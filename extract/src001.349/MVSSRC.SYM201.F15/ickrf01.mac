         TITLE '**********  ICKRF01:  REFORMAT COMMAND CONTROLLER  *****
               *********'
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
ICKRF01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL1(16)                                             0002
         DC    C'ICKRF01   78.192'                                 0002
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @12,0                                               0002
@PSTART  DS    0H                                                  0002
         USING @PSTART,@12                                         0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @11,@01                                             0002
         USING @DATD,@11                                           0002
         ST    @13,@SA00001+4                                      0002
         LM    @00,@01,20(@13)                                     0002
         ST    @11,8(,@13)                                         0002
         LR    @13,@11                                             0002
         XC    @ZTEMPS(@ZLEN),@ZTEMPS
         MVC   @PC00001(12),0(@01)                                 0002
*                                                                  0192
         EJECT
*                                                                  0193
*/*****  B E G I N    E X E C U T I O N  *****************************/
*                                                                  0193
*    IF GDTDBG = NULLPTR                                           0193
*      THEN;                                                       0193
         L     @10,@PC00001                                        0193
         L     @10,GDTDBG(,@10)                                    0193
         LTR   @10,@10                                             0193
         BZ    @RT00193                                            0193
*      ELSE                                                        0195
*        CALL ICKDB010 (GDTTBL, 'RF00');                           0195
*                                                                  0195
         L     @10,@PC00001                                        0195
         ST    @10,@AL00001                                        0195
         LA    @15,@CC00576                                        0195
         ST    @15,@AL00001+4                                      0195
         MVI   @AL00001+4,X'80'                                    0195
         L     @15,GDTDBG(,@10)                                    0195
         LA    @01,@AL00001                                        0195
         BALR  @14,@15                                             0195
*/*  ESTABLISH UPRINT ARGUMENT LIST                                  */
*    PRTHDR = 'DARGLIST';                                          0196
@RT00193 MVC   PRTHDR(4),@CC00577                                  0196
*    DDSTRU = ADDR(PRTARGS);                                       0197
         LA    @10,PRTARGS                                         0197
         ST    @10,DDSTRU                                          0197
*    PRTARGS = ''B;                                                0198
         XC    PRTARGS(20),PRTARGS                                 0198
*    DARGSMOD = MSGMODZ;                                           0199
         MVC   DARGSMOD(3,@10),@CC00525                            0199
*/*  INDICATE INITIALLY SUCCESSFUL COMPLETION (LASTCOND = 0)         */
*    LASTCOND = LASTCC00;                                          0200
         L     @10,@PC00001+8                                      0200
         SLR   @15,@15                                             0200
         STH   @15,LASTCOND(,@10)                                  0200
*/*  ISSUE_OPEN_VOLUME                                               */
*    CALL OPENVOL;                                                 0201
         BAL   @14,OPENVOL                                         0201
*/*  IF NO SEVERE ERRORS ENCOUNTERED                                 */
*    IF LASTCOND < LASTCC12                                        0202
*/*    THEN                                                          */
*      THEN DO;                                                    0202
*                                                                  0202
         L     @10,@PC00001+8                                      0202
         LH    @10,LASTCOND(,@10)                                  0202
         CH    @10,@CH00261                                        0202
         BNL   @RF00202                                            0202
*/*      OBTAIN SETTING OF FIRST TIME INITIALIZATION FLAG (UDEVINFO) */
*        CALL ICKDVIN0 (GDTTBL                                     0204
*                 ,VOLIB                                           0204
*                 ,VOLFINIT                                        0204
*                 ,POOLID                                          0204
*                 ,VIBPTR                                          0204
*                 ,VIBLEN                                          0204
*                 ,RETCODE);                                       0204
         L     @10,@PC00001                                        0204
         ST    @10,@AL00001                                        0204
         LA    @15,VOLIB                                           0204
         ST    @15,@AL00001+4                                      0204
         LA    @15,@CF00256                                        0204
         ST    @15,@AL00001+8                                      0204
         LA    @15,POOLID                                          0204
         ST    @15,@AL00001+12                                     0204
         LA    @15,VIBPTR                                          0204
         ST    @15,@AL00001+16                                     0204
         LA    @15,VIBLEN                                          0204
         ST    @15,@AL00001+20                                     0204
         LA    @15,RETCODE                                         0204
         ST    @15,@AL00001+24                                     0204
         L     @15,GDTDIN(,@10)                                    0204
         LA    @01,@AL00001                                        0204
         BALR  @14,@15                                             0204
*/*      IF THE VOLUME IS BEING INITIALIZED FOR THE FIRST TIME       */
*        IF VIBFLAG = ON                                           0205
*/*        THEN                                                      */
*          THEN DO;                                                0205
*                                                                  0205
         L     @10,VIBPTR                                          0205
         TM    VIBFLAG(@10),B'10000000'                            0205
         BNO   @RF00205                                            0205
*/*          ISSUE AN ERROR MESSAGE                                  */
*            DARGSENT = MSGRTIN;                                   0207
         L     @10,DDSTRU                                          0207
         MVI   DARGSENT(@10),X'1B'                                 0207
*            CALL ICKTPPR0 (GDTTBL                                 0208
*                   ,PRTFILE                                       0208
*                   ,DDSTRU);                                      0208
         L     @10,@PC00001                                        0208
         ST    @10,@AL00001                                        0208
         LA    @15,@CF00090                                        0208
         ST    @15,@AL00001+4                                      0208
         LA    @15,DDSTRU                                          0208
         ST    @15,@AL00001+8                                      0208
         MVI   @AL00001+8,X'80'                                    0208
         L     @15,GDTPRT(,@10)                                    0208
         LA    @01,@AL00001                                        0208
         BALR  @14,@15                                             0208
*/*          INDICATE A SEVERE ERROR                                 */
*            LASTCOND = LASTCC12;                                  0209
         L     @10,@PC00001+8                                      0209
         MVC   LASTCOND(2,@10),@CH00261                            0209
*/*          END-THEN                                                */
*            END;                                                  0210
*/*      END-THEN                                                    */
*        END;                                                      0211
@RF00205 DS    0H                                                  0212
*/*  IF NO SEVERE ERRORS ENCOUNTERED                                 */
*    IF LASTCOND < LASTCC12                                        0212
*/*    THEN                                                          */
*      THEN DO;                                                    0212
*                                                                  0212
@RF00202 L     @10,@PC00001+8                                      0212
         LH    @10,LASTCOND(,@10)                                  0212
         CH    @10,@CH00261                                        0212
         BNL   @RF00212                                            0212
*/*      OBTAIN_VOLUME_AUTHORIZATION                                 */
*        CALL ICKVA01                                              0214
*             (GDTTBL                                              0214
*             ,VOLIB                                               0214
*             ,RETCODE);                                           0214
         L     @10,@PC00001                                        0214
         ST    @10,@AL00001                                        0214
         LA    @10,VOLIB                                           0214
         ST    @10,@AL00001+4                                      0214
         LA    @10,RETCODE                                         0214
         ST    @10,@AL00001+8                                      0214
         L     @15,@CV00581                                        0214
         LA    @01,@AL00001                                        0214
         BALR  @14,@15                                             0214
*/*      IF VOLUME AUTHORIZATION NOT GRANTED                         */
*        IF RETCODE = FAILURE                                      0215
*/*        THEN INDICATE A SEVERE ERROR                              */
*          THEN LASTCOND = LASTCC12;                               0215
         CLC   RETCODE(4),@CF00161                                 0215
         BNE   @RF00215                                            0215
         L     @10,@PC00001+8                                      0216
         MVC   LASTCOND(2,@10),@CH00261                            0216
*/*      END-THEN                                                    */
*        END;                                                      0217
@RF00215 DS    0H                                                  0218
*/*  IF NO SEVERE ERRORS ENCOUNTERED AND VERIFICATION IS REQUESTED   */
*    IF (LASTCOND < LASTCC12) & (ADDR(VERFY) ^= NULLPTR)           0218
*/*    THEN                                                          */
*      THEN DO;                                                    0218
*                                                                  0218
@RF00212 L     @10,@PC00001+8                                      0218
         LH    @10,LASTCOND(,@10)                                  0218
         CH    @10,@CH00261                                        0218
         BNL   @RF00218                                            0218
         SLR   @10,@10                                             0218
         L     @15,@PC00001+4                                      0218
         C     @10,FDTPTR+16(,@15)                                 0218
         BE    @RF00218                                            0218
*/*      IF THE OWNER ID IS TO BE VERIFIED                           */
*        IF ADDR(VOWN) ^= NULLPTR                                  0220
*/*        THEN SET UP THE PROPER VALUE TO BE PASSED                 */
*          THEN DO;    VALVOWN = VOWNVAL; END;                     0220
         L     @15,FDTPTR+24(,@15)                                 0220
         CR    @15,@10                                             0220
         BE    @RF00220                                            0220
         MVC   VALVOWN(14),VOWNVAL(@15)                            0222
*/*        ELSE INDICATE THAT THE OWNER ID NEED NOT BE VERIFIED      */
*          ELSE DO;    VALVOWN = ' '; END;                         0224
         B     @RC00220                                            0224
@RF00220 DS    0H                                                  0225
         MVI   VALVOWN+1,C' '                                      0225
         MVC   VALVOWN+2(12),VALVOWN+1                             0225
         MVI   VALVOWN,C' '                                        0225
*/*      VERIFY_VOLUME_LABEL                                         */
*        CALL   ICKVV01                                            0227
*               (GDTTBL                                            0227
*               ,VOLIB                                             0227
*               ,VSERVAL                                           0227
*               ,VALVOWN                                           0227
*               ,RETCODE);                                         0227
@RC00220 L     @10,@PC00001                                        0227
         ST    @10,@AL00001                                        0227
         LA    @10,VOLIB                                           0227
         ST    @10,@AL00001+4                                      0227
         L     @10,@PC00001+4                                      0227
         L     @10,FDTPTR+20(,@10)                                 0227
         LA    @10,VSERVAL(,@10)                                   0227
         ST    @10,@AL00001+8                                      0227
         LA    @10,VALVOWN                                         0227
         ST    @10,@AL00001+12                                     0227
         LA    @10,RETCODE                                         0227
         ST    @10,@AL00001+16                                     0227
         L     @15,@CV00583                                        0227
         LA    @01,@AL00001                                        0227
         BALR  @14,@15                                             0227
*/*      IF VERIFICATION FAILS                                       */
*        IF RETCODE = FAILURE                                      0228
*/*        THEN INDICATE A SEVERE ERROR                              */
*          THEN LASTCOND = LASTCC12;                               0228
         CLC   RETCODE(4),@CF00161                                 0228
         BNE   @RF00228                                            0228
         L     @10,@PC00001+8                                      0229
         MVC   LASTCOND(2,@10),@CH00261                            0229
*/*      IF VOLUME LABEL DOES NOT EXIST                              */
*        IF RETCODE = NOLABEL                                      0230
*/*        THEN                                                      */
*          THEN DO;                                                0230
*                                                                  0230
@RF00228 CLC   RETCODE(4),@CF00112                                 0230
         BNE   @RF00230                                            0230
*/*          ISSUE ERROR MESSAGE (MSGURVOL) (UPRINT)                 */
*            DARGSENT = MSGURVOL;                                  0232
         L     @10,DDSTRU                                          0232
         MVI   DARGSENT(@10),X'10'                                 0232
*            CALL ICKTPPR0 (GDTTBL                                 0233
*                   ,PRTFILE                                       0233
*                   ,DDSTRU);                                      0233
         L     @10,@PC00001                                        0233
         ST    @10,@AL00001                                        0233
         LA    @15,@CF00090                                        0233
         ST    @15,@AL00001+4                                      0233
         LA    @15,DDSTRU                                          0233
         ST    @15,@AL00001+8                                      0233
         MVI   @AL00001+8,X'80'                                    0233
         L     @15,GDTPRT(,@10)                                    0233
         LA    @01,@AL00001                                        0233
         BALR  @14,@15                                             0233
*/*          INDICATE A SEVERE ERROR                                 */
*            LASTCOND = LASTCC12;                                  0234
         L     @10,@PC00001+8                                      0234
         MVC   LASTCOND(2,@10),@CH00261                            0234
*/*          END-THEN                                                */
*            END;                                                  0235
*/*      END-THEN                                                    */
*        END;                                                      0236
@RF00230 DS    0H                                                  0237
*/*  IF NO SEVERE ERRORS ENCOUNTERED                                 */
*    IF LASTCOND < LASTCC12                                        0237
*/*    THEN                                                          */
*      THEN DO;                                                    0237
*                                                                  0237
@RF00218 L     @10,@PC00001+8                                      0237
         LH    @10,LASTCOND(,@10)                                  0237
         CH    @10,@CH00261                                        0237
         BNL   @RF00237                                            0237
*/*      READ_VOLUME_LABEL                                           */
*        CALL ICKRL01                                              0239
*             (GDTTBL                                              0239
*             ,VOLIB                                               0239
*             ,VOL1P                                               0239
*             ,LABELS                                              0239
*             ,RETCODE);                                           0239
         L     @10,@PC00001                                        0239
         ST    @10,@AL00001                                        0239
         LA    @10,VOLIB                                           0239
         ST    @10,@AL00001+4                                      0239
         LA    @10,VOL1P                                           0239
         ST    @10,@AL00001+8                                      0239
         LA    @10,LABELS                                          0239
         ST    @10,@AL00001+12                                     0239
         LA    @10,RETCODE                                         0239
         ST    @10,@AL00001+16                                     0239
         L     @15,@CV00584                                        0239
         LA    @01,@AL00001                                        0239
         BALR  @14,@15                                             0239
*        RESPECIFY VOL1 BASED (ADDR(VOL1P));                       0240
*/*      IF UNABLE TO READ THE VOLUME LABEL                          */
*        IF RETCODE = NORVOLL                                      0241
*/*        THEN                                                      */
*          THEN DO;                                                0241
*                                                                  0241
         CLC   RETCODE(4),@CF00161                                 0241
         BNE   @RF00241                                            0241
*/*          ISSUE ERROR MESSAGE (MSGURVOL) (UPRINT)                 */
*            DARGSENT = MSGURVOL;                                  0243
         L     @10,DDSTRU                                          0243
         MVI   DARGSENT(@10),X'10'                                 0243
*            CALL ICKTPPR0 (GDTTBL                                 0244
*                   ,PRTFILE                                       0244
*                   ,DDSTRU);                                      0244
         L     @10,@PC00001                                        0244
         ST    @10,@AL00001                                        0244
         LA    @15,@CF00090                                        0244
         ST    @15,@AL00001+4                                      0244
         LA    @15,DDSTRU                                          0244
         ST    @15,@AL00001+8                                      0244
         MVI   @AL00001+8,X'80'                                    0244
         L     @15,GDTPRT(,@10)                                    0244
         LA    @01,@AL00001                                        0244
         BALR  @14,@15                                             0244
*/*          INDICATE A SEVERE ERROR (LASTCOND = 12)                 */
*            LASTCOND = LASTCC12;                                  0245
         L     @10,@PC00001+8                                      0245
         MVC   LASTCOND(2,@10),@CH00261                            0245
*/*          END-THEN                                                */
*            END;                                                  0246
*/*      END-THEN                                                    */
*        END;                                                      0247
@RF00241 DS    0H                                                  0248
*/*  IF NO SEVERE ERRORS ENCOUNTERED                                 */
*    IF LASTCOND < LASTCC12                                        0248
*/*    THEN                                                          */
*      THEN DO;                                                    0248
*                                                                  0248
@RF00237 L     @10,@PC00001+8                                      0248
         LH    @10,LASTCOND(,@10)                                  0248
         CH    @10,@CH00261                                        0248
         BNL   @RF00248                                            0248
*/*      IF NEW VOLUME-SERIAL OR OWNER-ID ARE SUPPLIED               */
*        IF ADDR(VOLID) ^= NULLPTR × ADDR(OWNER) ^= NULLPTR        0250
*/*        THEN                                                      */
*          THEN DO;                                                0250
*                                                                  0250
         SLR   @10,@10                                             0250
         L     @15,@PC00001+4                                      0250
         C     @10,FDTPTR+4(,@15)                                  0250
         BNE   @RT00250                                            0250
         C     @10,FDTPTR+8(,@15)                                  0250
         BE    @RF00250                                            0250
@RT00250 DS    0H                                                  0251
*/*          FOR SYSTEMS WITH RACF, CHECK PROPER LEVEL OF            */
*/*           AUTHORIZATION                                          */
*            CALL ICKSAVC0 (GDTTBL                                 0252
*                    ,VOL1SER                                      0252
*                    ,ALTER);                                      0252
         L     @10,@PC00001                                        0252
         ST    @10,@AL00001                                        0252
         LA    @03,VOL1P                                           0252
         LA    @03,VOL1SER(,@03)                                   0252
         ST    @03,@AL00001+4                                      0252
         LA    @03,@CC00151                                        0252
         ST    @03,@AL00001+8                                      0252
         MVI   @AL00001+8,X'80'                                    0252
         L     @15,GDTVCK(,@10)                                    0252
         LA    @01,@AL00001                                        0252
         BALR  @14,@15                                             0252
*            RESPECIFY RTNREG RSTD;                                0253
*            TESTRC = RTNREG;                                      0254
         LR    TESTRC,RTNREG                                       0254
*            RESPECIFY RTNREG UNRSTD;                              0255
*/*          IF USER ALLOWED TO ACCESS VOLUME                        */
*            IF (TESTRC = 0) × (TESTRC = 4)                        0256
*/*            THEN                                                  */
*              THEN DO;                                            0256
*                                                                  0256
         LTR   TESTRC,TESTRC                                       0256
         BZ    @RT00256                                            0256
         CH    TESTRC,@CH00040                                     0256
         BNE   @RF00256                                            0256
@RT00256 DS    0H                                                  0257
*/*              CHANGE_VOLUME_LABEL                                 */
*                IF ADDR(OWNER) = NULLPTR                          0258
*                  THEN DO;    OWNERID = ' '; END;                 0258
         L     @10,@PC00001+4                                      0258
         L     @10,FDTPTR+8(,@10)                                  0258
         LTR   @10,@10                                             0258
         BNZ   @RF00258                                            0258
         MVI   OWNERID+1,C' '                                      0260
         MVC   OWNERID+2(12),OWNERID+1                             0260
         MVI   OWNERID,C' '                                        0260
*                  ELSE DO;    OWNERID = OWNERVAL; END;            0262
         B     @RC00258                                            0262
@RF00258 DS    0H                                                  0263
         L     @10,@PC00001+4                                      0263
         L     @10,FDTPTR+8(,@10)                                  0263
         MVC   OWNERID(14),OWNERVAL(@10)                           0263
*                IF ADDR(VOLID) = NULLPTR                          0265
*                  THEN DO;    VOLSER = ' '; END;                  0265
@RC00258 L     @10,@PC00001+4                                      0265
         L     @10,FDTPTR+4(,@10)                                  0265
         LTR   @10,@10                                             0265
         BNZ   @RF00265                                            0265
         MVI   VOLSER+1,C' '                                       0267
         MVC   VOLSER+2(4),VOLSER+1                                0267
         MVI   VOLSER,C' '                                         0267
*                  ELSE DO;    VOLSER = VOLIDVAL; END;             0269
         B     @RC00265                                            0269
@RF00265 DS    0H                                                  0270
         L     @10,@PC00001+4                                      0270
         L     @10,FDTPTR+4(,@10)                                  0270
         MVC   VOLSER(6),VOLIDVAL(@10)                             0270
*                CALL ICKCV01                                      0272
*                     (GDTTBL                                      0272
*                     ,VOLIB                                       0272
*                     ,VOLSER                                      0272
*                     ,OWNERID                                     0272
*                     ,VTOCLOC                                     0272
*                     ,RETCODE);                                   0272
@RC00265 L     @10,@PC00001                                        0272
         ST    @10,@AL00001                                        0272
         LA    @10,VOLIB                                           0272
         ST    @10,@AL00001+4                                      0272
         LA    @10,VOLSER                                          0272
         ST    @10,@AL00001+8                                      0272
         LA    @10,OWNERID                                         0272
         ST    @10,@AL00001+12                                     0272
         LA    @10,@CF00090                                        0272
         ST    @10,@AL00001+16                                     0272
         LA    @10,RETCODE                                         0272
         ST    @10,@AL00001+20                                     0272
         L     @15,@CV00587                                        0272
         LA    @01,@AL00001                                        0272
         BALR  @14,@15                                             0272
*/*              IF CHANGE OPERATION FAILS                           */
*                IF RETCODE = FAILURE                              0273
*/*                THEN                                              */
*                  THEN DO;                                        0273
*                                                                  0273
         CLC   RETCODE(4),@CF00161                                 0273
         BNE   @RF00273                                            0273
*/*                  ISSUE ERROR MESSAGE (MSGLABB) (UPRINT)          */
*                    DARGSENT = MSGLABB;                           0275
         L     @10,DDSTRU                                          0275
         MVI   DARGSENT(@10),X'17'                                 0275
*                    CALL ICKTPPR0 (GDTTBL                         0276
*                           ,PRTFILE                               0276
*                           ,DDSTRU);                              0276
         L     @10,@PC00001                                        0276
         ST    @10,@AL00001                                        0276
         LA    @15,@CF00090                                        0276
         ST    @15,@AL00001+4                                      0276
         LA    @15,DDSTRU                                          0276
         ST    @15,@AL00001+8                                      0276
         MVI   @AL00001+8,X'80'                                    0276
         L     @15,GDTPRT(,@10)                                    0276
         LA    @01,@AL00001                                        0276
         BALR  @14,@15                                             0276
*/*                  INDICATE A SEVERE ERROR                         */
*                    LASTCOND = LASTCC12;                          0277
         L     @10,@PC00001+8                                      0277
         MVC   LASTCOND(2,@10),@CH00261                            0277
*/*                  END-THEN                                        */
*                    END;                                          0278
*/*              END-THEN (USER ALLOWED TO ACCESS VOLUME)            */
*                END;                                              0279
*/*            ELSE (USER NOT ALLOWED TO CHANGE VOLUME LABEL)        */
*              ELSE DO;                                            0280
*                                                                  0280
         B     @RC00256                                            0280
@RF00256 DS    0H                                                  0281
*/*              ISSUE ERROR MESSAGE (MSGVOLAU) (UPRINT)             */
*                DARGSENT = MSGVOLAU;                              0281
         L     @10,DDSTRU                                          0281
         MVI   DARGSENT(@10),X'1D'                                 0281
*                CALL ICKTPPR0 (GDTTBL                             0282
*                       ,PRTFILE                                   0282
*                       ,DDSTRU);                                  0282
         L     @10,@PC00001                                        0282
         ST    @10,@AL00001                                        0282
         LA    @15,@CF00090                                        0282
         ST    @15,@AL00001+4                                      0282
         LA    @15,DDSTRU                                          0282
         ST    @15,@AL00001+8                                      0282
         MVI   @AL00001+8,X'80'                                    0282
         L     @15,GDTPRT(,@10)                                    0282
         LA    @01,@AL00001                                        0282
         BALR  @14,@15                                             0282
*/*              INDICATE SEVERE ERROR (LASTCOND = 12)               */
*                LASTCOND = LASTCC12;                              0283
         L     @10,@PC00001+8                                      0283
         MVC   LASTCOND(2,@10),@CH00261                            0283
*/*              END-ELSE                                            */
*                END;                                              0284
*/*          END-THEN                                                */
*            END;                                                  0285
@RC00256 DS    0H                                                  0286
*/*      END-THEN                                                    */
*        END;                                                      0286
@RF00250 DS    0H                                                  0287
*/*  IF NO SEVERE ERRORS ENCOUNTERED                                 */
*    IF LASTCOND < LASTCC12                                        0287
*/*    THEN                                                          */
*      THEN DO;                                                    0287
*                                                                  0287
@RF00248 L     @10,@PC00001+8                                      0287
         LH    @10,LASTCOND(,@10)                                  0287
         CH    @10,@CH00261                                        0287
         BNL   @RF00287                                            0287
*/*      IF IPL PROGRAM IS SUPPLIED                                  */
*        IF ADDR(IPLDD) ^= NULLPTR                                 0289
*/*        THEN                                                      */
*          THEN DO;                                                0289
*                                                                  0289
         L     @10,@PC00001+4                                      0289
         L     @10,FDTPTR+12(,@10)                                 0289
         LTR   @10,@10                                             0289
         BZ    @RF00289                                            0289
*/*          FOR SYSTEMS WITH RACF, CHECK PROPER LEVEL OF            */
*/*           AUTHORIZATION                                          */
*            CALL ICKSAVC0 (GDTTBL                                 0291
*                    ,VOL1SER                                      0291
*                    ,UPDATE);                                     0291
         L     @10,@PC00001                                        0291
         ST    @10,@AL00001                                        0291
         LA    @03,VOL1P                                           0291
         LA    @03,VOL1SER(,@03)                                   0291
         ST    @03,@AL00001+4                                      0291
         LA    @03,@CC00153                                        0291
         ST    @03,@AL00001+8                                      0291
         MVI   @AL00001+8,X'80'                                    0291
         L     @15,GDTVCK(,@10)                                    0291
         LA    @01,@AL00001                                        0291
         BALR  @14,@15                                             0291
*            RESPECIFY RTNREG RSTD;                                0292
*            TESTRC = RTNREG;                                      0293
         LR    TESTRC,RTNREG                                       0293
*            RESPECIFY RTNREG UNRSTD;                              0294
*/*          IF USER ALLOWED TO ACCESS VOLUME                        */
*            IF (TESTRC = 0) × (TESTRC = 4)                        0295
*/*            THEN                                                  */
*              THEN DO;                                            0295
*                                                                  0295
         LTR   TESTRC,TESTRC                                       0295
         BZ    @RT00295                                            0295
         CH    TESTRC,@CH00040                                     0295
         BNE   @RF00295                                            0295
@RT00295 DS    0H                                                  0296
*/*              WRITE_IPL_RECORDS                                   */
*                IF ADDR(PURGE) = NULLPTR                          0297
*                  THEN DO;    PRGFLG = OFF; END;                  0297
         L     @10,@PC00001+4                                      0297
         L     @10,FDTPTR+32(,@10)                                 0297
         LTR   @10,@10                                             0297
         BNZ   @RF00297                                            0297
         NI    PRGFLG,B'01111111'                                  0299
*                  ELSE DO;    PRGFLG = ON; END;                   0301
         B     @RC00297                                            0301
@RF00297 DS    0H                                                  0302
         OI    PRGFLG,B'10000000'                                  0302
*/*              IF BOOTSTRAP RECORDS ARE SUPPLIED BY THE USER       */
*                IF ADDR (BOOTS) ^= NULLPTR                        0304
*/*                THEN INDICATE THAT THE BOOTSTRAP RECS ARE SUPPLIED*/
*                  THEN DO;    BOOTFLG = BOOTYES; END;             0304
@RC00297 L     @10,@PC00001+4                                      0304
         L     @10,FDTPTR+48(,@10)                                 0304
         LTR   @10,@10                                             0304
         BZ    @RF00304                                            0304
         OI    BOOTFLG,B'10000000'                                 0306
*/*                ELSE INDICATE THAT THEY ARE NOT SUPPLIED          */
*                  ELSE DO;    BOOTFLG = BOOTNO; END;              0308
         B     @RC00304                                            0308
@RF00304 DS    0H                                                  0309
         NI    BOOTFLG,B'01111111'                                 0309
*                CALL ICKWI01                                      0311
*                     (GDTTBL                                      0311
*                     ,VOLIB                                       0311
*                     ,IPLDDVAL                                    0311
*                     ,PRGFLG                                      0311
*                     ,BOOTFLG                                     0311
*                     ,RETCODE);                                   0311
@RC00304 L     @10,@PC00001                                        0311
         ST    @10,@AL00001                                        0311
         LA    @10,VOLIB                                           0311
         ST    @10,@AL00001+4                                      0311
         L     @10,@PC00001+4                                      0311
         L     @10,FDTPTR+12(,@10)                                 0311
         LA    @10,IPLDDVAL(,@10)                                  0311
         ST    @10,@AL00001+8                                      0311
         LA    @10,PRGFLG                                          0311
         ST    @10,@AL00001+12                                     0311
         LA    @10,BOOTFLG                                         0311
         ST    @10,@AL00001+16                                     0311
         LA    @10,RETCODE                                         0311
         ST    @10,@AL00001+20                                     0311
         L     @15,@CV00588                                        0311
         LA    @01,@AL00001                                        0311
         BALR  @14,@15                                             0311
*/*              IF WRITE OPERATION FAILS                            */
*                IF RETCODE = FAILURE                              0312
*/*                THEN                                              */
*                  THEN DO;                                        0312
*                                                                  0312
         CLC   RETCODE(4),@CF00161                                 0312
         BNE   @RF00312                                            0312
*/*                  ISSUE ERROR MESSAGE (MSGIPLA) (UPRINT)          */
*                    DARGSENT = MSGIPLA;                           0314
         L     @10,DDSTRU                                          0314
         MVI   DARGSENT(@10),X'09'                                 0314
*                    CALL ICKTPPR0 (GDTTBL                         0315
*                           ,PRTFILE                               0315
*                           ,DDSTRU);                              0315
         L     @10,@PC00001                                        0315
         ST    @10,@AL00001                                        0315
         LA    @15,@CF00090                                        0315
         ST    @15,@AL00001+4                                      0315
         LA    @15,DDSTRU                                          0315
         ST    @15,@AL00001+8                                      0315
         MVI   @AL00001+8,X'80'                                    0315
         L     @15,GDTPRT(,@10)                                    0315
         LA    @01,@AL00001                                        0315
         BALR  @14,@15                                             0315
*/*                  INDICATE AN ERROR                               */
*                    LASTCOND = LASTCC08;                          0316
         L     @10,@PC00001+8                                      0316
         MVC   LASTCOND(2,@10),@CH00157                            0316
*/*                  END-THEN                                        */
*                    END;                                          0317
*/*                ELSE (OPERATION SUCCESSFUL)                       */
*                  ELSE DO;                                        0318
         B     @RC00312                                            0318
@RF00312 DS    0H                                                  0319
*/*                  IF USER VOLMES EXISTED AND WERE PURGED          */
*                    IF LABELS > 0 & PRGFLG = ON                   0319
*/*                    THEN CHANGE_VOLUME_LABEL (TO UPDATE COUNT)    */
*                      THEN DO;                                    0319
         L     @10,LABELS                                          0319
         LTR   @10,@10                                             0319
         BNP   @RF00319                                            0319
         TM    PRGFLG,B'10000000'                                  0319
         BNO   @RF00319                                            0319
*                        OWNERID = ' ';                            0321
         MVI   OWNERID+1,C' '                                      0321
         MVC   OWNERID+2(12),OWNERID+1                             0321
         MVI   OWNERID,C' '                                        0321
*                        VOLSER = ' ';                             0322
         MVI   VOLSER+1,C' '                                       0322
         MVC   VOLSER+2(4),VOLSER+1                                0322
         MVI   VOLSER,C' '                                         0322
*                        CALL ICKCV01                              0323
*                             (GDTTBL                              0323
*                             ,VOLIB                               0323
*                             ,VOLSER                              0323
*                             ,OWNERID                             0323
*                             ,VTOCLOC                             0323
*                             ,RETCODE);                           0323
         L     @10,@PC00001                                        0323
         ST    @10,@AL00001                                        0323
         LA    @10,VOLIB                                           0323
         ST    @10,@AL00001+4                                      0323
         LA    @10,VOLSER                                          0323
         ST    @10,@AL00001+8                                      0323
         LA    @10,OWNERID                                         0323
         ST    @10,@AL00001+12                                     0323
         LA    @10,@CF00090                                        0323
         ST    @10,@AL00001+16                                     0323
         LA    @10,RETCODE                                         0323
         ST    @10,@AL00001+20                                     0323
         L     @15,@CV00587                                        0323
         LA    @01,@AL00001                                        0323
         BALR  @14,@15                                             0323
*/*                      IF CHANGE OPERATION FAILS                   */
*                        IF RETCODE = FAILURE                      0324
*/*                        THEN                                      */
*                          THEN DO;                                0324
*                                                                  0324
         CLC   RETCODE(4),@CF00161                                 0324
         BNE   @RF00324                                            0324
*/*                          ISSUE ERROR MESSAGE (MSGLABB) (UPRINT)  */
*                            DARGSENT = MSGLABB;                   0326
         L     @10,DDSTRU                                          0326
         MVI   DARGSENT(@10),X'17'                                 0326
*                            CALL ICKTPPR0 (GDTTBL                 0327
*                                   ,PRTFILE                       0327
*                                   ,DDSTRU);                      0327
         L     @10,@PC00001                                        0327
         ST    @10,@AL00001                                        0327
         LA    @15,@CF00090                                        0327
         ST    @15,@AL00001+4                                      0327
         LA    @15,DDSTRU                                          0327
         ST    @15,@AL00001+8                                      0327
         MVI   @AL00001+8,X'80'                                    0327
         L     @15,GDTPRT(,@10)                                    0327
         LA    @01,@AL00001                                        0327
         BALR  @14,@15                                             0327
*/*                          INDICATE A SEVERE ERROR                 */
*                            LASTCOND = LASTCC12;                  0328
         L     @10,@PC00001+8                                      0328
         MVC   LASTCOND(2,@10),@CH00261                            0328
*/*                          END-THEN                                */
*                            END;                                  0329
*/*                      END-THEN                                    */
*                        END;                                      0330
*/*                  END-ELSE                                        */
*                    END;                                          0331
*/*              END-THEN (USER ALLOWED ACCESS TO THE VOLUME)        */
*                END;                                              0332
*/*            ELSE (USER NOT ALLOWED TO CHANGE VOLUME LABEL)        */
*              ELSE DO;                                            0333
*                                                                  0333
         B     @RC00295                                            0333
@RF00295 DS    0H                                                  0334
*/*              ISSUE ERROR MESSAGE (MSGIPLAU) (UPRINT)             */
*                DARGSENT = MSGIPLAU;                              0334
         L     @10,DDSTRU                                          0334
         MVI   DARGSENT(@10),X'1E'                                 0334
*                CALL ICKTPPR0 (GDTTBL                             0335
*                       ,PRTFILE                                   0335
*                       ,DDSTRU);                                  0335
         L     @10,@PC00001                                        0335
         ST    @10,@AL00001                                        0335
         LA    @15,@CF00090                                        0335
         ST    @15,@AL00001+4                                      0335
         LA    @15,DDSTRU                                          0335
         ST    @15,@AL00001+8                                      0335
         MVI   @AL00001+8,X'80'                                    0335
         L     @15,GDTPRT(,@10)                                    0335
         LA    @01,@AL00001                                        0335
         BALR  @14,@15                                             0335
*/*              INDICATE SEVERE ERROR (LASTCOND = 12)               */
*                LASTCOND = LASTCC12;                              0336
         L     @10,@PC00001+8                                      0336
         MVC   LASTCOND(2,@10),@CH00261                            0336
*/*              END-ELSE                                            */
*                END;                                              0337
*/*          END-THEN                                                */
*            END;                                                  0338
@RC00295 DS    0H                                                  0339
*/*      END-THEN                                                    */
*        END;                                                      0339
@RF00289 DS    0H                                                  0340
*/*  CLOSE THE VOLUME (UDEVCLSE)                                     */
*    CALL ICKDVCL0 (GDTTBL                                         0340
*             ,VOLIB                                               0340
*             ,RETCODE);                                           0340
@RF00287 L     @10,@PC00001                                        0340
         ST    @10,@AL00001                                        0340
         LA    @15,VOLIB                                           0340
         ST    @15,@AL00001+4                                      0340
         LA    @15,RETCODE                                         0340
         ST    @15,@AL00001+8                                      0340
         L     @15,GDTDVC(,@10)                                    0340
         LA    @01,@AL00001                                        0340
         BALR  @14,@15                                             0340
*/*  IF UNABLE TO CLOSE THE VOLUME                                   */
*    IF RETCODE = FAILURE                                          0341
*/*    THEN                                                          */
*      THEN DO;                                                    0341
*                                                                  0341
         CLC   RETCODE(4),@CF00161                                 0341
         BNE   @RF00341                                            0341
*/*      ISSUE ERROR MESSAGE (MSGCLSEA) (UPRINT)                     */
*        DARGSENT = MSGCLSEA;                                      0343
         L     @10,DDSTRU                                          0343
         MVI   DARGSENT(@10),X'0B'                                 0343
*        CALL ICKTPPR0 (GDTTBL                                     0344
*               ,PRTFILE                                           0344
*               ,DDSTRU);                                          0344
         L     @10,@PC00001                                        0344
         ST    @10,@AL00001                                        0344
         LA    @15,@CF00090                                        0344
         ST    @15,@AL00001+4                                      0344
         LA    @15,DDSTRU                                          0344
         ST    @15,@AL00001+8                                      0344
         MVI   @AL00001+8,X'80'                                    0344
         L     @15,GDTPRT(,@10)                                    0344
         LA    @01,@AL00001                                        0344
         BALR  @14,@15                                             0344
*/*      SET LASTCOND = 8 OR MAXIMUM ENCOUNTERED                     */
*        LASTCOND = MAX (LASTCOND,8);                              0345
         L     @10,@PC00001+8                                      0345
         LH    @15,LASTCOND(,@10)                                  0345
         LA    @14,8                                               0345
         CR    @15,@14                                             0345
         BNL   *+6
         LR    @15,@14                                             0345
         STH   @15,LASTCOND(,@10)                                  0345
*/*      END-THEN                                                    */
*        END;                                                      0346
*/*  RETURN                                                          */
*    DARGSMOD = MSGUNIV;                                           0347
@RF00341 L     @10,DDSTRU                                          0347
         MVC   DARGSMOD(3,@10),@CC00539                            0347
*    IF LASTCOND >= LASTCC12                                       0348
*      THEN DO;    DARGSENT = MSGUNIVB; END;                       0348
         L     @15,@PC00001+8                                      0348
         LH    @15,LASTCOND(,@15)                                  0348
         CH    @15,@CH00261                                        0348
         BL    @RF00348                                            0348
         MVI   DARGSENT(@10),X'03'                                 0350
*      ELSE DO;    DARGSENT = MSGUNIVA; END;                       0352
         B     @RC00348                                            0352
@RF00348 DS    0H                                                  0353
         L     @10,DDSTRU                                          0353
         MVI   DARGSENT(@10),X'01'                                 0353
*    DARGDBP = ADDR (LASTCOND);                                    0355
@RC00348 L     @10,DDSTRU                                          0355
         L     @15,@PC00001+8                                      0355
         ST    @15,DARGDBP(,@10)                                   0355
*    DARGILP = LENGTH (LASTCOND);                                  0356
         MVC   DARGILP(2,@10),@CH00112                             0356
*    CALL ICKTPPR0 (GDTTBL                                         0357
*           ,PRTFILE                                               0357
*           ,DDSTRU);                                              0357
         L     @10,@PC00001                                        0357
         ST    @10,@AL00001                                        0357
         LA    @15,@CF00090                                        0357
         ST    @15,@AL00001+4                                      0357
         LA    @15,DDSTRU                                          0357
         ST    @15,@AL00001+8                                      0357
         MVI   @AL00001+8,X'80'                                    0357
         L     @15,GDTPRT(,@10)                                    0357
         LA    @01,@AL00001                                        0357
         BALR  @14,@15                                             0357
*    IF GDTDBG = NULLPTR                                           0358
*      THEN;                                                       0358
         L     @10,@PC00001                                        0358
         L     @10,GDTDBG(,@10)                                    0358
         LTR   @10,@10                                             0358
         BZ    @RT00358                                            0358
*      ELSE                                                        0360
*        CALL ICKDB010 (GDTTBL                                     0360
*          ,'RF99');                                               0360
         L     @10,@PC00001                                        0360
         ST    @10,@AL00001                                        0360
         LA    @15,@CC00590                                        0360
         ST    @15,@AL00001+4                                      0360
         MVI   @AL00001+4,X'80'                                    0360
         L     @15,GDTDBG(,@10)                                    0360
         LA    @01,@AL00001                                        0360
         BALR  @14,@15                                             0360
*    CALL ICKSAFP0 (GDTTBL                                         0361
*           ,POOLID);                                              0361
@RT00358 L     @10,@PC00001                                        0361
         ST    @10,@AL00001                                        0361
         LA    @15,POOLID                                          0361
         ST    @15,@AL00001+4                                      0361
         MVI   @AL00001+4,X'80'                                    0361
         L     @15,GDTFPL(,@10)                                    0361
         LA    @01,@AL00001                                        0361
         BALR  @14,@15                                             0361
*     CALL ICKSAEP0(GDTTBL,MODID);                                 0362
*                                                                  0362
         L     @10,@PC00001                                        0362
         ST    @10,@AL00001                                        0362
         LA    @15,MODID                                           0362
         ST    @15,@AL00001+4                                      0362
         MVI   @AL00001+4,X'80'                                    0362
         L     @15,GDTEPL(,@10)                                    0362
         LA    @01,@AL00001                                        0362
         BALR  @14,@15                                             0362
         EJECT
*/*****  START OF SPECIFICATIONS  ************************************/
*/*                                                                  */
*/*  SUB-PROCEDURE NAME:  OPENVOL                                    */
*/*                                                                  */
*/*  DESCRIPTIVE NAME:  ISSUE OPEN VOLUME                            */
*/*                                                                  */
*/*  FUNCTION:                                                       */
*/*                                                                  */
*/*    THIS SUBPROCEDURE INVOKES THE DEVICE ADAPTER MODULE THAT      */
*/*    OPENS THE VOLUME FOR SUBSEQUENT PROCESSING. IT ALSO ENSURES   */
*/*    THAT THE VOLUME IS MOUNTED PRIVATE WHEN THE VOLUME IS ON-LINE.*/
*/*                                                                  */
*/*****  END OF SPECIFICATIONS  **************************************/
*                                                                  0363
*                                                                  0363
*/*  SUB-PROCEDURE ISSUE_OPEN_VOLUME                                 */
*    OPENVOL:                                                      0363
*      PROCEDURE;                                                  0363
@EL00001 L     @13,4(,@13)                                         0363
@EF00001 L     @00,@SIZDATD                                        0363
         LR    @01,@11                                             0363
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0363
         BR    @14                                                 0363
OPENVOL  STM   @14,@12,@SA00002                                    0363
*    OLDERID2 = NEWERID2;                                          0364
         L     @10,@PC00001                                        0364
         L     @10,GDTTR2(,@10)                                    0364
         MVC   @TS00001(95),NEWERID2(@10)                          0364
         MVC   OLDERID2(95,@10),@TS00001                           0364
*    NEWID2 =  'RFOP';                                             0365
         MVC   NEWID2(4,@10),@CC00594                              0365
*/*  OPEN THE VOLUME FOR PROCESSING (UDEVOPEN)                       */
*/*  SET UP MSS PARAMETER AS A BLANK FIELD SINCE THIS COMMAND DOES   */
*/*   NOT SUPPORT MSS                                                */
*    MSSDEV = ' ';                                                 0366
         MVI   MSSDEV+1,C' '                                       0366
         MVC   MSSDEV+2(6),MSSDEV+1                                0366
         MVI   MSSDEV,C' '                                         0366
*/*  SET UP THE CUU OR DD-NAME PARAMETER                             */
*    IF (ADDR(DEVIC) ^= NULLPTR) & (ADDR(DNAME) = NULLPTR)         0367
*      THEN DO;                                                    0367
*                                                                  0367
         SLR   @10,@10                                             0367
         L     @15,@PC00001+4                                      0367
         L     @14,FDTPTR(,@15)                                    0367
         CR    @14,@10                                             0367
         BE    @RF00367                                            0367
         C     @10,FDTPTR+40(,@15)                                 0367
         BNE   @RF00367                                            0367
*        VIBNAME = DEVICVAL;                                       0369
         MVI   VIBNAME+3,C' '                                      0369
         MVC   VIBNAME+4(4),VIBNAME+3                              0369
         MVC   VIBNAME(3),DEVICVAL(@14)                            0369
*        VIBTYPE = CUUVAL;                                         0370
         ST    @10,VIBTYPE                                         0370
*        END;                                                      0371
*      ELSE DO;                                                    0372
*                                                                  0372
         B     @RC00367                                            0372
@RF00367 DS    0H                                                  0373
*        VIBNAME = DNAMEVAL;                                       0373
         L     @10,@PC00001+4                                      0373
         L     @10,FDTPTR+40(,@10)                                 0373
         MVC   VIBNAME(8),DNAMEVAL(@10)                            0373
*        VIBTYPE = DDNVAL;                                         0374
         MVC   VIBTYPE(4),@CF00161                                 0374
*        END;                                                      0375
*/*  IF DEVICETYPE IS SUPPLIED                                       */
*    IF ADDR (DEVTY) ^= NULLPTR                                    0376
*/*    THEN PASS THE DEVICE TYPE                                     */
*      THEN DO;    DEVTYPE = DEVTYVAL; END;                        0376
@RC00367 L     @10,@PC00001+4                                      0376
         L     @10,FDTPTR+44(,@10)                                 0376
         LTR   @10,@10                                             0376
         BZ    @RF00376                                            0376
         MVC   DEVTYPE(8),DEVTYVAL(@10)                            0378
*/*    ELSE INDICATE NO DEVICE TYPE SUPPLIED                         */
*      ELSE DO;    DEVTYPE = ' '; END;                             0380
         B     @RC00376                                            0380
@RF00376 DS    0H                                                  0381
         MVI   DEVTYPE+1,C' '                                      0381
         MVC   DEVTYPE+2(6),DEVTYPE+1                              0381
         MVI   DEVTYPE,C' '                                        0381
*    CALL ICKDVON0 (GDTTBL                                         0383
*             ,VIBNAME                                             0383
*             ,VIBTYPE                                             0383
*             ,DEVTYPE                                             0383
*             ,MSSDEV                                              0383
*             ,VOLIB                                               0383
*             ,RETCODE);                                           0383
@RC00376 L     @10,@PC00001                                        0383
         ST    @10,@AL00001                                        0383
         LA    @15,VIBNAME                                         0383
         ST    @15,@AL00001+4                                      0383
         LA    @15,VIBTYPE                                         0383
         ST    @15,@AL00001+8                                      0383
         LA    @15,DEVTYPE                                         0383
         ST    @15,@AL00001+12                                     0383
         LA    @15,MSSDEV                                          0383
         ST    @15,@AL00001+16                                     0383
         LA    @15,VOLIB                                           0383
         ST    @15,@AL00001+20                                     0383
         LA    @15,RETCODE                                         0383
         ST    @15,@AL00001+24                                     0383
         L     @15,GDTDVO(,@10)                                    0383
         LA    @01,@AL00001                                        0383
         BALR  @14,@15                                             0383
*/*  IF CUU OR DD-NAME IS INVALID                                    */
*    IF RETCODE = INVALCUU                                         0384
*/*    THEN                                                          */
*      THEN DO;                                                    0384
*                                                                  0384
         CLC   RETCODE(4),@CF00161                                 0384
         BNE   @RF00384                                            0384
*/*      ISSUE ERROR MESSAGE (MSGINCUU) (UPRINT)                     */
*        DARGSENT = MSGINCUU;                                      0386
         L     @10,DDSTRU                                          0386
         MVI   DARGSENT(@10),X'18'                                 0386
*        CALL ICKTPPR0 (GDTTBL                                     0387
*               ,PRTFILE                                           0387
*               ,DDSTRU);                                          0387
         L     @10,@PC00001                                        0387
         ST    @10,@AL00001                                        0387
         LA    @15,@CF00090                                        0387
         ST    @15,@AL00001+4                                      0387
         LA    @15,DDSTRU                                          0387
         ST    @15,@AL00001+8                                      0387
         MVI   @AL00001+8,X'80'                                    0387
         L     @15,GDTPRT(,@10)                                    0387
         LA    @01,@AL00001                                        0387
         BALR  @14,@15                                             0387
*/*      INDICATE SEVERE ERROR (LASTCOND = 12)                       */
*        LASTCOND = LASTCC12;                                      0388
         L     @10,@PC00001+8                                      0388
         MVC   LASTCOND(2,@10),@CH00261                            0388
*/*      END-THEN                                                    */
*        END;                                                      0389
*/*  IF NO ERRORS FOUND SO FAR                                       */
*    IF LASTCOND < LASTCC12                                        0390
*/*    THEN                                                          */
*      THEN DO;                                                    0390
*                                                                  0390
@RF00384 L     @10,@PC00001+8                                      0390
         LH    @10,LASTCOND(,@10)                                  0390
         CH    @10,@CH00261                                        0390
         BNL   @RF00390                                            0390
*/*      IF UNABLE TO OPEN VOLUME                                    */
*        IF RETCODE = NOOPEN                                       0392
*/*        THEN                                                      */
*          THEN DO;                                                0392
*                                                                  0392
         CLC   RETCODE(4),@CF00112                                 0392
         BNE   @RF00392                                            0392
*/*          ISSUE ERROR MESSAGE (MSGNOPEN) (UPRINT)                 */
*            DARGSENT = MSGNOPEN;                                  0394
         L     @10,DDSTRU                                          0394
         MVI   DARGSENT(@10),X'19'                                 0394
*            CALL ICKTPPR0 (GDTTBL                                 0395
*                   ,PRTFILE                                       0395
*                   ,DDSTRU);                                      0395
         L     @10,@PC00001                                        0395
         ST    @10,@AL00001                                        0395
         LA    @15,@CF00090                                        0395
         ST    @15,@AL00001+4                                      0395
         LA    @15,DDSTRU                                          0395
         ST    @15,@AL00001+8                                      0395
         MVI   @AL00001+8,X'80'                                    0395
         L     @15,GDTPRT(,@10)                                    0395
         LA    @01,@AL00001                                        0395
         BALR  @14,@15                                             0395
*/*          INDICATE SEVERE ERROR (LASTCOND = 12)                   */
*            LASTCOND = LASTCC12;                                  0396
         L     @10,@PC00001+8                                      0396
         MVC   LASTCOND(2,@10),@CH00261                            0396
*/*          END-THEN                                                */
*            END;                                                  0397
*/*      END-THEN                                                    */
*        END;                                                      0398
@RF00392 DS    0H                                                  0399
*/*  IF NO ERRORS FOUND SO FAR                                       */
*    IF LASTCOND < LASTCC12                                        0399
*/*    THEN                                                          */
*      THEN DO;                                                    0399
*                                                                  0399
@RF00390 L     @10,@PC00001+8                                      0399
         LH    @10,LASTCOND(,@10)                                  0399
         CH    @10,@CH00261                                        0399
         BNL   @RF00399                                            0399
*/*      IF CUU WAS SPECIFIED FOR AN ON-LINE VOLUME                  */
*        IF RETCODE = RCCUUONL                                     0401
*/*        THEN                                                      */
*          THEN DO;                                                0401
*                                                                  0401
         CLC   RETCODE(4),@CF00132                                 0401
         BNE   @RF00401                                            0401
*/*          ISSUE AN ERROR MESSAGE (MSGLINE)                        */
*            DARGSENT = MSGLINE;                                   0403
         L     @10,DDSTRU                                          0403
         MVI   DARGSENT(@10),X'31'                                 0403
*            CALL ICKTPPR0 (GDTTBL                                 0404
*                   ,PRTFILE                                       0404
*                   ,DDSTRU);                                      0404
         L     @10,@PC00001                                        0404
         ST    @10,@AL00001                                        0404
         LA    @15,@CF00090                                        0404
         ST    @15,@AL00001+4                                      0404
         LA    @15,DDSTRU                                          0404
         ST    @15,@AL00001+8                                      0404
         MVI   @AL00001+8,X'80'                                    0404
         L     @15,GDTPRT(,@10)                                    0404
         LA    @01,@AL00001                                        0404
         BALR  @14,@15                                             0404
*/*          INDICATE A SEVERE ERROR                                 */
*            LASTCOND = LASTCC12;                                  0405
         L     @10,@PC00001+8                                      0405
         MVC   LASTCOND(2,@10),@CH00261                            0405
*/*          END-THEN                                                */
*            END;                                                  0406
*/*      END-THEN                                                    */
*        END;                                                      0407
@RF00401 DS    0H                                                  0408
*/*  IF NO ERRORS FOUND SO FAR                                       */
*    IF LASTCOND < LASTCC12                                        0408
*/*    THEN                                                          */
*      THEN DO;                                                    0408
*                                                                  0408
@RF00399 L     @10,@PC00001+8                                      0408
         LH    @10,LASTCOND(,@10)                                  0408
         CH    @10,@CH00261                                        0408
         BNL   @RF00408                                            0408
*/*      IF SUCCESSFUL IN OPENING THE VOLUME                         */
*        IF RETCODE = SUCCESS                                      0410
*/*        THEN                                                      */
*          THEN DO;                                                0410
*                                                                  0410
         L     @10,RETCODE                                         0410
         LTR   @10,@10                                             0410
         BNZ   @RF00410                                            0410
*/*          OBTAIN INFORMATION ABOUT TYPE OF MOUNTING (UDEVINFO)    */
*            CALL ICKDVIN0 (GDTTBL                                 0412
*                     ,VOLIB                                       0412
*                     ,VOLPRVOL                                    0412
*                     ,POOLID                                      0412
*                     ,VIBPTR                                      0412
*                     ,VIBLEN                                      0412
*                     ,RETCODE);                                   0412
         L     @10,@PC00001                                        0412
         ST    @10,@AL00001                                        0412
         LA    @15,VOLIB                                           0412
         ST    @15,@AL00001+4                                      0412
         LA    @15,@CF00157                                        0412
         ST    @15,@AL00001+8                                      0412
         LA    @15,POOLID                                          0412
         ST    @15,@AL00001+12                                     0412
         LA    @15,VIBPTR                                          0412
         ST    @15,@AL00001+16                                     0412
         LA    @15,VIBLEN                                          0412
         ST    @15,@AL00001+20                                     0412
         LA    @15,RETCODE                                         0412
         ST    @15,@AL00001+24                                     0412
         L     @15,GDTDIN(,@10)                                    0412
         LA    @01,@AL00001                                        0412
         BALR  @14,@15                                             0412
*/*          IF THE VOLUME IS NOT MOUNTED PRIVATE AND DD-NAME        */
*/*           IS SPECIFIED                                           */
*            IF VIBPFLAG = OFF & VIBTYPE = DDNVAL                  0413
*/*            THEN                                                  */
*              THEN DO;                                            0413
*                                                                  0413
         L     @10,VIBPTR                                          0413
         TM    VIBPFLAG(@10),B'10000000'                           0413
         BNZ   @RF00413                                            0413
         CLC   VIBTYPE(4),@CF00161                                 0413
         BNE   @RF00413                                            0413
*/*              ISSUE ERROR MESSAGE (MSGNPRIV) (UPRINT)             */
*                DARGSENT = MSGNPRIV;                              0415
         L     @10,DDSTRU                                          0415
         MVI   DARGSENT(@10),X'1A'                                 0415
*                CALL ICKTPPR0 (GDTTBL                             0416
*                       ,PRTFILE                                   0416
*                       ,DDSTRU);                                  0416
         L     @10,@PC00001                                        0416
         ST    @10,@AL00001                                        0416
         LA    @15,@CF00090                                        0416
         ST    @15,@AL00001+4                                      0416
         LA    @15,DDSTRU                                          0416
         ST    @15,@AL00001+8                                      0416
         MVI   @AL00001+8,X'80'                                    0416
         L     @15,GDTPRT(,@10)                                    0416
         LA    @01,@AL00001                                        0416
         BALR  @14,@15                                             0416
*/*              INDICATE SEVERE ERROR (LASTCOND = 12)               */
*                LASTCOND = LASTCC12;                              0417
         L     @10,@PC00001+8                                      0417
         MVC   LASTCOND(2,@10),@CH00261                            0417
*/*              END-THEN                                            */
*                END;                                              0418
*/*          END-THEN (OPEN WAS SUCCESSFUL)                          */
*            END;                                                  0419
*/*      END-THEN                                                    */
*        END;                                                      0420
*/*  END-SUB-PROCEDURE ISSUE_OPEN_VOLUME                             */
*    END OPENVOL;                                                  0421
*                                                                  0421
@EL00002 DS    0H                                                  0421
@EF00002 DS    0H                                                  0421
@ER00002 LM    @14,@12,@SA00002                                    0421
         BR    @14                                                 0421
*    END ICKRF01                                                   0422
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (DMSDF01 )                                        *
*/*%INCLUDE SYSLIB  (DMSDF00 )                                        *
*/*@INCLUDE SYSLIB  (DMSDF02 )                                        *
*/*%INCLUDE SYSLIB  (DMSDF08 )                                        *
*/*%INCLUDE SYSLIB  (ICKCSRF )                                        *
*;                                                                 0422
@DATA    DS    0H
@CH00040 DC    H'4'
@CH00261 DC    H'12'
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    3F
@SA00002 DS    15F
@AL00001 DS    7A
@ZTEMPS  DS    C
@ZTEMPND EQU   *
@ZLEN    EQU   @ZTEMPND-@ZTEMPS
ICKRF01  CSECT
         DS    0F
@CF00090 DC    F'0'
@CF00161 DC    F'1'
@CF00112 DC    F'2'
@CH00112 EQU   @CF00112+2
@CF00132 DC    F'3'
@CF00157 DC    F'8'
@CH00157 EQU   @CF00157+2
@CF00256 DC    F'9'
@DATD    DSECT
         DS    0D
LISTSCAN DS    A
IOCSPTR  DS    A
OPNPTR   DS    A
DDSTRU   DS    A
FSADDR   DS    A
DMPINDEX DS    A
RETCODE  DS    F
VIBPTR   DS    A
VIBLEN   DS    F
VOLIB    DS    A
LABELS   DS    F
VIBTYPE  DS    F
LISTPTR  DS    A
SETRC    DS    H
LISTLN   DS    FL1
@TS00001 DS    CL95
         DS    CL2
PRTSTR   DS    CL24
         ORG   PRTSTR
PRTHDR   DS    CL4
PRTARGS  DS    CL20
         ORG   PRTSTR+24
PRGFLG   DS    BL1
BOOTFLG  DS    BL1
VOLSER   DS    CL6
OWNERID  DS    CL14
VALVOWN  DS    CL14
VOL1P    DS    CL80
MSSDEV   DS    CL8
VIBNAME  DS    CL8
DEVTYPE  DS    CL8
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
ICKRF01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
@CV00581 DC    V(ICKVA01)
@CV00583 DC    V(ICKVV01)
@CV00584 DC    V(ICKRL01)
@CV00587 DC    V(ICKCV01)
@CV00588 DC    V(ICKWI01)
         DS    0D
@CC00577 DC    C'DARGLIST'
@CC00151 DC    C'ALTR'
@CC00153 DC    C'UPDT'
@CC00576 DC    C'RF00'
@CC00590 DC    C'RF99'
@CC00594 DC    C'RFOP'
@CC00525 DC    C'CC0'
@CC00539 DC    C'UV0'
MODID    DC    CL4'RF01'
POOLID   DC    CL4'RF01'
PTCHRF01 DS    CL512
         ORG   PTCHRF01
@NM00020 DC    256X'00'
@NM00021 DC    256X'00'
         ORG   PTCHRF01+512
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
TESTRC   EQU   @02
REG12    EQU   @12
RTNREG   EQU   @15
REG0     EQU   @00
REG1     EQU   @01
REG10    EQU   @10
REG11    EQU   @11
REG13    EQU   @13
REG14    EQU   @14
REG15    EQU   @15
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG8     EQU   @08
REG9     EQU   @09
ICKSAEP0 EQU   0
ICKSAFP0 EQU   0
ICKSAVC0 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
STAEPARM EQU   0
STAEPFX  EQU   STAEPARM
IOCSTR   EQU   0
IOCDSO   EQU   IOCSTR+13
IOCRFM   EQU   IOCSTR+14
IOCMAC   EQU   IOCSTR+15
IOCMSG   EQU   IOCSTR+16
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNRFM   EQU   OPNAGL+1
OPNTYP   EQU   OPNAGL+2
OPNMOD   EQU   OPNAGL+3
UVOLLIST EQU   0
UVOLENT  EQU   UVOLLIST+2
ICKDVON0 EQU   0
ICKDVIN0 EQU   0
ICKDVCL0 EQU   0
ICKTPPR0 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGSTID EQU   DARGLIST+8
DARGSMOD EQU   DARGSTID
DARGSENT EQU   DARGSTID+3
DARGILP  EQU   DARGLIST+12
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ICKDB010 EQU   0
DMPITM   EQU   0
DMPARY   EQU   0
VOL1     EQU   0
VOL1SER  EQU   VOL1+4
VOL1OWNR EQU   VOL1+37
DEVIC    EQU   0
DEVICVAL EQU   DEVIC+1
VOLID    EQU   0
VOLIDVAL EQU   VOLID+1
OWNER    EQU   0
OWNERVAL EQU   OWNER+1
IPLDD    EQU   0
IPLDDVAL EQU   IPLDD+1
VERFY    EQU   0
VSER     EQU   0
VSERVAL  EQU   VSER+1
VOWN     EQU   0
VOWNVAL  EQU   VOWN+1
PURGE    EQU   0
DNAME    EQU   0
DNAMEVAL EQU   DNAME+1
DEVTY    EQU   0
DEVTYVAL EQU   DEVTY+1
BOOTS    EQU   0
VIBFLAG  EQU   0
VIBPFLAG EQU   0
DMPTRM   EQU   0
ICKDVOP0 EQU   0
ICKIOCL0 EQU   0
ICKIOGT0 EQU   0
ICKIOIT0 EQU   0
ICKIOOP0 EQU   0
ICKIOPT0 EQU   0
ICKIOTM0 EQU   0
ICKSACL0 EQU   0
ICKSADE0 EQU   0
ICKSAFS0 EQU   0
ICKSAGP0 EQU   0
ICKSAGS0 EQU   0
ICKSALD0 EQU   0
ICKSAPR0 EQU   0
ICKSASC0 EQU   0
ICKSASN0 EQU   0
ICKSAST0 EQU   0
ICKSATI0 EQU   0
ICKSAWO0 EQU   0
ICKTPEA0 EQU   0
ICKTPES0 EQU   0
ICKTPRE0 EQU   0
ICKTPRS0 EQU   0
LISTTEST EQU   0
NEWERID1 EQU   5
NOBTS    EQU   0
NOPRG    EQU   0
NOVER    EQU   0
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTDIN   EQU   GDTTBL+44
GDTDOP   EQU   GDTTBL+48
GDTDBG   EQU   GDTTBL+52
GDTDVO   EQU   GDTTBL+56
GDTPRT   EQU   GDTTBL+60
GDTESS   EQU   GDTTBL+64
GDTESA   EQU   GDTTBL+68
GDTRST   EQU   GDTTBL+72
GDTRES   EQU   GDTTBL+76
GDTCAL   EQU   GDTTBL+80
GDTGSP   EQU   GDTTBL+84
GDTFSP   EQU   GDTTBL+88
GDTGPL   EQU   GDTTBL+92
GDTFPL   EQU   GDTTBL+96
GDTLOD   EQU   GDTTBL+100
GDTDEL   EQU   GDTTBL+104
GDTPRL   EQU   GDTTBL+108
GDTEPL   EQU   GDTTBL+112
GDTTIM   EQU   GDTTBL+116
GDTIIO   EQU   GDTTBL+120
GDTTIO   EQU   GDTTBL+124
GDTOPN   EQU   GDTTBL+136
GDTCLS   EQU   GDTTBL+140
GDTGET   EQU   GDTTBL+144
GDTPUT   EQU   GDTTBL+148
GDTSNP   EQU   GDTTBL+160
GDTWTO   EQU   GDTTBL+168
GDTSCR   EQU   GDTTBL+172
GDTVCK   EQU   GDTTBL+176
GDTDVC   EQU   GDTTBL+180
GDTSTE   EQU   GDTTBL+188
FDTTBL   EQU   0
FDTPTR   EQU   FDTTBL+8
LASTCOND EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
FDTVERB  EQU   FDTTBL
GDTCVR   EQU   GDTTBL+184
GDTSPR   EQU   GDTTBL+164
GDTABH   EQU   GDTTBL+156
GDTABT   EQU   GDTTBL+152
GDTTOH   EQU   GDTTBL+132
GDTRIP   EQU   GDTTBL+128
GDTDVH   EQU   GDTTBL+40
GDTIOH   EQU   GDTTBL+36
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
DEVTYLEN EQU   DEVTY
DNAMELEN EQU   DNAME
VOWNLEN  EQU   VOWN
VSERLEN  EQU   VSER
IPLDDLEN EQU   IPLDD
OWNERLEN EQU   OWNER
VOLIDLEN EQU   VOLID
DEVICLEN EQU   DEVIC
VOL1STDV EQU   VOL1+79
@NM00019 EQU   VOL1+51
VOL1OLDO EQU   VOL1OWNR+4
VOL1OEXT EQU   VOL1OWNR
@NM00018 EQU   VOL1+16
VOL1VTOC EQU   VOL1+11
VOL1ACC  EQU   VOL1+10
VOL1NUM  EQU   VOL1+3
VOL1ID   EQU   VOL1
@NM00017 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00016 EQU   DMPITM+15
DMPITMTP EQU   DMPITM+14
DMPITMLN EQU   DMPITM+12
DMPITMPT EQU   DMPITM+8
DMPITMNM EQU   DMPITM
@NM00015 EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00014 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00013 EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGDTM  EQU   DARGARY+4
DARGPCT  EQU   DARGINL
DARGREP  EQU   DARGINS
@NM00012 EQU   DARGLIST+19
DARGIND  EQU   DARGLIST+18
DARGRETL EQU   DARGLIST+16
DARGCNT  EQU   DARGLIST+14
DARGRETP EQU   DARGLIST+4
UVOLVOL  EQU   UVOLENT+4
UVOLDEV  EQU   UVOLENT
UVOLCNT  EQU   UVOLLIST
OPNRSVD  EQU   OPNAGL+28
OPNVOL   EQU   OPNAGL+24
OPNBLK   EQU   OPNAGL+20
OPNREC   EQU   OPNAGL+16
OPNDSN   EQU   OPNAGL+12
OPNDDN   EQU   OPNAGL+8
OPNIOC   EQU   OPNAGL+4
@NM00011 EQU   OPNMOD
OPNMODRC EQU   OPNMOD
OPNMODAC EQU   OPNMOD
@NM00010 EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00009 EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNRFMSF EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNRFMFX EQU   OPNRFM
@NM00008 EQU   OPNOPT
OPNOPTJM EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNOPTUP EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNOPTIN EQU   OPNOPT
IOCEXT   EQU   IOCSTR+36
IOCRRN   EQU   IOCSTR+32
@NM00007 EQU   IOCSTR+30
IOCPNM   EQU   IOCSTR+28
IOCCBP   EQU   IOCSTR+24
IOCDSN   EQU   IOCSTR+20
@NM00006 EQU   IOCSTR+17
@NM00005 EQU   IOCMSG
IOCMSGOP EQU   IOCMSG
IOCMACPA EQU   IOCMAC
@NM00004 EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACUP EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00003 EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMFX EQU   IOCRFM
@NM00002 EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
IOCKYL   EQU   IOCSTR+12
IOCTRN   EQU   IOCSTR+8
IOCDLN   EQU   IOCSTR+4
IOCDAD   EQU   IOCSTR
STAEWORK EQU   STAEPARM+32
STARPTR  EQU   STAEPFX+28
STASPTR  EQU   STAEPFX+24
STALEN   EQU   STAEPFX+20
STAID    EQU   STAEPFX+16
STAEPA   EQU   STAEPFX+12
STAGDT   EQU   STAEPFX+8
STABPTR  EQU   STAEPFX+4
STAFPTR  EQU   STAEPFX
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00001 EQU   OLDERID1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RF00273 EQU   @RC00256
@RC00312 EQU   @RC00295
@RF00319 EQU   @RC00295
@RF00324 EQU   @RC00295
@RF00408 EQU   @EL00002
@RF00410 EQU   @EL00002
@RF00413 EQU   @EL00002
@PB00002 EQU   @EL00001
@ENDDATA EQU   *
         END   ICKRF01,(C'PLS1723',0701,78192)

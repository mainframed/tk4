         TITLE '*/* IRBMFDHP - CHANNEL INTERVAL MEASUREMENT GATHERING M*
               ODULE   '
IRBMFDHP CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'IRBMFDHP  74.087'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         L     @00,@SIZDATD                                        0001
         GETMAIN R,LV=(0)
         LR    @11,@01                                             0001
         USING @DATD,@11                                           0001
         ST    @13,@SA00001+4                                      0001
         LM    @00,@01,20(@13)                                     0001
         ST    @11,8(,@13)                                         0001
         LR    @13,@11                                             0001
         MVC   @PC00001(36),0(@01)                                 0001
*   STSMSAVE=GPR13P;                                               0018
*                                                                  0018
         L     @10,@PC00001                                        0018
         L     @10,DHSMAPTR(,@10)                                  0018
         ST    GPR13P,STSMSAVE(,@10)                               0018
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0019
*   RESPECIFY                                                      0019
*    (GPR13P)UNRESTRICTED;                                         0019
*                                                                  0020
*/* BEGIN MAINLINE PROCESSING.  THIS MODULE IS EXECUTED IN THREE   0020
*       SECTIONS: PROLOG, MOVE, AND EPILOG.  ALL PROLOG SECTIONS IN
*       ALL INTERVAL-DRIVEN MG ROUTINES ARE GIVEN CONTROL BY ESVC14
*       FIRST.  THEN ALL MOVE SECTIONS GET CONTROL, ETC.  THIS     0020
*       NECESSITATES SPECIAL RETURN LINKAGE TO ESVC14 WHICH PRESERVES
*       DATA AND CODE ADDRESSABILITY.  THE MACRO NAME FOR THIS RETURN
*       AND REENTRY LINKAGE IS IRBBREAK                              */
*                                                                  0020
*   /*****************************************************************/
*   /*                                                               */
*   /* PROLOG. THIS SECTION OBTAINS AND FIXES INTERVAL DATA STORAGE. */
*   /* IT ALSO FIXES THE MOVE SECTION AND ALL DATA WHICH THAT SECTION*/
*   /* OF CODE REFERENCES.                                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0020
*   DHDTAPTR=STSMIADD;              /* LAST WRAP VALUES TO OUTPUT  0020
*                                      POINTER                       */
*                                                                  0020
         MVC   DHDTAPTR(4),STSMIADD(@10)                           0020
*   /*****************************************************************/
*   /*                                                               */
*   /* FIX PROGRAM AND LOCAL DATA                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0021
*   DHPAGECB=DHECBRST;              /* RESET ECB                     */
*                                                                  0021
         SR    @10,@10                                             0021
         ST    @10,DHPAGECB                                        0021
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0022
*   RESPECIFY                                                      0022
*    (GPR00P,                                                      0022
*     GPR01P,                                                      0022
*     GPR14P,                                                      0022
*     GPR15P)RESTRICTED;                                           0022
*   GENERATE SETS(DHPAGECB);                                       0023
*                                                                  0023
         LA    GPR00P,DHPAGECB      ECB ADDRESS
DHPAGFX1 PGFIX R,A=IRBMFDHP,EA=@ENDDATA,ECB=(GPR00P),LONG=N,           X
               RELATED=(MFDHPGFX,IRBMFDHP(DHPAGFX4),IRBMFTRM(TR0110))
         WAIT  ECB=DHPAGECB
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0024
*   RESPECIFY                                                      0024
*    (GPR00P,                                                      0024
*     GPR01P,                                                      0024
*     GPR14P,                                                      0024
*     GPR15P)UNRESTRICTED;                                         0024
*                                                                  0024
*   /*****************************************************************/
*   /*                                                               */
*   /* FIX AUTOMATIC DATA STORAGE                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0025
*   DHPAGECB=DHECBRST;              /* RESET ECB                     */
*                                                                  0025
         SR    @10,@10                                             0025
         ST    @10,DHPAGECB                                        0025
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0026
*   RESPECIFY                                                      0026
*    (GPR00P,                                                      0026
*     GPR01P,                                                      0026
*     GPR14P,                                                      0026
*     GPR15P)RESTRICTED;                                           0026
*   GENERATE SETS(DHPAGECB);                                       0027
*                                                                  0027
         LA    GPR15P,@ENDDATD      END ADDRESS
         LA    GPR00P,DHPAGECB      ECB ADDRESS
         LA    GPR01P,@DATD         BEGINNING ADDRESS
DHPAGFX2 PGFIX R,A=(GPR01P),EA=(GPR15P),ECB=(GPR00P),LONG=N,           X
               RELATED=(MFDHATFX,IRBMFDHP(DHPAGFX5),IRBMFTRM(TR0210))
         WAIT  ECB=DHPAGECB
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0028
*   RESPECIFY                                                      0028
*    (GPR00P,                                                      0028
*     GPR01P,                                                      0028
*     GPR14P,                                                      0028
*     GPR15P)UNRESTRICTED;                                         0028
*                                                                  0028
*   /*****************************************************************/
*   /*                                                               */
*   /* ADD ENTRY TO STORAGE RESOURCE TABLE FOR AUTO DATA MACDATE Y-2 */
*   /* 73018                                                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0029
*   RESPECIFY                                                      0029
*    (GPR00P,                                                      0029
*     GPR01P)RESTRICTED;                                           0029
*   GENERATE;                                                      0030
         L     GPR00P,@SIZDATD      GET LENGTH OF AUTOMATIC DATA
         LA    GPR01P,@DATD         ADDRESS OF AUTOMATIC DATA
*   STSGFREE(STRVNSGT)=GPR00P;      /* SUBPOOL ZERO AND LENGTH       */
         L     @10,@PC00001                                        0031
         L     @10,DHSMAPTR(,@10)                                  0031
         L     @15,STSMRVT(,@10)                                   0031
         L     @14,STRVNSGT(,@15)                                  0031
         LR    @09,@14                                             0031
         SLA   @09,3                                               0031
         L     @08,STRVSSGT(,@15)                                  0031
         LA    @07,0(@09,@08)                                      0031
         AL    @07,@CF00266                                        0031
         ST    GPR00P,STSGFREE(,@07)                               0031
*   STSGADD(STRVNSGT)=GPR01P;       /* ADDRESS                       */
*                                                                  0032
         AL    @08,@CF00267                                        0032
         ST    GPR01P,STSGADD-4(@09,@08)                           0032
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0033
*   RESPECIFY                                                      0033
*    (GPR00P,                                                      0033
*     GPR01P)UNRESTRICTED;                                         0033
*   STRVNSGT=STRVNSGT+1;            /* POINT TO NEXT SGT SLOT        */
*                                                                  0034
         AH    @14,@CH00060                                        0034
         ST    @14,STRVNSGT(,@15)                                  0034
*   /*****************************************************************/
*   /*                                                               */
*   /* ALLOCATE STORAGE IN THE USERS KEY FOR INTERVAL DATA MACDATE   */
*   /* Y-2 73018                                                     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0035
*   RESPECIFY                                                      0035
*    (GPR00P,                                                      0035
*     GPR01P,                                                      0035
*     GPR14P,                                                      0035
*     GPR15P)RESTRICTED;                                           0035
*   GPR00P=STSMIGMC;                /* SET SUBPOOL AND LENGTH INTO 0036
*                                      REGISTER                      */
         L     GPR00P,STSMIGMC(,@10)                               0036
*   GENERATE;                                                      0037
DHGETMN1 GETMAIN R,LV=(0),RELATED=(MFDHISGM,IRBMFRGM(RGFREES1),        X
               IRBMFTRM(TR0220),IRBMFDTA(DT200))
*   STSMIADD=GPR01P+LENGTH(STSMIGMC);/* POINT TO SMF RCD PORTION OF
*                                      STORAGE                       */
*                                                                  0038
         L     @10,@PC00001                                        0038
         L     @10,DHSMAPTR(,@10)                                  0038
         LA    @09,4                                               0038
         LR    @08,GPR01P                                          0038
         AR    @08,@09                                             0038
         ST    @08,STSMIADD(,@10)                                  0038
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0039
*   RESPECIFY                                                      0039
*    (GPR00P,                                                      0039
*     GPR01P,                                                      0039
*     GPR14P,                                                      0039
*     GPR15P)UNRESTRICTED;                                         0039
*   DHSMIADD=STSMIADD;              /* MOVE TO TEMPORARY STARAGE     */
*                                                                  0040
         ST    @08,DHSMIADD                                        0040
*   /*****************************************************************/
*   /*                                                               */
*   /* FIX INTERVAL DATA STORAGE AREA                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0041
*   DHPAGECB=DHECBRST;              /* RESET ECB                     */
*                                                                  0041
         SR    @15,@15                                             0041
         ST    @15,DHPAGECB                                        0041
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0042
*   RESPECIFY                                                      0042
*    (GPR00P,                                                      0042
*     GPR01P,                                                      0042
*     GPR14P,                                                      0042
*     GPR15P)RESTRICTED;                                           0042
*   GPR01P=DHSMIADD-LENGTH(STSMIGMC);/* BEGINNING ADDRESS            */
         SR    @08,@09                                             0043
         LR    GPR01P,@08                                          0043
*   GPR15P=GPR01P+STSMILEN;         /* ENDING ADDRESS +1             */
         LR    GPR15P,GPR01P                                       0044
         SR    @09,@09                                             0044
         ICM   @09,7,STSMILEN(@10)                                 0044
         AR    GPR15P,@09                                          0044
*   GENERATE SETS(DHPAGECB);                                       0045
*                                                                  0045
         LA    GPR00P,DHPAGECB      ECB ADDRESS
DHPAGFX3 PGFIX R,A=(GPR01P),EA=(GPR15P),ECB=(GPR00P),LONG=N,           X
               RELATED=(MFDHISFX,IRBMFDHP(DHPAGFX6),IRBMFTRM(TR0210))
         WAIT  ECB=DHPAGECB
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0046
*   RESPECIFY                                                      0046
*    (GPR00P,                                                      0046
*     GPR01P,                                                      0046
*     GPR14P,                                                      0046
*     GPR15P)UNRESTRICTED;                                         0046
*                                                                  0046
*   /*****************************************************************/
*   /*                                                               */
*   /* SET SUBPOOL AND LENGTH INTO FIRST WORD OF GOTTEN AREA         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0047
*   EVAL(DHSMIADD-LENGTH(STSMIGMC))->DHDTAGMC=STSMIGMC;            0047
*                                                                  0047
         L     @10,DHSMIADD                                        0047
         SH    @10,@CH00112                                        0047
         L     @15,@PC00001                                        0047
         L     @01,DHSMAPTR(,@15)                                  0047
         MVC   DHDTAGMC(4,@10),STSMIGMC(@01)                       0047
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER BY SPECIAL RETURN SEQUENCE WHICH DOES NOT    */
*   /* FREE AUTOMATIC DATA OR INVALIDATE ADDRESSING. THE PURPOSE IS  */
*   /* TO ALLOW ALL PROLOGS, MOVES, AND EPILOGS TO EXECUTE TOGETHER. */
*   /* THE EFFECT IN ANY INTERVAL-DRIVEN MG ROUTINE IS AS IF THE     */
*   /* PROLOG, MOVE, AND EPILOG WERE EXECUTED AS SEQUENTIAL CODE     */
*   /* DHMOVE: IRBBREAK MACDATE Y-2 73018                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0048
*DHMOVE:                                                           0048
*                                                                  0048
*   /*****************************************************************/
*   /*                                                               */
*   /* INDICATE NEXT ROUTINE ADDRESS TO SVC MAINLINE FOR REENTRY     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0048
*   STSMENTR=ADDR(DHRT0020);                                       0048
DHMOVE   L     @10,@PC00001                                        0048
         L     @10,DHSMAPTR(,@10)                                  0048
         LA    @15,DHRT0020                                        0048
         ST    @15,STSMENTR(,@10)                                  0048
*   RESPECIFY                                                      0049
*    (GPR00P,                                                      0049
*     GPR01P,                                                      0049
*     GPR14P,                                                      0049
*     GPR15P)RESTRICTED;                                           0049
*   GENERATE;                                                      0050
         STM   @02,@12,28(@13)     SAVE REGISTERS FOR NEXT SEGMENT
         L     @13,4(,@13)         BACK CHAIN TO CALLERS SAVEAREA
         LM    @14,@12,12(@13)     RESTORE CALLERS REGISTERS
         BR    @14                 RETURN TO CALLER
*                                                                  0051
*   /*****************************************************************/
*   /*                                                               */
*   /* REENTRY POINT FROM CALLER, IGX00014.                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0051
*DHRT0020:                                                         0051
*   GENERATE;                                                      0051
DHRT0020 DS    0H                                                  0051
         STM   @14,@12,12(@13)     SAVE CALLERS REGISTERS
         L     @01,0(,@01)         GET ADDRESS OF SAVE AREA ADDRESS
         L     @01,0(,@01)         GET SAVE AREA ADDRESS
         LM    @02,@12,28(@01)     RELOAD REGISTERS
         ST    @13,4(,@01)         BACK CHAIN NEW SAVEAREA TO OLD
         ST    @01,8(,@13)         FORWARD CHAIN FROM OLD TO NEW
         LR    @13,@01             R13 NOW POINTS TO NEW SAVEAREA
*   RESPECIFY                                                      0052
*    (GPR00P,                                                      0052
*     GPR01P,                                                      0052
*     GPR14P,                                                      0052
*     GPR15P)UNRESTRICTED;                                         0052
*                                                                  0052
*   /*****************************************************************/
*   /*                                                               */
*   /* BEGIN MOVE SEGMENT. THIS CODE IS ENTERED DISABLED AND EXECUTES*/
*   /* WITH NO PAGE FAULTS. THE FUNCTION IS TO MOVE DATA INTO STORAGE*/
*   /* OBTAINED BY THE PROLOG PROVIDE ADDRESSABILITY TO SMF RECORD IN*/
*   /* NEW INTERVAL STORAGE                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0053
*   RESPECIFY                                                      0053
*     SMFRCD73 BASED(DHSMIADD);                                    0053
*                                                                  0053
*   /*****************************************************************/
*   /*                                                               */
*   /* MOVE IN STANDARD SMF HEADER                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0054
*   SMFRCD73=DHSMFHDR(1:LENGTH(SMFRCD73));                         0054
*                                                                  0054
         L     @10,DHSMIADD                                        0054
         L     @15,@PC00001+16                                     0054
         MVC   SMFRCD73(48,@10),DHSMFHDR(@15)                      0054
*   /*****************************************************************/
*   /*                                                               */
*   /* FILL IN UNSET FIELDS                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0055
*   SMF73RTY=DHRCDTYP;              /* INSERT RECORD TYPE            */
         MVI   SMF73RTY(@10),X'49'                                 0055
*   SMF73SAM=ECCESAMP;              /* NUMBER OF SAMPLES             */
         L     @15,@PC00001                                        0056
         L     @01,DHSMAPTR(,@15)                                  0056
         L     @01,STSMEDAD(,@01)                                  0056
         MVC   SMF73SAM(4,@10),ECCESAMP(@01)                       0056
*   SMF73A=SMF73A&&SMF73A;          /* ZERO MF/1 CHANNEL CONTROL AREA*/
         LA    @15,SMF73SIZ(,@10)                                  0057
         AH    @15,SMF73SIZ(,@10)                                  0057
         XC    SMF73A(8,@15),SMF73A(@15)                           0057
*   SMF73SHC=LENGTH(SMF73A);        /* SIZE OF CHANNEL CONTROL AREA  */
         MVC   SMF73SHC(2,@15),@CH00056                            0058
*   SMF73SHD=LENGTH(SMF73B);        /* SIZE OF CHANNEL DATA AREA     */
*                                                                  0059
         MVC   SMF73SHD(2,@15),@CH00123                            0059
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP THROUGH CPU ENTRIES AND CHANNEL DATA BLOCKS MOVING IN    */
*   /* DATA. ALSO COUNT NUMBER OF CHANNELS PROCESSED                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0060
*   DHCHACNT=1;                     /* INITIALIZE CHANNEL COUNT      */
         LA    @10,1                                               0060
         ST    @10,DHCHACNT                                        0060
*   DO DHCPERIX=1 TO ECCECPUS;      /* LOOP THROUGH CPE TABLE        */
*                                                                  0061
         B     @DE00061                                            0061
@DL00061 DS    0H                                                  0062
*     /***************************************************************/
*     /*                                                             */
*     /* LOOP THROUGH CHANNELS FOR THIS CPU                          */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0062
*     DO DHCDBRIX=1 TO ECCPCNUM(DHCPERIX);                         0062
*                                                                  0062
         LA    @10,1                                               0062
         B     @DE00062                                            0062
@DL00062 DS    0H                                                  0063
*       /*************************************************************/
*       /*                                                           */
*       /* ZERO CHANNEL ENTRY                                        */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0063
*       SMF73B(DHCHACNT)=SMF73B(DHCHACNT)&&SMF73B(DHCHACNT);       0063
*                                                                  0063
         L     @15,DHCHACNT                                        0063
         SLA   @15,4                                               0063
         L     @14,DHSMIADD                                        0063
         LA    @09,SMF73SIZ(,@14)                                  0063
         AH    @09,SMF73SIZ(,@14)                                  0063
         LH    @14,SMF73SHC(,@09)                                  0063
         AR    @14,@09                                             0063
         ST    @15,@TF00001                                        0063
         ALR   @15,@14                                             0063
         AL    @15,@CF00268                                        0063
         XC    SMF73B(16,@15),SMF73B(@15)                          0063
*       /*************************************************************/
*       /*                                                           */
*       /* ASSUME INVALID ENTRY AND MARK AS SUCH                     */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0064
*       SMF73HID(DHCHACNT)=DHNOTVLD;                               0064
         LA    @15,255                                             0064
         L     @01,@TF00001                                        0064
         AL    @01,@CF00269                                        0064
         STC   @15,SMF73HID-2(@01,@14)                             0064
*       IF ECCDVALD(DHCDBRIX)='0'B THEN                            0065
*                                                                  0065
         LR    @15,@10                                             0065
         MH    @15,@CH00263                                        0065
         L     @09,DHCPERIX                                        0065
         LR    @08,@09                                             0065
         SLA   @08,3                                               0065
         L     @07,@PC00001                                        0065
         L     @01,DHSMAPTR(,@07)                                  0065
         L     @01,STSMEDAD(,@01)                                  0065
         L     @01,ECCECPEQ(,@01)                                  0065
         AL    @01,@CF00267                                        0065
         L     @08,ECCPCDBQ-4(@08,@01)                             0065
         ST    @15,@TF00002                                        0065
         ALR   @15,@08                                             0065
         AL    @15,@CF00270                                        0065
         TM    ECCDVALD(@15),B'00000100'                           0065
         BZ    @RT00065                                            0065
*         /***********************************************************/
*         /*                                                         */
*         /* CHANNEL HAS NEVER BEEN ONLINE. SKIP THIS CHANNEL.       */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0066
*         GO TO DHLAB2;                                            0066
*                                                                  0066
*       /*************************************************************/
*       /*                                                           */
*       /* SET IN CPU IDENTIFIER (PHYSICAL ADDRESS)                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0067
*       SMF73CID(DHCHACNT)=DHCPERIX-1;                             0067
*                                                                  0067
         BCTR  @09,0                                               0067
         L     @15,@TF00001                                        0067
         AL    @15,@CF00268                                        0067
         STH   @09,SMF73CID(@15,@14)                               0067
*       /*************************************************************/
*       /*                                                           */
*       /* SET IN CHANNEL IDENTIFIER (PHYSICAL ADDRESS)              */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0068
*       SMF73HID(DHCHACNT)=DHCDBRIX-1;                             0068
*                                                                  0068
         BCTR  @10,0                                               0068
         L     @15,@TF00001                                        0068
         AL    @15,@CF00269                                        0068
         STC   @10,SMF73HID-2(@15,@14)                             0068
*       /*************************************************************/
*       /*                                                           */
*       /* SET CHANNEL TYPE FLAGS                                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0069
*       IF ECCDCTYP(DHCDBRIX)=SELECTOR THEN                        0069
         AL    @08,@TF00002                                        0069
         AL    @08,@CF00268                                        0069
         TM    ECCDCTYP-4(@08),B'11110000'                         0069
         BNZ   @RF00069                                            0069
*         SMF73TYP(DHCHACNT)=SELECTOR;                             0070
         AL    @14,@TF00001                                        0070
         AL    @14,@CF00271                                        0070
         NI    SMF73TYP-3(@14),B'00001111'                         0070
*       ELSE                                                       0071
*         DO;                                                      0071
         B     @RC00069                                            0071
@RF00069 DS    0H                                                  0072
*           IF ECCDCTYP(DHCDBRIX)=MULTPLEX THEN/* IS CHANNEL TYPE  0072
*                                      BYTE MULTIPLEX                */
         L     @10,DHCDBRIX                                        0072
         MH    @10,@CH00263                                        0072
         L     @15,DHCPERIX                                        0072
         SLA   @15,3                                               0072
         L     @14,@PC00001                                        0072
         L     @01,DHSMAPTR(,@14)                                  0072
         L     @01,STSMEDAD(,@01)                                  0072
         L     @01,ECCECPEQ(,@01)                                  0072
         AL    @01,@CF00267                                        0072
         L     @01,ECCPCDBQ-4(@15,@01)                             0072
         ALR   @01,@10                                             0072
         AL    @01,@CF00268                                        0072
         TM    ECCDCTYP-4(@01),B'00010000'                         0072
         BNO   @RF00072                                            0072
         TM    ECCDCTYP-4(@01),B'11100000'                         0072
         BNZ   @RF00072                                            0072
*             SMF73TYP(DHCHACNT)=MULTPLEX;                         0073
         L     @10,DHCHACNT                                        0073
         SLA   @10,4                                               0073
         L     @15,DHSMIADD                                        0073
         LA    @14,SMF73SIZ(,@15)                                  0073
         AH    @14,SMF73SIZ(,@15)                                  0073
         LH    @15,SMF73SHC(,@14)                                  0073
         AR    @15,@14                                             0073
         ALR   @15,@10                                             0073
         AL    @15,@CF00271                                        0073
         NI    SMF73TYP-3(@15),B'00011111'                         0073
         OI    SMF73TYP-3(@15),B'00010000'                         0073
*           ELSE                    /* ELSE IT IS BLOCK MULTIPLEX    */
*             SMF73TYP(DHCHACNT)=BLKMPLEX;                         0074
         B     @RC00072                                            0074
@RF00072 L     @10,DHCHACNT                                        0074
         SLA   @10,4                                               0074
         L     @15,DHSMIADD                                        0074
         LA    @14,SMF73SIZ(,@15)                                  0074
         AH    @14,SMF73SIZ(,@15)                                  0074
         LH    @15,SMF73SHC(,@14)                                  0074
         AR    @15,@14                                             0074
         ALR   @15,@10                                             0074
         AL    @15,@CF00271                                        0074
         NI    SMF73TYP-3(@15),B'00101111'                         0074
         OI    SMF73TYP-3(@15),B'00100000'                         0074
*         END;                                                     0075
*                                                                  0075
@RC00072 DS    0H                                                  0076
*       /*************************************************************/
*       /*                                                           */
*       /* SET CHANNEL TYPE INVALID FLAG IF NECESSARY                */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0076
*       IF ECCDIVID(DHCDBRIX)='1'B THEN                            0076
@RC00069 L     @10,DHCDBRIX                                        0076
         MH    @10,@CH00263                                        0076
         L     @15,DHCPERIX                                        0076
         SLA   @15,3                                               0076
         L     @14,@PC00001                                        0076
         L     @01,DHSMAPTR(,@14)                                  0076
         L     @01,STSMEDAD(,@01)                                  0076
         L     @01,ECCECPEQ(,@01)                                  0076
         AL    @01,@CF00267                                        0076
         L     @01,ECCPCDBQ-4(@15,@01)                             0076
         ALR   @01,@10                                             0076
         AL    @01,@CF00270                                        0076
         TM    ECCDIVID(@01),B'00001000'                           0076
         BNO   @RF00076                                            0076
*         DO;                                                      0077
*           SMF73IID(DHCHACNT)='1'B;                               0078
         L     @10,DHCHACNT                                        0078
         SLA   @10,4                                               0078
         L     @15,DHSMIADD                                        0078
         LA    @14,SMF73SIZ(,@15)                                  0078
         AH    @14,SMF73SIZ(,@15)                                  0078
         LH    @15,SMF73SHC(,@14)                                  0078
         AR    @15,@14                                             0078
         ST    @10,@TF00001                                        0078
         ALR   @10,@15                                             0078
         AL    @10,@CF00271                                        0078
         OI    SMF73IID-3(@10),B'00000100'                         0078
*           SMF73TYP(DHCHACNT)=DHIVCTYP;                           0079
         AL    @15,@TF00001                                        0079
         AL    @15,@CF00271                                        0079
         NI    SMF73TYP-3(@15),B'00001111'                         0079
*         END;                                                     0080
*                                                                  0080
*       /*************************************************************/
*       /*                                                           */
*       /* INSERT DATA IF CHANNEL IS ONLINE. USE COMPARE AND SWAP    */
*       /* LOGIC. MACDATE Y-2 73018                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0081
*       RESPECIFY                                                  0081
*        (GPR00P,                                                  0081
*         GPR06P)RESTRICTED;                                       0081
@RF00076 DS    0H                                                  0082
*DHLAB1:                            /* START TO COUNT SIOS AND BUSY
*                                      SAMPLES                       */
*       GPR06P=ADDR(ECCDFLGS(DHCDBRIX));                           0082
*                                                                  0082
DHLAB1   L     @10,DHCDBRIX                                        0082
         MH    @10,@CH00263                                        0082
         L     @01,DHCPERIX                                        0082
         SLA   @01,3                                               0082
         L     @15,@PC00001                                        0082
         L     @15,DHSMAPTR(,@15)                                  0082
         L     @15,STSMEDAD(,@15)                                  0082
         L     @15,ECCECPEQ(,@15)                                  0082
         AL    @15,@CF00267                                        0082
         L     GPR06P,ECCPCDBQ-4(@01,@15)                          0082
         AL    GPR06P,@CF00270                                     0082
         LA    GPR06P,ECCDFLGS(@10,GPR06P)                         0082
*       /*************************************************************/
*       /*                                                           */
*       /* WORD CONTAINING FLAGS TO REGISTER                         */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0083
*       GENERATE(L    GPR00P,0(,GPR06P));                          0083
         L    GPR00P,0(,GPR06P)
*       IF ECCDALIV(DHCDBRIX)='1'B THEN                            0084
         L     @10,DHCDBRIX                                        0084
         MH    @10,@CH00263                                        0084
         L     @07,DHCPERIX                                        0084
         SLA   @07,3                                               0084
         L     @01,@PC00001                                        0084
         L     @01,DHSMAPTR(,@01)                                  0084
         L     @01,STSMEDAD(,@01)                                  0084
         L     @01,ECCECPEQ(,@01)                                  0084
         AL    @01,@CF00267                                        0084
         L     @07,ECCPCDBQ-4(@07,@01)                             0084
         ST    @10,@TF00001                                        0084
         ALR   @10,@07                                             0084
         AL    @10,@CF00270                                        0084
         TM    ECCDALIV(@10),B'00000001'                           0084
         BNO   @RF00084                                            0084
*         DO;                                                      0085
*                                                                  0085
*           /*********************************************************/
*           /*                                                       */
*           /* SUCCESSFUL SIOS                                       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0086
*           SMF73CNT(DHCHACNT)=ECCDSIOS(DHCDBRIX);                 0086
*                                                                  0086
         L     @10,DHCHACNT                                        0086
         SLA   @10,4                                               0086
         L     @01,DHSMIADD                                        0086
         LA    @15,SMF73SIZ(,@01)                                  0086
         AH    @15,SMF73SIZ(,@01)                                  0086
         LH    @01,SMF73SHC(,@15)                                  0086
         AR    @01,@15                                             0086
         L     @15,@TF00001                                        0086
         AL    @15,@CF00278                                        0086
         L     @15,ECCDSIOS-8(@15,@07)                             0086
         LA    @14,0(@10,@01)                                      0086
         AL    @14,@CF00278                                        0086
         ST    @15,SMF73CNT-4(,@14)                                0086
*           /*********************************************************/
*           /*                                                       */
*           /* BUSY SAMPLES                                          */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0087
*           SMF73BSY(DHCHACNT)=ECCDBUSY(DHCDBRIX);                 0087
*                                                                  0087
         L     @15,@TF00001                                        0087
         AL    @15,@CF00266                                        0087
         L     @15,ECCDBUSY-12(@15,@07)                            0087
         LA    @14,0(@10,@01)                                      0087
         AL    @14,@CF00266                                        0087
         ST    @15,SMF73BSY-8(,@14)                                0087
*           /*********************************************************/
*           /*                                                       */
*           /* BUSY/CPU WAIT SAMPLES                                 */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0088
*           SMF73OLP(DHCHACNT)=ECCDOLAP(DHCDBRIX);                 0088
         L     @15,@TF00001                                        0088
         AL    @07,@CF00267                                        0088
         L     @07,ECCDOLAP-16(@15,@07)                            0088
         AL    @01,@CF00267                                        0088
         ST    @07,SMF73OLP-12(@10,@01)                            0088
*         END;                                                     0089
*       ELSE                                                       0090
*         DO;                                                      0090
*                                                                  0090
         B     @RC00084                                            0090
@RF00084 DS    0H                                                  0091
*           /*********************************************************/
*           /*                                                       */
*           /* ZERO SIOS, BUSY SAMPLES, AND OVERLAP SAMPLES          */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0091
*           SMF73CNT(DHCHACNT)=DHDTZERO;                           0091
         SR    @10,@10                                             0091
         L     @07,DHCHACNT                                        0091
         SLA   @07,4                                               0091
         L     @01,DHSMIADD                                        0091
         LA    @15,SMF73SIZ(,@01)                                  0091
         AH    @15,SMF73SIZ(,@01)                                  0091
         LH    @01,SMF73SHC(,@15)                                  0091
         AR    @01,@15                                             0091
         LA    @15,0(@07,@01)                                      0091
         AL    @15,@CF00278                                        0091
         ST    @10,SMF73CNT-4(,@15)                                0091
*           SMF73BSY(DHCHACNT)=DHDTZERO;                           0092
         LA    @15,0(@07,@01)                                      0092
         AL    @15,@CF00266                                        0092
         ST    @10,SMF73BSY-8(,@15)                                0092
*           SMF73OLP(DHCHACNT)=DHDTZERO;                           0093
         AL    @01,@CF00267                                        0093
         ST    @10,SMF73OLP-12(@07,@01)                            0093
*         END;                                                     0094
*                                                                  0094
*       /*************************************************************/
*       /*                                                           */
*       /* SET CONFIGURATION CHANGED FLAG IF NECESSARY               */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0095
*       IF ECCDCCHG(DHCDBRIX)='1'B THEN                            0095
@RC00084 L     @10,DHCDBRIX                                        0095
         MH    @10,@CH00263                                        0095
         L     @07,DHCPERIX                                        0095
         SLA   @07,3                                               0095
         L     @01,@PC00001                                        0095
         L     @01,DHSMAPTR(,@01)                                  0095
         L     @01,STSMEDAD(,@01)                                  0095
         L     @01,ECCECPEQ(,@01)                                  0095
         AL    @01,@CF00267                                        0095
         L     @07,ECCPCDBQ-4(@07,@01)                             0095
         ALR   @07,@10                                             0095
         AL    @07,@CF00270                                        0095
         TM    ECCDCCHG(@07),B'00000010'                           0095
         BNO   @RF00095                                            0095
*         SMF73VAC(DHCHACNT)='1'B;                                 0096
         L     @10,DHCHACNT                                        0096
         SLA   @10,4                                               0096
         L     @07,DHSMIADD                                        0096
         LA    @01,SMF73SIZ(,@07)                                  0096
         AH    @01,SMF73SIZ(,@07)                                  0096
         LH    @07,SMF73SHC(,@01)                                  0096
         AR    @07,@01                                             0096
         ALR   @07,@10                                             0096
         AL    @07,@CF00271                                        0096
         OI    SMF73VAC-3(@07),B'00000010'                         0096
*       ELSE                                                       0097
*         SMF73VAC(DHCHACNT)='0'B;                                 0097
*                                                                  0097
         B     @RC00095                                            0097
@RF00095 L     @10,DHCHACNT                                        0097
         SLA   @10,4                                               0097
         L     @07,DHSMIADD                                        0097
         LA    @01,SMF73SIZ(,@07)                                  0097
         AH    @01,SMF73SIZ(,@07)                                  0097
         LH    @07,SMF73SHC(,@01)                                  0097
         AR    @07,@01                                             0097
         ALR   @07,@10                                             0097
         AL    @07,@CF00271                                        0097
         NI    SMF73VAC-3(@07),B'11111101'                         0097
*       /*************************************************************/
*       /*                                                           */
*       /* SET CURRENT CHANNEL ONLINE/OFFLINE STATUS                 */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0098
*       IF ECCDALIV(DHCDBRIX)='1'B THEN                            0098
@RC00095 L     @10,DHCDBRIX                                        0098
         MH    @10,@CH00263                                        0098
         L     @07,DHCPERIX                                        0098
         SLA   @07,3                                               0098
         L     @01,@PC00001                                        0098
         L     @01,DHSMAPTR(,@01)                                  0098
         L     @01,STSMEDAD(,@01)                                  0098
         L     @01,ECCECPEQ(,@01)                                  0098
         AL    @01,@CF00267                                        0098
         L     @07,ECCPCDBQ-4(@07,@01)                             0098
         ALR   @07,@10                                             0098
         AL    @07,@CF00270                                        0098
         TM    ECCDALIV(@07),B'00000001'                           0098
         BNO   @RF00098                                            0098
*         SMF73STA(DHCHACNT)='1'B;                                 0099
         L     @10,DHCHACNT                                        0099
         SLA   @10,4                                               0099
         L     @07,DHSMIADD                                        0099
         LA    @01,SMF73SIZ(,@07)                                  0099
         AH    @01,SMF73SIZ(,@07)                                  0099
         LH    @07,SMF73SHC(,@01)                                  0099
         AR    @07,@01                                             0099
         ALR   @07,@10                                             0099
         AL    @07,@CF00271                                        0099
         OI    SMF73STA-3(@07),B'00000001'                         0099
*       ELSE                                                       0100
*         SMF73STA(DHCHACNT)='0'B;                                 0100
*                                                                  0100
         B     @RC00098                                            0100
@RF00098 L     @10,DHCHACNT                                        0100
         SLA   @10,4                                               0100
         L     @07,DHSMIADD                                        0100
         LA    @01,SMF73SIZ(,@07)                                  0100
         AH    @01,SMF73SIZ(,@07)                                  0100
         LH    @07,SMF73SHC(,@01)                                  0100
         AR    @07,@01                                             0100
         ALR   @07,@10                                             0100
         AL    @07,@CF00271                                        0100
         NI    SMF73STA-3(@07),B'11111110'                         0100
*       /*************************************************************/
*       /*                                                           */
*       /* MACDATE Y-2 73018                                         */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0101
*       RESPECIFY                                                  0101
*        (GPR01P)RESTRICTED;                                       0101
@RC00098 DS    0H                                                  0102
*       GPR01P=GPR00P&ECCDCCOF;     /* TURN OFF CONFIGURATION CHANGED
*                                      FLAG.                         */
         LR    GPR01P,GPR00P                                       0102
         N     GPR01P,@CF00134                                     0102
*       GENERATE(CS GPR00P,GPR01P,0(GPR06P));                      0103
         CS GPR00P,GPR01P,0(GPR06P)
*       BC(7,DHLAB1);               /* BRANCH IF UNSUCCESSFUL        */
*                                                                  0104
         BC    7,DHLAB1                                            0104
*       /*************************************************************/
*       /*                                                           */
*       /* MACDATE Y-2 73018                                         */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0105
*       RESPECIFY                                                  0105
*        (GPR00P,                                                  0105
*         GPR01P,                                                  0105
*         GPR06P)UNRESTRICTED;                                     0105
*DHLAB2:                                                           0106
*                                                                  0106
*       /*************************************************************/
*       /*                                                           */
*       /* INCREMENT NUMBER OF CHANNELS PROCESSED                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0106
*       DHCHACNT=DHCHACNT+1;                                       0106
DHLAB2   LA    @10,1                                               0106
         A     @10,DHCHACNT                                        0106
         ST    @10,DHCHACNT                                        0106
*     END;                                                         0107
         LA    @10,1                                               0107
         A     @10,DHCDBRIX                                        0107
@DE00062 ST    @10,DHCDBRIX                                        0107
         L     @15,DHCPERIX                                        0107
         SLA   @15,3                                               0107
         L     @14,@PC00001                                        0107
         L     @01,DHSMAPTR(,@14)                                  0107
         L     @01,STSMEDAD(,@01)                                  0107
         L     @01,ECCECPEQ(,@01)                                  0107
         AL    @01,@CF00283                                        0107
         CH    @10,ECCPCNUM-2(@15,@01)                             0107
         BNH   @DL00062                                            0107
*   END;                                                           0108
         LA    @10,1                                               0108
         A     @10,DHCPERIX                                        0108
@DE00061 ST    @10,DHCPERIX                                        0108
         L     @15,@PC00001                                        0108
         L     @01,DHSMAPTR(,@15)                                  0108
         L     @01,STSMEDAD(,@01)                                  0108
         SR    @00,@00                                             0108
         IC    @00,ECCECPUS(,@01)                                  0108
         CR    @10,@00                                             0108
         BNH   @DL00061                                            0108
*   SMF73CHA=DHCHACNT-1;            /* TOTAL NUMBER OF CHANNELS      */
*                                                                  0109
         L     @10,DHSMIADD                                        0109
         LA    @15,SMF73SIZ(,@10)                                  0109
         AH    @15,SMF73SIZ(,@10)                                  0109
         L     @10,DHCHACNT                                        0109
         BCTR  @10,0                                               0109
         STH   @10,SMF73CHA(,@15)                                  0109
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN AND REENTER THROUGH SPECIAL INTERFACE DHEPILOG:        */
*   /* IRBBREAK MACDATE Y-2 73018                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0110
*DHEPILOG:                                                         0110
*                                                                  0110
*   /*****************************************************************/
*   /*                                                               */
*   /* INDICATE NEXT ROUTINE ADDRESS TO SVC MAINLINE FOR REENTRY     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0110
*   STSMENTR=ADDR(DHRT0024);                                       0110
DHEPILOG L     @10,@PC00001                                        0110
         L     @10,DHSMAPTR(,@10)                                  0110
         LA    @15,DHRT0024                                        0110
         ST    @15,STSMENTR(,@10)                                  0110
*   RESPECIFY                                                      0111
*    (GPR00P,                                                      0111
*     GPR01P,                                                      0111
*     GPR14P,                                                      0111
*     GPR15P)RESTRICTED;                                           0111
*   GENERATE;                                                      0112
         STM   @02,@12,28(@13)     SAVE REGISTERS FOR NEXT SEGMENT
         L     @13,4(,@13)         BACK CHAIN TO CALLERS SAVEAREA
         LM    @14,@12,12(@13)     RESTORE CALLERS REGISTERS
         BR    @14                 RETURN TO CALLER
*                                                                  0113
*   /*****************************************************************/
*   /*                                                               */
*   /* REENTRY POINT FROM CALLER, IGX00014.                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0113
*DHRT0024:                                                         0113
*   GENERATE;                                                      0113
DHRT0024 DS    0H                                                  0113
         STM   @14,@12,12(@13)     SAVE CALLERS REGISTERS
         L     @01,0(,@01)         GET ADDRESS OF SAVE AREA ADDRESS
         L     @01,0(,@01)         GET SAVE AREA ADDRESS
         LM    @02,@12,28(@01)     RELOAD REGISTERS
         ST    @13,4(,@01)         BACK CHAIN NEW SAVEAREA TO OLD
         ST    @01,8(,@13)         FORWARD CHAIN FROM OLD TO NEW
         LR    @13,@01             R13 NOW POINTS TO NEW SAVEAREA
*   RESPECIFY                                                      0114
*    (GPR00P,                                                      0114
*     GPR01P,                                                      0114
*     GPR14P,                                                      0114
*     GPR15P)UNRESTRICTED;                                         0114
*                                                                  0114
*   /*****************************************************************/
*   /*                                                               */
*   /* BEGIN EPILOG PROCESSING. THIS CODE IS ENTERED ENABLED. ITS    */
*   /* FUNCTION IS TO FREE FIXED PAGES, TO COMPLETE THE SMF RECORD   */
*   /* AND TO TRACE IF DESIRED. FIRST UNFIX PROGRAM AND STATIC LOCAL */
*   /* DATA STORAGE. MACDATE Y-2 73018                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0115
*   RESPECIFY                                                      0115
*    (GPR00P,                                                      0115
*     GPR01P,                                                      0115
*     GPR14P,                                                      0115
*     GPR15P)RESTRICTED;                                           0115
*   GENERATE;                                                      0116
*                                                                  0116
DHPAGFX4 PGFREE  R,A=IRBMFDHP,EA=@ENDDATA,RELATED=(MFDHPGFX,           X
               IRBMFDHP(DHPAGFX1))
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0117
*   RESPECIFY                                                      0117
*    (GPR00P,                                                      0117
*     GPR01P,                                                      0117
*     GPR14P,                                                      0117
*     GPR15P)UNRESTRICTED;                                         0117
*                                                                  0117
*   /*****************************************************************/
*   /*                                                               */
*   /* PAGE FREE AUTOMATIC STORAGE MACDATE Y-2 73018                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0118
*   RESPECIFY                                                      0118
*    (GPR00P,                                                      0118
*     GPR01P,                                                      0118
*     GPR14P,                                                      0118
*     GPR15P)RESTRICTED;                                           0118
*   GENERATE;                                                      0119
*                                                                  0119
         LA    GPR15P,@ENDDATD      END ADDRESS
         LA    GPR01P,@DATD         BEGINNING ADDRESS
DHPAGFX5 PGFREE R,A=(GPR01P),EA=(GPR15P),RELATED=(MFDHATFX,            X
               IRBMFDHP(DHPAGFX2))
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0120
*   RESPECIFY                                                      0120
*    (GPR00P,                                                      0120
*     GPR01P,                                                      0120
*     GPR14P,                                                      0120
*     GPR15P)UNRESTRICTED;                                         0120
*   STRVNSGT=STRVNSGT-1;            /* REMOVE ENTRY FOR AUTOMATIC  0121
*                                      STORAGE.                      */
*                                                                  0121
         L     @10,@PC00001                                        0121
         L     @10,DHSMAPTR(,@10)                                  0121
         L     @15,STSMRVT(,@10)                                   0121
         L     @14,STRVNSGT(,@15)                                  0121
         BCTR  @14,0                                               0121
         ST    @14,STRVNSGT(,@15)                                  0121
*   /*****************************************************************/
*   /*                                                               */
*   /* UNFIX INTERVAL STORAGE DATA MACDATE Y-2 73018                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0122
*   RESPECIFY                                                      0122
*    (GPR00P,                                                      0122
*     GPR01P,                                                      0122
*     GPR14P,                                                      0122
*     GPR15P)RESTRICTED;                                           0122
*   GPR01P=DHSMIADD-LENGTH(STSMIGMC);/* BEGINNING ADDRESS            */
         L     GPR01P,DHSMIADD                                     0123
         SH    GPR01P,@CH00112                                     0123
*   GPR15P=GPR01P+STSMILEN;         /* ENDING ADDRESS+1              */
         LR    GPR15P,GPR01P                                       0124
         SR    @09,@09                                             0124
         ICM   @09,7,STSMILEN(@10)                                 0124
         AR    GPR15P,@09                                          0124
*   GENERATE;                                                      0125
*                                                                  0125
DHPAGFX6 PGFREE  R,A=(GPR01P),EA=(GPR15P),RELATED=(MFDHISFX,           X
               IRBMFDHP(DHPAGFX3))
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0126
*   RESPECIFY                                                      0126
*    (GPR00P,                                                      0126
*     GPR01P,                                                      0126
*     GPR14P,                                                      0126
*     GPR15P)UNRESTRICTED;                                         0126
*   IF DHFSTCLL='1'B THEN           /* RETURN IF FIRST CALL, RETURN  */
         L     @10,@PC00001+8                                      0127
         TM    DHFSTCLL(@10),B'10000000'                           0127
         BO    @RT00127                                            0127
*     RETURN;                       /* RETURN TO MFDATA SVC        0128
*                                      PROCESSOR-IGX00014            */
*                                                                  0128
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW HAVE TWO PARTIALLY COMPLETED SMF RECORDS WITH ENCODED     */
*   /* INFORMATION. ONE CONTAINS DATA FROM THE LAST INTERVAL (POINTED*/
*   /* TO BY DHDTAPTR). THE OTHER CONTAINS DATA COLLECTED AT THIS    */
*   /* INTERVAL (POINTED TO BY DHSMIADD). COMPLETE THE SMF RECORD    */
*   /* POINTED TO BY DHDTAPTR. PROVIDE DEFAULT ADDRESSABILITY TO THE */
*   /* OUTPUT RECORD. THE OTHER RECORD WILL BE EXPLICITLY            */
*   /* POINTER-QUALIFIED. SET EXPLICIT POINTER QUALIFIER FOR THIS    */
*   /* INTERVAL SMFB ARRAY                                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0129
*   RESPECIFY                                                      0129
*     SMFRCD73 BASED(DHSMIADD);                                    0129
*   DHSMFB=ADDR(SMF73B);                                           0130
*                                                                  0130
         L     @10,DHSMIADD                                        0130
         LA    @15,SMF73SIZ(,@10)                                  0130
         AH    @15,SMF73SIZ(,@10)                                  0130
         LH    @10,SMF73SHC(,@15)                                  0130
         AR    @10,@15                                             0130
         ST    @10,DHSMFB                                          0130
*   /*****************************************************************/
*   /*                                                               */
*   /* PROVIDE DEFAULT ADDRESSABILITY TO OUTPUT SUPERVISOR SMF RECORD*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0131
*   RESPECIFY                                                      0131
*     SMFRCD73 BASED(DHDTAPTR);                                    0131
*                                                                  0131
*   /*****************************************************************/
*   /*                                                               */
*   /* INSERT LAST INTERVAL START TIME, DATE, AND INTERVAL DURATION  */
*   /* INTO THE SMF RECORD                                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0132
*   SMF73IST=DHINTSRT;              /* LAST INTERVAL START TIME      */
         L     @10,DHDTAPTR                                        0132
         L     @15,@PC00001+24                                     0132
         MVC   SMF73IST(4,@10),DHINTSRT(@15)                       0132
*   SMF73DAT=DHINTDAT;              /* LAST INTERVAL DATE IN FORM  0133
*                                      00YYDDDF                      */
         L     @15,@PC00001+28                                     0133
         MVC   SMF73DAT(4,@10),DHINTDAT(@15)                       0133
*   SMF73INT=DHINTLEN;              /* INTERVAL DURATION             */
         L     @15,@PC00001+32                                     0134
         MVC   SMF73INT(4,@10),DHINTLEN(@15)                       0134
*   DHCHACNT=1;                     /* NEXT AVAILABLE CHANNEL SLOT   */
         LA    @10,1                                               0135
         ST    @10,DHCHACNT                                        0135
*   DO DHCHAIDX=1 TO SMF73CHA;                                     0136
*                                                                  0136
         B     @DE00136                                            0136
@DL00136 DS    0H                                                  0137
*     /***************************************************************/
*     /*                                                             */
*     /* IF THIS CHANNEL IS VALID                                    */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0137
*     IF DHSMFB->SMF73HID(DHCHAIDX)^=DHNOTVLD THEN                 0137
         LA    @15,255                                             0137
         L     @14,DHSMFB                                          0137
         SLA   @10,4                                               0137
         LA    @01,0(@10,@14)                                      0137
         AL    @01,@CF00269                                        0137
         SR    @00,@00                                             0137
         IC    @00,SMF73HID-2(,@01)                                0137
         CR    @15,@00                                             0137
         BE    @RF00137                                            0137
*       DO;                                                        0138
*                                                                  0138
*         /***********************************************************/
*         /*                                                         */
*         /* IF THIS CHANNEL WAS INVALID LAST INTERVAL               */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0139
*         IF SMF73HID(DHCHAIDX)=DHNOTVLD THEN                      0139
         L     @09,DHDTAPTR                                        0139
         LA    @08,SMF73SIZ(,@09)                                  0139
         AH    @08,SMF73SIZ(,@09)                                  0139
         LH    @09,SMF73SHC(,@08)                                  0139
         AR    @09,@08                                             0139
         LA    @01,0(@10,@09)                                      0139
         AL    @01,@CF00269                                        0139
         SR    @00,@00                                             0139
         IC    @00,SMF73HID-2(,@01)                                0139
         CR    @15,@00                                             0139
         BNE   @RF00139                                            0139
*           DO;                                                    0140
*                                                                  0140
*             /*******************************************************/
*             /*                                                     */
*             /* MOVE ENTRY TO OUTPUT RECORD                         */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0141
*             SMF73B(DHCHAIDX)=DHSMFB->SMF73B(DHCHAIDX);           0141
*                                                                  0141
         ST    @10,@TF00001                                        0141
         ALR   @10,@09                                             0141
         AL    @10,@CF00268                                        0141
         AL    @14,@TF00001                                        0141
         AL    @14,@CF00268                                        0141
         MVC   SMF73B(16,@10),SMF73B(@14)                          0141
*             /*******************************************************/
*             /*                                                     */
*             /* SET VARY ACTIVITY FLAG AND ZERO SIOS, BUSY SAMPLES  */
*             /* AND OVERLAP SAMPLES.                                */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0142
*             SMF73VAC(DHCHAIDX)='1'B;                             0142
         LR    @10,@09                                             0142
         AL    @10,@TF00001                                        0142
         AL    @10,@CF00271                                        0142
         OI    SMF73VAC-3(@10),B'00000010'                         0142
*             SMF73CNT(DHCHAIDX)=DHDTZERO;                         0143
         SR    @10,@10                                             0143
         L     @08,@TF00001                                        0143
         AL    @08,@CF00278                                        0143
         ST    @10,SMF73CNT-4(@08,@09)                             0143
*             SMF73BSY(DHCHAIDX)=DHDTZERO;                         0144
         L     @08,@TF00001                                        0144
         AL    @08,@CF00266                                        0144
         ST    @10,SMF73BSY-8(@08,@09)                             0144
*             SMF73OLP(DHCHAIDX)=DHDTZERO;                         0145
         L     @08,@TF00001                                        0145
         AL    @09,@CF00267                                        0145
         ST    @10,SMF73OLP-12(@08,@09)                            0145
*           END;                                                   0146
*         ELSE                      /* THIS CPU WAS VALID LAST     0147
*                                      INTERVAL                      */
*           DO;                                                    0147
*                                                                  0147
         B     @RC00139                                            0147
@RF00139 DS    0H                                                  0148
*             /*******************************************************/
*             /*                                                     */
*             /* MOVE OVER STATUS AND VARY FLAGS                     */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0148
*             IF DHSMFB->SMF73VAC(DHCHAIDX)='1'B THEN              0148
         L     @10,DHCHAIDX                                        0148
         SLA   @10,4                                               0148
         L     @01,DHSMFB                                          0148
         ALR   @01,@10                                             0148
         AL    @01,@CF00271                                        0148
         TM    SMF73VAC-3(@01),B'00000010'                         0148
         BNO   @RF00148                                            0148
*               SMF73VAC(DHCHAIDX)='1'B;                           0149
         L     @15,DHDTAPTR                                        0149
         LA    @14,SMF73SIZ(,@15)                                  0149
         AH    @14,SMF73SIZ(,@15)                                  0149
         LH    @15,SMF73SHC(,@14)                                  0149
         AR    @15,@14                                             0149
         ALR   @15,@10                                             0149
         AL    @15,@CF00271                                        0149
         OI    SMF73VAC-3(@15),B'00000010'                         0149
*             ELSE                                                 0150
*               SMF73VAC(DHCHAIDX)='0'B;                           0150
         B     @RC00148                                            0150
@RF00148 L     @10,DHCHAIDX                                        0150
         SLA   @10,4                                               0150
         L     @15,DHDTAPTR                                        0150
         LA    @14,SMF73SIZ(,@15)                                  0150
         AH    @14,SMF73SIZ(,@15)                                  0150
         LH    @15,SMF73SHC(,@14)                                  0150
         AR    @15,@14                                             0150
         ALR   @15,@10                                             0150
         AL    @15,@CF00271                                        0150
         NI    SMF73VAC-3(@15),B'11111101'                         0150
*             IF DHSMFB->SMF73STA(DHCHAIDX)='1'B THEN/* TEST FOR   0151
*                                      STATUS FLAG                   */
@RC00148 L     @10,DHCHAIDX                                        0151
         SLA   @10,4                                               0151
         L     @01,DHSMFB                                          0151
         ALR   @01,@10                                             0151
         AL    @01,@CF00271                                        0151
         TM    SMF73STA-3(@01),B'00000001'                         0151
         BNO   @RF00151                                            0151
*               SMF73STA(DHCHAIDX)='1'B;                           0152
         L     @15,DHDTAPTR                                        0152
         LA    @14,SMF73SIZ(,@15)                                  0152
         AH    @14,SMF73SIZ(,@15)                                  0152
         LH    @15,SMF73SHC(,@14)                                  0152
         AR    @15,@14                                             0152
         ALR   @15,@10                                             0152
         AL    @15,@CF00271                                        0152
         OI    SMF73STA-3(@15),B'00000001'                         0152
*             ELSE                  /* STATUS FLAG IS OFF            */
*               SMF73STA(DHCHAIDX)='0'B;                           0153
*                                                                  0153
         B     @RC00151                                            0153
@RF00151 L     @10,DHCHAIDX                                        0153
         SLA   @10,4                                               0153
         L     @15,DHDTAPTR                                        0153
         LA    @14,SMF73SIZ(,@15)                                  0153
         AH    @14,SMF73SIZ(,@15)                                  0153
         LH    @15,SMF73SHC(,@14)                                  0153
         AR    @15,@14                                             0153
         ALR   @15,@10                                             0153
         AL    @15,@CF00271                                        0153
         NI    SMF73STA-3(@15),B'11111110'                         0153
*             /*******************************************************/
*             /*                                                     */
*             /* IF VARY ACTIVITY WAS DETECTED, OR IF CHANNEL IS     */
*             /* OFFLINE                                             */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0154
*             IF SMF73VAC(DHCHAIDX)='1'BSMF73STA(DHCHAIDX)='0'B THEN
@RC00151 L     @10,DHCHAIDX                                        0154
         SLA   @10,4                                               0154
         L     @15,DHDTAPTR                                        0154
         LA    @14,SMF73SIZ(,@15)                                  0154
         AH    @14,SMF73SIZ(,@15)                                  0154
         LH    @15,SMF73SHC(,@14)                                  0154
         AR    @15,@14                                             0154
         ALR   @15,@10                                             0154
         AL    @15,@CF00271                                        0154
         TM    SMF73VAC-3(@15),B'00000010'                         0154
         BNZ   @RT00154                                            0154
         TM    SMF73STA-3(@15),B'00000001'                         0154
         BO    @RF00154                                            0154
@RT00154 DS    0H                                                  0155
*               DO;                 /* ZERO DATA                     */
*                 SMF73CNT(DHCHAIDX)=DHDTZERO;                     0156
         SR    @10,@10                                             0156
         L     @15,DHCHAIDX                                        0156
         SLA   @15,4                                               0156
         L     @14,DHDTAPTR                                        0156
         LA    @09,SMF73SIZ(,@14)                                  0156
         AH    @09,SMF73SIZ(,@14)                                  0156
         LH    @14,SMF73SHC(,@09)                                  0156
         AR    @14,@09                                             0156
         LA    @01,0(@15,@14)                                      0156
         AL    @01,@CF00278                                        0156
         ST    @10,SMF73CNT-4(,@01)                                0156
*                 SMF73BSY(DHCHAIDX)=DHDTZERO;                     0157
         LA    @01,0(@15,@14)                                      0157
         AL    @01,@CF00266                                        0157
         ST    @10,SMF73BSY-8(,@01)                                0157
*                 SMF73OLP(DHCHAIDX)=DHDTZERO;                     0158
         AL    @14,@CF00267                                        0158
         ST    @10,SMF73OLP-12(@15,@14)                            0158
*               END;                                               0159
*             ELSE                  /* NO VARY ACTIVITY WAS DETECTED
*                                      AND THE CHANNEL IS ONLINE.  0160
*                                      MOVE DATA.                    */
*               DO;                                                0160
         B     @RC00154                                            0160
@RF00154 DS    0H                                                  0161
*                 SMF73CNT(DHCHAIDX)=DHSMFB->SMF73CNT(DHCHAIDX)-   0161
*                     SMF73CNT(DHCHAIDX);                          0161
*                                                                  0161
         L     @10,DHCHAIDX                                        0161
         SLA   @10,4                                               0161
         L     @15,DHDTAPTR                                        0161
         LA    @14,SMF73SIZ(,@15)                                  0161
         AH    @14,SMF73SIZ(,@15)                                  0161
         LH    @15,SMF73SHC(,@14)                                  0161
         AR    @15,@14                                             0161
         L     @01,DHSMFB                                          0161
         AL    @01,@CF00278                                        0161
         L     @14,SMF73CNT-4(@10,@01)                             0161
         LA    @01,0(@10,@15)                                      0161
         AL    @01,@CF00278                                        0161
         SL    @14,SMF73CNT-4(,@01)                                0161
         LA    @01,0(@10,@15)                                      0161
         AL    @01,@CF00278                                        0161
         ST    @14,SMF73CNT-4(,@01)                                0161
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF CHANNEL TYPE IS INVALID, OR IF CHANNEL IS A  */
*                 /* BYTE MULTIPLEXOR, DONT COLLECT DATA             */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0162
*                 IF SMF73IID(DHCHAIDX)='1'B THEN                  0162
         ST    @10,@TF00001                                        0162
         ALR   @10,@15                                             0162
         AL    @10,@CF00271                                        0162
         TM    SMF73IID-3(@10),B'00000100'                         0162
         BNO   @RF00162                                            0162
*                   DO;                                            0163
*                     SMF73BSY(DHCHAIDX)=DHDTZERO;                 0164
         SR    @10,@10                                             0164
         L     @14,@TF00001                                        0164
         AL    @14,@CF00266                                        0164
         ST    @10,SMF73BSY-8(@14,@15)                             0164
*                     SMF73OLP(DHCHAIDX)=DHDTZERO;                 0165
         L     @14,@TF00001                                        0165
         AL    @15,@CF00267                                        0165
         ST    @10,SMF73OLP-12(@14,@15)                            0165
*                     GO TO DHLAB6; /* PASS OVER DATA COLLECTION   0166
*                                      ROUTINE AND INCR SLOT CTR     */
         B     DHLAB6                                              0166
*                   END;                                           0167
*                 IF SMF73TYP(DHCHAIDX)=MULTPLEX THEN/* TEST FOR   0168
*                                      MULTIPLEXER CHANNEL           */
@RF00162 L     @10,DHCHAIDX                                        0168
         SLA   @10,4                                               0168
         L     @15,DHDTAPTR                                        0168
         LA    @14,SMF73SIZ(,@15)                                  0168
         AH    @14,SMF73SIZ(,@15)                                  0168
         LH    @15,SMF73SHC(,@14)                                  0168
         AR    @15,@14                                             0168
         ST    @10,@TF00001                                        0168
         ALR   @10,@15                                             0168
         AL    @10,@CF00271                                        0168
         TM    SMF73TYP-3(@10),B'00010000'                         0168
         BNO   @RF00168                                            0168
         TM    SMF73TYP-3(@10),B'11100000'                         0168
         BNZ   @RF00168                                            0168
*                   DO;                                            0169
*                     SMF73BSY(DHCHAIDX)=DHDTZERO;                 0170
         SR    @10,@10                                             0170
         L     @14,@TF00001                                        0170
         AL    @14,@CF00266                                        0170
         ST    @10,SMF73BSY-8(@14,@15)                             0170
*                     SMF73OLP(DHCHAIDX)=DHDTZERO;                 0171
         L     @14,@TF00001                                        0171
         AL    @15,@CF00267                                        0171
         ST    @10,SMF73OLP-12(@14,@15)                            0171
*                     GO TO DHLAB6; /* PASS OVER DATA COLLECTION   0172
*                                      ROUTINE AND INCR SLOT CTR     */
         B     DHLAB6                                              0172
*                   END;                                           0173
*                                                                  0173
*                 /***************************************************/
*                 /*                                                 */
*                 /* COLLECT DATA                                    */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0174
*                 SMF73BSY(DHCHAIDX)=DHSMFB->SMF73BSY(DHCHAIDX)-   0174
*                     SMF73BSY(DHCHAIDX);                          0174
@RF00168 L     @10,DHCHAIDX                                        0174
         SLA   @10,4                                               0174
         L     @15,DHDTAPTR                                        0174
         LA    @14,SMF73SIZ(,@15)                                  0174
         AH    @14,SMF73SIZ(,@15)                                  0174
         LH    @15,SMF73SHC(,@14)                                  0174
         AR    @15,@14                                             0174
         L     @14,DHSMFB                                          0174
         LA    @01,0(@10,@14)                                      0174
         AL    @01,@CF00266                                        0174
         L     @09,SMF73BSY-8(,@01)                                0174
         LA    @08,0(@10,@15)                                      0174
         AL    @08,@CF00266                                        0174
         SL    @09,SMF73BSY-8(,@08)                                0174
         LA    @08,0(@10,@15)                                      0174
         AL    @08,@CF00266                                        0174
         ST    @09,SMF73BSY-8(,@08)                                0174
*                 SMF73OLP(DHCHAIDX)=DHSMFB->SMF73OLP(DHCHAIDX)-   0175
*                     SMF73OLP(DHCHAIDX);                          0175
         AL    @14,@CF00267                                        0175
         L     @14,SMF73OLP-12(@10,@14)                            0175
         LA    @01,0(@10,@15)                                      0175
         AL    @01,@CF00267                                        0175
         SL    @14,SMF73OLP-12(,@01)                               0175
         AL    @15,@CF00267                                        0175
         ST    @14,SMF73OLP-12(@10,@15)                            0175
*DHLAB6:                            /* END OF DATA COLLECTION        */
*               END;                                               0176
DHLAB6   DS    0H                                                  0177
*           END;                                                   0177
*                                                                  0177
@RC00154 DS    0H                                                  0178
*         /***********************************************************/
*         /*                                                         */
*         /* MOVE ENTRY INTO PROPER SLOT (IF NEEDED) AND INCREMENT   */
*         /* SLOT COUNTER                                            */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0178
*         IF DHCHACNT^=DHCHAIDX THEN                               0178
@RC00139 L     @10,DHCHACNT                                        0178
         L     @15,DHCHAIDX                                        0178
         CR    @10,@15                                             0178
         BE    @RF00178                                            0178
*           DO;                                                    0179
*             DHSMFPR1=ADDR(SMF73B(DHCHACNT));                     0180
         SLA   @10,4                                               0180
         L     @14,DHDTAPTR                                        0180
         LA    @09,SMF73SIZ(,@14)                                  0180
         AH    @09,SMF73SIZ(,@14)                                  0180
         LH    @08,SMF73SHC(,@09)                                  0180
         AR    @08,@09                                             0180
         AL    @10,@CF00268                                        0180
         LA    @10,SMF73B(@10,@08)                                 0180
         ST    @10,DHSMFPR1                                        0180
*             DHSMFPR2=ADDR(SMF73B(DHCHAIDX));                     0181
         SLA   @15,4                                               0181
         AL    @08,@CF00268                                        0181
         LA    @15,SMF73B(@15,@08)                                 0181
         ST    @15,DHSMFPR2                                        0181
*             DHSMFPR1->DHSMF73B=DHSMFPR2->DHSMF73B;               0182
         MVC   DHSMF73B(16,@10),DHSMF73B(@15)                      0182
*           END;                                                   0183
*         DHCHACNT=DHCHACNT+1;                                     0184
@RF00178 LA    @10,1                                               0184
         A     @10,DHCHACNT                                        0184
         ST    @10,DHCHACNT                                        0184
*       END;                                                       0185
*   END;                                                           0186
*                                                                  0186
@RF00137 LA    @10,1                                               0186
         A     @10,DHCHAIDX                                        0186
@DE00136 ST    @10,DHCHAIDX                                        0186
         L     @01,DHDTAPTR                                        0186
         LA    @15,SMF73SIZ(,@01)                                  0186
         L     @14,DHDTAPTR                                        0186
         AH    @15,SMF73SIZ(,@14)                                  0186
         CH    @10,SMF73CHA(,@15)                                  0186
         BNH   @DL00136                                            0186
*   /*****************************************************************/
*   /*                                                               */
*   /* SET NUMBER OF CHANNEL ENTRIES                                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0187
*   SMF73CHA=DHCHACNT-1;                                           0187
*                                                                  0187
         L     @10,DHDTAPTR                                        0187
         LA    @15,SMF73SIZ(,@10)                                  0187
         AH    @15,SMF73SIZ(,@10)                                  0187
         L     @14,DHCHACNT                                        0187
         BCTR  @14,0                                               0187
         STH   @14,SMF73CHA(,@15)                                  0187
*   /*****************************************************************/
*   /*                                                               */
*   /* SET NUMBER OF SAMPLES                                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0188
*   SMF73SAM=DHSMIADD->SMF73SAM-SMF73SAM;                          0188
*                                                                  0188
         L     @01,DHSMIADD                                        0188
         L     @15,SMF73SAM(,@01)                                  0188
         SL    @15,SMF73SAM(,@10)                                  0188
         ST    @15,SMF73SAM(,@10)                                  0188
*   /*****************************************************************/
*   /*                                                               */
*   /* SET ACTUAL RECORD LENGTH                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0189
*   SMF73LEN=LENGTH(SMFRCD73)+LENGTH(SMF73A)+SMF73CHA*LENGTH(SMF73B);
*                                                                  0189
         SLA   @14,4                                               0189
         AH    @14,@CH00264                                        0189
         STH   @14,SMF73LEN(,@10)                                  0189
*   /*****************************************************************/
*   /*                                                               */
*   /* TRACE TO SMF DATA SET IF DIRECTED TO DO SO                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0190
*   IF DHTRACE='1'B THEN                                           0190
         L     @15,@PC00001+12                                     0190
         TM    DHTRACE(@15),B'10000000'                            0190
         BNO   @RF00190                                            0190
*     DO;                                                          0191
*                                                                  0191
*       /*************************************************************/
*       /*                                                           */
*       /* MACDATE Y-2 73018                                         */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0192
*       RESPECIFY                                                  0192
*        (GPR00P,                                                  0192
*         GPR01P,                                                  0192
*         GPR14P,                                                  0192
*         GPR15P)RESTRICTED;                                       0192
*       GPR01P=DHDTAPTR;            /* SMF RECORD ADDRESS TO REGISTER*/
         LR    GPR01P,@10                                          0193
*       GENERATE(SMFWTM (GPR01P));                                 0194
*                                                                  0194
         SMFWTM (GPR01P)
*       /*************************************************************/
*       /*                                                           */
*       /* MACDATE Y-2 73018                                         */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0195
*       RESPECIFY                                                  0195
*        (GPR00P,                                                  0195
*         GPR01P,                                                  0195
*         GPR14P,                                                  0195
*         GPR15P)UNRESTRICTED;                                     0195
*     END;                                                         0196
*                                                                  0196
*   /*****************************************************************/
*   /*                                                               */
*   /* GET USER STORAGE FOR THE RETURN SMF RECORD DATA, MOVE THE DATA*/
*   /* IN AND FREE THE SUPERVISOR COPY. THE RETURN PARAMETER WILL    */
*   /* POINT TO THE USER STORAGE SMF DATA AREA. THE SUBPOOL AND      */
*   /* LENGTH WILL PREFIX THE DATA AREA. THIS STORAGE WILL BE FREED  */
*   /* BY THE USER                                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0197
*   DHSMFSBP=STSMSSP;               /* SMF RECORD USER STORAGE SBPOOL*/
@RF00190 L     @10,@PC00001                                        0197
         L     @10,DHSMAPTR(,@10)                                  0197
         MVC   DHSMFSBP(1),STSMSSP(@10)                            0197
*   DHSMFLEN=SMF73LEN+LENGTH(DHSMFGMC);/* ACTUAL LENGTH OF RECORD  0198
*                                      PLUS ROOM FOR SUBPOOL AND   0198
*                                      LENGTH                        */
*                                                                  0198
         LA    @10,4                                               0198
         L     @01,DHDTAPTR                                        0198
         AH    @10,SMF73LEN(,@01)                                  0198
         STCM  @10,7,DHSMFLEN                                      0198
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0199
*   RESPECIFY                                                      0199
*    (GPR00P,                                                      0199
*     GPR01P,                                                      0199
*     GPR14P,                                                      0199
*     GPR15P)RESTRICTED;                                           0199
*   GPR00P=DHSMFGMC;                /* GETMAIN CONTROL WORD TO REG   */
         L     GPR00P,DHSMFGMC                                     0200
*   GENERATE(GETMAIN R,LV=(0));                                    0201
         GETMAIN R,LV=(0)
*   DHRETDTA=GPR01P+LENGTH(DHSMFGMC);/* POINT PARM TO RETURN RECORD  */
*                                                                  0202
         L     @10,@PC00001+4                                      0202
         LA    @09,4                                               0202
         LR    @08,GPR01P                                          0202
         AR    @08,@09                                             0202
         ST    @08,DHRETDTA(,@10)                                  0202
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0203
*   RESPECIFY                                                      0203
*    (GPR00P,                                                      0203
*     GPR01P,                                                      0203
*     GPR14P,                                                      0203
*     GPR15P)UNRESTRICTED;                                         0203
*                                                                  0203
*   /*****************************************************************/
*   /*                                                               */
*   /* MOVE ALL PERTINENT CONTROL INFORMATION TO REGISTERS, CHANGE TO*/
*   /* USERS KEY AND CREATE USER RECORD MACDATE Y-2 73018            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0204
*   RESPECIFY                                                      0204
*    (GPR00P,                                                      0204
*     GPR01P,                                                      0204
*     GPR05P,                                                      0204
*     GPR06P,                                                      0204
*     GPR14P,                                                      0204
*     GPR15P)RESTRICTED;                                           0204
*   GPR05P=DHSMFGMC;                /* GETMAIN CONTROL WRD TO REG    */
         L     GPR05P,DHSMFGMC                                     0205
*   GPR06P=DHRETDTA-LENGTH(DHSMFGMC);/* PREFIX ADDRESS               */
         LCR   @09,@09                                             0206
         AR    @09,@08                                             0206
         LR    GPR06P,@09                                          0206
*   GPR00P=DHRETDTA;                /* USER SMF RECORD ADDRESS       */
         LR    GPR00P,@08                                          0207
*   GPR14P=DHDTAPTR;                /* SYSTEM SMF RECORD ADDRESS     */
         L     GPR14P,DHDTAPTR                                     0208
*   GPR01P=DHSMFLEN;                /* LENGTH TO MOVE                */
         SR    @10,@10                                             0209
         ICM   @10,7,DHSMFLEN                                      0209
         LR    GPR01P,@10                                          0209
*   GPR15P=DHSMFLEN;                /* LENGTH TO MOVE                */
*                                                                  0210
         LR    GPR15P,@10                                          0210
*   /*****************************************************************/
*   /*                                                               */
*   /* CHANGE TO USERS KEY MACDATE Y-2 73018                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0211
*   RESPECIFY                                                      0211
*    (GPR02P,                                                      0211
*     GPR03P,                                                      0211
*     GPR04P)RESTRICTED;                                           0211
*   GPR03P=DHTCBADR;                /* TCB ADDRESS TO REGISTER       */
         L     @10,@PC00001+20                                     0212
         L     GPR03P,DHTCBADR(,@10)                               0212
*   GENERATE SETS(DHSAVKEY);                                       0213
*                                                                  0213
         USING TCB,GPR03P
DHMODES1 MODESET EXTKEY=TCB,SAVEKEY=DHSAVKEY,WORKREG=4,                X
               RELATED=(MFDHUKEY,IRBMFDHP(DHMODES2))
         DROP  GPR03P
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0214
*   RESPECIFY                                                      0214
*    (GPR02P,                                                      0214
*     GPR03P,                                                      0214
*     GPR04P)UNRESTRICTED;                                         0214
*   GENERATE;                                                      0215
*                                                                  0215
         ST    GPR05P,0(,GPR06P)    STORE SUBPOOL AND LENGTH IN PREFIX
         MVCL  GPR00P,GPR14P        MOVE RECORD
*   /*****************************************************************/
*   /*                                                               */
*   /* CHANGE BACK TO SYSTEM KEY MACDATE Y-2 73018                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0216
*   RESPECIFY                                                      0216
*    (GPR02P,                                                      0216
*     GPR04P)RESTRICTED;                                           0216
*   GENERATE REFS(DHSAVKEY);                                       0217
*                                                                  0217
DHMODES2 MODESET KEYADDR=DHSAVKEY,WORKREG=4,                           X
               RELATED=(MFDHUKEY,IRBMFDHP(DHMODES1))
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0218
*   RESPECIFY                                                      0218
*    (GPR02P,                                                      0218
*     GPR04P)UNRESTRICTED;                                         0218
*                                                                  0218
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0219
*   RESPECIFY                                                      0219
*    (GPR00P,                                                      0219
*     GPR01P,                                                      0219
*     GPR05P,                                                      0219
*     GPR06P,                                                      0219
*     GPR14P,                                                      0219
*     GPR15P)UNRESTRICTED;                                         0219
*                                                                  0219
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW FREE SYSTEM SMF RECORD STORAGE MACDATE Y-2 73018          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0220
*   RESPECIFY                                                      0220
*    (GPR00P,                                                      0220
*     GPR01P,                                                      0220
*     GPR14P,                                                      0220
*     GPR15P)RESTRICTED;                                           0220
*   GPR00P=STSMIGMC;                /* GETMAIN CONTROL WORD TO REG   */
         L     @10,@PC00001                                        0221
         L     @10,DHSMAPTR(,@10)                                  0221
         L     GPR00P,STSMIGMC(,@10)                               0221
*   GPR01P=DHDTAPTR-LENGTH(STSMIGMC);/* POINT TO BEGINNING OF STORAGE*/
         L     GPR01P,DHDTAPTR                                     0222
         SH    GPR01P,@CH00112                                     0222
*   GENERATE;                                                      0223
*                                                                  0223
DHGETMN2 FREEMAIN R,LV=(0),A=(1),RELATED=(MFDHISGM,IRBMFDHP(DHGETMN1))
*   /*****************************************************************/
*   /*                                                               */
*   /* MACDATE Y-2 73018                                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0224
*   RESPECIFY                                                      0224
*    (GPR00P,                                                      0224
*     GPR01P,                                                      0224
*     GPR14P,                                                      0224
*     GPR15P)UNRESTRICTED;                                         0224
*   RETURN;                         /* RETURN TO CALLER              */
@EL00001 L     @13,4(,@13)                                         0225
@EF00001 L     @00,@SIZDATD                                        0225
         LR    @01,@11                                             0225
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0225
         BR    @14                                                 0225
*   END                                                            0226
*                                                                  0226
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IFASMFR )                                       */
*                                                                  0226
*       ;                                                          0226
         B     @EL00001                                            0226
@DATA    DS    0H
@CH00060 DC    H'1'
@CH00112 DC    H'4'
@CH00056 DC    H'8'
@CH00123 DC    H'16'
@CH00263 DC    H'20'
@CH00264 DC    H'56'
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    9F
@TF00001 DS    F
@TF00002 DS    F
IRBMFDHP CSECT
         DS    0F
@CF00270 DC    F'-20'
@CF00268 DC    F'-16'
@CF00269 DC    F'-14'
@CF00271 DC    F'-13'
@CF00278 DC    F'-12'
@CF00266 DC    F'-8'
@CF00283 DC    F'-6'
@CF00267 DC    F'-4'
@CF00134 DC    XL4'FDFFFFFF'
@DATD    DSECT
         DS    0D
DHCPERIX DS    F
DHDTAPTR DS    A
DHSMFB   DS    A
DHSMFPR1 DS    A
DHSMFPR2 DS    A
DHSMIADD DS    A
DHCHAIDX DS    F
DHPAGECB DS    F
DHCHACNT DS    F
DHCDBRIX DS    F
DHSAVKEY DS    CL1
         DS    CL3
DHSMFGMC DS    CL4
         ORG   DHSMFGMC
DHSMFSBP DS    FL1
DHSMFLEN DS    FL3
         ORG   DHSMFGMC+4
IRBMFDHP CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
DHPATCH  DS    CL200
IRBMFDHP CSECT
         IKJTCB
IRBMFDHP CSECT
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IRBMFDHP CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
GPR00P   EQU   @00
GPR01P   EQU   @01
GPR14P   EQU   @14
GPR15P   EQU   @15
GPR05P   EQU   @05
GPR13P   EQU   @13
GPR03P   EQU   @03
GPR04P   EQU   @04
GPR06P   EQU   @06
GPR02P   EQU   @02
GPR00F   EQU   @00
GPR01F   EQU   @01
GPR14F   EQU   @14
GPR15F   EQU   @15
STSMA    EQU   0
STSMOPT  EQU   STSMA
STSMOFLG EQU   STSMOPT+3
STSMSAVE EQU   STSMA+24
STSMENTR EQU   STSMA+28
STSMEDAD EQU   STSMA+32
STSMIGMC EQU   STSMA+36
STSMILEN EQU   STSMIGMC+1
STSMIADD EQU   STSMA+40
STSMRVT  EQU   STSMA+44
STSMSSP  EQU   STSMA+52
ECCEDT   EQU   0
ECCECPEQ EQU   ECCEDT
ECCECPUS EQU   ECCEDT+7
ECCESAMP EQU   ECCEDT+8
ECCPE    EQU   0
ECCPFLGS EQU   ECCPE
ECCPCNUM EQU   ECCPE+2
ECCPCDBQ EQU   ECCPE+4
ECCDB    EQU   0
ECCDFLGS EQU   ECCDB
ECCDIVID EQU   ECCDFLGS
ECCDVALD EQU   ECCDFLGS
ECCDCCHG EQU   ECCDFLGS
ECCDALIV EQU   ECCDFLGS
ECCDCHID EQU   ECCDB+4
ECCDCTYP EQU   ECCDCHID
ECCDSIOS EQU   ECCDB+8
ECCDBUSY EQU   ECCDB+12
ECCDOLAP EQU   ECCDB+16
SMFRCD73 EQU   0
SMF73LEN EQU   SMFRCD73
SMF73RTY EQU   SMFRCD73+5
SMF73SIZ EQU   SMFRCD73+18
SMF73IST EQU   SMFRCD73+20
SMF73DAT EQU   SMFRCD73+24
SMF73INT EQU   SMFRCD73+28
SMF73SAM EQU   SMFRCD73+36
SMF73PTR EQU   0
SMF73A   EQU   0
SMF73SHC EQU   SMF73A
SMF73CHA EQU   SMF73A+2
SMF73SHD EQU   SMF73A+4
SMF73B   EQU   0
SMF73CID EQU   SMF73B
SMF73HID EQU   SMF73B+2
SMF73FG2 EQU   SMF73B+3
SMF73TYP EQU   SMF73FG2
SMF73IID EQU   SMF73FG2
SMF73VAC EQU   SMF73FG2
SMF73STA EQU   SMF73FG2
SMF73CNT EQU   SMF73B+4
SMF73BSY EQU   SMF73B+8
SMF73OLP EQU   SMF73B+12
STRVT    EQU   0
STRVSSGT EQU   STRVT+8
STRVNSGT EQU   STRVT+12
STSGT    EQU   0
STSGFREE EQU   STSGT
STSGADD  EQU   STSGT+4
DHSMF73B EQU   0
DHDTAGMC EQU   0
IKEBC    EQU   0
IKEBF15  EQU   0
IKEBF31  EQU   0
IKEBP15  EQU   0
IKEBP31  EQU   0
IKEBP8   EQU   0
DHSMAPTR EQU   0
DHRETDTA EQU   0
DHFSTCLL EQU   0
DHTRACE  EQU   0
DHSMFHDR EQU   0
DHTCBADR EQU   0
DHINTSRT EQU   0
DHINTDAT EQU   0
DHINTLEN EQU   0
STSMB    EQU   STSMOPT
@NM00004 EQU   STSMB+3
STSMDEVF EQU   @NM00004
STSMC    EQU   STSMOPT
@NM00006 EQU   STSMC+3
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
STSMWKLD EQU   @NM00006
@NM00007 EQU   @NM00006
@NM00005 EQU   STSMC
STSMCRDR EQU   STSMDEVF
STSMUNIT EQU   STSMDEVF
STSMGRAP EQU   STSMDEVF
STSMDA   EQU   STSMDEVF
STSMTP   EQU   STSMDEVF
STSMTAPE EQU   STSMDEVF
@NM00003 EQU   STSMB
STSGLEN  EQU   STSGFREE+1
STSGSP   EQU   STSGFREE
STRVNPRT EQU   STRVT+4
STRVSPRT EQU   STRVT
@NM00008 EQU   SMF73FG2
SMF73RV2 EQU   SMF73A+6
SMF73RLS EQU   SMFRCD73+44
SMF73RV1 EQU   SMFRCD73+42
SMF73MFV EQU   SMFRCD73+40
SMF73SUB EQU   SMFRCD73+34
SMF73CYC EQU   SMFRCD73+32
SMF73SID EQU   SMFRCD73+14
SMF73DTE EQU   SMFRCD73+10
SMF73TME EQU   SMFRCD73+6
SMF73FLG EQU   SMFRCD73+4
SMF73SEG EQU   SMFRCD73+2
ECCDLSIO EQU   ECCDB+6
ECCDCMOD EQU   ECCDCHID
ECCDRS02 EQU   ECCDB+1
ECCDRS01 EQU   ECCDFLGS
ECCPRS02 EQU   ECCPE+1
ECCPVALD EQU   ECCPFLGS
ECCPRS01 EQU   ECCPFLGS
ECCECCHK EQU   ECCEDT+12
ECCERS01 EQU   ECCEDT+4
STSMRSV1 EQU   STSMA+53
STSMLCOM EQU   STSMA+48
STSMISP  EQU   STSMIGMC
STSMINTP EQU   STSMA+20
STSMTERM EQU   STSMA+12
STSMINIT EQU   STSMA+4
STSMSTA  EQU   STSMOFLG
@NM00002 EQU   STSMOFLG
@NM00001 EQU   STSMOPT
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00065 EQU   DHLAB2
@RT00127 EQU   @EL00001
@ENDDATA EQU   *
         END   IRBMFDHP,(C'PL/S-II',0502,74087)

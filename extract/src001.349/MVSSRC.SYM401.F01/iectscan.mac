         TITLE 'IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)   *
                        '
IECTSCAN CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'IECTSCAN  77.006'                                 0001
         DROP  @15
@PROLOG  ST    @14,12(,@13)                                        0001
         STM   @01,@12,24(@13)                                     0001
         BALR  @11,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@11                                         0001
         LR    9,1
*/**************************************************************/  0032
*/**************************************************************/  0032
*/*                                                            */  0032
*/*                                                            */  0032
*/* SCAN INITIAL HOUSKEEPING - THE FOLLOWING CODE SETS UP      */  0032
*/*     ADDRESSABILITY FOR THE SOURCE AREA, THE SINK AREA,     */  0032
*/*     ESTABLISHES WHETHER THE DEVICE IS REMOTE AND SETS      */  0032
*/*     RMTDV (DACFLG, BIT 7) ON IF IT IS REMOTE. IF THE       */  0032
*/*     DEVICE IS REMOTE THE SOURCE IS CHECKED FOR AN STX,     */  0032
*/*     AND IF PRESENT STXHER (DACFLG, BIT 6) IS SET ON        */  0032
*/*     AND THE STX PLACED IN THE SINK. LAST, IT IS            */  0032
*/*     DETERMINED WHETHER THIS IS A READ OR A WRITE OP,       */  0032
*/*     AND CONTROL IS PASSED TO SUBROUTINE READ OR WRITE.     */  0032
*/*                                                            */  0032
*/**************************************************************/  0032
*/**************************************************************/  0032
*           SINKAD = DACSINAD;        /*SINK ADDRESSABILIT     */  0032
         L     SINKAD,DACSINAD(,DACAD)                             0032
*           SOURAD = DACSRCAD;        /*SOURCE ADDRESSABIL     */  0033
         L     SOURAD,DACSRCAD(,DACAD)                             0033
*           IF SOURCE(DACSRCLN) = '03'X /*LAST CHARACTER ETX ? */  0034
*               THEN                  /*SET REMOTE FLAG ON     */  0034
         LH    @12,DACSRCLN(,DACAD)                                0034
         ALR   @12,SOURAD                                          0034
         BCTR  @12,0                                               0034
         CLI   SOURCE(@12),X'03'                                   0034
         BNE   @RF00034                                            0034
*                 DO;                 /*AND                    */  0035
*/**************************************************************/  0036
*/*                                                            */  0036
*/* BACKGO     FROM      WRTETX, RDETX                         */  0036
*/*      REPROCESS DATA STREAM AS REMOTE, ETX ENCOUNTERED AND  */  0036
*/* RMTDV IN DACFLG (BIT 7) WAS NOT ON                         */  0036
*/**************************************************************/  0036
*BACKGO:              RMTDV = '1'B;   /*TEST TO SEE IF AN      */  0036
BACKGO   OI    RMTDV(DACAD),B'00000001'                            0036
*                     DACIND = '02'X;                              0037
         MVI   DACIND(DACAD),X'02'                                 0037
*                     IF SOURCE(1) = '02'X /*IS STX FIRST ?    */  0038
*                         THEN        /*CHAR IN DATA STRM      */  0038
         CLI   SOURCE(SOURAD),X'02'                                0038
         BNE   @RF00038                                            0038
*                           DO;       /*SET STXHER ON AND      */  0039
*                               SOURAD = SOURAD + 1;               0040
         AH    SOURAD,@CH00061                                     0040
*                                     /*INCREMENT SOURCE POINTR*/  0041
*/**************************************************************/  0041
*/*                                                            */  0041
*/* STXPLUG    FROM     STXPLUG                                */  0041
*/*      INSERT AN STX IN THE SINK                             */  0041
*/**************************************************************/  0041
*                              STXHER = '1'B; /*MOVE STX       */  0041
         OI    STXHER(DACAD),B'00000010'                           0041
*                               DACIND = '03'X;                    0042
         MVI   DACIND(DACAD),X'03'                                 0042
*                                     /*SET INDICATOR BYTE     */  0043
*STXPLUG:;                                                         0043
STXPLUG  DS    0H                                                  0044
*                               SINK(1) = '02'X;                   0044
         MVI   SINK(SINKAD),X'02'                                  0044
*                                     /*FROM SOURCE TO SIN     */  0045
*                              SINKAD = SINKAD + 1;                0045
         AH    SINKAD,@CH00061                                     0045
*                                     /*INCREMENT SINK PTR     */  0046
*                           END;      /*IF NO STX              */  0046
*                ELSE                                              0047
*                     GO TO STXPLUG;  /*SET AN STX             */  0047
*                 END;                /*IF NO ETX OR ETB       */  0048
*               ELSE;                 /*RMTDX NOT SET ON       */  0049
@RF00034 DS    0H                                                  0050
*           IF RMTDV = '1'B                                        0050
*                THEN                                              0050
         TM    RMTDV(DACAD),B'00000001'                            0050
         BNO   @RF00050                                            0050
*                  DO;                                             0051
*                     GEN  REFS(DACAD) SETS(DACIND,SPECAR) SEQFLOW ;
         SR    SPECAR,SPECAR
         IC    SPECAR,DACIND(DACAD)                     Y02947
         AH    SPECAR,HAF3
         STC   SPECAR,DACIND(DACAD)                     Y02947
*                  END;                                            0053
*                ELSE DACIND = '03'X;                              0054
         B     @RC00050                                            0054
@RF00050 MVI   DACIND(DACAD),X'03'                                 0054
*           GEN REFS(DACOPTYP,DACAD) FLOWS(READ) SEQFLOW  /*Y02947*/ ;
@RC00050 DS    0H                                                  0055
         TM    DACOPTYP(DACAD),X'07'         IS IT A READ OPTYPE
         BNZ   READ                  YES GO TO READ, NO FALL
*           GEN;                                                   0056
         EJECT
*/*     FOLLOWING ARE THE FLOW CHARTING STATEMENTS FOR THE     */  0057
*/*     PRECEDING CODE:                                        */  0057
*/*IECTSCAN: CHART                                             */  0057
*/* HEADER                                                         0057
*/*        IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)    0057
*/*                                            PAGE #          */  0057
*/*IECTSCAN:     E SCAN ENTRY (AND ENTRY - INITIAL                 0057
*/*                HOUSEKEEPING)                               */  0057
*/*              P ESTABLISH SINK, SOURCE, AND DACA                0057
*/*                ADDRESSABILITY                              */  0057
*/*              D (NO,%RMTDV,YES,) IS ETX LAST                    0057
*/*                CHARACTER IN SOURCE ?                       */  0057
*/*BACKGO:       P SET RMTDV ON, SET DACIND TO '02'X           */  0057
*/*              D (NO,STXPLUG,YES,) IS STX FIRST                  0057
*/*                CHARACTER IN SOURCE ?                       */  0057
*/*              P BUMP SOURCE ONE                             */  0057
*/*STXPLUG:      P SET STXHER ON, SET DACIND TO '03'X, MOVE        0057
*/*                STX TO SINK, BUMP SINK                      */  0057
*/*%RMTDV:       D (NO,%NORMTDV,YES,) IS RMTDV ON ?            */  0057
*/*              P (,%WHATOP) ADD THREE TO DACIND              */  0057
*/*%NORMTDV:     P SET DACIND TO THREE                         */  0057
*/*%WHATOP:      D (RD,READ,WR,WRITE) IS IT A READ OR A WRITE      0057
*/*                OPERATION ?                                 */  0057
*        GEN;                                                      0057
         EJECT
*/**************************************************************/  0058
*/**************************************************************/  0058
*/*                                                            */  0058
*/*                                                            */  0058
*/* WRITE MAJOR ENTRY FROM HOUSEKEEPING TO PROCESS ALL         */  0058
*/*      OUTPUT DATA STREAMS. THIS INITIAL CODE PERFORMS       */  0058
*/*      THOSE HOUSEKEEPING FUNCTIONS SPECIFICALLY RELATED     */  0058
*/*      TO OUTPUT DATA STREAMS. IT INSERTS THE OPENING        */  0058
*/*      ORDERS AND CONTROL NESSECARY FOR THE 3270. THE        */  0058
*/*      INSERTIONS ARE BASED UPON THE CONDITION OF RMTDV      */  0058
*/*      (DACFLG, BIT 7) AND DACOPTYP (WHICH TYPE OF WRITE     */  0058
*/*      OPERATION TO BE DEALT WITH).                          */  0058
*/*       THIS SECTION ALSO MAKE THE DETERMINATION TO (AND     */  0058
*/*      INSERTS IF NEEDED) PLACE ORDER TO NULL AN             */  0058
*/*      EXISTING START OF MESSAGE ON THE 3270 SCREEN IN       */  0058
*/*      THE DATA STREAM. THIS IS BASED ON THE CONDITION       */  0058
*/*      OF SHRD (DACFLAG, BIT 1) AND DACSOMAD (ALL ONES       */  0058
*/*      OR A VALID ADDRESS). THE SCREEN IS SET TO BLANKS      */  0058
*/*      IF RVOID = NO WAS SPECIFIED ON A WRITE ERASE (IE:     */  0058
*/*      DACFLG, BIT 0 SET TO 0). CONTROL IS THEN PASSED       */  0058
*/*      TO WRITENT.                                           */  0058
*/*                                                            */  0058
*/**************************************************************/  0058
*/**************************************************************/  0058
*WRITE:;                              /*ENTRY FOR OUTPUTS      */  0058
WRITE    DS    0H                                                  0059
*           IF RMTDV = '1'B           /*IS IT REMOTE           */  0059
*                THEN                 /*YES, PUT ESCAPE        */  0059
         TM    RMTDV(DACAD),B'00000001'                            0059
         BNO   @RF00059                                            0059
*                  DO;                /*SEQUENCE IN SINK       */  0060
*                     SINK(1) = '27'X; /*AND INCREMENT THE     */  0061
         MVI   SINK(SINKAD),X'27'                                  0061
*                     SINKAD = SINKAD + 1; /*SINK PTR          */  0062
         LA    @12,1                                               0062
         ALR   SINKAD,@12                                          0062
*                     IF EWR = '1'B   /*ERASE WRITE ?          */  0063
*                          THEN       /*YES, PUT COMMAND       */  0063
         TM    EWR(DACAD),B'00001000'                              0063
         BNO   @RF00063                                            0063
*                            DO;      /*CODE OF 5 IN SINK      */  0064
*                               SINK(1) = 'F5'X; /*INCREMENT   */  0065
         MVI   SINK(SINKAD),X'F5'                                  0065
*                               SINKAD = SINKAD + 1;               0066
         ALR   SINKAD,@12                                          0066
*/**************************************************************/  0067
*/*                                                            */  0067
*/* REMTEWR    FROM      RTASET                                */  0067
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR AN ERASE  */  0067
*/* WRITE OPERATION TYPE                                       */  0067
*/**************************************************************/  0067
*REMTEWR:;                            /*THE SINK PTR           */  0067
REMTEWR  DS    0H                                                  0068
*           GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/ ;
         SR    SPECAR,SPECAR          CLEAR A WORK REG
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE
         SRL   SPECAR,6               MAKE AN ARGUMENT
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT
*                               SINK(1) = WCCTAB(SPECAR);          0069
         LA    @12,WCCTAB-1(SPECAR)                                0069
         MVC   SINK(1,SINKAD),0(@12)                               0069
*                                     /* PUT WCC               */  0070
*                                     /*IN THE SINK AND        */  0070
*                               SINKAD = SINKAD + 1;               0070
         AH    SINKAD,@CH00061                                     0070
*                                     /*INCREMENT THE SINK     */  0071
*/**************************************************************/  0071
*/*                                                            */  0071
*/* RTASET     FROM      (NO REFERENCES)                       */  0071
*/*      REPEAT TO ADDRESS ORDER INSERTION, TO CLEAR SCREEN    */  0071
*/* TO BLANKS IF RVOID = NO                                    */  0071
*/**************************************************************/  0071
*RTASET:;                             /*NULL OR BLANK SCREEN ? */  0071
RTASET   DS    0H                                                  0072
*                               IF RVOID = '1'B /*NULL ?       */  0072
*                                    THEN GO TO WRITENT;           0072
         TM    RVOID(DACAD),B'10000000'                            0072
         BO    @RT00072                                            0072
*                                     /*ALREADY NULLS          */  0074
*                                    ELSE; /*SET UP TO         */  0074
*           GEN SETS(REG0,SPECAR) REFS(BLNK,BUILDEND) SEQFLOW      0075
*                                       /*Y02947*/   ;             0075
         SR    REG0,REG0
         IC    REG0,BLNK
         LA    SPECAR,BUILDEND
*RTABUILD:;                                                        0076
RTABUILD DS    0H                                                  0077
*           GEN REFS(DACDSSCR,ANWIDE,ANLINE,REG0,DACOPTYP)         0077
*             SETS(WORKREG1,WORKREG2,WORKREG3,WORKREG4,CURSAD)     0077
*                FLOWS(BUILDEND,WITCH4)                  /*02947*/  ;
         LA    WORKREG1,480                  GET MAX RTA LENGTH
         SR    WORKREG2,WORKREG2              CLEAR A WORK REGISTER
         IC    WORKREG2,DSLINE(DACAD)       PICK UP 2260 LINE COUNT
         SR    WORKREG4,WORKREG4             CLEAR A WORK REGISTER
         IC    WORKREG4,ANWIDE(DACAD)            PICK UP 3270 WIDTH
         SR    WORKREG3,WORKREG3              CLEAR A WORK REGISTER
         IC    WORKREG3,ANLINE(DACAD)         PICK UP 3270 LINE COUNT
         SR    CURSAD,CURSAD           CLEAR CURSOR FOR SET UP
         LTR   REG0,REG0                     RTA TO END OF 3270 ?
         BNZ   UPPER                   NO, THEN BLANK 2260
         SR    WORKREG3,WORKREG2              GET EXCESS LINE COUNT
         B     CALC1                   GO SEE HOW MUCH TO RTA
UPPER    EQU   *                       WANTS TO BLANK 2260
         LR    WORKREG3,WORKREG2       GET 2260 LINE COUNT
CALC1    EQU   *                       COMPUTE RTA COUNT
         MR    WORKREG4,WORKREG4           LINES TIMES WIDTH
         LTR   REG0,REG0               RTA 2260 SCREEN TO BLANK ?
         BNZ   CALC2                   YES, GO FIGURE NUMBER RTAS
         TM    DACOPTYP(DACAD),X'40'   PROT = YES SPECIFIED ?
         BNO   CALC2                   NO, GO FIGURE NUMBER RTAS
         BCTR  WORKREG3,0              REDUCE COUNT FOR ATTRIBUTE
CALC2    EQU   *                       FIGURE NUMBER OF RTAS
         SR    WORKREG4,WORKREG4       CLEAR HIGH HALF OF DIVIDEND
         DR    WORKREG4,WORKREG1           480 INTO COUNT
         LR    WORKREG1,WORKREG4           SAVE THE REMAINDER
         LR    WORKREG2,WORKREG3                   SAVE THE QUOTIENT
         LTR   REG0,REG0               RTA TO END OF 3270 ?
         BNZ   UPHLF                   NO, GO SET TO BLNK 2260
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER
         IC    WORKREG4,DSLINE(DACAD)    PICK 2260 LINE COUNT
         SR    WORKREG3,WORKREG3       CLEAR A WORK REGISTER
         IC    WORKREG3,ANWIDE(DACAD)  PICK UP 3270 WIDTH
         MR    WORKREG4,WORKREG4           GET END OF 2260 IN BUFFER
         BCTR  WORKREG3,0              ACCOUNT FOR FIRST POS 0  YA01253
         LR    CURSAD,WORKREG3         SAVE FINAL RTA ADDRESS
         B     LOWHLF                  GO PREPARE TO NULL 3270
UPHLF    EQU   *                       WANTS TO BLANK 2260
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?
         BNZ   PAT                     YES, GENERATE RTAS
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?
         BZ    RETBCK                  NO, RETURN TO CALLER
         AR    CURSAD,WORKREG1         YES, BUMP THE CURSOR
         B     SETORD                  GO DO ONE RTA
LOWHLF   EQU   *                       WANTS TO NULL 3270
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?
         BNZ   ONTST                   YES, CONTINUE SET UP
         SR    CURSAD,CURSAD           RTA ADDRESS TO BUFFER ZERO
         B     SETORD                  GO DO ONE RTA TO ZERO
ONTST    EQU   *                       MORE THAN 480 AT BOTTOM
         BCT   WORKREG2,UPPIT          MORE THAN 960 GO TO UPPIT
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?
         BNZ   UPPITY                  YES, CONTINUE SET UP
         SR    CURSAD,CURSAD           SET ADDRESS TO BUFFER ZERO
         B     SETORD                  GO DO ONE RTA TO ZERO
UPPIT    EQU   *                       960 OR MORE TO DO AT BOTTOM
         LTR   WORKREG1,WORKREG1       ODD COUNT REMAINING ?
         BZ    PAT                     NO, GO DO RTAS
UPPITY   EQU   *                       480 + TO DO AT BOTTOM
         LA    WORKREG2,1(WORKREG2)    PUT RTA COUNT BACK
PAT      EQU   *                       INITIAL ENTRY TO LOOP
         LA    WORKREG2,1(WORKREG2)    BUMP COUNT FOR LOOP
RAT      EQU   *                       LOOP ITERATION ENTRY
         BCT   WORKREG2,LOOP           MORE 480 BYTE RTAS TO DO ?
         B     LOOPDONE                NO, DO FINAL SET UP
LOOP     EQU   *                       CONSTRUCT RTA SEQUENCES
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)
*                                    ARE THE SCREENS EQUAL  ?   YA01253
         BNE   LOOP1                   NO, GO SET UP RTA        YA01253
         LTR   WORKREG1,WORKREG1       MORE RTAS AFTER THIS ?   YA01253
         BNZ   LOOP1                   YES, GO SET UP RTA       YA01253
         C     WORKREG2,ONE            MORE RTAS AFTER THIS ?   YA01253
         BH    LOOP1                   YES, GO SET UP RTA       YA01253
         XR    CURSAD,CURSAD           CURSOR AT ZERO          @YA02151
         B     SETORD                  DO RTA TO ZERO           YA01253
LOOP1    EQU   *                                                YA01253
         LA    CURSAD,480(CURSAD)      SET RTA ADDRESS
SETORD   EQU   *                       ENTRY FOR SINGLE RTA
*                                      REG 12 MUST BE ZERO
         MVI   0(SINKAD),X'3C'         INSERT RTA ORDER IN SINK
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER
         BAL   CARADD,OUTVERT          GO COMPUTE ADDRESS IN 3270
         SR    CARADD,CARADD           CLEAR LINK REG
         STC   REG0,0(SINKAD)          PUT REPEATED CHARACTER
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER
         LTR   WORKREG2,WORKREG2       LOOP COUNTER AT ZERO ?
         BNZ   RAT                     NO, STAY IN LOOP
RETBCK   EQU   *                       RETURN TO CALLER
         BR    SPECAR                  GO TO ADDRESS IN SPECAR
LOOPDONE EQU   *                       ALL 480 BYTE RTAS DONE
         LTR   REG0,REG0               DOING 2260 SCREEN ?
         BZ    LOWHLF                  NO, GO SEE IF MORE AT BOTTOM
         B     UPHLF                   YES, GO SEE IF MORE 2260
*BUILDEND:;                                                        0078
BUILDEND DS    0H                                                  0079
*                               SINK(1) = '11'X;                   0079
         MVI   SINK(SINKAD),X'11'                                  0079
*                                     /*SET BUFFER TO FRST     */  0080
*                               SINKAD = SINKAD + 1;               0080
         AH    SINKAD,@CH00061                                     0080
*                                     /*OF 3270 SCREEN         */  0081
*                               SINK(1) = '40'X;                   0081
         MVI   SINK(SINKAD),X'40'                                  0081
*                               SINK(2) = '40'X;                   0082
         MVI   SINK+1(SINKAD),X'40'                                0082
*                               SINKAD = SINKAD + 2;               0083
         AH    SINKAD,@CH00059                                     0083
*                               DACSOMAD = ALLONE;                 0084
         MVC   DACSOMAD(2,DACAD),ALLONE                            0084
*                                     /*SET NO SOM INDICAT     */  0085
*                               GO TO WRITENT;                     0085
         B     WRITENT                                             0085
*                            END;                                  0086
*                          ELSE       /*IF NOT ERASE WRITE     */  0087
*                            DO;      /*PLUG COMMAND CODE      */  0087
@RF00063 DS    0H                                                  0088
*                               SINK(1) = 'F1'X; /* OF ONE     */  0088
         MVI   SINK(SINKAD),X'F1'                                  0088
*                               SINKAD = SINKAD + 1;               0089
         AH    SINKAD,@CH00061                                     0089
*                                     /*INCREMENT SINK PTR     */  0090
*                               GO TO LOCLWR;                      0090
         B     LOCLWR                                              0090
*                            END;                                  0091
*                  END;                                            0092
*                ELSE;                                             0093
@RF00059 DS    0H                                                  0094
*           IF EWR = '1'B             /*IS IT ERASE WRITE      */  0094
*                THEN GO TO REMTEWR;  /*PROCESS IT             */  0094
         TM    EWR(DACAD),B'00001000'                              0094
         BO    @RT00094                                            0094
*                ELSE;                /*NO, SET NORMAL         */  0096
*/**************************************************************/  0097
*/*                                                            */  0097
*/* LOCLWR     FROM      RTASET                                */  0097
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR WRITE TO  */  0097
*/* CURSOR, WRITE TO LINE ADDRESS OPERATION TYPES              */  0097
*/**************************************************************/  0097
*LOCLWR:;                             /*NOT ERASE WRITE        */  0097
LOCLWR   DS    0H                                                  0098
*           GEN SETS(SPECAR) REFS(DACAD,ANWIDE) SEQFLOW  /*Y02947*/ ;
         SR    SPECAR,SPECAR          CLEAR A WORK REG
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE
         SRL   SPECAR,6               MAKE AN ARGUMENT
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT
*           SINK(1) = WCCTAB(SPECAR); /* PUT WCC IN SINK       */  0099
         LA    @12,WCCTAB-1(SPECAR)                                0099
         MVC   SINK(1,SINKAD),0(@12)                               0099
*           SINKAD = SINKAD + 1;      /*INCREMENT SINK PTR     */  0100
         LA    @12,1                                               0100
         ALR   SINKAD,@12                                          0100
*           IF SHRD = '0'B            /*LAST READ NOT SHOR     */  0101
*           & DACSOMAD ^= ALLONE      /*AND SOM PRESENT        */  0101
*                THEN                 /*THEN SET UP TO         */  0101
         TM    SHRD(DACAD),B'01000000'                             0101
         BNZ   @RF00101                                            0101
         LH    @10,DACSOMAD(,DACAD)                                0101
         CH    @10,ALLONE                                          0101
         BE    @RF00101                                            0101
*                  DO;                /*NULL PREVIOUS SOM      */  0102
*                     SINK(1) = '11'X; /* ON 3270 SCREEN       */  0103
         MVI   SINK(SINKAD),X'11'                                  0103
*                     SINKAD = SINKAD + 1;                         0104
         ALR   SINKAD,@12                                          0104
*                                     /*INCREMENT SINK PTR     */  0105
*                     CURSAD = DACSOMAD;                           0105
         LR    CURSAD,@10                                          0105
*                                     /*PICK UP SOM PTR        */  0106
*                     GEN;                                         0106
         BAL   CARADD,OUTVERT         AND CONVERT TO 3270
*                     SINK(1) = '40'X;                             0107
         MVI   SINK(SINKAD),X'40'                                  0107
*                     SINKAD = SINKAD + 1;                         0108
         LA    @12,1                                               0108
         ALR   SINKAD,@12                                          0108
*                                     /*INCREMENT SINK PTR     */  0109
*                     SINK(1) = '11'X; /* PREPARE FOR DATA     */  0109
         MVI   SINK(SINKAD),X'11'                                  0109
*                     SINKAD = SINKAD + 1;                         0110
         ALR   SINKAD,@12                                          0110
*                                     /*INCREMENT SINK PTR     */  0111
*                  END;                                            0111
*                ELSE                 /*IF NO NEED TO CLER     */  0112
*                  DO;                /*SOM, THEN PREPARE      */  0112
         B     @RC00101                                            0112
@RF00101 DS    0H                                                  0113
*                     SINK(1) = '11'X; /* FOR DATA             */  0113
         MVI   SINK(SINKAD),X'11'                                  0113
*                     SINKAD = SINKAD + 1;                         0114
         AH    SINKAD,@CH00061                                     0114
*                                     /*INCREMENT SINK PTR     */  0115
*                  END;                                            0115
*           GEN;                                                   0116
@RC00101 DS    0H                                                  0116
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0117
*/*     PRECEDING CODE -                                       */  0117
*/*WRITE:        D (NO,%NOTRMT,YES,) IS RMTDV ON ?             */  0117
*/*              P PUT ESCAPE BYTE IN SINK, BUMP SINK          */  0117
*/*              D (NO,%NOTEWR,YES,) IS THIS AN ERASE WRITE        0117
*/*                OPERATION ?                                 */  0117
*/*              P PUT COMMAND CODE OF FIVE IN SINK, BUMP          0117
*/*                SINK                                        */  0117
*/*REMTEWR:      P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117
*/*                SINK                                        */  0117
*/*RTASET:       D (YES,WRITENT,NO,) IS RVOID = YES SPECIFIED ?*/  0117
*/*              S RTABUILD:BUILD RTA(S) TO BLANK 2260 SCREEN  */  0117
*/*RTABUILD: CHART                                             */  0117
*/*RTABUILD:     E CONSTRUCT RTA ORDERS                        */  0117
*/*              P SET UP WORK REGISTERS                       */  0117
*/*              D (YES,UPPER,NO,) RTA FOR 2260 PORTION ?      */  0117
*/*              P (,CALC1) SET TO COMPUTE 3270 PORTION        */  0117
*/*UPPER:        P SET TO COMPUTE 2260 PORTION                 */  0117
*/*CALC1:        P COMPUTE TOTAL BYTES SPANNED BY RTA          */  0117
*/*              D (YES,CALC2,NO,) RTA FOR 2260 PORTION ?      */  0117
*/*              D (NO,CALC2,YES,) PROT = YES ?                */  0117
*/*              P MODIFY RTA SPAN MINUS ONE                   */  0117
*/*CALC2:        P COMPUTE NUMBER OF RTAS NEEDED               */  0117
*/*              D (YES,UPHLF,NO,) RTA FOR 2260 PORTION ?      */  0117
*/*              P COMPUTE ADDRESS OF END OF 2260 PORTION      */  0117
*/*              P (,LOWHLF) SAVE ADDRESS IN CURSAD            */  0117
*/*UPHLF:        D (YES,PAT,NO,) AT LEAST ONE 480 BYTE RTA ?   */  0117
*/*              D (NO,RETBCK,YES,) ANY REMAINDER ?            */  0117
*/*              P (,SETORD) BUMP THE CURSOR BY THE REMAINDER  */  0117
*/*LOWHLF:       D (YES,ONTST,NO,) AT LEAST ONE 480 BYTE RTA ? */  0117
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117
*/*ONTST:        D (YES,UPPIT,NO,) AT LEAST TWO 480 BYTE RTAS ?*/  0117
*/*              D (YES,UPPITY,NO,) ANY REMAINDER ?            */  0117
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117
*/*UPPIT:        D (NO,PAT,YES,) ANY REMAINDER ?               */  0117
*/*UPPITY:       P MODIFY COUNT OF 480 BYTE RTAS               */  0117
*/*PAT:          P BUMP RTA COUNT TO COMPENSATE LOOP           */  0117
*/*RAT:          D (NO,LOOPDONE,YES,) RTA COUNT > ONE ?        */  0117
*/*LOOP:         P BUMP ADDRESS IN CURSAD BY 480               */  0117
*/*SETORD:       P PUT RTA IN SINK, BUMP SINK                  */  0117
*/*              S OUTVERT:CONVERT HEXADECIMAL TO 3270 BUFFER  */  0117
*/*              P PUT CHARACTER IN SINK, BUMP SINK            */  0117
*/*              D (YES,RAT,NO,) ANY 480 BYTE RTAS LEFT ?      */  0117
*/*RETBCK:       R BRANCH ON SPECAR                            */  0117
*/*LOOPDONE:     D (YES,UPHLF,NO,LOWHLF) RTA FOR 2260 PORTION ?*/  0117
*/*RTABUILD: END                                               */  0117
*/*IECTSCAN: CHART                                             */  0117
*/*BUILDEND:     P PUT A SET BUFFER ADDRESS ORDER IN SINK,         0117
*/*                BUMP SINK                                   */  0117
*/*              P (,WRITENT) PUT 3270 BUFFER ADDRESS ZERO         0117
*/*                IN SINK, BUMP SINK TWO, DACSOMAD =              0117
*/*                ALLONES                                     */  0117
*/*%NOTEWR:      P (,LOCLWR) PUT COMMAND CODE ONE IN SINK,         0117
*/*                BUMP SINK                                   */  0117
*/*%NOTRMT:      D (YES,REMTEWR,NO,) IS THIS ERASE WRITE           0117
*/*                OPERATION ?                                 */  0117
*/*LOCLWR:       P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117
*/*                SINK                                        */  0117
*/*              D (NO,%NOSOM,YES,) IS AN SOM ON THE SCREEN        0117
*/*                ?                                           */  0117
*/*              P PUT SET BUFFER ADDRESS ORDER IN SINK,           0117
*/*                BUMP SINK, PICK UP SOM POINTER              */  0117
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0117
*/*              P PUT A BLANK IN THE SINK, BUMP THE SINK      */  0117
*/*              P (,WRITENT) PUT A SET BUFFER ADDRESS ORDER       0117
*/*                IN THE SINK, BUMP THE SINK                  */  0117
*/*%NOSOM:       P PUT A SET BUFFER ADDRESS ORDER IN THE           0117
*/*                SINK, BUMP THE SINK                         */  0117
*        GEN;                                                      0117
         EJECT
*/**************************************************************/  0118
*/**************************************************************/  0118
*/*                                                            */  0118
*/*                                                            */  0118
*/* WRITENT ENTRY PROCESSING FOR ALL OUTPUT DATA STREAMS.      */  0118
*/*      THIS CODE ESTABLISHES THE CURRENT 2260 LINE           */  0118
*/*      (MAINTAINED IN REGISTER CURLIN), THE CURRENT 2260     */  0118
*/*      CURSOR POSITION (MAINTAINED IN REGISTER CURSAD),      */  0118
*/*      AND COMPUTES THE GROUP OF CHARACTERS IN THE           */  0118
*/*      SOURCE AREA TO BE INITIALLY DEALT WITH (KEPT IN       */  0118
*/*      REGISTER LINGRO), FOR THE VARIOUS OUTPUT OP TYPES     */  0118
*/*       FOR WRITE TO CURSOR AND WRITE TO LINE ADDRESS,       */  0118
*/*      THE 3270 BUFFER POSITION OF THE FIRST CHARACTER       */  0118
*/*      POSITION IS INSERTED IN THE SINK FOLLOWING THE        */  0118
*/*      SBA PLACED THERE BY WRITE. FOR ERASE WRITE THE        */  0118
*/*      3270 BUFFER IS ALREADY AT POSITION ZERO.              */  0118
*/*       CONTROL IS PASSED TO WITCH1.                         */  0118
*/*                                                            */  0118
*/**************************************************************/  0118
*/**************************************************************/  0118
*WRITENT:;                                                         0118
WRITENT  DS    0H                                                  0119
*           IF EWR = '1'B             /*IS THIS ERASE WRIT     */  0119
*                THEN                 /*YES, ESTABLISH         */  0119
         TM    EWR(DACAD),B'00001000'                              0119
         BNO   @RF00119                                            0119
*                  DO;                /*INITIAL VALUES         */  0120
*                     CURLIN = CURLIN - CURLIN;                    0121
         SLR   CURLIN,CURLIN                                       0121
*                                     /*LINE # TO ZERO         */  0122
*                     CURSAD = CURSAD - CURSAD;                    0122
         SLR   CURSAD,CURSAD                                       0122
*                                     /*CURSOR TO ZERO         */  0123
*                     LINGRO = DSWIDE;/*GROUP TO 2260 LINE     */  0123
         SLR   LINGRO,LINGRO                                       0123
         IC    LINGRO,DSWIDE(,DACAD)                               0123
*                     GO TO WITCH1;   /*GO PROCESS DATA        */  0124
         B     WITCH1                                              0124
*                  END;               /*IF NOT ERASE WRITE     */  0125
*                ELSE;                /*IS IT WRITE TO         */  0126
@RF00119 DS    0H                                                  0127
*           IF WRCRS = '1'B           /*CURSOR                 */  0127
*                THEN                 /*YES, ESTABLISH         */  0127
         TM    WRCRS(DACAD),B'00100000'                            0127
         BNO   @RF00127                                            0127
*                  DO;                /*INITIAL VALUES         */  0128
*                     CURSAD = DACCRS;/*PICK UP CURSOR ADR     */  0129
         LH    CURSAD,DACCRS(,DACAD)                               0129
*                     SPECAR = ANWIDE;/*GET SCREEN WIDTH       */  0130
         SLR   SPECAR,SPECAR                                       0130
         IC    SPECAR,ANWIDE(,DACAD)                               0130
*/*  THE FOLLOWING 2 STATEMENTS ARE IN COMMENTS TO             */  0131
*/*  DOCUMENT THE FOLLOWING GENERATE                           */  0131
*/*                   CURLIN = CURSAD / SPECAR;                */  0131
*                                     /*DETERMINE LINE #       */  0131
*/*                   SPECAR = CURSAD // SPECAR;               */  0131
*           GEN SETS(WORKREG4,WORKREG3,CURLIN,SPECAR) REFS(CURSAD) 0131
*                                       SEQFLOW  /*Y02947*/ ;      0131
         LR    WORKREG4,CURSAD
         SRDA  WORKREG4,32
         DR    WORKREG4,SPECAR
         LR    CURLIN,WORKREG3
         LR    SPECAR,WORKREG4
*                                     /*CHECK TO SEE IF        */  0132
*                                     /*ANY EXCESS BEYOND      */  0132
*                     IF SPECAR = FULL0 /*LINE BOUNDRY         */  0132
*                          THEN       /* NO, SET GROUP TO      */  0132
         C     SPECAR,FULL0                                        0132
         BNE   @RF00132                                            0132
*                            DO;      /*2260 SCREEN WIDTH      */  0133
*                               LINGRO = DSWIDE;                   0134
         SLR   LINGRO,LINGRO                                       0134
         IC    LINGRO,DSWIDE(,DACAD)                               0134
*                               GO TO OP1;                         0135
         B     OP1                                                 0135
*                            END;     /*YES, SET GROUP TO      */  0136
*                          ELSE       /*REMAINDER OF LINE      */  0137
*                                  LINGRO = DSWIDE - SPECAR;       0137
@RF00132 SLR   LINGRO,LINGRO                                       0137
         IC    LINGRO,DSWIDE(,DACAD)                               0137
         SLR   LINGRO,SPECAR                                       0137
*                     GO TO OP1;      /*CURSOR TO 3270         */  0138
         B     OP1                                                 0138
*                  END;               /*NOT WRITE TO CURSR     */  0139
*                ELSE;                /*THEN MUST BE WRITE     */  0140
@RF00127 DS    0H                                                  0141
*           IF SOURCE(1) > 'FB'X × SOURCE(1) < 'F0'X               0141
*                THEN GO TO OUTERR;                                0141
         CLI   SOURCE(SOURAD),X'FB'                                0141
         BH    @RT00141                                            0141
         CLI   SOURCE(SOURAD),X'F0'                                0141
         BL    @RT00141                                            0141
*                ELSE;                                             0143
*           GEN SETS(CURLIN) REFS(SOURAD) SEQFLOW   /*Y02947*/  ;  0144
         SR    CURLIN,CURLIN
         IC    CURLIN,0(SOURAD)
         SLL   CURLIN,28           SHIFT OUT ZONES             @YA02150
         SRL   CURLIN,28           REPOSITION VALUE            @YA02150
*           SPECAR = ANWIDE;          /*GET 3270  WIDTH        */  0145
         SLR   SPECAR,SPECAR                                       0145
         IC    SPECAR,ANWIDE(,DACAD)                               0145
*           CURSAD = CURLIN * SPECAR; /*CALCULATE BUFFER       */  0146
         LR    @15,SPECAR                                          0146
         MR    @14,CURLIN                                          0146
         LR    CURSAD,@15                                          0146
*                                     /*POSITION OF LINE       */  0147
*           SOURAD = SOURAD + 1;      /*INCREMENT SOURCE       */  0147
         AH    SOURAD,@CH00061                                     0147
*           LINGRO = DSWIDE;          /*GROUP TO 2260 LINE     */  0148
         SLR   LINGRO,LINGRO                                       0148
         IC    LINGRO,DSWIDE(,DACAD)                               0148
*/**************************************************************/  0149
*/*                                                            */  0149
*/* OP1        FROM      WRITENT                               */  0149
*/*      INVOKE OUTVERT TO CALCULATE 3270 BUFFER POSITION FOR  */  0149
*/* BEGINNING OF WRITE OPERATION                               */  0149
*/**************************************************************/  0149
*OP1:;                                /*USE OUTVERT ROUTNE     */  0149
OP1      DS    0H                                                  0150
*           GEN;                                                   0150
         BAL   CARADD,OUTVERT         TO CALCULATE BUFFER
*                                     /*POSITION               */  0151
*        GO TO WITCH1;                /*GO PROCESS DATA        */  0151
         B     WITCH1                                              0151
*           GEN ;                                                  0152
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0153
*/*     PRECEDING CODE -                                       */  0153
*/*WRITENT:      D (NO,%EWRNOT,YES,) IS THIS AN ERASE WRITE        0153
*/*                OPERATION ?                                 */  0153
*/*              P (,WITCH1) CLEAR CURLIN, CURSAD,SET LINGRO TO    0153
*/*                2260 SCREEN WIDTH                           */  0153
*/*%EWRNOT:      D (YES,%WLA,NO,) IS THIS A WRITE TO LINE          0153
*/*                ADDRESS OPERATION ?                         */  0153
*/*              P PICK UP CURSOR FROM DACCRS, GET 3270            0153
*/*                SCREEN WIDTH, FIGURE LINE NUMBER            */  0153
*/*              D (YES,%LINBDY,NO,) EXCESS BEYOND LINE            0153
*/*                BOUNDRY ?                                   */  0153
*/*              P (,OP1) SET LINGRO TO 2260 SCREEN WIDTH      */  0153
*/*%LINBDY:      P (,OP1) SET LINGRO TO REMAINDER OF 2260          0153
*/*                LINE                                        */  0153
*/*%WLA:         D (YES,%OK,NO,OUTERR) LINE ADDRESS CHARACTER      0153
*/*                VALID ?                                     */  0153
*/*%OK:          P SET CURLIN TO LINE NUMBER, COMPUTE              0153
*/*                ADDRESS FROM LINE NUMBER                    */  0153
*/*OP1:          S (,WITCH1) OUTVERT: CONVERT HEXIDECIMAL TO       0153
*/*                3270 BUFFER                                 */  0153
*        GEN;                                                      0153
         EJECT
*/**************************************************************/  0154
*/**************************************************************/  0154
*/*                                                            */  0154
*/*                                                            */  0154
*/*WITCH INITIALIZATION, TERMINATION, AND DATA STREAM          */  0154
*/*    PROCESSING (NOT INVOLVING SPECIAL CHARACTERS) WHICH     */  0154
*/*    IS SPECIFICALLY RELATED TO THE DATA.                    */  0154
*/*    WITCH3, WITCH4, AND NOCHAR, WHICH ARE DESCRIBED         */  0154
*/*      WITCH CONTAINS FIVE SECTIONS, WITCH1, WITCH2,         */  0154
*/*    IN THE FOLLOWING TEXT -                                 */  0154
*/*                                                            */  0154
*/*    WITCH1 IS ENTERED FROM WRITENT, WITCH4, AND SETTLE      */  0154
*/*    (IN WRSPCHAR). WITCH1 VERIFIES THE SINK, IF TOO         */  0154
*/*    SMALL IT PASSES CONTROL TO OUTSINK, VERIFIES THE        */  0154
*/*    SIZE OF THE GROUP OF DATA UNDER CONSIDERATION (IN       */  0154
*/*    REGISTER LINGRO), IF ZERO IT PASSES CONTROL TO WIT.     */  0154
*/*    THE PRIME FUNCTION OF WITCH1 IS TO SEARCH FOR           */  0154
*/*    CERTAIN CHARACTERS WHICH REQUIRE UNIQUE PROCESSING.     */  0154
*/*    THIS IS ACCOMPLISHED BY EXECUTING A TRANSLATE AND       */  0154
*/*    TEST (XLATE) AGAINST THE DATA GROUP USING TABLE.        */  0154
*/*    THE SECONDARY FUNCTION IS TO MOVE ALL CHARACTERS        */  0154
*/*    WHICH ARE NOT FOUND BY XLATE TO THE SINK AREA. IF       */  0154
*/*    A UNIQUE CHARACTER IS DISCOVERED, ONLY THOSE            */  0154
*/*    CHARACTERS PRECEDING IT IN THE DATA GROUP ARE MOVED     */  0154
*/*    TO THE SINK AREA, AND SPECIAL PROCESSING TAKES          */  0154
*/*    FOR THE SELECTED CHARACTER. A BRANCH IS MADE INTO       */  0154
*/*    WRSPCHAR TO ACCOMPLICH THIS PROCESSING. THE BRANCH      */  0154
*/*    ADDRESS IS DETERMINED BY THE FUNCTION BYTE SELECTED     */  0154
*/*    FROM TABLE BY XLATE. IF NO SPECIAL PROCESSING IS        */  0154
*/*    NEEDED, CONTROL PASSES TO NOCHAR.                       */  0154
*/*                                                            */  0154
*/*    NOCHAR 7OVES THE ENTIRE DATA GROUP TO THE SINK,         */  0154
*/*    INCREMENTS THE SINK AND SOURCE POINTERS AND THE         */  0154
*/*    CURSOR, CHECKS TO SEE IF ALL OF THE DATA HAS BEEN       */  0154
*/*    PROCESSED AND PASSES CONTROL TO WIT IF IT HAS. IF       */  0154
*/*    MORE DATA REMAINS, CONTROL IS PASSED TO WITCH2.         */  0154
*/*                                                            */  0154
*/*    WITCH2 INCREMENTS THE CURRENT LINE AND TESTS FOR        */  0154
*/*    SCREEN WRAP. IF WRAP EXISTS, CONTROL IS PASSED TO       */  0154
*/*    WALL. IF WRAP DOES NOT EXIST, THE CURSOR IS             */  0154
*/*    ADJUSTED TO THE BEGINNING OF THE NEXT 3270 LINE.        */  0154
*/*    THE 2260 AND 3270 SCREENS ARE COMPARED AND IF NOT       */  0154
*/*    EQUAL CONTROL IS PASSED TO WITCH3. IF THE 2260 AND      */  0154
*/*    3270 SCREEN ARE EQUAL, CONTROL IS PASSED TO WITCH4.     */  0154
*/*    WITCH2 MAY BE ENTERED FROM NOCHAR, WRTNEWL (IN          */  0154
*/*    WRSPCHAR).                                              */  0154
*/*                                                            */  0154
*/*    WITCH3 INSERTS A REPEAT TO ADDRESS ORDER TO NULL        */  0154
*/*    THE EXCESS 3270 SCREEN OVER THE 2260 IMAGE. CONTROL     */  0154
*/*    PASSES TO WITCH4.                                       */  0154
*/*                                                            */  0154
*/*    WITCH4 SETS THE GROUPING TO EQUAL THE 2260 WIDTH.       */  0154
*/*    CONTROL IS PASSED TO WITCH1.                            */  0154
*/*                                                            */  0154
*/**************************************************************/  0154
*/**************************************************************/  0154
*WITCH1:    GEN SETS(DACSRCAD) REFS(DACAD) SEQFLOW  /*Y02947*/  ;  0154
WITCH1   DS    0H                                                  0154
         MVI   DACSRCAD(DACAD),X'00'   INSURE HIGH BYTE CLEAR   YA01252
*           IF DACSRCAD + DACSRCLN <= SOURAD + LINGRO              0155
*                THEN                                              0155
         LH    @12,DACSRCLN(,DACAD)                                0155
         AL    @12,DACSRCAD(,DACAD)                                0155
         LR    @10,SOURAD                                          0155
         ALR   @10,LINGRO                                          0155
         CR    @12,@10                                             0155
         BH    @RF00155                                            0155
*                  DO;                                             0156
*                     LINGRO = DACSRCAD + DACSRCLN - SOURAD;       0157
         SLR   @12,SOURAD                                          0157
         LR    LINGRO,@12                                          0157
*                     IF LINGRO = FULL0                            0158
*                          THEN GO TO WRTEND;                      0158
         C     LINGRO,FULL0                                        0158
         BE    @RT00158                                            0158
*                          ELSE;                                   0160
*                  END;                                            0161
*                ELSE;                                             0162
@RF00155 DS    0H                                                  0163
*           IF DACSINAD + DACSINLN <= SINKAD + LINGRO              0163
*                THEN GO TO OUTSINK;                               0163
         LH    @12,DACSINLN(,DACAD)                                0163
         AL    @12,DACSINAD(,DACAD)                                0163
         LR    @10,SINKAD                                          0163
         ALR   @10,LINGRO                                          0163
         CR    @12,@10                                             0163
         BNH   @RT00163                                            0163
*                ELSE;                                             0165
*           GEN SETS(SPECAR,CARADD,LINGRO,WORKREG4,DACSRCAD)       0166
*             REFS(XLATE,SOURAD,DACAD) FLOWS(NOCHAR) SEQFLOW       0166
*                                                       /*Y02947*/  ;
         SR    SPECAR,SPECAR
         SR    CARADD,CARADD
         BCTR  LINGRO,0                 MAKE IT VALID LENGTH
         EX    LINGRO,XLATE
         BC    8,NOCHAR
         SR    WORKREG4,WORKREG4     CLEAR A WORK REGISTER       CODE2
         LR    WORKREG4,CARADD       PICK UP CHARACTER ADDRESS   CODE2
         SR    WORKREG4,SOURAD       REDUCE BY START ADDRESS     CODE2
         SR    LINGRO,WORKREG4       CALCULATE REMAINDER         CODE2
         STC   LINGRO,DACSRCAD(DACAD)     SAVE VALUE             CODE2
*           LINGRO = CARADD - SOURAD; /*GROUP PRIOR TO SPECIAL */  0167
         LR    LINGRO,CARADD                                       0167
         SLR   LINGRO,SOURAD                                       0167
*           IF LINGRO ^= FULL0                                     0168
*                THEN                                              0168
         C     LINGRO,FULL0                                        0168
         BE    @RF00168                                            0168
*                  DO;                                             0169
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0170
         BCTR  LINGRO,0
         EX    LINGRO,MYMOV
         LA    LINGRO,1(LINGRO)
*                     SINKAD = SINKAD + LINGRO;                    0171
         ALR   SINKAD,LINGRO                                       0171
*                     SOURAD = SOURAD + LINGRO;                    0172
         ALR   SOURAD,LINGRO                                       0172
*                  END;                                            0173
*                ELSE;                                             0174
@RF00168 DS    0H                                                  0175
*           GEN SETS (SPECAR) FLOWS (NOCHAR,WRTNLL,WRTNEWL,        0175
*            WRTSOM,WRTEOM,WRTETX) NOSEQFLOW  ;              /*Y02947*/
         SLL   SPECAR,2                 MULTIPLY BY FOUR
         B     BRANTAB(SPECAR)          BRANCH ON ARGUMENT
***********************************************************************
*
*   BRANTAB    FROM      PREVIOUS INSTRUCTION ONLY
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE
*   CHARACTER HANDLING ROUTINE
***********************************************************************
BRANTAB  EQU   *                        BRANCH TABLE FOR
*                                       EXIT FROM TRANSLATE
*                                       AND TEST, IF CONDT'N
*                                       CODE IS NOT ZERO
         B     NOCHAR                   UNUSED POSITION
         B     WRTNLL                   NULL IN OUTPUT DATA
         B     WRTNEWL                  NEW LINE IN DATA
         B     WRTNLL                EM 3270 IN OUTPUT DATA
*                                       THIS IS INVALID AND
*                                       A BLANK WILL GO IN
         B     WRTSOM                   SOM IN OUTPUT DATA
         B     WRTNLL                AN ! IN OUTPUT DATA
*                                       THIS IS INVALID AND
*                                       A BLANK WILL GO IN
         B     WRTEOM                   EOM IN OUTPUT DATA
         B     WRTETX                   END FRAMING DETECTED
*/**************************************************************/  0176
*/*                                                            */  0176
*/* NO CHAR    FROM      WITCH1                                */  0176
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0176
*/**************************************************************/  0176
*NOCHAR:;                                                          0176
NOCHAR   DS    0H                                                  0177
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0177
         EX    LINGRO,MYMOV
         LA    LINGRO,1(LINGRO)         PUT LINGRO BACK
*           SINKAD = SINKAD + LINGRO;                              0178
         ALR   SINKAD,LINGRO                                       0178
*           SOURAD = SOURAD + LINGRO;                              0179
         ALR   SOURAD,LINGRO                                       0179
*           CURSAD = CURSAD + LINGRO;                              0180
         ALR   CURSAD,LINGRO                                       0180
*WRTDONE:;                                                         0181
WRTDONE  DS    0H                                                  0182
*           IF SOURAD >= DACSRCAD + DACSRCLN                       0182
*                THEN                                              0182
         LH    @12,DACSRCLN(,DACAD)                                0182
         AL    @12,DACSRCAD(,DACAD)                                0182
         CR    SOURAD,@12                                          0182
         BL    @RF00182                                            0182
*                  DO;                                             0183
*WRTEND:;                                                          0184
WRTEND   DS    0H                                                  0185
*                     GEN SETS(WORKREG4,WORKREG3,REG0,DACFLG)      0185
*                      REFS(ANWIDE,DACAD,DSWIDE,DSLINE) FLOWS(WIT) 0185
*                                           NOSEQFLOW  /*Y02947*/ ;
         SR    WORKREG4,WORKREG4               GET A WORK REGISTER
         SR    WORKREG3,WORKREG3               GET A WORK REGISTER
         SR    REG0,REG0                     GET A WORK REGISTER
         LR    WORKREG3,CURSAD               GET CURSOR ADDRESS
         IC    REG0,ANWIDE(DACAD)             GET 3270 WIDTH
         DR    WORKREG4,REG0                    FIND WHERE ON 3270
         IC    REG0,DSWIDE(DACAD)     PICK UP 2260 WIDTH       @YA02150
         CR    WORKREG4,REG0       CURSOR BEYOND MAX COLUMN ?  @YA02150
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150
         IC    REG0,DSLINE(DACAD)     PICK UP 2260 LINE COUNT  @YA02150
         CR    WORKREG3,REG0       CURSOR BEYOND MAX VALUE ?   @YA02150
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150
         B     WIT                 NO, CURSOR OK               @YA02150
SETBLAT  EQU   *                   SET CURSOR ADJUST FLAG      @YA02150
         OI    DACFLG(DACAD),B'10000000' SET THE 'BLAT' FLAG   @YA02150
         B     WIT                 GO DO WRITE CLEANUP         @YA02150
*                  END;                                            0186
*                ELSE;                  /*FINALIZE             */  0187
@RF00182 DS    0H                                                  0188
*/**************************************************************/  0188
*/*                                                            */  0188
*/* WITCH2     FROM      WRTNEWL                               */  0188
*/*      AT THE END OF A 2260 LINE - PERTINENT PROCESSING      */  0188
*/**************************************************************/  0188
*WITCH2:    CURLIN = CURLIN + ONE;                                 0188
WITCH2   AL    CURLIN,ONE                                          0188
*           GEN SETS(SPECAR) REFS(DSLINE,DACAD) SEQFLOW   /*Y02947*/ ;
         SR    SPECAR,SPECAR
         IC    SPECAR,DSLINE(DACAD)
*           IF CURLIN = SPECAR                                     0190
*                THEN GO TO WALL;                                  0190
         CR    CURLIN,SPECAR                                       0190
         BE    @RT00190                                            0190
*                ELSE;                                             0192
*          GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/  ;
         IC    SPECAR,ANWIDE(DACAD)
*          CURSAD = CURLIN * SPECAR;                               0194
         LR    @15,SPECAR                                          0194
         MR    @14,CURLIN                                          0194
         LR    CURSAD,@15                                          0194
*          GEN SETS(CARADD) REFS(DSWIDE,DACAD) SEQFLOW   /*Y02947*/  ;
         SR    CARADD,CARADD
         IC    CARADD,DSWIDE(DACAD)
*GENA:;                                                            0196
GENA     DS    0H                                                  0197
*             /* GERMAN EXTENDED NETWORK ACCESS METHOD */          0197
*             /* FIXED INTERFACE ENTRY  10/06/72 STB   */          0197
*          GEN;                                                    0197
         ENTRY GENA
*          IF  SPECAR ^= CARADD                                    0198
*                THEN                                              0198
         CR    SPECAR,CARADD                                       0198
         BE    @RF00198                                            0198
*                  DO;                                             0199
*/**************************************************************/  0200
*/*                                                            */  0200
*/* WITCH3     FROM      WALL, WALL2                           */  0200
*/*      END OF LINE RTA ORDER, SCREEN WRAP ENTRY              */  0200
*/**************************************************************/  0200
*WITCH3:;                                                          0200
WITCH3   DS    0H                                                  0201
*           GEN SETS(CURSAD,REG0,SPECAR) REFS(WITCH4)              0201
*                     FLOWS(RTABUILD) SEQFLOW    /*Y02947*/ ;      0201
         LTR   CURSAD,CURSAD           RTA FOR SCREEN WRAP ?
         BNZ   NOBUILD                 NO, DO NORMAL RTA
         SR    REG0,REG0               CLEAR A WORK REG
*                                      LEAVE A NULL IN REG 0
         LA    SPECAR,WITCH4           SET UP RETURN POINT
         B     RTABUILD
*NOBUILD:;                                                         0202
NOBUILD  DS    0H                                                  0203
*                     SINK(1) = '3C'X; /*PUT RTA ORDER IN SINK */  0203
         MVI   SINK(SINKAD),X'3C'                                  0203
*                     SINKAD = SINKAD + ONE;                       0204
         AL    SINKAD,ONE                                          0204
*           GEN;                                                   0205
         BAL   CARADD,OUTVERT
*                     SINK(1) = '00'X; /*REPEAT A NULL         */  0206
         MVI   SINK(SINKAD),X'00'                                  0206
*                     SINKAD = SINKAD + ONE;                       0207
         AL    SINKAD,ONE                                          0207
*                  END;                                            0208
*                ELSE;                                             0209
@RF00198 DS    0H                                                  0210
*/**************************************************************/  0210
*/*                                                            */  0210
*/* WITCH4     FROM      WALL1                                 */  0210
*/*      END OF LINE, SCREEN WRAP ENTRY, EQUAL SCREENS         */  0210
*/**************************************************************/  0210
*WITCH4:;                                                          0210
WITCH4   DS    0H                                                  0211
*             IF DACDSSCR = DACANSCR & CURLIN = DSLINE - 1         0211
*                & PROT = '1'B                                     0211
*                  THEN LINGRO = DSWIDE - 1;                       0211
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0211
         BNE   @RF00211                                            0211
         SLR   @12,@12                                             0211
         IC    @12,DSLINE(,DACAD)                                  0211
         BCTR  @12,0                                               0211
         CR    CURLIN,@12                                          0211
         BNE   @RF00211                                            0211
         TM    PROT(DACAD),B'01000000'                             0211
         BNO   @RF00211                                            0211
         SLR   LINGRO,LINGRO                                       0212
         IC    LINGRO,DSWIDE(,DACAD)                               0212
         BCTR  LINGRO,0                                            0212
*                  ELSE LINGRO = DSWIDE;                           0213
         B     @RC00211                                            0213
@RF00211 SLR   LINGRO,LINGRO                                       0213
         IC    LINGRO,DSWIDE(,DACAD)                               0213
*          GO TO WITCH1;                                           0214
         B     WITCH1                                              0214
*           GEN;                                                   0215
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0216
*/*     PRECEDING CODE -                                       */  0216
*/*WITCH1:       D (NO,%SINKOK,YES,) DOES LINGRO EXTEND PAST       0216
*/*                SOURCE ?                                    */  0216
*/*              P SET LINGRO TO REMAINDER OF SOURCE           */  0216
*/*              D (NO,%SINKOK,YES,WIT) IS LINGRO = ZERO ?     */  0216
*/*%SINKOK:      D (NO,%GOON1,YES,OUTSINK) WILL LINGRO EXCEDE THE  0216
*/*                SINK ?                                      */  0216
*/*%GOON1:       P USE 'XLATE' TO CHECK FOR UNIQUE                 0216
*/*                CHARACTERS                                  */  0216
*/*              D (NO,NOCHAR,YES,) ANY UNIQUE CHARACTER ?     */  0216
*/*              P CALCULATE COUNT PRECEDING THE UNIQUE            0216
*/*                CHARACTER                                   */  0216
*/*              D (NO,%BRAN,YES,) ARE THERE ANY CHARACTERS        0216
*/*                TO MOVE ?                                   */  0216
*/*              P MOVE THE PRECEDING CHARACTERS, BUMP THE         0216
*/*                SINK AND SOURCE                             */  0216
*/*%BRAN:        D (NULL,WRTNLL,NL,WRTNEWL,EM,WRTNLL,SOM,          0216
*/*                WRTSOM,!,WRTNLL,EOM,WRTEOM,ETX,                 0216
*/*                WRTETX) GO PROCESS UNIQUE CHARACTER         */  0216
*/*NOCHAR:       P MOVE FULL GROUP TO SINK, BUMP SINK AND          0216
*/*                SOURCE BY GROUP COUNT                       */  0216
*/*              P INCREMENT CURSAD BY GROUP COUNT             */  0216
*/*              D (NO,WITCH2,YES,WIT) SOURCE EXPENDED ?       */  0216
*/*WITCH2:       P INCREMENT CURLIN BY ONE                     */  0216
*/*              D (NO,%SETCURS,YES,WALL) LAST LINE ON 2260 ?  */  0216
*/*%SETCURS:     P SET CURSAD TO BEGINNING OF NEXT LINE        */  0216
*/*              D (YES,WITCH4,NO,WITCH3) ARE THE SCREENS          0216
*/*                EQUAL ?                                     */  0216
*/*WITCH3:       D (YES,NOBUILD,NO,) SINGLE LINE RTA ?         */  0216
*/*              P SET RETURN TO WITCH4, CHARACTER TO NULL     */  0216
*/*              S (,WITCH4) RTABUILD:CONSTRUCT RTA ORDER(S)   */  0216
*/*NOBUILD:      P PUT A REPEAT TO ADDRESS ORDER IN THE SINK       0216
*/*                AND BUMP THE SINK                           */  0216
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0216
*/*              P PUT A NULL IN THE SINK AND BUMP SINK        */  0216
*/*WITCH4:       P (,WITCH1) SET LINGRO TO 2260 WIDTH          */  0216
*        GEN;                                                      0216
         EJECT
*/**************************************************************/  0217
*/**************************************************************/  0217
*/*                                                            */  0217
*/*                                                            */  0217
*/* WALL ENTERED IF WRAP AROUND IS DETECTED, FROM WITCH2       */  0217
*/*    (IN WITCH). WALL HANDLES THE FUNCTION OF FORMATTING     */  0217
*/*    THE 3270 SCREEN SO AS TO MAINTAIN THE 2260 IMAGE.       */  0217
*/*    WALL CALCULATES THE DISPLACEMENT FOR AND INSERTS        */  0217
*/*    THE PROTECTED ATTRIBUTE IF PROT = YES. WALL PUTS        */  0217
*/*    A REPEAT TO ADDRESS OF NULLS TO SCREEN POSITION         */  0217
*/*    ZERO IF  THE 3270 DOES NOT EQUAL THE 2260 BY            */  0217
*/*    SETTING THE CURSOR TO ZERO AND PASSING CONTROL TO       */  0217
*/*    WITCH3. IF NO RTA IS NEEDED, CONTROL IS PASSED TO       */  0217
*/*    WITCH4. IN ANY CASE, THE CURRENT LINE IS SET TO         */  0217
*/*    ZERO, AND THE CURSOR IS SET TO ZERO.                    */  0217
*/*                                                            */  0217
*/**************************************************************/  0217
*/**************************************************************/  0217
*WALL:;                                                            0217
WALL     DS    0H                                                  0218
*           IF PROT = '1'B                                         0218
*                THEN                                              0218
         TM    PROT(DACAD),B'01000000'                             0218
         BNO   @RF00218                                            0218
*                  DO;                                             0219
*                     IF DACDSSCR = DACANSCR                       0220
*                          THEN                                    0220
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0220
         BNE   @RF00220                                            0220
*                            DO;                                   0221
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,ANLINE)      0222
*                               SEQFLOW      /*Y02947*/  ;         0222
         SR    CARADD,CARADD
         SR    SPECAR,SPECAR
         IC    CARADD,ANWIDE(DACAD)
         IC    SPECAR,ANLINE(DACAD)
*                               CURSAD = SPECAR * CARADD - 1;      0223
         LR    @15,CARADD                                          0223
         MR    @14,SPECAR                                          0223
         BCTR  @15,0                                               0223
         LR    CURSAD,@15                                          0223
*                            END;                                  0224
*                          ELSE                                    0225
*                            DO;                                   0225
         B     @RC00220                                            0225
@RF00220 DS    0H                                                  0226
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,DSWIDE)      0226
*                               SEQFLOW        /*Y02947*/  ;       0226
         SR    CARADD,CARADD
         SR    SPECAR,SPECAR
         IC    CARADD,ANWIDE(DACAD)
         IC    SPECAR,DSWIDE(DACAD)
*                               CURSAD = CARADD * (CURLIN - ONE) + 0227
*                                SPECAR;                           0227
         LR    @15,CURLIN                                          0227
         SL    @15,ONE                                             0227
         MR    @14,CARADD                                          0227
         ALR   @15,SPECAR                                          0227
         LR    CURSAD,@15                                          0227
*                            END;                                  0228
*                     SINK(1) = '11'X;                             0229
@RC00220 MVI   SINK(SINKAD),X'11'                                  0229
*                     SINKAD = SINKAD + 1;                         0230
         AH    SINKAD,@CH00061                                     0230
*                     GEN;                                         0231
         BAL   CARADD,OUTVERT
*                               SINK(1) = '1D'X; /*SF ORDER    */  0232
         MVI   SINK(SINKAD),X'1D'                                  0232
*                               SINKAD = SINKAD + ONE;             0233
         AL    SINKAD,ONE                                          0233
*                               SINK(1) = '60'X; /*PROT ATTRIB */  0234
         MVI   SINK(SINKAD),X'60'                                  0234
*                               SINKAD = SINKAD + 1;               0235
         AH    SINKAD,@CH00061                                     0235
*/**************************************************************/  0236
*/*                                                            */  0236
*/* WALL2      FROM      WALL                                  */  0236
*/*      SCREEN WRAP PROCESSING, PROT = NO SPECIFIED           */  0236
*/**************************************************************/  0236
*WALL2:;                                                           0236
WALL2    DS    0H                                                  0237
*           CURLIN = CURLIN - CURLIN;                              0237
         SLR   CURLIN,CURLIN                                       0237
*           CURSAD = CURSAD - CURSAD;                              0238
         SLR   CURSAD,CURSAD                                       0238
*           IF DACDSSCR = DACANSCR                                 0239
*                THEN GO TO WITCH4;                                0239
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0239
         BE    @RT00239                                            0239
*                ELSE GO TO WITCH3;                                0241
         B     WITCH3                                              0241
*                  END;                                            0242
*                ELSE                                              0243
*                GO TO WALL2;                                      0243
*           GEN;                                                   0244
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0245
*/*     PRECEDING CODE -                                       */  0245
*/*WALL:         D (NO,WALL2,YES,) PROT = YES SPECIFIED IN         0245
*/*                DACA ?                                      */  0245
*/*              D (NO,%NOTEQ,YES,) 3270 SIZE = 2260 SIZE          0245
*/*                ?                                           */  0245
*/*              P (,%SETSBA) SET CURSAD TO POINT TO LAST          0245
*/*                POSITION OF 2260 SCREEN                     */  0245
*/*%NOTEQ:       P SET CURSAD TO POINT ONE PAST LAST 2260          0245
*/*                SCREEN POSITION                             */  0245
*/*%SETSBA:      P SET BUFFER ADDRESS ORDER IN SINK AND            0245
*/*                BUMP SINK                                   */  0245
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0245
*/*              P START FIELD, PROTECTED ATTRIBUTE IN             0245
*/*                SINK, BUMP SINK TWO                         */  0245
*/*              P SET CURLIN TO ZERO, CURSAD TO ZERO          */  0245
*/*              D (NO,WITCH3,YES,WALL1) 3270 SIZE = 2260 SIZE?*/  0245
*/*WALL1:        P (,WITCH4) CLEAR CURLIN, CURSAD TO ZERO      */  0245
*/*WALL2:        D (YES,WALL1,NO,) 3270 SIZE = 2260 SIZE ?     */  0245
*/*              P (,WITCH3) CLEAR CURLIN, CURSAD TO ZERO      */  0245
*        GEN;                                                      0245
         EJECT
*/**************************************************************/  0246
*/**************************************************************/  0246
*/*                                                            */  0246
*/*                                                            */  0246
*/* WRSPCHAR A COLLECTION OF SUBROUTINES TO DEAL WITH          */  0246
*/*    CHARACTERS REQUIRING SPECIAL ACTION. EACH               */  0246
*/*    SUBROUTINE IS AN INDIVIDUAL ENTITY, AND NOT             */  0246
*/*    SPECIFICALLY RELATED TO ANY OTHER. SETTLE IS A          */  0246
*/*    HOUSEKEEPING FACILITY USED BY SEVERAL, BUT NOT ALL,     */  0246
*/*    OF THE SUBROUTINES. ALL ARE ENTERED FROM WITCH.         */  0246
*/*    THE SUBROUTINES ARE:                                    */  0246
*/*                                                            */  0246
*/*       WRTNEWL NEW LINE CHARACTER DETECTED IN DATA          */  0246
*/*          ADJUST CURSOR TO NEXT LINE                        */  0246
*/*          REPEAT BLANKS (NULLS IF RVOID = YES) TO END       */  0246
*/*          OF 2260 LINE                                      */  0246
*/*          PASS CONTROL TO WITCH2                            */  0246
*/*                                                            */  0246
*/*       WRTSOM START OF MESSAGE SYMBOL DETECTED IN DATA      */  0246
*/*          SET A FIELD (UNPROTECTED)                         */  0246
*/*          PASS CONTROL TO SETTLE                            */  0246
*/*                                                            */  0246
*/*       WRTEOM END OF MESSAGE SYMBOL DETECTED IN DATA        */  0246
*/*          PUT AN EXCLAIMATION POINT IN SINK                 */  0246
*/*          SET A 3270 END OF MESSAGE                         */  0246
*/*          PASS CONTROL TO SETTLE                            */  0246
*/*                                                            */  0246
*/*       WRTETX ETX DETECTED IN DATA                          */  0246
*/*          IF REMOTE IS KNOWN, PASS CONTROL TO WIT           */  0246
*/*          IF NOT KNOWN, REPROCESS AS REMOTE BY RESET        */  0246
*/*          OF SINK AND SOURCE POINTERS AND PASSING           */  0246
*/*          CONTROL TO BACKGO (IN HOUSEKEEPING)               */  0246
*/*                                                            */  0246
*/*       WRTNLL NULL DETECTED IN DATA STREAM                  */  0246
*/*          INSERT BLANK IN SINK                              */  0246
*/*          PASS CONTROL TO SETTLE                            */  0246
*/*                                                            */  0246
*/*       SETTLE HOUSEKEEPING FACILITY                         */  0246
*/*          ADJUST SOURCE POINTER                             */  0246
*/*          ADJUST CURSOR                                     */  0246
*/*          IF FROM WRTSOM, SAVE SOM POSITION                 */  0246
*/*          PASS CONTROL TO WITCH1                            */  0246
*/*                                                            */  0246
*/**************************************************************/  0246
*/**************************************************************/  0246
*/**************************************************************/  0246
*/*                                                            */  0246
*/* WRTNEWL    FROM      BRANTAB                               */  0246
*/*      NEW LINE CHARACTER PROCESSING                         */  0246
*/**************************************************************/  0246
*WRTNEWL:;                                                         0246
WRTNEWL  DS    0H                                                  0247
*                      SINK(1) = '1E'X;                            0247
         MVI   SINK(SINKAD),X'1E'                                  0247
*                      SINKAD = SINKAD + 1;                        0248
         AH    SINKAD,@CH00061                                     0248
*                      GEN REFS(DACSRCAD,DACAD) FLOWS(ENDSCRN)     0249
*                          SEQFLOW ;     /*Y02947*/                0249
         CLI   DACSRCAD(DACAD),X'00'  THIS LINE GROUP EXPENDED?  CODE2
         BNH   ENDSCRN             YES, NO SBA NEEDED           YA01253
*WRTNEW1:;                                                  /*YA02152*/
WRTNEW1  DS    0H                                                  0251
*                      CURSAD = (CURLIN + 1) * ANWIDE;             0251
         LA    @15,1                                               0251
         ALR   @15,CURLIN                                          0251
         SLR   CURSAD,CURSAD                                       0251
         IC    CURSAD,ANWIDE(,DACAD)                               0251
         MR    @14,CURSAD                                          0251
         LR    CURSAD,@15                                          0251
*          CTLCOMP:   IF CURLIN + 1 = DSLINE                       0252
*                          THEN DO;                                0252
CTLCOMP  LA    @12,1                                               0252
         ALR   @12,CURLIN                                          0252
         SLR   @10,@10                                             0252
         IC    @10,DSLINE(,DACAD)                                  0252
         CR    @12,@10                                             0252
         BNE   @RF00252                                            0252
*                            IF ANWIDE = DSWIDE                    0254
*                                THEN DO;                   /*YA03264*/
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0254
         BNE   @RF00254                                            0254
*                                 IF ANLINE^= DSLINE        /*YA03264*/
*                                  THEN GO TO ENDSCRN;      /*YA03264*/
         CLC   ANLINE(1,DACAD),DSLINE(DACAD)                       0256
         BNE   @RT00256                                            0256
*                                    ELSE DO;               /*YA03264*/
*                                   CURSAD = CURSAD         /*YA03264*/
*                                         - CURSAD;         /*YA03264*/
         SLR   CURSAD,CURSAD                                       0259
*                                  BLAT = '1'B;             /*YA03264*/
         OI    BLAT(DACAD),B'10000000'                             0260
*                                  END;                     /*YA03264*/
*                          END;                             /*YA03264*/
*                                 ELSE;                            0263
@RF00254 DS    0H                                                  0264
*                               END;                               0264
*                          ELSE;                                   0265
@RF00252 DS    0H                                                  0266
*PLUGSBA:;                                                         0266
PLUGSBA  DS    0H                                                  0267
*                      SINK(1) = '11'X;                            0267
         MVI   SINK(SINKAD),X'11'                                  0267
*                      SINKAD = SINKAD + 1;                        0268
         AH    SINKAD,@CH00061                                     0268
*                      SPECAR = CURSAD;                            0269
         LR    SPECAR,CURSAD                                       0269
*                IF BLAT = '1'B                                    0270
*                   THEN GO TO WRTNEW2;                            0270
         TM    BLAT(DACAD),B'10000000'                             0270
         BO    @RT00270                                            0270
*                   ELSE;                                          0272
*                      CURSAD = CURSAD - ANWIDE + DSWIDE;          0273
         LR    @12,CURSAD                                          0273
         SLR   @10,@10                                             0273
         IC    @10,ANWIDE(,DACAD)                                  0273
         SLR   @12,@10                                             0273
         SLR   @10,@10                                             0273
         IC    @10,DSWIDE(,DACAD)                                  0273
         ALR   @12,@10                                             0273
         LR    CURSAD,@12                                          0273
*WRTNEW2:;                                                  /*YA02152*/
WRTNEW2  DS    0H                                                  0275
*                      GEN;                                        0275
         BAL   CARADD,OUTVERT
*                      CURSAD = SPECAR;                            0276
         LR    CURSAD,SPECAR                                       0276
*ENDSCRN:;                                                         0277
ENDSCRN  DS    0H                                                  0278
*                IF BLAT = '1'B                             /*YA02152*/
*                   THEN  GO TO SETTLE1;                           0278
         TM    BLAT(DACAD),B'10000000'                             0278
         BO    @RT00278                                            0278
*                   ELSE;                                          0280
*                      BLAT = '1'B;                                0281
         OI    BLAT(DACAD),B'10000000'                             0281
*                GEN REFS(DACSRCAD,DACAD) FLOWS(SETTLE1)           0282
*                 SEQFLOW ;    /*Y02947*/                          0282
         CLI   DACSRCAD(DACAD),X'00' THIS LINE GROUP EXPENDED?  YA02152
         BNE   SETTLE1             NO, NO SBA NEEDED            YA02152
*                IF (1 + LINGRO + CURSAD) // DSWIDE ^= FULL0       0283
*                   THEN GO TO WRTNEW1;                     /*YA02152*/
         LA    @12,1                                               0283
         LR    @10,LINGRO                                          0283
         ALR   @10,@12                                             0283
         ALR   @10,CURSAD                                          0283
         LR    @14,@10                                             0283
         SRDA  @14,32                                              0283
         SLR   @10,@10                                             0283
         IC    @10,DSWIDE(,DACAD)                                  0283
         DR    @14,@10                                             0283
         C     @14,FULL0                                           0283
         BNE   @RT00283                                            0283
*                   ELSE;                                          0285
*                CURSAD = (CURLIN + 1) * ANWIDE;                   0286
         LR    @15,@12                                             0286
         ALR   @15,CURLIN                                          0286
         SLR   CURSAD,CURSAD                                       0286
         IC    CURSAD,ANWIDE(,DACAD)                               0286
         MR    @14,CURSAD                                          0286
         LR    CURSAD,@15                                          0286
*                      GO TO SETTLE1;                              0287
         B     SETTLE1                                             0287
*/**************************************************************/  0288
*/*                                                            */  0288
*/* WRTSOM     FROM      BRANTAB                               */  0288
*/*      START OF MESSAGE SYMBOL PROCESSING                    */  0288
*/**************************************************************/  0288
*WRTSOM:;                                                          0288
WRTSOM   DS    0H                                                  0289
*                      SINK(1) = '1D'X; /*PUT SF ORDER IN SINK */  0289
         MVI   SINK(SINKAD),X'1D'                                  0289
*                     SINKAD = SINKAD + ONE;                       0290
         L     @12,ONE                                             0290
         ALR   SINKAD,@12                                          0290
*                      SINK(1) = 'C1'X; /*PUT ATTRIBUTE IN SINK*/  0291
         MVI   SINK(SINKAD),X'C1'                                  0291
*                     SINKAD = SINKAD + ONE;                       0292
         ALR   SINKAD,@12                                          0292
*                     SOMP = '1'B;                                 0293
         OI    SOMP(DACAD),B'00100000'                             0293
*                     GO TO SETTLE;                                0294
         B     SETTLE                                              0294
*/**************************************************************/  0295
*/*                                                            */  0295
*/* WRTEOM     FROM      BRANTAB                               */  0295
*/*      END OF MESSAGE CHARACTER PROCESSING                   */  0295
*/**************************************************************/  0295
*WRTEOM:;                                                          0295
WRTEOM   DS    0H                                                  0296
*                      SINK(1) = '5A'X; /*PUT A ! IN THE SINK  */  0296
         MVI   SINK(SINKAD),X'5A'                                  0296
*                     SINKAD = SINKAD + ONE;                       0297
         L     @12,ONE                                             0297
         ALR   SINKAD,@12                                          0297
*                      SINK(1) = '19'X; /*PUT EM IN SINK       */  0298
         MVI   SINK(SINKAD),X'19'                                  0298
*                     SINKAD = SINKAD + ONE;                       0299
         ALR   SINKAD,@12                                          0299
*                          GO TO SETTLE;                           0300
         B     SETTLE                                              0300
*/**************************************************************/  0301
*/*                                                            */  0301
*/* WRTETX     FROM      BRANTAB                               */  0301
*/*      END TRANSMISSION CHARACTER PROCESSING                 */  0301
*/**************************************************************/  0301
*WRTETX:;                             /* END FRAMING CHAR      */  0301
WRTETX   DS    0H                                                  0302
*           IF RMTDV = '1'B                                        0302
*                THEN                                              0302
         TM    RMTDV(DACAD),B'00000001'                            0302
         BNO   @RF00302                                            0302
*                  DO;                                             0303
*                     IF CURSAD = FULL0                            0304
*                          THEN                                    0304
         C     CURSAD,FULL0                                        0304
         BNE   @RF00304                                            0304
*                            DO;                                   0305
*                               BLAT = '1'B;                       0306
         OI    BLAT(DACAD),B'10000000'                             0306
*                               CURLIN = DSLINE - 1;               0307
         SLR   CURLIN,CURLIN                                       0307
         IC    CURLIN,DSLINE(,DACAD)                               0307
         BCTR  CURLIN,0                                            0307
*                            END;                                  0308
*                          ELSE;                                   0309
@RF00304 DS    0H                                                  0310
*                     GO TO WIT;                                   0310
         B     WIT                                                 0310
*                  END;                                            0311
*                ELSE                                              0312
*                  DO;                                             0312
@RF00302 DS    0H                                                  0313
*                     SOURAD = DACSRCAD;                           0313
         L     SOURAD,DACSRCAD(,DACAD)                             0313
*                     SINKAD = DACSINAD;                           0314
         L     SINKAD,DACSINAD(,DACAD)                             0314
*                     GO TO BACKGO;                                0315
         B     BACKGO                                              0315
*                  END;                                            0316
*/**************************************************************/  0317
*/*                                                            */  0317
*/* WRTNLL     FROM      BRANTAB                               */  0317
*/*      NULL OR INVALID CHARACGER PROCESSING                  */  0317
*/**************************************************************/  0317
*WRTNLL:;                                                          0317
WRTNLL   DS    0H                                                  0318
*                          SINK(1) = '40'X; /*PUT BLANK IN SINK*/  0318
         MVI   SINK(SINKAD),X'40'                                  0318
*                          SINKAD = SINKAD + ONE;                  0319
         AL    SINKAD,ONE                                          0319
*/**************************************************************/  0320
*/*                                                            */  0320
*/* SETTLE     FROM      WRTSOM, WRTEOM, WRTNLL                */  0320
*/*      RETURN ROUTE TO MAIN DATA STREAM PROCESSING           */  0320
*/**************************************************************/  0320
*SETTLE:;                                                          0320
SETTLE   DS    0H                                                  0321
*                      CURSAD = CURSAD + LINGRO + 1;               0321
         LR    @12,CURSAD                                          0321
         ALR   @12,LINGRO                                          0321
         AH    @12,@CH00061                                        0321
         LR    CURSAD,@12                                          0321
*SETTLE1:;                                                         0322
SETTLE1  DS    0H                                                  0323
*                      SOURAD = SOURAD + 1;                        0323
         AH    SOURAD,@CH00061                                     0323
*           GEN SETS(LINGRO,DACSRCAD) REFS(DACAD) SEQFLOW ; /*Y02947*/
         SR    LINGRO,LINGRO       CLEAR MOVED VALUE OUT        CODE2
         IC    LINGRO,DACSRCAD(DACAD) PICK UP REMAINING VALUE   A58221
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR SAVE BYTE A58221
*           IF SOMP = '1'B                                         0325
*                THEN                                              0325
         TM    SOMP(DACAD),B'00100000'                             0325
         BNO   @RF00325                                            0325
*                  DO;                                             0326
*                     SOMADD = CURSAD - ONE;                       0327
         LR    SOMADD,CURSAD                                       0327
         SL    SOMADD,ONE                                          0327
*                     SOMP = '0'B;                                 0328
*                     SOMHER = '1'B;                               0329
         OI    SOMHER(DACAD),B'00001000'                           0329
         NI    SOMP(DACAD),B'11011111'                             0329
*                  END;                                            0330
*                ELSE;                                             0331
@RF00325 DS    0H                                                  0332
*                 IF BLAT ='1'B                                    0332
*                      THEN DO;                                    0332
         TM    BLAT(DACAD),B'10000000'                             0332
         BNO   @RF00332                                            0332
*                        BLAT = '0'B;                              0334
         NI    BLAT(DACAD),B'01111111'                             0334
*                        IF LINGRO <= FULL0                        0335
*                             THEN GO TO WRTDONE;                  0335
         C     LINGRO,FULL0                                        0335
         BNH   @RT00335                                            0335
*                             ELSE GO TO WITCH2;                   0337
         B     WITCH2                                              0337
*                           END;                                   0338
*                      ELSE;                                       0339
@RF00332 DS    0H                                                  0340
*                 IF LINGRO <= FULL0                               0340
*                      THEN GO TO WRTDONE;                         0340
         C     LINGRO,FULL0                                        0340
         BNH   @RT00340                                            0340
*                      ELSE GO TO WITCH1;                          0342
         B     WITCH1                                              0342
*           GEN;                                                   0343
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0344
*/*     PRECEDING CODE -                                       */  0344
*/*WRTNEWL:      P SET CURSAD TO BEGINNING OF NEXT LINE        */  0344
*/*              D (NO,%NOTLAST,YES,) LAST POSITION IN 2260        0344
*/*                LINE ?                                      */  0344
*/*              P (,WITCH2) BUMP SOURCE, PUT FM IN SINK,          0344
*/*                BUMP SINK                                   */  0344
*/*%NOTLAST:     P PUT FIELD MARK IN SINK, BUMP SINK, PUT          0344
*/*                SBA IN SINK, BUMP SINK                      */  0344
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0344
*/*              P (,WITCH2) BUMP SOURCE                       */  0344
*/*WRTSOM:       P PUT START FIELD, ATTRIBUTE IN SINK, BUMP        0344
*/*                SINK TWO                                    */  0344
*/*              P (,SETTLE) SET SOMP FLAG ON                  */  0344
*/*WRTEOM:       P (,SETTLE) PUT !, END MESSAGE IN SINK,           0344
*/*                BUMP SINK TWO                               */  0344
*/*WRTETX:       D (NO,%RMTDVNO,YES,WIT) IS RMTDV ON ?         */  0344
*/*%RMTDVNO:     P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0344
*/*WRTNLL:       P PUT BLANK IN SINK, BUMP SINK                */  0344
*/*SETTLE:       P BUMP SOURCE, INCREMENT CURSAD, SET LINGRO       0344
*/*                TO REMAINING PART                           */  0344
*/*              D (NO,%OUT,YES,) IS SOMP ON ?                 */  0344
*/*              P SET SOMADD TO BUFFER ADDRESS OF SF, SET         0344
*/*              SOMP OFF, SET SOMHER ON                       */  0344
*/*%OUT:         D (YES,WITCH2,NO,WITCH1) IS LINGRO = 0 ?      */  0344
*        GEN;                                                      0344
         EJECT
*/**************************************************************/  0345
*/**************************************************************/  0345
*/*                                                            */  0345
*/*                                                            */  0345
*/* WIT TERMINATION OF SCAN PROCESSING FOR OUTPUT DATA.        */  0345
*/*    WIT IS ENTERED FROM WITCH1, NOCHAR (IN WITCH), AND      */  0345
*/*    WRETX (IN WRSPCHAR). WIT TESTS PROT AND IF YES, WIT     */  0345
*/*    ASCERTAINS THAT AN SOM (START FIELD, UNPROTECTED)       */  0345
*/*    IS ON THE SCREEN. WIT SETS AN INSERT CURSOR ORDER       */  0345
*/*    FOLLOWING THE LAST DATA. IF IT IS A REMOTE DATA         */  0345
*/*    STREAM, WIT PLACES AN ETX AT THE END. CONTROL IS        */  0345
*/*    PASSED TO OUTNORM.                                      */  0345
*/*                                                            */  0345
*/**************************************************************/  0345
*/**************************************************************/  0345
*WIT:       IF DACSINAD + DACSINLN <= SINKAD + 10                  0345
*                THEN GO TO OUTSINK;                               0345
WIT      LH    @12,DACSINLN(,DACAD)                                0345
         AL    @12,DACSINAD(,DACAD)                                0345
         LA    @10,10                                              0345
         ALR   @10,SINKAD                                          0345
         CR    @12,@10                                             0345
         BNH   @RT00345                                            0345
*                ELSE                                              0347
*                  DO;                                             0347
*                     IF SOMHER = '0'B /*IF NO SOM EXISTS      */  0348
*                     & PROT = '1'B   /*AND PROT = YES AND     */  0348
*                     & SHRD = '0'B   /*NOT SHORT READ ON      */  0348
*                     × SOMHER = '0'B /*IF NO SOM EXISTS       */  0348
*                     & RVOID = '1'B  /*AND RVOID = YES        */  0348
*                     & SHRD = '0'B   /*AND NOT SHORT READ ON  */  0348
*                          THEN                                    0348
         TM    SOMHER(DACAD),B'00001000'                           0348
         BNZ   @GL00005                                            0348
         TM    PROT(DACAD),B'01000000'                             0348
         BNO   @GL00005                                            0348
         TM    SHRD(DACAD),B'01000000'                             0348
         BZ    @RT00348                                            0348
@GL00005 TM    SOMHER(DACAD),B'00001000'                           0348
         BNZ   @RF00348                                            0348
         TM    RVOID(DACAD),B'10000000'                            0348
         BNO   @RF00348                                            0348
         TM    SHRD(DACAD),B'01000000'                             0348
         BNZ   @RF00348                                            0348
@RT00348 DS    0H                                                  0349
*                            DO;                                   0349
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0350
         MVI   SINK(SINKAD),X'1D'                                  0350
*                               SINK(2) = 'C1'X; /*ATTR IN SINK*/  0351
         MVI   SINK+1(SINKAD),X'C1'                                0351
*                               SINKAD = SINKAD + 2;               0352
         AH    SINKAD,@CH00059                                     0352
*                               SOMHER = '1'B;                     0353
         OI    SOMHER(DACAD),B'00001000'                           0353
*                               SOMADD = CURSAD;                   0354
         LR    SOMADD,CURSAD                                       0354
*                               CURSAD = CURSAD + 1;               0355
         AH    CURSAD,@CH00061                                     0355
*                            END;                                  0356
*                          ELSE;                                   0357
@RF00348 DS    0H                                                  0358
*                     IF BLAT = '1'B                               0358
*                          THEN                                    0358
         TM    BLAT(DACAD),B'10000000'                             0358
         BNO   @RF00358                                            0358
*                             DO;                                  0359
*                                BLAT = '0'B;                      0360
         NI    BLAT(DACAD),B'01111111'                             0360
*                                IF CURLIN = DSLINE - 1            0361
*                                     THEN                         0361
         SLR   @12,@12                                             0361
         IC    @12,DSLINE(,DACAD)                                  0361
         BCTR  @12,0                                               0361
         CR    CURLIN,@12                                          0361
         BNE   @RF00361                                            0361
*                                      DO;                         0362
*                                         CURLIN = CURLIN - CURLIN;
         SLR   CURLIN,CURLIN                                       0363
*                                         CURSAD = CURSAD - CURSAD;
         SLR   CURSAD,CURSAD                                       0364
*                                         IF SOMHER = '1'B         0365
*                                         & SOMADD = FULL0         0365
*                                         × DACSOMAD = HAF0        0365
*                                           THEN CURSAD = CURSAD + 1;
         TM    SOMHER(DACAD),B'00001000'                           0365
         BNO   @GL00010                                            0365
         C     SOMADD,FULL0                                        0365
         BE    @RT00365                                            0365
@GL00010 CLC   DACSOMAD(2,DACAD),HAF0                              0365
         BNE   @RF00365                                            0365
@RT00365 DS    0H                                                  0366
         AH    CURSAD,@CH00061                                     0366
*                                           ELSE;                  0367
@RF00365 DS    0H                                                  0368
*                                         SINK(1) = '11'X;/*SBA*/  0368
         MVI   SINK(SINKAD),X'11'                                  0368
*                                         SINKAD = SINKAD + 1;     0369
         AH    SINKAD,@CH00061                                     0369
*                                           GEN;                   0370
         BAL   CARADD,OUTVERT
*                                      END;                        0371
*                                     ELSE                         0372
*                                      DO;                         0372
         B     @RC00361                                            0372
@RF00361 DS    0H                                                  0373
*                                         CURLIN = CURLIN + 1;     0373
         LA    @12,1                                               0373
         ALR   CURLIN,@12                                          0373
*                                         CURSAD = ANWIDE * CURLIN;
         LR    @15,CURLIN                                          0374
         SLR   CURSAD,CURSAD                                       0374
         IC    CURSAD,ANWIDE(,DACAD)                               0374
         MR    @14,CURSAD                                          0374
         LR    CURSAD,@15                                          0374
*                                         SINK(1) = '11'X;/*SBA*/  0375
         MVI   SINK(SINKAD),X'11'                                  0375
*                                         SINKAD = SINKAD + 1;     0376
         ALR   SINKAD,@12                                          0376
*                                         GEN;                     0377
         BAL   CARADD,OUTVERT
*                                      END;                        0378
*                             END;                                 0379
*                          ELSE;                                   0380
@RF00358 DS    0H                                                  0381
*                     SINK(1) = '13'X; /*INSERT CURSOR IN SINK */  0381
@RC00358 MVI   SINK(SINKAD),X'13'                                  0381
*                     SINKAD = SINKAD + ONE;                       0382
         AL    SINKAD,ONE                                          0382
*                     SPECAR = CURSAD;                             0383
         LR    SPECAR,CURSAD                                       0383
*              GEN SETS(DACCRS) REFS(DACAD,CURSAD) SEQFLOW ; /*Y02947*/
         STH   CURSAD,DACCRS(DACAD)  STORE CURSOR POSITION        GENA
*                     IF DACANSCR = DACDSSCR                       0385
*                          THEN                                    0385
         CLC   DACANSCR(2,DACAD),DACDSSCR(DACAD)                   0385
         BNE   @RF00385                                            0385
*                            DO;                                   0386
*                     SINK(1) = '11'X; /*PUT SBA ORDER IN SINK */  0387
         MVI   SINK(SINKAD),X'11'                                  0387
*                     SINKAD = SINKAD + 1;                         0388
         AH    SINKAD,@CH00061                                     0388
*                               CURSAD = ANWIDE * ANLINE - 1;      0389
         SLR   @15,@15                                             0389
         IC    @15,ANLINE(,DACAD)                                  0389
         SLR   CURSAD,CURSAD                                       0389
         IC    CURSAD,ANWIDE(,DACAD)                               0389
         MR    @14,CURSAD                                          0389
         BCTR  @15,0                                               0389
         LR    CURSAD,@15                                          0389
*                               GEN;                               0390
         BAL   CARADD,OUTVERT
*                               GO TO SETPROT;                     0391
         B     SETPROT                                             0391
*                            END;                                  0392
*                          ELSE                                    0393
*                            DO;                                   0393
@RF00385 DS    0H                                                  0394
*                               IF ANWIDE = DSWIDE                 0394
*                                    THEN                          0394
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0394
         BNE   @RF00394                                            0394
*                                      DO;                         0395
*                                         SINK(1) = '11'X;/*SBA*/  0396
         MVI   SINK(SINKAD),X'11'                                  0396
*                                         SINKAD = SINKAD + 1;     0397
         AH    SINKAD,@CH00061                                     0397
*                                         CURSAD = ANWIDE *        0398
*                                         DSLINE;                  0398
         SLR   @15,@15                                             0398
         IC    @15,DSLINE(,DACAD)                                  0398
         SLR   CURSAD,CURSAD                                       0398
         IC    CURSAD,ANWIDE(,DACAD)                               0398
         MR    @14,CURSAD                                          0398
         LR    CURSAD,@15                                          0398
*                                         GEN;                     0399
         BAL   CARADD,OUTVERT
*                                         GO TO SETPROT;           0400
         B     SETPROT                                             0400
*                                      END;                        0401
*                                    ELSE;                         0402
@RF00394 DS    0H                                                  0403
*                               IF CURLIN = DSLINE                 0403
*                                    THEN CURLIN = CURLIN - 1;     0403
         SLR   @12,@12                                             0403
         IC    @12,DSLINE(,DACAD)                                  0403
         CR    CURLIN,@12                                          0403
         BNE   @RF00403                                            0403
         BCTR  CURLIN,0                                            0404
*                                    ELSE;                         0405
@RF00403 DS    0H                                                  0406
*/**************************************************************/  0406
*/*                                                            */  0406
*/* CLERLOOP   FROM      CLERLOOP                              */  0406
*/*      END OF DATA STREAM LINE CLEANUP LOOP POINT            */  0406
*/**************************************************************/  0406
*CLERLOOP:;                                                        0406
CLERLOOP DS    0H                                                  0407
*                               SINK(1) = '11'X; /*SBA IN SINK */  0407
         MVI   SINK(SINKAD),X'11'                                  0407
*                               SINKAD = SINKAD + 1;               0408
         AH    SINKAD,@CH00061                                     0408
*                               CURSAD = CURLIN * ANWIDE + DSWIDE; 0409
         SLR   @15,@15                                             0409
         IC    @15,ANWIDE(,DACAD)                                  0409
         MR    @14,CURLIN                                          0409
         SLR   CURSAD,CURSAD                                       0409
         IC    CURSAD,DSWIDE(,DACAD)                               0409
         ALR   @15,CURSAD                                          0409
         LR    CURSAD,@15                                          0409
*                               GEN;                               0410
         BAL   CARADD,OUTVERT
*                               CURLIN = CURLIN + 1;               0411
         LA    @12,1                                               0411
         ALR   CURLIN,@12                                          0411
*                               IF CURLIN = DSLINE                 0412
*                                    THEN GO TO SETPROT;           0412
         SLR   @10,@10                                             0412
         IC    @10,DSLINE(,DACAD)                                  0412
         CR    CURLIN,@10                                          0412
         BE    @RT00412                                            0412
*                                    ELSE                          0414
*                                      DO;                         0414
*                                         SINK(1) = '3C'X;/*RTA*/  0415
         MVI   SINK(SINKAD),X'3C'                                  0415
*                                         SINKAD = SINKAD + 1;     0416
         ALR   SINKAD,@12                                          0416
*                                         CURSAD = CURLIN * ANWIDE;
         SLR   @15,@15                                             0417
         IC    @15,ANWIDE(,DACAD)                                  0417
         MR    @14,CURLIN                                          0417
         LR    CURSAD,@15                                          0417
*                                         GEN;                     0418
         BAL   CARADD,OUTVERT
*                                         SINK(1) = '00'X;         0419
         MVI   SINK(SINKAD),X'00'                                  0419
*                                         SINKAD = SINKAD + 1;     0420
         AH    SINKAD,@CH00061                                     0420
*                                         GO TO CLERLOOP;          0421
         B     CLERLOOP                                            0421
*                                      END;                        0422
*                            END;                                  0423
*/**************************************************************/  0424
*/*                                                            */  0424
*/* SETPROT    FROM      WIT, CLERLOOP                         */  0424
*/*      ESTABLISH PROTECTED FIELD IF PROT = YES               */  0424
*/**************************************************************/  0424
*SETPROT:;                                                         0424
SETPROT  DS    0H                                                  0425
*                     IF PROT = '1'B                               0425
*                          THEN                                    0425
         TM    PROT(DACAD),B'01000000'                             0425
         BNO   @RF00425                                            0425
*                            DO;                                   0426
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0427
         MVI   SINK(SINKAD),X'1D'                                  0427
*                               SINK(2) = '60'X; /*PROT ATTR IN*/  0428
         MVI   SINK+1(SINKAD),X'60'                                0428
*                               SINKAD = SINKAD + 2;               0429
         AH    SINKAD,@CH00059                                     0429
*                               CURSAD = SPECAR;                   0430
         LR    CURSAD,SPECAR                                       0430
*                            END;                                  0431
*                          ELSE CURSAD = SPECAR;                   0432
         B     @RC00425                                            0432
@RF00425 LR    CURSAD,SPECAR                                       0432
*                     IF DACDSSCR ^= DACANSCR                      0433
*                          THEN                                    0433
@RC00425 CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0433
         BE    @RF00433                                            0433
*                            DO;                                   0434
*           GEN SETS(REG0,SPECAR) FLOWS(RTABUILD) SEQFLOW ; /*Y02947*/
         SR    REG0,REG0                     CLEAR A WORK REGISTER
*                                      LEAVE A NULL IN REG 0
         BAL   SPECAR,RTABUILD
*                            END;                                  0436
*                          ELSE;                                   0437
@RF00433 DS    0H                                                  0438
*                     IF RMTDV = '0'B                              0438
*                          THEN GO TO OUTNORM;                     0438
         TM    RMTDV(DACAD),B'00000001'                            0438
         BZ    @RT00438                                            0438
*                          ELSE                                    0440
*                            DO;                                   0440
*                     SINK(1) = '03'X; /*PUT AN ETX IN THE SINK*/  0441
         MVI   SINK(SINKAD),X'03'                                  0441
*                     SINKAD = SINKAD + 1;                         0442
         AH    SINKAD,@CH00061                                     0442
*                               GO TO OUTNORM;                     0443
         B     OUTNORM                                             0443
*                            END;                                  0444
*                  END;                                            0445
*           GEN;                                                   0446
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0447
*/*     PRECEDING CODE -                                       */  0447
*/*WIT:          D (NO,%NUF,YES,OUTSINK) WILL EXCEDE SINK ?    */  0447
*/*%NUF:         D (NO,%SOMOK,YES,) IS PROT OR RVOID ON & SOMHER   0447
*/*                OFF & SHRD OFF ?                            */  0447
*/*              P PUT SET FIELD, ATTRIBUTE IN SINK, BUMP          0447
*/*                SINK, SET SOMHER ON                         */  0447
*/*              P SAVE ADDRESS OF SF IN SOMADD, INCREMENT         0447
*/*                CURSAD                                      */  0447
*/*%SOMOK:       D (NO,%NOBLAT,YES,) IS BLAT ON ?              */  0447
*/*              P TURN BLAT OFF                               */  0447
*/*              D (YES,,NO,%MIDDLE) AT END OF 2260 ?          */  0447
*/*              P SET CURLIN TO 0, CURSAD TO 0                */  0447
*/*              D (YES,,NO,%NOSOM0) SOM IN POSITION 0 ?       */  0447
*/*              P INCREMENT CURSAD ONE POSITION               */  0447
*/*%NOSOM0:      P PUT SBA ORDER IN SINK, BUMP SINK            */  0447
*/*              S (,%NOBLAT) OUTVERT:CONVERT HEXIDECIMAL TO       0447
*/*                3270 BUFFER                                 */  0447
*/*%MIDDLE:      P INCREMENT CURLIN, SET CURSAD TO NEXT LINE   */  0447
*/*              P PUT SBA ORDER IN SINK, BUMP SINK            */  0447
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447
*/*%NOBLAT:      P PUT INSERT CURSOR IN SINK, BUMP SINK        */  0447
*/*              D (NO,%EQSCRN,YES,) 3270 SIZE = 2260 SIZE         0447
*/*                ?                                           */  0447
*/*              P PUT SBA IN SINK, BUMP SINK, SET CURSAD TO       0447
*/*                LAST 2260 POSITION                          */  0447
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447
*/*                3270 BUFFER                                 */  0447
*/*%EQSCRN:      D (NO,%EQWIDE,YES,) ANWIDE = DSWIDE ?         */  0447
*/*              P PUT SBA IN SINK, BUMP SINK                  */  0447
*/*              P SET CURSAD ONE PAST 2260 PORTION            */  0447
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447
*/*                3270 BUFFER                                 */  0447
*/*%EQWIDE:      D (YES,,NO,CLERLOOP) CURLIN = MAXIMUM 2260        0447
*/*                LINE ?                                      */  0447
*/*              P DECREMENT CURLIN ONE                        */  0447
*/*CLERLOOP:     P PUT SBA IN SINK, BUMP SINK, CURSAD = END        0447
*/*                OF CURRENT 2260 LINE                        */  0447
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447
*/*              P BUMP CURLIN                                 */  0447
*/*              D (YES,SETPROT,NO,) CURLIN = MAXIMUM 2260         0447
*/*                LINE ?                                      */  0447
*/*              P SET RTA IN SINK, BUMP SINK, CURSAD TO           0447
*/*                BEGINNING OF NEXT LINE                      */  0447
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447
*/*              P (,CLERLOOP) PUT NULL IN SINK                */  0447
*/*SETPROT:      D (NO,%NOPROT,YES,) PROT = YES SPECIFIED          0447
*/*                ?                                           */  0447
*/*              P PUT SF, PROTECTED ATTRIBUTE IN SINK, BUMP       0447
*/*                SINK TWO                                    */  0447
*/*              P (,%SOPROT) RESTORE CURSAD                   */  0447
*/*%NOPROT:      P RESTORE CURSAD                              */  0447
*/*%SOPROT:      D (NO,%NOTEQU,YES,) 3270 SIZE = 2260 SIZE ?   */  0447
*/*              P SET CHARACTER TO NULL, RETURN TO NEXT           0447
*/*                SEQUENTIAL INSTRUCTION                      */  0447
*/*              S RTABUILD:BUILD RTA(S) TO POSITION ZERO      */  0447
*/*%NOTEQU:      D (NO,%REMOT,YES,OUTNORM) IS RMTDV OFF ?      */  0447
*/*%REMOT:       D (NO,OUTSINK,YES,%ETX) ONE BYTE LEFT IN SINK?*/  0447
*/*%ETX:         P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0447
*        GEN;                                                      0447
         EJECT
*/**************************************************************/  0448
*/**************************************************************/  0448
*/* READ INITIAL ENTRY FROM HOUSEKEEPING FOR INPUT DATA        */  0448
*/*     STREAMS. ENTRY READ1 IS USED WHEN PROCESSING READ      */  0448
*/*     BUFFER, AS THE PROCESSING LOOP ENTRY. READ1 IS         */  0448
*/*     ENTERED FROM RDLAT (MORTST), AND KERF (INCREM).        */  0448
*/*      READ TESTS FOR AN SOH AND IF PRESENT PASSES           */  0448
*/*     CONTROL TO OUTERR. IF THE DEVICE IS REMOTE, THE        */  0448
*/*     CONTENT OF DACDSAD REPLACES THE 3270 DEVICE ADDRESS.   */  0448
*/*     THE AID IS TESTED FOR PA1,2,3 OR THE CLEAR KEY         */  0448
*/*     BEING DEPRESSED. IF SO, THE AID IS PLACED IN THE       */  0448
*/*     SINK, AN END FRAMING CHARACTER IS INSERTED IF          */  0448
*/*     NEEDED, AND CONTROL IS PASSED TO OUTSPEC. FOR A        */  0448
*/*     READ BUFFER OPERATION, PROCESSING IS INITIATED         */  0448
*/*     IN READ1 ON A LINE AT A TIME BASIS, CONTROL IS         */  0448
*/*     PASSED TO RDLAT. READ1 TESTS ON SUBSEQUENT             */  0448
*/*     ENTRIES FOR THE CURRENT PROCESSING LINE BEING EQUAL    */  0448
*/*     TO THE LAST 2260 LINE AND IF SO, BRANCHES TO           */  0448
*/*     READOUT IN SOURTST. FOR READ TYPES OTHER THAN          */  0448
*/*     READ BUFFER, THE CURSOR POSITION IS RELATED TO A       */  0448
*/*     TRUE CORE ADDRESS. IF AN SBA SEQUENCE IS PRESENT       */  0448
*/*     THE FIELD POSITION IS RELATED TO A TRUE CORE           */  0448
*/*     ADDRESS. IF NO SBA SEQUENCE IS PRESENT, THE DATA       */  0448
*/*     STREAM IS SEARCHED FOR AN X'4A' (Ö) AND IF FOUND,      */  0448
*/*     ITS POSITION BECOMES THE FIELD POSITION. IF THE        */  0448
*/*     SBA SEQUENCE IS PRESENT, SOURTST RECEIVES CONTROL.     */  0448
*/*     IF THE SBA IS NOT PRESENT, CKSMI IN SOURTST RECEIVES   */  0448
*/*     CONTROL.                                               */  0448
*/*                                                            */  0448
*/**************************************************************/  0448
*/**************************************************************/  0448
*READ:;                                                            0448
READ     DS    0H                                                  0449
*           IF SOURCE(1) = '01'X       /*IF THIS IS ERROR MSG  */  0449
*                THEN GO TO OUTERR;                                0449
         CLI   SOURCE(SOURAD),X'01'                                0449
         BE    @RT00449                                            0449
*                ELSE;                                             0451
*           IF RMTDV = '1'B                                        0452
*                THEN                                              0452
         TM    RMTDV(DACAD),B'00000001'                            0452
         BNO   @RF00452                                            0452
*                  DO;                                             0453
*                     SINK(1) = DACDSAD;                           0454
         MVC   SINK(1,SINKAD),DACDSAD(DACAD)                       0454
*                     SINKAD = SINKAD + 1; /*INCREMENT         */  0455
         AH    SINKAD,@CH00061                                     0455
*                     SOURAD = SOURAD + 2; /*INCREMENT 2       */  0456
         AH    SOURAD,@CH00059                                     0456
*                  END;                                            0457
*                ELSE;                                             0458
@RF00452 DS    0H                                                  0459
*           IF SOURCE(1) = '6C'X × SOURCE(1) = '6E'X × SOURCE(1) = 0459
*              '6B'X × SOURCE(1) = '6D'X × SOURCE(1) = '60'X       0459
*                THEN                                              0459
         CLI   SOURCE(SOURAD),X'6C'                                0459
         BE    @RT00459                                            0459
         CLI   SOURCE(SOURAD),X'6E'                                0459
         BE    @RT00459                                            0459
         CLI   SOURCE(SOURAD),X'6B'                                0459
         BE    @RT00459                                            0459
         CLI   SOURCE(SOURAD),X'6D'                                0459
         BE    @RT00459                                            0459
         CLI   SOURCE(SOURAD),X'60'                                0459
         BNE   @RF00459                                            0459
@RT00459 DS    0H                                                  0460
*                  DO;                                             0460
*                     SINK(1) = SOURCE(1);                         0461
         MVC   SINK(1,SINKAD),SOURCE(SOURAD)                       0461
*                     IF RMTDV = '1'B                              0462
*                          THEN                                    0462
         TM    RMTDV(DACAD),B'00000001'                            0462
         BNO   @RF00462                                            0462
*                            DO;                                   0463
*                               SINK(2) = SOURCE(4);               0464
         MVC   SINK+1(1,SINKAD),SOURCE+3(SOURAD)                   0464
*                     SINKAD = SINKAD + 2;                         0465
         AH    SINKAD,@CH00059                                     0465
*                            END;                                  0466
*                          ELSE SINKAD = SINKAD + ONE;             0467
         B     @RC00462                                            0467
@RF00462 AL    SINKAD,ONE                                          0467
*                     GO TO OUTSPEC;                               0468
         B     OUTSPEC                                             0468
*                  END;                                            0469
*                ELSE;                                             0470
@RF00459 DS    0H                                                  0471
*           IF RDBUF = '1'B                                        0471
*                THEN                                              0471
         TM    RDBUF(DACAD),B'00000001'                            0471
         BNO   @RF00471                                            0471
*                  DO;                                             0472
*                     IF SOURCE(4) = '11'X                         0473
*                          THEN SOURAD = SOURAD + 6;               0473
         CLI   SOURCE+3(SOURAD),X'11'                              0473
         BNE   @RF00473                                            0473
         AH    SOURAD,@CH00283                                     0474
*                          ELSE SOURAD = SOURAD + 3;               0475
         B     @RC00473                                            0475
@RF00473 AH    SOURAD,@CH00102                                     0475
*                     SHRD = '0'B;                                 0476
@RC00473 NI    SHRD(DACAD),B'10111111'                             0476
*                     CURLIN = CURLIN - CURLIN;                    0477
         SLR   CURLIN,CURLIN                                       0477
*/**************************************************************/  0478
*/*                                                            */  0478
*/* READ1      FROM      MORTST, INCREM                        */  0478
*/*      READ BUFFER SETUP FOR PASS THROUGH RDLAT              */  0478
*/**************************************************************/  0478
*READ1:;                              /*READ BUFFER            */  0478
READ1    DS    0H                                                  0479
*                     LINGRO = DSWIDE; /*GET 2260 WIDTH        */  0479
         SLR   LINGRO,LINGRO                                       0479
         IC    LINGRO,DSWIDE(,DACAD)                               0479
*                     SPECAR = DSLINE; /*GET 2260 LINE CNT     */  0480
         SLR   SPECAR,SPECAR                                       0480
         IC    SPECAR,DSLINE(,DACAD)                               0480
*                     IF CURLIN = SPECAR                           0481
*                          THEN GO TO READOUT;                     0481
         CR    CURLIN,SPECAR                                       0481
         BE    @RT00481                                            0481
*                          ELSE GO TO RDLAT;                       0483
         B     RDLAT                                               0483
*                  END;                                            0484
*                ELSE                                              0485
*                  DO;                                             0485
@RF00471 DS    0H                                                  0486
*                     SOURAD = SOURAD + ONE;                       0486
         AL    SOURAD,ONE                                          0486
*                     GEN SETS(CURSAD,CARADD,SOURAD) FLOWS(INVERT) 0487
*                       SEQFLOW ;  /*Y02947*/                      0487
         SR    CURSAD,CURSAD            CLEAR REGISTER
         IC    CURSAD,0(SOURAD)
         SLL   CURSAD,8
         IC    CURSAD,1(SOURAD)
         BAL   CARADD,INVERT            GO CONVERT ADDRESS
         LA    CARADD,0(CARADD)
         LA    SOURAD,2(SOURAD)         INCREMENT SOURCE
*           GEN REFS (CURSAD,DACAD,ANWIDE,DSLINE,DSWIDE)           0488
*               SETS(DACCRS,WORKREG4,WORKREG3,REG0)                0488
*                 FLOWS(OUTCURS) SEQFLOW;                    /*Y02947*/
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER
         LR    WORKREG3,CURSAD           PICK UP CURSOR POSITION
         SR    REG0,REG0              CLEAR A WORK REGISTER
         IC    REG0,ANWIDE(DACAD)         PICK UP 3270 WIDTH
         DR    WORKREG4,REG0            GET ROW COLUMN OF CURSOR
         IC    REG0,DSLINE(DACAD)         PICK UP MAX 2260 LINE
         CR    WORKREG3,REG0          IS CURSOR BEYOND MAX 2260 LINE
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'
         IC    REG0,DSWIDE(DACAD)         PICK UP MAX 2260 COLUMN
         CR    WORKREG4,REG0            IS CURSOR BEYOND MAX COLUMN
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'
         STH   CURSAD,DACCRS(DACAD)
*RDSBATST:;                                                        0489
RDSBATST DS    0H                                                  0490
*           SOMADD = CURSAD;                                       0490
         LR    SOMADD,CURSAD                                       0490
*           IF SOURCE(1) = '11'X                                   0491
*                          THEN                                    0491
         CLI   SOURCE(SOURAD),X'11'                                0491
         BNE   @RF00491                                            0491
*                            DO;                                   0492
*           GEN SETS(SPECAR,DACIND) REFS(DACAD,HAF3)               0493
*                       SEQFLOW ; /*Y02947*/                       0493
         SR    SPECAR,SPECAR
         IC    SPECAR,DACIND(DACAD)
         AH    SPECAR,HAF3
         STC   SPECAR,DACIND(DACAD)
*                               SOMHER = '1'B;                     0494
         OI    SOMHER(DACAD),B'00001000'                           0494
*          GEN SETS(CURSAD,SOURAD,CARADD,REG0,WORKREG4,WORKREG3)   0495
*                REFS(ANWIDE,DACAD,DSLINE,DSWIDE)                  0495
*                      FLOWS(INVERT,RDOPTST)  SEQFLOW ; /*Y02947*/ 0495
         SR    CURSAD,CURSAD
         IC    CURSAD,1(SOURAD)
         SLL   CURSAD,8
         IC    CURSAD,2(SOURAD)
         LA    SOURAD,3(SOURAD)
         BAL   CARADD,INVERT
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR  CODE2
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR    CODE2
         IC    REG0,ANWIDE(DACAD)   PICK UP 3270 WIDTH           CODE2
         IC    WORKREG3,DSLINE(DACAD)  PICK UP 2260 LINE COUNT   CODE2
         MR    WORKREG4,REG0        COMPUTE END OF 2260 PLUS     CODE2
*                                  THE DIFFERENCE 3270-2260      CODE2
         SR    WORKREG4,WORKREG4   CLEAR A WORK REGISTER         CODE2
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH    CODE2
         SR    REG0,WORKREG4        GET SCREEN WIDTH DIFFERENCE  CODE2
         SR    WORKREG3,REG0       GET END OF 2260 SCREEN + 1    CODE2
*                                  IN 3270 BUFFER UNITS         CODE2
         CR    CURSAD,WORKREG3     SOM POINT 1 PAST END OF 2260 CODE2
         BNE   RDOPTST             NO, GO AHEAD AND USE IT      CODE2
         SR    CURSAD,CURSAD       YES, POINT IT TO FIRST       CODE2
*                                  POSITION OF SCREEN           CODE2
*RDOPTST:                       SPECAR = CURSAD;                   0496
RDOPTST  LR    SPECAR,CURSAD                                       0496
*                               CURSAD = SOMADD;                   0497
         LR    CURSAD,SOMADD                                       0497
*           CARADD = SPECAR // DSWIDE;                             0498
         SLR   @12,@12                                             0498
         IC    @12,DSWIDE(,DACAD)                                  0498
         LR    @00,SPECAR                                          0498
         SRDA  @00,32                                              0498
         DR    @00,@12                                             0498
         LR    CARADD,@00                                          0498
*           IF CARADD ^= FULL0                                     0499
*                THEN                                              0499
         C     CARADD,FULL0                                        0499
         BE    @RF00499                                            0499
*                  DO;                                             0500
*           CARADD = DSWIDE - CARADD;                              0501
         SLR   @12,CARADD                                          0501
         LR    CARADD,@12                                          0501
*           GEN SETS(LINGRO,DACIND) REFS(DACAD,CARADD)             0502
*                  SEQFLOW ;   /*Y02947*/                          0502
         SR    LINGRO,LINGRO
         IC    LINGRO,DACIND(DACAD)
         AR    LINGRO,CARADD
         STC   LINGRO,DACIND(DACAD)
*                  END;                                            0503
*                ELSE;                                             0504
@RF00499 DS    0H                                                  0505
*                            END;                                  0505
*                          ELSE;                                   0506
@RF00491 DS    0H                                                  0507
*                     IF RDMI = '1'B                               0507
*                          THEN SHRD = '0'B;                       0507
         TM    RDMI(DACAD),B'00000100'                             0507
         BNO   @RF00507                                            0507
         NI    SHRD(DACAD),B'10111111'                             0508
*                          ELSE SHRD = '1'B;                       0509
         B     @RC00507                                            0509
@RF00507 OI    SHRD(DACAD),B'01000000'                             0509
*                  END;                                            0510
@RC00507 DS    0H                                                  0511
*           IF SOMHER = '1'B                                       0511
*                THEN                                              0511
         TM    SOMHER(DACAD),B'00001000'                           0511
         BNO   @RF00511                                            0511
*                  DO;                                             0512
*                     LINGRO = LINGRO - LINGRO;                    0513
         SLR   LINGRO,LINGRO                                       0513
*           GEN;                                                   0514
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0515
*/*     PRECEDING CODE -                                       */  0515
*/*READ:         D (YES,OUTERR,NO,%REMTST) IS SOH FIRST ?      */  0515
*/*%REMTST:      D (YES,,NO,%GO002) RMTDV ON ?                 */  0515
*/*              D (YES,OUTSINK,NO,%GO001) SINK EXPENDED ?     */  0515
*/*%GO001:       P (,%AIDTST) PUT 2260 DEVICE ADDRESS IN SINK      0515
*/*                AND BUMP SOURCE BY TWO, SINK BY ONE         */  0515
*/*%GO002:       D (YES,OUTSINK,NO,%AIDTST) SINK EXPENDED ?    */  0515
*/*%AIDTST:      D (YES,,NO,%RDBUF) AID FROM PA1,2,3 OR CLEAR ?*/  0515
*/*              P PUT AID IN SINK                             */  0515
*/*              D (YES,,NO,%GO003) RMTDV ON ?                 */  0515
*/*              P (,OUTSPEC) PUT END FRAMING IN SINK, BUMP        0515
*/*                SINK BY TWO                                 */  0515
*/*%GO003:       P (,OUTSPEC) BUMP SINK BY ONE                 */  0515
*/*%RDBUF:       D (YES,,NO,%GO006) READ BUFFER OPERATION ?    */  0515
*/*              D (YES,,NO,%NOSBA) SBA NEXT IN SOURCE ?       */  0515
*/*              P (,%GO004) BUMP SOURCE BY SIX                */  0515
*/*%NOSBA:       P BUMP SOURCE BY THREE                        */  0515
*/*%GO004:       P SET SHRD OFF, SET CURLIN TO ZERO            */  0515
*/*READ1:        D (YES,READOUT,NO,RDLAT) ALL 2260 LINES DONE ?*/  0515
*/*%GO006:       P INCREMENT SOURCE, GET CURSOR ADDRESS IN         0515
*/*                CURSAD                                      */  0515
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXADECIMAL   */  0515
*/*              D (YES,RDSBATST,NO,OUTCURS) CURSOR ON 2260 ?  */  0515
*/*RDSBATST:     P SAVE CURSAD TEMPORARILY IN SOMAOD           */  0515
*/*              D (YES,,NO,%GO007) SBA NEXT IN SOURCE ?       */  0515
*/*              P BUMP DACIND BY THREE, SET SOMHER ON, GET        0515
*/*                FIRST DATA ADDRESS                          */  0515
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXIDECIMAL   */  0515
*/*RDOPTST:      P SAVE SOM ADDRESS IN SPECAR, RESTORE CURSAD  */  0515
*/*              P CALCULATE OFFSET TO FIRST INTEGRAL LINE         0515
*/*                BOUNDRY, BUMP DACIND BY OFSET               */  0515
*/*%GO007:       D (YES,,NO,%GO008) READ MI OPERATION ?        */  0515
*/*              P  (,%GO009) SET SHRD OFF                     */  0515
*/*%GO008:       P  SET SHRD ON                                */  0515
*/*%GO009:       D (YES,%GO009A,NO,CKSMI) IS SOMHER ON ?       */  0515
*/*%GO009A:      P (,SOURTST) SET LINGRO TO ZERO               */  0515
*        GEN;                                                      0515
         EJECT
*/**************************************************************/  0516
*/**************************************************************/  0516
*/*                                                            */  0516
*/* SOURTST ENTERED FROM READ FOR THE PURPOSE OF ESTABLISHING  */  0516
*/*     THE BOUNDRIES OF DATA CONVERSION. SOURTST IS ALSO      */  0516
*/*     ENTERED FROM CKSMI (IN SOURTST) AFTER LOCATING AN      */  0516
*/*     SMI (Ö) IN THE DATA STREAM. SOURTST INCREMENTS         */  0516
*/*     DACIND TO POINT TO THE FIRST LINE BOUNDRY IN THE       */  0516
*/*     DATA STREAM, PLACES THE LENGTH TO BE PROCESSED         */  0516
*/*     IN LINGRO (SCREEN WRAP IS CONSIDERED), AND BRANCHES    */  0516
*/*     TO RDLAT.                                              */  0516
*/*                                                            */  0516
*/*         CKSMI IS ENTERED FROM READ IF NO SBA SEQUENCE      */  0516
*/*     EXISTS IN THE DATA STREAM. ITS PURPOSE IS TO           */  0516
*/*     LOCATE AN X'4A' (Ö) IN THE DATA STREAM. IF THE SMI     */  0516
*/*     IS LOCATED CONTROL IS PASSED TO SOURTST. IF NO         */  0516
*/*     SMI CAN BE FOUND, THE NO SMI PRESENT BIT IS SET ON     */  0516
*/*     IN DACFLG AND CONTROL IS PASSED TO OUTNORM (IN         */  0516
*/*     OUTPROC). THIS IS ACCOMPLISHED BY READOUT.             */  0516
*/*                                                            */  0516
*/*         READOUT IS THE ROUTE TAKEN BY THE READ             */  0516
*/*     PROCESSING ROUTINES FOR NORMAL EXIT. READOUT           */  0516
*/*     INSERTS AN ETX IF NEEDED, AND BRANCHES TO OUTNORM      */  0516
*/*     (IN OUTPROC).                                          */  0516
*/*                                                            */  0516
*/**************************************************************/  0516
*/**************************************************************/  0516
*SOURTST:;                                                         0516
SOURTST  DS    0H                                                  0517
*                     SOMADD = SPECAR;  /*SAVE SOM ADDRESS     */  0517
         LR    SOMADD,SPECAR                                       0517
*                GEN SETS(WORKREG4,WORKREG3,REG0,SPECAR,DACSINAD,BLAT,
*                            CARADD,CURSAD,DACFLG,LINGRO,SOMADD,LNGDT)
*                    REFS(DACAD,DACOPTYP,PROT,DACDSSCR,            0518
*                            DACANSCR,SOMHER)                      0518
*                    FLOWS(SOURTST,READOUT) SEQFLOW  ;    /*Y02947*/
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2
         CR    CURSAD,SOMADD       SOM RELATIVE TO CURSOR ?     CODE2
         BL    WRAP                WE HAVE SCREEN WRAPAROUND    CODE2
         BE    READOUT             WE HAVE NO DATA              CODE2
         LR    WORKREG3,CURSAD     GET CURSOR POINTER           CODE2
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH           CODE2
         DR    WORKREG4,REG0        LINE HOLDING CURSOR - 1     CODE2
         LR    SPECAR,WORKREG3     SAVE CURSORS LINE            CODE2
         SR    WORKREG4,WORKREG4       CAN THE REMAINDER        CODE2
         LR    WORKREG3,SOMADD     PICK UP THE SOM POINTER      CODE2
         DR    WORKREG4,REG0         LINE HOLDING SOM - 1       CODE2
         LR    CURLIN,WORKREG3    SAVE SOMS LINE                YA01252
         SR    SPECAR,WORKREG3    GET THE LINE DIFFERENCE       CODE2
         LTR   LINGRO,LINGRO           DO WE HAVE SCREEN WRAP?  YA01252
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ?     YA01252
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252
         SR    WORKREG4,WORKREG4       CLEAR                    YA01252
         IC    WORKREG4,DSLINE(DACAD)  PICK UP 2260 LINE COUNT  YA01252
         SR    WORKREG4,WORKREG3     GET DIFFERENCE             YA01252
         LA    WORKREG4,0(WORKREG4)  INSURE HIGH BYTE CLEAR     YA01252
         STC   WORKREG4,DACSINAD(DACAD) SAVE VALUE              YA01252
SOURTST1 EQU   *                   NOT SMI WRAP AND COMMON      YA01252
         SR    WORKREG4,WORKREG4    CAN THE REMAINDER           YA01252
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH   CODE2
         SR    REG0,WORKREG4      GET SCREEN WIDTH DIFFERENCE   CODE2
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR YA01252
         LR    WORKREG3,SPECAR     GET THE LINE DIFFERENCE      CODE2
         MR    WORKREG4,REG0       RIGHT BYTES LOST TO NULLS    CODE2
         LR    CARADD,CURSAD       KEEP CURSAD INTACT           CODE2
         SR    CARADD,SOMADD       3270 SCREEN POSITIONS SPANND CODE2
         SR    CARADD,WORKREG3     REDUCE BY LOST NULL COUNT    CODE2
         LTR   LINGRO,LINGRO
         BZ    NOWRAP
         TM    DACOPTYP(DACAD),X'40'
         BNO   PROTWRAP
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)
         BNE   PROTWRAP
         BCTR  CARADD,0
***********************************************************************
*
*   PROTWRAP   FROM      FIXIT
*        ADJUST FOR PROTECTED FIELD DURING SCREEN WRAP ON A
*   READ OPERATION
***********************************************************************
PROTWRAP EQU   *
         SR    WORKREG4,WORKREG4
         SR    WORKREG3,WORKREG3
         IC    WORKREG4,DSLINE(DACAD)
         IC    WORKREG3,ANLINE(DACAD)
         SR    WORKREG3,WORKREG4
         SR    WORKREG4,WORKREG4
         IC    WORKREG4,DSWIDE(DACAD)
         MR    WORKREG4,WORKREG4
         SR    CARADD,WORKREG3
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ? LD @ZA00540
         BZ    PROTWRAX            NO, DON'T ADJUST FOR WRAP    CODE2
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2
         SR    WORKREG4,WORKREG4   CLEAR EVEN OF EVEN/ODD PAIR  CODE2
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR   CODE2
         IC    REG0,ANWIDE(DACAD)   GET 3270 WIDTH              CODE2
         IC    WORKREG3,DSLINE(DACAD)  GET 2260 LINE COUNT      CODE2
         MR    WORKREG4,REG0        END ADDRESS OF LAST 3270    CODE2
*                                  LINE CONTAINING A 2260 LINE  CODE2
         SR    WORKREG4,WORKREG4    CLEAR A WORK REGISTER       YA01252
         IC    WORKREG4,DSWIDE(DACAD)  GET 2260 WIDTH           CODE2
         SR    REG0,WORKREG4       DIFFERENCE 3270 - 2260 WIDTH CODE2
         SR    15,0                LAST 2260 SCREEN POSITION    CODE2
*                                  PLUS ONE                     CODE2
         LR    CARADD,WORKREG3     SAVE                         CODE2
         SR    WORKREG3,WORKREG3   CLEAR                        YA01252
         IC    WORKREG3,DACSINAD(DACAD)  PICK UP DIFFERENCE     YA01252
         XC    DACSINAD(1,DACAD),DACSINAD(DACAD) CLEAR BYTE     YA01252
         MR    WORKREG4,REG0        COMPUTE BYTES LOST          YA01252
         SR    CARADD,WORKREG3     REDUCE COUNT                 YA01252
         SR    CARADD,SOMADD       COMPUTE DATA LENGTH          CODE2
PROTWRAX EQU   *                                                CODE2
         LR    CURSAD,CARADD
         AR    CURSAD,SOMADD
***********************************************************************
*
*   NOWRAP     FROM      FIXIT, PROTWRAP
*        SET LENGTH FOR PROCESSING READ DATA
***********************************************************************
NOWRAP   EQU   *
         TM    21(DACAD),X'80'     CHECK RVOID=YES             @YA03964
         BZ    NOWRAP2             BR IF NO                    @YA03964
         LR    WORKREG3,SOURAD     LOAD CURRENT SOURCE ADR     @YA03964
         L     WORKREG4,4(DACAD)   LOAD ORIGINAL SOURCE ADR    @YA03964
         LA    WORKREG4,0(WORKREG4)     CLEAR HI ORDER BYTE    @YA03964
         SR    WORKREG3,WORKREG4   GET PROCESSED LENGTH        @YA03964
         LH    CARADD,12(DACAD)    LOAD ORIG. SOURCE LENGTH    @YA03964
         SR    CARADD,WORKREG3     REMAINDER IN CARADD         @YA03964
NOWRAP2  EQU   *                                               @YA03964
         LR    WORKREG3,CARADD
         LA    WORKREG4,255               EXCEDES 255 BYTES
         CR    WORKREG3,WORKREG4          IF NO
         BNH   UND256                   GO SET ACTUAL IF YES
         LA    LINGRO,255               SET AT 255
         OI    DACFLG(DACAD),X'10'      SET LONG DATA FLAG
         B     OVR256                   GO SET IT UP
***********************************************************************
*
*   WRAP       FROM      SOURTST
*        SCREEN WRAP ON A READ (CURSOR POSITION LESS THAN SOM
***********************************************************************
WRAP     EQU   *                        WRAPAROUND PRESENT
         TM    DACFLG(DACAD),X'08' SOMHER FLAG ON (SBA IN DATA) CODE2
         BO    WRAP1               YES, NOT OPERATOR SMI        CODE2
         OI    DACFLG(DACAD),X'80' SET BLAT FLAG TO INDICATE    CODE2
*                                  WRAP WITH OPERATOR SMI       CODE2
WRAP1    EQU   *                   CODE2
         SR    LINGRO,LINGRO            CLEAR FOR SET GROUP
         IC    LINGRO,ANLINE(DACAD)         GET 3270 LINE COUNT
         SR    CARADD,CARADD            CLEAR FOR WORK
         IC    CARADD,ANWIDE(DACAD)         GET 3270  WIDTH
         TM    DACOPTYP(DACAD),X'40'
         BO    TOPLOST
         LR    WORKREG3,CARADD                PUT IN WORK AND
         MR    WORKREG4,LINGRO                CALCULATE LAST
         LR    LINGRO,WORKREG3                SAVE
         AR    CURSAD,LINGRO            MOVE CURSOR BY SCREN
         B     SOURTST                  GO BACK AND TRY 'GIN
TOPLOST  EQU   *
         IC    LINGRO,DSLINE(DACAD)
         IC    WORKREG3,DSWIDE(DACAD)
         MR    WORKREG4,LINGRO
         LR    CURSAD,WORKREG3
         SR    LINGRO,LINGRO
         B     SOURTST
***********************************************************************
*
*   UND256     FROM      NOWRAP
*        SET CALCULATED LENGTH IN LINGRO
***********************************************************************
UND256   EQU   *                        LESS THAN 256 BYTES
         LR    LINGRO,WORKREG3                SET REAL LENGTH
***********************************************************************
*
*   OVR256     FROM      NOWRAP, UND256
*        OUT TO RDLAT AFTER READ DATA LENGTH SET
***********************************************************************
OVR256   EQU   *                        MORE THAN 256
         SR    SOMADD,SOMADD       SOM TO ZERO FOR PROCESSING   YA01253
         LR    CURSAD,CARADD       SAVE REAL LENGTH IN CURSAD   YA01252
*                  END;                                            0519
*                ELSE                                              0520
*                  DO;                                             0520
         B     @RC00511                                            0520
@RF00511 DS    0H                                                  0521
*/**************************************************************/  0521
*/*                                                            */  0521
*/* CKSMI      FROM      READ1, NOSTART                        */  0521
*/*      SBA SEQUENCE NOT FOUND, SEARCH FOR SMI                */  0521
*/**************************************************************/  0521
*CKSMI:;                                /*SET UP LEN YO BE     */  0521
CKSMI    DS    0H                                                  0522
*           GEN SETS(WORKREG3,WORKREG4,LINGRO)                     0522
*                 REFS(DACSRCAD,DACSRCLN,DACAD,SOURAD,FULL0)       0522
*                      FLOWS(SMILOOP,NOSTART) SEQFLOW ; /*Y02947*/ 0522
         LA    WORKREG3,255                   SEARCHED IN ATTEMPT
         L     WORKREG4,DACSRCAD(DACAD)       TO FIND AN SMI
         AH    WORKREG4,DACSRCLN(DACAD)       CHARACTER-GET TRUE
         SR    WORKREG4,SOURAD            REMAINING SOURCE
         CR    WORKREG3,WORKREG4          IS IT LESS THAN 256
         BNL   UNDER256                 YES, SET UP REST
         LA    LINGRO,255               NO, SET UP MAXIMUM
         B     SMILOOP                  GO LOOK FOR SMI
***********************************************************************
*
*   UNDER256   FROM      CKSMI
*        TOTAL SEARCH LENGTH IS 255 OR LESS
***********************************************************************
UNDER256 EQU   *
         LR    LINGRO,WORKREG4                SET UP REMAINDER
         C     LINGRO,FULL0
         BNH   NOSTART
*/**************************************************************/  0523
*/*                                                            */  0523
*/* SMILOOP    FROM      CKSMI, NOTSMI, UNDER256               */  0523
*/*      SEARCH FOR SMI (Ö)                                    */  0523
*/**************************************************************/  0523
*SMILOOP:;                              /*LOOK FOR SMI         */  0523
SMILOOP  DS    0H                                                  0524
*           GEN DEFS(NOSTART) FLOWS(SOURTST,BACKGO,CKSMI) SEQFLOW  0524
*                SETS(LINGRO,SOURAD,SPECAR,CARADD,WORKREG3,        0524
*                     WORKREG4,SINKAD,SOURAD,DACFLG,NOSMI)         0524
*                REFS(DACAD,DACSRCAD,RMTDV,STXHER,DSWIDE,ANWIDE,   0524
*                     FULL0,DACSINAD,DACSRCLN)    ;      /*Y02947*/
         BCTR  LINGRO,0                 TRUE COUNT FOR XLATE
         EX    LINGRO,XLATE             TRANS AND TEST SOURC
         BC    8,NOSTART1               BRANCH IF TEST FAILS
         AR    LINGRO,SOURAD            SET GROUP TO UNTESTD
         SR    LINGRO,CARADD            PORTION
         LA    SOURAD,1(CARADD)         SET ON PAST CHARACT
         CLI   0(CARADD),X'03'
         BE    ENDAT
         CLI   0(CARADD),X'4A'          IS IT AN SMI
         BNE   NOTSMI                   NO, GO SEE IF MORE
         L     SPECAR,DACSRCAD(DACAD)    PICK UP CORE ADDRESS
         LA    SPECAR,3(SPECAR)         OF FIRST DATA BYTE
         SR    CARADD,SPECAR            COMPUTE BUFFER POSIT
         LA    SPECAR,1(CARADD)        OF SMI
         TM    DACFLG(DACAD),X'01'
         BNO   ADJUST                  NO, GO COMPUTE LOST NULLS
         BCTR  SPECAR,0                 DECREMENT FOR TWO
         BCTR  SPECAR,0                 BYTE 3270 ADDRESS
         TM    DACFLG(DACAD),X'02'
         BNO   ADJUST                 NO, GO COMPUTE LOST NULLS
         BCTR  SPECAR,0                 DECREMENT FOR STX
***********************************************************************
*
*   ADJUST     FROM     SMILOOP
*        COMPUTE LOST NULLS AND ADJUST SMI POSITION
***********************************************************************
ADJUST   EQU   *                      COMPUTE LOST NULLS
         SR    CARADD,CARADD          CLEAR A REG FOR WORK
         IC    CARADD,DSWIDE(DACAD)       PICK UP DSWIDE
         CR    SPECAR,CARADD          SMI IN FIRST LINE ?
         BL    ADJUST1
         LR    WORKREG3,SPECAR              SAVE THE DISPLACEMENT
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG
         DR    WORKREG4,CARADD              DIVIDE BY DSWIDE
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG
         IC    WORKREG4,ANWIDE(DACAD)           PICK UP ANWIDE
         SR    WORKREG4,CARADD              GET SCREEN DIFFERENCE
         MR    WORKREG4,WORKREG4                  COMPUTE LOST NULLS
         AR    SPECAR,WORKREG3              ADD TO DISPLACEMENT
ADJUST1  EQU   *
         SR    LINGRO,LINGRO
         B     SOURTST
***********************************************************************
*
*   NOTSMI     FROM      SMILOOP
*        CHARACTER FOUND IS NOT AN SMI
***********************************************************************
NOTSMI   C     LINGRO,FULL0             ANY LEFT
         BE    NOSTART                  NO, CHECK REST
         B     SMILOOP                  YES, DO REST
ENDAT    EQU   *
         TM    DACFLG(DACAD),X'01'
         BO    NOTSMI
         L     SOURAD,DACSRCAD(DACAD)
         L     SINKAD,DACSINAD(DACAD)
         B     BACKGO
***********************************************************************
*
*   NOSTART1   FROM      SMILOOP
*        NO CHARACTERS SELECTED BY TEST
***********************************************************************
NOSTART1 AR    SOURAD,LINGRO            INCREMENT BEGINNING
***********************************************************************
*
*   NOSTART    FROM      NOSTART1, NOTSMI
*        TEST FOR ADDITIONAL SOURCE TO TEST
***********************************************************************
NOSTART  EQU   *                        SMI NOT FOUND
         LH    WORKREG3,DACSRCLN(DACAD)       COMPUTE CORE
         A     WORKREG3,DACSRCAD(DACAD)       ADDRESS OF LAST
         BCTR  WORKREG3,0                     CHARACTER IN SOURCE
         CR    WORKREG3,SOURAD                ARE WE THERE
         BH    CKSMI
         OI    DACFLG(DACAD),X'04'
*/**************************************************************/  0525
*/*                                                            */  0525
*/* READOUT    FROM      READ1, MORTST, RDETX, SOURTST         */  0525
*/*      NORMAL EXIT PROCESSING FOR READ OPERATIONS            */  0525
*/**************************************************************/  0525
*RVOIDOUT:;                                                        0525
RVOIDOUT DS    0H                                                  0526
*        GEN SETS(LNGDT,DACFLG) REFS(DACAD) SEQFLOW ;      /*Y02947*/
         NI    DACFLG(DACAD),X'EF' TURN OFF LONG DATA FLAG     YA01252
*READOUT:;                                                         0527
READOUT  DS    0H                                                  0528
*           GEN SETS(SINK,SINKAD,DACFLG,BLAT,SOURAD,CURSAD,        0528
*                   SPECAR,LINGRO)                                 0528
*               REFS(DACAD,RMTDV,DACSRCAD,STXHER,DACCRS)           0528
*               FLOWS(OUTNORM,SOURTST) NOSEQFLOW ;         /*Y02947*/
         TM    DACFLG(DACAD),X'80'  WRAP WITH OPERATOR SMI ?    CODE2
         BO    READOUT1            YES, SET UP TO RETURN TO     CODE2
*                                  FIRST OF DATA STREAM TO      CODE2
*                                  PICK UP LAST OF DATA         CODE2
         TM    DACFLG(DACAD),X'01'
         BZ    OUTNORM               NO, GO CLEAN OUT
         MVI   0(SINKAD),X'03'
         LA    SINKAD,1(SINKAD)
         B     OUTNORM                  GO CLEAN OUT
READOUT1 EQU   *                                                CODE2
         NI    DACFLG(DACAD),X'7F'   TURN OFF BLAT FLAG         CODE2
         L     SOURAD,DACSRCAD(DACAD)   GET SOURCE ORIGIN       CODE2
         LA    SOURAD,3(SOURAD)    POINT TO FIRST DATA BYTE     CODE2
         TM    DACFLG(DACAD),X'01'   REMOTE DEVICE ?            CODE2
         BZ    READOUT3            NO, SOURAD IS CORRECT        CODE2
         LA    SOURAD,2(SOURAD)    BUMP PAST ADDRESS BYTES      CODE2
         TM    DACFLG(DACAD),X'02'   STX IN DATA STREAM ?       CODE2
         BNO   READOUT3            NO, SOURAD IS CORRECT        CODE2
         LA    SOURAD,1(SOURAD)    BUMP PAST STX                CODE2
READOUT3 EQU   *                                                CODE2
         LH    CURSAD,DACCRS(DACAD)  RESTORE CURSOR TO ORIGINAL CODE2
         LA    SPECAR,256          MAX LENGTH                   YA01252
         CR    SPECAR,CURSAD       256 LEFT ?                   YA01252
         BH    READOUT4            YES, CONTINUE SETUP          YA01252
         BCTR  CURSAD,0            REDUCE BY ONE                YA01252
READOUT4 EQU   *                                                YA01252
         SR    SPECAR,SPECAR       SET SOM POINTER TO ZERO      CODE2
         SR    LINGRO,LINGRO       CLEAR WRAP INDICATION        CODE2
         B     SOURTST             GO SET UP SECOND PASS        CODE2
*                  END;                                            0529
*           GEN;                                                   0530
@RC00511 DS    0H                                                  0530
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0531
*/*     PRECEDING CODE -                                       */  0531
*/*SOURTST:      P SAVE SOM ADDRESS IN SOMADD                  */  0531
*/*              D (LOW,WRAP,EQ,READOUT,HI,) CURSOR ADDRESS        0531
*/*                RELATIVE TO SOM ?                           */  0531
*/*              P CALCULATE TOTAL SCREEN DIFFERENCE BETWEEN       0531
*/*                SOM AND CURSOR                              */  0531
*/*              P TEMPORARILY SAVE VALUE IN CARADD            */  0531
*/*              P PICK UP DACIND AND DECREMENT BY THREE       */  0531
*/*              D (YES,,NO,REMOTST) SOMHER ON ?               */  0531
*/*              P DECREMENT MODIFIED DACIND BY THREE          */  0531
*/*REMOTST:      D (YES,,NO,FIXIT) RMTDV ON ?                  */  0531
*/*              P DECREMENT MODIFIED DACIND BY TWO            */  0531
*/*              D (YES,,NO,FIXIT) STXHER ON ?                 */  0531
*/*              P DECREMENT MODIFIED DACIND BY ONE            */  0531
*/*FIXIT:        P INCREMENT DIFFERENCE BY OFFSET FROM SOM TO      0531
*/*                FIRST LINE BOUNDRY                          */  0531
*/*              P DIVIDE RESULT BY 3270 SCREEN WIDTH TO GET       0531
*/*                NUMBER OF LINES SPANNED                     */  0531
*/*              P COMPUTE DIFFERENCE BETWEEN 2260 AND 3270        0531
*/*                SCREEN WIDTHS                               */  0531
*/*              P MULTIPLY WIDTH DIFFERENCE BY NUMBER OF LINES    0531
*/*                SPANNED                                     */  0531
*/*              P DECREMENT CARADD BY RESULT                  */  0531
*/*              D (YES,NOWRAP,NO,) LINGRO = ZERO ?            */  0531
*/*              D (YES,,NO,PROTWRAP) PROT = YES SPECIFIED ?   */  0531
*/*              D (YES,,NO,PROTWRAP) SCREENS EQUAL ?          */  0531
*/*              P DECREMENT CARADD BY ONE                     */  0531
*/*PROTWRAP:     P CALCULATE LINE DIFFERENCE BETWEEN 2260 AND      0531
*/*                3270                                        */  0531
*/*              P MULTIPLY BY 2260 WIDTH                      */  0531
*/*              P DECREMENT CARADD BY RESULT                  */  0531
*/*NOWRAP:       D (YES,,NO,UND256) STREAM OVER 255 BYTES ?    */  0531
*/*              P (,OVR256) SET LINGRO TO 255, TURN ON LNGDT  */  0531
*/*WRAP:         P (,SOURTST) INCREMENT CURSAD BY 3270 SCREEN      0531
*/*                SIZE, SET LINGRO NON ZERO                   */  0531
*/*UND256:       P SET LINGRO TO ACTUAL DATA LENGTH            */  0531
*/*OVR256:       P (,RDLAT) CLEAR CURLIN                       */  0531
*/*CKSMI:        P CALCULATE REMAINING SOURCE LENGTH - NOT         0531
*/*                INCLUDING AID, SBA, ETC.                    */  0531
*/*              D (YES,UNDER256,NO,) LENGTH LESS THAN 256 ?   */  0531
*/*              P (,SMILOOP) SET LINGRO TO 256                */  0531
*/*UNDER256:     P SET LINGRO TO ACTUAL LENGTH                 */  0531
*/*              D (YES,NOSTART,NO,) IS LINGRO ZERO ?          */  0531
*/*SMILOOP:      D (NO,NOSTART1,YES,) ANY SPECIAL CHARACTERS ? */  0531
*/*              P SET LINGRO TO UNTESTED PORTION              */  0531
*/*              D (YES,ENDAT,NO,) IS IT AN ETX ?              */  0531
*/*              D (NO,NOTSMI,YES,) IS IT AN SMI ?             */  0531
*/*              P COMPUTE BUFFER POSITION OF SMI              */  0531
*/*              D (NO,ADJUST,YES,) IS RMTDV ON ?              */  0531
*/*              P DECREMENT BY TWO TO REMOTE ADDRESS          */  0531
*/*              D (NO,ADJUST,YES,) IS STXHER ON ?             */  0531
*/*              P (,ADJUST) DECREMENT BY ONE FOR STX          */  0531
*/*ADJUST:       D (NO,,YES,ADJUST1) IS SMI IN FIRST LINE ?    */  0531
*/*              P DIVIDE DISPLACEMENT OF SMI INTO SOURCE BY       0531
*/*                DSWIDE                                      */  0531
*/*              P MULTIPLY QUOTIENT BY ANWIDE-DSWIDE TO GET       0531
*/*                NUMBER OF LOST NULLS                        */  0531
*/*              P ADD NUMBER OF LOST NULLS                        0531
*/*                TO DISPLACEMENT INTO SOURCE OF SMI          */  0531
*/*ADJUST1:      P (,SOURTST) CLEAR LINGRO TO ZERO             */  0531
*/*NOTSMI:       D (NO,SMILOOP,YES,NOSTART) IS LINGRO ZERO ?   */  0531
*/*ENDAT:        D (YES,NOTSMI,NO,) RMTDV ON ?                 */  0531
*/*              P (,BACKGO) RESTORE SOURCE, SINK TO BEGINNING */  0531
*/*NOSTART1:     P INCREMENT SOURAD BY LINGRO                  */  0531
*/*NOSTART:      D (NO,CKSMI,YES,) SOURAD POINT TO LAST BYTE ? */  0531
*/*              P TURN ON NOSMI FLAG                          */  0531
*/*READOUT:      D (NO,OUTNORM,YES,%REMT) IS RMTDV ON ?        */  0531
*/*%REMT:        P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0531
*        GEN;                                                      0531
         EJECT
*/**************************************************************/  0532
*/**************************************************************/  0532
*/*                                                            */  0532
*/* RDLAT PROCESSING OF INPUT DATA STREAMS NOT INVOLVING       */  0532
*/*     UNIQUE CHARACTERS. TESTING IS DONE FOR UNIQUE          */  0532
*/*     CHARACTERS AND IF FOUND, RDLAT MOVES THAT              */  0532
*/*     PORTION OF THE SOURCE WHICH PRECEDES THE UNIQUE        */  0532
*/*     CHARACTER INTO THE SINK. CONTROL IS THEN PASSED TO     */  0532
*/*     THE APPROPRIATE SPECIAL PROCESSING CODE IN KERF.       */  0532
*/*     CONTROL IS PASSED THROUGH A BRANCH TABLE BASED         */  0532
*/*     UPON AN ARGUMENT SELECTED FROM 'TABLE' BY XLATE.       */  0532
*/*                                                            */  0532
*/*       RDMOV (RNOCHAR) MOVES THE ENTIRE GROUP TO THE        */  0532
*/*     SINK, ADJUSTS THE GROUP, AND PASSES CONTROL TO         */  0532
*/*     MORTST IF NO UNIQUE CHARACTER IS FOUND.                */  0532
*/*                                                            */  0532
*/*       MORTST VERIFYS THAT THERE IS SOURCE LEFT TO          */  0532
*/*     PROCESS, IF NOT CONTROL IS PASSED TO READOUT IN        */  0532
*/*     SOURTST. IF ITS A READ BUFFER OPERATION, THE SOURCE    */  0532
*/*     POINTER IS SET TO THE BEGINNING OF THE NEXT LINE,      */  0532
*/*     THE CURRENT LINE IS INCREMENTED, AND CONTROL IS        */  0532
*/*     PASSED TO READ1 IN READ. FOR OTHER OPTYPES, THE        */  0532
*/*     LENGTH IS ESTABLISHED AT 255 OR ALL REMAINING,         */  0532
*/*     AND CONTROL IS PASSED TO RDLAT.                        */  0532
*/*                                                            */  0532
*/**************************************************************/  0532
*/**************************************************************/  0532
*RDLAT:     GEN SETS(SPECAR,CARADD,LINGRO)                         0532
*                REFS(DACSRCAD,DACAD,SOMADD)                       0532
*                 FLOWS(RNOCHAR) SEQFLOW  ;        /*Y02947*/      0532
RDLAT    DS    0H                                                  0532
         SR    SPECAR,SPECAR
         SR    CARADD,CARADD
         BCTR  LINGRO,0                 SET COUNT FOR XLATE
         EX    LINGRO,XLATE
         LA    LINGRO,1(LINGRO)         PUT COUNT BACK
         BC    8,RNOCHAR
         STC   SPECAR,DACSRCAD(DACAD)     SAVE THE ARGUMENT
         LR    SPECAR,SOMADD          SAVE THE SOM ADDRESS
*           SOMADD = LINGRO - CARADD + SOURAD - 1;                 0533
         LR    SOMADD,LINGRO                                       0533
         SLR   SOMADD,CARADD                                       0533
         ALR   SOMADD,SOURAD                                       0533
         BCTR  SOMADD,0                                            0533
*           LINGRO = CARADD - SOURAD;                              0534
         LR    LINGRO,CARADD                                       0534
         SLR   LINGRO,SOURAD                                       0534
*                     SPECAR = SPECAR + LINGRO + 1;                0535
         LR    @12,SPECAR                                          0535
         ALR   @12,LINGRO                                          0535
         AH    @12,@CH00061                                        0535
         LR    SPECAR,@12                                          0535
*           IF DACSINAD + DACSINLN < SINKAD + LINGRO               0536
*                THEN GO TO OUTSINK;                               0536
         LH    @12,DACSINLN(,DACAD)                                0536
         AL    @12,DACSINAD(,DACAD)                                0536
         LR    @10,SINKAD                                          0536
         ALR   @10,LINGRO                                          0536
         CR    @12,@10                                             0536
         BL    @RT00536                                            0536
*                ELSE;                                             0538
*           IF LINGRO ^= FULL0                                     0539
*                THEN                                              0539
         C     LINGRO,FULL0                                        0539
         BE    @RF00539                                            0539
*                  DO;                                             0540
*           GEN SETS(LINGRO) SEQFLOW ;               /*Y02947*/    0541
         BCTR  LINGRO,0
         EX    LINGRO,MYMOV
         LA    LINGRO,1(LINGRO)
*                     SINKAD = SINKAD + LINGRO;                    0542
         ALR   SINKAD,LINGRO                                       0542
*                     SOURAD = CARADD;                             0543
         LR    SOURAD,CARADD                                       0543
*                  END;                                            0544
*                ELSE;                                             0545
@RF00539 DS    0H                                                  0546
*                     GEN SETS (CARADD,SPECAR,DACSRCAD)            0546
*                            REFS(DACAD,DACOPTYP,RDBUF)            0546
*          FLOWS (RNOCHAR,RDNULL,RDFLDMK,RDSMI,RDEOM,              0546
*                 RDETX,RDSOM,RDBFM,RDBSMI,RDBEOM,RDBSOM)          0546
*          NOSEQFLOW ;                                       /*Y02947*/
         LR    CARADD,SPECAR          SAVE THE SOM ADDRESS
         SR    SPECAR,SPECAR          CLEAR SPECAR
         IC    SPECAR,DACSRCAD(DACAD)        RESTORE THE ARGUMENT
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR 1 BYTE SAVE AREA
         SLL   SPECAR,2                 MULTIPLY BY FOUR
         TM    DACOPTYP(DACAD),X'01'      READ BUFFER OPERAT'N
         BZ    RDTAB(SPECAR)          NO, PROCEDE
         LA    SPECAR,40(SPECAR)        YES, PUT INTO READ
*                                       BUFFER SECTION
         B     RDTAB(SPECAR)            BRANCH ON ARGUMENT
***********************************************************************
*
*   RDTAB      FROM      RDLAT
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE
*   CHARACTER HANDLING ROUTINE
***********************************************************************
RDTAB    EQU   *                        BRANCH TABLE FOR
*                                       EXIT FROM TRANSLATE
*                                       AND TEST, IF CONDT'N
*                                       CODE IS NOT ZERO
         B     RNOCHAR                  UNUSED POSITION
         B     RDNULL                NL IN INPUT DATA   THIS
*                                       IS INVALID AND A
*                                       BLANK WILL GO IN
         B     RDNULL                   NULL IN DATA
         B     RDFLDMK                  FIELD MARK IN DATA
         B     RDSMI
         B     RDEOM                    EOM IN DATA - X'5A'
         B     RDNULL                EOM IN DATA - X'6A'
*                                       THIS IS INVALID AND
*                                       A BLANK WILL GO IN
         B     RDETX                    END FRAMING DETECTED
         B     RDSOM                    SOM IN DATA
         B     RNOCHAR                  UNUSED POSITION
RDBUFTAB EQU   *                        IF READ BUFFER OPTYP
         B     RNOCHAR                  UNUSED POSITION
         B     RDNULL                   NULL IN DATA
         B     RDNULL                NL IN INPUT DATA   THIS
*                                       IS INVALID AND A
*                                       BLANK WILL GO IN
         B     RDBFM                    FIELD MARK IN DATA
         B     RDBSMI
         B     RDBEOM                   EOM IN DATA - X'5A'
         B     RDNULL                EOM IN DATA - X'6A'
*                                       THIS IS INVALID AND
*                                       A BLANK WILL GO IN
         B     RDETX                    END FRAMING DETECTED
         B     RDBSOM                   SOM IN DATA
*/**************************************************************/  0547
*/*                                                            */  0547
*/* RNOCHAR    FROM      RDLAT                                 */  0547
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0547
*/**************************************************************/  0547
*RNOCHAR:;                                                         0547
RNOCHAR  DS    0H                                                  0548
*           GEN SETS(SOMADD,WORKREG4,WORKREG3,LINGRO,SINKAD,SOURAD)
*                 REFS(DACSINAD,DACAD,DACSINLN)                    0548
*                    FLOWS(OUTSINK) SEQFLOW  ;       /*Y02947*/    0548
         AR    SOMADD,LINGRO
         LR    WORKREG4,SINKAD
         AR    WORKREG4,LINGRO
         L     WORKREG3,DACSINAD(DACAD)
         AH    WORKREG3,DACSINLN(DACAD)
         BCTR  WORKREG3,0
         CR    WORKREG3,WORKREG4
         BL    OUTSINK
         BCTR  LINGRO,0
         EX    LINGRO,MYMOV
         LA    LINGRO,1(LINGRO)
         AR    SINKAD,LINGRO
         AR    SOURAD,LINGRO
*/**************************************************************/  0549
*/*                                                            */  0549
*/* MORTST     FROM      RNOCHAR, DATLNTST                     */  0549
*/*      SETUP FOR CONTINUED PROCESSING, IF MORE DATA LEFT     */  0549
*/**************************************************************/  0549
*MORTST:;                                                          0549
MORTST   DS    0H                                                  0550
*           IF LNGDT = '0'B                                        0550
*                THEN                                              0550
         TM    LNGDT(DACAD),B'00010000'                            0550
         BNZ   @RF00550                                            0550
*                  DO;                                             0551
*                     IF RDBUF = '0'B                              0552
*                          THEN GO TO READOUT;                     0552
         TM    RDBUF(DACAD),B'00000001'                            0552
         BZ    @RT00552                                            0552
*                          ELSE                                    0554
*                            DO;                                   0554
*                               SOURAD = SOURAD + ANWIDE -         0555
*                               DSWIDE;                            0555
         LR    @12,SOURAD                                          0555
         SLR   @10,@10                                             0555
         IC    @10,ANWIDE(,DACAD)                                  0555
         ALR   @12,@10                                             0555
         SLR   @10,@10                                             0555
         IC    @10,DSWIDE(,DACAD)                                  0555
         SLR   @12,@10                                             0555
         LR    SOURAD,@12                                          0555
*                               CURLIN = CURLIN + ONE;             0556
         AL    CURLIN,ONE                                          0556
*                               GO TO READ1;                       0557
         B     READ1                                               0557
*                            END;                                  0558
*                  END;                                            0559
*                ELSE;                                             0560
@RF00550 DS    0H                                                  0561
*           GEN SETS(LINGRO,WORKREG4,DACFLG,LNGDT)                 0561
*                REFS(CURSAD,SOMADD,DACAD)                         0561
*                   FLOWS(READOUT,RDLAT) SEQFLOW ;     /*Y02947*/  0561
         LR    LINGRO,CURSAD           PICK UP REAL LENGTH      YA01252
         SR    LINGRO,SOMADD
         BNP   READOUT                 WE HAVE PASSED CURSOR
         LA    WORKREG4,255                   THAN 256
         CR    LINGRO,WORKREG4
         BNH   LOW256                   LEAVE REMAINDER
         LA    LINGRO,255               ELSE PLUG 255 AS
         B     RDLAT                    GROUP AND GO PROCESS
***********************************************************************
*
*   LOW256     FROM      MORTST
*        LESS  THAN 256 BYTES OF SOURCE LEFT
***********************************************************************
LOW256   EQU   *                        SET THE LONG DATA
         NI    DACFLG(DACAD),X'EF'          FLAG OFF
*           GO TO RDLAT;                                           0562
         B     RDLAT                                               0562
*           GEN;                                                   0563
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0564
*/*     PRECEDING CODE -                                       */  0564
*/*RDLAT:        D (NO,RNOCHAR,YES,) ANY UNIQUE CHARACTERS ?   */  0564
*/*              P SAVE THE BRANCH ARGUMENT, SAVE SOMADD       */  0564
*/*              P SOMADD TO REMAINING PORTION OF STREAM       */  0564
*/*              P LINGRO TO TESTED PORTION LESS ONE           */  0564
*/*              P BUMP SOM BY LINGRO                          */  0564
*/*              D (NO,OUTSINK,YES,%MOVIT) SINK HOLD LINGRO ?  */  0564
*/*%MOVIT:       D (NO,,YES,%SETBR) LINGRO = ZERO ?            */  0564
*/*              P MOVE TESTED PORTION LESS UNIQUE CHARACTER TO    0564
*/*                SINK                                        */  0564
*/*              P BUMP SINK BY LINGRO, SOURAD EQUAL UNIQUE        0564
*/*                CHARACTER'S ADDRESS                         */  0564
*/*%SETBR:       P SAVE SOM ADDRESS IN CARADD, RESTORE THE         0564
*/*                BRANCH ARGUMENT                             */  0564
*/*              D (NO,,YES,%BUFBR) IS THIS A READ BUFFER ?    */  0564
*/*              D (NL,RDNULL,NULL,RDNULL,FM,RDFLDMK,SMI,          0564
*/*                RDSMI,!,RDEOM,EOM,RDNULL,ETX,RDETX,SOM,         0564
*/*                RDSOM) WHAT IS CHARACTER ?                  */  0564
*/*%BUFBR:       D (NO,RDNULL,NULL,RDNULL,FM,RDBFM,SMI,            0564
*/*                RDBSMI,!,RDBEOM,EOM,RDNULL,ETX,RDETX,           0564
*/*                SOM,RDBSOM) WHAT IS CHARACTER ?             */  0564
*/*RNOCHAR:      P BUMP SOM ADDRESS BY LINGRO                  */  0564
*/*              D (NO,OUTSINK,YES,%DOMOV) SINK HOLD LINGRO ?  */  0564
*/*%DOMOV:       P MOVE THE TESTED GROUP TO THE SINK, BUMP THE     0564
*/*                SINK BY LINGRO                              */  0564
*/*MORTST:       D (NO,%GO011,YES,) IS LNGDT OFF ?             */  0564
*/*              D (YES,%GO010,NO,READOUT) READ BUFFER OPTYPE ?*/  0564
*/*%GO010:       P POINT SOURAD TO BEGINNING OF NEXT 2260 LINE */  0564
*/*              P (,READ1) INCREMENT CURLIN BY ONE            */  0564
*/*%GO011:       D (YES,,NO,LOW256) 256 BYTES LEFT ?           */  0564
*/*              P (,RDLAT) SET LINGRO TO 255                  */  0564
*/*LOW256:       P (,RDLAT) TURN OFF LNGDT IN DACFLG           */  0564
*        GEN;                                                      0564
         EJECT
*/**************************************************************/  0565
*/**************************************************************/  0565
*/*                                                            */  0565
*/* KERF A COLLECTION OF SUBROUTINES TO DEAL WITH              */  0565
*/*     CHARACTERS REQUIRING SPECIAL ACTION. EACH              */  0565
*/*     SUBROUTINE IS AN INDIVIDUAL AND NOT NECESSARILY        */  0565
*/*     RELATED TO ANY OTHER. DATLNTST AND INCREM ARE          */  0565
*/*     FACILITIES USED BY SOME OF THE SUBROUTINES TO          */  0565
*/*     EFFECT RETURN TO MAIN DATA STREAM PROCESSING.          */  0565
*/*                                                            */  0565
*/*        RDSOM START FIELD DECTECTED IN DATA                 */  0565
*/*            INCREMENT SOURCE POINTER                        */  0565
*/*            FALL INTO RDSMI                                 */  0565
*/*                                                            */  0565
*/*        RDSMI OPERATOR ENTERED SOM 'X'4A') DETECTED         */  0565
*/*            POINT SINK TO BEGINNING                         */  0565
*/*            INCREMENT SOURCE                                */  0565
*/*            BRANCH TO DATLNTST                              */  0565
*/*                                                            */  0565
*/*        RDEOM END OF MESSAGE DETECTED                       */  0565
*/*            PUT 2260 EOM IN SINK                            */  0565
*/*            INCREMENT SINK AND SOURCE                       */  0565
*/*            BRANCH TO DATLNTST                              */  0565
*/*                                                            */  0565
*/*        RDFLDMK 3270 FIELD MARK DETECTED                    */  0565
*/*            PUT 2260 NEW LINE IN SINK                       */  0565
*/*            INCREMENT SINK AND SOURCE                       */  0565
*/*            SET LINGRO, SOURCE POINTER IF REQUIRED          */  0565
*/*            BRANCH TO DATLNTST                              */  0565
*/*                                                            */  0565
*/*        RDETX ETX DETECTED                                  */  0565
*/*            IF THIS IS REMOTE, BRANCH TO READOUT            */  0565
*/*                IN SOURTST                                  */  0565
*/*            IF THIS IS NOT REMOTE, RESET SOURCE             */  0565
*/*                AND SINK TO BEGINNING AND BRANCH            */  0565
*/*                TO BACKGO IN HOUSEKEEPING                   */  0565
*/*                                                            */  0565
*/*        RDBSOM START FIELD DETECTED                         */  0565
*/*            INCREMENT SOURCE                                */  0565
*/*            FALL INTO RDBSMI                                */  0565
*/*                                                            */  0565
*/*        RDBSMI OPERATOR ENTERED SOM 'X'4A') DETECTED        */  0565
*/*            PUT 2260 SOM IN SINK                            */  0565
*/*            BRANCH TO INCREM                                */  0565
*/*                                                            */  0565
*/*        RDBEOM END OF MESSAGE DETECTED                      */  0565
*/*            PUT 2260 EOM IN SINK                            */  0565
*/*            INCREMENT THE SOURCE                            */  0565
*/*            BRANCH TO INCREM                                */  0565
*/*                                                            */  0565
*/*        RDBFM FIELD MARK DETECTED                           */  0565
*/*            PUT NEW LINE IN SINK                            */  0565
*/*            BRANCH TO INCREM                                */  0565
*/*                                                            */  0565
*/*        RDNULL NULL OR INVALID CHARACTER DETECTED           */  0565
*/*            PUT A BLANK IN SINK                             */  0565
*/*            IF READ BUFFER OP, BRANCH TO INCREM             */  0565
*/*            IF NOT, BRANCH TO DATLNTST                      */  0565
*/*                                                            */  0565
*/*        DATLNTST NORMAL READ RETURN                         */  0565
*/*            IF REMAINING GROUP IS ZERO, BRANCH              */  0565
*/*                TO MORTST                                   */  0565
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565
*/*                                                            */  0565
*/*        INCREM READ BUFFER RETURN                           */  0565
*/*            INCREMENT SINK AND SOURCE                       */  0565
*/*            IF REMAINING GROUP IS ZERO, POINT SOURCE        */  0565
*/*                TO NEXT LINE, INCREMENT LINE,               */  0565
*/*                BRANCH TO READ1 IN READ                     */  0565
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565
*/*                                                            */  0565
*/*                                                            */  0565
*/**************************************************************/  0565
*/**************************************************************/  0565
*/**************************************************************/  0565
*/*                                                            */  0565
*/* RDSOM      FROM      RDTAB                                 */  0565
*/*      PROCESS START FIELD ORDER                             */  0565
*/**************************************************************/  0565
*RDSOM:;                                                           0565
RDSOM    DS    0H                                                  0566
*           SOURAD = SOURAD + 1;                                   0566
         AH    SOURAD,@CH00061                                     0566
*/**************************************************************/  0567
*/*                                                            */  0567
*/* RDSMI      FROM      RDTAB                                 */  0567
*/*      PROCESS OPERATOR ENTERED START OF MESSAGE             */  0567
*/**************************************************************/  0567
*RDSMI:;                                                           0567
RDSMI    DS    0H                                                  0568
*           IF RMTDV = '1'B                                        0568
*                THEN SINKAD = DACSINAD + 2;                       0568
         TM    RMTDV(DACAD),B'00000001'                            0568
         BNO   @RF00568                                            0568
         LA    SINKAD,2                                            0569
         AL    SINKAD,DACSINAD(,DACAD)                             0569
*                ELSE SINKAD = DACSINAD;                           0570
         B     @RC00568                                            0570
@RF00568 L     SINKAD,DACSINAD(,DACAD)                             0570
*           SOURAD = SOURAD + 1;                                   0571
@RC00568 LA    @12,1                                               0571
         ALR   SOURAD,@12                                          0571
*           CARADD = CARADD + 1;                                   0572
         ALR   CARADD,@12                                          0572
*/**************************************************************/  0573
*/*                                                            */  0573
*/* DATLNTST   FROM      RDSMI, RDEOM, RDFLDMK, LINBOUND,      */  0573
*/*                      RDNULL                                */  0573
*/*      EXIT TO NORMAL DATA STREAM PROCESSING FOR READ MI     */  0573
*/* AND SHORT READ MI                                          */  0573
*/**************************************************************/  0573
*DATLNTST:;                                                        0573
DATLNTST DS    0H                                                  0574
*           LINGRO = SOMADD;                                       0574
         LR    LINGRO,SOMADD                                       0574
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0575
         LR    SOMADD,CARADD                                       0575
*           IF LINGRO <= FULL0                                     0576
*                THEN GO TO MORTST;                                0576
         C     LINGRO,FULL0                                        0576
         BNH   @RT00576                                            0576
*                ELSE GO TO RDLAT;                                 0578
         B     RDLAT                                               0578
*/**************************************************************/  0579
*/*                                                            */  0579
*/* RDEOM      FROM      RDTAB                                 */  0579
*/*      PROCESS END OF MESSAGE CHARACTER                      */  0579
*/**************************************************************/  0579
*RDEOM:;                                                           0579
RDEOM    DS    0H                                                  0580
*                     SINK(1) = '6A'X; /*PUT EOM IN SINK       */  0580
         MVI   SINK(SINKAD),X'6A'                                  0580
*                     SINKAD = SINKAD + ONE;                       0581
         L     @12,ONE                                             0581
         ALR   SINKAD,@12                                          0581
*                     SOURAD = SOURAD + ONE;                       0582
         ALR   SOURAD,@12                                          0582
*                     GO TO DATLNTST;                              0583
         B     DATLNTST                                            0583
*/**************************************************************/  0584
*/*                                                            */  0584
*/* RDFLDMK    FROM      RDTAB                                 */  0584
*/*      PROCESS FIELD MARK CHARACTER (NL)                     */  0584
*/**************************************************************/  0584
*RDFLDMK:;                                                         0584
RDFLDMK  DS    0H                                                  0585
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0585
         MVI   SINK(SINKAD),X'15'                                  0585
*           SINKAD = SINKAD + ONE;                                 0586
         L     @12,ONE                                             0586
         ALR   SINKAD,@12                                          0586
*           SOURAD = SOURAD + ONE;                                 0587
         ALR   SOURAD,@12                                          0587
*           IF RVOID = '1'B                                        0588
*                THEN DO;                                          0588
         TM    RVOID(DACAD),B'10000000'                            0588
         BNO   @RF00588                                            0588
*                GEN SETS(REG0,WORKREG4,WORKREG3,CURLIN,SOMADD)    0590
*                    REFS(DSLINE,DACAD,ANWIDE,DACCRS)              0590
*                    FLOWS(RVOIDOUT,DATLNTST) NOSEQFLOW ; /*Y02947*/
         SR    REG0,REG0          CLEAR WORK REGISTER           YA01252
         IC    REG0,DSLINE(DACAD)   PICK UP MAX LINE            YA01252
         BCTR  REG0,0             REDUCE MINUS ONE              YA01252
         CR    REG0,CURLIN        MAX LINE TO CURRENT LINE      YA01252
         BNH   RVOIDOUT            JUST PROCESSED LINE MAX      YA01252
         SR    WORKREG4,WORKREG4  CLEAR REG                     YA01252
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH          @ZA14059
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059
         DR    WORKREG4,REG0       GET CURSOR'S LINE LESS ONE  @ZA14059
*                                  REMAINDER IS IN 14 FOR      @ZA14059
*                                  LATER USE                   @ZA14059
         LTR   WORKREG3,WORKREG3   FIRST LINE?                 @ZA14059
         BNZ   NOTFIRST            BRANCH IF NOT FIRST LINE    @ZA14059
         LTR   CURLIN,CURLIN       END OF DATA MOVED ON        @ZA14059
*                                  FIRST LINE?                 @ZA14059
         BZ    RVOIDOUT            YES,DONE IN THIS ROUTINE    @ZA14059
NOTFIRST EQU   *                                               @ZA14059
         CR    WORKREG3,CURLIN     CURSOR'S LINE TO CURRENT?   @ZA14059
         BNE   RDMKC               BR IF NO                    @YA03965
         BCTR  SINKAD,0            REDUCE SINK BY ONE          @YA03965
         B     RVOIDOUT            FINISHED PROCESSING         @YA03965
RDMKC    EQU   *                                               @YA03965
         LR    WORKREG3,LINGRO     GET LENGTH OF DATA JUST     @ZA14059
*                                  MOVED                       @ZA14059
         SR    WORKREG4,WORKREG4   CLEAR REG                   @ZA14059
         DR    WORKREG4,REG0       DETERMINE NUMBER OF FULL    @ZA14059
*                                  LINES OF DATA MOVED         @ZA14059
         AR    CURLIN,WORKREG3     ADJUST CURLIN BY AMOUNT OF  @ZA14059
*                                  DATA JUST MOVED             @ZA14059
         LA    CURLIN,1(CURLIN)   BUMP CURRENT LINE POINTER     YA01252
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059
         SR    WORKREG4,WORKREG4  AND DEVELOP THE REMAINDER    @ZA14059
         DR    WORKREG4,0         OF DATA ON THE CURSORS LINE  @ZA14059
         CR    WORKREG3,CURLIN    NEXT LINE CURSORS LINE ?      YA01252
         BNE   DATLNTST            NO, GO DO ANOTHER            YA01252
         LR    SOMADD,WORKREG4    YES, SET TO DO REMAINDER      YA01252
         LTR   SOMADD,SOMADD       ANY ON CURSOR'S LINE TO DO?  YA01252
         BZ    RVOIDOUT            NO, DONE                     YA01252
         B     DATLNTST            YES, GO DO LAST LINE         YA01252
*              END;                                                0591
*                ELSE                                              0592
*                  DO;                                             0592
@RF00588 DS    0H                                                  0593
*           GEN SETS(WORKREG4,WORKREG3,SOURAD,CARADD,SOMADD,REG0)  0593
*               REFS(DACSRCAD,DACAD,DACIND,DSWIDE)                 0593
*               FLOWS(DATLNTST) NOSEQFLOW ;        /*Y02947*/      0593
         LCR   WORKREG4,SOURAD   SUBTRACT SOURCE POINTER FROM   CODE2
         A     WORKREG4,DACSRCAD(DACAD)  SOURCE BASE PLUS DACINDCODE2
         SR    WORKREG3,WORKREG3   CLEAR A WORK REGISTER        CODE2
         IC    WORKREG3,DACIND(DACAD)   PICK UP DACIND          CODE2
         AR    WORKREG4,WORKREG3    INTRODUCE DACIND            CODE2
         LTR   WORKREG4,WORKREG4    CHECK RELATION TO LINE BDRY CODE2
         BZ    DATLNTST            WE HAVE COINCIDENCE          CODE2
         BM    LINBOUND            WE ARE PAST FIRST BOUNDRY    CODE2
***********************************************************************
*
*   RAPON      FROM      RDFLDMK
*        PROCESS NEW LINE NOT IN FIRST 2260 LINE
***********************************************************************
RAPON    EQU   *
         AR    SOURAD,WORKREG4      BUMP SOURCE TO NEXT LINE    CODE2
         AR    CARADD,WORKREG4      BUMP SOM BUFFER UNITS       CODE2
         SR    SOMADD,WORKREG4      REDUCE RESIDUAL COUNT       CODE2
         B     DATLNTST            GO SET UP FOR NEXT PASS      CODE2
***********************************************************************
*
*   LINBOUND   FROM      RAPON
*        ADJUST LINE GROUPING
***********************************************************************
LINBOUND EQU   *
         LR    WORKREG4,SOURAD      COMPUTE OFFSET TO NEXT LINE CODE2
         S     WORKREG4,DACSRCAD(DACAD)   REDUCE BY BEGINNING   CODE2
         SR    WORKREG4,WORKREG3    REDUCE BY DACIND            CODE2
         LR    WORKREG3,WORKREG4    PUT IN ODD OF EVEN/ODD PAIR CODE2
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2
         SR    REG0,REG0            CLEAR WORK FOR DIVISOR      CODE2
         IC    REG0,DSWIDE(DACAD)   PICK UP 2260 WIDTH          CODE2
         DR    WORKREG4,REG0        COUNT INTO THIS LINE        CODE2
         LTR   WORKREG4,WORKREG4    ARE WE ON A LINE BOUNDRY    CODE2
         BZ    DATLNTST            YES, POINTERS NOW OK         CODE2
         SR    REG0,WORKREG4        REMAINDER OF LINE           CODE2
         LR    WORKREG4,REG0        PUT REMAINDER IN WORK       CODE2
         B     RAPON               GO UPDATE POINTERS           CODE2
*                  END;                                            0594
*/**************************************************************/  0595
*/*                                                            */  0595
*/* RDETX      FROM      RDTAB                                 */  0595
*/*      PROCESS ETX CHARATER                                  */  0595
*/**************************************************************/  0595
*RDETX:;                                                           0595
RDETX    DS    0H                                                  0596
*           IF RMTDV = '1'B                                        0596
*                THEN GO TO READOUT;                               0596
         TM    RMTDV(DACAD),B'00000001'                            0596
         BO    @RT00596                                            0596
*                ELSE                                              0598
*                  DO;                                             0598
*                     SOURAD = DACSRCAD;                           0599
         L     SOURAD,DACSRCAD(,DACAD)                             0599
*                     SINKAD = DACSINAD;                           0600
         L     SINKAD,DACSINAD(,DACAD)                             0600
*                     GO TO BACKGO;                                0601
         B     BACKGO                                              0601
*                  END;                                            0602
*RDBSOM:;                                                          0603
RDBSOM   DS    0H                                                  0604
*/**************************************************************/  0604
*/*                                                            */  0604
*/* RDBSOM     FROM      RDTAB                                 */  0604
*/*      PROCESS START FIELD ORDER (READ BUFFER ONLY)          */  0604
*/**************************************************************/  0604
*           SOURAD = SOURAD + 1;                                   0604
         AH    SOURAD,@CH00061                                     0604
*/**************************************************************/  0605
*/*                                                            */  0605
*/* RDBSMI     FROM      RDTAB                                 */  0605
*/*      PROCESS OPERATOR ENTERED SOM (Ö) (READ BUFFER ONLY)   */  0605
*/**************************************************************/  0605
*RDBSMI:;                                                          0605
RDBSMI   DS    0H                                                  0606
*           SINK(1) = '4A'X;           /*PUT SOM IN SINK       */  0606
         MVI   SINK(SINKAD),X'4A'                                  0606
*           GO TO INCREM;                                          0607
         B     INCREM                                              0607
*/**************************************************************/  0608
*/*                                                            */  0608
*/* RDBEOM     FROM      RDTAB                                 */  0608
*/*      PROCESS END OF MESSAGE (READ BUFFER ONLY)             */  0608
*/**************************************************************/  0608
*RDBEOM:;                                                          0608
RDBEOM   DS    0H                                                  0609
*           SINK(1) = '6A'X;           /*PUT EOM IN SINK       */  0609
         MVI   SINK(SINKAD),X'6A'                                  0609
*           SOURAD = SOURAD + 1;                                   0610
         AH    SOURAD,@CH00061                                     0610
*           GO TO INCREM;                                          0611
         B     INCREM                                              0611
*/**************************************************************/  0612
*/*                                                            */  0612
*/* RDBFM      FROM      RDTAB                                 */  0612
*/*      PROCESS FIELD MARK (READ BUFFER ONLY)                 */  0612
*/**************************************************************/  0612
*RDBFM:;                                                           0612
RDBFM    DS    0H                                                  0613
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0613
         MVI   SINK(SINKAD),X'15'                                  0613
*           GO TO INCREM;                                          0614
         B     INCREM                                              0614
*/**************************************************************/  0615
*/*                                                            */  0615
*/* RDNULL     FROM      RDTAB                                 */  0615
*/*      PROCESS NULL OR INVALID CHARACTERS                    */  0615
*/**************************************************************/  0615
*RDNULL:;                                                          0615
RDNULL   DS    0H                                                  0616
*           SINK(1) = '40'X;           /*PUT BLANK IN SINK     */  0616
         MVI   SINK(SINKAD),X'40'                                  0616
*           IF RDBUF = '1'B                                        0617
*                THEN GO TO INCREM;                                0617
         TM    RDBUF(DACAD),B'00000001'                            0617
         BO    @RT00617                                            0617
*                ELSE GO TO DATLNTST;                              0619
         B     DATLNTST                                            0619
*/**************************************************************/  0620
*/*                                                            */  0620
*/* INCREM     FROM      RDBSMI, RDBEOM, RDBFM, RDNULL         */  0620
*/*      EXIT TO NORMAL DATA STREAM PROCESSING                 */  0620
*/**************************************************************/  0620
*INCREM:;                                                          0620
INCREM   DS    0H                                                  0621
*           SINKAD = SINKAD + ONE;                                 0621
         L     @12,ONE                                             0621
         ALR   SINKAD,@12                                          0621
*           SOURAD = SOURAD + ONE;                                 0622
         ALR   SOURAD,@12                                          0622
*           LINGRO = SOMADD;                                       0623
         LR    LINGRO,SOMADD                                       0623
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0624
         LR    SOMADD,CARADD                                       0624
*           IF LINGRO = FULL0                                      0625
*                THEN                                              0625
         C     LINGRO,FULL0                                        0625
         BNE   @RF00625                                            0625
*                  DO;                                             0626
*                     SOURAD = SOURAD + ANWIDE - DSWIDE;           0627
         LR    @12,SOURAD                                          0627
         SLR   @10,@10                                             0627
         IC    @10,ANWIDE(,DACAD)                                  0627
         ALR   @12,@10                                             0627
         SLR   @10,@10                                             0627
         IC    @10,DSWIDE(,DACAD)                                  0627
         SLR   @12,@10                                             0627
         LR    SOURAD,@12                                          0627
*                     CURLIN = CURLIN + 1;                         0628
         AH    CURLIN,@CH00061                                     0628
*                     GO TO READ1;    /*GO SEE WHATS LEFT      */  0629
         B     READ1                                               0629
*                  END;                                            0630
*                ELSE;                                             0631
@RF00625 DS    0H                                                  0632
*           GO TO RDLAT;                                           0632
         B     RDLAT                                               0632
*           GEN;                                                   0633
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0634
*/*     PRECEDING CODE -                                       */  0634
*/*RDSOM:        P INCREMENT SOURAD BY ONE                     */  0634
*/*RDSMI:        D (NO,%GO012,YES,) IS RMTDV ON ?              */  0634
*/*              P (,%GO013) SET SINKAD TO DACSINAD PLUS TWO   */  0634
*/*%GO012:       P SET SINK TO DACSINAD                        */  0634
*/*%GO013:       P BUMP SOURCE                                 */  0634
*/*DATLNTST:     P LINGRO = REMAINING DATA, RESTORE SOMADD     */  0634
*/*              D (NO,RDLAT,YES,MORTST) LINGRO = ZERO ?       */  0634
*/*RDEOM:        P (,DATLNTST) PUT EOM IN SINK, BUMP SINK          0634
*/*                AND SOURCE                                  */  0634
*/*RDFLDMK:      P PUT NL IN SINK, BUMP SINK AND SOURCE        */  0634
*/*              D (YES,DATLNTST,NO,) DATA REMAINING = ZERO ?  */  0634
*/*              D (YES,DATLNTST,NO,) RVOID = YES SPECIFIED ?  */  0634
*/*              P INCREMENT CURLIN                            */  0634
*/*              D (NO,RAPON,YES,) ARE IN FIRST 2260 LINE ?    */  0634
*/*              P CALCULATE COUNT TO BE SKIPPED               */  0634
*/*              P DECREMENT REMAINING COUNT BY COUNT TO BE        0634
*/*                SKIPPED                                     */  0634
*/*              P LINGRO = REMAINDER                          */  0634
*/*              P (,DATLNTST) SET SOURAD TO POINT TO FIRST        0634
*/*                CHARACTER OF NEXT LINE                      */  0634
*/*RAPON:        P CALCULATE DIFFERENCE FROM FIRST LINE BOUNDRY    0634
*/*                TO FM                                       */  0634
*/*              P DIVIDE IT BY THE 2260 WIDTH, SPECAR =           0634
*/*                QUOTIENT                                    */  0634
*/*              P LINGRO = THE REMAINDER                      */  0634
*/*LINBOUND:     P POINT SOURAD TO BEGINNING OF NEXT LINE      */  0634
*/*              P (,DATLNTST) SET CURLIN TO ONE PAST SPECAR,      0634
*/*                SOMADD TO REMAINING DATA PORTION            */  0634
*/*RDETX:        D (YES,READOUT,NO,%GO015) IS RMTDV ON ?       */  0634
*/*%GO015:       P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0634
*/*RDBSOM:       P BUMP SOURCE                                 */  0634
*/*RDBSMI:       P (,INCREM) PUT SOM IN SINK                   */  0634
*/*RDBEOM:       P (,INCREM) PUT EOM IN SINK, BUMP SOURCE      */  0634
*/*RDBFM:        P (,INCREM) PUT NL IN SINK                    */  0634
*/*RDNULL:       P PUT A BLANK IN SINK                         */  0634
*/*              D (YES,INCREM,NO,DATLNTST) READ BUFFER ?      */  0634
*/*INCREM:       P BUMP SINK, SOURCE, LINGRO = SOMADD, RESTORE     0634
*/*                SOMADD                                      */  0634
*/*              D (YES,,NO,RDLAT) IS LINGRO = ZERO ?          */  0634
*/*              P (,READ1) SOURAD TO BEGINNING OF NEXT LINE,      0634
*/*                BUMP CURLIN                                 */  0634
*        GEN;                                                      0634
         EJECT
*/**************************************************************/  0635
*/**************************************************************/  0635
*/*                                                            */  0635
*/* INVERT ROUTINE TO CONVERT INCOMING ADDRESSES TO HEX        */  0635
*/*     INVERT IS USED BY VIRTUALLY ALL PHASES OF THE READ     */  0635
*/*     DATA STREAM PROCESSING TO CONVERT 3270 ADDRESSES TO    */  0635
*/*     HEXADECIMAL. NORMAL ENTRY IS VIA A BRANCH AND LINK     */  0635
*/*     ON REGISTER CARADD. RETURN IS VIA A BRANCH REGISTER    */  0635
*/*     CARADD.                                                */  0635
*/*                                                            */  0635
*/**************************************************************/  0635
*/**************************************************************/  0635
*INVERT:  GEN SETS(SPECAR,CURSAD) REFS(MASK,SINKAD,CARADD) ; /*Y02947*/
INVERT   DS    0H                                                  0635
         SLDL  SPECAR,24
         SRL   CURSAD,24
         N     SPECAR,MASK
         N     CURSAD,MASK
         SLL   SPECAR,6
         AR    SPECAR,CURSAD
         STC   SPECAR,1(SINKAD)
         SRL   SPECAR,8
         STC   SPECAR,0(SINKAD)
         IC    CURSAD,0(SINKAD)
         SLL   CURSAD,8
         IC    CURSAD,1(SINKAD)
         BR    CARADD
*           GEN;                                                   0636
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0637
*/*     PRECEDING CODE -                                       */  0637
*/*INVERT: CHART                                               */  0637
*/* HEADER                                                         0637
*/*        SCAN - CONVERSION OF INCOMING 3270 BUFFER ADDRESSES TO HEX
*/*                                            PAGE #          */  0637
*/*INVERT:       E READ ADDRESS CONVERSION                     */  0637
*/*              P CONVERT 3270 TO HEX                         */  0637
*/*              R BR CARADD                                   */  0637
*/*INVERT: END                                                 */  0637
*           GEN;                                                   0637
         EJECT
*/**************************************************************/  0638
*/**************************************************************/  0638
*/*                                                            */  0638
*/* OUTVERT ROUTINE TO CONVERT OUTGOING ADDRESSES TO 3270      */  0638
*/*     OUTVERT IS USED BY VIRTUALLY ALL PHASES OF THE WRITE   */  0638
*/*     DATA STREAM PROCESSING TO CONVERT HEXADECIMAL          */  0638
*/*     ADDRESSES TO 3270. NORMAL ENTRY IS VIA A BRANCH AND    */  0638
*/*     LINK ON REGISTER CARADD. RETURN IS VIA A BRANCH        */  0638
*/*     REGISTER CARADD.                                       */  0638
*/*                                                            */  0638
*/**************************************************************/  0638
*/**************************************************************/  0638
*OUTVERT:   GEN SETS(SINK,CURSAD,SINKAD) REFS(CARADD) ;   /*Y02947*/
OUTVERT  DS    0H                                                  0638
         STC   CURSAD,2(SINKAD)
         SRL   CURSAD,8
         STC   CURSAD,3(SINKAD)
         SLL   CURSAD,8
         IC    CURSAD,2(SINKAD)
         STC   CURSAD,1(SINKAD)
         NI    1(SINKAD),X'3F'
         SRL   CURSAD,6
         STC   CURSAD,0(SINKAD)
         NI    0(SINKAD),X'1F'
         TR    0(2,SINKAD),ADDRTAB
         IC    CURSAD,3(SINKAD)
         SLL   CURSAD,8
         IC    CURSAD,2(SINKAD)
         LA    SINKAD,2(SINKAD)
         BR    CARADD
*           GEN;                                                   0639
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0640
*/*     PRECEDING CODE -                                       */  0640
*/*OUTVERT: CHART                                              */  0640
*/* HEADER                                                         0640
*/*        SCAN - CONVERSION OF OUTGOING ADDRESSES TO 3270 BUFFER  0640
*/*                                            PAGE #          */  0640
*/*OUTVERT:      E WRITE ADDRESS CONVERSION                    */  0640
*/*              P CONVERT HEX TO 3270, USING ADDRTAB          */  0640
*/*              P BUMP SINK POINTER BY TWO                    */  0640
*/*              R BR CARADD                                   */  0640
*/*OUTVERT: END                                                */  0640
*        GEN;                                                      0640
         EJECT
*/**************************************************************/  0641
*/**************************************************************/  0641
*/* XLATE TRANSLATE AND TEST INSTRUCTION, MOVE CHARACTERS      */  0641
*/*     INSTRUCTION                                            */  0641
*/*     THESE INSTRUCTIONS ARE UTILIZED VIA EXECUTE            */  0641
*/*     INSTRUCTIONS AT VARIOUS POINTS THROUGH SCAN. THE       */  0641
*/*     TRT TRANSLATES SOME PORTION OF THE SOURCE AGAINST      */  0641
*/*     'TABLE'. THE MVC MOVES SOME PORTION OF THE SOURCE      */  0641
*/*     INTO THE SINK.                                         */  0641
*/*                                                            */  0641
*/**************************************************************/  0641
*/**************************************************************/  0641
*XLATE:     GEN;                                                   0641
XLATE    DS    0H                                                  0641
         TRT   0(1,SOURAD),TABLE
*MYMOV:;                                                           0642
MYMOV    DS    0H                                                  0643
*           GEN;                                                   0643
         MVC   0(1,SINKAD),0(SOURAD)
*           GEN;                                                   0644
         EJECT
*/**************************************************************/  0645
*/**************************************************************/  0645
*/*                                                            */  0645
*/* OUTPROC THE VARIOUS EXITS FROM SCAN                        */  0645
*/*     OUTPROC IS ACTUALY A COLLECTION OF CONDITION RETURN    */  0645
*/*     PROCESSORS. EACH MAY PERFORM SOME SPECIAL FUNCTION,    */  0645
*/*     THEN WILL LOAD REGISTER 15 WITH X'10' (16) AND BRANCH  */  0645
*/*     TO THE POINT IN GOBACK WHICH WILL LEAVE THE REQUIRED   */  0645
*/*     RETURN CODE IN REGISTER 15. EACH SUCCESSIVE STEP       */  0645
*/*     THROUGH GOBACK DECREMENTS REGISTER 15 BY FOUR. HENCE,  */  0645
*/*     FOR RETURN CODE OF 0, A BRANCH TO GOBACK00 IS          */  0645
*/*     REQUIRED, OF 4, A BRANCH TO GOBACK04, ETC. THE         */  0645
*/*     CURSOR IS SAVED IN DACCRS ONLY FOR GOBACK00. THE       */  0645
*/*     LENGTH OF SINK IS CALCULATED IN GOBACK08, SO GOBACK00  */  0645
*/*     AND GOBACK04 ALSO RESULT IN SINK LENGTH BEING PASSED   */  0645
*/*     IN REGISTER 0. THE DACFLG IS CLEARED EXCEPT FOR        */  0645
*/*     BITS 0 AND 1 FOR ALL EXITS. DACIND IS CLEARED FOR      */  0645
*/*     ALL EXITS.                                             */  0645
*/*                                                            */  0645
*/*       OUTNORM CHECKS FOR THE NO SMI BIT IN DACFLG AND IF   */  0645
*/*     ON BRANCHES TO OUTNSMI. IF THIS IS A WRITE AND THE     */  0645
*/*     SOM HERE BIT IN DACFLG IS ON, OUTNORM SAVES THE SOM    */  0645
*/*     ADDRESS IN DACSOMAD. IF SOM HERE IS OFF OUTNORM        */  0645
*/*     CHECKS THE SHORT READ FLAG. IF THE SHORT READ FLAG     */  0645
*/*     IF OFF, A HALFWORD OF ONES IS STORED IN DACSOMAD.      */  0645
*/*     OTHERWISE DACSOMAD IS NOT ALTERED. LOADS REG 15 WITH   */  0645
*/*     16 AND BRANCHES TO GOBACK00.                           */  0645
*/*                                                            */  0645
*/*       OUTSPEC LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645
*/*     GOBACK04.                                              */  0645
*/*                                                            */  0645
*/*       OUTSINK LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645
*/*     GOBACK08.                                              */  0645
*/*                                                            */  0645
*/*       OUTNSMI LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645
*/*     GOBACK0C.                                              */  0645
*/*                                                            */  0645
*/*       OUTERR LOADS REG 15 WITH 16 AND BRANCHES TO          */  0645
*/*     GOBACK10.                                              */  0645
*/*                                                            */  0645
*/**************************************************************/  0645
*/**************************************************************/  0645
*/**************************************************************/  0645
*/*                                                            */  0645
*/* OUTNORM    FROM      SETPROT, OUTTST                       */  0645
*/*      NORMAL EXIT FROM SCAN                                 */  0645
*/**************************************************************/  0645
*OUTNORM:;                                                         0645
OUTNORM  DS    0H                                                  0646
*           IF NOSMI = '1'B                                        0646
*                THEN GO TO OUTNSMI;                               0646
         TM    NOSMI(DACAD),B'00000100'                            0646
         BO    @RT00646                                            0646
*                ELSE;                                             0648
*           IF WRCRS = '1'B           /*IF THIS IS A WRITE     */  0649
*           × WRLA = '1'B             /*OPERATION - CHECK      */  0649
*           × EWR = '1'B              /*TO SEE IF AN SOM       */  0649
*                THEN                                              0649
         TM    WRCRS(DACAD),B'00111000'                            0649
         BZ    @RF00649                                            0649
*                  DO;                                             0650
*                     IF SOMHER = '1'B                             0651
*                          THEN                                    0651
         TM    SOMHER(DACAD),B'00001000'                           0651
         BNO   @RF00651                                            0651
*                            DO;                                   0652
*                               GEN SETS(DACSOMAD) REFS(SOMADD,DACAD)
*                                ; /*Y02947*/                      0653
         STH   SOMADD,DACSOMAD(DACAD)
*                            END;                                  0654
*                          ELSE                                    0655
*                            DO;                                   0655
         B     @RC00651                                            0655
@RF00651 DS    0H                                                  0656
*                               IF SHRD = '1'B                     0656
*                                   THEN;                          0656
         TM    SHRD(DACAD),B'01000000'                             0656
         BO    @RT00656                                            0656
*                                   ELSE DACSOMAD = ALLONE;        0658
         MVC   DACSOMAD(2,DACAD),ALLONE                            0658
*                            END;                                  0659
*                  END;                                            0660
*                ELSE;                                             0661
@RF00649 DS    0H                                                  0662
*           GEN;                                                   0662
@RC00649 DS    0H                                                  0662
         LA    WORKREG3,RETCONST
*           GO TO GOBACK00;                                        0663
         B     GOBACK00                                            0663
*/**************************************************************/  0664
*/*                                                            */  0664
*/* OUTSPEC    FROM      READ                                  */  0664
*/*      EXIT FOR PA1,2,3 AND CLEAR AID RECIEVED               */  0664
*/**************************************************************/  0664
*OUTSPEC:   GEN;                                                   0664
OUTSPEC  DS    0H                                                  0664
         LA    WORKREG3,RETCONST
*           GO TO GOBACK04;                                        0665
         B     GOBACK04                                            0665
*/**************************************************************/  0666
*/*                                                            */  0666
*/* OUTSINK    FROM      WITCH1, WIT, SETPROT, READ, RDLAT,    */  0666
*/*                      RDMOV                                 */  0666
*/*      EXIT FOR EXPIRATION OF SINK                           */  0666
*/**************************************************************/  0666
*OUTSINK:   GEN;                                                   0666
OUTSINK  DS    0H                                                  0666
         LA    WORKREG3,RETCONST
*           GO TO GOBACK08;                                        0667
         B     GOBACK08                                            0667
*/**************************************************************/  0668
*/*                                                            */  0668
*/* OUTNSMI    FROM      OUTNORM                               */  0668
*/*      EXIT FOR NO START OF MESSAGE FOUND                    */  0668
*/**************************************************************/  0668
*OUTNSMI:;                                                         0668
OUTNSMI  DS    0H                                                  0669
*           GEN;                                                   0669
         LA    WORKREG3,RETCONST
*           GO TO GOBACK0C;                                        0670
         B     GOBACK0C                                            0670
*/**************************************************************/  0671
*/*                                                            */  0671
*/* OUTERR     FROM      READ                                  */  0671
*/*      EXIT FOR SOH ERROR OR TEST REQUEST DETECTED           */  0671
*/**************************************************************/  0671
*OUTERR:;                                                          0671
OUTERR   DS    0H                                                  0672
*           GEN;                                                   0672
         LA    WORKREG3,RETCONST
*           GO TO GOBACK10;                                        0673
         B     GOBACK10                                            0673
*OUTCURS:;                                                         0674
OUTCURS  DS    0H                                                  0675
*           GEN;                                                   0675
         LA    WORKREG3,RETCONST
*           GO TO GOBACK14;                                        0676
         B     GOBACK14                                            0676
*/**************************************************************/  0677
*/*                                                            */  0677
*/* GOBACK00   FROM      OUTNORM                               */  0677
*/*      SET UP RETURN CODE 0                                  */  0677
*/**************************************************************/  0677
*GOBACK00:;                                                        0677
GOBACK00 DS    0H                                                  0678
*           GEN;                                                   0678
         SH    WORKREG3,HAF4
*/**************************************************************/  0679
*/*                                                            */  0679
*/* GOBACK04   FROM      OUTSPEC                               */  0679
*/*      SET UP RETURN CODE 4                                  */  0679
*/**************************************************************/  0679
*GOBACK04:;                                                        0679
GOBACK04 DS    0H                                                  0680
*           GEN;                                                   0680
         SH    WORKREG3,HAF4
*/**************************************************************/  0681
*/*                                                            */  0681
*/* GOBACK08   FROM      OUTSINK                               */  0681
*/*      SET UP RETURN CODE 8                                  */  0681
*/**************************************************************/  0681
*GOBACK08:;                                                        0681
GOBACK08 DS    0H                                                  0682
*           GEN SETS(REG0,WORKREG3) REFS(SINKAD,DACSINAD,DACAD,HAF4)
*                SEQFLOW  ;                      /*Y02947*/        0682
         LR    REG0,SINKAD
         S     REG0,DACSINAD(DACAD)
         SH    WORKREG3,HAF4
*/**************************************************************/  0683
*/*                                                            */  0683
*/* GOBACK0C   FROM      OUTNSMI                               */  0683
*/*      SET UP RETURN CODE 12                                 */  0683
*/**************************************************************/  0683
*GOBACK0C:;                                                        0683
GOBACK0C DS    0H                                                  0684
*           GEN;                                                   0684
         SH    WORKREG3,HAF4
*/**************************************************************/  0685
*/*                                                            */  0685
*/* GOBACK10   FROM      OUTERR                                */  0685
*/*      SET UP RETURN CODE 16                                 */  0685
*/**************************************************************/  0685
*GOBACK10:;                                                        0685
GOBACK10 DS    0H                                                  0686
*           GEN;                                                   0686
         SH    WORKREG3,HAF4
*GOBACK14:;                                                        0687
GOBACK14 DS    0H                                                  0688
*           GEN SETS(DACFLG,SHRD,DACIND) REFS(DACAD) ; /*Y02947*/  0688
         NI    DACFLG(DACAD),X'40'
         NI    DACIND(DACAD),X'00'
*           RETURN;                                                0689
@EL00001 DS    0H                                                  0689
@EF00001 DS    0H                                                  0689
@ER00001 L     @14,12(,@13)                                        0689
         LM    @01,@12,24(@13)                                     0689
         BR    @14                                                 0689
*           GEN;                                                   0690
         EJECT
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0691
*/*     PRECEDING CODE -                                       */  0691
*/*IECTSCAN: CHART                                             */  0691
*/*OUTNORM:      D (YES,OUTNSMI,NO,) IS NSMI ON ?              */  0691
*/*              D (YES,,NO,%GO020) IS THIS A WRITE ?          */  0691
*/*              D (YES,,NO,%GO019) IS SOMHER ON ?             */  0691
*/*              P (,%GO020) STORE THE SOM ADDRESS IN DACSOMAD */  0691
*/*%GO019:       D (YES,%GO020,NO,) IS SHRD ON ?               */  0691
*/*              P SET DACSOMAD TO X'FFFF'                     */  0691
*/*%GO020:       P (,GOBACK00) PUT RETCONST IN REG 15          */  0691
*/*OUTSPEC:      P (,GOBACK04) PUT RETCONST IN REG 15          */  0691
*/*OUTSINK:      P (,GOBACK08) PUT RETCONST IN REG 15          */  0691
*/*OUTNSMI:      P (,GOBACK0C) PUT RETCONST IN REG 15          */  0691
*/*OUTERR:       P (,GOBACK10) PUT RETCONST IN REG 15          */  0691
*/*OUTCURS:      P (,GOBACK14) PUT RETCONST IN REG 15          */  0691
*/*GOBACK00:     P STORE CURSOR IN DACCRS, DECREMENT 15 BY FOUR*/  0691
*/*GOBACK04:     P DECREMENT 15 BY FOUR                        */  0691
*/*GOBACK08:     P SET REG 0 TO SINK USED, DECREMENT 15 BY FOUR*/  0691
*/*GOBACK0C:     P DECREMENT 15 BY FOUR                        */  0691
*/*GOBACK10:     P DECREMENT 15 BY FOUR                        */  0691
*/*GOBACK14:     P TURN OFF ALL FLAGS BUT PRIEN, SHRD          */  0691
*/*              R RETURN TO CALLER                            */  0691
*/*IECTSCAN: END                                               */  0691
*           GEN;                                                   0691
RETCONST EQU   20
*              1 LINE DELETED                                    Y02947
*        END;                                                      0692
         B     @EL00001                                            0692
@DATA    DS    0H
@CH00061 DC    H'1'
@CH00059 DC    H'2'
@CH00102 DC    H'3'
@CH00283 DC    H'6'
@DATD    DSECT
         DS    0F
IECTSCAN CSECT
         DS    0F
@DATD    DSECT
         DS    0D
@ENDDATD EQU   *
IECTSCAN CSECT
         NOPR  ((@ENDDATD-@DATD)*16)
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
DUM      DC    XL4'5B7B4B00'
FULL0    DC    XL4'00000000'
ONE      DC    XL4'00000001'
MASK     DC    XL4'0000003F'
ALLONE   DC    XL2'FFFF'
HAF0     DC    XL2'0000'
HAF3     DC    XL2'0003'
HAF4     DC    XL2'0004'
ADDRTAB  DS    CL64
         ORG   ADDRTAB
BLNK     DC    X'40'
@NM00009 DC    X'C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'
@NM00010 DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'
@NM00011 DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'
@NM00012 DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'
         ORG   ADDRTAB+64
TABLE    DS    CL256
         ORG   TABLE
@NM00013 DC    X'01000007000000000000040000000000'
@NM00014 DC    X'00000000000200000000000000080300'
@NM00015 DC    X'00000000000007000000000000000000'
@NM00016 DC    X'00000000000000000000000000000000'
@NM00017 DC    X'00000000000000000000040000000000'
@NM00018 DC    X'00000000000000000000050000000000'
@NM00019 DC    X'00000000000000000000060000000000'
@NM00020 DC    X'00000000000000000000000000000000'
@NM00021 DC    X'00000000000000000000000000000000'
@NM00022 DC    X'00000000000000000000000000000000'
@NM00023 DC    X'00000000000000000000000000000000'
@NM00024 DC    X'00000000000000000000000000000000'
@NM00025 DC    X'00000000000000000000000000000000'
@NM00026 DC    X'00000000000000000000000000000000'
@NM00027 DC    X'00000000000000000000000000000000'
@NM00028 DC    X'00000000000000000000000000000000'
         ORG   TABLE+256
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
DACAD    EQU   @09
SOMADD   EQU   @08
CURLIN   EQU   @07
SOURAD   EQU   @06
SINKAD   EQU   @05
LINGRO   EQU   @04
CURSAD   EQU   @03
SPECAR   EQU   @02
CARADD   EQU   @01
REG0     EQU   @00
WORKREG1 EQU   @10
WORKREG2 EQU   @12
WORKREG3 EQU   @15
WORKREG4 EQU   @14
DACA     EQU   0
DACCRS   EQU   DACA
DACSOMAD EQU   DACA+2
DACSRCAD EQU   DACA+4
DACSINAD EQU   DACA+8
DACSRCLN EQU   DACA+12
DACSINLN EQU   DACA+14
DACDSSCR EQU   DACA+16
DSLINE   EQU   DACDSSCR
DSWIDE   EQU   DACDSSCR+1
DACANSCR EQU   DACA+18
ANLINE   EQU   DACANSCR
ANWIDE   EQU   DACANSCR+1
DACDSAD  EQU   DACA+20
DACOPTYP EQU   DACA+21
RVOID    EQU   DACOPTYP
PROT     EQU   DACOPTYP
WRCRS    EQU   DACOPTYP
WRLA     EQU   DACOPTYP
EWR      EQU   DACOPTYP
RDMI     EQU   DACOPTYP
RDBUF    EQU   DACOPTYP
DACFLG   EQU   DACA+22
BLAT     EQU   DACFLG
SHRD     EQU   DACFLG
SOMP     EQU   DACFLG
LNGDT    EQU   DACFLG
SOMHER   EQU   DACFLG
NOSMI    EQU   DACFLG
STXHER   EQU   DACFLG
RMTDV    EQU   DACFLG
DACIND   EQU   DACA+23
SOURCE   EQU   0
SINK     EQU   0
WCCTAB   EQU   DUM
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
NNAME    EQU   SINK
NONAME   EQU   SOURCE
@NM00008 EQU   DACIND
@NM00007 EQU   DACIND
@NM00006 EQU   DACIND
@NM00005 EQU   DACIND
@NM00004 EQU   DACIND
@NM00003 EQU   DACIND
@NM00002 EQU   DACIND
@NM00001 EQU   DACIND
SRDMI    EQU   DACOPTYP
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RF00038 EQU   STXPLUG
@RT00072 EQU   WRITENT
@RT00094 EQU   REMTEWR
@RT00141 EQU   OUTERR
@RT00158 EQU   WRTEND
@RT00163 EQU   OUTSINK
@RT00190 EQU   WALL
@RC00211 EQU   WITCH1
@RT00239 EQU   WITCH4
@RF00239 EQU   WITCH3
@RF00218 EQU   WALL2
@RT00256 EQU   ENDSCRN
@RT00270 EQU   WRTNEW2
@RT00278 EQU   SETTLE1
@RT00283 EQU   WRTNEW1
@RT00335 EQU   WRTDONE
@RF00335 EQU   WITCH2
@RT00340 EQU   WRTDONE
@RF00340 EQU   WITCH1
@RT00345 EQU   OUTSINK
@RC00361 EQU   @RC00358
@RT00412 EQU   SETPROT
@RT00438 EQU   OUTNORM
@RT00449 EQU   OUTERR
@RC00462 EQU   OUTSPEC
@RT00481 EQU   READOUT
@RF00481 EQU   RDLAT
@RT00536 EQU   OUTSINK
@RT00552 EQU   READOUT
@RT00576 EQU   MORTST
@RF00576 EQU   RDLAT
@RT00596 EQU   READOUT
@RT00617 EQU   INCREM
@RF00617 EQU   DATLNTST
@RT00646 EQU   OUTNSMI
@RC00651 EQU   @RC00649
@RT00656 EQU   @RC00649
@ENDDATA EQU   *
         END   IECTSCAN,(C'PLS1241',0701,77006)

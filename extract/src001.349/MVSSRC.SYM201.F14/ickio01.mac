         TITLE '*************ICKIO01 - I/O ADAPTER MAIN ROUTINE*********
               *********'
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
ICKIO01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00002-@MAINENT)
         DC    AL1(16)                                             0002
         DC    C'ICKIO01   78.192'                                 0002
ICKIOIT  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00241-ICKIOIT)
         ENTRY ICKIOIT
ICKIOOP  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00273-ICKIOOP)
         ENTRY ICKIOOP
ICKIOTM  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00308-ICKIOTM)
         ENTRY ICKIOTM
ICKIOCL  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00327-ICKIOCL)
         ENTRY ICKIOCL
ICKIOGT  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00361-ICKIOGT)
         ENTRY ICKIOGT
ICKIOPT  DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL2(@EP00528-ICKIOPT)
         ENTRY ICKIOPT
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @10,0                                               0002
@PSTART  LA    @11,4095(,@10)                                      0002
         LA    @12,4095(,@11)                                      0002
         USING @PSTART,@10                                         0002
         USING @PSTART+4095,@11                                    0002
         USING @PSTART+8190,@12                                    0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @08,@01                                             0002
         USING @DATD,@08                                           0002
         ST    @13,@SA00001+4                                      0002
         LM    @15,@01,16(@13)                                     0002
         ST    @08,8(,@13)                                         0002
         LR    @13,@08                                             0002
         AH    @15,4(,@15)                                         0002
         BR    @15                                                 0002
@EP00002 DS    0H                                                  0003
*                                           MODULE                   */
*                                                                  0240
*                                                                  0240
*                                                                  0240
*                                                                  0240
*                                                                  0241
*ICKIOIT:  ENTRY  (GDTTBLX,DDLOC,XTNADDR);                         0241
*                                                                  0241
         B     @EC00241                                            0241
@EP00241 MVC   @PC00001(12),0(@01)                                 0241
@EC00241 DS    0H                                                  0242
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED TO PERFORM THE INITIALIZATION */
*        /* REQUIRED BY THE I/O ADAPTER FOR SUBSEQUENT CALLS.        */
*        /* STORAGE FOR THE HISTORICAL DATA AREA IS OBTAINED AND     */
*        /* INITIALIZED.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0242
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO GDTTBL USING A REGISTER            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0242
*        RFY (GDTREG) RSTD;                                        0242
*        RFY GDTTBL BASED (GDTREG);                                0243
*        GDTREG = ADDR (GDTTBLX);                                  0244
*                                                                  0244
         L     GDTREG,@PC00001                                     0244
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED ONLY BY THIS ENTRY POINT.                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0245
*        /* ENTRY POINTS RECEIVES FOLLOWING ARGUMENTS                */
*        DCL DDLOC PTR (31);           /* ALTERNATE D LIST ADDRESS   */
*        DCL XTNADDR PTR (31);         /* ADDR OF EXTERNAL DS RTNS   */
*                                                                  0246
*                                                                  0246
*                                                                  0246
*        OLDERID2 = NEWERID2;                                      0247
         L     @15,GDTTR2(,GDTREG)                                 0247
         MVC   @TS00001(95),NEWERID2(@15)                          0247
         MVC   OLDERID2(95,@15),@TS00001                           0247
*        NEWID2 = 'IOIT';                                          0248
*                                                                  0248
         MVC   NEWID2(4,@15),@CC00930                              0248
*        /************************************************************/
*        /*                                                          */
*        /* GET STORAGE FOR HISTORICAL DATA STRUCTURE.               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0249
*        POOLSIZE = LENGTH (IODATA);                               0249
*                                                                  0249
         MVC   POOLSIZE(4),@CF00693                                0249
*        CALL ICKSAGP0 (GDTTBL,POOLSIZE,GDTIOH,INITID,SETZERO);    0250
         ST    GDTREG,@AL00001                                     0250
         LA    @15,POOLSIZE                                        0250
         ST    @15,@AL00001+4                                      0250
         LA    @15,GDTIOH(,GDTREG)                                 0250
         ST    @15,@AL00001+8                                      0250
         LA    @15,INITID                                          0250
         ST    @15,@AL00001+12                                     0250
         LA    @15,@CC00138                                        0250
         ST    @15,@AL00001+16                                     0250
         MVI   @AL00001+16,X'80'                                   0250
         L     @15,GDTGPL(,GDTREG)                                 0250
         LA    @01,@AL00001                                        0250
         BALR  @14,@15                                             0250
*        RESPECIFY RTNREG RSTD;                                    0251
*        TESTRC = RTNREG;                                          0252
         STH   RTNREG,TESTRC                                       0252
*        RESPECIFY RTNREG UNRSTD;                                  0253
*                                                                  0253
*        IF TESTRC = 0                                             0254
*          THEN                                                    0254
*                                                                  0254
         LH    @15,TESTRC                                          0254
         LTR   @15,@15                                             0254
         BNZ   @RF00254                                            0254
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE I/O ADAPTER DATA STRUCTURE.           */
*            /*                                                      */
*            /********************************************************/
*                                                                  0255
*INITIOD:    DO;                                                   0255
*                                                                  0255
INITIOD  DS    0H                                                  0256
*              IODMSG = GDTIOH + LENGTH (IODATA);                  0256
         L     @15,GDTIOH(,GDTREG)                                 0256
         LA    @14,40                                              0256
         ALR   @14,@15                                             0256
         ST    @14,IODMSG(,@15)                                    0256
*              IODADD = DDLOC;         /* ADDRESS OF ALT DLIST       */
         L     @14,@PC00001+4                                      0257
         L     @14,DDLOC(,@14)                                     0257
         ST    @14,IODADD(,@15)                                    0257
*              IODXTN = XTNADDR;       /* EXTERNAL I/O ROUTINE LIST  */
         L     @14,@PC00001+8                                      0258
         L     @14,XTNADDR(,@14)                                   0258
         ST    @14,IODXTN(,@15)                                    0258
*              IODSID (1:4) = INITID (1:4);  /* INITIAL IDENTIFIER   */
         MVC   IODSID(4,@15),INITID                                0259
*              IODEOD = ADDR (IROSEOD); /*  EODAD ADDRESS            */
         LA    @14,IROSEOD                                         0260
         ST    @14,IODEOD(,@15)                                    0260
*              IODOSS = ADDR (IRSISYN); /*  INPUT SYNAD RTN          */
         LA    @14,IRSISYN                                         0261
         ST    @14,IODOSS(,@15)                                    0261
*              IODOSO = ADDR (IRSOSYN); /*  OUTPUT SYNAD RTN         */
*                                                                  0262
         LA    @14,IRSOSYN                                         0262
         ST    @14,IODOSO(,@15)                                    0262
*            END INITIOD;                                          0263
*                                                                  0263
*          ELSE                                                    0264
*                                                                  0264
*            /********************************************************/
*            /*                                                      */
*            /* NO STORAGE AVAILABLE FOR INITIALIZATION.  TERMINATE  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0264
*                                                                  0264
*              DO;                                                 0264
         B     @RC00254                                            0264
@RF00254 DS    0H                                                  0265
*                RESPECIFY(REG13,REG14,REG15) RSTD;                0265
*                REG15 = 28;                                       0266
         LA    REG15,28                                            0266
*                REG14 = GDTABT;                                   0267
         L     REG14,GDTABT(,GDTREG)                               0267
*                REG13 = GDTABH;                                   0268
         L     REG13,GDTABH(,GDTREG)                               0268
*                GEN(BR    REG14);                                 0269
         BR    REG14
*                RESPECIFY(REG13,REG14,REG15)UNRSTD;               0270
*              END;                                                0271
*                                                                  0271
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO THE CALLER WITH SUCCESSFUL RETURN CODE         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0272
*        CALL ICKSAEP0(GDTTBL,MODID,TESTRC);                       0272
*                                                                  0272
*                                                                  0272
@RC00254 ST    GDTREG,@AL00001                                     0272
         LA    @15,MODID                                           0272
         ST    @15,@AL00001+4                                      0272
         LA    @15,TESTRC                                          0272
         ST    @15,@AL00001+8                                      0272
         MVI   @AL00001+8,X'80'                                    0272
         L     @15,GDTEPL(,GDTREG)                                 0272
         LA    @01,@AL00001                                        0272
         BALR  @14,@15                                             0272
*ICKIOOP:  ENTRY (GDTTBLX,ARG1,ARG2,ARG3,ARG4);                    0273
*                                                                  0273
         B     @EC00273                                            0273
@EP00273 MVC   @PC00001(4),0(@01)                                  0273
         MVC   @PC00001+12(16),4(@01)                              0273
@EC00273 DS    0H                                                  0274
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED TO HAVE DATA SETS OPENED.     */
*        /* IOCSTR STRUCTURES ARE BUILT FOR EACH DATA SET.  THESE    */
*        /* CONTROL BLOCKS MUST BE USED AS INPUT TO THE I/O ADAPTER  */
*        /* TO PERFORM THE OTHER I/O ADAPTER FUNCTIONS.              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0274
*        /* AREA IN USER STORAGE TO RETURN IOCS ADDRESS              */
*        DCL RETIOCS PTR (31) BASED (OPNIOC);                      0274
*                                                                  0274
*                                                                  0274
*                                                                  0274
*        RESPECIFY (RTNREG) RSTD;                                  0275
*                                                                  0275
*                                                                  0276
*        /************************************************************/
*        /*                                                          */
*        /* ULISTLN MACRO INCLUDED CODE                              */
*        /*                                                          */
*        /*     LISTLN - TO CONTAIN THE NUMBER OF ARGUMENTS PASSED   */
*        /*              TO THIS ROUTINE                             */
*        /*                                                          */
*        /*     LISTPTR - TO CONTAIN THE ADDRESS OF THE CORRESPONDING*/
*        /*               ADDRESS LIST                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0276
*        GEN;                                                      0276
        ST    1,LISTPTR
        ST    1,LISTSCAN
*        DO LISTLN = 1 TO 255 WHILE(LISTTEST = '0'B);              0277
         LA    @14,1                                               0277
         STC   @14,LISTLN                                          0277
@DL00277 L     @07,LISTSCAN                                        0277
         TM    LISTTEST(@07),B'10000000'                           0277
         BNZ   @DC00277                                            0277
*          LISTSCAN = LISTSCAN + 4;                                0278
         AL    @07,@CF00037                                        0278
         ST    @07,LISTSCAN                                        0278
*        END;                                                      0279
*                                                                  0279
         AL    @14,@CF00158                                        0279
         STC   @14,LISTLN                                          0279
         C     @14,@CF00950                                        0279
         BNH   @DL00277                                            0279
@DC00277 DS    0H                                                  0280
*        RESPECIFY (RTNREG) UNRSTD;                                0280
*                                                                  0280
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO GDTTBL USING A REGISTER            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0281
*        GDTREG = ADDR (GDTTBLX);                                  0281
*                                                                  0281
         L     GDTREG,@PC00001                                     0281
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE ARGUMENTS USED BY THIS ENTRY POINT.           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0282
*        OLDERID2 = NEWERID2;                                      0282
         L     @15,GDTTR2(,GDTREG)                                 0282
         MVC   @TS00001(95),NEWERID2(@15)                          0282
         MVC   OLDERID2(95,@15),@TS00001                           0282
*        NEWID2 = 'IOOP';                                          0283
         MVC   NEWID2(4,@15),@CC00951                              0283
*        OCARRAY = ''B;                                            0284
         XC    OCARRAY(20),OCARRAY                                 0284
*        OCATYP = OCATYPOP;                                        0285
*                                                                  0285
         MVI   OCATYP,X'01'                                        0285
*        IF LISTLN < 2 × LISTLN > 5                                0286
*          THEN                                                    0286
*                                                                  0286
         CLI   LISTLN,2                                            0286
         BL    @RT00286                                            0286
         CLI   LISTLN,5                                            0286
         BNH   @RF00286                                            0286
@RT00286 DS    0H                                                  0287
*            /********************************************************/
*            /*                                                      */
*            /* ENTRY POINT CAN RECEIVE 2,3,4 OR 5 ARGUMENTS         */
*            /* TERMINATE PROCESSING IF LIST LENGTH INVALID.         */
*            /*                                                      */
*            /********************************************************/
*                                                                  0287
*                                                                  0287
*                DO;                                               0287
*                  RESPECIFY(REG13,REG14,REG15) RSTD;              0288
*                  REG15 = 40;                                     0289
         LA    REG15,40                                            0289
*                  REG14 = GDTABT;                                 0290
         L     REG14,GDTABT(,GDTREG)                               0290
*                  REG13 = GDTABH;                                 0291
         L     REG13,GDTABH(,GDTREG)                               0291
*                  GEN(BR    REG14);                               0292
         BR    REG14
*                  RESPECIFY(REG13,REG14,REG15)UNRSTD;             0293
*                END;                                              0294
*                                                                  0294
*          ELSE                                                    0295
*                                                                  0295
*            /********************************************************/
*            /*                                                      */
*            /* ARGUMENT LIST IS VALID - BUILD OPEN ARGUMENT LIST.   */
*            /*                                                      */
*            /********************************************************/
*                                                                  0295
*VALOPARG:   DO;                                                   0295
*                                                                  0295
         B     @RC00286                                            0295
@RF00286 DS    0H                                                  0295
VALOPARG DS    0H                                                  0296
*              OCANUM = LISTLN - 1;                                0296
*                                                                  0296
         SLR   @15,@15                                             0296
         IC    @15,LISTLN                                          0296
         BCTR  @15,0                                               0296
         STC   @15,OCANUM                                          0296
*BLDOLIST:     DO OCCTR = 2 TO LISTLN;                             0297
*                                                                  0297
BLDOLIST LA    @15,2                                               0297
         B     @DE00297                                            0297
@DL00297 DS    0H                                                  0298
*                OPNPTR = ARGADDR (OCCTR);                         0298
         LR    @14,@15                                             0298
         SLA   @14,2                                               0298
         L     @01,LISTPTR                                         0298
         AL    @01,@CF01099                                        0298
         L     @07,ARGADDR(@14,@01)                                0298
         ST    @07,OPNPTR                                          0298
*                RETIOCS = NULLPTR;                                0299
         L     @01,OPNIOC(,@07)                                    0299
         SLR   @00,@00                                             0299
         ST    @00,RETIOCS(,@01)                                   0299
*                OCADDR (OCCTR-1) = ARGADDR(OCCTR);                0300
*                                                                  0300
         ST    @07,OCADDR-8(@14)                                   0300
*              END BLDOLIST;                                       0301
*                                                                  0301
         AL    @15,@CF00158                                        0301
@DE00297 STH   @15,OCCTR                                           0301
         SLR   @14,@14                                             0301
         IC    @14,LISTLN                                          0301
         CR    @15,@14                                             0301
         BNH   @DL00297                                            0301
*              /******************************************************/
*              /*                                                    */
*              /* OPEN ALL REQUESTED DATA SETS AND SAVE HIGHEST RC   */
*              /*                                                    */
*              /******************************************************/
*                                                                  0302
*              CALL ICKSACL0 (GDTTBL,'ICKIO02 ',OCARRAY);          0302
         ST    GDTREG,@AL00001                                     0302
         LA    @15,@CC00957                                        0302
         ST    @15,@AL00001+4                                      0302
         LA    @15,OCARRAY                                         0302
         ST    @15,@AL00001+8                                      0302
         MVI   @AL00001+8,X'80'                                    0302
         L     @15,GDTCAL(,GDTREG)                                 0302
         LA    @01,@AL00001                                        0302
         BALR  @14,@15                                             0302
*              RESPECIFY RTNREG RSTD;                              0303
*              TESTRC = RTNREG;                                    0304
         STH   RTNREG,TESTRC                                       0304
*              RESPECIFY RTNREG UNRSTD;                            0305
*                                                                  0305
*          END VALOPARG;                                           0306
*                                                                  0306
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLER WITH HIGHEST RETURN CODE ENCOUNTERED    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0307
*        CALL ICKSAEP0(GDTTBL,MODID,TESTRC);                       0307
@RC00286 ST    GDTREG,@AL00001                                     0307
         LA    @15,MODID                                           0307
         ST    @15,@AL00001+4                                      0307
         LA    @15,TESTRC                                          0307
         ST    @15,@AL00001+8                                      0307
         MVI   @AL00001+8,X'80'                                    0307
         L     @15,GDTEPL(,GDTREG)                                 0307
         LA    @01,@AL00001                                        0307
         BALR  @14,@15                                             0307
*ICKIOTM:  ENTRY (GDTTBLX);                                        0308
*                                                                  0308
         B     @EC00308                                            0308
@EP00308 MVC   @PC00001(4),0(@01)                                  0308
@EC00308 DS    0H                                                  0309
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED TO TERMINATE PROCESSING.  ALL */
*        /* REMAINING OPEN DATA SET ARE CLOSED.  ALL STORAGE THAT    */
*        /* THE I/O ADAPTER HAS OBTAINED IS RELEASED.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0309
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO THE GDTTBL USING A REGISTER        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0309
*        GDTREG = ADDR (GDTTBLX);                                  0309
*                                                                  0309
*                                                                  0309
         L     GDTREG,@PC00001                                     0309
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE STRUCTURED ARGUMENTS USED DURING PROCESSING   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0310
*        OLDERID2 = NEWERID2;                                      0310
         L     @15,GDTTR2(,GDTREG)                                 0310
         MVC   @TS00001(95),NEWERID2(@15)                          0310
         MVC   OLDERID2(95,@15),@TS00001                           0310
*        NEWID2 = 'IOTM';                                          0311
*                                                                  0311
         MVC   NEWID2(4,@15),@CC00963                              0311
*        OCARRAY = ''B;                                            0312
         XC    OCARRAY(20),OCARRAY                                 0312
*        OCATYP = OCATYPCL;                                        0313
*                                                                  0313
         MVI   OCATYP,X'02'                                        0313
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE A RETURN CODE.  IF AN ERROR THIS RETURN CODE  */
*        /* WILL BE SET TO INDICATE THE ERROR AND IS RETURNED        */
*        /* TO THE CALLER.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0314
*        SETRC = 0;                                                0314
*                                                                  0314
         SLR   @15,@15                                             0314
         STH   @15,SETRC                                           0314
*        /************************************************************/
*        /*                                                          */
*        /* CLOSE ALL DATA SETS THAT ARE STILL OPEN AND FREE         */
*        /* ALL STORAGE OBTAINED FOR ALL DATA SETS.                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0315
*        OCAOPTCA = ON;                                            0315
*                                                                  0315
         OI    OCAOPTCA,B'10000000'                                0315
*CLOSEALL:                                                         0316
*                                                                  0316
*        /************************************************************/
*        /*                                                          */
*        /* THIS LOOP WILL CLOSE A MAXIMUM OF FOUR DATA SETS WITH    */
*        /* EACH CALL TO THE CLOSE ROUTINE.  THE LOOP IS EXECUTED    */
*        /* UNTIL ALL ALL DATA SETS ARE CLOSED.                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0316
*        DO WHILE IODIOC ^= NULLPTR;                               0316
*                                                                  0316
CLOSEALL B     @DE00316                                            0316
@DL00316 DS    0H                                                  0317
*          /**********************************************************/
*          /*                                                        */
*          /* CLOSE THE DATA SETS AND SAVE THE HIGHEST ERROR CODE.   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0317
*          CALL ICKSACL0 (GDTTBL,'ICKIO02 ',OCARRAY);              0317
         ST    GDTREG,@AL00001                                     0317
         LA    @15,@CC00957                                        0317
         ST    @15,@AL00001+4                                      0317
         LA    @15,OCARRAY                                         0317
         ST    @15,@AL00001+8                                      0317
         MVI   @AL00001+8,X'80'                                    0317
         L     @15,GDTCAL(,GDTREG)                                 0317
         LA    @01,@AL00001                                        0317
         BALR  @14,@15                                             0317
*          RESPECIFY RTNREG RSTD;                                  0318
*          TESTRC = RTNREG;                                        0319
         STH   RTNREG,TESTRC                                       0319
*          RESPECIFY RTNREG UNRSTD;                                0320
*                                                                  0320
*          IF TESTRC = 4                                           0321
*            THEN                                                  0321
*                                                                  0321
         LH    @15,TESTRC                                          0321
         LA    @14,4                                               0321
         CR    @15,@14                                             0321
         BNE   @RF00321                                            0321
*              /******************************************************/
*              /*                                                    */
*              /*   IF ERROR WAS DETECTED SAVE ERROR CODE.           */
*              /*                                                    */
*              /******************************************************/
*                                                                  0322
*              SETRC = 4;                                          0322
*                                                                  0322
         STH   @14,SETRC                                           0322
*        END CLOSEALL;                                             0323
*                                                                  0323
@RF00321 DS    0H                                                  0323
@DE00316 L     @01,GDTIOH(,GDTREG)                                 0323
         L     @15,IODIOC(,@01)                                    0323
         LTR   @15,@15                                             0323
         BNZ   @DL00316                                            0323
*        /***********************************************************/
*        /*                                                          */
*        /*     ALL DATA SETS HAVE BEEN CLOSED                       */
*        /*     FREE ALL STORAGE USED FOR DATA SETS AND THE I/O      */
*        /*     ADAPTER NOT PREVIOUSLY FREED                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0324
*        CALL ICKSAFP0 (GDTTBL,INITID,ALL);                        0324
         MVC   @AL00001+4(8),@AL00324                              0324
         ST    GDTREG,@AL00001                                     0324
         L     @15,GDTFPL(,GDTREG)                                 0324
         LA    @01,@AL00001                                        0324
         BALR  @14,@15                                             0324
*        GDTIOH = NULLPTR;                                         0325
*                                                                  0325
         SLR   @15,@15                                             0325
         ST    @15,GDTIOH(,GDTREG)                                 0325
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLER WITH HIGHEST ERROR CODE ENCOUNTERED.    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0326
*        CALL ICKSAEP0(GDTTBL,MODID,SETRC);                        0326
         ST    GDTREG,@AL00001                                     0326
         LA    @15,MODID                                           0326
         ST    @15,@AL00001+4                                      0326
         LA    @15,SETRC                                           0326
         ST    @15,@AL00001+8                                      0326
         MVI   @AL00001+8,X'80'                                    0326
         L     @15,GDTEPL(,GDTREG)                                 0326
         LA    @01,@AL00001                                        0326
         BALR  @14,@15                                             0326
*ICKIOCL:  ENTRY (GDTTBLX,ARG1,ARG2,ARG3,ARG4);                    0327
*                                                                  0327
         B     @EC00327                                            0327
@EP00327 MVC   @PC00001(4),0(@01)                                  0327
         MVC   @PC00001+12(16),4(@01)                              0327
@EC00327 DS    0H                                                  0328
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED TO CLOSE DATA SETS THAT       */
*        /* WERE OPENED BY THE I/O ADAPTER.  ALL STORAGE AND         */
*        /* CONTROL BLOCKS OBTAINED FOR THE DATA SET BEING CLOSED    */
*        /* ARE RELEASED.                                            */
*        /*                                                          */
*        /* IF AN ERROR WAS DETECTED DURING OPEN THE DATA SET DOES   */
*        /* NOT NEED TO BE CLOSED.  THE I/O ADAPTER CLOSE WILL       */
*        /* STILL RELEASE THE AUTOMATIC STORAGE AND CONTROL BLOCKS   */
*        /* THAT WERE OBTAINED BEFORE THE ERROR WAS DETECTED.        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0328
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED ONLY BY THIS ENTRY POINT                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0328
*        /* ADDRESS OF FULLWORD CONTAINING IOCSTR ADDRESS            */
*        DCL CLOPTR PTR (31);                                      0328
*        /* ADDRESS OF IOCS DEFINING DATA SET TO CLOSE               */
*        DCL CLOSIOCS PTR (31) BASED (CLOPTR);                     0329
*                                                                  0329
*                                                                  0329
*                                                                  0329
*        RESPECIFY (RTNREG) RSTD;                                  0330
*                                                                  0330
*                                                                  0331
*        /************************************************************/
*        /*                                                          */
*        /* ULISTLN MACRO INCLUDED CODE                              */
*        /*                                                          */
*        /*     LISTLN - TO CONTAIN THE NUMBER OF ARGUMENTS PASSED   */
*        /*              TO THIS ROUTINE                             */
*        /*                                                          */
*        /*     LISTPTR - TO CONTAIN THE ADDRESS OF THE CORRESPONDING*/
*        /*               ADDRESS LIST                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0331
*        GEN;                                                      0331
        ST    1,LISTPTR
        ST    1,LISTSCAN
*        DO LISTLN = 1 TO 255 WHILE(LISTTEST = '0'B);              0332
         LA    @14,1                                               0332
         STC   @14,LISTLN                                          0332
@DL00332 L     @07,LISTSCAN                                        0332
         TM    LISTTEST(@07),B'10000000'                           0332
         BNZ   @DC00332                                            0332
*          LISTSCAN = LISTSCAN + 4;                                0333
         AL    @07,@CF00037                                        0333
         ST    @07,LISTSCAN                                        0333
*        END;                                                      0334
*                                                                  0334
         AL    @14,@CF00158                                        0334
         STC   @14,LISTLN                                          0334
         C     @14,@CF00950                                        0334
         BNH   @DL00332                                            0334
@DC00332 DS    0H                                                  0335
*        RESPECIFY (RTNREG) UNRSTD;                                0335
*                                                                  0335
*        /************************************************************/
*        /*                                                          */
*        /*  SET ADDRESSIBILITY TO THE GDTTBL USING A REGISTER       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0336
*        GDTREG = ADDR (GDTTBLX);                                  0336
*                                                                  0336
         L     GDTREG,@PC00001                                     0336
*        OLDERID2 = NEWERID2;                                      0337
         L     @15,GDTTR2(,GDTREG)                                 0337
         MVC   @TS00001(95),NEWERID2(@15)                          0337
         MVC   OLDERID2(95,@15),@TS00001                           0337
*        NEWID2 = 'IOCL';                                          0338
*                                                                  0338
         MVC   NEWID2(4,@15),@CC00977                              0338
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE ARGUMENTS USED BY THIS ROUTINE WHEN CALLING   */
*        /* OTHER MODULES.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0339
*        OCARRAY = ''B;                                            0339
         XC    OCARRAY(20),OCARRAY                                 0339
*        OCATYP = OCATYPCL;                                        0340
*                                                                  0340
         MVI   OCATYP,X'02'                                        0340
*        IF LISTLN < 2 × LISTLN > 5                                0341
*          THEN                                                    0341
*                                                                  0341
         CLI   LISTLN,2                                            0341
         BL    @RT00341                                            0341
         CLI   LISTLN,5                                            0341
         BNH   @RF00341                                            0341
@RT00341 DS    0H                                                  0342
*            /********************************************************/
*            /*                                                      */
*            /* 2,3,4 OR 5 DATA SETS MAY BE CLOSED WITH ONE CALL     */
*            /* TO THIS ENTRY POINT.  IF THE ARGUMENTS LIST SPECIFIES*/
*            /* A DIFFERENT NUMBER PROCESSING IS TERMINATED.         */
*            /*                                                      */
*            /********************************************************/
*                                                                  0342
*                                                                  0342
*              DO;                                                 0342
*                RESPECIFY(REG13,REG14,REG15) RSTD;                0343
*                REG15 = 40;                                       0344
         LA    REG15,40                                            0344
*                REG14 = GDTABT;                                   0345
         L     REG14,GDTABT(,GDTREG)                               0345
*                REG13 = GDTABH;                                   0346
         L     REG13,GDTABH(,GDTREG)                               0346
*                GEN(BR    REG14);                                 0347
         BR    REG14
*                RESPECIFY(REG13,REG14,REG15)UNRSTD;               0348
*              END;                                                0349
*                                                                  0349
*          ELSE                                                    0350
*                                                                  0350
*            /********************************************************/
*            /*                                                      */
*            /* PLACE THE ADDRESSES OF ALL IOCSS DEFINING DATA SETS  */
*            /* TO BE CLOSED IN THE CLOSE ROUTINE ARGUMENT LIST.     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0350
*VALCLARG:   DO;                                                   0350
*                                                                  0350
         B     @RC00341                                            0350
@RF00341 DS    0H                                                  0350
VALCLARG DS    0H                                                  0351
*              DO OCCTR = 2 TO LISTLN;                             0351
*                                                                  0351
         LA    @15,2                                               0351
         B     @DE00351                                            0351
@DL00351 DS    0H                                                  0352
*                CLOPTR = ARGADDR (OCCTR);                         0352
         LR    @14,@15                                             0352
         SLA   @14,2                                               0352
         L     @01,LISTPTR                                         0352
         AL    @01,@CF01099                                        0352
         L     @07,ARGADDR(@14,@01)                                0352
         ST    @07,CLOPTR                                          0352
*                OCADDR (OCCTR-1) = CLOSIOCS;                      0353
*                                                                  0353
         L     @07,CLOSIOCS(,@07)                                  0353
         ST    @07,OCADDR-8(@14)                                   0353
*              END;                                                0354
*                                                                  0354
         AL    @15,@CF00158                                        0354
@DE00351 STH   @15,OCCTR                                           0354
         SLR   @14,@14                                             0354
         IC    @14,LISTLN                                          0354
         CR    @15,@14                                             0354
         BNH   @DL00351                                            0354
*              /******************************************************/
*              /*                                                    */
*              /* CLOSE ALL DATA SETS REQUESTED AND FREE THE STORAGE */
*              /* THEY REQUIRED.  SAVE THE HIGHEST ERROR CODE        */
*              /* ENCOUNTERED.                                       */
*              /*                                                    */
*              /******************************************************/
*                                                                  0355
*              CALL ICKSACL0 (GDTTBL,'ICKIO02 ',OCARRAY);          0355
         ST    GDTREG,@AL00001                                     0355
         LA    @15,@CC00957                                        0355
         ST    @15,@AL00001+4                                      0355
         LA    @15,OCARRAY                                         0355
         ST    @15,@AL00001+8                                      0355
         MVI   @AL00001+8,X'80'                                    0355
         L     @15,GDTCAL(,GDTREG)                                 0355
         LA    @01,@AL00001                                        0355
         BALR  @14,@15                                             0355
*              RESPECIFY RTNREG RSTD;                              0356
*              TESTRC = RTNREG;                                    0357
         STH   RTNREG,TESTRC                                       0357
*              RESPECIFY RTNREG UNRSTD;                            0358
*                                                                  0358
*            END VALCLARG;                                         0359
*                                                                  0359
*        /************************************************************/
*        /*                                                          */
*        /* THE HIGHEST RETURN CODE SET IS RETURNED TO THE CALLER.   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0360
*        CALL ICKSAEP0(GDTTBL,MODID,TESTRC);                       0360
@RC00341 ST    GDTREG,@AL00001                                     0360
         LA    @15,MODID                                           0360
         ST    @15,@AL00001+4                                      0360
         LA    @15,TESTRC                                          0360
         ST    @15,@AL00001+8                                      0360
         MVI   @AL00001+8,X'80'                                    0360
         L     @15,GDTEPL(,GDTREG)                                 0360
         LA    @01,@AL00001                                        0360
         BALR  @14,@15                                             0360
*ICKIOGT:  ENTRY (GDTTBLX,GETIOCS);                                0361
*                                                                  0361
         B     @EC00361                                            0361
@EP00361 MVC   @PC00001(4),0(@01)                                  0361
         MVC   @PC00001+28(4),4(@01)                               0361
@EC00361 DS    0H                                                  0362
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED TO GET A DATA RECORD FROM     */
*        /* A DATA SET.  DATA RECORDS CAN BE READ FROM ANY DATA SET  */
*        /* THAT THE I/O ADAPTER COULD OPEN.  THE DATA RECORD LENGTH */
*        /* AND ADDRESS ARE RETURNED IN THE IOCSTR.                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0362
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED BY THIS ENTRY POINT ONLY                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0362
*        /* ENTRY POINT RECEIVES THE FOLLOWING ARGUMENTS             */
*        DCL GETIOCS PTR (31);         /* INPUT DATA SET IOCS        */
*                                                                  0362
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO THE GDTTBL USING A REGISTER        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0363
*        GDTREG = ADDR (GDTTBLX);                                  0363
*                                                                  0363
         L     GDTREG,@PC00001                                     0363
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO THE INPUT IOCS                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0364
*        OLDERID2 = NEWERID2;                                      0364
         L     @15,GDTTR2(,GDTREG)                                 0364
         MVC   @TS00001(95),NEWERID2(@15)                          0364
         MVC   OLDERID2(95,@15),@TS00001                           0364
*        NEWID2 = 'IOGT';                                          0365
         MVC   NEWID2(4,@15),@CC00987                              0365
*        IOCSPTR = GETIOCS;                                        0366
*                                                                  0366
         L     @15,@PC00001+28                                     0366
         L     @15,GETIOCS(,@15)                                   0366
         ST    @15,IOCSPTR                                         0366
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE TEXT PROCESSOR ARGUMENT LIST                  */
*        /* SET DEFAULT ERROR MESSAGE MODULE ID                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0367
*        DMSGARG = ''B;                                            0367
         XC    DMSGARG(44),DMSGARG                                 0367
*        DDSTRU = ADDR (DMSGARG);                                  0368
         LA    @14,DMSGARG                                         0368
         ST    @14,DDSTRU                                          0368
*        DARGSMOD = 'IO0';                                         0369
*                                                                  0369
         MVC   DARGSMOD(3,@14),@CC00988                            0369
*        /************************************************************/
*        /*                                                          */
*        /* IF IOCS WAS NOT BUILT OR DATA SET IS NOT OPEN            */
*        /* PROCESSING IS TERMINATED.                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0370
*        IF IOCSPTR = NULLPTR × IOCMSGOP = OFF                     0370
*          THEN                                                    0370
*                                                                  0370
*                                                                  0370
         LTR   @15,@15                                             0370
         BZ    @RT00370                                            0370
         TM    IOCMSGOP(@15),B'10000000'                           0370
         BNZ   @RF00370                                            0370
@RT00370 DS    0H                                                  0371
*              DO;                                                 0371
*                RESPECIFY(REG13,REG14,REG15) RSTD;                0372
*                REG15 = 32;                                       0373
         LA    REG15,32                                            0373
*                REG14 = GDTABT;                                   0374
         L     REG14,GDTABT(,GDTREG)                               0374
*                REG13 = GDTABH;                                   0375
         L     REG13,GDTABH(,GDTREG)                               0375
*                GEN(BR    REG14);                                 0376
         BR    REG14
*                RESPECIFY(REG13,REG14,REG15)UNRSTD;               0377
*              END;                                                0378
*                                                                  0378
*        /************************************************************/
*        /*                                                          */
*        /*       IF END OF FILE HAS ALREADY BEEN DETECTED IN DATA   */
*        /*       SET RETURN TO CALLER WITH EOD-OF-DATA RETURN CODE  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0379
*        IF IOCFLGEF = ON                                          0379
*          THEN                                                    0379
@RF00370 L     @15,IOCSPTR                                         0379
         L     @01,IOCEXT(,@15)                                    0379
         TM    IOCFLGEF(@01),B'00100000'                           0379
         BNO   @RF00379                                            0379
*            DO;                                                   0380
*              IF IOCMACPA = OFF                                   0381
*                THEN                                              0381
         TM    IOCMACPA(@15),B'00000001'                           0381
         BNZ   @RF00381                                            0381
*                  DO;                                             0382
*                    SETRC = 16;                                   0383
         MVC   SETRC(2),@CH00262                                   0383
*                    CALL ICKSAEP0(GDTTBL,MODID,SETRC);            0384
         ST    GDTREG,@AL00001                                     0384
         LA    @15,MODID                                           0384
         ST    @15,@AL00001+4                                      0384
         LA    @15,SETRC                                           0384
         ST    @15,@AL00001+8                                      0384
         MVI   @AL00001+8,X'80'                                    0384
         L     @15,GDTEPL(,GDTREG)                                 0384
         LA    @01,@AL00001                                        0384
         BALR  @14,@15                                             0384
*                  END;                                            0385
*                ELSE                                              0386
*                  DO;                                             0386
         B     @RC00381                                            0386
@RF00381 DS    0H                                                  0387
*                    IOCFLGEF = OFF;                               0387
         L     @15,IOCSPTR                                         0387
         L     @01,IOCEXT(,@15)                                    0387
         NI    IOCFLGEF(@01),B'11011111'                           0387
*                    IOCMACPA = OFF;                               0388
         NI    IOCMACPA(@15),B'11111110'                           0388
*                  END;                                            0389
*        END;                                                      0390
*                                                                  0390
@RC00381 DS    0H                                                  0391
*        /************************************************************/
*        /*                                                          */
*        /*       IF THE DATA SET IS EXTERNALLY CONTROLLED GET       */
*        /*       A DATA RECORD FROM EXTERNAL ROUTINE.               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0391
*        IF IOCFLGEX = ON                                          0391
*          THEN                                                    0391
*                                                                  0391
@RF00379 L     @01,IOCSPTR                                         0391
         L     @01,IOCEXT(,@01)                                    0391
         TM    IOCFLGEX(@01),B'10000000'                           0391
         BNO   @RF00391                                            0391
*            /********************************************************/
*            /*                                                      */
*            /* BUILD EXTERNAL GET FLAG FIELD AND CALL EXTERNAL RTN  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0392
*            DO;                                                   0392
*              EXTFLGFD = 0;                                       0393
         SLR   @15,@15                                             0393
         ST    @15,EXTFLGFD                                        0393
*              EXTTYPE = EXGETREQ;                                 0394
         MVI   EXTTYPE,X'08'                                       0394
*              CALL GETEXT (EXTFLGFD);                             0395
         LA    @15,EXTFLGFD                                        0395
         ST    @15,@AL00001                                        0395
         LA    @01,@AL00001                                        0395
         BAL   @14,GETEXT                                          0395
*            END;                                                  0396
*                                                                  0396
*          ELSE                                                    0397
*            CALL GETNONVS;                                        0397
*                                                                  0397
         B     @RC00391                                            0397
@RF00391 BAL   @14,GETNONVS                                        0397
*        /************************************************************/
*        /*                                                          */
*        /*       SAVE THE RETURN CODE FROM THE GET  SUBROUTINE.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0398
*        RESPECIFY RTNREG RSTD;                                    0398
@RC00391 DS    0H                                                  0399
*        TESTRC = RTNREG;                                          0399
         STH   RTNREG,TESTRC                                       0399
*        RESPECIFY RTNREG UNRSTD;                                  0400
*                                                                  0400
*        /************************************************************/
*        /*                                                          */
*        /* IF A MESSAGE IS TO BE WRITTEN THE MESSAGE ID HAS BEEN    */
*        /* SET IN THE TEXT PROC ARGUMENT.  THE PRINT ROUTINE        */
*        /* IS CALLED TO WRITE THE MESSAGE.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0401
*        IF DARGSENT ^= 0                                          0401
*          THEN                                                    0401
         L     @01,DDSTRU                                          0401
         CLI   DARGSENT(@01),0                                     0401
         BE    @RF00401                                            0401
*            CALL BLDDMSG;                                         0402
*                                                                  0402
         BAL   @14,BLDDMSG                                         0402
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO THE CALLER WITH THE HIGHEST ERROR CODE         */
*        /* ENCOUNTERED SET IN REGISTER 15.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0403
*        CALL ICKSAEP0(GDTTBL,MODID,TESTRC);                       0403
@RF00401 ST    GDTREG,@AL00001                                     0403
         LA    @15,MODID                                           0403
         ST    @15,@AL00001+4                                      0403
         LA    @15,TESTRC                                          0403
         ST    @15,@AL00001+8                                      0403
         MVI   @AL00001+8,X'80'                                    0403
         L     @15,GDTEPL(,GDTREG)                                 0403
         LA    @01,@AL00001                                        0403
         BALR  @14,@15                                             0403
*                                                                  0404
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - GETEXT                                  */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE WILL CALL AN EXTERNAL INPUT    */
*        /*            ROUTINE TO HAVE A DATA RECORD LOCATED.  THE   */
*        /*            EXTERNAL ARGUMENT, FLAG FIELD AND IOCSPTR     */
*        /*            ARE PASSED AS ARGUMENTS TO THE EXTERNAL       */
*        /*            ROUTINE.                                      */
*        /*                                                          */
*        /* INPUT -    IOCSPTR - ADDRESS OF INPUT IOCS.              */
*        /*                                                          */
*        /* OUTPUT -   IOCS IS UPDATE BY EXTERNAL ROUTINE            */
*        /*            RETURN CODE IS SET (FROM EXTERNAL RC)         */
*        /*                                                          */
*        /* ERRORS -   AN ERROR RETURN CODE FROM THE EXTERNAL        */
*        /*            ROUTINE RESULTS IN ERROR CODE BEING SET       */
*        /*            IN TESTRC.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0404
*GETEXT: PROC (INFLGFLD) OPTIONS (SAVEAREA);                       0404
*                                                                  0404
         B     @PB00002                                            0404
GETEXT   STM   @14,@12,12(@13)                                     0404
         ST    @13,@SA00002+4                                      0404
         LA    @14,@SA00002                                        0404
         ST    @14,8(,@13)                                         0404
         LR    @13,@14                                             0404
         MVC   @PC00002(4),0(@01)                                  0404
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED ONLY BY THIS PROCEDURE.                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0405
*        /* EXTERNAL ROUTINE FLAG FIELD                              */
*        DCL INFLGFLD FIXED (31);                                  0405
*                                                                  0405
*        /* RETURN CODE FOR MAIN ROUTINE AFTER GET EXTERNAL          */
*        DCL EXTRC FIXED (15);                                     0406
*                                                                  0406
*        /************************************************************/
*        /*                                                          */
*        /*GET DATA RECORD FROM EXTERNAL ROUTINE AND SAVE RETURN CODE*/
*        /*                                                          */
*        /************************************************************/
*                                                                  0407
*        EXTRC = EXTOK;                                            0407
*                                                                  0407
         SLR   @15,@15                                             0407
         STH   @15,EXTRC                                           0407
*        OLDERID2 = NEWERID2;                                      0408
         L     @15,GDTTR2(,GDTREG)                                 0408
         MVC   @TS00001(95),NEWERID2(@15)                          0408
         MVC   OLDERID2(95,@15),@TS00001                           0408
*        NEWID2 = 'IOEG';                                          0409
*                                                                  0409
         MVC   NEWID2(4,@15),@CC00998                              0409
*        CALL EXTRTN (IOEXPARM,INFLGFLD,EXTIOCS);                  0410
         L     @01,IOCSPTR                                         0410
         L     @15,IOCEXT(,@01)                                    0410
         L     @01,IOCXPM(,@15)                                    0410
         ST    @01,@AL00001                                        0410
         L     @14,@PC00002                                        0410
         ST    @14,@AL00001+4                                      0410
         LA    @14,EXTIOCS                                         0410
         ST    @14,@AL00001+8                                      0410
         MVI   @AL00001+8,X'80'                                    0410
         L     @15,IOCXAD(,@15)                                    0410
         LA    @01,@AL00001                                        0410
         BALR  @14,@15                                             0410
*        RESPECIFY RTNREG RSTD;                                    0411
*        TESTRC = RTNREG;                                          0412
         STH   RTNREG,TESTRC                                       0412
*        RESPECIFY RTNREG UNRSTD;                                  0413
*                                                                  0413
*        IF TESTRC = EXTEOD                                        0414
*          THEN                                                    0414
*                                                                  0414
         LH    @15,TESTRC                                          0414
         C     @15,@CF00037                                        0414
         BNE   @RF00414                                            0414
*            /********************************************************/
*            /*                                                      */
*            /* EODAD FROM EXTERNAL ROUTINE - SET RETURN CODE        */
*            /*                                                      */
*            /********************************************************/
*                                                                  0415
*            DO;                                                   0415
*              IOCFLGEF = ON;                                      0416
         L     @01,IOCSPTR                                         0416
         L     @01,IOCEXT(,@01)                                    0416
         OI    IOCFLGEF(@01),B'00100000'                           0416
*              EXTRC = 16;                                         0417
         MVC   EXTRC(2),@CH00262                                   0417
*            END;                                                  0418
*                                                                  0418
*          ELSE                                                    0419
*            DO;                                                   0419
*                                                                  0419
         B     @RC00414                                            0419
@RF00414 DS    0H                                                  0420
*              IF TESTRC = EXTOK                                   0420
*                THEN                                              0420
*                                                                  0420
         LH    @15,TESTRC                                          0420
         LTR   @15,@15                                             0420
         BNZ   @RF00420                                            0420
*                  /**************************************************/
*                  /*                                                */
*                  /* GET SUCCESSFUL - SET IOCSTR VALUES             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0421
*                  DO;                                             0421
*                    IOCDAD = EXTDAD;                              0422
         L     @15,IOCSPTR                                         0422
         L     @14,EXTDAD                                          0422
         ST    @14,IOCDAD(,@15)                                    0422
*                    IOCDLN = EXTDLN;                              0423
         L     @14,EXTDLN                                          0423
         ST    @14,IOCDLN(,@15)                                    0423
*                    IOCRRN = IOCRRN + 1;                          0424
         LA    @14,1                                               0424
         AL    @14,IOCRRN(,@15)                                    0424
         ST    @14,IOCRRN(,@15)                                    0424
*                  END;                                            0425
*                                                                  0425
*                ELSE                                              0426
*                                                                  0426
*                  /**************************************************/
*                  /*                                                */
*                  /* ERROR - CHECK TYPE AND SET RETURN CODE         */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0426
*                  DO;                                             0426
         B     @RC00420                                            0426
@RF00420 DS    0H                                                  0427
*                    EXTRC = 4;                                    0427
         MVC   EXTRC(2),@CH00037                                   0427
*                    IF TESTRC = EXTTERM                           0428
*                      THEN                                        0428
         CLC   TESTRC(2),@CH00034                                  0428
         BNE   @RF00428                                            0428
*                        IOCMSGOP = OFF;                           0429
         L     @01,IOCSPTR                                         0429
         NI    IOCMSGOP(@01),B'01111111'                           0429
*                  END;                                            0430
*                                                                  0430
@RF00428 DS    0H                                                  0431
*            END;                                                  0431
*                                                                  0431
@RC00420 DS    0H                                                  0432
*        IF GDTDBG = NULLPTR                                       0432
*          THEN;                                                   0432
@RC00414 L     @15,GDTDBG(,GDTREG)                                 0432
         LTR   @15,@15                                             0432
         BZ    @RT00432                                            0432
*          ELSE                                                    0434
*            CALL ICKDB010 (GDTTBL,'IOEG');                        0434
*                                                                  0434
         ST    GDTREG,@AL00001                                     0434
         LA    @15,@CC00998                                        0434
         ST    @15,@AL00001+4                                      0434
         MVI   @AL00001+4,X'80'                                    0434
         L     @15,GDTDBG(,GDTREG)                                 0434
         LA    @01,@AL00001                                        0434
         BALR  @14,@15                                             0434
*        /************************************************************/
*        /*                                                          */
*        /* SET HIGHEST RETURN CODE ENCOUNTERED FOR MAIN ROUTINE.    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0435
*        RETURN CODE (EXTRC);                                      0435
@RT00432 LH    @15,EXTRC                                           0435
         L     @13,4(,@13)                                         0435
         L     @14,12(,@13)                                        0435
         LM    @00,@12,20(@13)                                     0435
         BR    @14                                                 0435
*        END GETEXT;                                               0436
*                                                                  0437
*                                                                  0437
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - GETNONVS                                */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE WILL GET A LOGICAL RECORD      */
*        /*            FROM A  DATA SET.                             */
*        /*                                                          */
*        /* INPUT -    IOCSPTR CONTAINS THE ADDRESS OF THE IOCS      */
*        /*            DEFINING THE INPUT DATA SET.                  */
*        /*                                                          */
*        /* OUTPUT -   IOCDAD - RECORD ADDRESS                       */
*        /*            IOCDLN - LENGTH OF DATA RECORD                */
*        /*            GETRC  - RETURN CODE                          */
*        /*                                                          */
*        /* ERRORS -   I/O ERROR GETTING DATA RECORD.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0437
*GETNONVS: PROC OPTIONS (SAVEAREA);                                0437
*                                                                  0437
GETNONVS STM   @14,@12,12(@13)                                     0437
         ST    @13,@SA00003+4                                      0437
         LA    @14,@SA00003                                        0437
         ST    @14,8(,@13)                                         0437
         LR    @13,@14                                             0437
*        /* RETURN CODE FOR THE GET OPERATION                        */
*        DCL GETRC FIXED (15);                                     0438
*                                                                  0438
*        DCL KEYADDR PTR (31);         /* ADDRESS OF ISAM KEY        */
*        DCL MOVEKEY CHAR (256) BASED (KEYADDR);                   0440
*                                                                  0440
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE RETURN CODE AND SET ADDRESSIBILITY TO DCB     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0441
*        GETRC = 0;                                                0441
         SLR   @15,@15                                             0441
         STH   @15,GETRC                                           0441
*        DCBPTR = IOCCBA;                                          0442
         L     @15,IOCSPTR                                         0442
         L     @01,IOCEXT(,@15)                                    0442
         L     @14,IOCCBA(,@01)                                    0442
         ST    @14,DCBPTR                                          0442
*        OLDERID2 = NEWERID2;                                      0443
         L     @14,GDTTR2(,GDTREG)                                 0443
         MVC   @TS00001(95),NEWERID2(@14)                          0443
         MVC   OLDERID2(95,@14),@TS00001                           0443
*        NEWID2 = 'IOOG';                                          0444
*                                                                  0444
*                                                                  0444
         MVC   NEWID2(4,@14),@CC01006                              0444
*        /************************************************************/
*        /*                                                          */
*        /* IF THE DATA SET IS OPEN FOR BLOCK PROCESSING             */
*        /* THE READ MACRO WILL BE ISSUED                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0445
*        IF IOCMACBK = ON                                          0445
*          THEN                                                    0445
         TM    IOCMACBK(@15),B'00010000'                           0445
         BNO   @RF00445                                            0445
*BSAMGET:    DO;                                                   0446
*                                                                  0446
BSAMGET  DS    0H                                                  0447
*              /******************************************************/
*              /*                                                    */
*              /* MOVE LIST FORM OF READ MACRO                       */
*              /*                                                    */
*              /******************************************************/
*                                                                  0447
*              DECBADDR = ADDR (READLIST);                         0447
         LA    @15,READLIST                                        0447
         ST    @15,DECBADDR                                        0447
*              MACAREA (1:24) = IODECB (1:24);                     0448
*                                                                  0448
         MVC   MACAREA(24),IODECB(@15)                             0448
*              RFY (REG6) RSTD;                                    0449
*              RFY (REG5) RSTD;                                    0450
*              RFY (REG7) RSTD;                                    0451
*                                                                  0451
*              REG7 = DCBPTR;                                      0452
         L     REG7,DCBPTR                                         0452
*              REG6 = IOCWKA;                                      0453
         L     @04,IOCSPTR                                         0453
         L     @04,IOCEXT(,@04)                                    0453
         L     REG6,IOCWKA(,@04)                                   0453
*              REG5 = ADDR (MACAREA);                              0454
*                                                                  0454
         LA    REG5,MACAREA                                        0454
*LREAD1:       GEN(READ  (REG5),SF,(REG7),(REG6),MF=E);            0455
LREAD1   READ  (REG5),SF,(REG7),(REG6),MF=E
*LCHECK1:      GEN(CHECK (REG5));                                  0456
*                                                                  0456
LCHECK1  CHECK (REG5)
*              RFY (REG5) UNRSTD;                                  0457
*              RFY (REG6) UNRSTD;                                  0458
*              RFY (REG7) UNRSTD;                                  0459
*                                                                  0459
*              /******************************************************/
*              /*                                                    */
*              /* FOR UPDATE PROCESSING, SAVE A COPY OF              */
*              /* THE READ DECB FOR THE SUBSEQUENT WRITE.            */
*              /*                                                    */
*              /******************************************************/
*                                                                  0460
*              IF IOCMACUP = ON                                    0460
*                THEN                                              0460
         L     @15,IOCSPTR                                         0460
         TM    IOCMACUP(@15),B'00100000'                           0460
         BNO   @RF00460                                            0460
*                     UPDECB(1:24) = MACAREA (1:24);               0461
*                                                                  0461
         L     @01,IOCEXT(,@15)                                    0461
         L     @01,IOCDEC(,@01)                                    0461
         MVC   UPDECB(24,@01),MACAREA                              0461
*              /******************************************************/
*              /*                                                    */
*              /* IF NO MESSAGE HAS BEEN SET BY AN EXIT              */
*              /* ROUTINE THE READ WAS SUCCESSFUL.                   */
*              /* THE ADDRESS OF THE RECORD IS THE ADDRESS           */
*              /* OF THE WORKAREA.                                   */
*              /* IF DATA SET IS BEING PROCESSED WITH A KEY          */
*              /* THE KEY IS CONTAINED IN THE WORKAREA.              */
*              /* THE LENGTH OF THE  BLOCK FOR VARIABLE              */
*              /* LENGTH RECORDS IS FOUND IN THE BLOCK               */
*              /* DESCRIPTOR WORD.  THE LENGTH FOR FIXED             */
*              /* UNBLOCKED RECORDS IS FOUND IN DCBBLKSI.            */
*              /* THE LENGTH FOR ALL OTHERS IS FOUND BY              */
*              /* SUBTRACTING THE RESIDUAL COUNT IN THE IOB          */
*              /* FROM THE NUMBER OF BYTES REQUESTED IN THE          */
*              /* DCBBLKSI FIELD IN THE DCB.                         */
*              /*                                                    */
*              /******************************************************/
*                                                                  0462
*              IF DARGSENT ^= 0                                    0462
*                THEN                                              0462
@RF00460 L     @01,DDSTRU                                          0462
         CLI   DARGSENT(@01),0                                     0462
         BE    @RF00462                                            0462
*                  GETRC = 4;                                      0463
         MVC   GETRC(2),@CH00037                                   0463
*                ELSE                                              0464
*                  DO;                                             0464
         B     @RC00462                                            0464
@RF00462 DS    0H                                                  0465
*                    IOCRRN = IOCRRN + 1;                          0465
         L     @15,IOCSPTR                                         0465
         LA    @14,1                                               0465
         AL    @14,IOCRRN(,@15)                                    0465
         ST    @14,IOCRRN(,@15)                                    0465
*                    IOCDAD = IOCWKA;                              0466
         L     @01,IOCEXT(,@15)                                    0466
         L     @14,IOCWKA(,@01)                                    0466
         ST    @14,IOCDAD(,@15)                                    0466
*                    IF IOCRFMVR = ON                              0467
*                      THEN                                        0467
         TM    IOCRFMVR(@15),B'01000000'                           0467
         BNO   @RF00467                                            0467
*                        DO;                                       0468
*                          FMADDR = IOCDAD + IOCKYL;               0469
         SLR   @07,@07                                             0469
         IC    @07,IOCKYL(,@15)                                    0469
         ALR   @14,@07                                             0469
         ST    @14,FMADDR                                          0469
*                          LENCHR (1:2) = FMAREA (1:2);            0470
         MVC   LENCHR(2),FMAREA(@14)                               0470
*                          IOCDLN = LENHFIX;                       0471
         LH    @14,LENHFIX                                         0471
         ST    @14,IOCDLN(,@15)                                    0471
*                        END;                                      0472
*                                                                  0472
*                      ELSE                                        0473
*                        DO;                                       0473
*                                                                  0473
         B     @RC00467                                            0473
@RF00467 DS    0H                                                  0474
*                          IF IOCRFMFX = ON & IOCRFMBK = OFF       0474
*                            THEN                                  0474
         L     @15,IOCSPTR                                         0474
         TM    IOCRFMFX(@15),B'10000000'                           0474
         BNO   @RF00474                                            0474
         TM    IOCRFMBK(@15),B'00001000'                           0474
         BNZ   @RF00474                                            0474
*                              IOCDLN = DCBBLKSI;                  0475
*                                                                  0475
         L     @01,DCBPTR                                          0475
         LH    @14,DCBBLKSI+52(,@01)                               0475
         ST    @14,IOCDLN(,@15)                                    0475
*                            ELSE                                  0476
*                              IOCDLN = DCBBLKSI - IOBRESCT;       0476
*                                                                  0476
         B     @RC00474                                            0476
@RF00474 L     @01,DCBPTR                                          0476
         LH    @15,DCBBLKSI+52(,@01)                               0476
         L     @14,DECBIOB                                         0476
         SH    @15,IOBRESCT(,@14)                                  0476
         L     @14,IOCSPTR                                         0476
         ST    @15,IOCDLN(,@14)                                    0476
*                        END;                                      0477
*                                                                  0477
@RC00474 DS    0H                                                  0478
*                    /* ADD KEY LENGTH TO BLOCK LENGTH               */
*                    IOCDLN = IOCDLN + IOCKYL;                     0478
*                                                                  0478
@RC00467 L     @15,IOCSPTR                                         0478
         SLR   @14,@14                                             0478
         IC    @14,IOCKYL(,@15)                                    0478
         AL    @14,IOCDLN(,@15)                                    0478
         ST    @14,IOCDLN(,@15)                                    0478
*                  END;                                            0479
*                                                                  0479
*              RETURN CODE (GETRC);                                0480
*                                                                  0480
@RC00462 LH    @15,GETRC                                           0480
         L     @13,4(,@13)                                         0480
         L     @14,12(,@13)                                        0480
         LM    @00,@12,20(@13)                                     0480
         BR    @14                                                 0480
*            END BSAMGET;                                          0481
*                                                                  0481
*                                                                  0481
*        RESPECIFY (REG7) RSTD;                                    0482
@RF00445 DS    0H                                                  0483
*        RESPECIFY (REG0) RSTD;                                    0483
*        RESPECIFY (REG1) RSTD;                                    0484
*                                                                  0484
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE THE GET MACRO AND THE ADDRESS OF THE DATA          */
*        /* RECORD IS RETURNED IN REGISTER 1.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0485
*                                                                  0485
*        REG7 = DCBPTR;                                            0485
         L     REG7,DCBPTR                                         0485
*LGET2:  GEN(GET   (REG7));                                        0486
LGET2    GET   (REG7)
*        FMADDR = REG1;                                            0487
*                                                                  0487
*                                                                  0487
         ST    REG1,FMADDR                                         0487
*        RESPECIFY (REG0) UNRSTD;                                  0488
*        RESPECIFY (REG1) UNRSTD;                                  0489
*        RESPECIFY (REG7) UNRSTD;                                  0490
*                                                                  0490
*        /************************************************************/
*        /*                                                          */
*        /* IF AN I/O ERROR WAS DETECTED THE  INPUT SYNAD            */
*        /* ROUTINE (IRSISYN) WOULD HAVE PLACED AN MESSAGE ID IN     */
*        /* THE TEXT PROC ARGUMENT LIST.  IF THE SYNAD ROUTINE       */
*        /* RETURNED TO THE ACCESS METHOD  THE RETURN CODE MUST BE   */
*        /* SET HERE.                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0491
*        IF DARGSENT ^= 0                                          0491
*          THEN                                                    0491
         L     @01,DDSTRU                                          0491
         CLI   DARGSENT(@01),0                                     0491
         BE    @RF00491                                            0491
*            GETRC = 4;                                            0492
*                                                                  0492
         MVC   GETRC(2),@CH00037                                   0492
*          ELSE                                                    0493
*            DO;                                                   0493
*                                                                  0493
         B     @RC00491                                            0493
@RF00491 DS    0H                                                  0494
*              IOCDAD = FMADDR;                                    0494
*                                                                  0494
         L     @15,IOCSPTR                                         0494
         L     @14,FMADDR                                          0494
         ST    @14,IOCDAD(,@15)                                    0494
*              /******************************************************/
*              /*                                                    */
*              /* FOR VARIABLE LENGTH RECORDS FIRST BYTE OF DATA     */
*              /* IS AFTER THE RDW.                                  */
*              /*                                                    */
*              /******************************************************/
*                                                                  0495
*              IF IOCRFMVR = ON                                    0495
*                THEN                                              0495
         TM    IOCRFMVR(@15),B'01000000'                           0495
         BNO   @RF00495                                            0495
*                  IOCDAD = IOCDAD + 4;                            0496
*                                                                  0496
         AL    @14,@CF00037                                        0496
         ST    @14,IOCDAD(,@15)                                    0496
*              /******************************************************/
*              /*                                                    */
*              /* IF THE RECORD FORMAT IS VARIABLE THE LENGTH OF     */
*              /* THE RECORD IS FOUND IN THE FIRST TWO BYTES OF      */
*              /* THE LOGICAL RECORD.                                */
*              /*                                                    */
*              /* THE LENGTH OF THE RDW IS SUBTRACTED TO GIVE THE    */
*              /* LENGTH OF DATA ONLY.                               */
*              /*                                                    */
*              /******************************************************/
*                                                                  0497
*              IF IOCRFMVR = ON                                    0497
*                THEN                                              0497
@RF00495 L     @15,IOCSPTR                                         0497
         TM    IOCRFMVR(@15),B'01000000'                           0497
         BNO   @RF00497                                            0497
*                  DO;                                             0498
*                                                                  0498
*                    LENCHR (1:2) = FMAREA (1:2);                  0499
         L     @01,FMADDR                                          0499
         MVC   LENCHR(2),FMAREA(@01)                               0499
*                    LENHFIX = LENHFIX - 4;                        0500
         LH    @14,LENHFIX                                         0500
         SL    @14,@CF00037                                        0500
         STH   @14,LENHFIX                                         0500
*                    IOCDLN = LENHFIX;                             0501
*                                                                  0501
         ST    @14,IOCDLN(,@15)                                    0501
*                  END;                                            0502
*                                                                  0502
*                /****************************************************/
*                /*                                                  */
*                /* RECORD FORMAT IS FIXED OR UNDEFINED. THE LENGTH  */
*                /* OF RECORD READ IS IN THE DCB.                    */
*                /*                                                  */
*                /****************************************************/
*                                                                  0503
*                ELSE                                              0503
*                  IOCDLN = DCBLRECL;                              0503
*                                                                  0503
         B     @RC00497                                            0503
@RF00497 L     @01,DCBPTR                                          0503
         LH    @15,DCBLRECL+72(,@01)                               0503
         L     @14,IOCSPTR                                         0503
         ST    @15,IOCDLN(,@14)                                    0503
*              /******************************************************/
*              /*                                                    */
*              /* SET RECORD NUMBER                                  */
*              /*                                                    */
*              /******************************************************/
*              IOCRRN = IOCRRN + 1;                                0504
*                                                                  0504
@RC00497 L     @15,IOCSPTR                                         0504
         LA    @14,1                                               0504
         AL    @14,IOCRRN(,@15)                                    0504
         ST    @14,IOCRRN(,@15)                                    0504
*            END;                                                  0505
*                                                                  0505
*        /************************************************************/
*        /*                                                          */
*        /* THE GET PROCESSING IS COMPLETE  RETURN TO CALLING PROC   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0506
*        RETURN CODE (GETRC);                                      0506
*                                                                  0506
@RC00491 LH    @15,GETRC                                           0506
         L     @13,4(,@13)                                         0506
         L     @14,12(,@13)                                        0506
         LM    @00,@12,20(@13)                                     0506
         BR    @14                                                 0506
*        /************************************************************/
*        /*                                                          */
*        /* THE FOLLOWING ARE ROUTINES THAT WILL RECEIVE CONTROL     */
*        /* FROM THE ACCESS METHOD AFTER A  GET REQUEST              */
*        /* IF EODAD OR SYNAD IS DETECTED.                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0507
*        /************************************************************/
*        /*                                                          */
*        /* IF EOD IS DETECTED THE RETURN CODE IS SET AND CONTROL    */
*        /* RETURNS TO THE CALLING PROCEDURE.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0507
*IROSEOD:                                                          0507
*                                                                  0507
*                                                                  0507
*        IOCFLGEF = ON;                                            0507
IROSEOD  L     @01,IOCSPTR                                         0507
         L     @01,IOCEXT(,@01)                                    0507
         OI    IOCFLGEF(@01),B'00100000'                           0507
*        RETURN CODE (16);                                         0508
*                                                                  0508
         LA    @15,16                                              0508
         L     @13,4(,@13)                                         0508
         L     @14,12(,@13)                                        0508
         LM    @00,@12,20(@13)                                     0508
         BR    @14                                                 0508
*        /************************************************************/
*        /*                                                          */
*        /* ROUTINE IS ENTERED IF AN I/O ERROR IS DETECTED FOLLOWING */
*        /* THE  GET.                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0509
*IRSISYN:                                                          0509
*        RESPECIFY REG14 RSTD;                                     0509
IRSISYN  DS    0H                                                  0510
*        SAVE14 = REG14;                                           0510
         ST    REG14,SAVE14                                        0510
*        RESPECIFY REG14 UNRSTD;                                   0511
*                                                                  0511
*        RESPECIFY (REG1) RSTD;                                    0512
*                                                                  0512
*        OLDERID2 = NEWERID2;                                      0513
         L     @15,GDTTR2(,GDTREG)                                 0513
         MVC   @TS00001(95),NEWERID2(@15)                          0513
         MVC   OLDERID2(95,@15),@TS00001                           0513
*        NEWID2 = 'IOS2';                                          0514
*                                                                  0514
         MVC   NEWID2(4,@15),@CC01017                              0514
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE THE SYNADAF MACRO AND MOVE THE MESSAGE TO          */
*        /* TWO AREAS WHERE IT WILL BE WRITTEN FROM.                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0515
*          IF IOCMACBK = ON                                        0515
*            THEN                                                  0515
         L     @15,IOCSPTR                                         0515
         TM    IOCMACBK(@15),B'00010000'                           0515
         BNO   @RF00515                                            0515
*LSYNF5:       GEN(SYNADAF  ACSMETH=BSAM);                         0516
LSYNF5   SYNADAF  ACSMETH=BSAM
*            ELSE                                                  0517
*LSYNF1:       GEN(SYNADAF  ACSMETH=QSAM);                         0517
*                                                                  0517
         B     @RC00515                                            0517
@RF00515 DS    0H                                                  0517
LSYNF1   SYNADAF  ACSMETH=QSAM
*        SYNADDR = REG1;                                           0518
@RC00515 ST    REG1,SYNADDR                                        0518
*        SYNPRINT (1:80) = SYNMSG (49:128);                        0519
         L     @15,SYNADDR                                         0519
         MVC   SYNPRINT(80),SYNMSG+48(@15)                         0519
*        DARGDBP = ADDR (SYNPRINT);                                0520
         L     @15,DDSTRU                                          0520
         LA    @00,SYNPRINT                                        0520
         ST    @00,DARGDBP(,@15)                                   0520
*        DARGILP = 80;                                             0521
*                                                                  0521
         MVC   DARGILP(2,@15),@CH00874                             0521
*        /************************************************************/
*        /*                                                          */
*        /* SET ERROR CODE AND SAVE STATIC TEXT ID                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0522
*        GETRC = 4;                                                0522
         MVC   GETRC(2),@CH00037                                   0522
*        DARGSENT = SYNASTID;                                      0523
*                                                                  0523
         MVI   DARGSENT(@15),X'10'                                 0523
*        /************************************************************/
*        /*                                                          */
*        /* IF ANY CONDITIONS ARISE WHERE CONTROL SHOULD RETURN TO   */
*        /* THE ACCESS METHOD (CHECK SHOULD BE MADE HERE)  THE CODE  */
*        /* TO CHECK FOR THE SYNAD HAS ALREADY BEEN PLACED AFTER     */
*        /* THE GET  MACRO.                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0524
*                                                                  0524
*                                                                  0524
*        /************************************************************/
*        /*                                                          */
*        /* RELEASE THE WORKAREA WHERE THE SYNAD MESSAGE WAS         */
*        /* SAVE BY THE ACCESS METHOD.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0524
*LSYNR1: GEN(SYNADRLS);                                            0524
*                                                                  0524
*                                                                  0524
*                                                                  0524
LSYNR1   SYNADRLS
*        IOCMSGOP = OFF;                                           0525
*                                                                  0525
*                                                                  0525
         L     @15,IOCSPTR                                         0525
         NI    IOCMSGOP(@15),B'01111111'                           0525
*        RETURN CODE (4);                                          0526
         LA    @15,4                                               0526
         L     @13,4(,@13)                                         0526
         L     @14,12(,@13)                                        0526
         LM    @00,@12,20(@13)                                     0526
         BR    @14                                                 0526
*        END GETNONVS;                                             0527
*                                                                  0527
*ICKIOPT:  ENTRY (GDTTBLX,PUTIOCS,PUTID);                          0528
*                                                                  0528
         B     @EC00528                                            0528
@EP00528 MVC   @PC00001(4),0(@01)                                  0528
         MVC   @PC00001+32(8),4(@01)                               0528
@EC00528 DS    0H                                                  0529
*        /************************************************************/
*        /*                                                          */
*        /* THIS ENTRY POINT IS CALLED WHEN A DATA RECORD IS TO BE   */
*        /* WRITTEN.  DATA RECORDS CAN BE WRITTEN TO ANY DATA SET    */
*        /* THAT THE I/O ADAPTER  HAS OPENED.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0529
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED BY THIS ENTRY POINT ONLY.                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0529
*        /* ARGUMENTS RECEIVED BY THIS ENTRY POINT                   */
*        DCL PUTIOCS PTR (31);         /* OUTPUT DATA SET IOCS       */
*        DCL PUTID FIXED (15);         /* TYPE IDENTIFIER            */
*                                                                  0530
*        /* FLAGS USED BY THIS ENTRY POINT                           */
*        DCL 1 PFLAGS CHAR (1),                                    0531
*              2 MULTPUT BIT (1),      /* MULTIPLE PUTS              */
*              2 * BIT (7);            /* RESERVED                   */
*                                                                  0531
*        /* RETURN CODE FROM THE PUT OPERATION                       */
*        DCL MPUTRC FIXED (15);                                    0532
*                                                                  0532
*                                                                  0532
*        RESPECIFY (RTNREG) RSTD;                                  0533
*                                                                  0533
*                                                                  0534
*        /************************************************************/
*        /*                                                          */
*        /* ULISTLN MACRO INCLUDED CODE                              */
*        /*                                                          */
*        /*     LISTLN - TO CONTAIN THE NUMBER OF ARGUMENTS PASSED   */
*        /*              TO THIS ROUTINE                             */
*        /*                                                          */
*        /*     LISTPTR - TO CONTAIN THE ADDRESS OF THE CORRESPONDING*/
*        /*               ADDRESS LIST                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0534
*        GEN;                                                      0534
        ST    1,LISTPTR
        ST    1,LISTSCAN
*        DO LISTLN = 1 TO 255 WHILE(LISTTEST = '0'B);              0535
         LA    @14,1                                               0535
         STC   @14,LISTLN                                          0535
@DL00535 L     @07,LISTSCAN                                        0535
         TM    LISTTEST(@07),B'10000000'                           0535
         BNZ   @DC00535                                            0535
*          LISTSCAN = LISTSCAN + 4;                                0536
         AL    @07,@CF00037                                        0536
         ST    @07,LISTSCAN                                        0536
*        END;                                                      0537
*                                                                  0537
         AL    @14,@CF00158                                        0537
         STC   @14,LISTLN                                          0537
         C     @14,@CF00950                                        0537
         BNH   @DL00535                                            0537
@DC00535 DS    0H                                                  0538
*        RESPECIFY (RTNREG) UNRSTD;                                0538
*                                                                  0538
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO THE GDTTBL USING A REGISTER        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0539
*        GDTREG = ADDR (GDTTBLX);                                  0539
*                                                                  0539
         L     GDTREG,@PC00001                                     0539
*        /************************************************************/
*        /*                                                          */
*        /* SET ADDRESSIBILITY TO THE OUTPUT IOCS AND INITIALIZE     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0540
*        IOCSPTR = PUTIOCS;                                        0540
*                                                                  0540
         L     @15,@PC00001+32                                     0540
         L     @00,PUTIOCS(,@15)                                   0540
         ST    @00,IOCSPTR                                         0540
*        OLDERID2 = NEWERID2;                                      0541
         L     @15,GDTTR2(,GDTREG)                                 0541
         MVC   @TS00001(95),NEWERID2(@15)                          0541
         MVC   OLDERID2(95,@15),@TS00001                           0541
*        NEWID2 = 'IOPT';                                          0542
         MVC   NEWID2(4,@15),@CC01039                              0542
*        MPUTRC = 0;                                               0543
*                                                                  0543
         SLR   @00,@00                                             0543
         STH   @00,MPUTRC                                          0543
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE TEXT PROCESSOR ERROR MESSAGE ARG LIST         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0544
*        DMSGARG = ''B;                                            0544
         XC    DMSGARG(44),DMSGARG                                 0544
*        DDSTRU = ADDR (DMSGARG);                                  0545
         LA    @00,DMSGARG                                         0545
         ST    @00,DDSTRU                                          0545
*        DARGSMOD = 'IO0';                                         0546
*                                                                  0546
         LR    @15,@00                                             0546
         MVC   DARGSMOD(3,@15),@CC00988                            0546
*        IF LISTLN < 2 × LISTLN > 3                                0547
*          THEN                                                    0547
*                                                                  0547
         CLI   LISTLN,2                                            0547
         BL    @RT00547                                            0547
         CLI   LISTLN,3                                            0547
         BNH   @RF00547                                            0547
@RT00547 DS    0H                                                  0548
*            /********************************************************/
*            /*                                                      */
*            /* INVALID LENGTH ARGUMENT - TERMINATE PROCESSING.      */
*            /*                                                      */
*            /********************************************************/
*                                                                  0548
*                                                                  0548
*              DO;                                                 0548
*                RESPECIFY(REG13,REG14,REG15) RSTD;                0549
*                REG15 = 40;                                       0550
         LA    REG15,40                                            0550
*                REG14 = GDTABT;                                   0551
         L     REG14,GDTABT(,GDTREG)                               0551
*                REG13 = GDTABH;                                   0552
         L     REG13,GDTABH(,GDTREG)                               0552
*                GEN(BR    REG14);                                 0553
         BR    REG14
*                RESPECIFY(REG13,REG14,REG15)UNRSTD;               0554
*              END;                                                0555
*                                                                  0555
*          ELSE                                                    0556
*                                                                  0556
*            /********************************************************/
*            /*                                                      */
*            /* VALID ARGUMENT LIST RECEIVED.  WRITE THE RECORD.     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0556
*VALPTARG:   DO;                                                   0556
*                                                                  0556
         B     @RC00547                                            0556
@RF00547 DS    0H                                                  0556
VALPTARG DS    0H                                                  0557
*              /******************************************************/
*              /*                                                    */
*              /* IF DATA SET NOT OPEN TERMINATE PROCESSING          */
*              /*                                                    */
*              /******************************************************/
*                                                                  0557
*              IF IOCSPTR = NULLPTR × IOCMSGOP = OFF               0557
*                THEN                                              0557
*                                                                  0557
*                                                                  0557
         L     @15,IOCSPTR                                         0557
         LTR   @15,@15                                             0557
         BZ    @RT00557                                            0557
         TM    IOCMSGOP(@15),B'10000000'                           0557
         BNZ   @RF00557                                            0557
@RT00557 DS    0H                                                  0558
*                    DO;                                           0558
*                      RESPECIFY(REG13,REG14,REG15) RSTD;          0559
*                      REG15 = 32;                                 0560
         LA    REG15,32                                            0560
*                      REG14 = GDTABT;                             0561
         L     REG14,GDTABT(,GDTREG)                               0561
*                      REG13 = GDTABH;                             0562
         L     REG13,GDTABH(,GDTREG)                               0562
*                      GEN(BR    REG14);                           0563
         BR    REG14
*                      RESPECIFY(REG13,REG14,REG15)UNRSTD;         0564
*                    END;                                          0565
*                                                                  0565
*              /******************************************************/
*              /*                                                    */
*              /* IF MULTIPLE PUTS ARE SPECIFIED SET FLAG.  IF       */
*              /* SINGLE RECORD TO PUT SET NUMBER OF PUTS IN IOCSTR  */
*              /* TO 1.                                              */
*              /*                                                    */
*              /******************************************************/
*                                                                  0566
*              MULTPUT = OFF;                                      0566
*                                                                  0566
@RF00557 NI    MULTPUT,B'01111111'                                 0566
*              IF IOCPNM ^= 0                                      0567
*                THEN                                              0567
         L     @15,IOCSPTR                                         0567
         LH    @00,IOCPNM(,@15)                                    0567
         LTR   @00,@00                                             0567
         BZ    @RF00567                                            0567
*                  MULTPUT = ON;                                   0568
         OI    MULTPUT,B'10000000'                                 0568
*                ELSE                                              0569
*                  IOCPNM = 1;                                     0569
*                                                                  0569
         B     @RC00567                                            0569
@RF00567 L     @15,IOCSPTR                                         0569
         MVC   IOCPNM(2,@15),@CH00158                              0569
*              /******************************************************/
*              /*                                                    */
*              /* EXECUTE DO LOOP UNTIL ARE RECORDS SPECIFIED HAVE   */
*              /* BEEN WRITTEN.                                      */
*              /*                                                    */
*              /******************************************************/
*                                                                  0570
*CKMULT:       DO WHILE IOCPNM ^= 0;                               0570
*                                                                  0570
@RC00567 DS    0H                                                  0570
CKMULT   B     @DE00570                                            0570
@DL00570 DS    0H                                                  0571
*              /******************************************************/
*              /*                                                    */
*              /* FOR A MULTIPLE PUT THE LENGTH IS CONTAINED IN THE  */
*              /* FIRST TWO BYTES OF THE DATA RECORD                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  0571
*              IF MULTPUT = ON                                     0571
*                THEN                                              0571
         TM    MULTPUT,B'10000000'                                 0571
         BNO   @RF00571                                            0571
*                  DO;                                             0572
*                    LENCHR (1:2) = DATAIOC (1:2);                 0573
         L     @15,IOCSPTR                                         0573
         L     @14,IOCDAD(,@15)                                    0573
         MVC   LENCHR(2),DATAIOC(@14)                              0573
*                    IOCDLN = LENHFIX;                             0574
         LH    @00,LENHFIX                                         0574
         ST    @00,IOCDLN(,@15)                                    0574
*                    IOCDAD = IOCDAD + 2;                          0575
         AL    @14,@CF00109                                        0575
         ST    @14,IOCDAD(,@15)                                    0575
*                  END;                                            0576
*                                                                  0576
*              IF IOCFLGEX = ON                                    0577
*                THEN                                              0577
*                                                                  0577
@RF00571 L     @15,IOCSPTR                                         0577
         L     @15,IOCEXT(,@15)                                    0577
         TM    IOCFLGEX(@15),B'10000000'                           0577
         BNO   @RF00577                                            0577
*                  /**************************************************/
*                  /*                                                */
*                  /* IF DATA SET IS EXTERNALLY CONTROLLED CALL      */
*                  /* EXTERNAL PUT ROUTINE.                          */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0578
*EXTWRITE:         DO;                                             0578
*                                                                  0578
EXTWRITE DS    0H                                                  0579
*                    /************************************************/
*                    /*                                              */
*                    /* IF THREE ARGUMENTS RECEIVED A TYPE ID WAS    */
*                    /* SPECIFIED.                                   */
*                    /*                                              */
*                    /************************************************/
*                                                                  0579
*                    EXTFLGFD = 0;                                 0579
         SLR   @00,@00                                             0579
         ST    @00,EXTFLGFD                                        0579
*                    EXTTYPE = EXPUTREQ;                           0580
*                                                                  0580
         MVI   EXTTYPE,X'0C'                                       0580
*                    IF LISTLN = 3                                 0581
*                      THEN                                        0581
         CLI   LISTLN,3                                            0581
         BNE   @RF00581                                            0581
*                        EXTPUTID = PUTID;                         0582
         L     @15,@PC00001+36                                     0582
         LH    @00,PUTID(,@15)                                     0582
         STH   @00,EXTPUTID                                        0582
*                      ELSE                                        0583
*                        EXTPUTID = PUTD;                          0583
*                                                                  0583
         B     @RC00581                                            0583
@RF00581 SLR   @00,@00                                             0583
         STH   @00,EXTPUTID                                        0583
*                    /************************************************/
*                    /*                                              */
*                    /* CALL ROUTINE THAT WILL CALL EXTERNAL PUT     */
*                    /* ROUTINE.                                     */
*                    /*                                              */
*                    /************************************************/
*                                                                  0584
*                    CALL PUTEXT (EXTFLGFD);                       0584
*                                                                  0584
@RC00581 LA    @00,EXTFLGFD                                        0584
         ST    @00,@AL00001                                        0584
         LA    @01,@AL00001                                        0584
         BAL   @14,PUTEXT                                          0584
*                    /************************************************/
*                    /*                                              */
*                    /* SAVE THE RETURN CODE FROM EXTERNAL ROUTINE   */
*                    /*                                              */
*                    /************************************************/
*                                                                  0585
*                    RESPECIFY RTNREG RSTD;                        0585
*                    TESTRC = RTNREG;                              0586
         STH   RTNREG,TESTRC                                       0586
*                    RESPECIFY RTNREG UNRSTD;                      0587
*                                                                  0587
*                  END EXTWRITE;                                   0588
*                                                                  0588
*                ELSE                                              0589
*                                                                  0589
*                  /**************************************************/
*                  /*                                                */
*                  /* THE DATA SETS IS NOT EXTERNALLY CONTROLLED     */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0589
*NOEXTPUT:         DO;                                             0589
*                                                                  0589
*                                                                  0589
         B     @RC00577                                            0589
@RF00577 DS    0H                                                  0589
NOEXTPUT DS    0H                                                  0590
*                    /************************************************/
*                    /*                                              */
*                    /*     WRITE THE RECORD AND SAVE THE HIGHEST    */
*                    /*     CODE SET.                                */
*                    /*                                              */
*                    /************************************************/
*                                                                  0590
*                    CALL PUTNONVS;                                0590
*                                                                  0590
*                                                                  0590
         BAL   @14,PUTNONVS                                        0590
*                    RESPECIFY RTNREG RSTD;                        0591
*                    TESTRC = RTNREG;                              0592
         STH   RTNREG,TESTRC                                       0592
*                    RESPECIFY RTNREG UNRSTD;                      0593
*                                                                  0593
*                  END NOEXTPUT;                                   0594
*                                                                  0594
*              IOCPNM = IOCPNM - 1;                                0595
@RC00577 L     @15,IOCSPTR                                         0595
         LH    @00,IOCPNM(,@15)                                    0595
         BCTR  @00,0                                               0595
         STH   @00,IOCPNM(,@15)                                    0595
*              IF IOCPNM > 0                                       0596
*                THEN                                              0596
         LTR   @00,@00                                             0596
         BNP   @RF00596                                            0596
*                  IOCDAD = IOCDAD + IOCDLN;                       0597
*                                                                  0597
         L     @00,IOCDAD(,@15)                                    0597
         AL    @00,IOCDLN(,@15)                                    0597
         ST    @00,IOCDAD(,@15)                                    0597
*              /******************************************************/
*              /*                                                    */
*              /* IF ERROR RETURN CODE SET ERROR CODE FOR THE USER.  */
*              /* IF PUTS MUST STOP TO NUMBER TO PUT TO ZERO.        */
*              /*                                                    */
*              /******************************************************/
*                                                                  0598
*              IF TESTRC ^= 0                                      0598
*                THEN                                              0598
@RF00596 SLR   @15,@15                                             0598
         CH    @15,TESTRC                                          0598
         BE    @RF00598                                            0598
*                  DO;                                             0599
*                    MPUTRC = 4;                                   0600
         MVC   MPUTRC(2),@CH00037                                  0600
*                    IF IOCMSGOP = OFF                             0601
*                      THEN                                        0601
         L     @14,IOCSPTR                                         0601
         TM    IOCMSGOP(@14),B'10000000'                           0601
         BNZ   @RF00601                                            0601
*                        IOCPNM = 0;                               0602
         STH   @15,IOCPNM(,@14)                                    0602
*                  END;                                            0603
*                                                                  0603
@RF00601 DS    0H                                                  0604
*              /******************************************************/
*              /*                                                    */
*              /* PRINT ANY ERROR MESSAGES.                          */
*              /*                                                    */
*              /******************************************************/
*                                                                  0604
*              IF DARGSENT ^= 0                                    0604
*                THEN                                              0604
@RF00598 L     @15,DDSTRU                                          0604
         CLI   DARGSENT(@15),0                                     0604
         BE    @RF00604                                            0604
*                  CALL BLDDMSG;                                   0605
*                                                                  0605
         BAL   @14,BLDDMSG                                         0605
*              END CKMULT;                                         0606
*                                                                  0606
@RF00604 DS    0H                                                  0606
@DE00570 L     @15,IOCSPTR                                         0606
         LH    @00,IOCPNM(,@15)                                    0606
         LTR   @00,@00                                             0606
         BNZ   @DL00570                                            0606
*            END VALPTARG;                                         0607
*                                                                  0607
*        CALL ICKSAEP0(GDTTBL,MODID,MPUTRC);                       0608
@RC00547 ST    GDTREG,@AL00001                                     0608
         LA    @00,MODID                                           0608
         ST    @00,@AL00001+4                                      0608
         LA    @00,MPUTRC                                          0608
         ST    @00,@AL00001+8                                      0608
         MVI   @AL00001+8,X'80'                                    0608
         L     @15,GDTEPL(,GDTREG)                                 0608
         LA    @01,@AL00001                                        0608
         BALR  @14,@15                                             0608
*                                                                  0609
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - PUTEXT                                  */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE IS CALLED WHEN THE OUTPUT DATA */
*        /*            SET IS EXTERNALLY CONTROLLED.  THE DATA       */
*        /*            INFORMATION IS PASSED TO THE PUT ROUTINE      */
*        /*            AND THE RETURN CODE FROM THE ROUTINE IS USED  */
*        /*            TO SET THE ADAPTER RETURN CODE.               */
*        /*                                                          */
*        /* INPUT -    IOCSPTR - EXTERNAL DATA SET INFORMATION AND   */
*        /*                      DATA RECORD INFORMATION.            */
*        /*                                                          */
*        /* OUTPUT -   TESTRC - RETURN CODE SET FOR ADAPTER.         */
*        /*                                                          */
*        /* ERRORS -   IF THE RETURN CODE FROM THE EXTERNAL ROUTINE  */
*        /*            IMPLIES AN ERROR A FAILING RETURN CODE IS SET */
*        /*            BUT NO ERROR MESSAGE IS WRITTEN.              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0609
*PUTEXT: PROC (OTFLGFLD) OPTIONS (SAVEAREA);                       0609
*                                                                  0609
         B     @PB00004                                            0609
PUTEXT   STM   @14,@12,12(@13)                                     0609
         ST    @13,@SA00004+4                                      0609
         LA    @14,@SA00004                                        0609
         ST    @14,8(,@13)                                         0609
         LR    @13,@14                                             0609
         MVC   @PC00004(4),0(@01)                                  0609
*        /************************************************************/
*        /*                                                          */
*        /* DECLARES USED ONLY BY THIS PROCEDURE.                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0610
*        /* EXTERNAL OUTPUT FLAG FIELD                               */
*        DCL OTFLGFLD FIXED (31);                                  0610
*                                                                  0610
*        /* RETURN CODE FROM THIS PROCEDURE                          */
*        DCL EXTPUTRC FIXED (15);                                  0611
*                                                                  0611
*                                                                  0611
*        /************************************************************/
*        /*                                                          */
*        /* CALL EXTERNAL PUT ROUTINE AND SAVE RETURN CODE.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0612
*        OLDERID2 = NEWERID2;                                      0612
         L     @15,GDTTR2(,GDTREG)                                 0612
         MVC   @TS00001(95),NEWERID2(@15)                          0612
         MVC   OLDERID2(95,@15),@TS00001                           0612
*        NEWID2 = 'IOEP';                                          0613
*                                                                  0613
         MVC   NEWID2(4,@15),@CC01056                              0613
*        EXTDAD = IOCDAD;                                          0614
         L     @15,IOCSPTR                                         0614
         L     @00,IOCDAD(,@15)                                    0614
         ST    @00,EXTDAD                                          0614
*        EXTDLN = IOCDLN;                                          0615
*                                                                  0615
         L     @00,IOCDLN(,@15)                                    0615
         ST    @00,EXTDLN                                          0615
*        CALL EXTRTN (IOEXPARM,OTFLGFLD,EXTIOCS);                  0616
         L     @15,IOCEXT(,@15)                                    0616
         L     @14,IOCXPM(,@15)                                    0616
         ST    @14,@AL00001                                        0616
         L     @00,@PC00004                                        0616
         LR    @14,@00                                             0616
         ST    @14,@AL00001+4                                      0616
         LA    @00,EXTIOCS                                         0616
         ST    @00,@AL00001+8                                      0616
         MVI   @AL00001+8,X'80'                                    0616
         L     @15,IOCXAD(,@15)                                    0616
         LA    @01,@AL00001                                        0616
         BALR  @14,@15                                             0616
*        RESPECIFY RTNREG RSTD;                                    0617
*        TESTRC = RTNREG;                                          0618
         STH   RTNREG,TESTRC                                       0618
*        RESPECIFY RTNREG UNRSTD;                                  0619
*                                                                  0619
*                                                                  0619
*        /************************************************************/
*        /*                                                          */
*        /* IF SUCCESSFUL RETURN CODE FROM EXTERNAL ROUTINE SET      */
*        /* SUCCESSFUL ADAPTER RETURN CODE, OTHERWISE SET FAIL RC.   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0620
*        IF TESTRC = EXTOK                                         0620
*          THEN                                                    0620
         LH    @15,TESTRC                                          0620
         SLR   @14,@14                                             0620
         CR    @15,@14                                             0620
         BNE   @RF00620                                            0620
*            DO;                                                   0621
*              IOCRRN = IOCRRN + 1;                                0622
         L     @15,IOCSPTR                                         0622
         LA    @00,1                                               0622
         AL    @00,IOCRRN(,@15)                                    0622
         ST    @00,IOCRRN(,@15)                                    0622
*              EXTPUTRC = 0;                                       0623
         STH   @14,EXTPUTRC                                        0623
*            END;                                                  0624
*          ELSE                                                    0625
*            DO;                                                   0625
         B     @RC00620                                            0625
@RF00620 DS    0H                                                  0626
*              EXTPUTRC = 4;                                       0626
         MVC   EXTPUTRC(2),@CH00037                                0626
*              IF TESTRC = EXTTERM                                 0627
*                THEN                                              0627
         CLC   TESTRC(2),@CH00034                                  0627
         BNE   @RF00627                                            0627
*                  IOCMSGOP = OFF;                                 0628
         L     @15,IOCSPTR                                         0628
         NI    IOCMSGOP(@15),B'01111111'                           0628
*            END;                                                  0629
*                                                                  0629
@RF00627 DS    0H                                                  0630
*        IF GDTDBG = NULLPTR                                       0630
*          THEN;                                                   0630
@RC00620 L     @00,GDTDBG(,GDTREG)                                 0630
         LTR   @00,@00                                             0630
         BZ    @RT00630                                            0630
*          ELSE                                                    0632
*            CALL ICKDB010 (GDTTBL,'IOEP');                        0632
*                                                                  0632
         ST    GDTREG,@AL00001                                     0632
         LA    @00,@CC01056                                        0632
         ST    @00,@AL00001+4                                      0632
         MVI   @AL00001+4,X'80'                                    0632
         L     @15,GDTDBG(,GDTREG)                                 0632
         LA    @01,@AL00001                                        0632
         BALR  @14,@15                                             0632
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLING I/O ADAPTER ROUTINE WIRETURN CODE      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0633
*        RETURN CODE (EXTPUTRC);                                   0633
*                                                                  0633
@RT00630 LH    @15,EXTPUTRC                                        0633
         L     @13,4(,@13)                                         0633
         L     @14,12(,@13)                                        0633
         LM    @00,@12,20(@13)                                     0633
         BR    @14                                                 0633
*        END PUTEXT;                                               0634
*                                                                  0635
*                                                                  0635
*                                                                  0635
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - PUTNONVS                                */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE IS EXECUTED TO PUT A           */
*        /*            LOGICAL RECORD TO A  DATA SET.                */
*        /*                                                          */
*        /* INPUT -    IOCSPTR CONTAINS ADDRESSIBILITY TO THE OUTPUT */
*        /*            IOCS.                                         */
*        /*                                                          */
*        /* OUTPUT -   THE RECORD SPECIFIED BY THE OUTPUT IOCS       */
*        /*            IS PUT TO THE OUTPUT DATA SET.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0635
*PUTNONVS: PROC OPTIONS (SAVEAREA);                                0635
*                                                                  0635
PUTNONVS STM   @14,@12,12(@13)                                     0635
         ST    @13,@SA00005+4                                      0635
         LA    @14,@SA00005                                        0635
         ST    @14,8(,@13)                                         0635
         LR    @13,@14                                             0635
*        /* RETURN CODE FROM THIS PROCEDURE                          */
*        DCL PUTRC FIXED (15);                                     0636
*                                                                  0636
*        /* AREA TO BE SET TO BLANKS IF SYSOUT F BUFFER MOVE         */
*        DCL BLNKBUFF CHAR (120) BASED (TOADDR);                   0637
*                                                                  0637
*        /* USED AS WORKAREA TO SET BUFFER TO BLANKS                 */
*        DCL BLNKAREA CHAR (256);                                  0638
*                                                                  0638
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE RETURN CODE AND SET ADDRESSIBILITY TO THE DCB */
*        /*                                                          */
*        /************************************************************/
*                                                                  0639
*        OLDERID2 = NEWERID2;                                      0639
         L     @15,GDTTR2(,GDTREG)                                 0639
         MVC   @TS00001(95),NEWERID2(@15)                          0639
         MVC   OLDERID2(95,@15),@TS00001                           0639
*        NEWID2 = 'IOOW';                                          0640
         MVC   NEWID2(4,@15),@CC01064                              0640
*        PUTRC = 0;                                                0641
         SLR   @00,@00                                             0641
         STH   @00,PUTRC                                           0641
*        DCBPTR = IOCCBA;                                          0642
*                                                                  0642
*                                                                  0642
         L     @15,IOCSPTR                                         0642
         L     @14,IOCEXT(,@15)                                    0642
         L     @00,IOCCBA(,@14)                                    0642
         ST    @00,DCBPTR                                          0642
*        /************************************************************/
*        /*                                                          */
*        /* IF THE DATA SET IS OPENED FOR BLOCK PROCESSING           */
*        /* THE WRITE MACRO WILL BE ISSUED.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0643
*        IF IOCMACBK = ON                                          0643
*          THEN                                                    0643
         TM    IOCMACBK(@15),B'00010000'                           0643
         BNO   @RF00643                                            0643
*BSAMPUT:    DO;                                                   0644
*                                                                  0644
BSAMPUT  DS    0H                                                  0645
*              /******************************************************/
*              /*                                                    */
*              /* IF BLOCK IS TO LONG, SET ERROR AND RETURN          */
*              /* TO THE CALLER.                                     */
*              /*                                                    */
*              /******************************************************/
*                                                                  0645
*              IF IOCDLN - IOCKYL > IOCTRN                         0645
*                THEN                                              0645
         L     @15,IOCSPTR                                         0645
         L     @00,IOCDLN(,@15)                                    0645
         SLR   @14,@14                                             0645
         IC    @14,IOCKYL(,@15)                                    0645
         SLR   @00,@14                                             0645
         C     @00,IOCTRN(,@15)                                    0645
         BNH   @RF00645                                            0645
*                  DO;                                             0646
*                    DARGSENT = IVLGSTID;                          0647
         L     @14,DDSTRU                                          0647
         MVI   DARGSENT(@14),X'0C'                                 0647
*                    DARGDBP = IOCDAD;                             0648
         L     @00,IOCDAD(,@15)                                    0648
         ST    @00,DARGDBP(,@14)                                   0648
*                    DARGILP = 5;                                  0649
         MVC   DARGILP(2,@14),@CH00247                             0649
*                    RETURN CODE (4);                              0650
         LA    @15,4                                               0650
         L     @13,4(,@13)                                         0650
         L     @14,12(,@13)                                        0650
         LM    @00,@12,20(@13)                                     0650
         BR    @14                                                 0650
*                  END;                                            0651
*                                                                  0651
*              /******************************************************/
*              /*                                                    */
*              /* MOVE THE WRITE PARAMETER LIST TO                   */
*              /* AUTOMATIC STORAGE.                                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  0652
*              IF IOCMACUP = ON                                    0652
*                THEN                                              0652
*                                                                  0652
@RF00645 L     @15,IOCSPTR                                         0652
         TM    IOCMACUP(@15),B'00100000'                           0652
         BNO   @RF00652                                            0652
*                  /**************************************************/
*                  /*                                                */
*                  /* FOR UPDATE PROCESSING, THE DECB WHICH          */
*                  /* WAS USED TO DO THE READ MUST BE USED           */
*                  /* TO DO THE WRITE                                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0653
*                  DECBADDR = IOCDEC;                              0653
*                                                                  0653
         L     @15,IOCEXT(,@15)                                    0653
         L     @00,IOCDEC(,@15)                                    0653
         ST    @00,DECBADDR                                        0653
*                ELSE                                              0654
*                  DO;                                             0654
*                                                                  0654
         B     @RC00652                                            0654
@RF00652 DS    0H                                                  0655
*                  IF IOCRFMUN = ON                                0655
*                    THEN                                          0655
         L     @15,IOCSPTR                                         0655
         TM    IOCRFMUN(@15),B'00100000'                           0655
         BNO   @RF00655                                            0655
*                      DECBADDR = ADDR (WRITEU);                   0656
         LA    @00,WRITEU                                          0656
         ST    @00,DECBADDR                                        0656
*                    ELSE                                          0657
*                      DECBADDR = ADDR (WRITEFV);                  0657
*                                                                  0657
         B     @RC00655                                            0657
@RF00655 LA    @00,WRITEFV                                         0657
         ST    @00,DECBADDR                                        0657
*                  END;                                            0658
*                                                                  0658
@RC00655 DS    0H                                                  0659
*              MACAREA (1:24) = IODECB (1:24);                     0659
*                                                                  0659
@RC00652 L     @15,DECBADDR                                        0659
         MVC   MACAREA(24),IODECB(@15)                             0659
*              /******************************************************/
*              /*                                                    */
*              /* SET LENGTH OF BLOCK IN DCB (EXCLUDING              */
*              /* KEY).                                              */
*              /* SET ADDRESSES OF REQUIRED PARAMETERS IN            */
*              /* REGISTERS AND ISSUE THE WRITE MACRO,               */
*              /* USING THE EXECUTE FORM.                            */
*              /*                                                    */
*              /******************************************************/
*                                                                  0660
*              DCBBLKSI = IOCDLN - IOCKYL;                         0660
*                                                                  0660
         L     @15,DCBPTR                                          0660
         L     @14,IOCSPTR                                         0660
         L     @00,IOCDLN(,@14)                                    0660
         SLR   @07,@07                                             0660
         IC    @07,IOCKYL(,@14)                                    0660
         SLR   @00,@07                                             0660
         STH   @00,DCBBLKSI+52(,@15)                               0660
*              RFY (REG5) RSTD;                                    0661
*              RFY (REG6) RSTD;                                    0662
*              RFY (REG7) RSTD;                                    0663
*                                                                  0663
*              REG7 = DCBPTR;                                      0664
         LR    REG7,@15                                            0664
*              REG6 = IOCDAD;                                      0665
         L     REG6,IOCDAD(,@14)                                   0665
*              REG5 = ADDR (MACAREA);                              0666
*                                                                  0666
         LA    REG5,MACAREA                                        0666
*LWRITE1:      GEN(WRITE (REG5),SF,(REG7),(REG6),MF=E);            0667
LWRITE1  WRITE (REG5),SF,(REG7),(REG6),MF=E
*LCHECK2:      GEN(CHECK (REG5));                                  0668
*                                                                  0668
LCHECK2  CHECK (REG5)
*              RFY (REG5) UNRSTD;                                  0669
*              RFY (REG6) UNRSTD;                                  0670
*              RFY (REG7) UNRSTD;                                  0671
*                                                                  0671
*              /******************************************************/
*              /*                                                    */
*              /* IF AN ERROR WAS DETECTED BY AN EXIT                */
*              /* ROUTINE, MESSAGE DATA WILL BE SET.                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  0672
*              IF DARGSENT ^= 0                                    0672
*                THEN                                              0672
         L     @15,DDSTRU                                          0672
         CLI   DARGSENT(@15),0                                     0672
         BE    @RF00672                                            0672
*                  PUTRC = 4;                                      0673
         MVC   PUTRC(2),@CH00037                                   0673
*                ELSE                                              0674
*                  IOCRRN = IOCRRN + 1;                            0674
*                                                                  0674
         B     @RC00672                                            0674
@RF00672 L     @15,IOCSPTR                                         0674
         LA    @00,1                                               0674
         AL    @00,IOCRRN(,@15)                                    0674
         ST    @00,IOCRRN(,@15)                                    0674
*              RETURN CODE (PUTRC);                                0675
*                                                                  0675
@RC00672 LH    @15,PUTRC                                           0675
         L     @13,4(,@13)                                         0675
         L     @14,12(,@13)                                        0675
         LM    @00,@12,20(@13)                                     0675
         BR    @14                                                 0675
*            END BSAMPUT;                                          0676
*                                                                  0676
*                                                                  0676
*        /************************************************************/
*        /*                                                          */
*        /* RECORD WILL BE WRITTEN USING QSAM LOCATE MODE            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0677
*        IF IOCFLGSP = ON                                          0677
*          THEN                                                    0677
*                                                                  0677
@RF00643 L     @15,IOCSPTR                                         0677
         L     @14,IOCEXT(,@15)                                    0677
         TM    IOCFLGSP(@14),B'00000010'                           0677
         BNO   @RF00677                                            0677
*            /********************************************************/
*            /*                                                      */
*            /* DATA SET IS SYSPRINT.  IF A RECORD IS TO LONG        */
*            /* IT IS TRUNCATED.                                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0678
*            DO;                                                   0678
*              IF IOCDLN > IOCTRN                                  0679
*                THEN                                              0679
         L     @14,IOCTRN(,@15)                                    0679
         C     @14,IOCDLN(,@15)                                    0679
         BNL   @RF00679                                            0679
*                  IOCDLN = IOCTRN;                                0680
         ST    @14,IOCDLN(,@15)                                    0680
*            END;                                                  0681
*                                                                  0681
*          ELSE                                                    0682
*            DO;                                                   0682
*                                                                  0682
         B     @RC00677                                            0682
@RF00677 DS    0H                                                  0683
*              IF IOCDLN > IOCTRN                                  0683
*                THEN                                              0683
*                                                                  0683
         L     @15,IOCSPTR                                         0683
         L     @00,IOCDLN(,@15)                                    0683
         C     @00,IOCTRN(,@15)                                    0683
         BNH   @RF00683                                            0683
*                  /**************************************************/
*                  /*                                                */
*                  /* DATA LENGTH IS GREATER THAN MAXIMUM THE DATA   */
*                  /* SET MAY CONTAIN.  SET APPROPIATE ERROR MESSAGE.*/
*                  /*                                                */
*                  /**************************************************/
*                  DO;                                             0684
*                    DARGSENT = IVLGSTID;                          0685
         L     @14,DDSTRU                                          0685
         MVI   DARGSENT(@14),X'0C'                                 0685
*                    DARGDBP = IOCDAD;                             0686
         L     @00,IOCDAD(,@15)                                    0686
         ST    @00,DARGDBP(,@14)                                   0686
*                    DARGILP = 5;                                  0687
         MVC   DARGILP(2,@14),@CH00247                             0687
*                    RETURN CODE (4);                              0688
         LA    @15,4                                               0688
         L     @13,4(,@13)                                         0688
         L     @14,12(,@13)                                        0688
         LM    @00,@12,20(@13)                                     0688
         BR    @14                                                 0688
*                  END;                                            0689
*                                                                  0689
*              /******************************************************/
*              /*                                                    */
*              /* IF OUTPUT DATA SET HAS FIXED LENGTH RECORDS A      */
*              /* RECORD SHORTHER THAN THE LRECL RESULTS IN AN ERROR */
*              /*                                                    */
*              /******************************************************/
*                                                                  0690
*              IF IOCRFMFX = ON                                    0690
*                THEN                                              0690
@RF00683 L     @15,IOCSPTR                                         0690
         TM    IOCRFMFX(@15),B'10000000'                           0690
         BNO   @RF00690                                            0690
*                  DO;                                             0691
*                    IF IOCDLN < IOCTRN                            0692
*                      THEN                                        0692
         L     @00,IOCDLN(,@15)                                    0692
         C     @00,IOCTRN(,@15)                                    0692
         BNL   @RF00692                                            0692
*                        DO;                                       0693
*                          DARGSENT = IVLGSTID;                    0694
         L     @14,DDSTRU                                          0694
         MVI   DARGSENT(@14),X'0C'                                 0694
*                          DARGDBP = IOCDAD;                       0695
         L     @00,IOCDAD(,@15)                                    0695
         ST    @00,DARGDBP(,@14)                                   0695
*                          DARGILP = 5;                            0696
         MVC   DARGILP(2,@14),@CH00247                             0696
*                          RETURN CODE (4);                        0697
         LA    @15,4                                               0697
         L     @13,4(,@13)                                         0697
         L     @14,12(,@13)                                        0697
         LM    @00,@12,20(@13)                                     0697
         BR    @14                                                 0697
*                        END;                                      0698
*                  END;                                            0699
@RF00692 DS    0H                                                  0700
*            END;                                                  0700
*                                                                  0700
@RF00690 DS    0H                                                  0701
*        /************************************************************/
*        /*                                                          */
*        /* SET LENGTH OF LOGICAL RECORD IN DCB FOR V FORMAT RECORDS */
*        /* OR U FORMAT RECORDS.                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0701
*        IF IOCRFMVR = ON                                          0701
*          THEN                                                    0701
@RC00677 L     @15,IOCSPTR                                         0701
         TM    IOCRFMVR(@15),B'01000000'                           0701
         BNO   @RF00701                                            0701
*            DCBLRECL = IOCDLN + 4;                                0702
*                                                                  0702
         LA    @00,4                                               0702
         AL    @00,IOCDLN(,@15)                                    0702
         L     @15,DCBPTR                                          0702
         STH   @00,DCBLRECL+72(,@15)                               0702
*          ELSE                                                    0703
*            DO;                                                   0703
         B     @RC00701                                            0703
@RF00701 DS    0H                                                  0704
*              IF IOCRFMUN = ON                                    0704
*                THEN                                              0704
         L     @15,IOCSPTR                                         0704
         TM    IOCRFMUN(@15),B'00100000'                           0704
         BNO   @RF00704                                            0704
*                  DCBLRECL = IOCDLN;                              0705
         L     @00,IOCDLN(,@15)                                    0705
         L     @15,DCBPTR                                          0705
         STH   @00,DCBLRECL+72(,@15)                               0705
*            END;                                                  0706
*                                                                  0706
@RF00704 DS    0H                                                  0707
*        /************************************************************/
*        /*                                                          */
*        /* DATA RECORD WILL BE WRITTEN IN THE LOCATE MODE.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0707
*        RESPECIFY (REG1) RSTD;                                    0707
@RC00701 DS    0H                                                  0708
*        RESPECIFY (REG7) RSTD;                                    0708
*        REG7 = IOCCBA;                                            0709
*                                                                  0709
         L     @15,IOCSPTR                                         0709
         L     @15,IOCEXT(,@15)                                    0709
         L     REG7,IOCCBA(,@15)                                   0709
*LPUT2:  GEN(PUT   (REG7));                                        0710
LPUT2    PUT   (REG7)
*        TOADDR = REG1;                                            0711
*                                                                  0711
         ST    REG1,TOADDR                                         0711
*        RESPECIFY (REG1) UNRSTD;                                  0712
*        RESPECIFY (REG7) UNRSTD;                                  0713
*                                                                  0713
*        FMADDR = IOCDAD;                                          0714
*                                                                  0714
         L     @01,IOCSPTR                                         0714
         L     @15,IOCDAD(,@01)                                    0714
         ST    @15,FMADDR                                          0714
*        /************************************************************/
*        /*                                                          */
*        /* IF A MESSAGE ID IS IN THE TEXT PROC ARGUMENT AN I/O      */
*        /* ERROR HAS BEEN DETECTED.  THE OUTPUT SYNAD               */
*        /* ROUTINE (IRSOSYN) WAS CALLED BY THE ACCESS METHOD.       */
*        /* THE SYNAD ROUTINE DETERMINED THAT PROCESSING COULD       */
*        /* CONTINUE WITH THE NEXT PUT AND RETURN CONTROL            */
*        /* TO THE ACCESS METHOD.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0715
*        IF DARGSENT ^= 0                                          0715
*          THEN                                                    0715
         L     @01,DDSTRU                                          0715
         CLI   DARGSENT(@01),0                                     0715
         BE    @RF00715                                            0715
*            PUTRC = 4;                                            0716
*                                                                  0716
         MVC   PUTRC(2),@CH00037                                   0716
*          ELSE                                                    0717
*PUTDLOC:    DO;                                                   0717
*                                                                  0717
         B     @RC00715                                            0717
@RF00715 DS    0H                                                  0717
PUTDLOC  DS    0H                                                  0718
*              IOCRRN = IOCRRN + 1;                                0718
*                                                                  0718
*                                                                  0718
         L     @15,IOCSPTR                                         0718
         LA    @14,1                                               0718
         AL    @14,IOCRRN(,@15)                                    0718
         ST    @14,IOCRRN(,@15)                                    0718
*              /******************************************************/
*              /*                                                    */
*              /* FOR VARIABLE LENGTH RECORDS MOVE RDW TO BUFFER     */
*              /*                                                    */
*              /******************************************************/
*                                                                  0719
*              IF IOCRFMVR = ON                                    0719
*                THEN                                              0719
         TM    IOCRFMVR(@15),B'01000000'                           0719
         BNO   @RF00719                                            0719
*                  DO;                                             0720
*                                                                  0720
*                    LENFFIX = 0;                                  0721
         SLR   @15,@15                                             0721
         ST    @15,LENFFIX                                         0721
*                    LENHFIX = DCBLRECL;                           0722
         L     @01,DCBPTR                                          0722
         LH    @15,DCBLRECL+72(,@01)                               0722
         STH   @15,LENHFIX                                         0722
*                    TOAREA (1:4) = LENCHR (1:4);                  0723
         L     @15,TOADDR                                          0723
         MVC   TOAREA(4,@15),LENCHR                                0723
*                    TOADDR = TOADDR + 4;                          0724
*                                                                  0724
         AL    @15,@CF00037                                        0724
         ST    @15,TOADDR                                          0724
*                  END;                                            0725
*                                                                  0725
*              /******************************************************/
*              /*                                                    */
*              /* MOVE THE RECORD SPECIFIED TO THE OUTPUT BUFFER.    */
*              /* 256 BYTES OF DATA  IS MAXIMUM MOVED AT A TIME      */
*              /* THE LOOP IS EXECUTED UNTIL ALL DATA IS MOVE TO     */
*              /* BUFFER.                                            */
*              /*                                                    */
*              /******************************************************/
*                                                                  0726
*              MOVETOT = IOCDLN;                                   0726
*                                                                  0726
@RF00719 L     @01,IOCSPTR                                         0726
         L     @15,IOCDLN(,@01)                                    0726
         ST    @15,MOVETOT                                         0726
*LOCDMOVE:     DO WHILE MOVETOT > 0;                               0727
*                                                                  0727
LOCDMOVE B     @DE00727                                            0727
@DL00727 DS    0H                                                  0728
*                IF MOVETOT > 256                                  0728
*                  THEN                                            0728
         LA    @15,256                                             0728
         C     @15,MOVETOT                                         0728
         BNL   @RF00728                                            0728
*                    MOVELEN = 256;                                0729
*                                                                  0729
         STH   @15,MOVELEN                                         0729
*                  ELSE                                            0730
*                    MOVELEN = MOVETOT;                            0730
*                                                                  0730
         B     @RC00728                                            0730
@RF00728 L     @15,MOVETOT                                         0730
         STH   @15,MOVELEN                                         0730
*                MOVETOT = MOVETOT - MOVELEN;                      0731
*                                                                  0731
@RC00728 LH    @15,MOVELEN                                         0731
         L     @14,MOVETOT                                         0731
         SLR   @14,@15                                             0731
         ST    @14,MOVETOT                                         0731
*                TOAREA (1:MOVELEN) = FMAREA (1:MOVELEN);          0732
*                                                                  0732
         L     @14,TOADDR                                          0732
         LR    @07,@15                                             0732
         BCTR  @07,0                                               0732
         L     @06,FMADDR                                          0732
         EX    @07,@SM01105                                        0732
*                TOADDR = TOADDR + MOVELEN;                        0733
         ALR   @14,@15                                             0733
         ST    @14,TOADDR                                          0733
*                FMADDR = FMADDR + MOVELEN;                        0734
*                                                                  0734
         ALR   @06,@15                                             0734
         ST    @06,FMADDR                                          0734
*              END LOCDMOVE;                                       0735
*                                                                  0735
@DE00727 L     @15,MOVETOT                                         0735
         LTR   @15,@15                                             0735
         BP    @DL00727                                            0735
*            END PUTDLOC;                                          0736
*                                                                  0736
*                                                                  0736
*        /************************************************************/
*        /*                                                          */
*        /* PUT A  RECORD PROCESSING IS COMPLETE RETURN              */
*        /* TO CALLING PROCEDURE.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0737
*        RETURN CODE (PUTRC);                                      0737
*                                                                  0737
*                                                                  0737
*                                                                  0737
*                                                                  0737
@RC00715 LH    @15,PUTRC                                           0737
         L     @13,4(,@13)                                         0737
         L     @14,12(,@13)                                        0737
         LM    @00,@12,20(@13)                                     0737
         BR    @14                                                 0737
*        /************************************************************/
*        /*                                                          */
*        /* THIS ROUTINE RECEIVES CONTROL FROM THE ACCESS METHOD     */
*        /* IF AN I/O ERROR IS DETECTED ATTEMPTING THE PUT THE       */
*        /*  DATA RECORD.                                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0738
*IRSOSYN:                                                          0738
*        RESPECIFY (REG1) RSTD;                                    0738
*                                                                  0738
IRSOSYN  DS    0H                                                  0739
*        SAVE14 = REG14;                                           0739
*                                                                  0739
         ST    REG14,SAVE14                                        0739
*        OLDERID2 = NEWERID2;                                      0740
         L     @15,GDTTR2(,GDTREG)                                 0740
         MVC   @TS00001(95),NEWERID2(@15)                          0740
         MVC   OLDERID2(95,@15),@TS00001                           0740
*        NEWID2 = 'IOS4';                                          0741
*                                                                  0741
         MVC   NEWID2(4,@15),@CC01078                              0741
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE THE SYNADAF MACRO FOR QSAM OR BSAM                 */
*        /* ACSMETH AND SAVE THE SYNAD MESSAGE.                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0742
*        IF IOCMACBK = ON                                          0742
*              THEN                                                0742
         L     @15,IOCSPTR                                         0742
         TM    IOCMACBK(@15),B'00010000'                           0742
         BNO   @RF00742                                            0742
*LSYNF4:           GEN(SYNADAF ACSMETH=BSAM);                      0743
LSYNF4   SYNADAF ACSMETH=BSAM
*              ELSE                                                0744
*LSYNF3:           GEN(SYNADAF ACSMETH=QSAM);                      0744
*                                                                  0744
         B     @RC00742                                            0744
@RF00742 DS    0H                                                  0744
LSYNF3   SYNADAF ACSMETH=QSAM
*        SYNADDR = REG1;                                           0745
@RC00742 ST    REG1,SYNADDR                                        0745
*        RESPECIFY (REG1) UNRSTD;                                  0746
*        SYNPRINT (1:80) = SYNMSG (49:128);                        0747
         L     @15,SYNADDR                                         0747
         MVC   SYNPRINT(80),SYNMSG+48(@15)                         0747
*        DARGDBP = ADDR (SYNPRINT);                                0748
         L     @15,DDSTRU                                          0748
         LA    @14,SYNPRINT                                        0748
         ST    @14,DARGDBP(,@15)                                   0748
*        DARGILP = 80;                                             0749
*                                                                  0749
         MVC   DARGILP(2,@15),@CH00874                             0749
*LSYNR2: GEN(SYNADRLS);                                            0750
*                                                                  0750
LSYNR2   SYNADRLS
*        /************************************************************/
*        /*                                                          */
*        /* SET ERROR CODE AND SAVE STATIC TEXT ID.                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0751
*        PUTRC = 4;                                                0751
         MVC   PUTRC(2),@CH00037                                   0751
*        DARGSENT = SYNASTID;                                      0752
*                                                                  0752
         L     @01,DDSTRU                                          0752
         MVI   DARGSENT(@01),X'10'                                 0752
*        /************************************************************/
*        /*                                                          */
*        /* IF THE DATA SET IS THE PRINTER (ERROPT=ACCEPT) RETURN    */
*        /* TO ACCESS METHOD TO COMPLETE THE I/O OPERATION.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0753
*        IF DCBERACC = ON                                          0753
*          THEN                                                    0753
         L     @01,DCBPTR                                          0753
         TM    DCBERACC+72(@01),B'10000000'                        0753
         BNO   @RF00753                                            0753
*            DO;                                                   0754
*                                                                  0754
*              REG14 = SAVE14;                                     0755
         L     REG14,SAVE14                                        0755
*              GEN(RETURN);                                        0756
*                                                                  0756
         RETURN
*            END;                                                  0757
*                                                                  0757
*                                                                  0757
*        /************************************************************/
*        /*                                                          */
*        /* NO MORE PUT REQUESTS MAY BE ISSUED AGAINST THIS DATA     */
*        /* SET.  SET THE I/O ERROR FLAG AND RETURN TO CALLING       */
*        /* PROCEDURE.                                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0758
*        IOCMSGOP = OFF;                                           0758
*                                                                  0758
*                                                                  0758
@RF00753 L     @01,IOCSPTR                                         0758
         NI    IOCMSGOP(@01),B'01111111'                           0758
*        RETURN CODE (4);                                          0759
*                                                                  0759
         LA    @15,4                                               0759
         L     @13,4(,@13)                                         0759
         L     @14,12(,@13)                                        0759
         LM    @00,@12,20(@13)                                     0759
         BR    @14                                                 0759
*        END PUTNONVS;                                             0760
*                                                                  0760
*                                                                  0761
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - BLDDMSG                                 */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE IS CALLED WHEN AN ERROR HAS    */
*        /*            BEEN DETECTED WHEN AN I/O OPERATION WAS       */
*        /*            REQUESTED.                                    */
*        /*                                                          */
*        /*            THE TEXT PROCESSOR STRUCTURED ARGUMENT IS     */
*        /*            BUILT FOR ALL MESSAGES PRINTED.               */
*        /*                                                          */
*        /* INPUT -    SAVESTID - STID FOR ERROR MESSAGE TO PRINT    */
*        /*                                                          */
*        /* OUTPUT -   DARGLIST BUILT AND PASSED TO PRINTMSG TO      */
*        /*            HAVE THE ERROR MESSAGE WRITTEN.               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0761
*BLDDMSG:  PROC;                                                   0761
*                                                                  0761
BLDDMSG  STM   @14,@12,@SA00006                                    0761
*        /* DARG LIST USED TO WRITE THE HEADER MESSAGE               */
*        DCL DARGHEAD CHAR (28) BDY(WORD);                         0762
*                                                                  0762
*        /* DSNAME AREA                                              */
*        DCL DSNCMP CHAR(44) BASED (IOCDSN);                       0763
*                                                                  0763
*        /* SPECIAL DSNAME FOR VTOC                                  */
*        GENERATE DATA;                                            0764
*                                                                  0764
*        DCL VTOC CHAR(44) GENERATED; /* SPECIAL VTOC NAME           */
*                                                                  0765
*        /* VTOC DSNAME AREA                                         */
*        DCL DSNVTOC CHAR(44) INIT ('VTOC');                       0766
*                                                                  0766
*        /* VTOC DSNAME AREA ADDRESS                                 */
*        DCL DSNVTOCP PTR(31) INIT (ADDR(DSNVTOC));                0767
*                                                                  0767
*        DDSTRU = ADDR (DARGHEAD);                                 0768
         LA    @15,DARGHEAD                                        0768
         ST    @15,DDSTRU                                          0768
*        DARGHEAD = ''B;                                           0769
*                                                                  0769
         XC    DARGHEAD(28),DARGHEAD                               0769
*        /************************************************************/
*        /*                                                          */
*        /* PRINT ERROR IDENTIFIER MESSAGE AND DATA SET NAME         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0770
*        DARGSMOD = 'IO0';                                         0770
         MVC   DARGSMOD(3,@15),@CC00988                            0770
*        DARGSENT = ACTSTID;                                       0771
         MVI   DARGSENT(@15),X'03'                                 0771
*        IF DSNCMP = VTOC                                          0772
*          THEN                                                    0772
         L     @01,IOCSPTR                                         0772
         L     @01,IOCDSN(,@01)                                    0772
         CLC   DSNCMP(44,@01),VTOC                                 0772
         BNE   @RF00772                                            0772
*             DARGDBP = DSNVTOCP;                                  0773
         L     @14,DSNVTOCP                                        0773
         ST    @14,DARGDBP(,@15)                                   0773
*          ELSE                                                    0774
*             DARGDBP = IOCDSN;                                    0774
         B     @RC00772                                            0774
@RF00772 L     @01,IOCSPTR                                         0774
         L     @15,IOCDSN(,@01)                                    0774
         L     @14,DDSTRU                                          0774
         ST    @15,DARGDBP(,@14)                                   0774
*        DARGILP = 44;                                             0775
*                                                                  0775
@RC00772 L     @01,DDSTRU                                          0775
         MVC   DARGILP(2,@01),@CH00513                             0775
*        CALL PRINTMSG;                                            0776
*                                                                  0776
         BAL   @14,PRINTMSG                                        0776
*        /************************************************************/
*        /*                                                          */
*        /* WRITE THE SECOND ERROR MESSAGE FOR THIS ERROR            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0777
*        DDSTRU = ADDR (DMSGARG);                                  0777
         LA    @15,DMSGARG                                         0777
         ST    @15,DDSTRU                                          0777
*        CALL PRINTMSG;                                            0778
*                                                                  0778
         BAL   @14,PRINTMSG                                        0778
*        DMSGARG = ''B;                                            0779
         XC    DMSGARG(44),DMSGARG                                 0779
*        DARGSMOD = 'IO0';                                         0780
*                                                                  0780
         L     @01,DDSTRU                                          0780
         MVC   DARGSMOD(3,@01),@CC00988                            0780
*        END BLDDMSG;                                              0781
*                                                                  0781
@EL00006 DS    0H                                                  0781
@EF00006 DS    0H                                                  0781
@ER00006 LM    @14,@12,@SA00006                                    0781
         BR    @14                                                 0781
*                                                                  0782
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - PRINTMSG                                */
*        /*                                                          */
*        /* FUNCTION - CALL THE TEXT PROCESSOR TO WRITE MESSAGE      */
*        /*                                                          */
*        /* INPUT -  DDSTRU - ADDRESS OF TEXT PROCESSOR ARGUMENT     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0782
*PRINTMSG: PROC;                                                   0782
*                                                                  0782
PRINTMSG STM   @14,@12,@SA00007                                    0782
*        /************************************************************/
*        /*                                                          */
*        /* THE TEXT PROCESSOR IS CALLED TO PRINT ERROR MESSAGE.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0783
*        CALL ICKTPPR0 (GDTTBL,PRTFILE,DDSTRU);                    0783
*                                                                  0783
         ST    GDTREG,@AL00001                                     0783
         LA    @15,@CF00087                                        0783
         ST    @15,@AL00001+4                                      0783
         LA    @15,DDSTRU                                          0783
         ST    @15,@AL00001+8                                      0783
         MVI   @AL00001+8,X'80'                                    0783
         L     @15,GDTPRT(,GDTREG)                                 0783
         LA    @01,@AL00001                                        0783
         BALR  @14,@15                                             0783
*        END PRINTMSG;                                             0784
*                                                                  0784
@EL00007 DS    0H                                                  0784
@EF00007 DS    0H                                                  0784
@ER00007 LM    @14,@12,@SA00007                                    0784
         BR    @14                                                 0784
@PB00007 DS    0H                                                  0784
*        END ICKIO01                                               0785
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (DMSDF01 )                                        *
*/*%INCLUDE SYSLIB  (DMSDF00 )                                        *
*/*@INCLUDE SYSLIB  (DMSDF02 )                                        *
*/*%INCLUDE SYSLIB  (DMSDF03 )                                        *
*/*%INCLUDE SYSLIB  (IHADCBDF)                                        *
*/*%INCLUDE SYSLIB  (IHADCB  )                                        *
*;                                                                 0785
@DATA    DS    0H
@CH00247 DC    H'5'
@CH00034 DC    H'12'
@CH00262 DC    H'16'
@CH00513 DC    H'44'
@CH00874 DC    H'80'
@SM01105 MVC   TOAREA(0,@14),FMAREA(@06)
         DS    0F
@AL00324 DC    A(INITID)               LIST WITH   2 ARGUMENT(S)
         DC    AL1(X'80')
         DC    AL3(@CC00130)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    10F
@SA00002 DS    18F
@PC00002 DS    1F
@SA00003 DS    18F
@SA00006 DS    15F
@SA00004 DS    18F
@PC00004 DS    1F
@SA00005 DS    18F
@SA00007 DS    15F
@AL00001 DS    5A
ICKIO01  CSECT
         DS    0F
@CF00087 DC    F'0'
@CF00158 DC    F'1'
@CH00158 EQU   @CF00158+2
@CF00109 DC    F'2'
@CF00037 DC    F'4'
@CH00037 EQU   @CF00037+2
@CF00693 DC    F'40'
@CF00950 DC    F'255'
@CF01099 DC    F'-4'
@DATD    DSECT
         DS    0D
LISTPTR  DS    A
LISTSCAN DS    A
IOCSPTR  DS    A
OPNPTR   DS    A
DDSTRU   DS    A
FSADDR   DS    A
DMPINDEX DS    A
LENFFIX  DS    FL4
         ORG   LENFFIX
LENCHR   DS    CL4
         ORG   LENCHR
LENHFIX  DS    FL2
         ORG   LENFFIX+4
SAVE14   DS    A
POOLSIZE DS    F
MOVETOT  DS    F
TOADDR   DS    A
FMADDR   DS    A
DECBADDR DS    A
EXTFLGFD DS    FL4
         ORG   EXTFLGFD
EXTTYPE  DS    FL1
EXTOPT   DS    BL1
         ORG   EXTOPT
EXTOPTIN DS    BL1
EXTOPTOT EQU   EXTOPT+0
EXTOPTDD EQU   EXTOPT+0
EXTOPTDS EQU   EXTOPT+0
@NM00033 EQU   EXTOPT+0
         ORG   EXTFLGFD+2
EXTPUTID DS    FL2
         ORG   EXTFLGFD+4
SYNADDR  DS    A
DCBPTR   DS    A
CLOPTR   DS    A
KEYADDR  DS    A
SETRC    DS    H
TESTRC   DS    H
OCCTR    DS    H
MOVELEN  DS    H
EXTRC    DS    H
GETRC    DS    H
MPUTRC   DS    H
EXTPUTRC DS    H
PUTRC    DS    H
LISTLN   DS    FL1
@TS00001 DS    CL95
         DS    CL2
OCARRAY  DS    CL20
         ORG   OCARRAY
OCATYP   DS    FL1
OCAOPT   DS    BL1
         ORG   OCAOPT
OCAOPTCA DS    BL1
@NM00022 EQU   OCAOPT+0
         ORG   OCARRAY+2
OCANUM   DS    FL1
@NM00023 DS    CL1
OCADDR   DS    4A
         ORG   OCARRAY+20
DMSGARG  DS    CL44
MACAREA  DS    CL24
         ORG   MACAREA
@NM00026 DS    CL16
DECBIOB  DS    AL4
         ORG   MACAREA+24
EXTIOCS  DS    CL8
         ORG   EXTIOCS
EXTDAD   DS    AL4
EXTDLN   DS    FL4
         ORG   EXTIOCS+8
SYNPRINT DS    CL150
PFLAGS   DS    CL1
         ORG   PFLAGS
MULTPUT  DS    BL1
@NM00061 EQU   PFLAGS+0
         ORG   PFLAGS+1
         DS    CL1
DARGHEAD DS    CL28
BLNKAREA DS    CL256
ICKIO01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
DSNVTOCP DC    AL4(DSNVTOC)
@CC00957 DC    C'ICKIO02 '
@CC00138 DC    C'ZERO'
@CC00930 DC    C'IOIT'
@CC00951 DC    C'IOOP'
@CC00963 DC    C'IOTM'
@CC00977 DC    C'IOCL'
@CC00987 DC    C'IOGT'
@CC00998 DC    C'IOEG'
@CC01006 DC    C'IOOG'
@CC01017 DC    C'IOS2'
@CC01039 DC    C'IOPT'
@CC01056 DC    C'IOEP'
@CC01064 DC    C'IOOW'
@CC01078 DC    C'IOS4'
@CC00130 DC    C'ALL'
@CC00988 DC    C'IO0'
         DS    CL2
INITID   DS    CL4
         ORG   INITID
@NM00024 DC    CL2'IO'
@NM00025 DC    H'0'
         ORG   INITID+4
MODID    DC    CL4'IO01'
DSNVTOC  DC    CL44'VTOC'
FIXAREA  DS    CL300
@DATD    DSECT
ICKIO01 CSECT
        ENTRY ICKIOS1
ICKIOS1 DC  A(@SIZDATD)
        READ  READLIST,SF,,,'S',MF=L
        WRITE WRITEFV,SF,,,,MF=L
        WRITE WRITEU,SF,,,'S',MF=L
@DATD    DSECT
ICKIO01   CSECT
VTOC    DC    44X'04'
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
ICKIO01  CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
RTNREG   EQU   @15
REG0     EQU   @00
REG1     EQU   @01
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG13    EQU   @13
REG14    EQU   @14
REG15    EQU   @15
GDTREG   EQU   @09
REG10    EQU   @10
REG11    EQU   @11
REG12    EQU   @12
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG8     EQU   @08
REG9     EQU   @09
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTIOH   EQU   GDTTBL+36
GDTDIN   EQU   GDTTBL+44
GDTDOP   EQU   GDTTBL+48
GDTDBG   EQU   GDTTBL+52
GDTDVO   EQU   GDTTBL+56
GDTPRT   EQU   GDTTBL+60
GDTESS   EQU   GDTTBL+64
GDTESA   EQU   GDTTBL+68
GDTRST   EQU   GDTTBL+72
GDTRES   EQU   GDTTBL+76
GDTCAL   EQU   GDTTBL+80
GDTGSP   EQU   GDTTBL+84
GDTFSP   EQU   GDTTBL+88
GDTGPL   EQU   GDTTBL+92
GDTFPL   EQU   GDTTBL+96
GDTLOD   EQU   GDTTBL+100
GDTDEL   EQU   GDTTBL+104
GDTPRL   EQU   GDTTBL+108
GDTEPL   EQU   GDTTBL+112
GDTTIM   EQU   GDTTBL+116
GDTIIO   EQU   GDTTBL+120
GDTTIO   EQU   GDTTBL+124
GDTOPN   EQU   GDTTBL+136
GDTCLS   EQU   GDTTBL+140
GDTGET   EQU   GDTTBL+144
GDTPUT   EQU   GDTTBL+148
GDTABT   EQU   GDTTBL+152
GDTABH   EQU   GDTTBL+156
GDTSNP   EQU   GDTTBL+160
GDTWTO   EQU   GDTTBL+168
GDTSCR   EQU   GDTTBL+172
GDTVCK   EQU   GDTTBL+176
GDTDVC   EQU   GDTTBL+180
GDTSTE   EQU   GDTTBL+188
ICKSACL0 EQU   0
ICKSAEP0 EQU   0
ICKSAGP0 EQU   0
ICKSAFP0 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
STAEPARM EQU   0
STAEPFX  EQU   STAEPARM
LISTTEST EQU   0
IOCSTR   EQU   0
IOCDAD   EQU   IOCSTR
IOCDLN   EQU   IOCSTR+4
IOCTRN   EQU   IOCSTR+8
IOCKYL   EQU   IOCSTR+12
IOCDSO   EQU   IOCSTR+13
IOCRFM   EQU   IOCSTR+14
IOCRFMFX EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCMAC   EQU   IOCSTR+15
IOCMACUP EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACPA EQU   IOCMAC
IOCMSG   EQU   IOCSTR+16
IOCMSGOP EQU   IOCMSG
IOCDSN   EQU   IOCSTR+20
IOCPNM   EQU   IOCSTR+28
IOCRRN   EQU   IOCSTR+32
IOCEXT   EQU   IOCSTR+36
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNRFM   EQU   OPNAGL+1
OPNTYP   EQU   OPNAGL+2
OPNMOD   EQU   OPNAGL+3
OPNIOC   EQU   OPNAGL+4
UVOLLIST EQU   0
UVOLENT  EQU   UVOLLIST+2
ICKTPPR0 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGSTID EQU   DARGLIST+8
DARGSMOD EQU   DARGSTID
DARGSENT EQU   DARGSTID+3
DARGILP  EQU   DARGLIST+12
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ICKDB010 EQU   0
DMPITM   EQU   0
DMPARY   EQU   0
IODATA   EQU   0
IODIOC   EQU   IODATA
IODMSG   EQU   IODATA+4
IODADD   EQU   IODATA+8
IODXTN   EQU   IODATA+12
IODSID   EQU   IODATA+16
IODEOD   EQU   IODATA+20
IODOSS   EQU   IODATA+24
IODOSO   EQU   IODATA+28
IOCSEX   EQU   0
IOCCBA   EQU   IOCSEX
IOCDEC   EQU   IOCSEX+4
IOCWKA   EQU   IOCSEX+12
IOCXAD   EQU   IOCSEX+16
IOCXPM   EQU   IOCSEX+20
IOCFLG   EQU   IOCSEX+32
IOCFLGEX EQU   IOCFLG
IOCFLGEF EQU   IOCFLG
IOCFLGSP EQU   IOCFLG
IOCDEV   EQU   IOCSEX+33
IOCINF   EQU   IOCSEX+34
ARGADDR  EQU   0
DATAIOC  EQU   0
TOAREA   EQU   0
FMAREA   EQU   0
IODECB   EQU   0
BLKIOB   EQU   0
IOBRESCT EQU   BLKIOB+14
UPDECB   EQU   0
ERRIOB   EQU   0
ERRCSW   EQU   ERRIOB+16
ERRSTAT  EQU   ERRCSW+4
EXTRTN   EQU   0
IOEXPARM EQU   0
SYNMSG   EQU   0
IHADCB   EQU   0
IHADCS00 EQU   0
DCBFDAD  EQU   IHADCS00+5
IHADCS01 EQU   0
DCBDVTBL EQU   IHADCS01
IHADCS02 EQU   0
IHADCS11 EQU   0
DCBRELB  EQU   IHADCS11
DCBREL   EQU   DCBRELB+1
DCBBUFCB EQU   IHADCS11+4
DCBDSORG EQU   IHADCS11+10
DCBDSRG1 EQU   DCBDSORG
DCBDSRG2 EQU   DCBDSORG+1
DCBIOBAD EQU   IHADCS11+12
DCBODEB  EQU   DCBIOBAD
DCBLNP   EQU   DCBODEB
DCBQSLM  EQU   DCBLNP
DCBIOBAA EQU   DCBODEB+1
IHADCS50 EQU   0
DCBSVCXL EQU   IHADCS50
DCBEODAD EQU   IHADCS50+4
DCBBFALN EQU   DCBEODAD
DCBHIARC EQU   DCBBFALN
DCBBFTEK EQU   DCBHIARC
DCBBFT   EQU   DCBBFTEK
DCBEXLST EQU   IHADCS50+8
DCBRECFM EQU   DCBEXLST
DCBRECLA EQU   DCBRECFM
IHADCS24 EQU   0
DCBOFLGS EQU   IHADCS24+8
DCBOFLWR EQU   DCBOFLGS
DCBIFLG  EQU   IHADCS24+9
DCBIBPCT EQU   DCBIFLG
DCBMACR  EQU   IHADCS24+10
DCBMACR1 EQU   DCBMACR
DCBMRFE  EQU   DCBMACR1
DCBMRGET EQU   DCBMRFE
DCBMRAPG EQU   DCBMACR1
DCBMRRD  EQU   DCBMRAPG
DCBMRCI  EQU   DCBMACR1
DCBMRMVG EQU   DCBMRCI
DCBMRLCG EQU   DCBMACR1
DCBMRABC EQU   DCBMACR1
DCBMRPT1 EQU   DCBMRABC
DCBMRSBG EQU   DCBMRPT1
DCBMRCRL EQU   DCBMACR1
DCBMRCHK EQU   DCBMRCRL
DCBMRRDX EQU   DCBMRCHK
DCBMRDMG EQU   DCBMACR1
DCBMACR2 EQU   DCBMACR+1
DCBMRPUT EQU   DCBMACR2
DCBMRWRT EQU   DCBMACR2
DCBMRMVP EQU   DCBMACR2
DCBMR5WD EQU   DCBMACR2
DCBMRLDM EQU   DCBMR5WD
DCBMRLCP EQU   DCBMRLDM
DCBMR4WD EQU   DCBMACR2
DCBMRPT2 EQU   DCBMR4WD
DCBMRTMD EQU   DCBMRPT2
DCBMR3WD EQU   DCBMACR2
DCBMRCTL EQU   DCBMR3WD
DCBMRSTK EQU   DCBMRCTL
DCBMR1WD EQU   DCBMACR2
DCBMRSWA EQU   DCBMR1WD
DCBMRDMD EQU   DCBMRSWA
IHADCS25 EQU   0
DCBMACRF EQU   IHADCS25+2
DCBMACF1 EQU   DCBMACRF
DCBMFFE  EQU   DCBMACF1
DCBMFGET EQU   DCBMFFE
DCBMFAPG EQU   DCBMACF1
DCBMFRD  EQU   DCBMFAPG
DCBMFCI  EQU   DCBMACF1
DCBMFMVG EQU   DCBMFCI
DCBMFLCG EQU   DCBMACF1
DCBMFABC EQU   DCBMACF1
DCBMFPT1 EQU   DCBMFABC
DCBMFSBG EQU   DCBMFPT1
DCBMFCRL EQU   DCBMACF1
DCBMFCHK EQU   DCBMFCRL
DCBMFDMG EQU   DCBMACF1
DCBMACF2 EQU   DCBMACRF+1
DCBMFPUT EQU   DCBMACF2
DCBMFWRT EQU   DCBMACF2
DCBMFMVP EQU   DCBMACF2
DCBMF5WD EQU   DCBMACF2
DCBMFLDM EQU   DCBMF5WD
DCBMFLCP EQU   DCBMFLDM
DCBMF4WD EQU   DCBMACF2
DCBMFPT2 EQU   DCBMF4WD
DCBMFTMD EQU   DCBMFPT2
DCBMF3WD EQU   DCBMACF2
DCBMFCTL EQU   DCBMF3WD
DCBMFSTK EQU   DCBMFCTL
DCBMF1WD EQU   DCBMACF2
DCBMFSWA EQU   DCBMF1WD
DCBMFDMD EQU   DCBMFSWA
DCBDEBAD EQU   IHADCS25+4
DCBIFLGS EQU   DCBDEBAD
DCBIFPCT EQU   DCBIFLGS
IHADCS27 EQU   0
DCBGET   EQU   IHADCS27
DCBPUT   EQU   DCBGET
DCBGETA  EQU   DCBPUT+1
IHADCS36 EQU   0
DCBGERR  EQU   IHADCS36
DCBPERR  EQU   DCBGERR
DCBCHECK EQU   DCBPERR
DCBOPTCD EQU   DCBCHECK
DCBOPTH  EQU   DCBOPTCD
DCBOPTO  EQU   DCBOPTH
DCBOPTZ  EQU   DCBOPTCD
DCBGERRA EQU   DCBCHECK+1
DCBPERRA EQU   DCBGERRA
DCBSYNAD EQU   IHADCS36+4
DCBCIND1 EQU   IHADCS36+8
DCBCIND2 EQU   IHADCS36+9
DCBBLKSI EQU   IHADCS36+10
DCBIOBA  EQU   IHADCS36+16
DCBCICB  EQU   DCBIOBA
IHADCS52 EQU   0
DCBDIRCT EQU   IHADCS52
DCBQSWS  EQU   DCBDIRCT
DCBUSASI EQU   DCBQSWS
DCBQADFS EQU   DCBUSASI
DCBBUFOF EQU   DCBDIRCT+1
IHADCS37 EQU   0
DCBFLAG1 EQU   IHADCS37
IHADCS40 EQU   0
DCBEOBAD EQU   IHADCS40
DCBCCCW  EQU   IHADCS40+4
DCBRECAD EQU   DCBCCCW
DCBRECBT EQU   DCBRECAD
DCBRCREL EQU   DCBRECBT
DCBLRECL EQU   IHADCS40+10
DCBCNTRL EQU   IHADCS40+12
DCBEROPT EQU   DCBCNTRL
DCBERACC EQU   DCBEROPT
RETIOCS  EQU   0
CLOSIOCS EQU   0
DSNCMP   EQU   0
BLNKBUFF EQU   0
DMPTRM   EQU   0
ICKDVCL0 EQU   0
ICKDVIN0 EQU   0
ICKDVON0 EQU   0
ICKDVOP0 EQU   0
ICKIOCL0 EQU   0
ICKIOGT0 EQU   0
ICKIOIT0 EQU   0
ICKIOOP0 EQU   0
ICKIOPT0 EQU   0
ICKIOTM0 EQU   0
ICKSADE0 EQU   0
ICKSAFS0 EQU   0
ICKSAGS0 EQU   0
ICKSALD0 EQU   0
ICKSAPR0 EQU   0
ICKSASC0 EQU   0
ICKSASN0 EQU   0
ICKSAST0 EQU   0
ICKSATI0 EQU   0
ICKSAVC0 EQU   0
ICKSAWO0 EQU   0
ICKTPEA0 EQU   0
ICKTPES0 EQU   0
ICKTPRE0 EQU   0
ICKTPRS0 EQU   0
MOVEKEY  EQU   0
NEWERID1 EQU   5
GDTTBLX  EQU   0
DDLOC    EQU   0
XTNADDR  EQU   0
ARG1     EQU   0
ARG2     EQU   0
ARG3     EQU   0
ARG4     EQU   0
GETIOCS  EQU   0
INFLGFLD EQU   0
PUTIOCS  EQU   0
PUTID    EQU   0
OTFLGFLD EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
DCBEOB   EQU   IHADCS40+20
DCBPRECL EQU   IHADCS40+18
@NM00060 EQU   IHADCS40+16
DCBCNTRA EQU   DCBCNTRL+1
@NM00059 EQU   DCBEROPT
DCBERABE EQU   DCBEROPT
DCBERSKP EQU   DCBEROPT
@NM00058 EQU   IHADCS40+9
@NM00057 EQU   IHADCS40+8
DCBRECA  EQU   DCBRECAD+1
@NM00056 EQU   DCBRECBT
DCBRCFGT EQU   DCBRCREL
DCBRCTRU EQU   DCBRCREL
DCBLCCW  EQU   DCBEOBAD
@NM00055 EQU   DCBFLAG1
DCBSTFLS EQU   DCBFLAG1
DCBSTQCK EQU   DCBFLAG1
DCBDIRCQ EQU   DCBBUFOF
DCBQSTRU EQU   DCBUSASI
@NM00054 EQU   DCBUSASI
DCBQADF3 EQU   DCBQADFS
DCBQADF2 EQU   DCBQADFS
DCBQADF1 EQU   DCBQADFS
DCBBLBP  EQU   DCBUSASI
@NM00053 EQU   DCBUSASI
DCBCICBA EQU   DCBCICB+1
@NM00052 EQU   DCBCICB
DCBOFFSW EQU   IHADCS36+15
DCBOFFSR EQU   IHADCS36+14
DCBWCPL  EQU   IHADCS36+13
DCBWCPO  EQU   IHADCS36+12
DCBCNQSM EQU   DCBCIND2
DCBCNFEO EQU   DCBCIND2
DCBCNCHS EQU   DCBCIND2
DCBCNBFP EQU   DCBCIND2
DCBCNIOE EQU   DCBCIND2
DCBCNCLO EQU   DCBCIND2
DCBCNWRO EQU   DCBCIND2
DCBCNSTO EQU   DCBCIND2
DCBCNEXB EQU   DCBCIND1
@NM00051 EQU   DCBCIND1
DCBCNBRM EQU   DCBCIND1
@NM00050 EQU   DCBCIND1
DCBCNEVA EQU   DCBCIND1
DCBCNEVB EQU   DCBCIND1
DCBCNSRD EQU   DCBCIND1
DCBCNTOV EQU   DCBCIND1
DCBSYNA  EQU   DCBSYNAD+1
DCBIOBL  EQU   DCBSYNAD
DCBCHCKA EQU   DCBPERRA
DCBOPTJ  EQU   DCBOPTCD
DCBOPTT  EQU   DCBOPTCD
DCBSRCHD EQU   DCBOPTZ
DCBOPTQ  EQU   DCBOPTCD
DCBBCKPT EQU   DCBOPTO
DCBOPTC  EQU   DCBOPTCD
DCBOPTU  EQU   DCBOPTCD
DCBOPTW  EQU   DCBOPTCD
DCBPUTA  EQU   DCBGETA
@NM00049 EQU   DCBPUT
DCBDEBA  EQU   DCBDEBAD+1
@NM00048 EQU   DCBIFLGS
DCBIFIOE EQU   DCBIFLGS
DCBCH12  EQU   DCBIFPCT
DCBCH9   EQU   DCBIFPCT
DCBIFEC  EQU   DCBIFLGS
DCBMFSTI EQU   DCBMFDMD
DCBMFAWR EQU   DCBMFSTK
DCBMFUIP EQU   DCBMFTMD
DCBMFIDW EQU   DCBMFLCP
DCBMFWRK EQU   DCBMFMVP
DCBMFRDQ EQU   DCBMFWRT
DCBMFGTQ EQU   DCBMFPUT
DCBMFSTL EQU   DCBMACF2
DCBMFCK  EQU   DCBMFDMG
DCBMFRDX EQU   DCBMFCHK
DCBMFDBF EQU   DCBMFSBG
DCBMFRDI EQU   DCBMFLCG
DCBMFRDK EQU   DCBMFMVG
DCBMFWRQ EQU   DCBMFRD
DCBMFPTQ EQU   DCBMFGET
DCBMFECP EQU   DCBMACF1
DCBTIOT  EQU   IHADCS25
DCBMRSTI EQU   DCBMRDMD
DCBMRAWR EQU   DCBMRSTK
DCBMRUIP EQU   DCBMRTMD
DCBMRIDW EQU   DCBMRLCP
DCBMRWRK EQU   DCBMRMVP
DCBMRRDQ EQU   DCBMRWRT
DCBMRGTQ EQU   DCBMRPUT
DCBMRSTL EQU   DCBMACR2
DCBMRCK  EQU   DCBMRDMG
DCBPGFXA EQU   DCBMRRDX
DCBMRDBF EQU   DCBMRSBG
DCBMRRDI EQU   DCBMRLCG
DCBMRRDK EQU   DCBMRMVG
DCBMRWRQ EQU   DCBMRRD
DCBMRPTQ EQU   DCBMRGET
DCBMRECP EQU   DCBMACR1
@NM00047 EQU   DCBIFLG
DCBIBIOE EQU   DCBIFLG
DCBICH12 EQU   DCBIBPCT
DCBICH9  EQU   DCBIBPCT
DCBIBEC  EQU   DCBIFLG
DCBOFIOF EQU   DCBOFLGS
DCBOFUEX EQU   DCBOFLGS
DCBOFTM  EQU   DCBOFLGS
DCBOFPPC EQU   DCBOFLGS
DCBOFOPN EQU   DCBOFLGS
DCBOFEOV EQU   DCBOFLGS
DCBOFLRB EQU   DCBOFLGS
DCBOFIOD EQU   DCBOFLWR
DCBDDNAM EQU   IHADCS24
DCBEXLSA EQU   DCBEXLST+1
DCBRECKL EQU   DCBRECFM
DCBRECCC EQU   DCBRECFM
DCBRECSB EQU   DCBRECFM
DCBRECBR EQU   DCBRECFM
DCBRECTO EQU   DCBRECLA
DCBRECL  EQU   DCBRECLA
DCBEODA  EQU   DCBEODAD+1
DCBBFA   EQU   DCBBFTEK
DCBH0    EQU   DCBBFTEK
DCBBFTKD EQU   DCBBFTEK
DCBBFTE  EQU   DCBBFT
DCBBFTKR EQU   DCBBFT
DCBBFTS  EQU   DCBBFT
DCBH1    EQU   DCBBFTEK
DCBSVCXA EQU   DCBSVCXL+1
@NM00046 EQU   DCBSVCXL
DCBODEBA EQU   DCBIOBAA
@NM00045 EQU   DCBQSLM
DCBUPDBT EQU   DCBQSLM
DCBUPDCM EQU   DCBQSLM
DCB1DVDS EQU   DCBQSLM
@NM00044 EQU   DCBDSRG2
DCBDSGTR EQU   DCBDSRG2
DCBACBM  EQU   DCBDSRG2
@NM00043 EQU   DCBDSRG2
DCBDSGTQ EQU   DCBDSRG2
DCBDSGTX EQU   DCBDSRG2
DCBDSGGS EQU   DCBDSRG2
DCBDSGU  EQU   DCBDSRG1
DCBDSGPO EQU   DCBDSRG1
@NM00042 EQU   DCBDSRG1
@NM00041 EQU   DCBDSRG1
DCBDSGCX EQU   DCBDSRG1
DCBDSGDA EQU   DCBDSRG1
DCBDSGPS EQU   DCBDSRG1
DCBDSGIS EQU   DCBDSRG1
DCBBUFL  EQU   IHADCS11+8
DCBBUFCA EQU   DCBBUFCB+1
DCBBUFNO EQU   DCBBUFCB
DCBDEVT  EQU   DCBREL
DCBKEYLE EQU   DCBRELB
@NM00040 EQU   IHADCS02+19
DCBDEN   EQU   IHADCS02+18
@NM00039 EQU   IHADCS02+17
DCBTRTCH EQU   IHADCS02+16
DCBBLKCT EQU   IHADCS02+12
@NM00038 EQU   IHADCS02
DCBTRBAL EQU   IHADCS01+6
@NM00037 EQU   IHADCS01+5
@NM00036 EQU   IHADCS01+4
DCBDVTBA EQU   DCBDVTBL+1
@NM00035 EQU   DCBDVTBL
DCBKEYCN EQU   IHADCS00+4
DCBRELAD EQU   IHADCS00
@NM00034 EQU   IHADCB
@NM00032 EQU   ERRCSW+6
@NM00031 EQU   ERRSTAT+1
ERRWLR   EQU   ERRSTAT+1
@NM00030 EQU   ERRSTAT
@NM00029 EQU   ERRCSW
@NM00028 EQU   ERRIOB+8
ERRPRFX  EQU   ERRIOB
@NM00027 EQU   BLKIOB
@NM00021 EQU   IOCSEX+35
IOCINFR1 EQU   IOCINF
IOCINFAC EQU   IOCINF
IOCINFQX EQU   IOCINF
IOCINFND EQU   IOCINF
IOCINFAE EQU   IOCINF
IOCINFPT EQU   IOCINF
@NM00020 EQU   IOCDEV
IOCDEVUR EQU   IOCDEV
IOCDEVMT EQU   IOCDEV
IOCDEVDA EQU   IOCDEV
@NM00019 EQU   IOCFLG
IOCFLGOE EQU   IOCFLG
IOCFLGOP EQU   IOCFLG
IOCFLGIO EQU   IOCFLG
IOCFLGDF EQU   IOCFLG
IOCSID   EQU   IOCSEX+28
IOCNIO   EQU   IOCSEX+24
@NM00018 EQU   IOCSEX+10
IOCCBL   EQU   IOCSEX+8
IODOCS   EQU   IODATA+36
IODICS   EQU   IODATA+32
IODINC   EQU   IODSID+2
IODMID   EQU   IODSID
@NM00017 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00016 EQU   DMPITM+15
DMPITMTP EQU   DMPITM+14
DMPITMLN EQU   DMPITM+12
DMPITMPT EQU   DMPITM+8
DMPITMNM EQU   DMPITM
@NM00015 EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00014 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00013 EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGDTM  EQU   DARGARY+4
DARGPCT  EQU   DARGINL
DARGREP  EQU   DARGINS
@NM00012 EQU   DARGLIST+19
DARGIND  EQU   DARGLIST+18
DARGRETL EQU   DARGLIST+16
DARGCNT  EQU   DARGLIST+14
DARGRETP EQU   DARGLIST+4
UVOLVOL  EQU   UVOLENT+4
UVOLDEV  EQU   UVOLENT
UVOLCNT  EQU   UVOLLIST
OPNRSVD  EQU   OPNAGL+28
OPNVOL   EQU   OPNAGL+24
OPNBLK   EQU   OPNAGL+20
OPNREC   EQU   OPNAGL+16
OPNDSN   EQU   OPNAGL+12
OPNDDN   EQU   OPNAGL+8
@NM00011 EQU   OPNMOD
OPNMODRC EQU   OPNMOD
OPNMODAC EQU   OPNMOD
@NM00010 EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00009 EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNRFMSF EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNRFMFX EQU   OPNRFM
@NM00008 EQU   OPNOPT
OPNOPTJM EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNOPTUP EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNOPTIN EQU   OPNOPT
@NM00007 EQU   IOCSTR+30
IOCCBP   EQU   IOCSTR+24
@NM00006 EQU   IOCSTR+17
@NM00005 EQU   IOCMSG
@NM00004 EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00003 EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
@NM00002 EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
STAEWORK EQU   STAEPARM+32
STARPTR  EQU   STAEPFX+28
STASPTR  EQU   STAEPFX+24
STALEN   EQU   STAEPFX+20
STAID    EQU   STAEPFX+16
STAEPA   EQU   STAEPFX+12
STAGDT   EQU   STAEPFX+8
STABPTR  EQU   STAEPFX+4
STAFPTR  EQU   STAEPFX
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00001 EQU   OLDERID1
GDTCVR   EQU   GDTTBL+184
GDTSPR   EQU   GDTTBL+164
GDTTOH   EQU   GDTTBL+132
GDTRIP   EQU   GDTTBL+128
GDTDVH   EQU   GDTTBL+40
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@PB00003 EQU   @EC00528
@RF00679 EQU   @RC00677
@PB00006 EQU   @PB00007
@PB00002 EQU   @PB00003
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@ENDDATA EQU   *
         END   ICKIO01,(C'PLS1716',0701,78192)

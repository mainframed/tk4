         TITLE 'IGE0019I - FIRST ERP MODULE FOR THE 2955'
         TITLE 'IGE0019I - FIRST ERP MODULE FOR THE 2955'
         LCLA  &T,&SPN                                            0002
.@001    ANOP                                                     0002
IGE0019I CSECT ,                                                  0002
         BC    15,24(0,@F)
         DC    C'IGE0019I 17 APR 74'                             0002
         BALR  @B,0                                               0002
@PSTART  DS    0H                                                 0002
         USING @PSTART+00000,@B                                   0002
*         R3=R1;                         /* PARAMETER LIST            *
         LR    @3,@1                                              0051
*         R9=IOSERP+'28'X;               /* PTR, CCW WORK AREA  Y02008*
         LA    @F,X'28'                                           0052
         A     @F,52(0,@3)                                        0052
         LR    @9,@F                                              0052
*         R12=R9+'60'X;              /* INIT REG FOR REENT DATA Y02008*
         LA    @F,X'60'                                           0053
         AR    @F,@9                                              0053
         LR    @C,@F                                              0053
*         GEN;
         USING @DATD+00000,@C           REENT DATA IN ERPWKAREA Y02008
         XC    @TEMPS(@L),@TEMPS        CLEAR TEMPORARY AREA    Y02008
         DS    0H
*
* /*      SET IOSB EXCEPTION FLAG AND ERROR FLAG                Y02008*
*
*         IOSEX='1'B;                  /*SET IOB EXCEPION FLAG  Y02008*
         OI    0(@3),B'00100100'                                  0055
*         IOSERR='1'B;                 /*SET IOB ERROR FLAG     Y02008*
*
*         /*    INITIALIZE DATA AREAS IN CCW WORK AREA          Y02008*
*
*         DAT1DATA='DF'X;                /* READ-SKIP DATA BUFR Y02008*
         L     @4,52(0,@3)         
         MVI   94(@4),X'DF'                                       0057
*         EOTDATA='1F'X;                 /* END OF XMISSION CHARY02008*
         MVI   92(@4),X'1F'                                       0058
*         NEGDATA='40'X;                 /* NEG RESPONSE DATA   Y02008*
         MVI   93(@4),X'40'                                       0059
*
*         DAT1=ADDR(DAT1DATA);           /* ADDRESS OF RD/SKP   Y02008*
         LA    @F,94(0,@4)                                        0060
         ST    @F,@TEMP4                                          0060
         MVC   88(4,@4),@TEMP4                                    0060
*         EOT=ADDR(EOTDATA);             /* ADDRESS OF EOT CHAR Y02008*
         LA    @F,92(0,@4)                                        0061
         ST    @F,@TEMP4                                          0061
         MVC   80(4,@4),@TEMP4                                    0061
*         NEG=ADDR(NEGDATA);             /* ADDRESS OF NEG CHAR Y02008*
         LA    @F,93(0,@4)                                        0062
         ST    @F,@TEMP4                                          0062
         MVC   84(4,@4),@TEMP4                                    0062
*
*         /* GET REAL ADDRESSES OF DATA AREAS FOR IOS USE       Y02008*
*
*         R2=DAT1;                       /* PUT DATA ADD IN REG Y02008*
         MVC   @TEMP4(4),88(@4)                                   0063
         L     @2,@TEMP4                                          0063
*
*         GEN;
         LRA   2,0(0,2)                 REAL ADDR OF DAT BUFR  Y02008
         BNZ   PERR                     PERM ERR IF XLATE FAIL Y02008
         DS    0H
*         DAT1=R2;                       /* SAVE REAL ADDRESS   Y02008*
         ST    @2,@TEMP4                                          0065
         MVC   88(4,@4),@TEMP4                                    0065
*
*
*         R2=EOT;                        /* PUT DATA ADD IN REG Y02008*
         MVC   @TEMP4(4),80(@4)                                   0066
         L     @2,@TEMP4                                          0066
*
*         GEN;
         LRA   2,0(0,2)                 REAL ADDR OF EOT CHAR  Y02008
         BNZ   PERR                     PERM ERR IF XLATE FAIL Y02008
         DS    0H
*
*         EOT=R2;                        /* SAVE REAL ADDRESS   Y02008*
         ST    @2,@TEMP4                                          0068
         MVC   80(4,@4),@TEMP4                                    0068
*
*         R2=NEG;                        /* PUT DATA ADD IN REG Y02008*
         MVC   @TEMP4(4),84(@4)                                   0069
         L     @2,@TEMP4                                          0069
*
*         GEN;
         LRA   2,0(0,2)                 REAL ADDR OF NEG CHAR  Y02008
         BNZ   PERR                     PERM ERR IF XLATE FAIL Y02008
         DS    0H
*
*        NEG=R2;                        /* SAVE REAL ADDRESS  Y02008*/
         ST    @2,@TEMP4                                          0071
         MVC   84(4,@4),@TEMP4                                    0071
*
*         IF TCBRV='0'B          /* IF IN VIRTUAL STORAGE       Y02008*
*          THEN                  /* MUST USE VIRT ADDRS         Y02008*
         L     @4,CVTADPTR                                        0072
         L     @4,0(0,@4)          CVTADDR                        0072
         MVC   @TEMP4(4),328(@4)                                  0072
         L     @4,@TEMP4           CVT                            0072
         L     @4,28(0,@4)         CVTOLTEP                       0072
         MVC   @TEMP4(4),8(@4)                                    0072
         L     @4,@TEMP4           OLTEPTAB                       0072
         TM    202(@4),B'10000000'                                0072
         BC    05,@9FF                                            0072
*           DO;                  /* TO EXAMINE CCW'S            Y02008*
*
*             R15=CVTPTRV;       /* GET ADDR OF XLATE RTN       Y02008*
         L     @4,CVTADPTR                                        0074
         L     @4,0(0,@4)          CVTADDR                        0074
         MVC   @TEMP4(4),288(@4)                                  0074
         L     @F,@TEMP4                                          0074
*             R1=IOSRST;         /* GET ADDR OF CHAN PROG(REAL) Y02008*
         L     @1,72(0,@3)                                        0075
*             GEN( BALR   R14,R15); /* BRANCH TO XLATE RTN      Y02008*
          BALR   R14,R15
         DS    0H
*             IOSRST=R1;         /* PUT XLATED ADDR IN IOSB     Y02008*
         ST    @1,72(0,@3)                                        0077
*             R1=R3;             /* RESTORE IOSB PTR IN REG 1   Y02008*
         LR    @1,@3                                              0078
*
*           END;
*         RELEASE(R2);
*
*
*         /* SETUP RETRY AND CCW SCAN PTRS BASED ON CSW INFO    Y02008*
*
*         IF IOSCSWCA=0                  /* IF CSW CMND ADDR IS Y02008*
*          THEN                          /* ZERO, MUST CHECK RE-Y02008*
@9FF     CLC   21(3,@3),@D1+1                                     0081
         BC    07,@9FE                                            0081
*               R7=IOSRST;               /* USE RETRY FOR SCAN  Y02008*
         L     @7,72(0,@3)                                        0082
         BC    15,@9FD                                            0083
*
*
*          ELSE                          /* CSW CMND ADDR ^=0   Y02008*
*           R7=IOSCSWCA-8;               /* ADDRESS FAILING CCW Y02008*
@9FE     LH    @7,@D2                                             0083
         MVC   @TEMP3+1(3),21(@3)                                 0083
         A     @7,@TEMP3                                          0083
*
*         R10=R7;                        /* SAVE CCW PTR        Y02008*
@9FD     LR    @A,@7                                              0084
*         /* CHECK STATUS OF EVENTS, INITIAL OR RETRY OF CCWS   Y02008*
*
*         IF IOBENT='0'B THEN            /* IS ENTRY FLAG ON          *
         L     @2,52(0,@3)         
         TM    11(@2),B'10000000'                                 0085
*           GOTO ERR001;                 /* NO, NOT FIRST TIME  Y02008*
         BC    08,ERR001                                          0086
*
*         /* RETRY SITUATION, CHECK RETRY CCW STRING            Y02008*
*
*         IOSMDB=IOSMDB &'00'X;          /* ZERO MODIFIER BYTE  Y02008*
         NI    90(@3),X'00'                                       0087
*         R7=IOSRST;                     /* POINT TO RESTART    Y02008*
         L     @7,72(0,@3)                                        0088
*         IF COCO='02'X
*               & SKIP='1'B THEN         /* READ SKIP                 *
         CLI   0(@7),X'02'                                        0089
         BC    07,@9FC                                            0089
         TM    4(@7),B'00010000'                                  0089
         BC    12,@9FB                                            0089
*               DO;
*               R7=R7+8;
         LA    @7,8(0,@7)                                         0091
*               IOSRST=R7;                /* SET UP  FAIL CCW   Y02008*
         ST    @7,72(0,@3)                                        0092
*               GOTO RETRY1;             /* RETRY               Y02008*
         BC    15,RETRY1                                          0093
*               END;
*
*         R7= R10;                       /* GET CCW ADDR        Y02008*
@9FB     EQU   *                                                  0095
@9FC     LR    @7,@A                                              0095
*         IF IOSRST=R7 THEN              /* RESTART = FAILING   Y02008*
         C     @7,72(0,@3)                                        0096
*           GOTO ERR002;                 /* YES.BRANCH                *
         BC    08,ERR002                                          0097
*         ERRFLGS1='00'X;                /* ZERO FLAGS          Y02008*
         L     @2,52(0,@3)         
         MVI   11(@2),X'00'                                       0098
*
*  ERR001:
*         IOBENT='1'B;                   /* SET ENTRY BIT             *
ERR001   L     @2,52(0,@3)         
         OI    11(@2),B'11000000'                                 0099
*         SRS='1'B;                      /* SET RESTART FLAG          *
*         IOSRST=R7;                     /* RESTART=FAILING CCW Y02008*
         ST    @7,72(0,@3)                                        0101
*  ERR002:
*         R7=IOSVST;                     /* CHAN PROG ADDR      Y02008*
ERR002   L     @7,76(0,@3)                                        0102
*         IF COCO='06'X THEN
         CLI   0(@7),X'06'                                        0103
         BC    07,@9FA                                            0103
*               R='1'B;                  /* READ INITIAL              *
         L     @2,52(0,@3)         
         OI    12(@2),B'10000000'                                 0104
*         IF COCO='01'X THEN
@9FA     CLI   0(@7),X'01'                                        0105
         BC    07,@9F9                                            0105
*               DO;                      /* WRITE COMMAND             *
*               W='1'B;
         L     @2,52(0,@3)         
         OI    12(@2),B'01000000'                                 0107
*
*         IF TCBRV='0'B          /* IF IN VIRTUAL STORAGE       Y02008*
*          THEN                  /* MUST USE VIRT ADDRS         Y02008*
         L     @4,CVTADPTR                                        0108
         L     @4,0(0,@4)          CVTADDR                        0108
         MVC   @TEMP4(4),328(@4)                                  0108
         L     @4,@TEMP4           CVT                            0108
         L     @4,28(0,@4)         CVTOLTEP                       0108
         MVC   @TEMP4(4),8(@4)                                    0108
         L     @4,@TEMP4           OLTEPTAB                       0108
         TM    202(@4),B'10000000'                                0108
         BC    05,@9F8                                            0108
*           DO;                  /* TO EXAMINE CCW'S            Y02008*
*
*         R15=CVTPTRV;                    /* ADDRESS V/R XLATR  Y02008*
         L     @2,CVTADPTR                                        0110
         L     @2,0(0,@2)          CVTADDR                        0110
         MVC   @TEMP4(4),288(@2)                                  0110
         L     @F,@TEMP4                                          0110
*         R1=DAD;                         /* ADDRESS CCW BUFR   Y02008*
         MVC   @TEMP3+1(3),1(@7)                                  0111
         L     @1,@TEMP3                                          0111
*         GEN( BALR  R14,R15);            /* XLATE VIRT TO REAL Y02008*
          BALR  R14,R15
         DS    0H
*         R8=R1;                          /* SAVE XLATED ADDR   Y02008*
         LR    @8,@1                                              0113
*         R1=R3;                          /* RESTORE IOSB PTR   Y02008*
         LR    @1,@3                                              0114
         BC    15,@9F7                                            0116
*
*           END;                          /* END VIRT XLATE RTN Y02008*
*
*         ELSE                            /* TASK IN REAL STOR  Y02008*
*
*          R8=DAD;                        /* DATA BUFFR IN CCW  Y02008*
@9F8     MVC   @TEMP3+1(3),1(@7)                                  0116
         L     @8,@TEMP3                                          0116
*
*               IF DADBUF='76'X          /* POS CHARACTER       Y02008*
*                 & COMCHN='1'B THEN     /* COMMAND CHAINING     M4502*
@9F7     CLI   0(@8),X'76'                                        0117
         BC    07,@9F6                                            0117
         TM    4(@7),B'01000000'                                  0117
         BC    12,@9F5                                            0117
*                 WR='1'B;
         L     @2,52(0,@3)         
         OI    12(@2),B'00100000'                                 0118
*         IF DADBUF='1F'X THEN ERRFLGS2='80'X;/*EOT? YES, R='1' Y02008*
@9F5     EQU   *                                                  0119
@9F6     CLI   0(@8),X'1F'                                        0119
         BC    07,@9F4                                            0119
         L     @2,52(0,@3)         
         MVI   12(@2),X'80'                                       0120
*               END;
@9F4     EQU   *                                                  0121
*
*  ERR003:
*         R7=R10;                       /* RESTORE CCW PTR      Y02008*
@9F9     EQU   *                                                  0122
ERR003   LR    @7,@A                                              0122
*         RELEASE (R8,R10);
*         RESTRICT(R5);
* /*      THIS SECTION IS USED TO TEST FOR INITIAL SELECTION          *
* /*      ERRORS. AN SIO CONDITION CODE OF '01' INDICATES             *
* /*      STATUS STORED. ANY STATUS AND SENSE INFORMATION OTHER       *
* /*      THAN UNIT CHECK (UCK) WITH SENSE INDICATING BUS OUT         *
* /*      CHECK (BOC) OR COMMAND REJECT (CRT) IS TREATED AS A         *
* /*      "SHOULD NOT OCCUR" (SNO) TYPE ERROR CONDITION               *
*                                                                  /* *
*         IF IOSCC ='50'X THEN           /* IS SIO CODE='01'    Y02008*
         CLI   20(@3),X'50'                                       0125
*           GOTO LOADNEXT;               /* YES. LOAD NEXT MODULE     *
         BC    08,LOADNEXT                                        0126
*                                                                  /* *
*         IF IOSCC='70'X THEN            /* DEV CC=3 ON SIO?    Y02008*
         CLI   20(@3),X'70'                                       0127
         BC    07,@9F3                                            0127
*
*          DO;                            /* CC=3 ON SIO, MUST  Y02008*
*           CC3UCB=REIUCB;                /* ADDRESS REI UCB    Y02008*
         L     @2,CVTADPTR                                        0129
         L     @2,0(0,@2)          CVTADDR                        0129
         MVC   @TEMP4(4),328(@2)                                  0129
         L     @2,@TEMP4           CVT                            0129
         L     @2,28(0,@2)         CVTOLTEP                       0129
         MVC   CC3PLIST+1(3),33(@2)                               0129
*           FUNCTCOD='00'X;               /* VERIFY PATH FNCTN  Y02008*
         MVI   CC3PLIST,X'00'                                     0130
*           RESTRICT(R0,R13,R14,R15);     /* REGS FOR US/IOS USEY02008*
*           GEN( LOAD EP=IECVIOPM);       /* LOAD PATH CHK MOD  Y02008*
          LOAD EP=IECVIOPM
         DS    0H
*           R14=R0;                       /* SAVE ENTRY ADDR    Y02008*
         LR    @E,@0                                              0133
*           R13=ADDR(IOSGENTBL);          /* IOS SAVE/WORK AREA Y02008*
         LA    @D,40(0,@2)                                        0134
*           R15=ADDR(ERR004);             /* RET POINT IN CODE  Y02008*
         LA    @F,ERR004                                          0135
*           R1=ADDR(CC3PLIST);            /* ADDRESS PARMLIST   Y02008*
         LA    @1,CC3PLIST                                        0136
*           GEN(BALR R14,R15);            /* GO TO IECVIOPM     Y02008*
         BALR R14,R15
         DS    0H
*
* ERR004:
*           R1=R3;                        /* RESTORE IOSB ADDR  Y02008*
ERR004   LR    @1,@3                                              0138
*           RELEASE (R0,R13,R14);         /* FREE REGS FOR CMPLRY02008*
*           IF R15^=0                     /* IF NO PATHS AVAIL  Y02008*
*            THEN                         /* FOR I/O, THEN PERM Y02008*
         LTR   @F,@F                                              0140
*             GO TO PERR;                 /* ERROR ON REI LINE  Y02008*
         BC    07,PERR                                            0141
*           GO TO RETRY;                  /* RETRY EVENT        Y02008*
         BC    15,RETRY                                           0142
*          END;                           /* END CC=3 CODE.     Y02008*
*
* /*      THIS SECTION CHECKS FOR CHANNEL DATA CHECK (CDC). IF        *
* /*      FOUND RETRYS THE CHANNEL PROGRAM THREE TIMES                *
*                                                                  /* *
*                                                                  /* *
*         IF CDC = '1'B THEN                 /*CHANNEL DATA CHECK ?   *
@9F3     TM    25(@3),B'00001000'                                 0144
*              GO TO ERRORA3X;               /*IF POS THEN BRANCH     *
         BC    01,ERRORA3X                                        0145
* /*      THIS SECTION TESTS FOR UNIT CHECK. IF UNIT CHECK (UCK) IS   *
* /*      INDICATED THEN CHECK FOR EQUIPMENT CHECK (ECK), LOST        *
* /*      DATA (LDA), TIME OUT (TOT), INTERVENTION REQUIRED (IRD),    *
* /*      BUS OUT CHECK (BOC), DATA CHECK (DCK), OVERRUN (OVR),       *
* /*      OR COMMAND REJECT (CRT). IF NONE ARE INDICATED THEN A       *
* /*      "SHOULD NOT OCCUR" (SNO) TYPE OF ERROR EXISTS               *
*                                                                  /* *
*         IF UCK = '0'B THEN                 /*UNIT CHECK ?           *
         TM    24(@3),B'00000010'                                 0146
*           GOTO LOADNEXT;               /* LOAD NEXT MODULE          *
         BC    08,LOADNEXT                                        0147
* /*      THIS SECTION TESTS FOR EQUIPMENT CHECK (ECK) IF UNIT        *
* /*      CHECK (UCK) HAS BEEN INDICATED. DEPENDING UPON THE          *
* /*      CURRENT CCW RECOVERY PROCEDURES ARE DEFINED                 *
*                                                                  /* *
*         IF ECK = '0'B THEN                 /*EQUIPMENT CHECK ?      *
         L     @2,52(0,@3)         
         TM    32(@2),B'00010000'                                 0148
*              GO TO LOSTDATA;               /*IF NEGATIVE BRANCH     *
         BC    08,LOSTDATA                                        0149
*                                            /*    TO LOSTDATA        *
*         IF COCO='27'X                  /* IF ENABLE COMMAND         *
*               × COCO='2F'X THEN        /* OR DISABLE COMMAND        *
         CLI   0(@7),X'27'                                        0150
         BC    08,@9F2                                            0150
         CLI   0(@7),X'2F'                                        0150
         BC    07,@9F1                                            0150
*               GOTO ERRORA3X;           /* RETRY 3 TIMES             *
         BC    08,ERRORA3X                                        0151
*                                                                  /* *
*         GO TO ERRORSNO;                    /*SHOULD NOT OCCUR       *
         BC    15,ERRORSNO                                        0152
* /*      THIS SECTION TESTS FOR LOST DATA CHECK (LDA) IF UNIT        *
* /*      CHECK (UCK) HAS BEEN INDICATED. DEPENDING UPON THE          *
* /*      CURRENT CCW AND COMMAND CHAINING RECOVERY PROCEDURES        *
* /*      ARE DEFINED                                                 *
*                                                                  /* *
* LOSTDATA:
*                                                                  /* *
*         IF LDA = '0'B THEN                 /*LOST DATA ?            *
LOSTDATA L     @2,52(0,@3)         
         TM    32(@2),B'00000010'                                 0153
*              GO TO TIMEOUT;                /*IF NEGATIVE BRANCH     *
         BC    08,TIMEOUT                                         0154
*                                            /*    TO TIME OUT        *
*         IF COCO ^= '02'X THEN          /* IF NOT A READ             *
         CLI   0(@7),X'02'                                        0155
*               GOTO ERRORSNO;           /* SHOULD NOT OCCUR          *
         BC    07,ERRORSNO                                        0156
*                                                                  /* *
* NEXTEST0:
*                                                                  /* *
*         IF IOSCSWRC ^= '0000'X THEN  /* RESIDUAL COUNT = 0 ?  Y02008*
NEXTEST0 CLC   26(2,@3),@X18                                      0157
*              GO TO NEXTEST1;               /*IF NEGATIVE BRANCH     *
         BC    07,NEXTEST1                                        0158
*                                            /*    TO NEXT TEST       *
*         IF R='1'B THEN                 /* READ SEQUENCE             *
         L     @2,52(0,@3)         
         TM    12(@2),B'10000000'                                 0159
*               GOTO ERRORSRR;
         BC    01,ERRORSRR                                        0160
*
*         IF W='1'B THEN                 /* WRITE SEQUENCE            *
         TM    12(@2),B'01000000'                                 0161
*               GOTO ERRORIWC;
         BC    01,ERRORIWC                                        0162
*
*         GOTO ERRORSNO;
         BC    15,ERRORSNO                                        0163
*                                                                  /* *
* NEXTEST1:
*         IF IOSCOD='48'THEN                /*HALT I/O ISSUED ? Y02008*
NEXTEST1 CLC   13(1,@3),@C19                                      0164
*              GO TO ERRORRFW;               /*IF POSITIVE BRANCH     *
         BC    08,ERRORRFW                                        0165
*                                            /*    TO RECOVERY        *
*         GOTO ERRORSNO;
         BC    15,ERRORSNO                                        0166
* /*      THIS SECTION TESTS FOR TIME OUT (TOT) IF UNIT CHECK         *
* /*      (UCK) HAS BEEN INDICATED. DEPENDING UPON THE CURRENT        *
* /*      CCW AND COMMAND CHAINING RECOVERY PROCEDURES ARE DEFINED    *
*                                                                  /* *
* TIMEOUT:
*                                                                  /* *
*         IF TOT = '0'B THEN                 /*TIME OUT ?             *
TIMEOUT  L     @2,52(0,@3)         
         TM    32(@2),B'00000001'                                 0167
*              GO TO INTEREQD;               /*IF NEGATIVE BRANCH TO  *
         BC    08,INTEREQD                                        0168
*                                            /*    INTERVENTION REQ'D *
*         IF COCO ^= '02'X THEN          /* IF NOT A READ COMMAND     *
         CLI   0(@7),X'02'                                        0169
*               DO;
*               GOTO ERRORA3X;
         BC    07,ERRORA3X                                        0171
*               END;
* TEXTRANS:
*                                                                  /* *
*         IF COU = IOSCSWRC THEN         /* CCW RESIDUAL CT=0 ? Y02008*
@9F0     EQU   *                                                  0173
TEXTRANS CLC   6(2,@7),26(@3)                                     0173
         BC    07,@9EF                                            0173
*         DO;
*         IOSRST=IOSVST;            /* RESTART CCWS AT 1ST CCW Y02008*/
         MVC   72(4,@3),76(@3)                                    0175
*              GO TO ERRORA3X;               /*IF POSITIVE BRANCH     *
         BC    15,ERRORA3X                                        0176
*                                            /*    TO RECOVERY        *
*         END;
*
*         IF W='1'B THEN                 /* WRITE SEQUENCE            *
@9EF     L     @2,52(0,@3)         
         TM    12(@2),B'01000000'                                 0178
*               GOTO ERRORSNO;           /* SHOULD NOT ICCUR          *
         BC    01,ERRORSNO                                        0179
*
*         GO TO ERRORIRR;                    /*BRANCH TO RECOVERY     *
         BC    15,ERRORIRR                                        0180
* /*      THIS SECTION TESTS FOR INTERVENTION REQUIRED (IRD) IF       *
* /*      UNIT CHECK (UCK) HAS BEEN INDICATED. RECOVERY PROCEDURES    *
* /*      ARE DEFINED                                                 *
*                                                                  /* *
* INTEREQD:
*         IF IRD = '1'B THEN                 /*INTERVENTION REQUIRED ?*
INTEREQD L     @2,52(0,@3)         
         TM    32(@2),B'01000000'                                 0181
*              GO TO ERRORECR;               /*IF POSITIVE BRANCH     *
         BC    01,ERRORECR                                        0182
*                                            /*    TO RECOVERY        *
* /*      THIS SECTION TESTS FOR BUS OUT CHECK (BOC) IF UNIT CHECK    *
* /*      (UCK) HAS BEEN INDICATED. DEPENDING UPON THE NEXT CCW       *
* /*      TO BE EXECUTED THE RECOVERY PROCEDURES ARE DEFINED          *
*                                                                  /* *
*         IF BOC = '0'B THEN                 /*BUS OUT CHECK ?        *
         TM    32(@2),B'00100000'                                 0183
*           GOTO LOADNEXT;               /* LOAD NEXT MODULE          *
         BC    08,LOADNEXT                                        0184
*  SRCHRD:
*         IF COMCHN='0'B THEN
SRCHRD   TM    4(@7),B'01000000'                                  0185
*         GOTO RETRY;
         BC    08,RETRY                                           0186
*         IF COCO='02'X THEN
         CLI   0(@7),X'02'                                        0187
*         GOTO RETRY;
         BC    08,RETRY                                           0188
*         R7=R7+8;
         LA    @7,8(0,@7)                                         0189
*         IOSRST=R7;                                    /*     Y02008*/
         ST    @7,72(0,@3)                                        0190
*         GOTO SRCHRD;
         BC    15,SRCHRD                                          0191
*
*  LOADNEXT:
*
* /*      THIS SECTION IS USED TO TEST FOR INITIAL SELECTION          *
* /*      ERRORS. AN SIO CONDITION CODE OF '01' INDICATES             *
* /*      STATUS STORED. ANY STATUS AND SENSE INFORMATION OTHER       *
* /*      THAN UNIT CHECK (UCK) WITH SENSE INDICATING BUS OUT         *
* /*      CHECK (BOC) OR COMMAND REJECT (CRT) IS TREATED AS A         *
* /*      "SHOULD NOT OCCUR" (SNO) TYPE ERROR CONDITION               *
*                                                                  /* *
*         IF IOSCC^='50'X THEN           /* DOES SIO CODE='01'  Y02008*
LOADNEXT CLI   20(@3),X'50'                                       0192
*           GOTO ERP2001;                /* NO. BRANCH TO NEXT SECTION*
         BC    07,ERP2001                                         0193
*                                                                  /* *
*         IF UCK = '0'B THEN                 /*UNIT CHECK ?           *
         TM    24(@3),B'00000010'                                 0194
*              GO TO ERRORSNO;               /*IF NEG THEN BRANCH     *
         BC    08,ERRORSNO                                        0195
*                                                                  /* *
*         IF BOC = '1'B THEN                 /*BUS OUT CHECK ?        *
         L     @2,52(0,@3)         
         TM    32(@2),B'00100000'                                 0196
*              GO TO ERRORA2X;               /*IF POS THEN BRANCH     *
         BC    01,ERRORA2X                                        0197
*                                                                  /* *
*         IF CRT = '1'B THEN                 /*COMMAND REJECT ?       *
         TM    32(@2),B'10000000'                                 0198
*              GO TO ERRORA3X;               /*IF POS THEN BRANCH     *
         BC    01,ERRORA3X                                        0199
*                                                                  /* *
*         GO TO ERRORSNO;                    /*SHOULD NOT OCCUR       *
         BC    15,ERRORSNO                                        0200
*  ERP2001:
*         IF UCK='0'B THEN
ERP2001  TM    24(@3),B'00000010'                                 0201
*           GOTO SECTION4;
         BC    08,SECTION4                                        0202
*
* /*      THIS SECTION TESTS FOR DATA CHECK (DCK) IF UNIT CHECK       *
* /*      (UCK) HAS BEEN INDICATED. DEPENDING UPON THE PRESENT        *
* /*      CCW BEING EXECUTED AND THE CHAINED COMMAND IF ANY           *
*                                                                  /* *
* DATCHECK:
*                                                                  /* *
*         IF DCK = '0'B THEN                 /*DATA CHECK ?           *
DATCHECK L     @2,52(0,@3)         
         TM    32(@2),B'00001000'                                 0203
*              GO TO OVERRUN;                /*IF NEGATIVE BRANCH     *
         BC    08,OVERRUN                                         0204
*                                            /*    TO OVER RUN        *
*         IF COCO = '02'X THEN GOTO TESTNEX2; /* READ COMMAND         *
         CLI   0(@7),X'02'                                        0205
         BC    08,TESTNEX2                                        0206
*         IF COCO='01'X THEN
         CLI   0(@7),X'01'                                        0207
         BC    07,@9EE                                            0207
*         DO;
*
*         IF WR='1'B THEN                /* WRITE EOT,READ RESP       *
         TM    12(@2),B'00100000'                                 0209
*               GOTO ERRORIWC;
         BC    01,ERRORIWC                                        0210
*
*         GOTO ERRORRFW;
         BC    15,ERRORRFW                                        0211
*         END;
*
*         GO TO ERRORSNO;                    /*BRANCH TO RECOVERY     *
*                                                                  /* *
*                                                                  /* *
* TESTNEX2:
*                                                                  /* *
*         IF R='1'B THEN                 /* READ SEQUENCE             *
TESTNEX2 L     @2,52(0,@3)         
         TM    12(@2),B'10000000'                                 0214
*               GOTO ERRORIRR;
         BC    01,ERRORIRR                                        0215
*
*         IF WR='1'B THEN                /* WRITE EOT,READ RESP       *
         TM    12(@2),B'00100000'                                 0216
*           GOTO ERRORIWC;
         BC    01,ERRORIWC                                        0217
*
*         GOTO ERRORRFW;
         BC    15,ERRORRFW                                        0218
* /*      THIS SECTION TESTS FOR OVER RUN (OVR) IF UNIT CHECK         *
* /*      (UCK) HAS BEEN INDICATED. DEPENDING UPON CURRENT CCW        *
* /*      RECOVERY PROCEDURES ARE DEFINED                             *
*                                                                  /* *
* OVERRUN:
*                                                                  /* *
*         IF OVR = '0'B THEN             /* OVER RUN ?                *
OVERRUN  L     @2,52(0,@3)         
         TM    32(@2),B'00000100'                                 0219
*              GO TO COMANREJ;               /*IF NEGATIVE BRANCH     *
         BC    08,COMANREJ                                        0220
*                                            /*    TO COMMAND REJECT  *
*         IF COCO ='CA'X                 /* INHIBIT COMMAND           *
*               × COCO='02'X THEN        /* READ COMMAND              *
         CLI   0(@7),X'CA'                                        0221
         BC    08,@9ED                                            0221
         CLI   0(@7),X'02'                                        0221
         BC    07,@9EC                                            0221
*               GOTO ERRORIRR;
         BC    08,ERRORIRR                                        0222
*                                                                  /* *
*         GO TO ERRORSNO;                    /*SHOULD NOT OCCUR       *
         BC    15,ERRORSNO                                        0223
* /*      THIS SECTION TESTS FOR COMMAND REJECT (CRT) IF UNIT         *
* /*      CHECK (UCK) HAS BEEN INDICATED. ERROR RECOVERY              *
* /*      PROCEDURES ARE DEFINED                                      *
*                                                                  /* *
* COMANREJ:
*                                                                  /* *
*         IF CRT = '1'B THEN                 /*COMMAND REJECT         *
COMANREJ L     @2,52(0,@3)         
         TM    32(@2),B'10000000'                                 0224
*               GOTO ERRORA2X;
         BC    01,ERRORA2X                                        0225
* /*      THIS SECTION TEST FOR THE CHANNEL STATUS ERRORS PROGRAM     *
* /*      CHECK, PROTECTION CHECK, OR CHAINING CHECK. ERROR           *
* /*      RECOVERY PROCEDURES ARE DEFINED                             *
*                                                                  /* *
*  SECTION4:
*         IF PCK = '1'B                      /*PROGRAM CHECK ?        *
*             × PRK = '1'B                   /*PROTECTION CHECK ?     *
*                × CHC = '1'B THEN           /*CHAINING CHECK ?       *
SECTION4 TM    25(@3),B'00100000'                                 0226
         BC    01,@9EB                                            0226
         TM    25(@3),B'00010000'                                 0226
         BC    01,@9EA                                            0226
         TM    25(@3),B'00000001'                                 0226
         BC    12,@9E9                                            0226
*                    GO TO ERRORA3X;         /*IF POSITIVE BRANCH     *
         BC    03,ERRORA3X                                        0227
*                                            /*    TO RECOVERY        *
* /*      THIS SECTION TESTS FOR THE CHANNEL STATUS ERROR UNIT        *
* /*      EXCEPTION (UEX). DEPENDING UPON THE PRESENT CCW AND         *
* /*      PRESENT COMMAND CHAIN, IF ANY, RECOVERY PROCEDURES ARE      *
* /*      DEFINED                                                     *
*                                                                  /* *
*         IF UEX = '0'B THEN                 /*UNIT EXCEPTION ?       *
@9E9     TM    24(@3),B'00000001'                                 0228
*               GOTO CKPREP;             /* CHECK IF PREPARE COMMAND  *
         BC    08,CKPREP                                          0229
*
*         IF COCO='02'X THEN             /* READ COMMAND              *
         CLI   0(@7),X'02'                                        0230
*               GOTO CHECKER0;
         BC    08,CHECKER0                                        0231
*
*         IF COCO='01'X THEN             /* WRITE COMMAND             *
         CLI   0(@7),X'01'                                        0232
*               GOTO ERRORRFW;
         BC    08,ERRORRFW                                        0233
*                                                                  /* *
*         GO TO NOERITOK;                    /*NO ERROR CONDITION  -  *
         BC    15,NOERITOK                                        0234
*                                            /*    RETURN             *
* CHECKER0:
*                                                                  /* *
*         IF R='1'B THEN                 /* READ SEQUENCE             *
CHECKER0 L     @2,52(0,@3)         
         TM    12(@2),B'10000000'                                 0235
*               GOTO ERRORIWC;                                /*Y02008*
         BC    01,ERRORIWC                                        0236
*
*         IF W='1'B THEN                 /* WRITE SEQUENCE            *
         TM    12(@2),B'01000000'                                 0237
         BC    12,@9E8                                            0237
*           DO;
*           IF WR='1'B THEN              /* WRITE EOT, READ RESP M4502*
         TM    12(@2),B'00100000'                                 0239
*               GOTO NOERITOK;           /* NO ERROR CONDITION   M4502*
         BC    01,NOERITOK                                        0240
*
*           IOSRST=IOSVST;               /* RESTART = START ADDR Y02008
         MVC   72(4,@3),76(@3)                                    0241
*           GOTO RETRY1;
         BC    15,RETRY1                                          0242
*
*           END;
*
*         GO TO NOERITOK;                    /*NO ERROR CONDITION  -  *
*                                            /*    RETURN             *
*  CKPREP:
*         IF COCO='06'X THEN             /* PREPARE COMMAND           *
CKPREP   CLI   0(@7),X'06'                                        0245
*               GOTO ERRORRFW;
         BC    08,ERRORRFW                                        0246
* /*      THIS SECTION TESTS FOR INCORRECT LENGTH (ILH) BUT           *
* /*      THIS CONDITION IS NOT TREATED AS AN ERROR CONDITION         *
* INCORLGH:
*         IF ILH = '1'B THEN                 /*INCORRECT LENGTH ?     *
INCORLGH TM    25(@3),B'01000000'                                 0247
*              GO TO NOERITOK;               /*NO ERROR CONDITION  -  *
         BC    01,NOERITOK                                        0248
*                                            /*    RETURN             *
* /*      THIS SECTION TESTS FOR BUSY (BUS), ATTENTION (ATT),         *
* /*      CONTROL UNIT END (CUE), STATUS MODIFIER (STM) AND           *
* /*      BRANCHES TO RECOVERY FOR THREE RETRYS                       *
*                                                                  /* *
*         IF BUS = '1'B THEN                 /*BUSY ?                 *
         TM    24(@3),B'00010000'                                 0249
*              GO TO ERRORA3X;               /*IF POSITIVE BRANCH     *
         BC    01,ERRORA3X                                        0250
*                                            /*    TO RECOVERY        *
*         IF ATT = '1'B THEN                 /*ATTENTION ?            *
         TM    24(@3),B'10000000'                                 0251
*              GO TO ERRORA3X;               /*IF POSITIVE BRANCH     *
         BC    01,ERRORA3X                                        0252
*                                            /*    TO RECOVERY        *
*         IF CUE = '1'B THEN                 /*CONTROL UNIT END ?     *
         TM    24(@3),B'00100000'                                 0253
*              GO TO ERRORA3X;               /*IF POSITIVE BRANCH     *
         BC    01,ERRORA3X                                        0254
*                                            /*    TO RECOVERY        *
*         IF STM = '1'B THEN                 /*STATUS MODIFIER ?      *
         TM    24(@3),B'01000000'                                 0255
*              GO TO ERRORA3X;               /*IF POSITIVE BRANCH     *
         BC    01,ERRORA3X                                        0256
*                                            /*    TO RECOVERY        *
*
*
*         GOTO NOERITOK;                 /*                      M4502*
         BC    15,NOERITOK                                        0257
*
*         RESTRICT (R4);
*
*  ERRORA2X:
*
*         IF FECT ='03'X THEN            /* IS THIS A PERMANENT ERROR *
ERRORA2X L     @2,52(0,@3)         
         CLI   10(@2),X'03'                                       0259
*            GOTO PERR;
         BC    08,PERR                                            0260
*
*         ELSE GOTO RETRY;               /* RETRY CHAN PROGRAM        *
         BC    15,RETRY                                           0261
*
*
*  ERRORA3X:
*
*         IF FECT ='04'X THEN            /* IS THIS A PERM ERROR ?    *
ERRORA3X L     @2,52(0,@3)         
         CLI   10(@2),X'04'                                       0262
*            GOTO PERR;                  /* GO SET UP FOR RETURN      *
         BC    08,PERR                                            0263
*
*         ELSE
*            GOTO RETRY;                 /* RETRY CHAN PROGRAM        *
         BC    15,RETRY                                           0264
*
*
*  ERRORRFW:
*
*         CCWA(1:8)=CCWRDSKP(1:8);      /* MOVE IN READ SKIP CCW      *
ERRORRFW MVC   0(8,@9),CCWRDSKP                                   0265
*         CCWADAT=DAT1;
         L     @2,52(0,@3)         
         MVC   1(3,@9),89(@2)                                     0266
*         CCWB(1:8)=CCWWREOT(1:8);      /* MOVE IN WRITE EOT          *
         MVC   8(8,@9),CCWWREOT                                   0267
*         CCWBDAT=EOT;
         MVC   9(3,@9),81(@2)                                     0268
*         CCWC(1:8)=CCWRDEOT(1:8);      /* MOVE IN READ EOT           *
         MVC   16(8,@9),CCWRDEOT                                  0269
*         CCWCDAT=DAT1;
         MVC   17(3,@9),89(@2)                                    0270
*         DISP=25;                      /* POINT TO NEXT AVAILABLE SP *
         LA    @4,25                                              0271
*         GOTO MOVECHN;                  /* MOVE IN CHAIN & RETRY     *
         BC    15,MOVECHN                                         0272
*
*
*  ERRORSRR:
*         CCWA(1:8)=CCWRDSKP(1:8);       /* MOVE IN READ SKIP         *
ERRORSRR MVC   0(8,@9),CCWRDSKP                                   0273
*         CCWADAT=DAT1;
         L     @2,52(0,@3)         
         MVC   1(3,@9),89(@2)                                     0274
*         CCWB(1:8)=CCWWRNEG(1:8);      /* MOVE IN WRITE NEGATIVE     *
         MVC   8(8,@9),CCWWRNEG                                   0275
*         CCWBDAT=NEG;
         MVC   9(3,@9),85(@2)                                     0276
*         R5=IOSVST;                    /* USER CHANNEL PROGRAM  Y0200*
         L     @5,76(0,@3)                                        0277
*
*    SRR1:IF OP1 = '02'X THEN DO;       /* SEARCH CHAIN FOR A READ CCW*
SRR1     CLI   0(@5),X'02'                                        0278
         BC    07,@9E7                                            0278
*         CCWC(1:8)=CCWCHAIN(1:8);      /* THEN MOVE IT IN            *
         MVC   16(8,@9),0(@5)                                     0280
*         IOSRST=R9;                    /* RESTART CHAN PROG    Y02008*
         ST    @9,72(0,@3)                                        0281
*         GOTO RETRY;                   /* RETRY                      *
         BC    15,RETRY                                           0282
*         END;
*
*         R5=R5+8;
@9E7     AH    @5,@D3                                             0284
*
*         GOTO  SRR1;                   /* LOOP                       *
         BC    15,SRR1                                            0285
*
*
*  ERRORIWC:
*         IOSRST=IOSVST;               /* RETRY ADDR=START ADDR Y02008*
ERRORIWC MVC   72(4,@3),76(@3)                                    0286
*         GOTO RETRY;                   /* RETRY IT                   *
         BC    15,RETRY                                           0287
*
*
*  ERRORIRR:
*         CCWA(1:8)=CCWWRNEG(1:8);      /* MOVE WRITE NEGATIVE IN WORK*
ERRORIRR MVC   0(8,@9),CCWWRNEG                                   0288
*         CCWADAT=NEG;
         L     @2,52(0,@3)         
         MVC   1(3,@9),85(@2)                                     0289
*         R5=IOSVST;                 /* POINT TO USERS CCW CHAIN Y02008
         L     @5,76(0,@3)                                        0290
*
*    IRR1:IF OP1 = '02'X THEN DO;       /* SEARCH FOR A READ CCW      *
IRR1     CLI   0(@5),X'02'                                        0291
         BC    07,@9E6                                            0291
*         CCWB(1:8)=CCWCHAIN(1:8);      /* WHEN FOUND MOVE IN WORK AR *
         MVC   8(8,@9),0(@5)                                      0293
*         IOSRST=R9;                                          /*Y02008*
         ST    @9,72(0,@3)                                        0294
*         GOTO RETRY;                   /* RETRY IT                   *
         BC    15,RETRY                                           0295
*         END;
*
*           ELSE;
@9E6     EQU   *                                                  0297
*         R5=R5+8;
@9E5     AH    @5,@D3                                             0298
*         GOTO IRR1;                    /* LOOP                       *
         BC    15,IRR1                                            0299
*
*
*  ERRORECR:
*         CCWA(1:8)=CCWENABL(1:8);      /* MOVE ENABLE CCW IN WORKAREA*
ERRORECR MVC   0(8,@9),CCWENABL                                   0300
*         DISP=9;                       /* POINT TO NEXT SPACE IN WORK*
         LA    @4,9                                               0301
*         GOTO  MOVECHN;                /* GO MOVE IN USERS CCW CHAIN *
         BC    15,MOVECHN                                         0302
*
*
* ERRORSNO:
*         IF FECT ='04'X THEN            /* IS THIS A PERM ERROR ?    *
ERRORSNO L     @2,52(0,@3)         
         CLI   10(@2),X'04'                                       0303
*            GOTO PERR;                  /* GO SET UP FOR ERR RETURN  *
         BC    08,PERR                                            0304
*         ELSE GOTO RETRY;               /* SET UP FOR CHAN PROG RETRY*
         BC    15,RETRY                                           0305
*
*  NOERITOK:
*
*         R2=IOSRST;
NOERITOK L     @2,72(0,@3)                                        0306
*         GEN;
         LRA   2,0(0,2)
         BNZ   PERR
         DS    0H
*         IOSRST=R2;
         ST    @2,72(0,@3)                                        0308
*
*         SENSE='0000'X;                 /* ZERO SENSE IN ERPWK Y02008*
         L     @2,52(0,@3)         
         MVC   32(2,@2),@X18                                      0309
*         ERRFLGS2='00'X;                /* SERO FLAGS IN ERPWK Y02008*
         MVI   12(@2),X'00'                                       0310
*         SRS='0'B;
         NI    11(@2),B'00111111'                                 0311
*         IOBENT='0'B;
*         FECT='00'X;
         MVI   10(@2),X'00'                                       0313
*         IOSERR ='0'B;                  /* SET IOBERR TO ZERO Y02008*/
         NI    0(@3),B'11011011'                                  0314
*         IOSEX='0'B;                 /* SET IOBEX BIT TO ZERO Y02008*/
*         IOSTATUS='0C00'X;          /* SET CSWFLAGS TO NORMAL Y02008*/
         MVC   24(2,@3),@X23                                      0316
*         GEN(SVC 15);
         SVC 15
         DS    0H
*         GEN(SVC 3);                    /* RETURN TO IOS             *
         SVC 3
         DS    0H
*
*  /*THIS PROCEDURE MOVES CCWS FROM USERS "HAIN TO ERP WORK AREA      *
*
*  MOVECHN:
*         R5=IOSVST;                    /* USERS CCW START ADDR Y02008*
MOVECHN  L     @5,76(0,@3)                                        0319
*    NEXT:CCWWORK(DISP:DISP+7)=CCWCHAIN(1:8); /* MOVE IN CCW          *
NEXT     LR    @2,@4                                              0320
         LA    @A,0(@2,@9)                                        0320
         BCTR  @A,0                                               0320
         MVC   0(8,@A),0(@5)                                      0320
*
*         IF CHN1 = '1'B THEN DO;             /* IS IT CHAINED? IF YES*
         TM    4(@5),B'01000000'                                  0321
         BC    12,@9E4                                            0321
*         R5=R5+8;                            /* SET UP TO MOVE IN    *
         AH    @5,@D3                                             0323
*         DISP=DISP+8;                        /* NEXT CCW             *
         AH    @4,@D3                                             0324
*         GOTO NEXT;                          /* GO DO IT             *
         BC    15,NEXT                                            0325
*         END;
*
*         IOSRST=R9;                  /* IOSRST ADDR = NEW CCWS Y02008*
@9E4     ST    @9,72(0,@3)                                        0327
*
*
*  RETRY:
*         IF FECT='04'X THEN
RETRY    L     @2,52(0,@3)         
         CLI   10(@2),X'04'                                       0328
*           GOTO PERR;
         BC    08,PERR                                            0329
*
*         FECT=FECT+1;                   /* UPDATE IOB ERROR COUNT    *
         LA    @F,1                                               0330
         SR    @0,@0                                              0330
         IC    @0,10(0,@2)                                        0330
         AR    @F,@0                                              0330
         STC   @F,10(0,@2)                                        0330
*
*  RETRY1:
*         RESTRICT(R2);
*
*         R2=IOSRST;                     /* PUT REAL ADD IN REG Y02008*
RETRY1   L     @2,72(0,@3)                                        0332
*
*         GEN;
         LRA   2,0(0,2)                 GET REAL ADR OF VIRT CP Y02008
         BNZ   PERR                     PERM ERR IF XLATE FAIL Y02008
         DS    0H
*
*         IOSRST=R2;                     /* PUT REAL AD IN IOSB Y02008*
         ST    @2,72(0,@3)                                        0334
*
*
*         ERRFLGS2='00'X;                /* ZERO INTERNAL FLAGS Y02008*
         L     @8,52(0,@3)         
         MVI   12(@8),X'00'                                       0335
*         GEN(SVC 15);
         SVC 15
         DS    0H
*         GEN(SVC 3);                    /* RETURN TO IOS             *
         SVC 3
         DS    0H
*
*
*  PERR:
*
*         R2=IOSRST;
PERR     L     @2,72(0,@3)                                        0338
*         GEN;
         LRA   2,0(0,2)
         BNZ   PERR
         DS    0H
*         IOSRST=R2;
         ST    @2,72(0,@3)                                        0340
*
*
*         IOSERR='0'B;                   /* ZERO IOBERR BIT     Y02008*
         NI    0(@3),B'11011111'                                  0341
*         ERRFLGS2='00'X;                /* ZERO INTERNAL FLAGS Y02008*
         L     @8,52(0,@3)         
         MVI   12(@8),X'00'                                       0342
*         GEN(SVC 15);
         SVC 15
         DS    0H
*         GEN(SVC 3);                    /* RETURN TO IOS             *
         SVC 3
         DS    0H
*
*         RETURN;
*  END;
@EL01    BCR   15,@E                                              0346
@DATA1   EQU   *
@0       EQU   00                  EQUATES FOR REGISTERS 0-15
@1       EQU   01
@2       EQU   02
@3       EQU   03
@4       EQU   04
@5       EQU   05
@6       EQU   06
@7       EQU   07
@8       EQU   08
@9       EQU   09
@A       EQU   10
@B       EQU   11
@C       EQU   12
@D       EQU   13
@E       EQU   14
@F       EQU   15
@D1      DC    F'0'
@D2      DC    H'-8'
@D3      DC    H'8'
         DS    0F
@SIZ001  DC    AL1(&SPN)
         DC    AL3(@DATEND-@DATD)
         DS    0F
@X18     DC    X'0000'
@C19     DC    C'48'
@X23     DC    X'0C00'
         DS    0D
@DATA    EQU   *
P        EQU   00000000            FULLWORD INTEGER
R0       EQU   00000000            FULLWORD POINTER REGISTER
R1       EQU   00000001            FULLWORD POINTER REGISTER
R2       EQU   00000002            FULLWORD POINTER REGISTER
R3       EQU   00000003            FULLWORD POINTER REGISTER
R4       EQU   00000004            FULLWORD INTEGER REGISTER
R5       EQU   00000005            FULLWORD POINTER REGISTER
R6       EQU   00000006            FULLWORD POINTER REGISTER
R7       EQU   00000007            3  BYTE  POINTER REGISTER
R8       EQU   00000008            FULLWORD POINTER REGISTER
R9       EQU   00000009            3  BYTE  POINTER REGISTER
R10      EQU   00000010            FULLWORD INTEGER REGISTER
R11      EQU   00000011            FULLWORD INTEGER REGISTER
R12      EQU   00000012            FULLWORD INTEGER REGISTER
R13      EQU   00000013            FULLWORD INTEGER REGISTER
R14      EQU   00000014            FULLWORD INTEGER REGISTER
R15      EQU   00000015            FULLWORD INTEGER REGISTER
DISP     EQU   00000004            FULLWORD INTEGER REGISTER
IOSBPTR  EQU   00000003            FULLWORD POINTER REGISTER
IOSBCB   EQU   00000000            91 BYTE(S) ON WORD
IOSFLA   EQU   IOSBCB+00000000     1 BYTE(S)
A00000   EQU   IOSBCB+00000000     2 BIT(S)
IOSERR   EQU   IOSBCB+00000000     1 BIT(S)
A00001   EQU   IOSBCB+00000000     2 BIT(S)
IOSEX    EQU   IOSBCB+00000000     1 BIT(S)
A00002   EQU   IOSBCB+00000001     12 BYTE(S)
IOSCOD   EQU   IOSBCB+00000013     1 BYTE(S)
A00003   EQU   IOSBCB+00000014     6 BYTE(S)
IOSCC    EQU   IOSBCB+00000020     1 BYTE(S)
IOSCSWCA EQU   IOSBCB+00000021     3 BYTE(S)
IOSTATUS EQU   IOSBCB+00000024     2 BYTE(S)
IOSTSA   EQU   IOSBCB+00000024     1 BYTE(S)
ATT      EQU   IOSBCB+00000024     1 BIT(S)
STM      EQU   IOSBCB+00000024     1 BIT(S)
CUE      EQU   IOSBCB+00000024     1 BIT(S)
BUS      EQU   IOSBCB+00000024     1 BIT(S)
CED      EQU   IOSBCB+00000024     1 BIT(S)
DED      EQU   IOSBCB+00000024     1 BIT(S)
UCK      EQU   IOSBCB+00000024     1 BIT(S)
UEX      EQU   IOSBCB+00000024     1 BIT(S)
IOSTSB   EQU   IOSBCB+00000025     1 BYTE(S)
PCI      EQU   IOSBCB+00000025     1 BIT(S)
ILH      EQU   IOSBCB+00000025     1 BIT(S)
PCK      EQU   IOSBCB+00000025     1 BIT(S)
PRK      EQU   IOSBCB+00000025     1 BIT(S)
CDC      EQU   IOSBCB+00000025     1 BIT(S)
CCC      EQU   IOSBCB+00000025     1 BIT(S)
ICC      EQU   IOSBCB+00000025     1 BIT(S)
CHC      EQU   IOSBCB+00000025     1 BIT(S)
IOSCSWRC EQU   IOSBCB+00000026     2 BYTE(S)
A00004   EQU   IOSBCB+00000028     24 BYTE(S)
IOSERP   EQU   IOSBCB+00000052     FULLWORD POINTER
A00005   EQU   IOSBCB+00000056     16 BYTE(S)
IOSRST   EQU   IOSBCB+00000072     FULLWORD POINTER
IOSVST   EQU   IOSBCB+00000076     FULLWORD POINTER
A00006   EQU   IOSBCB+00000080     10 BYTE(S)
IOSMDB   EQU   IOSBCB+00000090     1 BYTE(S)
ERRFLGS1 EQU   00000011            1 BYTE(S)
IOBENT   EQU   ERRFLGS1+00000000   1 BIT(S)
SRS      EQU   ERRFLGS1+00000000   1 BIT(S)
ERRFLGS2 EQU   00000012            1 BYTE(S)
R        EQU   ERRFLGS2+00000000   1 BIT(S)
W        EQU   ERRFLGS2+00000000   1 BIT(S)
WR       EQU   ERRFLGS2+00000000   1 BIT(S)
SENSE    EQU   00000032            2 BYTE(S)
CRT      EQU   SENSE+00000000      1 BIT(S)
IRD      EQU   SENSE+00000000      1 BIT(S)
BOC      EQU   SENSE+00000000      1 BIT(S)
ECK      EQU   SENSE+00000000      1 BIT(S)
DCK      EQU   SENSE+00000000      1 BIT(S)
OVR      EQU   SENSE+00000000      1 BIT(S)
LDA      EQU   SENSE+00000000      1 BIT(S)
TOT      EQU   SENSE+00000000      1 BIT(S)
A00007   EQU   SENSE+00000001      8 BIT(S)
FECT     EQU   00000010            1 BYTE(S)
LINEDATA EQU   00000080            15 BYTE(S)
EOT      EQU   LINEDATA+00000000   4  BYTE  POINTER
NEG      EQU   LINEDATA+00000004   4  BYTE  POINTER
DAT1     EQU   LINEDATA+00000008   4  BYTE  POINTER
EOTDATA  EQU   LINEDATA+00000012   1 BYTE(S)
NEGDATA  EQU   LINEDATA+00000013   1 BYTE(S)
DAT1DATA EQU   LINEDATA+00000014   1 BYTE(S)
CVTADPTR EQU   *                   FULLWORD POINTER
         DC    AL4(16)
CVTADDR  EQU   00000000            FULLWORD POINTER
CVT      EQU   00000000            1 BYTE(S)
A00008   EQU   CVT+00000000        288 BYTE(S)
CVTPTRV  EQU   CVT+00000288        4  BYTE  POINTER
A00009   EQU   CVT+00000292        36 BYTE(S)
CVTEXT2  EQU   CVT+00000328        4  BYTE  POINTER
CVTOLTEP EQU   00000028            FULLWORD POINTER
OLTEPTAB EQU   00000000            24 BYTE(S)
DIEHEAD  EQU   OLTEPTAB+00000000   4 BYTE(S)
REIDEBAD EQU   OLTEPTAB+00000004   4  BYTE  POINTER
OLTEPTCB EQU   OLTEPTAB+00000008   4  BYTE  POINTER
A00010   EQU   OLTEPTAB+00000012   20 BYTE(S)
REIUCB   EQU   OLTEPTAB+00000032   4  BYTE  POINTER
A00011   EQU   OLTEPTAB+00000036   4 BYTE(S)
IOSGENTB EQU   OLTEPTAB+00000040   18*4  BYTE  INTEGER
OURTCB   EQU   00000000            206 BYTE(S)
A00012   EQU   OURTCB+00000000     202 BYTE(S)
TCBFLGS6 EQU   OURTCB+00000202     1 BYTE(S)
TCBRV    EQU   OURTCB+00000202     1 BIT(S)
A00013   EQU   OURTCB+00000202     7 BIT(S)
CCW      EQU   00000000            64 BIT(S) ON BYTE
COCO     EQU   CCW+00000000        8 BIT(S)
DAD      EQU   CCW+00000001        24 BIT(S)
FLAG12   EQU   CCW+00000004        8 BIT(S)
A00014   EQU   CCW+00000004        1 BIT(S)
COMCHN   EQU   CCW+00000004        1 BIT(S)
A00015   EQU   CCW+00000004        1 BIT(S)
SKIP     EQU   CCW+00000004        1 BIT(S)
FLOBS    EQU   CCW+00000004        4 BIT(S)
BLA      EQU   CCW+00000005        8 BIT(S)
COU      EQU   CCW+00000006        16 BIT(S)
CCWCHAIN EQU   00000000            8 BYTE(S)
CCW1     EQU   CCWCHAIN+00000000   8 BYTE(S)
OP1      EQU   CCWCHAIN+00000000   1 BYTE(S)
BUFADR1  EQU   CCWCHAIN+00000001   3  BYTE  POINTER
FLAGS0   EQU   CCWCHAIN+00000004   8 BIT(S)
A00016   EQU   CCWCHAIN+00000004   1 BIT(S)
CHN1     EQU   CCWCHAIN+00000004   1 BIT(S)
A00017   EQU   CCWCHAIN+00000004   6 BIT(S)
A00018   EQU   CCWCHAIN+00000005   1 BYTE(S)
CNT1     EQU   CCWCHAIN+00000006   2 BYTE(S)
CCWWORK  EQU   00000000            40 BYTE(S) ON DWORD
CCWA     EQU   CCWWORK+00000000    8 BYTE(S)
A00019   EQU   CCWWORK+00000000    1 BYTE(S)
CCWADAT  EQU   CCWWORK+00000001    3  BYTE  POINTER
A00020   EQU   CCWWORK+00000004    4 BYTE(S)
CCWB     EQU   CCWWORK+00000008    8 BYTE(S)
A00021   EQU   CCWWORK+00000008    1 BYTE(S)
CCWBDAT  EQU   CCWWORK+00000009    3  BYTE  POINTER
A00022   EQU   CCWWORK+00000012    4 BYTE(S)
CCWC     EQU   CCWWORK+00000016    8 BYTE(S)
A00023   EQU   CCWWORK+00000016    1 BYTE(S)
CCWCDAT  EQU   CCWWORK+00000017    3  BYTE  POINTER
A00024   EQU   CCWWORK+00000020    4 BYTE(S)
CCWD     EQU   CCWWORK+00000024    8 BYTE(S)
CCWF     EQU   CCWWORK+00000032    8 BYTE(S)
WRITEBUF EQU   00000000            120 BYTE(S)
DADBUF   EQU   00000000            1 BYTE(S)
         ORG   @DATA
         DS    00000004C
@L       EQU   3
@DATD    DSECT
CC3PLIST EQU   @DATD+00000000      4 BYTE(S) ON WORD
FUNCTCOD EQU   CC3PLIST+00000000   1 BYTE(S)
CC3UCB   EQU   CC3PLIST+00000001   3  BYTE  POINTER ON WORD+1
         DS    00000008C
@TEMPS   DS    0F
@TEMP3   DC    F'0'
@TEMP4   DC    F'0'
IGE0019I CSECT                                                   XM4924
*
***********************************************************************
*        READ SKIP AND READ REPEAT
CCWRDSKP CCW   2,*,X'30',80             READ SKIP                M4502
CCWWRNEG CCW   1,*,X'60',1             WRTIE N                    M4502
*        FORCE TO READ SEQUENCE
CCWWREOT CCW   1,*,X'60',1              WRITE EOT                 M4502
CCWRDEOT CCW   2,*,X'60',1              READ                      M4502
*        ENABLE
CCWENABL CCW   X'27',0,X'60',1          ENABLE                    M4502
***********************************************************************
*
*
***********************************************************************
***********************************************************************
*
@DATD    DSECT                                                   XM4924
@DATD    DSECT
@DATEND  EQU   *
IGE0019I CSECT ,
@9F2     EQU   ERRORA3X
@9F1     EQU   ERRORSNO
@9EE     EQU   ERRORSNO
@9ED     EQU   ERRORIRR
@9EC     EQU   ERRORSNO
@9EB     EQU   ERRORA3X
@9EA     EQU   ERRORA3X
@9E8     EQU   NOERITOK
         END

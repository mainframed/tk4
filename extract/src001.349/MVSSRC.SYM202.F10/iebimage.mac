         TITLE 'PRINTER IMAGE LIBRARY UTILITY -IEBIMAGE- .             *
                        '
IEBIMAGE CSECT ,                                                01S0001
@MAINENT DS    0H                                               01S0001
         USING *,@15                                            01S0001
         B     @PROLOG                                          01S0001
         DC    AL1(16)                                          01S0001
         DC    C'IEBIMAGE  76.350'                              01S0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                  01S0001
         BALR  @09,0                                            01S0001
@PSTART  LA    @10,4095(,@09)                                   01S0001
         LA    @11,4095(,@10)                                   01S0001
         LA    @12,4095(,@11)                                   01S0001
         USING @PSTART,@09                                      01S0001
         USING @PSTART+4095,@10                                 01S0001
         USING @PSTART+8190,@11                                 01S0001
         USING @PSTART+12285,@12                                01S0001
         ST    @13,@SA00001+4                                   01S0001
         LA    @14,@SA00001                                     01S0001
         ST    @14,8(,@13)                                      01S0001
         LR    @13,@14                                          01S0001
BACK     EQU   4
FORE     EQU   8
*        PARAM = R1;                   /* SAVE PARAMETER LIST POINTER*/
         LR    PARAM,R1                                         01S0101
*        R0 = LENGTH(WORKAREA);        /* GET SIZE OF WORKAREA       */
         LH    R0,@CH01845                                      01S0102
*        GEN (GETMAIN  R,LV=(0));      /*  FOR GETMAIN.              */
         GETMAIN  R,LV=(0)
*        BUFAD = R1;                   /* ESTABLISH WORKAREA ADDR    */
         LR    BUFAD,R1                                         01S0104
*        RESPECIFY (R0)   UNRESTRICTED;                         01S0105
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL SET THE ENTIRE WORKAREA TO ZERO.                *
**                                                                    *
**********************************************************************/
*                                                               02S0106
*        RESPECIFY (RECAREA,           /*                            */
*                   RECSIZE,           /* RESTRICT NECESSARY         */
*                   TRANSIZE,          /* REGISTERS FOR MOVE LONG.   */
*                   BUFFPTR)  RESTRICTED;                       02S0106
*                                                               02S0106
*        RECAREA = BUFAD;              /* ADDRESS OF WORKAREA.       */
         LR    RECAREA,BUFAD                                    02S0107
*        RECSIZE = LENGTH(WORKAREA);   /* SIZE OF WORKAREA.          */
         LH    RECSIZE,@CH01845                                 02S0108
*        TRANSIZE = ZERO;              /* USE PADDING BYTE.          */
         SLR   TRANSIZE,TRANSIZE                                02S0109
*        BUFFPTR = ADDR(ZERO);         /* ADDRESS OF A ZERO.         */
         LA    BUFFPTR,@CH00462+1                               02S0110
*                                      /*                            */
*        MVCL(RECAREA,BUFFPTR);        /* CLEAR WORKAREA.            */
         MVCL  RECAREA,BUFFPTR                                  02S0111
*                                      /*                            */
*        RESPECIFY (RECAREA,           /* FREE REGISTERS FOR         */
*                   RECSIZE,           /*  COMPILER USE.             */
*                   TRANSIZE,          /*                            */
*                   BUFFPTR) UNRESTRICTED;                      02S0112
*        SYSINAD = ADDR(SYSIN);        /* SET DCB ADDRESSES          */
         LA    @02,SYSIN                                        01S0113
         ST    @02,SYSINAD(,BUFAD)                              01S0113
*        SYSPRTAD = ADDR(SYSPRINT);    /*  INTO                      */
         LA    @02,SYSPRINT                                     01S0114
         ST    @02,SYSPRTAD(,BUFAD)                             01S0114
*        UTINAD = ADDR(SYSUTIN);       /*  WORKAREA.                 */
         LA    @02,SYSUTIN                                      01S0115
         ST    @02,UTINAD(,BUFAD)                               01S0115
*        UTOUTAD = ADDR(SYSUTOUT);     /*                            */
         LA    @02,SYSUTOUT                                     01S0116
         ST    @02,UTOUTAD(,BUFAD)                              01S0116
*        PAGE = ONE;                   /* SET DEFAULT PAGE NUMBER.   */
         MVC   PAGE(2,BUFAD),@CH00060                           01S0117
*        IF PARMVL1 ^= LAST            /* CHECK FOR USER PARAMETERS. */
*          THEN                        /*                            */
         TM    PARMVL1(PARAM),B'10000000'                       01S0118
         BO    @RF00118                                         01S0118
*            DO;                       /* INTERROGATE USER PARAMETERS*/
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL INTERROGATE THE PARAMETERS PASSED TO THE        *
**  UTILITY VIA LINK OR ATTATCH. THE FIRST PARAMETER IS IGNORED, THE  *
**  SECOND POINTS TO AN ALTERNATE DDNAME LIST, AND THE THIRD POINTS   *
**  TO A HEADING LIST.                                                *
**                                                                    *
**********************************************************************/
*        IF LISTLEN => SYS2NO          /* CHECK FOR LIBRARY OUTPUT   */
*         & SYS2FLG ^= ZERO            /*  DDNAME.                   */
*          THEN                        /*                            */
         SLR   @02,@02                                          02S0120
         ICM   @02,7,PARM2(PARAM)                               02S0120
         LH    @00,LISTLEN(,@02)                                02S0120
         CH    @00,@CH00175                                     02S0120
         BL    @RF00120                                         02S0120
         CLI   SYS2FLG(@02),0                                   02S0120
         BE    @RF00120                                         02S0120
*            DDNAMES(FOUR) = USERU2DD; /* USER SUPPLIED DDNAME.      */
         MVC   DDNAMES+24(8,BUFAD),USERU2DD(@02)                02S0121
*          ELSE                        /*                            */
*            DDNAMES(FOUR) = SYSUTDD;  /* STANDARD DDNAME IS SYSUT1. */
         B     @RC00120                                         02S0122
@RF00120 MVC   DDNAMES+24(8,BUFAD),@CC01087                     02S0122
*        IF LISTLEN => SYS1NO          /* CHECK FOR LIBRARY INPUT    */
*         & SYS1FLG ^= ZERO            /*  DDNAME.                   */
*          THEN                        /*                            */
@RC00120 SLR   @02,@02                                          02S0123
         ICM   @02,7,PARM2(PARAM)                               02S0123
         LH    @00,LISTLEN(,@02)                                02S0123
         CH    @00,@CH00245                                     02S0123
         BL    @RF00123                                         02S0123
         CLI   SYS1FLG(@02),0                                   02S0123
         BE    @RF00123                                         02S0123
*            DDNAMES(THREE) = USERU1DD;/* USER SUPPLIED DDNAME.      */
         MVC   DDNAMES+16(8,BUFAD),USERU1DD(@02)                02S0124
*          ELSE                        /*                            */
*            DDNAMES(THREE) = SYSUTDD; /* STANDARD DDNAME IS SYSUT1. */
         B     @RC00123                                         02S0125
@RF00123 MVC   DDNAMES+16(8,BUFAD),@CC01087                     02S0125
*        IF LISTLEN => SYSPNO          /* CHECK FOR SYSTEM OUTPUT    */
*         & SYSPFLG ^= ZERO            /*  DDNAME.                   */
*          THEN                        /*                            */
@RC00123 SLR   @02,@02                                          02S0126
         ICM   @02,7,PARM2(PARAM)                               02S0126
         LH    @00,LISTLEN(,@02)                                02S0126
         CH    @00,@CH00408                                     02S0126
         BL    @RF00126                                         02S0126
         CLI   SYSPFLG(@02),0                                   02S0126
         BE    @RF00126                                         02S0126
*            DDNAMES(ONE) = USERPRDD;  /* USER SUPPLIED DDNAME.      */
         MVC   DDNAMES(8,BUFAD),USERPRDD(@02)                   02S0127
*          ELSE                        /*                            */
*            DDNAMES(ONE) = SYSPRDD;   /* STANDARD DDNAME IS SYSPRINT*/
         B     @RC00126                                         02S0128
@RF00126 MVC   DDNAMES(8,BUFAD),@CC01083                        02S0128
*        IF LISTLEN => SYSINO          /* CHECK FOR SYSTEM INPUT     */
*         & SYSIFLG ^= ZERO            /*  DDNAME.                   */
*          THEN                        /*                            */
@RC00126 SLR   @02,@02                                          02S0129
         ICM   @02,7,PARM2(PARAM)                               02S0129
         LH    @00,LISTLEN(,@02)                                02S0129
         CH    @00,@CH00039                                     02S0129
         BL    @RF00129                                         02S0129
         CLI   SYSIFLG(@02),0                                   02S0129
         BE    @RF00129                                         02S0129
*            DDNAMES(TWO) = USERINDD;  /* USER SUPPLIED DDNAME.      */
         MVC   DDNAMES+8(8,BUFAD),USERINDD(@02)                 02S0130
*          ELSE                        /*                            */
*            DDNAMES(TWO) = SYSINDD;   /* STANDARD DDNAME IS SYSIN.  */
         B     @RC00129                                         02S0131
@RF00129 MVC   DDNAMES+8(8,BUFAD),@CC01085                      02S0131
*        IF PARMVL2 ^= LAST            /* CHECK FOR MORE PARAMETERS. */
*          THEN                        /*                            */
@RC00129 TM    PARMVL2(PARAM),B'10000000'                       02S0132
         BO    @RF00132                                         02S0132
*            DO;                       /*                            */
*              DO                      /* CHECK FOR                  */
*               CNT = ONE              /*  VALID PARAMETER.          */
*               TO LENGTH(HDNG)        /*                            */
*               WHILE HDNG(CNT) =< CHAR9                        02S0134
*                   & HDNG(CNT) => CHAR0;                       02S0134
         LA    CNT,1                                            02S0134
@DL00134 SLR   @15,@15                                          02S0134
         ICM   @15,7,PARM3(PARAM)                               02S0134
         LR    @14,@15                                          02S0134
         ALR   @14,CNT                                          02S0134
         CLI   HDNG-1(@14),C'9'                                 02S0134
         BH    @DC00134                                         02S0134
         ALR   @15,CNT                                          02S0134
         CLI   HDNG-1(@15),C'0'                                 02S0134
         BL    @DC00134                                         02S0134
*              END;                    /*                            */
         AH    CNT,@CH00060                                     02S0135
         CH    CNT,@CH00050                                     02S0135
         BNH   @DL00134                                         02S0135
@DC00134 DS    0H                                               02S0136
*              IF PARMVL3 ^= LAST      /* CHECK FOR VALID            */
*               × HLEN ^= LENGTH(HDNG) /*  PARAMETER                 */
*               × CNT ^> LENGTH(HDNG)  /*  LIST.                     */
*                THEN                  /*                            */
         TM    PARMVL3(PARAM),B'10000000'                       02S0136
         BNO   @RT00136                                         02S0136
         LA    @15,4                                            02S0136
         ICM   @14,7,PARM3(PARAM)                               02S0136
         CH    @15,HLEN(,@14)                                   02S0136
         BNE   @RT00136                                         02S0136
         CR    CNT,@15                                          02S0136
         BH    @RF00136                                         02S0136
@RT00136 DS    0H                                               02S0137
*                  DO;                 /*                            */
*                    RETSAVE = RC24;   /* INVALID LIST.              */
         MVI   RETSAVE(BUFAD),X'18'                             02S0138
*                    ABNDFLG = ON;     /* TERMINATE UTILITY.         */
         OI    ABNDFLG(BUFAD),B'10000000'                       02S0139
*                  END;                /*                            */
*                ELSE                  /*                            */
*                  DO;                 /*                            */
         B     @RC00136                                         02S0141
@RF00136 DS    0H                                               02S0142
*                    PACK(DWORK,HDNG); /* CONVERT NUMBER TO          */
         ICM   @02,7,PARM3(PARAM)                               02S0142
         PACK  DWORK(8,BUFAD),HDNG(4,@02)                       02S0142
*                    CVB(FWORK,DWORK); /*  ARITHMETIC                */
         CVB   @02,DWORK(,BUFAD)                                02S0143
         ST    @02,FWORK(,BUFAD)                                02S0143
*                    PAGE = FWORK;     /*  VALUE.                    */
         STH   @02,PAGE(,BUFAD)                                 02S0144
*                  END;                /*                            */
*            END;                      /*                            */
*            END;                      /*                            */
*          ELSE                        /* IGNORE FIRST PARAMETER.    */
*            DO;                       /* INTIALIZE DDNAMES.         */
         B     @RC00118                                         01S0148
@RF00118 DS    0H                                               01S0149
*              DDNAMES(ONE) = SYSPRDD; /* SET SYSPRINT FOR SYSOUT.   */
         MVC   DDNAMES(8,BUFAD),@CC01083                        01S0149
*              DDNAMES(TWO) = SYSINDD; /* SET SYSIN FOR SYSIN.       */
         MVC   DDNAMES+8(8,BUFAD),@CC01085                      01S0150
*              DDNAMES(THREE) = SYSUTDD;/* SET SYSUT1 FOR LIB INPUT. */
         MVC   DDNAMES+16(8,BUFAD),@CC01087                     01S0151
*              DDNAMES(FOUR) = SYSUTDD;/* SET SYSUT1 AS LIB OUTPUT.  */
         MVC   DDNAMES+24(8,BUFAD),@CC01087                     01S0152
*            END;                      /*                            */
*        IF ABNDFLG = OFF              /* CHECK FOR TERMINATION      */
*          THEN                        /*  REQUEST.                  */
@RC00118 TM    ABNDFLG(BUFAD),B'10000000'                       01S0154
         BNZ   @RF00154                                         01S0154
*            DO;                       /* NOT THIS TIME.             */
*              DO                      /* START DDNAME SCAN.         */
*               CNT = ONE              /*                            */
*               TO DIM(DDNAMES);       /*                            */
         LA    CNT,1                                            01S0156
@DL00156 DS    0H                                               01S0157
*                DCBPTR = DCBTAB(CNT); /* SET ALL DCBS WITH          */
         LR    @15,CNT                                          01S0157
         SLA   @15,2                                            01S0157
         L     DCBPTR,DCBTAB-4(@15,BUFAD)                       01S0157
*                DCBDDNAM=DDNAMES(CNT);/* DDNAME.                    */
         LR    @05,CNT                                          01S0158
         SLA   @05,3                                            01S0158
         ALR   @05,BUFAD                                        01S0158
         MVC   DCBDDNAM+40(8,DCBPTR),DDNAMES-8(@05)             01S0158
*              END;                    /* END DDNAME SCAN.           */
         AH    CNT,@CH00060                                     01S0159
         CH    CNT,@CH00050                                     01S0159
         BNH   @DL00156                                         01S0159
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL OPEN THE SYSTEM OUTPUT DATA SET AND, IF OPEN    *
**  IS SUCCESSFUL WILL OPEN THE SYSTEM INPUT AND LIBRARY INPUT DATA   *
**  SETS.                                                             *
**                                                                    *
**********************************************************************/
*        GEN SETS(SYSPRINT)            /* OPEN SYSTEM OUTPUT         */
*            FLOWS(BKSZCK)             /**** OPEN EXIT.              */
*         (OPEN  (SYSPRINT,OUTPUT));   /*                            */
         OPEN  (SYSPRINT,OUTPUT)
*        DCBPTR = ADDR(SYSPRINT);      /*                            */
         LA    DCBPTR,SYSPRINT                                  02S0161
*        IF DCBOFOPN = OFF             /* CHECK FOR SUCCESSFUL OPEN. */
*          THEN                        /*                            */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  02S0162
         BNZ   @RF00162                                         02S0162
*            DO;                       /* OPEN FAILED.               */
*              RETSAVE = RC20;         /* SET RETURN CODE 20 (14)X.  */
         MVI   RETSAVE(BUFAD),X'14'                             02S0164
*              ABNDFLG = ON;           /* TERMINATE UTILITY.         */
         OI    ABNDFLG(BUFAD),B'10000000'                       02S0165
*            END;                      /*                            */
*          ELSE                        /* OK OPEN                    */
*            DO;                       /* NOW TRY SYSIN AND READ     */
         B     @RC00162                                         02S0167
@RF00162 DS    0H                                               02S0168
*              GEN SETS(SYSIN,SYSUTIN) /*  LIBRARY DATASET.          */
*            FLOWS(ABEND)              /**** OPEN EXIT               */
*               (OPEN (SYSIN,INPUT,SYSUTIN,INPUT));             02S0168
         OPEN (SYSIN,INPUT,SYSUTIN,INPUT)
*              DO                      /*                            */
*               CNT = TWO              /* NOW CHECK FOR GOOD OPENS.  */
*               TO DIM(DCBTAB)-ONE;    /*                            */
         LA    CNT,2                                            02S0169
@DL00169 DS    0H                                               02S0170
*                DCBPTR = DCBTAB(CNT); /* POINT TO A DCB.            */
         LR    @15,CNT                                          02S0170
         SLA   @15,2                                            02S0170
         L     DCBPTR,DCBTAB-4(@15,BUFAD)                       02S0170
*                IF DCBOFOPN = OFF     /* CHECK OPEN BIT.            */
*                  THEN                /*                            */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  02S0171
         BNZ   @RF00171                                         02S0171
*                    DO;               /*********** IEBA20I **********/
*                      MSGN = IEBA20I; /* DCB OPEN FAILURE           */
         MVI   MSGN(BUFAD),X'14'                                02S0173
*                      EDITDATA(ONE) = /* GET DDNAME FOR MESSAGE.    */
*                       ADDR(DDNAMES(CNT)); /*                       */
         LR    @15,CNT                                          02S0174
         SLA   @15,3                                            02S0174
         LA    @00,DDNAMES-8(@15,BUFAD)                         02S0174
         STCM  @00,7,EDITDATA(BUFAD)                            02S0174
*                      EDITLEN(ONE) =       /* GET NAME LENGTH       */
*                       LENGTH(DCBDDNAM);   /*                       */
         MVI   EDITLEN(BUFAD),X'08'                             02S0175
*                      CALL IEBIMSGS;       /* PRINT A MESSAGE       */
         L     @15,@CV00037                                     02S0176
         BALR  @14,@15                                          02S0176
*                      RETSAVE = RC16;      /*                       */
         MVI   RETSAVE(BUFAD),X'10'                             02S0177
*                      ABNDFLG = ON;        /* CAUSE TERMINATION     */
         OI    ABNDFLG(BUFAD),B'10000000'                       02S0178
*                    END;              /******************************/
*                  ELSE;               /*                            */
@RF00171 DS    0H                                               02S0181
*              END;                    /* END CHECK LOOP.            */
         AH    CNT,@CH00060                                     02S0181
         CH    CNT,@CH00111                                     02S0181
         BNH   @DL00169                                         02S0181
*            END;                      /*                            */
*              IF ABNDFLG = OFF        /* OPEN(S) COULD HAVE FAILED. */
*                THEN                  /*                            */
@RC00162 TM    ABNDFLG(BUFAD),B'10000000'                       01S0183
         BNZ   @RF00183                                         01S0183
*                  DO;                 /* NOT THIS TIME.             */
*                    OPTABAD           /* INITIALIZE WORKAREA WITH   */
*                     = ADDR(OPTAB);   /*  OPERATION TABLE ADDRESS   */
         LA    @02,OPTAB                                        01S0185
         STCM  @02,7,OPTABAD(BUFAD)                             01S0185
*                    OPTABLN           /*  OPERATION TABLE LENGTH    */
*                     = OPTABLEN;      /*                            */
         MVC   OPTABLN(1,BUFAD),OPTABLEN                        01S0186
*                    CARDEND           /*  LAST CARD COLUMN          */
*                     = ADDR(COL72);   /*                            */
         LA    @02,COL72(,BUFAD)                                01S0187
         ST    @02,CARDEND(,BUFAD)                              01S0187
*                    GEN (TIME);       /*                            */
         TIME
*                    TODAY = R1;       /*  TODAYS DATE.              */
         STCM  R1,7,TODAY(BUFAD)                                01S0189
*                  END;                /*                            */
*                ELSE;                 /*                            */
@RF00183 DS    0H                                               01S0192
*            END;                      /*                            */
*        RESPECIFY (R1,PARAM) UNRESTRICTED;                     01S0193
@RF00154 DS    0H                                               01S0194
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS IS THE MAINLINE OF THE UTILITY. IEBISCAN IS CALLED TO READ   *
**  CONTROL CARDS AND SCAN FOR THE OPERATION FIELD. WHEN CONTROL IS   *
**  RETURNED THE OPERATION IS DETERMINED AND EXECUTED. ALL OPERATIONS *
**  MUST BE DELIMITED WITH A (NAME) CONTROL STATEMENT.                *
**                                                                    *
**********************************************************************/
*                                                               01S0194
*        DO WHILE EOFFLG = OFF         /* QUIT IF END OF FILE.       */
*         & ABNDFLG = OFF;             /* QUIT IF ABEND INDICATED.   */
         B     @DE00194                                         01S0194
@DL00194 DS    0H                                               01S0195
*          CALL IEBISCAN;              /* START OP DETERMINATION     */
         L     @15,@CV00036                                     01S0195
         BALR  @14,@15                                          01S0195
*          IF EOFFLG = OFF             /* COULD BE LAST CARD IN SCAN */
*            THEN                      /* NOT THIS TIME.             */
         TM    EOFFLG(BUFAD),B'01000000'                        01S0196
         BNZ   @RF00196                                         01S0196
*              IF ACTIVOP ^= ZERO      /* TEST FOR ACTIVE OPERATION. */
*                THEN                  /*                            */
         CLI   ACTIVOP(BUFAD),0                                 01S0197
         BE    @RF00197                                         01S0197
*                  IF NEXTOP = ACTIVOP /* SOME OPERATIONS MAY HAVE   */
*                    & MLTFLAG(ACTIVOP)/*  MULTIPLE CONTROL CARDS.   */
*                        = ON          /*                            */
*                    THEN              /*                            */
         CLC   NEXTOP(1,BUFAD),ACTIVOP(BUFAD)                   01S0198
         BNE   @RF00198                                         01S0198
         SLR   @15,@15                                          01S0198
         IC    @15,ACTIVOP(,BUFAD)                              01S0198
         MH    @15,@CH00053                                     01S0198
         ICM   @01,7,OPTABAD(BUFAD)                             01S0198
         ALR   @01,@15                                          01S0198
         AL    @01,@CF01870                                     01S0198
         TM    MLTFLAG-1(@01),B'10000000'                       01S0198
         BNO   @RF00198                                         01S0198
*                      DO;             /*                            */
*                        CALL PRTCARD; /* PRINT CONTROL CARD.        */
         BAL   @14,PRTCARD                                      01S0200
*                        CALL BLDMOD;  /* EXECUTE CURRENT OPERATION  */
         SLR   @14,@14                                          01S0201
         IC    @14,ACTIVOP(,BUFAD)                              01S0201
         MH    @14,@CH00053                                     01S0201
         ICM   @01,7,OPTABAD(BUFAD)                             01S0201
         AL    @01,@CF01871                                     01S0201
         L     @15,BLDPTR-5(@14,@01)                            01S0201
         LA    @15,0(,@15)                                      01S0201
         BALR  @14,@15                                          01S0201
*                      END;            /*                            */
*                    ELSE              /* ALL OPERATIONS MUST HAVE   */
*                      IF NEXTOP       /*  NAME CONTROL CARD.        */
*                           = NAMEOP   /*                            */
*                        THEN          /*                            */
         B     @RC00198                                         01S0203
@RF00198 CLC   NEXTOP(1,BUFAD),NAMEOP                           01S0203
         BNE   @RF00203                                         01S0203
*                          DO;         /*                            */
*                            CALL PRTCARD; /* PRINT CONTROL CARD.    */
         BAL   @14,PRTCARD                                      01S0205
*                            CALL NAME;/* COMPLETE CURRENT OPERATION.*/
         BAL   @14,NAME                                         01S0206
*                          END;        /*                            */
*                        ELSE          /* CONTROL CARD SEQUENCE ERROR*/
*                          DO;         /*                            */
         B     @RC00203                                         01S0208
@RF00203 DS    0H                                               01S0209
*                            CALL PRTCARD;/* PRINT THIS CONTROL CARD.*/
         BAL   @14,PRTCARD                                      01S0209
*                            CALL INVOP;/* MAKE IT INVALID OPERATION.*/
         BAL   @14,INVOP                                        01S0210
*                          END;        /*                            */
*                ELSE                  /* NO OPERATION IN PROGRESS.  */
*                  DO;                 /*                            */
         B     @RC00197                                         01S0212
@RF00197 DS    0H                                               01S0213
*                    CALL PRTCARD;     /* PRT HEADING, CONTROL CARD. */
         BAL   @14,PRTCARD                                      01S0213
*                    ACTIVOP = NEXTOP; /* NEXT CONTOL CARD NOW ACTIVE*/
         SLR   @15,@15                                          01S0214
         IC    @15,NEXTOP(,BUFAD)                               01S0214
         STC   @15,ACTIVOP(,BUFAD)                              01S0214
*                    CALL BLDMOD;      /* EXECUTE OPERATION.         */
         MH    @15,@CH00053                                     01S0215
         ICM   @01,7,OPTABAD(BUFAD)                             01S0215
         AL    @01,@CF01871                                     01S0215
         L     @15,BLDPTR-5(@15,@01)                            01S0215
         LA    @15,0(,@15)                                      01S0215
         BALR  @14,@15                                          01S0215
*                  END;                /*                            */
*            ELSE;                     /* END OF FILE FROM IEBISCAN. */
@RF00196 DS    0H                                               01S0218
*        END;                          /* END OF OPERATION LOOP.     */
@RC00196 DS    0H                                               01S0218
@DE00194 TM    EOFFLG(BUFAD),B'11000000'                        01S0218
         BZ    @DL00194                                         01S0218
         EJECT
*/*********************************************************************
**                                                                    *
**  THE UTILITY WILL NOW ISSUE ITS FINAL MESSAGE, CLOSE THE DATA      *
**  CONTROL BLOCKS AND FREE ANY GOTTEN CORE. TERMINATION WILL THEN    *
**  OCCUR WITH THE HIGHEST RETURN CODE RECEIVED DURING EXECUTION.     *
**                                                                    *
**********************************************************************/
*                                                               01S0219
*        IF OPINPRG = ON               /* CHECK FOR COMPLETED OP.    */
*          THEN                        /*                            */
         TM    OPINPRG(BUFAD),B'00000010'                       01S0219
         BNO   @RF00219                                         01S0219
*            CALL NAME;                /* GO COMPLETE OPERATION.     */
         BAL   @14,NAME                                         01S0220
*          ELSE;                       /* OPERATION COMPLETE.        */
@RF00219 DS    0H                                               01S0222
*        DCBPTR = SYSPRTAD;            /* GET ADDRESS OF SYSPRINT.   */
         L     DCBPTR,SYSPRTAD(,BUFAD)                          01S0222
*        IF DCBOFOPN = ON              /* CHECK ABILITY TO PRINT.    */
*          THEN                        /*                            */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  01S0223
         BNO   @RF00223                                         01S0223
*            DO;                       /*********** IEBA01I **********/
*              FWORK = RETSAVE;        /* MOVE RETURN CODE TO WORK.  */
         SLR   @15,@15                                          01S0225
         IC    @15,RETSAVE(,BUFAD)                              01S0225
         ST    @15,FWORK(,BUFAD)                                01S0225
*              CVD(FWORK,DWORK);       /* CONVERT RETURN CODE.       */
         CVD   @15,DWORK(,BUFAD)                                01S0226
*              UNPK(UWORK,PWORK);      /* MAKE RETURN CODE PRINTABLE */
         UNPK  UWORK(2,BUFAD),PWORK(2,BUFAD)                    01S0227
*              UNITS = UNITS × MASK;   /*                            */
         OI    UNITS(BUFAD),C'0'                                01S0228
*              EDITDATA(ONE) = ADDR(CWORK); /* DATA ADDR FOR MESSAGE.*/
         LA    @15,CWORK(,BUFAD)                                01S0229
         STCM  @15,7,EDITDATA(BUFAD)                            01S0229
*              EDITLEN(ONE) = TWO;     /* DATA LENGTH FOR MESSAGE.   */
         MVI   EDITLEN(BUFAD),X'02'                             01S0230
*              MSGN = IEBA01I;         /* UTILITY COMPLETE MESSAGE.  */
         MVI   MSGN(BUFAD),X'01'                                01S0231
*              CALL IEBIMSGS;          /* GET A MESSAGE.             */
         L     @15,@CV00037                                     01S0232
         BALR  @14,@15                                          01S0232
*              DO                      /* CLOSE DATA SET LOOP.       */
*               CNT = ONE              /* START AT FIRST DCB.        */
*               TO DIM(DCBTAB);        /* CONTINUE THRU LAST DCB.    */
         LA    CNT,1                                            01S0233
@DL00233 DS    0H                                               01S0234
*                DCBPTR = DCBTAB(CNT); /* GET A DCB ADDRESS.         */
         LR    @03,CNT                                          01S0234
         SLA   @03,2                                            01S0234
         L     DCBPTR,DCBTAB-4(@03,BUFAD)                       01S0234
*                IF DCBOFOPN = ON      /* IS DCB OPEN?               */
*                  THEN                /* YES, CLOSE DATA SET        */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  01S0235
         BNO   @RF00235                                         01S0235
*                    GEN SETS(SYSPRINT,SYSIN,                   01S0236
*                     SYSUTIN,SYSUTOUT)/* CLOSE FOLLOWING DATA SETS  */
*                       (CLOSE ((DCBPTR)));                     01S0236
         CLOSE ((DCBPTR))
*                  ELSE;               /* NO, GET NEXT DCB OR QUIT.  */
@RF00235 DS    0H                                               01S0238
*              END;                    /* END OF CLOSE LOOP.         */
         AH    CNT,@CH00060                                     01S0238
         CH    CNT,@CH00050                                     01S0238
         BNH   @DL00233                                         01S0238
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF00223 DS    0H                                               01S0241
*        RESPECIFY (R0,R1) RESTRICTED;                          01S0241
*        R0 = LENGTH(WORKAREA);        /* SIZE FOR FREEMAIN.         */
         LH    R0,@CH01845                                      01S0242
*        R1 = BUFAD;                   /* AREA TO FREE.              */
         LR    R1,BUFAD                                         01S0243
*        BUFAD = RETSAVE;              /* SAVE RETURN CODE.          */
         SLR   @15,@15                                          01S0244
         IC    @15,RETSAVE(,BUFAD)                              01S0244
         LR    BUFAD,@15                                        01S0244
*        GEN                           /* AND FREE THE CORE.         */
*          (FREEMAIN R,LV=(0),A=(1));                           01S0245
         FREEMAIN R,LV=(0),A=(1)
*        RESPECIFY (R0,R1) UNRESTRICTED;                        01S0246
*        RETURN CODE(BUFAD);           /* TERMINATE UTILITY.         */
         LR    @15,BUFAD                                        01S0247
         L     @13,4(,@13)                                      01S0247
         L     @14,12(,@13)                                     01S0247
         LM    @00,@12,20(@13)                                  01S0247
         BR    @14                                              01S0247
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE VALIDATES THE INCLUDE OPERATION. THE SUBSEQUENT      *
**  OPERATION WILL INVOKE READ OR LOAD TO BRING IN THE REQUESTED      *
**  LIBRARY MODULE.                                                   *
**                                                                    *
**********************************************************************/
*INCLUDE:                                                       01S0248
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0248
@EL00001 L     @13,4(,@13)                                      01S0248
@EF00001 DS    0H                                               01S0248
@ER00001 LM    @14,@12,12(@13)                                  01S0248
         BR    @14                                              01S0248
INCLUDE  STM   @14,@12,12(@13)                                  01S0248
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        IF INCLSW = ON                /* CHECK FOR PREVIOUS INCLUDE.*/
*          THEN                        /*                            */
         TM    INCLSW(BUFAD),B'00100000'                        01S0250
         BNO   @RF00250                                         01S0250
*            DO;                       /* INDICATE PREVIOUS INCLUDE  */
*              MSGN = IEBA13I;         /*  WILL NOT BE USED.         */
         MVI   MSGN(BUFAD),X'0D'                                01S0252
*              CALL IEBIMSGS;          /* PRINT THE MESSAGE.         */
         L     @15,@CV00037                                     01S0253
         BALR  @14,@15                                          01S0253
*              KWDUSED = OFF;          /* RESET ANY KEYWORDS.        */
         MVI   KWDUSED(BUFAD),B'00000000'                       01S0254
*            END;                      /*                            */
*        IF SCANINP = ON               /* NEED TO FIND NAME.         */
*          THEN                        /*                            */
@RF00250 TM    SCANINP(BUFAD),B'01000000'                       01S0256
         BNO   @RF00256                                         01S0256
*            DO;                       /* CONTINUE INCLUDE PROCESS.  */
*              CALL IEBISCAN;          /* SCAN REST OF CARD.         */
         L     @15,@CV00036                                     01S0258
         BALR  @14,@15                                          01S0258
*              IF BNAME ^= BADNAM      /* CHECK FOR POSSIBLE SCAN ERR*/
*               & NAMESET = ON         /*  OR ANY NAME AT ALL.       */
*                THEN                  /*                            */
         CLC   BNAME(8,BUFAD),@CC00825                          01S0259
         BE    @RF00259                                         01S0259
         TM    NAMESET(BUFAD),B'10000000'                       01S0259
         BNO   @RF00259                                         01S0259
*                  INCLNAME = BSUFIX;  /* SAVE MODULE NAME.          */
         MVC   INCLNAME(4,BUFAD),BSUFIX(BUFAD)                  01S0260
*                ELSE                  /* MUST HAVE BEEN ERROR.      */
*                  DO;                 /*                            */
         B     @RC00259                                         01S0261
@RF00259 DS    0H                                               01S0262
*                    INHIBITR = ON;    /* INHIBIT LIBRARY READ.      */
         OI    INHIBITR(BUFAD),B'00100000'                      01S0262
*                    DELSET = OFF;     /* RESET DELETE REQUEST.      */
         NI    DELSET(BUFAD),B'11011111'                        01S0263
*                  END;                /*                            */
*            END;                      /*                            */
*          ELSE;                       /* ERROR. NO NAME.            */
@RF00256 DS    0H                                               01S0267
*        IF NAMESET = OFF              /* CHECK FOR NO NAME.         */
*          THEN                        /*                            */
@RC00256 TM    NAMESET(BUFAD),B'10000000'                       01S0267
         BNZ   @RF00267                                         01S0267
*            DO;                       /*                            */
*              MSGN = IEBA08I;         /* NO NAME MESSAGE.           */
         MVI   MSGN(BUFAD),X'08'                                01S0269
*              CALL IEBIMSGS;          /* PRINT THE MESSAGE.         */
         L     @15,@CV00037                                     01S0270
         BALR  @14,@15                                          01S0270
*              RETSAVE =               /* SET RETURN CODE 8 THIS     */
*                MAX(RETSAVE,RC8);     /*  OPERATION.                */
         SLR   @15,@15                                          01S0271
         IC    @15,RETSAVE(,BUFAD)                              01S0271
         LA    @14,8                                            01S0271
         CR    @15,@14                                          01S0271
         BNL   *+6
         LR    @15,@14                                          01S0271
         STC   @15,RETSAVE(,BUFAD)                              01S0271
*              INHIBIT = ONNER;        /* PREVENT LIBRARY ACCESS.    */
         OI    INHIBIT(BUFAD),B'01100000'                       01S0272
*              DELSET = OFF;           /* RESET DELETE REQUEST.      */
         NI    DELSET(BUFAD),B'11011111'                        01S0273
*            END;                      /*                            */
*          ELSE                        /*                            */
*            NAMESET = OFF;            /* RESET NAME INDICATOR.      */
         B     @RC00267                                         01S0275
@RF00267 NI    NAMESET(BUFAD),B'01111111'                       01S0275
*        INCLSW = ON;                  /* INDICATE INCLUDE.          */
@RC00267 OI    INCLSW(BUFAD),B'00100000'                        01S0276
*        ACTIVOP = ZERO;               /* NEXT OP WILL BE ACTIVE OP. */
         MVI   ACTIVOP(BUFAD),X'00'                             01S0277
*        GEN REFS(SAVE1)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE1+BACK(,BUFAD)); /*                            */
         L  @13,SAVE1+BACK(,BUFAD)
*END INCLUDE;                          /* RETURN TO CALLER.          */
@EL00002 DS    0H                                               01S0279
@EF00002 DS    0H                                               01S0279
@ER00002 LM    @14,@12,12(@13)                                  01S0279
         BR    @14                                              01S0279
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL SET THE APPROPRIATE  FUNCTION DEFAULTS AND      *
**  IF THE CONTROL CARD HAS MORE DATA, THE ROUTINE WILL THEN          *
**  CALL IEBISCAN TO OBTAIN THE KEYWORD DATA FROM THE CONTROL         *
**  CARD(S). WHEN CONTROL IS RETURNED, THE SPECIFIED FORMS CONTROL    *
**  BUFFER MODULE WILL BE BUILT AND TESTED FOR VALIDITY.              *
**                                                                    *
**********************************************************************/
*FCB:                                                           01S0280
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0280
FCB      STM   @14,@12,12(@13)                                  01S0280
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        BNAME = FCB3;                 /* SET FCB MEMBER PREFIX.     */
         MVI   BNAME+4(BUFAD),C' '                              01S0282
         MVC   BNAME+5(3,BUFAD),BNAME+4(BUFAD)                  01S0282
         MVC   BNAME(4,BUFAD),@CC00817                          01S0282
*        OPINPRG = ON;                 /* SET OPERATION IN PROGRESS. */
         OI    OPINPRG(BUFAD),B'00000010'                       01S0283
*        IF SCANINP = ON               /* SCAN IN PROGRESS MEANS     */
*          THEN                        /*  KEYWORDS NEED SCANNING.   */
         TM    SCANINP(BUFAD),B'01000000'                       01S0284
         BNO   @RF00284                                         01S0284
*            DO;                       /* EXECUTE SCAN ROUTINES      */
*              IF INCLSW = ON          /* CHECK FOR INCLUDE.         */
*                THEN                  /* IT IS INVALID.             */
         TM    INCLSW(BUFAD),B'00100000'                        01S0286
         BNO   @RF00286                                         01S0286
*                  DO;                 /*                            */
*                    INCLSW = OFF;     /* RESET INCLUDE SWITCH.      */
         NI    INCLSW(BUFAD),B'11011111'                        01S0288
*                    MSGN = IEBA13I;   /* SET MESSAGE NUMBER.        */
         MVI   MSGN(BUFAD),X'0D'                                01S0289
*                    CALL IEBIMSGS;    /* PRINT IT.                  */
         L     @15,@CV00037                                     01S0290
         BALR  @14,@15                                          01S0290
*                    RETSAVE =         /* SET RETURN CODE 4          */
*                     MAX(RETSAVE,RC4);/*  FOR THIS OPERATION.       */
         SLR   @15,@15                                          01S0291
         IC    @15,RETSAVE(,BUFAD)                              01S0291
         LA    @14,4                                            01S0291
         CR    @15,@14                                          01S0291
         BNL   *+6
         LR    @15,@14                                          01S0291
         STC   @15,RETSAVE(,BUFAD)                              01S0291
*                  END;                /*                            */
*                ELSE;                 /* CONTINUE.                  */
@RF00286 DS    0H                                               01S0294
*              FCBMOD = FCBMOD&&FCBMOD;/* CLEAR AREA FOR FCB MODULE. */
         XC    FCBMOD(152,BUFAD),FCBMOD(BUFAD)                  01S0294
*              FCBSIZE = FDFLT;        /* SET DEFAULT SIZE TO 11 INCH*/
         MVC   FCBSIZE(2,BUFAD),@CH00754                        01S0295
*              CALL IEBISCAN;          /*  TO DETERMINE KEYWORDS.    */
         L     @15,@CV00036                                     01S0296
         BALR  @14,@15                                          01S0296
*              LPICNT = ZERO;          /* RESET LPI COUNTERS.@Z48MSTT*/
         SLR   @05,@05                                          01S0297
         ST    @05,LPICNT(,BUFAD)                               01S0297
*              FCBSIZE =               /* CALCULATE SIZE AS NUMBER   */
*               (FCBSIZE/FIVE - TWO)   /*  OF 1/24 INCHES -  @Z48MSTT*/
*                * TWELV;              /* EXCLUDING MARGINS. @Z48MSTT*/
         LH    @00,FCBSIZE(,BUFAD)                              01S0298
         SRDA  @00,32                                           01S0298
         D     @00,@CF00040                                     01S0298
         BCTR  @01,0                                            01S0298
         BCTR  @01,0                                            01S0298
         MH    @01,@CH00035                                     01S0298
         STH   @01,FCBSIZE(,BUFAD)                              01S0298
*              FCNT = FCBMAX;          /* PRIME FCB LINE COUNTER.    */
         LA    FCNT,144                                         01S0299
*              IF LPISET = ON          /* CHECK FOR LPI KEYWORD.     */
*                THEN                  /* BUILD FCB FROM INPUT.      */
         TM    LPISET(BUFAD),B'00010000'                        01S0300
         BNO   @RF00300                                         01S0300
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL SET THE LINE PER INCH BIT IN THE FCB IMAGE      *
**  AS REQUESTED ON THE CONTROL CARD.                                 *
**                                                                    *
**********************************************************************/
*        DO;                                                    02S0301
*          LPICNT = ZERO;              /* RESET LPI COUNTERS.        */
         ST    @05,LPICNT(,BUFAD)                               02S0302
*          FCNT = THREE;               /* FIRST THREE LINES 6 LPI    */
         LA    FCNT,3                                           02S0303
*          DO                          /* START FILLING FCB WITH     */
*           XCNT = ONE                 /*  LINE PER INCH INDICATIONS.*/
*           TO SCNT - ONE              /*                            */
*           WHILE FCNT ^> FCBMAX       /* STOP IF BUFF ORUN  @Z48MSTT*/
*               & FCBSIZE ^< ZERO;     /*  OR NO MORE ROOM.  @Z48MSTT*/
         LA    XCNT,1                                           02S0304
         B     @DE00304                                         02S0304
@DL00304 CH    FCNT,@CH00236                                    02S0304
         BH    @DC00304                                         02S0304
         SLR   @05,@05                                          02S0304
         LH    @02,FCBSIZE(,BUFAD)                              02S0304
         CR    @02,@05                                          02S0304
         BL    @DC00304                                         02S0304
*            ZCNT = SCANARY(XCNT,TWO); /* GET NUMBER OF LINES.       */
         LR    @15,XCNT                                         02S0305
         SLA   @15,2                                            02S0305
         SLR   ZCNT,ZCNT                                        02S0305
         IC    ZCNT,SCANARY-3(@15,BUFAD)                        02S0305
*            IF SCANARY(XCNT,ONE)=SIX  /* CHECK FOR 6 LPI.           */
*              THEN                    /*                            */
         SLR   @14,@14                                          02S0306
         IC    @14,SCANARY-4(@15,BUFAD)                         02S0306
         CH    @14,@CH00185                                     02S0306
         BNE   @RF00306                                         02S0306
*                DO;                   /* LPI 6 REQUEST.             */
*                  IF ZCNT = ZERO      /* CHECK FOR FILL REQUEST.    */
*                    THEN              /* SET REMAINING SIZE.        */
         CR    ZCNT,@05                                         02S0308
         BNE   @RF00308                                         02S0308
*                      ZCNT =          /*  AT SIX LINES PER INCH.    */
*                       FCBSIZE / FOUR;/*                    @Z48MSTT*/
         LH    @05,FCBSIZE(,BUFAD)                              02S0309
         LR    @00,@05                                          02S0309
         SRDA  @00,32                                           02S0309
         D     @00,@CF00050                                     02S0309
         LR    ZCNT,@01                                         02S0309
*                  FCBSIZE = FCBSIZE   /* ADJUST SIZE FOR    @Z48MSTT*/
*                       -ZCNT*FOUR;    /*  THIS INCREMENT.   @Z48MSTT*/
@RF00308 LR    @05,ZCNT                                         02S0310
         SLA   @05,2                                            02S0310
         LCR   @05,@05                                          02S0310
         AH    @05,FCBSIZE(,BUFAD)                              02S0310
         STH   @05,FCBSIZE(,BUFAD)                              02S0310
*                  LPI6 = LPI6 + ZCNT; /* INCREMENT 6 LPI COUNTER    */
         SLR   @05,@05                                          02S0311
         IC    @05,LPI6(,BUFAD)                                 02S0311
         ALR   @05,ZCNT                                         02S0311
         STC   @05,LPI6(,BUFAD)                                 02S0311
*                END;                  /*                            */
*              ELSE                    /* CHECK FOR 8 LPI.           */
*                IF SCANARY(XCNT,ONE) = EIGHT                   02S0313
*                  THEN                /*                            */
         B     @RC00306                                         02S0313
@RF00306 LR    @05,XCNT                                         02S0313
         SLA   @05,2                                            02S0313
         SLR   @15,@15                                          02S0313
         IC    @15,SCANARY-4(@05,BUFAD)                         02S0313
         CH    @15,@CH00048                                     02S0313
         BNE   @RF00313                                         02S0313
*                    DO;               /*                            */
*                      IF ZCNT = ZERO  /* CHECK FOR FILL REQUEST.    */
*                        THEN          /* SET REMAINING SIZE.        */
         LTR   ZCNT,ZCNT                                        02S0315
         BNZ   @RF00315                                         02S0315
*                          ZCNT =      /*  AT EIGHT LINES PER INCH.  */
*                           FCBSIZE /THREE;/*                @Z48MSTT*/
         LH    @00,FCBSIZE(,BUFAD)                              02S0316
         SRDA  @00,32                                           02S0316
         D     @00,@CF00111                                     02S0316
         LR    ZCNT,@01                                         02S0316
*                      FCBSIZE = FCBSIZE   /* ADJUST SIZE FOR@Z48MSTT*/
*                           -ZCNT*THREE;   /*  THIS INCREMENT@Z48MSTT*/
@RF00315 LR    @05,ZCNT                                         02S0317
         MH    @05,@CH00111                                     02S0317
         LCR   @05,@05                                          02S0317
         AH    @05,FCBSIZE(,BUFAD)                              02S0317
         STH   @05,FCBSIZE(,BUFAD)                              02S0317
*                      DO              /* START 8 LPI BIT SET.       */
*                       YCNT = ONE     /*                            */
*                       TO ZCNT;       /*  SET 8 LPI FOR AMOUNT      */
         LA    YCNT,1                                           02S0318
         B     @DE00318                                         02S0318
@DL00318 DS    0H                                               02S0319
*                        FLPI(FCNT+YCNT) = ON;/* SPECIFIED.          */
         LR    @15,FCNT                                         02S0319
         ALR   @15,YCNT                                         02S0319
         ALR   @15,BUFAD                                        02S0319
         OI    FLPI-1(@15),B'00010000'                          02S0319
*                      END;            /* END 8 LPI BIT SET.         */
         AH    YCNT,@CH00060                                    02S0320
@DE00318 CR    YCNT,ZCNT                                        02S0320
         BNH   @DL00318                                         02S0320
*                      LPI8=LPI8+ZCNT; /* INCREMENT 8 LPI COUNTER    */
         SLR   @05,@05                                          02S0321
         IC    @05,LPI8(,BUFAD)                                 02S0321
         ALR   @05,ZCNT                                         02S0321
         STC   @05,LPI8(,BUFAD)                                 02S0321
*                    END;              /*                            */
*                  ELSE                /*                            */
*                    IF SCANARY(XCNT,ONE) = TWELV /*         @Z48MSTT*/
*                      THEN            /* THIS IS 12 LPI REQUEST.    */
         B     @RC00313                                         02S0323
@RF00313 LR    @05,XCNT                                         02S0323
         SLA   @05,2                                            02S0323
         SLR   @15,@15                                          02S0323
         IC    @15,SCANARY-4(@05,BUFAD)                         02S0323
         CH    @15,@CH00035                                     02S0323
         BNE   @RF00323                                         02S0323
*                        DO;           /* SET 12 LPI INDICATORS.     */
*                          IF ZCNT = ZERO /*                 @Z48MSTT*/
*                            THEN      /* THIS IS 12 LPI FILL REQUEST*/
         LTR   ZCNT,ZCNT                                        02S0325
         BNZ   @RF00325                                         02S0325
*                              ZCNT =  /* COMPUTE REMAINING FCB BYTES*/
*                               FCBSIZE / TWO;/*             @Z48MSTT*/
         LH    @00,FCBSIZE(,BUFAD)                              02S0326
         SRDA  @00,32                                           02S0326
         D     @00,@CF00057                                     02S0326
         LR    ZCNT,@01                                         02S0326
*                            ELSE;     /* ZCNT CONTAINS LINE COUNT.  */
@RF00325 DS    0H                                               02S0328
*                          FCBSIZE = FCBSIZE /* ADJ SIZE FOR @Z48MSTT*/
*                           -ZCNT*TWO; /*  THIS INCREMENT.   @Z48MSTT*/
         LR    @05,ZCNT                                         02S0328
         ALR   @05,@05                                          02S0328
         LCR   @05,@05                                          02S0328
         AH    @05,FCBSIZE(,BUFAD)                              02S0328
         STH   @05,FCBSIZE(,BUFAD)                              02S0328
*                          DO          /* SET INDICATORS     @Z48MSTT*/
*                           YCNT = ONE /*  AS PER REQUST.    @Z48MSTT*/
*                           TO ZCNT;   /*                    @Z48MSTT*/
         LA    YCNT,1                                           02S0329
         B     @DE00329                                         02S0329
@DL00329 DS    0H                                               02S0330
*                            FLPI12(FCNT + YCNT) = ONNER; /* @Z48MSTT*/
         LR    @15,FCNT                                         02S0330
         ALR   @15,YCNT                                         02S0330
         ALR   @15,BUFAD                                        02S0330
         OI    FLPI12-1(@15),B'00110000'                        02S0330
*                          END;        /*                    @Z48MSTT*/
         AH    YCNT,@CH00060                                    02S0331
@DE00329 CR    YCNT,ZCNT                                        02S0331
         BNH   @DL00329                                         02S0331
*                          LPI12 = LPI12 + ZCNT;/* UPDATE 12 LPI CNT.*/
         SLR   @05,@05                                          02S0332
         IC    @05,LPI12(,BUFAD)                                02S0332
         ALR   @05,ZCNT                                         02S0332
         STC   @05,LPI12(,BUFAD)                                02S0332
*                        END;          /* END 12 LPI PROCESSING.     */
*                      ELSE            /* NOT 6, 8, OR 12.   @Z48MSTT*/
*                        FMTERR = ON;  /* REMEMBER ERROR.    @Z48MSTT*/
         B     @RC00323                                         02S0334
@RF00323 OI    FMTERR(BUFAD),B'00001000'                        02S0334
*            FCNT = FCNT + ZCNT;       /* UPDATE FCB LINE COUNTER.   */
@RC00323 DS    0H                                               02S0335
@RC00313 DS    0H                                               02S0335
@RC00306 ALR   FCNT,ZCNT                                        02S0335
*          END;                        /* END LPI INSERT.            */
         AH    XCNT,@CH00060                                    02S0336
@DE00304 SLR   @05,@05                                          02S0336
         ICM   @05,3,SCNT(BUFAD)                                02S0336
         BCTR  @05,0                                            02S0336
         CR    XCNT,@05                                         02S0336
         BNH   @DL00304                                         02S0336
@DC00304 DS    0H                                               02S0337
*          IF FMTERR = ON              /* TEST FOR ANY ERROR.        */
*            THEN                      /* CREATE A MESSAGE.          */
         TM    FMTERR(BUFAD),B'00001000'                        02S0337
         BNO   @RF00337                                         02S0337
*              DO;                     /***********IEBA14I************/
*                MSGN = IEBA14I;       /* INVALID PARM MESSAGE.      */
         MVI   MSGN(BUFAD),X'0E'                                02S0339
*                EDITDATA(ONE)=        /* SET ADDR OF KEYWORD        */
*                 ADDR(LPI);           /*  FOR MESSAGE.              */
         LA    @05,@CC00839                                     02S0340
         STCM  @05,7,EDITDATA(BUFAD)                            02S0340
*                EDITLEN(ONE) =        /* SET LENGTH OF KEYWORD      */
*                 LENGTH(LPI);         /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'03'                             02S0341
*                CALL IEBIMSGS;        /* PRINT MESSAGE.             */
         L     @15,@CV00037                                     02S0342
         BALR  @14,@15                                          02S0342
*                INHIBITW = ON;        /* PREVENT LIBRARY ACCESS.    */
*                FMTERR = OFF;         /* RESET ERROR SWITCH.        */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0344
         NI    FMTERR(BUFAD),B'11110111'                        02S0344
*              END;                    /******************************/
*            ELSE;                     /*                            */
@RF00337 DS    0H                                               02S0347
*        END;                          /* FCB BUILD COMPLETE.        */
*                ELSE;                 /* VALIDATE THE FCB.  @Z48MSTT*/
@RF00300 DS    0H                                               01S0349
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL VALIDATE THAT THE FCB IMAGE IS WITHIN THE       *
**  RANGE OF THE FORM SIZE REQUESTED AND THAT THE IMAGE ENDS ON       *
**  A HALF INCH BOUNDARY.                                             *
**                                                                    *
**********************************************************************/
*                                                               02S0349
*        LPI6 =                        /* SET REMAINDER AT 6 @Z48MSTT*/
*           FCBSIZE/FOUR + LPI6;       /*  LINES PER INCH.   @Z48MSTT*/
         LH    @05,FCBSIZE(,BUFAD)                              02S0349
         LR    @00,@05                                          02S0349
         SRDA  @00,32                                           02S0349
         D     @00,@CF00050                                     02S0349
         SLR   @00,@00                                          02S0349
         IC    @00,LPI6(,BUFAD)                                 02S0349
         ALR   @01,@00                                          02S0349
         STC   @01,LPI6(,BUFAD)                                 02S0349
*        MODCNT = LPI6 + LPI8 + LPI12  /* SET MODULE COUNT   @Z48MSTT*/
*                      +               /*  TO LENGTH OF      @Z48MSTT*/
*                   MARGINS;           /*    FCB.            @Z48MSTT*/
         SLR   @00,@00                                          02S0350
         IC    @00,LPI8(,BUFAD)                                 02S0350
         ALR   @01,@00                                          02S0350
         SLR   @00,@00                                          02S0350
         IC    @00,LPI12(,BUFAD)                                02S0350
         ALR   @01,@00                                          02S0350
         AH    @01,@CH00185                                     02S0350
         STH   @01,MODCNT(,BUFAD)                               02S0350
*        FCBCLR = FCBCLR && FCBCLR;    /* CREATE A ZEROED AREA.      */
         XC    FCBCLR(144,BUFAD),FCBCLR(BUFAD)                  02S0351
*        IF FCBSIZE < ZERO             /* CHECK FOR FORM ORUN@Z48MSTT*/
*         × FCNT > FCBMAX              /*                            */
*          THEN                        /* MODULE TOO BIG.            */
         LTR   @05,@05                                          02S0352
         BM    @RT00352                                         02S0352
         CH    FCNT,@CH00236                                    02S0352
         BNH   @RF00352                                         02S0352
@RT00352 DS    0H                                               02S0353
*            DO;                       /*                            */
*              MSGN = IEBA07I;         /* GET A MESSAGE.             */
         MVI   MSGN(BUFAD),X'07'                                02S0354
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0355
         BALR  @14,@15                                          02S0355
*              FMTERR = ON;            /* REMEMBER ERROR.            */
*              INHIBITW = ON;          /* DO NOT UPDATE LIBRARY.     */
         OI    FMTERR(BUFAD),B'01001000'                        02S0357
*            END;                      /*                            */
*          ELSE;                       /* NOT TOO BIG.               */
@RF00352 DS    0H                                               02S0360
*        IF FCBSIZE // FOUR ^= ZERO    /* CHECK BOUNDARIES.  @Z48MSTT*/
*          THEN                        /* NOT SO GOOD.               */
         LH    @00,FCBSIZE(,BUFAD)                              02S0360
         SRDA  @00,32                                           02S0360
         D     @00,@CF00050                                     02S0360
         LTR   @00,@00                                          02S0360
         BZ    @RF00360                                         02S0360
*            DO;                       /*                            */
*              MSGN = IEBA11I;         /* GET A MESSAGE.             */
         MVI   MSGN(BUFAD),X'0B'                                02S0362
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0363
         BALR  @14,@15                                          02S0363
*              FMTERR = ON;            /* REMEMBER ERROR.            */
*              INHIBITW = ON;          /* DO NOT UPDATE LIBRARY.     */
         OI    FMTERR(BUFAD),B'01001000'                        02S0365
*            END;                      /*                            */
*          ELSE;                       /* GOOD HALF INCH BOUNDARIES. */
@RF00360 DS    0H                                               02S0368
*        IF MODBOD(MODCNT-TWO:FCBMAX)  /* CHECK FOR DATA BEYOND FORM.*/
*           ^= FCBCLR                  /*                            */
*          THEN                        /* HAVE SOME DATA, NOT GOOD.  */
         SLR   @15,@15                                          02S0368
         ICM   @15,3,MODCNT(BUFAD)                              02S0368
         LA    @14,146                                          02S0368
         SLR   @14,@15                                          02S0368
         ALR   @15,BUFAD                                        02S0368
         EX    @14,@SC01878                                     02S0368
         BE    @RF00368                                         02S0368
*            DO;                       /*                            */
*              MSGN = IEBA05I;         /* GET A MESSAGE.             */
         MVI   MSGN(BUFAD),X'05'                                02S0370
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0371
         BALR  @14,@15                                          02S0371
*              INHIBITW = ON;          /* DO NOT UPDATE LIBRARY.     */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0372
*            END;                      /*                            */
*          ELSE;                       /* NO DATA, GOOD MARGINS.     */
@RF00368 DS    0H                                               02S0375
*              IF INHIBITW = ON        /* CHECK FOR ANY ERROR.       */
*                THEN                  /*                            */
         TM    INHIBITW(BUFAD),B'01000000'                      01S0375
         BNO   @RF00375                                         01S0375
*                  RETSAVE =           /* SET RETURN CODE FOR THIS   */
*                   MAX(RETSAVE,RC8);  /*  OPERATION SO FAR.         */
         SLR   @15,@15                                          01S0376
         IC    @15,RETSAVE(,BUFAD)                              01S0376
         LA    @14,8                                            01S0376
         CR    @15,@14                                          01S0376
         BNL   *+6
         LR    @15,@14                                          01S0376
         STC   @15,RETSAVE(,BUFAD)                              01S0376
*                ELSE;                 /*                            */
@RF00375 DS    0H                                               01S0378
*            END;                      /*                            */
*          ELSE;                       /******************************/
@RF00284 DS    0H                                               01S0380
*        IF NOKEY = ON                 /* CHECK FOR NULL OPERANDS.   */
*          THEN                        /*                            */
         TM    NOKEY(BUFAD),B'01000000'                         01S0380
         BNO   @RF00380                                         01S0380
*            READMOD = ON;             /* SET READ AND PRINT ONLY.   */
         OI    READMOD(BUFAD),B'00000001'                       01S0381
*          ELSE;                       /*                            */
@RF00380 DS    0H                                               01S0383
*        GEN REFS(SAVE1)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE1+BACK(,BUFAD)); /*                            */
         L  @13,SAVE1+BACK(,BUFAD)
*END FCB;                              /* RETURN TO CALLER.          */
@EL00003 DS    0H                                               01S0384
@EF00003 DS    0H                                               01S0384
@ER00003 LM    @14,@12,12(@13)                                  01S0384
         BR    @14                                              01S0384
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL MODIFY EXISTING, OR CREATE NEW, TRANSLATE       *
**  TABLES.                                                           *
**                                                                    *
**********************************************************************/
*TABLE:                                                         01S0385
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0385
TABLE    STM   @14,@12,12(@13)                                  01S0385
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        BPREFX = XTB1;                /* SET TRANSLATE TABLE PREFIX.*/
         MVC   BPREFX(4,BUFAD),@CC00813                         01S0387
*        OPINPRG = ON;                 /* SET OPERATION IN PROGRESS. */
         OI    OPINPRG(BUFAD),B'00000010'                       01S0388
*        IF SCANINP = ON               /* COULD BE MORE DATA.        */
*          THEN                        /*                            */
         TM    SCANINP(BUFAD),B'01000000'                       01S0389
         BNO   @RF00389                                         01S0389
*            DO;                       /* INITIALIZE BUFFER.         */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL EITHER READ IN AN INCLUDE MODULE OR,            *
**  INITIALIZE A DUMMY TRANSLATE TABLE TO BE MODIFIED.                *
**                                                                    *
**********************************************************************/
*                                                               02S0391
*        IF INCLSW = ON                /* CHECK FOR INCLUDE.         */
*          THEN                        /*                            */
         TM    INCLSW(BUFAD),B'00100000'                        02S0391
         BNO   @RF00391                                         02S0391
*            DO;                       /* BRING IN MODULE TO UPDATE. */
*              IF DELSET = ON          /*CHECK FOR ERROR KEYWORD.    */
*                THEN                  /* DELSEG NOT ALLOWED.        */
         TM    DELSET(BUFAD),B'00100000'                        02S0393
         BNO   @RF00393                                         02S0393
*                  DO;                 /*                            */
*                    EDITDATA(ONE)     /* SET DATA ADDRESS FOR MSG.  */
*                     = ADDR(DELSEG);  /*                            */
         LA    @15,@CC00843                                     02S0395
         STCM  @15,7,EDITDATA(BUFAD)                            02S0395
*                    EDITLEN(ONE)      /* SET LENGTH ALSO.           */
*                     = LENGTH(DELSEG);                         02S0396
         MVI   EDITLEN(BUFAD),X'06'                             02S0396
*                    MSGN = IEBA23I;   /* EXCLUSIVE KEYWORD.         */
         MVI   MSGN(BUFAD),X'17'                                02S0397
*                    CALL IEBIMSGS;    /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0398
         BALR  @14,@15                                          02S0398
*                    INHIBITW = ON;    /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0399
*                  END;                /*                            */
*                ELSE;                 /* NO DELSEG SPECIFIED.       */
@RF00393 DS    0H                                               02S0402
*              IF INHIBITR = OFF       /* CHECK FOR READ PREVENTED.  */
*                THEN                  /*                            */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0402
         BNZ   @RF00402                                         02S0402
*                  DO;                 /*                            */
*                    BSUFIX = INCLNAME;/* PREPARE BLDL.              */
         MVC   BSUFIX(4,BUFAD),INCLNAME(BUFAD)                  02S0404
*                    CALL BLDL;        /* FIND THE MODULE.           */
         BAL   @14,BLDL                                         02S0405
*                  END;                /*                            */
*                ELSE;                 /*                            */
@RF00402 DS    0H                                               02S0408
*              IF INHIBITR = OFF       /*                            */
*                THEN                  /* BLDL MUST HAVE FOUND IT.   */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0408
         BNZ   @RF00408                                         02S0408
*                  CALL READLIB;       /* BRING MODULE INTO BUFFER.  */
         BAL   @14,READLIB                                      02S0409
*                ELSE                  /* MUST HAVE HAD BLDL ERROR.  */
*                  DO;                                          02S0410
         B     @RC00408                                         02S0410
@RF00408 DS    0H                                               02S0411
*                    INHIBITW = ON;                             02S0411
*                  INHIBITP = ON;      /* CAN DO NO PRINTING.        */
         OI    INHIBITW(BUFAD),B'01010000'                      02S0412
*                END;                                           02S0413
*            END;                      /*                            */
*          ELSE                        /* MUST BUILD FROM SCRATCH.   */
*            DO;                       /*                            */
         B     @RC00391                                         02S0415
@RF00391 DS    0H                                               02S0416
*              MODBOD(ONE) = ALBIT;    /* FILL ENTIRE TRANSLATE TABLE*/
         MVI   MODBOD(BUFAD),X'FF'                              02S0416
*              MVC(MODBOD(TWO:TABEND), /*  WITH (FF) WHICH IS AN     */
*               MODBOD(ONE));          /*  UNPRINTABLE CHARACTER.    */
         MVC   MODBOD+1(255,BUFAD),MODBOD(BUFAD)                02S0417
*              MODRSVD = ZERO;         /* INSURE RESERVED BYTES ZERO.*/
         SLR   @15,@15                                          02S0418
         STH   @15,MODRSVD(,BUFAD)                              02S0418
*              MODCNT = TBLSIZE;       /* SET MODULE LENGTH.         */
         MVC   MODCNT(2,BUFAD),@CH00757                         02S0419
*                                      /* CLEAR CGMID AREA.          */
*              CGMIDALL = CGMIDALL && CGMIDALL;                 02S0420
         XC    CGMIDALL(8,BUFAD),CGMIDALL(BUFAD)                02S0420
*              CGMIDN(ONE) = GOTH;     /* STANDARD GOTHIC ID         */
         MVI   CGMIDN(BUFAD),X'82'                              02S0421
*              GRFMODS = BLANK;        /* NO GCM INDICATED.          */
         MVI   GRFMODS+1(BUFAD),C' '                            02S0422
         MVC   GRFMODS+2(14,BUFAD),GRFMODS+1(BUFAD)             02S0422
         MVI   GRFMODS(BUFAD),C' '                              02S0422
*            END;                      /*                            */
*              SCNT = ZERO;            /* RESET SCAN COUNT FOR LOC.  */
@RC00391 SLR   @15,@15                                          01S0424
         STH   @15,SCNT(,BUFAD)                                 01S0424
*              CALL IEBISCAN;          /* SCAN FOR KEYWORDS.         */
         L     @15,@CV00036                                     01S0425
         BALR  @14,@15                                          01S0425
*              IF LOCSET = ON          /* CHECK FOR LOC KEYWORD.     */
*                THEN                  /*                            */
         TM    LOCSET(BUFAD),B'00010000'                        01S0426
         BNO   @RF00426                                         01S0426
*                  DO;                 /* CHECK AND SET LOC PARMS.   */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT PROCESSES THE LOC PARAMETERS AND PLACES THE          *
**  INFORMATION DERIVED THEREFROM INTO THE TRANSLATE TABLE.           *
**                                                                    *
**********************************************************************/
*        CARDDATA(ONE:DIM(TBLREF))     /* CLEAR DUP REFERENCE ARRAY. */
*         = CARDDATA(ONE:DIM(TBLREF))                           02S0428
*          && CARDDATA(ONE:DIM(TBLREF));                        02S0428
         XC    CARDDATA(256,BUFAD),CARDDATA(BUFAD)              02S0428
*        DO                            /* SET TRANSLATE TABLE WITH   */
*         CNT = ONE                    /*  INFORMATION IN LOC PARMS.*/
*         TO SCNT - ONE;               /* SCNT HAS NO. OF PARM GRPS.*/
         LA    CNT,1                                            02S0429
         B     @DE00429                                         02S0429
@DL00429 DS    0H                                               02S0430
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL VERIFY THAT CHARACTER ARRANGMENT TABLE          *
**  REFERENCES HANE NOT BEEN DUPLICATED.                              *
**                                                                    *
**********************************************************************/
*                                                               03S0430
*        IF TBLREF(SCANARY(CNT,ONE) + ONE) = ALBIT              03S0430
*          THEN                        /* CHECK FOR DUPLICATE REF.   */
         LR    @03,CNT                                          03S0430
         SLA   @03,2                                            03S0430
         SLR   @15,@15                                          03S0430
         IC    @15,SCANARY-4(@03,BUFAD)                         03S0430
         ST    @15,@TF00001                                     03S0430
         ALR   @15,BUFAD                                        03S0430
         CLI   TBLREF+1822(@15),X'FF'                           03S0430
         BNE   @RF00430                                         03S0430
*            DO;                       /*                            */
*              MSGN = IEBA48I;         /* REQUEST DUP ERROR MESSAGE. */
         MVI   MSGN(BUFAD),X'30'                                03S0432
*              UNITS = SCANARY(CNT,ONE);/* MAKE XLOC PRINTABLE.      */
         MVC   UNITS(1,BUFAD),@TF00001+3                        03S0433
*              UNPK(CWORK(1:3),CWORK(2:3));/*                        */
         UNPK  CWORK(3,BUFAD),CWORK+1(2,BUFAD)                  03S0434
*              FWORK = FWORK & MSK0F;  /*                            */
         L     @03,FWORK(,BUFAD)                                03S0435
         N     @03,@CF00797                                     03S0435
         ST    @03,FWORK(,BUFAD)                                03S0435
*              TR(UWORK,TRTAB);        /*                            */
         TR    UWORK(2,BUFAD),TRTAB                             03S0436
*              EDITDATA(ONE)           /* SET                        */
*               = ADDR(UWORK);         /*  REFERENCE                 */
         LA    @03,UWORK(,BUFAD)                                03S0437
         STCM  @03,7,EDITDATA(BUFAD)                            03S0437
*              EDITLEN(ONE)            /*  FOR                       */
*               = LENGTH(UWORK);       /*  MESSAGE.                  */
         MVI   EDITLEN(BUFAD),X'02'                             03S0438
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S0439
         BALR  @14,@15                                          03S0439
*              INHIBITW = ON;          /* PREVENT LIBRARY UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      03S0440
*            END;                      /*                            */
*          ELSE                        /* NOT DUPLICATE, INDICATE.   */
*            TBLREF(SCANARY(CNT,ONE) + ONE) = ALBIT;            03S0442
         B     @RC00430                                         03S0442
@RF00430 LR    @03,CNT                                          03S0442
         SLA   @03,2                                            03S0442
         SLR   @01,@01                                          03S0442
         IC    @01,SCANARY-4(@03,BUFAD)                         03S0442
         ALR   @01,BUFAD                                        03S0442
         MVI   TBLREF+1822(@01),X'FF'                           03S0442
*          IF SCANARY(CNT,THREE) = ZERO                         02S0443
*            THEN                      /* CHECK FOR VALID 2ND PARM.  */
@RC00430 LR    @03,CNT                                          02S0443
         SLA   @03,2                                            02S0443
         SLR   @15,@15                                          02S0443
         IC    @15,SCANARY-2(@03,BUFAD)                         02S0443
         CH    @15,@CH00462                                     02S0443
         BNE   @RF00443                                         02S0443
*              IF SCANARY(CNT,TWO) = ALBIT                      02S0444
*               × SCANARY(CNT,TWO) =< SXBIT                     02S0444
*                THEN                  /* 2ND PARM VALID, 3RD PARM 0.*/
         SLR   @15,@15                                          02S0444
         IC    @15,SCANARY-3(@03,BUFAD)                         02S0444
         CH    @15,@CH00851                                     02S0444
         BE    @RT00444                                         02S0444
         CH    @15,@CH00853                                     02S0444
         BH    @RF00444                                         02S0444
@RT00444 DS    0H                                               02S0445
*                  MODBOD(SCANARY(CNT,ONE)+ONE)                 02S0445
*                   = SCANARY(CNT,TWO);/* SET SECOND PARM IN TABLE.  */
         LR    @03,CNT                                          02S0445
         SLA   @03,2                                            02S0445
         SLR   @01,@01                                          02S0445
         IC    @01,SCANARY-4(@03,BUFAD)                         02S0445
         SLR   @00,@00                                          02S0445
         IC    @00,SCANARY-3(@03,BUFAD)                         02S0445
         STC   @00,MODBOD(@01,BUFAD)                            02S0445
*                ELSE                  /*                            */
*                  FMTERR = ON;        /* SECOND PARAMETER INVALID.  */
         B     @RC00444                                         02S0446
@RF00444 OI    FMTERR(BUFAD),B'00001000'                        02S0446
*            ELSE                      /* CHECK FOR VALID 3RD PARM.  */
*              IF SCANARY(CNT,THREE) < FOUR                     02S0447
*               & SCANARY(CNT,TWO) =< SXBIT                     02S0447
*                THEN                  /* COMBINE SECOND AND THIRD   */
         B     @RC00443                                         02S0447
@RF00443 LR    @03,CNT                                          02S0447
         SLA   @03,2                                            02S0447
         SLR   @15,@15                                          02S0447
         IC    @15,SCANARY-2(@03,BUFAD)                         02S0447
         CH    @15,@CH00050                                     02S0447
         BNL   @RF00447                                         02S0447
         SLR   @15,@15                                          02S0447
         IC    @15,SCANARY-3(@03,BUFAD)                         02S0447
         CH    @15,@CH00853                                     02S0447
         BH    @RF00447                                         02S0447
*                  DO;                 /*  PARAMETERS AND SET IN TBL.*/
*                    SLL(SCANARY(CNT,THREE),SIX);               02S0449
         SLR   @15,@15                                          02S0449
         IC    @15,SCANARY-2(@03,BUFAD)                         02S0449
         SLL   @15,6                                            02S0449
         STC   @15,SCANARY-2(@03,BUFAD)                         02S0449
*                    MODBOD(SCANARY(CNT,ONE)+ONE)               02S0450
*                     = SCANARY(CNT,TWO)                        02S0450
*                      × SCANARY(CNT,THREE);                    02S0450
         SLR   @15,@15                                          02S0450
         IC    @15,SCANARY-4(@03,BUFAD)                         02S0450
         SLR   @14,@14                                          02S0450
         IC    @14,SCANARY-3(@03,BUFAD)                         02S0450
         SLR   @07,@07                                          02S0450
         IC    @07,SCANARY-2(@03,BUFAD)                         02S0450
         OR    @14,@07                                          02S0450
         STC   @14,MODBOD(@15,BUFAD)                            02S0450
*                    IF MODBOD(SCANARY(CNT,ONE)+ONE) = ALBIT    02S0451
*                      THEN            /* CHECK IF COMBINATION       */
         ALR   @15,BUFAD                                        02S0451
         CLI   MODBOD(@15),X'FF'                                02S0451
         BNE   @RF00451                                         02S0451
*                        FMTERR1 = ON; /*  CREATED UNPRINTABLE CHAR. */
         OI    FMTERR1(BUFAD),B'00000100'                       02S0452
*                      ELSE;           /* GOOD CHARACTER.            */
@RF00451 DS    0H                                               02S0454
*                  END;                /*                            */
*                ELSE                  /*                            */
*                  FMTERR = ON;        /* THIRD PARAMETER INVALID.   */
         B     @RC00447                                         02S0455
@RF00447 OI    FMTERR(BUFAD),B'00001000'                        02S0455
*        END;                          /* END OF TRANSLATE TABLE LOOP*/
@RC00447 DS    0H                                               02S0456
@RC00443 AH    CNT,@CH00060                                     02S0456
@DE00429 SLR   @03,@03                                          02S0456
         ICM   @03,3,SCNT(BUFAD)                                02S0456
         BCTR  @03,0                                            02S0456
         CR    CNT,@03                                          02S0456
         BNH   @DL00429                                         02S0456
*        IF FMTERR = ON                /* CHECK FOR PARAMETER ERROR. */
*          THEN                        /*                            */
         TM    FMTERR(BUFAD),B'00001000'                        02S0457
         BNO   @RF00457                                         02S0457
*            DO;                       /*                            */
*              MSGN = IEBA14I;         /* INVALID PARAMETER MESSAGE. */
         MVI   MSGN(BUFAD),X'0E'                                02S0459
*              EDITDATA(ONE)=ADDR(LOC);/* SET ADDRESS AND LENGTH OF  */
         LA    @15,@CC00841                                     02S0460
         STCM  @15,7,EDITDATA(BUFAD)                            02S0460
*              EDITLEN(ONE)=LENGTH(LOC);/* KEYWORD TO BE PRINTED.    */
         MVI   EDITLEN(BUFAD),X'03'                             02S0461
*              CALL IEBIMSGS;          /* PRINT THE MESSAGE.         */
         L     @15,@CV00037                                     02S0462
         BALR  @14,@15                                          02S0462
*              INHIBITW = ON;          /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0463
*                                      /* SET RETURN CODE 8 THIS OP. */
*              RETSAVE = MAX(RETSAVE,RC8);                      02S0464
         SLR   @15,@15                                          02S0464
         IC    @15,RETSAVE(,BUFAD)                              02S0464
         LA    @14,8                                            02S0464
         CR    @15,@14                                          02S0464
         BNL   *+6
         LR    @15,@14                                          02S0464
         STC   @15,RETSAVE(,BUFAD)                              02S0464
*            END;                      /******************************/
*          ELSE;                       /*                            */
@RF00457 DS    0H                                               02S0467
*        IF FMTERR1 = ON               /* CHECK FOR GENERATION OF AN */
*          THEN                        /*  UNPRINTABLE CHARACTER.    */
         TM    FMTERR1(BUFAD),B'00000100'                       02S0467
         BNO   @RF00467                                         02S0467
*            DO;                       /*                            */
*              MSGN = IEBA06I;         /* WARNING MESSAGE.           */
         MVI   MSGN(BUFAD),X'06'                                02S0469
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0470
         BALR  @14,@15                                          02S0470
*            END;                      /******************************/
*          ELSE;                       /*                            */
@RF00467 DS    0H                                               02S0473
*        FMTERR = OFF;                 /* RESET                      */
*        FMTERR1 = OFF;                /*  ERROR CONDITIONS.         */
         NI    FMTERR(BUFAD),B'11110011'                        02S0474
*                  END;                /*                            */
*                ELSE                  /* NO LOC SPECIFIED.          */
*                  IF INCLSW = OFF     /* CHECK FOR INCLUDED TABLE.  */
*                    THEN              /*  NONE MEANS ENTIRE TABLE   */
         B     @RC00426                                         01S0476
@RF00426 TM    INCLSW(BUFAD),B'00100000'                        01S0476
         BNZ   @RF00476                                         01S0476
*                      DO;             /*   HAS UNPRINTABLE CHARS.   */
*                        MSGN=IEBA25I; /* INSUFFICIENT KEYWORDS.     */
         MVI   MSGN(BUFAD),X'19'                                01S0478
*                        CALL IEBIMSGS;/* PRINT IT.                  */
         L     @15,@CV00037                                     01S0479
         BALR  @14,@15                                          01S0479
*                        INHIBITW = ON;/* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      01S0480
*                      END;            /* END MESSAGE BUILD.         */
*                    ELSE;             /*                            */
@RF00476 DS    0H                                               01S0483
*            END;                      /*                            */
*          ELSE;                       /* NO KEYWORDS, PRINT ONLY.   */
@RF00389 DS    0H                                               01S0485
*        IF INHIBITW = ON              /* CHECK FOR INHIBITIVE ERRORS*/
*          THEN                        /*                            */
@RC00389 TM    INHIBITW(BUFAD),B'01000000'                      01S0485
         BNO   @RF00485                                         01S0485
*            RETSAVE = MAX(RETSAVE,RC8);/* SET RC = 8 THIS OPERATION.*/
         SLR   @15,@15                                          01S0486
         IC    @15,RETSAVE(,BUFAD)                              01S0486
         LA    @14,8                                            01S0486
         CR    @15,@14                                          01S0486
         BNL   *+6
         LR    @15,@14                                          01S0486
         STC   @15,RETSAVE(,BUFAD)                              01S0486
*        IF NOKEY = ON                 /* CHECK FOR NULL OPERANDS.   */
*          THEN                        /*                            */
@RF00485 TM    NOKEY(BUFAD),B'01000000'                         01S0487
         BNO   @RF00487                                         01S0487
*            READMOD = ON;             /* SET READ AND PRINT ONLY.   */
         OI    READMOD(BUFAD),B'00000001'                       01S0488
*          ELSE;                       /*                            */
@RF00487 DS    0H                                               01S0490
*        GEN REFS(SAVE1)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE1+BACK(,BUFAD)); /*                            */
         L  @13,SAVE1+BACK(,BUFAD)
*  END TABLE;                          /* RETURN TO CALLER.          */
@EL00004 DS    0H                                               01S0491
@EF00004 DS    0H                                               01S0491
@ER00004 LM    @14,@12,12(@13)                                  01S0491
         BR    @14                                              01S0491
         EJECT
*/*********************************************************************
**                                                                    *
**  IF REQUESTED THIS SECTION WILL FORMAT AND PRINT THE TRANSLATE     *
**  TABLE.                                                            *
**                                                                    *
**********************************************************************/
*TABLPRT:                                                       01S0492
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0492
TABLPRT  STM   @14,@12,12(@13)                                  01S0492
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        NEXT = ONE;                   /* INITIALIZE MSG QUEUE CNT.  */
         LA    @15,1                                            01S0494
         STH   @15,NEXT(,BUFAD)                                 01S0494
*        PRTQELEM = SKIP;              /* SET SKIP.                  */
         LA    @14,121                                          01S0495
         LR    @01,@15                                          01S0495
         MR    @00,@14                                          01S0495
         AL    @01,@CF01883                                     01S0495
         LA    @07,MSGSAVE-10648(@01,BUFAD)                     01S0495
         MVI   PRTQELEM+1(@07),C' '                             01S0495
         MVC   PRTQELEM+2(119,@07),PRTQELEM+1(@07)              01S0495
         MVI   PRTQELEM(@07),C'1'                               01S0495
*        TBN = BNAME;                  /* 1ST LINE PRINTS MEMBER NAME*/
         MVC   TBN(8,@07),BNAME(BUFAD)                          01S0496
*        NEXT = NEXT + ONE;            /* INCREMENT MSG QUEUE ADDR.  */
         LR    @07,@15                                          01S0497
         ALR   @07,@15                                          01S0497
         STH   @07,NEXT(,BUFAD)                                 01S0497
*        PRTQELEM = PRTXHDG;           /* SET XLATE HDR IN QUEUE.    */
         MR    @06,@14                                          01S0498
         AL    @07,@CF01883                                     01S0498
         LA    @14,MSGSAVE-10648(@07,BUFAD)                     01S0498
         MVC   PRTQELEM(121,@14),PRTXHDG                        01S0498
*        DO                            /* START PRINT TABLE LOOP.    */
*         YCNT = ONE                   /*                            */
*         TO SIXTN;                    /* PRINT SIXTEEN LINES.       */
         LR    YCNT,@15                                         01S0499
@DL00499 DS    0H                                               01S0500
*          NEXT = NEXT + ONE;          /* INCR MESSAGE QUEUE.        */
         LA    @04,1                                            01S0500
         SLR   @15,@15                                          01S0500
         ICM   @15,3,NEXT(BUFAD)                                01S0500
         ALR   @15,@04                                          01S0500
         STH   @15,NEXT(,BUFAD)                                 01S0500
*          CONTROL = DOUBL;            /* SET DOUBLE SPACE.          */
         MH    @15,@CH00190                                     01S0501
         AL    @15,@CF01883                                     01S0501
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     01S0501
         MVI   CONTROL(@15),C'0'                                01S0501
*          XHEAD = XHCON;              /* SET LINE HEADER.           */
         MVI   XHEAD+4(@15),C' '                                01S0502
         MVC   XHEAD+5(115,@15),XHEAD+4(@15)                    01S0502
         MVC   XHEAD(4,@15),@CC00821                            01S0502
*          TENS = TRTAB(YCNT);         /* SET TENS POSITION OF HDR.  */
         LA    @14,TRTAB-1(YCNT)                                01S0503
         MVC   TENS(1,@15),0(@14)                               01S0503
*          DO                          /* START PRINT LINE LOOP.     */
*           XCNT = ONE                 /*                            */
*           TO SIXTN;                  /* SET 16 ENTRIES PER LINE.   */
         LR    XCNT,@04                                         01S0504
@DL00504 DS    0H                                               01S0505
*            IF XPOS(YCNT,XCNT)        /* IS THIS A                  */
*               = ALBIT                /* NON-PRINTABLE CHARACTER?   */
*              THEN                    /*                            */
         LR    @04,YCNT                                         01S0505
         SLA   @04,4                                            01S0505
         ALR   @04,XCNT                                         01S0505
         ALR   @04,BUFAD                                        01S0505
         CLI   XPOS-17(@04),X'FF'                               01S0505
         BNE   @RF00505                                         01S0505
*                CPOS(XCNT) = SPLAT;   /* YES, SET ASTERISK.         */
         LR    @04,XCNT                                         01S0506
         MH    @04,@CH00118                                     01S0506
         SLR   @02,@02                                          01S0506
         ICM   @02,3,NEXT(BUFAD)                                01S0506
         MH    @02,@CH00190                                     01S0506
         AL    @02,@CF01883                                     01S0506
         LA    @02,MSGSAVE-10648(@02,BUFAD)                     01S0506
         ALR   @02,@04                                          01S0506
         MVI   CPOS-6(@02),C' '                                 01S0506
         MVI   CPOS-7(@02),C'*'                                 01S0506
*              ELSE                    /* IT IS PRINTABLE.           */
*                DO;                   /* TRANSLATE ONE POSITION.    */
         B     @RC00505                                         01S0507
@RF00505 DS    0H                                               01S0508
*                  RGMT = XPOS(YCNT,XCNT);/* GET ONE BYTE FROM TABLE.*/
         LR    @04,YCNT                                         01S0508
         SLA   @04,4                                            01S0508
         ALR   @04,XCNT                                         01S0508
         SLR   @15,@15                                          01S0508
         IC    @15,XPOS-17(@04,BUFAD)                           01S0508
         LR    RGMT,@15                                         01S0508
*                  SRL(RGMT,SIX);      /* TWO HI BITS = CGMID ORDER. */
         SRL   RGMT,6                                           01S0509
*                  CGMO(XCNT) = TRTAB(RGMT+ONE);/* CGM ORDER TO PRINT*/
         LR    @04,XCNT                                         01S0510
         MH    @04,@CH00118                                     01S0510
         SLR   @14,@14                                          01S0510
         ICM   @14,3,NEXT(BUFAD)                                01S0510
         MH    @14,@CH00190                                     01S0510
         AL    @14,@CF01883                                     01S0510
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     01S0510
         ST    @04,@TF00001                                     01S0510
         ALR   @04,@14                                          01S0510
         LA    @01,TRTAB(RGMT)                                  01S0510
         MVC   CGMO-7(1,@04),0(@01)                             01S0510
*                  RGMT = XPOS(YCNT,XCNT);/* GET SAME BYTE AGAIN.    */
         LR    RGMT,@15                                         01S0511
*                  UNITS = RGMT & SXBIT;/* STRIP TWO HI BITS OFF.    */
         LA    @04,63                                           01S0512
         NR    @04,RGMT                                         01S0512
         STC   @04,UNITS(,BUFAD)                                01S0512
*                  UNPK(CWORK(1:3),CWORK(2:3));/* CONVERT TO EBCDIC. */
         UNPK  CWORK(3,BUFAD),CWORK+1(2,BUFAD)                  01S0513
*                  FWORK = FWORK & MSK0F;/* MASK OUT ZONES.          */
         L     @04,FWORK(,BUFAD)                                01S0514
         N     @04,@CF00797                                     01S0514
         ST    @04,FWORK(,BUFAD)                                01S0514
*                  TR(UWORK,TRTAB);    /* MAKE ALL CHARS PRINTABLE.  */
         TR    UWORK(2,BUFAD),TRTAB                             01S0515
*                  CPOS(XCNT) = CWORK; /* SET CGM REFERENCE TO PRINT.*/
         AL    @14,@TF00001                                     01S0516
         MVC   CPOS-7(2,@14),CWORK(BUFAD)                       01S0516
*                END;                  /* END ONE POSITION TRANSLATE.*/
*          END;                        /* END PRINT LINE LOOP.       */
@RC00505 AH    XCNT,@CH00060                                    01S0518
         CH    XCNT,@CH00116                                    01S0518
         BNH   @DL00504                                         01S0518
*        END;                          /* END PRINT TABLE LOOP.      */
         AH    YCNT,@CH00060                                    01S0519
         CH    YCNT,@CH00116                                    01S0519
         BNH   @DL00499                                         01S0519
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL FORMAT AND PRINT THE TRAILER INFORMATION OF     *
**  THE TRANSLATE TABLE.                                              *
**                                                                    *
**********************************************************************/
*        NEXT = NEXT + ONE;            /* INCREMENT MESSAGE QUEUE.   */
         LA    @15,1                                            01S0520
         SLR   @14,@14                                          01S0520
         ICM   @14,3,NEXT(BUFAD)                                01S0520
         ALR   @14,@15                                          01S0520
         STH   @14,NEXT(,BUFAD)                                 01S0520
*        DISC1 = CGMOLINE;             /* SET CGM ORDER PRINT LINE.  */
         LA    @07,121                                          01S0521
         LR    @01,@14                                          01S0521
         MR    @00,@07                                          01S0521
         AL    @01,@CF01883                                     01S0521
         LA    @06,MSGSAVE-10648(@01,BUFAD)                     01S0521
         MVI   DISC1+53(@06),C' '                               01S0521
         MVC   DISC1+54(66,@06),DISC1+53(@06)                   01S0521
         MVC   DISC1(53,@06),CGMOLINE                           01S0521
*        CONTROL = TRIPL;              /* SET TRIPLE SPACE.          */
         MVI   CONTROL(@06),C'-'                                01S0522
*        NEXT = NEXT + ONE;            /* INCRE MENT MESSAGE QUEUE.  */
         ALR   @14,@15                                          01S0523
         STH   @14,NEXT(,BUFAD)                                 01S0523
*        DISC1 = CGMILINE;             /* SET CGMID PRINT LINE.      */
         LR    @01,@14                                          01S0524
         MR    @00,@07                                          01S0524
         AL    @01,@CF01883                                     01S0524
         LA    @14,MSGSAVE-10648(@01,BUFAD)                     01S0524
         MVI   DISC1+53(@14),C' '                               01S0524
         MVC   DISC1+54(66,@14),DISC1+53(@14)                   01S0524
         MVC   DISC1(53,@14),CGMILINE                           01S0524
*        CONTROL = DOUBL;              /* SET DOUBLE SPACE.          */
         MVI   CONTROL(@14),C'0'                                01S0525
*        DO                            /* START CGMID EDIT LOOP.     */
*         CNT = ONE                    /*                            */
*         TO FOUR                      /* ONLY FOUR POSSIBLE CGMIDS. */
*         WHILE CGMIDN(CNT) ^= ZERO;   /* STOP AT INVALID ID         */
         LR    CNT,@15                                          01S0526
@DL00526 LR    @03,CNT                                          01S0526
         ALR   @03,@03                                          01S0526
         SLR   @15,@15                                          01S0526
         IC    @15,CGMIDN-2(@03,BUFAD)                          01S0526
         LTR   @15,@15                                          01S0526
         BZ    @DC00526                                         01S0526
*          UNITS = CGMIDN(CNT);        /* GET ONE CGMID.             */
         STC   @15,UNITS(,BUFAD)                                01S0527
*          UNPK(CWORK(1:3),CWORK(2:3));/* CONV TO EBCDIC.            */
         UNPK  CWORK(3,BUFAD),CWORK+1(2,BUFAD)                  01S0528
*          FWORK = FWORK & MSK0F;      /* MASK OUT ZONES.            */
         L     @03,FWORK(,BUFAD)                                01S0529
         N     @03,@CF00797                                     01S0529
         ST    @03,FWORK(,BUFAD)                                01S0529
*          TR(UWORK,TRTAB);            /* MAKE CHAR PRNTABLE         */
         TR    UWORK(2,BUFAD),TRTAB                             01S0530
*          CG(CNT) = CWORK;            /* SET TO PRINTLINE.          */
         LR    @03,CNT                                          01S0531
         SLA   @03,3                                            01S0531
         SLR   @15,@15                                          01S0531
         ICM   @15,3,NEXT(BUFAD)                                01S0531
         MH    @15,@CH00190                                     01S0531
         AL    @15,@CF01883                                     01S0531
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     01S0531
         ALR   @15,@03                                          01S0531
         MVC   CG-8(2,@15),CWORK(BUFAD)                         01S0531
*        END;                          /* END CGMID EDIT LOOP.       */
         AH    CNT,@CH00060                                     01S0532
         CH    CNT,@CH00050                                     01S0532
         BNH   @DL00526                                         01S0532
@DC00526 DS    0H                                               01S0533
*        NEXT = NEXT + ONE;            /* INCREMENT MESSAGE QUEUE.   */
         LA    @15,1                                            01S0533
         SLR   @14,@14                                          01S0533
         ICM   @14,3,NEXT(BUFAD)                                01S0533
         ALR   @14,@15                                          01S0533
         STH   @14,NEXT(,BUFAD)                                 01S0533
*        PRNTGCMR = GCMRLINE;          /* READY GRAPICS NAME LINE.   */
         MH    @14,@CH00190                                     01S0534
         AL    @14,@CF01883                                     01S0534
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     01S0534
         ALR   @14,@15                                          01S0534
         MVI   PRNTGCMR+47(@14),C' '                            01S0534
         MVC   PRNTGCMR+48(72,@14),PRNTGCMR+47(@14)             01S0534
         MVC   PRNTGCMR(47,@14),GCMRLINE                        01S0534
*        DO                            /* START GRAF NAME LOOP.      */
*         CNT = ONE                    /*                            */
*         TO FOUR                      /* ONLY FOUR GRAF NAMES.      */
*         WHILE GRAFMODN(CNT,ONE)      /* STOP AT 1ST NO NAME.       */
*                ^= BLANK;             /*                            */
         LR    CNT,@15                                          01S0535
@DL00535 LR    @03,CNT                                          01S0535
         SLA   @03,2                                            01S0535
         ST    @03,@TF00001                                     01S0535
         ALR   @03,BUFAD                                        01S0535
         CLI   GRAFMODN-4(@03),C' '                             01S0535
         BE    @DC00535                                         01S0535
*          GCMNAME(CNT) = GRAF;        /* SET PREFIX.                */
         LR    @03,CNT                                          01S0536
         MH    @03,@CH00035                                     01S0536
         SLR   @15,@15                                          01S0536
         ICM   @15,3,NEXT(BUFAD)                                01S0536
         MH    @15,@CH00190                                     01S0536
         AL    @15,@CF01883                                     01S0536
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     01S0536
         AH    @15,@CH00060                                     01S0536
         ST    @03,@TF00002                                     01S0536
         ALR   @03,@15                                          01S0536
         MVI   GCMNAME-8(@03),C' '                              01S0536
         MVC   GCMNAME-7(7,@03),GCMNAME-8(@03)                  01S0536
         MVC   GCMNAME-12(4,@03),@CC00811                       01S0536
*          SUF(CNT) = GRAFMODN(CNT);   /* SET SUFFIX.                */
         LR    @03,@15                                          01S0537
         AL    @03,@TF00002                                     01S0537
         LR    @01,BUFAD                                        01S0537
         AL    @01,@TF00001                                     01S0537
         MVC   SUF-12(4,@03),GRAFMODN-4(@01)                    01S0537
*                                      /* SET GRAF NAME FOR BLDL.    */
*          BNAME = GCMNAME(CNT,ONE:LENGTH(BNAME));              01S0538
         AL    @15,@TF00002                                     01S0538
         MVC   BNAME(8,BUFAD),GCMNAME-12(@15)                   01S0538
*          CALL BLDL;                  /* ISSUE BLDL.                */
         BAL   @14,BLDL                                         01S0539
*        END;                          /* END GRAF NAME LOOP.        */
         AH    CNT,@CH00060                                     01S0540
         CH    CNT,@CH00050                                     01S0540
         BNH   @DL00535                                         01S0540
@DC00535 DS    0H                                               01S0541
*        CONTROL = TRIPL;              /* SET TRIPLE SPACE.          */
         SLR   @15,@15                                          01S0541
         ICM   @15,3,NEXT(BUFAD)                                01S0541
         MH    @15,@CH00190                                     01S0541
         AL    @15,@CF01883                                     01S0541
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     01S0541
         MVI   CONTROL(@15),C'-'                                01S0541
*        CALL PRINTQ;                  /* PRINT QUEUE.               */
         BAL   @14,PRINTQ                                       01S0542
*        GEN REFS(SAVE2)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE2+BACK(,BUFAD)); /*                            */
         L  @13,SAVE2+BACK(,BUFAD)
*  END TABLPRT;                        /* RETURN TO CALLER.          */
@EL00005 DS    0H                                               01S0544
@EF00005 DS    0H                                               01S0544
@ER00005 LM    @14,@12,12(@13)                                  01S0544
         BR    @14                                              01S0544
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL MODIFY OR CREATE COPY MODIFICATION MODULES.     *
**  THE MODULES MAY BE CONSTRUCTED BY INCLUDING ANY PORTION OR ALL    *
**  OF AN EXISTING MODULE. SEGMENTS ARE THEN ADDED AS SPECIFIED ON    *
**  THE SUPPLIED CONTROL CARDS.                                       *
**                                                                    *
**********************************************************************/
*COPYMOD:                                                       01S0545
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0545
COPYMOD  STM   @14,@12,12(@13)                                  01S0545
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        BNAME = MOD1;                 /* SET GCM NAME PREFIX.       */
         MVI   BNAME+4(BUFAD),C' '                              01S0547
         MVC   BNAME+5(3,BUFAD),BNAME+4(BUFAD)                  01S0547
         MVC   BNAME(4,BUFAD),@CC00815                          01S0547
*        IF OPINPRG = OFF              /* CHECK HAVING BEEN HERE     */
*          THEN                        /*  BEFORE.                   */
         TM    OPINPRG(BUFAD),B'00000010'                       01S0548
         BNZ   @RF00548                                         01S0548
*            DO;                       /* CLEAR MODULE HEADER.       */
*              MODHEAD = MODHEAD && MODHEAD;                    01S0550
         XC    MODHEAD(8,BUFAD),MODHEAD(BUFAD)                  01S0550
*              OPINPRG = ON;           /* REMEMBER BEING HERE.       */
         OI    OPINPRG(BUFAD),B'00000010'                       01S0551
*              COPYSIZE = ZERO;        /* RESET SEGMENT COUNTER.     */
         SLR   COPYSIZE,COPYSIZE                                01S0552
*              IF INCLSW = ON          /* CHECK FOR INCLUDE OPTION.  */
*                THEN                  /* LOAD INCLUDE MODULE        */
         TM    INCLSW(BUFAD),B'00100000'                        01S0553
         BNO   @RF00553                                         01S0553
*                  DO;                 /*  AND COPY INTO BUFFER.     */
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL CAUSE THE INCLUDED COPY MODIFICATION            *
**  MODULE TO BE COPIED INTO THE BUFFER, EXCLUDING ANY SEGMENTS       *
**  SPECIFIED IN THE DELSEG KEYWORD OF THE PREVIOUS INCLUDE.          *
**                                                                    *
**********************************************************************/
*        INCLSW = OFF;                 /* RESET INCLUDE INDICATION.  */
         NI    INCLSW(BUFAD),B'11011111'                        02S0555
*        NOKEY = OFF;                  /* RESET PRINT ONLY REQUEST   */
         NI    NOKEY(BUFAD),B'10111111'                         02S0556
*        BSUFIX = INCLNAME;            /* SET NAME IN BLDL ENTRY.    */
         MVC   BSUFIX(4,BUFAD),INCLNAME(BUFAD)                  02S0557
*        IF DELSET = ON                /* CHECK FOR DELSEG KEYWORD.  */
*          THEN                        /* NEED TO LOAD MODULE.       */
         TM    DELSET(BUFAD),B'00100000'                        02S0558
         BNO   @RF00558                                         02S0558
*            DO;                       /*                            */
*              CALL LOADLIB;           /* LOAD A MODULE.             */
         BAL   @14,LOADLIB                                      02S0560
*              IF LOADFLAG = ALBIT     /* CHECK FOR MODULE LOADED.   */
*                THEN                  /*                            */
         CLI   LOADFLAG(BUFAD),X'FF'                            02S0561
         BNE   @RF00561                                         02S0561
*                  DO;                 /*                            */
*                    HCNT = ZERO;      /* INITIALIZE SEGMENT SIZE.   */
         SLR   HCNT,HCNT                                        02S0563
*                    FWORK = ZERO;     /* RESET WORK AREA.           */
         SLR   @02,@02                                          02S0564
         ST    @02,FWORK(,BUFAD)                                02S0564
*                    MODCNT = LMODCNT; /* GET MODULE SIZE.           */
         ICM   @02,7,LOADMOD(BUFAD)                             02S0565
         MVC   MODCNT(2,BUFAD),LMODCNT(@02)                     02S0565
*                    DO                /* START COPY OF INCLUDED     */
*                     CNT = ONE        /*  MODULE.                   */
*                     TO BIGNUM        /* COPY TO END OF MODULE      */
*                     WHILE CMODCNT > ZERO                      02S0566
*                         & LENGTH(MODBOD) => COPYSIZE;         02S0566
         LA    CNT,1                                            02S0566
@DL00566 SLR   @15,@15                                          02S0566
         CH    @15,CMODCNT(,BUFAD)                              02S0566
         BNL   @DC00566                                         02S0566
         CH    COPYSIZE,@CH00231                                02S0566
         BH    @DC00566                                         02S0566
*                      HCNT = LTNO + LENGTH(COPYLABL);/* GET SEG SIZE*/
         SLR   @14,@14                                          02S0567
         ICM   @14,7,LOADMOD(BUFAD)                             02S0567
         AL    @14,FWORK(,BUFAD)                                02S0567
         AH    @14,@CH00048                                     02S0567
         LA    HCNT,6                                           02S0567
         SLR   @06,@06                                          02S0567
         IC    @06,LTNO(,@14)                                   02S0567
         ALR   HCNT,@06                                         02S0567
*                      IF DEL(CNT) = ZERO                       02S0568
*                        THEN          /* DO NOT DELETE THIS SEGMENT.*/
         SLR   @06,@06                                          02S0568
         IC    @06,DEL+795(CNT,BUFAD)                           02S0568
         CR    @15,@06                                          02S0568
         BNE   @RF00568                                         02S0568
*                          DO;         /*                            */
*                            MODBOD(COPYSIZE+ONE:COPYSIZE+HCNT) 02S0570
*                             = CLOADSEG(ONE:HCNT);/* COPY SEGMENT.  */
         LR    @06,BUFAD                                        02S0570
         ALR   @06,COPYSIZE                                     02S0570
         LR    @15,HCNT                                         02S0570
         BCTR  @15,0                                            02S0570
         EX    @15,@SM01885                                     02S0570
*                            COPYSIZE = COPYSIZE + HCNT;/*UPDATE SIZE*/
         ALR   COPYSIZE,HCNT                                    02S0571
*                          END;        /*                            */
*                        ELSE          /* NO SEGMENT COPIED.         */
*                          DO;         /* INDICATE SEGMENT DELETED.  */
         B     @RC00568                                         02S0573
@RF00568 DS    0H                                               02S0574
*                            SCNT = SCNT-ONE;/* REDUCE DELSEG CNT.   */
         SLR   @06,@06                                          02S0574
         ICM   @06,3,SCNT(BUFAD)                                02S0574
         BCTR  @06,0                                            02S0574
         STH   @06,SCNT(,BUFAD)                                 02S0574
*                            DEL(CNT) = ZERO;                   02S0575
         SLR   @06,@06                                          02S0575
         STC   @06,DEL+795(CNT,BUFAD)                           02S0575
*                          END;        /*                            */
*                      FWORK = FWORK + HCNT;                    02S0577
@RC00568 LR    @06,HCNT                                         02S0577
         AL    @06,FWORK(,BUFAD)                                02S0577
         ST    @06,FWORK(,BUFAD)                                02S0577
*                      CMODCNT = CMODCNT - HCNT;                02S0578
         LH    @06,CMODCNT(,BUFAD)                              02S0578
         SLR   @06,HCNT                                         02S0578
         STH   @06,CMODCNT(,BUFAD)                              02S0578
*                    END;              /* END COPY.                  */
         AH    CNT,@CH00060                                     02S0579
         CH    CNT,@CH00762                                     02S0579
         BNH   @DL00566                                         02S0579
@DC00566 DS    0H                                               02S0580
*                    IF CMODCNT ^= ZERO × CNT > BIGNUM          02S0580
*                      THEN            /*  OF MODULE.                */
         ICM   @15,3,CMODCNT(BUFAD)                             02S0580
         BNZ   @RT00580                                         02S0580
         CH    CNT,@CH00762                                     02S0580
         BNH   @RF00580                                         02S0580
@RT00580 DS    0H                                               02S0581
*                        DO;           /*                            */
*                          MSGN = IEBA07I;   /* MODULE TOO LARGE.    */
         MVI   MSGN(BUFAD),X'07'                                02S0582
*                          CALL IEBIMSGS;    /* PRINT MESSAGE.       */
         L     @15,@CV00037                                     02S0583
         BALR  @14,@15                                          02S0583
*                          INHIBITW = ON;    /* INHIB LIB UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0584
*                        END;          /*                            */
*                      ELSE;           /* GOOD COPY.                 */
@RF00580 DS    0H                                               02S0587
*                    CMODCNT = COPYSIZE;/* SET MODULE SIZE.          */
         STH   COPYSIZE,CMODCNT(,BUFAD)                         02S0587
*                    CALL DELCHK;      /* INSURE PROPER DELETE.      */
         BAL   @14,DELCHK                                       02S0588
*                  END;                /*                            */
*                ELSE                  /* ERROR IN BLDL.             */
*            INHIBITW = ON;            /* INHIBIT LIBRARY UPDATE.    */
         B     @RC00561                                         02S0590
@RF00561 OI    INHIBITW(BUFAD),B'01000000'                      02S0590
*            END;                      /* END LOAD CODE.             */
*          ELSE                        /* CAN READ THIS ONE.         */
*            IF INHIBITR = OFF         /* COULD BE NAME ERROR.       */
*              THEN                    /*                            */
         B     @RC00558                                         02S0592
@RF00558 TM    INHIBITR(BUFAD),B'00100000'                      02S0592
         BNZ   @RF00592                                         02S0592
*            DO;                       /*                            */
*              CALL BLDL;              /* FIND THE MODULE.           */
         BAL   @14,BLDL                                         02S0594
*              IF INHIBITR = OFF       /* CHECK FOR BLDL ERROR.      */
*                THEN                  /*                            */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0595
         BNZ   @RF00595                                         02S0595
*                  IF BSTOR =< LENGTH(LIBBUF)                   02S0596
*                    THEN              /* CHECK FOR MODULE SIZE.     */
         CLC   BSTOR(3,BUFAD),@CF01849+1                        02S0596
         BH    @RF00596                                         02S0596
*                      DO;             /*                            */
*                        CALL READLIB; /* READ MODULE INTO BUFFER.   */
         BAL   @14,READLIB                                      02S0598
*                        IF INHIBITR = ON                       02S0599
*                          THEN        /* CHECK FOR ERROR FROM READ. */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0599
         BNO   @RF00599                                         02S0599
*                            DO;                                02S0600
*                              INHIBITW = ON;                   02S0601
         OI    INHIBITW(BUFAD),B'01000000'                      02S0601
*                            END;                               02S0602
*                          ELSE;       /* NO ERROR FROM READ.        */
@RF00599 DS    0H                                               02S0604
*                      END;            /*                            */
*                    ELSE              /* MODULE TOO BIG.            */
*                      DO;             /*                            */
         B     @RC00596                                         02S0605
@RF00596 DS    0H                                               02S0606
*                        MSGN = IEBA07I;                        02S0606
         MVI   MSGN(BUFAD),X'07'                                02S0606
*                        CALL IEBIMSGS;/* PRINT MODULE TOO BIG.      */
         L     @15,@CV00037                                     02S0607
         BALR  @14,@15                                          02S0607
*                        INHIBITW = ON;                         02S0608
         OI    INHIBITW(BUFAD),B'01000000'                      02S0608
*                      END;            /*                            */
*                ELSE;                 /* BLDL ERROR.                */
@RF00595 DS    0H                                               02S0611
*            END;                      /*                            */
*              ELSE                    /*                            */
*                INHIBITW = ON;        /* PREVENT LIBRARY UPDATE     */
         B     @RC00592                                         02S0612
@RF00592 OI    INHIBITW(BUFAD),B'01000000'                      02S0612
*        BSUFIX = BLANK;               /* CLEAR MODULE NAME, BLDL.   */
@RC00592 DS    0H                                               02S0613
@RC00558 MVI   BSUFIX+1(BUFAD),C' '                             02S0613
         MVC   BSUFIX+2(2,BUFAD),BSUFIX+1(BUFAD)                02S0613
         MVI   BSUFIX(BUFAD),C' '                               02S0613
*        INHIBITR = OFF;               /* RESET READ INHIBIT.        */
         NI    INHIBITR(BUFAD),B'11011111'                      02S0614
*                  END;                /*                            */
*                ELSE;                 /* NO INCLUDE.                */
@RF00553 DS    0H                                               01S0617
*            END;                      /*                            */
*          ELSE                        /* OPERATION IN PROGRESS.     */
*            KWDUSED = ZERO;           /*                            */
         B     @RC00548                                         01S0618
@RF00548 MVI   KWDUSED(BUFAD),X'00'                             01S0618
*        IF SCANINP = ON               /* CHECK FOR MORE SCANNING    */
*          THEN                        /*  TO DO.                    */
@RC00548 TM    SCANINP(BUFAD),B'01000000'                       01S0619
         BNO   @RF00619                                         01S0619
*            DO;                       /*                            */
*              READMOD = OFF;          /* IGNORE READ ONLY           */
         NI    READMOD(BUFAD),B'11111110'                       01S0621
*              COPYLINE = COPYLINE && COPYLINE;                 01S0622
         LA    @15,796                                          01S0622
         ALR   @15,BUFAD                                        01S0622
         XC    COPYLINE(210,@15),COPYLINE(@15)                  01S0622
*              COPYLABL = COPYDFLT;    /* SET DEFAUL COPY SEG.       */
         MVC   COPYLABL(6,@15),@CB00896                         01S0623
*              CALL IEBISCAN;          /* SCAN FOR KEYWORDS.         */
         L     @15,@CV00036                                     01S0624
         BALR  @14,@15                                          01S0624
*              IF COPYSET = ON         /* CHECK FOR ALL KEYWORDS     */
*               & LINESET = ON         /*  SPECIFIED.                */
*               & POSSET = ON          /*                            */
*               & TEXTSET = ON         /*                            */
*                THEN                  /*                            */
         TM    COPYSET(BUFAD),B'00011110'                       01S0625
         BNO   @RF00625                                         01S0625
*                  DO;                 /* SET TEXT INFO IN COPY MOD. */
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL INVESTIGATE THE TEXT GENERATED AND REDUCE TO    *
**  THREE BYTES ANY STRING OF EQUAL CHARACTERS. THE THREE BYTES ARE   *
**  IN THE FOLLOWING FORMAT.                                          *
**                                                                    *
**       BYTE 1 HEX(FF)                                               *
**       BYTE 2 REPETITION FACTOR                                     *
**       BYTE 3 CHARACTER TO BE REPEATED                              *
**                                                                    *
**********************************************************************/
*        DO;                           /*                            */
*          RESPECIFY (BUFFPTR) RESTRICTED;                      02S0628
*          YCNT = ZERO;                /* RESET COUNTER.             */
         SLR   YCNT,YCNT                                        02S0629
*          BUFFPTR = ADDR(TEXTD);      /* POINTER TRACKS TEXTDATA.   */
         LA    BUFFPTR,TEXTD+796(,BUFAD)                        02S0630
*          DO                          /* START TEXT FIELD SCAN.     */
*           XCNT = ONE                 /* COUNTER FOR RECEIVING FLD. */
*           TO TEXTN                   /*                            */
*           WHILE YCNT < TEXTN;        /* TOTAL FIELD COUNTER.       */
         LA    XCNT,1                                           02S0631
         B     @DE00631                                         02S0631
@DL00631 SLR   @07,@07                                          02S0631
         IC    @07,TEXTN+796(,BUFAD)                            02S0631
         CR    YCNT,@07                                         02S0631
         BNL   @DC00631                                         02S0631
*            DO                        /* SCAN FOR EQUAL CHARACTERS  */
*             CNT = ONE                /* COUNT EQUAL CHARACTERS     */
*             TO TEXTN - YCNT          /* STOP AT END OF FIELD.      */
*             WHILE TEXTDATA(CNT)      /*                            */
*                 = TEXTDATA(CNT+ONE); /*                            */
         LA    CNT,1                                            02S0632
         B     @DE00632                                         02S0632
@DL00632 LR    @07,BUFFPTR                                      02S0632
         ALR   @07,CNT                                          02S0632
         BCTR  @07,0                                            02S0632
         LR    @04,BUFFPTR                                      02S0632
         ALR   @04,CNT                                          02S0632
         CLC   TEXTDATA(1,@07),TEXTDATA(@04)                    02S0632
         BNE   @DC00632                                         02S0632
*              TEXTD(XCNT + CNT - ONE) /* MOVE TO POSSIBLY COMPRESS  */
*               = TEXTDATA(CNT);       /*  FIELD.                    */
         LR    @07,XCNT                                         02S0633
         ALR   @07,CNT                                          02S0633
         ALR   @07,BUFAD                                        02S0633
         LR    @04,BUFFPTR                                      02S0633
         ALR   @04,CNT                                          02S0633
         BCTR  @04,0                                            02S0633
         MVC   TEXTD+794(1,@07),TEXTDATA(@04)                   02S0633
*            END;                      /* END OF EQ CHARACTER SCAN.  */
         AH    CNT,@CH00060                                     02S0634
@DE00632 SLR   @07,@07                                          02S0634
         IC    @07,TEXTN+796(,BUFAD)                            02S0634
         SLR   @07,YCNT                                         02S0634
         CR    CNT,@07                                          02S0634
         BNH   @DL00632                                         02S0634
@DC00632 DS    0H                                               02S0635
*            IF CNT > THREE            /* CHECK FOR MORE THAN THREE  */
*              THEN                    /*  EQUAL CHARACTERS.         */
         CH    CNT,@CH00111                                     02S0635
         BNH   @RF00635                                         02S0635
*                DO;                   /*                            */
*                  TEXTD(XCNT) = ALBIT;/* INDICATE COMPRESSION.      */
         LA    @07,796                                          02S0637
         ALR   @07,BUFAD                                        02S0637
         LR    @04,@07                                          02S0637
         ALR   @04,XCNT                                         02S0637
         MVI   TEXTD-1(@04),X'FF'                               02S0637
*                  TEXTD(XCNT+ONE)     /* SET REPITITION FACTOR.     */
*                   = CNT;             /*                            */
         STC   CNT,TEXTD(XCNT,@07)                              02S0638
*                  XCNT = XCNT + TWO;  /* INCREMENT REC FIELD CTR.   */
         AL    XCNT,@CF00057                                    02S0639
*                END;                  /*                            */
*              ELSE                    /* ENTER HERE FOR 3 OR LESS.  */
*                DO;                   /*                            */
         B     @RC00635                                         02S0641
@RF00635 DS    0H                                               02S0642
*                  XCNT                /*                            */
*                   = XCNT + CNT - ONE;/*                            */
         LR    @07,XCNT                                         02S0642
         ALR   @07,CNT                                          02S0642
         BCTR  @07,0                                            02S0642
         LR    XCNT,@07                                         02S0642
*                  TEXTD(XCNT)         /* MOVE THE LAST CHARACTER OF */
*                   = TEXTDATA(CNT);   /*  AN EQUAL CHAR STRING < 3. */
         LR    @07,BUFAD                                        02S0643
         ALR   @07,XCNT                                         02S0643
         LR    @04,BUFFPTR                                      02S0643
         ALR   @04,CNT                                          02S0643
         BCTR  @04,0                                            02S0643
         MVC   TEXTD+795(1,@07),TEXTDATA(@04)                   02S0643
*                END;                  /*                            */
*            BUFFPTR = BUFFPTR + CNT;  /* UPDATE TRACKING POINTER.   */
@RC00635 ALR   BUFFPTR,CNT                                      02S0645
*            YCNT = YCNT + CNT;        /* UPDATE TOTAL FIELD COUNTER.*/
         ALR   YCNT,CNT                                         02S0646
*          END;                        /*                            */
         AH    XCNT,@CH00060                                    02S0647
@DE00631 SLR   @07,@07                                          02S0647
         IC    @07,TEXTN+796(,BUFAD)                            02S0647
         CR    XCNT,@07                                         02S0647
         BNH   @DL00631                                         02S0647
@DC00631 DS    0H                                               02S0648
*          TEXTN = XCNT - ONE;         /* SET UPDATE TEXT NUMBER.    */
         LR    @07,XCNT                                         02S0648
         BCTR  @07,0                                            02S0648
         STC   @07,TEXTN+796(,BUFAD)                            02S0648
*          RESPECIFY (BUFFPTR) UNRESTRICTED;                    02S0649
*        END;                          /*                            */
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL INSERT INTO THE COPY MODIFICATION MODULE, IN    *
**  THE PROPER SEQUENCE A COPY SEGMENT AS SPECIFIED BY THE COPY MOD   *
**  CONTROL STATMENT.                                                 *
**                                                                    *
**********************************************************************/
*        IF CMODCNT < LENGTH(MODBOD)   /* CHECK IF MODULE ALREADY    */
*          THEN                        /*  TO LARGE                  */
         LH    @15,CMODCNT(,BUFAD)                              02S0651
         CH    @15,@CH00231                                     02S0651
         BNL   @RF00651                                         02S0651
*            DO;                       /* NOT THIS TIME              */
*              RESPECIFY               /*                            */
*               (BUFFPTR) RESTRICTED;  /*                            */
*              BUFFPTR = ADDR(MODBOD); /* INITALIZE SEGMENT POINTER  */
         LA    BUFFPTR,MODBOD(,BUFAD)                           02S0654
*              COPYSIZE = ZERO;        /*  AND SIZE SAVER.           */
         SLR   COPYSIZE,COPYSIZE                                02S0655
*              DO                      /* START SEGMENT SEARCH       */
*               WHILE CMODCNT > ZERO   /*  TO END OF MODULE          */
*               & (COPY1 < ICOPY       /*  OR PLACE TO INSERT.       */
*                  × (COPY1 = ICOPY & LINE1 < ILINE));          02S0656
         B     @DE00656                                         02S0656
@DL00656 DS    0H                                               02S0657
*                FWORK                 /* GET LENGTH OF SEGMENT.     */
*                 = TEXTX + LENGTH(COPYHD);                     02S0657
         LA    @07,6                                            02S0657
         SLR   @02,@02                                          02S0657
         IC    @02,TEXTX(,BUFFPTR)                              02S0657
         ALR   @07,@02                                          02S0657
         ST    @07,FWORK(,BUFAD)                                02S0657
*                BUFFPTR               /* STEP TO NEXT SEGMENT.      */
*                 = BUFFPTR + FWORK;   /*                            */
         ALR   BUFFPTR,@07                                      02S0658
*                CMODCNT               /* REDUCE MODULE COUNT.       */
*                 = CMODCNT - FWORK;   /*                            */
         LH    @02,CMODCNT(,BUFAD)                              02S0659
         SLR   @02,@07                                          02S0659
         STH   @02,CMODCNT(,BUFAD)                              02S0659
*                COPYSIZE              /* UPDATE CURRENT SIZE.       */
*                 = COPYSIZE + FWORK;  /*                            */
         ALR   COPYSIZE,@07                                     02S0660
*              END;                    /* END OF SEARCH.             */
@DE00656 ICM   @07,3,CMODCNT(BUFAD)                             02S0661
         BNP   @DC00656                                         02S0661
         LA    @07,796                                          02S0661
         ALR   @07,BUFAD                                        02S0661
         CLC   COPY1(1,BUFFPTR),ICOPY(@07)                      02S0661
         BL    @DL00656                                         02S0661
         CLC   COPY1(1,BUFFPTR),ICOPY(@07)                      02S0661
         BNE   @DC00656                                         02S0661
         CLC   LINE1(1,BUFFPTR),ILINE(@07)                      02S0661
         BL    @DL00656                                         02S0661
@DC00656 DS    0H                                               02S0662
*              FWORK = TEXTN + LENGTH(COPYLABL);                02S0662
         LA    @07,6                                            02S0662
         SLR   @02,@02                                          02S0662
         IC    @02,TEXTN+796(,BUFAD)                            02S0662
         ALR   @07,@02                                          02S0662
         ST    @07,FWORK(,BUFAD)                                02S0662
*              IF CMODCNT > ZERO       /* CHECK FOR NEED TO MAKE     */
*                THEN                  /*  ROOM FOR LINE TO INSERT.  */
         LH    @07,CMODCNT(,BUFAD)                              02S0663
         LTR   @07,@07                                          02S0663
         BNP   @RF00663                                         02S0663
*                  DO;                 /*                            */
*                    RESPECIFY         /* REGS NEEDED FOR MOVE LONG. */
*                     (RECAREA,RECSIZE,TRANSIZE) RESTRICTED;    02S0665
*                    DWORK2 = BUFFPTR; /* SAVE SEGMENT POINTER.      */
         ST    BUFFPTR,DWORK2(,BUFAD)                           02S0666
*                    RECSIZE = CMODCNT;/* AMOUNT TO MOVE             */
         LH    @02,CMODCNT(,BUFAD)                              02S0667
         LR    RECSIZE,@02                                      02S0667
*                    TRANSIZE = RECSIZE;/*    DITTO                  */
         LR    TRANSIZE,RECSIZE                                 02S0668
*                    RECAREA = ADDR(MSGSAVE);/* MOVE TO TEMP AREA.   */
         LR    RECAREA,BUFAD                                    02S0669
         AL    RECAREA,@CF01856                                 02S0669
*                    MVCL(RECAREA,BUFFPTR);/* SAVE BALANCE OF MODULE.*/
         MVCL  RECAREA,BUFFPTR                                  02S0670
*                    RECAREA = DWORK2 + FWORK;/* RECEIVING AREA.     */
         L     RECAREA,DWORK2(,BUFAD)                           02S0671
         AL    RECAREA,FWORK(,BUFAD)                            02S0671
*                    BUFFPTR = ADDR(MSGSAVE);/* MOVE FROM TEMP AREA. */
         LR    BUFFPTR,BUFAD                                    02S0672
         AL    BUFFPTR,@CF01856                                 02S0672
*                    RECSIZE = CMODCNT;/* AMOUNT TO MOVE             */
         LH    RECSIZE,CMODCNT(,BUFAD)                          02S0673
*                    TRANSIZE = RECSIZE;/*    DITTO                  */
         LR    TRANSIZE,RECSIZE                                 02S0674
*                    MVCL(RECAREA,BUFFPTR);/* MAKE SOME ROOM.        */
         MVCL  RECAREA,BUFFPTR                                  02S0675
*                    BUFFPTR = DWORK2; /* RESTORE SEGMENT POINTER.   */
         L     BUFFPTR,DWORK2(,BUFAD)                           02S0676
*                    RESPECIFY         /*                            */
*                     (RECAREA,RECSIZE,TRANSIZE) UNRESTRICTED;  02S0677
*                  END;                /*                            */
*                ELSE;                 /*                            */
@RF00663 DS    0H                                               02S0680
*              COPYSEG(ONE:FWORK)      /* INSERT GENERATE COPY       */
*               = COPYLINE(ONE:FWORK); /*  SEGMENT.                  */
         L     @07,FWORK(,BUFAD)                                02S0680
         LR    @02,@07                                          02S0680
         BCTR  @02,0                                            02S0680
         EX    @02,@SM01888                                     02S0680
*              CMODCNT                 /* UPDATE MODULE SIZE.        */
*               = CMODCNT + COPYSIZE + FWORK;                   02S0681
         LR    @02,COPYSIZE                                     02S0681
         AH    @02,CMODCNT(,BUFAD)                              02S0681
         ALR   @02,@07                                          02S0681
         STH   @02,CMODCNT(,BUFAD)                              02S0681
*              RESPECIFY (BUFFPTR) UNRESTRICTED;                02S0682
*            END;                      /* END OF UPDATE.             */
*          ELSE;                       /*                            */
@RF00651 DS    0H                                               02S0685
*        IF CMODCNT > LENGTH(MODBOD)   /* CHECK AGAIN FOR BIG MODULE.*/
*          THEN                        /*                            */
         LH    @15,CMODCNT(,BUFAD)                              02S0685
         CH    @15,@CH00231                                     02S0685
         BNH   @RF00685                                         02S0685
*            DO;                       /*                            */
*              MSGN = IEBA07I;         /* MODULE TO LARGE.           */
         MVI   MSGN(BUFAD),X'07'                                02S0687
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0688
         BALR  @14,@15                                          02S0688
*              INHIBITW = ON;          /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0689
*            END;                      /*                            */
*          ELSE;                       /* NO ERROR, CONTINUE         */
@RF00685 DS    0H                                               02S0692
*                  END;                /*                            */
*                ELSE                  /* KEYWORD MISSING.           */
*                  DO;                 /*                            */
         B     @RC00625                                         01S0693
@RF00625 DS    0H                                               01S0694
*                    MSGN = IEBA25I;   /* INSUFFICIENT KEYWORDS.     */
         MVI   MSGN(BUFAD),X'19'                                01S0694
*                    CALL IEBIMSGS;    /* PRINT IT.                  */
         L     @15,@CV00037                                     01S0695
         BALR  @14,@15                                          01S0695
*                    INHIBITW = ON;    /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      01S0696
*                  END;                /*                            */
*            END;                      /* END BUILD.                 */
@RC00625 DS    0H                                               01S0699
*        IF NOKEY = ON                 /* CHECK FOR READ ONLY REQ.   */
*          THEN                        /*                            */
@RF00619 TM    NOKEY(BUFAD),B'01000000'                         01S0699
         BNO   @RF00699                                         01S0699
*            READMOD = ON;             /* SET FOR READ ONLY.         */
         OI    READMOD(BUFAD),B'00000001'                       01S0700
*          ELSE;                       /*                            */
@RF00699 DS    0H                                               01S0702
*        IF INHIBITW = ON              /* CHECK FOR ANY ERROR.       */
*          THEN                        /* RETURN CODE = 8 THIS OP.   */
         TM    INHIBITW(BUFAD),B'01000000'                      01S0702
         BNO   @RF00702                                         01S0702
*            RETSAVE = MAX(RETSAVE,RC8);                        01S0703
         SLR   @15,@15                                          01S0703
         IC    @15,RETSAVE(,BUFAD)                              01S0703
         LA    @14,8                                            01S0703
         CR    @15,@14                                          01S0703
         BNL   *+6
         LR    @15,@14                                          01S0703
         STC   @15,RETSAVE(,BUFAD)                              01S0703
*          ELSE;                       /*                            */
@RF00702 DS    0H                                               01S0705
*        GEN REFS(SAVE1)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE1+BACK(,BUFAD)); /*                            */
         L  @13,SAVE1+BACK(,BUFAD)
*END COPYMOD;                                                   01S0706
@EL00006 DS    0H                                               01S0706
@EF00006 DS    0H                                               01S0706
@ER00006 LM    @14,@12,12(@13)                                  01S0706
         BR    @14                                              01S0706
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL MODIFY OR CREATE GRAPHIC CHARACTER MODIFICATION *
**  MODULES. THE MODULES MAY BE CONSTRUCTED BY INCLUDING ANY PORTION  *
**  OR ALL OF AN EXISTING GCM, OR REFERENCING AN EXISTING GCM OR THE  *
**  SPECIAL GRAPHIC CHARACTER RECORD, OR BY BUILDING SEGMENTS FROM    *
**  DATA CARDS.                                                       *
**                                                                    *
**********************************************************************/
*GRAPHIC:                                                       01S0707
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0707
GRAPHIC  STM   @14,@12,12(@13)                                  01S0707
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        BNAME = GRAF;                 /* SET GCM NAME PREFIX.       */
         MVI   BNAME+4(BUFAD),C' '                              01S0709
         MVC   BNAME+5(3,BUFAD),BNAME+4(BUFAD)                  01S0709
         MVC   BNAME(4,BUFAD),@CC00811                          01S0709
*        IF OPINPRG = OFF              /* CHECK HAVING BEEN HERE     */
*          THEN                        /*  BEFORE.                   */
         TM    OPINPRG(BUFAD),B'00000010'                       01S0710
         BNZ   @RF00710                                         01S0710
*            DO;                       /* CLEAR MODULE HEADER.       */
*              MODHEAD = MODHEAD && MODHEAD;                    01S0712
         XC    MODHEAD(8,BUFAD),MODHEAD(BUFAD)                  01S0712
*              OPINPRG = ON;           /* REMEMBER BEING HERE.       */
         OI    OPINPRG(BUFAD),B'00000010'                       01S0713
*              SEGCNT = ZERO;          /* RESET SEGMENT COUNTER.     */
         SLR   @15,@15                                          01S0714
         STH   @15,SEGCNT(,BUFAD)                               01S0714
*              IF INCLSW = ON          /* CHECK FOR INCLUDE OPTION.  */
*                THEN                  /* LOAD INCLUDE MODULE        */
         TM    INCLSW(BUFAD),B'00100000'                        01S0715
         BNO   @RF00715                                         01S0715
*                  DO;                 /*  AND COPY INTO BUFFER.     */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL LOAD THE INCLUDED GRAPHIC CHARACTER MODULE      *
**  AND COPY IT INTO THE BUFFER MINUS THE DELETED SEGMENTS.           *
**                                                                    *
**********************************************************************/
*        INCLSW = OFF;                 /* RESET INCLUDE INDICATION.  */
         NI    INCLSW(BUFAD),B'11011111'                        02S0717
*        NOKEY = OFF;                  /* RESET PRINT ONLY REQUEST   */
         NI    NOKEY(BUFAD),B'10111111'                         02S0718
*        BSUFIX = INCLNAME;            /* SET NAME IN BLDL ENTRY.    */
         MVC   BSUFIX(4,BUFAD),INCLNAME(BUFAD)                  02S0719
*        IF DELSET = ON                /* CHECK FOR DELSEG KEYWORD.  */
*          THEN                        /* NEED TO LOAD MODULE.       */
         TM    DELSET(BUFAD),B'00100000'                        02S0720
         BNO   @RF00720                                         02S0720
*            DO;                       /*                            */
*              CALL LOADLIB;           /* LOAD A MODULE.             */
         BAL   @14,LOADLIB                                      02S0722
*              IF LOADFLAG = ALBIT     /* CHECK FOR MODULE LOADED.   */
*                THEN                  /*                            */
         CLI   LOADFLAG(BUFAD),X'FF'                            02S0723
         BNE   @RF00723                                         02S0723
*                  DO;                 /*                            */
*                    DO                /* START COPY OF INCLUDED     */
*                     CNT = ONE        /*  MODULE.                   */
*                     TO MAXSEG        /* COPY TO END OF MODULE      */
*                     WHILE LMODCNT/LENGTH(GRAFSEG) => CNT;     02S0725
         LA    CNT,1                                            02S0725
@DL00725 LA    @03,73                                           02S0725
         SLR   @15,@15                                          02S0725
         ICM   @15,7,LOADMOD(BUFAD)                             02S0725
         SLR   @01,@01                                          02S0725
         ICM   @01,3,LMODCNT(@15)                               02S0725
         SLR   @00,@00                                          02S0725
         DR    @00,@03                                          02S0725
         CR    @01,CNT                                          02S0725
         BL    @DC00725                                         02S0725
*                      IF DEL(CNT) = ZERO                       02S0726
*                        THEN          /* DO NOT DELETE THIS SEGMENT.*/
         SLR   @14,@14                                          02S0726
         IC    @14,DEL+795(CNT,BUFAD)                           02S0726
         CH    @14,@CH00462                                     02S0726
         BNE   @RF00726                                         02S0726
*                          DO;         /*                            */
*                            SEGCNT =  /* INCREMENT SEGMENT COUNT.   */
*                             SEGCNT + ONE; /*                       */
         LA    @14,1                                            02S0728
         AH    @14,SEGCNT(,BUFAD)                               02S0728
         STH   @14,SEGCNT(,BUFAD)                               02S0728
*                            GSEG(SEGCNT) = /* COPY ONE SEGMENT.     */
*                             LOADSEG(CNT); /*                       */
         LR    @01,@14                                          02S0729
         MR    @00,@03                                          02S0729
         ALR   @01,BUFAD                                        02S0729
         LR    @05,@03                                          02S0729
         MR    @04,CNT                                          02S0729
         ALR   @15,@05                                          02S0729
         AL    @15,@CF01890                                     02S0729
         MVC   GSEG+2171(73,@01),LOADSEG-8(@15)                 02S0729
*                          END;        /*                            */
*                        ELSE          /* NO SEGMENT COPIED.         */
*                          DO;         /* INDICATE SEGMENT DELETED.  */
         B     @RC00726                                         02S0731
@RF00726 DS    0H                                               02S0732
*                            SCNT = SCNT-ONE;/* REDUCE DELSEG CNT.   */
         SLR   @03,@03                                          02S0732
         ICM   @03,3,SCNT(BUFAD)                                02S0732
         BCTR  @03,0                                            02S0732
         STH   @03,SCNT(,BUFAD)                                 02S0732
*                            DEL(CNT) = ZERO;/* DELETE DELETE IND.   */
         SLR   @03,@03                                          02S0733
         STC   @03,DEL+795(CNT,BUFAD)                           02S0733
*                          END;        /*                            */
*                    END;              /* END COPY.                  */
@RC00726 AH    CNT,@CH00060                                     02S0735
         CH    CNT,@CH00245                                     02S0735
         BNH   @DL00725                                         02S0735
@DC00725 DS    0H                                               02S0736
*                    IF CNT < LMODCNT/LENGTH(GRAFSEG)/* COPY TO END  */
*                      THEN            /*  OF MODULE.                */
         ICM   @03,7,LOADMOD(BUFAD)                             02S0736
         SLR   @01,@01                                          02S0736
         ICM   @01,3,LMODCNT(@03)                               02S0736
         SLR   @00,@00                                          02S0736
         D     @00,@CF00610                                     02S0736
         CR    CNT,@01                                          02S0736
         BNL   @RF00736                                         02S0736
*                        DO;           /*                            */
*                          MSGN = IEBA07I;/* MODULE TOO LARGE.       */
         MVI   MSGN(BUFAD),X'07'                                02S0738
*                          CALL IEBIMSGS; /* PRINT MESSAGE.          */
         L     @15,@CV00037                                     02S0739
         BALR  @14,@15                                          02S0739
*                          INHIBITW = ON; /* INHIB LIB UPDATE.       */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0740
*                        END;          /*                            */
*                      ELSE;           /* GOOD COPY.                 */
@RF00736 DS    0H                                               02S0743
*                  CALL DELCHK;        /* INSURE PROPER DELETE.      */
         BAL   @14,DELCHK                                       02S0743
*                  END;                /*                            */
*                ELSE                  /* ERROR IN BLDL.             */
*            INHIBITW = ON;            /* INHIBIT LIBRARY UPDATE.    */
         B     @RC00723                                         02S0745
@RF00723 OI    INHIBITW(BUFAD),B'01000000'                      02S0745
*            END;                      /* END LOAD CODE.             */
*          ELSE                        /* CAN READ THIS ONE.         */
*            IF INHIBITR = OFF         /* COULD BE NAME ERROR.       */
*              THEN                    /*                            */
         B     @RC00720                                         02S0747
@RF00720 TM    INHIBITR(BUFAD),B'00100000'                      02S0747
         BNZ   @RF00747                                         02S0747
*            DO;                       /*                            */
*              CALL BLDL;              /* FIND THE MODULE.           */
         BAL   @14,BLDL                                         02S0749
*              IF INHIBITR = OFF       /* CHECK FOR BLDL ERROR.      */
*                THEN                  /*                            */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0750
         BNZ   @RF00750                                         02S0750
*                  IF BSTOR/LENGTH(GSEG) < MAXSEG + ONE         02S0751
*                    THEN              /* CHECK FOR MODULE SIZE.     */
         SLR   @01,@01                                          02S0751
         ICM   @01,7,BSTOR(BUFAD)                               02S0751
         SLR   @00,@00                                          02S0751
         D     @00,@CF00610                                     02S0751
         CH    @01,@CH01851                                     02S0751
         BNL   @RF00751                                         02S0751
*                      DO;             /*                            */
*                        CALL READLIB; /* READ MODULE INTO BUFFER.   */
         BAL   @14,READLIB                                      02S0753
*                        IF INHIBITR = OFF                      02S0754
*                          THEN        /* CHECK FOR ERROR FROM READ. */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0754
         BNZ   @RF00754                                         02S0754
*                            SEGCNT    /* SET SEGMENT COUNT.         */
*                             = MODCNT/LENGTH(GRAFSEG);         02S0755
         SLR   @01,@01                                          02S0755
         ICM   @01,3,MODCNT(BUFAD)                              02S0755
         SLR   @00,@00                                          02S0755
         D     @00,@CF00610                                     02S0755
         STH   @01,SEGCNT(,BUFAD)                               02S0755
*                          ELSE        /* ERROR FROM READ.           */
*                            INHIBITW = ON;                     02S0756
         B     @RC00754                                         02S0756
@RF00754 OI    INHIBITW(BUFAD),B'01000000'                      02S0756
*                      END;            /*                            */
*                    ELSE              /* MODULE TOO BIG.            */
*                      DO;             /*                            */
         B     @RC00751                                         02S0758
@RF00751 DS    0H                                               02S0759
*                        MSGN = IEBA07I;                        02S0759
         MVI   MSGN(BUFAD),X'07'                                02S0759
*                        CALL IEBIMSGS;/* PRINT MODULE TOO BIG.      */
         L     @15,@CV00037                                     02S0760
         BALR  @14,@15                                          02S0760
*                        INHIBITW = ON;                         02S0761
         OI    INHIBITW(BUFAD),B'01000000'                      02S0761
*                      END;            /*                            */
*                ELSE;                 /* BLDL ERROR.                */
@RF00750 DS    0H                                               02S0764
*            END;                      /*                            */
*              ELSE                    /*                            */
*                INHIBITW = ON;        /* PREVENT LIBRARY UPDATE     */
         B     @RC00747                                         02S0765
@RF00747 OI    INHIBITW(BUFAD),B'01000000'                      02S0765
*        BSUFIX = BLANK;               /* CLEAR MODULE NAME, BLDL.   */
@RC00747 DS    0H                                               02S0766
@RC00720 MVI   BSUFIX+1(BUFAD),C' '                             02S0766
         MVC   BSUFIX+2(2,BUFAD),BSUFIX+1(BUFAD)                02S0766
         MVI   BSUFIX(BUFAD),C' '                               02S0766
*        INHIBITR = OFF;               /* RESET READ INHIBIT.        */
         NI    INHIBITR(BUFAD),B'11011111'                      02S0767
*                  END;                /*                            */
*                ELSE;                 /* NO INCLUDE.                */
@RF00715 DS    0H                                               01S0770
*            END;                      /*                            */
*          ELSE                        /* OPERATION IN PROGRESS.     */
*            KWDUSED = ZERO;           /*                            */
         B     @RC00710                                         01S0771
@RF00710 MVI   KWDUSED(BUFAD),X'00'                             01S0771
*        IF SCANINP = ON               /* CHECK FOR MORE SCANNING    */
*          THEN                        /*  TO DO.                    */
@RC00710 TM    SCANINP(BUFAD),B'01000000'                       01S0772
         BNO   @RF00772                                         01S0772
*            DO;                       /*                            */
*              PITCH = TEN;            /* INIT PITCH FOR ASSIGN.     */
         MVI   PITCH(BUFAD),X'0A'                               01S0774
*              READMOD = OFF;          /* IGNORE READ ONLY           */
         NI    READMOD(BUFAD),B'11111110'                       01S0775
*              CALL IEBISCAN;          /* SCAN FOR KEYWORDS          */
         L     @15,@CV00036                                     01S0776
         BALR  @14,@15                                          01S0776
*              IF REFSET = ON          /* GCM REFERENCE REQUESTED.   */
*                THEN                  /* LOAD GCM AND COPY SEGMENTS.*/
         TM    REFSET(BUFAD),B'00010000'                        01S0777
         BNO   @RF00777                                         01S0777
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL LOAD THE REFERENCED GRAPHIC CHARACTER MODULE    *
**  AND COPY THE SEGMENTS INDICATED IN THE REF KEYWORD.               *
**                                                                    *
**********************************************************************/
*        IF BPREFX = GRAF              /* CHECK FOR VALID NAME.      */
*          THEN                        /*                            */
         CLC   BPREFX(4,BUFAD),@CC00811                         02S0778
         BNE   @RF00778                                         02S0778
*            DO;                       /*                            */
*              CALL LOADLIB;           /* LOAD REQUESTED MODULE.     */
         BAL   @14,LOADLIB                                      02S0780
*              DO                      /* START SEGMENT SELECT.      */
*               CNT = ONE              /*                            */
*               TO SCNT - ONE          /*                            */
*               WHILE LOADFLAG = ALBIT /*                            */
*                      & SEGCNT =< MAXSEG;                      02S0781
         LA    CNT,1                                            02S0781
         B     @DE00781                                         02S0781
@DL00781 CLI   LOADFLAG(BUFAD),X'FF'                            02S0781
         BNE   @DC00781                                         02S0781
         LH    @03,SEGCNT(,BUFAD)                               02S0781
         CH    @03,@CH00245                                     02S0781
         BH    @DC00781                                         02S0781
*                IF REFARRAY(CNT) =< LMODCNT/LENGTH(GRAFSEG)    02S0782
*                  THEN                /* CHECK FOR VALID SEGMENT.   */
         LR    @15,CNT                                          02S0782
         SLA   @15,2                                            02S0782
         LA    @14,796                                          02S0782
         ALR   @14,BUFAD                                        02S0782
         ST    @15,@TF00001                                     02S0782
         ALR   @15,@14                                          02S0782
         BCTR  @15,0                                            02S0782
         BCTR  @15,0                                            02S0782
         SLR   @07,@07                                          02S0782
         ICM   @07,3,REFARRAY-2(@15)                            02S0782
         LA    @06,73                                           02S0782
         SLR   @15,@15                                          02S0782
         ICM   @15,7,LOADMOD(BUFAD)                             02S0782
         SLR   @01,@01                                          02S0782
         ICM   @01,3,LMODCNT(@15)                               02S0782
         SLR   @00,@00                                          02S0782
         DR    @00,@06                                          02S0782
         CR    @07,@01                                          02S0782
         BH    @RF00782                                         02S0782
*                    DO;               /* INCREMENT SEGMENT COUNT.   */
*                      SEGCNT = SEGCNT + ONE;                   02S0784
         AH    @03,@CH00060                                     02S0784
         STH   @03,SEGCNT(,BUFAD)                               02S0784
*                      GSEG(SEGCNT) =  /* COPY SEGMENT TO BUFFER.    */
*                       LOADSEG(REFARRAY(CNT));                 02S0785
         LR    @01,@03                                          02S0785
         MR    @00,@06                                          02S0785
         LA    @03,2244                                         02S0785
         ALR   @03,BUFAD                                        02S0785
         ST    @01,@TF00002                                     02S0785
         ALR   @01,@03                                          02S0785
         AL    @01,@CF01891                                     02S0785
         MR    @06,@06                                          02S0785
         ALR   @15,@07                                          02S0785
         AL    @15,@CF01890                                     02S0785
         MVC   GSEG(73,@01),LOADSEG-8(@15)                      02S0785
*                      IF ASNENTRY(CNT) = ALBIT                 02S0786
*                        THEN          /* CHANGE ASSIGNMENT BYTE.    */
         LR    @15,@14                                          02S0786
         AL    @15,@TF00001                                     02S0786
         AL    @15,@CF01892                                     02S0786
         CLI   ASNENTRY-1(@15),X'FF'                            02S0786
         BNE   @RF00786                                         02S0786
*                          GSEGASGN(SEGCNT)                     02S0787
*                           = ASNARRAY(CNT);                    02S0787
         AL    @03,@TF00002                                     02S0787
         AL    @03,@CF01891                                     02S0787
         AL    @14,@TF00001                                     02S0787
         AL    @14,@CF01893                                     02S0787
         MVC   GSEGASGN(1,@03),ASNARRAY(@14)                    02S0787
*                        ELSE;         /* NO CHANGE REQUESTED        */
@RF00786 DS    0H                                               02S0789
*                    END;              /*                            */
*                  ELSE                /* SEGMENT NUMBER NOT FOUND.  */
*                    DO;               /* GENERATE MESSAGE.          */
         B     @RC00782                                         02S0790
@RF00782 DS    0H                                               02S0791
*                      FWORK = REFARRAY(CNT);                   02S0791
         LR    @03,CNT                                          02S0791
         SLA   @03,2                                            02S0791
         ALR   @03,BUFAD                                        02S0791
         SLR   @15,@15                                          02S0791
         ICM   @15,3,REFARRAY+792(@03)                          02S0791
         ST    @15,FWORK(,BUFAD)                                02S0791
*                      CVD(FWORK,DWORK);/* MAKE SEG NO. PRINTABLE.   */
         CVD   @15,DWORK(,BUFAD)                                02S0792
*                      UNPK(CWORK,PWORK);                       02S0793
         UNPK  CWORK(4,BUFAD),PWORK(2,BUFAD)                    02S0793
*                      CWORK(LENGTH(CWORK)) =                   02S0794
*                        CWORK(LENGTH(CWORK)) × MASK;           02S0794
         OI    CWORK+3(BUFAD),C'0'                              02S0794
*                      EDITDATA(ONE)   /*                            */
*                       = ADDR(CWORK); /*                            */
         LA    @03,CWORK(,BUFAD)                                02S0795
         STCM  @03,7,EDITDATA(BUFAD)                            02S0795
*                      EDITLEN(ONE)    /*                            */
*                       = LENGTH(CWORK);                        02S0796
         MVI   EDITLEN(BUFAD),X'04'                             02S0796
*                      MSGN = IEBA24I; /*                            */
         MVI   MSGN(BUFAD),X'18'                                02S0797
*                      CALL IEBIMSGS;  /*                            */
         L     @15,@CV00037                                     02S0798
         BALR  @14,@15                                          02S0798
*                      INHIBITW = ON;  /*                            */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0799
*                    END;              /* END MESSAGE GENERATION.    */
*              END;                    /* END SEGMENT SELECT         */
@RC00782 AH    CNT,@CH00060                                     02S0801
@DE00781 SLR   @03,@03                                          02S0801
         ICM   @03,3,SCNT(BUFAD)                                02S0801
         BCTR  @03,0                                            02S0801
         CR    CNT,@03                                          02S0801
         BNH   @DL00781                                         02S0801
@DC00781 DS    0H                                               02S0802
*            END;                      /* END VALID REF SECTION.     */
*          ELSE;                       /* NAME INVALID.              */
@RF00778 DS    0H                                               02S0804
*                ELSE                  /* NO REF SPECIFIED.          */
*                  IF GCMSET = ON × KWDUSED = ZERO              01S0804
*                    THEN              /* INSUFFICIENT KEYWORDS.     */
         B     @RC00777                                         01S0804
@RF00777 TM    GCMSET(BUFAD),B'00001000'                        01S0804
         BO    @RT00804                                         01S0804
         CLI   KWDUSED(BUFAD),0                                 01S0804
         BNE   @RF00804                                         01S0804
@RT00804 DS    0H                                               01S0805
*                      DO;             /*                            */
*                        MSGN = IEBA25I;/* SET ERROR MESSAGE.        */
         MVI   MSGN(BUFAD),X'19'                                01S0806
*                        CALL IEBIMSGS;/* PRINT IT.                  */
         L     @15,@CV00037                                     01S0807
         BALR  @14,@15                                          01S0807
*                        INHIBITW = ON;/* INHIBIT LIBRARY UPDATE     */
         OI    INHIBITW(BUFAD),B'01000000'                      01S0808
*                      END;            /*                            */
*                    ELSE;             /*                            */
@RF00804 DS    0H                                               01S0811
*              IF ASGNSET = ON         /* CHECK FOR ASSIGN KEYWORD.  */
*                THEN                  /*                            */
@RC00777 TM    ASGNSET(BUFAD),B'00000100'                       01S0811
         BNO   @RF00811                                         01S0811
*                  DO;                 /* BUILD A CHARACTER.         */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL INTERROGATE DATA CARDS AND BUILD A GRAPHIC      *
**  CHARACTER THEREFROM.                                              *
**                                                                    *
**********************************************************************/
*        RESPECIFY (BUFFPTR,SHIFT,SHIFT2) RESTRICTED;           02S0813
*        BUFFPTR = ADDR(MODBOD);       /* GET MODULE ADDRESS.        */
         LA    BUFFPTR,MODBOD(,BUFAD)                           02S0814
*        CNT = SEGCNT + ONE;           /* GET NUMBER FOR THIS SEG.   */
         LA    CNT,1                                            02S0815
         AH    CNT,SEGCNT(,BUFAD)                               02S0815
*        ASGNSAVE = ASGNSAVE && ASGNSAVE;/* CLEAR LINE USED IND AREA.*/
         XC    ASGNSAVE+796(256,BUFAD),ASGNSAVE+796(BUFAD)      02S0816
*        GASNMT = ASGNMENT;            /* SET ASSIGNMENT BYTE.       */
         LR    @07,CNT                                          02S0817
         MH    @07,@CH00610                                     02S0817
         AL    @07,@CF01891                                     02S0817
         LA    @07,GRAFBOD(@07,BUFFPTR)                         02S0817
         MVC   GASNMT(1,@07),ASGNMENT(BUFAD)                    02S0817
*        IF PITCH = FIFTN              /* CHECK FOR 15 PITCH         */
*          THEN                        /*                            */
         CLI   PITCH(BUFAD),15                                  02S0818
         BNE   @RF00818                                         02S0818
*            RASTER(ONE) = FFTNP;      /* SET PITCH AND PARITY 15.   */
         MVC   RASTER(3,@07),@CB00801                           02S0819
*          ELSE                        /*                            */
*            IF PITCH = TWELV          /* CHECK FOR TWELVE PITCH.    */
*              THEN                    /*                            */
         B     @RC00818                                         02S0820
@RF00818 CLI   PITCH(BUFAD),12                                  02S0820
         BNE   @RF00820                                         02S0820
*                RASTER(ONE) = TWLVP;  /* SET PITCH AND PARITY 12.   */
         LR    @07,CNT                                          02S0821
         MH    @07,@CH00610                                     02S0821
         AL    @07,@CF01891                                     02S0821
         LA    @07,GRAFBOD(@07,BUFFPTR)                         02S0821
         MVC   RASTER(3,@07),@CB00803                           02S0821
*              ELSE                    /* MUST BE 10 PITCH           */
*                RASTER(ONE) = TENP;   /* SET PITCH AND PARITY 10.   */
         B     @RC00820                                         02S0822
@RF00820 LR    @07,CNT                                          02S0822
         MH    @07,@CH00610                                     02S0822
         AL    @07,@CF01891                                     02S0822
         LA    @07,GRAFBOD(@07,BUFFPTR)                         02S0822
         MVC   RASTER(3,@07),@CB00805                           02S0822
*        MVC(GRSPAT(FOUR:LENGTH(GRSPAT)),     /*                     */
*            GRSPAT(ONE:LENGTH(GRSPAT)-THREE));/*                    */
@RC00820 DS    0H                                               02S0823
@RC00818 LR    @07,CNT                                          02S0823
         MH    @07,@CH00610                                     02S0823
         AL    @07,@CF01891                                     02S0823
         LA    @07,GRAFBOD(@07,BUFFPTR)                         02S0823
         MVC   GRSPAT+3(69,@07),GRSPAT(@07)                     02S0823
*        LASTQ = OFF;                  /* RESET GET OUT SWITCH.      */
         NI    LASTQ(BUFAD),B'11111110'                         02S0824
*        DO                            /* START BUILDING CHARACTER.  */
*         WHILE EOFFLG = OFF           /* STOP ON LAST DATA CARD.    */
*             & LASTQ = OFF;           /*                            */
         B     @DE00825                                         02S0825
@DL00825 DS    0H                                               02S0826
*          IF CARDIN = ON              /* CHECK FOR CARD ALREADY     */
*            THEN                      /*  IN BUFFER.                */
         TM    CARDIN(BUFAD),B'00100000'                        02S0826
         BNO   @RF00826                                         02S0826
*              CARDIN = OFF;           /* USE CARD IN BUFFER.        */
         NI    CARDIN(BUFAD),B'11011111'                        02S0827
*            ELSE                      /*                            */
*              GEN REFS(SYSIN)         /* GET A NEW CARD.            */
*                  SETS(SDRYCARD) FLOWS(EODAD)                  02S0828
*               (GET SYSIN,SDRYCARD(BUFAD));                    02S0828
         B     @RC00826                                         02S0828
@RF00826 DS    0H                                               02S0828
         GET SYSIN,SDRYCARD(BUFAD)
*          IF IDENT = SEQ              /* DATA CARD IDENTIFIER IS    */
*            THEN                      /*  SEQ=                      */
@RC00826 CLC   IDENT(4,BUFAD),@CC00819                          02S0829
         BNE   @RF00829                                         02S0829
*              DO;                     /*                            */
*                SPACE = SINGL;        /* SET SINGLE PRINT SPACE.    */
         MVI   SPACE(BUFAD),C' '                                02S0831
*                MSGTXT = SDRYCARD;    /* SET CARD TO PRINT.         */
         MVI   MSGTXT+80(BUFAD),C' '                            02S0832
         MVC   MSGTXT+81(39,BUFAD),MSGTXT+80(BUFAD)             02S0832
         MVC   MSGTXT(80,BUFAD),SDRYCARD(BUFAD)                 02S0832
*                GEN REFS(SYSPRINT,MSG)/* PRINT DATA CARD.           */
*                 (PUT  SYSPRINT,MSG(,BUFAD));                  02S0833
         PUT  SYSPRINT,MSG(,BUFAD)
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL CONVERT NON BLANK COLUMNS IN THE DATA CARDS     *
**  TO BITS OF THE RASTER SCAN PATTERN.                               *
**                                                                    *
**********************************************************************/
*        UWORK = SEQNO;                /* SET SEQUENCE NUMBER IN     */
         MVC   UWORK(2,BUFAD),SEQNO(BUFAD)                      03S0834
*        IF UWORK(ONE) =< CHAR2        /*  WORK AREA THEN TEST TO    */
*         & UWORK(ONE) => CHAR0        /*  INSURE THAT IT IS INDEED  */
*         & UWORK(TWO) =< CHAR9        /*  A NUMBER BETWEEN ZERO     */
*         & UWORK(TWO) => CHAR0        /*  AND TWENTY-NINE.          */
*          THEN                        /*                            */
         CLI   UWORK(BUFAD),C'2'                                03S0835
         BH    @RF00835                                         03S0835
         CLI   UWORK(BUFAD),C'0'                                03S0835
         BL    @RF00835                                         03S0835
         CLI   UWORK+1(BUFAD),C'9'                              03S0835
         BH    @RF00835                                         03S0835
         CLI   UWORK+1(BUFAD),C'0'                              03S0835
         BL    @RF00835                                         03S0835
*            DO;                       /* YES, IT IS PATH.           */
*              SHIFT2 = -ONE;          /* INITIALIZE BIT LENDER.     */
         SLR   SHIFT2,SHIFT2                                    03S0837
         BCTR  SHIFT2,0                                         03S0837
*              SHIFT = ZERO;           /* INITIALIZE BIT BORROWER.   */
         SLR   SHIFT,SHIFT                                      03S0838
*              PACK(DWORK,UWORK);      /* MAKE SEQUENCE              */
         PACK  DWORK(8,BUFAD),UWORK(2,BUFAD)                    03S0839
*              CVB(FWORK,DWORK);       /*  NUMBER BINARY.            */
         CVB   @07,DWORK(,BUFAD)                                03S0840
         ST    @07,FWORK(,BUFAD)                                03S0840
*              IF FWORK ^= ZERO        /* NOW CHECK THAT NUMBER IS   */
*               & FWORK =< DIM(RASTER) /*  BETWEEN 1 AND 24 AND HAS  */
*               & DEL(FWORK) = ZERO    /*  NOT BEEN USED BEFORE.     */
*                THEN                  /*                            */
         SLR   @03,@03                                          03S0841
         CR    @07,@03                                          03S0841
         BE    @RF00841                                         03S0841
         CH    @07,@CH00053                                     03S0841
         BH    @RF00841                                         03S0841
         LA    @15,796                                          03S0841
         ALR   @15,BUFAD                                        03S0841
         LA    @01,0(@07,@15)                                   03S0841
         BCTR  @01,0                                            03S0841
         SLR   @00,@00                                          03S0841
         IC    @00,DEL(,@01)                                    03S0841
         CR    @03,@00                                          03S0841
         BNE   @RF00841                                         03S0841
*                  DO;                 /* INDICATE ONE RASTER SCAN.  */
*                    SETRAS = ON;      /*                            */
         OI    SETRAS(BUFAD),B'00000010'                        03S0843
*                    DEL(FWORK) = ALBIT;/* INDICATE USED SEQ NUMBER. */
         ALR   @15,@07                                          03S0844
         BCTR  @15,0                                            03S0844
         MVI   DEL(@15),X'FF'                                   03S0844
*                    DO                /* START BIT BUILDER.         */
*                     XCNT = ONE       /*                            */
*                     TO DIM(RASDATA); /* SCAN 18 BITS               */
         LA    XCNT,1                                           03S0845
@DL00845 DS    0H                                               03S0846
*                      IF RASDATA(XCNT) ^= BLANK                03S0846
*                        THEN          /* NON BLANK IS BIT TIME      */
         LR    @07,BUFAD                                        03S0846
         ALR   @07,XCNT                                         03S0846
         CLI   RASDATA-1(@07),C' '                              03S0846
         BE    @RF00846                                         03S0846
*                          DO;         /* BORROW A BIT               */
*                            SLDA(SHIFT,ONE);                   03S0848
         SLDA  SHIFT,1                                          03S0848
*                            IF XCNT > LENGTH(BITPAT1)          03S0849
*                              THEN    /* FLIP PARITY BIT 2.         */
         CH    XCNT,@CH00032                                    03S0849
         BNH   @RF00849                                         03S0849
*                                PITPAR = PITPAR && FLIPIT2;    03S0850
         L     @07,FWORK(,BUFAD)                                03S0850
         MH    @07,@CH00111                                     03S0850
         LR    @15,CNT                                          03S0850
         MH    @15,@CH00610                                     03S0850
         AL    @15,@CF01891                                     03S0850
         LA    @15,GRAFBOD(@15,BUFFPTR)                         03S0850
         BCTR  @15,0                                            03S0850
         BCTR  @15,0                                            03S0850
         LA    @07,RASTER-1(@07,@15)                            03S0850
         XI    PITPAR+2(@07),X'04'                              03S0850
*                              ELSE    /* FLIP PARITY BIT 1.         */
*                                PITPAR = PITPAR && FLIPIT1;    03S0851
         B     @RC00849                                         03S0851
@RF00849 L     @07,FWORK(,BUFAD)                                03S0851
         MH    @07,@CH00111                                     03S0851
         LR    @15,CNT                                          03S0851
         MH    @15,@CH00610                                     03S0851
         AL    @15,@CF01891                                     03S0851
         LA    @15,GRAFBOD(@15,BUFFPTR)                         03S0851
         BCTR  @15,0                                            03S0851
         BCTR  @15,0                                            03S0851
         LA    @07,RASTER-1(@07,@15)                            03S0851
         XI    PITPAR+2(@07),X'08'                              03S0851
*                          END;        /*                            */
*                        ELSE          /* NO BIT BORROWED.           */
*                          SLL(SHIFT,ONE);/* JUST MOVE OVER.         */
         B     @RC00846                                         03S0853
@RF00846 SLL   SHIFT,1                                          03S0853
*                    END;              /* END OF BIT BUILDER.        */
@RC00846 AH    XCNT,@CH00060                                    03S0854
         CH    XCNT,@CH00183                                    03S0854
         BNH   @DL00845                                         03S0854
*                    SLL(SHIFT,SIX);   /* ALIGN FOR 24 BITS.         */
         SLL   SHIFT,6                                          03S0855
*                    DWORK1 = SHIFT;   /* PREPARE TO COMBINE.        */
         ST    SHIFT,DWORK1(,BUFAD)                             03S0856
*                    RASTER(FWORK)     /* RASTER PITCH AND PARITY.   */
*                     = RASTER(FWORK) × DWORKB;                 03S0857
         L     @07,FWORK(,BUFAD)                                03S0857
         MH    @07,@CH00111                                     03S0857
         LR    @03,CNT                                          03S0857
         MH    @03,@CH00610                                     03S0857
         AL    @03,@CF01891                                     03S0857
         LA    @03,GRAFBOD(@03,BUFFPTR)                         03S0857
         ALR   @03,@07                                          03S0857
         BCTR  @03,0                                            03S0857
         BCTR  @03,0                                            03S0857
         OC    RASTER-1(3,@03),DWORKB(BUFAD)                    03S0857
*                  END;                /*                            */
*                ELSE                  /*                            */
*                  DO;                 /*                            */
         B     @RC00841                                         03S0859
@RF00841 DS    0H                                               03S0860
*                    MSGN = IEBA44I;   /* INVALID SEQUENCE NUMBER    */
         MVI   MSGN(BUFAD),X'2C'                                03S0860
*                    CALL IEBIMSGS;    /* PRINT IT                   */
         L     @15,@CV00037                                     03S0861
         BALR  @14,@15                                          03S0861
*                    INHIBITW = ON;    /* NO LIBRARY UPDATE          */
         OI    INHIBITW(BUFAD),B'01000000'                      03S0862
*                    END;              /*                            */
*            END;                      /*                            */
*          ELSE                        /* ERROR PATH.                */
*            DO;                       /*                            */
         B     @RC00835                                         03S0865
@RF00835 DS    0H                                               03S0866
*              MSGN = IEBA28I;         /* INVALID SEQUENCE NUMBER.   */
         MVI   MSGN(BUFAD),X'1C'                                03S0866
*              CALL IEBIMSGS;          /* SO PRINT IT.               */
         L     @15,@CV00037                                     03S0867
         BALR  @14,@15                                          03S0867
*              INHIBITW = ON;          /* NO WRITING ON LIBRARY      */
         OI    INHIBITW(BUFAD),B'01000000'                      03S0868
*            END;                      /*                            */
*              END;                    /*                            */
*            ELSE                      /* NOT A DATA CARD.           */
*              DO;                     /*                            */
         B     @RC00829                                         02S0871
@RF00829 DS    0H                                               02S0872
*                IF SETRAS = ON        /* CHECK IF ANY DATA CARDS.   */
*                  THEN                /*                            */
         TM    SETRAS(BUFAD),B'00000010'                        02S0872
         BNO   @RF00872                                         02S0872
*                    SEGCNT = CNT;     /* UPDATE SEGMENT COUNT.      */
         STH   CNT,SEGCNT(,BUFAD)                               02S0873
*                  ELSE                /*                            */
*                    DO;               /* MUST HAVE BEEN NO DATA     */
         B     @RC00872                                         02S0874
@RF00872 DS    0H                                               02S0875
*                      MSGN = IEBA31I; /*  CARDS.                    */
         MVI   MSGN(BUFAD),X'1F'                                02S0875
*                      CALL IEBIMSGS;  /* WRITE THAT MESSAGE.        */
         L     @15,@CV00037                                     02S0876
         BALR  @14,@15                                          02S0876
*                      INHIBITW = ON;  /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0877
*                    END;              /*                            */
*                LASTQ = ON;           /* SET GET OUT SWITCH.        */
@RC00872 OI    LASTQ(BUFAD),B'00000001'                         02S0879
*                CARDIN = ON;          /* INDICATE UNPROCESSED CARD  */
         OI    CARDIN(BUFAD),B'00100000'                        02S0880
*              END;                    /*  IN BUFFER.                */
*        END;                          /*                            */
@RC00829 DS    0H                                               02S0882
@DE00825 TM    EOFFLG(BUFAD),B'01000000'                        02S0882
         BNZ   @DC00825                                         02S0882
         TM    LASTQ(BUFAD),B'00000001'                         02S0882
         BZ    @DL00825                                         02S0882
@DC00825 DS    0H                                               02S0883
*        RESPECIFY (BUFFPTR,SHIFT,SHIFT2) UNRESTRICTED;         02S0883
*                  END;                /*                            */
*                ELSE;                 /* NO ASSIGN.                 */
@RF00811 DS    0H                                               01S0886
*            END;                      /*                            */
*          ELSE;                       /* SCAN IN PROGRESS IS OFF.   */
@RF00772 DS    0H                                               01S0888
*        INHIBITR = OFF;               /* RESET READ INHIBIT.        */
         NI    INHIBITR(BUFAD),B'11011111'                      01S0888
*        IF SEGCNT > MAXSEG            /* CHECK FOR BIG MODULE.      */
*          THEN                        /* MAKE A MESSAGE.            */
         LA    @15,64                                           01S0889
         CH    @15,SEGCNT(,BUFAD)                               01S0889
         BNL   @RF00889                                         01S0889
*            DO;                       /*                            */
*              SEGCNT = MAXSEG;        /* PRINT ONLY 64 SEGMENTS.    */
         STH   @15,SEGCNT(,BUFAD)                               01S0891
*              MSGN = IEBA07I;         /* MODULE TO LARGE.           */
         MVI   MSGN(BUFAD),X'07'                                01S0892
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     01S0893
         BALR  @14,@15                                          01S0893
*              INHIBITW = ON;          /* PREVENT LIBRARY UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      01S0894
*            END;                      /*                            */
*          ELSE;                       /* MODULE OK THUS FAR.        */
@RF00889 DS    0H                                               01S0897
*        MODCNT                        /* SET MODULE COUNT THUS FAR. */
*         = SEGCNT * LENGTH(GRAFSEG);                           01S0897
         LH    @15,SEGCNT(,BUFAD)                               01S0897
         MH    @15,@CH00610                                     01S0897
         STH   @15,MODCNT(,BUFAD)                               01S0897
*        IF NOKEY = ON                 /* NULL STATEMENT IS          */
*          THEN                        /*  A PRINT ONLY              */
         TM    NOKEY(BUFAD),B'01000000'                         01S0898
         BNO   @RF00898                                         01S0898
*            READMOD = ON;             /*   REQUEST.                 */
         OI    READMOD(BUFAD),B'00000001'                       01S0899
*        IF INHIBITW = ON              /* CHECK FOR ANY ERROR.       */
*          THEN                        /* RETURN CODE  = 8 THIS OP.  */
@RF00898 TM    INHIBITW(BUFAD),B'01000000'                      01S0900
         BNO   @RF00900                                         01S0900
*            RETSAVE = MAX(RETSAVE,RC8);                        01S0901
         SLR   @15,@15                                          01S0901
         IC    @15,RETSAVE(,BUFAD)                              01S0901
         LA    @14,8                                            01S0901
         CR    @15,@14                                          01S0901
         BNL   *+6
         LR    @15,@14                                          01S0901
         STC   @15,RETSAVE(,BUFAD)                              01S0901
*          ELSE;                       /*                            */
@RF00900 DS    0H                                               01S0903
*        GEN REFS(SAVE1)               /******************************/
*         (L  @13,SAVE1+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER   */
         L  @13,SAVE1+BACK(,BUFAD)
*  END GRAPHIC;                        /* RETURN TO CALLER.          */
@EL00007 DS    0H                                               01S0904
@EF00007 DS    0H                                               01S0904
@ER00007 LM    @14,@12,12(@13)                                  01S0904
         BR    @14                                              01S0904
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL INDICATE THAT AN INVALID OPERATION HAS          *
**  BEEN FOUND.                                                       *
**                                                                    *
**********************************************************************/
*INVOP:                                                         01S0905
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0905
INVOP    STM   @14,@12,12(@13)                                  01S0905
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        IF FMTERR = ON                /* CHECK FOR CONTROL CARD     */
*          THEN                        /*  FORMAT ERROR.             */
         TM    FMTERR(BUFAD),B'00001000'                        01S0907
         BNO   @RF00907                                         01S0907
*            DO;                       /*                            */
*              MSGN = IEBA17I;         /* CONTROL CARD ERROR.        */
         MVI   MSGN(BUFAD),X'11'                                01S0909
*              FMTERR = OFF;           /* RESET ERROR CONDITION.     */
         NI    FMTERR(BUFAD),B'11110111'                        01S0910
*            END;                      /*                            */
*          ELSE                        /* MUST BE OP CODE ERROR.     */
*            DO;                       /*                            */
         B     @RC00907                                         01S0912
@RF00907 DS    0H                                               01S0913
*                                      /* ADDR OF BAD OP CODE.       */
*              EDITDATA(ONE) = ADDR(CARDDATA);                  01S0913
         LA    @15,CARDDATA(,BUFAD)                             01S0913
         STCM  @15,7,EDITDATA(BUFAD)                            01S0913
*                                      /* MAX OF 8 BYTES TO EDIT.    */
*              EDITLEN(ONE) = MIN(EIGHT,PARMSIZE);              01S0914
         SLR   @15,@15                                          01S0914
         ICM   @15,3,PARMSIZE(BUFAD)                            01S0914
         LA    @14,8                                            01S0914
         CR    @15,@14                                          01S0914
         BNH   *+6
         LR    @15,@14                                          01S0914
         STC   @15,EDITLEN(,BUFAD)                              01S0914
*              MSGN = IEBA16I;         /* BAD OPERATION MESSAGE.     */
         MVI   MSGN(BUFAD),X'10'                                01S0915
*            END;                      /*                            */
*        CALL IEBIMSGS;                /* PRINT THE MESSAGE.         */
@RC00907 L     @15,@CV00037                                     01S0917
         BALR  @14,@15                                          01S0917
*        SCANINP = OFF;                /* RESET SCAN IN PROGRESS.    */
         NI    SCANINP(BUFAD),B'10111111'                       01S0918
*        INHIBITW = ON;                /* PREVENT LIBRARY UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      01S0919
*        IF CONTINUE = ON              /* COULD BE MORE CARDS.       */
*          THEN                        /* NEED TO PURGE THEM.        */
         TM    CONTINUE(BUFAD),B'00001000'                      01S0920
         BNO   @RF00920                                         01S0920
*            CALL IEBISCAN;            /* LET SCAN DO IT.            */
         L     @15,@CV00036                                     01S0921
         BALR  @14,@15                                          01S0921
*          ELSE;                       /* NO CONTINUATION CARDS.     */
@RF00920 DS    0H                                               01S0923
*        KWDUSED = ZERO;               /* RESET KEYWORD INDICATORS.  */
         MVI   KWDUSED(BUFAD),X'00'                             01S0923
*        RETSAVE = MAX(RETSAVE,RC8);   /* SET RC = 8 THIS OPERATION. */
         SLR   @15,@15                                          01S0924
         IC    @15,RETSAVE(,BUFAD)                              01S0924
         LA    @14,8                                            01S0924
         CR    @15,@14                                          01S0924
         BNL   *+6
         LR    @15,@14                                          01S0924
         STC   @15,RETSAVE(,BUFAD)                              01S0924
*        GEN REFS(SAVE1)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE1+BACK(,BUFAD)); /*                            */
         L  @13,SAVE1+BACK(,BUFAD)
*  END INVOP;                          /* RETURN TO CALLER.          */
@EL00008 DS    0H                                               01S0926
@EF00008 DS    0H                                               01S0926
@ER00008 LM    @14,@12,12(@13)                                  01S0926
         BR    @14                                              01S0926
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE COMPLETES EACH FUNCTION. NORMAL ENTRY IS WITH A      *
**  VALID ACTIVE OPERATION AND THE NEXT OPERATION REQUESTED IS NAME.  *
**  IF THE ACTIVE OPERATION HAS BUILT A MODULE FROM THE KEYWORDS      *
**  PROVIDED A MEMBER WILL BE WRITTEN TO THE LIBRARY AND PRINTED.     *
**  UPON ANY TYPE OF ERROR ENTRY, AN ATTEMPT TO PRINT ONLY WILL BE    *
**  MADE.                                                             *
**                                                                    *
**********************************************************************/
*NAME:                                                          01S0927
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S0927
NAME     STM   @14,@12,12(@13)                                  01S0927
*        GEN REFS(SAVE1);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE1+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE1(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        OPINPRG = OFF;                /* RESET OPERATION IN PROGRESS*/
         NI    OPINPRG(BUFAD),B'11111101'                       01S0929
*        IF INHIBLIB = ON              /* CHECK PERMANENT LIBRARY    */
*          THEN                        /*  RESTRICTION.              */
         TM    INHIBLIB(BUFAD),B'00010000'                      01S0930
         BNO   @RF00930                                         01S0930
*            INHIBIT = ONNER;          /* PROHIBIT LIBRARY ACCESS.   */
         OI    INHIBIT(BUFAD),B'01100000'                       01S0931
*        IF NOWRITE = ON               /* CHECK FOR WRITE PROHIBITION*/
*          THEN                        /*                            */
@RF00930 TM    NOWRITE(BUFAD),B'00000100'                       01S0932
         BNO   @RF00932                                         01S0932
*            INHIBITW = ON;            /* DO NOT ALLOW WRITE THIS OP.*/
         OI    INHIBITW(BUFAD),B'01000000'                      01S0933
*        IF ACTIVOP ^= NAMEOP          /* NORMAL ENTRY IS WITH       */
*          THEN                        /*  A VALID OPERATION.        */
@RF00932 CLC   ACTIVOP(1,BUFAD),NAMEOP                          01S0934
         BE    @RF00934                                         01S0934
*            DO;                       /*                            */
*              IF NEXTOP = NAMEOP      /* NEXT CARD SHOULD BE A      */
*                THEN                  /*  NAME CONTROL CARD.        */
         CLC   NEXTOP(1,BUFAD),NAMEOP                           01S0936
         BNE   @RF00936                                         01S0936
*                  IF SCANINP = ON     /* NEED MODULE NAME.          */
*                    THEN              /*                            */
         TM    SCANINP(BUFAD),B'01000000'                       01S0937
         BNO   @RF00937                                         01S0937
*                      CALL IEBISCAN;  /* SCAN FOR MODULE NAME.      */
         L     @15,@CV00036                                     01S0938
         BALR  @14,@15                                          01S0938
*                    ELSE;             /*                            */
@RF00937 DS    0H                                               01S0940
*                ELSE;                 /*                            */
@RF00936 DS    0H                                               01S0941
*              IF NAMESET = OFF        /* CHECK FOR ANY NAME.        */
*                THEN                  /*                            */
         TM    NAMESET(BUFAD),B'10000000'                       01S0941
         BNZ   @RF00941                                         01S0941
*                      DO;             /*                            */
*                        INHIBIT=ONNER;/* RESTRICT LIBRARY ACCESS.   */
         OI    INHIBIT(BUFAD),B'01100000'                       01S0943
*                        BNAME = NONAM;/* INSERT NONAME.             */
         MVI   BNAME+6(BUFAD),C' '                              01S0944
         MVI   BNAME+7(BUFAD),C' '                              01S0944
         MVC   BNAME(6,BUFAD),@CC00823                          01S0944
*                        MSGN = IEBA08I;/* NO NAME SPECIFIED.        */
         MVI   MSGN(BUFAD),X'08'                                01S0945
*                        CALL IEBIMSGS;/* PRINT THE MESSAGE.         */
         L     @15,@CV00037                                     01S0946
         BALR  @14,@15                                          01S0946
*                        RETSAVE =     /* SET RC = 8 THIS OPERATION. */
*                         MAX(RETSAVE,RC8);                     01S0947
         SLR   @15,@15                                          01S0947
         IC    @15,RETSAVE(,BUFAD)                              01S0947
         LA    @14,8                                            01S0947
         CR    @15,@14                                          01S0947
         BNL   *+6
         LR    @15,@14                                          01S0947
         STC   @15,RETSAVE(,BUFAD)                              01S0947
*                      END;            /*                            */
*                ELSE;                 /* GOT A NAME.                */
@RF00941 DS    0H                                               01S0950
*              IF READMOD = ON         /* CHECK FOR PRINT ONLY FOR   */
*                THEN                  /*  ACTIVE OPERATION.         */
         TM    READMOD(BUFAD),B'00000001'                       01S0950
         BNO   @RF00950                                         01S0950
*                                      /* BRING IN REQUESTED MODULE. */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL CAUSE A MODULE TO BE BROUGHT INTO STORAGE       *
**  FROM THE LIBRARY TO BE PRINTED.                                   *
**                                                                    *
**********************************************************************/
*                                                               02S0951
*       DO;                                                     02S0951
*        IF INCLSW = ON                /* CHECK FOR INCLUDE.         */
*          THEN                        /* IT IS INVALID.             */
         TM    INCLSW(BUFAD),B'00100000'                        02S0952
         BNO   @RF00952                                         02S0952
*            DO;                       /*                            */
*              MSGN = IEBA13I;         /* SET MESSAGE NUMBER.        */
         MVI   MSGN(BUFAD),X'0D'                                02S0954
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     02S0955
         BALR  @14,@15                                          02S0955
*              RETSAVE =               /* SET RETURN CODE 4          */
*               MAX(RETSAVE,RC4);      /*  FOR THIS OPERATION.       */
         SLR   @15,@15                                          02S0956
         IC    @15,RETSAVE(,BUFAD)                              02S0956
         LA    @14,4                                            02S0956
         CR    @15,@14                                          02S0956
         BNL   *+6
         LR    @15,@14                                          02S0956
         STC   @15,RETSAVE(,BUFAD)                              02S0956
*            END;                      /*                            */
*          ELSE;                       /* CONTINUE.                  */
@RF00952 DS    0H                                               02S0959
*        IF INHIBITR = OFF             /* READING OF LIBRARY MAY     */
*          THEN                        /*  HAVE BEEN PREVENTED.      */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0959
         BNZ   @RF00959                                         02S0959
*            IF BSUFIX(ONE)=SPLAT      /* SPEC MOD REQUEST           */
*              THEN                    /*  CAN ONLY                  */
         CLI   BSUFIX(BUFAD),C'*'                               02S0960
         BNE   @RF00960                                         02S0960
*                DO;                   /*                            */
*                  BSUFIX = BLANK;     /* SET FOR BIG MODULE.        */
         MVI   BSUFIX+1(BUFAD),C' '                             02S0962
         MVC   BSUFIX+2(2,BUFAD),BSUFIX+1(BUFAD)                02S0962
         MVI   BSUFIX(BUFAD),C' '                               02S0962
*                  CALL LOADLIB;       /* LOAD SPECIAL MODULE.       */
         BAL   @14,LOADLIB                                      02S0963
*                END;                  /*                            */
*              ELSE                    /* NORMAL REQUEST.            */
*                DO;                   /*                            */
         B     @RC00960                                         02S0965
@RF00960 DS    0H                                               02S0966
*                  CALL BLDL;          /* FIND THE MEMBER.           */
         BAL   @14,BLDL                                         02S0966
*                  IF INHIBITR = OFF   /* CHECK FOR GOOD FIND.       */
*                    THEN              /*                            */
         TM    INHIBITR(BUFAD),B'00100000'                      02S0967
         BNZ   @RF00967                                         02S0967
*                      CALL READLIB;   /* READ THE MODULE.           */
         BAL   @14,READLIB                                      02S0968
*                    ELSE              /* MUST HAVE BEEN ERROR.      */
*                      INHIBITP = ON;  /* DO NOT PRINT MODULE.       */
         B     @RC00967                                         02S0969
@RF00967 OI    INHIBITP(BUFAD),B'00010000'                      02S0969
*                END;                  /*                            */
*          ELSE                        /* DID NOT FILL BUFFER.       */
*            INHIBITP = ON;            /* PREVENT PRINTING MODULE.   */
         B     @RC00959                                         02S0971
@RF00959 OI    INHIBITP(BUFAD),B'00010000'                      02S0971
*       INHIBITW = ON;                 /* INHIBIT WRITE ALWAYS.      */
@RC00959 OI    INHIBITW(BUFAD),B'01000000'                      02S0972
*       END;                           /*                            */
*                ELSE;                 /* UPDATE REQUESTED.          */
@RF00950 DS    0H                                               01S0975
*              IF INHIBITP = OFF                                01S0975
*               & CHKPTR(ACTIVOP) ^= ZERO                       01S0975
*               & (MODCNT ^= ZERO      /* CHECK FOR A MODULE.        */
*                 × (READMOD = ON & BNAME = BIGGRAF))           01S0975
*                THEN                                           01S0975
         TM    INHIBITP(BUFAD),B'00010000'                      01S0975
         BNZ   @RF00975                                         01S0975
         SLR   @15,@15                                          01S0975
         IC    @15,ACTIVOP(,BUFAD)                              01S0975
         MH    @15,@CH00053                                     01S0975
         ICM   @01,7,OPTABAD(BUFAD)                             01S0975
         AL    @01,@CF01896                                     01S0975
         L     @15,CHKPTR-9(@15,@01)                            01S0975
         LA    @15,0(,@15)                                      01S0975
         LTR   @15,@15                                          01S0975
         BZ    @RF00975                                         01S0975
         ICM   @15,3,MODCNT(BUFAD)                              01S0975
         BNZ   @RT00975                                         01S0975
         TM    READMOD(BUFAD),B'00000001'                       01S0975
         BNO   @RF00975                                         01S0975
         CLC   BNAME(8,BUFAD),@CC00837                          01S0975
         BNE   @RF00975                                         01S0975
@RT00975 DS    0H                                               01S0976
*                  CALL CHKMOD;        /* TEST MODULE FOR VALIDITY.  */
         SLR   @14,@14                                          01S0976
         IC    @14,ACTIVOP(,BUFAD)                              01S0976
         MH    @14,@CH00053                                     01S0976
         ICM   @01,7,OPTABAD(BUFAD)                             01S0976
         AL    @01,@CF01896                                     01S0976
         L     @15,CHKPTR-9(@14,@01)                            01S0976
         LA    @15,0(,@15)                                      01S0976
         BALR  @14,@15                                          01S0976
*                ELSE;                 /*                            */
@RF00975 DS    0H                                               01S0978
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL INSURE THE LIBRARY IS OPENED FOR WRITING.       *
**                                                                    *
**********************************************************************/
*        DO;                           /*                            */
*          IF INHIBITW = OFF           /* CHECK FOR PERMISSION TO    */
*            THEN                      /*  OPEN FOR WRITE.           */
         TM    INHIBITW(BUFAD),B'01000000'                      02S0979
         BNZ   @RF00979                                         02S0979
*              DO;                     /*                            */
*                DCBPTR = UTOUTAD;     /* ADDRESS OF WRITE DCB.      */
         L     DCBPTR,UTOUTAD(,BUFAD)                           02S0981
*                IF DCBOFOPN = OFF     /* DCB MAY BE OPEN ALREADY.   */
*                  THEN                /*                            */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  02S0982
         BNZ   @RF00982                                         02S0982
*                    DO;               /* NOT THIS TIME.             */
*                      GEN SETS(SYSUTOUT) FLOWS(BKSZFIX) /* OPEN FOR */
*                       (OPEN (SYSUTOUT,OUTPUT)); /*  LIBRARY WRITE. */
         OPEN (SYSUTOUT,OUTPUT)
*                      IF NOWRITE = OFF           /*                 */
*                       & DCBOFOPN = OFF          /* CHECK FOR OPEN  */
*                        THEN                     /*  SUCCESSFUL     */
         TM    NOWRITE(BUFAD),B'00000100'                       02S0985
         BNZ   @RF00985                                         02S0985
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  02S0985
         BNZ   @RF00985                                         02S0985
*                          DO;                    /* NO.             */
*                            INHIBITW = ON;       /* PREVENT WRITING */
         OI    INHIBITW(BUFAD),B'01000000'                      02S0987
*                            NOWRITE = ON;        /* NOW AND FOREVER */
         OI    NOWRITE(BUFAD),B'00000100'                       02S0988
*                            MSGN = IEBA20I;      /* NOT OPEN MESSAGE*/
         MVI   MSGN(BUFAD),X'14'                                02S0989
*                            EDITDATA(ONE)        /* DDNAME          */
*                             =ADDR(DDNAMES(FOUR));/* FOR MESSAGE    */
         LA    @15,DDNAMES+24(,BUFAD)                           02S0990
         STCM  @15,7,EDITDATA(BUFAD)                            02S0990
*                            EDITLEN(ONE)         /*                 */
*                             = LENGTH(DCBDDNAM); /*                 */
         MVI   EDITLEN(BUFAD),X'08'                             02S0991
*                            CALL IEBIMSGS;       /* PRINT IT        */
         L     @15,@CV00037                                     02S0992
         BALR  @14,@15                                          02S0992
*                            RETSAVE = RC12;      /* RETURN CODE 12. */
         MVI   RETSAVE(BUFAD),X'0C'                             02S0993
*                          END;        /*                            */
*                        ELSE;         /* OPEN SUCCESSFUL.           */
@RF00985 DS    0H                                               02S0996
*                    END;              /*                            */
*                  ELSE;               /* ALREADY OPEN.              */
@RF00982 DS    0H                                               02S0998
*              END;                    /*                            */
*            ELSE;                     /* NO NEED TO TRY             */
@RF00979 DS    0H                                               02S1000
*        END;                          /*                            */
*              IF INHIBITW = OFF       /* WRITING OF LIB MAY BE      */
*                THEN                  /*  PREVENTED.                */
         TM    INHIBITW(BUFAD),B'01000000'                      01S1001
         BNZ   @RF01001                                         01S1001
*                  DO;                 /* WRITE A MODULE ON LIBRARY. */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL WRITE THE INDICATED MODULE ON THE LIBRARY.      *
**  THE WRITE OPERATION WILL BE CHECKED FOR SUCCESSFULL COMPLETION    *
**  THEN THE DIRECTORY WILL BE UPDATED WITH THE NEW MEMBER            *
**  INFORMATION. ANY WRITE ERRORS WILL CAUSE THE SYNAD ROUTINE TO     *
**  BE INVOKED.                                                       *
**                                                                    *
***********************************************************************
*                                                               02S1003
*        IF REPUSE = OFF               /* TEST REPLACE OPTION.       */
*          THEN                        /* SEE IF MODULE EXISTS.      */
         TM    REPUSE(BUFAD),B'10000000'                        02S1003
         BNZ   @RF01003                                         02S1003
*            DO;                       /*                            */
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT ISSUES A BLDL FOR THE MEMBER REQUESTED AND IF        *
**  THERE IS AN ERROR THE APPROPRIATE MESSAGE WILL BE PRINTED AND     *
**  WRITING OF THE LIBRARY WILL BE INHIBITED.                         *
**                                                                    *
**********************************************************************/
*        BFFLL = FFLLCON;              /* SET BLDL ENTRY NO. AND LEN.*/
         MVC   BFFLL(4,BUFAD),FFLLCON                           03S1005
*        GEN SETS(BLDLNTRY)            /* THE LIBRARY IS NOW SEARCHED*/
*            REFS(SYSUTIN);            /* FOR THE MEMBER REQUESTED.  */
         BLDL  SYSUTIN,BLDLNTRY(BUFAD) ISSUE BLDL.
*        RESPECIFY (RETCODE) RESTRICTED;                        03S1007
*        IF RETCODE ^= FOUR            /* NON ZERO RETURN CODE MEANS */
*          THEN                        /*  ERROR IN BLDL.            */
         CL    RETCODE,@CF00050                                 03S1008
         BE    @RF01008                                         03S1008
*            DO;                       /*                            */
*              IF RETCODE = ZERO       /* WAS MEMBER FOUND?          */
*                THEN                  /********** IEBA09I ***********/
         LTR   RETCODE,RETCODE                                  03S1010
         BNZ   @RF01010                                         03S1010
*                  DO;                 /* YES.                       */
*                    MSGN = IEBA09I;   /* MEMBER FOUND.              */
         MVI   MSGN(BUFAD),X'09'                                03S1012
*                    EDITDATA(ONE) =   /* SET DATA ADDRESS           */
*                     ADDR(BNAME);     /*  FOR MESSAGE.              */
         LA    @14,BNAME(,BUFAD)                                03S1013
         STCM  @14,7,EDITDATA(BUFAD)                            03S1013
*                    EDITLEN(ONE) =    /* SET DATA LENGTH            */
*                     LENGTH(BNAME);   /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'08'                             03S1014
*                    RETSAVE=MAX(RETSAVE,RC8);/* RC = 8 FOR THIS BLDL*/
         SLR   @14,@14                                          03S1015
         IC    @14,RETSAVE(,BUFAD)                              03S1015
         LA    @07,8                                            03S1015
         CR    @14,@07                                          03S1015
         BNL   *+6
         LR    @14,@07                                          03S1015
         STC   @14,RETSAVE(,BUFAD)                              03S1015
*                  END;                /******************************/
*              IF RETCODE = EIGHT      /* WAS THERE AN I/O ERROR?    */
*                THEN                  /********** IEBA04I ***********/
@RF01010 CL    RETCODE,@CF00048                                 03S1017
         BNE   @RF01017                                         03S1017
*                  DO;                 /* YES.                       */
*                    MSGN = IEBA04I;   /* I/O ERROR MESSAGE.         */
         MVI   MSGN(BUFAD),X'04'                                03S1019
*                    EDITDATA(ONE) =   /* SET DATA ADDRESS           */
*                     ADDR(DCTRY);     /*  FOR MESSAGE.              */
         LA    @14,@CC00862                                     03S1020
         STCM  @14,7,EDITDATA(BUFAD)                            03S1020
*                    EDITLEN(ONE) =    /* SET DATA LENGTH            */
*                     LENGTH(DCTRY);   /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'09'                             03S1021
*                    RETSAVE = RC12;   /* RC = 12 FOR THIS BLDL.     */
         MVI   RETSAVE(BUFAD),X'0C'                             03S1022
*                    ABNDFLG = ON;     /* TERMINATE UTILITY.         */
         OI    ABNDFLG(BUFAD),B'10000000'                       03S1023
*                  END;                /******************************/
*              INHIBITW = ON;          /* INHIBIT DISK READ.         */
@RF01017 OI    INHIBITW(BUFAD),B'01000000'                      03S1025
*              CALL IEBIMSGS;          /* GET MESSAGE.               */
         L     @15,@CV00037                                     03S1026
         BALR  @14,@15                                          03S1026
*            END;                      /*                            */
*        RESPECIFY (RETCODE) UNRESTRICTED;                      03S1028
@RF01008 DS    0H                                               03S1029
*            END;                      /* END BLDL FOR WRITE.        */
*          ELSE;                       /* NO NEED TO ISSUE BLDL.     */
@RF01003 DS    0H                                               02S1031
*        DNAME = BNAME;                /* SET MODULE NAME.           */
         MVC   DNAME(8,BUFAD),BNAME(BUFAD)                      02S1031
*        MODNAME = DSUFIX;             /* NAME TO HEADER.            */
         MVC   MODNAME(4,BUFAD),DSUFIX(BUFAD)                   02S1032
*        DCBPTR = UTOUTAD;             /* SET DCB ADDRESS FOR WRITE. */
         L     DCBPTR,UTOUTAD(,BUFAD)                           02S1033
*                                      /* SET MODULE LENGTH.         */
*        DSTOR = MODCNT + LENGTH(MODHEAD);                      02S1034
         LA    @05,8                                            02S1034
         SLR   @15,@15                                          02S1034
         ICM   @15,3,MODCNT(BUFAD)                              02S1034
         ALR   @05,@15                                          02S1034
         STCM  @05,7,DSTOR(BUFAD)                               02S1034
*        DATTRI = ATTCON;              /* MODULE ATTRIBUTES.         */
         MVC   DATTRI(2,BUFAD),@CB00869                         02S1035
*        DINDCT = INDCON;              /* MODULE INDICATORS.         */
         MVI   DINDCT(BUFAD),X'2C'                              02S1036
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL WRITE THE PROPER CESD RECORDS FOR OTHER         *
**  UTILITIES TO MAINTAIN THE MODULES CREATED BY THIS UTILITY.        *
**                                                                    *
**********************************************************************/
*        IF INHIBITW = OFF             /* CHECK PERMISSION TO WRITE. */
*          THEN                        /*                            */
         TM    INHIBITW(BUFAD),B'01000000'                      03S1037
         BNZ   @RF01037                                         03S1037
*            DO;                       /* START WRITING CESD RECORDS.*/
*              RESPECIFY (BUFFPTR) RESTRICTED;                  03S1039
*              BUFFPTR = ADDR(MSGSAVE);                         03S1040
         LR    BUFFPTR,BUFAD                                    03S1040
         AL    BUFFPTR,@CF01856                                 03S1040
         ST    BUFFPTR,@TF00001                                 03S1040
*              CESDID = CID;                                    03S1041
         MVI   CESDID(BUFFPTR),X'20'                            03S1041
*              CESDSP = ZERO;                                   03S1042
         SLR   @07,@07                                          03S1042
         STCM  @07,7,CESDSP(BUFFPTR)                            03S1042
*              CESDESDI = ONE;                                  03S1043
         MVC   CESDESDI(2,BUFFPTR),@CH00060                     03S1043
*              CESDCNT = LENGTH(CESDDATA);                      03S1044
         MVC   CESDCNT(2,BUFFPTR),@CH00116                      03S1044
*              CESDNAME = DNAME;                                03S1045
         MVC   CESDNAME(8,BUFFPTR),DNAME(BUFAD)                 03S1045
*              CESDTYPE = SD;                                   03S1046
         MVI   CESDTYPE(BUFFPTR),X'00'                          03S1046
*              CESDADDR = ZERO;                                 03S1047
         STCM  @07,7,CESDADDR(BUFFPTR)                          03S1047
*              CESDSEGN = ONE;                                  03S1048
         MVI   CESDSEGN(BUFFPTR),X'01'                          03S1048
*              CESDIDLN = DSTOR;                                03S1049
         STCM  @05,7,CESDIDLN(BUFFPTR)                          03S1049
*              DCBBLKSI = LENGTH(CESD);                         03S1050
         MVC   DCBBLKSI+52(2,DCBPTR),@CH00053                   03S1050
*              RESPECIFY (DB) RESTRICTED;                       03S1051
*              DB = ADDR(MSGSAVE);                              03S1052
         L     DB,@TF00001                                      03S1052
*              CALL WRITE;             /* WRITE FIRST CESD RECORD.   */
         BAL   @14,WRITE                                        03S1053
*              IF INHIBITW = OFF       /* CHECK FOR SUCCESSFULL      */
*                THEN                  /*  WRITE.                    */
         TM    INHIBITW(BUFAD),B'01000000'                      03S1054
         BNZ   @RF01054                                         03S1054
*                  DO;                                          03S1055
*                    RESPECIFY (R1) RESTRICTED;                 03S1056
*                    GEN REFS(SYSUTOUT)                         03S1057
*                     (NOTE  SYSUTOUT);                         03S1057
         NOTE  SYSUTOUT
*                    DTTRP = R1;                                03S1058
         STCM  R1,7,DTTRP(BUFAD)                                03S1058
*                    RESPECIFY (R1) UNRESTRICTED;               03S1059
*                    IDRID = IID;                               03S1060
         MVI   IDRID(BUFFPTR),X'80'                             03S1060
*                    IDRCNT = LENGTH(IDRZAP) + TWO;             03S1061
         MVI   IDRCNT(BUFFPTR),X'FA'                            03S1061
*                    IDRTYPE = ZAP;                             03S1062
         MVI   IDRTYPE(BUFFPTR),X'01'                           03S1062
*                    IDRZAP = IDRZAP && IDRZAP;                 03S1063
         XC    IDRZAP(248,BUFFPTR),IDRZAP(BUFFPTR)              03S1063
*                    DCBBLKSI = LENGTH(IDR);                    03S1064
         MVC   DCBBLKSI+52(2,DCBPTR),@CH01855                   03S1064
*                    CALL WRITE;       /* WRITE FIRST IDR RECORD.    */
         BAL   @14,WRITE                                        03S1065
*                    IF INHIBITW = OFF /* CHECK FOR SUCCESSFUL       */
*                      THEN            /*  WRITE.                    */
         TM    INHIBITW(BUFAD),B'01000000'                      03S1066
         BNZ   @RF01066                                         03S1066
*                        DO;                                    03S1067
*                          IDRCNT = LENGTH(IDR2DATA)+TWO;       03S1068
         MVI   IDRCNT(BUFFPTR),X'11'                            03S1068
*                          IDRTYPE = LK;                        03S1069
         MVI   IDRTYPE(BUFFPTR),X'02'                           03S1069
*                          IDR2PRNM = IMAGENAM;                 03S1070
         MVI   IDR2PRNM+9(BUFFPTR),C' '                         03S1070
         MVC   IDR2PRNM(9,BUFFPTR),IMAGENAM                     03S1070
*                          IDR2PRVM = VERSION;                  03S1071
         MVC   IDR2PRVM(2,BUFFPTR),VERSION                      03S1071
*                          IDR2DATE = TODAY;                    03S1072
         MVC   IDR2DATE(3,BUFFPTR),TODAY(BUFAD)                 03S1072
*                          DCBBLKSI = LENGTH(IDRINFO)+LENGTH(IDR2DATA);
         MVC   DCBBLKSI+52(2,DCBPTR),@CH00183                   03S1073
*                          CALL WRITE; /* WRITE SECOND IDR RECORD.   */
         BAL   @14,WRITE                                        03S1074
*                          IF INHIBITW = OFF /* CHECK FOR            */
*                            THEN      /*  SUCCESSFUL WRITE.         */
         TM    INHIBITW(BUFAD),B'01000000'                      03S1075
         BNZ   @RF01075                                         03S1075
*                              DO;                              03S1076
*                                IDRCNT = LENGTH(IDR3DATA)+TWO; 03S1077
         MVI   IDRCNT(BUFFPTR),X'14'                            03S1077
*                                IDRTYPE = TRAN;                03S1078
         MVI   IDRTYPE(BUFFPTR),X'84'                           03S1078
*                                IDR3ESDI = ESDID;              03S1079
         MVC   IDR3ESDI(2,BUFFPTR),@CB00709                     03S1079
*                                IDR3IND = ZERO;                03S1080
         MVI   IDR3IND(BUFFPTR),X'00'                           03S1080
*                                IDR3PRNM = IMAGENAM;           03S1081
         MVI   IDR3PRNM+9(BUFFPTR),C' '                         03S1081
         MVC   IDR3PRNM(9,BUFFPTR),IMAGENAM                     03S1081
*                                IDR3PRVM = VERSION;            03S1082
         MVC   IDR3PRVM(2,BUFFPTR),VERSION                      03S1082
*                                IDR3DATE = TODAY;              03S1083
         MVC   IDR3DATE(3,BUFFPTR),TODAY(BUFAD)                 03S1083
*                                DCBBLKSI = LENGTH(IDRINFO)     03S1084
*                                         + LENGTH(IDR3DATA);   03S1084
         MVC   DCBBLKSI+52(2,DCBPTR),@CH00358                   03S1084
*                                CALL WRITE;/* WRITE 3RD IDR RECORD. */
         BAL   @14,WRITE                                        03S1085
*                              END;                             03S1086
*                            ELSE;     /* WRITE ERROR.               */
@RF01075 DS    0H                                               03S1088
*                        END;                                   03S1088
*                      ELSE;           /* WRITE ERROR.               */
@RF01066 DS    0H                                               03S1090
*                  END;                                         03S1090
*                ELSE;                 /* WRITE ERROR.               */
@RF01054 DS    0H                                               03S1092
*            END;                                               03S1092
*          ELSE;                       /* WRITE INHIBITED.           */
@RF01037 DS    0H                                               03S1094
*        RESPECIFY (BUFFPTR) UNRESTRICTED;                      03S1094
*        IF INHIBITW = OFF             /* CHECK FOR PERMISSION.      */
*          THEN                        /*  TO WRITE ON LIBRARY.      */
         TM    INHIBITW(BUFAD),B'01000000'                      02S1095
         BNZ   @RF01095                                         02S1095
*            DO;                       /* UPDATE LIBRARY.            */
*              CALL WRBLOCK;           /* WRITE MODULE TO LIBRARY.   */
         BAL   @14,WRBLOCK                                      02S1097
*              IF INHIBITW = OFF       /* CHECK FOR PERMISSION       */
*                THEN                  /*  TO PROCEED.               */
         TM    INHIBITW(BUFAD),B'01000000'                      02S1098
         BNZ   @RF01098                                         02S1098
*                  DO;                 /* UPDATE DIRECTORY.          */
*                    RESPECIFY (RETCODE) RESTRICTED;            02S1100
*                    IF REPUSE = ON    /* CHECK FOR REPLACE OPTION.  */
*                      THEN            /* STOW WITH REPLACE.         */
         TM    REPUSE(BUFAD),B'10000000'                        02S1101
         BNO   @RF01101                                         02S1101
*                        GEN REFS(SYSUTOUT,DIRECTRY)            02S1102
*                         (STOW  SYSUTOUT,DIRECTRY(BUFAD),R);   02S1102
         STOW  SYSUTOUT,DIRECTRY(BUFAD),R
*                      ELSE            /* STOW WITHOUT REPLACE.      */
*                        GEN REFS(SYSUTOUT,DIRECTRY)            02S1103
*                         (STOW  SYSUTOUT,DIRECTRY(BUFAD),A);   02S1103
         B     @RC01101                                         02S1103
@RF01101 DS    0H                                               02S1103
         STOW  SYSUTOUT,DIRECTRY(BUFAD),A
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL CAUSE THE PROPER MESSAGE TO BE PRINTED FOR THE  *
**  LAST LIBRARY UPDATE.                                              *
**                                                                    *
**********************************************************************/
*                                                               03S1104
*        IF RETCODE = RC16             /* CHECK FOR I/O ERROR.       */
*          THEN                        /*                            */
@RC01101 CL    RETCODE,@CF00116                                 03S1104
         BNE   @RF01104                                         03S1104
*            DO;                       /*                            */
*              EDITDATA(ONE)=ADDR(DCTRY);                       03S1106
         LA    @14,@CC00862                                     03S1106
         STCM  @14,7,EDITDATA(BUFAD)                            03S1106
*              EDITLEN(ONE)=LENGTH(DCTRY);                      03S1107
         MVI   EDITLEN(BUFAD),X'09'                             03S1107
*              MSGN = IEBA04I;         /* I/O ERROR MESSAGE.         */
         MVI   MSGN(BUFAD),X'04'                                03S1108
*              RETSAVE = RC12;         /* SET RETURN CODE THIS OP.   */
         MVI   RETSAVE(BUFAD),X'0C'                             03S1109
*              NOWRITE = ON;           /* PREVENT FUTURE WRITING.    */
         OI    NOWRITE(BUFAD),B'00000100'                       03S1110
*            END;                      /*                            */
*          ELSE                        /* OTHER THAN I/O ERROR.      */
*            DO;                       /*                            */
         B     @RC01104                                         03S1112
@RF01104 DS    0H                                               03S1113
*              EDITDATA(ONE)=ADDR(DNAME);                       03S1113
         LA    @14,DNAME(,BUFAD)                                03S1113
         STCM  @14,7,EDITDATA(BUFAD)                            03S1113
*              EDITLEN(ONE)=LENGTH(DNAME);                      03S1114
         MVI   EDITLEN(BUFAD),X'08'                             03S1114
*              IF RETCODE = ZERO       /* ZERO MEANS SUCCESS.        */
*                THEN                  /*                            */
         LTR   RETCODE,RETCODE                                  03S1115
         BNZ   @RF01115                                         03S1115
*                  DO;                 /*                            */
*                    MSGN = IEBA02I;   /* LIBRARY UPDATE MESSAGE.    */
         MVI   MSGN(BUFAD),X'02'                                03S1117
*                    IF REPUSE = ON    /* CHECK FOR REPLACE OPTION.  */
*                      THEN            /*                            */
         TM    REPUSE(BUFAD),B'10000000'                        03S1118
         BNO   @RF01118                                         03S1118
*                        DO;           /* EDIT MESSAGE SOMEMORE.     */
*                          EDITDATA(TWO)=ADDR(REPL);            03S1120
         LA    @14,@CC00860                                     03S1120
         STCM  @14,7,EDITDATA+4(BUFAD)                          03S1120
*                          EDITLEN(TWO)=LENGTH(REPL);           03S1121
         MVI   EDITLEN+4(BUFAD),X'08'                           03S1121
*                        END;          /*                            */
*                  END;                /* END RC = 0 CODE.           */
*                ELSE                  /*                            */
*                  IF RETCODE = RC4    /* CHECK FOR RETURN CODE 4.   */
*                    THEN              /* MODULE ALREADY THERE.      */
         B     @RC01115                                         03S1124
@RF01115 CL    RETCODE,@CF00050                                 03S1124
         BNE   @RF01124                                         03S1124
*                      DO;             /*                            */
*                        MSGN=IEBA09I; /* PRINT MEMBER THERE,        */
         MVI   MSGN(BUFAD),X'09'                                03S1126
*                        RETSAVE       /* SET RETURN CODE 8 THIS OP. */
*                         = MAX(RETSAVE,RC8);                   03S1127
         SLR   @14,@14                                          03S1127
         IC    @14,RETSAVE(,BUFAD)                              03S1127
         LA    @06,8                                            03S1127
         CR    @14,@06                                          03S1127
         BNL   *+6
         LR    @14,@06                                          03S1127
         STC   @14,RETSAVE(,BUFAD)                              03S1127
*                      END;            /*                            */
*                    ELSE              /*                            */
*                      IF RETCODE = RC8 /* CHECK FOR RETURN CODE = 8.*/
*                        THEN          /* MEMBER NOT FOUND.          */
         B     @RC01124                                         03S1129
@RF01124 CL    RETCODE,@CF00048                                 03S1129
         BNE   @RF01129                                         03S1129
*                          DO;         /* SO INDICATE.               */
*                            MSGN = IEBA10I;/* NOT FOUND MESSAGE.    */
         MVI   MSGN(BUFAD),X'0A'                                03S1131
*                            CALL IEBIMSGS; /* PRINT IT.             */
         L     @15,@CV00037                                     03S1132
         BALR  @14,@15                                          03S1132
*                            EDITDATA(ONE)=ADDR(DNAME);         03S1133
         LA    @14,DNAME(,BUFAD)                                03S1133
         STCM  @14,7,EDITDATA(BUFAD)                            03S1133
*                            EDITLEN(ONE)=LENGTH(DNAME);        03S1134
         MVI   EDITLEN(BUFAD),X'08'                             03S1134
*                            MSGN = IEBA02I;/* MEMBER ADDED MESSAGE. */
         MVI   MSGN(BUFAD),X'02'                                03S1135
*                          END;        /*                            */
*                        ELSE          /*                            */
*                          IF RETCODE = RC12                    03S1137
*                            THEN      /* CHECK RC = 12.             */
         B     @RC01129                                         03S1137
@RF01129 CL    RETCODE,@CF00035                                 03S1137
         BNE   @RF01137                                         03S1137
*                              DO;     /* NO DIRECTORY SPACE.        */
*                                MSGN = IEBA03I;                03S1139
         MVI   MSGN(BUFAD),X'03'                                03S1139
*                                RETSAVE = RC12;                03S1140
         MVI   RETSAVE(BUFAD),X'0C'                             03S1140
*                                NOWRITE = ON;/*PREVENT ANY WRITE.   */
         OI    NOWRITE(BUFAD),B'00000100'                       03S1141
*                              END;    /* END RETURN CODE 12 CODE.   */
*                            ELSE      /* MUST BE RETURN CODE 18.    */
*                              DO;     /* INSUFFICIENT STOW STORAGE. */
         B     @RC01137                                         03S1143
@RF01137 DS    0H                                               03S1144
*                                MSGN = IEBA47I;/* GET THE MESSAGE.  */
         MVI   MSGN(BUFAD),X'2F'                                03S1144
*                                RETSAVE = RC12;/* PREVENT           */
         MVI   RETSAVE(BUFAD),X'0C'                             03S1145
*                                NOWRITE = ON;  /*  FUTURE WRITE.    */
         OI    NOWRITE(BUFAD),B'00000100'                       03S1146
*                              END;    /*                            */
*              RESPECIFY (RETCODE) UNRESTRICTED;                03S1148
@RC01137 DS    0H                                               03S1148
@RC01129 DS    0H                                               03S1148
@RC01124 DS    0H                                               03S1148
@RC01115 DS    0H                                               03S1149
*            END;                      /* END STOW MESSAGE CODE.     */
*         CALL IEBIMSGS;               /* PRINT ANY MESSAGE REQUESTED*/
@RC01104 L     @15,@CV00037                                     03S1150
         BALR  @14,@15                                          03S1150
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL TEST THE NUMBER OF EXTENTS FOR THE LIBRARY      *
**  DATA SET. A MESSAGE WILL BE ISSUED IF THERE ARE MORE THAN ONE     *
**  EXTENT. THE READ LIBRARY DCB WILL BE CLOSED AND REOPENED IF       *
**  WRITING TO THE LIBRARY HAS CAUSED AN EXTENT TO BE CROSSED.        *
**                                                                    *
**********************************************************************/
*        IF DEBNMEXT > ONE             /* CHECK FOR MULTIPLE         */
*          THEN                        /*  EXTENTS.                  */
         L     @06,DEBPTR+40(,DCBPTR)                           03S1151
         CLI   DEBNMEXT(@06),1                                  03S1151
         BNH   @RF01151                                         03S1151
*            DO;                       /*                            */
*              MSGN = IEBA45I;         /* MULTIPLE EXTENT MESSAGE.   */
         MVI   MSGN(BUFAD),X'2D'                                03S1153
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S1154
         BALR  @14,@15                                          03S1154
*              RETSAVE =               /* SET RETURN CODE 4          */
*                MAX(RETSAVE,RC4);     /*  THIS OPERATION.           */
         SLR   @06,@06                                          03S1155
         IC    @06,RETSAVE(,BUFAD)                              03S1155
         LA    @05,4                                            03S1155
         CR    @06,@05                                          03S1155
         BNL   *+6
         LR    @06,@05                                          03S1155
         STC   @06,RETSAVE(,BUFAD)                              03S1155
*              IF DEBNMEXT > LIBEXT    /* CHECK FOR CROSSED EXTENTS. */
*                THEN                  /*                            */
         L     @06,DEBPTR+40(,DCBPTR)                           03S1156
         CLC   DEBNMEXT(1,@06),LIBEXT(BUFAD)                    03S1156
         BNH   @RF01156                                         03S1156
*                  DO;                 /*                            */
*                    LIBEXT = DEBNMEXT;/* SAVE NEW EXTENT NUMBER.    */
         MVC   LIBEXT(1,BUFAD),DEBNMEXT(@06)                    03S1158
*                    GEN SETS(SYSUTIN);/* CLOSE AND REOPEN READ DCB. */
                     CLOSE  (SYSUTIN)
                     OPEN (SYSUTIN,INPUT)
*                    DCBPTR = UTINAD;  /* POINT TO READ DCB.         */
         L     DCBPTR,UTINAD(,BUFAD)                            03S1160
*                    IF DCBOFOPN = OFF /* CHECK FOR SUCCESSFUL OPEN. */
*                      THEN            /*                            */
         TM    DCBOFOPN+40(DCBPTR),B'00010000'                  03S1161
         BNZ   @RF01161                                         03S1161
*                        DO;           /********** IEBA20I ***********/
*                          MSGN = IEBA20I;        /* SYSUT1 NOT OPEN.*/
         MVI   MSGN(BUFAD),X'14'                                03S1163
*                          EDITDATA(ONE)          /* EDIT IN         */
*                           =ADDR(DDNAMES(THREE));/*  DDNAME.        */
         LA    @06,DDNAMES+16(,BUFAD)                           03S1164
         STCM  @06,7,EDITDATA(BUFAD)                            03S1164
*                          EDITLEN(ONE)           /*                 */
*                           = LENGTH(DCBDDNAM);   /*                 */
         MVI   EDITLEN(BUFAD),X'08'                             03S1165
*                          CALL IEBIMSGS;         /* PRINT IT.       */
         L     @15,@CV00037                                     03S1166
         BALR  @14,@15                                          03S1166
*                          RETSAVE = RC16;        /* CAUSE UTILITY   */
         MVI   RETSAVE(BUFAD),X'10'                             03S1167
*                          ABNDFLG = ON;          /*  TO TERMINATE.  */
         OI    ABNDFLG(BUFAD),B'10000000'                       03S1168
*                        END;          /******************************/
*                      ELSE;           /* READ DCB OPEN SUCCESSFUL.  */
@RF01161 DS    0H                                               03S1171
*                  END;                /*                            */
*                ELSE;                 /* EXTENTS NOT CROSSED.       */
@RF01156 DS    0H                                               03S1173
*            END;                      /*                            */
*          ELSE;                       /* ONLY ONE EXTENT.           */
@RF01151 DS    0H                                               03S1175
*                  END;                /* END STOW CODE.             */
*                ELSE;                 /* ERROR ENTRY.               */
@RF01098 DS    0H                                               02S1177
*            END;                      /* END LIBRARY UPDATE.        */
*          ELSE;                       /* ENTERED WITH ERROR.        */
@RF01095 DS    0H                                               02S1179
*                  END;                /* END LIBRARY WRITE.         */
*                ELSE                  /* DO NO WRITING.             */
*                  IF READMOD = OFF    /* CHECK FOR NO WRITE ANYWAY. */
*                    THEN              /*                            */
         B     @RC01001                                         01S1180
@RF01001 TM    READMOD(BUFAD),B'00000001'                       01S1180
         BNZ   @RF01180                                         01S1180
*                      DO;             /*                            */
*                        MSGN=IEBA42I; /* LIBRARY NOT UPDATED.       */
         MVI   MSGN(BUFAD),X'2A'                                01S1182
*                        CALL IEBIMSGS;/* PRINT IT.                  */
         L     @15,@CV00037                                     01S1183
         BALR  @14,@15                                          01S1183
*                      END;            /*                            */
*                    ELSE;             /* MUST HAVE BEEN READ ONLY.  */
@RF01180 DS    0H                                               01S1186
*              IF INHIBITP = OFF       /* PRINTING COULD BE INHIBITED*/
*               & PRTPTR(ACTIVOP) ^= ZERO                       01S1186
*               & (MODCNT ^= ZERO      /* CHECK FOR A MODULE.        */
*                 × (READMOD = ON & BNAME = BIGGRAF))           01S1186
*                THEN                  /*                            */
@RC01001 TM    INHIBITP(BUFAD),B'00010000'                      01S1186
         BNZ   @RF01186                                         01S1186
         SLR   @06,@06                                          01S1186
         IC    @06,ACTIVOP(,BUFAD)                              01S1186
         MH    @06,@CH00053                                     01S1186
         ICM   @01,7,OPTABAD(BUFAD)                             01S1186
         AL    @01,@CF01897                                     01S1186
         L     @06,PRTPTR-13(@06,@01)                           01S1186
         LA    @06,0(,@06)                                      01S1186
         LTR   @06,@06                                          01S1186
         BZ    @RF01186                                         01S1186
         ICM   @06,3,MODCNT(BUFAD)                              01S1186
         BNZ   @RT01186                                         01S1186
         TM    READMOD(BUFAD),B'00000001'                       01S1186
         BNO   @RF01186                                         01S1186
         CLC   BNAME(8,BUFAD),@CC00837                          01S1186
         BNE   @RF01186                                         01S1186
@RT01186 DS    0H                                               01S1187
*                  CALL PRTMOD;        /* FORMAT AND PRINT MODULE.   */
         SLR   @06,@06                                          01S1187
         IC    @06,ACTIVOP(,BUFAD)                              01S1187
         MH    @06,@CH00053                                     01S1187
         ICM   @01,7,OPTABAD(BUFAD)                             01S1187
         AL    @01,@CF01897                                     01S1187
         L     @15,PRTPTR-13(@06,@01)                           01S1187
         LA    @15,0(,@15)                                      01S1187
         BALR  @14,@15                                          01S1187
*            END;                      /*                            */
*          ELSE                        /* ENTER HERE IF NO ACTIVE OP.*/
*            DO;                       /*                            */
         B     @RC00934                                         01S1189
@RF00934 DS    0H                                               01S1190
*              RETSAVE                 /* RETURN CODE 8 THIS OP.     */
*               = MAX(RETSAVE,RC8);    /*                            */
         SLR   @06,@06                                          01S1190
         IC    @06,RETSAVE(,BUFAD)                              01S1190
         LA    @15,8                                            01S1190
         CR    @06,@15                                          01S1190
         BNL   *+6
         LR    @06,@15                                          01S1190
         STC   @06,RETSAVE(,BUFAD)                              01S1190
*              MSGN = IEBA27I;         /* NO OPERATION DEFINED MSG.  */
         MVI   MSGN(BUFAD),X'1B'                                01S1191
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     01S1192
         BALR  @14,@15                                          01S1192
*            END;                      /*                            */
*        ACTIVOP = ZERO;               /* ACTIVE OPERATION COMPLETE. */
@RC00934 MVI   ACTIVOP(BUFAD),X'00'                             01S1194
*        KWDUSED = ZERO;               /* RESET KEYWORD INDICATORS.  */
         MVI   KWDUSED(BUFAD),X'00'                             01S1195
*        STATUS2 = ZERO;               /* RESET OPERATION STATUS.    */
         MVI   STATUS2(BUFAD),X'00'                             01S1196
*        STATUS3 = ZERO;               /* RESET SCAN STATUS.         */
         MVI   STATUS3(BUFAD),X'00'                             01S1197
*        STATUS4 = ZERO;               /* RESET MISC. STATUS.        */
         MVI   STATUS4(BUFAD),X'00'                             01S1198
*        IF LOADFLAG = ALBIT           /* CHECK FOR LOADED MODULE.   */
*          THEN                        /*                            */
         CLI   LOADFLAG(BUFAD),X'FF'                            01S1199
         BNE   @RF01199                                         01S1199
*            DO;                       /* DELETE LOADED MODULE.      */
*              GEN REFS(LOADNAME)      /*                            */
*               (DELETE  EPLOC=LOADNAME(BUFAD));                01S1201
         DELETE  EPLOC=LOADNAME(BUFAD)
*              LOADNAME = BLANK;       /* INDICATE NO LOADED MODULE. */
         MVI   LOADNAME+1(BUFAD),C' '                           01S1202
         MVC   LOADNAME+2(6,BUFAD),LOADNAME+1(BUFAD)            01S1202
         MVI   LOADNAME(BUFAD),C' '                             01S1202
*              LOADFLAG = ZERO;        /* CLEAR LOAD FLAG.           */
         MVI   LOADFLAG(BUFAD),X'00'                            01S1203
*            END;                      /*                            */
*          ELSE;                       /* NO LOADED MODULE.          */
@RF01199 DS    0H                                               01S1206
*        GEN REFS(SAVE1)               /*                            */
*         (L  @13,SAVE1+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE1+BACK(,BUFAD)
*  END NAME;                           /* RETURN TO CALLER.          */
@EL00009 DS    0H                                               01S1207
@EF00009 DS    0H                                               01S1207
@ER00009 LM    @14,@12,12(@13)                                  01S1207
         BR    @14                                              01S1207
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL TEST THE CHARACTER GENERATION MODULE BITS,      *
**  (BITS 0 AND 1), TO INSURE THAT THERE IS A MATCHING CGM            *
**  IDENTIFICATION ORDER SPECIFIED IN THE TRAILING INFORMATION OF     *
**  THIS TRANSLATE TABLE.                                             *
**                                                                    *
**********************************************************************/
*TABCHK:                                                        01S1208
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1208
TABCHK   STM   @14,@12,12(@13)                                  01S1208
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        FMTERR = OFF;                                          01S1210
*        FMTERR1 = ON;                 /* VALID TABLE WILL RESET.    */
         OI    FMTERR1(BUFAD),B'00000100'                       01S1211
         NI    FMTERR(BUFAD),B'11110111'                        01S1211
*        DO                            /*                            */
*         CNT = ONE                    /* VERIFY ENTIRE TABLE.       */
*         TO TABEND;                   /*                            */
         LA    CNT,1                                            01S1212
@DL01212 DS    0H                                               01S1213
*          IF MODBOD(CNT) ^= ALBIT     /* IGNORE UNPRINTABLE ENTRY.  */
*            THEN                      /*                            */
         LR    @06,BUFAD                                        01S1213
         ALR   @06,CNT                                          01S1213
         CLI   MODBOD-1(@06),X'FF'                              01S1213
         BE    @RF01213                                         01S1213
*              DO;                     /*                            */
*                FWORK = MODBOD(CNT);  /* GET ONE ENTRY.             */
         SLR   @06,@06                                          01S1215
         IC    @06,MODBOD-1(CNT,BUFAD)                          01S1215
         ST    @06,FWORK(,BUFAD)                                01S1215
*                SRL(FWORK,SIX);       /* SEPARATE CGM REFERENCE BITS*/
         L     @06,FWORK(,BUFAD)                                01S1216
         SRL   @06,6                                            01S1216
         ST    @06,FWORK(,BUFAD)                                01S1216
*                IF CGMIDN(FWORK+ONE) = ZERO                    01S1217
*                  THEN                /* CHECK MATCHING CGMID ORDER.*/
         L     @06,FWORK(,BUFAD)                                01S1217
         ALR   @06,@06                                          01S1217
         SLR   @03,@03                                          01S1217
         IC    @03,CGMIDN(@06,BUFAD)                            01S1217
         CH    @03,@CH00462                                     01S1217
         BNE   @RF01217                                         01S1217
*                    FMTERR = ON;      /* NO CGMID - ERROR.          */
         OI    FMTERR(BUFAD),B'00001000'                        01S1218
*                  ELSE                /* CONTINUE.                  */
*                    FMTERR1 = OFF;    /* FOUND A PRINTABLE CHAR.    */
         B     @RC01217                                         01S1219
@RF01217 NI    FMTERR1(BUFAD),B'11111011'                       01S1219
*              END;                    /*                            */
*            ELSE;                     /* ENTER HERE IF UNPRINTABLE. */
@RF01213 DS    0H                                               01S1222
*        END;                          /* END OF TABLE VERIFY.       */
@RC01213 AH    CNT,@CH00060                                     01S1222
         CH    CNT,@CH00218                                     01S1222
         BNH   @DL01212                                         01S1222
*        IF FMTERR = ON                /* CHECK FOR ANY ERROR FOUND. */
*         × FMTERR1 = ON               /*                            */
*          THEN                        /*                            */
         TM    FMTERR(BUFAD),B'00001100'                        01S1223
         BZ    @RF01223                                         01S1223
*            DO;                       /* ERROR FOUND.               */
*              IF FMTERR = ON          /*                            */
*                THEN                  /* NO CGMID MATCH.            */
         TM    FMTERR(BUFAD),B'00001000'                        01S1225
         BNO   @RF01225                                         01S1225
*                  DO;                 /*                            */
*                    MSGN = IEBA37I;   /* NO CGMID FOR THIS CHAR.    */
         MVI   MSGN(BUFAD),X'25'                                01S1227
*                    FMTERR = OFF;     /* RESET ERROR CONDITION.     */
         NI    FMTERR(BUFAD),B'11110111'                        01S1228
*                  END;                /*                            */
*                ELSE                  /* NO PRINTABLE CHARACTERS.   */
*                  DO;                 /*                            */
         B     @RC01225                                         01S1230
@RF01225 DS    0H                                               01S1231
*                    MSGN = IEBA38I;   /* GET ERROR MESSAGE NUMBER.  */
         MVI   MSGN(BUFAD),X'26'                                01S1231
*                    FMTERR1 = OFF;    /* RESET ERROR SWITCH.        */
         NI    FMTERR1(BUFAD),B'11111011'                       01S1232
*                  END;                /*                            */
*              CALL IEBIMSGS;          /* PRINT THE MESSAGE.         */
@RC01225 L     @15,@CV00037                                     01S1234
         BALR  @14,@15                                          01S1234
*              INHIBITW = ON;          /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      01S1235
*              RETSAVE = MAX(RETSAVE,RC8);/*RETURN CODE 8 THIS OP.   */
         SLR   @06,@06                                          01S1236
         IC    @06,RETSAVE(,BUFAD)                              01S1236
         LA    @15,8                                            01S1236
         CR    @06,@15                                          01S1236
         BNL   *+6
         LR    @06,@15                                          01S1236
         STC   @06,RETSAVE(,BUFAD)                              01S1236
*            END;                      /* END ERROR MESSAGE BUILD.   */
*          ELSE;                       /* NO ERRORS.                 */
@RF01223 DS    0H                                               01S1239
*        GEN REFS(SAVE2)               /******************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*  END TABCHK;                         /* RETURN TO CALLER.          */
@EL00010 DS    0H                                               01S1240
@EF00010 DS    0H                                               01S1240
@ER00010 LM    @14,@12,12(@13)                                  01S1240
         BR    @14                                              01S1240
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS PROCEDURE ISSUES A BLDL FOR THE MEMBER REQUESTED AND IF      *
**  THERE IS AN ERROR THE APPROPRIATE MESSAGE WILL BE PRINTED AND     *
**  READING OF THE LIBRARY WILL BE INHIBITED.                         *
**                                                                    *
**********************************************************************/
*BLDL:                                                          01S1241
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1241
BLDL     STM   @14,@12,12(@13)                                  01S1241
*        GEN SETS(SAVE4);              /* USE CONVENTIONAL SAVE.     */
         ST    @13,SAVE4+BACK(,BUFAD)  BACKWARD POINTER.
         LA    @14,SAVE4(,BUFAD)       THIS ROUTINE SAVE AREA.
         ST    @14,FORE(,@13)          FORWARD POINTER.
         LR    @13,@14                 LINKAGE COMPLETE.
*        BFFLL = FFLLCON;              /* SET BLDL ENTRY NO. AND LEN.*/
         MVC   BFFLL(4,BUFAD),FFLLCON                           01S1243
*        GEN SETS(BLDLNTRY)            /* THE LIBRARY IS NOW SEARCHED*/
*            REFS(SYSUTIN);            /* FOR THE MEMBER REQUESTED.  */
         BLDL  SYSUTIN,BLDLNTRY(BUFAD) ISSUE BLDL.
*        RESPECIFY (RETCODE) RESTRICTED;                        01S1245
*        IF RETCODE ^= ZERO            /* NON ZERO RETURN CODE MEANS */
*          THEN                        /*  ERROR IN BLDL.            */
         LTR   RETCODE,RETCODE                                  01S1246
         BZ    @RF01246                                         01S1246
*            DO;                       /*                            */
*              IF RETCODE = FOUR       /* WAS MEMBER FOUND?          */
*                THEN                  /********** IEBA10I ***********/
         CL    RETCODE,@CF00050                                 01S1248
         BNE   @RF01248                                         01S1248
*                  DO;                 /* NO.                        */
*                    MSGN = IEBA10I;   /* MEMBER NOT FOUND.          */
         MVI   MSGN(BUFAD),X'0A'                                01S1250
*                    EDITDATA(ONE) =   /* SET DATA ADDRESS           */
*                     ADDR(BNAME);     /*  FOR MESSAGE.              */
         LA    @14,BNAME(,BUFAD)                                01S1251
         STCM  @14,7,EDITDATA(BUFAD)                            01S1251
*                    EDITLEN(ONE) =    /* SET DATA LENGTH            */
*                     LENGTH(BNAME);   /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'08'                             01S1252
*                    CALL IEBIMSGS;    /* GET MESSAGE                */
         L     @15,@CV00037                                     01S1253
         BALR  @14,@15                                          01S1253
*                    RETSAVE=MAX(RETSAVE,RC4);/* RC = 4 FOR THIS BLDL*/
         SLR   @14,@14                                          01S1254
         IC    @14,RETSAVE(,BUFAD)                              01S1254
         LA    @06,4                                            01S1254
         CR    @14,@06                                          01S1254
         BNL   *+6
         LR    @14,@06                                          01S1254
         STC   @14,RETSAVE(,BUFAD)                              01S1254
*                  END;                /******************************/
*              IF RETCODE = EIGHT      /* WAS THERE AN I/O ERROR?    */
*                THEN                  /********** IEBA04I ***********/
@RF01248 CL    RETCODE,@CF00048                                 01S1256
         BNE   @RF01256                                         01S1256
*                  DO;                 /* YES.                       */
*                    MSGN = IEBA04I;   /* I/O ERROR MESSAGE.         */
         MVI   MSGN(BUFAD),X'04'                                01S1258
*                    EDITDATA(ONE) =   /* SET DATA ADDRESS           */
*                     ADDR(DCTRY);     /*  FOR MESSAGE.              */
         LA    @14,@CC00862                                     01S1259
         STCM  @14,7,EDITDATA(BUFAD)                            01S1259
*                    EDITLEN(ONE) =    /* SET DATA LENGTH            */
*                     LENGTH(DCTRY);   /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'09'                             01S1260
*                    CALL IEBIMSGS;    /* GET MESSAGE.               */
         L     @15,@CV00037                                     01S1261
         BALR  @14,@15                                          01S1261
*                    RETSAVE = RC12;   /* RC = 12 FOR THIS BLDL.     */
         MVI   RETSAVE(BUFAD),X'0C'                             01S1262
*                    ABNDFLG = ON;     /* TERMINATE UTILITY.         */
         OI    ABNDFLG(BUFAD),B'10000000'                       01S1263
*                  END;                /******************************/
*              INHIBIT = ONNER;        /* INHIBIT DISK ACCESS.       */
@RF01256 OI    INHIBIT(BUFAD),B'01100000'                       01S1265
*            END;                      /*                            */
*        RESPECIFY (RETCODE) UNRESTRICTED;                      01S1267
@RF01246 DS    0H                                               01S1268
*        GEN REFS(SAVE4)               /******************************/
*         (L  @13,SAVE4+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE4+BACK(,BUFAD)
*  END BLDL;                           /* RETURN TO CALLER.          */
@EL00011 DS    0H                                               01S1269
@EF00011 DS    0H                                               01S1269
@ER00011 LM    @14,@12,12(@13)                                  01S1269
         BR    @14                                              01S1269
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS WILL LOAD THE REQUESTED MODULE INTO STORAGE UNLESS THE       *
**  MODULE HAS BEEN PREVIOUSLY LOADED AND NOT DELETED.                *
**                                                                    *
**********************************************************************/
*LOADLIB:                                                       01S1270
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1270
LOADLIB  STM   @14,@12,12(@13)                                  01S1270
*        GEN SETS(SAVE3);              /* USE CONVENTIONAL SAVE.     */
        ST    @13,SAVE3+BACK(,BUFAD)   BACKWARD POINTER.
        LA    @14,SAVE3(,BUFAD)        THIS ROUTINE SAVE AREA.
        ST    @14,FORE(,@13)           FORWARD POINTER
        LR    @13,@14                  LINKAGE COMPLETE
*        IF BNAME ^= LOADNAME          /* CHECK FOR MODULE LOADED.   */
*          THEN                        /* NOT THIS TIME.             */
         CLC   BNAME(8,BUFAD),LOADNAME(BUFAD)                   01S1272
         BE    @RF01272                                         01S1272
*            DO;                       /*                            */
*              IF LOADFLAG = ALBIT     /* CHECK FOR ANY MODULE       */
*                THEN                  /*  LOADED.                   */
         CLI   LOADFLAG(BUFAD),X'FF'                            01S1274
         BNE   @RF01274                                         01S1274
*                  DO;                 /*                            */
*                    GEN REFS(LOADNAME)/* DELETE THE MODULE.         */
*                     (DELETE  EPLOC=LOADNAME(BUFAD));          01S1276
         DELETE  EPLOC=LOADNAME(BUFAD)
*                    LOADNAME = BLANK; /* CLEAR LOADED MODULE NAME.  */
         MVI   LOADNAME+1(BUFAD),C' '                           01S1277
         MVC   LOADNAME+2(6,BUFAD),LOADNAME+1(BUFAD)            01S1277
         MVI   LOADNAME(BUFAD),C' '                             01S1277
*                  END;                /*                            */
*                ELSE;                 /* NO MOD TO DELETE.          */
@RF01274 DS    0H                                               01S1280
*              CALL BLDL;              /* FIND REQUESTED MODULE.     */
         BAL   @14,BLDL                                         01S1280
*              IF INHIBITR = OFF       /* CHECK FOR BLDL ERROR.      */
*                THEN                  /*                            */
         TM    INHIBITR(BUFAD),B'00100000'                      01S1281
         BNZ   @RF01281                                         01S1281
*                  DO;                 /* NONE THIS TIME.            */
*                    GEN REFS(BNAME)   /* LOAD REQUESTED MODULE      */
*                     (LOAD DE=BNAME(BUFAD),DCB=SYSUTIN);       01S1283
         LOAD DE=BNAME(BUFAD),DCB=SYSUTIN
*                    RESPECIFY (R0) RESTRICTED;                 01S1284
*                    LOADMOD = R0;     /* SAVE MODULE ADDRESS.       */
         STCM  R0,7,LOADMOD(BUFAD)                              01S1285
*                    RESPECIFY (R0) UNRESTRICTED;               01S1286
*                    LOADNAME = BNAME; /* REMEMBER NAME.             */
         MVC   LOADNAME(8,BUFAD),BNAME(BUFAD)                   01S1287
*                    LOADFLAG = ALBIT; /* SET LOADED SWITCH.         */
         MVI   LOADFLAG(BUFAD),X'FF'                            01S1288
*                  END;                /*                            */
*                ELSE                  /* ERROR IN BLDL.             */
*                  LOADFLAG = ZERO;    /* RESET LOADED SWITCH.       */
         B     @RC01281                                         01S1290
@RF01281 MVI   LOADFLAG(BUFAD),X'00'                            01S1290
*            END;                      /*                            */
*          ELSE;                       /* REQUESTED MODULE IS LOADED */
@RF01272 DS    0H                                               01S1293
*        GEN REFS(SAVE3)               /******************************/
*         (L   @13,SAVE3+BACK(,BUFAD));/* RESTORE BACKWARD POINTER   */
@RC01272 DS    0H                                               01S1293
         L   @13,SAVE3+BACK(,BUFAD)
*   END LOADLIB;                       /* RETURN TO CALLER.          */
@EL00012 DS    0H                                               01S1294
@EF00012 DS    0H                                               01S1294
@ER00012 LM    @14,@12,12(@13)                                  01S1294
         BR    @14                                              01S1294
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS IS THE COMMON WRITE ROUTINE. THE DCB BLOCK SIZE MUST HAVE    *
**  BEEN FILLED WITH THE CORRECT LENGTH AND THE WORK REGISTER MUST    *
**  POINT TO THE DATA AREA FROM WHICH TO WRITE.                       *
**                                                                    *
**********************************************************************/
*WRITE:                                                         01S1295
*  PROCEDURE OPTIONS(SAVE(R14));                                01S1295
*                                                               01S1295
WRITE    ST    @14,@SA00013                                     01S1295
*              RESPECIFY (DB) RESTRICTED;                       01S1296
*                                      /* WRITE SPECIFIED INFORMATION*/
*              GEN REFS(SYSUTOUT,DB) FLOWS(SYNAD);              01S1297
               WRITE WDECB,SF,SYSUTOUT,(DB),'S'
               CHECK WDECB             CHECK FOR SUCCESSFULL WRITE.
*              RESPECIFY (DB) UNRESTRICTED;                     01S1298
*  END WRITE;                          /* RETURN TO CALLER.          */
@EL00013 DS    0H                                               01S1299
@EF00013 DS    0H                                               01S1299
@ER00013 L     @14,@SA00013                                     01S1299
         BR    @14                                              01S1299
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL PRINT ALL LINES PRESENTLY IN THE MESSAGE QUEUE. *
**                                                                    *
**********************************************************************/
*PRINTQ:                                                        01S1300
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1300
PRINTQ   STM   @14,@12,12(@13)                                  01S1300
*        GEN SETS(SAVE3);              /* USE CONVENTIONAL SAVE      */
         ST  @13,SAVE3+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE3(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        IF QUECTL(ONE) = SKIP         /* CHECK FOR NEW PAGE REQUEST.*/
*          THEN                        /*                            */
         LR    @01,BUFAD                                        01S1302
         AL    @01,@CF01856                                     01S1302
         CLI   QUECTL(@01),C'1'                                 01S1302
         BNE   @RF01302                                         01S1302
*            DO;                       /* SET PAGE NUMBER.           */
*              FWORK = PAGE;           /* GET PAGE NUMBER FOR CONVERT*/
         LH    @15,PAGE(,BUFAD)                                 01S1304
         ST    @15,FWORK(,BUFAD)                                01S1304
*              CALL CONVERT;           /* CONVERT TO PRINTABLE NUMBER*/
         BAL   @14,CONVERT                                      01S1305
*              QUEPGN(ONE) = CWORK;    /* SET IN PRINT LINE.         */
         LR    @15,BUFAD                                        01S1306
         AL    @15,@CF01856                                     01S1306
         MVC   QUEPGN(4,@15),CWORK(BUFAD)                       01S1306
*              PAGE = PAGE + ONE;      /* INCREMENT PAGE.            */
         LA    @14,1                                            01S1307
         AH    @14,PAGE(,BUFAD)                                 01S1307
         STH   @14,PAGE(,BUFAD)                                 01S1307
*              QUEPGW(ONE) = PAGEW;    /* SET THE WORD PAGE.         */
         MVC   QUEPGW(4,@15),@CC00849                           01S1308
*            END;                      /*                            */
*        DO                            /* START PRINT LOOP.          */
*         NCNT = ONE                   /* -NEXT- EQUALS NUMBER OF    */
*         TO NEXT;                     /* LINES TO PRINT.            */
@RF01302 LA    NCNT,1                                           01S1310
         B     @DE01310                                         01S1310
@DL01310 DS    0H                                               01S1311
*          RESPECIFY (DB) RESTRICTED;                           01S1311
*          DB = ADDR(QUEUE(NCNT));     /* GET NEXT PRINT AREA.       */
         LR    @03,NCNT                                         01S1312
         MH    @03,@CH00190                                     01S1312
         AL    @03,@CF01883                                     01S1312
         LA    DB,QUEUE(@03,BUFAD)                              01S1312
*          GEN REFS(SYSPRINT,DB)       /*                            */
*           (PUT  SYSPRINT,(DB));      /* PRINT THE LINE.            */
         PUT  SYSPRINT,(DB)
*          RESPECIFY (DB) UNRESTRICTED;                         01S1314
*        END;                          /* END PRINT LOOP.            */
         AH    NCNT,@CH00060                                    01S1315
@DE01310 SLR   @03,@03                                          01S1315
         ICM   @03,3,NEXT(BUFAD)                                01S1315
         CR    NCNT,@03                                         01S1315
         BNH   @DL01310                                         01S1315
*        NEXT = ZERO;                  /* RESET MESSAGE COUNTER.     */
         SLR   @15,@15                                          01S1316
         STH   @15,NEXT(,BUFAD)                                 01S1316
*        GEN REFS(SAVE3)               /* RESTORE BACKWARD POINTER.  */
*         (L  @13,SAVE3+BACK(,BUFAD)); /*                            */
         L  @13,SAVE3+BACK(,BUFAD)
*  END PRINTQ;                         /* RETURN TO CALLER.          */
@EL00014 DS    0H                                               01S1318
@EF00014 DS    0H                                               01S1318
@ER00014 LM    @14,@12,12(@13)                                  01S1318
         BR    @14                                              01S1318
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL PRINT THE HEADING, IF THE CARD TO BE PRINTED    *
**  IS THE FIRST OF A GROUP. THE CONTROL CARD WILL ALWAYS BE PRINTED. *
**                                                                    *
**********************************************************************/
*PRTCARD:                                                       01S1319
*  PROCEDURE OPTIONS(SAVE(R14));                                01S1319
PRTCARD  ST    @14,@SA00015                                     01S1319
*        IF ACTIVOP = ZERO             /* ZERO OPERATION MEANS       */
*         & INCLSW = OFF               /*                            */
*          THEN                        /* FIRST CARD OF A GROUP.     */
         CLI   ACTIVOP(BUFAD),0                                 01S1320
         BNE   @RF01320                                         01S1320
         TM    INCLSW(BUFAD),B'00100000'                        01S1320
         BNZ   @RF01320                                         01S1320
*            DO;                       /*                            */
*              MSG = HEADING;          /* SET HEADING TO PRINT.      */
         MVC   MSG(121,BUFAD),HEADING                           01S1322
*              FWORK = PAGE;           /* GET PAGE NUMBER FOR CONVERT*/
         LH    @15,PAGE(,BUFAD)                                 01S1323
         ST    @15,FWORK(,BUFAD)                                01S1323
*              CALL CONVERT;           /* CONVERT TO PRINTABLE NUMBER*/
         BAL   @14,CONVERT                                      01S1324
*              PAGENO = CWORK;         /* SET IN PRINT LINE.         */
         MVC   PAGENO(4,BUFAD),CWORK(BUFAD)                     01S1325
*              PAGE = PAGE + ONE;      /* INCREMENT PAGE.            */
         LA    @15,1                                            01S1326
         AH    @15,PAGE(,BUFAD)                                 01S1326
         STH   @15,PAGE(,BUFAD)                                 01S1326
*              GEN REFS(SYSPRINT,MSG)  /* PRINT UTILITY HEADING.     */
*               (PUT  SYSPRINT,MSG(BUFAD));                     01S1327
         PUT  SYSPRINT,MSG(BUFAD)
*              SPACE = DOUBL;          /* DOUBLE SPACE AFTER HEADING.*/
         MVI   SPACE(BUFAD),C'0'                                01S1328
*            END;                      /*                            */
*          ELSE                        /* SUBSEQUENT CARD OF GROUP.  */
*            SPACE = SINGL;            /* SINGLE SPACE BETWEEN CARDS.*/
         B     @RC01320                                         01S1330
@RF01320 MVI   SPACE(BUFAD),C' '                                01S1330
*        MSGTXT = PRIMCARD;            /* CARD TO PRINT AREA.        */
@RC01320 MVI   MSGTXT+80(BUFAD),C' '                            01S1331
         MVC   MSGTXT+81(39,BUFAD),MSGTXT+80(BUFAD)             01S1331
         MVC   MSGTXT(80,BUFAD),PRIMCARD(BUFAD)                 01S1331
*        GEN REFS(SYSPRINT,MSG)        /* PRINT CONTROL CARD.        */
*         (PUT  SYSPRINT,MSG(BUFAD));                           01S1332
         PUT  SYSPRINT,MSG(BUFAD)
*        COL72 = BLANK;                /* BLANK LAST COLUMN FOR SCAN.*/
         MVI   COL72(BUFAD),C' '                                01S1333
*  END PRTCARD;                        /* RETURN TO CALLER.          */
@EL00015 DS    0H                                               01S1334
@EF00015 DS    0H                                               01S1334
@ER00015 L     @14,@SA00015                                     01S1334
         BR    @14                                              01S1334
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS PROCEDURE WILL OBTAIN INFORMATION ABOUT THE INPUT/OUTPUT     *
**  ERROR THAT CAUSED THIS PROCEDURE TO BE ENTERED. THE INFORMATION   *
**  WILL BE EDITED INTO A MESSAGE AND THE MESSAGE PRINTED.            *
**                                                                    *
**********************************************************************/
*SYNAD:                                                         01S1335
*  PROCEDURE OPTIONS(SAVE(R14));                                01S1335
SYNAD    ST    @14,@SA00016                                     01S1335
*        RESPECIFY (R1) RESTRICTED;    /*                            */
*        DCBPTR = R1;                  /* GET THIS DCB POINTER.      */
         LR    DCBPTR,R1                                        01S1337
*        IF DCBMRWRT = ON              /* CHECK FOR WRITE DCB.       */
*          THEN                        /*                            */
         TM    DCBMRWRT+40(DCBPTR),B'00100000'                  01S1338
         BNO   @RF01338                                         01S1338
*            NOWRITE = ON;             /* WRITE NO MORE.             */
         OI    NOWRITE(BUFAD),B'00000100'                       01S1339
*            DO;                       /*                            */
@RF01338 DS    0H                                               01S1341
*              MODHEAD = MODHEAD && MODHEAD;/* CLEAR MODULE HEADER.  */
         XC    MODHEAD(8,BUFAD),MODHEAD(BUFAD)                  01S1341
*              INHIBITR = ON;          /* READ NO MORE.              */
         OI    INHIBITR(BUFAD),B'00100000'                      01S1342
*            END;                      /*                            */
*        GEN                           /* MACRO TO SUPPLY ERROR INFO */
*         (SYNADAF ACSMETH=BPAM,PARM1=(1));                     01S1344
         SYNADAF ACSMETH=BPAM,PARM1=(1)
*        SYNADDR = R1;                 /* SAVE SYNADAF MSG AREA ADDR */
         LR    SYNADDR,R1                                       01S1345
*        RESPECIFY (R1) UNRESTRICTED;  /*                            */
*        MSGN = IEBA04I;               /***********IEBA04I************/
         MVI   MSGN(BUFAD),X'04'                                01S1347
*        EDITDATA(TWO) = ADDR(SYNMSG); /* DATA ADDR FOR MESSAGE.     */
         LA    @03,SYNMSG(,SYNADDR)                             01S1348
         STCM  @03,7,EDITDATA+4(BUFAD)                          01S1348
*        EDITLEN(TWO) = LENGTH(SYNMSG);/* DATA LENGTH FOR MESSAGE.   */
         MVI   EDITLEN+4(BUFAD),X'4E'                           01S1349
*        CALL IEBIMSGS;                /* OBTAIN ERROR  MESSAGE.     */
         L     @15,@CV00037                                     01S1350
         BALR  @14,@15                                          01S1350
*        INHIBITW = ON;                /* INHIBIT DISK WRITE.        */
         OI    INHIBITW(BUFAD),B'01000000'                      01S1351
*        RETSAVE = RC12;               /* INDICATE RETURN CODE 12.   */
         MVI   RETSAVE(BUFAD),X'0C'                             01S1352
*        GEN (SYNADRLS);               /* RELEASE SYNADAF BUFFER.    */
         SYNADRLS
*  END SYNAD;                          /* RETURN TO CALLER.          */
@EL00016 DS    0H                                               01S1354
@EF00016 DS    0H                                               01S1354
@ER00016 L     @14,@SA00016                                     01S1354
         BR    @14                                              01S1354
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS PROCEDURE IS GIVEN CONTROL DURING OPEN PROCESSING. THE DCB   *
**  BLOCKSIZE IS CHECKED TO INSURE IT IS A MULTIPLE OF THE DCB LRECL. *
**                                                                    *
**********************************************************************/
*BKSZCK:                                                        01S1355
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1355
BKSZCK   STM   @14,@12,12(@13)                                  01S1355
*        RESPECIFY (R1) RESTRICTED;    /*                            */
*        DCBPTR = R1;                  /* ADDRESSABILITY TO DCB.     */
         LR    DCBPTR,R1                                        01S1357
*        RESPECIFY (R1) UNRESTRICTED;  /*                            */
*        IF DCBBLKSI = ZERO            /* BLOCKSIZE SHOULD NOT = 0   */
*          × DCBBLKSI//DCBLRECL ^= ZERO /* SHOULD BE MULT OF LRECL   */
*           THEN                       /*                            */
         SLR   @05,@05                                          01S1359
         LH    @15,DCBBLKSI+52(,DCBPTR)                         01S1359
         CR    @15,@05                                          01S1359
         BE    @RT01359                                         01S1359
         LR    @00,@15                                          01S1359
         SRDA  @00,32                                           01S1359
         LH    @15,DCBLRECL+72(,DCBPTR)                         01S1359
         DR    @00,@15                                          01S1359
         CR    @00,@05                                          01S1359
         BE    @RF01359                                         01S1359
@RT01359 DS    0H                                               01S1360
*              DCBBLKSI = DCBLRECL;    /* REPLACE BLKSIZE WITH LRECL */
         MVC   DCBBLKSI+52(2,DCBPTR),DCBLRECL+72(DCBPTR)        01S1360
*           ELSE;                      /* DCB IS OK, DO NOTHING.     */
@RF01359 DS    0H                                               01S1362
*END BKSZCK;                           /* RETURN TO OPEN PROCESSOR.  */
@EL00017 DS    0H                                               01S1362
@EF00017 DS    0H                                               01S1362
@ER00017 LM    @14,@12,12(@13)                                  01S1362
         BR    @14                                              01S1362
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL SETUP THE NECESSARY FLAGS AND CONDITIONS        *
**  FOR PROPER UTILITY TERMINATION.                                   *
**                                                                    *
**********************************************************************/
*EODAD:                                                         01S1363
*  PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                        01S1363
EODAD    DS    0H                                               01S1364
*        EOFFLG = ON;                  /* INDICATE END OF FILE.      */
         OI    EOFFLG(BUFAD),B'01000000'                        01S1364
*        SCANINP = OFF;                /* RESET TO EXIT SCAN.        */
         NI    SCANINP(BUFAD),B'10111111'                       01S1365
*        PRIMCARD = BLANK;             /*                            */
         MVI   PRIMCARD+1(BUFAD),C' '                           01S1366
         MVC   PRIMCARD+2(78,BUFAD),PRIMCARD+1(BUFAD)           01S1366
         MVI   PRIMCARD(BUFAD),C' '                             01S1366
*        SDRYCARD = BLANK;             /* INDICATE NO CARD.          */
         MVI   SDRYCARD+1(BUFAD),C' '                           01S1367
         MVC   SDRYCARD+2(78,BUFAD),SDRYCARD+1(BUFAD)           01S1367
         MVI   SDRYCARD(BUFAD),C' '                             01S1367
*  END EODAD;                          /* RETURN TO CALLER.          */
@EL00018 DS    0H                                               01S1368
@EF00018 DS    0H                                               01S1368
@ER00018 BR    @14                                              01S1368
         EJECT
*ABEND:                                                         01S1369
*  PROCEDURE (ABPAR1,ABDCB,ABOCEWA) OPTIONS(NOSAVEAREA,NOSAVE); 01S1369
ABEND    MVC   @PC00019(12),0(@01)                              01S1369
*/*********************************************************************
**                                                                    *
**  THE FOLLOWING DESCRIBES THE PARAMETER LIST AS ACCEPTED FROM       *
**  OPEN/CLOSE/EOV ABEND PROCESSING.                                  *
**                                                                    *
**********************************************************************/
*    DECLARE                                                    01S1370
*        ABNDSAVE(16) FIXED(32),       /* ABEND SAVE AREA.           */
*        AWORK  PTR(31),               /* DEFINE WORK WORD AS POINTER*/
*        1 ABPARM     BASED(AWORK),    /* PARAMETER LIST FROM FEOV   */
*          2 SYSCODE  BIT(12),         /* SYSTEM ABEND CODE.         */
*          2    *     BIT(4),          /*                            */
*          2 RETCOD   FIXED(8),        /* SYSTEM RETURN CODE.        */
*          2 OPTION   BIT(8),          /* ABEND OPTIONS.             */
*            3   *    BIT(5),          /* UNUSED OPTIONS.            */
*            3 IGNORE BIT(1);          /* IGNORABLE ABEND.           */
*    DECLARE                                                    01S1371
*        ABDCB    CHAR(*),             /* ACTIVE DCB.                */
*        1 ABOCEWA,                    /* O/C/E WORK AREA.           */
*          2  *    CHAR(100),          /* UNREFERENCED AREA.         */
*          2 ABDSN CHAR(44);           /* DATA SET NAME.             */
*    DECLARE                                                    01S1372
*        S213 BIT(12) CONSTANT('213'X),/* SYSTEM 213 ABEND.          */
*        S713 BIT(12) CONSTANT('713'X),/* SYSTEM 713 ABEND.          */
*        SD37 BIT(12) CONSTANT('D37'X);/* SYSTEM D37 ABEND.          */
*/********************************************************************/
*        GEN SETS(SAVE4,ABNDSAVE);     /* USE CONVENTIONAL SAVE      */
         STM  @00,@15,ABNDSAVE         SAVE REGISTERS DURING ABEND.
         LA  @13,SAVE4(,BUFAD)         THIS ROUTINE SAVE AREA.
*/*********************************************************************
**                                                                    *
**  THIS PROCEDURE IS GIVEN CONTROL IF AN ABEND OCCURS DURING         *
**  OPEN/CLOSE/EOV PROCESSING. FOR SYSTEM 213, 713  AND D37 ABENDS A  *
**  MESSAGE WILL BE PRINTED, THE ABEND WILL BE IGNORED AND THE        *
**  PROGRAM WILL BE TERMINATED.                                       *
**                                                                    *
**********************************************************************/
*        RESPECIFY (R1) RESTRICTED;                             01S1374
*        AWORK = R1;                   /* GET POINTER TO ABEND CODE. */
         LR    AWORK,R1                                         01S1375
*        RESPECIFY (R1) UNRESTRICTED;  /*                            */
*        IF IGNORE = ON                /* IS ABEND IGNORABLE?        */
*          THEN                        /* CHECK IF TRULY IGNORABLE.  */
         TM    IGNORE(AWORK),B'00000100'                        01S1377
         BNO   @RF01377                                         01S1377
*            DO;                       /* START ABEND ANALYSIS.      */
*              OPTION = ZERO;          /* RESET ALL OPTIONS.         */
         MVI   OPTION(AWORK),X'00'                              01S1379
*              IF SYSCODE = S213       /* TEST FOR 213 ABEND         */
*                 & RETCOD = RC4       /* WITH RETURN CODE OF FOUR.  */
*                THEN                  /* THIS IS 213 ABEND.         */
         MVC   @TS00001(2),SYSCODE(AWORK)                       01S1380
         NC    @TS00001(2),@CB01899                             01S1380
         CLC   @TS00001(2),@CB01901                             01S1380
         BNE   @RF01380                                         01S1380
         CLI   RETCOD(AWORK),4                                  01S1380
         BNE   @RF01380                                         01S1380
*                  DO;                 /********** IEBA19I ***********/
*                    IGNORE = ON;      /* SET IGNORE OPTION.         */
         OI    IGNORE(AWORK),B'00000100'                        01S1382
*                    RETSAVE = RC16;   /* CAUSE RETURN CODE 16       */
         MVI   RETSAVE(BUFAD),X'10'                             01S1383
*                    INHIBLIB = ON;    /* PREVENT LIB ACCESS FOREVER */
*                    ABNDFLG = ON;     /* CAUSE TERMINATION.         */
         OI    INHIBLIB(BUFAD),B'10010000'                      01S1385
*                    MSGN = IEBA19I;   /* ABEND ERR MSG NUMBER       */
         MVI   MSGN(BUFAD),X'13'                                01S1386
*                  END;                /******************************/
*              IF SYSCODE = SD37       /* TEST FOR D37 ABEND         */
*                 & RETCOD = RC4       /* WITH RETURN CODE OF FOUR.  */
*                THEN                  /* THIS IS D37 ABEND.         */
@RF01380 MVC   @TS00001(2),SYSCODE(AWORK)                       01S1388
         NC    @TS00001(2),@CB01899                             01S1388
         CLC   @TS00001(2),@CB01903                             01S1388
         BNE   @RF01388                                         01S1388
         CLI   RETCOD(AWORK),4                                  01S1388
         BNE   @RF01388                                         01S1388
*                  DO;                 /********** IEBA21I ***********/
*                    IGNORE = ON;      /* SET IGNORE OPTION.         */
         OI    IGNORE(AWORK),B'00000100'                        01S1390
*                    RETSAVE = RC12;   /* CAUSE RETURN CODE 12.      */
         MVI   RETSAVE(BUFAD),X'0C'                             01S1391
*                    NOWRITE = ON;     /* PREVENT WRITE FOREVER.     */
         OI    NOWRITE(BUFAD),B'00000100'                       01S1392
*                    MSGN = IEBA21I;   /* ABEND ERR MSG NUMBER.      */
         MVI   MSGN(BUFAD),X'15'                                01S1393
*                  END;                /******************************/
*              IF SYSCODE = S713       /* TEST FOR 713 ABEND         */
*                 & RETCOD = RC8       /* WITH RETURN CODE OF EIGHT. */
*                THEN                  /* THIS IS 713 ABEND.         */
@RF01388 MVC   @TS00001(2),SYSCODE(AWORK)                       01S1395
         NC    @TS00001(2),@CB01899                             01S1395
         CLC   @TS00001(2),@CB01905                             01S1395
         BNE   @RF01395                                         01S1395
         CLI   RETCOD(AWORK),8                                  01S1395
         BNE   @RF01395                                         01S1395
*                  DO;                 /********** IEBA46I ***********/
*                    IGNORE = ON;      /* SET IGNORE OPTION.         */
         OI    IGNORE(AWORK),B'00000100'                        01S1397
*                    RETSAVE = RC12;   /* CAUSE RETURN CODE 12.      */
         MVI   RETSAVE(BUFAD),X'0C'                             01S1398
*                    NOWRITE = ON;     /* PREVENT WRITE FOREVER.     */
         OI    NOWRITE(BUFAD),B'00000100'                       01S1399
*                    MSGN = IEBA46I;   /* ABEND ERR MSG NUMBER.      */
         MVI   MSGN(BUFAD),X'2E'                                01S1400
*                  END;                /******************************/
*              IF IGNORE = ON          /* THIS IS A IGNORABLE ABEND. */
*                THEN                  /*                            */
@RF01395 TM    IGNORE(AWORK),B'00000100'                        01S1402
         BNO   @RF01402                                         01S1402
*                  DO;                 /* SET UP FOR PRINT.          */
*                    EDITDATA(ONE) =   /* SET ADDR OF DSNAME         */
*                     ADDR(ABDSN);     /*  FOR MESSAGE.              */
         L     @15,@PC00019+8                                   01S1404
         LA    @15,ABDSN(,@15)                                  01S1404
         STCM  @15,7,EDITDATA(BUFAD)                            01S1404
*                    EDITLEN(ONE) =    /* SET LENGTH OF DSNAME       */
*                     LENGTH(ABDSN);   /*  FOR MESSAGE.              */
         MVI   EDITLEN(BUFAD),X'2C'                             01S1405
*                    CALL IEBIMSGS;    /* GET AN ERROR MESSAGE       */
         L     @15,@CV00037                                     01S1406
         BALR  @14,@15                                          01S1406
*                    INHIBIT = ONNER;  /* INHIBIT LIB ACCESS THIS OP */
         OI    INHIBIT(BUFAD),B'01100000'                       01S1407
*                  END;                /* END OF PRINT SETUP.        */
*            END;                      /* END ABEND ANALYSIS.        */
*          ELSE                        /* CANNOT IGNORE THIS ABEND   */
*            OPTION = ZERO;            /* INDICATE CONTINE ABEND     */
         B     @RC01377                                         01S1410
@RF01377 MVI   OPTION(AWORK),X'00'                              01S1410
*        GEN REFS(ABNDSAVE)            /******************************/
*          (LM  @00,@15,ABNDSAVE);     /* RESTORE REGISTERS.         */
@RC01377 DS    0H                                               01S1411
         LM  @00,@15,ABNDSAVE
*  END ABEND;                          /* RETURN TO O/C/EOV.         */
@EL00019 DS    0H                                               01S1412
@EF00019 DS    0H                                               01S1412
@ER00019 BR    @14                                              01S1412
         EJECT
*/*********************************************************************
**                                                                    *
**  THE FOLLOWING ROUTINE WILL CONVERT A BINARY NUMBER WHOSE DECIMAL  *
**  VALUE IS LESS THAN 9999 TO PRINTABLE FORMAT. HIGH ORDER ZEROES    *
**  WILL BE ELIMINATED.                                               *
**                                                                    *
**********************************************************************/
*CONVERT:                                                       01S1413
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1413
CONVERT  STM   @14,@12,12(@13)                                  01S1413
*        GEN SETS(SAVE4);              /* USE CONVENTIONAL SAVE      */
         ST  @13,SAVE4+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE4(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        CVD(FWORK,DWORK);             /* MAKE                       */
         L     @15,FWORK(,BUFAD)                                01S1415
         CVD   @15,DWORK(,BUFAD)                                01S1415
*        UNPK(CWORK,PWORK);            /*  NUMBER                    */
         UNPK  CWORK(4,BUFAD),PWORK(2,BUFAD)                    01S1416
*        CWORK1 = CWORK1 × MASK;       /*  PRINTABLE.                */
         OI    CWORK1(BUFAD),C'0'                               01S1417
*        DO                            /*                            */
*         CCNT = ONE                   /* ELIMINATE                  */
*         TO LENGTH(CWORK)             /*  ALL                       */
*         WHILE CWORK(CCNT) = CHAR0;   /*  HIGH ORDER                */
         LA    CCNT,1                                           01S1418
@DL01418 LR    @03,BUFAD                                        01S1418
         ALR   @03,CCNT                                         01S1418
         CLI   CWORK-1(@03),C'0'                                01S1418
         BNE   @DC01418                                         01S1418
*          CWORK(CCNT) = BLANK;        /*  ZEROES.                   */
         LR    @03,BUFAD                                        01S1419
         ALR   @03,CCNT                                         01S1419
         MVI   CWORK-1(@03),C' '                                01S1419
*        END;                          /*                            */
         AH    CCNT,@CH00060                                    01S1420
         CH    CCNT,@CH00050                                    01S1420
         BNH   @DL01418                                         01S1420
@DC01418 DS    0H                                               01S1421
*        GEN REFS(SAVE4)               /******************************/
*         (L  @13,SAVE4+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE4+BACK(,BUFAD)
*   END CONVERT;                       /* RETURN TO CALLER.          */
@EL00020 DS    0H                                               01S1422
@EF00020 DS    0H                                               01S1422
@ER00020 LM    @14,@12,12(@13)                                  01S1422
         BR    @14                                              01S1422
         EJECT
*/*********************************************************************
**                                                                    *
**  IF REQUESTED THIS SECTION WILL FORMAT AND PRINT THE FCB MODULE.   *
**                                                                    *
**********************************************************************/
*FCBPRT:                                                        01S1423
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1423
FCBPRT   STM   @14,@12,12(@13)                                  01S1423
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL DETERMINE THE SPACING AND THE VALIDITY OF       *
**  THE TOP AND BOTTOM MARGINS OF THE FCB IMAGE.                      *
**                                                                    *
**********************************************************************/
*                                                               02S1425
*        CNT = ZERO;                     /* RESET            @Z48MSTT*/
         SLR   CNT,CNT                                          02S1425
*        TOP = ZERO;                     /*  FCB LOCATION    @Z48MSTT*/
         SLR   TOP,TOP                                          02S1426
*        XCNT = ONE;                     /* INITIALIZE LOOP  @Z48MSTT*/
         LA    @15,1                                            02S1427
         LR    XCNT,@15                                         02S1427
*        YCNT = SIX;                     /*  CNTRL VARIABLES @Z48MSTT*/
         LA    YCNT,6                                           02S1428
*        HCNT = ONE;                     /*  FOR TOP MARGIN. @Z48MSTT*/
         LR    HCNT,@15                                         02S1429
*        LINE = ONE;                     /* SET FOR 1ST LOOP.@Z48MSTT*/
         LR    LINE,@15                                         02S1430
*        DO LOOP = ONE TO TWO;           /* LOOP TOP/BOTTOM. @Z48MSTT*/
         STH   @15,LOOP(,BUFAD)                                 02S1431
@DL01431 DS    0H                                               02S1432
*          MARGN = ZERO;                 /* RESET MARGIN.    @Z48MSTT*/
         MVI   MARGN(BUFAD),X'00'                               02S1432
*          DO                            /* VALIDITY CHECK   @Z48MSTT*/
*           HCNT = HCNT                  /*  AND COUNT.      @Z48MSTT*/
*           TO YCNT                      /*  MARGIN BYTES.   @Z48MSTT*/
*           WHILE MARGN / TWELV < ONE;   /*                  @Z48MSTT*/
         B     @DE01433                                         02S1433
@DL01433 SLR   @15,@15                                          02S1433
         IC    @15,MARGN(,BUFAD)                                02S1433
         LR    @01,@15                                          02S1433
         SLR   @00,@00                                          02S1433
         D     @00,@CF00035                                     02S1433
         LTR   @01,@01                                          02S1433
         BP    @DC01433                                         02S1433
*            TPARTY = FCBYTE(LINE) & FZERO;/* GET HI 4 BITS  @Z48MSTT*/
         LR    @01,BUFAD                                        02S1434
         ALR   @01,LINE                                         02S1434
         MVC   TPARTY(1,BUFAD),FCBYTE-1(@01)                    02S1434
         NI    TPARTY(BUFAD),X'F0'                              02S1434
*            IF MRG6 = TPARTY            /* CHECK FOR 6 LPI. @Z48MSTT*/
*              THEN                      /* INCREASE MARGIN  @Z48MSTT*/
         CLI   TPARTY(BUFAD),B'00000000'                        02S1435
         BNE   @RF01435                                         02S1435
*                MARGN = MARGN + FOUR;   /*  CNT BY 4/24.    @Z48MSTT*/
         AL    @15,@CF00050                                     02S1436
         STC   @15,MARGN(,BUFAD)                                02S1436
*              ELSE                      /*                  @Z48MSTT*/
*                IF MRG8 = TPARTY        /* CHECK FOR 8 LPI. @Z48MSTT*/
*                  THEN                  /*  INCREASE MARGIN @Z48MSTT*/
         B     @RC01435                                         02S1437
@RF01435 CLI   TPARTY(BUFAD),B'00010000'                        02S1437
         BNE   @RF01437                                         02S1437
*                    MARGN = MARGN + THREE;/* CNT BY 3/24.   @Z48MSTT*/
         LA    @15,3                                            02S1438
         SLR   @14,@14                                          02S1438
         IC    @14,MARGN(,BUFAD)                                02S1438
         ALR   @15,@14                                          02S1438
         STC   @15,MARGN(,BUFAD)                                02S1438
*                  ELSE                  /*                  @Z48MSTT*/
*                    DO;                 /*                  @Z48MSTT*/
         B     @RC01437                                         02S1439
@RF01437 DS    0H                                               02S1440
*                      IF MRG12 ^= TPARTY /* CHECK FOR       @Z48MSTT*/
*                        THEN            /* NOT 12 LPI.      @Z48MSTT*/
         CLI   TPARTY(BUFAD),B'00110000'                        02S1440
         BE    @RF01440                                         02S1440
*                          FMTERR = ON;  /* REMEMBER ERROR.  @Z48MSTT*/
         OI    FMTERR(BUFAD),B'00001000'                        02S1441
*                        ELSE;           /* INCREASE MARGIN  @Z48MSTT*/
@RF01440 DS    0H                                               02S1443
*                      MARGN = MARGN + TWO;/* CNT BY 2/24.   @Z48MSTT*/
         LA    @15,2                                            02S1443
         SLR   @14,@14                                          02S1443
         IC    @14,MARGN(,BUFAD)                                02S1443
         ALR   @15,@14                                          02S1443
         STC   @15,MARGN(,BUFAD)                                02S1443
*                    END;                /*                  @Z48MSTT*/
*            IF ZERO ^= (FCBYTE(LINE) & CEEFF) /* CHECK FOR  @Z48MSTT*/
*              THEN                            /*  GARBAGE   @Z48MSTT*/
@RC01437 DS    0H                                               02S1445
@RC01435 LA    @15,207                                          02S1445
         SLR   @14,@14                                          02S1445
         IC    @14,FCBYTE-1(LINE,BUFAD)                         02S1445
         NR    @15,@14                                          02S1445
         LTR   @15,@15                                          02S1445
         BZ    @RF01445                                         02S1445
*                FMTERR = ON;                  /*  IN MARGIN @Z48MSTT*/
         OI    FMTERR(BUFAD),B'00001000'                        02S1446
*            LINE = LINE + XCNT;         /* ADJUST LINE CNT. @Z48MSTT*/
@RF01445 ALR   LINE,XCNT                                        02S1447
*          END;                          /* END OF MARGIN.   @Z48MSTT*/
         AH    HCNT,@CH00060                                    02S1448
@DE01433 CR    HCNT,YCNT                                        02S1448
         BNH   @DL01433                                         02S1448
@DC01433 DS    0H                                               02S1449
*          IF MARGN//12 ^= ZERO          /* CHECK FOR        @Z48MSTT*/
*            THEN                        /*  INVALID MARGIN. @Z48MSTT*/
         SLR   @00,@00                                          02S1449
         IC    @00,MARGN(,BUFAD)                                02S1449
         SRDA  @00,32                                           02S1449
         D     @00,@CF00035                                     02S1449
         LTR   @00,@00                                          02S1449
         BZ    @RF01449                                         02S1449
*              FMTERR = ON;              /* REMEMBER ERROR.  @Z48MSTT*/
         OI    FMTERR(BUFAD),B'00001000'                        02S1450
*            ELSE;                       /* HERE GOOD MARG   @Z48MSTT*/
@RF01449 DS    0H                                               02S1452
*          IF LOOP = ONE                 /* NEED TO CHANGE   @Z48MSTT*/
*            THEN                        /*  CNTRL VARIABLES @Z48MSTT*/
         CLC   LOOP(2,BUFAD),@CH00060                           02S1452
         BNE   @RF01452                                         02S1452
*              DO;                       /*  FOR SECOND LOOP.@Z48MSTT*/
*                CNT = LINE;             /* SAVE LINE COUNT  @Z48MSTT*/
         LR    CNT,LINE                                         02S1454
*                TOP = LINE - ONE;       /*  FOR LATER USE.  @Z48MSTT*/
         LR    TOP,LINE                                         02S1455
         BCTR  TOP,0                                            02S1455
*                HCNT = -(FCBCNT);       /* SET RANGE TO     @Z48MSTT*/
         SLR   @15,@15                                          02S1456
         ICM   @15,3,FCBCNT(BUFAD)                              02S1456
         LCR   HCNT,@15                                         02S1456
*                YCNT = -(HCNT - SIX);   /*  VER BOTTOM MGN  @Z48MSTT*/
         LR    YCNT,HCNT                                        02S1457
         SH    YCNT,@CH00185                                    02S1457
         LCR   YCNT,YCNT                                        02S1457
*                XCNT = -ONE;            /*  AND DECREMENT.  @Z48MSTT*/
         SLR   XCNT,XCNT                                        02S1458
         BCTR  XCNT,0                                           02S1458
*                LINE = FCBCNT;          /* SET AT BOTTOM.   @Z48MSTT*/
         LR    LINE,@15                                         02S1459
*              END;                      /*                  @Z48MSTT*/
*            ELSE                        /* HERE ON 2ND LOOP.@Z48MSTT*/
*              BOTTOM = LINE;            /* SAVE BOTTOM LINE.@Z48MSTT*/
         B     @RC01452                                         02S1461
@RF01452 STH   LINE,BOTTOM(,BUFAD)                              02S1461
*       END;                             /*                  @Z48MSTT*/
@RC01452 LA    @14,1                                            02S1462
         AH    @14,LOOP(,BUFAD)                                 02S1462
         ST    @15,@TF00001                                     02S1462
         LR    @15,@14                                          02S1462
         STH   @15,LOOP(,BUFAD)                                 02S1462
         CH    @15,@CH00057                                     02S1462
         BNH   @DL01431                                         02S1462
*        LPICNT = ZERO;                /* RESET LPI COUNTER.         */
         SLR   @07,@07                                          01S1463
         ST    @07,LPICNT(,BUFAD)                               01S1463
*        FMTERR1 = ON;                 /* PRESET CH1 WARNING.@Z48MSTT*/
         OI    FMTERR1(BUFAD),B'00000100'                       01S1464
*        DO                            /* START FCB FORMAT PRINT.    */
*         CNT = CNT                    /*                            */
*         TO BOTTOM;                   /* NUMBER OF LINES IN FCB.    */
         B     @DE01465                                         01S1465
@DL01465 DS    0H                                               01S1466
*          FWORK = CNT - TOP;          /* LINE NUMBER TO PRT.@Z48MSTT*/
         LR    @07,CNT                                          01S1466
         SLR   @07,TOP                                          01S1466
         ST    @07,FWORK(,BUFAD)                                01S1466
*          CALL CONVERT;               /* CONVERT THIS NO.   @Z48MSTT*/
         BAL   @14,CONVERT                                      01S1467
*          XFCBLINE = CWORK3;          /* AND SAVE IN ARRAY. @Z48MSTT*/
         LR    @07,CNT                                          01S1468
         SLA   @07,3                                            01S1468
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1468
         MVC   XFCBLINE(3,@07),CWORK3(BUFAD)                    01S1468
*          IF FLPI(CNT) = OFF          /* CHECK FOR 6 LPI.   @Z48MSTT*/
*            THEN                      /*                    @Z48MSTT*/
         LR    @03,BUFAD                                        01S1469
         ALR   @03,CNT                                          01S1469
         TM    FLPI-1(@03),B'00010000'                          01S1469
         BNZ   @RF01469                                         01S1469
*              DO;                     /* YES,               @Z48MSTT*/
*                XFCBLPI = CHAR6;      /* SET 6 IN PRT ARRAY.@Z48MSTT*/
         MVC   XFCBLPI(2,@07),@CC00788                          01S1471
*                LPI6 = LPI6 + ONE;    /* INCR 6 LPI CNTR.   @Z48MSTT*/
         LA    @07,1                                            01S1472
         SLR   @03,@03                                          01S1472
         IC    @03,LPI6(,BUFAD)                                 01S1472
         ALR   @07,@03                                          01S1472
         STC   @07,LPI6(,BUFAD)                                 01S1472
*                DWORK2 = MRG6;        /* MASK FOR 6 LPI.    @Z48MSTT*/
         SLR   @07,@07                                          01S1473
         ST    @07,DWORK2(,BUFAD)                               01S1473
*              END;                    /*                    @Z48MSTT*/
*            ELSE                      /*                    @Z48MSTT*/
*              IF FLPI12(CNT) = ONNER  /* CHECK FOR 12 LPI.  @Z48MSTT*/
*                THEN                  /*                    @Z48MSTT*/
         B     @RC01469                                         01S1475
@RF01469 LR    @07,BUFAD                                        01S1475
         ALR   @07,CNT                                          01S1475
         TM    FLPI12-1(@07),B'00110000'                        01S1475
         BNO   @RF01475                                         01S1475
*                  DO;                 /*                    @Z48MSTT*/
*                    XFCBLPI = CHAR12; /* SET 12 IN PRT ARRAY@Z48MSTT*/
         LR    @07,CNT                                          01S1477
         SLA   @07,3                                            01S1477
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1477
         MVC   XFCBLPI(2,@07),@CC00792                          01S1477
*                    LPI12 = LPI12+ONE;/* INCR 12 LPI CNTR.  @Z48MSTT*/
         LA    @07,1                                            01S1478
         SLR   @03,@03                                          01S1478
         IC    @03,LPI12(,BUFAD)                                01S1478
         ALR   @07,@03                                          01S1478
         STC   @07,LPI12(,BUFAD)                                01S1478
*                    DWORK2 = MRG12;   /* MASK FOR 12 LPI.   @Z48MSTT*/
         LA    @07,48                                           01S1479
         ST    @07,DWORK2(,BUFAD)                               01S1479
*                  END;                /*                    @Z48MSTT*/
*                ELSE                  /* MUST BE 6 LPI.     @Z48MSTT*/
*                  DO;                 /*                    @Z48MSTT*/
         B     @RC01475                                         01S1481
@RF01475 DS    0H                                               01S1482
*                    XFCBLPI = CHAR8;  /* SET 8 IN PRT ARRAY.@Z48MSTT*/
         LR    @07,CNT                                          01S1482
         SLA   @07,3                                            01S1482
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1482
         MVC   XFCBLPI(2,@07),@CC00790                          01S1482
*                    LPI8 = LPI8 + ONE;/* INCR 8 LPI COUNTER.@Z48MSTT*/
         LA    @07,1                                            01S1483
         SLR   @03,@03                                          01S1483
         IC    @03,LPI8(,BUFAD)                                 01S1483
         ALR   @07,@03                                          01S1483
         STC   @07,LPI8(,BUFAD)                                 01S1483
*                    DWORK2 = MRG8;    /* MASK FOR 8 LPI.    @Z48MSTT*/
         LA    @07,16                                           01S1484
         ST    @07,DWORK2(,BUFAD)                               01S1484
*                  END;                /*                    @Z48MSTT*/
*          DWORK2 = FCBYTE(CNT)        /* GET FCB CODE MINUS @Z48MSTT*/
*               && DWORK2;             /*  LPI INDICATOR.    @Z48MSTT*/
@RC01475 DS    0H                                               01S1486
@RC01469 SLR   @07,@07                                          01S1486
         IC    @07,FCBYTE-1(CNT,BUFAD)                          01S1486
         X     @07,DWORK2(,BUFAD)                               01S1486
         ST    @07,DWORK2(,BUFAD)                               01S1486
*          IF DWORK2 =< HICHAN         /* CHECK FOR MAX CHAN @Z48MSTT*/
*            THEN                      /*  IN FCB BYTE.      @Z48MSTT*/
         CH    @07,@CH00807                                     01S1487
         BH    @RF01487                                         01S1487
*              DO;                     /* GOOD FCB BYTE.     @Z48MSTT*/
*                XFCBFLG = ZERO;       /* RESET ERROR FLAGS. @Z48MSTT*/
         LR    @03,CNT                                          01S1489
         SLA   @03,3                                            01S1489
         LA    @03,FCBARRAY+788(@03,BUFAD)                      01S1489
         MVI   XFCBFLG(@03),X'00'                               01S1489
*                FWORK = DWORK2;       /* CHANNEL CODE       @Z48MSTT*/
         ST    @07,FWORK(,BUFAD)                                01S1490
*                IF FWORK = ONE        /* CHECK FOR CHANNEL  @Z48MSTT*/
*                  THEN                /*  ONE CODE.         @Z48MSTT*/
         CH    @07,@CH00060                                     01S1491
         BNE   @RF01491                                         01S1491
*                    FMTERR1 = OFF;    /* RESET CH1 WARNING. @Z48MSTT*/
         NI    FMTERR1(BUFAD),B'11111011'                       01S1492
*                  ELSE;               /*                    @Z48MSTT*/
@RF01491 DS    0H                                               01S1494
*                CALL CONVERT;         /*  TO BE CONVERTED.  @Z48MSTT*/
         BAL   @14,CONVERT                                      01S1494
*                XFCBCHX = CWORK2;     /* SET IN PRT ARRAY.  @Z48MSTT*/
         LR    @07,CNT                                          01S1495
         SLA   @07,3                                            01S1495
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1495
         MVC   XFCBCHX(2,@07),CWORK2(BUFAD)                     01S1495
*              END;                    /*                    @Z48MSTT*/
*            ELSE                      /* MUST BE INVALID.   @Z48MSTT*/
*              DO;                     /*                    @Z48MSTT*/
         B     @RC01487                                         01S1497
@RF01487 DS    0H                                               01S1498
*                RETSAVE =             /* SET RETURN CODE 4, @Z48MSTT*/
*                 MAX(RETSAVE,RC4);    /*                    @Z48MSTT*/
         SLR   @07,@07                                          01S1498
         IC    @07,RETSAVE(,BUFAD)                              01S1498
         LA    @03,4                                            01S1498
         CR    @07,@03                                          01S1498
         BNL   *+6
         LR    @07,@03                                          01S1498
         STC   @07,RETSAVE(,BUFAD)                              01S1498
*                PWORK1 = FCBYTE(CNT); /* GET INVALID BYTE.  @Z48MSTT*/
         LR    @07,BUFAD                                        01S1499
         ALR   @07,CNT                                          01S1499
         MVC   PWORK1(1,BUFAD),FCBYTE-1(@07)                    01S1499
*                XFCBERR = ON;         /* FLAG THIS ELEMENT. @Z48MSTT*/
         LR    @07,CNT                                          01S1500
         SLA   @07,3                                            01S1500
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1500
         OI    XFCBERR(@07),B'10000000'                         01S1500
*                UNPK(CWORK3,PWORK);   /* SPREAD HEX NO.     @Z48MSTT*/
         UNPK  CWORK3(3,BUFAD),PWORK(2,BUFAD)                   01S1501
*                INHIBITW = ON;        /* PREVENT LIB WRITE. @Z48MSTT*/
         OI    INHIBITW(BUFAD),B'01000000'                      01S1502
*                XFCBCHX = CWORK3 & MAS0F;/* MAKE THIS BYTE  @Z48MSTT*/
         MVC   XFCBCHX(2,@07),CWORK3(BUFAD)                     01S1503
         NC    XFCBCHX(2,@07),@CB00799                          01S1503
*                TR(XFCBCHX,TRTAB);    /* PRINT HEX VALUE.   @Z48MSTT*/
         TR    XFCBCHX(2,@07),TRTAB                             01S1504
*              END;                    /*                    @Z48MSTT*/
*        END;                          /* END OF FCB ARRAY.  @Z48MSTT*/
@RC01487 AH    CNT,@CH00060                                     01S1506
@DE01465 CH    CNT,BOTTOM(,BUFAD)                               01S1506
         BNH   @DL01465                                         01S1506
*        XFCBEND = ON;                 /* SET FCB END FLAG.  @Z48MSTT*/
         LR    @07,CNT                                          01S1507
         SLA   @07,3                                            01S1507
         LA    @07,FCBARRAY+788(@07,BUFAD)                      01S1507
         OI    XFCBEND(@07),B'01000000'                         01S1507
*        IF INHIBITW = OFF             /* COULD HAVE PRINTED ERRORS  */
*         × NOKEY = ON                 /*                            */
*          THEN                        /*  ALREADY.                  */
         TM    INHIBITW(BUFAD),B'01000000'                      01S1508
         BZ    @RT01508                                         01S1508
         TM    NOKEY(BUFAD),B'01000000'                         01S1508
         BNO   @RF01508                                         01S1508
@RT01508 DS    0H                                               01S1509
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL CHECK THE FCB IMAGE FOR CORRECT BOUNDARY        *
**  ALIGNMENT.                                                        *
**                                                                    *
**********************************************************************/
*                                                               02S1509
*        DO;                           /*                            */
*          IF FMTERR = OFF             /* CHECK FOR MARGIN ERROR.    */
*           × (LPI8 * THREE            /* CHECK FOR VALID    @Z48MSTT*/
*             + LPI6 * FOUR            /*  HALF INCH         @Z48MSTT*/
*             + LPI12 * TWO) // TWELV  /*   BOUNDARIES.      @Z48MSTT*/
*             = ZERO                   /*                    @Z48MSTT*/
*            THEN                      /*                    @Z48MSTT*/
         TM    FMTERR(BUFAD),B'00001000'                        02S1510
         BZ    @RT01510                                         02S1510
         SLR   @00,@00                                          02S1510
         IC    @00,LPI8(,BUFAD)                                 02S1510
         MH    @00,@CH00111                                     02S1510
         SLR   @07,@07                                          02S1510
         IC    @07,LPI6(,BUFAD)                                 02S1510
         SLA   @07,2                                            02S1510
         ALR   @00,@07                                          02S1510
         SLR   @07,@07                                          02S1510
         IC    @07,LPI12(,BUFAD)                                02S1510
         ALR   @07,@07                                          02S1510
         ALR   @00,@07                                          02S1510
         SRDA  @00,32                                           02S1510
         D     @00,@CF00035                                     02S1510
         LTR   @00,@00                                          02S1510
         BNZ   @RF01510                                         02S1510
@RT01510 DS    0H                                               02S1511
*              DO;                     /* DETERMINE SIZE OF FORM.    */
*                FWORK =((((MARGINS + LPI6) * FOUR)        /*@Z48MSTT*/
*                              +       /* CHANGE TO TENTHS   @Z48MSTT*/
*                         (LPI8 * THREE)                   /*@Z48MSTT*/
*                              +       /*   OF INCHES.       @Z48MSTT*/
*                         (LPI12 * TWO))*TEN) / TWNTY4;    /*@Z48MSTT*/
         LA    @00,6                                            02S1512
         SLR   @07,@07                                          02S1512
         IC    @07,LPI6(,BUFAD)                                 02S1512
         ALR   @00,@07                                          02S1512
         SLA   @00,2                                            02S1512
         SLR   @07,@07                                          02S1512
         IC    @07,LPI8(,BUFAD)                                 02S1512
         MH    @07,@CH00111                                     02S1512
         ALR   @00,@07                                          02S1512
         SLR   @07,@07                                          02S1512
         IC    @07,LPI12(,BUFAD)                                02S1512
         ALR   @07,@07                                          02S1512
         ALR   @00,@07                                          02S1512
         LR    @03,@00                                          02S1512
         M     @02,@CF00033                                     02S1512
         D     @02,@CF00053                                     02S1512
         ST    @03,FWORK(,BUFAD)                                02S1512
*                                      /*                    @Z48MSTT*/
*                CALL CONVERT;         /* HEX TO DECIMAL.    @Z48MSTT*/
         BAL   @14,CONVERT                                      02S1513
*                                      /* EXPAND FOR DECIMAL POINT.  */
*                UWORK = CWORK(TWO:THREE);                      02S1514
         MVC   @TS00001(2),CWORK+1(BUFAD)                       02S1514
         MVC   UWORK(2,BUFAD),@TS00001                          02S1514
*                CWORK(THREE) = PERIOD;/* INSERT DECIMAL POINT.      */
         MVI   CWORK+2(BUFAD),C'.'                              02S1515
*                                      /* ADDR OF SIZE VAL FOR EDIT. */
*                EDITDATA(ONE) = ADDR(CWORK);                   02S1516
         LA    @07,CWORK(,BUFAD)                                02S1516
         STCM  @07,7,EDITDATA(BUFAD)                            02S1516
*                                      /* SET LENGTH TO EDIT.        */
*                EDITLEN(ONE) = LENGTH(CWORK);                  02S1517
         MVI   EDITLEN(BUFAD),X'04'                             02S1517
*                MSGN = IEBA32I;       /* FORM SIZE MESSAGE.         */
         MVI   MSGN(BUFAD),X'20'                                02S1518
*              END;                    /* END MESSAGE BUILD.         */
*            ELSE                      /* BOUNDARY ERROR.            */
*              DO;                     /*                            */
         B     @RC01510                                         02S1520
@RF01510 DS    0H                                               02S1521
*                MSGN = IEBA11I;       /* SET BDY ERROR MESSAGE.     */
         MVI   MSGN(BUFAD),X'0B'                                02S1521
*                RETSAVE =             /* SET RETURN CODE 4 THIS     */
*                 MAX(RETSAVE,RC4);    /*  OPERATION.                */
         SLR   @07,@07                                          02S1522
         IC    @07,RETSAVE(,BUFAD)                              02S1522
         LA    @00,4                                            02S1522
         CR    @07,@00                                          02S1522
         BNL   *+6
         LR    @07,@00                                          02S1522
         STC   @07,RETSAVE(,BUFAD)                              02S1522
*                 FMTERR = OFF;        /* RESET ERROR SWITCH.        */
         NI    FMTERR(BUFAD),B'11110111'                        02S1523
*              END;                    /*                            */
*          CALL IEBIMSGS;              /* PRINT A MESSAGE.           */
@RC01510 L     @15,@CV00037                                     02S1525
         BALR  @14,@15                                          02S1525
*        END;                          /*                            */
*        IF FMTERR1 = ON               /* CHECK FOR CH1      @Z48MSTT*/
*          THEN                        /*  WARNING.          @Z48MSTT*/
@RF01508 TM    FMTERR1(BUFAD),B'00000100'                       01S1527
         BNO   @RF01527                                         01S1527
*            DO;                       /* SELECT WARNING MSG.@Z48MSTT*/
*              MSGN = IEBA49I;         /*******IEBA49I*******@Z48MSTT*/
         MVI   MSGN(BUFAD),X'31'                                01S1529
*              CALL IEBIMSGS;          /* PRINT THE MESSAGE. @Z48MSTT*/
         L     @15,@CV00037                                     01S1530
         BALR  @14,@15                                          01S1530
*              RETSAVE =               /* SET RETURN CODE    @Z48MSTT*/
*               MAX(RETSAVE,RC4);      /*  FOR WARNING.      @Z48MSTT*/
         SLR   @07,@07                                          01S1531
         IC    @07,RETSAVE(,BUFAD)                              01S1531
         LA    @00,4                                            01S1531
         CR    @07,@00                                          01S1531
         BNL   *+6
         LR    @07,@00                                          01S1531
         STC   @07,RETSAVE(,BUFAD)                              01S1531
*            END;                      /*                    @Z48MSTT*/
*          ELSE;                       /* NO WARNING NEEDED. @Z48MSTT*/
@RF01527 DS    0H                                               01S1534
*/*********************************************************************
**                                                                    *
**  THIS SEGMENT WILL PRINT THE FCB USING THE INFORMATION IN THE FCB  *
**  ARRAY. THE FORMAT OF EACH ELEMENT OF THE ARRAY IS AS FOLLOWS..    *
**                                                                    *
**       BYTE 1    XFCBFLG  - ERROR AND END FLAGS                     *
**       BYTE 2-4  XFCBLINE - LINE NUMBERS CHARACTERS                 *
**       BYTE 5,6  XFCBLPI  - LINE PER INCH CHARACTERS                *
**       BYTE 7,8  XFCBCHX  - CHANNEL CODE OR INVALID BYTE CHARACTERS *
**                                                                    *
**********************************************************************/
*                                                               02S1534
*         NEXT = ONE;                   /* INIT PRT Q COUNT. @Z48MSTT*/
         LA    @07,1                                            02S1534
         STH   @07,NEXT(,BUFAD)                                 02S1534
*         CONTROL = SKIP;               /* SKIP TO NEW PAGE. @Z48MSTT*/
         LR    @15,@07                                          02S1535
         MH    @15,@CH00190                                     02S1535
         AL    @15,@CF01883                                     02S1535
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1535
         MVI   CONTROL(@15),C'1'                                02S1535
*         DO                            /* STEP THROUGH EACH @Z48MSTT*/
*          CNT = TOP + ONE              /*  ELEMENT OF THE   @Z48MSTT*/
*          TO BOTTOM                    /*   FCB             @Z48MSTT*/
*          WHILE XFCBEND = OFF;         /*   ARRAY.          @Z48MSTT*/
         ALR   @07,TOP                                          02S1536
         LR    CNT,@07                                          02S1536
         B     @DE01536                                         02S1536
@DL01536 LR    @07,CNT                                          02S1536
         SLA   @07,3                                            02S1536
         LA    @07,FCBARRAY+788(@07,BUFAD)                      02S1536
         TM    XFCBEND(@07),B'01000000'                         02S1536
         BNZ   @DC01536                                         02S1536
*           PRTFCB = FCBPRL;            /* SET PRINT INFO    @Z48MSTT*/
         SLR   @03,@03                                          02S1537
         ICM   @03,3,NEXT(BUFAD)                                02S1537
         MH    @03,@CH00190                                     02S1537
         AL    @03,@CF01883                                     02S1537
         LA    @03,MSGSAVE-10648(@03,BUFAD)                     02S1537
         MVI   PRTFCB+44(@03),C' '                              02S1537
         MVC   PRTFCB+45(75,@03),PRTFCB+44(@03)                 02S1537
         MVC   PRTFCB(44,@03),FCBPRL                            02S1537
*           FCBLN = XFCBLINE;           /*  AND LINE NUMBER. @Z48MSTT*/
         MVC   FCBLN(3,@03),XFCBLINE(@07)                       02S1538
*           IF XFCBERR = ON             /* CHECK FOR FCB BYTE@Z48MSTT*/
*             THEN                      /*  ERROR.           @Z48MSTT*/
         TM    XFCBERR(@07),B'10000000'                         02S1539
         BNO   @RF01539                                         02S1539
*               DO;                     /* SET INVALID INFO  @Z48MSTT*/
*                 FCBCH = FCBINV;       /*  IN PRINT LINE    @Z48MSTT*/
         MVC   FCBCH(23,@03),FCBINV                             02S1541
*                 FCBCN = XFCBCHX;      /*  WITH INVALID BYTE@Z48MSTT*/
         MVC   FCBCN(2,@03),XFCBCHX(@07)                        02S1542
*               END;                    /*                   @Z48MSTT*/
*             ELSE                      /* NO ERROR HERE.    @Z48MSTT*/
*               DO;                     /*                   @Z48MSTT*/
         B     @RC01539                                         02S1544
@RF01539 DS    0H                                               02S1545
*                 FCBLPI = XFCBLPI;     /* SET LPI CHARACTERS@Z48MSTT*/
         SLR   @07,@07                                          02S1545
         ICM   @07,3,NEXT(BUFAD)                                02S1545
         MH    @07,@CH00190                                     02S1545
         AL    @07,@CF01883                                     02S1545
         LA    @07,MSGSAVE-10648(@07,BUFAD)                     02S1545
         LR    @03,CNT                                          02S1545
         SLA   @03,3                                            02S1545
         LA    @03,FCBARRAY+788(@03,BUFAD)                      02S1545
         MVC   FCBLPI(2,@07),XFCBLPI(@03)                       02S1545
*                 IF XFCBCH ^= BLANK    /* CHECK FOR CHANNEL @Z48MSTT*/
*                   THEN                /*  CODE THIS LINE.  @Z48MSTT*/
         CLI   XFCBCH(@03),C' '                                 02S1546
         BE    @RF01546                                         02S1546
*                     DO;               /* SET CHANNEL CODE  @Z48MSTT*/
*                       FCBCH = FCBCHL; /*  INFO IN PRINT    @Z48MSTT*/
         MVC   FCBCH(23,@07),FCBCHL                             02S1548
*                       FCBCN = XFCBCHX;/*  LINE WITH CODE.  @Z48MSTT*/
         MVC   FCBCN(2,@07),XFCBCHX(@03)                        02S1549
*                     END;              /*                   @Z48MSTT*/
*                   ELSE;               /* NO CHANNEL CODE.  @Z48MSTT*/
@RF01546 DS    0H                                               02S1552
*               END;                    /*                   @Z48MSTT*/
*           IF NEXT = PGFUL             /* CHECK FOR PRINT   @Z48MSTT*/
*             THEN                      /*  QUEUE PAGE FULL. @Z48MSTT*/
@RC01539 CLC   NEXT(2,BUFAD),@CH00746                           02S1553
         BNE   @RF01553                                         02S1553
*               CALL PRINTQ;            /* PRINT A PAGE.     @Z48MSTT*/
         BAL   @14,PRINTQ                                       02S1554
*             ELSE;                     /* CONTINUE.         @Z48MSTT*/
@RF01553 DS    0H                                               02S1556
*           NEXT = NEXT + ONE;          /* INCR PRT Q COUNT. @Z48MSTT*/
         LA    @07,1                                            02S1556
         SLR   @03,@03                                          02S1556
         ICM   @03,3,NEXT(BUFAD)                                02S1556
         ALR   @07,@03                                          02S1556
         STH   @07,NEXT(,BUFAD)                                 02S1556
*           CONTROL = SPACE;            /* SPACE REST OF LINE@Z48MSTT*/
         MH    @07,@CH00190                                     02S1557
         AL    @07,@CF01883                                     02S1557
         LA    @07,MSGSAVE-10648(@07,BUFAD)                     02S1557
         MVC   CONTROL(1,@07),SPACE(BUFAD)                      02S1557
*        END;                           /* END OF PRINT LOOP.@Z48MSTT*/
         AH    CNT,@CH00060                                     02S1558
@DE01536 CH    CNT,BOTTOM(,BUFAD)                               02S1558
         BNH   @DL01536                                         02S1558
@DC01536 DS    0H                                               02S1559
*        NEXT = NEXT - ONE;             /* ALWAYS GOES TO FAR@Z48MSTT*/
         SLR   @00,@00                                          02S1559
         ICM   @00,3,NEXT(BUFAD)                                02S1559
         BCTR  @00,0                                            02S1559
         STH   @00,NEXT(,BUFAD)                                 02S1559
*        IF NEXT ^= ZERO                /* CHECK FOR FCB PRT @Z48MSTT*/
*          THEN                         /*  COMPLETE.        @Z48MSTT*/
         LTR   @00,@00                                          02S1560
         BZ    @RF01560                                         02S1560
*            CALL PRINTQ;               /*  PORTION OF FCB.  @Z48MSTT*/
         BAL   @14,PRINTQ                                       02S1561
*          ELSE;                        /*                   @Z48MSTT*/
@RF01560 DS    0H                                               02S1563
*        GEN REFS(SAVE2)               /* RESTORE BACKWARD POINTER   */
*         (L  @13,SAVE2+BACK(,BUFAD)); /*                            */
         L  @13,SAVE2+BACK(,BUFAD)
*  END FCBPRT;                         /* RETURN TO CALLER.          */
@EL00021 DS    0H                                               01S1564
@EF00021 DS    0H                                               01S1564
@ER00021 LM    @14,@12,12(@13)                                  01S1564
         BR    @14                                              01S1564
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL PRINT A COPY MODIFICATION MODULE.               *
**                                                                    *
**********************************************************************/
*COPYPRT:                                                       01S1565
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1565
COPYPRT  STM   @14,@12,12(@13)                                  01S1565
*        RESPECIFY (BUFFPTR) RESTRICTED;                        01S1566
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        SEGCNT = ZERO;                /* RESET SEGMENT COUNT.       */
         SLR   @07,@07                                          01S1568
         STH   @07,SEGCNT(,BUFAD)                               01S1568
*        BUFFPTR = ADDR(MODBOD);       /* INITIALIZE SEGMENT POINTER */
         LA    BUFFPTR,MODBOD(,BUFAD)                           01S1569
*        DO                            /* START COPY MOD PRINT.      */
*         WHILE CMODCNT > ZERO;        /* PRINT THE WHOLE MODULE.    */
         B     @DE01570                                         01S1570
@DL01570 DS    0H                                               01S1571
*          NEXT = ONE;                 /* INITIALIZE PRINT QUEUE CTR.*/
         LA    @07,1                                            01S1571
         STH   @07,NEXT(,BUFAD)                                 01S1571
*          PRTQELEM = SKIP;            /* SKIP TO NEW PAGE.          */
         LA    @15,121                                          01S1572
         LR    @03,@07                                          01S1572
         MR    @02,@15                                          01S1572
         AL    @03,@CF01883                                     01S1572
         LA    @14,MSGSAVE-10648(@03,BUFAD)                     01S1572
         MVI   PRTQELEM+1(@14),C' '                             01S1572
         MVC   PRTQELEM+2(119,@14),PRTQELEM+1(@14)              01S1572
         MVI   PRTQELEM(@14),C'1'                               01S1572
*          TBN = BNAME;                /* SET MODULE NAME            */
         MVC   TBN(8,@14),BNAME(BUFAD)                          01S1573
*          NEXT = NEXT + ONE;          /* INCREMENT QUEUE.           */
         LR    @14,@07                                          01S1574
         ALR   @14,@07                                          01S1574
         STH   @14,NEXT(,BUFAD)                                 01S1574
*          CONTROL = DOUBL;            /* DOUBLE SPACE.              */
         LR    @03,@14                                          01S1575
         MR    @02,@15                                          01S1575
         AL    @03,@CF01883                                     01S1575
         LA    @05,MSGSAVE-10648(@03,BUFAD)                     01S1575
         MVI   CONTROL(@05),C'0'                                01S1575
*          PRTQUEUE = COPYHD1;         /* SET COPY HEADER LINE ONE.  */
         MVI   PRTQUEUE+90(@05),C' '                            01S1576
         MVC   PRTQUEUE+91(29,@05),PRTQUEUE+90(@05)             01S1576
         MVC   PRTQUEUE(90,@05),COPYHD1                         01S1576
*          NEXT = NEXT + ONE;          /* INCREMENT QUEUE            */
         ALR   @14,@07                                          01S1577
         STH   @14,NEXT(,BUFAD)                                 01S1577
*          CONTROL = SINGL;            /* SINGLE SPACE.              */
         MR    @14,@14                                          01S1578
         AL    @15,@CF01883                                     01S1578
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     01S1578
         MVI   CONTROL(@15),C' '                                01S1578
*          PRTQUEUE = COPYHD2;         /* SET COPY HEADER LINE TWO.  */
         MVI   PRTQUEUE+91(@15),C' '                            01S1579
         MVC   PRTQUEUE+92(28,@15),PRTQUEUE+91(@15)             01S1579
         MVC   PRTQUEUE(91,@15),COPYHD2                         01S1579
*          DO;                         /*                            */
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL FILL THE PRINT QUEUE WITH ONE PAGE OF COPY      *
**  MODIFICATION INFORMATION.                                         *
**                                                                    *
**********************************************************************/
*        DO                            /* START PRINT SEGMENT LOOP   */
*         NEXT = NEXT + ONE            /*  FOR ONE PAGE.             */
*         TO LASTLINE                  /*                            */
*         WHILE CMODCNT > ZERO;        /* STOP AT MODULE END.        */
         SLR   @15,@15                                          02S1581
         ICM   @15,3,NEXT(BUFAD)                                02S1581
         ALR   @15,@07                                          02S1581
         B     @DE01581                                         02S1581
@DL01581 SLR   @07,@07                                          02S1581
         CH    @07,CMODCNT(,BUFAD)                              02S1581
         BNL   @DC01581                                         02S1581
*          SEGCNT = SEGCNT + ONE;      /* INCREMENT SEGMENT NUMBER.  */
         LA    @15,1                                            02S1582
         LH    @14,SEGCNT(,BUFAD)                               02S1582
         ALR   @14,@15                                          02S1582
         STH   @14,SEGCNT(,BUFAD)                               02S1582
*          PRTQELEM = DOUBL;           /* SET DOUBL SPACE.           */
         SLR   @05,@05                                          02S1583
         ICM   @05,3,NEXT(BUFAD)                                02S1583
         MH    @05,@CH00190                                     02S1583
         AL    @05,@CF01883                                     02S1583
         LA    @05,MSGSAVE-10648(@05,BUFAD)                     02S1583
         MVI   PRTQELEM+1(@05),C' '                             02S1583
         MVC   PRTQELEM+2(119,@05),PRTQELEM+1(@05)              02S1583
         MVI   PRTQELEM(@05),C'0'                               02S1583
*          IF DEL(SEGCNT) ^= ZERO      /* CHECK FOR LINE OVERRUN     */
*            THEN                      /*  NOTE.                     */
         LA    @04,796                                          02S1584
         ALR   @04,BUFAD                                        02S1584
         LA    @03,0(@14,@04)                                   02S1584
         BCTR  @03,0                                            02S1584
         SLR   @02,@02                                          02S1584
         IC    @02,DEL(,@03)                                    02S1584
         CR    @07,@02                                          02S1584
         BE    @RF01584                                         02S1584
*              DO;                     /*                    @Z48MSTT*/
*                MNOTE = NOTE;         /* SET NOTE CONSTANT. @Z48MSTT*/
         ALR   @05,@15                                          02S1586
         MVC   MNOTE(7,@05),@CC00865                            02S1586
*                MNOTEM = DEL(SEGCNT); /* SET NOTE NUMBER.   @Z48MSTT*/
         ALR   @04,@14                                          02S1587
         BCTR  @04,0                                            02S1587
         MVC   MNOTEM(1,@05),DEL(@04)                           02S1587
*              END;                    /*                    @Z48MSTT*/
*            ELSE;                     /* NO NOTE.                   */
@RF01584 DS    0H                                               02S1590
*          FWORK = SEGCNT;             /* GET SEGMENT NUMBER.        */
         LH    @07,SEGCNT(,BUFAD)                               02S1590
         ST    @07,FWORK(,BUFAD)                                02S1590
*          CALL CONVERT;               /* CONVERT TO PRINTABLE.      */
         BAL   @14,CONVERT                                      02S1591
*          MSEG = CWORK3;              /* SET SEGMENT NO. IN PRT QUE */
         LA    @07,1                                            02S1592
         SLR   @15,@15                                          02S1592
         ICM   @15,3,NEXT(BUFAD)                                02S1592
         MH    @15,@CH00190                                     02S1592
         AL    @15,@CF01883                                     02S1592
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1592
         ALR   @15,@07                                          02S1592
         MVC   MSEG(3,@15),CWORK3(BUFAD)                        02S1592
*          DO                          /* START SEGMENT INFO CONVERT.*/
*           CNT = ONE                  /* CONVERT ALL BUT TEXT       */
*           TO LENGTH(COPYHD) - ONE;   /*  NUMBER.                   */
         LR    CNT,@07                                          02S1593
@DL01593 DS    0H                                               02S1594
*            FWORK = COPYHD(CNT);      /* GET A NUMBER.              */
         LR    @07,BUFFPTR                                      02S1594
         BCTR  @07,0                                            02S1594
         SLR   @03,@03                                          02S1594
         IC    @03,COPYHD(CNT,@07)                              02S1594
         ST    @03,FWORK(,BUFAD)                                02S1594
*            CALL CONVERT;             /* CONVERT IT.                */
         BAL   @14,CONVERT                                      02S1595
*            MNUMBER(CNT) = CWORK3;    /* SET IT IN PRINT QUEUE LINE.*/
         LR    @07,CNT                                          02S1596
         MH    @07,@CH00035                                     02S1596
         SLR   @03,@03                                          02S1596
         ICM   @03,3,NEXT(BUFAD)                                02S1596
         MH    @03,@CH00190                                     02S1596
         AL    @03,@CF01883                                     02S1596
         LA    @03,MSGSAVE-10648(@03,BUFAD)                     02S1596
         ALR   @03,@07                                          02S1596
         MVC   MNUMBER-11(3,@03),CWORK3(BUFAD)                  02S1596
*          END;                        /* END SEGMENT INFO CONVERT.  */
         AH    CNT,@CH00060                                     02S1597
         CH    CNT,@CH00040                                     02S1597
         BNH   @DL01593                                         02S1597
*          XCNT = ZERO;                /* INITIALIZE CHARACTER CTR.  */
         SLR   XCNT,XCNT                                        02S1598
*          DO                          /* START CHARACTER COUNT LOOP.*/
*           CNT = ONE                  /*                            */
*           TO TEXTX;                  /*                            */
         LA    CNT,1                                            02S1599
         B     @DE01599                                         02S1599
@DL01599 DS    0H                                               02S1600
*            IF TEXT(CNT) = ALBIT      /* CHECK FOR REPITITION FACTOR*/
*              THEN                    /*                            */
         LR    @07,BUFFPTR                                      02S1600
         ALR   @07,CNT                                          02S1600
         CLI   TEXT-1(@07),X'FF'                                02S1600
         BNE   @RF01600                                         02S1600
*                DO;                   /*                            */
*                  XCNT = XCNT         /* INCR CHAR CTR BY REP FACTOR*/
*                    + TEXT(CNT + ONE);/*                            */
         SLR   @07,@07                                          02S1602
         IC    @07,TEXT(CNT,BUFFPTR)                            02S1602
         ALR   XCNT,@07                                         02S1602
*                  CNT = CNT + TWO;    /* STEP OVER COMPESSED FIELD. */
         AL    CNT,@CF00057                                     02S1603
*                END;                  /* END CHARACTER COUNT LOOP.  */
*              ELSE                    /*                            */
*                XCNT = XCNT + ONE;    /* INCREMENT CHARACTER COUNT  */
         B     @RC01600                                         02S1605
@RF01600 AH    XCNT,@CH00060                                    02S1605
*          END;                        /*                            */
@RC01600 AH    CNT,@CH00060                                     02S1606
@DE01599 SLR   @07,@07                                          02S1606
         IC    @07,TEXTX(,BUFFPTR)                              02S1606
         CR    CNT,@07                                          02S1606
         BNH   @DL01599                                         02S1606
*          FWORK = XCNT;               /* GET CHARACTER COUNT.       */
         ST    XCNT,FWORK(,BUFAD)                               02S1607
*          CALL CONVERT;               /* CONVERT NUMBER TO PRINT.   */
         BAL   @14,CONVERT                                      02S1608
*          MCHAR = CWORK3;             /* SET NUMBER IN PRINT QUEUE. */
         SLR   @07,@07                                          02S1609
         ICM   @07,3,NEXT(BUFAD)                                02S1609
         MH    @07,@CH00190                                     02S1609
         AL    @07,@CF01883                                     02S1609
         LA    @07,MSGSAVE-10648(@07,BUFAD)                     02S1609
         MVC   MCHAR+1(3,@07),CWORK3(BUFAD)                     02S1609
*          CMODCNT                     /* REDUCE MODULE SIZE.        */
*           = CMODCNT - (TEXTX + LENGTH(COPYHD));               02S1610
         LA    @07,6                                            02S1610
         SLR   @00,@00                                          02S1610
         IC    @00,TEXTX(,BUFFPTR)                              02S1610
         ALR   @07,@00                                          02S1610
         LH    @00,CMODCNT(,BUFAD)                              02S1610
         SLR   @00,@07                                          02S1610
         STH   @00,CMODCNT(,BUFAD)                              02S1610
*          BUFFPTR                     /* INCR TO NEXT SEGMENT.      */
*           = BUFFPTR + (TEXTX + LENGTH(COPYHD));               02S1611
         ALR   BUFFPTR,@07                                      02S1611
*        END;                          /* END OF PAGE.               */
         LA    @15,1                                            02S1612
         SLR   @07,@07                                          02S1612
         ICM   @07,3,NEXT(BUFAD)                                02S1612
         ALR   @15,@07                                          02S1612
@DE01581 STH   @15,NEXT(,BUFAD)                                 02S1612
         CH    @15,@CH00371                                     02S1612
         BNH   @DL01581                                         02S1612
@DC01581 DS    0H                                               02S1613
*          END;                        /*  INFORMATION.              */
*          IF NEXT > ONE               /* CHECK FOR ANY PRINTING.    */
*            THEN                      /*                            */
         SLR   @07,@07                                          01S1614
         ICM   @07,3,NEXT(BUFAD)                                01S1614
         CH    @07,@CH00060                                     01S1614
         BNH   @RF01614                                         01S1614
*              NEXT = NEXT - ONE;      /* ALWAYS GO ONE TO MANY.     */
         BCTR  @07,0                                            01S1615
         STH   @07,NEXT(,BUFAD)                                 01S1615
*            ELSE;                     /*                            */
@RF01614 DS    0H                                               01S1617
*          CALL PRINTQ;                /*  PRINT ONE PAGE.           */
         BAL   @14,PRINTQ                                       01S1617
*        END;                          /* END COPY MOD PRINT.        */
@DE01570 ICM   @07,3,CMODCNT(BUFAD)                             01S1618
         BP    @DL01570                                         01S1618
*        RESPECIFY (BUFFPTR) UNRESTRICTED;                      01S1619
*        GEN REFS(SAVE2)               /******************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*   END COPYPRT;                       /* RETURN TO CALLER.          */
@EL00022 DS    0H                                               01S1621
@EF00022 DS    0H                                               01S1621
@ER00022 LM    @14,@12,12(@13)                                  01S1621
         BR    @14                                              01S1621
         EJECT
*                                                               01S1622
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL CHECK THE COPY MODIFICATION MODULE TO INSURE    *
**  VALIDITY AND USABILITY.                                           *
**                                                                    *
**********************************************************************/
*COPCHK:                                                        01S1622
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1622
COPCHK   STM   @14,@12,12(@13)                                  01S1622
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        RESPECIFY (RECAREA,           /*                            */
*                   RECSIZE,           /* RESTRICT NECESSARY         */
*                   TRANSIZE,          /* REGISTERS FOR MOVE LONG.   */
*                   BUFFPTR)  RESTRICTED;                       01S1624
*                                                               01S1624
*        RECAREA = ADDR(DEL);          /* ADDRESS OF DELSEG ARRAY.   */
         LA    RECAREA,796                                      01S1625
         ALR   RECAREA,BUFAD                                    01S1625
*        RECSIZE = DIM(DEL);           /* SIZE OF DELSEG ARRAY.      */
         LA    RECSIZE,1024                                     01S1626
*        TRANSIZE = ZERO;              /* USE PADDING BYTE.          */
         SLR   TRANSIZE,TRANSIZE                                01S1627
*        BUFFPTR = ADDR(ZERO);         /* ADDRESS OF A ZERO.         */
         LA    BUFFPTR,@CH00462+1                               01S1628
*                                      /*                            */
*        MVCL(RECAREA,BUFFPTR);        /* CLEAR WORKAREA.            */
         MVCL  RECAREA,BUFFPTR                                  01S1629
*                                      /*                            */
*        RESPECIFY (RECAREA,           /* FREE REGISTERS FOR         */
*                   RECSIZE,           /*  COMPILER USE.             */
*                   TRANSIZE) UNRESTRICTED;                     01S1630
*        BUFFPTR = ADDR(MODBOD);       /* SEGMENT TRACKER.           */
         LA    BUFFPTR,MODBOD(,BUFAD)                           01S1631
*        MINC = COPY1;                 /* GET INITIAL COPY THIS MOD. */
         LR    @07,BUFAD                                        01S1632
         AL    @07,@CF01856                                     01S1632
         MVC   MINC(1,@07),COPY1(BUFFPTR)                       01S1632
*        MAXC = ZERO;                  /* RESET MAX COPY.            */
         MVI   MAXC(@07),X'00'                                  01S1633
*        MAXL = ZERO;                  /* RESET MAX LINE.            */
         MVI   MAXL(@07),X'00'                                  01S1634
*        MINL = MAXLINE;               /* RESET MIN LINE.            */
         MVI   MINL(@07),X'84'                                  01S1635
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL GATHER THE TIMING INFORMATION FOR EACH SEGMENT. *
**                                                                    *
**********************************************************************/
*        DO                            /* START MODULE SCAN          */
*         SEGCNT = ONE                 /*                            */
*         TO DIM(CMTARRAY)             /* COUNT SEGMENTS.            */
*         WHILE BUFFPTR                /* STOP WHEN MODULE COMPLETE. */
*             < ADDR(MODBOD) + CMODCNT;/*                            */
         LA    @07,1                                            02S1636
         STH   @07,SEGCNT(,BUFAD)                               02S1636
@DL01636 LA    @07,MODBOD(,BUFAD)                               02S1636
         AH    @07,CMODCNT(,BUFAD)                              02S1636
         CR    BUFFPTR,@07                                      02S1636
         BNL   @DC01636                                         02S1636
*          COPYINFO(SEGCNT)            /* SET FIRST FOUR BYTES OF    */
*           = COPYSEQN;                /*  SEGMENT IN TIMING ARRAY.  */
         LH    @07,SEGCNT(,BUFAD)                               02S1637
         SLA   @07,3                                            02S1637
         LR    @02,BUFAD                                        02S1637
         AL    @02,@CF01856                                     02S1637
         ST    @07,@TF00002                                     02S1637
         ALR   @07,@02                                          02S1637
         MVC   COPYINFO-8(4,@07),COPYSEQN(BUFFPTR)              02S1637
*          TXT(SEGCNT) = CMLOHD;       /* SET LINE OVERHEAD IN TIME. */
         LA    @07,1875                                         02S1638
         L     @15,@TF00002                                     02S1638
         ST    @07,TXT-8(@15,@02)                               02S1638
*          XCNT = ZERO;                /* RESET CHARACTER COUNTER.   */
         SLR   XCNT,XCNT                                        02S1639
*          DO                          /* START CHARACTER COUNT FOR  */
*           CNT = ONE                  /*  TIMING INFORMATION        */
*           TO TEXTX;                  /*                            */
         LA    CNT,1                                            02S1640
         B     @DE01640                                         02S1640
@DL01640 DS    0H                                               02S1641
*            IF TEXT(CNT) = ALBIT      /* CHECK FOR COMPRESSED CHAR. */
*              THEN                    /*                            */
         LR    @07,BUFFPTR                                      02S1641
         ALR   @07,CNT                                          02S1641
         CLI   TEXT-1(@07),X'FF'                                02S1641
         BNE   @RF01641                                         02S1641
*                DO;                   /*                            */
*                  TXT(SEGCNT)         /* CALC COMPRESSION TIME.     */
*                   = TXT(SEGCNT) + (TEXT(CNT+ONE) * CMPCHT);   02S1643
         LH    @07,SEGCNT(,BUFAD)                               02S1643
         SLA   @07,3                                            02S1643
         LR    @15,BUFAD                                        02S1643
         AL    @15,@CF01856                                     02S1643
         SLR   @14,@14                                          02S1643
         IC    @14,TEXT(CNT,BUFFPTR)                            02S1643
         LR    @00,@14                                          02S1643
         MH    @00,@CH01036                                     02S1643
         AL    @00,TXT-8(@07,@15)                               02S1643
         ST    @00,TXT-8(@07,@15)                               02S1643
*                  XCNT = XCNT         /* ADD REPITION FACTOR TO     */
*                   + TEXT(CNT + ONE); /*  CHARACTER COUNTER.        */
         ALR   XCNT,@14                                         02S1644
*                  CNT = CNT + TWO;    /* SKIP NEXT TWO BYTES        */
         AL    CNT,@CF00057                                     02S1645
*                END;                  /*                            */
*              ELSE                    /*                            */
*                DO;                   /* STANDARD CHARACTER.        */
         B     @RC01641                                         02S1647
@RF01641 DS    0H                                               02S1648
*                  TXT(SEGCNT)         /* ADD STD CHAR TIMING.       */
*                   = TXT(SEGCNT) + STDCHT;                     02S1648
         LH    @07,SEGCNT(,BUFAD)                               02S1648
         SLA   @07,3                                            02S1648
         LR    @15,BUFAD                                        02S1648
         AL    @15,@CF01856                                     02S1648
         LA    @14,325                                          02S1648
         AL    @14,TXT-8(@07,@15)                               02S1648
         ST    @14,TXT-8(@07,@15)                               02S1648
*                  XCNT = XCNT + ONE;  /* INCR CHARACTER COUNTER.    */
         AH    XCNT,@CH00060                                    02S1649
*                END;                  /*                            */
*          END;                        /* END OF CHARACTER COUNT.    */
@RC01641 AH    CNT,@CH00060                                     02S1651
@DE01640 SLR   @07,@07                                          02S1651
         IC    @07,TEXTX(,BUFFPTR)                              02S1651
         CR    CNT,@07                                          02S1651
         BNH   @DL01640                                         02S1651
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL GENERATE ANY MESSAGE NECESSARY TO INDICATE      *
**  THE INVALIDITY OF A COPY MODIFICATION MODULE.                     *
**                                                                    *
**********************************************************************/
*        FWORK = SEGCNT;               /* SEGMENT NUMBER FOR CONVERT.*/
         LH    @07,SEGCNT(,BUFAD)                               03S1652
         ST    @07,FWORK(,BUFAD)                                03S1652
*        CALL CONVERT;                 /* MAKE IT PRINTABLE          */
         BAL   @14,CONVERT                                      03S1653
*        EDITDATA(ONE) = ADDR(CWORK);  /* POINT TO SEGMENT NUMBER.   */
         LA    @07,CWORK(,BUFAD)                                03S1654
         STCM  @07,7,EDITDATA(BUFAD)                            03S1654
*        EDITLEN(ONE) = LENGTH(CWORK); /* SET BYTE LENGTH OF NUMBER  */
         MVI   EDITLEN(BUFAD),X'04'                             03S1655
*        IF SEGCNT > ONE               /* DO NOT CHECK FIRST SEGMENT */
*         & CP1(SEGCNT) < CP1(SEGCNT - ONE)                     03S1656
*          THEN                        /*  FOR ASCENDING SEQUENCE.   */
         LH    @07,SEGCNT(,BUFAD)                               03S1656
         CH    @07,@CH00060                                     03S1656
         BNH   @RF01656                                         03S1656
         SLA   @07,3                                            03S1656
         LR    @02,BUFAD                                        03S1656
         AL    @02,@CF01856                                     03S1656
         SLR   @00,@00                                          03S1656
         IC    @00,CP1-8(@07,@02)                               03S1656
         SLR   @15,@15                                          03S1656
         IC    @15,CP1-16(@07,@02)                              03S1656
         CR    @00,@15                                          03S1656
         BNL   @RF01656                                         03S1656
*            DO;                       /*                            */
*              MSGN = IEBA18I;         /* OUT OF SEQUENCE.           */
         MVI   MSGN(BUFAD),X'12'                                03S1658
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S1659
         BALR  @14,@15                                          03S1659
*              FMTERR1 = ON;           /* REMEMBER IT.               */
         OI    FMTERR1(BUFAD),B'00000100'                       03S1660
*            END;                      /*                            */
*          ELSE;                       /* SEQUENCE OK.               */
@RF01656 DS    0H                                               03S1663
*        MSGN = IEBA43I;               /* PRESET MESSAGE.            */
         MVI   MSGN(BUFAD),X'2B'                                03S1663
*        IF COPY1 + COPYN - ONE        /* CHECK FOR MAXIMUM COPY     */
*         > MAXCOPY                    /*  EXCEEDED.                 */
*          THEN                        /*                            */
         SLR   @07,@07                                          03S1664
         IC    @07,COPY1(,BUFFPTR)                              03S1664
         SLR   @02,@02                                          03S1664
         IC    @02,COPYN(,BUFFPTR)                              03S1664
         ALR   @07,@02                                          03S1664
         BCTR  @07,0                                            03S1664
         CH    @07,@CH00543                                     03S1664
         BNH   @RF01664                                         03S1664
*            DO;                       /*                            */
*              EDITLEN(ONE) = LENGTH(CWORK);                    03S1666
         MVI   EDITLEN(BUFAD),X'04'                             03S1666
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S1667
         BALR  @14,@15                                          03S1667
*              FMTERR1 = ON;           /* REMEMBER IT.               */
         OI    FMTERR1(BUFAD),B'00000100'                       03S1668
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF01664 DS    0H                                               03S1671
*        IF LINE1 + LINEN - ONE        /* CHECK FOR MAXIMUM LINES    */
*         > MAXLINE                    /*  EXCEEDED.                 */
*          THEN                        /*                            */
         SLR   @07,@07                                          03S1671
         IC    @07,LINE1(,BUFFPTR)                              03S1671
         SLR   @02,@02                                          03S1671
         IC    @02,LINEN(,BUFFPTR)                              03S1671
         ALR   @07,@02                                          03S1671
         BCTR  @07,0                                            03S1671
         CH    @07,@CH01051                                     03S1671
         BNH   @RF01671                                         03S1671
*            DO;                       /*                            */
*              EDITLEN(ONE) = LENGTH(CWORK);/* RESTORE NUMBER LENGTH.*/
         MVI   EDITLEN(BUFAD),X'04'                             03S1673
*              EDITDATA(TWO) = ADDR(LINEW); /* POINT TO LINE WORD.   */
         LA    @07,@CC00845                                     03S1674
         STCM  @07,7,EDITDATA+4(BUFAD)                          03S1674
*              EDITLEN(TWO) = LENGTH(LINEW);/* SET LENGTH OF WORD.   */
         MVI   EDITLEN+4(BUFAD),X'04'                           03S1675
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S1676
         BALR  @14,@15                                          03S1676
*              FMTERR1 = ON;           /* REMEMBER IT.               */
         OI    FMTERR1(BUFAD),B'00000100'                       03S1677
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF01671 DS    0H                                               03S1680
*        IF POS1 + XCNT - ONE          /* CHECK FOR MAXIMUM PRINT    */
*         > MAXPOS                     /*  POSITIONS EXCEEDED.       */
*          THEN                        /*                            */
         SLR   @07,@07                                          03S1680
         IC    @07,POS1(,BUFFPTR)                               03S1680
         ALR   @07,XCNT                                         03S1680
         BCTR  @07,0                                            03S1680
         CH    @07,@CH00279                                     03S1680
         BNH   @RF01680                                         03S1680
*            DO;                       /*                            */
*              EDITLEN(ONE) = LENGTH(CWORK);/* RESTORE NUMBER LENGTH.*/
         MVI   EDITLEN(BUFAD),X'04'                             03S1682
*              EDITDATA(TWO) = ADDR(TEXTW); /* POINT TO TEXT WORD.   */
         LA    @07,@CC00847                                     03S1683
         STCM  @07,7,EDITDATA+4(BUFAD)                          03S1683
*              EDITLEN(TWO) = LENGTH(TEXTW);/* SET LENGTH OF WORD.   */
         MVI   EDITLEN+4(BUFAD),X'04'                           03S1684
*              CALL IEBIMSGS;          /* PRINT IT                   */
         L     @15,@CV00037                                     03S1685
         BALR  @14,@15                                          03S1685
*              FMTERR1 = ON;           /* REMEMBER IT.               */
         OI    FMTERR1(BUFAD),B'00000100'                       03S1686
*            END;                      /*                            */
*        EDITLEN(ONE) = ZERO;          /* RESET EDIT INDICATE@Z48MSTT*/
@RF01680 MVI   EDITLEN(BUFAD),X'00'                             03S1688
*        IF FMTERR1 = ON               /* CHECK FOR ANY ERROR.       */
*          THEN                        /*                            */
         TM    FMTERR1(BUFAD),B'00000100'                       03S1689
         BNO   @RF01689                                         03S1689
*            DO;                       /*                            */
*              INHIBITW = ON;          /* PROHIBIT LIBRARY UPDATE.   */
         OI    INHIBITW(BUFAD),B'01000000'                      03S1691
*              RETSAVE                 /* SET RETURN CODE 8 THIS OP. */
*               = MAX(RETSAVE,RC8);    /*                            */
         SLR   @07,@07                                          03S1692
         IC    @07,RETSAVE(,BUFAD)                              03S1692
         LA    @00,8                                            03S1692
         CR    @07,@00                                          03S1692
         BNL   *+6
         LR    @07,@00                                          03S1692
         STC   @07,RETSAVE(,BUFAD)                              03S1692
*              FMTERR1 = OFF;          /* RESET ERROR INDICATOR.     */
         NI    FMTERR1(BUFAD),B'11111011'                       03S1693
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF01689 DS    0H                                               03S1696
*          MAXC                        /* GET MAXIMUM COPY NUMBER.   */
*           = MAX(MAXC,MIN(COPY1+COPYN-ONE,MAXCOPY));           02S1696
         LR    @07,BUFAD                                        02S1696
         AL    @07,@CF01856                                     02S1696
         SLR   @00,@00                                          02S1696
         IC    @00,COPY1(,BUFFPTR)                              02S1696
         SLR   @15,@15                                          02S1696
         IC    @15,COPYN(,BUFFPTR)                              02S1696
         ALR   @00,@15                                          02S1696
         BCTR  @00,0                                            02S1696
         LA    @15,255                                          02S1696
         CR    @00,@15                                          02S1696
         BNH   *+6
         LR    @00,@15                                          02S1696
         SLR   @15,@15                                          02S1696
         IC    @15,MAXC(,@07)                                   02S1696
         CR    @15,@00                                          02S1696
         BNL   *+6
         LR    @15,@00                                          02S1696
         STC   @15,MAXC(,@07)                                   02S1696
*          MINL                        /* GET MINIMUM LINE NUMBER.   */
*           = MIN(MINL,LINE1);         /*                            */
         SLR   @15,@15                                          02S1697
         IC    @15,LINE1(,BUFFPTR)                              02S1697
         SLR   @14,@14                                          02S1697
         IC    @14,MINL(,@07)                                   02S1697
         CR    @14,@15                                          02S1697
         BNH   *+6
         LR    @14,@15                                          02S1697
         STC   @14,MINL(,@07)                                   02S1697
*          MAXL                        /* GET MAXIMUM LINE NUMBER.   */
*           = MAX(MAXL,MIN(LINE1+LINEN-ONE,MAXLINE));           02S1698
         SLR   @14,@14                                          02S1698
         IC    @14,LINEN(,BUFFPTR)                              02S1698
         ALR   @15,@14                                          02S1698
         BCTR  @15,0                                            02S1698
         LA    @14,132                                          02S1698
         CR    @15,@14                                          02S1698
         BNH   *+6
         LR    @15,@14                                          02S1698
         SLR   @14,@14                                          02S1698
         IC    @14,MAXL(,@07)                                   02S1698
         CR    @14,@15                                          02S1698
         BNL   *+6
         LR    @14,@15                                          02S1698
         STC   @14,MAXL(,@07)                                   02S1698
*          BUFFPTR = BUFFPTR           /* STEP TO NEXT SEGMENT.      */
*           + TEXTX + LENGTH(COPYHD);  /*                            */
         LR    @07,BUFFPTR                                      02S1699
         SLR   @00,@00                                          02S1699
         IC    @00,TEXTX(,BUFFPTR)                              02S1699
         ALR   @07,@00                                          02S1699
         AH    @07,@CH00185                                     02S1699
         LR    BUFFPTR,@07                                      02S1699
*        END;                          /* END OF MODULE SCAN         */
         LA    @07,1                                            02S1700
         AH    @07,SEGCNT(,BUFAD)                               02S1700
         STH   @07,SEGCNT(,BUFAD)                               02S1700
         CH    @07,@CH01026                                     02S1700
         BNH   @DL01636                                         02S1700
@DC01636 DS    0H                                               02S1701
*        SEGCNT = SEGCNT - ONE;        /* ALWAYS GOES ONE TO FAR.    */
         LH    @07,SEGCNT(,BUFAD)                               01S1701
         BCTR  @07,0                                            01S1701
         STH   @07,SEGCNT(,BUFAD)                               01S1701
*        RESPECIFY (BUFFPTR) UNRESTRICTED;                      01S1702
*/*********************************************************************
**                                                                    *
**  THIS SECTION CHECKS FOR POSSIBLE OVERRUN CONDITIONS.              *
**                                                                    *
**********************************************************************/
*        DO                            /* START COPY LOOP            */
*         CNT = MINC                   /*  FROM LOWEST               */
*         TO MAXC;                     /*  TO HIGHEST COPY.          */
         LR    @15,BUFAD                                        02S1703
         AL    @15,@CF01856                                     02S1703
         SLR   CNT,CNT                                          02S1703
         IC    CNT,MINC(,@15)                                   02S1703
         B     @DE01703                                         02S1703
@DL01703 DS    0H                                               02S1704
*          DO                          /* START PAGE LOOP            */
*           XCNT = MINL                /*  FROM LOWEST               */
*           TO MAXL;                   /*  TO HIGHEST LINE SPECIFIED */
         LR    @15,BUFAD                                        02S1704
         AL    @15,@CF01856                                     02S1704
         SLR   XCNT,XCNT                                        02S1704
         IC    XCNT,MINL(,@15)                                  02S1704
         B     @DE01704                                         02S1704
@DL01704 DS    0H                                               02S1705
*            NHPG = ZERO;              /* RESET NO HIT PAGE COUNTER. */
         SLR   @15,@15                                          02S1705
         LR    @14,BUFAD                                        02S1705
         AL    @14,@CF01856                                     02S1705
         STH   @15,NHPG(,@14)                                   02S1705
*            NHLN = ZERO;              /* RESET NO HIT LINE COUNTER. */
         STH   @15,NHLN(,@14)                                   02S1706
*            TIME = ZERO;              /* RESET TIME.                */
         ST    @15,TIME(,@14)                                   02S1707
*            DO                        /* START LINE LOOP.           */
*             YCNT = ONE               /*  THRU ALL SEGMENTS.        */
*             TO SEGCNT                /*                            */
*             WHILE CNT ^< CP1(YCNT);  /*                            */
         LA    YCNT,1                                           02S1708
         B     @DE01708                                         02S1708
@DL01708 LR    @04,YCNT                                         02S1708
         SLA   @04,3                                            02S1708
         LR    @15,BUFAD                                        02S1708
         AL    @15,@CF01856                                     02S1708
         SLR   @14,@14                                          02S1708
         IC    @14,CP1-8(@04,@15)                               02S1708
         CR    CNT,@14                                          02S1708
         BL    @DC01708                                         02S1708
*              IF CNT ^< CP1(YCNT)     /* CHECK FOR SEGMENT FOR THIS */
*                         + CPX(YCNT)                           02S1709
*                THEN                  /*  COPY.                     */
         SLR   @00,@00                                          02S1709
         IC    @00,CPX-8(@04,@15)                               02S1709
         ALR   @14,@00                                          02S1709
         CR    CNT,@14                                          02S1709
         BL    @RF01709                                         02S1709
*                  NHPG = NHPG + ONE;  /* INCREMENT NO HIT COUNTER.  */
         LA    @04,1                                            02S1710
         AH    @04,NHPG(,@15)                                   02S1710
         STH   @04,NHPG(,@15)                                   02S1710
*                ELSE                  /* CHECK FOR SEG FOR THIS LINE*/
*                  IF XCNT ^< LN1(YCNT) + LNX(YCNT)             02S1711
*                   × XCNT < LN1(YCNT)                          02S1711
*                    THEN              /*                            */
         B     @RC01709                                         02S1711
@RF01709 LR    @04,YCNT                                         02S1711
         SLA   @04,3                                            02S1711
         LR    @15,BUFAD                                        02S1711
         AL    @15,@CF01856                                     02S1711
         SLR   @14,@14                                          02S1711
         IC    @14,LN1-8(@04,@15)                               02S1711
         SLR   @00,@00                                          02S1711
         IC    @00,LNX-8(@04,@15)                               02S1711
         ALR   @00,@14                                          02S1711
         CR    XCNT,@00                                         02S1711
         BNL   @RT01711                                         02S1711
         CR    XCNT,@14                                         02S1711
         BNL   @RF01711                                         02S1711
@RT01711 DS    0H                                               02S1712
*                      NHLN = NHLN + ONE;                       02S1712
         LR    @04,BUFAD                                        02S1712
         AL    @04,@CF01856                                     02S1712
         LA    @00,1                                            02S1712
         AH    @00,NHLN(,@04)                                   02S1712
         STH   @00,NHLN(,@04)                                   02S1712
*                    ELSE              /* MUST BE A HIT LINE         */
*                      TIME = TIME     /* UPDATE WORKAREA WITH TIME. */
*                         + TXT(YCNT); /*                            */
         B     @RC01711                                         02S1713
@RF01711 LR    @04,BUFAD                                        02S1713
         AL    @04,@CF01856                                     02S1713
         LR    @15,YCNT                                         02S1713
         SLA   @15,3                                            02S1713
         L     @14,TIME(,@04)                                   02S1713
         AL    @14,TXT-8(@15,@04)                               02S1713
         ST    @14,TIME(,@04)                                   02S1713
*              DO;                     /* DETERMINE WHICH MESSAGE    */
@RC01711 DS    0H                                               02S1714
@RC01709 DS    0H                                               02S1715
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL FLAG, ON THE OUTPUT LISTING OF A COPY           *
**  MODIFICATION MODULE, THOSE SEGMENTS WHICH COULD POSSIBLY          *
**  CAUSE A LINE OVERRUN CONDITION IN THE PRINTER.                    *
**                                                                    *
**********************************************************************/
*        ORUNTIME = (NHPG*NHPGT)       /* CALCULATE THE      @Z48MSTT*/
*                        +             /*  TOTAL TIME        @Z48MSTT*/
*                   (NHLN*NHLNT)       /*  NECSSARY TO       @Z48MSTT*/
*                        +             /*  PROCESS CURRENT   @Z48MSTT*/
*                      TIME;           /*  LINE.             @Z48MSTT*/
         LR    @04,BUFAD                                        03S1715
         AL    @04,@CF01856                                     03S1715
         LH    @00,NHPG(,@04)                                   03S1715
         MH    @00,@CH01040                                     03S1715
         LH    @15,NHLN(,@04)                                   03S1715
         MH    @15,@CH01042                                     03S1715
         ALR   @00,@15                                          03S1715
         AL    @00,TIME(,@04)                                   03S1715
         ST    @00,ORUNTIME(,@04)                               03S1715
*        IF ORUNTIME > TA6LPI          /* CHECK FOR OVERRUN  @Z48MSTT*/
*          THEN                        /*  AT 6 LPI.         @Z48MSTT*/
         C     @00,@CF01048                                     03S1716
         BNH   @RF01716                                         03S1716
*            DO;                       /* SET OUTPUT LISTING @Z48MSTT*/
*              DEL(YCNT) = CHAR3;      /*  FLAG,THIS SEGMENT.@Z48MSTT*/
         LR    @04,BUFAD                                        03S1718
         ALR   @04,YCNT                                         03S1718
         MVI   DEL+795(@04),C'3'                                03S1718
*              EDITDATA(FOUR)          /* REQ 6 LPI MESSAGE. @Z48MSTT*/
*               = ADDR(CHAR6);         /*                    @Z48MSTT*/
         LA    @04,@CC00788                                     03S1719
         STCM  @04,7,EDITDATA+12(BUFAD)                         03S1719
*              EDITLEN(FOUR)           /*                    @Z48MSTT*/
*               = LENGTH(CHAR6);       /*                    @Z48MSTT*/
         MVI   EDITLEN+12(BUFAD),X'02'                          03S1720
*            END;                      /*                    @Z48MSTT*/
*          ELSE                        /*                    @Z48MSTT*/
*           IF ORUNTIME > TA8LPI       /* CHECK FOR OVERRUN  @Z48MSTT*/
*             THEN                     /*  AT 8 LPI.         @Z48MSTT*/
         B     @RC01716                                         03S1722
@RF01716 LR    @04,BUFAD                                        03S1722
         AL    @04,@CF01856                                     03S1722
         L     @04,ORUNTIME(,@04)                               03S1722
         C     @04,@CF01046                                     03S1722
         BNH   @RF01722                                         03S1722
*               DO;                    /* SET OUTPUT LISTING @Z48MSTT*/
*                 DEL(YCNT) =          /*  FLAG,THIS SEGMENT.@Z48MSTT*/
*                  MAX(DEL(YCNT),CHAR2);/*                   @Z48MSTT*/
         LA    @04,796                                          03S1724
         ALR   @04,BUFAD                                        03S1724
         LR    @15,YCNT                                         03S1724
         BCTR  @15,0                                            03S1724
         SLR   @14,@14                                          03S1724
         IC    @14,DEL(@15,@04)                                 03S1724
         LA    @15,242                                          03S1724
         CR    @14,@15                                          03S1724
         BNL   *+6
         LR    @14,@15                                          03S1724
         BCTR  @04,0                                            03S1724
         STC   @14,DEL(YCNT,@04)                                03S1724
*                 EDITDATA(FOUR)       /* REQ 8 LPI MESSAGE. @Z48MSTT*/
*                  = ADDR(CHAR8);      /*                    @Z48MSTT*/
         LA    @04,@CC00790                                     03S1725
         STCM  @04,7,EDITDATA+12(BUFAD)                         03S1725
*                 EDITLEN(FOUR)        /*                    @Z48MSTT*/
*                  = LENGTH(CHAR8);    /*                    @Z48MSTT*/
         MVI   EDITLEN+12(BUFAD),X'02'                          03S1726
*               END;                   /*                    @Z48MSTT*/
*             ELSE                     /*                    @Z48MSTT*/
*               IF ORUNTIME > TA12LPI  /* CHECK FOR OVERRUN  @Z48MSTT*/
*                 THEN                 /*  AT 12 LPI.        @Z48MSTT*/
         B     @RC01722                                         03S1728
@RF01722 LR    @04,BUFAD                                        03S1728
         AL    @04,@CF01856                                     03S1728
         L     @04,ORUNTIME(,@04)                               03S1728
         C     @04,@CF01044                                     03S1728
         BNH   @RF01728                                         03S1728
*                   DO;                /* SET OUTPUT LISTING @Z48MSTT*/
*                     DEL(YCNT) =      /*  FLAG FOR THIS     @Z48MSTT*/
*                      MAX(DEL(YCNT),CHAR1);/* SEGMENT.      @Z48MSTT*/
         LA    @04,796                                          03S1730
         ALR   @04,BUFAD                                        03S1730
         LR    @15,YCNT                                         03S1730
         BCTR  @15,0                                            03S1730
         SLR   @14,@14                                          03S1730
         IC    @14,DEL(@15,@04)                                 03S1730
         LA    @15,241                                          03S1730
         CR    @14,@15                                          03S1730
         BNL   *+6
         LR    @14,@15                                          03S1730
         BCTR  @04,0                                            03S1730
         STC   @14,DEL(YCNT,@04)                                03S1730
*                   END;               /*                    @Z48MSTT*/
*                 ELSE;                /*****NO OVERRUN******@Z48MSTT*/
@RF01728 DS    0H                                               03S1733
*                                      /* GOTO NEXT PAGE OF LISTING. */
*        IF ORUNTIME > TA12LPI         /*                    @Z48MSTT*/
*          THEN                        /* TEST FOR ANY MSG.  @Z48MSTT*/
@RC01722 DS    0H                                               03S1733
@RC01716 LR    @04,BUFAD                                        03S1733
         AL    @04,@CF01856                                     03S1733
         L     @04,ORUNTIME(,@04)                               03S1733
         C     @04,@CF01044                                     03S1733
         BNH   @RF01733                                         03S1733
*            DO;                       /*                    @Z48MSTT*/
*              FWORK = CNT;            /* GET COPY NUMBER.           */
         ST    CNT,FWORK(,BUFAD)                                03S1735
*              CALL CONVERT;           /* MAKE IT PRINTABLE.         */
         BAL   @14,CONVERT                                      03S1736
*              COPSV = CWORK3;         /* SAVE IT.                   */
         MVC   COPSV(3,BUFAD),CWORK3(BUFAD)                     03S1737
*              FWORK = XCNT;           /* GET LINE NUMBER.           */
         ST    XCNT,FWORK(,BUFAD)                               03S1738
*              CALL CONVERT;           /* MAKE IT PRINTABLE.         */
         BAL   @14,CONVERT                                      03S1739
*              LINSV = CWORK3;         /* SAVE IT.           @Z48MSTT*/
         MVC   LINSV(3,BUFAD),CWORK3(BUFAD)                     03S1740
*              FWORK = YCNT;           /* GET SEGMENT NUMBER.        */
         ST    YCNT,FWORK(,BUFAD)                               03S1741
*              CALL CONVERT;           /* MAKE IT PRINTABLE.         */
         BAL   @14,CONVERT                                      03S1742
*              EDITDATA(ONE) = ADDR(CWORK3);  /***********************/
         LA    @04,CWORK3(,BUFAD)                               03S1743
         STCM  @04,7,EDITDATA(BUFAD)                            03S1743
*              EDITLEN(ONE) = LENGTH(CWORK3); /* SET                 */
         MVI   EDITLEN(BUFAD),X'03'                             03S1744
*              EDITDATA(TWO) = ADDR(COPSV);   /*   MESSAGE           */
         LA    @04,COPSV(,BUFAD)                                03S1745
         STCM  @04,7,EDITDATA+4(BUFAD)                          03S1745
*              EDITLEN(TWO) = LENGTH(COPSV);  /*         EDIT        */
         MVI   EDITLEN+4(BUFAD),X'03'                           03S1746
*              EDITDATA(THREE) = ADDR(LINSV); /*            VALUES.  */
         LA    @04,LINSV(,BUFAD)                                03S1747
         STCM  @04,7,EDITDATA+8(BUFAD)                          03S1747
*              EDITLEN(THREE) = LENGTH(LINSV);/***********************/
         MVI   EDITLEN+8(BUFAD),X'03'                           03S1748
*              MSGN = IEBA33I;         /* OVERRUN MESSAGE.           */
         MVI   MSGN(BUFAD),X'21'                                03S1749
*              CALL IEBIMSGS;          /* PRINT IT.                  */
         L     @15,@CV00037                                     03S1750
         BALR  @14,@15                                          03S1750
*              RETSAVE                 /* RETURN CODE 4 THIS         */
*               = MAX(RETSAVE,RC4);    /*  OPERATION.                */
         SLR   @04,@04                                          03S1751
         IC    @04,RETSAVE(,BUFAD)                              03S1751
         LA    @00,4                                            03S1751
         CR    @04,@00                                          03S1751
         BNL   *+6
         LR    @04,@00                                          03S1751
         STC   @04,RETSAVE(,BUFAD)                              03S1751
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF01733 DS    0H                                               03S1754
*              END;                    /*                            */
*            END;                      /* END LINE LOOP.             */
         AH    YCNT,@CH00060                                    02S1755
@DE01708 CH    YCNT,SEGCNT(,BUFAD)                              02S1755
         BNH   @DL01708                                         02S1755
@DC01708 DS    0H                                               02S1756
*          END;                        /* END PAGE LOOP.             */
         AH    XCNT,@CH00060                                    02S1756
@DE01704 LR    @15,BUFAD                                        02S1756
         AL    @15,@CF01856                                     02S1756
         SLR   @14,@14                                          02S1756
         IC    @14,MAXL(,@15)                                   02S1756
         CR    XCNT,@14                                         02S1756
         BNH   @DL01704                                         02S1756
*        END;                          /* END COPY LOOP.             */
         AH    CNT,@CH00060                                     02S1757
@DE01703 LR    @03,BUFAD                                        02S1757
         AL    @03,@CF01856                                     02S1757
         SLR   @00,@00                                          02S1757
         IC    @00,MAXC(,@03)                                   02S1757
         CR    CNT,@00                                          02S1757
         BNH   @DL01703                                         02S1757
*        GEN REFS(SAVE2)               /******************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*   END COPCHK;                        /* RETURN TO CALLER.          */
@EL00023 DS    0H                                               01S1759
@EF00023 DS    0H                                               01S1759
@ER00023 LM    @14,@12,12(@13)                                  01S1759
         BR    @14                                              01S1759
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL PRINT A GRAPHIC CHARACTER MODIFICATION MODULE.  *
**                                                                    *
**********************************************************************/
*GCMPRT:                                                        01S1760
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1760
GCMPRT   STM   @14,@12,12(@13)                                  01S1760
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        RESPECIFY (BUFFPTR) RESTRICTED;                        01S1762
*        IF READMOD = ON               /* CHECK FOR READ ONLY.       */
*         & LOADFLAG = ALBIT           /* CHECK FOR MODULE LOADED.   */
*          THEN                        /*                            */
         TM    READMOD(BUFAD),B'00000001'                       01S1763
         BNO   @RF01763                                         01S1763
         CLI   LOADFLAG(BUFAD),X'FF'                            01S1763
         BNE   @RF01763                                         01S1763
*            DO;                       /* MODULE WAS LOADED.         */
*              SEGCNT = LMODCNT;       /* GET BYTE COUNT.            */
         SLR   @07,@07                                          01S1765
         ICM   @07,7,LOADMOD(BUFAD)                             01S1765
         MVC   SEGCNT(2,BUFAD),LMODCNT(@07)                     01S1765
*              BUFFPTR = ADDR(LMODBOD);/* INITIALIZE REG WITH ADDR.  */
         LA    BUFFPTR,LMODBOD(,@07)                            01S1766
*            END;                      /*                            */
*          ELSE                                                 01S1768
*            DO;                       /* MODULE WAS READ.           */
         B     @RC01763                                         01S1768
@RF01763 DS    0H                                               01S1769
*              SEGCNT = MODCNT;        /* GET BYTE COUNT.            */
         MVC   SEGCNT(2,BUFAD),MODCNT(BUFAD)                    01S1769
*              BUFFPTR = ADDR(MODBOD); /* INITIALIZE REG WITH ADDR.  */
         LA    BUFFPTR,MODBOD(,BUFAD)                           01S1770
*            END;                      /*                            */
*        SEGCNT = SEGCNT/LENGTH(GRAFSEG);/* CALC 73 BYTE SEGMENTS.   */
@RC01763 LH    @02,SEGCNT(,BUFAD)                               01S1772
         SRDA  @02,32                                           01S1772
         D     @02,@CF00610                                     01S1772
         STH   @03,SEGCNT(,BUFAD)                               01S1772
*        HPGN = ZERO;                                           01S1773
         SLR   @07,@07                                          01S1773
         ST    @07,HPGN                                         01S1773
*        DO                            /* START SEGMENT PRINT.       */
*         WHILE SEGCNT^=ZERO;          /* TILL NO MORE SEGMENTS.     */
         B     @DE01774                                         01S1774
@DL01774 DS    0H                                               01S1775
*          IF NEXT = ZERO              /* CHECK FOR START OF NEW PAGE*/
*            THEN                      /*                            */
         ICM   @07,3,NEXT(BUFAD)                                01S1775
         BNZ   @RF01775                                         01S1775
*              DO;                     /*                            */
*                NEXT = ONE;           /* START COUNTER.             */
         LA    @07,1                                            01S1777
         STH   @07,NEXT(,BUFAD)                                 01S1777
*                PRTQELEM = SKIP;      /* GO TO NEW PAGE.            */
         MH    @07,@CH00190                                     01S1778
         AL    @07,@CF01883                                     01S1778
         LA    @07,MSGSAVE-10648(@07,BUFAD)                     01S1778
         MVI   PRTQELEM+1(@07),C' '                             01S1778
         MVC   PRTQELEM+2(119,@07),PRTQELEM+1(@07)              01S1778
         MVI   PRTQELEM(@07),C'1'                               01S1778
*                TBN = BNAME;          /* WITH MODULE NAME AS HEADING*/
         MVC   TBN(8,@07),BNAME(BUFAD)                          01S1779
*              END;                    /*                            */
*            ELSE;                     /* NOT NEW PAGE.              */
@RF01775 DS    0H                                               01S1782
*          HCNT = MIN(SEGCNT,FOUR);    /* XLATE MAX OF 4 SEGMENTS    */
         LH    @15,SEGCNT(,BUFAD)                               01S1782
         LA    HCNT,4                                           01S1782
         CR    HCNT,@15                                         01S1782
         BNH   *+6
         LR    HCNT,@15                                         01S1782
*          SEGCNT = SEGCNT - HCNT;     /* REDUCE SEGMENT COUNTER     */
         SLR   @15,HCNT                                         01S1783
         STH   @15,SEGCNT(,BUFAD)                               01S1783
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL DEVELOPE THE APPROPRIATE HEADING INFORMATION    *
**  TO BE PLACED IN THE PRINT QUEUE FOR ONE TO FOUR SEGMENTS.         *
**                                                                    *
**********************************************************************/
*        NEXT = NEXT + ONE;            /* INCREMENT PRINT QUEUE CNTR.*/
         LA    @15,1                                            02S1784
         SLR   @14,@14                                          02S1784
         ICM   @14,3,NEXT(BUFAD)                                02S1784
         ALR   @14,@15                                          02S1784
         STH   @14,NEXT(,BUFAD)                                 02S1784
*        PRTQELEM = DOUBL;             /* DOUBLE SPACE & CLEAR LINE. */
         MH    @14,@CH00190                                     02S1785
         AL    @14,@CF01883                                     02S1785
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1785
         MVI   PRTQELEM+1(@14),C' '                             02S1785
         MVC   PRTQELEM+2(119,@14),PRTQELEM+1(@14)              02S1785
         MVI   PRTQELEM(@14),C'0'                               02S1785
*        HPGN = HPGN + ONE;                                     02S1786
         L     @14,HPGN                                         02S1786
         ALR   @14,@15                                          02S1786
         ST    @14,HPGN                                         02S1786
*        DO                            /* SEGMENT HEADING START.     */
*         CNT = ONE                    /*                            */
*         TO HCNT;                     /* HEAD UP TO FOUR SEGMENTS   */
         LR    CNT,@15                                          02S1787
         B     @DE01787                                         02S1787
@DL01787 DS    0H                                               02S1788
*          GRCHARHD(CNT) = SEGHEAD;    /* SET SEGMENT HEADING        */
         LR    @03,CNT                                          02S1788
         MH    @03,@CH00375                                     02S1788
         SLR   @15,@15                                          02S1788
         ICM   @15,3,NEXT(BUFAD)                                02S1788
         MH    @15,@CH00190                                     02S1788
         AL    @15,@CF01883                                     02S1788
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1788
         AH    @15,@CH00060                                     02S1788
         ST    @03,@TF00002                                     02S1788
         ALR   @03,@15                                          02S1788
         AL    @03,@CF01907                                     02S1788
         MVI   GRCHARHD+8(@03),C' '                             02S1788
         MVC   GRCHARHD+9(21,@03),GRCHARHD+8(@03)               02S1788
         MVC   GRCHARHD(8,@03),SEGHEAD                          02S1788
*          FWORK = (HPGN - ONE) * FOUR /* DETERMINE SEGMENT NUMBER   */
*           + CNT;                     /*                            */
         L     @03,HPGN                                         02S1789
         BCTR  @03,0                                            02S1789
         SLA   @03,2                                            02S1789
         ALR   @03,CNT                                          02S1789
         ST    @03,FWORK(,BUFAD)                                02S1789
*          CVD(FWORK,DWORK);           /* MAKE SEGMENT               */
         CVD   @03,DWORK(,BUFAD)                                02S1790
*          UNPK(CWORK,PWORK);          /* NUMBER                     */
         UNPK  CWORK(4,BUFAD),PWORK(2,BUFAD)                    02S1791
*          CWORK(LENGTH(CWORK)) =      /* PRINTABLE.                 */
*            CWORK(LENGTH(CWORK)) × MASK;/*                          */
         OI    CWORK+3(BUFAD),C'0'                              02S1792
*          SEGNO(CNT)                  /* SET NO. IN HDG.            */
*           = CWORK(TWO:LENGTH(CWORK));                         02S1793
         AL    @15,@TF00002                                     02S1793
         AL    @15,@CF01908                                     02S1793
         MVC   SEGNO-11(3,@15),CWORK+1(BUFAD)                   02S1793
*        END;                          /* SEGMENT HEADING END.       */
         AH    CNT,@CH00060                                     02S1794
@DE01787 CR    CNT,HCNT                                         02S1794
         BNH   @DL01787                                         02S1794
*        NEXT = NEXT + ONE;            /* INCREMENT PRINT QUEUE      */
         LA    @15,1                                            02S1795
         SLR   @14,@14                                          02S1795
         ICM   @14,3,NEXT(BUFAD)                                02S1795
         ALR   @14,@15                                          02S1795
         STH   @14,NEXT(,BUFAD)                                 02S1795
*        PRTQELEM = SINGL;             /* SINGLE SPACE CLEAR LINE.   */
         MH    @14,@CH00190                                     02S1796
         AL    @14,@CF01883                                     02S1796
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1796
         MVI   PRTQELEM+1(@14),C' '                             02S1796
         MVC   PRTQELEM+2(119,@14),PRTQELEM+1(@14)              02S1796
         MVI   PRTQELEM(@14),C' '                               02S1796
*        DO                            /* ASSIGNMENT HEADING START.  */
*         CNT = ONE                    /* CONTINUATION OF            */
*         TO HCNT;                     /* HEADING                    */
         LR    CNT,@15                                          02S1797
         B     @DE01797                                         02S1797
@DL01797 DS    0H                                               02S1798
*          GRCHARHD(CNT) = GRAFHEAD;   /* INITIALIZE HEADING         */
         LR    @03,CNT                                          02S1798
         MH    @03,@CH00375                                     02S1798
         SLR   @15,@15                                          02S1798
         ICM   @15,3,NEXT(BUFAD)                                02S1798
         MH    @15,@CH00190                                     02S1798
         AL    @15,@CF01883                                     02S1798
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1798
         AH    @15,@CH00060                                     02S1798
         ST    @03,@TF00002                                     02S1798
         ALR   @03,@15                                          02S1798
         AL    @03,@CF01907                                     02S1798
         MVC   GRCHARHD(30,@03),GRAFHEAD                        02S1798
*          UNITS = GASNMT;             /* ASSIGNMENT FROM SEGMENT    */
         LR    @03,CNT                                          02S1799
         MH    @03,@CH00610                                     02S1799
         AL    @03,@CF01891                                     02S1799
         LA    @03,GRAFBOD(@03,BUFFPTR)                         02S1799
         MVC   UNITS(1,BUFAD),GASNMT(@03)                       02S1799
*          UNPK(CWORK(1:3),CWORK(2:3));/* MAKE                       */
         UNPK  CWORK(3,BUFAD),CWORK+1(2,BUFAD)                  02S1800
*          FWORK = FWORK & MSK0F;      /* ASSIGNMENT                 */
         L     @14,FWORK(,BUFAD)                                02S1801
         N     @14,@CF00797                                     02S1801
         ST    @14,FWORK(,BUFAD)                                02S1801
*          TR(UWORK,TRTAB);            /* VALUE                      */
         TR    UWORK(2,BUFAD),TRTAB                             02S1802
*          GRASN(CNT) = UWORK;         /* PRINTABLE.                 */
         LR    @14,@15                                          02S1803
         AL    @14,@TF00002                                     02S1803
         AL    @14,@CF01908                                     02S1803
         MVC   GRASN-11(2,@14),UWORK(BUFAD)                     02S1803
*          IF PITBITS(ONE) = ONNER     /* CHECK FOR 15 PITCH.        */
*            THEN                      /*                            */
         TM    PITBITS(@03),B'00110000'                         02S1804
         BNO   @RF01804                                         02S1804
*              GRPIT(CNT) = CHAR5;     /* INDICATE 15 PITCH.         */
         AL    @15,@TF00002                                     02S1805
         AL    @15,@CF01909                                     02S1805
         MVI   GRPIT-22(@15),C'5'                               02S1805
*            ELSE                      /*                            */
*            IF PIT2(ONE) = ON         /* CHECK FOR 12 PITCH.        */
*              THEN                    /*                            */
         B     @RC01804                                         02S1806
@RF01804 LR    @03,CNT                                          02S1806
         MH    @03,@CH00610                                     02S1806
         AL    @03,@CF01891                                     02S1806
         LA    @03,GRAFBOD(@03,BUFFPTR)                         02S1806
         TM    PIT2(@03),B'00010000'                            02S1806
         BNO   @RF01806                                         02S1806
*                GRPIT(CNT) = CHAR2;   /* INDICATE 12 PITCH.         */
         LR    @03,CNT                                          02S1807
         MH    @03,@CH00375                                     02S1807
         SLR   @15,@15                                          02S1807
         ICM   @15,3,NEXT(BUFAD)                                02S1807
         MH    @15,@CH00190                                     02S1807
         AL    @15,@CF01883                                     02S1807
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1807
         ALR   @15,@03                                          02S1807
         AL    @15,@CF01910                                     02S1807
         MVI   GRPIT-22(@15),C'2'                               02S1807
*              ELSE;                   /* MUST BE 10 PITCH.          */
@RF01806 DS    0H                                               02S1809
*        END;                          /* END ASSIGNMENT HEADING.    */
@RC01804 AH    CNT,@CH00060                                     02S1809
@DE01797 CR    CNT,HCNT                                         02S1809
         BNH   @DL01797                                         02S1809
*        NEXT = NEXT + ONE;            /* INCREMENT PRINT QUEUE.     */
         LA    @15,1                                            02S1810
         SLR   @14,@14                                          02S1810
         ICM   @14,3,NEXT(BUFAD)                                02S1810
         ALR   @14,@15                                          02S1810
         STH   @14,NEXT(,BUFAD)                                 02S1810
*        PRTQELEM = SINGL;             /* SINGLE SPACE.              */
         MH    @14,@CH00190                                     02S1811
         AL    @14,@CF01883                                     02S1811
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1811
         MVI   PRTQELEM+1(@14),C' '                             02S1811
         MVC   PRTQELEM+2(119,@14),PRTQELEM+1(@14)              02S1811
         MVI   PRTQELEM(@14),C' '                               02S1811
*        DO                            /* SET COLUMN HEADING.        */
*         CNT = ONE                    /*                            */
*         TO HCNT;                     /*                            */
         LR    CNT,@15                                          02S1812
         B     @DE01812                                         02S1812
@DL01812 DS    0H                                               02S1813
*          BITHD = BITHEAD;            /* ONE THRU EIGHTEEN.         */
         LR    @03,CNT                                          02S1813
         MH    @03,@CH00375                                     02S1813
         SLR   @15,@15                                          02S1813
         ICM   @15,3,NEXT(BUFAD)                                02S1813
         MH    @15,@CH00190                                     02S1813
         AL    @15,@CF01883                                     02S1813
         LA    @15,MSGSAVE-10648(@15,BUFAD)                     02S1813
         AL    @15,@CF01911                                     02S1813
         LA    @03,GRCHARHD(@03,@15)                            02S1813
         LA    @03,GRAFBIT(,@03)                                02S1813
         MVC   BITHD(18,@03),BITHEAD                            02S1813
*        END;                          /*                            */
         AH    CNT,@CH00060                                     02S1814
@DE01812 CR    CNT,HCNT                                         02S1814
         BNH   @DL01812                                         02S1814
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL INTERROGATE UP TO FOUR SEGMENTS AT A TIME AND   *
**  DEVELOPE A GRAPHIC REPRESENTATION OF THE CHARACTER.               *
**                                                                    *
**********************************************************************/
*         DO                           /* START CHARACTER DEVELOPMENT*/
*          YCNT = ONE                  /* INITIALIZE VERTICAL COUNTER*/
*          TO DIM(RASTER);             /*                            */
         LA    YCNT,1                                           02S1815
@DL01815 DS    0H                                               02S1816
*           NEXT = NEXT + ONE;         /* INCREMENT PRINT QUEUE      */
         LA    @04,1                                            02S1816
         SLR   @00,@00                                          02S1816
         ICM   @00,3,NEXT(BUFAD)                                02S1816
         ALR   @04,@00                                          02S1816
         STH   @04,NEXT(,BUFAD)                                 02S1816
*           PRTQELEM = SINGL;          /* SINGLE SPACE AND CLEAR     */
         MH    @04,@CH00190                                     02S1817
         AL    @04,@CF01883                                     02S1817
         LA    @04,MSGSAVE-10648(@04,BUFAD)                     02S1817
         MVI   PRTQELEM+1(@04),C' '                             02S1817
         MVC   PRTQELEM+2(119,@04),PRTQELEM+1(@04)              02S1817
         MVI   PRTQELEM(@04),C' '                               02S1817
*           FWORK = YCNT;              /* LINE NUMBER FOR CONVERT.   */
         ST    YCNT,FWORK(,BUFAD)                               02S1818
*           CALL CONVERT;              /* NO. RETURNS IN CWORK2.     */
         BAL   @14,CONVERT                                      02S1819
*           RESPECIFY (SHIFT) RESTRICTED;                       02S1820
*           DO                         /* DEVELOPE UP TO FOUR        */
*            CNT = ONE                 /* CHARACTERS AT A TIME.      */
*            TO HCNT;                  /*                            */
         LA    CNT,1                                            02S1821
         B     @DE01821                                         02S1821
@DL01821 DS    0H                                               02S1822
*            LNO = CWORK2;             /* LABEL THIS LINE.           */
         LR    @03,CNT                                          02S1822
         MH    @03,@CH00375                                     02S1822
         LA    @15,1                                            02S1822
         SLR   @14,@14                                          02S1822
         ICM   @14,3,NEXT(BUFAD)                                02S1822
         MH    @14,@CH00190                                     02S1822
         AL    @14,@CF01883                                     02S1822
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1822
         ALR   @14,@15                                          02S1822
         AL    @14,@CF01907                                     02S1822
         LA    @03,GRCHARHD(@03,@14)                            02S1822
         MVC   LNO(2,@03),CWORK2(BUFAD)                         02S1822
*            DOT1 = PERIOD;            /* SET MARGINS.               */
         MVI   DOT1(@03),C'.'                                   02S1823
*            DOT2 = PERIOD;            /*                            */
         MVI   DOT2(@03),C'.'                                   02S1824
*            SHIFT = RASTER(YCNT);     /* GET ONE RASTER SCAN LINE.  */
         LR    @03,YCNT                                         02S1825
         MH    @03,@CH00111                                     02S1825
         LR    @14,CNT                                          02S1825
         MH    @14,@CH00610                                     02S1825
         AL    @14,@CF01891                                     02S1825
         LA    @14,GRAFBOD(@14,BUFFPTR)                         02S1825
         AL    @14,@CF01892                                     02S1825
         L     SHIFT,RASTER-1(@03,@14)                          02S1825
         LA    SHIFT,0(,SHIFT)                                  02S1825
*            SRL(SHIFT,SIX);           /* ONLY NEED GRAPHIC          */
         SRL   SHIFT,6                                          02S1826
*            SLL(SHIFT,FORTN);         /*  BITS.                     */
         SLL   SHIFT,14                                         02S1827
*             DO                       /* INTERROGATE ONE RASTER     */
*              XCNT = ONE              /* SCAN LINE.                 */
*              TO DIM(GRAFBIT)         /*                            */
*              WHILE SHIFT ^= ZERO;    /* FINISHED WHEN OUT OF BITS. */
         LR    XCNT,@15                                         02S1828
@DL01828 SLR   @15,@15                                          02S1828
         CR    SHIFT,@15                                        02S1828
         BE    @DC01828                                         02S1828
*               IF SHIFT < ZERO        /* CHECK HI ORDER FOR BIT.    */
*                THEN                  /* CHECK PITCH RANGE.         */
         CR    SHIFT,@15                                        02S1829
         BNL   @RF01829                                         02S1829
*                  IF (XCNT<FOUR&PIT1(ONE)=ON)                  02S1830
*                   × (XCNT>FIFTN&PIT2(ONE)=ON)                 02S1830
*                    THEN              /*                            */
         CH    XCNT,@CH00050                                    02S1830
         BNL   @GL00046                                         02S1830
         LR    @15,CNT                                          02S1830
         MH    @15,@CH00610                                     02S1830
         AL    @15,@CF01891                                     02S1830
         LA    @15,GRAFBOD(@15,BUFFPTR)                         02S1830
         TM    PIT1(@15),B'00100000'                            02S1830
         BO    @RT01830                                         02S1830
@GL00046 CH    XCNT,@CH00155                                    02S1830
         BNH   @RF01830                                         02S1830
         LR    @15,CNT                                          02S1830
         MH    @15,@CH00610                                     02S1830
         AL    @15,@CF01891                                     02S1830
         LA    @15,GRAFBOD(@15,BUFFPTR)                         02S1830
         TM    PIT2(@15),B'00010000'                            02S1830
         BNO   @RF01830                                         02S1830
@RT01830 DS    0H                                               02S1831
*                      GRAFBIT(XCNT)   /* DOLLAR SIGN PRINTS FOR BIT */
*                       = DOLLA;       /* OUT OF RANGE.              */
         LR    @15,CNT                                          02S1831
         MH    @15,@CH00375                                     02S1831
         SLR   @14,@14                                          02S1831
         ICM   @14,3,NEXT(BUFAD)                                02S1831
         MH    @14,@CH00190                                     02S1831
         AL    @14,@CF01883                                     02S1831
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1831
         AL    @14,@CF01911                                     02S1831
         LA    @15,GRCHARHD(@15,@14)                            02S1831
         ALR   @15,XCNT                                         02S1831
         MVI   GRAFBIT-1(@15),C'$'                              02S1831
*                    ELSE              /*                            */
*                      GRAFBIT(XCNT)   /* ASTERISK PRINTS FOR        */
*                       = SPLAT;       /* VALID BIT.                 */
         B     @RC01830                                         02S1832
@RF01830 LR    @15,CNT                                          02S1832
         MH    @15,@CH00375                                     02S1832
         SLR   @14,@14                                          02S1832
         ICM   @14,3,NEXT(BUFAD)                                02S1832
         MH    @14,@CH00190                                     02S1832
         AL    @14,@CF01883                                     02S1832
         LA    @14,MSGSAVE-10648(@14,BUFAD)                     02S1832
         AL    @14,@CF01911                                     02S1832
         LA    @15,GRCHARHD(@15,@14)                            02S1832
         ALR   @15,XCNT                                         02S1832
         MVI   GRAFBIT-1(@15),C'*'                              02S1832
*              SLL(SHIFT,ONE);         /* GET NEXT BIT TO HI ORDER.  */
@RC01830 DS    0H                                               02S1833
@RF01829 SLL   SHIFT,1                                          02S1833
*            END;                      /* END THIS RASTER SCAN.      */
         AH    XCNT,@CH00060                                    02S1834
         CH    XCNT,@CH00183                                    02S1834
         BNH   @DL01828                                         02S1834
@DC01828 DS    0H                                               02S1835
*          END;                        /* END THIS LINE.             */
         AH    CNT,@CH00060                                     02S1835
@DE01821 CR    CNT,HCNT                                         02S1835
         BNH   @DL01821                                         02S1835
*          RESPECIFY (SHIFT) UNRESTRICTED;                      02S1836
*        END;                          /* END THIS GROUP.            */
         AH    YCNT,@CH00060                                    02S1837
         CH    YCNT,@CH00053                                    02S1837
         BNH   @DL01815                                         02S1837
*          BUFFPTR                     /* STEP TO NEXT               */
*           = BUFFPTR + HCNT * LENGTH(GRAFSEG);                 01S1838
         LR    @00,HCNT                                         01S1838
         MH    @00,@CH00610                                     01S1838
         ALR   BUFFPTR,@00                                      01S1838
*          IF NEXT => PGFUL            /* CHECK FOR FULL PAGE OR     */
*           × SEGCNT = ZERO            /* LAST SEGMENT IN QUEUE      */
*            THEN                      /*                            */
         CLC   NEXT(2,BUFAD),@CH00746                           01S1839
         BNL   @RT01839                                         01S1839
         ICM   @07,3,SEGCNT(BUFAD)                              01S1839
         BNZ   @RF01839                                         01S1839
@RT01839 DS    0H                                               01S1840
*              CALL PRINTQ;            /* PRINT ONE PAGE.            */
         BAL   @14,PRINTQ                                       01S1840
*            ELSE;                     /*                            */
@RF01839 DS    0H                                               01S1842
*        END;                          /* END SEGMENT PRINT.         */
@DE01774 ICM   @07,3,SEGCNT(BUFAD)                              01S1842
         BNZ   @DL01774                                         01S1842
*        GEN REFS(SAVE2)               /******************************/
*          (L  @13,SAVE2+BACK(,BUFAD));/* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*        RESPECIFY (BUFFPTR) UNRESTRICTED;                      01S1844
*   END GCMPRT;                        /* RETURN TO CALLER.          */
@EL00024 DS    0H                                               01S1845
@EF00024 DS    0H                                               01S1845
@ER00024 LM    @14,@12,12(@13)                                  01S1845
         BR    @14                                              01S1845
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL TEST TO INSURE THE DELETE SEGMENT REQUEST WAS   *
**  SATISFIED AND, IF NOT, WILL ISSUE APPROPRIATE MESSAGES.           *
**                                                                    *
**********************************************************************/
*DELCHK:                                                        01S1846
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1846
DELCHK   STM   @14,@12,12(@13)                                  01S1846
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        DO                            /*                            */
*         CNT = ONE                    /* CHECK ENTIRE DELETE ARRAY. */
*         TO DIM(DEL)                  /*  AS LONG AS THERE ARE      */
*         WHILE SCNT > ONE;            /*  ENTRIES TO BE HONORED.    */
         LA    CNT,1                                            01S1848
@DL01848 CLC   SCNT(2,BUFAD),@CH00060                           01S1848
         BNH   @DC01848                                         01S1848
*          IF DEL(CNT) ^= ZERO         /* NONZERO ENTRIES INDICATE   */
*            THEN                      /*                            */
         SLR   @03,@03                                          01S1849
         IC    @03,DEL+795(CNT,BUFAD)                           01S1849
         CH    @03,@CH00462                                     01S1849
         BE    @RF01849                                         01S1849
*              DO;                     /* DELETE NOT HONORED.        */
*                CVD(CNT,DWORK);       /* CONVERT SEGMENT NUMBER     */
         CVD   CNT,DWORK(,BUFAD)                                01S1851
*                UNPK(CWORK,PWORK);    /*  TO                        */
         UNPK  CWORK(4,BUFAD),PWORK(2,BUFAD)                    01S1852
*                CWORK(LENGTH(CWORK))  /*  PRINTABLE CHARACTERS.     */
*                 = CWORK(LENGTH(CWORK)) × MASK;                01S1853
         OI    CWORK+3(BUFAD),C'0'                              01S1853
*                EDITDATA(ONE)         /* SET DATA ADDRESS FOR MSG.  */
*                 = ADDR(CWORK);       /*                            */
         LA    @03,CWORK(,BUFAD)                                01S1854
         STCM  @03,7,EDITDATA(BUFAD)                            01S1854
*                EDITLEN(ONE)          /* SET DATA LENGTH ALSO.      */
*                 = LENGTH(CWORK);     /*                            */
         MVI   EDITLEN(BUFAD),X'04'                             01S1855
*                MSGN = IEBA24I;       /* NON-EXISTENT SEGMENT.      */
         MVI   MSGN(BUFAD),X'18'                                01S1856
*                CALL IEBIMSGS;        /* PRINT IT.                  */
         L     @15,@CV00037                                     01S1857
         BALR  @14,@15                                          01S1857
*                INHIBITW = ON;        /* PREVENT LIBRARY UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      01S1858
*                SCNT = SCNT - ONE;    /* DECREMENT SCAN COUNTER.    */
         SLR   @03,@03                                          01S1859
         ICM   @03,3,SCNT(BUFAD)                                01S1859
         BCTR  @03,0                                            01S1859
         STH   @03,SCNT(,BUFAD)                                 01S1859
*              END;                    /*                            */
*            ELSE;                     /*                            */
@RF01849 DS    0H                                               01S1862
*        END;                          /* END OF DELETE TEST.        */
         AH    CNT,@CH00060                                     01S1862
         CH    CNT,@CH00252                                     01S1862
         BNH   @DL01848                                         01S1862
@DC01848 DS    0H                                               01S1863
*        GEN REFS(SAVE2)               /*****************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*  END DELCHK;                         /* RETURN TO CALLER.          */
@EL00025 DS    0H                                               01S1864
@EF00025 DS    0H                                               01S1864
@ER00025 LM    @14,@12,12(@13)                                  01S1864
         BR    @14                                              01S1864
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL TEST A GRAPHIC CHARACTER MODIFICATION MODULE    *
**  FOR VALIDITY AND INDICATE WHICH SEGMENTS ARE INVLAID.             *
**                                                                    *
**********************************************************************/
*GRFCHK:                                                        01S1865
*   PROCEDURE OPTIONS(NOSAVEAREA);                              01S1865
GRFCHK   STM   @14,@12,12(@13)                                  01S1865
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        RESPECIFY (BUFFPTR,SHIFT) RESTRICTED;                  01S1867
*        IF READMOD = ON               /* CHECK FOR READ/PRINT ONLY  */
*         & LOADFLAG = ALBIT           /* AND MODULE LOADED.         */
*          THEN                        /*                            */
         TM    READMOD(BUFAD),B'00000001'                       01S1868
         BNO   @RF01868                                         01S1868
         CLI   LOADFLAG(BUFAD),X'FF'                            01S1868
         BNE   @RF01868                                         01S1868
*            DO;                       /*                            */
*              SEGCNT = LMODCNT;       /* GET MODULE COUNT.          */
         SLR   @07,@07                                          01S1870
         ICM   @07,7,LOADMOD(BUFAD)                             01S1870
         MVC   SEGCNT(2,BUFAD),LMODCNT(@07)                     01S1870
*              BUFFPTR = ADDR(LMODBOD);/* SET ADDRESSING TO STOR ADDR*/
         LA    BUFFPTR,LMODBOD(,@07)                            01S1871
*            END;                      /*                            */
*          ELSE                        /* MODULE IS IN BUFFER.       */
*            DO;                       /*                            */
         B     @RC01868                                         01S1873
@RF01868 DS    0H                                               01S1874
*              SEGCNT=MODCNT;          /* GET MODULE COUNT.          */
         MVC   SEGCNT(2,BUFAD),MODCNT(BUFAD)                    01S1874
*              BUFFPTR = ADDR(MODBOD); /* SET ADDRESSING TO BUFFER.  */
         LA    BUFFPTR,MODBOD(,BUFAD)                           01S1875
*            END;                      /*                            */
*        SEGCNT=SEGCNT/LENGTH(GRAFSEG);/* REDUCE TO 73 BYTE SEGS.    */
@RC01868 LH    @02,SEGCNT(,BUFAD)                               01S1877
         SRDA  @02,32                                           01S1877
         D     @02,@CF00610                                     01S1877
         STH   @03,SEGCNT(,BUFAD)                               01S1877
*        ASGNSAVE = ASGNSAVE&&ASGNSAVE;/* CLEAR DUPLICATION AREA.    */
         XC    ASGNSAVE+796(256,BUFAD),ASGNSAVE+796(BUFAD)      01S1878
*        DO                            /* START MODULE SCAN.         */
*         CNT=ONE                      /* SCAN ALL SEGMENTS          */
*         TO BIGNUM                    /* COULD BE PRINT SPEC.       */
*         WHILE SEGCNT^=ZERO;          /*                            */
         LA    CNT,1                                            01S1879
@DL01879 SLR   @07,@07                                          01S1879
         CH    @07,SEGCNT(,BUFAD)                               01S1879
         BE    @DC01879                                         01S1879
*          PRTYERR = OFF;              /*                            */
*          FMTERR = OFF;               /* RESET ERROR INDICATORS.    */
*          FMTERR1 = OFF;              /*                            */
         NI    PRTYERR(BUFAD),B'11110001'                       01S1882
*          TESTP = ZERO;               /* RESET PITCH & PARITY WORK. */
         STH   @07,TESTP(,BUFAD)                                01S1883
*          IF PIT1(ONE) = ON           /*                            */
*            THEN                      /*                            */
         LR    @07,CNT                                          01S1884
         MH    @07,@CH00610                                     01S1884
         AL    @07,@CF01891                                     01S1884
         LA    @07,GRAFBOD(@07,BUFFPTR)                         01S1884
         TM    PIT1(@07),B'00100000'                            01S1884
         BNO   @RF01884                                         01S1884
*              TP1 = ON;               /* SET PITCH BIT ONE          */
         OI    TP1(BUFAD),B'10000000'                           01S1885
*          IF PIT2(ONE) = ON           /*                            */
*            THEN                      /*                            */
@RF01884 LR    @07,CNT                                          01S1886
         MH    @07,@CH00610                                     01S1886
         AL    @07,@CF01891                                     01S1886
         LA    @07,GRAFBOD(@07,BUFFPTR)                         01S1886
         TM    PIT2(@07),B'00010000'                            01S1886
         BNO   @RF01886                                         01S1886
*              TP2 = ON;               /* SET PITCH BIT TWO          */
         OI    TP2(BUFAD),B'01000000'                           01S1887
*          DO                          /*                            */
*           YCNT = ONE                 /* START SEGMENT SCAN.        */
*           TO DIM(RASTER);            /*                            */
@RF01886 LA    YCNT,1                                           01S1888
@DL01888 DS    0H                                               01S1889
*            IF (TP1=ON & PIT1(YCNT)=OFF)/*                          */
*             × (TP1=OFF & PIT1(YCNT)=ON)/*  CHECK FOR CONSISTENT    */
*             × (TP2=ON & PIT2(YCNT)=OFF)/*  PITCH WITHIN SEGMENT.   */
*             × (TP2=OFF & PIT2(YCNT)=ON)/*                          */
*              THEN                    /*                            */
         TM    TP1(BUFAD),B'10000000'                           01S1889
         BNO   @GL00053                                         01S1889
         LR    @07,YCNT                                         01S1889
         MH    @07,@CH00111                                     01S1889
         LR    @03,CNT                                          01S1889
         MH    @03,@CH00610                                     01S1889
         AL    @03,@CF01891                                     01S1889
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1889
         ALR   @03,@07                                          01S1889
         TM    PIT1-3(@03),B'00100000'                          01S1889
         BZ    @RT01889                                         01S1889
@GL00053 TM    TP1(BUFAD),B'10000000'                           01S1889
         BNZ   @GL00052                                         01S1889
         LR    @07,YCNT                                         01S1889
         MH    @07,@CH00111                                     01S1889
         LR    @03,CNT                                          01S1889
         MH    @03,@CH00610                                     01S1889
         AL    @03,@CF01891                                     01S1889
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1889
         ALR   @03,@07                                          01S1889
         TM    PIT1-3(@03),B'00100000'                          01S1889
         BO    @RT01889                                         01S1889
@GL00052 TM    TP2(BUFAD),B'01000000'                           01S1889
         BNO   @GL00051                                         01S1889
         LR    @07,YCNT                                         01S1889
         MH    @07,@CH00111                                     01S1889
         LR    @03,CNT                                          01S1889
         MH    @03,@CH00610                                     01S1889
         AL    @03,@CF01891                                     01S1889
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1889
         ALR   @03,@07                                          01S1889
         TM    PIT2-3(@03),B'00010000'                          01S1889
         BZ    @RT01889                                         01S1889
@GL00051 TM    TP2(BUFAD),B'01000000'                           01S1889
         BNZ   @RF01889                                         01S1889
         LR    @07,YCNT                                         01S1889
         MH    @07,@CH00111                                     01S1889
         LR    @03,CNT                                          01S1889
         MH    @03,@CH00610                                     01S1889
         AL    @03,@CF01891                                     01S1889
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1889
         ALR   @03,@07                                          01S1889
         TM    PIT2-3(@03),B'00010000'                          01S1889
         BNO   @RF01889                                         01S1889
@RT01889 DS    0H                                               01S1890
*                FMTERR = ON;          /* INCONSISTENT PITCH.        */
         OI    FMTERR(BUFAD),B'00001000'                        01S1890
*              ELSE                    /*                            */
*                DO;                   /* INVERT PITCH FOR PARITY.   */
         B     @RC01889                                         01S1891
@RF01889 DS    0H                                               01S1892
*                  TPARTY = TPITCH && FLIPPER;                  01S1892
         MVC   TPARTY(1,BUFAD),TPITCH(BUFAD)                    01S1892
         XI    TPARTY(BUFAD),X'C0'                              01S1892
*                  SHIFT = RASTER(YCNT);/* SET RASTER IN REGISTER.   */
         LR    @07,YCNT                                         01S1893
         MH    @07,@CH00111                                     01S1893
         LR    @03,CNT                                          01S1893
         MH    @03,@CH00610                                     01S1893
         AL    @03,@CF01891                                     01S1893
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1893
         AL    @03,@CF01892                                     01S1893
         L     SHIFT,RASTER-1(@07,@03)                          01S1893
         LA    SHIFT,0(,SHIFT)                                  01S1893
*                  SRL(SHIFT,SIX);     /* ALIGN FOR RASTER           */
         SRL   SHIFT,6                                          01S1894
*                  SLL(SHIFT,FORTN);   /* BITS ONLY                  */
         SLL   SHIFT,14                                         01S1895
*                  DO                  /* START RASTER SCAN.         */
*                   XCNT = ONE         /*                            */
*                   TO DIM(GRAFBIT)    /* SCAN AS LONG AS THERE      */
*                   WHILE SHIFT^=ZERO; /* ARE BITS                   */
         LA    XCNT,1                                           01S1896
@DL01896 SLR   @07,@07                                          01S1896
         CR    SHIFT,@07                                        01S1896
         BE    @DC01896                                         01S1896
*                    IF SHIFT < ZERO   /* CHECK FOR HI ORDER BIT     */
*                      THEN            /*                            */
         CR    SHIFT,@07                                        01S1897
         BNL   @RF01897                                         01S1897
*                        DO;           /*                            */
*                          IF XCNT=<DIM(GRAFBIT)/TWO            01S1899
*                            THEN      /* FLIP PARITY 1ST HALF.      */
         CH    XCNT,@CH00032                                    01S1899
         BH    @RF01899                                         01S1899
*                              TPARTY = TPARTY && FLIP1;        01S1900
         XI    TPARTY(BUFAD),X'80'                              01S1900
*                             ELSE     /* FLIP PARITY 2ND HALF.      */
*                               TPARTY = TPARTY && FLIP2;       01S1901
         B     @RC01899                                         01S1901
@RF01899 XI    TPARTY(BUFAD),X'40'                              01S1901
*                          IF (XCNT < FOUR & TP1 = ON)          01S1902
*                           × (XCNT > FIFTN & TP2 = ON)         01S1902
*                              THEN    /* BIT OUT OF PITCH RANGE.    */
@RC01899 CH    XCNT,@CH00050                                    01S1902
         BNL   @GL00058                                         01S1902
         TM    TP1(BUFAD),B'10000000'                           01S1902
         BO    @RT01902                                         01S1902
@GL00058 CH    XCNT,@CH00155                                    01S1902
         BNH   @RF01902                                         01S1902
         TM    TP2(BUFAD),B'01000000'                           01S1902
         BNO   @RF01902                                         01S1902
@RT01902 DS    0H                                               01S1903
*                                FMTERR1 = ON;/* SO REMEMBER IT.     */
         OI    FMTERR1(BUFAD),B'00000100'                       01S1903
*                              ELSE;                            01S1904
@RF01902 DS    0H                                               01S1905
*                        END;          /*                            */
*                      ELSE;           /*                            */
@RF01897 DS    0H                                               01S1907
*                    SLL(SHIFT,ONE);   /* GET NEXT BIT.              */
         SLL   SHIFT,1                                          01S1907
*                  END;                /* END RASTER SCAN            */
         AH    XCNT,@CH00060                                    01S1908
         CH    XCNT,@CH00183                                    01S1908
         BNH   @DL01896                                         01S1908
@DC01896 DS    0H                                               01S1909
*                  IF (PR1 = ON & PARITY1(YCNT) = OFF)          01S1909
*                   × (PR1 = OFF& PARITY1(YCNT) = ON)           01S1909
*                   × (PR2 = ON & PARITY2(YCNT) = OFF)          01S1909
*                   × (PR2 = OFF& PARITY2(YCNT) = ON)           01S1909
*                    THEN              /* CHECK FOR INVALID PARITY.  */
         TM    PR1(BUFAD),B'10000000'                           01S1909
         BNO   @GL00063                                         01S1909
         LR    @07,YCNT                                         01S1909
         MH    @07,@CH00111                                     01S1909
         LR    @03,CNT                                          01S1909
         MH    @03,@CH00610                                     01S1909
         AL    @03,@CF01891                                     01S1909
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1909
         ALR   @03,@07                                          01S1909
         TM    PARITY1-3(@03),B'00001000'                       01S1909
         BZ    @RT01909                                         01S1909
@GL00063 TM    PR1(BUFAD),B'10000000'                           01S1909
         BNZ   @GL00062                                         01S1909
         LR    @07,YCNT                                         01S1909
         MH    @07,@CH00111                                     01S1909
         LR    @03,CNT                                          01S1909
         MH    @03,@CH00610                                     01S1909
         AL    @03,@CF01891                                     01S1909
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1909
         ALR   @03,@07                                          01S1909
         TM    PARITY1-3(@03),B'00001000'                       01S1909
         BO    @RT01909                                         01S1909
@GL00062 TM    PR2(BUFAD),B'01000000'                           01S1909
         BNO   @GL00061                                         01S1909
         LR    @07,YCNT                                         01S1909
         MH    @07,@CH00111                                     01S1909
         LR    @03,CNT                                          01S1909
         MH    @03,@CH00610                                     01S1909
         AL    @03,@CF01891                                     01S1909
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1909
         ALR   @03,@07                                          01S1909
         TM    PARITY2-3(@03),B'00000100'                       01S1909
         BZ    @RT01909                                         01S1909
@GL00061 TM    PR2(BUFAD),B'01000000'                           01S1909
         BNZ   @RF01909                                         01S1909
         LR    @07,YCNT                                         01S1909
         MH    @07,@CH00111                                     01S1909
         LR    @03,CNT                                          01S1909
         MH    @03,@CH00610                                     01S1909
         AL    @03,@CF01891                                     01S1909
         LA    @03,GRAFBOD(@03,BUFFPTR)                         01S1909
         ALR   @03,@07                                          01S1909
         TM    PARITY2-3(@03),B'00000100'                       01S1909
         BNO   @RF01909                                         01S1909
@RT01909 DS    0H                                               01S1910
*                      PRTYERR = ON;   /* REMEMBER ERROR.            */
         OI    PRTYERR(BUFAD),B'00000010'                       01S1910
*                    ELSE;             /* NO ERROR THIS TIME.        */
@RF01909 DS    0H                                               01S1912
*                END;                  /*                            */
*            END;                      /* END SEGMENT SCAN.          */
@RC01889 AH    YCNT,@CH00060                                    01S1913
         CH    YCNT,@CH00053                                    01S1913
         BNH   @DL01888                                         01S1913
*/*********************************************************************
**                                                                    *
**  THIS SECTION WILL CAUSE THE NECESSARY MESSAGE(S) TO BE PRINTED    *
**   REGARDING INVALIDITY OF THE GRAPHIC CHARACTER MODULE.            *
**                                                                    *
**********************************************************************/
*       MSGN=ZERO;                     /* RESET FOR SUBSEQUENT TEST. */
         MVI   MSGN(BUFAD),X'00'                                02S1914
*       CVD(CNT,DWORK);                /* CONVERT                    */
         CVD   CNT,DWORK(,BUFAD)                                02S1915
*       UNPK(CWORK,PWORK);             /*  SEGMENT NUMBER            */
         UNPK  CWORK(4,BUFAD),PWORK(2,BUFAD)                    02S1916
*       CWORK(LENGTH(CWORK))=          /*  TO PRINTABLE              */
*        CWORK(LENGTH(CWORK))×MASK;    /*  AND                       */
         OI    CWORK+3(BUFAD),C'0'                              02S1917
*       EDITDATA(ONE)=ADDR(CWORK);     /*  SET FOR                   */
         LA    @07,CWORK(,BUFAD)                                02S1918
         STCM  @07,7,EDITDATA(BUFAD)                            02S1918
*       EDITLEN(ONE)=LENGTH(CWORK);    /*  MESSAGE EDITING.          */
         MVI   EDITLEN(BUFAD),X'04'                             02S1919
*       IF FMTERR = ON                 /* CHECK FOR PITCH ERROR.     */
*         THEN                         /*                            */
         TM    FMTERR(BUFAD),B'00001000'                        02S1920
         BNO   @RF01920                                         02S1920
*           DO;                        /*                            */
*             MSGN = IEBA40I;          /* PRINT PITCH ERROR          */
         MVI   MSGN(BUFAD),X'28'                                02S1922
*             CALL IEBIMSGS;           /* THIS SEGMENT.              */
         L     @15,@CV00037                                     02S1923
         BALR  @14,@15                                          02S1923
*           END;                       /*                            */
*         ELSE                         /* NO PITCH ERROR.            */
*           DO;                        /*                            */
         B     @RC01920                                         02S1925
@RF01920 DS    0H                                               02S1926
*             IF FMTERR1 = ON          /* CHECK FOR RANGE ERROR.     */
*               THEN                   /*                            */
         TM    FMTERR1(BUFAD),B'00000100'                       02S1926
         BNO   @RF01926                                         02S1926
*                 DO;                  /*                            */
*                   MSGN = IEBA30I;    /*                            */
         MVI   MSGN(BUFAD),X'1E'                                02S1928
*                   CALL IEBIMSGS;     /* PRINT RANGE ERROR.         */
         L     @15,@CV00037                                     02S1929
         BALR  @14,@15                                          02S1929
*                 END;                 /*                            */
*               ELSE;                  /* CHECK FOR PARITY ERROR.    */
@RF01926 DS    0H                                               02S1932
*         IF PRTYERR = ON              /* CHECK FOR PARITY ERROR.    */
*           THEN                       /*                            */
         TM    PRTYERR(BUFAD),B'00000010'                       02S1932
         BNO   @RF01932                                         02S1932
*             DO;                      /* RESTORE MSG EDIT INDICATOR.*/
*               EDITLEN(ONE)=LENGTH(CWORK);                     02S1934
         MVI   EDITLEN(BUFAD),X'04'                             02S1934
*               MSGN = IEBA39I;        /* PRINT PARITY ERROR         */
         MVI   MSGN(BUFAD),X'27'                                02S1935
*               CALL IEBIMSGS;         /* THIS SEGMENT.              */
         L     @15,@CV00037                                     02S1936
         BALR  @14,@15                                          02S1936
*             END;                     /*                            */
*           ELSE;                      /*                            */
@RF01932 DS    0H                                               02S1939
*        END;                          /*                            */
*        IF MSGN ^= ZERO               /* CHECK FOR ANY MSG PRINTED. */
*         THEN                         /*                            */
@RC01920 CLI   MSGN(BUFAD),0                                    02S1940
         BE    @RF01940                                         02S1940
*           DO;                        /*                            */
*             RETSAVE =                /* SET RETURN CODE 8 THIS     */
*               MAX(RETSAVE,RC8);      /* OPERATION.                 */
         SLR   @07,@07                                          02S1942
         IC    @07,RETSAVE(,BUFAD)                              02S1942
         LA    @05,8                                            02S1942
         CR    @07,@05                                          02S1942
         BNL   *+6
         LR    @07,@05                                          02S1942
         STC   @07,RETSAVE(,BUFAD)                              02S1942
*             INHIBITW = ON;           /* INHIBIT LIBRARY UPDATE.    */
         OI    INHIBITW(BUFAD),B'01000000'                      02S1943
*           END;                       /*                            */
*         ELSE;                        /*                            */
@RF01940 DS    0H                                               02S1946
*        IF BSUFIX(ONE) ^= BLANK       /* CHECK FOR SPECIAL GRAFMOD. */
*          THEN                        /* NOT THIS TIME.             */
         CLI   BSUFIX(BUFAD),C' '                               02S1946
         BE    @RF01946                                         02S1946
*            IF DEL(GASNMT+ONE)=ZERO   /* CHECK FOR PREVIOUS ASSIGN. */
*              THEN                    /*                            */
         LR    @07,CNT                                          02S1947
         MH    @07,@CH00610                                     02S1947
         AL    @07,@CF01891                                     02S1947
         LA    @07,GRAFBOD(@07,BUFFPTR)                         02S1947
         SLR   @05,@05                                          02S1947
         IC    @05,GASNMT(,@07)                                 02S1947
         LA    @03,796                                          02S1947
         ALR   @03,BUFAD                                        02S1947
         SLR   @00,@00                                          02S1947
         IC    @00,DEL(@05,@03)                                 02S1947
         CH    @00,@CH00462                                     02S1947
         BNE   @RF01947                                         02S1947
*               DEL(GASNMT+ONE)=GASNMT;/* NO, ASSIGN.                */
         ALR   @03,@05                                          02S1948
         MVC   DEL(1,@03),GASNMT(@07)                           02S1948
*              ELSE                    /*                            */
*                DO;                   /* YES, RESTORE MSG EDIT IND. */
         B     @RC01947                                         02S1949
@RF01947 DS    0H                                               02S1950
*                  EDITLEN(ONE)=LENGTH(CWORK);                  02S1950
         MVI   EDITLEN(BUFAD),X'04'                             02S1950
*                  MSGN = IEBA41I;     /* PRINT PREVIOUS ASSIGNMENT  */
         MVI   MSGN(BUFAD),X'29'                                02S1951
*                  CALL IEBIMSGS;      /* USED.                      */
         L     @15,@CV00037                                     02S1952
         BALR  @14,@15                                          02S1952
*                  RETSAVE =           /* SET RETURN CODE 4 THIS     */
*                  MAX(RETSAVE,RC4);   /* OPERATION.                 */
         SLR   @07,@07                                          02S1953
         IC    @07,RETSAVE(,BUFAD)                              02S1953
         LA    @05,4                                            02S1953
         CR    @07,@05                                          02S1953
         BNL   *+6
         LR    @07,@05                                          02S1953
         STC   @07,RETSAVE(,BUFAD)                              02S1953
*                END;                  /*                            */
*          ELSE;                       /* SPECIAL GRAFMOD.           */
@RF01946 DS    0H                                               02S1956
*        EDITLEN(ONE) = ZERO;          /* INSURE NO MSG EDIT LENGTH. */
@RC01946 MVI   EDITLEN(BUFAD),X'00'                             02S1956
*            SEGCNT = SEGCNT - ONE;    /* REDUCE SEGMENT COUNT.      */
         LH    @07,SEGCNT(,BUFAD)                               01S1957
         BCTR  @07,0                                            01S1957
         STH   @07,SEGCNT(,BUFAD)                               01S1957
*        END;                          /* END MODULE SCAN.           */
         AH    CNT,@CH00060                                     01S1958
         CH    CNT,@CH00762                                     01S1958
         BNH   @DL01879                                         01S1958
@DC01879 DS    0H                                               01S1959
*        RESPECIFY (BUFFPTR,SHIFT) UNRESTRICTED;                01S1959
*        GEN REFS(SAVE2)               /******************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*   END GRFCHK;                                                 01S1961
@EL00026 DS    0H                                               01S1961
@EF00026 DS    0H                                               01S1961
@ER00026 LM    @14,@12,12(@13)                                  01S1961
         BR    @14                                              01S1961
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE IS THE OPEN EXIT ROUTINE FOR THE WRITE DCB FOR THE   *
**  SYSUT1 DATA SET. THE DCB BLOCK SIZE WILL BE OBTAINED FOR          *
**  SUBSEQUENT USE AS A BLOCKING FACTOR.                              *
**                                                                    *
**********************************************************************/
*BKSZFIX:                                                       01S1962
*  PROCEDURE OPTIONS(SAVE(R14));                                01S1962
BKSZFIX  ST    @14,@SA00027                                     01S1962
*        RESPECIFY (R1) RESTRICTED;    /*                            */
*        DCBPTR = R1;                  /* GET DCB POINTER            */
         LR    DCBPTR,R1                                        01S1964
*        RESPECIFY (R1) UNRESTRICTED;  /*                            */
*        IF DCBBLKSI = ZERO            /* CHECK FOR ZERO BLOCK SIZE  */
*          THEN                        /*                            */
         ICM   @05,3,DCBBLKSI+52(DCBPTR)                        01S1966
         BNZ   @RF01966                                         01S1966
*            DO;                       /* ISSUE DEVTYPE MACRO        */
*              GEN REFS(LIBOUTDD)      /*  TO OBTAIN MAXIMUM TRACK   */
*                  SETS(DWORK)         /*  SIZE TO USE AS            */
*               (DEVTYPE  LIBOUTDD,DWORK);                      01S1968
         DEVTYPE  LIBOUTDD,DWORK
*              LIBBLKSZ = PWORK;       /*  BLOCKING FACTOR.          */
         MVC   LIBBLKSZ(2,BUFAD),PWORK(BUFAD)                   01S1969
*            END;                      /*                            */
*          ELSE                        /* USE DCB BLOCK SIZE         */
*            LIBBLKSZ = DCBBLKSI;      /* AS BLOCKING FACTOR.        */
         B     @RC01966                                         01S1971
@RF01966 MVC   LIBBLKSZ(2,BUFAD),DCBBLKSI+52(DCBPTR)            01S1971
*  END BKSZFIX;                        /*                            */
@EL00027 DS    0H                                               01S1972
@EF00027 DS    0H                                               01S1972
@ER00027 L     @14,@SA00027                                     01S1972
         BR    @14                                              01S1972
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL BLOCK THE MODULE AS REQUIRED FOR THE LIBRARY.   *
**  A TWENTY-BYTE CONTROL RECORD PRECEDES EACH BLOCK OF TEXT.         *
**                                                                    *
**********************************************************************/
*WRBLOCK:                                                       01S1973
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S1973
WRBLOCK  STM   @14,@03,12(@13)                                  01S1973
         STM   @05,@12,40(@13)                                  01S1973
*        GEN SETS(SAVE3);              /* USE CONVENTIONAL SAVE.     */
         ST   @13,SAVE3+BACK(,BUFAD)   BACKWARD POINTER.
         LA   @14,SAVE3(,BUFAD)        THIS ROUTINE SAVE AREA.
         ST   @14,FORE(,@13)           FORWARD POINTER.
         LR   @13,@14                  LINKAGE COMPLETE.
*        RESPECIFY (BUFFPTR,DB,REMSIZE) RESTRICTED;             01S1975
*        BUFFPTR = ADDR(MSGSAVE);      /* ACCESS CONTROL RECORD AREA */
         LR    BUFFPTR,BUFAD                                    01S1976
         AL    BUFFPTR,@CF01856                                 01S1976
*        EOMID = NCESD;                /* INITIALIZE                 */
         MVI   EOMID(BUFFPTR),X'01'                             01S1977
*        EOMSP = ZERO;                 /*  CONTROL                   */
         SLR   @05,@05                                          01S1978
         STCM  @05,7,EOMSP(BUFFPTR)                             01S1978
*        EOMCNT = FOUR;                /*  RECORD FOR                */
         MVC   EOMCNT(2,BUFFPTR),@CH00050                       01S1979
*        EOMCNTZ = ZERO;               /*  SUBSEQUENT                */
         STH   @05,EOMCNTZ(,BUFFPTR)                            01S1980
*        EOMCCW = RDCCW;               /*  UPDATE                    */
         XC    EOMCCW+6(2,BUFFPTR),EOMCCW+6(BUFFPTR)            01S1981
         MVC   EOMCCW(6,BUFFPTR),@CB00714                       01S1981
*        EOMENT = ONE;                 /*  AND WRITING TO LIBRARY    */
         MVC   EOMENT(2,BUFFPTR),@CH00060                       01S1982
*        REMSIZE = DSTOR;              /* TOTAL MODULE SIZE          */
         SLR   @15,@15                                          01S1983
         ICM   @15,7,DSTOR(BUFAD)                               01S1983
         LR    REMSIZE,@15                                      01S1983
*        DLEN = MIN(DSTOR,LIBBLKSZ);   /* SET SIZE OF FIRST TEXT REC */
         SLR   @02,@02                                          01S1984
         ICM   @02,3,LIBBLKSZ(BUFAD)                            01S1984
         CR    @15,@02                                          01S1984
         BNH   *+6
         LR    @15,@02                                          01S1984
         STH   @15,DLEN(,BUFAD)                                 01S1984
*        EOMCCWCT = DLEN;              /* INITIALIZE CCW.            */
         STH   @15,EOMCCWCT(,BUFFPTR)                           01S1985
*        NOTED = OFF;                  /* RESET NOTE SWITCH.         */
         NI    NOTED(BUFAD),B'11111101'                         01S1986
*        DO                            /* START                      */
*         CNT = ZERO                   /*  BLOCKING OPERATION        */
*         BY LIBBLKSZ                  /*                            */
*         WHILE INHIBITW = OFF         /* DO ALL BUT LAST OR ONLY    */
*             & REMSIZE > LIBBLKSZ;    /*  BLOCK.                    */
         LR    CNT,@05                                          01S1987
         B     @DE01987                                         01S1987
@DL01987 DS    0H                                               01S1988
*          UNIREC = OFF;               /* RESET ONE TEXT RECORD SW.  */
         NI    UNIREC(BUFAD),B'11111110'                        01S1988
*          EOMTLN = LIBBLKSZ;          /* SET TEXT LENGTH            */
         MVC   EOMTLN(2,BUFFPTR),LIBBLKSZ(BUFAD)                01S1989
*          EOMCCWAD = CNT;             /*  ADD RELATIVE ADDRESS      */
         STCM  CNT,7,EOMCCWAD(BUFFPTR)                          01S1990
*          DB = BUFFPTR;               /* ADDR OF CONTROL RECORD.    */
         LR    DB,BUFFPTR                                       01S1991
*          DCBPTR = UTOUTAD;           /* DCB ADDRESS.               */
         L     DCBPTR,UTOUTAD(,BUFAD)                           01S1992
*          DCBBLKSI = LENGTH(EOM);     /* LENGTH OF CONTROL RECORD.  */
         MVC   DCBBLKSI+52(2,DCBPTR),@CH00356                   01S1993
*          CALL WRITE;                 /* WRITE A CONTROL RECORD.    */
         BAL   @14,WRITE                                        01S1994
*          CALL WRTEXT;                /* WRITE A TEXT RECORD.       */
         BAL   @14,WRTEXT                                       01S1995
*          REMSIZE = REMSIZE - LIBBLKSZ;/* UPDATE REMAINING SIZE.    */
         SLR   @05,@05                                          01S1996
         ICM   @05,3,LIBBLKSZ(BUFAD)                            01S1996
         SLR   REMSIZE,@05                                      01S1996
*        END;                          /* END OF BLOCKING.           */
         SLR   @05,@05                                          01S1997
         ICM   @05,3,LIBBLKSZ(BUFAD)                            01S1997
         ALR   CNT,@05                                          01S1997
@DE01987 TM    INHIBITW(BUFAD),B'01000000'                      01S1997
         BNZ   @DC01987                                         01S1997
         SLR   @05,@05                                          01S1997
         ICM   @05,3,LIBBLKSZ(BUFAD)                            01S1997
         CR    REMSIZE,@05                                      01S1997
         BH    @DL01987                                         01S1997
@DC01987 DS    0H                                               01S1998
*        IF INHIBITW = OFF             /* CHECK FOR SUCCESS THUS FAR.*/
*          THEN                        /* WRITE LAST OR ONLY BLOCK.  */
         TM    INHIBITW(BUFAD),B'01000000'                      01S1998
         BNZ   @RF01998                                         01S1998
*            DO;                       /*                            */
*              EOMTLN = REMSIZE;       /* LENGTH OF                  */
         STH   REMSIZE,EOMTLN(,BUFFPTR)                         01S2000
*              EOMCCWCT = REMSIZE;     /*  LAST BLOCK.               */
         STH   REMSIZE,EOMCCWCT(,BUFFPTR)                       01S2001
*              EOMCCWAD = CNT;         /* RELATIVE ADDRESS.          */
         STCM  CNT,7,EOMCCWAD(BUFFPTR)                          01S2002
*              EOMID = LCESD;          /* INDICATE LAST CONTROL REC. */
         MVI   EOMID(BUFFPTR),X'0D'                             01S2003
*              DB = BUFFPTR;           /* ADDR OF CONTROL RECORD.    */
         LR    DB,BUFFPTR                                       01S2004
*              DCBPTR = UTOUTAD;       /* DCB ADDRESS.               */
         L     DCBPTR,UTOUTAD(,BUFAD)                           01S2005
*              DCBBLKSI = LENGTH(EOM); /* CONTROL RECORD LENGTH.     */
         MVC   DCBBLKSI+52(2,DCBPTR),@CH00356                   01S2006
*              CALL WRITE;             /* WRITE CONTROL RECORD.      */
         BAL   @14,WRITE                                        01S2007
*              CALL WRTEXT;            /* WRITE TEXT RECORD          */
         BAL   @14,WRTEXT                                       01S2008
*            END;                      /*                            */
*          ELSE;                       /*                            */
@RF01998 DS    0H                                               01S2011
*        RESPECIFY (BUFFPTR,DB,REMSIZE) UNRESTRICTED;           01S2011
*        GEN REFS(SAVE3)               /******************************/
*         (L  @13,SAVE3+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE3+BACK(,BUFAD)
*  END WRBLOCK;                        /* RETURN TO                  */
@EL00028 DS    0H                                               01S2013
@EF00028 DS    0H                                               01S2013
@ER00028 LM    @14,@03,12(@13)                                  01S2013
         LM    @05,@12,40(@13)                                  01S2013
         BR    @14                                              01S2013
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL CAUSE ONE BLOCK OF TEXT INFORMATION TO BE       *
**  WRITTEN TO THE LIBRARY. THE NOTE LIST WILL BE UPDATED FOR THE     *
**  FIRST TEXT RECORD WRITTEN. DCB BLOCK SIZE MUST BE FILLED IN       *
**  BEFORE ENTERING THIS ROUTINE.                                     *
**                                                                    *
**********************************************************************/
*WRTEXT:                                                        01S2014
*  PROCEDURE OPTIONS(SAVE(R14));                                01S2014
WRTEXT   ST    @14,@SA00029                                     01S2014
*        RESPECIFY (DB,BUFFPTR,REMSIZE) RESTRICTED;             01S2015
*        IF INHIBITW = OFF             /* CHECK FOR PREVIOUS WRITE   */
*          THEN                        /*  A SUCCESS.                */
         TM    INHIBITW(BUFAD),B'01000000'                      01S2016
         BNZ   @RF02016                                         01S2016
*            DO;                       /*                            */
*              DCBPTR = UTOUTAD;       /* DCB ADDRESS.               */
         L     DCBPTR,UTOUTAD(,BUFAD)                           01S2018
*              DCBBLKSI = EOMCCWCT;    /* SET BLOCK SIZE.            */
         MVC   DCBBLKSI+52(2,DCBPTR),EOMCCWCT(BUFFPTR)          01S2019
*              DB = ADDR(LIBBUF)       /* GET AREA TO                */
*                 + EOMCCWAD;          /*  WRITE FROM.               */
         LA    DB,LIBBUF(,BUFAD)                                01S2020
         SLR   @05,@05                                          01S2020
         ICM   @05,7,EOMCCWAD(BUFFPTR)                          01S2020
         ALR   DB,@05                                           01S2020
*              CALL WRITE;             /* WRITE THIS RECORD.         */
         BAL   @14,WRITE                                        01S2021
*              IF NOTED = OFF          /* CHECK FOR FIRST TEXT RECORD*/
*               & INHIBITW = OFF       /*  AND NO PREVIOUS ERROR     */
*                THEN                  /*                            */
         TM    NOTED(BUFAD),B'00000010'                         01S2022
         BNZ   @RF02022                                         01S2022
         TM    INHIBITW(BUFAD),B'01000000'                      01S2022
         BNZ   @RF02022                                         01S2022
*                  DO;                 /*                            */
*                    RESPECIFY (R1) RESTRICTED;                 01S2024
*                    NOTED = ON;       /* REMEMBER FIRST RECORD      */
         OI    NOTED(BUFAD),B'00000010'                         01S2025
*                    GEN REFS(SYSUTOUT)/*  AS BEING NOTED.           */
*                     (NOTE  SYSUTOUT);/* MAKE NOTE OF LAST WRITE    */
         NOTE  SYSUTOUT
*                    DTTRT = R1;       /* SET TTR IN DRCTRY ENTRY    */
         ST    R1,DTTRT(,BUFAD)                                 01S2027
*                  END;                /* END NOTE.                  */
*                ELSE;                 /*                            */
@RF02022 DS    0H                                               01S2030
*            END;                      /* END WRITE TEXT.            */
*          ELSE;                       /*                            */
@RF02016 DS    0H                                               01S2032
*  END WRTEXT;                         /* RETURN TO CALLER.          */
@EL00029 DS    0H                                               01S2032
@EF00029 DS    0H                                               01S2032
@ER00029 L     @14,@SA00029                                     01S2032
         BR    @14                                              01S2032
         EJECT
*/*********************************************************************
**                                                                    *
**  THIS ROUTINE WILL READ INTO THE BUFFER A MODULE. WHEN THE MODULE  *
**  HAS MORE THAN ONE TEXT RECORD A CONTROL RECORD WILL BE READ IN    *
**  TO ENABLE THE READING OF THE NEXT TEXT RECORD. THE CONTROL RECORD *
**  CONTAINS A CCW WHICH DEFINES THE LENGTH OF THE TEXT RECORD AND    *
**  AN ADDRESS WHICH IS RELATIVE TO THE BEGINNING OF THE MODULE.      *
**                                                                    *
**********************************************************************/
*READLIB:                                                       01S2033
*  PROCEDURE OPTIONS(NOSAVEAREA);                               01S2033
READLIB  STM   @14,@12,12(@13)                                  01S2033
*        GEN REFS(SAVE2);              /* USE CONVENTIONAL SAVE.     */
         ST  @13,SAVE2+BACK(,BUFAD)    BACKWARD POINTER.
         LA  @14,SAVE2(,BUFAD)         THIS ROUTINE SAVE AREA.
         ST  @14,FORE(,@13)            FORWARD POINTER.
         LR  @13,@14                   LINKAGE COMPLETE.
*        RESPECIFY (RECAREA,RECSIZE,BUFFPTR) RESTRICTED;        01S2035
*        RECSIZE = BLEN;               /* SIZE OF FIRST TEXT RECORD. */
         SLR   RECSIZE,RECSIZE                                  01S2036
         ICM   RECSIZE,3,BLEN(BUFAD)                            01S2036
*        RECAREA = ADDR(LIBBUF);       /* STARTING BUFFER ADDRESS.   */
         LA    RECAREA,LIBBUF(,BUFAD)                           01S2037
*        GEN REFS(SYSUTIN,BTTRT)       /*                            */
*            SETS(SYSUTIN,LIBBUF)      /* READ IN FIRST TEXT RECORD. */
*            FLOWS(SYNAD);             /*                            */
         POINT  SYSUTIN,BTTRT(BUFAD)   OREINTATION
         READ   RDECB,SF,SYSUTIN,(RECAREA),(RECSIZE)
         CHECK  RDECB                  VERIFY VALIDITY
*        IF INHIBITR = OFF             /* CHECK FOR SUCCESSFUL READ  */
*         & BUNIREC = OFF              /*  AND MORE RECORDS NEEDED.  */
*          THEN                        /* MORE RECORDS FOLLOW.       */
         TM    INHIBITR(BUFAD),B'00100000'                      01S2039
         BNZ   @RF02039                                         01S2039
         TM    BUNIREC(BUFAD),B'00000001'                       01S2039
         BNZ   @RF02039                                         01S2039
*            DO;                       /* ESTABLISH CONTROL          */
*              BUFFPTR = ADDR(MSGSAVE);/*  RECORD AREA.              */
         LR    BUFFPTR,BUFAD                                    01S2041
         AL    BUFFPTR,@CF01856                                 01S2041
*              DO                      /* READ RECORDS TO LAST TEXT  */
*               UNTIL EOMID = LCESD    /*  RECORD OR ERROR.          */
*                   × INHIBITR = ON;   /*                            */
@DL02042 DS    0H                                               01S2043
*                RECSIZE = LENGTH(EOM);/* LENGTH OF CONTROL RECORD.  */
         LA    RECSIZE,20                                       01S2043
*                GEN REFS(SYSUTIN)     /* READ A CONTROL RECORD      */
*                    SETS(EOM);        /*                            */
                 READ  RDECB,SF,,(BUFFPTR),(RECSIZE),MF=E
                 CHECK RDECB           VERIFY VALIDITY
*                IF INHIBITR = OFF     /* CONTINUE IF NO ERROR ON    */
*                  THEN                /*  CONTROL RECORD.           */
         TM    INHIBITR(BUFAD),B'00100000'                      01S2045
         BNZ   @RF02045                                         01S2045
*                    DO;               /*                            */
*                      RECSIZE = EOMCCWCT;/* GET TEXT RECORD SIZE    */
         SLR   RECSIZE,RECSIZE                                  01S2047
         ICM   RECSIZE,3,EOMCCWCT(BUFFPTR)                      01S2047
*                      RECAREA = EOMCCWAD /* INCREMENT AREA ADDRESS  */
*                          + ADDR(LIBBUF);/*  FOR TEXT.              */
         LA    RECAREA,LIBBUF(,BUFAD)                           01S2048
         SLR   @02,@02                                          01S2048
         ICM   @02,7,EOMCCWAD(BUFFPTR)                          01S2048
         ALR   RECAREA,@02                                      01S2048
*                      GEN REFS(SYSUTIN)  /* READ IN A TEXT RECORD.  */
*                          SETS(LIBBUF);  /*                         */
                       READ RDECB,SF,,(RECAREA),(RECSIZE),MF=E
                       CHECK RDECB
*                    END;              /* END TEXT RECORD READ.      */
*                  ELSE;               /* MUST BE READ ERROR.        */
@RF02045 DS    0H                                               01S2052
*              END;                    /* END OF MODULE OR ERROR.    */
@DE02042 CLI   EOMID(BUFFPTR),X'0D'                             01S2052
         BE    @DC02042                                         01S2052
         TM    INHIBITR(BUFAD),B'00100000'                      01S2052
         BNO   @DL02042                                         01S2052
@DC02042 DS    0H                                               01S2053
*            END;                      /* END MODULE READ IN.        */
*          ELSE;                       /* ONLY ONE RECORD READ.      */
@RF02039 DS    0H                                               01S2055
*        RESPECIFY (RECSIZE,RECAREA,BUFFPTR) UNRESTRICTED;      01S2055
*        GEN REFS(SAVE2)               /******************************/
*         (L  @13,SAVE2+BACK(,BUFAD)); /* RESTORE BACKWARD POINTER.  */
         L  @13,SAVE2+BACK(,BUFAD)
*  END READLIB;                        /* RETURN TO CALLER.          */
@EL00030 DS    0H                                               01S2057
@EF00030 DS    0H                                               01S2057
@ER00030 LM    @14,@12,12(@13)                                  01S2057
         BR    @14                                              01S2057
*END IEBIMAGE                          /* END OF UTILITY.            */
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (IEBIBLKS)                                        *
*/*%INCLUDE SYSLIB  (IHADCBDF)                                        *
*/*%INCLUDE SYSLIB  (IHADCB  )                                        *
*/*%INCLUDE SYSLIB  (IEZDEB  )                                        *
*/*@INCLUDE SYSUT5  (CLEAR   )                                        *
*/*@INCLUDE SYSUT5  (USEPARM )                                        *
*/*@INCLUDE SYSUT5  (OPEN    )                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (SAVECODE)                                        *
*/*@INCLUDE SYSUT5  (FCBBLD  )                                        *
*/*@INCLUDE SYSUT5  (FCBCHECK)                                        *
*/*@INCLUDE SYSUT5  (TABLINIT)                                        *
*/*@INCLUDE SYSUT5  (SETLOC  )                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (SAVECOD2)                                        *
*/*@INCLUDE SYSUT5  (COPYINCL)                                        *
*/*@INCLUDE SYSUT5  (TEXTCOMP)                                        *
*/*@INCLUDE SYSUT5  (SETTEXT )                                        *
*/*@INCLUDE SYSUT5  (GRAFINCL)                                        *
*/*@INCLUDE SYSUT5  (SETREF  )                                        *
*/*@INCLUDE SYSUT5  (GRAFBLD )                                        *
*/*@INCLUDE SYSUT5  (READONLY)                                        *
*/*@INCLUDE SYSUT5  (UT1OPEN )                                        *
*/*@INCLUDE SYSUT5  (WRITELIB)                                        *
*/*@INCLUDE SYSUT5  (FCBMARG )                                        *
*/*@INCLUDE SYSUT5  (FCBSTAT )                                        *
*/*@INCLUDE SYSUT5  (FCBPRINT)                                        *
*/*@INCLUDE SYSUT5  (CSEGPRT )                                        *
*/*@INCLUDE SYSUT5  (TIMECK  )                                        *
*/*@INCLUDE SYSUT5  (OVERRUN )                                        *
*/*@INCLUDE SYSUT5  (GCMPRTHD)                                        *
*/*@INCLUDE SYSUT5  (GCMPRTCH)                                        *
*/*@INCLUDE SYSUT5  (SEGMSG  )                                        *
*;                                                              01S2058
@DATA    DS    0H
@CH00462 DC    H'0'
@CH00060 DC    H'1'
@CH00185 DC    H'6'
@CH00118 DC    H'7'
@CH00032 DC    H'9'
@CH00155 DC    H'15'
@CH00183 DC    H'18'
@CH00356 DC    H'20'
@CH00358 DC    H'21'
@CH00371 DC    H'28'
@CH00375 DC    H'30'
@CH00039 DC    H'40'
@CH00408 DC    H'48'
@CH00746 DC    H'50'
@CH00245 DC    H'64'
@CH01851 DC    H'65'
@CH00175 DC    H'72'
@CH00754 DC    H'110'
@CH00190 DC    H'121'
@CH01051 DC    H'132'
@CH00236 DC    H'144'
@CH00279 DC    H'204'
@CH01855 DC    H'251'
@CH00543 DC    H'255'
@CH00218 DC    H'256'
@CH00757 DC    H'280'
@CH01036 DC    H'300'
@CH01026 DC    H'500'
@CH01040 DC    H'900'
@CH00762 DC    H'999'
@CH00252 DC    H'1024'
@CH01042 DC    H'1475'
@CH00231 DC    H'8192'
@CH01845 DC    H'17909'
@CH00807 DC    XL2'0C'
@CH00851 DC    XL2'FF'
@CH00853 DC    XL2'3F'
@SC01878 CLC   MODBOD-3(0,@15),FCBCLR(BUFAD)
@SM01885 MVC   MODBOD(0,@06),CLOADSEG(@14)
@SM01888 MVC   COPYSEG(0,BUFFPTR),COPYLINE+796(BUFAD)
         DS    0F
@SA00001 DS    18F
@SA00027 DS    1F
@PC00019 DS    3F
@SA00015 DS    1F
@SA00013 DS    1F
@SA00016 DS    1F
@SA00029 DS    1F
@TF00001 DS    F
@TF00002 DS    F
         DS    0F
@CF00057 DC    F'2'
@CH00057 EQU   @CF00057+2
@CF00111 DC    F'3'
@CH00111 EQU   @CF00111+2
@CF00050 DC    F'4'
@CH00050 EQU   @CF00050+2
@CF00040 DC    F'5'
@CH00040 EQU   @CF00040+2
@CF00048 DC    F'8'
@CH00048 EQU   @CF00048+2
@CF00033 DC    F'10'
@CF00035 DC    F'12'
@CH00035 EQU   @CF00035+2
@CF00116 DC    F'16'
@CH00116 EQU   @CF00116+2
@CF00053 DC    F'24'
@CH00053 EQU   @CF00053+2
@CF00610 DC    F'73'
@CH00610 EQU   @CF00610+2
@CF01849 DC    F'8412'
@CF01883 DC    F'10527'
@CF01856 DC    F'10648'
@CF01044 DC    F'100000'
@CF01046 DC    F'213600'
@CF01048 DC    F'344600'
@CF01891 DC    F'-73'
@CF01890 DC    F'-65'
@CF01907 DC    F'-30'
@CF01911 DC    F'-29'
@CF01870 DC    F'-23'
@CF01871 DC    F'-20'
@CF01908 DC    F'-19'
@CF01896 DC    F'-16'
@CF01897 DC    F'-12'
@CF01909 DC    F'-8'
@CF01910 DC    F'-7'
@CF01893 DC    F'-4'
@CF01892 DC    F'-3'
@CF00797 DC    XL4'0F0F0F0F'
@CV00036 DC    V(IEBISCAN)
@CV00037 DC    V(IEBIMSGS)
         DS    0D
HPGN     DS    F
FFLLCON  DS    FL4
         ORG   FFLLCON
@NM00098 DC    AL2(1)
@NM00099 DC    AL2(36)
         ORG   FFLLCON+4
OPTABLEN DC    AL1(168/24-1)
@TS00001 DS    CL2
@CC00862 DC    C'DIRECTORY'
@CC00825 DC    C'BAD NAME'
@CC00837 DC    C'GRAF    '
@CC00860 DC    C'REPLACED'
@CC01083 DC    C'SYSPRINT'
@CC01085 DC    C'SYSIN   '
@CC01087 DC    C'SYSUT1  '
@CC00865 DC    C'NOTE(1)'
@CC00823 DC    C'NONAME'
@CC00843 DC    C'DELSEG'
@CC00811 EQU   @CC00837
@CC00813 DC    C'XTB1'
@CC00815 DC    C'MOD1'
@CC00817 DC    C'FCB3'
@CC00819 DC    C'SEQ='
@CC00821 DC    C' 0X '
@CC00845 DC    C'LINE'
@CC00847 DC    C'TEXT'
@CC00849 DC    C'PAGE'
@CC00839 DC    C'LPI'
@CC00841 DC    C'LOC'
@CC00788 DC    C' 6'
@CC00790 DC    C' 8'
@CC00792 DC    C'12'
@CB00714 DC    X'060000004000'
@CB00896 DC    X'000100010000'
@CB00799 DC    X'0F0F0F'
@CB00801 DC    X'000030'
@CB00803 DC    X'000018'
@CB00805 DC    X'00000C'
@CB00709 DC    X'8001'
@CB00869 DC    X'CBF1'
@CB01899 DC    B'1111111111110000'
@CB01901 DC    B'0010000100110000'
@CB01903 DC    B'1101001101110000'
@CB01905 DC    B'0111000100110000'
         DS    CL1
OPTAB    DS    CL168
         ORG   OPTAB
ELEM     DS    CL24
         ORG   ELEM
OP1      DC    AL1(1)
@NM00024 DC    B'011100000000000010000000'
@NM00025 DC    AL1(3)
@NM00026 DC    AL3(FCB)
@NM00027 DC    AL1(0)
@NM00028 DC    AL3(0)
@NM00029 DC    AL1(0)
@NM00030 DC    AL3(FCBPRT)
FCBOP    DC    CL8'FCB'
         ORG   OPTAB+24
@NM00031 DS    CL24
         ORG   @NM00031
OP2      DC    AL1(2)
@NM00032 DC    B'000000000000011110000000'
@NM00033 DC    AL1(5)
@NM00034 DC    AL3(TABLE)
@NM00035 DC    AL1(0)
@NM00036 DC    AL3(TABCHK)
@NM00037 DC    AL1(0)
@NM00038 DC    AL3(TABLPRT)
TABOP    DC    CL8'TABLE'
         ORG   OPTAB+48
@NM00039 DS    CL24
         ORG   @NM00039
OP3      DC    AL1(3)
@NM00040 DC    B'100011110000000010000000'
@NM00041 DC    AL1(7)
@NM00042 DC    AL3(COPYMOD)
@NM00043 DC    AL1(0)
@NM00044 DC    AL3(COPCHK)
@NM00045 DC    AL1(0)
@NM00046 DC    AL3(COPYPRT)
COPYOP   DC    CL8'COPYMOD'
         ORG   OPTAB+72
@NM00047 DS    CL24
         ORG   @NM00047
OP4      DC    AL1(4)
@NM00048 DC    B'100000000101100011000000'
@NM00049 DC    AL1(7)
@NM00050 DC    AL3(GRAPHIC)
@NM00051 DC    AL1(0)
@NM00052 DC    AL3(GRFCHK)
@NM00053 DC    AL1(0)
@NM00054 DC    AL3(GCMPRT)
GRAFOP   DC    CL8'GRAPHIC'
         ORG   OPTAB+96
@NM00055 DS    CL24
         ORG   @NM00055
OP5      DC    AL1(5)
@NM00056 DC    B'000000001010000000000000'
@NM00057 DC    AL1(7)
@NM00058 DC    AL3(INCLUDE)
@NM00059 DC    A(0)
@NM00060 DC    A(0)
INCLOP   DC    CL8'INCLUDE'
         ORG   OPTAB+120
@NM00061 DS    CL24
         ORG   @NM00061
NAMEOP   DC    AL1(6)
@NM00062 DC    B'000000001000000010100000'
@NM00063 DC    AL1(4)
@NM00064 DC    AL3(NAME)
@NM00065 DC    A(0)
@NM00066 DC    A(0)
NAMOP    DC    CL8'NAME'
         ORG   OPTAB+144
@NM00067 DS    CL24
         ORG   @NM00067
LOST     DC    AL1(255)
@NM00068 DC    AL3(0)
@NM00069 DC    AL1(0)
@NM00070 DC    AL3(INVOP)
@NM00071 DC    A(0)
@NM00072 DC    A(0)
@NM00073 DC    CL8' '
         ORG   OPTAB+168
GRAFHEAD DC    CL30'ASSIGNMENT XX  PITCH 10'
SEGHEAD  DC    CL8' SEGMENT'
BITHEAD  DC    CL18'123456789012345678'
IMAGENAM DC    CL9'5752SC1UM'
VERSION  DC    X'0203'
TRTAB    DC    CL16'0123456789ABCDEF'
HEADING  DS    CL121
         ORG   HEADING
@NM00100 DC    CL1'1'
BLNKS    DC    CL40' '
@NM00101 DC    CL34'SYSTEM SUPPORT UTILITY --IEBIMAGE-'
@NM00102 DC    CL26'-'
@NM00103 DC    CL20'PAGE'
         ORG   HEADING+121
FCBPRL   DS    CL44
         ORG   FCBPRL
@NM00104 DC    CL22'         PRINT LINE XX'
@NM00105 DC    CL22'X AT XX LINES PER INCH'
         ORG   FCBPRL+44
FCBINV   DC    CL23' INVALID BYTE (  ).'
FCBCHL   DC    CL23' - HAS CHANNEL XX CODE.'
PRTXHDG  DS    CL121
         ORG   PRTXHDG
@NM00106 DC    CL1'0'
@NM00107 DC    CL32'         X0     X1     X2     X3'
@NM00108 DC    CL35'     X4     X5     X6     X7     X8'
@NM00109 DC    CL35'     X9     XA     XB     XC     XD'
@NM00110 DC    CL18'     XE     XF'
         ORG   PRTXHDG+121
CGMILINE DS    CL53
         ORG   CGMILINE
@NM00111 DC    CL28'CGM IDENTIFICATION'
@NM00112 DC    CL25'*       *       *       *'
         ORG   CGMILINE+53
CGMOLINE DS    CL53
         ORG   CGMOLINE
@NM00113 DC    CL28'CGM IDENTIFICATION ORDER'
@NM00114 DC    CL25'0       1       2       3'
         ORG   CGMOLINE+53
GCMRLINE DS    CL47
         ORG   GCMRLINE
@NM00115 DC    CL35'GRAPHIC MODIFICATION RECORDS'
@NM00116 DC    CL12'****NONE****'
         ORG   GCMRLINE+47
COPYHD1  DS    CL90
         ORG   COPYHD1
@NM00119 DC    CL7' '
@NM00120 DC    CL34'              INITIAL    NUMBER OF'
@NM00121 DC    CL35'    INITIAL     NUMBER OF   INITIAL'
@NM00122 DC    CL14'     NUMBER OF'
         ORG   COPYHD1+90
COPYHD2  DS    CL91
         ORG   COPYHD2
@NM00123 DC    CL7' '
@NM00124 DC    CL34'    SEGMENT   COPY NO.    COPIES'
@NM00125 DC    CL35'    LINE NO.      LINES    PRINT PO'
@NM00126 DC    CL15'S.   CHARACTERS'
         ORG   COPYHD2+91
         DS    CL3
EXLST1   DS    CL4
         ORG   EXLST1
@NM00139 DC    XL1'85'
@NM00140 DC    AL3(BKSZCK)
         ORG   EXLST1+4
EXLST2   DS    CL8
         ORG   EXLST2
@NM00141 DC    XL1'05'
@NM00142 DC    AL3(BKSZFIX)
EXLST3   DC    XL1'91'
@NM00143 DC    AL3(ABEND)
         ORG   EXLST2+8
PATCH    DC    40CL5'PATCH'
ABNDSAVE DS    16A
IEBIMAGE CSECT
SYSIN    DCB  DDNAME=SYSIN,DSORG=PS,RECFM=FB,LRECL=80,MACRF=GM,       **
               EXLST=EXLST1,BUFNO=2,EROPT=SKP,EODAD=EODAD
SYSPRINT DCB  DDNAME=SYSPRINT,DSORG=PS,RECFM=FBSA,LRECL=121,MACRF=PM, **
               EXLST=EXLST1
SYSUTIN  DCB  DDNAME=SYSUT1,DSORG=PO,RECFM=U,MACRF=R,SYNAD=SYNAD,     XX
               EXLST=EXLST3
SYSUTOUT DCB  DDNAME=SYSUT1,DSORG=PO,RECFM=U,MACRF=W,SYNAD=SYNAD,     XX
               EXLST=EXLST2
IEBIMAGE CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
AWORK    EQU   @02
DCBPTR   EQU   @04
SYNADDR  EQU   @02
FCNT     EQU   @04
COPYSIZE EQU   @03
ZCNT     EQU   @02
HCNT     EQU   @07
LINE     EQU   @04
CCNT     EQU   @02
RGMT     EQU   @02
XCNT     EQU   @03
YCNT     EQU   @05
NCNT     EQU   @02
TOP      EQU   @06
CNT      EQU   @02
BUFAD    EQU   @08
BUFFPTR  EQU   @06
R0       EQU   @00
R1       EQU   @01
PARAM    EQU   @03
REMSIZE  EQU   @03
SHIFT    EQU   @04
SHIFT2   EQU   @05
RECAREA  EQU   @04
RECSIZE  EQU   @05
TRANSIZE EQU   @07
DB       EQU   @07
R14      EQU   @14
RETCODE  EQU   @15
WORKAREA EQU   0
WORK     EQU   WORKAREA
WSTOR    EQU   WORK
DWORK    EQU   WSTOR
DWORK1   EQU   DWORK
DWORKB   EQU   DWORK1+1
DWORK2   EQU   DWORK+4
PWORK    EQU   DWORK2+2
PWORK1   EQU   PWORK
FWORK    EQU   WSTOR+8
STATUS1  EQU   WORK+12
ABNDFLG  EQU   STATUS1
EOFFLG   EQU   STATUS1
CARDIN   EQU   STATUS1
INHIBLIB EQU   STATUS1
CONTINUE EQU   STATUS1
NOWRITE  EQU   STATUS1
NOTED    EQU   STATUS1
STATUS2  EQU   WORK+13
REPUSE   EQU   STATUS2
INHIBIT  EQU   STATUS2
INHIBITW EQU   INHIBIT
INHIBITR EQU   INHIBIT
INHIBITP EQU   STATUS2
FMTERR   EQU   STATUS2
FMTERR1  EQU   STATUS2
PRTYERR  EQU   STATUS2
SETRAS   EQU   PRTYERR
READMOD  EQU   STATUS2
STATUS3  EQU   WORK+14
STATUS4  EQU   WORK+15
SCANINP  EQU   STATUS4
INCLSW   EQU   STATUS4
OPINPRG  EQU   STATUS4
LASTQ    EQU   STATUS4
KWDUSED  EQU   WORK+16
ACTIVOP  EQU   WORK+17
NEXTOP   EQU   WORK+18
OPTABLN  EQU   WORK+20
OPTABAD  EQU   WORK+21
DIRECTRY EQU   WORK+24
DNAME    EQU   DIRECTRY
DSUFIX   EQU   DNAME+4
DTTRP    EQU   DIRECTRY+8
DINDCT   EQU   DIRECTRY+11
DTTRT    EQU   DIRECTRY+12
DATTRI   EQU   DIRECTRY+20
UNIREC   EQU   DATTRI
DSTOR    EQU   DIRECTRY+22
DLEN     EQU   DIRECTRY+25
LIBBLKSZ EQU   WORK+60
BLDLNTRY EQU   WORK+62
BFFLL    EQU   BLDLNTRY
BNAME    EQU   BLDLNTRY+4
BPREFX   EQU   BNAME
BSUFIX   EQU   BNAME+4
BTTRTA   EQU   BLDLNTRY+18
BTTRT    EQU   BTTRTA
BATTRI   EQU   BLDLNTRY+26
BUNIREC  EQU   BATTRI
BSTOR    EQU   BLDLNTRY+28
BLEN     EQU   BLDLNTRY+31
LIBEXT   EQU   WORK+104
NEXT     EQU   WORK+106
RETSAVE  EQU   WORK+108
CC       EQU   WORK+109
CARDEND  EQU   WORK+112
DCBADS   EQU   WORK+116
SYSPRTAD EQU   DCBADS
SYSINAD  EQU   DCBADS+4
UTINAD   EQU   DCBADS+8
UTOUTAD  EQU   DCBADS+12
MSGEDIT  EQU   WORK+132
EDITLEN  EQU   MSGEDIT
EDITDATA EQU   MSGEDIT+1
PAGE     EQU   WORK+150
TODAY    EQU   WORK+153
LOADFLAG EQU   WORK+156
LOADMOD  EQU   WORK+157
LOADNAME EQU   WORK+160
INCLNAME EQU   LOADNAME+4
SEGCNT   EQU   WORK+168
TESTP    EQU   WORK+170
TPITCH   EQU   TESTP
TPP      EQU   TPITCH
TP1      EQU   TPP
TP2      EQU   TPP
TPARTY   EQU   TESTP+1
TPS      EQU   TPARTY
PR1      EQU   TPS
PR2      EQU   TPS
SAVE1    EQU   WORKAREA+172
SAVE2    EQU   WORKAREA+244
SAVE3    EQU   WORKAREA+316
SAVE4    EQU   WORKAREA+388
PRIMCARD EQU   WORKAREA+460
SDRYCARD EQU   WORKAREA+540
RASDATA  EQU   SDRYCARD
IDENT    EQU   SDRYCARD+24
SEQNO    EQU   SDRYCARD+28
MSGN     EQU   WORKAREA+620
MSG      EQU   WORKAREA+621
SPACE    EQU   MSG
MSGTXT   EQU   MSG+1
MSGR     EQU   MSGTXT+4
MSGOF    EQU   MSGR+1
PAGENO   EQU   MSGOF+100
FCBSIZE  EQU   WORKAREA+742
LPICNT   EQU   WORKAREA+744
LPI8     EQU   LPICNT
LPI6     EQU   LPICNT+1
LPI12    EQU   LPICNT+2
MARGN    EQU   LPICNT+3
BOTTOM   EQU   WORKAREA+748
LOOP     EQU   WORKAREA+750
DDNAMES  EQU   WORKAREA+752
PARMSIZE EQU   WORKAREA+792
SCANWORK EQU   WORKAREA+796
SCANARY  EQU   SCANWORK
SCNT     EQU   SCANWORK+1024
CARDDATA EQU   SCANWORK+1026
COPSV    EQU   CARDDATA
LINSV    EQU   CARDDATA+3
LIBBUF   EQU   WORKAREA+2236
MODHEAD  EQU   LIBBUF
MODNAME  EQU   MODHEAD
MODRSVD  EQU   MODHEAD+4
MODCNT   EQU   MODHEAD+6
CMODCNT  EQU   MODCNT
MODBOD   EQU   LIBBUF+8
FCBCLR   EQU   MODBOD+144
MSGSAVE  EQU   WORKAREA+10648
GRAFARY  EQU   0
ASNARRAY EQU   GRAFARY
ASNENTRY EQU   GRAFARY+1
REFARRAY EQU   GRAFARY+2
ASGNSAVE EQU   0
DEL      EQU   0
TEXTDATA EQU   0
COPYLINE EQU   0
COPYLABL EQU   COPYLINE
ICOPY    EQU   COPYLABL
ILINE    EQU   COPYLABL+2
TEXTN    EQU   COPYLABL+5
TEXTD    EQU   COPYLINE+6
PRTQELEM EQU   0
CONTROL  EQU   PRTQELEM
PRTQUEUE EQU   PRTQELEM+1
TBN      EQU   PRTQUEUE+54
TABLDEF  EQU   0
OPFLAGS  EQU   TABLDEF+1
MLTFLAG  EQU   OPFLAGS
BLDPTR   EQU   TABLDEF+5
CHKPTR   EQU   TABLDEF+9
PRTPTR   EQU   TABLDEF+13
BLDMOD   EQU   0
CHKMOD   EQU   0
PRTMOD   EQU   0
QUEUE    EQU   0
QUECTL   EQU   QUEUE
QUEPGW   EQU   QUEUE+101
QUEPGN   EQU   QUEUE+106
PRINTXTB EQU   0
XHEAD    EQU   PRINTXTB+1
TENS     EQU   XHEAD+1
HEXREP   EQU   XHEAD+7
CGMO     EQU   HEXREP+1
CPOS     EQU   HEXREP+3
WNCI     EQU   0
DISC1    EQU   WNCI+1
@NM00083 EQU   DISC1+28
CG       EQU   @NM00083
PRNTGCMR EQU   0
GCMNAME  EQU   PRNTGCMR+35
SUF      EQU   GCMNAME+4
FCBARRAY EQU   0
FCBELEM  EQU   0
XFCBFLG  EQU   FCBELEM
XFCBERR  EQU   XFCBFLG
XFCBEND  EQU   XFCBFLG
XFCBLINE EQU   FCBELEM+1
XFCBLPI  EQU   FCBELEM+4
XFCBCHX  EQU   FCBELEM+6
XFCBCH   EQU   XFCBCHX+1
FCBLINE  EQU   0
PRTFCB   EQU   FCBLINE+1
FCBLN    EQU   PRTFCB+20
FCBLPI   EQU   PRTFCB+27
FCBCH    EQU   PRTFCB+44
FCBCN    EQU   FCBCH+15
GSEG     EQU   0
GSEGASGN EQU   GSEG
GLOADMOD EQU   0
LMODCNT  EQU   GLOADMOD+6
LMODBOD  EQU   GLOADMOD+8
LOADSEG  EQU   LMODBOD
GRAFBOD  EQU   0
GRAFSEG  EQU   0
GASNMT   EQU   GRAFSEG
GRSPAT   EQU   GRAFSEG+1
RASTER   EQU   GRSPAT
BITPAT1  EQU   RASTER
PITBITS  EQU   RASTER+2
PIT1     EQU   PITBITS
PIT2     EQU   PITBITS
PARITY1  EQU   RASTER+2
PARITY2  EQU   RASTER+2
PITPAR   EQU   0
GRFHDR   EQU   0
GRCHARHD EQU   GRFHDR
SEGNO    EQU   GRCHARHD+11
GRASN    EQU   SEGNO
GRPIT    EQU   GRCHARHD+22
BITHD    EQU   0
GRFGRID  EQU   0
LNO      EQU   GRFGRID+2
DOT1     EQU   GRFGRID+5
GRAFBIT  EQU   GRFGRID+6
DOT2     EQU   GRFGRID+24
CESD     EQU   0
CESDINFO EQU   CESD
CESDID   EQU   CESDINFO
CESDSP   EQU   CESDINFO+1
CESDESDI EQU   CESDINFO+4
CESDCNT  EQU   CESDINFO+6
CESDDATA EQU   CESD+8
CESDNAME EQU   CESDDATA
CESDTYPE EQU   CESDDATA+8
CESDADDR EQU   CESDDATA+9
CESDSEGN EQU   CESDDATA+12
CESDIDLN EQU   CESDDATA+13
TBLREF   EQU   0
CLOADSEG EQU   0
LTNO     EQU   CLOADSEG+5
COPYSEG  EQU   0
COPYHD   EQU   COPYSEG
COPYSEQN EQU   COPYHD
COPY1    EQU   COPYSEQN
COPYN    EQU   COPYSEQN+1
LINE1    EQU   COPYSEQN+2
LINEN    EQU   COPYSEQN+3
POS1     EQU   COPYHD+4
TEXTX    EQU   COPYHD+5
TEXT     EQU   COPYSEG+6
MODFORM  EQU   0
MNOTE    EQU   MODFORM+2
MNOTEM   EQU   MNOTE+5
MSEG     EQU   MODFORM+13
@NM00131 EQU   MODFORM+23
MNUMBER  EQU   @NM00131
MCHAR    EQU   MODFORM+84
CMTINFO  EQU   0
MINC     EQU   CMTINFO
MAXC     EQU   CMTINFO+1
MINL     EQU   CMTINFO+2
MAXL     EQU   CMTINFO+3
NHPG     EQU   CMTINFO+4
NHLN     EQU   CMTINFO+6
TIME     EQU   CMTINFO+8
ORUNTIME EQU   CMTINFO+12
CMTARRAY EQU   CMTINFO+16
COPYINFO EQU   CMTARRAY
CP1      EQU   COPYINFO
CPX      EQU   COPYINFO+1
LN1      EQU   COPYINFO+2
LNX      EQU   COPYINFO+3
TXT      EQU   CMTARRAY+4
USERLIST EQU   0
@NM00133 EQU   USERLIST
PARMVL1  EQU   @NM00133
@NM00134 EQU   USERLIST+4
PARMVL2  EQU   @NM00134
PARM2    EQU   USERLIST+5
@NM00135 EQU   USERLIST+8
PARMVL3  EQU   @NM00135
PARM3    EQU   USERLIST+9
DDNMLIST EQU   0
LISTLEN  EQU   DDNMLIST
USERINDD EQU   DDNMLIST+34
SYSIFLG  EQU   USERINDD
USERPRDD EQU   DDNMLIST+42
SYSPFLG  EQU   USERPRDD
USERU1DD EQU   DDNMLIST+58
SYS1FLG  EQU   USERU1DD
USERU2DD EQU   DDNMLIST+66
SYS2FLG  EQU   USERU2DD
HDNGLIST EQU   0
HLEN     EQU   HDNGLIST
HDNG     EQU   HDNGLIST+2
DDNMLST  EQU   0
LIBOUTDD EQU   DDNMLST+24
SYNMSG   EQU   41
IHADCB   EQU   0
IHADCS00 EQU   0
DCBFDAD  EQU   IHADCS00+5
IHADCS01 EQU   0
DCBDVTBL EQU   IHADCS01
IHADCS11 EQU   0
DCBRELB  EQU   IHADCS11
DCBREL   EQU   DCBRELB+1
DCBBUFCB EQU   IHADCS11+4
DCBDSORG EQU   IHADCS11+10
DCBDSRG1 EQU   DCBDSORG
DCBDSRG2 EQU   DCBDSORG+1
DCBIOBAD EQU   IHADCS11+12
DCBODEB  EQU   DCBIOBAD
DCBLNP   EQU   DCBODEB
DCBQSLM  EQU   DCBLNP
DCBIOBAA EQU   DCBODEB+1
IHADCS50 EQU   0
DCBSVCXL EQU   IHADCS50
DCBEODAD EQU   IHADCS50+4
DCBBFALN EQU   DCBEODAD
DCBHIARC EQU   DCBBFALN
DCBBFTEK EQU   DCBHIARC
DCBBFT   EQU   DCBBFTEK
DCBEXLST EQU   IHADCS50+8
DCBRECFM EQU   DCBEXLST
DCBRECLA EQU   DCBRECFM
IHADCS24 EQU   0
DCBDDNAM EQU   IHADCS24
DCBOFLGS EQU   IHADCS24+8
DCBOFLWR EQU   DCBOFLGS
DCBOFOPN EQU   DCBOFLGS
DCBIFLG  EQU   IHADCS24+9
DCBIBPCT EQU   DCBIFLG
DCBMACR  EQU   IHADCS24+10
DCBMACR1 EQU   DCBMACR
DCBMRFE  EQU   DCBMACR1
DCBMRGET EQU   DCBMRFE
DCBMRAPG EQU   DCBMACR1
DCBMRRD  EQU   DCBMRAPG
DCBMRCI  EQU   DCBMACR1
DCBMRMVG EQU   DCBMRCI
DCBMRLCG EQU   DCBMACR1
DCBMRABC EQU   DCBMACR1
DCBMRPT1 EQU   DCBMRABC
DCBMRSBG EQU   DCBMRPT1
DCBMRCRL EQU   DCBMACR1
DCBMRCHK EQU   DCBMRCRL
DCBMRRDX EQU   DCBMRCHK
DCBMRDMG EQU   DCBMACR1
DCBMACR2 EQU   DCBMACR+1
DCBMRPUT EQU   DCBMACR2
DCBMRWRT EQU   DCBMACR2
DCBMRMVP EQU   DCBMACR2
DCBMR5WD EQU   DCBMACR2
DCBMRLDM EQU   DCBMR5WD
DCBMRLCP EQU   DCBMRLDM
DCBMR4WD EQU   DCBMACR2
DCBMRPT2 EQU   DCBMR4WD
DCBMRTMD EQU   DCBMRPT2
DCBMR3WD EQU   DCBMACR2
DCBMRCTL EQU   DCBMR3WD
DCBMRSTK EQU   DCBMRCTL
DCBMR1WD EQU   DCBMACR2
DCBMRSWA EQU   DCBMR1WD
DCBMRDMD EQU   DCBMRSWA
IHADCS25 EQU   0
DCBMACRF EQU   IHADCS25+2
DCBMACF1 EQU   DCBMACRF
DCBMFFE  EQU   DCBMACF1
DCBMFGET EQU   DCBMFFE
DCBMFAPG EQU   DCBMACF1
DCBMFRD  EQU   DCBMFAPG
DCBMFCI  EQU   DCBMACF1
DCBMFMVG EQU   DCBMFCI
DCBMFLCG EQU   DCBMACF1
DCBMFABC EQU   DCBMACF1
DCBMFPT1 EQU   DCBMFABC
DCBMFSBG EQU   DCBMFPT1
DCBMFCRL EQU   DCBMACF1
DCBMFCHK EQU   DCBMFCRL
DCBMFDMG EQU   DCBMACF1
DCBMACF2 EQU   DCBMACRF+1
DCBMFPUT EQU   DCBMACF2
DCBMFWRT EQU   DCBMACF2
DCBMFMVP EQU   DCBMACF2
DCBMF5WD EQU   DCBMACF2
DCBMFLDM EQU   DCBMF5WD
DCBMFLCP EQU   DCBMFLDM
DCBMF4WD EQU   DCBMACF2
DCBMFPT2 EQU   DCBMF4WD
DCBMFTMD EQU   DCBMFPT2
DCBMF3WD EQU   DCBMACF2
DCBMFCTL EQU   DCBMF3WD
DCBMFSTK EQU   DCBMFCTL
DCBMF1WD EQU   DCBMACF2
DCBMFSWA EQU   DCBMF1WD
DCBMFDMD EQU   DCBMFSWA
DCBDEBAD EQU   IHADCS25+4
DCBIFLGS EQU   DCBDEBAD
DCBIFPCT EQU   DCBIFLGS
IHADCS26 EQU   0
DCBWRITE EQU   IHADCS26
DCBREAD  EQU   DCBWRITE
DCBWRITA EQU   DCBREAD+1
IHADCS27 EQU   0
DCBGET   EQU   IHADCS27
DCBPUT   EQU   DCBGET
DCBGETA  EQU   DCBPUT+1
IHADCS36 EQU   0
DCBGERR  EQU   IHADCS36
DCBPERR  EQU   DCBGERR
DCBCHECK EQU   DCBPERR
DCBOPTCD EQU   DCBCHECK
DCBOPTH  EQU   DCBOPTCD
DCBOPTO  EQU   DCBOPTH
DCBOPTZ  EQU   DCBOPTCD
DCBGERRA EQU   DCBCHECK+1
DCBPERRA EQU   DCBGERRA
DCBSYNAD EQU   IHADCS36+4
DCBCIND1 EQU   IHADCS36+8
DCBCIND2 EQU   IHADCS36+9
DCBBLKSI EQU   IHADCS36+10
DCBIOBA  EQU   IHADCS36+16
DCBCICB  EQU   DCBIOBA
IHADCS52 EQU   0
DCBDIRCT EQU   IHADCS52
DCBQSWS  EQU   DCBDIRCT
DCBUSASI EQU   DCBQSWS
DCBQADFS EQU   DCBUSASI
DCBBUFOF EQU   DCBDIRCT+1
IHADCS37 EQU   0
DCBFLAG1 EQU   IHADCS37
IHADCS38 EQU   0
DCBEOBR  EQU   IHADCS38
DCBLRECL EQU   IHADCS38+10
DCBPOINT EQU   IHADCS38+12
DCBCNTRL EQU   DCBPOINT
IHADCS40 EQU   0
DCBEOBAD EQU   IHADCS40
DCBCCCW  EQU   IHADCS40+4
DCBRECAD EQU   DCBCCCW
DCBRECBT EQU   DCBRECAD
DCBRCREL EQU   DCBRECBT
@NM00169 EQU   IHADCS40+12
DCBEROPT EQU   @NM00169
DEBDAPTR EQU   0
DEBEXPTR EQU   0
DEBSBPTR EQU   0
DEBBASIC EQU   0
DEBTCBAD EQU   DEBBASIC
DEBDEBAD EQU   DEBBASIC+4
DEBIRBAD EQU   DEBBASIC+8
DEBOFLGS EQU   DEBIRBAD
DEBOPATB EQU   DEBBASIC+12
DEBFLGS1 EQU   DEBBASIC+14
DEBUSRPG EQU   DEBBASIC+16
DEBNMEXT EQU   DEBUSRPG
DEBRRQ   EQU   DEBBASIC+20
DEBECBAD EQU   DEBRRQ
DEBDCBAD EQU   DEBBASIC+24
DEBPROTG EQU   DEBDCBAD
DEBAPPAD EQU   DEBBASIC+28
DEBBASND EQU   DEBBASIC+32
DEBDASD  EQU   0
DEBUCBAD EQU   DEBDASD
DEBACSMD EQU   0
DEBVOLSQ EQU   DEBACSMD
DEBVOLBT EQU   DEBVOLSQ
DEBDSNM  EQU   DEBACSMD+4
DEBUTSAA EQU   DEBDSNM
DEBACS01 EQU   0
DEBDSNAM EQU   DEBACS01
DEBACS02 EQU   0
DEBDBLK  EQU   DEBACS02
DEBACS03 EQU   0
DEBACS04 EQU   0
DEBTBFRA EQU   DEBACS04
DEBTCCWA EQU   DEBACS04+4
DEBACS05 EQU   0
DEBFUCBA EQU   DEBACS05
DEBLUCBA EQU   DEBACS05+4
DEBACS06 EQU   0
DEBACS07 EQU   0
DEBACS08 EQU   0
DEBSUBNM EQU   0
DEB      EQU   0
DEBAVT   EQU   DEB
DEBEOEA  EQU   DEBAVT
DEBEOEAB EQU   DEBEOEA
DEBSIOA  EQU   DEBAVT+4
DEBSIOAB EQU   DEBSIOA
DEBPCIA  EQU   DEBAVT+8
DEBPCIAB EQU   DEBPCIA
DEBCEA   EQU   DEBAVT+12
DEBCEAB  EQU   DEBCEA
DEBXCEA  EQU   DEBAVT+16
DEBXCEAB EQU   DEBXCEA
DEBPREFX EQU   DEB+20
DEBXTNP  EQU   DEBPREFX+8
DEBXTN   EQU   0
DEBXFLG1 EQU   DEBXTN+2
ABPARM   EQU   0
SYSCODE  EQU   ABPARM
RETCOD   EQU   ABPARM+2
OPTION   EQU   ABPARM+3
IGNORE   EQU   OPTION
COL      EQU   0
ABPAR1   EQU   0
ABDCB    EQU   0
ABOCEWA  EQU   0
ABDSN    EQU   ABOCEWA+100
ASGNMENT EQU   LPI8
PITCH    EQU   LPI6
ALLKEY   EQU   KWDUSED
NAMESET  EQU   ALLKEY
NOKEY    EQU   ALLKEY
DELSET   EQU   ALLKEY
FCBKEY   EQU   KWDUSED
LPISET   EQU   FCBKEY
TBLKEY   EQU   KWDUSED
LOCSET   EQU   TBLKEY
COPYKEY  EQU   KWDUSED
COPYSET  EQU   COPYKEY
LINESET  EQU   COPYKEY
POSSET   EQU   COPYKEY
TEXTSET  EQU   COPYKEY
GRAPHKEY EQU   KWDUSED
REFSET   EQU   GRAPHKEY
GCMSET   EQU   GRAPHKEY
ASGNSET  EQU   GRAPHKEY
XLATTABL EQU   MODBOD
XPOS     EQU   XLATTABL
CGMIDALL EQU   XLATTABL+256
CGMIDX   EQU   CGMIDALL
CGMIDN   EQU   CGMIDX
GRFMODS  EQU   XLATTABL+264
GRAFMODN EQU   GRFMODS
FCBMOD   EQU   LIBBUF
FCBHEAD  EQU   FCBMOD
FCBCNT   EQU   FCBHEAD+6
FCBYTE   EQU   FCBMOD+8
FLPI12   EQU   FCBYTE
FLPI     EQU   FLPI12
DCBTAB   EQU   DCBADS
CWORK    EQU   FWORK
UWORK    EQU   CWORK
UNITS    EQU   UWORK+1
CWORKX   EQU   FWORK
CWORK3   EQU   CWORKX+1
CWORK2   EQU   CWORK3+1
CWORK1   EQU   CWORK2+1
COL72    EQU   PRIMCARD+71
IDR      EQU   CESD
IDRINFO  EQU   IDR
IDRID    EQU   IDRINFO
IDRCNT   EQU   IDRINFO+1
IDRTYPE  EQU   IDRINFO+2
IDRDATA  EQU   IDR+3
IDRZAP   EQU   IDRDATA
IDR2DATA EQU   IDRDATA
IDR2PRNM EQU   IDR2DATA
IDR2PRVM EQU   IDR2DATA+10
IDR2DATE EQU   IDR2DATA+12
IDR3DATA EQU   IDRDATA
IDR3ESDI EQU   IDR3DATA
IDR3IND  EQU   IDR3DATA+2
IDR3PRNM EQU   IDR3DATA+3
IDR3PRVM EQU   IDR3DATA+13
IDR3DATE EQU   IDR3DATA+15
EOM      EQU   CESD
EOMID    EQU   EOM
EOMSP    EQU   EOM+1
EOMCNT   EQU   EOM+4
EOMCNTZ  EQU   EOM+6
EOMCCW   EQU   EOM+8
EOMCCWAD EQU   EOMCCW+1
EOMCCWCT EQU   EOMCCW+6
EOMENT   EQU   EOM+16
EOMTLN   EQU   EOM+18
DEBPTR   EQU   DCBDEBAD
DEBBAS02 EQU   DEBBASND
DEBDDS1  EQU   DEBBAS02
DEBSUCBA EQU   DEBDDS1
DEBDEVED EQU   DEBDDS1+4
DEBRDCB  EQU   DEBDDS1+4
DEBPDCB  EQU   DEBDDS1+8
DEBWDCB  EQU   DEBDDS1+12
DEBACS09 EQU   DEBDEVED
DEBASC09 EQU   DEBACS09
DEBEAMFG EQU   DEBASC09+3
DEBDSID  EQU   DEBASC09+4
DEBEOD   EQU   DEBASC09+12
DEBBOE   EQU   DEBEOD
DEBEODRV EQU   DEBBOE
DEBEODTT EQU   DEBBOE+1
DEBEOD0  EQU   DEBBOE+2
DEBEODSS EQU   DEBBOE+3
DEBBAS01 EQU   DEBBASND
DEBISAM  EQU   DEBBAS01
DEBFIEAD EQU   DEBISAM
DEBFPEAD EQU   DEBISAM+4
DEBFOEAD EQU   DEBISAM+8
DEBEXPT  EQU   DEBISAM+12
DEBRPSID EQU   DEBEXPT
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
DEBEXPTA EQU   DEBEXPT+1
DEBRSV12 EQU   DEBRPSID
DEBRSV11 EQU   DEBRPSID
DEBRSV10 EQU   DEBRPSID
DEBRSV09 EQU   DEBRPSID
DEBRPSAP EQU   DEBRPSID
DEBRPSO  EQU   DEBRPSID
DEBRPSI  EQU   DEBRPSID
DEBRPSP  EQU   DEBRPSID
DEBFOEB  EQU   DEBFOEAD+1
DEBNOEE  EQU   DEBFOEAD
DEBFPEB  EQU   DEBFPEAD+1
DEBNPEE  EQU   DEBFPEAD
DEBFIEB  EQU   DEBFIEAD+1
DEBNIEE  EQU   DEBFIEAD
DEBBOESS EQU   DEBEODSS
DEBBOE0  EQU   DEBEOD0
DEBBOETT EQU   DEBEODTT
DEBBOERV EQU   DEBEODRV
DEBRV008 EQU   DEBDSID+7
DEBWTPTI EQU   DEBDSID+6
DEBEXDTE EQU   DEBDSID
DEBRV007 EQU   DEBEAMFG
DEBRV006 EQU   DEBEAMFG
DEBRV005 EQU   DEBEAMFG
DEBRV004 EQU   DEBEAMFG
DEBSECVL EQU   DEBEAMFG
DEBVAMSG EQU   DEBEAMFG
DEBDSOPN EQU   DEBEAMFG
DEBMULTI EQU   DEBEAMFG
DEBVSEQU EQU   DEBASC09+2
DEBDSSQL EQU   DEBASC09+1
DEBVOLAC EQU   DEBASC09
DEBWDCBA EQU   DEBWDCB+1
DEBRSV08 EQU   DEBWDCB
DEBPDCBA EQU   DEBPDCB+1
DEBRSV07 EQU   DEBPDCB
DEBRDCBA EQU   DEBRDCB+1
DEBRSV06 EQU   DEBRDCB
DEBSUCBB EQU   DEBSUCBA+1
DEBSDVM  EQU   DEBSUCBA
@NM00097 EQU   EOMCCW+4
@NM00096 EQU   EOMCCW
@NM00020 EQU   CWORK2
@NM00019 EQU   CWORK3
@NM00018 EQU   CWORKX
@NM00017 EQU   UWORK
FCHN     EQU   FCBYTE
@NM00016 EQU   FLPI12
FCBNA    EQU   FCBYTE
FCBRSVD  EQU   FCBHEAD+4
FCBNAME  EQU   FCBHEAD
CGMIDNO  EQU   CGMIDX+1
XREF     EQU   XPOS
XWCGM    EQU   XPOS
@NM00015 EQU   GRAPHKEY
@NM00014 EQU   COPYKEY
GCMLSET  EQU   TBLKEY
CGMIDSET EQU   TBLKEY
@NM00013 EQU   TBLKEY
CHSET    EQU   FCBKEY
SIZESET  EQU   FCBKEY
@NM00012 EQU   FCBKEY
@NM00179 EQU   ABOCEWA
@NM00178 EQU   OPTION
@NM00177 EQU   ABPARM+1
DEBXRV40 EQU   DEBXTN+28
DEBXOPNJ EQU   DEBXTN+24
DEBXXARG EQU   DEBXTN+20
DEBXMCF2 EQU   DEBXTN+19
DEBXMCF1 EQU   DEBXTN+18
DEBXDSO2 EQU   DEBXTN+17
DEBXDSO1 EQU   DEBXTN+16
DEBXDBPR EQU   DEBXTN+12
DEBXDCBM EQU   DEBXTN+8
DEBXDSAB EQU   DEBXTN+4
DEBXRV48 EQU   DEBXTN+3
DEBXRV47 EQU   DEBXFLG1
DEBXRV46 EQU   DEBXFLG1
DEBXRV45 EQU   DEBXFLG1
DEBXRV44 EQU   DEBXFLG1
DEBXRV43 EQU   DEBXFLG1
DEBXDSSI EQU   DEBXFLG1
DEBXTSKC EQU   DEBXFLG1
DEBXCDCB EQU   DEBXFLG1
DEBXLNGH EQU   DEBXTN
DEBTBLOF EQU   DEBPREFX+14
DEBAMTYP EQU   DEBPREFX+13
DEBLNGTH EQU   DEBPREFX+12
DEBDCBMK EQU   DEBXTNP
DEBDSCBA EQU   DEBPREFX+1
DEBWKARA EQU   DEBPREFX
DEBXCEAD EQU   DEBXCEA+1
DEBXCENP EQU   DEBXCEAB
DEBRSV35 EQU   DEBXCEAB
DEBRSV34 EQU   DEBXCEAB
DEBRSV33 EQU   DEBXCEAB
DEBRSV32 EQU   DEBXCEAB
DEBCEAD  EQU   DEBCEA+1
DEBCENP  EQU   DEBCEAB
DEBRSV31 EQU   DEBCEAB
DEBRSV30 EQU   DEBCEAB
DEBRSV29 EQU   DEBCEAB
DEBRSV28 EQU   DEBCEAB
DEBPCIAD EQU   DEBPCIA+1
DEBPCINP EQU   DEBPCIAB
DEBRSV27 EQU   DEBPCIAB
DEBRSV26 EQU   DEBPCIAB
DEBRSV25 EQU   DEBPCIAB
DEBRSV24 EQU   DEBPCIAB
DEBSIOAD EQU   DEBSIOA+1
DEBSIONP EQU   DEBSIOAB
DEBFIX   EQU   DEBSIOAB
DEBIOVR  EQU   DEBSIOAB
DEBSIOX  EQU   DEBSIOAB
DEBPGFX  EQU   DEBSIOAB
DEBEOEAD EQU   DEBEOEA+1
DEBEOENP EQU   DEBEOEAB
DEBRSV22 EQU   DEBEOEAB
DEBRSV21 EQU   DEBEOEAB
DEBRSV20 EQU   DEBEOEAB
DEBRSV19 EQU   DEBEOEAB
DEBSUBID EQU   DEBSUBNM
DEBSIOA2 EQU   DEBACS08+24
DEBRPSIO EQU   DEBACS08+20
DEBFREED EQU   DEBACS08+16
@NM00176 EQU   DEBACS08+12
@NM00175 EQU   DEBACS08+8
DEBDISAD EQU   DEBACS08+4
@NM00174 EQU   DEBACS08
DEBRPSST EQU   DEBACS07+64
DEBARECK EQU   DEBACS07+60
DEBAREWT EQU   DEBACS07+56
DEBACHK  EQU   DEBACS07+52
DEBAWRIT EQU   DEBACS07+48
DEBASETL EQU   DEBACS07+44
DEBAREAD EQU   DEBACS07+40
DEBCRECK EQU   DEBACS07+36
DEBCREWT EQU   DEBACS07+32
DEBCCHK  EQU   DEBACS07+28
DEBCWRIT EQU   DEBACS07+24
DEBCSETL EQU   DEBACS07+20
DEBCREAD EQU   DEBACS07+16
DEBWKPT5 EQU   DEBACS07+12
DEBWKPT4 EQU   DEBACS07+8
DEBGET   EQU   DEBACS07+4
@NM00173 EQU   DEBACS07
DEBPUT   EQU   DEBACS06+4
DEBDCBFA EQU   DEBACS06
DEBLUCBB EQU   DEBLUCBA+1
DEBRSV18 EQU   DEBLUCBA
DEBFUCBB EQU   DEBFUCBA+1
DEBRSV17 EQU   DEBFUCBA
DEBTCCWB EQU   DEBTCCWA+1
DEBRSV16 EQU   DEBTCCWA
DEBTBFRB EQU   DEBTBFRA+1
DEBRSV15 EQU   DEBTBFRA
DEBDBPEF EQU   DEBACS03+8
DEBDBPP  EQU   DEBACS03+4
DEBDTPP  EQU   DEBACS03
DEBDBPE  EQU   DEBDBLK+1
DEBDBPT  EQU   DEBDBLK
DEBEXTNM EQU   DEBDSNAM
DEBLRECL EQU   DEBACSMD+14
DEBBLKSI EQU   DEBACSMD+12
DEBRSV14 EQU   DEBDSNM+4
DEBUTSAB EQU   DEBUTSAA+1
DEBRSV13 EQU   DEBUTSAA
DEBVOLNM EQU   DEBACSMD+2
DEBVLSEQ EQU   DEBVOLSQ+1
DEBRSV42 EQU   DEBVOLBT
DEBRSV41 EQU   DEBVOLBT
DEBRSV40 EQU   DEBVOLBT
DEBRSV39 EQU   DEBVOLBT
DEBRSV38 EQU   DEBVOLBT
DEBRSV37 EQU   DEBVOLBT
DEBRSV36 EQU   DEBVOLBT
DEBEXFUL EQU   DEBVOLBT
DEBNMTRK EQU   DEBDASD+14
DEBENDHH EQU   DEBDASD+12
DEBENDCC EQU   DEBDASD+10
DEBSTRHH EQU   DEBDASD+8
DEBSTRCC EQU   DEBDASD+6
DEBBINUM EQU   DEBDASD+4
DEBUCBA  EQU   DEBUCBAD+1
DEBDVMOD EQU   DEBUCBAD
DEBAPPB  EQU   DEBAPPAD+1
DEBEXSCL EQU   DEBAPPAD
DEBDCBB  EQU   DEBDCBAD+1
DEBDEBID EQU   DEBPROTG
DEBECBB  EQU   DEBECBAD+1
DEBPRIOR EQU   DEBECBAD
DEBUSRPB EQU   DEBUSRPG+1
DEBRSV05 EQU   DEBBASIC+15
DEBXTNIN EQU   DEBFLGS1
DEBAPFIN EQU   DEBFLGS1
DEBF1CEV EQU   DEBFLGS1
DEBCINDI EQU   DEBFLGS1
DEBRSV02 EQU   DEBFLGS1
DEBRSIOA EQU   DEBFLGS1
DEBEOFDF EQU   DEBFLGS1
DEBPWCKD EQU   DEBFLGS1
DEBQSCNT EQU   DEBBASIC+13
DEBACCS  EQU   DEBOPATB
DEBPOSIT EQU   DEBOPATB
DEBZERO  EQU   DEBOPATB
DEBABEND EQU   DEBOPATB
DEBIRBB  EQU   DEBIRBAD+1
DEBRERR  EQU   DEBOFLGS
DEBLABEL EQU   DEBOFLGS
DEBSPLIT EQU   DEBOFLGS
DEBDCB   EQU   DEBOFLGS
DEBRLSE  EQU   DEBOFLGS
DEBEOF   EQU   DEBOFLGS
DEBDISP  EQU   DEBOFLGS
DEBDEBB  EQU   DEBDEBAD+1
DEBAMLNG EQU   DEBDEBAD
DEBTCBB  EQU   DEBTCBAD+1
DEBNMSUB EQU   DEBTCBAD
DCBEOB   EQU   IHADCS40+20
DCBPRECL EQU   IHADCS40+18
@NM00172 EQU   IHADCS40+16
@NM00171 EQU   @NM00169+1
@NM00170 EQU   DCBEROPT
DCBERABE EQU   DCBEROPT
DCBERSKP EQU   DCBEROPT
DCBERACC EQU   DCBEROPT
@NM00168 EQU   IHADCS40+10
@NM00167 EQU   IHADCS40+9
@NM00166 EQU   IHADCS40+8
DCBRECA  EQU   DCBRECAD+1
@NM00165 EQU   DCBRECBT
DCBRCFGT EQU   DCBRCREL
DCBRCTRU EQU   DCBRCREL
DCBLCCW  EQU   DCBEOBAD
DCBNOTE  EQU   DCBCNTRL
@NM00164 EQU   IHADCS38+8
DCBEOBW  EQU   IHADCS38+4
DCBEOBRA EQU   DCBEOBR+1
DCBNCP   EQU   DCBEOBR
@NM00163 EQU   DCBFLAG1
DCBSTFLS EQU   DCBFLAG1
DCBSTQCK EQU   DCBFLAG1
DCBDIRCQ EQU   DCBBUFOF
DCBQSTRU EQU   DCBUSASI
@NM00162 EQU   DCBUSASI
DCBQADF3 EQU   DCBQADFS
DCBQADF2 EQU   DCBQADFS
DCBQADF1 EQU   DCBQADFS
DCBBLBP  EQU   DCBUSASI
@NM00161 EQU   DCBUSASI
DCBCICBA EQU   DCBCICB+1
@NM00160 EQU   DCBCICB
DCBOFFSW EQU   IHADCS36+15
DCBOFFSR EQU   IHADCS36+14
DCBWCPL  EQU   IHADCS36+13
DCBWCPO  EQU   IHADCS36+12
DCBCNQSM EQU   DCBCIND2
DCBCNFEO EQU   DCBCIND2
DCBCNCHS EQU   DCBCIND2
DCBCNBFP EQU   DCBCIND2
DCBCNIOE EQU   DCBCIND2
DCBCNCLO EQU   DCBCIND2
DCBCNWRO EQU   DCBCIND2
DCBCNSTO EQU   DCBCIND2
DCBCNEXB EQU   DCBCIND1
@NM00159 EQU   DCBCIND1
DCBCNBRM EQU   DCBCIND1
@NM00158 EQU   DCBCIND1
DCBCNEVA EQU   DCBCIND1
DCBCNEVB EQU   DCBCIND1
DCBCNSRD EQU   DCBCIND1
DCBCNTOV EQU   DCBCIND1
DCBSYNA  EQU   DCBSYNAD+1
DCBIOBL  EQU   DCBSYNAD
DCBCHCKA EQU   DCBPERRA
DCBOPTJ  EQU   DCBOPTCD
DCBOPTT  EQU   DCBOPTCD
DCBSRCHD EQU   DCBOPTZ
DCBOPTQ  EQU   DCBOPTCD
DCBBCKPT EQU   DCBOPTO
DCBOPTC  EQU   DCBOPTCD
DCBOPTU  EQU   DCBOPTCD
DCBOPTW  EQU   DCBOPTCD
DCBPUTA  EQU   DCBGETA
@NM00157 EQU   DCBPUT
DCBREADA EQU   DCBWRITA
@NM00156 EQU   DCBREAD
DCBDEBA  EQU   DCBDEBAD+1
@NM00155 EQU   DCBIFLGS
DCBIFIOE EQU   DCBIFLGS
DCBCH12  EQU   DCBIFPCT
DCBCH9   EQU   DCBIFPCT
DCBIFEC  EQU   DCBIFLGS
DCBMFSTI EQU   DCBMFDMD
DCBMFAWR EQU   DCBMFSTK
DCBMFUIP EQU   DCBMFTMD
DCBMFIDW EQU   DCBMFLCP
DCBMFWRK EQU   DCBMFMVP
DCBMFRDQ EQU   DCBMFWRT
DCBMFGTQ EQU   DCBMFPUT
DCBMFSTL EQU   DCBMACF2
DCBMFCK  EQU   DCBMFDMG
DCBMFRDX EQU   DCBMFCHK
DCBMFDBF EQU   DCBMFSBG
DCBMFRDI EQU   DCBMFLCG
DCBMFRDK EQU   DCBMFMVG
DCBMFWRQ EQU   DCBMFRD
DCBMFPTQ EQU   DCBMFGET
DCBMFECP EQU   DCBMACF1
DCBTIOT  EQU   IHADCS25
DCBMRSTI EQU   DCBMRDMD
DCBMRAWR EQU   DCBMRSTK
DCBMRUIP EQU   DCBMRTMD
DCBMRIDW EQU   DCBMRLCP
DCBMRWRK EQU   DCBMRMVP
DCBMRRDQ EQU   DCBMRWRT
DCBMRGTQ EQU   DCBMRPUT
DCBMRSTL EQU   DCBMACR2
DCBMRCK  EQU   DCBMRDMG
DCBPGFXA EQU   DCBMRRDX
DCBMRDBF EQU   DCBMRSBG
DCBMRRDI EQU   DCBMRLCG
DCBMRRDK EQU   DCBMRMVG
DCBMRWRQ EQU   DCBMRRD
DCBMRPTQ EQU   DCBMRGET
DCBMRECP EQU   DCBMACR1
@NM00154 EQU   DCBIFLG
DCBIBIOE EQU   DCBIFLG
DCBICH12 EQU   DCBIBPCT
DCBICH9  EQU   DCBIBPCT
DCBIBEC  EQU   DCBIFLG
DCBOFIOF EQU   DCBOFLGS
DCBOFUEX EQU   DCBOFLGS
DCBOFTM  EQU   DCBOFLGS
DCBOFPPC EQU   DCBOFLGS
DCBOFEOV EQU   DCBOFLGS
DCBOFLRB EQU   DCBOFLGS
DCBOFIOD EQU   DCBOFLWR
DCBEXLSA EQU   DCBEXLST+1
DCBRECKL EQU   DCBRECFM
DCBRECCC EQU   DCBRECFM
DCBRECSB EQU   DCBRECFM
DCBRECBR EQU   DCBRECFM
DCBRECTO EQU   DCBRECLA
DCBRECL  EQU   DCBRECLA
DCBEODA  EQU   DCBEODAD+1
DCBBFA   EQU   DCBBFTEK
DCBH0    EQU   DCBBFTEK
DCBBFTKD EQU   DCBBFTEK
DCBBFTE  EQU   DCBBFT
DCBBFTKR EQU   DCBBFT
DCBBFTS  EQU   DCBBFT
DCBH1    EQU   DCBBFTEK
DCBSVCXA EQU   DCBSVCXL+1
@NM00153 EQU   DCBSVCXL
DCBODEBA EQU   DCBIOBAA
@NM00152 EQU   DCBQSLM
DCBUPDBT EQU   DCBQSLM
DCBUPDCM EQU   DCBQSLM
DCB1DVDS EQU   DCBQSLM
@NM00151 EQU   DCBDSRG2
DCBDSGTR EQU   DCBDSRG2
DCBACBM  EQU   DCBDSRG2
@NM00150 EQU   DCBDSRG2
DCBDSGTQ EQU   DCBDSRG2
DCBDSGTX EQU   DCBDSRG2
DCBDSGGS EQU   DCBDSRG2
DCBDSGU  EQU   DCBDSRG1
DCBDSGPO EQU   DCBDSRG1
@NM00149 EQU   DCBDSRG1
@NM00148 EQU   DCBDSRG1
DCBDSGCX EQU   DCBDSRG1
DCBDSGDA EQU   DCBDSRG1
DCBDSGPS EQU   DCBDSRG1
DCBDSGIS EQU   DCBDSRG1
DCBBUFL  EQU   IHADCS11+8
DCBBUFCA EQU   DCBBUFCB+1
DCBBUFNO EQU   DCBBUFCB
DCBDEVT  EQU   DCBREL
DCBKEYLE EQU   DCBRELB
DCBTRBAL EQU   IHADCS01+6
@NM00147 EQU   IHADCS01+5
@NM00146 EQU   IHADCS01+4
DCBDVTBA EQU   DCBDVTBL+1
@NM00145 EQU   DCBDVTBL
DCBKEYCN EQU   IHADCS00+4
DCBRELAD EQU   IHADCS00
@NM00144 EQU   IHADCB
@NM00138 EQU   DDNMLST
@NM00137 EQU   DDNMLIST+50
@NM00136 EQU   DDNMLIST+2
PARM1    EQU   USERLIST+1
@NM00132 EQU   MODFORM+83
@NM00130 EQU   MODFORM+16
@NM00129 EQU   MODFORM+9
@NM00128 EQU   MNOTE
@NM00127 EQU   MODFORM
@NM00118 EQU   CLOADSEG+6
@NM00117 EQU   CLOADSEG
@NM00095 EQU   GRFGRID+4
@NM00094 EQU   GRFGRID
@NM00093 EQU   GRCHARHD+14
@NM00092 EQU   GRCHARHD
BITPAT2  EQU   RASTER+1
@NM00091 EQU   GLOADMOD
@NM00090 EQU   FCBCH
@NM00089 EQU   PRTFCB+29
@NM00088 EQU   PRTFCB+23
@NM00087 EQU   PRTFCB
FCBCTL   EQU   FCBLINE
@NM00086 EQU   XFCBCHX
@NM00085 EQU   GCMNAME
@NM00084 EQU   PRNTGCMR
OR       EQU   CG
@NM00082 EQU   DISC1
@NM00081 EQU   WNCI
@NM00080 EQU   HEXREP+2
@NM00079 EQU   HEXREP
@NM00078 EQU   XHEAD+2
@NM00077 EQU   XHEAD
@NM00076 EQU   PRINTXTB
@NM00075 EQU   QUEUE+105
@NM00074 EQU   QUEUE+1
RTNAME   EQU   TABLDEF+16
@NM00023 EQU   TABLDEF+12
@NM00022 EQU   TABLDEF+8
NOB      EQU   TABLDEF+4
REPFLAG  EQU   OPFLAGS+2
ASTRFLAG EQU   OPFLAGS+2
NOFLAG   EQU   OPFLAGS+2
CGMIDFLG EQU   OPFLAGS+1
LOCFLAG  EQU   OPFLAGS+1
GCMLFLAG EQU   OPFLAGS+1
GCMFLAG  EQU   OPFLAGS+1
REFFLAG  EQU   OPFLAGS+1
DELFLAG  EQU   OPFLAGS+1
ASGNFLAG EQU   OPFLAGS+1
NAMEFLAG EQU   OPFLAGS+1
TEXTFLAG EQU   OPFLAGS
POSFLAG  EQU   OPFLAGS
LINEFLAG EQU   OPFLAGS
COPYFLAG EQU   OPFLAGS
SIZEFLAG EQU   OPFLAGS
CHFLAG   EQU   OPFLAGS
LPIFLAG  EQU   OPFLAGS
OPNUM    EQU   TABLDEF
@NM00021 EQU   PRTQUEUE
IPOS     EQU   COPYLABL+4
LINEX    EQU   COPYLABL+3
COPYX    EQU   COPYLABL+1
LASTBYTE EQU   WORKAREA+17908
OVERFLO  EQU   LIBBUF+8200
FCBBOD   EQU   MODBOD+3
BEGMARG  EQU   MODBOD
RESRV1   EQU   WORKAREA+795
PARMNUM  EQU   WORKAREA+794
LASTKEY  EQU   WORKAREA+784
@NM00011 EQU   MSGOF
@NM00010 EQU   MSGR
PREFX    EQU   MSGTXT
@NM00009 EQU   SDRYCARD+18
@NM00008 EQU   LOADNAME
ARGMT    EQU   WORK+152
PRNCNT   EQU   WORK+148
PRECOL   EQU   WORK+105
@NM00007 EQU   BLDLNTRY+33
@NM00006 EQU   BATTRI
BINDCT   EQU   BLDLNTRY+17
@NM00005 EQU   BLDLNTRY+15
BTTRP    EQU   BLDLNTRY+12
@NM00004 EQU   DIRECTRY+27
@NM00003 EQU   DATTRI
@NM00002 EQU   DIRECTRY+16
DPREFX   EQU   DNAME
ACTIVKEY EQU   WORK+19
PARMGRP  EQU   STATUS4
FLDSW    EQU   STATUS4
HEXERR   EQU   STATUS4
KEYIN    EQU   STATUS4
KWDCOMP  EQU   STATUS3
UNBAL    EQU   STATUS3
INVCHAR  EQU   STATUS3
INVPARM  EQU   STATUS3
EXCLKWD  EQU   STATUS3
INVKWD   EQU   STATUS3
FOUND    EQU   STATUS3
INVDLM   EQU   STATUS3
XWORK    EQU   DWORK2
@NM00001 EQU   DWORK1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RF00132 EQU   @RC00118
@RC00136 EQU   @RC00118
@RC00197 EQU   @RC00196
@RC00259 EQU   @RC00256
@RC00408 EQU   @RC00391
@RC00444 EQU   @RC00443
@RC00426 EQU   @RC00389
@RC00561 EQU   @RC00558
@RC00595 EQU   @RC00592
@RC00723 EQU   @RC00720
@RC00750 EQU   @RC00747
@RC00849 EQU   @RC00846
@RC00835 EQU   @RC00829
@RC00960 EQU   @RC00959
@RC00967 EQU   @RC00959
@RF01118 EQU   @RC01115
@RF01186 EQU   @RC00934
@RC01217 EQU   @RC01213
@RC01281 EQU   @RC01272
@RF01402 EQU   @RC01377
@RC01947 EQU   @RC01946
@RC01966 EQU   @EL00027
@RC00203 EQU   @RC00197
@RC00198 EQU   @RC00197
@RC00596 EQU   @RC00595
@RC00751 EQU   @RC00750
@RC00841 EQU   @RC00835
@RC00754 EQU   @RC00751
@ENDDATA EQU   *
         END   IEBIMAGE,(C'PLS1330',0701,76350)

//LTJR1199 JOB ('MVSJES3      ','LFALJRACF011               '),
// 'T. ROBINSON 49',MSGLEVEL=1,PRTY=12,PERFORM=4,
// NOTIFY=L11FOTJ,MSGCLASS=A
//*MAIN CLASS=Q96,ORG=RMT40
//*DIST  PLEASE DELIVER TO BILL MCCOY  _____CUBICLE 209_____
//*DIST  PLEASE DELIVER TO BILL MCCOY  _____CUBICLE 209_____
//*PASSWORD DSN=EP.TESTLIBH,P=XXXX
// EXEC ASMFCL,SYSLMOD='EP.TESTLIBH(RDX01DRV)',DISP=SHR,RENT=NORENT
//ASMFCL.SYSPRINT DD SYSOUT=*
RCX      TITLE 'RACF EXIT ICHRDX01 - DRIVER ROUTINE'
***********************************************************************
*    NAME:                                                            *
*    PURPOSE:                                                         *
*                                                                     *
***********************************************************************
         EJECT
DRVRDX01 CSECT
*
*        SETUP SAVEAREA AND SAVE CALLER'S REGS
*
         USING DRVRDX01,R15
         B     DRVRCX                     BRANCH AROUND I.D.
         DC    C'DRVRDX01'                CSECT NAME
         DC    C'&SYSDATE'                ASSEMBLY DATE
         DC    C'&SYSTIME'                ASSEMBLY TIME
         USING SAVEAREA,R13
DRVRCX   STM   R14,R12,SAVER14            SAVE REGS
         LR    R12,R15                    SET UP BASE REGISTER
         USING DRVRDX01,R12
         DROP  R15
         LR    R11,R1                     SETUP PARAMETER REGISTER
         GETMAIN R,LV=WORKSIZE,SP=0       GET SAVEAREA + WORKAREA
         ST    R1,SAVENEW-SAVEAREA(,R13)  FORWARD POINTER TO OLD AREA
         ST    R13,SAVEOLD-SAVEAREA(,R1)  BACKWARD POINTER TO NEW AREA
         LR    R13,R1                     SETUP SAVEAREA POINTER
*
*        SET UP BASE REGISTERS
*
         LA    R9,DX01PRMS                PICK UP LIST OF PARMS
LINKTO   L     R1,0(,R9)                  PICK UP PARAMETER ADD VECTOR
         LTR   R1,R1
         BZ    GOAWAY
         L     R2,4(,R9)                  PICK UP CONNECT PARMS
         L     R3,0(,R2)                  PICK UP USER
         MVC   MYUSER(9),0(R3)            CHANGE USER
         L     R3,4(,R2)                  PICK UP GROUP
         MVC   MYGROUP(9),0(R3)           CHANGE GROUP
         L     R3,8(,R2)                  PICK UP AUTH
         MVC   MYAUTH(1),0(R3)            CHANGE AUTH
         LINK  EP=RDX01V01
         ST    15,WORD
         UNPK  RET15(3),WORD+3(2)
         TR    RET15(2),HEXTAB-240
         MVC   WTOLIST(WTOLISTL),WTOPROTO
         MVC   MSG1(MSG1LGTH),MSG1PRTO
         MVC   MSG1RETC,RET15+1
         MVC   WTOLIST+4(MSG1LGTH),MSG1
         WTO   MF=(E,WTOLIST)
         LA    R9,8(,R9)
         B     LINKTO
         SPACE
GOAWAY   ABEND 999,DUMP
NORACF   DS    0H
         WTO   '*** WARNING *** RACF NOT ACTIVE - ACCESS ALLOWED',     X
               ROUTCDE=(9,11)
         LA    R15,8                      RACF IS NOT ACTIVE
         EJECT
PLUGR15  DS    0H
         LR    R1,R13            SAVE NEW SAVEAREA ADR FOR FREEMAIN
         L     R13,SAVEOLD                OLD SAVEAREA
         ST    R15,SAVER15       PLUG (R15) FOR RESTORE (R14-R12)
*
*        FREEMAIN NEW SAVEAREA AND RETURN TO CALLER
*
         FREEMAIN R,A=(1),LV=WORKSIZE,SP=0 FREE UP NEW SAVEAREA
         XC    SAVENEW,SAVENEW            BREAK CHAIN
         LM    R14,R12,SAVER14            RESTORE REGS
         BR    R14                        BACK TO MOTHER
         DROP  ,                          DROP EVERYTHING
         EJECT
*
*        PARAMETER LISTS ECT.
*
DX01PRMS DS    0F
         DC    A(DX01PARM),A(CONNECT1)
*        DC    A(DX02PARM),A(CONNECT1)
*        DC    A(DX03PARM),A(CONNECT1)
*        DC    A(DX04PARM),A(CONNECT1)
*        DC    A(DX05PARM),A(CONNECT1)
*        DC    A(DX06PARM),A(CONNECT1)
*        DC    A(DX07PARM),A(CONNECT1)
*        DC    A(DX08PARM),A(CONNECT2)
*        DC    A(DX09PARM),A(CONNECT3)
         DC    A(0),A(0)
CONNECT1 DC    A(TUSER1),A(TGROUP1),A(TAUTH1)
TUSER1   DC    AL1(6),CL8'U02001'
TGROUP1  DC    AL1(4),CL8'G020'
TAUTH1   DC    X'80'
CONNECT2 DC    A(TUSER2),A(TGROUP2),A(TAUTH2)
TUSER2   DC    AL1(7),CL8'L11FOTM'
TGROUP2  DC    AL1(6),CL8'G00106'
TAUTH2   DC    X'80'
CONNECT3 DC    A(TUSER3),A(TGROUP3),A(TAUTH3)
TUSER3   DC    AL1(7),CL8'L11FOTM'
TGROUP3  DC    AL1(6),CL8'G00106'
TAUTH3   DC    X'10'
DX01PARM DS    0F
DX01WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX01FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX01INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX01ENTY DC    A(ENTITY1)          ADDRESS OF ENTITY NAME
DX01OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX01VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX01CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX01MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX01MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX01FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX01NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX01FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX01PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX01ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
DX02PARM DS    0F
DX02WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX02FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX02INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX02ENTY DC    A(ENTITY2)          ADDRESS OF ENTITY NAME
DX02OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX02VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX02CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX02MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX02MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX02FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX02NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX02FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX02PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX02ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
DX03PARM DS    0F
DX03WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX03FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX03INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX03ENTY DC    A(ENTITY3)          ADDRESS OF ENTITY NAME
DX03OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX03VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX03CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX03MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX03MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX03FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX03NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX03FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX03PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX03ACEE DC    A(ACEE)             ADDRESS OF ACEE PASSED FROM SVC
DX04PARM DS    0F
DX04WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX04FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX04INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX04ENTY DC    A(ENTITY4)          ADDRESS OF ENTITY NAME
DX04OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX04VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX04CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX04MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX04MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX04FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX04NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX04FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX04PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX04ACEE DC    A(ACEE)             ADDRESS OF ACEE PASSED FROM SVC
DX05PARM DS    0F
DX05WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX05FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX05INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX05ENTY DC    A(ENTITY5)          ADDRESS OF ENTITY NAME
DX05OLDV DC    A(0)                ADDRESS OF OLD VOLSER
DX05VOLN DC    A(0)                ADDRESS OF VOLSER
DX05CLAS DC    A(CLASS2-1)         ADDRESS OF CLASS NAME
DX05MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX05MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX05FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX05NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
DX05FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX05PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX05ACEE DC    A(ACEE)             ADDRESS OF ACEE PASSED FROM SVC
DX06PARM DS    0F
DX06WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX06FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX06INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX06ENTY DC    A(ENTITY1)          ADDRESS OF ENTITY NAME
DX06OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX06VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX06CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX06MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX06MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX06FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX06NAMC DC    A(NAMC2)            ADDRESS OF NAMING CONV. PARM. LIST
DX06FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX06PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX06ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
DX07PARM DS    0F
DX07WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX07FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX07INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX07ENTY DC    A(ENTITY7)          ADDRESS OF ENTITY NAME
DX07OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX07VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX07CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX07MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX07MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX07FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX07NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX07FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX07PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX07ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
DX08PARM DS    0F
DX08WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX08FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX08INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX08ENTY DC    A(ENTITY8)          ADDRESS OF ENTITY NAME
DX08OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX08VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX08CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX08MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX08MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX08FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX08NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX08FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX08PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX08ACEE DC    A(ACEE)             ADDRESS OF ACEE PASSED FROM SVC
DX09PARM DS    0F
DX09WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF # WORDS
DX09FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
DX09INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
DX09ENTY DC    A(ENTITY9)          ADDRESS OF ENTITY NAME
DX09OLDV DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
DX09VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
DX09CLAS DC    A(CLASS-1)          ADDRESS OF CLASS NAME
DX09MENT DC    A(MENTITY)          ADDRESS OF MODEL ENTITY
DX09MVOL DC    A(MVOL)             ADDRESS OF MODEL VOLSER
DX09FLG2 DC    A(FLAG2)            ADDRESS OF MODEL FLAG2
DX09NAMC DC    A(NAMC)             ADDRESS OF NAMING CONV. PARM. LIST
DX09FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
DX09PROF DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
DX09ACEE DC    A(ACEE)             ADDRESS OF ACEE PASSED FROM SVC
NAMC     DS    0F
         DC    A(#WORDS2)          ADDRESS OF # WORDS
         DC    A(FUNCT)            ADDRESS OF FUNCTION
         DC    A(AUTH)             ADDRESS OF AUTHORITY
         DC    A(ENTITY1-1)        ADDRESS OF RESOURCE NAME
         DC    A(OENTITY-1)        ADDRESS OF OLD NAME
         DC    A(VOLSER-1)         ADDRESS OF VOLSER
         DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
         DC    A(CLASS)            ADDRESS OF CLASS
         DC    A(QUAL)             ADDRESS OF QUALIFIER
         DC    A(TYPE)             ADDRESS OF DATA SET TYPE
         DC    A(0)                ADDRESS OF LIST AUTH
         DC    A(0)                ADDRESS OF CPPL
NAMC2    DS    0F
         DC    A(#WORDS2)          ADDRESS OF # WORDS
         DC    A(FUNCT2)           ADDRESS OF FUNCTION
         DC    A(AUTH)             ADDRESS OF AUTHORITY
         DC    A(ENTITY1-1)        ADDRESS OF RESOURCE NAME
         DC    A(OENTITY-1)        ADDRESS OF OLD NAME
         DC    A(VOLSER-1)         ADDRESS OF VOLSER
         DC    A(OLDVOL)           ADDRESS OF OLD VOLSER
         DC    A(CLASS)            ADDRESS OF CLASS
         DC    A(QUAL)             ADDRESS OF QUALIFIER
         DC    A(TYPE)             ADDRESS OF DATA SET TYPE
         DC    A(0)                ADDRESS OF LIST AUTH
         DC    A(0)                ADDRESS OF CPPL
#WORDS1  DC    A(14)
#WORDS2  DC    A(12)
FLAG1    DC    X'00'
FLAG2    DC    X'00'
FLAG3    DC    X'00'
ENTITY1  DC    CL44'A11COP.G02001.CHANGEOD.G0673V00'
ENTITY2  DC    CL44'L11FOD.G00108.CCC'
ENTITY3  DC    CL44'L11FOD.G00108.AAA'
ENTITY4  DC    CL44'L11FOD.TEST.AAA'
ENTITY5  DC    CL6'T00999'
ENTITY7  DC    CL44'L11FOD.A.B.G0001V01'
ENTITY8  DC    CL44'L11FOD.G00108.BBB'
ENTITY9  DC    CL44'L11FOD.G00108.BBB'
MENTITY  DC    CL44'L11FOD.G00106.AAA'
OENTITY  DC    CL44'L11FOD.G00106.DDD'
CLASSL   DC    AL1(7)
CLASS    DC    C'DATASET'
CLASS2   DC    C'TAPEVOL'
VOLSER   DC    C'DMVS66'
OLDVOL   DC    C'      '
MVOL     DC    C'      '
AUTH     DC    X'80'
TYPE     DC    X'01'
QUAL     DC    CL8'A'
FUNCT    DC    X'0201'            DEFINE
FUNCT2   DC    X'0204'            DELETE
HEXTAB   DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
WTOPROTO WTO   '123456789012345678901234567890123456789012345678901234 X
               67890123456789012345678901234567',MF=L,ROUTCDE=(9,11)
WTOLISTL EQU   *-WTOPROTO              LENGTH OF PROTOTYPE WTO LIST
MSG1PRTO EQU   *
         DC    C'RACDEF  - RETURN CODE FROM ICHRDX01 ('
         DC    CL1' '
         DC    C')'
BLANKS   DC    CL44' '
MSG1LGTH EQU   *-MSG1PRTO
WORD     DC    F'0'
RET15    DC    CL3'0'
         SPACE
         LTORG
         EJECT
MYCVT    DS    0F
         DC    A(MYTCBP)
         ORG   *+988
         DC    A(MYRCVT)
*
MYTCBP   DS    0F
         DS    3F
         DC    A(MYASCB)
*
         ORG   *-108
MYASCB   DS    0F
         ORG   *+108
         DC    A(MYASXB)
         ORG   *+64
         DC    A(MYJBNS)
*
         ORG   *-200
MYASXB   DS    0F
         ORG   *+200
         DC    A(MYACEE)
*
MYJBNS   DC    CL8'MYJOBNAM'
*
         ORG   *-153
MYRCVT   DS    0F
         ORG   *+153
MYFLGS   DC    X'00'
         ORG   *+58
MYCSTA   DC    X'00',X'00',X'00',X'01'       +3=X'01' WTO TRACING ON
*
*
MYCAUD   DC    X'00',X'00',X'00',X'01'       +3=X'01' GTF TRACING ON
*
*
MYCPRO   DC    X'00',X'00',X'02',X'03'
*
*
MYACEE   DS    0F
         ORG   *+12
         DC    A(MYIEP)
         DC    A(0)
MYUSER   DC    AL1(7),CL8'L11FOTM'
MYGROUP  DC    AL1(6),CL8'G00106'
         DC    X'00'              FLAG1
         DC    X'BB'              FLAG2
         DC    X'CC'              FLAG3
         ORG   *+15
         DC    X'DD'              FLAG4
ACEE     DS    0F
         ORG   *+12
         DC    A(MYIEP)
         DC    A(0)
         DC    AL1(7),CL8'L11FOTM'
         DC    AL1(6),CL8'G00106'
         DC    X'AA'              FLAG1
         DC    X'BB'              FLAG2
         DC    X'CC'              FLAG3
         ORG   *+15
         DC    X'DD'              FLAG4
MYIEP    DS    A(0)
MYAUTH   DC    X'80',X'80'        AUTH=JOIN & FLAG=OK
         DC    AL2(0)
         EJECT
SAVEAREA DSECT
SAVEPLI  DS    F
SAVEOLD  DS    F
SAVENEW  DS    F
SAVER14  DS    F
SAVER15  DS    F
SAVER0   DS    F
SAVER1   DS    F
SAVER2   DS    F
SAVER3   DS    F
SAVER4   DS    F
SAVER5   DS    F
SAVER6   DS    F
SAVER7   DS    F
SAVER8   DS    F
SAVER9   DS    F
SAVER10  DS    F
SAVER11  DS    F
SAVER12  DS    F
SAVESIZE EQU   *-SAVEAREA
WORKAREA EQU   *                          START OF WORKAREA
WTOLIST  WTO   '1234567890123456789012345678901234567890123456789012345X
               67890123456789012345678901234567',MF=L,ROUTCDE=(9,11)
MSG1     EQU   *
         DC    C'RACDEF  - RETURN CODE FROM ICHRDX01 ('
MSG1RETC DC    CL1' '
         DC    C')'
         DC    CL44' '
WORKSIZE EQU   *-SAVEAREA
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
//LINK.SYSIN DD *
 SETCODE AC(1)
/*

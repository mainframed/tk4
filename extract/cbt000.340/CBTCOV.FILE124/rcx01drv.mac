//LBM01199 JOB ('MVSJES3      ','LFALJMVS1BM1               '),
// 'BILL MCCOY 209',MSGLEVEL=1,PRTY=12,PERFORM=4,
// NOTIFY=U00100,MSGCLASS=T,USER=U00100,PASSWORD=HASP
//*MAIN CLASS=Q96,ORG=RMT40
//*FORMAT PR,DDNAME=SYSPRINT,COPIES=1
//*DIST  PLEASE DELIVER TO BILL MCCOY  _____CUBICLE 209_____
//*DIST  PLEASE DELIVER TO BILL MCCOY  _____CUBICLE 209_____
//*PASSWORD DSN=EP.TESTLIBH,P=XXXX
//ASMLNK PROC RENT=NORENT,MACLIB=DMVS81,EXITO=ICHRCX01
//ASM      EXEC PGM=IFOX00,PARM='LOAD,NODECK,&RENT',
//        REGION=128K,TIME=15
//SYSABEND DD SYSOUT=A
//* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
//*
//* ASSEMBLER OPTIONS HAVE BEEN CHANGED. PLEASE CHECK THE PROGRAMMER'S
//* GUIDE FOR OS/VS-VM 370 ASSEMBLER, PAGES 16-23, GC33-4021
//*
//* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
//SYSPRINT DD SYSOUT=*,DCB=(DUMMY.UTILITY)
//SYSLIB   DD    DSN=SYS1.MACLIB,DISP=SHR,UNIT=DISK,VOL=SER=&MACLIB
//         DD    DSN=U00100.RACF.MACLIB,DISP=SHR
//SYSUT1  DD  UNIT=DISK,SPACE=(CYL,(6,1))
//SYSUT2  DD  UNIT=DISK,SPACE=(CYL,(6,1))
//SYSUT3   DD  UNIT=(SYSDA,SEP=(SYSUT1,SYSUT2,SYSLIB)),                X
//         SPACE=(CYL,(6,1))
//SYSGO    DD  DSN=U00100.NEWRACF.OBJECT(&EXITO),DISP=(OLD,PASS)
//LNK  EXEC PGM=LINKEDIT,TIME=5,REGION=2048K,COND=(5,LT,ASM),
// PARM='SIZE=(912K,128K),NCAL,XREF,LET,LIST,NORENT,REUS'
//SYSPRINT DD SYSOUT=*
//SYSUT1   DD UNIT=DISK,SPACE=(CYL,(5,1))
//SYSLMOD  DD DSN=EP.TESTLIBH(&EXITO),DISP=SHR
//SYSLIN   DD DSN=U00100.NEWRACF.OBJECT(&EXITO),DISP=SHR
//         DD DSN=U00100.NEWRACF.OBJECT(AC1),DISP=SHR
//GO   EXEC PGM=&EXITO,TIME=5,REGION=2048K,COND=(5,LT,ASM)
//STEPLIB  DD DSN=EP.TESTLIBH,DISP=SHR
//SYSUDUMP DD SYSOUT=*
//         PEND
//       EXEC  ASMLNK,EXITO=RCX01DRV
//ASM.SYSIN    DD  *
RCX      TITLE 'RACF EXIT ICHRCX01 - DRIVER ROUTINE'
***********************************************************************
*    NAME:                                                            *
*    PURPOSE:                                                         *
*                                                                     *
***********************************************************************
         EJECT
DRVRCX01 CSECT
*
*        SETUP SAVEAREA AND SAVE CALLER'S REGS
*
         USING DRVRCX01,R15
         B     DRVRCX                     BRANCH AROUND I.D.
         DC    C'DRVRCX01'                CSECT NAME
         DC    C'&SYSDATE'                ASSEMBLY DATE
         DC    C'&SYSTIME'                ASSEMBLY TIME
         USING SAVEAREA,R13
DRVRCX   STM   R14,R12,SAVER14            SAVE REGS
         LR    R12,R15                    SET UP BASE REGISTER
         USING DRVRCX01,R12
         DROP  R15
         LR    R11,R1                     SETUP PARAMETER REGISTER
         GETMAIN R,LV=WORKSIZE,SP=0       GET SAVEAREA + WORKAREA
         ST    R1,SAVENEW-SAVEAREA(,R13)  FORWARD POINTER TO OLD AREA
         ST    R13,SAVEOLD-SAVEAREA(,R1)  BACKWARD POINTER TO NEW AREA
         LR    R13,R1                     SETUP SAVEAREA POINTER
*
*        SET UP BASE REGISTERS
*
         LA    R9,CX01PRMS                PICK UP LIST OF PARMS
LINKTO   L     R1,0(,R9)                  PICK UP PARAMETER ADD VECTOR
         LTR   R1,R1
         BZ    GOAWAY
         LINK  EP=RCX01V01
         ST    15,WORD
         UNPK  RET15(3),WORD+3(2)
         TR    RET15(2),HEXTAB-240
         MVC   WTOLIST(WTOLISTL),WTOPROTO
         MVC   MSG1(MSG1LGTH),MSG1PRTO
         MVC   MSG1RETC,RET15+1
         MVC   WTOLIST+4(MSG1LGTH),MSG1
         WTO   MF=(E,WTOLIST)
         LA    R9,4(,R9)
         B     LINKTO
         SPACE
GOAWAY   ABEND 999,DUMP
NORACF   DS    0H
         WTO   '*** WARNING *** RACF NOT ACTIVE - ACCESS ALLOWED',     X
               ROUTCDE=(9,11)
         LA    R15,8                      RACF IS NOT ACTIVE
         EJECT
PLUGR15  DS    0H
         LR    R1,R13            SAVE NEW SAVEAREA ADR FOR FREEMAIN
         L     R13,SAVEOLD                OLD SAVEAREA
         ST    R15,SAVER15       PLUG (R15) FOR RESTORE (R14-R12)
*
*        FREEMAIN NEW SAVEAREA AND RETURN TO CALLER
*
         FREEMAIN R,A=(1),LV=WORKSIZE,SP=0 FREE UP NEW SAVEAREA
         XC    SAVENEW,SAVENEW            BREAK CHAIN
         LM    R14,R12,SAVER14            RESTORE REGS
         BR    R14                        BACK TO MOTHER
         DROP  ,                          DROP EVERYTHING
         EJECT
*
*        PARAMETER LISTS ECT.
*
CX01PRMS DS    0F
*        DC    A(CX01PARM)
*        DC    A(CX02PARM)
*        DC    A(CX03PARM)
*        DC    A(CX04PARM)
         DC    A(CX05PARM)
*        DC    A(CX06PARM)
*        DC    A(CX07PARM)
         DC    A(0)
CX01PARM DS    0F
CX01WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX01FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX01FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX01FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX01INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX01ENTY DC    A(ENTITY1)          ADDRESS OF ENTITY NAME
CX01CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX01VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX01USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX01WRKA DC    A(WKAREA)           ADDRESS OF WORKAREA BETWEEN EXITS
CX01ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX01RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX01ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX01RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX01OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX01NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX01APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX01ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
CX02PARM DS    0F
CX02WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX02FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX02FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX02FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX02INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX02ENTY DC    A(ENTITY2)          ADDRESS OF ENTITY NAME
CX02CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX02VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX02USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX02WRKA DC    A(0)                ADDRESS OF WORKAREA BETWEEN EXITS
CX02ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX02RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX02ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX02RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX02OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX02NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX02APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX02ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
CX03PARM DS    0F
CX03WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX03FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX03FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX03FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX03INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX03ENTY DC    A(ENTITY3)          ADDRESS OF ENTITY NAME
CX03CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX03VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX03USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX03WRKA DC    A(0)                ADDRESS OF WORKAREA BETWEEN EXITS
CX03ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX03RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX03ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX03RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX03OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX03NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX03APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX03ACEE DC    A(ACEEADR)          ADDRESS OF ACEE PASSED FROM SVC
CX04PARM DS    0F
CX04WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX04FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX04FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX04FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX04INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX04ENTY DC    A(ENTITY4)          ADDRESS OF ENTITY NAME
CX04CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX04VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX04USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX04WRKA DC    A(0)                ADDRESS OF WORKAREA BETWEEN EXITS
CX04ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX04RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX04ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX04RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX04OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX04NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX04APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX04ACEE DC    A(ACEEADR)          ADDRESS OF ACEE PASSED FROM SVC
CX05PARM DS    0F
CX05WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX05FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX05FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX05FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX05INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX05ENTY DC    A(ENTITY5)          ADDRESS OF ENTITY NAME
CX05CLAS DC    A(CLASS2)           ADDRESS OF CLASS NAME
CX05VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX05USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX05WRKA DC    A(WKAREA)           ADDRESS OF WORKAREA BETWEEN EXITS
CX05ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX05RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX05ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX05RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX05OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX05NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX05APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX05ACEE DC    A(0)                ADDRESS OF ACEE PASSED FROM SVC
CX06PARM DS    0F
CX06WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX06FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX06FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX06FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX06INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX06ENTY DC    A(ENTITY6)          ADDRESS OF ENTITY NAME
CX06CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX06VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX06USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX06WRKA DC    A(0)                ADDRESS OF WORKAREA BETWEEN EXITS
CX06ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX06RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX06ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX06RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX06OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX06NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX06APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX06ACEE DC    A(ACEEADR)          ADDRESS OF ACEE PASSED FROM SVC
CX07PARM DS    0F
CX07WORD DC    X'FF',AL3(MYCVT)    ADDRESS OF PARM COUNT IN LIST
CX07FLG1 DC    A(FLAG1)            ADDRESS OF FLAG BYTE 1
CX07FLG2 DC    A(FLAG2)            ADDRESS OF FLAG BYTE 2
CX07FLG3 DC    A(FLAG3)            ADDRESS OF FLAG BYTE 3
CX07INST DC    A(0)                ADDRESS OF INSTALL PARMS FOR USER
CX07ENTY DC    A(ENTITY7)          ADDRESS OF ENTITY NAME
CX07CLAS DC    A(CLASS)            ADDRESS OF CLASS NAME
CX07VOLN DC    A(VOLSER)           ADDRESS OF VOLSER
CX07USRD DC    A(0)                ADDRESS OF USER DATA FROM PROFILE
CX07WRKA DC    A(0)                ADDRESS OF WORKAREA BETWEEN EXITS
CX07ABND DC    A(0)                ADDRESS OF ABEND CODE FROM RACF-SVC
CX07RTRN DC    A(0)                ADDRESS OF RETURN CODE FROM RACF-SVC
CX07ACSS DC    A(AUTH)             ADDRESS OF USERS'S AUTHORITY LEVEL
CX07RSNM DC    A(LEVEL)            ADDRESS OF LEVEL VALUE OF RESOURCE
CX07OLDV DC    A(0)                ADDRESS OF PREVIOUS DEFINED VOLSER
CX07NAMC DC    A(0)                ADDRESS OF NAMING CONV. PARM. LIST
CX07APPL DC    A(0)                ADDRESS OF APPLICATION NAME FROM SVC
CX07ACEE DC    A(0)
ACEEADR  DC    A(ACEE)
FLAG1    DC    X'00'
FLAG2    DC    X'02'
FLAG3    DC    X'00'
ENTITY1  DC    CL44'L11FOD.G001.DATA'
ENTITY2  DC    CL44'A.B.G0001V02'
ENTITY3  DC    CL44'AAAAAA$.B.C'
ENTITY4  DC    CL44'AAAAAA$.B.G0001V02'
ENTITY5  DC    CL44'SYS1.INFOSYST.TESTLIB.COMPCNTR'
ENTITY6  DC    CL44'L11FUR1.TEST01'
ENTITY7  DC    CL44'L11FGR1.TEST01'
CLASS    DC    X'07',C'DATASET'
CLASS2   DC    X'07',C'DATASET'
VOLSER   DC    C'DMVS80'
AUTH     DC    X'80'
LEVEL    DC    X'99'
HEXTAB   DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
WTOPROTO WTO   '123456789012345678901234567890123456789012345678901234 X
               67890123456789012345678901234567',MF=L,ROUTCDE=(9,11)
WTOLISTL EQU   *-WTOPROTO              LENGTH OF PROTOTYPE WTO LIST
MSG1PRTO EQU   *
         DC    C'RACHECK - RETURN CODE FROM ICHRCX01 ('
         DC    CL1' '
         DC    C')'
BLANKS   DC    CL44' '
MSG1LGTH EQU   *-MSG1PRTO
WKAREA   DC    CL256' '
         SPACE
         LTORG
         EJECT
MYCVT    DS    0F
         DC    A(MYTCBP)
         ORG   *+988
         DC    A(MYRCVT)
*
MYTCBP   DS    0F
         DS    3F
         DC    A(MYASCB)
*
         ORG   *-108
MYASCB   DS    0F
         ORG   *+108
         DC    A(MYASXB)
         ORG   *+64
         DC    A(MYJBNS)
*
         ORG   *-200
MYASXB   DS    0F
         ORG   *+200
         DC    A(MYACEE) <<<<<<<<<ACEE ADDRESS<<<<<<<
*
MYJBNS   DC    CL8'MYJOBNAM'
*
         ORG   *-153
MYRCVT   DS    0F
         ORG   *+153
MYFLGS   DC    X'00'          X'80' IF RVARY INACT
         ORG   *+58
MYCSTA   DC    X'00',X'00',X'00',X'01'       +3=X'01' WTO TRACING ON
*
*
MYCAUD   DC    X'00',X'00',X'00',X'01'       +3=X'01' GTF TRACING ON
*
*
MYCPRO   DC    X'00',X'00',X'02',X'03'       +2=X'02' WTO TRACE BIT
*                                            +3=X'01' OPTION A BIT
*                                            +3=X'02' OPTION B BIT
MYACEE   DS    0F
         ORG   *+12
         DC    A(MYIEP)
         DC    A(0)
         DC    AL1(6),CL8'U00901'
         DC    AL1(6),CL8'G009BK '
         DC    X'00'              FLAG1
         DC    X'00'              FLAG2
         DC    X'00'              FLAG3
         ORG   *+15
         DC    X'00'              FLAG4
MYIEP    DS    0F
         DC    AL1(255),AL3(256)
         DC    X'80880007'
         DC    A(0)
         DC    A(0)
         DC    CL8'G009  '
         DC    CL8'REMOTES'
         DC    CL8'G00901'
         DC    CL8'PASSWORD'
         DC    CL8'SYS1'
         DC    CL8'G009BK'
         DC    CL8'G009TS'
ACEE     DS    0F
         ORG   *+12
         DC    X'80',AL3(0)
         DC    A(0)
         DC    AL1(7),CL8'L11FUR1'
         DC    AL1(7),CL8'L11FGR1'
         DC    X'AA'              FLAG1
         DC    X'BB'              FLAG2
         DC    X'CC'              FLAG3
         ORG   *+15
         DC    X'DD'              FLAG4
         EJECT
SAVEAREA DSECT
SAVEPLI  DS    F
SAVEOLD  DS    F
SAVENEW  DS    F
SAVER14  DS    F
SAVER15  DS    F
SAVER0   DS    F
SAVER1   DS    F
SAVER2   DS    F
SAVER3   DS    F
SAVER4   DS    F
SAVER5   DS    F
SAVER6   DS    F
SAVER7   DS    F
SAVER8   DS    F
SAVER9   DS    F
SAVER10  DS    F
SAVER11  DS    F
SAVER12  DS    F
SAVESIZE EQU   *-SAVEAREA
WORKAREA EQU   *                          START OF WORKAREA
WTOLIST  WTO   '1234567890123456789012345678901234567890123456789012345X
               67890123456789012345678901234567',MF=L,ROUTCDE=(9,11)
MSG1     EQU   *
         DC    C'RACHECK - RETURN CODE FROM ICHRCX01 ('
MSG1RETC DC    CL1' '
         DC    C')'
         DC    CL44' '
WORD     DC    F'0'
RET15    DC    CL1'0'
WORKSIZE EQU   *-SAVEAREA
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
/*

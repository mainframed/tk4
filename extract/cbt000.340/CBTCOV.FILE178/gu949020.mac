C          DATA SET GU949020   AT LEVEL 004 AS OF 11/12/79
C          DATA SET GU949020   AT LEVEL 003 AS OF 11/03/79
C          DATA SET GU949020   AT LEVEL 001 AS OF 10/17/79
C              PGM-ID.   GU949020.
C              DATE.     09/28/79.
C              AUTHOR.   DON HIGGINS
C              REMARKS.  THIS IS MAINLINE OF MONITOR WHICH COLLECTS
C                        MVS SYSTEM DATA AT SPECIFIED INTERVALS AND
C                        STORES IT IN A RANDOM ACCESS FILE.
C              REFERENCES.
C                  GC28-0708-0 OS/VS2 DEBUGGING HANDBOOK VOL. 1
C                  GC28-0709-1 OS/VS2 DEBUGGING HANDBOOK VOL. 2
C                  GC28-0710-0 OS/VS2 DEBUGGING HANDBOOK VOL. 3
C                  GC28-0886-0 OS/VS2 MVS PERFORMANCE NOTEBOOK
C                  GC28-0648-2 OS/VS2 TSO GUIDE TO COMMAND PROCESSORS
C                  GC28-0683-1 OS/VS2 SUPR. SERVICES MACRO INSTR.
C                  SY28-0715-1 OS/VS2 SYSTEM LOGIC LIBRARY
C
C              MAINTENANCE.
C
C                  11/03/79 DSH - EXPAND RECORD FOR UCB DATA.
C                  11/11/79 DSH - EXPAND TO 200 UCBS.
C
C
C               FILES.
C
C
C
C
C
C                  FT10F001 - DIRECT ACCESS LOG FILE
C                             (SEE GU949030 FOR LAYOUT)
C
C     FILE DATA
C
      IMPLICIT INTEGER(A-Z)
      DEFINE FILE 10(10000,260,U,IX10)
      INTEGER MAXREC/10000/,MAXWDS/260/,MAXC/1040/
      INTEGER REC(260),LREC(260)
      INTEGER UCB(200),LUCB(200),MAXUCB/200/
      INTEGER FMAST/10/
      INTEGER TLAST/0/,TINTVL/5/
      REAL*8  MODULE/'GU949010'/
      INTEGER ACPU(10),AIO(10),APG(10),MAXAS/10/
      INTEGER LCPU(10),LIO(10),LPG(10)
      INTEGER ECB/0/
      REAL*8 LNAME(10)
      REAL*8 ANAME(10),FNAME(10)/10*' '/
      EQUIVALENCE
     *   (LREC(01),LYYDDD)
     *  ,(LREC(02),LTIME)
     *  ,(LREC(08),LXCOM)
     *  ,(LREC(11),LNAME(1))
     *  ,(LREC(31),LCPU(1))
     *  ,(LREC(41),LIO(1))
     *  ,(LREC(51),LPG(1))
     *  ,(LREC(61),LUCB(1))
      EQUIVALENCE
     *   (REC(01),YYDDD)
     *  ,(REC(02),TIME)
     *  ,(REC(03),IPLDAT)
     *  ,(REC(04),IPLTIM)
     *  ,(REC(05),CURSTC)
     *  ,(REC(06),CURTSO)
     *  ,(REC(07),CURJOB)
     *  ,(REC(08),XCOM)
     *  ,(REC(11),ANAME(1))
     *  ,(REC(31),ACPU(1))
     *  ,(REC(41),AIO(1))
     *  ,(REC(51),APG(1))
     *  ,(REC(61),UCB(1))
C
C     MAINLINE
C
      PM INIT
      DO   WHILE,(ECB.EQ.0)
           PM   UPDATE
      OD
      STOP
C
C     INIT  - SET MODE AND LOAD ASCBS TO BE MONITORED
C
      PENTRY INIT
      CALL SBREAK(ECB)
      CALL NOSTAE
      CALL NOSPIE
      READ(FMAST'1)REC
      TINTVL=REC(1)
      MAXREC=REC(2)
      DO   I=1,MAXAS
           FNAME(I)=ANAME(I)
      OD
      MAXF=1
      DO   I=1,MAXAS
           IF   (FNAME(I).NE.BLANK)MAXF=I
      OD
      PEXIT
C
C     UPDATE
C
      PENTRY UPDATE
      CALL DCALL(MODULE,TLAST,TINTVL*6000,FNAME,REC)
      PM   GETKEY
      WRITE(FMAST'KEY)REC
      PEXIT
C
C     GETKEY - CALCULATE KEY BASED ON YYDDD AND TIME
C
      PENTRY GETKEY
      TMIN=YYDDD*1440+TIME/6000
      TINT=TMIN/TINTVL
      KEY=MOD(TINT,MAXREC-1)+2
      PEXIT
      END

.section UCBSCAN
.ix Programs UCBSCAN
.ix UCB
.sp
UCBFIND is a subroutine for use in an MVS/SP3 or MVS/XA system
for performing UCB lookup functions.  The load module may be found
in the AOST load library.
.sp
This code was acquired from the CBT Mods tape.
.sp
The following chart describes the various functions of UCBFIND:
.fo off;.sp 2
  FUNC×       INPUT DATA                 ×  RETURNED OUTPUT DATA
  CODE×                                  ×
  ----×----------------------------------×-------------------------
   00 ×GENERIC OR ESOTERIC NAME          ×  ALL MATCHING UCBS
   01 ×DEV CLASS+TYPE FOR GENERIC DEVICE ×  ALL MATCHING UCBS
   01 ×DEV CLASS+TYPE FOR ESOTERIC DEVICE×  CURRENTLY NOT SUPPORTED
   02 ×1 COMPLETE VOL-SER                ×  CURRENTLY NOT SUPPORTED
   03 ×FIRST 3 CHARS OF VOL-SER          ×  CURRENTLY NOT SUPPORTED
  -----------------------------------------------------------------
.sp 2
   00   DEVICE SEARCH VIA GENERIC NAME:
            THE EDT IS SEARCHED FOR GENERIC NAME.  IF MATCH FOUND,
    THE COMPLETE MASK (DEVICE CLASS AND DEVICE TYPE) IS RETRIEVED
    FROM THE EDT.  THE NAME IS GENERIC IF THE DEVICE TYPE NOT 00.
    ALL UCBS OF 'THAT DEVICE CLASS' ARE REQUESTED FROM THE SCAN
    SERVICE ROUTINE.  EACH RETRIEVED UCB IS COMPARED WITH THE HELD
    DEVICE TYPE. UCB ADDRESSES OF ALL MATCHES ARE STORED IN THE
    CALLERS STORAGE AREA WITH A COUNT OF THE NUMBER FOUND.

   00   DEVICE SEARCH VIA ESOTERIC NAME:
            THE EDT IS SEARCHED FOR ESOTERIC NAME. IF MATCH FOUND,
    THE COMPLETE MASK (DEVICE CLASS AND DEVICE TYPE) IS RETRIEVED
    FROM THE EDT.  THE NAME IS ESOTERIC IF THE DEVICE TYPE = 00.
    THE SCAN SERVICE ROUTINE CAN NOT BE USED, IEFAB4UV IS UTILIZED
    (PROTECT KEY 1)

   01   DEVICE SEARCH VIA DEVICE CLASS + TYPE FOR GENERIC NAME:
    THE DEVICE IS GENERIC IF THE DEVICE TYPE NOT 00.  ALL UCBS OF
    'THAT DEVICE CLASS' ARE REQUESTED FROM THE SCAN SERVICE ROUTINE
    EACH RETRIEVED UCB IS COMPARED WITH THE HELD DEVICE TYPE. ALL
    MATCHES ARE STORED IN THE CALLER'S STORAGE AREA WITH A COUNT.

   01   DEVICE SEARCH VIA DEVICE CLASS + TYPE FOR ESOTERIC NAME:
    SUPPORTED ONLY UNDER X-A:
    THE DEVICE IS ESOTERIC IF THE DEVICE TYPE = 00.  IEFAB4UV IS
    INVOKED WITH THE UCBTYP AS INPUT REQUESTING A UNIT NAME AS
    OUTPUT (THIS FUNCTION ONLY WORKS UNDER X-A).  IEFAB4UV IS THEN
    REINVOKED WITH THE UNIT NAME AS INPUT. OUTPUT CONSISTS OF THE
    UCBS AND A COUNT OF THEM

    IF ALL THE UCB ADDRESSES DO NOT FIT INTO THE OUTPUT AREA, THE
    CALLER MUST RE-INVOKE THE SUBROUTINE WITH THE SAME REQUEST,
    ''WITHOUT'' CLEARING OUT THE 100 BYTE WORK AREA (INFO IN THAT
    AREA TELLS THE SUBROUTINE WHERE TO CONTINUE PROCESSING UCBS.
      THIS CODE IS NOT COMPLETED



      CMD BUFFER (INPUT) POINTED TO BY CPPL:

    ____________________________________________
    ×   XX    ×XXXXXX×CCCCCCCC×    XXXXXXXX    ×
    ×________________×________×________________×
    ×FUNCTION ×(NOT  × NAME/  ×  ADDRESS OF A  ×
    ×  CODE   × USED)× DEVICE × 2K OUTPUT AREA ×
    ×         ×      ×  TYPE  ×                ×
    ×_________×______×________×________________×

   F  -XX FUNCTION BITS -
    00: GENERIC/ESOTERIC NAME BEING PASSED FOR UCBS
    01: UNITTYP (3010200E) IS BEING PASSED FOR MATCHING UCBS
                (00012000) ESOTERIC DEVICES   WORKS ONLY FOR X-A
    THE FOLLOWING FUNCTIONS ARE NOT SUPPORTED:
    02: 1 COMPLETE VOL-SER IS BEING PASSED FOR MATCHING UCB
    03: FIRST 3 CHARS OF VOL-SER BEING PASSED FOR MATCHING UCBS
      -XXXXXX NOT UTILIZED CURRENTLY
   CL8-GENERIC/ESOTERIC/VOL-SER NAME
      OR:
      -XX DEVICE CLASS
      -XXXXXX NOT UTILIZED FOR FUNCTION=01
   F  -AN ADDRESS OF A 2K STORAGE AREA WHICH THE CALLER IS
       RESPONSIBLE TO GET/FREEMAIN. IT WILL CONTAIN ALL THE OUTPUT
       FROM THE SUBROUTINE. THE BREAKDOWN OF ITS CONTENTS IS:
       -100 BYTE WORK AREA WHICH MUST BE INITIALIZED TO BINARY
           ZEROS 'ONLY' ON THE FIRST CALL TO THIS SUBROUTINE FOR A
           SPECIFIC FUNCTION. FOR SUBSEQUENT ACCESSES 'OF SAME'
           FUNCTION, DO 'NOT' TOUCH THE CONTENTS OF THIS WORK AREA
       -4 BYTES (1 FULLWORD) FOR RETURNED COUNT OF # OF UCBS BEING
            RETURNED. THIS SHOULD BE INITIALIZED TO ZEROS
       -1944 BYTES (486 FULLWORDS) FOR RETURNED UCB ADDRESSES. THIS
           SHOULD BE INITIALIZED TO ZEROS

    RETURN CODE SETTINGS:
    R15 = 00 - ALL UCBS RETURNED
    R15 = 04 - NOT ALL UCBS RETURNED, MUST RETURN FOR THE REST
    R15 = 08 - NO UCBS FOUND
    R15 = 16 - FUNCTION NOT SUPPORTED
    R15 = 20 - STORAGE NOT AVAIL TO IEFAB4UV FOR UCB LIST
    R15 = 24 - DEVICE TYPE NOT DEFINED TO SYSTEM
    R15 = 28 - NOT ALL UCBS RETURNED, RECODE FOR MORE THAT 486 UCBS
    R15 = 99 - PROBLEM - ABEND PROGRAM
.fo on

.section 'Keyword Validation Macros'
.ix Macros KEYVAL
.ix Macros KEYT
.ix 'Keyword Validation Macros'
.sp
.subsection 'Keyword Parsing and Validation'

   These macros have been designed to provide a generalized keyword
validation service for use by any program module requiring keyword
validation services.  A character string is passed to this routine
containing one or more 'KEYWORD(value)' items seperated by commas or
blanks.  This passed string is matched with a keyword validation table.
The keyword validation table defines what is to occur when a particular
keyword in the table matches with a keyword in the string.  The code
generated by this routine is reentrant and does a getmain.  The
following services may be requested when a keyword match occurs:

   -  Move the keyword values,  if there are any,  to an area designated
      by the  caller.    The  format  of  this  area  is  defined  below
   -  Invoke a user routine  to process a particular  keyword when it is
      found in the character string.
   -  Validate keyword values  found for the  following characteristics:
   -  Numeric only
   -  Alphabetic only
   -  Alphabetic, numeric, and the characters @ # . $ *
   -  Min-max count of number of keyword values specified
   -  Perform the following storage-to-storage operations when a keyword
      is found:
   -  MVC
   -  NC
   -  OC
   -  XC
     This  permits the setting or resetting of flags and the movement of
     data when a particular keyword is found.

The format of the input character string expected to be received by this
routine is as follows:

    llKEYWORD(value,value,...),KEYWORD(value,...) /* Comment */

 -  ll specifies the length of  the input character string  and is a 2
    byte hex field.    The maximum  length which  can be  specified  is
    X'ffff'=65,535.
 -  A keyword cannot be greater than 255 bytes in length.
 -  A keyword  value cannot  be greater  than  255  bytes  in  length.
 -  Keywords may be seperated by one or more blanks or a single comma.
 -  Values may be separated only by commas.    Any  embedded blanks are
    considered as part of the value.
 -  Comments may appear  between any keywords  which are  separated by
    blanks.   Comments must be preceeded  and followed by  at least one
    blank.
 -  The characters  , ) '   cannot  appear in any value unless enclosed
    in single parentheses.   A single parenthesis  can also be given by
    indicating 2 single parentheses in a row.
    Ex: GO('WARN,COLD,''FORMAT''') would indicate a single value
        for the keyword GO and that value would be   WARM,COLD,'FORMAT'
    Ex: GO('(WARM)',COLD,FORMAT)   would  indicate  3  values  for  the
        keyword GO and they would be  (WARM)  COLD  FORMAT  .
 -  The absence  of a  value is  indicated by  a comma  in  the  value
    position, i.e. KEYWORD(value1,,,value4) .

The services of this routine require the specification of 2 macros.  The
1st macro,  KEYVAL,  invokes the  routine and  the second  macro,  KEYT,
defines the keyword validation table.

   KEYVAL   String,           is the address of the character string
                              and may be a symbol or (RX) notation
                              this parameter is required.

            Table,            is the address of the keyword validation
                              table and may be a symbol or (RX) notation
                              this parameter is required.

            PRINT=ON          request the keyword validation routine to
                              be generated with code printed in the
                              assembly listing.
                              This parameter is optional.


   KEYT     keyword,          this parameter designates a keyword which
                              is to be scanned for in the input charac-
                              ter string. This parameter must be
                              specified as a character string.
                              This parameter is required.

            (rtn,parm),       this parameter identifies a routine which
                              is to get control when the above specified
                              keyword has been found in the input char-
                              acter string.  This parameter must be
                              specified as a symbol.  Parm information
                              may be passed at the location specified by
                              by the 2nd positional parameter.  If no
                              parm information needs to be passed to the
                              exit routine then this parameter need not
                              be parenthesized.  This routine will
                              be branched to at the time the keyword is
                              found.  This exit has no limitations as
                              to its ability to request mvs services and
                              can in fact call the keyword validation
                              routine itself if the need arises.  The
                              registers passed to this exit are:
                              R0     address of values string in same
                                     format as defined for 'area' below
                              R1     addr of 'parm' value or zero
                              R13    address of save area which can be
                                     used by 'rtn'
                              R14    return point to keyword validation
                                     routine when 'rtn' is complete
                              R15    entry point address of 'rtn'
                              this parameter is optional.
                              Default : none

            Area,             this parameter specifies the location
                              where value(s) are to be placed when found
                              with the above specified keyword.  This
                              area must be large enough to contain the
                              entire string of expected values for this
                              keyword and will be in the following
                              format:
                              field  len  max  contents
                              nn     1    255  count of value fields
                                               which follow
                            * ll     1    255  length of value string
                           *                   which follows
                       ****
                       *   *
                       *    * vv     ?    255  value string
                       *
                       *
                       *****> ll and vv may appear 255 times in this
                              values character string.   Note that a
                              null value in this string will be defined
                              when ll=0.
                              This parameter must be specified as a
                              symbol and its base reg must contain the
                              correct value when the KEYVAL macro is
                              issued this parameter is optional.
                              Default : none

            Type,             this parameter indicates what type of
                              validation is to be performed upon any
                              values specified with this keyword.  One
                              of 3 types of validation may be requested
                              by this macro:
                              ALPHA        letters only
                              NUMERIC      numbers only
                              ALPHANUM     letters, numbers, and @#.$*
                              This parameter is optional.
                              Default : none

            valcnt,           this parameter defines how many values may
                              be specified with this keyword.  A single
                              number may be specified and indicates the
                              maximum number of values which can be
                              Provided with this keyword. This parameter
                              may also be specified as two subparameters
                              in which case the first subparameter
                              indicates the minimum number of values and
                              The second subparameter indicates the
                              maximum number of parameters which can be
                              Specified with this keyword, i.e. (3,6)
                              Indicates that 3-->6 values can be speci-
                              fied and (3,3) indicates that 3 values
                              must be specified.
                              This parameter is optional.
                              Default : (1,1)

            FIELD1=(value,    the FIELD1 keyword parameter in this macro
                              is used to define whether the input char-
                              acter string keyword values are to be
                              compared for specific values as defined in
                              this parameter and what to do if a values
                              match should occur.  This first subpara-
                              meter defines the character string value
                              which is to be compared for.  If this 1st
                              subparameter is missing then the indicated
                              action is performed upon a successful key-
                              word match only and any specified char-
                              acter string values which do not match
                              subsequently specified 'values' in this
                              keyword parameter will not be considered
                              In error but will be 'filtered' through
                              this keyword parameter entry which has a
                              null 'value' specifiction.  This parameter
                              must be specified as a character string.
                              This parameter is optional.
                              Default : null

            op,               this parameter indicates what type of
                              action should be performed by this routine
                              if the keyword matches and the above value
                              matches or is null.  The action is a stor-
                              age-to-storage operation proceeding in a
                              'from' --> 'to' manner where 'from' and
                              'to' are described below.  The available
                              specifications are:
                              N  and       'from' --> 'to'
                              O  or        'from' --> 'to'
                              M  move      'from' --> 'to'
                              X  ex-or     'from' --> 'to'
                              One of these four symbols must be given
                              for this parameter.  If this parameter
                              is specified 'to' and 'from' must be
                              defined or a macro expansion error occurs.
                              This parameter is required only if 'to'
                              and 'from' are specified.
                              Default : none

            To,               this parameter defines the 'to' field for
                              the above 'op' which was specified.  It
                              must be a symbol and its base reg must
                              contain the correct value when the KEYVAL
                              macro is being issued.  This parameter is
                              only required if 'op' and 'from' are spec-
                              ified.
                              Default : none

            From),            this parameter defines the 'from' field
                              for the above 'op' which was specified.
                              It must be a symbol and its base reg must
                              contain the correct value when the KEYVAL
                              macro is being issued.  This parameter is
                              only required if 'op' and 'to' are spec-
                              ified.
                              Default : none

            FIELD2=           FIELD2 thru FIELD15 are specified in the
            thru              same format as FIELD1.  The keyword vali-
            FIELD15=          dation routine will perform actions of all
                              FIELD1 through FIELD15 parameters which
                              match the specified criteria and will not
                              stop processing when the first FIELDn
                              criteria has been satisfied.  Using this
                              fact you may be able to perform up to 15
                              different operations when the keyword
                              criteria matches. The requested operations
                              are performed for FIELD1 before FIELD2 and
                              for FIELD2 before FIELD3, etc.  Only one
                              FIELDn must match the appropriate criteria
                              for a nonerror return code to be returned.
                              If no FIELDn matches occur with given
                              values then you will get an error rc.
                              (Value,op,from,to) may bespecified up to
                              15 times in FIELD1-FIELD15.

            LEN=(min,max),    this parameter specifies the allowable
                              length of the values which can be spec-
                              ified with this keyword.  Use this para-
                              meter if you know how long a value may be
                              but you dont necessarily know the value
                              itself.  A non-parenthesized parameter
                              indicates that the value must be exactly
                              that size, i.e. LEN=3.
                              Default : none

            END=YES           this parameter designates the end of the
                              validation table and should only be
                              specified on the last KEYT macro.

   Keyword validation routine return codes and exit regs

   Register  0   addr of keyword in char string where validation error
                 Occured.
   Register  1   addr of value in char string where validation error
                 Occured.
   Register 15   return code
                 00     Keyword(s)/value(s) found and op(s) performed
                 04     keyword(s) found, some value not found in KEYT
                 08     a keyword was not found in KEYT.
                 12     'Valcnt' did not pass validation.
                 16     More input expected, i.e. Only blanks, comments,
                        or ),blank was found.  Otherwise rc=00 would
                        have been returned.
                 20     'Type' did not pass validation.
                 24     'Len' did not pass validation.

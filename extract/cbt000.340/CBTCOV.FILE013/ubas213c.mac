000001* STAND 04/02/76
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.    RZ202
000030 AUTHOR.        LINCK FOD/O
000040 DATE-WRITTEN.  OKTOBER 1974.
000050 DATE-COMPILED. OKTOBER 1974.
000060 REMARKS.       LOGDATEI IN ABSTIMMSUMMEN-DATEI EINSPIELEN.
000070     SKIP3
000080 ENVIRONMENT DIVISION.
000090 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.
000110     SELECT D-ASTLOG   ASSIGN UT-S-ASTLOG.
000120     SELECT D-ASTSUM   ASSIGN DA-I-ASTSUM
000130                       ACCESS      IS RANDOM
000140                       NOMINAL KEY IS ASUMNRZ
000150                       RECORD  KEY IS ASUMNR IN S-ASTSUM.
000160     SELECT D-ASTPRINT ASSIGN UT-S-ASTPRINT.
000170     SKIP3
000180 DATA DIVISION.
000190 FILE SECTION.
000200 FD  D-ASTLOG    BLOCK  CONTAINS   0 RECORDS
000210                 RECORD CONTAINS  48 CHARACTERS
000220                 LABEL RECORD STANDARD
000230                 RECORDING MODE F
000240                 DATA RECORD S-ASTLOG.
000250 01  S-ASTLOG COPY ACLOGDF.
000260     SKIP3
000270 FD  D-ASTSUM    BLOCK  CONTAINS   1 RECORDS
000280                 RECORD CONTAINS  92 CHARACTERS
000290                 LABEL RECORD STANDARD
000300                 RECORDING MODE F
000310                 DATA RECORD S-ASTSUM.
000320 01  S-ASTSUM COPY ACSUMDF.
000330     SKIP3
000340 FD  D-ASTPRINT  BLOCK  CONTAINS   0 RECORDS
000350                 RECORD CONTAINS  77 CHARACTERS
000360                 LABEL RECORD STANDARD
000370                 RECORDING MODE F
000380                 DATA RECORD S-ASTPRINT.
000390 01  S-ASTPRINT              PIC X(77).
000400     SKIP3
000410 WORKING-STORAGE SECTION.
000420 01  DATCOPY COPY ACDATDF.
000430 01  FELD-D.
000440     05  WERTN               PIC X(25).
000450     05  SORTZWI.
000460         10  LOGDAT          PIC 9(7).
000470         10  LOGUHR          PIC 9(7).
000480     05  SORTALT             PIC X(14).
000490 01  TAB.
000500     05  TAB1.
000510         10  DAT1.
000520             15  JAHR1       PIC S99             VALUE +0.
000530             15  TAG1        PIC S999            VALUE +0.
000540         10  UHR1            PIC S9(7)   COMP-3  VALUE +0.
000550         10  DAT22.
000560             15  JAHR2       PIC S99             VALUE +0.
000570             15  TAG2        PIC S999            VALUE +0.
000580         10  DAT2        REDEFINES DAT22
000590                             PIC S9(5).
000600         10  UHR2            PIC S9(7)   COMP-3  VALUE +0.
000610         10  ZAE             PIC S9(5)   COMP-3  VALUE +0.
000620     05  TAB2.
000630         10  DAT1.
000640             15  JAHR1       PIC S99             VALUE +0.
000650             15  TAG1        PIC S999            VALUE +0.
000660         10  UHR1            PIC S9(7)   COMP-3  VALUE +0.
000670         10  DAT22.
000680             15  JAHR2       PIC S99             VALUE +0.
000690             15  TAG2        PIC S999            VALUE +0.
000700         10  DAT2        REDEFINES DAT22
000710                             PIC S9(5).
000720         10  UHR2            PIC S9(7)   COMP-3  VALUE +0.
000730         10  ZAE             PIC S9(5)   COMP-3  VALUE +0.
000740 01  UEB.
000750     05  FILLER              PIC X(20)   VALUE '1RZ20201'.
000760     05  FILLER              PIC X(34)   VALUE
000770                 'PROTOKOLL ASTLOG-BEARBEITUNG'.
000780     05  FILLER              PIC X(10)   VALUE '(RZ L 202)'.
000790 01  UEB1.
000800     05  FILLER              PIC X(54)   VALUE SPACES.
000810     05  DATUM               PIC X(10).
000820     05  FILLER              PIC X       VALUE ' '.
000830     05  ZEIT                PIC X(8).
000840 01  ZEILE1.
000850     05  FILLER              PIC X       VALUE '0'.
000860     05  TVAR                PIC X(17).
000870     05  DAT1.
000880         10  TAG1            PIC ZZ9.
000890         10  FILLER          PIC XXX     VALUE '.19'.
000900         10  JAHR1           PIC 99.
000910     05  UHR1                PIC ZZ9,99,99,9.
000920     05  FILLER              PIC X(7)    VALUE '  BIS  '.
000930     05  DAT22.
000940         10  TAG2            PIC ZZ9.
000950         10  FILLER          PIC XXX     VALUE '.19'.
000960         10  JAHR2           PIC 99.
000970     05  UHR2                PIC Z99,99,99,9.
000980     05  ZAE                 PIC Z(6)9.
000990     05  FILLER              PIC X(7)    VALUE ' SAETZE'.
001000 01  ZEILE2.
001010     05  FILLER              PIC X(044)  VALUE
001020                 '0PROGRAMMABBRUCH : LOGDATEI FALSCHER SATZTYP'.
001030 01  ZEILE3.
001040     05  FILLER              PIC X(042)  VALUE
001050                 '0PROGRAMMABBRUCH : SORTIERFOLGE FALSCH'.
001060     EJECT
001070 PROCEDURE DIVISION.
001080 VORUEB.
001090     COPY ACVOR.
001100 VORSPANN.
001110     OPEN INPUT  D-ASTLOG.
001120     OPEN I-O    D-ASTSUM.
001130     MOVE 0 TO RETURN-CODE.
001140     WRITE S-ASTPRINT FROM UEB.
001150     WRITE S-ASTPRINT FROM UEB1.
001160     MOVE ZERO TO SORTALT.
001170* H A U P T T E I L
001180* -----------------
001190 MAIN.
001200     PERFORM LESLOG.
001210     IF  KTYP IN S-ASTLOG = NEU      PERFORM SCHIEBEN    ELSE
001220     IF  KTYP IN S-ASTLOG = WIEDER   PERFORM KORR        ELSE
001230     IF  KTYP IN S-ASTLOG = INIT     PERFORM HINZUF      ELSE
001240     IF  KTYP IN S-ASTLOG = REP      PERFORM KORR        ELSE
001250     IF  KTYP IN S-ASTLOG = DEL      PERFORM DELE        ELSE
001260     IF  KTYP IN S-ASTLOG =  DELPER  PERFORM DEL-PERIODE ELSE
001270     MOVE 8 TO RETURN-CODE
001280     WRITE S-ASTPRINT FROM ZEILE2
001290     GO TO ENDE.
001300     ADD 1 TO ZAE IN TAB1.
001310     MOVE LOGUHR IN S-ASTLOG TO UHR2 IN TAB1.
001320     MOVE LOGDAT IN S-ASTLOG TO DAT2 IN TAB1.
001330     IF  ZAE IN TAB1 = 1
001340         MOVE UHR2 IN TAB1 TO UHR1 IN TAB1
001350         MOVE DAT2 IN TAB1 TO DAT1 IN TAB1.
001360     IF ERR = ZERO
001370         ADD 1 TO ZAE IN TAB2
001380         MOVE LOGUHR IN S-ASTLOG TO UHR2 IN TAB2
001390         MOVE LOGDAT IN S-ASTLOG TO DAT2 IN TAB2
001400         IF  ZAE IN TAB2 = 1
001410             MOVE UHR2 IN TAB2 TO UHR1 IN TAB2
001420             MOVE DAT2 IN TAB2 TO DAT1 IN TAB2.
001430     GO TO MAIN.
001440     SKIP3
001450* A B S C H L U S S
001460* -----------------
001470 ENDE.
001480     CLOSE D-ASTSUM.
001490     CLOSE D-ASTLOG.
001500     MOVE 'LOGDATEI VOM' TO TVAR IN ZEILE1.
001510     MOVE CORRESPONDING TAB1 TO ZEILE1.
001520     WRITE S-ASTPRINT FROM ZEILE1.
001530     MOVE 'VERARBEITET VOM' TO TVAR IN ZEILE1.
001540     MOVE CORRESPONDING TAB2 TO ZEILE1.
001550     WRITE S-ASTPRINT FROM ZEILE1.
001560     CLOSE D-ASTPRINT.
001570     STOP RUN.
001580     EJECT
001590* A U F G E R U F E N E  S E C T I O N S
001600* --------------------------------------
001610     SKIP3
001620 LESLOG SECTION.
001630* LOGDATEI-SATZ LESEN
001640     READ D-ASTLOG AT END GO TO ENDE.
001650     MOVE CORRESPONDING SORTBEGRIFF IN S-ASTLOG  TO  SORTZWI
001660     IF  SORTZWI < SORTALT
001670         WRITE S-ASTPRINT FROM ZEILE3
001680         MOVE 8 TO RETURN-CODE
001690         GO TO ENDE.
001700     MOVE SORTZWI TO SORTALT.
001710     MOVE ZERO TO ERR.
001720     MOVE ASUMNR IN S-ASTLOG TO ASUMNRZ.
001730     SKIP3
001740 HINZUF SECTION.
001750     COPY ACHINZ REPLACING S-ASTKOR BY S-ASTLOG.
001760 DEL-PERIODE SECTION.
001770     COPY ACDLP  REPLACING S-ASTKOR BY S-ASTLOG.
001780     SKIP3
001790     SKIP3
001800 KORR SECTION.
001810* ABSTIMMSUMMENSATZ KORRIGIEREN
001820     PERFORM READSATZ.
001830     IF  ERR NOT = 0
001840         GO TO KORR-E.
001850     COMPUTE NPER-I =
001860                   NPER IN S-ASTSUM + NPER IN S-ASTLOG.
001870     IF  NPER-I < 1
001880         OR NPER-I > NPER IN S-ASTSUM
001890         MOVE 9 TO ERR
001900         GO TO KORR-E.
001910     SET PIX TO NPER-I
001920     MOVE KTYP IN S-ASTLOG  TO FLAG  IN S-ASTSUM (PIX).
001930     MOVE AWERT IN S-ASTLOG TO AWERT IN S-ASTSUM (PIX).
001940     MOVE BERZT IN S-ASTLOG TO BERZT IN S-ASTSUM (PIX).
001950     PERFORM REWRITESATZ.
001960 KORR-E.
001970     EXIT.
001980     SKIP3
001990 DELE SECTION.
002000     COPY ACDELE REPLACING S-ASTKOR BY S-ASTLOG.
002010     SKIP3
002020 SCHIEBEN SECTION.
002030*  AELTESTE PERIODE AUS ASTSUM-SATZ ENTFERNEN UND
002040*  ALS NEUESTE PERIODE DATEN AUS ASTLOG-SATZ EINFUEGEN
002050     PERFORM READSATZ.
002060     IF  ERR > ZERO GO TO SCHIEBEN-E.
002070     MOVE NPER IN S-ASTSUM TO NPER-I.
002080     PERFORM SHIFTDISK
002090         VARYING I FROM 2 BY 1 UNTIL I > NPER-I.
002100     PERFORM CARDTODISK.
002110     PERFORM REWRITESATZ.
002120 SCHIEBEN-E.
002130     EXIT.
002140 SHIFTDISK SECTION.
002150     COMPUTE J = I - 1.
002160     MOVE PERDEF IN S-ASTSUM (I) TO PERDEF IN S-ASTSUM(J).
002170     SKIP3
002180 CARDTODISK SECTION.
002190     COPY ACCTD   REPLACING S-ASTKOR BY S-ASTLOG.
002200     SKIP3
002210 ZEROTODISK SECTION.
002220     COPY ACZTD.
002230     SKIP3
002240 RSHIFT SECTION.
002250     COPY ACRSHIFT.
002260     SKIP3
002270 READSATZ SECTION.
002280     COPY ACSUMRD.
002290     SKIP3
002300 SCHRSUM SECTION.
002310     COPY ACSUMWT.
002320     SKIP3
002330 REWRITESATZ SECTION.
002340     COPY ACSUMRW.
002350     SKIP3
002360 MOVELOG SECTION.
002365 MOVELOG-P.
002370     EXIT.
002380 WRITELOG SECTION.
002385 WRITELOG-P.
002390     EXIT.

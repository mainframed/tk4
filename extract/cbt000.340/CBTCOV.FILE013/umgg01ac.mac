./ ADD NAME=UMGG01AC,LIST=ALL,LEVEL=00,SOURCE=0
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. ANAPCT.
000030 AUTHOR. KHRUHL.
000040 DATE-COMPILED.
000050 REMARKS. PCT-ANALYSE, DRUCKT PCT-LISTE.
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. IBM-370.
000090 OBJECT-COMPUTER. IBM-370.
000091 SPECIAL-NAMES.
000092 INPUT-OUTPUT SECTION.
000093 FILE-CONTROL.
000094     SELECT PCTIN ASSIGN SYS001-S-PCTIN.
000095     SELECT SORTWRK ASSIGN SYS002-S-SORTWK01.
000096     SELECT PCTOT ASSIGN SYS003-S-PCTOT.
000097     SELECT PCTLST ASSIGN SYS006-PRINTER.
000098 I-O-CONTROL.
000099 DATA DIVISION.
000100 FILE SECTION.
000101*
000102 FD  PCTIN,
000103     DATA RECORD PCT-IN-REC
000104     BLOCK 40 RECORDS
000105     LABEL RECORDS STANDARD.
000106 01  PCT-IN-REC.
000107     02 PCTIN-REC.
000108        04 PCTIN-COM       PIC XX.
000109        04 PCTIN-REST      PIC X(70).
000110        04 PCTIN-FILLER    PIC X(8).
000111     02 PCTIN-RED REDEFINES PCTIN-REC PIC X OCCURS 80
000112     INDEXED BY IX-2.
000113*
000114 SD  SORTWRK
000115     DATA RECORD SORT-WRK-REC.
000116 01  SORT-WRK-REC.
000117     02 PCT-SORT.
000118        04 PCT-K1       PIC XXXX.
000119        04 PCT-FILLER   PIC X(6).
000120        04 PCT-K2       PIC X(70).
000121        04 PCT-FILLER   PIC X.
000122*
000123 FD  PCTOT,
000124     DATA RECORD PCT-OT-REC
000125     BLOCK 40 RECORDS
000126     LABEL RECORDS STANDARD.
000127 01  PCT-OT-REC.
000128     02 PCTOT-REC.
000129        04 PCT-TRID     PIC XXXX.
000130        04 PCT-TCLASS   PIC XX.
000131        04 PCT-RTCLASS REDEFINES PCT-TCLASS PIC S99.
000132        04 PCT-SID1     PIC XXXX.
000133        04 PCT-KOM      PIC X(70).
000134        04 PCT-R        PIC X.
000135*
000136*
000137 FD  PCTLST,
000138     DATA RECORD PCT LST-REC
000139     BLOCK 20 RECORDS
000140     LABEL RECORDS OMITTED.
000141 01  PCT-LST-REC.
000142     02 STEUERZEICHEN   PIC X.
000143     02 PCTLST-REC      PIC X(132).
000144 WORKING-STORAGE SECTION.
000145 01  CDATE.
000146     02 CDATUM          PIC X(8).
000147     02 CJULDAT         PIC X(6).
000148     02 CZEIT           PIC X(11).
000149 01  WSYSID             PIC X(4).
000150 01  W-S                PIC X VALUE 'W'.
000151 01  ZZ                 PIC 99   VALUE 75.
000152 01  SZ                 PIC 9(5) VALUE 0.
000153 01  KOPFZB             PIC X(132) VALUE SPACE.
000154 01  KOPFZ1.
000155     02 FILLER          PIC X(23) VALUE ' INPUT CICS TABELLEN :'.
000156     02 CICSID          PIC X(10) VALUE SPACE.
000157     02 FILLER          PIC X(20) VALUE SPACE.
000158     02 FILLER          PIC X(21) VALUE 'P C T - A N A L Y S E'.
000159     02 PCTNAME         PIC X(10)  VALUE SPACE.
000160     02 FILLER          PIC X(8) VALUE 'DATUM: '.
000161     02 KDATUM          PIC X(12).
000162     02 FILLER          PIC X(8) VALUE 'SEITE: '.
000163     02 KSZ             PIC ZZZZ9.
000164 01  KOPFZ11.
000165     02 FILLER          PIC X(15) VALUE ' SORTIERT NACH '.
000166     02 SORTFOLGE       PIC X(8)  VALUE SPACE.
000167     02 FILLER          PIC X(11) VALUE 'CICST = T, '.
000168     02 FILLER          PIC X(11) VALUE 'CICSK = K, '.
000169     02 FILLER          PIC X(11) VALUE 'CICSD = D, '.
000170     02 FILLER          PIC X(11) VALUE 'CLOGA = L, '.
000171     02 FILLER          PIC X(11) VALUE 'CCODB = C, '.
000172     02 FILLER          PIC X(10) VALUE 'CICS = N, '.
000173     02 FILLER          PIC X(9)  VALUE 'SAP = S, '.
000174     02 FILLER          PIC X(11) VALUE 'DFUE1 = F, '.
000175     02 FILLER          PIC X(9)  VALUE 'DFUE2 = F'.
000176 01  KOPFZ3.
000177     02 FILLER          PIC X(14).
000178     02 FILLER          PIC X(17) VALUE ' TRID   TCLASS '.
000179     02 FILLER          PIC X(13) VALUE 'CICS'.
000180     02 FILLER          PIC X(15) VALUE 'K  O  M  M  E'.
000181     02 FILLER          PIC X(11) VALUE 'N  T  A  R'.
000182     02 FILLER          PIC X(10) VALUE SPACE.
000183 01  FUSSZA.
000184     02 FILLER          PIC X(4)  VALUE SPACE.
000185     02 FILLER          PIC X(20) VALUE ' SORT-RET-CODE  :   '.
000186     02 SRC-1           PIC ZZZ9.
000187 01  FUSSZB.
000188     02 FILLER          PIC X(4)  VALUE SPACE.
000189     02 FILLER          PIC X(20) VALUE ' PROG-RET-CODE  :   '.
000190     02 PRC-1           PIC ZZZ9.
000191 01  FUSSZC.
000192     02 FILLER          PIC X(4)  VALUE SPACE.
000193     02 FILLER          PIC X(20) VALUE ' PROGRAMM-ENDE, PROG'.
000194     02 FILLER          PIC X(20) VALUE 'RAMMVERSION VOM :   '.
000195     02 P-D-C           PIC X(8)BX(12).
000196 01  FUSSZD1.
000197     02 FILLER          PIC X(26) VALUE SPACE.
000198     02 FILLER          PIC X(20) VALUE 'ES WURDEN FOLGENDE T'.
000199     02 FILLER          PIC X(20) VALUE 'RANSAKTIONEN PRO TCL'.
000200     02 FILLER          PIC X(13) VALUE 'ASS GEZAEHLT:'.
000201 01  FUSSZD2.
000202     02 FILLER          PIC X(4)  VALUE SPACE.
000203     02 FILLER          PIC X(9)  VALUE 'RINCTR = '.
000204     02 FRINCTR         PIC X(4).
000205     02 FILLER          PIC X(4)  VALUE SPACE.
000206     02 FILLER          PIC X(9)  VALUE 'SIDCTR = '.
000207     02 FSIDCTR         PIC X(4).
000208     02 FILLER          PIC X(4)  VALUE SPACE.
000209     02 FILLER          PIC X(9)  VALUE 'TRCTR  = '.
000210     02 FTRCTR          PIC X(4).
000211     02 FILLER          PIC X(4)  VALUE SPACE.
000212     02 FILLER          PIC X(9)  VALUE 'ZCTR   = '.
000213     02 FZCTR           PIC X(4).
000214     02 FILLER          PIC X(4)  VALUE SPACE.
000215     02 FILLER          PIC X(9)  VALUE 'ROTCTR = '.
000216     02 FROTCTR         PIC X(4).
000217 01  ZEILE1.
000218     02 FILLER          PIC X(14).
000219     02 ZTRID           PIC X(4).
000220     02 FILLER          PIC X(5).
000221     02 ZTCLASS         PIC XX.
000222     02 FILLER          PIC X(5).
000223     02 ZSYSID.
000224        04 ZSID1           PIC X OCCURS 10 INDEXED BY IND-1.
000225     02 ZKOMR           PIC X(80).
000226 01  WTCLASS            PIC XX    VALUE SPACE.
000227 01  WTRID              PIC X(4)  VALUE SPACE.
000228 01  CDATEA             PIC X(20).
000229*
000230*    AUFTEILUNG PCTWRK
000231*
000232*    1  -  4     TRANID
000233*    5  -  6     TCLASS
000234*    7  - 10     SYSIDNT1
000235*   11  - 80     KOMMENTAR
000236*   81           REMOTE KENNZEICHEN
000237*
000238 01  PCTWRKA.
000239     02 PCTWRKX.
000240     04 FILLER          PIC X(6).
000241     04 LSYSID          PIC X(4)     VALUE SPACE.
000242     04 FILLER          PIC X(71).
000243     02 PCTWRKB REDEFINES PCTWRKX PIC X OCCURS 81
000244     INDEXED BY IX-1.
000245 01  PCTWRKC.
000246     02 PCTWRKD         PIC X OCCURS 81 INDEXED BY IX-5.
000247*
000248*    CICS NAMEN
000249*
000250 01  PCTREM             PIC X     VALUE SPACE.
000251*
000252 01  FTSW               PIC X    VALUE '0'.
000253 01  MCTR               PIC 9999 VALUE ZERO.
000254 01  PCTR               PIC 9999 VALUE ZERO.
000255 01  TCTR               PIC 9999 VALUE ZERO.
000256 01  RINCTR             PIC 9999 VALUE ZERO.
000257 01  SIDCTR             PIC 9999 VALUE ZERO.
000258 01  TRCTR              PIC 9999 VALUE ZERO.
000259 01  ZCTR               PIC 9999 VALUE ZERO.
000260 01  ROTCTR             PIC 9999 VALUE ZERO.
000261 01  OT-CTR             PIC 9(6) VALUE ZERO.
000262 01  TOPOFPAGE          PIC 9    VALUE 1.
000263 01  SORT-RC1           PIC S9999 COMP.
000264 01  PRG-RC1            PIC S9999 COMP.
000265 PROCEDURE DIVISION.
000266*
000267*     DIESES PROGRAMM DRUCKT LISTEN DER PROGRAM-CONTROL-TABLES.
000268*     SORTIERT NACH TRID SYSIDNT TCLASS MIT KOMMENTAR.
000269*
000270 ANFANG.
000271     CALL 'FORDAT' USING CDATE.
000272     MOVE CDATUM TO KDATUM.
000273     MOVE SPACE TO PCTWRKA, PCTWRKC, ZEILE1.
000274     OPEN OUTPUT PCTLST.
000275*
000276*     GENERIEREN DER PCT-SAETZE AUS DER PCT-SOURCE,
000277*     SORT NACH TRANS-ID, SYSIDNT.
000278*
000279 PCT-GEN.
000280     SORT,
000281     SORTWRK,
000282     ASCENDING PCT-K1,
000283     DESCENDING PCT-K2,
000284     INPUT PROCEDURE PCT-INPUT,
000285     GIVING PCTOT.
000286     MOVE SORT-RETURN TO SORT-RC1.
000287*
000288*     LISTE NACH TRANSID MIT KOMMENTAR DRUCKEN.
000289*
000290     PERFORM LISTE-PCT THRU LISTE-PCT9.
000291*
000292*     ENDE DES PROGRAMMS.
000293*
000294 PROG-ENDE1.
000295     MOVE WHEN-COMPILED TO CDATEA.
000296     MOVE CDATEA TO P-D-C.
000297     MOVE SORT-RC1 TO SRC-1.
000298     MOVE RETURN-CODE TO PRG-RC1.
000299     MOVE PRG-RC1 TO PRC-1.
000300     WRITE PCT-LST-REC FROM KOPFZB BEFORE PAGE.
000301     WRITE PCT-LST-REC FROM FUSSZA BEFORE 1.
000302     WRITE PCT-LST-REC FROM FUSSZB BEFORE 1.
000303     WRITE PCT-LST-REC FROM FUSSZC BEFORE 1.
000304     MOVE '0000' TO RETURN-CODE.
000305 PROG-ENDE2.
000306     CLOSE PCTLST.
000307     STOP RUN.
000308*
000309*     INPUT PROZEDUR FUER PCT-SORT
000310*
000311 PCT-INPUT SECTION.
000312 PCT-IN1.
000313     OPEN INPUT PCTIN.
000314*
000315*     ERMITTELN MACRO-TYPE
000316*
000317 PCT-IN2.
000318     READ PCTIN AT END PERFORM PCT-IN8
000319                         GO TO PCT-IN9.
000320     MOVE ZERO TO TCTR PCTR MCTR.
000321     INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'DFHPCT'.
000322     IF TCTR > 0
000323        MOVE ZERO TO TCTR
000324        INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'TYPE=ENTRY'.
000325     IF TCTR = 0
000326        INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'TYPE=REMOTE'
000327        IF TCTR = 1 MOVE 'R' TO PCTREM.
000328     IF TCTR > 0
000329        PERFORM PCT-IN8
000330        MOVE 'N' TO W-S.
000331     PERFORM PCT-IN5.
000332     GO TO PCT-IN2.
000333*
000334*     ERMITTELN PARAMETER-TYPE
000335*
000336 PCT-IN5.
000337*    UEBERTRAGE WSYSID
000338     MOVE ZERO TO TCTR PCTR.
000339     IF PCTIN-COM = '*W'
000340        MOVE PCTIN-REST TO WSYSID
000341        PERFORM SYSIDZ
000342        IF LSYSID = SPACE MOVE WSYSID TO LSYSID.
000343*    UEBERTRAGE KOMMENTAR
000344     IF PCTIN-COM = '*C'
000345        MOVE 70  TO PCTR
000346        SET IX-2 TO 72
000347        SET IX-5 TO 80
000348        PERFORM PCT-IN75.
000349*    UEBERTRAGE TRANSACTION-ID
000350     MOVE ZERO TO TCTR PCTR.
000351     INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'TRANSID='
000352        REPLACING FIRST 'TRANSID=' BY '$$$$$$$$'.
000353     IF TCTR > 0
000354        EXAMINE PCTIN-REC TALLYING UNTIL FIRST '$'
000355        SET IX-2 TO TALLY
000356        SET IX-2 UP BY 8
000357        SET IX-1 TO 4
000358        PERFORM PCT-IN7 THRU PCT-IN70
000359        INSPECT PCTIN-REC REPLACING FIRST '$$$$$$$$'
000360        BY 'TRANSID='.
000361*    UEBERTRAGE PROGRAM-FUNCTION-KEY
000362     MOVE ZERO TO TCTR PCTR.
000363     INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'TASKREQ='
000364        REPLACING FIRST 'TASKREQ=' BY '$$$$$$$$'.
000365     IF TCTR > 0
000366        EXAMINE PCTIN-REC TALLYING UNTIL FIRST '$'
000367        SET IX-2 TO TALLY
000368        SET IX-2 UP BY 8
000369        SET IX-1 TO 4
000370        PERFORM PCT-IN7 THRU PCT-IN70
000371        INSPECT PCTIN-REC REPLACING FIRST '$$$$$$$$'
000372        BY 'TASKREQ='.
000373*    UEBERTRAGE TCLASS
000374     MOVE ZERO TO TCTR PCTR.
000375     INSPECT PCTIN-REC TALLYING TCTR FOR ALL 'TCLASS='
000376        REPLACING FIRST 'TCLASS=' BY '$$$$$$$'.
000377     IF TCTR > 0
000378        EXAMINE PCTIN-REC TALLYING UNTIL FIRST '$'
000379        SET IX-2 TO TALLY
000380        SET IX-2 UP BY 7
000381        SET IX-1 TO 6
000382        PERFORM PCT-IN7 THRU PCT-IN70
000383        INSPECT PCTIN-REC REPLACING FIRST '$$$$$$$' BY 'TCLASS='.
000384*
000385*     ERMITTELN PARAMETERLAENGE
000386*
000387 PCT-IN7.
000388     SET IX-2 UP BY 1.
000389     ADD 1 TO PCTR.
000390     IF PCTIN-RED (IX-2) NOT EQUAL ',' AND ' '
000391        GO TO PCT-IN7.
000392     SET IX-2 DOWN BY 1.
000393     ADD -1 TO PCTR.
000394*
000395*     UEBERTRAGEN PARAMETER IN AUSGABESATZ
000396*
000397 PCT-IN70.
000398     MOVE PCTIN-RED (IX-2) TO PCTWRKB (IX-1).
000399     SET IX-1 IX-2 DOWN BY 1.
000400     ADD 1 TO MCTR.
000401     IF MCTR < PCTR GO TO PCT-IN70.
000402     MOVE ZERO TO TCTR MCTR PCTR.
000403 PCT-IN75.
000404     MOVE PCTIN-RED (IX-2) TO PCTWRKD (IX-5).
000405     SET IX-5 IX-2 DOWN BY 1.
000406     ADD 1 TO MCTR.
000407     IF MCTR < PCTR GO TO PCT-IN75.
000408     MOVE ZERO TO TCTR MCTR PCTR.
000409*
000410*     AUSGABE SCHREIBEN WENN MACRO-WECHSEL
000411*
000412 PCT-IN8.
000413     IF W-S = 'N'
000414        MOVE 'W' TO W-S
000415        ADD 1 TO RINCTR OT-CTR
000416        RELEASE SORT-WRK-REC FROM PCTWRKA
000417        MOVE PCTWRKC TO PCTWRKA
000418        MOVE PCTREM TO PCTWRKB (81)
000419        MOVE SPACE TO PCTREM PCTWRKC
000420        MOVE WSYSID TO LSYSID
000421        ELSE
000422        MOVE PCTWRKC TO PCTWRKA.
000423 PCT-IN9.
000424     MOVE ZSYSID TO CICSID
000425     MOVE SPACE TO ZSYSID
000426     SET IND-1 TO 1.
000427     CLOSE PCTIN.
000428 PCT-IN-EXIT.
000429     EXIT.
000430*
000431*     LISTE NACH TRANSID MIT KOMMENTAR DRUCKEN
000432*
000433 LISTE-PCT SECTION.
000434 LISTE-PCT1.
000435     OPEN INPUT PCTOT.
000436     MOVE 'TRID           ' TO SORTFOLGE.
000437 LISTE-PCT2.
000438     READ PCTOT AT END GO TO LISTE-PCT8.
000439     IF PCT-TRID NOT EQUAL ZTRID
000440        PERFORM ZEILENDRUCK
000441        SET IND-1 TO 1
000442        MOVE PCT-TRID TO ZTRID
000443        MOVE PCT-TCLASS TO ZTCLASS
000444        MOVE PCT-KOM TO ZKOMR
000445        PERFORM SYSIDGEN
000446        GO TO LISTE-PCT2.
000447     PERFORM SYSIDGEN.
000448     GO TO LISTE-PCT2.
000449 LISTE-PCT8.
000450     CLOSE PCTOT.
000451 LISTE-PCT9.
000452     EXIT.
000453*
000454*     ZEILENDRUCK ROUTINE
000455*
000456 ZEILENDRUCK SECTION.
000457 ZEILENDR1.
000458     IF FTSW = '0'
000459        MOVE '1' TO FTSW
000460        GO TO ZEILENDR2.
000461     IF ZZ > 65
000462        PERFORM KOPFDRUCK.
000463     MOVE ZEILE1 TO PCTLST-REC.
000464     WRITE PCT-LST-REC BEFORE TOPOFPAGE.
000465     MOVE SPACE TO ZEILE1 PCTLST-REC.
000466     ADD TOPOFPAGE TO ZZ.
000467 ZEILENDR2.
000468     EXIT.
000469*
000470*     KOPFDRUCK ROUTINE
000471*
000472 KOPFDRUCK SECTION.
000473 KOPF1.
000474     MOVE 5    TO ZZ.
000475     ADD  1    TO SZ.
000476     MOVE SZ   TO KSZ.
000477     WRITE PCT-LST-REC FROM KOPFZB BEFORE PAGE.
000478     WRITE PCT-LST-REC FROM KOPFZ1 BEFORE 1.
000479     WRITE PCT-LST-REC FROM KOPFZ11 BEFORE 2.
000480     WRITE PCT-LST-REC FROM KOPFZ3 BEFORE 2.
000481     MOVE SPACE TO PCT-LST-REC.
000482 KOPF2.
000483     EXIT.
000484 SYSIDGEN SECTION.
000485 SYSIDG1.
000486     IF PCT-R = 'R'
000487        GO TO SYSIDG3.
000488     IF PCT-SID1 = 'LOCT'
000489        MOVE 'T' TO ZSID1 (IND-1)
000490        GO TO SYSIDG2.
000491     IF PCT-SID1 = 'CICK'
000492        MOVE 'K' TO ZSID1 (IND-1)
000493        GO TO SYSIDG2.
000494     IF PCT-SID1 = 'DLIT'
000495        MOVE 'D' TO ZSID1 (IND-1)
000496        GO TO SYSIDG2.
000497     IF PCT-SID1 = 'LOGA'
000498        MOVE 'L' TO ZSID1 (IND-1)
000499        GO TO SYSIDG2.
000500     IF PCT-SID1 = 'CODB'
000501        MOVE 'C' TO ZSID1 (IND-1)
000502        GO TO SYSIDG2.
000503     IF PCT-SID1 = 'CICS'
000504        MOVE 'N' TO ZSID1 (IND-1)
000505        GO TO SYSIDG2.
000506     IF PCT-SID1 = 'CSAP'
000507        MOVE 'S' TO ZSID1 (IND-1)
000508        GO TO SYSIDG2.
000509     IF PCT-SID1 = 'DFUE'
000510        MOVE 'F' TO ZSID1 (IND-1)
000511        GO TO SYSIDG2.
000512     IF PCT-SID1 = SPACE
000513        MOVE '&' TO ZSID1 (IND-1)
000514        GO TO SYSIDG2.
000515 SYSIDG2.
000516        SET IND-1 UP BY 1.
000517 SYSIDG3.
000518     EXIT.
000519 SYSIDZ SECTION.
000520 SYSIDZ1.
000521     IF WSYSID = 'LOCT'
000522        MOVE 'T' TO ZSID1 (IND-1)
000523        GO TO SYSIDZ2.
000524     IF WSYSID = 'CICK'
000525        MOVE 'K' TO ZSID1 (IND-1)
000526        GO TO SYSIDZ2.
000527     IF WSYSID = 'DLIT'
000528        MOVE 'D' TO ZSID1 (IND-1)
000529        GO TO SYSIDZ2.
000530     IF WSYSID = 'LOGA'
000531        MOVE 'L' TO ZSID1 (IND-1)
000532        GO TO SYSIDZ2.
000533     IF WSYSID = 'CODB'
000534        MOVE 'C' TO ZSID1 (IND-1)
000535        GO TO SYSIDZ2.
000536     IF WSYSID = 'CICS'
000537        MOVE 'N' TO ZSID1 (IND-1)
000538        GO TO SYSIDZ2.
000539     IF WSYSID = 'CSAP'
000540        MOVE 'S' TO ZSID1 (IND-1)
000541        GO TO SYSIDZ2.
000542     IF WSYSID = 'DFUE'
000543        MOVE 'F' TO ZSID1 (IND-1)
000544        GO TO SYSIDZ2.
000545     IF WSYSID = SPACE
000546        MOVE '&' TO ZSID1 (IND-1)
000547        GO TO SYSIDZ2.
000548 SYSIDZ2.
000549        SET IND-1 UP BY 1.
000550 SYSIDZ3.
000551     EXIT.

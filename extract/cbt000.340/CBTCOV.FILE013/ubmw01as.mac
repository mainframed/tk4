LNUNITS  CSECT
    COMEIN  REG=YES,RETURN=TERM
     EXTRACT  SECS,FIELDS=COMM
    L  R3,SECS
      L  R3,0(R3)
         OPEN  (PRINT,OUTPUT)
         TM  PRINT+48,X'10'
    BO  OPENOK
    LA  R15,4
   B  TERM
OPENOK EQU *
    LA  R4,16
         L  R4,0(R4)
START EQU *
     L  R5,240(R4)
      LA   R5,0(R5)
     LTR  R5,R5
     BZ  NOTCAM
FIRST NOP SECOND
     MVI  FIRST+1,X'F0'
    TIME DEC
    ST  R1,SECS
    ED  PTRN1(9),SECS
    PUT  PRINT
     MVC  0(133,R1),LINE1
    PUT PRINT
    MVC  0(133,R1),LINE2
   L  R11,0(R5)
      L   R6,1068(R11)
     LH R8,454(R11)
    AR  R6,R8
   CVD  R6,DOUBLE
     ST  R6,STEP
    ED  PTRN2(6),DOUBLE+5
    DP  DOUBLE(8),TWOP(4)
    ED  PTRN3(6),DOUBLE+1
     PUT  PRINT
    MVC  0(133,R1),LINE3
    PUT PRINT
   MVC  PTRN1(9),COPY1
    MVC  PTRN2(6),COPY2
   MVC  PTRN3(6),COPY3
     MVC  0(133,R1),LINE4
    PUT  PRINT
     MVC  0(133,R1),LINE5
    L  R7,X'1A8'(R11)
  LA  R7,82(R7)
    LH  R6,44(R7)
    LA  R10,TABLE
LOOPBO  EQU   *
        CLI   0(R10),X'FF'
        BE    TABEND
        CLC  0(8,R7),0(R10)
    BE  GOTMA
  LA  R7,11(R7)
     BCT  R6,LOOPBO
 SR  R8,R8
      LA    R6,1
  B  PUTIT
GOTMA  L  R8,7(R7)
    L  R8,0(R8)
PUTIT   EQU   *
        ST    R8,8(R10)
        LA    R10,16(R10)
        B     LOOPBO
TABEND  EQU   *
    LA   R10,1
SECOND  EQU *
    BCT  R10,BEGIN
    LA  R10,10
    TIME DEC
    ST  R0,SECS
    MVC  PTRN4(6),COPY4
    ED  PTRN4(6),SECS
     MVC  TIME5(6),PTRN4
BEGIN  EQU  *
      LH   R7,1040(R11)
      M R6,HUND
     D  R6,STEP
       CH  R7,=H'20'
      BL  WARNING
      MVI  W05+1,X'00'
POSIT EQU *
         EX    R7,MOVES
        LA    R7,TABLE
LOOPPR  EQU   *
        CLI   0(R7),X'FF'
        BE    TABOVER
        L     R8,8(R7)
        L     R1,12(R7)
        LTR   R8,R8
        BNZ   CALCIT
        MVC   0(3,R1),STARS
        B     LOOPCT
CALCIT   EQU   *
    LH  R8,26(R8)
       CVD  R8,DOUBLE
      UNPK  0(3,R1),DOUBLE+6(2)
     OI  2(R1),X'F0'
LOOPCT   EQU   *
         LA     R7,16(R7)
         B     LOOPPR
TABOVER  EQU   *
     PUT  PRINT
    MVC  0(133,R1),LINE5
      XC  LINE5(133),LINE5
WAIT  EQU  *
    STIMER  WAIT,BINTVL=TIME
      TM  0(R3),X'40'
       BO  CLOSE
   B  START
NOTCAM  EQU *
    MVI  FIRST+1,X'00'
   B  WAIT
CLOSE   EQU  *
   CLOSE  PRINT
    SR  R15,R15
     B  TERM
WARNING EQU *
W05    NOP  W10
      WTO '*** TCAM LINE UNITS < 20% ***'
    MVI  W05+1,X'F0'
W10  EQU *
   CH R7,=H'10'
     BNL  W15
    WTO '***** VORSICHT ***** TCAM LINE UNITS < 10% ***** VORSICHT **'
W15  EQU *
     B POSIT
   EJECT
MOVES  MVC  LINE5+10(1),STARS
STARS  DC  101C'*'
LINE1 DC C'1'
     DC  10C' '
    DC  C'*** TCAM LINE UNIT AVAILABILITY TRACE ***'
    DC   5C' '
        DC  C'DAY  '
PTRN1 DC X'40202020204B202020'
     DC  62C' '
LINE2  DC C'0'
   DC  54C' '
   DC  C'UNITS AVAILABLE'
    DC  63C' '
LINE3 DC C'0'
    DC   9C' '
    DC  C'0'
     DC    45C' '
PTRN3  DC  X'402020202020'
    DC  44C' '
PTRN2  DC  X'402020202020'
    DC   19C' '
LINE4  DC  10C' '
    DC  10X'4F5C5C5C5C5C5C5C5C5C'
   DC  X'4F'
         DC    C'    BO  FE  MA  TI    '
LINE5  EQU   *
TIME5  DC  6C' '
   DC  4C' '
     DC  C'*'
    DC   122C' '
*
DOUBLE  DC  D'0'
SECS  DC  F'0'
TIME  DC  F'500'
PTRN4  DC  X'4020204B2020'
COPY1 DC X'40202020204B202020'
COPY2  DC  X'402020202020'
COPY3  DC  X'402020202020'
COPY4  DC  X'4020204B2020'
HUND  DC  F'100'
TWOP  DC  PL4'2'
STEP  DC  F'0'
TABLE    DS    0F
         DC    CL8'IBO1A000',AL4(0),AL4(LINE5+114)
         DC    CL8'IFE1A000',AL4(0),AL4(LINE5+118)
         DC    CL8'IMA1A000',AL4(0),AL4(LINE5+122)
         DC    CL8'ITI1A000',AL4(0),AL4(LINE5+126)
         DC    X'FF'
PRINT DCB DDNAME=PRINT,DSORG=PS,MACRF=(PL),LRECL=133,RECFM=FBA,        *
               BLKSIZE=133
      END

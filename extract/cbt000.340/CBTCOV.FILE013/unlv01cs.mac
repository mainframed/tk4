 ./        ADD   NAME=INVENTAR,LIST=ALL
         PRINT OFF
         MACRO
&NAME    TACLOSE
&NAME    CLOSE (INVDATEI)
         DEQ   (MAJOR,MINOR,,SYSTEM),RET=HAVE
         MEND
         MACRO
&NAME    TAOPEN &TYP
         AIF   ('&TYP' NE 'WRITE').A1
&NAME    ENQ   (MAJOR,MINOR,E,,SYSTEM),RET=NONE
         MODCB ACB=INVDATEI,MACRF=(OUT)
         OPEN  (INVDATEI)
         MEXIT
.A1      AIF   ('&TYP' NE 'READ').A2
&NAME    ENQ   (MAJOR,MINOR,S,,SYSTEM),RET=NONE
         MODCB ACB=INVDATEI,MACRF=(IN)
         OPEN  (INVDATEI)
         MEXIT
.A2      MNOTE 9,'FALSCHER TAOPEN-TYP, ENTWEDER "READ" ODER "WRITE"'
         MEND
         MACRO
&NAME    UPRUF &UP
&NAME    L     15,=A(&UP)
         BALR  14,15
         MEND
         MACRO
&NAME    OUTPUT &F,&L,&P
         LOESCH DRUCKZ,DRUCKZ,C' '      DRUCKZEILE LOESCHEN
         MVC   DRUCKZ+5(132),&F
         LA    R15,5+&L
         STCM  R15,3,DRUCKZ
         AIF   ('&P' EQ '').M5
         MVI   DRUCKZ+4,X'8B'           NEUE SEITE
         AGO   .M6
.M5      ANOP
         MVI   DRUCKZ+4,X'09'           SPACE 1 LINE AFTER PRINTING
.M6      ANOP
         CLI   INVLIST,C'P'
         BNE   @&SYSNDX.A
         PUT   D001OS99,DRUCKZ
         B     @&SYSNDX.B
@&SYSNDX.A PUT D002OS99,DRUCKZ
@&SYSNDX.B DS  0H
         MEND
         MACRO
&NAME    LOESCH &VON,&BIS,&L
&NAME    MVI   &VON,&L
         MVC   &VON+1(&BIS-&VON+L'&BIS-1),&VON
         MEND
         MACRO
&NAME    LISTDEF &FL
         LCLA  &A,&B
&A       SETA  1
.W1      AIF   (&A GT N'&FL).W2
&B       SETA  &B+1+&FL(&A)
&A       SETA  &A+1
         AGO   .W1
.W2      ANOP
&B       SETA  &B-1
&NAME    DS    0CL&B
&A       SETA  1
.W3      AIF   (&A GT N'&FL).W4
&NAME.&A DS    CL&FL(&A)
         DS    C
&A       SETA  &A+1
         AGO   .W3
.W4      MEND
         MACRO
&N       ISPLINK &P,&R0=*+24,&R4=*+20,&R8=*+16,&R12=*+12,&R16=*+8,     *
               &R20=*+4
         LCLA  &A,&X,&XTAB(100),&Y,&OFFS
         LCLC  &NM,&V
&NM      SETC  '$&SYSNDX'
&A       SETA  N'&P
         AIF   (NOT (&A LT 2)).ELS1000
         MNOTE 8,'&P LESS 2 PARAMETERS'
         MEXIT
.ELS1000 ANOP
&N       DS    0H
         CNOP  0,4
&NM      BAL   1,&NM.A
&X       SETA  1
.THR1001 AIF   (&X GT &A-1).RHT1001
&V       SETC  '&P(&X)'
         AIF   (NOT ('&V'(1,1) NE '''')).ELS1002
         DC    A(&V)
         AGO   .END1002
.ELS1002 ANOP
&XTAB(&X) SETA 1
&OFFS    SETA  4*&A+4+&Y
&Y       SETA  &Y+K'&P(&X)-2
         DC    A(&NM+&OFFS)
.END1002 ANOP
&X       SETA  &X+1
         AGO   .THR1001
.RHT1001 ANOP
&V       SETC  '&P(&X)'
         AIF   (NOT ('&V'(1,1) NE '''')).ELS1003
         DC    X'80',AL3(&V)
         AGO   .END1003
.ELS1003 ANOP
&XTAB(&X) SETA 1
&OFFS    SETA  4*&A+4+&Y
&Y       SETA  &Y+K'&P(&X)-2
         DC    X'80',AL3(&NM+&OFFS)
.END1003 ANOP
&X       SETA  1
.THR1004 AIF   (&X GT &A).RHT1004
         AIF   (NOT (&XTAB(&X) EQ 1)).ELS1005
&V       SETC  '&P(&X)'
         DC    C&V
.ELS1005 ANOP
&X       SETA  &X+1
         AGO   .THR1004
.RHT1004 ANOP
&NM.A    L     15,=V(ISPLINK)
         BALR  14,15
         B     *+4(15)
         B     &R0
         B     &R4
         B     &R8
         B     &R12
         B     &R16
         B     &R20
         MEND
         MACRO
&NAME    DISPLAY &PANEL,&CONTROL,&RETURN,&PRUEF,&ACTION,&PF24
         LCLA  &ANZ
         LCLC  &C
&C       SETC  '&PANEL'.'       '
&C       SETC  '&C'(1,8)
&NAME    CLI   &CONTROL,C'X'
         BNE   *+8(15)
         B     *+28
         B     @&SYSNDX.D               0
         B     &RETURN                  4
         B     &RETURN                  8
         B     &RETURN                  12
         B     &RETURN                  16
         B     &RETURN                  20
@&SYSNDX DS    0H
         AIF   ('&PF24' EQ '').LAB5
         ISPLINK ('VGET','(ZPF24)')
         MVC   ZPF24SAV,ZPF24
         MVC   ZPF24,=CL40&PF24
         ISPLINK ('VPUT','(ZPF24)')
.LAB5    ANOP
         ISPLINK ('DISPLAY','&C',MSGNUM)
         AIF   ('&PF24' EQ '').LAB6
         ST    15,DOWO+4
         MVC   ZPF24,ZPF24SAV
         ISPLINK ('VPUT','(ZPF24)')
         L     15,DOWO+4
.LAB6    ANOP
@&SYSNDX.A DS  0H
         AIF   (0 EQ N'&ACTION).LAB2
         ST    15,DOWO+4
         LOESCH INVZCMD,INVZCMD,C' '
         MVC   DOWO(L'F79),F79
         ISPLINK ('VCOPY','(ZCMD)',DOWO,INVZCMD,'MOVE')
&ANZ     SETA  1
.LAB0    AIF   (&ANZ GT N'&ACTION).LAB1
&C       SETC  '&ANZ'
         CLC   =C&ACTION(&ANZ,1),INVZCMD
         BNE   @&SYSNDX.C&C
         UPRUF &ACTION(&ANZ,2)
         B     @&SYSNDX
@&SYSNDX.C&C DS 0H
&ANZ     SETA  &ANZ+1
         AGO   .LAB0
.LAB1    ANOP
         L     15,DOWO+4
.LAB2    ANOP
         MVC   MSGNUM,=CL8' '
         MVC   MSGFELD,=CL8' '
         C     15,=F'8'
         BE    &RETURN
&ANZ     SETA  1
.LAB3    AIF   (&ANZ GT N'&PRUEF).LAB4
         UPRUF &PRUEF(&ANZ)
         B     @&SYSNDX.B
&ANZ     SETA  &ANZ+1
         AGO   .LAB3
.LAB4    ANOP
         XR    15,15
         B     @&SYSNDX.D
@&SYSNDX.B DS  0H
         AIF   ('&PF24' EQ '').LAB7
         ISPLINK ('VGET','(ZPF24)')
         MVC   ZPF24SAV,ZPF24
         MVC   ZPF24,=CL40&PF24
         ISPLINK ('VPUT','(ZPF24)')
.LAB7    ANOP
         ISPLINK ('DISPLAY',0,MSGNUM,MSGFELD)
         AIF   ('&PF24' EQ '').LAB8
         ST    15,DOWO+4
         MVC   ZPF24,ZPF24SAV
         ISPLINK ('VPUT','(ZPF24)')
         L     15,DOWO+4
.LAB8    ANOP
         B     @&SYSNDX.A
@&SYSNDX.D DS  0H
         MEND
         MACRO
&NAME    D191D &PR=DSCT
         SPACE 2
*---------------------------------------------------------------------
*        DSECT FUER INFO-DATEI
*---------------------------------------------------------------------
         SPACE 2
*  FOLGENDE SATZARTEN SIND IN DER INFO-DATEI:
*  -----------------------------------------
         SPACE 2
*  GEHALTS-TABELLEN-SAETZE:     KENNZEICHEN = 'GH'
*
*  --->  ABTEILUNGS-SAETZE:     'AB'
*  --->  BEREICHS-SAETZE  :     'BE'
*  --->  KOSTSTELLENSAETZE:     'KO'
         SPACE 2
*  TRANID-GRUPPEN-SAETZE  :     KENNZEICHEN = 'GR'
         SPACE 2
*  TRANSAKTIONS-SAETZE    :     KENNZEICHEN = 'TR'
         SPACE 2
*  INFORMATIONS-SAETZE    :     KENNZEICHEN = 'DATUMS-KOMPLEMENT'
         SPACE 5
&NAME    DSECT
         SPACE 2
&PR.REC  DS    0CL90                 GESAMT-SATZ
         SPACE 2
&PR.KEY  DS    CL11                  SCHLUESSEL-FELD
&PR.DATA DS    CL79                  DATEN-TEIL
         EJECT
*----------------------------------------------------------------------
*              GEHALTS-TABELLENSAETZE
*----------------------------------------------------------------------
         SPACE 2
         ORG   &PR.KEY               SCHLUESSELFELD
         SPACE 1
&PR.KZGH DS    CL2                   KENNZEICHEN KONST. 'GH'
&PR.FIRM DS    CL2                   FIRMA Z. ZT. '00'
&PR.KZSA DS    CL2                   SATZKENNZEICHEN 'AB','BE','KO'
&PR.NR   DS    CL4                   ABTLG.-, BEREICHS- ODER KOST-NR
         DS    CL1                   UNBELEGT - KONST. BLANK
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
*                                    ---> ABTEILUNGS-SAETZE
*
&PR.BER# DS    CL4                   BEREICHSNUMMER DER ABTEILUNG
&PR.ABTT DS    CL50                  ABTEILUNGSTEXT (BEZEICHNUNG)
&PR.ABTK DS    CL4                   ABTEILUNGS-KURZTEXT
         DS    CL21                  UNBELEGT - KONST. BLANK
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
*                                    ---> BEREICHS-SAETZE
*
         DS    CL4                   UNBELEGT - KONST. BLANK
&PR.BER  DS    0CL50                 BEREICHSTEXT
&PR.BERC DS    CL8                   KONST. 'BEREICH '
&PR.BERT DS    CL42                  BEREICHSBEZEICHNUNG
         DS    CL25                  UNBELEGT - KONST. BLANK
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
*                                    ---> KOSTENSTELLEN-SAETZE
*
&PR.ABT  DS    CL4                   ABTEILUNGSNUMMER DER KOSTENST.
&PR.KOST DS    CL25                  KOSTENSTELLENTEXT (BEZEICHNUNG)
         DS    CL50                  UNBELEGT - KONST. BLANK
         EJECT
*----------------------------------------------------------------------
*              INFORMATIONS-EINTRAEGE
*----------------------------------------------------------------------
         SPACE 2
         ORG   &PR.KEY               SCHLUESSELFELD
         SPACE 1
&PR.DATK DS    CL6                   DATUMSKOMPLEMENT VON JJMMTT
&PR.ENTK DS    CL2                   KOMPLEMENT ENTRY-NUMMER
&PR.REC# DS    CL1                   LFD. SATZ-NUMMER DES EINTRAGS
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
&PR.ENTR DS    CL79                  ENTRY-TEXT DER LFD. NUMMER
         EJECT
*----------------------------------------------------------------------
*              TRANSAKTIONS-SAETZE
*----------------------------------------------------------------------
         SPACE 2
         ORG   &PR.KEY               SCHLUESSELFELD
         SPACE 1
&PR.KZTR DS    CL2                   KZ. TRANSAKTIONSSATZ - KONST. 'TR'
&PR.TRAN DS    CL4                   TRANSAKTIONS-CODE
&PR.TRGR DS    CL4                   ZUGEHOERIG ZU TRANSAKTIONS-GRUPPE
&PR.TRSA DS    CL1                   LFD. SATZ-NUMMER
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
&PR.KZEI DS    CL1                   KZ. EXTERNE (E)/INTERNE(I) TRANID
&PR.TXTT DS    CL74                  TRANSAKTIONS-KLARTEXT
&PR.TR0  DS    0CL4                  KONST. BLANK FALLS NICHT SATZ=0
         DS    CL1                   KONST. BLANK
&PR.PROF DS    CL3                   PROFIL-VERSION BEI SATZ=0
         SPACE 5
*----------------------------------------------------------------------
*              TRANSAKTIONS-GRUPPENSAETZE
*----------------------------------------------------------------------
         SPACE 2
         ORG   &PR.KEY               SCHLUESSELFELD
         SPACE 1
&PR.KZGR DS    CL2                   KZ. GRUPPENSATZ - KONST. 'GR'
&PR.GRP  DS    CL4                   TRANSAKTIONS-GRUPPE
         DS    CL5                   UNBELEGT - KONST. C'00000'
         SPACE 2
         ORG   &PR.DATA              DATENFELD
         SPACE 1
         DS    CL1                   UNBELEGT - KONST. BLANK
&PR.TXTG DS    CL70                  TRANSAKTIONS-GRUPPEN-TEXT
&PR.VABT DS    CL4                   ABTLG-NR VERANTW. FACHABTLG
&PR.VBO  DS    CL4                   ABTLG-NR BETREUENDER BO-BEREICH
         ORG
&PR.ENDE EQU   *                     ENDE DER DSECT
         SPACE 3
&PR.RECL EQU   &PR.ENDE-&NAME        SATZ-LAENGE
         SPACE 2
&SYSECT  CSECT
         MEND
         MACRO
&NAME    D137D &PR=IND
&NAME    DSECT
&PR.KEY  DS    0CL21            X       SCHLUESSEL DER INVENTARDATEI
PRODKZ   DS    CL4              X       PRODUKTGRUPPE
TYP      DS    CL4              X       TYP-NUMMER
MODELL   DS    CL3              X       MODELL-NUMMER
MANR     DS    CL7              X       MASCHINEN-NUMMER
LFDNR    DS    PL3              X       LAUFENDE NUMMER
TYPBEZ   DS    CL30             X       TYPBEZEICHNUNG
HERSTELL DS    CL8              X       HERSTELLER
FEATURE  DS    0CL36                    FEATURE DES PRODUKTES
FANZ     DS    PL2                      FEATURE-ANZAHL
FTYP     DS    CL4              X       FEATURE-TYP
FTYPBEZ  DS    CL30             X       FEATURE-TYPBEZEICHNUNG
         ORG   FEATURE
FEATURES DS    10CL36                   TABELLE DER FEATURES
ECLEVEL  DS    CL3                      EC-LEVEL DES PRODUKTES
INSTKZ   DS    CL1              X       INSTALLATIONS-ZUSTAND
DATLIEF  DS    CL8              X       GEPLANTER LIEFERTERMIN
DATINST  DS    CL8              X       INSTALLATIONSDATUM
DATBEGIN DS    CL8              X       MIETBEGINN/KAUFDATUM
DATENDE  DS    CL8              X       MIETENDE/VERKAUFSDATUM
DATKUEND DS    CL8              X       KUENDIGUNGSDATUM
DATVERLG DS    CL3                      VERLAENGERUNGSZEITRAUM
ABLAGENR DS    CL10             X       MIETSCHEIN-/ABLAGE-NR
BESOKZ   DS    CL1              X       MIETE-KAUF-KENNZEICHEN
WARTKZ   DS    CL1              X       WARTUNGS-KENNZEICHEN
&PR.AKZ  DS    C                        ALLGEM. KENNZEICHEN
KZEIT    DS    CL2                      ANZAHL TAGE KUENDIGUNGSZEIT
TZEIT    DS    CL2                      ANZAHL TAGE TESTZEIT
KZGEW    DS    C                        GEWAEHRLEISTUNG
KZGEB    DS    C                        GEBAEUDELIZENZ
KZINS    DS    C                        INSTALLATIONSLIZENZ
KZZSER   DS    C                        ZENTRALER SERVICE
KZZSEDAT DS    CL8                      ZENTRALER SERVICE DATUM
KZOSER   DS    C                        OERTLICHER SERVICE
KZOSEDAT DS    CL8                      OERTLICHER SERVICE DATUM
KZOUNT   DS    C                        OERTLICHE UNTERSTUETZUNG
KZOUNDAT DS    CL8                      ZENTRALER SERVICE DATUM
KPREIS   DS    CL14             X       KAUFPREIS
         DS    C
ZEITRAUM DS    2CL6             X       GUELTIGKEITSZEITRAUM
MPREIS   DS    CL12             X       ABSCHREIBUNGSRATEN/MIETPREIS
WPREIS   DS    CL12             X       WARTUNGSKOSTEN
KOSTENST DS    CL4              X       KOSTENSTELLE
KOSTENTR DS    CL4              X       KOSTENTRAEGER
&PR.FAKZ DS    CL2                      FIRMENKENNZEICHEN
&PR.ABTL DS    CL4              X       BEZEICHNUNG DER ABTEILUNG
&PR.ORT  DS    CL8              X       INSTALLATIONSORT
&PR.BEN  DS    CL12             X       BENUTZER
&PR.TEL  DS    CL13             X       TELEFON
&PR.CUA  DS    CL5              X       GERAETEADRESSE
&PR.LEIT DS    CL7              X       LEITUNGSNUMMER
&PR.PFLG DS    CL8              X       USERID DES ERSTELLER DES SATZES
&PR.PFLD DS    CL6              X       DATUM DER ERSTELLUNG DES SATZES
&PR.INVN DS    CL10                     INVENTARNUMMER
&PR.AART DS    CL2                      ABSCHREIBUNGSART
&PR.ABAS DS    CL14                     ABSCHREIBUNGSBASIS
&PR.ARAT DS    CL14                     ABSCHREIBUNGSRATE
&PR.ABEG DS    CL8                      ABSCHREIBUNGSBEGINN
&PR.AEND DS    CL8                      ABSCHREIBUNGSENDE
&PR.END  EQU   *
&SYSECT  CSECT
         MEND
         MACRO
         EQUREG
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         MEND
         MACRO
         DDICT &N,&D,&L,&C,&B,&T
         DC    CL8'&N'                  DATA FIELD NAME
         DC    Y(X'&D')                 DATA FIELD DISPLACEMENT
         DC    AL1(&L)                  DATA FIELD LENGTH
         DC    CL1'&C '                 CONTINUATION CHARACTER
         DC    CL24&B                   BEZEICHNUNG
         DC    CL24&T                   TITEL
         MEND
         MACRO
&NAME    CVXP  &VON,&NACH
&NAME    CLC   &VON,=X'80000000'
         BNE   *+14
         ZAP   &NACH,=P'-1'
         B     *+18
         L     R7,&VON
         CVD   R7,DOWO
         ZAP   &NACH,DOWO
         MEND
         MACRO
&NAME    CVPX  &VON,&NACH
&NAME    CP    &VON,=P'-1'
         BNE   *+14
         MVC   &NACH,=X'80000000'
         B     *+18
         ZAP   DOWO,&VON
         CVB   R7,DOWO
         ST    R7,&NACH
         MEND
         MACRO
&NAME    QSORT &EL1,&EL2,&ELL,&SDISPL,&SLNG **** STABREY 30.12.83 ****
*        &EL1     =  ADRESSE DES ERSTEN ELEMENTES
*        &EL2     =  ADRESSE DES LETZTEN ELEMENTES
*        &ELL     =  LAENGE EINES ELEMENTES
*        &SDISPL  =  DISTANZ DES SORTIERFELDES
*        &SLNG    =  LAENGE DES SORTIERFELDES
*
*        ES MUESSEN FOLGENDE RANDBEDINGUNGEN GELTEN:
*        1.  0 < &SDISPL + &SLNG <= &ELL <= 256
*        2.  ANZAHL ELEMENTE <= 16.777.216 = 2**24
*        3.  &EL2 = (ANZAHL ELEMENTE  -  1) * &ELL  +  &EL1
*
*        INITIALISIERUNG
         STM   0,15,$&SYSNDX.S          REGISTER SICHERN
         LA    0,1                      ANZAHL SORT-TEIL-TAB'S = 1
         ST    0,$&SYSNDX.S+4*16
         LA    0,&EL1                   ADRESSE ERSTES ELEMENT
         ST    0,$&SYSNDX.S+4*17
         LA    0,&EL2                   ADRESSE LETZTES ELEMENT
         ST    0,$&SYSNDX.S+4*18
         LA    0,&ELL                   LAENGE EINES TABELLENELEMENTES
         ST    0,$&SYSNDX.S+4*19
         LA    0,&SDISPL                SORTFELDDISPLACEMENT
         ST    0,$&SYSNDX.S+4*20
         LA    0,&SLNG                  SORTIERFELDLAENGE
         ST    0,$&SYSNDX.S+4*21
         BALR  15,0                     BASISREGISTER
         USING *,15
         CLC   $&SYSNDX.S+4*18(4),$&SYSNDX.S+4*17    2 ELEMENTE VORH.?
         BNH   $&SYSNDX.Z               NEIN, FERTIG
         L     1,$&SYSNDX.S+4*19        LAENGE EINES SORT-TAB-ELEMENTES
         L     6,$&SYSNDX.S+4*20        SORTIERFELD-DISPLACEMENT
         L     7,$&SYSNDX.S+4*21        SORTIERFELD-LAENGE
         BCTR  7,0                      WEGEN EX-CLC
         LR    10,1
         BCTR  10,0                     WEGEN EX-XC
*        SORT-TAB VOM STACK LADEN
$&SYSNDX.A L   8,$&SYSNDX.S+4*16        ANZAHL SORT-TEIL-TAB'S
         LTR   8,8                      SORT-TEIL-TAB'S VORHANDEN?
         BZ    $&SYSNDX.Z               NEIN, FERTIG
         BCTR  8,0
         ST    8,$&SYSNDX.S+4*16        1 SORT-TAB WENIGER
         SLL   8,3
         LA    8,$&SYSNDX.S+4*17(8)     ANFANG DES SORT-STACK
         L     2,0(8)                   ANFANG SORT-TAB
         L     5,4(8)                   ENDE SORT-TAB
         LA    13,0(5,1)
         SR    13,2                     LAENGE SORT-TAB
         XR    12,12
         LA    14,0(1,1)
         DR    12,14                    ANZAHL ELEMENTE / 2
         LR    12,1
         MR    12,12                    LAENGE SORT-TAB / 2
         LA    3,0(2,13)                MITTLERES ELEMENT
         LR    4,5                      LETZTES ELEMENT
         CLR   3,4
         BE    $&SYSNDX.H               NUR EIN ELEMENT, NICHT TAUSCHEN
         EX    10,$&SYSNDX.J            ELEMENTE AUSTAUSCHEN
         EX    10,$&SYSNDX.K
         EX    10,$&SYSNDX.J
$&SYSNDX.H LR  3,2                      UNTERER TEILPUNKT
         LR    4,5                      OBERER TEILPUNKT
         LA    11,0(6,3)
         LA    12,0(6,4)
*        AUFTEILEN EINER SORT-TAB
$&SYSNDX.B CLR 3,4                      SORT-TAB GETEILT?
         BE    $&SYSNDX.F               JA
         EX    7,$&SYSNDX.I
         BNL   $&SYSNDX.C               AUSTAUSCHEN
         AR    3,1                      1 ELEMENT VORWAERTS
         AR    11,1
         B     $&SYSNDX.B
$&SYSNDX.C EX  10,$&SYSNDX.J
         EX    10,$&SYSNDX.K
         EX    10,$&SYSNDX.J
         SR    4,1
         SR    12,1
$&SYSNDX.D CLR 3,4                      SORT-TAB GETEILT?
         BE    $&SYSNDX.F               JA
         EX    7,$&SYSNDX.I
         BNL   $&SYSNDX.E               AUSTAUSCHEN
         SR    4,1                      1 ELEMENT VORWAERTS
         SR    12,1
         B     $&SYSNDX.D
$&SYSNDX.E EX  10,$&SYSNDX.J
         EX    10,$&SYSNDX.K
         EX    10,$&SYSNDX.J
         AR    3,1
         AR    11,1
         B     $&SYSNDX.B
*        TEIL-SORT-TAB AUF DEN STACK, DIE GROESSERE ZUERST
$&SYSNDX.F LR  14,5
         SR    14,4                     LAENGE DER RECHTEN SORT-TAB
         LR    13,3
         SR    13,2                     LAENGE DER LINKEN SORT-TAB
         AR    4,1                      ANFANG DER RECHTEN SORT-TAB
         SR    3,1                      ENDE DER LINKEN SORT-TAB
         CLR   13,14                    LINKE SORT-TAB>RECHTE SORT-TAB?
         BH    $&SYSNDX.G               JA
         CLR   4,5                      RECHTE SORT-TAB LEER?
         BNL   $&SYSNDX.A               JA
         STM   4,5,0(8)
         LA    8,8(8)
         L     9,$&SYSNDX.S+4*16
         LA    9,1(9)
         ST    9,$&SYSNDX.S+4*16
         CLR   2,3                      LINKE SORT-TAB LEER?
         BNL   $&SYSNDX.A               JA
         STM   2,3,0(8)
         LA    8,8(8)
         L     9,$&SYSNDX.S+4*16
         LA    9,1(9)
         ST    9,$&SYSNDX.S+4*16
         B     $&SYSNDX.A               NEUE SORT-TAB BEARBEITEN
$&SYSNDX.G CLR 2,3                      LINKE SORT-TAB LEER?
         BNL   $&SYSNDX.A               JA
         STM   2,3,0(8)
         LA    8,8(8)
         L     9,$&SYSNDX.S+4*16
         LA    9,1(9)
         ST    9,$&SYSNDX.S+4*16
         CLR   4,5                      RECHTE SORT-TAB LEER?
         BNL   $&SYSNDX.A               JA
         STM   4,5,0(8)
         LA    8,8(8)
         L     9,$&SYSNDX.S+4*16
         LA    9,1(9)
         ST    9,$&SYSNDX.S+4*16
         B     $&SYSNDX.A               NEUE SORT-TAB BEARBEITEN
$&SYSNDX.I CLC 0(0,11),0(12)
$&SYSNDX.J XC  0(0,3),0(4)
$&SYSNDX.K XC  0(0,4),0(3)
$&SYSNDX.S DS  65A
$&SYSNDX.Z LM  0,15,$&SYSNDX.S
         DROP  15
         MEND
         MACRO
&NAME    BSUCH &EL1,&EL2,&ELL,&SDISPL,&SLNG,&SUCH **** STABREY 30.12.83
*        &EL1     =  ADRESSE DES ERSTEN ELEMENTES
*        &EL2     =  ADRESSE DES LETZTEN ELEMENTES
*        &ELL     =  LAENGE EINES ELEMENTES
*        &SDISPL  =  DISTANZ DES SORTIERFELDES
*        &SLNG    =  LAENGE DES SORTIERFELDES
*        &SUCH    =  ADRESSE DES SUCHBEGRIFFS
*
*        ES MUSS FOLGENDE RANDBEDINGUNG GELTEN:
*            &EL2 = (ANZAHL ELEMENTE - 1) * &ELL + &EL1
*
*        RETURNCODES :
*        R15 = 0     SUCHBEGRIFF GEFUNDEN, R1 = TAB-ELEMENT-ADRESSE
*        R15 = 4     SUCHBEGRIFF NICHT GEFUNDEN,
*                    R1 = ADRESSE DES NAECHSTHOEHEREN TAB-ELEMENTES
*        R15 = 8     TABELLEN-FORMAT FEHLER
*
*        INITIALISIERUNG
         STM   0,15,$&SYSNDX.S          REGISTER SICHERN
         LA    0,&EL1
         ST    0,$&SYSNDX.S+4*16
         LA    0,&EL2
         ST    0,$&SYSNDX.S+4*17
         LA    0,&ELL
         ST    0,$&SYSNDX.S+4*18
         LA    0,&SDISPL
         ST    0,$&SYSNDX.S+4*19
         LA    0,&SLNG
         ST    0,$&SYSNDX.S+4*20
         LA    0,&SUCH
         ST    0,$&SYSNDX.S+4*21
         BALR  14,0                     BASISREGISTER
         USING *,14
         CLC   $&SYSNDX.S+4*17(4),$&SYSNDX.S+4*16  EIN ELEMENT VORH.?
         BL    $&SYSNDX.W               NEIN, ABBRUCH
         LM    2,7,$&SYSNDX.S+4*16
         LR    13,3                     ENDADRESSE
         SR    13,2                     - ANFANGSADRESSE
         XR    12,12                    WEGEN DR-BEFEHL
         DR    12,4                     / ELEMENTLAENGE
         LTR   12,12                    REST = 0 ?
         BNZ   $&SYSNDX.Z               NEIN, ABBRUCH
         LA    11,1(13)                 R13 = ANZAHL ELEMENTE - 1
         XR    10,10
         BCTR  6,0                      WEGEN EX-CLC
*        BINAERES SUCHEN
$&SYSNDX.A CLR 10,11                    ELEMENT NICHT GEFUNDEN ?
         BE    $&SYSNDX.Y               SO IST ES
         LR    9,11                     INTERVALL HALBIEREN
         SR    9,10
         SRL   9,1                      / 2
         AR    9,10
         LR    13,9
         MR    12,4
         AR    13,2
         AR    13,5
         EX    6,$&SYSNDX.V             SUCHBEGRIFF ? TABELLENELEMENT
         BE    $&SYSNDX.X               SUCHBEGRIFF = TABELLENELEMENT
         BL    $&SYSNDX.B               SUCHBEGRIFF < TABELLENELEMENT
         LA    10,1(9)                  SUCHBEGRIFF > TABELLENELEMENT
         B     $&SYSNDX.A
$&SYSNDX.B LR  11,9
         B     $&SYSNDX.A
$&SYSNDX.S DS  22A
$&SYSNDX.V CLC 0(0,7),0(13)
$&SYSNDX.W LA  15,4
         L     1,$&SYSNDX.S+4*16
         B     $&SYSNDX.X+6
$&SYSNDX.X XR  15,15
         LR    1,13
         SR    1,5
         L     0,$&SYSNDX.S
         B     $&SYSNDX.Z+8
$&SYSNDX.Y LA  15,4
         XR    10,10
         MR    10,4
         LA    1,0(11,2)
         L     0,$&SYSNDX.S
         B     $&SYSNDX.Z+8
$&SYSNDX.Z LA  15,8
         LM    0,1,$&SYSNDX.S
         LM    2,14,$&SYSNDX.S+4*2
         DROP  14
         MEND
         MACRO
         ABTLTAB &ABT,&KOST
         L R8,ADDRKOST+4
         $IF LT
            C R8,ADDRKOST+8
         $THEN
            MVC TABKOSTN-TABKOST(L'TABKOSTN,R8),=C&KOST
            MVC TABKOSTA-TABKOST(L'TABKOSTA,R8),=C&ABT
            LA R8,L'TABKOST(R8)
            ST R8,ADDRKOST+4
            LA R7,4
         $ELSE
            LA R7,0
         $BEND
         MEND
         MACRO
&LABEL   $WHILE &CC
         GBLA  &AG53
         GBLB  &BG53,&BG54
         LCLC  &CL0
&CL0     SETC  '&CC'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,@WHIL(E),(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&CL0' EQ '')).ELS1002
&CL0     SETC  '@@'
         MNOTE 'MISSING OPERAND : @@ IS USED'
.ELS1002 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1003
&LABEL   DS    0H
.ELS1003 ANOP
         $$PUS W,W,N,&CL0
@W&AG53  DS    0H
.ELS1001 ANOP
         MEND
         MACRO
&LABEL   $WHEN &CC
         GBLA  &AG50
         GBLB  &BG54
         GBLC  &CG50,&CG53,&CG56
         LCLA  &AL0
         LCLC  &CL0
&CL0     SETC  '&CC'
&AL0     SETA  &AG50
         $$OUV S,,O,U,V,@WHEN,(Y,G,R)
         AIF   (NOT (&BG54)).ELS1000
         AIF   (NOT ('&CL0' EQ '')).ELS1001
&CL0     SETC  '@@'
         MNOTE 'MISSING OPERAND : @@ IS USED'
.ELS1001 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
&CG50    SETC  '&CG50'(1,&AG50-1).'H'.'&CG56'
&AG50    SETA  &AL0
&CG53    SETC  '@'.'&CL0'
.ELS1000 ANOP
         MEND
         MACRO
&LABEL   $THRU &BEG,&END,&STP
         GBLA  &AG55
         GBLB  &BG53,&BG54
         GBLC  &CG55
         LCLA  &AL1,&AL2,&AL3,&AL4,&AL5
         LCLC  &B,&E,&S,&TE,&TS,&CL0,&CL1,&CL2
&CL0     SETC  '&BEG'
&CL1     SETC  '&END'
&CL2     SETC  '&STP'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,@THRU,(@,T,E,D,R,G,Y,A,X,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
         $$PUS J,J,N
&AL1     SETA  K'&CL0-2
&AL2     SETA  K'&CL1
&AL3     SETA  K'&CL2
         AIF   (NOT (&AL1 EQ 0)).ELS1003
&CL0     SETC  '(@)'
&AL1     SETA  1
         MNOTE 'WRONG OR MISSING FIRST OPERAND : (@) IS USED'
.ELS1003 ANOP
         AIF   (NOT (&AL2 EQ 0)).ELS1004
&CL1     SETC  '@'
&AL2     SETA  1
         MNOTE 'WRONG OR MISSING SECOND OPERAND : @ IS USED'
.ELS1004 ANOP
&CL0     SETC  '&CL0'.'@@@@@@'
&B       SETC  'R'.'&AL1'.'&CL0'(2,8)
&CL1     SETC  '&CL1'.'@@@@@@@'
&AL4     SETA  1
&TE      SETC  'H'
         AIF   (NOT ('&CL1'(1,1) EQ '(' AND '&CL1'(&AL2,1) EQ ')')).ELS*
               1005
&AL2     SETA  &AL2-2
&AL4     SETA  2
&TE      SETC  'R'
.ELS1005 ANOP
&E       SETC  '&TE'.'&AL2'.'&CL1'(&AL4,8)
&CL2     SETC  '&CL2'.'@@@@@@@'
&AL5     SETA  1
&TS      SETC  'D'
         AIF   (NOT (&AL3 GT 0)).ELS1006
&TS      SETC  'H'
         AIF   (NOT ('&CL2'(1,1) EQ '(' AND '&CL2'(&AL3,1) EQ ')')).ELS*
               1007
&AL3     SETA  &AL3-2
&AL5     SETA  2
&TS      SETC  'R'
.ELS1007 ANOP
.ELS1006 ANOP
&S       SETC  '&TS'.'&AL3'.'&CL2'(&AL5,8)
&AG55    SETA  &AG55+30
&CG55    SETC  '&CG55'.'&B'.'&E'.'&S'
.ELS1001 ANOP
         MEND
         MACRO
         $TOR  &CC
         $$OAT &CC,@,@,V,T,@TOR
         MEND
         MACRO
         $THEN
         $$INT I,T,F,@THEN
         MEND
         MACRO
         $OR   &CC
         $$OAT &CC,V,U,O,T,@OR
         MEND
         MACRO
&LABEL   $OFREST
         GBLA  &AG50,&AG52,&AG54
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG54
         LCLC  &L,&L2
         AIF   (NOT (NOT &BG53)).ELS1000
         $$SYN ,@OFREST,(X)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
&CG50    SETC  '&CG50'(1,&AG50-1).'Z'
&L       SETC  '&CG52'(&AG52-3,4)
&L2      SETC  '&CG54'(&AG54-3,4)
         B     @CE&L
@C&L2    DS    0H
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
.ELS1001 ANOP
         MEND
         MACRO
&LABEL   $OF
         GBLA  &AG50,&AG52,&AG53,&AG54
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG54
         LCLA  &AL0,&AL1
         LCLC  &E,&N,&V,&L,&L2,&LN,&S
         AIF   (NOT (NOT &BG53)).ELS1000
         $$SYN ,@OF,(X,F,K,L)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
&S       SETC  '&CG50'(&AG50,1)
         AIF   ('&S'             NE 'X' AND '&S'             NE 'F').O1*
               00210
&L       SETC  '&CG52'(&AG52-3,4)
&L2      SETC  '&CG54'(&AG54-3,4)
&AL0     SETA  N'&SYSLIST
         AIF   (NOT ('&CG50'(&AG50,1) NE 'F')).ELS1003
         B     @CE&L
@C&L2    DS    0H
.ELS1003 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1004
&LABEL   DS    0H
.ELS1004 ANOP
&AG53    SETA  &AG53+1
&LN      SETC  '&AG53'
&CG50    SETC  '&CG50'(1,&AG50-1).'X'
&CG54    SETC  '&CG54'(1,&AG54-4).'&LN'
         AIF   (NOT (&AL0 GT 0)).ELS1005
&E       SETC  '&CG54'(&AG54-15,16)
&V       SETC  '&E'(1,3)               GET CNTRF TYP
&N       SETC  '&E'(4,1)               GET CNTRF LENGTH
&AL1     SETA  &N
&N       SETC  '&E'(5,&AL1)            GET CNTRF NAME
         AIF   (NOT ('&V' EQ 'C  ')).ELS1006
         &V    &N,&SYSLIST(1)
         AGO   .END1006
.ELS1006 ANOP
         &V    &SYSLIST(1),&N
.END1006 ANOP
&AL1     SETA  2
.THR1007 AIF   (&AL1 GT &AL0).RHT1007
         BE    @O&L2
         AIF   (NOT ('&V' EQ 'C  ')).ELS1008
         &V    &N,&SYSLIST(&AL1)
         AGO   .END1008
.ELS1008 ANOP
         &V    &SYSLIST(&AL1),&N
.END1008 ANOP
&AL1     SETA  &AL1+1
         AGO   .THR1007
.RHT1007 ANOP
         BNE   @C&LN
         AIF   (NOT (&AL0 GT 1)).ELS1009
@O&L2    DS    0H
.ELS1009 ANOP
         AGO   .END1005
.ELS1005 ANOP
         MNOTE 'ERROR : NO OPERANDS DEFINED : NO COMPARISON IS         *
               GENERATED : @OFREST-FUNCTION RESULTS'
.END1005 ANOP
         AGO   .ECA1002
.O100210 AIF   ('&S'             NE 'K' AND '&S'             NE 'L').O1*
               00211
&CG50    SETC  '&CG50'(1,&AG50-1).'L'
&LN      SETC  '&CG54'(&AG54-1,2)
&AL0     SETA  &LN+1
&LN      SETC  '&AL0'
&CG54    SETC  '&CG54'(1,&AG54-2).'&LN'
&LN      SETC  '&CG54'(&AG54-5,6)
         AIF   (NOT (&AL0 GT 10)).ELS1010
&N       SETC  '&CG54'(&AG54-5,4)
         B     $&N
.ELS1010 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1011
&LABEL   DS    0H
.ELS1011 ANOP
$&LN     DS    0H
.O100211 ANOP
.ECA1002 ANOP
.ELS1001 ANOP
         MEND
         MACRO
&NAME    $INFO &DD=,&DS=
         LCLA  &ZAHL
         AIF   (NOT ('&NAME' EQ '')).ELS1000
         MNOTE 'NAMENSFELD NICHT VERSORGT, KEINE GENERIERUNG'
         MEXIT
.ELS1000 ANOP
         AIF   (NOT ('&DD' NE '' AND '&DS' NE '')).ELS1001
         MNOTE 'PARAMETERFEHLER, ENTWEDER &&DD ODER &&DS SPEZIFIZIEREN'
         MEXIT
.ELS1001 ANOP
         AIF   (NOT ('&DD' EQ '' AND '&DS' EQ '')).ELS1002
         MNOTE 'PARAMETERFEHLER, ENTWEDER &&DD ODER &&DS SPEZIFIZIEREN'
         MEXIT
.ELS1002 ANOP
         CNOP  0,4
&NAME    BAL   1,$&SYSNDX.C
         DC    AL1(X'80'),AL3(*+3)     REQUEST BLOCK POINTER
         DC    X'14070000'             REQUEST BLOCK
&NAME.ER DC    X'00000000'             ERROR CODE, INFO CODE
         DC    A($&SYSNDX.B)           TEXT POINTERS POINTER
         DC    XL8'00'
         DC    X'000400010008'
&NAME.DD DC    CL8' '
         DC    X'00050001002C'
&NAME.DS DC    CL44' '
         DC    X'000600010008'
&NAME.MB DC    CL8' '
         DC    X'000700010001'
&NAME.ST DC    CL1' '
         DC    X'000800010001'
&NAME.ND DC    CL1' '
         DC    X'000900010001'
&NAME.CD DC    CL1' '
         DC    X'000A00010002'
&NAME.DO DC    CL2' '
         DC    X'000E00010001'
&NAME.DT DC    CL1' '
         AIF   (NOT ('&DD' NE '' AND '&DS' EQ '')).ELS1003
&ZAHL    SETA  K'&DD
         DC    X'00010001',AL2(&ZAHL),C'&DD'
.ELS1003 ANOP
         AIF   (NOT ('&DS' NE '' AND '&DD' EQ '')).ELS1004
&ZAHL    SETA  K'&DS
         DC    X'00020001',AL2(&ZAHL),C'&DS'
.ELS1004 ANOP
$&SYSNDX.B DC  A(&NAME.ER+16)
         DC    A(&NAME.ER+30)
         DC    A(&NAME.ER+80)
         DC    A(&NAME.ER+94)
         DC    A(&NAME.ER+101)
         DC    A(&NAME.ER+108)
         DC    A(&NAME.ER+115)
         DC    A(&NAME.ER+123)
         DC    X'80',AL3(&NAME.ER+130)
$&SYSNDX.C SVC 99
         MEND
         MACRO
&LABEL   $IF   &CC
         GBLB  &BG53,&BG54
         LCLC  &CL0
&CL0     SETC  '&CC'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,@IF,(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&CL0' EQ '')).ELS1002
&CL0     SETC  '@@'
         MNOTE 'MISSING OPERAND : @@ IS USED'
.ELS1002 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1003
&LABEL   DS    0H
.ELS1003 ANOP
         $$PUS I,,N,&CL0
.ELS1001 ANOP
         MEND
         MACRO
         $ELSE
         GBLA  &AG50,&AG52
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG56,&CG57
         LCLC  &L
         $$OUV S,L,O,U,V,$ELSE,(T)
         AIF   (NOT (&BG53 OR &BG54)).ELS1000
&CG50    SETC  '&CG50'(1,&AG50-1).'E'
&L       SETC  '&CG52'(&AG52-3,4)
         B     @I&L
@F&L     DS    0H
         AIF   (NOT ('&CG56' NE '')).ELS1001
         $$GEN F,&CG56,&CG57
.ELS1001 ANOP
.ELS1000 ANOP
         MEND
         MACRO
&NAME    $EXIT &RC=0
         GBLA  &AG50
         GBLB  &BG57
         GBLC  &CG61
         AIF   (NOT (&BG57)).ELS1000
&NAME    LR    1,13
         L     13,4(,13)
         AIF   (NOT ('&CG61'(1,1) GT 'Z')).ELS1001
         FREEMAIN R,LV=72+&CG61*8,A=(1)
.ELS1001 ANOP
         AIF   (NOT ('&RC' NE '')).ELS1002
         LA    15,&RC
         L     14,12(13)
         LM    0,12,20(13)
         AGO   .END1002
.ELS1002 ANOP
         LM    14,12,12(13)
.END1002 ANOP
         BR    14
         AGO   .END1000
.ELS1000 ANOP
&NAME    L     14,0(,13)
         SH    14,2(,10)
         ST    14,0(,13)
         L     10,4(14)
         L     14,0(14)
         AIF   (NOT ('&RC' EQ '')).ELS1003
         BR    14
         AGO   .END1003
.ELS1003 ANOP
         AIF   (NOT ('&RC'(1,1) LT '+' AND '&RC'(1,1) GT '<')).ELS1004
         B     0(14,&RC)
         AGO   .END1004
.ELS1004 ANOP
         B     &RC.(14)
.END1004 ANOP
.END1003 ANOP
.END1000 ANOP
         AIF   (NOT (&AG50 EQ 1)).ELS1005
         LTORG
.ELS1005 ANOP
         MEND
         MACRO
&NAME    $ENTRY &TYP,&STACK=100
         GBLB  &BG57
         GBLC  &CG61
         $$INIT
         AIF   (NOT ('&TYP' EQ 'M')).ELS1000
&BG57    SETB  1
&CG61    SETC  '&STACK'
&NAME    CSECT
         USING &NAME,10
         B     28(,15)
         DC    CL8'&NAME'
         DC    CL8'&SYSDATE'
         DC    CL8'&SYSTIME'
         STM   14,12,12(13)
         LR    10,15
         AIF   (NOT ('&CG61'(1,1) GT 'Z')).ELS1001
         GETMAIN R,LV=72+&CG61*8
         AGO   .END1001
.ELS1001 ANOP
         L     1,=A(&CG61)
.END1001 ANOP
         ST    13,4(,1)                CHAIN SAVE AREA'S
         ST    1,8(,13)
         L     1,24(,13)               RESTORE PARAMETER REGISTER
         L     13,8(,13)               NEW SAVE AREA
         LA    14,72(,13)
         ST    14,0(,13)               STACK POINTER
         AGO   .END1000
.ELS1000 ANOP
&BG57    SETB  0
&NAME    L     15,0(,13)
         ST    14,0(,15)
         ST    10,4(,15)
         BALR  10,0
         USING *,10
         LA    15,8(15)
         ST    15,0(,13)
.END1000 ANOP
         MEND
         MACRO
         $DO
         GBLA  &AG50,&AG51,&AG52,&AG55
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG51,&CG52,&CG55
         LCLC  &L,&E,&X,&Y,&Z
         LCLA  &AL0
         AIF   (NOT ('&CG51'(&AG51,1) EQ 'W')).ELS1000
         $$INT W,D,F,@DO
         AGO   .END1000
.ELS1000 ANOP
         AIF   (NOT (NOT &BG53)).ELS1001
         $$SYN ,@DO,(J)
.ELS1001 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1002
&CG50    SETC  '&CG50'(1,&AG50-1).'D'
&L       SETC  '&CG52'(&AG52-3,4)
&E       SETC  '&CG55'(&AG55-29,30)
&X       SETC  '&E'(2,1)
&AL0     SETA  &X                      GET BEG LENGTH
&Y       SETC  '&E'(3,&AL0)            GET BEG NAME
&X       SETC  '&E'(12,1)
&AL0     SETA  &X                      GET END LENGTH
&Z       SETC  '&E'(13,&AL0)           GET END NAME
&X       SETC  '&E'(11,1)
@J&L     DS    0H
         C&X   &Y,&Z
         BH    @F&L
.ELS1002 ANOP
.END1000 ANOP
         MEND
         MACRO
&LABEL   $CYCLE &REG
         GBLA  &AG53
         GBLB  &BG53,&BG54
         LCLC  &X,&CL0
&CL0     SETC  '&REG'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,$CYCLE,(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
&AG53    SETA  &AG53+1
&X       SETC  'Y'
         AIF   (NOT ('&CL0' NE '')).ELS1003
         AIF   (NOT ('&CL0'(1,1) EQ '(' AND '&CL0'(K'&CL0,1) EQ ')')).E*
               LS1004
&CL0     SETC  '&CL0'(2,K'&CL0-2)
.ELS1004 ANOP
&X       SETC  'G'
@CR&AG53 EQU   &CL0
.ELS1003 ANOP
         $$PUS &X,&X,&AG53
@CY&AG53 DS    0H
.ELS1001 ANOP
         MEND
         MACRO
&LABEL   $CPASS &ROUT,&CT=
         GBLA  &AG53,&AG54
         GBLB  &BG53,&BG54
         GBLC  &CG54
         LCLA  &AL0,&AL1
         LCLC  &CL0
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,$CPASS,(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
&AG53    SETA  &AG53+1
         $$PUS K,,&AG53
&AG54    SETA  &AG54+6
&CG54    SETC  '&CG54'.'&AG53'.'09'
         L     15,=A(&ROUT)
         BALR  14,15
&AL0     SETA  1
.THR1003 AIF   (&AL0 GT &CT).RHT1003
&AL1     SETA  &AL0+9
&CL0     SETC  '$'.'&AG53'.'&AL1'
         B     &CL0
&AL0     SETA  &AL0+1
         AGO   .THR1003
.RHT1003 ANOP
.ELS1001 ANOP
         MEND
         MACRO
&LABEL   $CAS2 &CV
         GBLA  &AG53,&AG54
         GBLB  &BG53,&BG54
         GBLC  &CG54
         LCLA  &AL0,&AL1,&AL2
         LCLC  &E,&V,&CL0
&CL0     SETC  '&CV'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,@CAS2,(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
&AL0     SETA  K'&CL0
         AIF   (NOT (&AL0 EQ 0)).ELS1002
&CL0     SETC  '@'
&AL0     SETA  1
         MNOTE 'CASE-VARIABLE MISSING : @ IS USED'
.ELS1002 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1003
&LABEL   DS    0H
.ELS1003 ANOP
         $$PUS F,,N
&CL0     SETC  '&CL0'.'@@@@@@@'
         AIF   (NOT ('&CL0'(1,1) EQ '(' AND '&CL0'(&AL0,1) EQ ')')).ELS*
               1004
&AL1     SETA  &AL0-2
&AL2     SETA  2
&V       SETC  'C  '
         AGO   .END1004
.ELS1004 ANOP
&AL1     SETA  &AL0
&AL2     SETA  1
&V       SETC  'CLC'
.END1004 ANOP
&AG53    SETA  &AG53+1
&E       SETC  '&V'.'&AL1'.'&CL0'(&AL2,8).'&AG53'
&AG54    SETA  &AG54+16
&CG54    SETC  '&CG54'.'&E'
.ELS1001 ANOP
         MEND
         MACRO
&LABEL   $CASE &REG,&CHECK=OFF
         GBLA  &AG53,&AG54
         GBLB  &BG50,&BG53,&BG54
         GBLC  &CG54
         LCLA  &AL0,&AL1
         LCLC  &CL0
&CL0     SETC  '&REG'
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,$CASE,(@,T,E,D,R,G,Y,A,X,L,Z,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
&AL1     SETA  K'&CL0
         AIF   (NOT (&AL1 EQ 0)).ELS1002
&CL0     SETC  '@'
&AL1     SETA  3
         MNOTE 'REGISTER MISSING : (@) IS USED'
.ELS1002 ANOP
         AIF   (NOT ('&LABEL' NE '')).ELS1003
&LABEL   DS    0H
.ELS1003 ANOP
         AIF   (NOT ('&CL0'(1,1) EQ '(' AND '&CL0'(&AL1,1) EQ ')')).ELS*
               1004
&CL0     SETC  '&CL0'(2,&AL1-2)
.ELS1004 ANOP
&AG53    SETA  &AG53+1
&AL0     SETA  &AG53
         AIF   (NOT (&BG50 OR '&CHECK' NE 'OFF')).ELS1005
         $$CHE &CL0,@A&AL0
.ELS1005 ANOP
         $$PUS C,,&AL0
&AG54    SETA  &AG54+2
&CG54    SETC  '&CG54'.'09'
         SLL   &CL0,1
         LH    &CL0,@A&AL0.(&CL0)
@CA&AL0  B     *(&CL0)
.ELS1001 ANOP
         MEND
         MACRO
         $BREAK
         $$INT H,R,T,@BREAK
         MEND
         MACRO
&LABEL   $BEND
         GBLA  &AG50,&AG51,&AG52,&AG54,&AG55
         GBLB  &BG54
         GBLC  &CG50,&CG51,&CG52,&CG54,&CG55,&CG56,&CG57
         LCLC  &S,&A,&L,&L2,&E,&X,&Y,&Z
         LCLB  &BL1
         LCLA  &AL0,&AL1
         $$OUV S,L,O,U,V,@BEND,(T,E,D,R,G,Y,A,X,Z,C,B,L)
         AIF   (NOT (&BG54)).ELS1000
         AIF   (NOT ('&LABEL' NE '')).ELS1001
&LABEL   DS    0H
.ELS1001 ANOP
&BL1     SETB  ('&CG56' NE '')
&S       SETC  '&CG50'(&AG50,1)
         AIF   ('&S'             NE 'T' AND '&S'             NE 'E').O1*
               00210
&A       SETC  ''
&L       SETC  '&CG52'(&AG52-3,4)
         AGO   .ECA1002
.O100210 AIF   ('&S'             NE 'D' AND '&S'             NE 'R' AND*
                '&S'             NE 'G' AND '&S'             NE 'Y').O1*
               00211
&A       SETC  '&CG51'(&AG51,1)
&L       SETC  '&CG52'(&AG52-3,4)
         AIF   (NOT ('&A' EQ 'J')).ELS1003
&E       SETC  '&CG55'(&AG55-29,30)
&AG55    SETA  &AG55-30                POP THRU STACK
&CG55    SETC  '&CG55'(1,&AG55)
&X       SETC  '&E'(2,1)
&AL0     SETA  &X                      GET BEG LENGTH
&Y       SETC  '&E'(3,&AL0)            GET BEG NAME
&X       SETC  '&E'(22,1)
&AL0     SETA  &X                      GET STEP LENGTH
&Z       SETC  '&E'(23,&AL0)           GET STEP NAME
&X       SETC  '&E'(21,1)              GET STEP TYP
.ELS1003 ANOP
         AGO   .ECA1002
.O100211 AIF   ('&S'             NE 'A' AND '&S'             NE 'C').O1*
               00212
&A       SETC  ''
&L       SETC  ''
&L2      SETC  '&CG52'(&AG52-3,4)
         AIF   (NOT ('&S' EQ 'C')).ELS1004
&L       SETC  '&L2'
&L2      SETC  '&CG54'(&AG54-1,2)
&AL0     SETA  &L2
&AG54    SETA  &AG54-2                 POP CASE/CAS2 STACK
&CG54    SETC  '&CG54'(1,&AG54)
.ELS1004 ANOP
         AGO   .ECA1002
.O100212 AIF   ('&S'             NE 'X' AND '&S'             NE 'Z').O1*
               00213
&A       SETC  ''
&L       SETC  '&CG52'(&AG52-3,4)
&L2      SETC  '&CG54'(&AG54-3,4)
&AG54    SETA  &AG54-16                POP CASE/CAS2 STACK
&CG54    SETC  '&CG54'(1,&AG54)
         AGO   .ECA1002
.O100213 AIF   ('&S'             NE 'K' AND '&S'             NE 'L').O1*
               00214
&A       SETC  ''
&L       SETC  '&CG52'(&AG52-3,4)
&L2      SETC  '&CG54'(&AG54-5,4)
&AG54    SETA  &AG54-6                 POP CPASS     STACK
&CG54    SETC  '&CG54'(1,&AG54)
         AGO   .ECA1002
.O100214 AIF   ('&S'             NE 'B').O100215
&A       SETC  ''
&L       SETC  ''
.O100215 ANOP
.ECA1002 ANOP
         $$POP &S,&A,&L
         AIF   ('&S'             NE 'T').O100510
@F&L     DS    0H
         AIF   (NOT (&BL1)).ELS1006
         $$GEN F,&CG56,&CG57
.ELS1006 ANOP
         AGO   .ECA1005
.O100510 AIF   ('&S'             NE 'E').O100511
@I&L     DS    0H
         AGO   .ECA1005
.O100511 AIF   ('&S'             NE 'D').O100512
         AIF   (NOT ('&A' EQ 'W')).ELS1007
         B     @W&L
@F&L     DS    0H
         AIF   (NOT (&BL1)).ELS1008
         $$GEN F,&CG56,&CG57
.ELS1008 ANOP
         AGO   .END1007
.ELS1007 ANOP
         AIF   (NOT ('&X' EQ 'D')).ELS1009
         LA    &Y,1(0,&Y)
         AGO   .END1009
.ELS1009 ANOP
         A&X   &Y,&Z
.END1009 ANOP
         B     @J&L
@F&L     DS    0H
.END1007 ANOP
         AGO   .ECA1005
.O100512 AIF   ('&S'             NE 'R').O100513
         AIF   (NOT ('&A' EQ 'Y')).ELS1010
         B     @CY&L
         AGO   .END1010
.ELS1010 ANOP
         BCT   @CR&L,@CY&L
.END1010 ANOP
@T&L     DS    0H
         AIF   (NOT (&BL1)).ELS1011
         $$GEN T,&CG56,&CG57
.ELS1011 ANOP
         AGO   .ECA1005
.O100513 AIF   ('&S'             NE 'G').O100514
         BCT   @CR&L,@CY&L
         AGO   .ECA1005
.O100514 AIF   ('&S'             NE 'Y').O100515
         MNOTE 'WARNING : @CYCLE WITHOUT @WHEN-@BREAK'
         B     @CY&L
         AGO   .ECA1005
.O100515 AIF   ('&S'             NE 'A').O100516
         B     @CE&L2
         AGO   .ECA1005
.O100516 AIF   ('&S'             NE 'X').O100517
@C&L2    DS    0H
@CE&L    DS    0H
         AGO   .ECA1005
.O100517 AIF   ('&S'             NE 'L').O100518
$&L2     DS    0H
         AGO   .ECA1005
.O100518 AIF   ('&S'             NE 'Z').O100519
@CE&L    DS    0H
         AGO   .ECA1005
.O100519 AIF   ('&S'             NE 'C').O100520
&AL1     SETA  9
         B     @CE&L
@A&L     DC    Y(&AL0-&AL1)
         AIF   (NOT (&AL1 LT &AL0)).ELS1012
&AL1     SETA  &AL1+1
.THR1013 AIF   (&AL1 GT &AL0).RHT1013
         DC    Y(@C&L&AL1-@CA&L)
&AL1     SETA  &AL1+1
         AGO   .THR1013
.RHT1013 ANOP
         AGO   .END1012
.ELS1012 ANOP
         MNOTE 'ERROR : NUMBER OF BLOCKS IN @CASE-STATEMENT IS 0'
.END1012 ANOP
@CE&L    DS    0H
         AGO   .ECA1005
.O100520 AIF   ('&S'             NE 'B').O100521
.O100521 ANOP
.ECA1005 ANOP
.ELS1000 ANOP
         MEND
         MACRO
&LABEL   $BEGIN
         GBLA  &AG50,&AG52,&AG54
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG54
         LCLC  &L
         LCLA  &AL0
         AIF   (NOT (NOT &BG53)).ELS1000
         $$OUV ,,O,U,V,@BEGIN,(@,T,E,D,R,G,Y,A,X,Z,C,B)
.ELS1000 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1001
         AIF   (NOT ('&LABEL' NE '')).ELS1002
&LABEL   DS    0H
.ELS1002 ANOP
         AIF   (NOT ('&CG50'(&AG50,1) EQ 'C')).ELS1003
&AG50    SETA  &AG50+1
&CG50    SETC  '&CG50'.'A'
&L       SETC  '&CG54'(&AG54-1,2)
&AL0     SETA  &L+1
         AIF   (NOT (&AL0 LE 99)).ELS1004
&L       SETC  '&CG52'(&AG52-3,4)
&CG54    SETC  '&CG54'(1,&AG54-2).'&AL0'
@C&L&AL0 DS    0H
         AGO   .END1004
.ELS1004 ANOP
         MNOTE 'ERROR : MORE THAN 90 BLOCKS IN @CASE-STATEMENT:        *
               SURPLUS BLOCKS ARE IGNORED'
.END1004 ANOP
         AGO   .END1003
.ELS1003 ANOP
&AG50    SETA  &AG50+1
&CG50    SETC  '&CG50'.'B'
.END1003 ANOP
.ELS1001 ANOP
         MEND
         MACRO
         $AND  &CC
         $$OAT &CC,V,@,U,F,@AND
         MEND
         MACRO
         $$SYN &X,&TEXT,&L,&M,&N
         GBLC  &CG50
         GBLB  &BG54
         GBLA  &AG50
         LCLA  &AL0,&AL1
         LCLC  &CL0
&CL0     SETC  '&X'
         AIF   (NOT (K'&L GT 0)).ELS1000
         AIF   (NOT ('&CL0' EQ '')).ELS1001
&CL0     SETC  '&CG50'(&AG50,1)
.ELS1001 ANOP
&BG54    SETB  0
&AL1     SETA  N'&L
&AL0     SETA  1
.THR1002 AIF   (&AL0 GT &AL1).RHT1002
         AIF   (NOT ('&CL0' EQ '&L(&AL0)')).ELS1003
&BG54    SETB  1
&AL1     SETA  &AL0
.ELS1003 ANOP
&AL0     SETA  &AL0+1
         AGO   .THR1002
.RHT1002 ANOP
         AGO   .END1000
.ELS1000 ANOP
         AIF   (NOT ('&M' NE '')).ELS1004
&BG54    SETB  ('&AG50' EQ '&M')
         AGO   .END1004
.ELS1004 ANOP
&BG54    SETB  ('&AG50' LE '&N')
.END1004 ANOP
.END1000 ANOP
         AIF   (NOT (NOT &BG54)).ELS1005
         MNOTE 'SYNTAX ERROR : &TEXT ON WRONG PLACE : SKIPPED'
.ELS1005 ANOP
         MEND
         MACRO
         $$PUS &STR,&CYC,&LAB,&CON
         GBLA  &AG50,&AG51,&AG52,&AG53
         GBLC  &CG50,&CG51,&CG52,&CG53
         LCLC  &CL0
&CL0     SETC  '&LAB'
         AIF   (NOT ('&STR' NE '')).ELS1000
&AG50    SETA  &AG50+1                 PUSH STRUCTURE
&CG50    SETC  '&CG50'.'&STR'
.ELS1000 ANOP
         AIF   (NOT ('&CYC' NE '')).ELS1001
&AG51    SETA  &AG51+1                 PUSH LOOP
&CG51    SETC  '&CG51'.'&CYC'
.ELS1001 ANOP
         AIF   (NOT ('&CL0' NE '')).ELS1002
         AIF   (NOT ('&CL0' EQ 'N')).ELS1003
&AG53    SETA  &AG53+1                 GENERATE A NEW LABEL
&CL0     SETC  '&AG53'
.ELS1003 ANOP
&AG52    SETA  &AG52+4                 PUSH LABEL
&CG52    SETC  '&CG52'.'&CL0'
.ELS1002 ANOP
         AIF   (NOT ('&CON' NE '')).ELS1004
&CG53    SETC  '@'.'&CON'
.ELS1004 ANOP
         MEND
         MACRO
         $$POP &S,&A,&L
         GBLA  &AG50,&AG51,&AG52
         GBLC  &CG50,&CG51,&CG52
         AIF   (NOT ('&S' NE '')).ELS1000
&AG50    SETA  &AG50-1
&CG50    SETC  '&CG50'(1,&AG50)
.ELS1000 ANOP
         AIF   (NOT ('&A' NE '')).ELS1001
&AG51    SETA  &AG51-1
&CG51    SETC  '&CG51'(1,&AG51)
.ELS1001 ANOP
         AIF   (NOT ('&L' NE '')).ELS1002
&AG52    SETA  &AG52-4
&CG52    SETC  '&CG52'(1,&AG52)
.ELS1002 ANOP
         MEND
         MACRO
         $$OUV &S,&L,&X,&Y,&Z,&TEXT,&LIS
         GBLA  &AG50,&AG52
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG56,&CG57
         LCLC  &A
         LCLA  &AL1
&AL1     SETA  &AG50+1
.CYC1000 ANOP
&AL1     SETA  &AL1-1
&A       SETC  '&CG50'(&AL1,1)
         AIF   ('&A' NE '&X' AND '&A' NE '&Y' AND '&A' NE '&Z').CYE1000
         AGO   .CYC1000
.CYE1000 ANOP
         AIF   (NOT (NOT &BG53)).ELS1001
         $$SYN &A,&TEXT,&LIS
.ELS1001 ANOP
         AIF   (NOT (&BG53 OR &BG54)).ELS1002
&AL1     SETA  &AG50-&AL1
         AIF   (NOT (&AL1 GT 0)).ELS1003
         AIF   (NOT ('&S' NE '')).ELS1004
&AG50    SETA  &AG50-&AL1
&CG56    SETC  '&CG50'(&AG50+1,&AL1)
&CG50    SETC  '&CG50'(1,&AG50)
.ELS1004 ANOP
         AIF   (NOT ('&L' NE '')).ELS1005
&AL1     SETA  &AL1*4
&AG52    SETA  &AG52-&AL1
&CG57    SETC  '&CG52'(&AG52+1,&AL1)
&CG52    SETC  '&CG52'(1,&AG52)
.ELS1005 ANOP
         AGO   .END1003
.ELS1003 ANOP
&CG56    SETC  ''
&CG57    SETC  ''
.END1003 ANOP
.ELS1002 ANOP
         MEND
         MACRO
         $$OAT &CC,&X,&Y,&NEW,&TYP,&TEXT
         GBLA  &AG50,&AG52,&AG53
         GBLB  &BG53,&BG54
         GBLC  &CG50,&CG52,&CG55,&CG56,&CG57
         LCLC  &L,&CL0
&CL0     SETC  '&CC'
         $$OUV S,L,&X,&Y,@,&TEXT,(I,W,H,O,U,V)
         AIF   (NOT (&BG53 OR &BG54)).ELS1000
         AIF   (NOT ('&CL0' EQ '')).ELS1001
&CL0     SETC  '@@'
         MNOTE 'MISSING OPERAND : @@ IS USED'
.ELS1001 ANOP
         AIF   (NOT ('&CG50'(&AG50,1) EQ '&NEW')).ELS1002
&L       SETC  '&CG52'(&AG52-3,4)
         $$POP S,,L
         AGO   .END1002
.ELS1002 ANOP
&AG53    SETA  &AG53+1
&L       SETC  '&AG53'
.END1002 ANOP
         $$JUM &TYP,&L,&CG56,&CG57
         $$PUS &NEW,,&L,&CL0
.ELS1000 ANOP
         MEND
         MACRO
         $$JUM &TYP,&L,&STR,&LAB
         GBLC  &CG53
         AIF   (NOT ('&TYP' EQ 'T')).ELS1000
         BC    &CG53,@&TYP&L
         AGO   .END1000
.ELS1000 ANOP
         BC    @F-&CG53,@&TYP&L
.END1000 ANOP
         AIF   (NOT ('&STR' NE '')).ELS1001
         AIF   (NOT ('&TYP' EQ 'T')).ELS1002
         $$GEN F,&STR,&LAB
         AGO   .END1002
.ELS1002 ANOP
         $$GEN T,&STR,&LAB
.END1002 ANOP
.ELS1001 ANOP
         MEND
         MACRO
         $$INT &OLD,&NEW,&TYP,&TEXT
         GBLC  &CG50,&CG56,&CG57,&CG52
         GBLA  &AG50,&AG52
         GBLB  &BG53,&BG54
         LCLC  &L
         $$OUV S,L,O,U,V,&TEXT,(&OLD)
         AIF   (NOT (&BG53 OR &BG54)).ELS1000
&CG50    SETC  '&CG50'(1,&AG50-1).'&NEW'
&L       SETC  '&CG52'(&AG52-3,4)
         $$JUM &TYP,&L,&CG56,&CG57
.ELS1000 ANOP
         MEND
         MACRO
         $$INIT
         GBLA  &AG50,&AG51,&AG52,&AG53,&AG54,&AG55
         GBLB  &BG55
         GBLC  &CG50,&CG51,&CG52,&CG53,&CG54,&CG55
&AG50    SETA  1
&AG51    SETA  1
&AG52    SETA  1
&AG54    SETA  1
&AG55    SETA  1
&CG50    SETC  '@'
&CG51    SETC  '@'
&CG52    SETC  '@'
&CG54    SETC  '@'
&CG55    SETC  '@'
         AIF   (NOT (NOT &BG55)).ELS1000
&BG55    SETB  1
&AG53    SETA  1000
         $$CAE
.ELS1000 ANOP
         MEND
         MACRO
         $$GEN &T,&S,&L
         LCLC  &A,&B
         LCLA  &AL0
         LCLB  &BL1,&BL2
&AL0     SETA  1
.THR1000 AIF   (&AL0 GT K'&S).RHT1000
&A       SETC  '&S'(&AL0,1)
&B       SETC  '&L'(4*&AL0-3,4)
&BL1     SETB  ('&T' EQ 'T')
&BL2     SETB  ('&A' EQ 'U')
         AIF   (NOT (&BL1 AND &BL2 OR NOT &BL1 AND NOT &BL2)).ELS1001
         $$PUS &A,,&B
         AGO   .END1001
.ELS1001 ANOP
@&T&B    DS    0H
.END1001 ANOP
&AL0     SETA  &AL0+1
         AGO   .THR1000
.RHT1000 ANOP
         MEND
         MACRO
         $$CHE &R,&N
         GBLB  &BG53
         LCLB  &BL0
&BL0     SETB  (&BG53)                 SAVE BG53
&BG53    SETB  1                       NO SYNTAX CHECK
         $IF   LE
         LTR   &R,&R
         $OR   GT
         CH    &R,&N
         $THEN
         LH    &R,&N
         $BEND
&BG53    SETB  (&BL0)                  RESET BG53
         MEND
         MACRO
         $$CAE
         LCLA &AL0
.* AG50 = STRUCTURE STACK LENGTH
.* AG51 = LOOP STACK LENGTH
.* AG52 = LABEL STACK LENGTH
.* AG53 = LABEL GENERATOR
.* AG54 = CASE/CAS2 STACK LENGTH
.* AG55 = THRU CONTROLFIELD STACK LENGTH
.* AG56 = LENGTH OF SAVE AREA
.* AG57 = MAXIMAL NUMBERS OF PARAMETERS
.* BG50 = CHECK FLAG
.* BG51 = TRACE FLAG
.* BG52 = RUN-THROUGH-COUNTER FLAG
.* BG53 = NO SYNTAX CHECK FLAG
.* BG54 = NO SYNTAX ERROR FLAG
.* BG55 = ON AFTER FIRST @ENTR
.* BG56 = ON AFTER CALL OF @@SAV
.* BG57 = MAIN PROCEDURE
.* BG58 = BASIC OR LOW LEVEL PROCEDURE
.* BG59 = DUMMY PROCEDURE
.* BG60 = SPL ENVIRONMENT
.* CG50 = STRUCTURE STACK
.*    A = CASE BLOCK (BEGIN - BEND)
.*    B = BLOCK
.*    C = CASE
.*    D = DO
.*    E = ELSE
.*    F = CAS2
.*    G = CYCLE WITH REGISTER
.*    H = WHEN
.*    I = IF
.*    J = THRU
.*    K = CPASS
.*    L = OF CPASS
.*    O = OR
.*    R = BREAK
.*    T = THEN
.*    U = AND
.*    V = TOR
.*    W = WHILE
.*    X = OF CAS2
.*    Y = CYCLE WITHOUT REGISTER
.*    Z = OFREST
.* CG51 = LOOP STACK
.* CG52 = LABEL STACK
.* CG53 = CONDITION CODE VARIABLE
.* CG54 = CASE/CAS2 STACK
.* CG55 = THRU CONTROLFIELD STACK
.* CG56 = AUXILIARY STRUCTURE STACK
.* CG57 = AUXILIARY LABEL STACK
.* CG58 = ACCUMULATES REGISTERS TO DROP
.* CG59 = PROCEDURE NAME
.* CG60 = CSECT NAME VARIABLE
.* CG61 = STACK NAME VARIABLE           OWN VARIABLE
* SYMBOLIC CONDITIONS FOR @IF,@WHEN,@WHILE,@TOR,@AND,@OR
@LT      EQU   4   LESS THAN
@GT      EQU   2   GREATER THAN
@EQ      EQU   8   EQUAL
@NE      EQU   7   NOT EQUAL
@LE      EQU   13  LESS OR EQUAL
@NH      EQU   13  NOT HIGH
@NP      EQU   13  NOT PLUS
@GE      EQU   11  GREATER OR EQUAL
@NL      EQU   11  NOT LOW
@NM      EQU   11  NOT MINUS
@LZ      EQU   4   LESS THAN ZERO
@GZ      EQU   2   GREATER THAN ZERO
@ZE      EQU   8   ZERO
@NZ      EQU   7   NOT ZERO
@ON      EQU   1   ONES
@MI      EQU   4   MIXED
@ZO      EQU   11  ZEROS OR ONES
@ZM      EQU   14  ZEROS OR MIXED
@NO      EQU   14  NOT ONES
@OM      EQU   7   ONES OR MIXED
@F       EQU   15  TRUE IN ANY CASE
         MEND
INVENTAR TITLE 'EDV-INVENTARDATEI-VERWALTUNGSPROGRAMM'
         PRINT NOGEN,ON
         EQUREG
INVENTAR $ENTRY M
 LM    R11,R12,=A(DATEN,DATEN+4096)
 USING DATEN,R11,R12
 BAL   R14,UPDEF                        ISP-VARIABLEN DEFINIEREN
 $CPASS UPABTLR,CT=2                    ABTEILUNGSTABELLE EINLESEN
 $OF                                    FEHLER
 $OF                                    KEIN FEHLER
    UPRUF UPDDRD                        DATA DICTIONARY LESEN
    ISPLINK ('DISPLAY','NLV9$9 ')
    $WHILE NE
       C     R15,=F'8'
    $DO
       MVC   INVDAY,INVDAT6             WERTIGKEITSDATUM
       MVC   INVMON,INVDAT6+3
       MVC   INVYEAR,INVDAT6+6
       MVC   TAGESDAT,INVDAT7           TAGESDATUM
       LA    R1,INVDAT6
       MVC   MSGFELD,=C'INVDAT6 '
       $CPASS UPPLDAT,CT=2              DATUM PRUEFEN
       $OF                              FEHLER
          ISPLINK ('DISPLAY',0,MSGNUM,MSGFELD)
       $OF                              KEIN FEHLER
          $CAS2 INVOPT
          $OF =C'0'
             UPRUF UPDISP0              DISPLAY PANEL 0 (=INITIALIS.)
          $OF =C'1'
             UPRUF UPDISP1              DISPLAY PANEL 1 (=NEUAUFNAHME)
          $OF =C'2'
             UPRUF UPDISP2              DISPLAY PANEL 2 (=AENDERUNGSD.)
          $OF =C'3'
             UPRUF UPDISP3              DISPLAY PANEL 3 (=LOESCHEN)
          $OF =C'4'
             UPRUF UPDISP4              DISPLAY PANEL 4 (=AUSWERTUNG)
          $OF =C'5'
             UPRUF UPDISP5              DISPLAY PANEL 5 (=KOPIEREN)
          $OF =C'6'
             UPRUF UPDISP6              DISPLAY PANEL 6 (=SUCHABFRAGE)
          $BEND
          ISPLINK ('DISPLAY','NLV9$9 ',MSGNUM)
       $BEND
    $BEND
 $BEND
 ISPLINK ('TBEND','TABABTL ')
 ISPLINK ('TBEND','TABDD ')
 $EXIT
 EJECT
UPDEF    $ENTRY
         ISPLINK ('VDEFINE','(INVOPT,INVZUST,INVMKKZ,INVWKZ)',         *
               INVOPT,'CHAR ',F1)
         ISPLINK ('VDEFINE','(INVZSERV,INVGEW,INVOSERV,INVOUNT,INVGLZ, *
               INVILZ,INVAKZ)',INVZSERV,'CHAR ',F1)
         ISPLINK ('VDEFINE','(INVSA,INVSB,INVSC,INVSD)',INVSA,'CHAR ', *
               F1)
         ISPLINK ('VDEFINE','(INVKZEIT,INVTZEIT,INVNLVKZ,INVDAY,INVMON,*
               INVYEAR,INVAART)',INVKZEIT,'CHAR ',F2)
         ISPLINK ('VDEFINE','(INVMOD,INVECL,INVVLMON)',                *
               INVMOD,'CHAR ',F3)
         ISPLINK ('VDEFINE','(INVMODN)',INVMODN,'CHAR ',F3)
         ISPLINK ('VDEFINE','(INVTYP,INVFT0,INVFT1,INVFT2,INVFT3,      *
               INVFT4,INVFT5,INVFT6,INVFT7,INVFT8,INVFT9,INVKST,       *
               INVKTR,INVABTL,INVPROD)',INVTYP,'CHAR ',F4)
         ISPLINK ('VDEFINE','(INVPRODN,INVTYPN)',INVPRODN,'CHAR ',F4)
         ISPLINK ('VDEFINE','(INVCA,DELRECNR)',INVCA,'CHAR ',F5)
         ISPLINK ('VDEFINE','(INVLNR,INVMANR)',INVLNR,'CHAR ',F7)
         ISPLINK ('VDEFINE','(INVMANRN)',INVMANRN,'CHAR ',F7)
         ISPLINK ('VDEFINE','(INVUSER,INVDAT1,INVDAT2,INVDAT3,INVDAT4, *
               INVDAT5,INVDAT6,INVDAT7,INVDAT8,INVIORT,INVHERS,INVABEG,*
               INVAEND)',INVUSER,'CHAR ',F8)
         ISPLINK ('VDEFINE','(INVMSNR,INVINVN)',INVMSNR,'CHAR ',F10)
         ISPLINK ('VDEFINE','(INVMODUS)',INVMODUS,'CHAR ',F11)
         ISPLINK ('VDEFINE','(INVTUSER,INVMPR,INVWPR)',                *
               INVTUSER,'CHAR ',F12)
         ISPLINK ('VDEFINE','(INVTTEL)',INVTTEL,'CHAR ',F13)
         ISPLINK ('VDEFINE','(INVKPR,INVABAS,INVARAT)',                *
               INVKPR,'CHAR ',F14)
         ISPLINK ('VDEFINE','(INVBEZ,INVFB0,INVFB1,INVFB2,INVFB3,INVFB4*
               ,INVFB5,INVFB6,INVFB7,INVFB8,INVFB9)',INVBEZ,'CHAR ',   *
               F30)
         ISPLINK ('VDEFINE','(INVLIST,ZPF24)',INVLIST,'CHAR ',F40)
         ISPLINK ('VDEFINE','(INVFZ0,INVFZ1,INVFZ2,INVFZ3,INVFZ4,INVFZ5*
               ,INVFZ6,INVFZ7,INVFZ8,INVFZ9)',INVFZ0,'FIXED ',F4)
         ISPLINK ('VDEFINE','(INVANF0,INVANF1,INVANF2,INVANF3,INVANF4, *
               INVANF5,INVANF6,INVANF7,INVANF8,INVANF9)',              *
               INVANF0,'CHAR ',F74)
         ISPLINK ('VDEFINE','(INVUEB1,INVUEB2,INVUEB3,INVZEIL)',       *
               INVUEB1,'CHAR ',F79)
UPDEF1   $INFO DD=D137VS
         MVC   MINOR,UPDEF1DS           UEBERTRAGEN DSNAME
         $EXIT
         EJECT
UPABTLR  $ENTRY
 MVI WEOF,WEOFN
 OPEN (INFODAT)
 LA R9,SATZINFO
 USING D191D,R9
 GET RPL=INFODATG
 $WHILE NE
    CLI WEOF,WEOFY
 $DO
    $IF EQ
       CLC D191KZGH,=C'GH'
    $THEN
       $CAS2 D191KZSA
       $OF =C'AB'
          L R8,ADDRABTL+4
          $IF LT
             C R8,ADDRABTL+8
          $THEN
             MVC TABABTLN-TABABTL(L'TABABTLN,R8),D191NR
             MVC TABABTLT-TABABTL(L'TABABTLT,R8),D191ABTT
             LA R8,L'TABABTL(R8)
             ST R8,ADDRABTL+4
             LA R7,4
          $ELSE
             LA R7,0
          $BEND
       $OF =C'KO'
          L R8,ADDRKOST+4
          $IF LT
             C R8,ADDRKOST+8
          $THEN
             MVC TABKOSTN-TABKOST(L'TABKOSTN,R8),D191NR
             MVC TABKOSTA-TABKOST(L'TABKOSTA,R8),D191ABT
             LA R8,L'TABKOST(R8)
             ST R8,ADDRKOST+4
             LA R7,4
          $ELSE
             LA R7,0
          $BEND
       $BEND
    $BEND
    GET RPL=INFODATG
 $BEND
 DROP R9
 CLOSE (INFODAT)
 ABTLTAB '0400','5551'
 ABTLTAB '0800','9101'
 ABTLTAB '1000','4631'
 ABTLTAB '1081','0000'
 ABTLTAB '1100','6961'
 ABTLTAB '1300','5211'
 ABTLTAB '1500','7841'
 ABTLTAB '1600','7451'
 ABTLTAB '1700','4871'
 ABTLTAB '2000','4291'
 ABTLTAB '2700','8521'
 ABTLTAB '2800','5941'
 ABTLTAB '3400','6431'
 ABTLTAB '4200','8181'
 $IF NZ
    LTR R7,R7
 $THEN
    L R9,ADDRKOST+4
    LA R8,L'TABKOST
    SR R9,R8
    ST R9,ADDRKOST+4
    L R8,ADDRKOST
    QSORT 0(R8),0(R9),L'TABKOST,TABKOSTN-TABKOST,L'TABKOSTN
    L R9,ADDRABTL+4
    LA R8,L'TABABTL
    SR R9,R8
    ST R9,ADDRABTL+4
    L R8,ADDRABTL
    QSORT 0(R8),0(R9),L'TABABTL,TABABTLN-TABABTL,L'TABABTLN
    ISPLINK ('VDEFINE','(TABABTNR)',SATZINFO,'CHAR ',F4)
    ISPLINK ('VDEFINE','(TABABTNM)',SATZINFO+4,'CHAR ',F26)
    ISPLINK ('TBCREATE','TABABTL ',0,'(TABABTNR,TABABTNM)',            *
               'NOWRITE','REPLACE')
    L R8,ADDRABTL
    $WHILE LE
       C R8,ADDRABTL+4
    $DO
       MVC SATZINFO(L'TABABTLN+L'TABABTLT),0(R8)
       ISPLINK ('TBADD','TABABTL ')
       LA R8,L'TABABTL(R8)
    $BEND
 $ELSE
    ISPLINK ('SETMSG','STA062A ')
 $BEND
 $EXIT RC=(R7)
         EJECT
UPDDRD   $ENTRY
 ISPLINK ('VDEFINE','(TABDDLNG)',TABDDLNG,'CHAR ',F2)
 ISPLINK ('VDEFINE','(TABDDOP)',TABDDOP,'CHAR ',F3)
 ISPLINK ('VDEFINE','(TABDDDSP)',TABDDDSP,'CHAR ',F4)
 ISPLINK ('VDEFINE','(TABDDNM)',TABDDNM,'CHAR ',F8)
 ISPLINK ('VDEFINE','(TABDDBEZ,TABDDTIT)',TABDDBEZ,'CHAR ',F24)
 ISPLINK ('TBCREATE','TABDD ',0,'(TABDDNM,TABDDDSP,TABDDLNG,TABDDOP,   *
               TABDDBEZ,TABDDTIT)','NOWRITE','REPLACE')
 L R8,DDTAB                             ANFANG DER TABELLE
 $WHILE NE
    C R8,DDTABE                         ENDE DER TABELLE?
 $DO
    MVC   TABDDNM,DDNM-DDELEM(R8)
    UNPK  WORK(5),DDDSP-DDELEM(3,R8)
    TR    WORK(4),TRTABUNP-240
    MVC   TABDDDSP,WORK
    XR    R9,R9
    IC    R9,DDLNG-DDELEM(R8)
    CVD   R9,DOWO
    UNPK  TABDDLNG,DOWO
    OI    TABDDLNG+1,X'F0'
    LA R9,DDOP-DDELEM(R8)
    $CAS2 0(R9)
    $OF =C' '
       MVC   TABDDOP,=C'   '
    $OF =C'A'
       MVC   TABDDOP,=C'AND'
    $OF =C'O'
       MVC   TABDDOP,=C'OR '
    $BEND
    MVC   TABDDBEZ,DDBEZ-DDELEM(R8)
    MVC   TABDDTIT,DDTIT-DDELEM(R8)
    ISPLINK ('TBADD','TABDD ')
    LA    R8,L'DDELEM(R8)
 $BEND
 $EXIT
 EJECT
UPDISP0  $ENTRY
 MODCB ACB=INVDATEI,MACRF=(RST)
 TAOPEN WRITE
 $IF ZE
    LTR R15,R15
 $THEN
    MVI SATZALT,X'00'
    MVC SATZALT+1(39),SATZALT
    PUT RPL=INVLOAD
    MVI SATZALT,X'FF'
    MVC SATZALT+1(39),SATZALT
    PUT RPL=INVLOAD
    MVC MSGNUM,=CL8'STA065A'
 $ELSE
    MVC MSGNUM,=CL8'STA066A'
 $BEND
 TACLOSE
 MODCB ACB=INVDATEI,MACRF=(NRS)
 $EXIT
 EJECT
UPDISP1  $ENTRY
         LOESCH INVZUST,INVNLVKZ,C' '
         LOESCH INVAART,INVMANR,C' '
         LOESCH INVDAT1,INVAEND,C' '
         LOESCH INVMSNR,INVFB1,C' '
         LOESCH INVFB2,INVFB9,C' '
         MVC   INVHERS,=CL8'IBM'
         MVC   INVMODUS,=CL11'NEUAUFNAHME'
         MVC   INVFZ0,=X'80000000'
         MVC   INVFZ1(INVFZ9-INVFZ0),INVFZ0
         MVC   MSGNUM,=CL8' '
         MVI   INVSA,C'X'
         MVI   INVSB,C'X'
         MVI   INVSC,C'X'
         MVI   INVSD,C'X'
UPDISP12 UPRUF UPPAN                    FELDER ANZEIGEN
         B     UPDISP1E                 RETURN
         LA    R9,SATZNEU
         UPRUF UPRECWR                  NEUEN SATZ AUFBAUEN
         ZAP   SATZNEU+LFDNR-INDSATZ(L'LFDNR),=P'1' OKAY, LFDNR = 1
         MVC   MSGNUM,=CL8'STA013A'     FEHLERMELDUNG: SCHON VORH.
         TAOPEN WRITE
         MVC   UPREADLK,SATZNEU
         LA    R9,SATZALT
         UPRUF UPREADL                  LESEN LETZTEN SATZ DIESES KEYS
         B     UPDISP16                 KEIN SATZ DIESEN KEYS VORHANDEN
         B     UPDISP15                 GUELTIGER SATZ DIESEN KEYS VORH
         ZAP   SATZNEU+LFDNR-INDSATZ(L'LFDNR),SATZALT+LFDNR-INDSATZ(L'L*
               FDNR)                    SATZ DIESEN KEYS NICHT GUELTIG
         AP    SATZNEU+LFDNR-INDSATZ(L'LFDNR),=P'1'
UPDISP16 L     R3,LAENGEG
         MODCB RPL=INSERT,RECLEN=(3)
         PUT   RPL=INSERT
         LOESCH INVZUST,INVNLVKZ,C' '
         LOESCH INVAART,INVMANR,C' '
         LOESCH INVDAT1,INVAEND,C' '
         LOESCH INVMSNR,INVFB1,C' '
         LOESCH INVFB2,INVFB9,C' '
         MVC   INVHERS,=CL8'IBM'
         MVC   INVMODUS,=CL11'NEUAUFNAHME'
         MVC   INVFZ0,=X'80000000'
         MVC   INVFZ1(INVFZ9-INVFZ0),INVFZ0
         MVC   MSGNUM,=C'STA015A '      MELDUNG: ALLES O.K.
UPDISP15 TACLOSE
         B     UPDISP12
UPDISP1E $EXIT
         EJECT
UPDISP2  $ENTRY
         LOESCH INVPROD,INVPROD,C' '
         LOESCH INVTYP,INVTYP,C' '
         LOESCH INVMOD,INVMOD,C' '
         LOESCH INVMANR,INVMANR,C' '
         LOESCH INVSA,INVSD,C'X'
UPDISP2B MVC   MSGNUM,=CL8' '
UPDISP2A ISPLINK ('DISPLAY','NLV992$ ',MSGNUM),R8=UPDISP2E
         MVC   INVMODUS,=CL11'NDERUNG'
         MVC   MSGNUM,=CL8'STA014A'
         TAOPEN READ
         MVC   UPREADLK+PRODKZ-INDSATZ(L'PRODKZ),INVPROD
         MVC   UPREADLK+TYP-INDSATZ(L'TYP),INVTYP
         MVC   UPREADLK+MODELL-INDSATZ(L'MODELL),INVMOD
         MVC   UPREADLK+MANR-INDSATZ(L'MANR),INVMANR
         LA    R9,SATZALT
         UPRUF UPREADL                  LESEN LETZTEN SATZ DIESEN KEYS
         B     UPDISP2D
         B     UPDISP2C
UPDISP2D TACLOSE
         B     UPDISP2A
UPDISP2C TACLOSE
         USING INDSATZ,R9
         MVC   WORK+0(2),ZEITRAUM+4
         MVC   WORK+2(2),ZEITRAUM+2
         MVC   WORK+4(2),ZEITRAUM+0
         MVC   WORK+6(2),INVYEAR
         MVC   WORK+8(2),INVMON
         MVC   WORK+10(2),INVDAY
         MVC   MSGNUM,=C'STA027A '
         CLC   WORK(6),WORK+6 DATUM LETZTE AENDERUNG<=WERTIGKEITSDATUM?
         BH    UPDISP2A                 FEHLER
         UPRUF UPRECRD                  ISP-FELDER VERSORGEN
         MVC   SATZNEU(L'INDKEY),SATZALT SCHLUESSEL SICHERN
         MVC   MSGNUM,=CL8' '
UPDISP22 UPRUF UPPAN                    FELDER ANZEIGEN
         B     UPDISP2B                 RETURN
         TAOPEN WRITE                   OKAY
         MVC   MSGNUM,=CL8'STA014A'
         MVC   UPREADLK,SATZNEU
         UPRUF UPREADL
         B     UPDISP21                 SCHLUESSEL NICHT VORHANDEN
         B     UPDISP24                 SCHLUESSEL GUELTIG VORHANDEN
         B     UPDISP21                 SCHLUESSEL UNGUELTIG VORHANDEN
UPDISP24 MVC   MSGNUM,=CL8'STA029A'
         CLC   SATZNEU(L'INDKEY),SATZALT SATZ UNVERAENDERT
         BNE   UPDISP21                 NEIN
         MVC   UPREADLK+PRODKZ-INDSATZ(L'PRODKZ),INVPROD
         MVC   UPREADLK+TYP-INDSATZ(L'TYP),INVTYP
         MVC   UPREADLK+MODELL-INDSATZ(L'MODELL),INVMOD
         MVC   UPREADLK+MANR-INDSATZ(L'MANR),INVMANR
         CLC   UPREADLK,SATZNEU         SCHLUESSELAENDERUNG ?
         BE    UPDISP25                 NEIN
         MVC   MSGNUM,=CL8'STA013A'
         UPRUF UPREADL
         B     UPDISP26                 NEUER SCHLUESSEL NICHT VORH.
         B     UPDISP23                 NEUER SCHLUESSEL GUELTIG VORH.
UPDISP25 ZAP   WORK(3),SATZALT+L'INDKEY-L'LFDNR(L'LFDNR) SCHL UNG VORH
         B     UPDISP29
UPDISP26 ZAP   WORK(3),=P'0'
UPDISP29 MVC   SATZALT(L'INDKEY),SATZNEU
         MODCB RPL=GETUPD,OPTCD=(FKS,KEQ,DIR),KEYLEN=21
         LOESCH INDINVN,INDAEND,C' '    VARIABLEN SATZTEIL LOESCHEN
         GET   RPL=GETUPD               ALTEN SATZ LESEN FUER UPDATE
         LA    R9,SATZNEU
         UPRUF UPRECWR                  NEUEN SATZ AUFBAUEN
         AP    WORK(3),=P'1'            LFDNR ERRECHNEN
         MVC   SATZNEU+LFDNR-INDSATZ(L'LFDNR),WORK LFDNR EINTRAGEN
         MVC   SATZALT+ZEITRAUM+L'ZEITRAUM-INDSATZ(L'ZEITRAUM),SATZNEU+*
               ZEITRAUM-INDSATZ         ZEITRAUM BIS EINTRAGEN
         L     R3,LAENGEG
         CLC   SATZALT+ZEITRAUM+L'ZEITRAUM-INDSATZ(L'ZEITRAUM),SATZALT+*
               ZEITRAUM-INDSATZ         ZEITRAUM VON = ZEITRAUM BIS ?
         BE    UPDISP27                 JA, SATZ LOESCHEN
         MODCB RPL=GETUPD,RECLEN=(3)    NEIN, SATZ UPDATEN
         PUT   RPL=GETUPD
         B     UPDISP28
UPDISP27 ERASE RPL=GETUPD
UPDISP28 MODCB RPL=INSERT,RECLEN=(3)
         PUT   RPL=INSERT
         MVC   MSGNUM,=C'STA016A '      MELDUNG: ALLES O.K.
UPDISP21 TACLOSE
         B     UPDISP2A
UPDISP23 TACLOSE
         B     UPDISP22
UPDISP2E MVC   MSGNUM,=CL8' '
         $EXIT
         DROP  R9
         EJECT
UPDISP3  $ENTRY
         ISPLINK ('DISPLAY','NLV993$ '),R8=UPDISP3Z
UPDISP3A LA    R1,INVDAT1
         MVC   MSGFELD,=C'INVDAT1 '
         UPRUF UPPLDAT                  DATUM PRUEFEN
         B     UPDISP3N                 FEHLER
         B     UPDISP3B                 KEIN FEHLER
UPDISP3N ISPLINK ('DISPLAY',0,MSGNUM,MSGFELD),R8=UPDISP3Z
         B     UPDISP3A
UPDISP3B LA    R9,SATZALT
         USING INDSATZ,R9
         XC    DOWO(4),DOWO             ANZAHL GELOESCHTER SAETZE = 0
         MVC   PRODKZ,INVPROD
         MVC   TYP,INVTYP
         MVC   MODELL,INVMOD
         MVC   MANR,INVMANR
         TAOPEN WRITE
         CLI   INDKEY,C' '              KEIN PRODUKT ANGEGEBEN ?
         BE    UPDISP3D                 JA
         MVC   UPREADLK,SATZALT
         UPRUF UPREADL
         B     UPDISP3D                 SCLUESSEL NICHT VORHANDEN
         B     UPDISP3I                 SCHLUESSEL GUELTIG VORHANDEN
         B     UPDISP3D                 SCHLUESSEL UNGUELTIG VORHANDEN
UPDISP3I MVC   WORK+4(2),SATZALT+ZEITRAUM-INDSATZ+4
         MVC   WORK+6(2),SATZALT+ZEITRAUM-INDSATZ+2
         MVC   WORK+8(2),SATZALT+ZEITRAUM-INDSATZ+0
         MVC   WORK+10(2),INVYEAR
         MVC   WORK+12(2),INVMON
         MVC   WORK+14(2),INVDAY
         MVC   MSGNUM,=C'STA027A '
         CLC   WORK+4(6),WORK+10
*                             DATUM LETZTE AENDERUNG<=WERTIGKEITSDATUM?
         BNH   UPDISP3J                 JA, OKAY
         TACLOSE
         B     UPDISP3N
UPDISP3J MODCB RPL=GETUPD,OPTCD=(FKS,KEQ,DIR),KEYLEN=21
         LOESCH INDINVN,INDAEND,C' '    VARIABLEN SATZTEIL LOESCHEN
         GET   RPL=GETUPD
         MVC   WORK+4(2),INVDAY
         MVC   WORK+6(2),INVMON
         MVC   WORK+8(2),INVYEAR
         MVC   SATZALT+ZEITRAUM+L'ZEITRAUM-INDSATZ(L'ZEITRAUM),WORK+4
         L     R3,LAENGEG
         CLC   SATZALT+ZEITRAUM+L'ZEITRAUM-INDSATZ(L'ZEITRAUM),SATZALT+*
               ZEITRAUM-INDSATZ         ZEITRAUM VON = ZEITRAUM BIS ?
         BE    UPDISP3K                 JA, SATZ LOESCHEN
         MODCB RPL=GETUPD,RECLEN=(3)    NEIN, SATZ UPDATEN
         PUT   RPL=GETUPD
         B     UPDISP3L
UPDISP3K ERASE RPL=GETUPD
UPDISP3L L     R15,DOWO
         LA    R15,1(R15)               ANZAHL GELOESCHTER SAETZE + 1
         ST    R15,DOWO
UPDISP3D CLI   INVDAT1,C' '             LOESCHDATUM ANGEGEBEN ?
         BE    UPDISP3F                 NEIN
         XC    SATZALT(L'INDKEY),SATZALT
         MVC   WORK+6(2),INVDAT1+6
         MVC   WORK+8(2),INVDAT1+3
         MVC   WORK+10(2),INVDAT1
         MODCB RPL=GETUPD,OPTCD=(FKS,KEQ,SEQ),KEYLEN=21
         POINT RPL=GETUPD
         GET   RPL=GETUPD               X'0000'-SATZ LESEN
UPDISP3E GET   RPL=GETUPD
         CLI   SATZALT,X'FF'            LETZTER SATZ ?
         BE    UPDISP3F                 JA
         MVC   WORK(2),ZEITRAUM+10
         MVC   WORK+2(2),ZEITRAUM+8
         MVC   WORK+4(2),ZEITRAUM+6
         CLI   WORK,C' '                AKTUELLER SATZ ?
         BE    UPDISP3E                 JA, WIRD NICHT GELOESCHT
         CLC   WORK(6),WORK+6           AENDERUNGSDATUM < LOESCHDATUM
         BNL   UPDISP3E                 NEIN, SATZ WIRD NICHT GELOESCHT
         ERASE RPL=GETUPD               DELETE, READ NEXT
         L     R15,DOWO
         LA    R15,1(R15)               ANZAHL GELOESCHTER SAETZE + 1
         ST    R15,DOWO
         B     UPDISP3E
UPDISP3F TACLOSE
         MVC   MSGNUM,=CL8'STA048A'
         L     R15,DOWO
         CVD   R15,DOWO
         LOESCH WORK,WORK,C' '
         MVC   WORK(6),=X'402020202120'
         ED    WORK(6),DOWO+5
         LA    R15,WORK+1
UPDISP3G CLI   0(R15),C' '
         BNE   UPDISP3H
         LA    R15,1(R15)
         B     UPDISP3G
UPDISP3H MVC   DELRECNR,0(R15)
         ISPLINK ('DISPLAY',0,MSGNUM),R8=UPDISP3Z
         B     UPDISP3A
UPDISP3Z MVC   MSGNUM,=CL8' '
         $EXIT
         DROP  R9
         EJECT
UPDISP4  $ENTRY
 LOESCH MSGNUM,MSGNUM,C' '
 ISPLINK ('DISPLAY','NLV994$ ')
 $WHILE NE
    C     R15,=F'8'
 $DO
    LA    R8,INVLIST+1
    $WHILE NE
       CLI   0(R8),C' '               ENDE DER LISTENAUSGABE?
    $DO
       $IF LE
          CLI   1(R8),C'P'
       $AND NZ
          UPRUF UPTBLD
          NC    SORTTAB,SORTTAB
       $THEN
          MVC   LISTNR,0(R8)
          TR    LISTNR,TRTABLST-193
          MVC   INVLIST(1),1(R8)
          L     R7,SORTTABA
          L     R6,SORTTAB
          $WHILE NE
             C     R7,SORTTABL          TABELLE ABGEARBEITET ?
          $DO                           JA
             UPRUF UPLAUSW              SATZ AUSWAEHLEN
             ST    R7,SORTADR-SORTTAB1(R6)
             LA    R7,SORTLNG2(R7)      NAECHSTES TABELLENELEMENT
             LA    R6,SORTLNG1(R6)      NAECHSTES TABELLENELEMENT
          $BEND
          ST    R6,SORTTABE
          L     R14,SORTTAB
          L     R15,SORTTABE
          LA    R1,SORTLNG1
          SR    R15,R1
          QSORT 0(R14),0(R15),SORTLNG1,SORTKEY-SORTTAB1,L'SORTKEY
          MVC   ZEILENL,ZEILENLD
          ZAP   ZEILENZ,ZEILENZD        NEUE SEITE ERZWINGEN
          ZAP   SEITENZ,=P'0'           SEITENZAEHLER = 0
          ZAP   SUMKPR,=P'0'            SUMMENFELDER LOESCHEN
          ZAP   SUMMPR,=P'0'
          ZAP   SUMWPR,=P'0'
          ZAP   SUMAPR,=P'0'
          ZAP   SUMBPR,=P'0'
          ZAP   GRUPKPR,=P'0'
          ZAP   GRUPMPR,=P'0'
          ZAP   GRUPWPR,=P'0'
          ZAP   GRUPAPR,=P'0'
          ZAP   GRUPBPR,=P'0'
          XC    GRUPPALT,GRUPPALT       GRUPPENBEGRIFF-ALT LOESCHEN
          MVI   WAUSG,WAUSGN            KEINE FUSSZEILE DRUCKEN
          UPRUF UPLANF                  LISTENKOPF VERSORGEN
          LA    R9,SATZALT
          L     R6,SORTTAB              ANFANG DER SORTTAB
          $WHILE NE                     BIS TABELLE ABGEARBEITET
             C     R6,SORTTABE
          $AND NE                       ODER EINTRAEGE UNGUELTIG
             CLI   SORTKEY-SORTTAB1(R6),X'FF'
          $DO
             L     R7,SORTADR-SORTTAB1(R6)
             UPRUF UPAUSGD              SATZ AUF DRUCKER AUSGEBEN
             LA    R5,SORTNUM2-SORTTAB2(R7)
             UPRUF UPSUM                NUMERISCHE WERTE ADDIEREN
             LA    R6,SORTLNG1(R6)      NAECHSTEN SATZ
          $BEND
          $IF EQ
             CLI   WAUSG,WAUSGJ         LISTENFUSS DRUCKEN?
          $THEN                         JA
             UPRUF UPLEND               LISTENFUSS DRUCKEN
             $CAS2 INVLIST
             $OF =C'B'
                CLOSE (D002OS99)
                ISPLINK ('BROWSE','INVENTAR.LISTE ')
             $OF =C'E'
                CLOSE (D002OS99)
                ISPLINK ('EDIT','INVENTAR.LISTE ')
             $OF =C'P'
                CLOSE (D001OS99)
             $BEND
          $BEND
       $BEND
       LA    R8,2(R8)
    $BEND
    ISPLINK ('DISPLAY','NLV994$ ',MSGNUM)
 $BEND
 UPRUF UPTBUNLD                       TABELLE ENTLADEN
 $EXIT
 EJECT
UPDISP5  $ENTRY
UPDISP5A LOESCH INVPROD,INVPROD,C' '
         LOESCH INVTYP,INVTYP,C' '
         LOESCH INVMOD,INVMOD,C' '
         LOESCH INVMANR,INVMANR,C' '
         LOESCH INVPRODN,INVPRODN,C' '
         LOESCH INVTYPN,INVTYPN,C' '
         LOESCH INVMODN,INVMODN,C' '
         LOESCH INVMANRN,INVMANRN,C' '
         ISPLINK ('DISPLAY','NLV995$ '),R8=UPDISP5E
UPDISP5B TAOPEN WRITE
         MVC   UPREADLK+PRODKZ-INDSATZ(L'PRODKZ),INVPROD
         MVC   UPREADLK+TYP-INDSATZ(L'TYP),INVTYP
         MVC   UPREADLK+MODELL-INDSATZ(L'MODELL),INVMOD
         MVC   UPREADLK+MANR-INDSATZ(L'MANR),INVMANR
         LA    R9,SATZALT
         UPRUF UPREADL
         B     UPDISP5F
         B     UPDISP5C
UPDISP5F MVC   MSGNUM,=CL8'STA014A'
         MVC   MSGFELD,=CL8'INVPROD'
         TACLOSE
         ISPLINK ('DISPLAY',0,MSGNUM,MSGFELD),R8=UPDISP5E
         B     UPDISP5B
UPDISP5C LA    R14,SATZNEU
         LA    R15,L'SATZNEU
         LA    R8,SATZALT
         LA    R9,L'SATZALT
         MVCL  R14,R8                   SATZ SICHERN
         MVC   UPREADLK+PRODKZ-INDSATZ(L'PRODKZ),INVPRODN
         MVC   UPREADLK+TYP-INDSATZ(L'TYP),INVTYPN
         MVC   UPREADLK+MODELL-INDSATZ(L'MODELL),INVMODN
         MVC   UPREADLK+MANR-INDSATZ(L'MANR),INVMANRN
         LA    R9,SATZALT
         UPRUF UPREADL
         B     UPDISP5G
         B     UPDISP5H
         B     UPDISP5I
UPDISP5H MVC   MSGNUM,=CL8'STA013A'
         MVC   MSGFELD,=CL8'INVPRODN'
         TACLOSE
         ISPLINK ('DISPLAY',0,MSGNUM,MSGFELD),R8=UPDISP5E
         B     UPDISP5B
UPDISP5G ZAP   SATZNEU+LFDNR-INDSATZ(L'LFDNR),=P'1'
         B     UPDISP5D
UPDISP5I MVC   SATZNEU+LFDNR-INDSATZ(L'LFDNR),SATZALT+LFDNR-INDSATZ
         AP    SATZNEU+L'INDKEY-L'LFDNR(L'LFDNR),=P'1'
UPDISP5D MVC   SATZNEU(L'INDKEY-L'LFDNR),UPREADLK
         MVC   SATZNEU+INDPFLG-INDSATZ(L'INVUSER),INVUSER
         MVC   SATZNEU+INDPFLD-INDSATZ(2),TAGESDAT
         MVC   SATZNEU+INDPFLD+2-INDSATZ(2),TAGESDAT+3
         MVC   SATZNEU+INDPFLD+4-INDSATZ(2),TAGESDAT+6
         MVC   SATZNEU+ZEITRAUM-INDSATZ(2),INVDAY
         MVC   SATZNEU+ZEITRAUM+2-INDSATZ(2),INVMON
         MVC   SATZNEU+ZEITRAUM+4-INDSATZ(2),INVYEAR
         MVC   SATZNEU+ZEITRAUM+6-INDSATZ(6),=CL6' '
         L     R3,LAENGEG
         MODCB RPL=INSERT,RECLEN=(3)
         PUT   RPL=INSERT
         MVC   MSGNUM,=C'STA028A '      MELDUNG: ALLES O.K.
         TACLOSE
         ISPLINK ('DISPLAY','NLV995$ ',MSGNUM),R8=UPDISP5E
         B     UPDISP5B
UPDISP5E MVC   MSGNUM,=CL8' '
         $EXIT
         EJECT
         USING INDSATZ,R9
UPDISP6  $ENTRY
         GETMAIN EC,LV=X'100000',A=ADRFIND
         LTR   R15,R15
         BZ    UPDISP61
         MVC   MSGNUM,=C'STA022A '
         B     UPDISP6Z                 FEHLER
UPDISP61 L     R7,ADRFIND
         LA    R7,2048(R7)
         ST    R7,ADRSORT
         LA    R7,512(R7)
         ST    R7,ADRLIST
         LA    R7,512(R7)
         ST    R7,ADRLITER
         LA    R7,960(R7)
         ST    R7,ADRSUMZ
         LA    R7,64(R7)
         ST    R7,SORTTAB
         L     R7,=A(X'100000'-X'1000')
         XR    R6,R6
         LA    R5,SORTLNG3
         DR    R6,R5                    R7 = ANZAHL TABELLENPLAETZE
         LA    R6,SORTLNG3
         MR    R6,R6
         A     R7,SORTTAB
         ST    R7,SORTTABE              SORT-TABELLENENDE
         LA    R14,INVANF0              ANFORDERUNGSBEREICH LOESCHEN
         LA    R15,750
         LR    R8,R14
         XR    R9,R9
         ICM   R9,8,LEERZ
         MVCL  R14,R8
         LOESCH MSGNUM,MSGNUM,C' '
         MVC   ZEILENL,ZEILENLD
UPDISP69 DISPLAY NLV996$,=C'X',UPDISP67,,(('DDICT ',UPDISPD)),'DDICT '
         MVC   SORTTABL,SORTTAB         ERSTER FREIER EINTRAG
         UPRUF UPSCAN                   LISTENANFORDERUNG UMSETZEN
         B     UPDISP69                 SYNTAX-FEHLER
         LA    R9,SATZALT               KEIN SYNTAX-FEHLER
         L     R8,ADRLITER
         LOESCH INDKEY,INDKEY,X'00'
         TAOPEN READ
         POINT RPL=GETSEQ
         GET   RPL=GETSEQ               X'0000'-SATZ LESEN
UPDISP62 LOESCH INDINVN,INDAEND,C' '    VARIABLEN SATZTEIL LOESCHEN
         GET   RPL=GETSEQ
         CLI   INDKEY,X'FF'             LETZTER SATZ DER DATEI
         BE    UPDISP63                 JA
         L     R15,ADRFIND              SATZ AUSWAEHLEN
         BALR  R14,R15
         B     UPDISP62                 SATZ NICHT AUSGEWAEHLT
         UPRUF UPSELDAT                 GUELTIGKEITSZEITRAUM OKAY?
         B     UPDISP62                 NEIN
         L     R7,SORTTABL              NAECHSTES FREIES SORTTAB-FELD
         USING SORTTAB3,R7
         LA    R7,SORTFLD
         L     R15,ADRSORT              SORTIERFELDER UEBERTRAGEN
         BALR  R14,R15
         L     R7,SORTTABL              NAECHSTES FREIES SORTTAB-FELD
         USING INDSATZ,R9
         LA    R5,SORTNUM3
         USING SORTTAB4,R5
         TR    KPREIS,TRTABDM
         TR    MPREIS,TRTABDM
         TR    WPREIS,TRTABDM
         TR    INDABAS,TRTABDM
         TR    INDARAT,TRTABDM
         MVC   SORTKPR,KPREIS           NUMERISCHE FELDER UEBERTRAGEN
         MVC   SORTMPR,MPREIS
         MVC   SORTWPR,WPREIS+3
         MVC   SORTAPR,INDARAT
         MVC   SORTBPR,INDABAS
         DROP  R5
         MVI   SORTZL,C' '              AUSGABEFELDER LOESCHEN
         MVC   SORTZL+1(L'SORTZL-1),SORTZL
         LA    R7,SORTZL
         L     R15,ADRLIST              AUSGABEFELDER UEBERTRAGEN
         BALR  R14,R15
         DROP  R7
         L     R15,SORTTABL             NAECHSTES FREIES SORTTAB-FELD
         LA    R15,SORTLNG3(R15)        AKTUALISIEREN
         ST    R15,SORTTABL
         C     R15,SORTTABE             TABELLE VOLL?
         BNE   UPDISP62                 NEIN
         MVC   MSGNUM,=C'STA024A '
         TACLOSE
         B     UPDISP67
UPDISP63 TACLOSE
         L     R14,SORTTAB
         L     R15,SORTTABL
         LA    R1,SORTLNG3
         SR    R15,R1
         QSORT 0(R14),0(R15),SORTLNG3,SORTFLD-SORTTAB3,L'SORTFLD
         ZAP   ZEILENZ,ZEILENZD
         ZAP   SEITENZ,=P'0'
         ZAP   SUMKPR,=P'0'
         ZAP   SUMMPR,=P'0'
         ZAP   SUMWPR,=P'0'
         ZAP   SUMAPR,=P'0'
         ZAP   SUMBPR,=P'0'
         ZAP   GRUPKPR,=P'0'
         ZAP   GRUPMPR,=P'0'
         ZAP   GRUPWPR,=P'0'
         ZAP   GRUPAPR,=P'0'
         ZAP   GRUPBPR,=P'0'
         MVI   WAUSG,WAUSGN             KEINE FUSSZEILE DRUCKEN
         L     R7,SORTTAB               ANFANG DER SORTTAB
UPDISP64 C     R7,SORTTABL              TABELLE ABGEARBEITET?
         BE    UPDISP6A                 JA
         USING SORTTAB3,R7
         LA    R5,SORTNUM3
         UPRUF UPSUM                    PREISE ADDIEREN
         MVC   LISTZ,SORTZL             AUSGABEFELDER UEBERTRAGEN
         DROP  R7
         L     R5,LNGLIST
         L     R15,=A(UPZAUSG)          SATZ AUSGEBEN
         CALL  (15),(LISTZ,(R5),UEBZ,(R5))
         LA    R7,SORTLNG3(R7)          NAECHSTEN SATZ
         B     UPDISP64
UPDISP6A MVC   MSGNUM,=C'STA047A '      FEHLERMELDUNG BEI KEINEM TREFF.
         CLI   WAUSG,WAUSGJ             FUSSZEILE DRUCKEN ?
         BNE   UPDISP69                 NEIN
         LOESCH MSGNUM,MSGNUM,C' '      FEHLERMELDUNG L\SCHEN
         L     R14,ADRSUMZ
         LA    R14,2(R14)
         C     R14,CNTSUMZ              PREISFELD VORHANDEN ?
         BE    UPDISP65                 NEIN
         MVC   KPREIS-1(15),=X'402020204B2020204B2021206B2020'
         ED    KPREIS-1(15),SUMKPR
         MVC   WPREIS-1(13),=X'40204B2020204B2021206B2020'
         ED    WPREIS-1(13),SUMWPR
         MVC   MPREIS-1(13),=X'40204B2020204B2021206B2020'
         ED    MPREIS-1(13),SUMMPR
         MVC   INDARAT-1(15),=X'402020204B2020204B2021206B2020'
         ED    INDARAT-1(15),SUMAPR
         MVC   INDABAS-1(15),=X'402020204B2020204B2021206B2020'
         ED    INDABAS-1(15),SUMBPR
         LOESCH LISTZ,LISTZ,C' '
         LA    R7,LISTZ
         L     R15,ADRSUMZ              SUMMENZEILE UEBERTRAGEN
         BALR  R14,R15
         L     R5,LNGLIST
         L     R15,=A(UPZAUSG)
         CALL  (15),(LISTZ,(R5),UEBZ,(R5))
UPDISP65 CLI   INVLIST,C'B'
         BNE   UPDISP6B
         CLOSE (D002OS99)
         ISPLINK ('BROWSE','INVENTAR.LISTE ')
         B     UPDISP69
UPDISP6B CLI   INVLIST,C'E'
         BNE   UPDISP6C
         CLOSE (D002OS99)
         ISPLINK ('EDIT','INVENTAR.LISTE ')
         B     UPDISP69
UPDISP6C CLOSE (D001OS99)
         B     UPDISP69
UPDISP67 FREEMAIN EC,LV=X'100000',A=ADRFIND
         LTR   R15,R15
         BZ    UPDISP6Z
         MVC   MSGNUM,=C'STA023A '
         B     UPDISP6Y
UPDISP6Z XC    SORTTAB,SORTTAB
UPDISP6Y $EXIT
         DROP  R9
         EJECT
UPREADL $ENTRY
 USING INDSATZ,R9
 MVC   SATZALT(L'INDKEY-L'LFDNR),UPREADLK
 MVI   SATZALT+LFDNR-INDSATZ,X'FF'
 MODCB RPL=GETLAST,OPTCD=(FWD,KGE,GEN),KEYLEN=19
 POINT RPL=GETLAST
 GET   RPL=GETLAST
 MODCB RPL=GETLAST,OPTCD=(BWD,KEQ,FKS),KEYLEN=21
 POINT RPL=GETLAST
 GET   RPL=GETLAST
 LOESCH INDINVN,INDAEND,C' '            VARIABLEN SATZTEIL LOESCHEN
 GET   RPL=GETLAST
 $IF EQ                                 SATZ GEFUNDEN ?
    CLC UPREADLK,SATZALT
 $THEN                                  JA
    $IF EQ                              SATZ GUELTIG ?
       CLC SATZALT+ZEITRAUM+L'ZEITRAUM-INDSATZ(L'ZEITRAUM),=CL6' '
    $THEN                               JA
       LA R15,4
    $ELSE                               NEIN
       LA R15,8
    $BEND
 $ELSE                                  NEIN
    XR R15,R15
 $BEND
 DROP R9
 $EXIT RC=(R15)
 EJECT
UPPAN    $ENTRY
         XR    R15,R15
UPPAN1   DISPLAY NLV991$1,INVSA,UPPANRET
UPPAN2   DISPLAY NLV991$2,INVSB,UPPAN1,(UPPLP12)
UPPAN3   DISPLAY NLV991$3,INVSC,UPPAN2,(UPPLP13,UPPLP14)
UPPAN4   DISPLAY NLV991$4,INVSD,UPPAN3,(UPPLP15),(('ABTL ',UPDISPA)),  *
               'ABTL '
         LA    R15,4
         B     UPPANEXT
UPPANRET XR    R15,R15
UPPANEXT $EXIT RC=(R15)
         SPACE 3
UPDISPA  $ENTRY
UPDISPA1 ISPLINK ('TBTOP','TABABTL ')
         ISPLINK ('TBDISPL','TABABTL ','NLV99ABT'),R0=UPDISPA1
         $EXIT
         SPACE 3
UPDISPD  $ENTRY
UPDISPD1 ISPLINK ('TBTOP','TABDD ')
         ISPLINK ('TBDISPL','TABDD ','NLV99DD '),R0=UPDISPD1
         $EXIT
         EJECT
UPPLP11  $ENTRY
         LA    R7,WORK
         BAL   R14,UPPLPPR              ZAHL EINLESEN
         B     UPPLP11A                 EINGABEFELDENDE
         B     UPPLP11B                 KOMMA AN NICHTLETZTER STELLE
         B     UPPLP11F                 UNGUELTIGES ZEICHEN
         B     UPPLP11G                 ZUVIELE STELLEN VOR DEM KOMMA
UPPLP11A LA    R8,2                     KOMMA AN LETZTER STELLE
         B     UPPLP11D                 ZWEI NULLEN ANHAENGEN
UPPLP11B LA    R8,2                     MAX. ANZAHL STELLEN NACH KOMMA
         BAL   R14,UPPLPPR              ZAHL EINLESEN
         B     UPPLP11C                 EINGABEFELDENDE
         B     UPPLP11H                 KOMMA AN NICHTLETZTER STELLE
         B     UPPLP11F                 UNGUELTIGES ZEICHEN
         B     UPPLP11I                 ZUVIELE STELLEN VOR DEM KOMMA
         B     UPPLP11H                 KOMMA AN LETZTER STELLE
UPPLP11C LTR   R8,R8                    2 STELLEN NACH KOMMA?
         BZ    UPPLP11E                 JA
UPPLP11D MVI   0(R7),C'0'               MIT 0 AUFFUELLEN
         LA    R7,1(R7)
         BCT   R8,UPPLP11D
UPPLP11E LA    R8,WORK+1
         SR    R7,R8                    R7= ANZ. STELLEN - 1
         EX    R7,UPPLP11V
         MVC   WORK(15),=X'402020204B2020204B2021206B2020'
         ED    WORK(15),DOWO+2
         LA    R15,4
         B     UPPLP11Z                 ENDE
UPPLP11F MVC   MSGNUM,=C'STA018A '      ZAHL UNG}LTIG
         B     UPPLP11X
UPPLP11G MVC   MSGNUM,=C'STA017A '      ZAHL ZU GROSS
         B     UPPLP11X
UPPLP11H MVC   MSGNUM,=C'STA019A '      ZU VIELE KOMMATA
         B     UPPLP11X
UPPLP11I MVC   MSGNUM,=C'STA021A '      ZU VIELE DEZIMALSTELLEN
UPPLP11X XR    R15,R15
UPPLP11Z $EXIT RC=(R15)
         SPACE 3
UPPLP11V PACK  DOWO,WORK(0)
         EJECT
UPPLP12  $ENTRY
         LA    R1,INVDAT1
         MVC   MSGFELD,=C'INVDAT1 '
         BAL   R14,UPPLDAT              INVDAT1 PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVDAT2
         MVC   MSGFELD,=C'INVDAT2 '
         BAL   R14,UPPLDAT              INVDAT2 PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVDAT3
         MVC   MSGFELD,=C'INVDAT3 '
         BAL   R14,UPPLDAT              INVDAT3 PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVDAT4
         MVC   MSGFELD,=C'INVDAT4 '
         BAL   R14,UPPLDAT              INVDAT4 PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVDAT5
         MVC   MSGFELD,=C'INVDAT5 '
         BAL   R14,UPPLDAT              INVDAT5 PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVABEG
         MVC   MSGFELD,=C'INVABEG '
         BAL   R14,UPPLDAT              INVABEG PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R1,INVAEND
         MVC   MSGFELD,=C'INVAEND '
         BAL   R14,UPPLDAT              INVAEND PR!FEN
         B     UPPLP12E                 FEHLER
         LA    R15,4
         B     UPPLP12Z
UPPLP12E XR    R15,R15
UPPLP12Z $EXIT RC=(R15)
         EJECT
UPPLP13  $ENTRY
         LA    R1,INVDAT6
         MVC   MSGFELD,=C'INVDAT6 '
         BAL   R14,UPPLDAT              INVDAT6 PR!FEN
         B     UPPLP13E                 FEHLER
         LA    R1,INVDAT7
         MVC   MSGFELD,=C'INVDAT7 '
         BAL   R14,UPPLDAT              INVDAT7 PR!FEN
         B     UPPLP13E                 FEHLER
         LA    R1,INVDAT8
         MVC   MSGFELD,=C'INVDAT8 '
         BAL   R14,UPPLDAT              INVDAT8 PR!FEN
         B     UPPLP13E                 FEHLER
         LA    R15,4
         B     UPPLP13Z
UPPLP13E XR    R15,R15
UPPLP13Z $EXIT RC=(R15)
         EJECT
UPPLP14  $ENTRY
         LA    R1,INVKPR
         LA    R2,L'INVKPR
         LA    R8,9                     MAX. ANZAHL STELLEN VOR KOMMA
         MVC   MSGFELD,=C'INVKPR  '
         UPRUF UPPLP11                  PREIS PRUEFEN
         B     UPPLP14X                 FEHLER
         MVC   INVKPR,WORK+1
         LA    R1,INVMPR
         LA    R2,L'INVMPR
         LA    R8,7                     MAX. ANZAHL STELLEN VOR KOMMA
         MVC   MSGFELD,=C'INVMPR  '
         UPRUF UPPLP11                  PREIS PRUEFEN
         B     UPPLP14X                 FEHLER
         MVC   INVMPR,WORK+3
         LA    R1,INVWPR
         LA    R2,L'INVWPR
         LA    R8,7                     MAX. ANZAHL STELLEN VOR KOMMA
         MVC   MSGFELD,=C'INVWPR  '
         UPRUF UPPLP11                  PREIS PRUEFEN
         B     UPPLP14X                 FEHLER
         MVC   INVWPR,WORK+3
         LA    R1,INVABAS
         LA    R2,L'INVABAS
         LA    R8,9                     MAX. ANZAHL STELLEN VOR KOMMA
         MVC   MSGFELD,=C'INVABAS '
         UPRUF UPPLP11                  PREIS PRUEFEN
         B     UPPLP14X                 FEHLER
         MVC   INVABAS,WORK+1
         LA    R1,INVARAT
         LA    R2,L'INVARAT
         LA    R8,9                     MAX. ANZAHL STELLEN VOR KOMMA
         MVC   MSGFELD,=C'INVARAT '
         UPRUF UPPLP11                  PREIS PRUEFEN
         B     UPPLP14X                 FEHLER
         MVC   INVARAT,WORK+1
         LA    R15,4
         B     UPPLP14Z
UPPLP14X XR    R15,R15
UPPLP14Z $EXIT RC=(R15)
         EJECT
UPPLP15  $ENTRY
         LM    R14,R15,ADDRKOST
         BSUCH 0(R14),0(R15),L'TABKOST,0,L'TABKOSTN,INVKST
         B     *+4(R15)
         B     UPPLP15A                 KOSTENSTELLE GEFUNDEN
         B     UPPLP15B                 KOSTENSTELLE NICHT GEFUNDEN
         B     UPPLP15C                 INTERNER FEHLER
UPPLP15A CLC   INVABTL,TABKOSTA-TABKOST(R1)
         BE    UPPLP15D
         MVC   MSGFELD,=CL8'INVKST '
         MVC   MSGNUM,=C'STA049A '      UNGUELTIGE KOSTENSTELLE
         XR    R15,R15
         B     UPPLP15Z
UPPLP15B MVC   MSGFELD,=CL8'INVKST '
         MVC   MSGNUM,=C'STA025A '      UNBEKANNTE KOSTENSTELLE
         XR    R15,R15
         B     UPPLP15Z
UPPLP15C MVC   MSGFELD,=CL8'INVABTL'    TABELLENFEHLER
         MVC   MSGNUM,=C'STA026A '
         XR    R15,R15
         B     UPPLP15Z
UPPLP15D LA    R15,L'INVCA
         LA    R14,INVCA
UPPLP15E CLI   0(R14),C' '              MIT NACHFOLGENDEN BLANKS ?
         BE    UPPLP15F                 JA
         LA    R14,1(R14)
         BCT   R15,UPPLP15E
         B     UPPLP15X                 KEINE BLANKS GEFUNDEN
UPPLP15F MVC   WORK(L'INVCA),INVCA      R15 = ANZAHL BLANKS
         MVI   INVCA,C' '
         MVC   INVCA+1(L'INVCA-1),INVCA
         LA    R14,INVCA(R15)
         LA    R1,L'INVCA
         SR    R1,R15                   R1 = ANZAHL STELLEN
         BNP   UPPLP15X                 NUR BLANKS GEFUNDEN
         BCTR  R1,0
         EX    R1,UPPLP15V
UPPLP15X LA    R15,4
UPPLP15Z $EXIT RC=(R15)
         SPACE 3
UPPLP15V MVC   0(0,R14),WORK
         EJECT
UPPLDAT  $ENTRY
 LA R15,4
 $IF NE
    CLI   0(R1),C' '                   DATUM VORHANDEN?
 $THEN                                 JA
    $IF GT
       CLC   3(2,R1),=C'12'            MONAT GROESSER 12
    $OR LT
       CLC   3(2,R1),=C'01'            MONAT KLEINER 01
    $OR GT
       CLC   0(2,R1),=C'31'            TAG GROESSER 31
    $OR LT
       CLC   0(2,R1),=C'01'            TAG KLEINER 01
    $OR GT
       CLC   0(2,R1),=C'28'            NICHT MEHR ALS 28 TAGE?
    $AND EQ
       CLC   3(2,R1),=C'02'            FEBRUAR?
    $OR GT
       CLC   0(2,R1),=C'30'            NICHT MEHR ALS 30 TAGE?
    $AND EQ
       CLC   3(2,R1),=C'04'            APRIL?
    $TOR EQ
       CLC   3(2,R1),=C'06'            JUNI?
    $TOR EQ
       CLC   3(2,R1),=C'09'            SEPTEMBER?
    $TOR EQ
       CLC   3(2,R1),=C'11'            NOVEMBER?
    $THEN
       XR    R15,R15                   FEHLERCODE SETZEN
       MVC   MSGNUM,=C'STA012A '       FALSCHE DATUMSANGABE
    $BEND
 $BEND
 $EXIT RC=(R15)
         EJECT
UPPLPPR  $ENTRY
UPPLPPRA CLI   0(R1),C' '
         BE    UPPLPPRB
         CLI   0(R1),C'.'
         BE    UPPLPPRB
         CLI   0(R1),C'*'
         BE    UPPLPPRB
         CLI   0(R1),C','
         BE    UPPLPPRC
         CLI   0(R1),C'0'
         BL    UPPLPPRE
         CLI   0(R1),C'9'
         BH    UPPLPPRE
         LTR   R8,R8                    EMPFANGSFELD VOLL?
         BNP   UPPLPPRF                 JA
         MVC   0(1,R7),0(R1)
         BCTR  R8,0
         LA    R7,1(R7)
UPPLPPRB LA    R1,1(R1)
         BCT   R2,UPPLPPRA
         XR    R15,R15                  EINGABEFELDENDE
         B     UPPLPPRZ
UPPLPPRC LA    R1,1(R1)
         BCT   R2,UPPLPPRD
         LA    R15,16                   KOMMA AN LETZTER STELLE
         B     UPPLPPRZ
UPPLPPRD LA    R15,4                    KOMMA AN NICHTLETZTER STELLE
         B     UPPLPPRZ
UPPLPPRE LA    R15,8                    UNGUELTIGES ZEICHEN
         B     UPPLPPRZ
UPPLPPRF LA    R15,12                   ZUVIELE STELLEN
UPPLPPRZ $EXIT RC=(R15)
         EJECT
UPRECRD  $ENTRY
*                      SATZALT -> ISP-FELDER
         USING INDSATZ,R9
         MVC   INVPROD,PRODKZ           PRODUKTGRUPPE
         MVC   INVTYP,TYP               TYP
         MVC   INVMOD,MODELL            MODELL
         MVC   INVMANR,MANR             MASCHINEN-NR
         MVC   INVBEZ,TYPBEZ            BEZEICHNUNG
         MVC   INVHERS,HERSTELL         HERSTELLER
         MVC   INVFT0,FEATURES+0*L'FEATURES+FTYP-FEATURE
         MVC   INVFT1,FEATURES+1*L'FEATURES+FTYP-FEATURE
         MVC   INVFT2,FEATURES+2*L'FEATURES+FTYP-FEATURE
         MVC   INVFT3,FEATURES+3*L'FEATURES+FTYP-FEATURE
         MVC   INVFT4,FEATURES+4*L'FEATURES+FTYP-FEATURE
         MVC   INVFT5,FEATURES+5*L'FEATURES+FTYP-FEATURE
         MVC   INVFT6,FEATURES+6*L'FEATURES+FTYP-FEATURE
         MVC   INVFT7,FEATURES+7*L'FEATURES+FTYP-FEATURE
         MVC   INVFT8,FEATURES+8*L'FEATURES+FTYP-FEATURE
         MVC   INVFT9,FEATURES+9*L'FEATURES+FTYP-FEATURE
         MVC   INVFB0,FEATURES+0*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB1,FEATURES+1*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB2,FEATURES+2*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB3,FEATURES+3*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB4,FEATURES+4*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB5,FEATURES+5*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB6,FEATURES+6*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB7,FEATURES+7*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB8,FEATURES+8*L'FEATURES+FTYPBEZ-FEATURE
         MVC   INVFB9,FEATURES+9*L'FEATURES+FTYPBEZ-FEATURE
         CVPX  FEATURES+0*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ0
         CVPX  FEATURES+1*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ1
         CVPX  FEATURES+2*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ2
         CVPX  FEATURES+3*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ3
         CVPX  FEATURES+4*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ4
         CVPX  FEATURES+5*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ5
         CVPX  FEATURES+6*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ6
         CVPX  FEATURES+7*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ7
         CVPX  FEATURES+8*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ8
         CVPX  FEATURES+9*L'FEATURES+FANZ-FEATURE(L'FANZ),INVFZ9
         MVC   INVECL,ECLEVEL           EC-LEVEL
         MVC   INVZUST,INSTKZ           INSTALLATIONSZUSTAND
         MVC   INVDAT1,DATLIEF          GEPLANTER LIEFERTERMIN
         MVC   INVDAT2,DATINST          INSTALLATIONSDATUM
         MVC   INVDAT3,DATBEGIN         MIETBEGINN
         MVC   INVDAT4,DATENDE          MIETENDE
         MVC   INVDAT5,DATKUEND         KUENDIGUNGSDATUM
         MVC   INVVLMON,DATVERLG        VERLAENGERUNGSZEITRAUM
         MVC   INVMSNR,ABLAGENR         MIETSCHEIN-NR
         MVC   INVMKKZ,BESOKZ           MIETE-KAUF-KZ
         MVC   INVWKZ,WARTKZ            WARTUNGS-KZ
         MVC   INVKZEIT,KZEIT           KUENDIGUNGSZEIT IN TAGEN
         MVC   INVTZEIT,TZEIT           TESTZEIT IN TAGEN
         MVC   INVGEW,KZGEW             GEWAEHRLEISTUNG
         MVC   INVGLZ,KZGEB             GEBAEUDELIZENZ
         MVC   INVILZ,KZINS             INSTALLATIONSLIZENZ
         MVC   INVZSERV,KZZSER          ZENTRALER SERVICE
         MVC   INVOSERV,KZOSER          OERTLICHER SERVICE
         MVC   INVOUNT,KZOUNT           OERTLICHE UNTERSTUETZUNG
         MVC   INVDAT6,KZZSEDAT         ENDDATUM ZENTRALER SERVICE
         MVC   INVDAT7,KZOSEDAT         ENDDATUM OERTLICHER SERVICE
         MVC   INVDAT8,KZOUNDAT         ENDDATUM OERTLICHE UNTERSTUETZ.
         MVC   INVKPR,KPREIS            KAUFPREIS
         MVC   INVMPR,MPREIS            MIETPREIS
         MVC   INVWPR,WPREIS            WARTUNGSKOSTEN
         MVC   INVKST,KOSTENST          KOSTENSTELLE
         MVC   INVKTR,KOSTENTR          KOSTENTRAEGER
         MVC   INVNLVKZ,INDFAKZ         NLV-NAV-KZ
         MVC   INVABTL,INDABTL          ABTEILUNG
         MVC   INVIORT,INDORT           INSTALLATIONSORT
         MVC   INVTUSER,INDBEN          TERMINAL-BENUTZER
         MVC   INVCA,INDCUA             GERAETEADRESSE
         MVC   INVTTEL,INDTEL           TELEFON
         MVC   INVLNR,INDLEIT           LEITUNGSNUMMER
         MVC   INVINVN,INDINVN          INVENTARNUMMER
         MVC   INVAART,INDAART          ABSCHREIBUNGSART
         MVC   INVABEG,INDABEG          ABSCHREIBUNGSBEGINN
         MVC   INVAEND,INDAEND          ABSCHREIBUNGSENDE
         MVC   INVABAS,INDABAS          ABSCHREIBUNGSBASIS
         MVC   INVARAT,INDARAT          ABSCHREIBUNGSRATE
         MVC   INVAKZ,INDAKZ            ALLGEMEINES KENNZEICHEN
         DROP  R9
         $EXIT
         EJECT
UPRECWR  $ENTRY
*                         ISP-FELDER -> SATZNEU
         USING INDSATZ,R9
         MVC   PRODKZ,INVPROD           PRODUKTGRUPPE
         MVC   TYP,INVTYP               TYP
         MVC   MODELL,INVMOD            MODELL
         MVC   MANR,INVMANR             MASCHINEN-NR
         MVC   TYPBEZ,INVBEZ            BEZEICHNUNG
         MVC   HERSTELL,INVHERS         HERSTELLER
         MVC   FEATURES+0*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT0
         MVC   FEATURES+1*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT1
         MVC   FEATURES+2*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT2
         MVC   FEATURES+3*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT3
         MVC   FEATURES+4*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT4
         MVC   FEATURES+5*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT5
         MVC   FEATURES+6*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT6
         MVC   FEATURES+7*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT7
         MVC   FEATURES+8*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT8
         MVC   FEATURES+9*L'FEATURES+FTYP-FEATURE(L'FTYP),INVFT9
         MVC   FEATURES+0*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB0
         MVC   FEATURES+1*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB1
         MVC   FEATURES+2*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB2
         MVC   FEATURES+3*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB3
         MVC   FEATURES+4*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB4
         MVC   FEATURES+5*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB5
         MVC   FEATURES+6*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB6
         MVC   FEATURES+7*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB7
         MVC   FEATURES+8*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB8
         MVC   FEATURES+9*L'FEATURES+FTYPBEZ-FEATURE(L'FTYPBEZ),INVFB9
         CVXP  INVFZ0,FEATURES+0*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ1,FEATURES+1*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ2,FEATURES+2*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ3,FEATURES+3*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ4,FEATURES+4*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ5,FEATURES+5*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ6,FEATURES+6*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ7,FEATURES+7*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ8,FEATURES+8*L'FEATURES+FANZ-FEATURE(L'FANZ)
         CVXP  INVFZ9,FEATURES+9*L'FEATURES+FANZ-FEATURE(L'FANZ)
         MVC   ECLEVEL,INVECL           EC-LEVEL
         MVC   INSTKZ,INVZUST           INSTALLATIONSZUSTAND
         MVC   DATLIEF,INVDAT1          GEPLANTER LIEFERTERMIN
         MVC   DATINST,INVDAT2          INSTALLATIONSDATUM
         MVC   DATBEGIN,INVDAT3         MIETBEGINN
         MVC   DATENDE,INVDAT4          MIETENDE
         MVC   DATKUEND,INVDAT5         KUENDIGUNGSDATUM
         MVC   DATVERLG,INVVLMON        VERLAENGERUNGSZEITRAUM
         MVC   ABLAGENR,INVMSNR         MIETSCHEIN-NR
         MVC   BESOKZ,INVMKKZ           MIETE-KAUF-KZ
         MVC   WARTKZ,INVWKZ            WARTUNGS-KZ
         MVC   KZEIT,INVKZEIT           KUENDIGUNGSZEIT IN TAGEN
         MVC   TZEIT,INVTZEIT           TESTZEIT IN TAGEN
         MVC   KZGEW,INVGEW             GEWAEHRLEISTUNG
         MVC   KZGEB,INVGLZ             GEBAEUDELIZENZ
         MVC   KZINS,INVILZ             INSTALLATIONSLIZENZ
         MVC   KZZSER,INVZSERV          ZENTRALER SERVICE
         MVC   KZOSER,INVOSERV          OERTLICHER SERVICE
         MVC   KZOUNT,INVOUNT           OERTLICHE UNTERSTUETZUNG
         MVC   KZZSEDAT,INVDAT6         ENDDATUM ZENTRALER SERVICE
         MVC   KZOSEDAT,INVDAT7         ENDDATUM OERTLICHER SERVICE
         MVC   KZOUNDAT,INVDAT8         ENDDATUM OERTLICHE UNTERSTUETZ.
         MVC   KPREIS,INVKPR            KAUFPREIS
         MVC   MPREIS,INVMPR            MIETPREIS
         MVC   WPREIS,INVWPR            WARTUNGSKOSTEN
         MVC   ZEITRAUM(2),INVDAY       ABRECHNUNGSZEITRAUMBEGINN
         MVC   ZEITRAUM+2(2),INVMON
         MVC   ZEITRAUM+4(2),INVYEAR
         MVC   ZEITRAUM+6(6),=CL6' '    ABRECHNUNGSZEITRAUMENDE
         MVC   KOSTENST,INVKST          KOSTENSTELLE
         MVC   KOSTENTR,INVKTR          KOSTENTRAEGER
         MVC   INDFAKZ,INVNLVKZ         NLV-NAV-KZ
         MVC   INDABTL,INVABTL          ABTEILUNG
         MVC   INDORT,INVIORT           INSTALLATIONSORT
         MVC   INDBEN,INVTUSER          TERMINAL-BENUTZER
         MVC   INDCUA,INVCA             GERAETEADRESSE
         MVC   INDTEL,INVTTEL           TELEFON
         MVC   INDLEIT,INVLNR           LEITUNGSNUMMER
         MVC   INDINVN,INVINVN          INVENTARNUMMER
         MVC   INDAART,INVAART          ABSCHREIBUNGSART
         MVC   INDABEG,INVABEG          ABSCHREIBUNGSBEGINN
         MVC   INDAEND,INVAEND          ABSCHREIBUNGSENDE
         MVC   INDABAS,INVABAS          ABSCHREIBUNGSBASIS
         MVC   INDARAT,INVARAT          ABSCHREIBUNGSRATE
         MVC   INDAKZ,INVAKZ            ALLGEMEINES KENNZEICHEN
         MVC   INDPFLG,INVUSER          USER-ID DER SATZERSTELLERS
         MVC   INDPFLD(2),TAGESDAT      DATUM DER SATZERSTELLUNG
         MVC   INDPFLD+2(2),TAGESDAT+3
         MVC   INDPFLD+4(2),TAGESDAT+6
         DROP  R9
         $EXIT
         EJECT
UPTBLD   $ENTRY
         NC    SORTTAB,SORTTAB
         BNZ   UPTBLDZ
         GETMAIN EC,LV=X'100000',A=SORTTAB
         LTR   R15,R15                  GETMAIN OKAY?
         BZ    UPTBLD1                  JA
         MVC   MSGNUM,=C'STA022A '
         B     UPTBLDZ
UPTBLD1  LA    R4,SORTLNG1+SORTLNG2
         XR    R2,R2
         L     R3,=A(X'100000')
         DR    R2,R4                    R3 = ANZAHL TABELLENPLAETZE
         LR    R4,R3
         LA    R2,SORTLNG1
         MR    R2,R2
         A     R3,SORTTAB
         ST    R3,SORTTABE
         ST    R3,SORTTABA
         ST    R3,SORTTABL
         LA    R2,SORTLNG2
         LR    R3,R4
         MR    R2,R2
         A     R3,SORTTABA
         ST    R3,SORTTABB
         LA    R9,SATZALT
         USING SORTTAB2,R7
         USING INDSATZ,R9
         LOESCH INDKEY,INDKEY,X'00'
         TAOPEN READ
         POINT RPL=GETSEQ
         GET   RPL=GETSEQ               X'0000'-SATZ LESEN
UPTBLD2  LOESCH INDINVN,INDAEND,C' '    VARIABLEN SATZTEIL LOESCHEN
         GET   RPL=GETSEQ
         CLI   INDKEY,X'FF'             LETZTER SATZ DER DATEI
         BE    UPTBLDE                  JA
         BAL   R14,UPSELDAT             WERTIGKEITSDATUM OKAY ?
         B     UPTBLD2                  NEIN
         L     R7,SORTTABL              JA, ADRESSE FREIER PLATZ
         MVC   SORTPROD,PRODKZ
         MVC   SORTTYP,TYP
         MVC   SORTMOD,MODELL
         MVC   SORTMANR,MANR
         MVC   SORTBEZ,TYPBEZ
         MVC   SORTHERS,HERSTELL
         MVC   SORTINST,INSTKZ
         MVC   SORTLIEF,DATLIEF
         MVC   SORTBEG,DATBEGIN
         MVC   SORTEND,DATENDE
         MVC   SORTABLG,ABLAGENR
         MVC   SORTBESO,BESOKZ
         MVC   SORTWART,WARTKZ
         MVC   SORTKPR-SORTTAB4+SORTNUM2,KPREIS
         MVC   SORTMPR-SORTTAB4+SORTNUM2,MPREIS
         MVC   SORTWPR-SORTTAB4+SORTNUM2,WPREIS+3
         MVC   SORTAPR-SORTTAB4+SORTNUM2,INDARAT
         MVC   SORTBPR-SORTTAB4+SORTNUM2,INDABAS
         TR    SORTKPR-SORTTAB4+SORTNUM2,TRTABDM
         TR    SORTMPR-SORTTAB4+SORTNUM2,TRTABDM
         TR    SORTWPR-SORTTAB4+SORTNUM2,TRTABDM
         TR    SORTAPR-SORTTAB4+SORTNUM2,TRTABDM
         TR    SORTBPR-SORTTAB4+SORTNUM2,TRTABDM
         MVC   SORTKST,KOSTENST
         MVC   SORTKTR,KOSTENTR
         MVC   SORTABTL,INDABTL
         MVC   SORTORT,INDORT
         MVC   SORTBEN,INDBEN
         MVC   SORTTEL,INDTEL
         MVC   SORTCUA,INDCUA
         MVC   SORTLEIT,INDLEIT
         MVC   SORTAART,INDAART
         MVC   SORTABEG,INDABEG
         MVC   SORTAEND,INDAEND
         MVC   SORTFAKZ,INDFAKZ
         MVC   SORTINVN,INDINVN
         LA    R7,SORTLNG2(R7)          ADR FREIER PLATZ ERHOEHEN
         ST    R7,SORTTABL
         C     R7,SORTTABB              TABELLE VOLL?
         BNE   UPTBLD2                  NEIN
         MVC   MSGNUM,=C'STA024A '
UPTBLDE  TACLOSE
UPTBLDZ  $EXIT
         SPACE 3
UPTBUNLD $ENTRY
         NC    SORTTAB,SORTTAB          TABELLE VORHANDEN ?
         BZ    UPTBUNLZ
         FREEMAIN EC,LV=X'100000',A=SORTTAB
         LTR   R15,R15                  FREEMAIN OKAY?
         BZ    UPTBUNLA                 JA
         MVC   MSGNUM,=C'STA023A '
         B     UPTBUNLZ
UPTBUNLA XC    SORTTAB,SORTTAB
UPTBUNLZ $EXIT
         EJECT
         USING INDSATZ,R9
         USING SORTTAB1,R6
         USING SORTTAB2,R7
UPLAUSW  $ENTRY
 XC    SORTKEY,SORTKEY          SORTKEY LOESCHEN
 MVI   SORTKEY,X'FF'
 $IF   EQ
    CLI LISTNR,X'0B'
 $AND  EQ
    CLI SORTINST,C'1'
 $OR   NE
    CLI LISTNR,X'0B'
 $AND  EQ
    CLI SORTINST,C'3'
 $THEN
    $CAS2 LISTNR
    $OF =X'01'
       MVC SORTKEY-SORTTAB1(L'INDKEY-L'LFDNR,R6),SORTPROD
    $OF =X'02'
       MVC SORTKEY-SORTTAB1(L'TYP+L'MODELL+L'MANR,R6),SORTTYP
    $OF =X'03'
       MVC SORTKEY-SORTTAB1(L'MANR,R6),SORTMANR
    $OF =X'04'
       MVC SORTKEY-SORTTAB1(L'SORTABTL,R6),SORTABTL
       MVC SORTKEY-SORTTAB1+L'SORTABTL(L'INDKEY-L'LFDNR,R6),SORTPROD
    $OF =X'05'
       MVC SORTKEY-SORTTAB1(L'KOSTENTR,R6),SORTKTR
       MVC SORTKEY-SORTTAB1+L'KOSTENTR(L'INDKEY-L'LFDNR,R6),SORTPROD
    $OF =X'06'
       $IF EQ
          CLC =C'239',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'TYP+L'MODELL,R6),SORTTYP
       $BEND
    $OF =X'07'
       $IF EQ
          CLC =C'2324',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'MANR,R6),SORTMANR
       $BEND
    $OF =X'08'
       $IF EQ
          CLC =C'2324',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'SORTABTL,R6),SORTABTL
          MVC SORTKEY-SORTTAB1+L'SORTABTL(L'SORTBEN,R6),SORTBEN
       $BEND
    $OF =X'09'
       $IF EQ
          CLC =C'2324',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'SORTLEIT,R6),SORTLEIT
       $BEND
    $OF =X'0A'
       $IF EQ
          CLC =C'2324',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'SORTCUA,R6),SORTCUA
       $BEND
    $OF =X'0B'
       MVC SORTKEY-SORTTAB1(L'INDKEY-L'LFDNR,R6),SORTPROD
    $OF =X'0C'
       $IF NE
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(2,R6),SORTEND+6
          MVC SORTKEY-SORTTAB1+2(2,R6),SORTEND+3
          MVC SORTKEY-SORTTAB1+4(2,R6),SORTEND
       $BEND
    $OF =X'0D'
       $IF NE
          CLI SORTBESO,C'1'
       $AND NE
          CLC =C'239',SORTPROD
       $THEN
          MVC SORTKEY-SORTTAB1(L'TYP+L'MODELL+L'MANR,R6),SORTTYP
       $BEND
    $OF =X'0E'
       $IF NE
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(L'KOSTENTR,R6),SORTKTR
          MVC SORTKEY-SORTTAB1+L'KOSTENTR(L'TYP,R6),SORTTYP
       $BEND
    $OF =X'0F'
       $IF EQ
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(L'KOSTENTR,R6),SORTKTR
          MVC SORTKEY-SORTTAB1+L'KOSTENTR(L'TYP,R6),SORTTYP
       $BEND
    $OF =X'10'
       $IF EQ
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(L'TYP+L'MODELL+L'MANR,R6),SORTTYP
       $BEND
    $OF =X'11'
       $IF EQ
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(L'KOSTENTR,R6),SORTKTR
          MVC SORTKEY-SORTTAB1+L'KOSTENTR(L'INDKEY-L'LFDNR,R6),SORTPROD
       $BEND
    $OF =X'12'
       $IF EQ
          CLI SORTBESO,C'1'
       $THEN
          MVC SORTKEY-SORTTAB1(L'INDKEY-L'LFDNR,R6),SORTPROD
       $BEND
    $BEND
 $BEND
 $EXIT
 EJECT
UPSELDAT $ENTRY
 MVC   WORK(2),ZEITRAUM+4               ZEITRAUM VON
 MVC   WORK+2(2),ZEITRAUM+2
 MVC   WORK+4(2),ZEITRAUM
 MVC   WORK+6(2),ZEITRAUM+10            ZEITRAUM BIS
 MVC   WORK+8(2),ZEITRAUM+8
 MVC   WORK+10(2),ZEITRAUM+6
 MVC   WORK+12(2),INVDAT6+6             WERTIGKEITSDATUM
 MVC   WORK+14(2),INVDAT6+3
 MVC   WORK+16(2),INVDAT6
 $IF EQ
    CLC   WORK+12(6),=CL6' '            WERTIGKEITSDATUM NICHT ANGEGEB.
 $OR LE
    CLC   WORK(6),WORK+12               ZEITRAUM VON <= WERTIGKEITSD.
 $AND LT
    CLC   WORK+12(6),WORK+6             WERTIGKEITSD. < ZEITRAUM BIS
 $TOR EQ
    CLC   WORK+6(6),=CL6' '             ZEITRAUM BIS OFFEN
 $THEN
    LA R15,4                            ZEITRAUM OKAY
 $ELSE
    LA R15,0                            ZEITRAUM NICHT OKAY
 $BEND
 $EXIT RC=(R15)
 EJECT
UPAUSGD  $ENTRY
 $CAS2 LISTNR
 $OF =X'01',=X'02',=X'03',=X'04',=X'05',=X'0C',=X'0D'
    LOESCH LISTB,LISTB,C' '
    MVC   LISTB1,SORTPROD
    MVC   LISTB2,SORTTYP
    MVC   LISTB3,SORTMOD
    MVC   LISTB4,SORTMANR
    MVC   LISTB5,SORTBEZ
    MVC   LISTB6,SORTORT
    MVC   LISTB7,SORTABTL
    MVC   LISTB8,SORTKST
    MVC   LISTB9,SORTKTR
    MVC   LISTB10,SORTBESO
    MVC   LISTB11,SORTBEG
    MVC   LISTB12,SORTEND
    MVC   LISTB13,SORTHERS
    MVC   LISTB14,SORTKPR-SORTTAB4+SORTNUM2
    MVC   LISTB15,SORTWPR-SORTTAB4+SORTNUM2
    MVC   LISTB16,SORTMPR-SORTTAB4+SORTNUM2+3
    $CAS2 LISTNR
    $OF =X'01'
       MVC   GRUPPNEU,SORTPROD
    $OF =X'02'
       MVC   GRUPPNEU,SORTTYP
    $OF =X'04'
       MVC   GRUPPNEU,SORTABTL
    $OF =X'05'
       MVC   GRUPPNEU,SORTKTR
    $OFREST
       XC    GRUPPNEU,GRUPPNEU
    $BEND
    $IF NE
       CLC   GRUPPALT,GRUPPNEU        GRUPPENWECHSEL ?
    $AND NZ                           JA
       NC    GRUPPALT,GRUPPALT        ERSTER GRUPPENWECHSEL ?
    $THEN                             NEIN
       LOESCH LISTFUSS,LISTFUSS,C' '
       MVC   LISTFB1(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFB1(15),GRUPKPR
       MVC   LISTFB3-3(13),=X'40204B2020204B2021206B2020'
       ED    LISTFB3-3(13),GRUPMPR
       L     R15,=A(UPZAUSG)
       CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
       LOESCH LISTFUSS,LISTFUSS,C' '
       MVC   LISTFB2-3(13),=X'40204B2020204B2021206B2020'
       ED    LISTFB2-3(13),GRUPWPR
       L     R15,=A(UPZAUSG)
       CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
       L     R15,=A(UPZAUSG)
       CALL  (15),(LEERZ,L'LEERZ,UEBB,L'UEBB)
       ZAP   GRUPKPR,=P'0'
       ZAP   GRUPWPR,=P'0'
       ZAP   GRUPMPR,=P'0'
    $BEND
    MVC   GRUPPALT,GRUPPNEU
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTB,L'LISTB,UEBB,L'UEBB)
 $OF =X'06'
    LOESCH LISTF,LISTF,C' '
    MVC   LISTF1,SORTBEZ
    MVC   LISTF2,SORTTYP
    MVC   LISTF3,SORTMOD
    MVC   LISTF4,SORTHERS
    MVC   LISTF5,SORTBESO
    MVC   LISTF6,SORTWART
    $IF NE
       CLI   SORTBESO,C'1'            KAUF?
    $THEN                          NEIN
       MVC   LISTF7,SORTMPR-SORTTAB4+SORTNUM2+3
    $ELSE
       MVC   LISTF7,SORTWPR-SORTTAB4+SORTNUM2
    $BEND
    MVC   LISTF8,SORTBEG
    MVC   LISTF9,SORTEND
    MVC   LISTF10,SORTABLG
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTF,L'LISTF,UEBF,L'UEBF)
 $OF =X'07',=X'08',=X'09',=X'0A'
    LOESCH LISTH,LISTH,C' '
    MVC   LISTH1,SORTMANR
    MVC   LISTH2,SORTCUA
    LM    R14,R15,ADDRABTL
    BSUCH 0(R14),0(R15),L'TABABTL,0,L'TABABTLN,SORTABTL
    ST    R15,DOWO
    $CAS2 DOWO+3
    $OF =X'00'                     ABTEILUNG GEFUNDEN
       MVC   LISTH3,4(R1)
    $OF =X'04'                     ABTEILUNG NICHT GEFUNDEN
       MVC   LISTH3,=CL16'ABTEILUNG : XXXX'
       MVC   LISTH3+12(4),SORTABTL
    $OF =X'08'                     INTERNER FEHLER
       MVC   LISTH3,=CL16'INTERNER FEHLER'
    $BEND
    MVC   LISTH4,SORTBEN
    MVC   LISTH5,SORTTEL
    MVC   LISTH6,SORTORT
    MVC   LISTH7,SORTTYP
    MVC   LISTH8,SORTMOD
    MVC   LISTH9,SORTLEIT
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTH,L'LISTH,UEBH,L'UEBH)
 $OF =X'0B'
    LOESCH LISTL,LISTL,C' '
    MVC   LISTL1,SORTPROD
    MVC   LISTL2,SORTTYP
    MVC   LISTL3,SORTMOD
    MVC   LISTL4,SORTMANR
    MVC   LISTL5,SORTBEZ
    MVC   LISTL6,SORTLIEF
    MVC   LISTL7,SORTORT
    MVC   LISTL8,SORTABTL
    MVC   LISTL9,SORTKST
    MVC   LISTL10,SORTKTR
    MVC   LISTL11,SORTKPR-SORTTAB4+SORTNUM2
    MVC   LISTL12,SORTMPR-SORTTAB4+SORTNUM2
    MVC   LISTL13,SORTWPR-SORTTAB4+SORTNUM2
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTL,L'LISTL,UEBL,L'UEBL)
 $OF =X'0E'
    LOESCH LISTC,LISTC,C' '
    MVC   LISTC1,SORTPROD
    MVC   LISTC2,SORTTYP
    MVC   LISTC3,SORTMOD
    MVC   LISTC4,SORTMANR
    MVC   LISTC5,SORTBEZ
    MVC   LISTC6,SORTORT
    MVC   LISTC7,SORTABTL
    MVC   LISTC8,SORTKST
    MVC   LISTC9,SORTKTR
    MVC   LISTC10,SORTBESO
    MVC   LISTC11,SORTBEG
    MVC   LISTC12,SORTEND
    MVC   LISTC13,SORTHERS
    MVC   LISTC14,SORTMPR-SORTTAB4+SORTNUM2
    MVC   LISTC15,SORTKPR-SORTTAB4+SORTNUM2
    MVC   GRUPPNEU,SORTKTR
    $IF NE
       CLC   GRUPPALT,GRUPPNEU        GRUPPENWECHSEL ?
    $AND NZ                           JA
       NC    GRUPPALT,GRUPPALT        ERSTER GRUPPENWECHSEL ?
    $THEN                             NEIN
       LOESCH LISTFUSS,LISTFUSS,C' '
       MVC   LISTFC1(13),=X'40204B2020204B2021206B2020'
       ED    LISTFC1(13),GRUPMPR
       MVC   LISTFC2(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFC2(15),GRUPKPR
       L     R15,=A(UPZAUSG)
       CALL  (15),(LISTFUSS,L'LISTFUSS,UEBC,L'UEBC)
       L     R15,=A(UPZAUSG)
       CALL  (15),(LEERZ,L'LEERZ,UEBC,L'UEBC)
       ZAP   GRUPKPR,=P'0'
       ZAP   GRUPWPR,=P'0'
       ZAP   GRUPMPR,=P'0'
    $BEND
    MVC   GRUPPALT,GRUPPNEU
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTC,L'LISTC,UEBC,L'UEBC)
 $OF =X'0F'
    LOESCH LISTD,LISTD,C' '
    MVC   LISTD1,SORTPROD
    MVC   LISTD2,SORTTYP
    MVC   LISTD3,SORTMOD
    MVC   LISTD4,SORTMANR
    MVC   LISTD5,SORTBEZ
    MVC   LISTD6,SORTORT
    MVC   LISTD7,SORTABTL
    MVC   LISTD8,SORTKST
    MVC   LISTD9,SORTKTR
    MVC   LISTD10,SORTBESO
    MVC   LISTD11,SORTBEG
    MVC   LISTD12,SORTHERS
    MVC   LISTD13,SORTWPR-SORTTAB4+SORTNUM2
    MVC   LISTD14,SORTKPR-SORTTAB4+SORTNUM2
    MVC   GRUPPNEU,SORTKTR
    $IF NE
       CLC   GRUPPALT,GRUPPNEU        GRUPPENWECHSEL ?
    $AND NZ                           JA
       NC    GRUPPALT,GRUPPALT        ERSTER GRUPPENWECHSEL ?
    $THEN                             NEIN
       LOESCH LISTFUSS,LISTFUSS,C' '
       MVC   LISTFD1(10),=X'4020204B2021206B2020'
       ED    LISTFD1(10),GRUPWPR+1
       MVC   LISTFD2(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFD2(15),GRUPKPR
       L     R15,=A(UPZAUSG)
       CALL  (15),(LISTFUSS,L'LISTFUSS,UEBD,L'UEBD)
       L     R15,=A(UPZAUSG)
       CALL  (15),(LEERZ,L'LEERZ,UEBD,L'UEBD)
       ZAP   GRUPKPR,=P'0'
       ZAP   GRUPWPR,=P'0'
       ZAP   GRUPMPR,=P'0'
    $BEND
    MVC   GRUPPALT,GRUPPNEU
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTD,L'LISTD,UEBD,L'UEBD)
 $OF =X'10',=X'11',=X'12'
    LOESCH LISTA,LISTA,C' '
    MVC   LISTA1,SORTPROD
    MVC   LISTA2,SORTTYP
    MVC   LISTA3,SORTMOD
    MVC   LISTA4,SORTMANR
    MVC   LISTA5,SORTINVN
    MVC   LISTA6,SORTBEZ
    MVC   LISTA7,SORTKTR
    MVC   LISTA8,SORTAART
    MVC   LISTA9,SORTABEG+3
    MVC   LISTA10,SORTAEND+3
    MVC   LISTA11,SORTFAKZ
    MVC   LISTA12,SORTKPR-SORTTAB4+SORTNUM2
    MVC   LISTA13,SORTBPR-SORTTAB4+SORTNUM2
    MVC   LISTA14,SORTAPR-SORTTAB4+SORTNUM2
    $CAS2 LISTNR
    $OF =X'10'
       MVC   GRUPPNEU,SORTTYP
    $OF =X'11'
       MVC   GRUPPNEU,SORTKTR
    $OF =X'12'
       MVC   GRUPPNEU,SORTPROD
    $BEND
    $IF NE
       CLC   GRUPPALT,GRUPPNEU        GRUPPENWECHSEL ?
    $AND NZ                           JA
       NC    GRUPPALT,GRUPPALT        ERSTER GRUPPENWECHSEL ?
    $THEN                             NEIN
       LOESCH LISTFUSS,LISTFUSS,C' '
       MVC   LISTFA3(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFA3(15),GRUPAPR
       MVC   LISTFA2(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFA2(15),GRUPBPR
       MVC   LISTFA1(15),=X'402020204B2020204B2021206B2020'
       ED    LISTFA1(15),GRUPKPR
       L     R15,=A(UPZAUSG)
       CALL  (15),(LISTFUSS,L'LISTFUSS,UEBA,L'UEBA)
       L     R15,=A(UPZAUSG)
       CALL  (15),(LEERZ,L'LEERZ,UEBA,L'UEBA)
       ZAP   GRUPAPR,=P'0'
       ZAP   GRUPBPR,=P'0'
       ZAP   GRUPKPR,=P'0'
    $BEND
    MVC   GRUPPALT,GRUPPNEU
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTA,L'LISTA,UEBA,L'UEBA)
 $BEND
 $EXIT
 EJECT
UPLANF   $ENTRY
 MVC   UEBTEXT(UEBDATUM-1-UEBTEXT),UEBTEXT-1
 MVC   UEBDATUM(8),TAGESDAT
 $CAS2 LISTNR
 $OF =X'01'
    MVC   UEBTEXT(45),=C' GESAMTAUSWERTUNG NACH PRODUKTIDENTIFIKATION '
 $OF =X'02'
    MVC   UEBTEXT(27),=C' GESAMTAUSWERTUNG NACH TYP '
 $OF =X'03'
    MVC   UEBTEXT(40),=C' GESAMTAUSWERTUNG NACH MASCHINEN-NUMMER '
 $OF =X'04'
    MVC   UEBTEXT(33),=C' GESAMTAUSWERTUNG NACH ABTEILUNG '
 $OF =X'05'
    MVC   UEBTEXT(36),=C' GESAMTAUSWERTUNG NACH KOSTENTRGER '
 $OF =X'06'
    MVC   UEBTEXT(42),=C' LISTE DER PROGRAMME NACH PROGRAMM-NUMMER '
 $OF =X'07'
    MVC   UEBTEXT(43),=C' LISTE DER TERMINALS NACH MASCHINEN-NUMMER '
 $OF =X'08'
    MVC   UEBTEXT(36),=C' LISTE DER TERMINALS NACH ABTEILUNG '
 $OF =X'09'
    MVC   UEBTEXT(42),=C' LISTE DER TERMINALS NACH LEITUNGS-NUMMER '
 $OF =X'0A'
    MVC   UEBTEXT(40),=C' LISTE DER TERMINALS NACH GERTEADRESSE '
 $OF =X'0B'
    MVC   UEBTEXT(36),=C' LISTE DER GEPLANTEN INSTALLATIONEN '
 $OF =X'0C'
    MVC   UEBTEXT(38),=C' LISTE DER MIETPRODUKTE NACH MIETENDE '
 $OF =X'0D'
    MVC   UEBTEXT(32),=C' LISTE DER MIETGERAETE NACH TYP '
 $OF =X'0E'
    MVC   UEBTEXT(40),=C' LISTE DER MIETKOSTEN NACH KOSTENTRGER '
 $OF =X'0F'
    MVC   UEBTEXT(44),=C' LISTE DER WARTUNGSKOSTEN NACH KOSTENTRGER '
 $OF =X'10'
    MVC   UEBTEXT(40),=C' LISTE DER ABSCHREIBUNGSKOSTEN NACH TYP '
 $OF =X'11'
    MVC   UEBTEXT(49),=C' LISTE DER ABSCHREIBUNGSKOSTEN NACH KOSTENTRG*
               ER '
 $OF =X'12'
    MVC   UEBTEXT(58),=C' LISTE DER ABSCHREIBUNGSKOSTEN NACH PRODUKTIDE*
               NTIFIKATION '
 $BEND
 $EXIT
 EJECT
UPLEND   $ENTRY
 $CAS2 LISTNR
 $OF =X'06'
    MVC   LISTFF1P(10),=X'4020204B2021206B2020'
    ED    LISTFF1P(10),SUMMPR+1
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFF1,L'LISTFF1,UEBF,L'UEBF)
    MVC   LISTFF2P(10),=X'4020204B2021206B2020'
    ED    LISTFF2P(10),SUMWPR+1
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFF2,L'LISTFF2,UEBF,L'UEBF)
 $OF =X'0E'
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFC1(13),=X'40204B2020204B2021206B2020'
    ED    LISTFC1(13),GRUPMPR
    MVC   LISTFC2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFC2(15),GRUPKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBC,L'UEBC)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBC,L'UEBC)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFC1(13),=X'40204B2020204B2021206B2020'
    ED    LISTFC1(13),SUMMPR
    MVC   LISTFC2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFC2(15),SUMKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBC,L'UEBC)
 $OF =X'0F'
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFD1(10),=X'4020204B2021206B2020'
    ED    LISTFD1(10),GRUPWPR+1
    MVC   LISTFD2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFD2(15),GRUPKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBD,L'UEBD)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBD,L'UEBD)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFD1(10),=X'4020204B2021206B2020'
    ED    LISTFD1(10),SUMWPR+1
    MVC   LISTFD2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFD2(15),SUMKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBD,L'UEBD)
 $OF =X'01',=X'02',=X'04',=X'05'
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFB1(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFB1(15),GRUPKPR
    MVC   LISTFB3-3(13),=X'40204B2020204B2021206B2020'
    ED    LISTFB3-3(13),GRUPMPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFB2-3(13),=X'40204B2020204B2021206B2020'
    ED    LISTFB2-3(13),GRUPWPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBB,L'UEBB)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFB1(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFB1(15),SUMKPR
    MVC   LISTFB3-3(13),=X'40204B2020204B2021206B2020'
    ED    LISTFB3-3(13),SUMMPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFB2-3(13),=X'40204B2020204B2021206B2020'
    ED    LISTFB2-3(13),SUMWPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBB,L'UEBB)
 $OF =X'10',=X'11',=X'12'
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFA3(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA3(15),GRUPAPR
    MVC   LISTFA2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA2(15),GRUPBPR
    MVC   LISTFA1(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA1(15),GRUPKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBB,L'UEBB)
    LOESCH LISTFUSS,LISTFUSS,C' '
    MVC   LISTFA3(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA3(15),SUMAPR
    MVC   LISTFA2(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA2(15),SUMBPR
    MVC   LISTFA1(15),=X'402020204B2020204B2021206B2020'
    ED    LISTFA1(15),SUMKPR
    L     R15,=A(UPZAUSG)
    CALL  (15),(LISTFUSS,L'LISTFUSS,UEBB,L'UEBB)
    L     R15,=A(UPZAUSG)
    CALL  (15),(LEERZ,L'LEERZ,UEBB,L'UEBB)
 $BEND
 $EXIT
 EJECT
UPZAUSG  $ENTRY
 LM    R2,R5,0(R1)              PARAMETER LADEN
 $IF NE
    CLI WAUSG,WAUSGJ
 $THEN
    MVI WAUSG,WAUSGJ
    $CAS2 INVLIST
    $OF =C'P'
       OPEN  (D001OS99,(EXTEND))
    $OF =C'B',=C'E'
       OPEN  (D002OS99,(OUTPUT))
    $BEND
 $BEND
 $IF   GE
    CP    ZEILENZ,ZEILENZD         VORSCHUB?
 $THEN
    OUTPUT LEERZ,L'LEERZ,PAGE
    ZAP   ZEILENZ,=P'4'
    AP    SEITENZ,=P'1'
    LA    1,UEB-10
    A     1,ZEILENL                ZEILENLAENGE
    MVC   0(6,1),=C' SEITE'
    MVC   6(4,1),=X'40202120'
    ED    6(4,1),SEITENZ
    OUTPUT UEB,L'UEB
    OUTPUT LEERZ,L'LEERZ
    OUTPUT 0(R4),0(R5)
    OUTPUT STRICHZ,0(R5)
 $BEND
 AP    ZEILENZ,=P'1'
 OUTPUT 0(R2),0(R3)
 $EXIT
 EJECT
UPSUM    $ENTRY
         USING SORTTAB4,R5
         MVC   WORK(3),SORTKPR
         MVC   WORK+3(3),SORTKPR+4
         MVC   WORK+6(3),SORTKPR+8
         MVC   WORK+9(2),SORTKPR+12
         PACK  DOWO(6),WORK(11)
         AP    SUMKPR,DOWO(6)
         AP    GRUPKPR,DOWO(6)
         MVC   WORK(2),SORTMPR
         MVC   WORK+1(3),SORTMPR+2
         MVC   WORK+4(3),SORTMPR+6
         MVC   WORK+7(2),SORTMPR+10
         PACK  DOWO(5),WORK(9)
         AP    SUMMPR,DOWO(5)
         AP    GRUPMPR,DOWO(5)
         MVC   WORK(2),SORTWPR
         MVC   WORK+2(3),SORTWPR+3
         MVC   WORK+5(2),SORTWPR+7
         PACK  DOWO(4),WORK(7)
         AP    SUMWPR,DOWO(4)
         AP    GRUPWPR,DOWO(4)
         MVC   WORK(3),SORTAPR
         MVC   WORK+3(3),SORTAPR+4
         MVC   WORK+6(3),SORTAPR+8
         MVC   WORK+9(2),SORTAPR+12
         OI    WORK+10,C'0'
         PACK  DOWO(6),WORK(11)
         AP    SUMAPR,DOWO(6)
         AP    GRUPAPR,DOWO(6)
         MVC   WORK(3),SORTBPR
         MVC   WORK+3(3),SORTBPR+4
         MVC   WORK+6(3),SORTBPR+8
         MVC   WORK+9(2),SORTBPR+12
         OI    WORK+10,C'0'
         PACK  DOWO(6),WORK(11)
         AP    SUMBPR,DOWO(6)
         AP    GRUPBPR,DOWO(6)
         DROP  R7
         $EXIT
         EJECT
UPSCAN   $ENTRY
         LA    R8,1
         ST    R8,CNTLEVEL
         L     R8,ADRFIND
         MVC   0(4,R8),=X'47F0E004'
         L     R8,ADRSORT
         MVC   0(2,R8),=X'07FE'
         MVC   CNTAREA,ADRAREA
         MVC   CNTFIND,ADRFIND
         MVC   CNTSORT,ADRSORT
         MVC   CNTLIST,ADRLIST
         MVC   CNTLITER,ADRLITER
         MVC   CNTSUMZ,ADRSUMZ
         MVC   STACKAAD,=A(STACKAND)
         MVC   STACKOAD,=A(STACKOR)
         XC    LNGSORT,LNGSORT
         XC    LNGLIST,LNGLIST
         LOESCH UEBZ,UEBZ,C' '
         MVC   UEBTEXT(UEBDATUM-1-UEBTEXT),UEBTEXT-1
         MVC   UEBDATUM(8),TAGESDAT
         BAL   R14,UPSYMB
         B     UPSCANEZ
UPSCANA  CLC   SYMBOL(5),=CL5'FIND'
         BNE   UPSCANB
UPSCANA1 BAL   R14,UPSYMB
         B     UPSCANEZ
         CLC   SYMBOL(2),=CL2'('
         BNE   UPSCANA2
         L     R8,CNTLEVEL
         LA    R8,1(R8)
         ST    R8,CNTLEVEL
         B     UPSCANA1
UPSCANA2 BAL   R14,UPNAME
         B     UPSCANE1
         BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPOPER
         B     UPSCANE2
         BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPLITER
         B     UPSCANEZ
         BAL   R14,UPVERGL
UPSCANA3 BAL   R14,UPSYMB
         B     UPSCANEZ
         CLC   SYMBOL(2),=CL2')'
         BNE   UPSCANA4
         L     R8,CNTLEVEL
         S     R8,F1
         BNP   UPSCANE4
         ST    R8,CNTLEVEL
         B     UPSCANA3
UPSCANA4 CLC   SYMBOL(4),=CL4'AND'
         BNE   UPSCANA5
         BAL   R14,UPAND
         B     UPSCANE5
         B     UPSCANA1
UPSCANA5 CLC   SYMBOL(3),=CL3'OR'
         BNE   UPSCANA6
         BAL   R14,UPOR
         B     UPSCANE6
         B     UPSCANA1
UPSCANA6 LA    R8,1
         C     R8,CNTLEVEL
         BNE   UPSCANE7
         BAL   R14,UPFINDR
UPSCANB  CLC   SYMBOL(5),=CL5'SORT'
         BNE   UPSCANC
         BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPNAME
         B     UPSCANE1
         BAL   R14,UPSORT1
         B     UPSCANEZ
UPSCANB1 BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPNAME
         B     UPSCANB2
         BAL   R14,UPSORT1
         B     UPSCANEZ
         B     UPSCANB1
UPSCANB2 BAL   R14,UPSORT2
UPSCANC  CLC   SYMBOL(5),=CL5'EDIT'
         MVI   INVLIST,C'E'
         BE    UPSCANC0
         CLC   SYMBOL(5),=CL6'BROWSE'
         MVI   INVLIST,C'B'
         BE    UPSCANC0
         CLC   SYMBOL(6),=CL6'PRINT'
         BNE   UPSCANE8
         MVI   INVLIST,C'P'
UPSCANC0 BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPNAME
         B     UPSCANE1
         BAL   R14,UPLST1
         B     UPSCANEZ
UPSCANC1 BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPNAME
         B     UPSCANC2
         BAL   R14,UPLST1
         B     UPSCANEZ
         B     UPSCANC1
UPSCANC2 BAL   R14,UPLST2
UPSCAND  CLC   SYMBOL(6),=CL6'TITLE'
         BNE   UPSCANF
         BAL   R14,UPSYMB
         B     UPSCANEZ
         BAL   R14,UPTITLE
         B     UPSCANEZ
         BAL   R14,UPSYMB
         B     UPSCANEZ
UPSCANF  CLC   SYMBOL(2),=CL2'.'
         BE    UPSCANZ
UPSCANE0 MVC   MSGNUM,=C'STA031A '
         B     UPSCANEZ
UPSCANE1 MVC   MSGNUM,=C'STA032A '
         B     UPSCANEZ
UPSCANE2 MVC   MSGNUM,=C'STA033A '
         B     UPSCANEZ
UPSCANE4 MVC   MSGNUM,=C'STA035A '
         B     UPSCANEZ
UPSCANE5 MVC   MSGNUM,=C'STA036A '
         B     UPSCANEZ
UPSCANE6 MVC   MSGNUM,=C'STA037A '
         B     UPSCANEZ
UPSCANE7 MVC   MSGNUM,=C'STA038A '
         B     UPSCANEZ
UPSCANE8 MVC   MSGNUM,=C'STA046A '
UPSCANEZ L     R8,CNTERROR
         MVI   0(R8),C'?'
         $EXIT
UPSCANZ  $EXIT RC=4
         EJECT
UPSYMB   $ENTRY
         MVI   SYMBOL,C' '
         MVC   SYMBOL+1(L'SYMBOL-1),SYMBOL
         XC    LNGSYMBL,LNGSYMBL
         L     R8,CNTAREA
         ST    R8,CNTERROR
UPSYMB1  CLI   0(R8),C' '
         BNE   UPSYMB2
         LA    R8,1(R8)
         B     UPSYMB1
UPSYMB2  CLI   0(R8),X'00'
         BE    UPSYMBE1
         ST    R8,CNTERROR
         CLI   0(R8),C'.'
         BE    UPSYMBS
         CLI   0(R8),C'='
         BE    UPSYMBS
         CLI   0(R8),C'('
         BE    UPSYMBS
         CLI   0(R8),C')'
         BE    UPSYMBS
         CLC   0(2,R8),=C'<='
         BE    UPSYMBO
         CLC   0(2,R8),=C'>='
         BE    UPSYMBO
         CLC   0(2,R8),=C'<>'
         BE    UPSYMBO
         CLI   0(R8),C'<'
         BE    UPSYMBS
         CLI   0(R8),C'>'
         BE    UPSYMBS
         LR    R9,R8
         CLC   0(2,R8),=C'X'''
         BE    UPSYMBX
         CLC   0(2,R8),=C'C'''
         BE    UPSYMBC
         CLI   0(R8),C''''
         BE    UPSYMBCO
         CLI   0(R8),C'A'
         BL    UPSYMBE2
         CLI   0(R8),C'Z'
         BH    UPSYMBE2
UPSYMBN  LA    R8,1(R8)
         CLI   0(R8),C'A'
         BL    UPSYMBN1
         CLI   0(R8),C'9'
         BNH   UPSYMBN
UPSYMBN1 ST    R8,CNTAREA
         SR    R8,R9
         C     R8,F8
         BH    UPSYMBE3
         STH   R8,LNGSYMBL
         BCTR  R8,0
         EX    R8,UPSYMBV
         B     UPSYMBZ
UPSYMBS  MVC   SYMBOL(1),0(R8)
         LA    R8,1(R8)
         ST    R8,CNTAREA
         MVC   LNGSYMBL,F1+2
         B     UPSYMBZ
UPSYMBO  MVC   SYMBOL(2),0(R8)
         LA    R8,2(R8)
         ST    R8,CNTAREA
         MVC   LNGSYMBL,F2+2
         B     UPSYMBZ
UPSYMBX  LA    R8,2(R8)
UPSYMBX1 CLI   0(R8),C'A'
         BL    UPSYMBE4
         CLI   0(R8),C'F'
         BNH   UPSYMBX2
         CLI   0(R8),C'0'
         BL    UPSYMBE4
         CLI   0(R8),C'9'
         BH    UPSYMBE4
UPSYMBX2 LA    R8,1(R8)
         CLI   0(R8),C''''
         BNE   UPSYMBX1
         LA    R8,1(R8)
         ST    R8,CNTAREA
         SR    R8,R9
         C     R8,=F'63'
         BH    UPSYMBE5
         STH   R8,LNGSYMBL
         BCTR  R8,0
         EX    R8,UPSYMBV
         B     UPSYMBZ
UPSYMBC  LA    R8,1(R8)
UPSYMBCO LA    R8,1(R8)
         MVC   SYMBOL(2),=C'C'''
         LA    R9,SYMBOL+2
         LA    R7,2
         CLI   0(R8),C''''
         BNE   UPSYMBC1
         CLI   1(R8),C''''
         BNE   UPSYMBE4
UPSYMBC1 MVC   0(1,R9),0(R8)
         LA    R7,1(R7)
         C     R7,=F'63'
         BH    UPSYMBE5
         LA    R9,1(R9)
         CLI   0(R8),C''''
         LA    R8,1(R8)
         BNE   UPSYMBC1
         CLI   0(R8),C''''
         BNE   UPSYMBC2
         LA    R8,1(R8)
         B     UPSYMBC1
UPSYMBC2 ST    R8,CNTAREA
         STH   R7,LNGSYMBL
         B     UPSYMBZ
UPSYMBE1 MVC   MSGNUM,=C'STA041A '
         B     UPSYMBEZ
UPSYMBE2 MVC   MSGNUM,=C'STA031A '
         B     UPSYMBEZ
UPSYMBE3 MVC   MSGNUM,=C'STA043A '
         B     UPSYMBEZ
UPSYMBE4 MVC   MSGNUM,=C'STA044A '
         B     UPSYMBEZ
UPSYMBE5 MVC   MSGNUM,=C'STA034A '
UPSYMBEZ $EXIT
UPSYMBZ  $EXIT RC=4
         SPACE 3
UPSYMBV  MVC   SYMBOL(0),0(R9)
         EJECT
UPNAME   $ENTRY
         L     R8,DDTAB
UPNAME1  C     R8,DDTABE
         BE    UPNAMEE
         CLC   0(L'DDNM,R8),SYMBOL
         BE    UPNAME2
         LA    R8,L'DDELEM(R8)
         B     UPNAME1
UPNAME2  ST    R8,ADRNM
         $EXIT RC=4
UPNAMEE  $EXIT
         SPACE 3
UPOPER   $ENTRY
         L     R8,OPTAB
UPOPER1  C     R8,OPTABE
         BE    UPOPERE
         CLC   0(L'OPOPCODE,R8),SYMBOL
         BE    UPOPER2
         LA    R8,L'OPELEM(R8)
         B     UPOPER1
UPOPER2  ST    R8,ADROP
         $EXIT RC=4
UPOPERE  $EXIT
         SPACE 3
UPLITER  $ENTRY
         LH    R8,LNGSYMBL
         S     R8,F3
         BNP   UPLITE2
         L     R7,ADRNM
         XR    R9,R9
UPLITER0 XR    R6,R6
         IC    R6,DDLNG-DDELEM(R7)
         AR    R9,R6
         CLI   DDOP-DDELEM(R7),C'A'
         BNE   UPLITER1
         LA    R7,L'DDELEM(R7)
         B     UPLITER0
UPLITER1 CLC   SYMBOL(2),=C'C'''
         BE    UPLITC
         CLC   SYMBOL(2),=C'X'''
         BNE   UPLITE2
UPLITX   MVI   SATZALT,X'00'
         MVC   SATZALT+1(255),SATZALT
         SLL   R9,1
         CLR   R8,R9
         BH    UPLITE1
         LA    R6,SATZALT(R9)
         SR    R6,R8
         BCTR  R8,0
         EX    R8,UPLITXM
         BCTR  R9,0
         EX    R9,UPLITXT
         LA    R5,SATZALT+1(R9)
         LA    R4,SATZALT
         LA    R3,SATZALT+300
UPLITX1  PACK  0(5,R3),0(9,R4)
         LA    R3,4(R3)
         LA    R4,8(R4)
         CLR   R4,R5
         BL    UPLITX1
         LA    R9,1(R9)
         SRL   R9,1
         B     UPLITG
UPLITC   MVI   SATZALT+300,C' '
         MVC   SATZALT+301(255),SATZALT+300
         CLR   R8,R9
         BH    UPLITE1
         BCTR  R8,0
         EX    R8,UPLITCM
UPLITG   BCTR  R9,0
         L     R8,CNTLITER
         ST    R8,ADRLIT
         EX    R9,UPLITVM
         LA    R8,1(R9,R8)
         ST    R8,CNTLITER
         $EXIT RC=4
UPLITE1  MVC   MSGNUM,=C'STA034A '
         B     UPLITERE
UPLITE2  MVC   MSGNUM,=C'STA044A '
UPLITERE $EXIT
         SPACE 3
UPLITXM  MVC   0(0,R6),SYMBOL+2
UPLITXT  TR    SATZALT(0),TRTABPK-193
UPLITCM  MVC   SATZALT+300(0),SYMBOL+2
UPLITVM  MVC   0(0,R8),SATZALT+300
         EJECT
UPVERGL  $ENTRY
         L     R8,CNTLEVEL
         LA    R8,1(R8)
         ST    R8,CNTLEVEL
         L     R7,ADRNM
         L     R8,ADROP
         L     R9,ADRLIT
UPVERGL1 L     R6,CNTFIND
         MVI   0(R6),X'D5'
         XR    R5,R5
         IC    R5,DDLNG-DDELEM(R7)
         BCTR  R5,0
         STC   R5,1(R6)
         MVC   2(2,R6),DDDSP-DDELEM(R7)
         OI    2(R6),X'90'
         LR    R4,R9
         S     R4,ADRLITER
         STH   R4,4(R6)
         OI    4(R6),X'80'
         LA    R6,6(R6)
         ST    R6,CNTFIND
         CLI   DDOP-DDELEM(R7),C' '
         BE    UPVERGL3
         CLI   DDOP-DDELEM(R7),C'A'
         BNE   UPVERGL2
         LA    R7,L'DDELEM(R7)
         LA    R9,1(R5,R9)
         BAL   R14,UPAND
         B     UPVERGL3                 FEHLER
         B     UPVERGL1
UPVERGL2 LA    R7,L'DDELEM(R7)
         L     R9,ADRLIT
         BAL   R14,UPOR
         B     UPVERGL3                 FEHLER
         B     UPVERGL1
UPVERGL3 L     R8,CNTLEVEL
         BCTR  R8,0
         ST    R8,CNTLEVEL
         $EXIT
         EJECT
UPAND    $ENTRY
         L     R4,ADROP
         L     R5,CNTFIND
         MVI   0(R5),X'47'
         MVC   1(L'OPFMASKE,R5),OPFMASKE-OPELEM(R4)
         L     R3,STACKAAD
         LA    R5,2(R5)
         ST    R5,0(R3)
         MVC   0(1,R3),CNTLEVEL+3
         LA    R3,4(R3)
         ST    R3,STACKAAD
         C     R3,=A(STACKAND+40)       STACKENDE ERREICHT ?
         BE    UPANDE                   JA, FEHLER
         LA    R5,2(R5)
         ST    R5,CNTFIND
         S     R5,ADRFIND
UPAND1   L     R3,STACKOAD
         C     R3,=A(STACKOR)
         BE    UPANDZ
         S     R3,F4
         CLC   0(1,R3),CNTLEVEL+3
         BNH   UPANDZ
         XR    R2,R2
         ICM   R2,7,1(R3)
         STH   R5,0(R2)
         OI    0(R2),X'F0'
         ST    R3,STACKOAD
         B     UPAND1
UPANDE   $EXIT
UPANDZ   $EXIT RC=4
         EJECT
UPOR     $ENTRY
         L     R4,ADROP
         L     R5,CNTFIND
         MVI   0(R5),X'47'
         MVC   1(L'OPWMASKE,R5),OPWMASKE-OPELEM(R4)
         L     R3,STACKOAD
         LA    R5,2(R5)
         ST    R5,0(R3)
         MVC   0(1,R3),CNTLEVEL+3
         LA    R3,4(R3)
         ST    R3,STACKOAD
         C     R3,=A(STACKOR+40)        STACKENDE ERREICHT ?
         BE    UPORE                    JA, FEHLER
         LA    R5,2(R5)
         ST    R5,CNTFIND
         S     R5,ADRFIND
UPOR1    L     R3,STACKAAD
         C     R3,=A(STACKAND)
         BE    UPORZ
         S     R3,F4
         CLC   0(1,R3),CNTLEVEL+3
         BL    UPORZ
         XR    R2,R2
         ICM   R2,7,1(R3)
         STH   R5,0(R2)
         OI    0(R2),X'F0'
         ST    R3,STACKAAD
         B     UPOR1
UPORE    $EXIT
UPORZ    $EXIT RC=4
         EJECT
UPFINDR  $ENTRY
         L     R9,STACKAAD
UPFINDR1 C     R9,=A(STACKAND)
         BE    UPFINDR2
         S     R9,F4
         XR    R8,R8
         ICM   R8,7,1(R9)
         MVC   0(2,R8),=X'E000'
         B     UPFINDR1
UPFINDR2 ST    R9,STACKAAD
         L     R9,STACKOAD
UPFINDR3 C     R9,=A(STACKOR)
         BE    UPFINDR4
         S     R9,F4
         XR    R8,R8
         ICM   R8,7,1(R9)
         MVC   0(2,R8),=X'E004'
         B     UPFINDR3
UPFINDR4 ST    R9,STACKOAD
         L     R9,CNTFIND
         MVC   0(6,R9),=X'4700E00407FE'
         L     R8,ADROP
         MVC   1(L'OPWMASKE,R9),OPWMASKE-OPELEM(R8)
         LA    R9,6(R9)
         ST    R9,CNTFIND
         $EXIT
         EJECT
UPSORT1  $ENTRY
         L     R6,ADRNM
         XR    R7,R7
         IC    R7,DDLNG-DDELEM(R6)
         L     R8,LNGSORT
         LA    R5,0(R7,R8)
         C     R5,=A(L'SORTFLD)         ZU VIELE SORTIERFELDER ?
         BH    UPSORT1E                 JA, FEHLERMELDUNG
         ST    R5,LNGSORT
         L     R9,CNTSORT
         MVI   0(R9),X'D2'
         BCTR  R7,0
         STC   R7,1(R9)
         STH   R8,2(R9)
         OI    2(R9),X'70'
         MVC   4(L'DDDSP,R9),DDDSP-DDELEM(R6)
         OI    4(R9),X'90'
         LA    R9,6(R9)
         ST    R9,CNTSORT
         $EXIT RC=4
UPSORT1E MVC   MSGNUM,=C'STA039A '
         $EXIT
         SPACE 3
UPSORT2  $ENTRY
         L     R9,CNTSORT
         MVC   0(2,R9),=X'07FE'
         LA    R9,2(R9)
         ST    R9,CNTSORT
         $EXIT
         EJECT
UPLST1   $ENTRY
         L     R9,ADRNM
         XR    R8,R8
         IC    R8,DDLNG-DDELEM(R9)
         L     R7,LNGLIST
         LTR   R7,R7
         BZ    UPLST12
         LA    R7,1(R7)
UPLST12  LA    R6,0(R7,R8)
         C     R6,ZEILENL               ZEILE ZU LANG ?
         BH    UPLST1E                  JA
         ST    R6,LNGLIST
         BCTR  R8,0
         LA    R5,UEBZ(R7)
         C     R8,=F'23'
         BNH   UPLST11
         L     R8,=F'23'
UPLST11  EX    R8,UPLST1M
         L     R5,CNTLIST
         LR    R4,R5
         MVI   0(R5),X'D2'              MVC-OPCODE
         IC    R8,DDLNG-DDELEM(R9)
         BCTR  R8,0
         STC   R8,1(R5)
         STH   R7,2(R5)
         OI    2(R5),X'70'              BASISREGISTER EMPFANGSFELD
         MVC   4(L'DDDSP,R5),DDDSP-DDELEM(R9)
         OI    4(R5),X'90'              BASISREGISTER SENDEFELD
         LA    R5,6(R5)
         ST    R5,CNTLIST
         CLC   DDNM-DDELEM+1(5,R9),=C'PREIS' ZU ADDIERENDES FELD ?
         BNE   UPLST1Z                  NEIN
         L     R5,CNTSUMZ
         MVC   0(6,R5),0(R4)            SUMMENWERT UEBERTRAGEN
         LA    R5,6(R5)
         ST    R5,CNTSUMZ
UPLST1Z  $EXIT RC=4
UPLST1E  MVC   MSGNUM,=C'STA042A '
         $EXIT
         SPACE 3
UPLST1M  MVC   0(0,R5),DDTIT-DDELEM(9)
         EJECT
UPLST2   $ENTRY
         L     R9,CNTLIST
         MVC   0(2,R9),=X'07FE'
         LA    R9,2(R9)
         ST    R9,CNTLIST
         L     R9,CNTSUMZ
         MVC   0(2,R9),=X'07FE'
         LA    R9,2(R9)
         ST    R9,CNTSUMZ
         $EXIT
         SPACE 3
UPTITLE  $ENTRY
         LH    R9,LNGSYMBL
         C     R9,=F'57'
         BH    UPTITLEE
         LA    R8,UEBTEXT
         MVI   0(R8),C' '
         LA    R8,1(R8)
         S     R9,F4
         EX    R9,UPTITLEV
         LA    R8,1(R9,R8)
         MVI   0(R8),C' '
         $EXIT RC=4
UPTITLEE MVC   MSGNUM,=C'STA045A '
         $EXIT
         SPACE 3
UPTITLEV MVC   0(0,R8),SYMBOL+2
         EJECT
DATEN    DS    0D
*************************************** ARBEITSBEREICHE
DOWO     DC    D'0'                     ARBEITSFELD
WORK     DC    XL20'00'                 ARBEITSBEREICH
*************************************** VSAM-FELDER
INVDATEI ACB   AM=VSAM,DDNAME=D137VS,EXLST=INVEXLST,                   *
               MACRF=(KEY,DIR,SEQ,IN)
INVEXLST EXLST AM=VSAM,LERAD=INVLERAD,SYNAD=INVSYNAD
INVLERAD $ENTRY
         SHOWCB RPL=(1),AREA=WORK,LENGTH=4,FIELDS=(FDBK)
         TACLOSE
         UNPK  WORK+5(3),WORK+3(2)
         TR    WORK+5(2),TRTABUNP-240
         LOESCH DELRECNR,DELRECNR,C' '
         MVC   DELRECNR(2),WORK+5
         ISPLINK ('SETMSG','STA063A ')
         LA    R14,80(R13)              STACK ZURUECKSETZEN
         ST    R14,0(R13)               UND IN HAUPTPROZEDUR ZURUECK
         $EXIT
INVSYNAD $ENTRY
         SHOWCB RPL=(1),AREA=WORK,LENGTH=4,FIELDS=(FDBK)
         TACLOSE
         UNPK  WORK+5(3),WORK+3(2)
         TR    WORK+5(2),TRTABUNP-240
         LOESCH DELRECNR,DELRECNR,C' '
         MVC   DELRECNR(2),WORK+5
         ISPLINK ('SETMSG','STA064A ')
         LA    R14,80(R13)              STACK ZURUECKSETZEN
         ST    R14,0(R13)               UND IN HAUPTPROZEDUR ZURUECK
         $EXIT
GETSEQ   RPL   AM=VSAM,ACB=INVDATEI,AREA=SATZALT,AREALEN=L'SATZALT,    *
               KEYLEN=21,ARG=SATZALT,OPTCD=(KEY,SEQ)
INVLOAD  RPL   AM=VSAM,ACB=INVDATEI,AREA=SATZALT,AREALEN=40,           *
               KEYLEN=21,ARG=SATZALT,OPTCD=(KEY,SEQ,ARD,FWD),RECLEN=40
GETUPD   RPL   AM=VSAM,ACB=INVDATEI,AREA=SATZALT,AREALEN=L'SATZALT,    *
               KEYLEN=21,ARG=SATZALT,OPTCD=(KEY,SEQ,UPD)
GETLAST  RPL   AM=VSAM,ACB=INVDATEI,AREA=SATZALT,AREALEN=L'SATZALT,    *
               ARG=SATZALT,OPTCD=(KEY,SEQ)
INSERT   RPL   AM=VSAM,ACB=INVDATEI,AREA=SATZNEU,AREALEN=L'SATZNEU,    *
               KEYLEN=21,ARG=SATZNEU,OPTCD=(KEY,DIR)
LAENGEG  DC    A(INDEND-INDSATZ)        SATZLAENGE ZUM SCHREIBEN
UPREADLK DC    XL18'00'                 KEY FUER LESEN LETZTEN SATZ
SATZALT  DS    CL700
SATZNEU  DS    CL700
*************************************** SORTIERHILFSFELDER
SORTTAB  DC    A(0)                     SORTIERFELDER ANFANG
SORTTABE DC    A(0)                     SORTIERFELDER LAUFEND
SORTTABL DC    A(0)                     AUSGABEFELDER LAUFEND
SORTTABA DC    A(0)                     AUSGABEFELDER ANFANG
SORTTABB DC    A(0)                     AUSGABEFELDER ENDE
*************************************** FELDER DER SUCHABFRAGEN
ADRAREA  DC    A(INVANF0)               ADR DER LISTENANFORDERUNG
ADRFIND  DC    A(0)                     ADR DER SATZAUSWAHL
ADRSORT  DC    A(0)                     ADR DER SORTIERUNG
ADRLIST  DC    A(0)                     ADR DER FELDAUSWAHL
ADRLITER DC    A(0)                     ADR DES LITERALBEREICHS
ADRSUMZ  DC    A(0)                     ADR DER SUMMENZEILENAUFBER.
CNTAREA  DC    A(0)                     CNT DER TGET-AREA
CNTFIND  DC    A(0)                     CNT DER SATZAUSWAHL
CNTSORT  DC    A(0)                     CNT DER SORTIERUNG
CNTLIST  DC    A(0)                     CNT DER FELDAUSWAHL
CNTLITER DC    A(0)                     CNT DES LITERALBEREICHS
CNTSUMZ  DC    A(0)                     CNT DER SUMMENZEILENAUFBER.
CNTLEVEL DC    F'0'                     CNT DER SCHACHTELUNGSTIEFE
CNTERROR DC    A(0)                     CNT DES FEHLERS
SYMBOL   DC    CL70' '                  EINGELESENES SYMBOL
LNGSYMBL DC    H'0'                     LAENGE DES SYMBOLS
STACKAND DC    10F'0'                   UND-STACK
STACKOR  DC    10F'0'                   ODER-STACK
STACKAAD DC    A(0)                     ADRESSE UND-STACK
STACKOAD DC    A(0)                     ADRESSE ODER-STACK
ADRNM    DC    A(0)                     EINTRAG IN DATA DICTIONARY
ADROP    DC    A(0)                     EINTRAG IN OPERATORENTABELLE
ADRLIT   DC    A(0)                     ADRESSE DES LITERALS
LNGSORT  DC    F'0'                     LAENGE DER SORTIERFELDER
LNGLIST  DC    F'0'                     LAENGE DER LISTENZEILE
*************************************** FELDER DER LISTENAUSGABE
LISTNR   DS    X                        LISTEN-NUMMER
ZEILENZ  DC    PL2'0'
SEITENZ  DC    PL2'0'
ZEILENZD DC    PL2'56'
ZEILENL  DC    F'0'                     ZEILENLAENGE
ZEILENLD DC    F'132'
*************************************** SERIALISIERUNGSFELDER
MAJOR    DC    CL8'T051105'
MINOR    DC    CL44' '
*************************************** SUMMENFELDER
SUMKPR   DS    PL6                      SUMME KAUFPREIS
SUMMPR   DS    PL5                      SUMME MIETPREIS
SUMWPR   DS    PL5                      SUMME WARTUNG
SUMAPR   DS    PL6                      SUMME ABSCHREIBUNGSRATE
SUMBPR   DS    PL6                      SUMME ABSCHREIBUNGSBASIS
         SPACE 3
GRUPKPR  DS    PL6                      GRUPPENSUMME KAUFPREIS
GRUPMPR  DS    PL5                      GRUPPENSUMME MIETPREIS
GRUPWPR  DS    PL5                      GRUPPENSUMME WARTUNG
GRUPAPR  DS    PL6                      GRUPPENSUMME ABSCHREIBUNGSRATE
GRUPBPR  DS    PL6                      GRUPPENSUMME ABSCHREIBUNGSBASIS
         SPACE 3
WAUSG    DS    C                        WEICHE FUSSZEILE DRUCKEN
WAUSGJ   EQU   C'0'                     FUSSZEILE DRUCKEN
WAUSGN   EQU   C'1'                     FUSSZEILE NICHT DRUCKEN
         SPACE 3
GRUPPALT DS    CL4                      GRUPPENBEGRIFF ALT
GRUPPNEU DS    CL4                      GRUPPENBEGRIFF NEU
         EJECT
LISTA    LISTDEF (4,4,3,7,10,30,4,2,5,5,2,14,14,14)
LISTB    LISTDEF (4,4,3,7,30,7,4,4,4,1,8,8,1,14,9,9)
LISTC    LISTDEF (4,4,3,7,30,7,4,4,4,1,8,8,3,12,14)
LISTD    LISTDEF (4,4,3,7,30,7,4,4,4,1,8,3,9,14)
LISTF    LISTDEF (27,4,3,5,1,1,9,8,8,4)
LISTH    LISTDEF (7,5,16,12,8,8,4,3,7)
LISTL    LISTDEF (4,4,3,7,30,8,7,4,4,4,14,12,9)
LISTZ    DS    CL132
UEB      DC    CL132'INVENTARDATEI ------------------------------------*
               ------------------------ XX.XX.XX ----------------------*
               --------------------------'
UEBTEXT  EQU   UEB+15
UEBDATUM EQU   UEB+75
LISTFUSS DC    CL132' '
LISTFA1  EQU   LISTFUSS+LISTA12-LISTA-1
LISTFA2  EQU   LISTFUSS+LISTA13-LISTA-1
LISTFA3  EQU   LISTFUSS+LISTA14-LISTA-1
LISTFB1  EQU   LISTFUSS+LISTB14-LISTB-1
LISTFB2  EQU   LISTFUSS+LISTB15-LISTB-1
LISTFB3  EQU   LISTFUSS+LISTB16-LISTB-1
LISTFC1  EQU   LISTFUSS+LISTC14-LISTC-1
LISTFC2  EQU   LISTFUSS+LISTC15-LISTC-1
LISTFD1  EQU   LISTFUSS+LISTD13-LISTD-1
LISTFD2  EQU   LISTFUSS+LISTD14-LISTD-1
LISTFF1  DC    C'                 SUMME MIETKOSTEN (K/M = 2,3)         *
                                        '
LISTFF1P EQU   LISTFF1+46
LISTFF2  DC    C'                 SUMME WARTUNG    (K/M = 1)           *
                                        '
LISTFF2P EQU   LISTFF2+46
UEBZ     DS    CL132
LEERZ    DC    C' '
STRICHZ  DC    132C'-'
TAGESDAT DS    CL8                      TAGESDATUM
         SPACE 3
D001OS99 DCB   DSORG=PS,DDNAME=D001OS99,MACRF=(PM),                    *
               RECFM=VBM,BLKSIZE=2048,LRECL=137
D002OS99 DCB   DSORG=PS,DDNAME=D002OS99,MACRF=(PM),RECFM=VBM
DRUCKZ   DS    CL137
         SPACE 3
TRTABUNP DC    C'0123456789ABCDEF'
TRTABPK  DC    X'FAFBFCFDFEFF',41C' ',C'0123456789'
TRTABDM  DC    75C' ',C'.',31C' ',C',',132C' ',C'0123456789',6C' '
TRTABLST DC    X'01020304050607080900000000000000'
         DC    X'0A0B0C0D0E0F10111200000000000000001314151617'
         EJECT
INFODAT  ACB   AM=VSAM,DDNAME=D191VS,EXLST=INFODATX,MACRF=(KEY,SEQ,IN),*
               PASSWD=PASSWORD
INFODATX EXLST AM=VSAM,EODAD=INFODATE
INFODATE MVI   WEOF,WEOFY
         BR    R14
WEOF     DS    C
WEOFY    EQU   C'Y'
WEOFN    EQU   C'N'
PASSWORD DC    X'03C1C3C2'
INFODATG RPL   AM=VSAM,ACB=INFODAT,AREA=SATZINFO,AREALEN=L'SATZINFO
SATZINFO DS    CL90
ADDRKOST DC    A(TABKOST,TABKOST,TABKOST+TABKOSTM*L'TABKOST)
ADDRABTL DC    A(TABABTL,TABABTL,TABABTL+TABABTLM*L'TABABTL)
TABKOSTM EQU   300
TABABTLM EQU   300
         SPACE 3
DDTAB    DC    A(DDTABT)
DDTABE   DC    A(DDTABTE)
DDELEM   DS    0CL60
DDNM     DS    CL8                      NAME
DDDSP    DS    XL2                      DISPLACEMENT
DDLNG    DS    CL1                      LAENGE
DDOP     DS    CL1                      OPERATOR
DDBEZ    DS    CL24                     BEZEICHNUNG
DDTIT    DS    CL24                     UEBERSCHRIFT
         ORG   DDELEM
         SPACE 3
OPTAB    DC    A(OPTABT)                TABELLE DER OPERATOREN
OPTABE   DC    A(OPTABTE)
OPELEM   DS    0CL4
OPOPCODE DS    CL2
OPWMASKE DS    CL1
OPFMASKE DS    CL1
         ORG   OPELEM
         EJECT
F1       DC    F'1'
F2       DC    F'2'
F3       DC    F'3'
F4       DC    F'4'
F5       DC    F'5'
F7       DC    F'7'
F8       DC    F'8'
F10      DC    F'10'
F11      DC    F'11'
F12      DC    F'12'
F13      DC    F'13'
F14      DC    F'14'
F15      DC    F'15'
F24      DC    F'24'
F26      DC    F'26'
F30      DC    F'30'
F40      DC    F'40'
F74      DC    F'74'
F79      DC    F'79'
         EJECT
*                                       ISPF-FELDER
INVSA    DS    C                        KZ FUER FELDGRUPPE 1 DISPLAY
INVSB    DS    C                        KZ FUER FELDGRUPPE 2 DISPLAY
INVSC    DS    C                        KZ FUER FELDGRUPPE 3 DISPLAY
INVSD    DS    C                        KZ FUER FELDGRUPPE 4 DISPLAY
INVOPT   DS    C                        SELECT OPTION
INVZUST  DS    C                        ZUSTAND DER INSTALLATION
INVMKKZ  DS    C                        MIETE-KAUF-KENNZEICHEN
INVWKZ   DS    C                        WARTUNGSKENNZEICHEN
INVZSERV DS    C                        KZ FUER ZENTRALEN SERVICE
INVGEW   DS    C                        KZ FUER GEWAEHRLEISTUNG
INVOSERV DS    C                        KZ FUER OERTLICHEN SERVICE
INVOUNT  DS    C                        KZ FUER OERTLICHE UNTERSTUETZ.
INVGLZ   DS    C                        KZ FUER GEBAEUDELIZENZ
INVILZ   DS    C                        KZ FUER INSTALLATIONSLIZENZ
INVAKZ   DS    C                        KZ FUER ALLGEMEINE ZWECKE
INVKZEIT DS    CL2                      KUENDIGUNGSZEIT
INVTZEIT DS    CL2                      TESTZEIT
INVNLVKZ DS    CL2                      NLV-NAV-KZ
INVDAY   DS    CL2                      TAG
INVMON   DS    CL2                      MONAT
INVYEAR  DS    CL2                      JAHR
INVAART  DS    CL2                      ABSCHREIBUNGSART
INVMOD   DS    CL3                      MODELL
INVECL   DS    CL3                      EC LEVEL
INVVLMON DS    CL3                      VERLNGERUNGSZEITRAUM IN MONATE
INVTYP   DS    CL4                      TYP-NUMMER
INVFT0   DS    CL4                      FEATURE TYP 0
INVFT1   DS    CL4                      FEATURE TYP 1
INVFT2   DS    CL4                      FEATURE TYP 2
INVFT3   DS    CL4                      FEATURE TYP 3
INVFT4   DS    CL4                      FEATURE TYP 4
INVFT5   DS    CL4                      FEATURE TYP 5
INVFT6   DS    CL4                      FEATURE TYP 6
INVFT7   DS    CL4                      FEATURE TYP 7
INVFT8   DS    CL4                      FEATURE TYP 8
INVFT9   DS    CL4                      FEATURE TYP 9
INVKST   DS    CL4                      KOSTENSTELLE
INVKTR   DS    CL4                      KOSTENTRAEGER
INVABTL  DS    CL4                      ABTEILUNG
INVPROD  DS    CL4                      PRODUKT KENNZEICHEN
INVCA    DS    CL5                      GERAETEADRESSE
DELRECNR DS    CL5                      ANZAHL GELOESCHTER SAETZE
INVLNR   DS    CL7                      LEITUNGSNUMMER
INVMANR  DS    CL7                      MASCHINEN-NUMMER
INVUSER  DS    CL8                      USER-ID
INVDAT1  DS    CL8                      GEPLANTER LIEFERTERMIN
INVDAT2  DS    CL8                      INSTALLATIONSDATUM
INVDAT3  DS    CL8                      MIETBEGINN
INVDAT4  DS    CL8                      MIETENDE
INVDAT5  DS    CL8                      K!NDIGUNGSDATUM
INVDAT6  DS    CL8                      DATUM ZENTRALER SERVICE
INVDAT7  DS    CL8                      DATUM OERTLICHER SERVIVE
INVDAT8  DS    CL8                      DATUM OERTLICHE UNTERSTUETZUNG
INVIORT  DS    CL8                      INSTALLATIONSORT
INVHERS  DS    CL8                      HERSTELLER
INVABEG  DS    CL8                      ABSCHREIBUNGSBEGINN
INVAEND  DS    CL8                      ABSCHREIBUNGSENDE
INVMSNR  DS    CL10                     MIETSCHEIN-NR
INVINVN  DS    CL10                     INVENTAR-NR
INVMODUS DS    CL11                     MODUS (NEUAUFN. / NDERUNG)
INVTUSER DS    CL12                     TERMINALBENUTZER
INVMPR   DS    CL12                     MIETPREIS
INVWPR   DS    CL12                     WARTUNGSPREIS
INVTTEL  DS    CL13                     TELEFON-NR
INVKPR   DS    CL14                     KAUFPREIS
INVABAS  DS    CL14                     ABSCHREIBUNGSBASIS
INVARAT  DS    CL14                     ABSCHREIBUNGSRATE
INVBEZ   DS    CL30                     BEZEICHNUNG
INVFB0   DS    CL30                     FEATURE BEZEICHNUNG 0
INVFB1   DS    CL30                     FEATURE BEZEICHNUNG 1
INVFB2   DS    CL30                     FEATURE BEZEICHNUNG 2
INVFB3   DS    CL30                     FEATURE BEZEICHNUNG 3
INVFB4   DS    CL30                     FEATURE BEZEICHNUNG 4
INVFB5   DS    CL30                     FEATURE BEZEICHNUNG 5
INVFB6   DS    CL30                     FEATURE BEZEICHNUNG 6
INVFB7   DS    CL30                     FEATURE BEZEICHNUNG 7
INVFB8   DS    CL30                     FEATURE BEZEICHNUNG 8
INVFB9   DS    CL30                     FEATURE BEZEICHNUNG 9
INVLIST  DS    CL40                     LISTEN-SPEZIFIKATION
ZPF24    DS    CL40                     PF24-TASTE
ZPF24SAV DS    CL40                     PF24-TASTE SICHERUNG
INVFZ0   DS    F                        FEATURE ANZAHL 0
INVFZ1   DS    F                        FEATURE ANZAHL 1
INVFZ2   DS    F                        FEATURE ANZAHL 2
INVFZ3   DS    F                        FEATURE ANZAHL 3
INVFZ4   DS    F                        FEATURE ANZAHL 4
INVFZ5   DS    F                        FEATURE ANZAHL 5
INVFZ6   DS    F                        FEATURE ANZAHL 6
INVFZ7   DS    F                        FEATURE ANZAHL 7
INVFZ8   DS    F                        FEATURE ANZAHL 8
INVFZ9   DS    F                        FEATURE ANZAHL 9
INVPRODN DS    CL4                      PRODUKTGRUPPE  DER PRODUKTKOPIE
INVTYPN  DS    CL4                      TYP-NUMMER             "
INVMODN  DS    CL3                      MODELL-NUMMER          "
INVMANRN DS    CL7                      MASCHINEN-NUMMER       "
TABABTNR DS    CL4                      ABTEILUNGSNUMMER
TABABTNM DS    CL26                     ABTEILUNGSNAME
TABDDLNG DS    CL2                      LAENGE
TABDDOP  DS    CL3                      OPERATION
TABDDDSP DS    CL4                      DISPLACEMENT
TABDDNM  DS    CL8                      NAME
TABDDBEZ DS    CL24                     BEZEICHNUNG
TABDDTIT DS    CL24                     UEBERSCHRIFT
MSGNUM   DS    CL8                      MESSAGE-NUMMER
MSGFELD  DS    CL8                      MESSAGE-FELDNAME
INVUEB1  DS    CL79                     UEBERSCHRIFT 1
INVUEB2  DS    CL79                     UEBERSCHRIFT 2
INVUEB3  DS    CL79                     UEBERSCHRIFT 3
INVZEIL  DS    CL79                     LISTENZEILE
INVZCMD  DS    CL79                     ZCMD
INVANF0  DS    10CL75                   LISTENANFORDERUNG
         DC    X'00'                    ENDE DES EINGABEPUFFERS
         EJECT
UEBA     DC    C'PROD TYP  MOD MANR    INVENTARNR BEZEICHNUNG          *
                         KTR  AB ABBEG ABEND FA      KAUFPREIS  ABSCHR.*
               -BASIS   ABSCHR.-RATE'
UEBB     DC    C'PROD TYP  MOD MANR    BEZEICHNUNG                   ST*
               ANDORT ABTL KST  KTR M/K MIETBEG MIETENDE FA     KAUFPRE*
               IS  WARTKOST MIETPREIS'
UEBC     DC    C'PROD TYP  MOD MANR    BEZEICHNUNG                   ST*
               ANDORT ABTL KST  KTR M/K MIETBEG MIETENDE FA     MIETPRE*
               IS      KAUFPREIS'
UEBD     DC    C'PROD TYP  MOD MANR    BEZEICHNUNG                   ST*
               ANDORT ABTL KST  KTR M/K KAUFDAT FA   WARTKOST      KAUF*
               PREIS'
UEBF     DC    C'SOFTWARE - PRODUKT          PROG-NR FIRMA K/M W  GEBUE*
               HR MIETBEG. MIETENDE ABL#'
UEBH     DC    C'MANR    CUA   ABTEILUNG        NAME         TELEFON  R*
               AUM     TYP  MOD LEITUNG'
UEBL     DC    C'PROD TYP  MOD MANR    BEZEICHNUNG                    L*
               IEF-DAT STANDORT ABTL KST KTR       KAUFPREIS    MIETPRE*
               IS  WARTKOST'
         EJECT
*                                       TABELLEN
TABKOST  DS    (TABKOSTM)CL8
         ORG   TABKOST
TABKOSTN DS    CL4                      KOSTENSTELLEN-NUMMER
TABKOSTA DS    CL4                      ABTEILUNGSNUMMER
         ORG
TABABTL  DS    (TABABTLM)CL30
         ORG   TABABTL
TABABTLN DS    CL4                      ABTEILUNGSNUMMER
TABABTLT DS    CL26                     ABTEILUNGSBEZEICHNUNG
         ORG
DDTABT   DS    0F
         DDICT ABBEG,2A5,8,,'ABSCHREIBUNGSBEGINN','ABSCHBEG'
         DDICT ABENDE,2AD,8,,'ABSCHREIBUNGSENDE','ABSCHEND'
         DDICT ABLG,1D2,10,,'ABLAGE-NR','ABLG'
         DDICT ABSCHART,287,2,,'ABSCHREIBUNGSART','AA'
         DDICT ABTL,23E,4,,'ABTEILUNG','ABTL'
         DDICT AKZ,1DE,1,,'ALLGEM. KENNZEICHEN','A'
         DDICT APREIS,297,14,,'ABSCHREIBUNGSRATE','ABSCHR.RATE'
         DDICT BEG,1B7,8,,'MIETBEGINN','MIETBEG'
         DDICT BEGJ,1BD,2,,'MIETBEGINN (JAHR)','DB'
         DDICT BEGM,1BA,2,,'MIETBEGINN (MONAT)','DB'
         DDICT BEGT,1B7,2,,'MIETBEGINN (TAG)','DB'
         DDICT BENUTZER,24A,12,,'BENUTZER','BENUTZER'
         DDICT BEZ,15,30,,'BEZEICHNUNG','BEZEICHNUNG'
         DDICT BEZK,15,17,,'KURZBEZEICHNUNG','KURZBEZEICHNUNG'
         DDICT BPREIS,289,14,,'ABSCHREIBUNGSBASIS','ABSCHR.BASIS'
         DDICT CUA,263,5,,'CUA','CUA'
         DDICT END,1BF,8,,'MIETENDE','MIETENDE'
         DDICT ENDJ,1C5,2,,'MIETENDE (JAHR)','DE'
         DDICT ENDM,1C2,2,,'MIETENDE (MONAT)','DE'
         DDICT ENDT,1BF,2,,'MIETENDE (TAG)','DE'
         DDICT FBEZ,41,30,O,'FEATUREBEZEICHNUNG 1',                    *
               'FEATUREBEZEICHNUNG 1'
         DDICT FBEZ2,65,30,O,'FEATUREBEZEICHNUNG 2',                   *
               'FEATUREBEZEICHNUNG 2'
         DDICT FBEZ3,89,30,O,'FEATUREBEZEICHNUNG 3',                   *
               'FEATUREBEZEICHNUNG 3'
         DDICT FBEZ4,AD,30,O,'FEATUREBEZEICHNUNG 4',                   *
               'FEATUREBEZEICHNUNG 4'
         DDICT FBEZ5,D1,30,O,'FEATUREBEZEICHNUNG 5',                   *
               'FEATUREBEZEICHNUNG 5'
         DDICT FBEZ6,F5,30,O,'FEATUREBEZEICHNUNG 6',                   *
               'FEATUREBEZEICHNUNG 6'
         DDICT FBEZ7,119,30,O,'FEATUREBEZEICHNUNG 7',                  *
               'FEATUREBEZEICHNUNG 7'
         DDICT FBEZ8,13D,30,O,'FEATUREBEZEICHNUNG 8',                  *
               'FEATUREBEZEICHNUNG 8'
         DDICT FBEZ9,161,30,O,'FEATUREBEZEICHNUNG 9',                  *
               'FEATUREBEZEICHNUNG 9'
         DDICT FBEZ10,185,30,,'FEATUREBEZEICHNUNG 10',                 *
               'FEATUREBEZEICHNUNG 10'
         DDICT FIRMA,23C,2,,'FIRMENKENNZEICHEN','FA'
         DDICT FTYP,3D,4,O,'FEATURETYP 1','FTYP'
         DDICT FTYP2,61,4,O,'FEATURETYP 2','FTYP'
         DDICT FTYP3,85,4,O,'FEATURETYP 3','FTYP'
         DDICT FTYP4,A9,4,O,'FEATURETYP 4','FTYP'
         DDICT FTYP5,CD,4,O,'FEATURETYP 5','FTYP'
         DDICT FTYP6,F1,4,O,'FEATURETYP 6','FTYP'
         DDICT FTYP7,115,4,O,'FEATURETYP 7','FTYP'
         DDICT FTYP8,139,4,O,'FEATURETYP 8','FTYP'
         DDICT FTYP9,15D,4,O,'FEATURETYP 9','FTYP'
         DDICT FTYP10,181,4,,'FEATURETYP 10','FTYP'
         DDICT HERSTELL,33,5,,'HERSTELLER','HERST'
         DDICT INST,1AF,8,,'INSTALLATIONSDATUM','INSTDAT'
         DDICT INSTKZ,1A6,1,,'INSTALLATIONSZUSTAND','I'
         DDICT INSTJ,1B5,2,,'INSTALLATION (JAHR)','DI'
         DDICT INSTM,1B2,2,,'INSTALLATION (MONAT)','DI'
         DDICT INSTT,1AF,2,,'INSTALLATION (TAG)','DI'
         DDICT INVKEY,0,18,,'INVENTARSCHLUESSEL',                      *
               'INVENTARSCHLUESSEL'
         DDICT INVNR,27D,10,,'INVENTARNR','INVENTARNR'
         DDICT KPREIS,201,14,,'KAUFPREIS','KAUFPREIS'
         DDICT KPREISK,206,9,,'KAUFPREIS','KAUFPREIS'
         DDICT KST,234,4,,'KOSTENSTELLE','KST'
         DDICT KTR,238,4,,'KOSTENTRAEGER','KTR'
         DDICT KUEN,1C7,8,,'KUENDIGUNGSDATUM','DATKUEND'
         DDICT KUENJ,1CD,2,,'KUENDIGUNG (JAHR)','DK'
         DDICT KUENM,1CA,2,,'KUENDIGUNG (MONAT)','DK'
         DDICT KUENT,1C7,2,,'KUENDIGUNG (TAG)','DK'
         DDICT LEITUNG,268,7,,'LEITUNGSNUMMER','LEITUNG'
         DDICT LIEF,1A7,8,,'LIEFERDATUM','DATLIEF'
         DDICT LIEFJ,1AD,2,,'LIEFERDATUM (JAHR)','DL'
         DDICT LIEFM,1AA,2,,'LIEFERDATUM (MONAT)','DL'
         DDICT LIEFT,1A7,2,,'LIEFERDATUM (TAG)','DL'
         DDICT LFDNR,12,3,,'LAUFENDE NUMMER DES PRODUKTS','LNR'
         DDICT MANR,B,7,,'MASCHINENNUMMER','MANR'
         DDICT MIETKZ,1DC,1,,'MIETE/KAUF-KZ','M'
         DDICT MOD,8,3,,'MODELL','MOD'
         DDICT MPREIS,21C,12,,'MIETPREIS','MIETPREIS'
         DDICT MPREISK,21F,9,,'MIETPREIS','MIETPREIS'
         DDICT PROD,0,4,,'PRODUKTKENNZEICHEN','PROD'
         DDICT RAUM,242,8,,'RAUM','RAUM'
         DDICT TEL,256,13,,'TELEFON','TELEFON'
         DDICT TYP,4,4,,'TYP-NUMMER','TYP'
         DDICT USERDAT,277,6,,'USER-INPUT-DATUM','UDATUM'
         DDICT USERID,26F,8,,'USERID','USERID'
         DDICT WARTKZ,1DD,1,,'WARTUNGS-KZ','W'
         DDICT WPREIS,228,12,,'WARTUNGSKOSTEN','WARTUNG'
         DDICT WPREISK,22B,9,,'WARTUNGSKOSTEN','WARTUNG'
         DDICT ZV,210,6,,'ZEITRAUM VON','ZVON'
         DDICT ZVJ,214,2,,'ZEITRAUM VON (JAHR)','ZV'
         DDICT ZVM,212,2,,'ZEITRAUM VON (MONAT)','ZV'
         DDICT ZVT,210,2,,'ZEITRAUM VON (TAG)','ZV'
         DDICT ZB,216,6,,'ZEITRAUM BIS','ZBIS'
         DDICT ZBJ,21A,2,,'ZEITRAUM BIS (JAHR)','ZB'
         DDICT ZBM,218,2,,'ZEITRAUM BIS (MONAT)','ZB'
         DDICT ZBT,216,2,,'ZEITRAUM BIS (TAG)','ZB'
DDTABTE  EQU   *
OPTABT   DS    0F
         DC    C'< ',X'40B0'
         DC    C'> ',X'20D0'
         DC    C'= ',X'8070'
         DC    C'<=',X'D020'
         DC    C'>=',X'B040'
         DC    C'<>',X'7080'
OPTABTE  EQU   *
         EJECT
SORTTAB1 DSECT
SORTADR  DS    A                        ADRESSE AUSGABEFELDER
SORTKEY  DS    CL30                     SORTIERFELDER
SORTLNG1 EQU   *-SORTTAB1               LAENGE SORTTABELLE 1
         SPACE
SORTTAB2 DSECT
SORTPROD DS    CL4                      PRODUKTGRUPPE
SORTTYP  DS    CL4                      TYP-NUMMER
SORTMOD  DS    CL3                      MODELL-NUMMER
SORTMANR DS    CL7                      MASCHINEN-NUMMER
SORTBEZ  DS    CL30                     TYPBEZEICHNUNG
SORTHERS DS    CL8                      HERSTELLER
SORTINST DS    CL1                      INSTALLATIONS-ZUSTAND
SORTLIEF DS    CL8                      GEPLANTER LIEFERTERMIN
SORTBEG  DS    CL8                      MIETBEGINN/KAUFDATUM
SORTEND  DS    CL8                      MIETENDE/VERKAUFSDATUM
SORTABLG DS    CL10                     MIETSCHEIN-/ABLAGE-NR
SORTBESO DS    CL1                      MIETE-KAUF-KENNZEICHEN
SORTWART DS    CL1                      WARTUNGS-KENNZEICHEN
SORTKST  DS    CL4                      KOSTENSTELLE
SORTABTL DS    CL4                      ABTEILUNGSNUMMER
SORTORT  DS    CL8                      INSTALLATIONSORT
SORTBEN  DS    CL12                     BENUTZER
SORTTEL  DS    CL13                     TELEFON
SORTCUA  DS    CL5                      GERAETEADRESSE
SORTLEIT DS    CL7                      LEITUNGSNUMMER
SORTKTR  DS    CL4                      KOSTENTRAEGER
SORTAART DS    CL2                      ABSCHREIBUNGSART
SORTABEG DS    CL8                      ABSCHREIBUNGSBEGINN
SORTAEND DS    CL8                      ABSCHREIBUNGSENDE
SORTFAKZ DS    CL2                      FIRMENKENNZEICHEN
SORTINVN DS    CL10                     INVENTARNUMMER
SORTNUM2 DS    (SORTLNG4)C
SORTLNG2 EQU   *-SORTTAB2               LAENGE SORTTABELLE 2
         SPACE
SORTTAB3 DSECT
SORTFLD  DS    CL45                     SORTIERFELDER FREIES FORMAT
SORTZL   DS    CL132                    AUSGABEFELDER FREIES FORMAT
SORTNUM3 DS    (SORTLNG4)C
SORTLNG3 EQU   *-SORTTAB3               LAENGE SORTTABELLE 3
         SPACE
SORTTAB4 DSECT
SORTKPR  DS    CL14                     KAUFPREIS
SORTMPR  DS    CL12                     MIETPREIS
SORTWPR  DS    CL9                      WARTUNGSKOSTEN
SORTAPR  DS    CL14                     ABSCHREIBUNGSRATE
SORTBPR  DS    CL14                     ABSCHREIBUNGSBASIS
SORTLNG4 EQU   *-SORTTAB4               LAENGE SORTTABELLE 4
         CSECT
         EJECT
         PRINT GEN
D191D    D191D PR=D191
         EJECT
INDSATZ  D137D
         END

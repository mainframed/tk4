./ ADD NAME=EANF
         MACRO
&NAME    EANF  &V,&CD=C,&LC=0,&BR=1,&SA=72,&EP=,&ID=,&REG=(14,12),     1
               &CT=
.*
.* V     REG. 15 WIRD ZUM LADEN DER BASISREG. BENUTZT
.* CD=   STANDARDWERT IST -S- WIE -START-
.*       ZULAESSIG AUCH -C- WIE -CSECT-
.* LC=   STANDARDWERT IST -0-, SETZT ZUORDNUNGSZAEHLER AUF 0
.*       NUR ZULAESSIG IN VERBINDUNG MIT -START-, SIEHE CD=
.* BR=   STANDARDWERT IST -1- WIE -EIN BASISREGISTER=BASIS1=R3-
.*       ZULAESSIG IST 0,1,2 ODER 3
.* SA=   STANDARDWERT IST -72-
.*       GIBT DIE LAENGE DER SAVEAREA AN
.* EP=   NAME DES EINGANGSPUNKTES. WENN ANGEGEBEN,SO WIRD
.*       ER MERKMAL DER SAVE-INSTUKTION IN DER MAKROAUFLOESUNG
.* ID=   IDENTIFIKATION, WIE BEIM SAVE-MACRO ANGEGEBEN WERDEN KANN
.* REG=  REGISTERNOTIERUNG, STANDARDWERT IST (14,12)
.*       WIE IM SAVE-MACRO ANGEGEBEN WERDEN KANN
.* CT=   T,
.*       WIE IM SAVE-MACRO ANGEGEBEN WERDEN KANN
.*
.* GLOBALE VARIABLE ZUM TEST GEGEN DOPPELDEFINITION DER REGISTER
         GBLB  &GLBIT   BETROFFEN SIND DIE EQU'S
         GBLA  &GLBR
         LCLA  &SETBR   ZUM TEST FUER BR=
         LCLA  &LECS
         LCLC  &CSET
         LCLA  &ASET
.*
         AIF   (T'&NAME EQ 'O').M1
.M2      AIF   ('&CD' EQ 'S').M3
         AIF   ('&CD' EQ 'C').M4
         MNOTE 4,'CD=  IST UNGUELTIG'
.M3      MNOTE *,'START GENERIERT'
&NAME    START &LC
         AGO   .M5
.M4      MNOTE *,'CSECT GENERIERT'
&NAME    CSECT
.M5      ANOP
         AIF   (&GLBIT).E1
*
*
*
         MNOTE *,'SYMBOLISCHE REGISTER GENERIERT'
*
R15      EQU   15  VERZWEIGREGISTER
R14      EQU   14  RUECKKEHRREGISTER
R13      EQU   13  REGISTER FUER DEN LAUFENDEN SICHERUNGSBEREICH
R12      EQU   12
R11      EQU   11
R10      EQU   10
R9       EQU   9
R8       EQU   8
R7       EQU   7
R6       EQU   6
R5       EQU   5
R4       EQU   4
R3       EQU   3
R2       EQU   2   BEI TRT-EINGABEDATENPRUEFUNG VERWENDET
R1       EQU   1   PARAMETERREGISTER
R0       EQU   0   PARAMETERREGISTER
*
*
.E1      AIF   ('&BR'(1,1) NE '(').E2
         AGO   .M22
.E2 ANOP
&SETBR   SETA  &BR
         AIF   (&GLBIT).M18
.M19     AIF   (&SETBR EQ 0).M6
         AIF   (&SETBR GE 1).M8
.M9      AIF   (&SETBR GE 2).M10
.M12     ANOP
         AIF   (&GLBR GT &SETBR).M22
&GLBR    SETA  &SETBR
.M22     ANOP
**
**
         USING *,R15
MACR&SYSNDX EQU *
&EP      SAVE  &REG,&CT,&ID
         LR    2,1
         AIF   (T'&EP EQ 'O').M13
         AIF   (T'&EP EQ 'SYSECT').M21
         ENTRY &EP
         MNOTE *,'ENTRY-EINGANGSPUNKT GENERIERT'
.M13        CNOP  0,4
            LA    1,*+8
            B     *+4+&SA
            DS    &SA.C
         ST    R13,4(R1)
         LR    R10,R13
         LA    R13,0(R1)
         ST    R13,8(R10)
         LR   1,2
         AIF   (&GLBIT).M17
*
* AUFBAU DER SAVEAREA
*
* WORT 0  NUR VON PL/1 VERWENDET
* WORT 1  A(SAVEAREA IM RUFENDEN PROGRAMM)
* WORT 2  A(SAVEAREA IM GERUFENEN PROGRAMM)
* WORT 3  R14
* WORT 4  R15
* WORT 5  R0         **BEI         R14
* WORT 6  R1         **ZUGRIFFS-   R15
* WORT 7  R2         **ROUTINEN    R0
* WORT 8  R3 BASIS1  **WERDEN      R1
* WORT 9  R4 BASIS2  **HIER        R2
* WORT 10 R5 BASIS3  **FOLGENDE    R3
* WORT 11 R6         **REGISTER    R4
* WORT 12 R7         **VON DER     R5
* WORT 13 R8         **ZUGRIFFS-   R6
* WORT 14 R9         **ROUTINE     R7
* WORT 15 R10        **GESPEICHERT R8
* WORT 16 R11
* WORT 17 R12
*
.M17     ANOP
         AIF   ('&BR'(1,1) NE '(').E5
&SETBR   SETA  N'&BR
         BALR  &BR(1),0
         USING *,&BR(1)
         AIF   (&SETBR EQ 1).M14
         AIF   (&SETBR GT 10).E4
.E3      ANOP
&LECS    SETA  2
&ASET    SETA  1
         LA    &BR(&SETBR),4095
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E11
 USING *+4096-&SETBR*4,&BR(2)
 AGO .M14
.E11  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E12
 USING *+4096-&SETBR*4,&BR(2),&BR(3)
 AGO .M14
.E12  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E13
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4)
 AGO .M14
.E13  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E14
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5)
 AGO .M14
.E14  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E15
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5),&BR(6)
 AGO .M14
.E15  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E16
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5),&BR(6),&BR(7)
 AGO .M14
.E16  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E17
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5),&BR(6),&BR(7),&BR(8)
 AGO .M14
.E17  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E18
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5),&BR(6),&BR(7),&BR(8)*
               ,&BR(9)
 AGO .M14
.E18  ANOP
&LECS    SETA  &LECS+1
&ASET    SETA  &ASET+1
         LA    &BR(&LECS),1(&BR(&ASET),&BR(&SETBR))
         AIF   (&LECS NE &SETBR).E19
 USING *+4096-&SETBR*4,&BR(2),&BR(3),&BR(4),&BR(5),&BR(6),&BR(7),&BR(8)*
               ,&BR(9),&BR(10)
 AGO .M14
.E19  ANOP
         AGO   .M14
.E4      MNOTE 4,'MEHR ALS 10 BASISREGISTER ANGEGEBEN'
         MNOTE *,'10 BASISREGISTER WERDEN GENERIERT'
&SETBR   SETA  10
         AGO   .E3
.E5      AIF   (&SETBR EQ 0).M14
         AIF   ('&V' EQ 'V').M25
         BALR  BASIS1,0
         USING *,BASIS1
.M26     ANOP
         MNOTE *,'BASIS1 BEREITGESTELLT, GELADEN'
.M24     ANOP
         AIF   (&SETBR EQ 1).M14
         AIF   (&SETBR EQ 2).M15
         AIF   ('&V' EQ 'V').M27
         USING *+4096,BASIS2,BASIS3
.M28     ANOP
         LA    BASIS3,4095
         LA    BASIS2,1(BASIS1,BASIS3)
         LA    BASIS3,1(BASIS2,BASIS3)
         MNOTE *,'BASIS2 UND BASIS3 BEREITGESTELLT, GELADEN'
.M14     ANOP
&GLBIT   SETB  1
*
*
*   ENDE DES VORSPANNES
*
*
         MEXIT
.M15     AIF   ('&V' EQ 'V').M29
         USING *+4096,BASIS2
.M30     ANOP
         LA    BASIS2,4095
         LA    BASIS2,1(BASIS1,BASIS2)
         MNOTE *,'BASIS2 BEREITGESTELLT, GELADEN'
         AGO   .M14
.M18     AIF   (&GLBR GE &SETBR).M12
         AIF   (&GLBR EQ 0).M19
         AIF   (&GLBR EQ 1).M9
         AIF   (&GLBR EQ 2).M11
         AGO   .M20
.M1      MNOTE 12,'UNBENANNTE CONTROL-SECTION'
         AGO   .M2
.M6      MNOTE *,'KEINE BASISREGISTER GENERIERT'
         AGO   .M12
.M8      MNOTE *,'BASIS1 GENERIERT'
BASIS1   EQU   3   ** BASISREGISTER 1 **
         AGO   .M9
.M10     MNOTE *,'BASIS2 GENERIERT'
BASIS2   EQU   4   ** BASISREGISTER 2 **
         AIF   (&SETBR GE 3).M11
         AGO   .M12
.M11     MNOTE *,'BASIS3 GENERIERT'
BASIS3   EQU   5   ** BASISREGISTER 3 **
         AIF   (&SETBR EQ 3).M12
.M20     MNOTE 4,'BR=  ZU HOCH'
         AGO   .M12
.M21     MNOTE 4,'EP=  CSECT-NAME'
         AGO   .M13
.M25     USING MACR&SYSNDX,BASIS1
         LR    BASIS1,R15
         AGO   .M26
.M27     USING MACR&SYSNDX+4096,BASIS2,BASIS3
         AGO   .M28
.M29     USING MACR&SYSNDX+4096,BASIS2
         AGO   .M30
         MEND
./ ADD NAME=ERET
         MACRO
&NAME    ERET  &REG=(14,12),&CT=,&RC=,&SA=72
.* RC=   RETURN-CODE,
.*       WIE IM RETURN-MACRO ANGEGEBEN WERDEN KANN
.* REG=  REGISTERNOTIERUNG, STANDARDWERT IST (14,12)
.*       WIE IM RETURN-MACRO ANGEGEBEN WERDEN KANN
.* CT=   T,
.*       WIE IM RETURN-MACRO ANGEGEBEN WERDEN KANN
.* SA=   LAENGE DER SAVEAREA, STANDARDWERT IST 72
         LCLC  &TRC  DEFINIERT DEN TYP VON &RC
&TRC     SETC  T'&RC  DAMIT AUF FEHLEN VON RC= GEPRUEFT WERDEN KANN
&NAME    LA    1,0(13)
         L     13,4(1)
         LR    1,2
         AIF   ('&REG' EQ 'NO').M3
         AIF   ('&TRC' EQ 'O').M1
         RETURN &REG,&CT,RC=&RC
         AGO   .M2
.M1      RETURN &REG,&CT
.M2      MNOTE *,'ERET GENERIERT'
         MEXIT
.M3      AIF   ('&TRC' EQ 'O').M4
         RETURN &CT,RC=&RC
         AGO   .M2
.M4      RETURN &CT
         AGO   .M2
         MEND

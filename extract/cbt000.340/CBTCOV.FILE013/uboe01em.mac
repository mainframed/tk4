./ ADD UBOE01EM
         MACRO
&NAME    CSTART &REGS,&A
         LCLC  &C1
         LCLA  &A1,&A2
&NAME    CSECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         AIF   (T'&A NE 'O').A1
         SAVE  (14,12)
         AGO   .A2
.A1      SAVE  (14,12),,&A
.A2      ANOP
&A1      SETA  N'&REGS
&A2      SETA  K'&REGS
&C1      SETC  '&REGS'(2,&A2-2)
         CNOP  0,4
         BALR  &REGS(1),0
         USING *,&C1
         ST    R13,SAVEA+4
         LR    R12,R13
         LA    R13,SAVEA
         ST    R13,8(R12)
         AIF   (&A1 EQ 1).B1
         LA    &REGS(2),4095
         LA    &REGS(2),1(&REGS(2),&REGS(1))
         AIF   (&A1 EQ 2).B1
         LA    &REGS(3),4095
         LA    &REGS(3),1(&REGS(3),&REGS(2))
         AIF   (&A1 EQ 3).B1
         LA    &REGS(4),4095
         LA    &REGS(4),1(&REGS(4),&REGS(3))
         AIF   (&A1 EQ 4).B1
         LA    &REGS(5),4095
         LA    &REGS(5),1(&REGS(5),&REGS(4))
         AIF   (&A1 EQ 5).B1
         LA    &REGS(6),4095
         LA    &REGS(6),1(&REGS(6),&REGS(5))
         AIF   (&A1 EQ 6).B1
         MNOTE 'MEHR ALS 6 BASISREGISTER'
.B1      ANOP
         B     SAVEA+72
SAVEA    DS    18F
         MEND
*
**************************************************
* UNTERPROGRAMM DATUMF                           *
**************************************************
000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.  DATUMF.
000300 ENVIRONMENT DIVISION.
000400 CONFIGURATION SECTION.
000500 DATA DIVISION.
000600 WORKING-STORAGE SECTION.
000700 77  INDEX--X PICTURE S99 COMPUTATIONAL SYNC.
000800 01  MONATS-TAG-ANZ-TABELLE SYNC.
000900     02 MT PICTURE X(24) VALUE '312831303130313130313031'.
001000     02 T REDEFINES MT.
001100     03 TT PICTURE 99 OCCURS 12 TIMES.
001200 01  WS-DNUM SYNC.
001300     02 WS-NUM PICTURE S9(5).
001400     02 WS-NUM2 REDEFINES WS-NUM.
001500     03 WS-JJ  PICTURE 9(2).
001600     03 WS-TTT PICTURE S9(3).
001700     03 WS-TT3 REDEFINES WS-TTT.
001800     04 WS-TTT1 PICTURE 9.
001900     04 WS-TTT2 PICTURE 99.
002000 01  WS-DNORM SYNC.
002100     02 NORM-TT PICTURE 99.
002200     02 FILLER  PICTURE X VALUE '.'.
002300     02 NORM-MM PICTURE 99.
002400     02 FILLER  PICTURE X VALUE '.'.
002500     02 NORM-JJ PICTURE 99.
002600 01  WS-SCHJ SYNC.
002700     02 WS-SCH-JAHR PICTURE 99V99.
002800     02 WS-SCHALTJ REDEFINES WS-SCH-JAHR.
002900     03 WS-SCH-JA PICTURE 99.
003000     03 WS-SCH-JR PICTURE 99.
003100 LINKAGE SECTION.
003200 01  DAT-NUM  PICTURE S9(5) COMPUTATIONAL-3 SYNC.
003300 01  DAT-NUMX REDEFINES  DAT-NUM.
003400     05  FILLER  PICTURE XX.
003500     05  DAT-NUM3 PICTURE X.
003600 01  DAT-NORM SYNC.
003700     02 DAT-TT  PICTURE 99.
003800     02 DAT-MM  PICTURE 99.
003900     02 DAT-JJ  PICTURE 99.
004000 01  DAT-NORM2 REDEFINES DAT-NORM.
004100     05 FILLER PIC X(5).
004200     05 DAT-JJ2 PIC X.
004300 01  DAT-DRUCK SYNC.
004400     02 DR-TT  PICTURE 99.
004500     02 FILLER PICTURE X.
004600     02 DR-MM  PICTURE 99.
004700     02 FILLER PICTURE X.
004800     02 DR-JJ  PICTURE 99.
004900 01  PARAMET SYNC.
005000     05 EINGFELD PICTURE 9.
005100     05 EINGFELDX REDEFINES EINGFELD PIC X.
005200     05 DAT-UNGUELT PICTURE X.
005300 PROCEDURE DIVISION USING DAT-NUM, DAT-NORM, DAT-DRUCK, PARAMET.
005400 UMFORMEN.
005500     MOVE ' ' TO DAT-UNGUELT.
005600     MOVE +1 TO INDEX--X.
005700     IF EINGFELDX IS LESS THAN '1' GO TO R0.
005800     GO TO R1 R2 R3 R4 DEPENDING ON EINGFELD.
005900 R0.
006000     MOVE 'Z' TO DAT-UNGUELT GO TO  DAT-UMF-E.
006100 R1.
006200     TRANSFORM DAT-NUM3 FROM 'ü×^?"ìô' TO 'ºÇ<*%@è‘'.
006300     IF DAT-NUM IS NOT NUMERIC GO TO FEHLER1.
006400     IF DAT-NUM IS LESS THAN +1 GO TO FEHLER1.
006500     MOVE DAT-NUM TO WS-NUM.
006600     IF WS-TTT IS LESS THAN +1 GO TO FEHLER1.
006700     MOVE WS-JJ TO                 DAT-JJ.
006800 SCHALTJAHR.
006900     DIVIDE 4 INTO WS-JJ GIVING WS-SCH-JAHR.
007000     IF WS-SCH-JR IS EQUAL TO 00 ADD 1 TO TT (2).
007100 UMF1.
007200     IF INDEX--X IS GREATER THAN 12 GO TO FEHLER1.
007300     SUBTRACT TT (INDEX--X) FROM WS-TTT.
007400     IF WS-TTT IS NOT GREATER THAN 000 GO TO UMF2.
007500     ADD +1 TO INDEX--X.
007600     GO TO UMF1.
007700 UMF2.
007800     ADD TT (INDEX--X) TO WS-TTT.
007900     MOVE WS-TTT2 TO WS-SCH-JAHR.
008000     MOVE WS-SCH-JA TO DAT-TT.
008100     MOVE INDEX--X TO          DAT-MM.
008200     GO TO DAT-UMF-ENDE.
008300 R4.
008400     MOVE CURRENT-DATE TO DAT-DRUCK.
008500     MOVE DR-TT TO DAT-MM.
008600     MOVE DR-MM TO DAT-TT.
008700     GO TO R3A.
008800 R3.
008900     MOVE DR-TT TO DAT-TT.
009000     MOVE DR-MM TO DAT-MM.
009100 R3A.
009200     MOVE DR-JJ TO DAT-JJ.
009300 R2.
009400     IF DAT-NORM IS NOT NUMERIC GO TO FEHLER2.
009500     IF DAT-JJ2 IS LESS THAN '0' GO TO FEHLER2.
009600     IF DAT-MM IS LESS THAN 01 GO TO FEHLER2.
009700     IF DAT-MM IS GREATER THAN 12 GO TO FEHLER2.
009800     MOVE DAT-JJ TO WS-JJ.
009900     PERFORM SCHALTJAHR.
010000     IF DAT-TT IS LESS THAN 01 GO TO FEHLER2.
010100     IF DAT-TT IS GREATER THAN TT (DAT-MM) GO TO FEHLER2.
010200     MOVE DAT-TT TO WS-TTT.
010300 UMF21.
010400     IF INDEX--X IS EQUAL TO DAT-MM GO TO UMF22.
010500     ADD TT (INDEX--X) TO WS-TTT.
010600     ADD +1 TO INDEX--X.
010700     GO TO UMF21.
010800 UMF22.
010900     MOVE WS-NUM TO DAT-NUM.
011000     GO TO DAT-UMF-ENDE.
011100 FEHLER1.
011200     MOVE ZEROS TO DAT-NORM.
011300     GO TO FEHLER.
011400 FEHLER2.
011500     MOVE +0 TO DAT-NUM.
011600 FEHLER.
011700     MOVE 'Z' TO DAT-UNGUELT.
011800 DAT-UMF-ENDE.
011900     MOVE DAT-TT TO NORM-TT.
012000     MOVE DAT-MM TO NORM-MM.
012100     MOVE DAT-JJ TO NORM-JJ.
012200     MOVE WS-DNORM TO DAT-DRUCK.
012300     MOVE 28 TO TT (2).
012400 DAT-UMF-E.
012500     GOBACK.

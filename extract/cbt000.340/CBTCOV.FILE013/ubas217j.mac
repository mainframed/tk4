//Z325044N JOB    (6613,044,2,,RRR),MSGLEVEL=1,
//  TIME=3,CLASS=B,MSGCLASS=O,NOTIFY=Z325044
//*
//*****************************************************************
//*
//*  PROCEDURE ASTTEST
//*
//ASTTEST  PROC   ASTSUM=,ASTLOG=,
//  UNT=DISK,
//  CL='*'
//*
//*  T E S T J O B   AUTOMATISCHE ABSTIMMUNG
//*  ===========================================
//*
//*   LIB   = DSNAME EINER PDS-DATEI, IN DIE DIE LOADMODULE ABSTROOT
//*           USW. EINGEFUEGT WERDEN
//*   ASTSUM  = NAME DER SUMMENDATEI
//*   ASTLOG  = NAME DER LOGDATEI
//*   CL    = SYSOUT-CLASS
//*   V     = VOLUME, AUF DEM ASTLOG  ERSTELLT WIRD
//*           Z.B V=DA620
//*   UNT   = UNITNAME FUER PLATTE
//CRLOG     EXEC  PGM=IEFBR14
//*
//*  ASTLOG  PREALLOCATION UND KATALOGISIEREN
//*  ---------------------------------------
//*
//ASTLOG    DD    DSN=&ASTLOG,DISP=(,CATLG),
//   UNIT=&UNT,VOL=SER=&V,
//   SPACE=(TRK,(1,1)),LABEL=EXPDT=99365,
//   DCB=(RECFM=FB,BLKSIZE=48,LRECL=48)
//CRSUM     EXEC  PGM=OPV20
//*
//*  ASTSUM INITIALISIEREN
//*  ---------------------------------------
//*
//STEPLIB   DD    DSN=&LIB,DISP=SHR
//ASTPRINT  DD    SYSOUT=&CL,DCB=(RECFM=FB,BLKSIZE=1200,LRECL=120)
//ASTSUM    DD    DSN=&ASTSUM,DISP=SHR
//INSUM     EXEC  PGM=OPV21
//*
//*  WEITERE SUMMEN IN ASTSUM EINFUEGEN
//*  ---------------------------------------
//*
//STEPLIB   DD    DSN=&LIB,DISP=SHR
//ASTPRINT  DD    SYSOUT=&CL,DCB=(RECFM=FB,BLKSIZE=1200,LRECL=120)
//ASTSUM    DD    DSN=&ASTSUM,DISP=SHR
//ASTLOG   DD    DSN=&ASTLOG,DISP=MOD
//ASM  EXEC  PGM=IEUASM,REGION=150K,RD=R,
//  PARM=DECK
//*
//* TEST AUTOMATISCHE ABSTIMMUNG
//*  ---------------------------------------
//*
//SYSLIB  DD  DSN=SYS1.MACLIB,DISP=SHR
//SYSUT1 DD UNIT=&UNT,SPACE=(CYL,(3,2)),DSN=&&UT1
//SYSUT2 DD UNIT=&UNT,SPACE=(CYL,(3,2)),DSN=&&UT2
//SYSUT3 DD UNIT=(&UNT,SEP=(SYSUT2,SYSUT1,SYSLIB)),
//   SPACE=(CYL,(3,2)),DSN=&&UT3
//SYSPUNCH  DD  DSN=&&LOADSET,DISP=(MOD,PASS),
//  UNIT=&UNT,SPACE=(CYL,(1,1)),
// DCB=BLKSIZE=3040
//SYSPRINT DD SYSOUT=&CL,
// DCB=(RECFM=FBSM,BLKSIZE=3146)
//SYSGO    DD DSN=NULLFILE,DCB=BLKSIZE=3040
//LKED EXEC PGM=IEWL,PARM='MAP,LIST,LET,SIZE=(110K,24K)',REGION=120K,
//   COND=(4,LT,ASM),RD=R
//SYSLIN DD DSN=&&LOADSET,DISP=(OLD,DELETE)
//   DD DDNAME=SYSIN
//SYSLMOD DD UNIT=(&UNT,SEP=(SYSLIN)),SPACE=(CYL,(1,1,1)),
// DISP=(,PASS),DSN=&&GOSET(ASM)
//SYSLIB    DD    DSN=&LIB,DISP=SHR
//SYSUT1 DD UNIT=(&UNT,SEP=(SYSLIN,SYSLMOD)),SPACE=(CYL,(3,2)),
//   DSN=&&UT1
//SYSPRINT DD SYSOUT=&CL,DCB=BLKSIZE=605
//GO EXEC PGM=*.LKED.SYSLMOD,COND=((4,LT,ASM),(4,LT,LKED)),RD=R,
//  REGION=70K
//STEPLIB   DD    DSN=&LIB,DISP=SHR
//SYSUDUMP DD SYSOUT=&CL
//ASTBLATT  DD    SYSOUT=&CL
//ASTSUM    DD    DSN=&ASTSUM,DISP=SHR
//ASTLOG    DD    DSN=&ASTLOG,DISP=SHR
//KARTEN    DD    DSN=&LIB,DISP=SHR
//      PEND
//*
//*  ENDE PROCEDURE ASTTEST
//*
//*****************************************************************
//*
//*  ASTSUM DATEI ANLEGEN
//*
//  EXEC  PGM=IDCAMS
//SYSPRINT  DD  SYSOUT=*
//SYSIN     DD  *
 DELETE OPV.ASTLOG PURGE
 DELETE OPV.ASTSUM PURGE
 DEFINE CLUSTER (NAME(OPV.ASTSUM) -
                 VOLUMES(VV0537) KEYS(10 2) -
                 CYLINDERS(1 1)  IMBED UNIQUE -
                 SHAREOPTIONS(3 3) -
                 RECORDSIZE(170 404) FREESPACE(10 10) -
                 TO(99365) FILE(ASTSUM))
//ASTSUM    DD  UNIT=3330V,VOL=SER=VV0537,DISP=SHR
//TEST  EXEC  ASTTEST,
//  LIB='Z325044.ASTTEST.LOAD',
//  ASTSUM='OPV.ASTSUM',ASTLOG='OPV.ASTLOG',
//  UNT=3330V,V=VV0537
//CRSUM.ASTKOR  DD  *
ADDRZ00101 3006                              4000               0000
ADDRZ00101 4003                              6000               0000
ADDRZ10001 3015
ADDRZ10001 3103
//INSUM.ASTKOR  DD  *
ADDRZ00501 4006  JUENGSTE PER.          259093588
ADDRZ00501 4110  JUENGSTE PER.             799000
REPRZ00501 40 1- PERIODE-1              271051231               0000
REPRZ00501 40 2- PERIODE-2              284792642               0000
REPRZ00501 41 1- PERIODE-1                 894000               0000
REPRZ00501 41 2- PERIODE-2                 952000               0000
//ASM.SYSIN  DD  *
TEST     CSECT
         STM   14,12,12(13)   SAVE REGS
         LR    12,15          LOAD BASE REG
         USING *-6,12
         LA    1,SAVE         GET  SA ADR
         ST    1,8(0,13)      SA DONN CHAIN
         ST    13,4(0,1)      SA UP CHAIN
         LR    13,1           LOAD SA REG
         L     1,4(0,13)      GET HIGH SA
         LM    0,1,20(1)      RESTORE REGS 0 AND 1
         CALL  COBAST,(RCODE,BZEIT,TAB1,TAB2,TAB3),VL
         L     13,4(0,13)     GET HIGH SA ADR
         ST        15,16(0,13)         RETURNCODE
         LM    14,12,12(13)   RESTORE REGS
         BR    14
*
RCODE    DC    H'0'
BZEIT    DC    CL15'4.QUARTAL 1974'
TAB1     DC    PL8'628705881,814937461,628705881'
TAB2     DC    PL3'103,89,202,2645,2453,2453'
TAB3     DC    PL2'9,10'
SAVE     DC    18F'0'
         END
//GO.ASTPARM  DD  *
RZ10001 K RZ 100 01        ABSTIMMZAHLEN BEISPIEL
RZ10001 *0** E I N G A B E
RZ10001 *    -------------
RZ10001 F KARTEN
RZ10001 S 01 ANZAHL KA1                    02010HERR ANTON    * FOD/AV
RZ10001 S 02 ANZAHL KA2                    02020              RZ K 010
RZ10001 S 03 ANZAHL KA3                    03020              RZ00101 30
RZ10001 S                                       ODER          RZ00101 30
RZ10001 S                                                    +RZ00101 40
RZ10001 S 04 KARTENANZAHL GESAMT           02030              RZ10001 01
RZ10001 S                                                    +RZ10001 02
RZ10001 S                                                    +RZ10001 03
RZ10001 F BESTAND
RZ10001 S 10 WERT                          01023MONAT         RZ00501 40
RZ10001 S                                       MONAT-1      +RZ00501 40
RZ10001 S                                       MONAT-2      +RZ00501 40
RZ10001 S 11 SATZANZAHL                    02040MONAT         RZ00501 41
RZ10001 S                                       MONAT-1      +RZ00501 41
RZ10001 S                                       MONAT-2      +RZ00501 41
RZ10001 S 12 WERT AUSGEFILTERT             01033
RZ10001 S 13 SATZANZAHL AUSGEFILTERT       02050              RZ10001 11
RZ10001 S                                                    -RZ10001 04
RZ10001 *0** A U S G A B E
RZ10001 *    -------------
RZ10001 F BESTF
RZ10001 S 30 WERT AUSGEFILTER              01013              RZ10001 12
RZ10001 S 31 SATZANZAHL AUSGEFILTERT       02060              RZ10001 13
RZ10001 F LISTE
RZ10001 S 40 RZ L 102  SEITENANZAHL        03010

000010 ID DIVISION.
000020 PROGRAM-ID. SYE95701.
000030 AUTHOR. BUCHHOLZ  BWO.
000040 REMARKS.
000050     DIESES PROGRAMM ERSTELLT EINE TSO-STATISTIK
000060     NACH USERID AUS DEN DATEN VON SY.ACCTMOD.
000070     SKIP3
000080 ENVIRONMENT DIVISION.
000090 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.
000110     SELECT ACCTMOD   ASSIGN TO UT-S-EDATEI1.
000120     SELECT KAD20     ASSIGN TO UT-S-EDATEI2.
000130     SELECT SORTDATEI ASSIGN TO UT-S-SDATEI1.
000140     SELECT LISTE     ASSIGN TO UT-S-ADATEI1.
000150     SKIP3
000160 DATA DIVISION.
000170 FILE SECTION.
000180     SKIP1
000190 FD  ACCTMOD RECORDING F LABEL RECORD STANDARD
000200     BLOCK 0 RECORDS DATA RECORD ACCSATZ.
000210 01  ACCSATZ.
000220     02 ACSA        PIC 99.
000230     02 FILLER      PIC X(12).
000240     02 ACJOB1-4    PIC X(4).
000250     02 FILLER       PIC X(4).
000260     02 ACJSZT       PIC S9(8)   COMP.
000270     02 ACJSDT       PIC S9(7)   COMP-3.
000280     02 FILLER       PIC X(9).
000290     02 ACSEZT       PIC S9(8)   COMP.
000300     02 ACSEDT       PIC S9(7)   COMP-3.
000310     02 ACKA-IN      PIC S9(7)   COMP.
000320     02 FILLER       PIC X(11).
000330     02 ACSTEPN.
000340        03 ACSTEPN-2 PIC X(2).
000350        03 ACSTEPN-7 PIC X(5).
000360        03 ACSTEPN-8 PIC X.
000370     02 ACREGGEF     PIC S9(4)   COMP.
000380     02 FILLER       PIC X(10).
000390     02 ACANR        PIC X(9).
000400     02 ACZEIL       PIC S9(7)   COMP.
000410     02 ACKA-OUT     PIC S9(7)   COMP.
000420     02 FILLER       PIC XXX.
000430     02 ACANZDEV     PIC S99.
000440     02 ACDEVICES.
000450        03 ACDEVICE         OCCURS 40 TIMES.
000460           04 ACDEVTYP  PIC 999      COMP.
000470           04 ACDEVADR  PIC 999      COMP.
000480           04 ACZUGR    PIC S9(7)    COMP.
000490     02 ACCPUZT      PIC S9(8)    COMP.
000500     02 FILLER       PIC X(12).
000510 FD  KAD20 RECORDING F LABEL RECORD STANDARD
000520     BLOCK 0 RECORDS DATA RECORD KSATZ.
000530 01  KSATZ.
000540     02 D20KA        PIC XXX.
000550     02 D20FOLGE     PIC 9.
000560     02 D20FAKTOR    PIC S99V999  OCCURS 15 TIMES.
000570     02 D20F1        PIC X.
000580     SKIP1
000590 SD  SORTDATEI RECORDING F DATA RECORD SORTSATZ.
000600 01  SORTSATZ.
000610     02 SORTFELD.
000620        03 USERID    PIC X(8).
000630        03 JSDT      PIC S9(7)    COMP-3.
000640        03 JSZT      PIC S9(8)   COMP.
000650        03 PRNR      PIC X(9).
000660     02 SEDT         PIC S9(7)   COMP-3.
000670     02 SEZT         PIC S9(8)   COMP.
000680     02 CPUZT        PIC S9(8)   COMP.
000690     02 REGION       PIC S9(4)   COMP.
000700     02 KA-IN        PIC S9(7)   COMP.
000710     02 KA-OUT       PIC S9(7)   COMP.
000720     02 ZEIL         PIC S9(7)   COMP.
000730     02 ANZDEV       PIC S99.
000740     02 DEVICES.
000750        03 DEVICE        OCCURS 40 TIMES.
000760           04 DEVTYP     PIC 999  COMP.
000770           04 DEVADR     PIC 999  COMP.
000780           04 ZUGR       PIC S9(7) COMP.
000790     SKIP1
000800 FD  LISTE RECORDING F LABEL RECORD OMITTED
000810     BLOCK 0 RECORDS DATA RECORD ASATZ.
000820 01  ASATZ.
000830     02 VOR          PIC X.
000840     02 FILLER       PIC X(132).
000850     SKIP2
000860 WORKING-STORAGE SECTION.
000870     SKIP1
000880 77  IND1            PIC 99.
000890 77  UIND            PIC 999             VALUE ZEROS.
000900 77  DIND            PIC 99              VALUE ZEROS.
000910 77  BLZL            PIC 999             VALUE ZEROS.
000920 77  ZZL             PIC 99              VALUE ZEROS.
000930 77  SZAEHL          PIC 9(6)            VALUE ZEROS.
000940 77  AZAEHL          PIC 9(6)            VALUE ZEROS.
000950 77  SCHALTER        PIC X               VALUE ZEROS.
000960 77  SCHALTER1       PIC X               VALUE ZEROS.
000970 77  ANZPL           PIC S9(7)    COMP-3    VALUE ZEROES.
000980 77  ANZB            PIC S9(7)    COMP-3    VALUE ZEROES.
000990 77  ANZBS           PIC S9(7)    COMP-3    VALUE ZEROES.
001000 77  EXCPPL          PIC S9(7)    COMP-3    VALUE ZEROES.
001010 77  EXCPB           PIC S9(7)    COMP-3    VALUE ZEROES.
001020 77  EXCPBS          PIC S9(7)    COMP-3    VALUE ZEROES.
001030 77  EXCPKA-IN       PIC S9(7)    COMP-3    VALUE ZEROES.
001040 77  EXCPKA-OUT      PIC S9(7)    COMP-3    VALUE ZEROES.
001050 77  EXCPZEIL        PIC S9(7)    COMP-3    VALUE ZEROES.
001060 77  IND             PIC 99.
001070 77  XD              PIC 99.
001080 77  KIND            PIC 99.
001090 77  TPROC           PIC S9(9)V999   COMP-3  VALUE ZEROES.
001100 77  KOSTE           PIC 9(6)V99      VALUE ZEROES.
001110 77  KOST            PIC 9(6)V99.
001120     SKIP2
001130 01  SUMMENFELDER.
001140     02  USULOGONZT      PIC S9(10)    COMP    VALUE ZEROS.
001150     02  GSULOGONZT      PIC S9(10)    COMP    VALUE ZEROS.
001160     02  USUCPUZT        PIC S9(8)    COMP   VALUE ZEROS.
001170     02  GSUCPUZT        PIC S9(8)    COMP   VALUE ZEROS.
001180     02  USUKOST         PIC S9(6)V99        VALUE ZEROS.
001190     02  GSUKOST         PIC S9(6)V99        VALUE ZEROS.
001200     02  SCPUZT          PIC S9(8)    COMP   VALUE ZEROS.
001210     SKIP1
001220 01  ZEILE1.
001230     02 FILLER       PIC X       VALUE '1'.
001240     02 FILLER       PIC X(19)   VALUE 'BOSCH-EDA3  JOBNR '.
001250     02 JOBNR        PIC X(10).
001260     02 FILLER       PIC X(8)    VALUE 'LIST-NR '.
001270     02 PROGNR       PIC X(8).
001280     02 FILLER       PIC X       VALUE '/'.
001290     02 LISTNR       PIC 99.
001300     02 FILLER       PIC X(42)   VALUE '      T S O - STATISTIK NA
001310-                                'CH USERID       '.
001320     02 FILLER       PIC X(6)    VALUE 'MONAT '.
001330     02 MONMON       PIC X(3).
001340     02 FILLER       PIC X       VALUE SPACE.
001350     02 JAHRJAHR     PIC 99.
001360     02 FILLER       PIC X(11)   VALUE '    DATUM  '.
001370     02 EDATUM.
001380        03 ETAG      PIC 99.
001390        03 FILLER    PIC X       VALUE '.'.
001400        03 EMON      PIC 99.
001410        03 FILLER    PIC X       VALUE '.'.
001420        03 EJAHR     PIC 99.
001430     02 FILLER       PIC X(8)    VALUE '  BLATT '.
001440     02 BLNR         PIC ZZ9.
001450     SKIP1
001460 01  ZEILE2.
001470     02 FILLER       PIC X       VALUE '-'.
001480     02 FILLER       PIC X(50)   VALUE ' USERID          DATUM
001490-                                      '      PROJEKT-NR       S'.
001500     02 FILLER       PIC X(50)   VALUE 'TART       STOP      LOGON
001510-                                      '-ZEIT        CPU-ZEIT   '.
001520     02 FILLER       PIC X(32)   VALUE '          KOSTEN
001530-                                      '      '.
001540     SKIP1
001550 01  ZEILE3.
001560     02 FILLER       PIC X       VALUE ' '.
001570     02 FILLER       PIC X(55)   VALUE SPACES.
001580     02 FILLER       PIC X(41)   VALUE 'ZEIT              (STD)
001590-                                      '          (MIN)'.
001600     02 FILLER       PIC X(36)   VALUE SPACES.
001610     SKIP1
001620 01  DRUCKZEILE1.
001630     02 VORSCHUB1    PIC X       VALUE SPACES.
001640     02 USERID3      PIC X(9).
001650     02 FILLER       PIC X(6)    VALUE SPACES.
001660     02 DATUM.
001670        03 TAG       PIC XX.
001680        03 P1        PIC X.
001690        03 MON       PIC XX.
001700        03 P2        PIC X.
001710        03 JAHR      PIC XX.
001720     02 FILLER       PIC X(9)    VALUE SPACES.
001730     02 PROJNR       PIC X(10).
001740     02 FILLER       PIC X(5)    VALUE SPACES.
001750     02 STARTZT.
001760        03 ASTD      PIC Z9.
001770        03 FILLER    PIC X       VALUE '.'.
001780        03 AMIN      PIC 99.
001790        03 FILLER    PIC X       VALUE '.'.
001800        03 ASEC      PIC 99.
001810     02 FILLER       PIC X(4)    VALUE SPACES.
001820     02 STOPZT.
001830        03 ESTD      PIC Z9.
001840        03 FILLER    PIC X       VALUE '.'.
001850        03 EMIN      PIC 99.
001860        03 FILLER    PIC X       VALUE '.'.
001870        03 ESEC      PIC 99.
001880     02 FILLER       PIC X(3)    VALUE SPACES.
001890     02 LOGONZT.
001900        03 LSTD      PIC ZZZ9.
001910        03 FILLER    PIC X       VALUE '.'.
001920        03 LMIN      PIC 99.
001930        03 FILLER    PIC X       VALUE '.'.
001940        03 LSEC      PIC 99.
001950     02 FILLER       PIC X(11)   VALUE SPACES.
001960     02 CPU.
001970        03 CMIN      PIC Z9.
001980        03 FILLER    PIC X       VALUE '.'.
001990        03 CSEC      PIC 99.
002000     02 FILLER       PIC X(12)   VALUE SPACES.
002010     02 DKOST        PIC Z(4)9.99.
002020     02 FILLER       PIC X(18)   VALUE SPACES.
002030     SKIP1
002040 01  DRUCKZEILE2.
002050     02 VORSCHUB2    PIC X.
002060     02 FILLER       PIC X(70)   VALUE SPACES.
002070     02 ULOGONZT.
002080        03 ULSTD     PIC ZZZ9.
002090        03 FILLER    PIC X       VALUE '.'.
002100        03 ULMIN     PIC 99.
002110        03 FILLER    PIC X       VALUE '.'.
002120        03 ULSEC     PIC 99.
002130     02 FILLER       PIC XXX     VALUE ' **'.
002140     02 FILLER       PIC X(8)    VALUE SPACES.
002150     02 UCPU.
002160        03 UCMIN     PIC Z9.
002170        03 FILLER    PIC X       VALUE '.'.
002180        03 UCSEC     PIC 99.
002190     02 FILLER       PIC X(12)   VALUE ' **         '.
002200     02 UKOST        PIC Z(4)9.99.
002210     02 FILLER       PIC X(13)   VALUE ' **          '.
002220     SKIP1
002230 01  DRUCKZEILE3.
002240     02 VORSCHUB3    PIC X.
002245     02 FILLER PIC X(19) VALUE 'GESAMTSUMMEN IN STD'.
002250     02 FILLER       PIC X(51)   VALUE SPACES.
002260     02 SLOGONZT.
002270        03 SSTD      PIC ZZZ9.
002280        03 FILLER    PIC X       VALUE '.'.
002290        03 SMIN      PIC 99.
002300        03 FILLER    PIC X       VALUE '.'.
002310        03 SSEC      PIC 99.
002320     02 FILLER       PIC X(8)    VALUE ' ***    '.
002330     02 SCPU.
002340        03 SCSTD     PIC Z9.
002350        03 FILLER    PIC X       VALUE '.'.
002360        03 SCMIN     PIC 99.
002370        03 FILLER    PIC X       VALUE '.'.
002380        03 SCSEC     PIC 99.
002390     02 FILLER       PIC X(10)   VALUE ' ***      '.
002400     02 SKOST        PIC Z(6)9.99.
002410     02 FILLER       PIC X(13)   VALUE ' ***         '.
002420     SKIP1
002430 01  PARMANGABEN.
002440     02 LAENGE-BIN   PIC S999    COMP      VALUE ZEROES.
002450     02 STEPZUSCHL   PIC S9V99             VALUE ZEROES.
002460     02 B-ZUGRZ      PIC SV999             VALUE ZEROES.
002470     02 P-ZUGRZ      PIC SV999             VALUE ZEROES.
002480     02 BS-ZUGRZ     PIC SV999             VALUE ZEROES.
002490     02 KA-IN-ZUGRZ  PIC SV999             VALUE ZEROES.
002500     02 KA-OU-ZUGRZ  PIC SV999             VALUE ZEROES.
002510     02 ZEIL-ZUGRZ   PIC SV999             VALUE ZEROES.
002520     02 BAND-FAKT    PIC S9V99             VALUE ZEROES.
002530     SKIP1
002540 01  ACCGRW1.
002550     02 GRW1.
002560        03 USERID1   PIC X(8).
002570        03 JSDT1     PIC S9(7)   COMP-3.
002580        03 JSZT1     PIC S9(8)   COMP.
002590     02 PRNR1        PIC X(9).
002600     02 SEDT1        PIC S9(7)   COMP-3.
002610     02 SEZT1        PIC S9(8)   COMP.
002620     02 CPUZT1       PIC S9(8)   COMP.
002630     02 REGION1      PIC S9(4)   COMP.
002640     02 KA-IN1       PIC S9(7)   COMP.
002650     02 KA-OUT1      PIC S9(7)   COMP.
002660     02 ZEIL1        PIC S9(7)   COMP.
002670     02 ANZDEV1      PIC S99.
002680     02 DEVICES1.
002690        03 DEVICE1       OCCURS 40 TIMES.
002700           04 DEVTYP1    PIC 999  COMP.
002710           04 DEVADR1    PIC 999  COMP.
002720           04 ZUGR1      PIC S9(7) COMP.
002730     SKIP1
002740 01  ACCGRW2.
002750     02 GRW2.
002760        03 USERID2   PIC X(8).
002770        03 JSDT2     PIC S9(7)   COMP-3.
002780        03 JSZT2     PIC S9(8)   COMP.
002790     02 PRNR2        PIC X(9).
002800     02 SEDT2        PIC S9(7)   COMP-3.
002810     02 SEZT2        PIC S9(8)   COMP.
002820     02 CPUZT2       PIC S9(8)   COMP.
002830     02 REGION2      PIC S9(4)   COMP.
002840     02 KA-IN2       PIC S9(7)   COMP.
002850     02 KA-OUT2      PIC S9(7)   COMP.
002860     02 ZEIL2        PIC S9(7)   COMP.
002870     02 ANZDEV2      PIC S99.
002880     02 DEVICES2.
002890        03 DEVICE2       OCCURS 40 TIMES.
002900           04 DEVTYP2    PIC 999  COMP.
002910           04 DEVADR2    PIC 999  COMP.
002920           04 ZUGR2      PIC S9(7) COMP.
002930     SKIP1
002940 01  KOST-TAB.
002950     02 KOSTEN  PIC S9(6)V999  COMP-3    OCCURS 15 TIMES.
002960     SKIP1
002970 01  UMRECHENFELDER.
002980     02 X-100        PIC S9(10)  COMP    VALUE +0.
002990     02 UHRZEIT      PIC 9(8)            VALUE ZEROES.
003000     02 FILLER REDEFINES UHRZEIT.
003010        03 UHR-H     PIC 9999.
003020        03 FILLER REDEFINES UHR-H.
003030           04 UHR-H1    PIC 99.
003040           04 UHR-H23   PIC 99.
003050        03 UHR-M     PIC 99.
003060        03 UHR-S     PIC 99.
003070     02 UHR-H-M REDEFINES UHRZEIT PIC 9(5).
003080     02 MASCHDAT     PIC 9(8)    SYNC    VALUE ZEROES.
003090     02 FILLER REDEFINES MASCHDAT.
003100        03 FILLER    PIC 999.
003110        03 MAJAR     PIC 99.
003120        03 MATAG     PIC 999.
003130     02 MONATSTAGE   PIC X(24)   VALUE '312831303130313130313031'.
003140     02 FILLER REDEFINES MONATSTAGE.
003150        03 MTAG     PIC 99      OCCURS 12 TIMES.
003160     02 TAGESDATUM   PIC 9(6)    SYNC    VALUE ZEROES.
003170     02 FILLER REDEFINES TAGESDATUM.
003180        03 TAGTAG    PIC 99.
003190        03 TAGMON    PIC 99.
003200        03 TAGJAR    PIC 99.
003210     02 M-IND        PIC S9(4)   SYNC    COMP    VALUE +0.
003220     02 DATUMTAGES   PIC 9(6)    SYNC    VALUE ZEROES.
003230     02 FILLER REDEFINES DATUMTAGES.
003240        03 DATJAR    PIC 99.
003250        03 DATMON    PIC 99.
003260        03 DATTAG    PIC 99.
003270     SKIP1
003280 01  DISPLAY-FELDER.
003290     02 DISPL-FELD           PIC X(70).
003300     02 SATZTAB.
003310        03 DISPLAYSATZ   OCCURS 5 TIMES.
003320           04 DISPFELD       PIC X(60).
003330           04 DISPZAEHL      PIC ZZZBZZ9.
003340     02 DISPDAT.
003350        03 FILLER            PIC X(13) VALUE SPACES.
003360        03 FILLER  PIC X(22) VALUE '   ERSTELLUNGSDATUM   '.
003370        03 DISPDAT1.
003380           04 DISPTT         PIC Z9.
003390           04 FILLER         PIC X VALUE '.'.
003400           04 DISPMM         PIC 99.
003410           04 FILLER         PIC X VALUE '.'.
003420           04 DISPJJ         PIC 99.
003430 01  DISP-LIT1       PIC X(60) VALUE ' *****  ABBRUCH  ABBRUCH  AB
003440-                              'BRUCH  ABBRUCH  ABBRUCH  *****  '.
003450 01  DISP-LIT2       PIC X(60) VALUE ' ********************  PROGR
003460-                              'AMMENDE  *********************  '.
003470 01  DISP-LIT3       PIC X(60) VALUE ' ******************  ENDE -
003480-                              'PROTOKOLL  *******************  '.
003490     SKIP1
003500 01  DISPDATUM.
003510     02 DISP-MM      PIC 99.
003520     02 FILLER       PIC X.
003530     02 DISP-TT      PIC 99.
003540     02 FILLER       PIC X.
003550     02 DISP-JJ      PIC 99.
003560     SKIP1
003570 01  MONATSTABELLE.
003580     02 FILLER      PIC X(9) VALUE 'JANFEBMRZ'.
003590     02 FILLER      PIC X(9) VALUE 'APRMAIJUN'.
003600     02 FILLER      PIC X(9) VALUE 'JULAUGSEP'.
003610     02 FILLER      PIC X(9) VALUE 'OKTNOVDEZ'.
003620 01  FILLER REDEFINES MONATSTABELLE.
003630     02 MONAT       PIC X(3)    OCCURS 12 TIMES.
003640     SKIP1
003650     01 DISP-JOB    PIC X(8)    VALUE SPACES.
003660     01 DISP-STEP   PIC X(8)    VALUE SPACES.
003670     01 DISP-PROG   PIC X(8)    VALUE SPACES.
003680     SKIP1
003690 LINKAGE SECTION.
003700 01  PARMFELD.
003710     02 LAENGE          PIC S999    COMP.
003720     02 PARMANG.
003730        03 PSTEPZUSCHL  PIC S9V99.
003740        03 PB-ZUGRZ     PIC SV999.
003750        03 PP-ZUGRZ     PIC SV999.
003760        03 PBS-ZUGRZ    PIC SV999.
003770        03 PKA-IN-ZUGRZ PIC SV999.
003780        03 PKA-OU-ZUGRZ PIC SV999.
003790        03 PZEIL-ZUGRZ  PIC SV999.
003800        03 PBAND-FAKT   PIC S9V99.
003810     SKIP1
003820 PROCEDURE DIVISION              USING PARMFELD.
003830     SKIP1
003840     IF LAENGE = ZEROES
003850        MOVE '****  PARMANGABEN FEHLEN  ****' TO DISPL-FELD
003860        CALL 'DISPLAY' USING DISPL-FELD
003870        STOP RUN
003880     ELSE     MOVE PARMFELD TO PARMANGABEN.
003890     SKIP1
003900     CALL 'JOBPROG' USING DISP-JOB, DISP-STEP, DISP-PROG.
003910     MOVE DISP-JOB TO JOBNR.
003920     MOVE DISP-PROG TO PROGNR.
003930     MOVE '01' TO LISTNR.
003940     SKIP1
003950*****    EROEFFNEN DER DATEIEN                               *****
003960     SKIP1
003970     OPEN INPUT ACCTMOD KAD20.
003980     OPEN OUTPUT LISTE.
003990     SKIP1
004000*****    ERSTELLUNGSDATUM UND ERSTELLUNGSMONAT               *****
004010     SKIP1
004020     MOVE CURRENT-DATE TO DISPDATUM.
004030     MOVE DISP-TT TO ETAG DISPTT.
004040     MOVE DISP-MM TO EMON DISPMM.
004050     MOVE DISP-JJ TO EJAHR DISPJJ.
004060     IF DISP-MM < 02 SUBTRACT 1 FROM DISP-JJ.
004070     MOVE DISP-JJ TO JAHRJAHR.
004080     IF DISP-MM < 02 MOVE 12 TO IND1
004090        ELSE COMPUTE IND1 = DISP-MM - 1.
004100     MOVE MONAT (IND1) TO MONMON.
004110     SKIP1
004120     PERFORM KD20LES.
004130     SKIP1
004140*****    SORTIEREN VON ACCTMOD NACH USERID, DATUM, PROJEKTNR *****
004150*****                               UND JOBSTARTZEIT.        *****
004160         SKIP1
004170     SORT SORTDATEI ASCENDING SORTFELD
004180          INPUT  PROCEDURE EXIT-15
004190          OUTPUT PROCEDURE EXIT-35.
004200     SKIP1
004210     IF SORT-RETURN NOT = ZEROS
004220        GO TO E5.
004230 E4.
004240     MOVE 'SAETZE VON SY.ACCTMOD' TO DISPFELD (1).
004250     MOVE AZAEHL TO DISPZAEHL (1).
004260     MOVE ' DAVON VERWENDET' TO DISPFELD (2).
004270     MOVE SZAEHL TO DISPZAEHL (2).
004280     MOVE SPACES TO DISPL-FELD. PERFORM E49.
004290     MOVE DISP-LIT3 TO DISPL-FELD. PERFORM E49.
004300     MOVE SPACES TO DISPL-FELD. PERFORM E49.
004310     MOVE DISPDAT TO DISPL-FELD. PERFORM E49.
004320     MOVE SPACES TO DISPL-FELD. PERFORM E49.
004330     MOVE DISPLAYSATZ (1) TO DISPL-FELD. PERFORM E49.
004340     MOVE DISPLAYSATZ (2) TO DISPL-FELD. PERFORM E49.
004350     MOVE SPACES TO DISPL-FELD. PERFORM E49.
004360     MOVE DISP-LIT2 TO DISPL-FELD. PERFORM E49.
004370 E41.
004380     CLOSE ACCTMOD KAD20.
004390     CLOSE LISTE.
004400     STOP RUN.
004410 E49.
004420     CALL 'DISPLAY' USING DISPL-FELD.
004430 E5.
004440     MOVE DISP-LIT1 TO DISPL-FELD. PERFORM E49.
004450 E7.
004460     PERFORM E49 10 TIMES.
004470     GO TO E41.
004480     SKIP1
004490 EXIT-15 SECTION.
004500 LESEN1.
004510     READ ACCTMOD AT END GO TO ENDE-15.
004520     ADD 1 TO AZAEHL.
004530     IF ACSA NOT = '04' GO TO LESEN1.
004540     IF ACSTEPN-2 NOT = 'DI' GO TO LESEN1.
004550     IF ACSTEPN-8 NOT = SPACE GO TO LESEN1.
004560     IF ACANR = ZEROS
004570        MOVE ACJOB1-4 TO PRNR
004580        ELSE MOVE ACANR TO PRNR.
004590     MOVE ACJSDT  TO JSDT.
004600     MOVE ACJSZT  TO JSZT.
004610     MOVE ACSEDT  TO SEDT.
004620     MOVE ACSEZT  TO SEZT.
004630     MOVE ACSTEPN TO USERID.
004640     MOVE ACCPUZT TO CPUZT.
004650     MOVE ACREGGEF TO REGION.
004660     MOVE ACKA-IN  TO KA-IN.
004670     MOVE ACKA-OUT TO KA-OUT.
004680     MOVE ACZEIL   TO ZEIL.
004690     MOVE ACANZDEV TO ANZDEV.
004700     MOVE ACDEVICES TO DEVICES.
004710     RELEASE SORTSATZ.
004720     GO TO LESEN1.
004730 ENDE-15.
004740     EXIT.
004750 EXIT-35 SECTION.
004760     SKIP1
004770*****    LISTENKOPF                                          *****
004780     SKIP1
004790 KOPF.
004800     ADD 1 TO BLZL.
004810     MOVE BLZL TO BLNR.
004820     WRITE ASATZ FROM ZEILE1 AFTER POSITIONING VOR.
004830     WRITE ASATZ FROM ZEILE2 AFTER POSITIONING VOR.
004840     WRITE ASATZ FROM ZEILE3 AFTER POSITIONING VOR.
004850     MOVE 5 TO ZZL.
004860     SKIP1
004870 LESEN2.
004880     RETURN SORTDATEI AT END GO TO ENDE-35.
004890     ADD 1 TO SZAEHL.
004900     GO TO A3.
004910     SKIP1
004920*****    UMRECHNUNG DES DATUMS UND DER UHRZEIT               *****
004930     SKIP1
004940 A1. COPY SYMASDAT.
004950     SKIP1
004960 A2. COPY SYUHRZET.
004970     SKIP2
004980 A3.
004990     IF SZAEHL NOT = 1 GO TO A4.
005000        PERFORM A41.
005010        MOVE 1 TO SCHALTER.
005020        GO TO LESEN2.
005030 SKIP1
005040*****    EINGELESENER SATZ HAT GLEICHE USERID                *****
005050 SKIP1
005060 A4.
005070     MOVE ACCGRW1 TO ACCGRW2.
005080 A41.
005090     MOVE JSDT   TO JSDT1.
005100     MOVE JSZT   TO JSZT1.
005110     MOVE SEDT   TO SEDT1.
005120     MOVE SEZT   TO SEZT1.
005130     MOVE CPUZT  TO CPUZT1.
005140     MOVE USERID TO USERID1.
005150     MOVE PRNR   TO PRNR1.
005160     MOVE REGION TO REGION1.
005170     MOVE KA-IN  TO KA-IN1.
005180     MOVE KA-OUT TO KA-OUT1.
005190     MOVE ZEIL   TO ZEIL1.
005200     MOVE ANZDEV TO ANZDEV1.
005210     MOVE DEVICES TO DEVICES1.
005220 A42.
005230     ADD CPUZT2 TO SCPUZT.
005240     PERFORM KOSTENBERECH.
005250     IF USERID1 = USERID2 ADD KOST TO KOSTE.
005260     IF USERID1 NOT = USERID2 MOVE 1 TO SCHALTER1
005270     ADD KOST TO KOSTE
005280     GO TO A5.
005290     IF GRW1 = GRW2 AND SCHALTER NOT = 2
005300     ADD KOST TO KOSTE
005310     GO TO LESEN2.
005330     SKIP1
005340 A5.
005350     IF USERID2 = USERID3 MOVE SPACES TO USERID3
005360        ELSE MOVE USERID2 TO USERID3.
005370     MOVE JSDT2 TO MASCHDAT.
005380     PERFORM MASCH-TAG-DATUM THRU MASCH-AUS.
005390     IF TAGTAG = TAG AND TAGMON = MON AND TAGJAR = JAHR
005400        AND PRNR2 = PROJNR
005402        MOVE SPACES TO DATUM PROJNR VORSCHUB1     GO TO A51.
005403     IF TAGTAG NOT = TAG OR TAGMON NOT = MON OR TAGJAR NOT = JAHR
005404        MOVE TAGTAG TO TAG
005410        MOVE TAGMON TO MON
005420        MOVE TAGJAR TO JAHR
005430        MOVE '.' TO P1 P2
005451        MOVE '0' TO VORSCHUB1
005480        MOVE PRNR2 TO PROJNR        GO TO A51.
005490     MOVE PRNR2 TO PROJNR.
005491     MOVE SPACES TO DATUM.
005500     MOVE ' ' TO VORSCHUB1.
005510     SKIP1
005520 A51.
005530     IF JSDT2 < SEDT2
005540        ADD 8640000 TO SEZT2.
005550     COMPUTE X-100 = SEZT2 - JSZT2.
005560     ADD X-100 TO USULOGONZT.
005570     PERFORM SEC-100-UHRZEIT.
005580     MOVE UHR-H TO LSTD.
005590     MOVE UHR-M TO LMIN.
005600     MOVE UHR-S TO LSEC.
005610     MOVE JSZT2 TO X-100.
005620     PERFORM SEC-100-UHRZEIT.
005630     MOVE UHR-H23 TO ASTD.
005640     MOVE UHR-M TO AMIN.
005650     MOVE UHR-S TO ASEC.
005660     MOVE SEZT2 TO X-100.
005670     PERFORM SEC-100-UHRZEIT.
005680     MOVE UHR-H23 TO ESTD.
005690     MOVE UHR-M TO EMIN.
005700     MOVE UHR-S TO ESEC.
005710     ADD SCPUZT TO USUCPUZT.
005720     MOVE SCPUZT TO X-100.
005730     PERFORM SEC-100-UHRZEIT.
005740     MOVE UHR-M TO CMIN
005750     MOVE UHR-S TO CSEC.
005760     ADD KOSTE TO USUKOST.
005770     MOVE KOSTE TO DKOST.
005780     MOVE ZEROES TO SCPUZT KOSTE.
005790     SKIP1
005800     IF ZZL > 66 PERFORM KOPF
005810        MOVE USERID2 TO USERID3
005820        MOVE PRNR2 TO PROJNR
005821     MOVE JSDT2 TO MASCHDAT
005822     PERFORM MASCH-TAG-DATUM THRU MASCH-AUS
005823     MOVE '.' TO P1 P2
005824     MOVE TAGTAG TO TAG
005825     MOVE TAGMON TO MON
005826     MOVE TAGJAR TO JAHR
005830        MOVE '-' TO VORSCHUB1.
005840     WRITE ASATZ FROM DRUCKZEILE1 AFTER POSITIONING VOR.
005850     MOVE PRNR2 TO PROJNR.
005870     MOVE USERID2 TO USERID3.
005871     MOVE TAGTAG TO TAG.
005872     MOVE TAGMON TO MON.
005873     MOVE TAGJAR TO JAHR.
005880     IF VOR = ' ' ADD 1 TO ZZL.
005890     IF VOR = '0' ADD 2 TO ZZL.
005900     IF VOR = '-' ADD 3 TO ZZL.
005910     IF SCHALTER1 = 1 MOVE 0 TO SCHALTER1 GO TO B.
005920     IF SCHALTER = 2 GO TO E1 ELSE GO TO LESEN2.
005930     SKIP1
005940*****    EINGELESENER SATZ HAT NEUE USERID                   *****
005950     SKIP1
005960 B.
005970     ADD USULOGONZT TO GSULOGONZT.
005980     ADD USUCPUZT TO GSUCPUZT.
005990     ADD USUKOST TO GSUKOST.
006000     SKIP1
006010     MOVE USULOGONZT TO X-100.
006020     PERFORM SEC-100-UHRZEIT.
006030     MOVE UHR-H TO ULSTD.
006040     MOVE UHR-M TO ULMIN.
006050     MOVE UHR-S TO ULSEC.
006060     MOVE USUCPUZT TO X-100.
006070     PERFORM SEC-100-UHRZEIT.
006080     MOVE UHR-M TO UCMIN.
006090     MOVE UHR-S TO UCSEC.
006100     MOVE USUKOST TO UKOST.
006110     SKIP1
006120     MOVE ZEROS TO USULOGONZT
006130                   USUCPUZT USUKOST.
006140     IF ZZL > 66 PERFORM KOPF
006150        MOVE '-' TO VORSCHUB2.
006160     MOVE '0' TO VORSCHUB2.
006170     WRITE ASATZ FROM DRUCKZEILE2 AFTER POSITIONING VOR.
006180     MOVE 70 TO ZZL.
006190     IF SCHALTER = 2 GO TO E2 ELSE GO TO LESEN2.
006200     SKIP1
006210*****    ENDE                                                *****
006220     SKIP1
006230 ENDE-35.
006240     MOVE 2 TO SCHALTER.
006250     PERFORM A4 THRU ENDE-35.
006260 E1.
006270     PERFORM B.
006280 E2.
006290     MOVE GSULOGONZT TO X-100.
006300     PERFORM SEC-100-UHRZEIT.
006310     MOVE UHR-H TO SSTD.
006320     MOVE UHR-M TO SMIN.
006330     MOVE UHR-S TO SSEC.
006340     MOVE GSUCPUZT TO X-100.
006350     PERFORM SEC-100-UHRZEIT.
006360     MOVE UHR-H23 TO SCSTD.
006370     MOVE UHR-M TO SCMIN.
006380     MOVE UHR-S TO SCSEC.
006390     MOVE GSUKOST TO SKOST.
006400     SKIP1
006410     MOVE '-' TO VORSCHUB3.
006420     IF ZZL > 66 PERFORM KOPF.
006430     WRITE ASATZ FROM DRUCKZEILE3 AFTER POSITIONING VOR.
006440 SCHLUSS.
006450     EXIT.
006460     SKIP1
006470 KD20LES SECTION.
006480 LESEN3.
006490     READ KAD20 AT END GO TO FEHLER.
006500     IF D20KA NOT = 'D20' GO TO LESEN3.
006505     IF D20FOLGE NOT = 4 GO TO LESEN3.
006510     MOVE ZEROES TO KIND KOST-TAB.
006520 ABSPEICH.
006530     ADD 1 TO KIND.
006540     IF KIND > 15 GO TO KD20LES-EX.
006550     MOVE D20FAKTOR (KIND) TO KOSTEN (KIND).
006560     GO TO ABSPEICH.
006570 FEHLER.
006580     MOVE '****   FEHLER IN KA D20  ****' TO DISPL-FELD.
006590     CALL 'DISPLAY' USING DISPL-FELD.
006600     STOP RUN.
006610 KD20LES-EX.
006620     EXIT.
006630     SKIP1
006640     SKIP3
006650****************************************************
006660*    BERECHNUNG DER KOSTEN FUER DIE TSO-BENUTZUNG   *
006670****************************************************
006680     SKIP1
006690 KOSTENBERECH SECTION.
006700     SKIP1
006710     MOVE ZEROES TO KOST
006720     SKIP1
006730*****    SYSIN-KARTEN VERRECHNEN                             *****
006740     SKIP1
006750     ADD KA-IN2 TO EXCPKA-IN.
006760     COMPUTE KOST ROUNDED
006770            = KOST
006780            + KA-IN2 * KOSTEN (6) / 1000.
006790     SKIP1
006800*****    SYSOUT-ZEILEN VERRECHNEN                            *****
006810     SKIP1
006820     ADD ZEIL2 TO EXCPZEIL.
006830     COMPUTE KOST ROUNDED
006840            = KOST
006850            + ZEIL2 * KOSTEN (7) / 1000.
006860     SKIP1
006870*****    FESTER ZUSCHLAG JE STEP                             *****
006880     SKIP1
006890     COMPUTE KOST ROUNDED
006900            = KOST
006910            + KOSTEN (11).
006920     SKIP1
006930*****    SYSOUT-KARTEN VERRECHNEN                            *****
006940     SKIP1
006950     ADD KA-OUT2 TO EXCPKA-OUT.
006960     COMPUTE KOST ROUNDED
006970            = KOST
006980            + KA-OUT2 * KOSTEN (8) / 1000.
006990     SKIP1
007000****************************************************
007010*****    DURCHARBEITEN DER DEVICE - TABELLE    *****
007020****************************************************
007030     SKIP1
007040     IF ANZDEV2 > 40
007050        MOVE ZERO TO ANZDEV2.
007060     IF ANZDEV2 = ZERO
007070        GO TO TPROCRECH.
007080     MOVE 1 TO IND.
007090 PRUEF.
007100     IF ZUGR2 (IND) NEGATIVE
007110        GO TO TPROCRECH.
007120     SKIP1
007130*****    HASP - EINHEITEN NICHT BERECHNEN                    *****
007140     SKIP1
007150     IF DEVADR2 (IND) > 399
007160     AND DEVADR2 (IND) < 418
007170         GO TO UR-UNIT.
007180     IF  (DEVADR2 (IND) > 655
007190     AND DEVADR2  (IND) < 690)
007200     OR  (DEVADR2 (IND) > 479
007210     AND DEVADR2  (IND) < 490)
007220         GO TO UR-UNIT.
007230     IF DEVTYP2 (IND) = 07
007240     OR DEVTYP2 (IND) = 08
007250     OR DEVTYP2 (IND) = 09
007260         GO TO UR-UNIT.
007270     IF  DEVTYP2 (IND) = 16
007280         GO TO BS-UNIT.
007290     IF  DEVTYP2 (IND) = 32
007300         GO TO PL-UNIT.
007310     IF  DEVTYP2 (IND) = 64
007320         GO TO TPROCRECH.   NOTE  **  STEUEREINHEITEN  **.
007330     IF  DEVTYP2 (IND) = 128
007340         GO TO TP-UNIT.
007350     GO TO TPROCRECH.
007360     SKIP2
007370 UR-UNIT.
007380     SKIP1
007390*****    KARTEN - EINGABE                                    *****
007400     SKIP1
007410     IF (DEVADR2 (IND) > 399
007420     AND DEVADR2 (IND) < 418)
007430     OR  DEVTYP2 (IND) = 07
007440     COMPUTE KOST ROUNDED
007450            = KOST
007460            + ZUGR2 (IND) * KOSTEN (6) / 1000
007470     ADD ZUGR2 (IND) TO EXCPKA-IN
007480     GO TO TPROCRECH.
007490     SKIP1
007500*****    KARTEN - AUSGABE                                    *****
007510     SKIP1
007520     IF (DEVADR2 (IND) > 479
007530     AND DEVADR2 (IND) < 490)
007540     OR  DEVTYP2 (IND) = 09
007550     COMPUTE KOST ROUNDED
007560            = KOST
007570            + ZUGR2 (IND) * KOSTEN (8) / 1000
007580     ADD ZUGR2 (IND) TO EXCPKA-OUT
007590     GO TO TPROCRECH.
007600     SKIP1
007610*****    ZEILEN                                              *****
007620     SKIP1
007630     IF (DEVADR2 (IND) > 655
007640     AND DEVADR2 (IND) < 690)
007650     OR  DEVTYP2 (IND) = 08
007660     COMPUTE KOST ROUNDED
007670            = KOST
007680            + ZUGR2 (IND) * KOSTEN (7) / 1000
007690     ADD ZUGR2 (IND) TO EXCPZEIL
007700     GO TO TPROCRECH.
007710     SKIP1
007720*****    BILDSCHIRME                                         *****
007730     SKIP1
007740 BS-UNIT.
007750     ADD 1 TO ANZBS
007760     ADD ZUGR2 (IND) TO EXCPBS
007770     GO TO TPROCRECH.
007780     SKIP1
007790*****    PLATTEN                                             *****
007800*****    BEI GLEICHER PLATTEN-ADRESSE                        *****
007810*****    NICHT ADDIEREN                                      *****
007820     SKIP1
007830 PL-UNIT.
007840     MOVE 1 TO XD.
007850 PL-UN1.
007860     IF DEVADR2 (XD) = DEVADR2 (IND)
007870     AND IND NOT = 1
007880        GO TO PL-UN2.
007890     IF XD < IND - 1
007900        ADD 1 TO XD
007910        GO TO PL-UN1.
007920     ADD 1 TO ANZPL.
007930 PL-UN2.
007940     ADD ZUGR2 (IND) TO EXCPPL.
007950     GO TO TPROCRECH.
007960     SKIP1
007970*****    BAENDER                                             *****
007980     SKIP1
007990 TP-UNIT.
008000     ADD 1 TO ANZB.
008010     ADD ZUGR2 (IND) TO EXCPB.
008020     GO TO TPROCRECH.
008030     SKIP1
008040 TPROCRECH.
008050     SKIP1
008060*****    INDEX IND WEITERSETZEN                              *****
008070     SKIP1
008080     IF IND < ANZDEV2
008090        ADD 1 TO IND
008100        GO TO PRUEF.
008110 SKIP1
008120**************************************
008130*****    BERECHNUNG DER TPROC    *****
008140**************************************
008150     SKIP1
008160     MOVE ZEROES TO TPROC.
008170     COMPUTE TPROC ROUNDED
008180            = CPUZT2 / 100
008190            + STEPZUSCHL
008200            + EXCPB      * B-ZUGRZ
008210            + EXCPPL     * P-ZUGRZ
008220            + EXCPBS     * BS-ZUGRZ
008230            + EXCPKA-IN  * KA-IN-ZUGRZ
008240            + EXCPKA-OUT * KA-OU-ZUGRZ
008250            + EXCPZEIL   * ZEIL-ZUGRZ.
008260     SKIP1
008270*****    BILDSCHIRME                                         *****
008280     SKIP1
008290     COMPUTE KOST ROUNDED
008300            = KOST
008310            + TPROC * ANZBS * KOSTEN (10).
008320     SKIP1
008330*****    SPEICHER                                            *****
008340     SKIP1
008350     COMPUTE KOST ROUNDED
008360            = KOST
008370            + TPROC * REGION2 * KOSTEN (2)
008380            / 3600 / 120.
008390     SKIP1
008400*****    PLATTEN                                             *****
008410     SKIP1
008420     COMPUTE KOST ROUNDED
008430            = KOST
008440            + EXCPPL * KOSTEN (3) / 1000
008450            + TPROC * ANZPL * KOSTEN (4) / 3600.
008460     SKIP1
008470*****    BAENDER                                             *****
008480     IF ANZB > 3
008490        COMPUTE KOST ROUNDED
008500               = KOST
008510               + TPROC * (ANZB - 3) * KOSTEN (5)
008520                       * BAND-FAKT / 3600
008530        MOVE 3 TO ANZB.
008540     COMPUTE KOST ROUNDED
008550            = KOST
008560            + TPROC * ANZB * KOSTEN (5) / 3600.
008570     SKIP1
008580*****    GEMEINKOSTEN                                        *****
008590     SKIP1
008600     COMPUTE KOST ROUNDED
008610            = KOST
008620            +  TPROC * KOSTEN (12)
008630*    KOMMA VERSETZT IN KAD20     *                           *****
008640            / 360.
008650     SKIP1
008660*****    CPU ZEIT RECHNEN                                    *****
008670     SKIP1
008680     COMPUTE KOST ROUNDED
008690            = KOST
008700            + CPUZT2 * KOSTEN (1) / 60 / 100.
008710     SKIP2
008720     MOVE ZEROES TO ANZPL  ANZB  ANZBS
008730                    EXCPPL  EXCPB  EXCPBS
008740                    EXCPKA-IN  EXCPKA-OUT  EXCPZEIL.
008750 KOSTENBERECH-EX.
008760     EXIT.

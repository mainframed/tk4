000100 ID DIVISION.
000200 PROGRAM-ID. SYE95601.
000300 AUTHOR. H. BUCHHOLZ.
000400 DATE-WRITTEN. AUGUST 1975.
000500 REMARKS.
000600     DIESES PROGRAM ERSTELLT EINE TSO-STATISTIK NACH
000700     BENUTZERGRUPPEN AUS DEN DATEN VON SY.ACCTMOD.
000800     SKIP3
000900 ENVIRONMENT DIVISION.
001000 INPUT-OUTPUT SECTION.
001100 FILE-CONTROL.
001200     SELECT ACCTMOD   ASSIGN TO UT-S-EDATEI1.
001300     SELECT LISTE     ASSIGN TO UT-S-ADATEI1.
001400     SELECT SORTDATEI ASSIGN TO UT-S-SDATEI1.
001500     SKIP3
001600 DATA DIVISION.
001700 FILE SECTION.
001800 FD  ACCTMOD RECORDING F
001900     LABEL RECORD STANDARD
002000     BLOCK 0 RECORDS
002100     DATA RECORD IS ASATZ.
002200 01  ASATZ           PIC X(440).
002300     SKIP2
002400 SD  SORTDATEI RECORDING F
002500     DATA RECORD IS ACCSATZ.
002600 01  ACCSATZ.
002700     02  SA          PIC 99.
002800     02  SSZT        PIC S9(8)       COMP.
002900     02  SSDT        PIC S9(7)       COMP-3.
003000     02  FILLER      PIC X(12).
003100     02  JSZT        PIC S9(8)       COMP.
003200     02  JSDT        PIC S9(7)       COMP-3.
003300     02  FILLER      PIC X(9).
003400     02  SEZT        PIC S9(8)       COMP.
003500     02  SEDT        PIC S9(7)       COMP-3.
003600     02  FILLER      PIC X(15).
003700     02  STEPN.
003800         03 STEPN1-2 PIC X(2).
003900         03 STEPN3-4 PIC X(2).
004000         03 STEPN5-7 PIC X(3).
004100         03 STEPN-8  PIC X.
004200     02  FILLER      PIC X(370).
004300     SKIP2
004400 FD  LISTE RECORDING F LABEL RECORD OMITTED
004500     BLOCK 0 RECORDS DATA RECORD IS ASATZ1.
004600 01  ASATZ1.
004700     02 VOR          PIC X.
004800     02 FILLER       PIC X(132).
004900     SKIP2
005000 WORKING-STORAGE SECTION.
005100 77  DURCH       PIC S9(8)   COMP    VALUE ZEROES.
005200 77  SULOGON     PIC 9(4)            VALUE ZEROES.
005300 77  SULOGONZT   PIC S9(10)  COMP    VALUE ZEROES.
005400 77  SUDURCH     PIC S9(8)   COMP    VALUE ZEROES.
005500 77  RECHF1      PIC S9(8)   COMP    VALUE ZEROES.
005600 77  IND1            PIC 99.
005700 77  IND             PIC 99.
005800 77  KZ          PIC X.
005900 77  ZZL         PIC 99              VALUE ZEROES.
006000 77  BLZ         PIC 99              VALUE ZEROES.
006100 77  SCHALTER    PIC 9               VALUE ZEROES.
006200 77  SZAEHL      PIC 9(6)            VALUE ZEROES.
006300 77  AZAEHL      PIC 9(6)            VALUE ZEROES.
006400     SKIP3
006500 01  FELD2.
006600     02 FILLER       PIC X(20)   VALUE 'EDP1,2,3 5  BWO     '.
006700     02 FILLER       PIC X(20)   VALUE 'EDA, EDP4           '.
006800     02 FILLER       PIC X(20)   VALUE 'FA. HESSER          '.
006900     02 FILLER       PIC X(20)   VALUE 'KTERA               '.
007000     02 FILLER       PIC X(20)   VALUE 'FAM-SH              '.
007100     02 FILLER       PIC X(20)   VALUE 'EVO                 '.
007200     02 FILLER       PIC X(20)   VALUE 'FAM-FE              '.
007250     02 FILLER       PIC X(20)   VALUE 'K8 - HEIDELBERG     '.
007300     02 FILLER       PIC X(20)   VALUE 'NEUE USERIDS        '.
007400 01  FILLER REDEFINES FELD2.
007500     02 BENUTZER     PIC X(20)   OCCURS 9 TIMES.
007600     SKIP1
007700 01  FELD3.
007800     02 INHALT                   OCCURS 9 TIMES.
007900        03 LOGONZT   PIC S9(10)  COMP.
008000        03 ANZLOGON  PIC 9(4)    COMP.
008100     SKIP1
008200 01  DRUCKZEILE1.
008300     02 DVOR         PIC X           VALUE '0'.
008400     02 FILLER       PIC X(10)       VALUE SPACES.
008500     02 DAT.
008600        03 DTAG      PIC Z9.
008700        03 P1        PIC X.
008800        03 DMON      PIC 99.
008900        03 P2        PIC X.
009000        03 DJAR      PIC 99.
009100     02 FILLER       PIC X(16)       VALUE SPACES.
009200     02 BENUTZ       PIC X(20).
009300     02 FILLER       PIC X(14)       VALUE SPACES.
009400     02 LOGONZEIT.
009500        03 LSTD      PIC ZZZ9.
009600        03 FILLER    PIC X           VALUE '.'.
009700        03 LMIN      PIC 99.
009800        03 FILLER    PIC X           VALUE '.'.
009900        03 LSEC      PIC 99.
010000     02 FILLER       PIC XX          VALUE SPACES.
010100     02 STERN1       PIC XX          VALUE SPACES.
010200     02 FILLER       PIC X(17)       VALUE SPACES.
010300     02 DURCHSCHNITT.
010400        03 DSTD      PIC ZZ9.
010500        03 FILLER    PIC X           VALUE '.'.
010600        03 DMIN      PIC 99.
010700        03 FILLER    PIC X           VALUE '.'.
010800        03 DSEC      PIC 99.
010900     02 FILLER       PIC XX          VALUE SPACES.
011000     02 STERN2       PIC XX          VALUE SPACES.
011100     02 FILLER       PIC X(20)       VALUE SPACES.
011200     SKIP1
011300 01  ZEILE1.
011400     02 FILLER       PIC X       VALUE '1'.
011500     02 FILLER       PIC X(19)   VALUE 'BOSCH-EDA3  JOB-NR '.
011600     02 JOBNR        PIC X(10).
011700     02 FILLER       PIC X(8)    VALUE 'LIST-NR '.
011800     02 PROGNR       PIC X(8).
011900     02 FILLER       PIC X       VALUE '/'.
012000     02 LISTNR       PIC 99.
012100     02 FILLER       PIC X(43)   VALUE '  T S O - STATISTIK NACH B
012200-                                'ENUTZERGRUPPEN   '.
012300     02 FILLER       PIC X(6)    VALUE 'MONAT '.
012400     02 MONMON       PIC X(3).
012500     02 FILLER       PIC X       VALUE SPACE.
012600     02 JAHRJAHR     PIC X(2).
012700     02 FILLER       PIC X(9)    VALUE '  DATUM  '.
012800     02 DATUM.
012900        03 TAG       PIC Z9.
013000        03 FILLER       PIC X       VALUE '.'.
013100        03 MON       PIC 99.
013200        03 FILLER       PIC X       VALUE '.'.
013300        03 JAHR      PIC 99.
013400     02 FILLER       PIC X(9)    VALUE '   BLATT '.
013500     02 BLNR         PIC ZZ9.
013600     SKIP1
013700 01  ZEILE2.
013800     02 FILLER   PIC X       VALUE '-'.
013900     02 FILLER   PIC X(11)   VALUE SPACES.
014000     02 FILLER   PIC X(5)    VALUE 'DATUM'.
014100     02 FILLER   PIC X(18)   VALUE SPACES.
014200     02 FILLER   PIC X(15)   VALUE 'BENUTZERGRUPPEN'.
014300     02 FILLER   PIC X(20)   VALUE SPACES.
014400     02 FILLER   PIC X(10)   VALUE 'LOGON-ZEIT'.
014500     02 FILLER   PIC X(19)   VALUE SPACES.
014600     02 FILLER   PIC X(12)   VALUE 'DURCHSCHNITT'.
014700     02 FILLER   PIC X(22)   VALUE SPACES.
014800     SKIP1
014900 01  ZEILE3.
015000     02 FILLER   PIC X       VALUE ' '.
015100     02 FILLER   PIC X(71)   VALUE SPACES.
015200     02 FILLER   PIC X(5)    VALUE '(STD)'.
015300     02 FILLER   PIC X(56)   VALUE SPACES.
015400     SKIP1
015500 01  FILLER.
015600     02 MONATSTABELLE.
015700        03 FILLER  PIC X(9) VALUE 'JANFEBMRZ'.
015800        03 FILLER  PIC X(9) VALUE 'APRMAIJUN'.
015900        03 FILLER  PIC X(9) VALUE 'JULAUGSEP'.
016000        03 FILLER  PIC X(9) VALUE 'OKTNOVDEZ'.
016100     02 FILLER REDEFINES MONATSTABELLE.
016200        03 MONAT   PIC X(3)  OCCURS 12 TIMES.
016300     SKIP1
016400 01  DISPLAY-FELDER.
016500     02 DISPL-AUS             PIC X(70).
016600     02 SATZTAB.
016700        03 DISPLAYSATZ        OCCURS 5 TIMES.
016800           04 DISPL-FELD      PIC X(60).
016900           04 DISPL-ZAEHL     PIC ZZZBZZ9.
017000     02 DISPDAT.
017100        03 FILLER  PIC X(13)  VALUE SPACES.
017200        03 FILLER  PIC X(22)  VALUE '   ERSTELLUNGSDATUM   '.
017300        03 DISPDAT1.
017400           04 DISPTT     PIC Z9.
017500           04 FILLER     PIC X      VALUE '.'.
017600           04 DISPMM     PIC 99.
017700           04 FILLER     PIC X       VALUE '.'.
017800           04 DISPJJ     PIC 99.
017900 01  DISP-LIT1       PIC X(60) VALUE ' *****  ABBRUCH  ABBRUCH  AB
018000-                              'BRUCH  ABBRUCH  ABBRUCH  *****  '.
018100 01  DISP-LIT2       PIC X(60) VALUE ' ********************  PROGR
018200-                              'AMMENDE  *********************  '.
018300 01  DISP-LIT3       PIC X(60) VALUE ' ******************  ENDE -
018400-                              'PROTOKOLL  *******************  '.
018500     SKIP1
018600 01  DISPDATUM.
018700     02 DISP-MM    PIC 99.
018800     02 FILLER     PIC X.
018900     02 DISP-TT    PIC 99.
019000     02 FILLER     PIC X.
019100     02 DISP-JJ    PIC 99.
019200     SKIP1
019250 01  UMRECHENFELDER.
019300    02 X-100             PIC S9(10)      COMP VALUE +0.
019400    02 UHRZEIT           PIC X(8) VALUE ZEROES.
019500    02 FILLER REDEFINES UHRZEIT.
019600       03 UHR-H          PIC 9999.
019700       03 UHR-M          PIC 99.
019800       03 UHR-S          PIC 99.
019900     02 UHR-H-M REDEFINES UHRZEIT   PIC 9(5).
020000     02 MASCHDAT         PIC 9(8)   SYNC  VALUE ZEROES.
020100     02 FILLER REDEFINES MASCHDAT.
020200        03 FILLER        PIC 999.
020300        03 MAJAR         PIC 99.
020400        03 MATAG         PIC 999.
020500      02 MONATSTAGE  PIC X(24) VALUE '312831303130313130313031'.
020600      02 FILLER REDEFINES MONATSTAGE.
020700         03 MTAG         PIC 99  OCCURS 12 TIMES.
020800      02 TAGESDATUM      PIC 9(6)  SYNC  VALUE ZEROES.
020900      02 FILLER REDEFINES TAGESDATUM.
021000         03 TAGTAG       PIC 99.
021100         03 TAGMON       PIC 99.
021200         03 TAGJAR       PIC 99.
021300      02 M-IND           PIC S9(4) SYNC VALUE ZEROES.
021400      02 DATUMTAGES      PIC 9(6)  SYNC  VALUE ZEROES.
021500      02 FILLER REDEFINES DATUMTAGES.
021600         03 DATTAG       PIC 99.
021700         03 DATMON       PIC 99.
021800         03 DATJAR       PIC 99.
021900     SKIP1
022000 01  DISP-JOB       PIC X(8)      VALUE  SPACES.
022100 01  DISP-STEP      PIC X(8)      VALUE  SPACES.
022200 01  DISP-PROG      PIC X(8)      VALUE  SPACES.
022300     SKIP1
022400 01  ACCGRW1.
022500     02 GRW1.
022600        03 JSDT1         PIC S9(7)    COMP-3.
022700        03 BKZ1          PIC XX.
022800        03 1USERID5-7    PIC 999.
022900        03 JSZT1         PIC S9(8)    COMP.
023000     02 SEDT1            PIC S9(7)    COMP-3.
023100     02 SEZT1            PIC S9(8)    COMP.
023200     SKIP1
023300 01  ACCGRW2.
023400     02 GRW2.
023500        03 JSDT2         PIC S9(7)    COMP-3.
023600        03 BKZ2          PIC XX.
023700        03 2USERID5-7    PIC 999.
023800        03 JSZT2         PIC S9(8)    COMP.
023900     02 SEDT2            PIC S9(7)    COMP-3.
024000     02 SEZT2            PIC S9(8)    COMP.
024100     SKIP3
024200 PROCEDURE DIVISION.
024300     SKIP1
024400     CALL 'JOBPROG' USING DISP-JOB, DISP-STEP, DISP-PROG.
024500     MOVE DISP-JOB TO JOBNR.
024600     MOVE DISP-PROG TO PROGNR.
024700     MOVE '01' TO LISTNR.
024800     SKIP1
024900     OPEN INPUT  ACCTMOD
025000     OPEN OUTPUT LISTE.
025100     SKIP1
025200     MOVE CURRENT-DATE TO DISPDATUM.
025300     MOVE DISP-TT TO TAG DISPTT.
025400     MOVE DISP-MM TO MON DISPMM.
025500     MOVE DISP-JJ TO JAHR DISPJJ.
025600     IF DISP-MM < 02 SUBTRACT 1 FROM DISP-JJ
025700     MOVE 12 TO IND1
025800     ELSE COMPUTE IND1 = DISP-MM - 1.
025900     MOVE MONAT (IND1) TO MONMON.
026000     MOVE DISP-JJ TO JAHRJAHR.
026100     PERFORM MOVEN VARYING IND FROM 1 BY 1
026200                    UNTIL IND > 9.
026300     GO TO KOPF.
026400 MOVEN.
026500     MOVE ZEROES TO LOGONZT (IND) ANZLOGON (IND).
026600     SKIP1
026700 KOPF.
026800     ADD 1 TO BLZ.
026900     MOVE BLZ TO BLNR.
027000     MOVE 4 TO ZZL.
027100     WRITE ASATZ1 FROM ZEILE1 AFTER POSITIONING VOR.
027200     WRITE ASATZ1 FROM ZEILE2 AFTER POSITIONING VOR.
027300     WRITE ASATZ1 FROM ZEILE3 AFTER POSITIONING VOR.
027400     SKIP1
027500 SORTIER.
027600     SORT SORTDATEI ASCENDING JSDT, STEPN, JSZT
027700          INPUT PROCEDURE EXIT-15
027800                OUTPUT PROCEDURE EXIT-35.
027900     SKIP1
028000     IF SORT-RETURN = ZEROES GO TO E1.
028100        GO TO E2.
028200     SKIP1
028300 E1.
028400     MOVE 'SAETZE VON SY.ACCTMOD' TO DISPL-FELD (1).
028500     MOVE ' DAVON VERWENDET'      TO DISPL-FELD (2).
028600     MOVE AZAEHL TO DISPL-ZAEHL (1).
028700     MOVE SZAEHL TO DISPL-ZAEHL (2).
028800     MOVE SPACES TO DISPL-AUS. PERFORM E12.
028900     MOVE DISP-LIT3 TO DISPL-AUS. PERFORM E12.
029000     MOVE SPACES TO DISPL-AUS. PERFORM E12.
029100     MOVE DISPDAT TO DISPL-AUS. PERFORM E12.
029200     MOVE SPACES TO DISPL-AUS. PERFORM E12.
029300     MOVE DISPLAYSATZ (1) TO DISPL-AUS. PERFORM E12.
029400     MOVE DISPLAYSATZ (2) TO DISPL-AUS. PERFORM E12.
029500     MOVE SPACES TO DISPL-AUS. PERFORM E12.
029600     MOVE DISP-LIT2 TO DISPL-AUS. PERFORM E12.
029700     GO TO E13.
029800 E12.
029900     CALL 'DISPLAY' USING DISPL-AUS.
030000 E13.
030100     CLOSE ACCTMOD.
030200     CLOSE LISTE.
030300     STOP RUN.
030400 E2.
030500     CALL 'DISPLAY' USING DISP-LIT1.
030600 E21.
030700     PERFORM E2 10 TIMES.
030800     GO TO E13.
030900     SKIP3
031000 EXIT-15 SECTION.
031100 LESEN1.
031200     READ ACCTMOD  AT END GO TO ENDE-15.
031300     MOVE ASATZ TO ACCSATZ.
031400     ADD 1 TO AZAEHL.
031500     IF SA NOT = '04' GO TO LESEN1.
031600     IF STEPN1-2 NOT = 'DI' GO TO LESEN1.
031700     IF STEPN-8 NOT = SPACE GO TO LESEN1.
031800     RELEASE ACCSATZ.
031900     GO TO LESEN1.
032000 ENDE-15.
032100     EXIT.
032200     SKIP3
032300 EXIT-35 SECTION.
032400 LESEN2.
032500     RETURN SORTDATEI AT END GO TO ENDE.
032600     ADD 1 TO SZAEHL.
032700 A0.
032800     IF SZAEHL NOT = 1 GO TO A01.
032900     PERFORM A02.
033000     GO TO LESEN2.
033100 A01.
033200     MOVE ACCGRW1 TO ACCGRW2.
033300 A02.
033400     MOVE JSZT TO JSZT1.
033500     MOVE JSDT TO JSDT1.
033600     MOVE SEZT TO SEZT1.
033700     MOVE SEDT TO SEDT1.
033800     MOVE STEPN3-4 TO BKZ1.
033900     MOVE STEPN5-7 TO 1USERID5-7.
034000 A03.
034100     IF GRW1 = GRW2 GO TO LESEN2.
034400 A1.
034500     IF BKZ2 = 'SH' MOVE 1 TO IND1 GO TO B.
034600     IF BKZ2 = 'FE' MOVE 2 TO IND1 GO TO B.
034700     IF BKZ2 = 'HE' MOVE 3 TO IND1 GO TO B.
034800     IF BKZ2 = 'K5' MOVE 4 TO IND1 GO TO B.
034900     IF BKZ2 = 'SF' MOVE 5 TO IND1 GO TO B.
035000     IF BKZ2 = 'K1' MOVE 6 TO IND1 GO TO B.
035100     IF BKZ2 = 'K8' MOVE 8 TO IND1 GO TO B.
035200     MOVE 9 TO IND1.
035300     SKIP1
035400 B.
035500     IF JSDT2 < SEDT2
035600        ADD 8640000 TO SEZT2.
035700     COMPUTE RECHF1 = SEZT2 - JSZT2.
035800     ADD RECHF1 TO LOGONZT (IND1).
035900     ADD 1 TO ANZLOGON (IND1).
036000 B1.
036100     IF JSDT1 = JSDT2 GO TO LESEN2
036150        ELSE GO TO DRUCK.
036200     SKIP1
036300 C.  COPY SYMASDAT.
036400     SKIP1
036500 D.  COPY SYUHRZET.
036600     SKIP1
036700 DRUCK.
036800     MOVE 1 TO IND1.
036900     MOVE ' ' TO KZ.
037000     IF ZZL > 66
037100        PERFORM KOPF.
037200     MOVE '0' TO DVOR.
037300     MOVE JSDT2 TO MASCHDAT.
037400     PERFORM MASCH-TAG-DATUM THRU MASCH-AUS.
037500     MOVE TAGTAG TO DTAG.
037600     MOVE TAGMON TO DMON.
037700     MOVE TAGJAR TO DJAR.
037800     MOVE '.' TO P1 P2.
037900     SKIP1
038000 DRUCK1.
038100     IF ANZLOGON (IND1) = ZERO GO TO DRUCK2.
038200     ADD  LOGONZT (IND1) TO SULOGONZT.
038300     ADD  ANZLOGON (IND1) TO SULOGON.
038400     IF KZ = '*' MOVE SPACES TO DAT.
038500     COMPUTE DURCH = LOGONZT (IND1) / ANZLOGON (IND1).
038600     MOVE DURCH TO X-100.
038700     PERFORM SEC-100-UHRZEIT.
038800     MOVE UHR-H TO DSTD.
038900     MOVE UHR-M TO DMIN.
039000     MOVE UHR-S TO DSEC.
039100     MOVE LOGONZT (IND1) TO X-100.
039200     PERFORM SEC-100-UHRZEIT.
039300     MOVE UHR-H TO LSTD. MOVE BENUTZER (IND1) TO BENUTZ.
039400     MOVE UHR-M TO LMIN.
039500     MOVE UHR-S TO LSEC.
039600     WRITE ASATZ1 FROM DRUCKZEILE1 AFTER POSITIONING VOR.
039700     IF DVOR = ' ' ADD 1 TO ZZL ELSE ADD 2 TO ZZL.
039800     MOVE ' ' TO DVOR. MOVE '*' TO KZ.
039900     IF ZZL > 66 PERFORM KOPF.
040000 DRUCK2.
040100     ADD 1 TO IND1
040200     IF IND1 > 9 AND SCHALTER = 1 GO TO ENDE1.
040300     IF IND1 > 9
040400        PERFORM MOVEN VARYING IND FROM 1 BY 1 UNTIL IND > 9
040600        GO TO LESEN2.
040700     GO TO DRUCK1.
040800     SKIP1
040900 ENDE.
041000     MOVE 1 TO SCHALTER.
041100     MOVE ACCGRW1 TO ACCGRW2.
041200     PERFORM A1 THRU B.
041300     PERFORM DRUCK THRU DRUCK2.
041400     SKIP1
041500 ENDE1.
041600     MOVE SPACES TO DAT.
041650     MOVE 'GESAMTSUMMEN IN STD ' TO BENUTZ.
041700     MOVE '**' TO STERN1, STERN2.
041800     COMPUTE SUDURCH = SULOGONZT / SULOGON.
041900     MOVE SUDURCH TO X-100.
042000     PERFORM SEC-100-UHRZEIT.
042100     MOVE UHR-H TO DSTD.
042200     MOVE UHR-M TO DMIN.
042300     MOVE UHR-S TO DSEC.
042400     MOVE SULOGONZT TO X-100.
042500     PERFORM SEC-100-UHRZEIT.
042600     MOVE UHR-H TO LSTD.
042700     MOVE UHR-M TO LMIN.
042800     MOVE UHR-S TO LSEC.
042900     MOVE '0' TO DVOR.
043000     WRITE ASATZ1 FROM DRUCKZEILE1 AFTER POSITIONING VOR.
043100     SKIP1
043200 ENDE2.
043300     EXIT.

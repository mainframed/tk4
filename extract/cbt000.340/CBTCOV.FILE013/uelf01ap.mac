 HMSFG:  PROC OPTIONS(MAIN);           /* SCREEN FORMAT GENERATOR     */
 DEFAULT RANGE(*) STATIC;

 /*********************************************************************/
 /*                                                                   */
 /*                UNTERNEHMENSBERATUNG DR.HENK                       */
 /*                                                                   */
 /*                8   M U E N C H E N   4 0                          */
 /*                                                                   */
 /*                    KUNIGUNDENSTR. 13                              */
 /*                                                                   */
 /*********************************************************************/

 /*********************************************************************/
 /*                                                                   */
 /*         DIESES PROGRAMM ERSTELLT AUS QUELLENKARTEN LAUT           */
 /*                                                                   */
 /*         BESCHREIBUNG 'SCREEN FORMAT GENERATOR'                    */
 /*                                                                   */
 /*         DIE ASSEMBLER-STATEMENTS FUER DEN IMS-FORMAT-SERVICE      */
 /*                                                                   */
 /*********************************************************************/

         IF DATE()>'990730' THEN DO;   /* DANACH RUECKSPRACHEMELDUNG  */
         WRITE FILE(SYSPRINT) FROM(HORZ);
         IT='BITTE RUECKSPRACHE MIT UNTERNEHMENSBERATUNG DR. HENK,';
         WRITE FILE(SYSPRINT) FROM(INPUT);
         IT='8 MUENCHEN 40, KUNIGUNDENSTR. 13, TEL.089/395115';
         WRITE FILE(SYSPRINT) FROM(INPUT);
         WRITE FILE(SYSPRINT) FROM(HORZ);
         WRITE FILE(SYSPRINT) FROM(SKIP);
         IF DATE()>'990807' THEN GOTO END; /* DANACH NICHTS WENN RUECK*/
         END;                          /* DANACH RUECKSPRACHEMELDUNG  */

 /*********************************************************************/
 /*                                                                   */
 /* 010  FILE - DEKLARATIONEN                                         */
 /*                                                                   */
 /*********************************************************************/

 DCL SYSIN     RECORD;
 DCL SYSOUT    RECORD OUTPUT ENV(FB BLKSIZE(1600) RECSIZE(080));
 DCL SYSPRINT  RECORD OUTPUT ENV(FB BLKSIZE(1089) RECSIZE(121) CTL360);

 /*********************************************************************/
 /*                                                                   */
 /* 020  TABELLEN - DEKLARATIONEN                                     */
 /*                                                                   */
 /*********************************************************************/

 DCL     TAB1(300) CHAR(14);           /* LITERAL-SPEICHER            */

 DCL 1   TB1       BASED(PT1),         /* LITERAL-EINZEL-DUMMY-FELD   */
      2  AN1       BIN FIXED,          /* ANFANGSSTELLE               */
      2  FL1       BIN FIXED,          /* FELDLAENGE                  */
      2  AT1       CHAR(1),            /* ATTRIBUT-TYP DFLD           */
      2  PZ1       PIC'(2)9',          /* PICTURE ZEILE               */
      2  PS1       PIC'(2)9',          /* PICTURE SPALTE              */
      2  ST1       PIC'(4)Z';          /* STATEMENT NR.               */

 DCL     ST(50)    PIC'(4)Z';          /* STATEMENT NR. INPUT         */

 DCL     TAB2(50)  CHAR(80);           /* TEXTZEILEN INPUT            */

 DCL 1   TB2       BASED(PT2),         /* MOD/MID-EINZEL-DUMMY-FELD   */
      2  PA2       PIC'(3)9',          /* FELD A  VON                 */
      2  PB2       PIC'(3)9',          /* FELD B  BIS                 */
      2  PC2       PIC'(3)9',          /* FELD C  INKREMENT           */
      2  JU2       CHAR(1),            /* JUST FORCED                 */
      2  FIL1      CHAR(4),
      2  AF2       CHAR(4),            /* ATTR/FILL FORCED            */
      2  FIL2      CHAR(1),
      2  LH2       CHAR(1),            /* LITERAL-HOCHKOMMA           */
      2  LT2       CHAR(23);           /* LITERAL                     */

 DCL 1   TB2S      BASED(PT2),         /* MOD/MID-SONDER-DUMMY-FELD   */
      2  SO2       CHAR(3),            /* SONDERFELD-SPEZIFIKATION    */
      2  SN2       CHAR(5),            /* SEGMENTNAME OHNE SEG        */
      2  FIL       CHAR(1),
      2  KO2       CHAR(56);           /* KOMMENTAR                   */

 DCL     CH2       CHAR(9)   BASED(PT2); /* MOD/MID STELLEN 1-9       */
 DCL     ZS2(80)   CHAR(1)   BASED(PT2); /* ZEILENSTELLEN EINZELN     */

 DCL     Z(4000)   CHAR(1)   DEF TAB2(1); /* EINZELSPALTEN            */
 DCL     ZG        CHAR(4000)DEF TAB2; /* GESAMTBILD                  */

 DCL 1   STDA      DEF TAB2,           /* STD-ANFANG                  */
      2  GR2       CHAR(1),            /* GRUPPENKENNZEICHEN          */
      2  FIL1      CHAR(3),
      2  AU2       CHAR(1),            /* MAKRO-AUFLOESUNG            */
      2  IO2       CHAR(1),            /* IO-ANFANG                   */
      2  HI2       CHAR(1),            /* HI-ANFANG                   */
      2  FIL2      CHAR(1),
      2  SL2       CHAR(40);           /* STANDARD-LEISTE             */

 DCL 1   FMTA      DEF TAB2,           /* FMT-ANFANG                  */
      2  AB2       CHAR(9),            /* FELD A,B,C                  */
      2  FM2       CHAR(7),            /* FORMATNAME + 1              */
      2  FIL1      CHAR(3),
      2  CU2       CHAR(10),           /* CURSOR + 1                  */
      2  FIL2      CHAR(3),
      2  DO2       CHAR(48);           /* DEVICE OPTIONS              */


 DCL 1   MMDA      DEF TAB2,           /* MOD/MID-ANFANG              */
      2  FIL1      CHAR(4),
      2  SW2       CHAR(1),            /* STANDARD-WAHL               */
      2  FIL2      CHAR(4),
      2  MN2       CHAR(8),            /* MOD/MID-NAME                */
      2  FIL3      CHAR(2),
      2  OP2       CHAR(1),            /* OPTION                      */
      2  CU3       PIC'(4)Z',          /* FMT: FELD-NR FUER CURS-POS  */
      2  FIL4      CHAR(5),
      2  NX2       CHAR(8),            /* NEXT                        */
      2  FIL5      CHAR(2),
      2  TR2       CHAR(41);           /* TRANCODE                    */

 DCL     TRA2      CHAR(61)  DEF TAB2  POS(20); /* TRANCODE VERSETZT  */

 DCL     TAB3(300) CHAR(20);           /* I/O-FELD-SPEICHER           */

 DCL 1   TB3       BASED(PT3),         /* I/O-EINZEL-DUMMY-FELD       */
      2  AT3       CHAR(1),            /* ATTRIBUT-TYP DFLD           */
      2  PE3       CHAR(1),            /* PEN-KONSTANTE               */
      2  FL3       BIN FIXED,          /* FELDLAENGE                  */
      2  PL3       PIC'(3)9',          /* PICTURE FELDLAENGE          */
      2  PZ3       PIC'(2)9',          /* PICTURE ZEILE               */
      2  PS3       PIC'(2)9',          /* PICTURE SPALTE              */
      2  PN3       PIC'(4)9',          /* PICTURE FELD-NR.            */
      2  ST3       PIC'(4)Z';          /* STATEMENT NR.               */

 DCL     PL0       PIC'(3)9';          /* PICTURE FELDLAENGE          */

 DCL 1   AT        BASED(PT3),         /* ATTRIBUT-TYP, 2. DEFINITION */
      2  ATB0      BIT(1),             /* NUM                         */
      2  ATB1      BIT(1),             /* PROT                        */
      2  ATB2      BIT(1),             /* DET                         */
      2  ATB3      BIT(1),             /* HI                          */
      2  ATB4      BIT(1),             /* MOD                         */
      2  ATB5      BIT(1),             /* NOSTRIP                     */
      2  ATB6      BIT(1),             /* IDET                        */
      2  ATB7      BIT(1);             /* NODISP                      */

 /*********************************************************************/
 /*                                                                   */
 /* 030  ZEILEN - DEKLARATIONEN                                       */
 /*                                                                   */
 /*********************************************************************/

 DCL 1 QUB,                  /* LISTUNG QUELLENBILD                   */
       2 CTL   BIT(8)        INIT('00010001'B), /* SPACE 2            */
       2 LIM1  CHAR(1)       INIT('×'), /* LINKE BILDBEGRENZUNG       */
       2 ITB   CHAR(80),                /* INPUT TEXT BILD            */
       2 LIM2  CHAR(1)       INIT('×'), /* RECHTE BILDBEGRENZUNG      */
       2 FIL1  CHAR(2)       INIT(' '),
       2 ISTB  PIC'(4)Z',               /* INPUT STATEMENT BILD       */
      2  FIL2  CHAR(3)       INIT(' '),
      2  VONC      CHAR(3),            /* I/O-FELD NR. 'VON'          */
      2  FIL3      CHAR(1)   INIT('-'),/* 'BIS'-STRICH                */
      2  BISC      CHAR(3)   INIT(' '),/* I/O-FELD NR. 'BIS'          */
      2  FIL4      CHAR(22)  INIT(' ');

 DCL     VON       PIC'(3)9' DEF VONC; /* I/O-FELD NR. 'VON'          */
 DCL     BIS       PIC'(3)9' DEF BISC; /* I/O-FELD NR. 'BIS'          */

 DCL 1 INPUT,                           /* LISTUNG DER QUELLENANGABEN */
       2 CTL   BIT(8)        INIT('00001001'B), /* SPACE 1            */
       2 LIM   CHAR(1)       INIT(''),  /* ANALOG LIM1                */
       2 IT    CHAR(80),                /* INPUT-TEXT                 */
       2 FIL1  CHAR(3)       INIT(''),
       2 IST   PIC'(4)Z'     INIT(0),   /* INPUT STATEMENT NR.        */
      2  FIL2      CHAR(32)  INIT(' ');

 DCL 1 GEN,                             /* GENERIERTE STATEMENTS      */
       2 CTL   BIT(8)        INIT('00001001'B), /* SPACE 1            */
       2 LIM   CHAR(1)       INIT(''),  /* ANALOG LIM1                */
      2  UT        CHAR(80)  INIT('         PRINT NOGEN'), /* OUTPUT  */
       2 FIL1  CHAR(3)       INIT(''),
       2 IST1  PIC'(4)Z'     INIT(1),   /* ZUGEHOERIGE INPUT-STMT-NR.1*/
       2 FIL2  CHAR(3)       INIT(''),
       2 IST2  PIC'(4)Z'     INIT(0),   /* ZUGEHOERIGE INPUT-STMT-NR.2*/
      2  FIL3      CHAR(25)  INIT(' ');

 DCL     UTPIC     PIC'(5)Z' DEF UT;   /* COMPILERZAEHLER             */

 DCL     UA        CHAR(80);           /* OUTPUT BEI AUFLOESUNG       */
 DCL     U         CHAR(80)  BASED(UP);

 DCL     LPU       PIC'(3)9' DEF UA    POS(18); /* LAENGE PLUS KONST. */
 DCL     PZU       PIC'(2)9' DEF UA    POS(31); /* PICTURE ZEILE      */
 DCL     PSU       PIC'(2)9' DEF UA    POS(34); /* PICTURE SPALTE     */
 DCL     ATU       CHAR(1)   DEF UA    POS(40); /* ATTRIBUT           */
 DCL     LLU       PIC'(3)9' DEF UA    POS(57); /* LTH LITERAL        */
 DCL     LIU       PIC'(3)9' DEF UA    POS(56); /* LTH I/O-FELD       */
 DCL     PNU       PIC'(4)9' DEF UA    POS(45); /* PICTURE FELD-NR.   */
 DCL     PEU       CHAR(1)   DEF UA    POS(67); /* PENFELD            */
 DCL     UNPK9     PIC'(9)9' DEF UA    POS(27); /* ENTPACKEN          */
 DCL     CHAR8     CHAR(8)   DEF UA    POS(27); /* IN HEXA UMWANDELN  */
 DCL     FIU       CHAR(2)   DEF UA    POS(33); /* FILL UNPK          */
 DCL     NUU       CHAR(1)   DEF UA    POS(35); /* NULLZIFFER         */
 DCL     P3U       PIC'(4)9' DEF UA    POS(44); /* PIC FELDNUMMER     */
 DCL     KOU       CHAR(23)  DEF UA    POS(49); /* KONSTANTE MOD/MID  */
 DCL     KFU       CHAR(3)   DEF UA    POS(41); /* KONSTANTE FLD      */

 DCL 1 HORZ,                            /* HORIZONTAL-STERN-ZEILE     */
      2  CTL       BIT(8)    INIT('00010001'B), /* SPACE 2            */
      2  HOR       CHAR(82)  INIT('0----+----1----+----2----+----3----+-
 ---4----+----5----+----6----+----7----+----8-'), /* HORIZONTALZEILE  */
      2  FIL       CHAR(38)  INIT('         FELD-NR');

 DCL 1 STSATZ,                          /* STATISTIK-SATZ             */
       2 CTL     BIT(8)       INIT('00010001'B), /* SPACE 2           */
       2 TXT1    CHAR(24)     INIT('         ZEILEN SYSIN  ='),
       2 PZL     PIC'(5)Z',             /* PICTURE ZEILEN             */
       2 TXT2    CHAR(25)     INIT('         ZEICHEN SYSIN  ='),
       2 PZC     PIC'(9)Z',             /* PICTURE ZEICHEN            */
      2  FIL1      CHAR(57)  INIT(' ');

 DCL 1 SKIP,                            /* BLATTVORSCHUB              */
       2 CTL     BIT(8)       INIT('10001011'B), /* VORSCHUB SOFORT   */
      2  FIL1      CHAR(120) INIT(' ');

 /*********************************************************************/
 /*                                                                   */
 /* 040  KONSTANTEN - DEKLARATIONEN                                   */
 /*                                                                   */
 /*********************************************************************/

 DCL     VAR       CHAR(2000)VAR;      /* VARIABLER CHARACTER-STRING  */
 DCL     SFM       CHAR(6)   VAR;      /* SAVE FMT-NAME               */
 DCL     JUSTER    CHAR(7)   VAR;      /* JUST ERGEBNIS               */
 DCL     ATFLER    CHAR(11)  VAR;      /* ATTR/FILL ERGEBNIS          */
 DCL     LITV      CHAR(9)   VAR;      /* LITERAL-ATTRIBUTE           */
 DCL     BZ        FIXED(5);           /* BILDZEILEN-NR..             */
 DCL     ZEILE1    PIC'(2)9';          /* POS-ANGABE ZEILE            */
 DCL     SPALTE1   PIC'(2)9';          /* POS-ANGABE SPALTE           */
 DCL     PBZ       PIC'(2)9';          /* PICTURE BILDZEILEN-NR.      */
 DCL     PLZ       PIC'(4)9';          /* PICTURE LAENGENZAEHLER      */
 DCL     LZ        BIN FIXED INIT(0);  /* LAENGENZAEHLER              */
 DCL     ZZAE      BIN FIXED INIT(0);  /* ZEILENZAEHLER FUER LISTE    */
 DCL     ALN       BIN FIXED;          /* ALIGNMENT                   */
 DCL     ZCIN      BIN FIXED(31)INIT(0); /* ZEICHEN INPUT             */
 DCL     ZCUT      BIN FIXED(31)INIT(10);/* ZEICHEN OUTPUT            */
 DCL     ZLUT      BIN FIXED INIT(1);  /* ZEILEN  OUTPUT              */
 DCL     ZLIN      FIXED(5)  INIT(0);  /* ZEILEN  INPUT               */
 DCL     LAB       CHAR(4)   INIT('
 DCL     IOM       CHAR(1)   INIT('^');/* IO-MARKE                    */
 DCL     HIM       CHAR(1)   INIT('@');/* HI-MARKE                    */
 DCL     SL        CHAR(40)  INIT(' ');/* STANDARD-LEISTE             */
 DCL     STD(0:7)  CHAR(5)   DEF SL;   /* EINZELFELDER                */
 DCL     CH2T      CHAR(9);            /* TRANSLATE-TEST ZU CH2       */
 DCL TR  CHAR(256) INIT ('


                                                     0123456789ABCDEF');
 DCL 1   PACK      ALIGNED,            /* ATTRIBUT-FELD               */
      2  FIL       CHAR(1),
      2  PACK5     CHAR(5);
 DCL 1   PACKP     DEF PACK5,
      2  ATP       CHAR(1),
      2  FL0       BIN FIXED,
      2  FIP       CHAR(2);
 DCL 1   PACKP2    DEF PACK5,
      2  ATP0      BIT(1),             /* JUST=L                      */
      2  ATP1      BIT(1),             /* ATTR=YES                    */
      2  ATP2      BIT(1),             /* MOD-KONSTANTE               */
      2  ATP3      BIT(1),             /* FILL=NULL                   */
      2  ATP4      BIT(4),             /* SCA                         */
      2  AFP       CHAR(4);            /* ATTR/FILL                   */
 DCL     PACKP3    FIXED(9)  DEF PACK5;

 /*********************************************************************/
 /*                                                                   */
 /* 050  STEUERUNGS - DEKLARATIONEN                                   */
 /*                                                                   */
 /*********************************************************************/

 DCL     LA        LABEL;              /* ALLG. VERZWEIGUNGS-ADRESSE  */
 DCL     ANF(0:4)  LABEL     AUTO;     /* VERZW. ZUM GRUPPEN-ANFANG   */
 DCL     MIT(0:4)  LABEL     AUTO;     /* VERZW. ZUR GRUPPEN-MITTE    */
 DCL     ING       BIN FIXED INIT(0);  /* GRUPPEN-INDEX               */
 DCL     BIT0      BIT(1)    INIT('0'B); /*                           */
 DCL     BIT1      BIT(1)    INIT('0'B); /* BILDZEILEN                */
 DCL     BIT2      BIT(1)    INIT('0'B); /* HI-LITERALE               */
 DCL     BIT3      BIT(1)    INIT('0'B); /* I/O-FELD                  */
 DCL     BIT4      BIT(1)    INIT('0'B); /* MIT FORTSETZUNG NACH 50   */
 DCL     BIT5      BIT(1)    INIT('0'B); /* MAKRO-AUFLOESUNG          */
 DCL     BIT6      BIT(1)    INIT('0'B); /* ENDE SYSIN                */

 /*********************************************************************/
 /*                                                                   */
 /* 060  ENDE UND ANFANG SYSIN                                        */
 /*                                                                   */
 /*********************************************************************/

         ON ENDFILE(SYSIN) BEGIN;      /* BEGIN                       */
         BIT6='1'B; GOTO P090;         /* SCHALTER ENDE, ZUR WEICHE   */
         END;                          /* BEGIN                       */

         WRITE FILE(SYSOUT) FROM(UT);
         READ FILE(SYSIN) INTO(IT);    /* SATZ LESEN                  */
         UP=ADDR(UT);                  /* AUSGABE OHNE AUFLOESUNG     */

 /*********************************************************************/
 /*                                                                   */
 /* 070  VERARBEITEN 1. SYSIN-RECORD PRO GRUPPE                       */
 /*                                                                   */
 /*  GRUPPEN-INDEX BESTIMMEN (0=DEFAULT, 1=STD, 2=FMT, 3=MOD, 4=MID)  */
 /*                                                                   */
 /*********************************************************************/

 ERST:   ING=INDEX('TMOI',SUBSTR(IT,3,1)); /* GRUPPEN-INDEX           */

 /*********************************************************************/
 /*                                                                   */
 /* 080  EINZELVERARBEITUNG (BIS ZU 50 RECORDS)                       */
 /*                                                                   */
 /*********************************************************************/

 P080:   DO N=1 TO 50;                 /* 50 SAETZE LESEN             */
         DO J=1 TO 80;
         IF SUBSTR(IT,J,1)^='' THEN
         IF SUBSTR(IT,J,1)^='-' THEN ZCIN=ZCIN+1; /* ZEICHEN INPUT    */
         END;
         ZLIN=ZLIN+1; /* ZEILEN INPUT */
         ST(N)=ZLIN;         /* STATEMENT NR.                         */
         TAB2(N)=IT;                   /* IN TEXTZEILEN-TABELLE       */
         IF ING=2 THEN                 /* FMT                         */
         IF BIT1 THEN GOTO P081;       /* FMT-BILDZEILEN              */
    ELSE IF SUBSTR(IT,72,1)=' ' THEN DO; /* OHNE FORTSETZUNG          */
         IL=N; BIT1='1'B;              /* INDEX LETZTE KOPFZEILE      */
         END;                          /* OHNE FORTSETZUNG            */
         IST=ST(N);
         WRITE FILE(SYSPRINT) FROM(INPUT); ZZAE=ZZAE+1;
 P081:   READ FILE(SYSIN) INTO(IT);    /* SATZ LESEN                  */
         IF SUBSTR(IT,1,1) =',' THEN GOTO P090; /* ZUR WEICHE         */
         END;                          /* 50 SAETZE LESEN             */

 /*********************************************************************/
 /*                                                                   */
 /* 090  VERZWEIGUNG ZU EINER GRUPPE                                  */
 /*                                                                   */
 /*           ANFANG EINER GRUPPE = ERSTE 50 RECORDS DER GRUPPE       */
 /*           MITTE  EINER GRUPPE = WEITERE  RECORDS DER GRUPPE       */
 /*                                                                   */
 /*********************************************************************/

 P090:   IF GR2=',' THEN GOTO ANF(ING);/* GRUPPENZEICHEN AM ANFANG    */
         GOTO MIT(ING);                /* MITTE                       */

 /*********************************************************************/
 /*                                                                   */
 /* 100  DEFAULT - GRUPPE                                             */
 /*                                                                   */
 /*********************************************************************/

 MIT(0):;
 ANF(0): GOTO EJECT3;   /* FEHLER */

 /*********************************************************************/
 /*                                                                   */
 /* 110  STD - GRUPPE                                                 */
 /*                                                                   */
 /*********************************************************************/

 ANF(1): IF AU2='A' THEN DO; BIT5='1'B;/* MAKRO-AUFLOESUNG            */
         UP=ADDR(UA);                  /* FUER AUSGABE                */
         END;                          /* MAKRO-AUFLOESUNG            */
    ELSE DO; BIT5='0'B;                /* OHNE AUFLOESUNG             */
         UP=ADDR(UT);                  /* FUER AUSGABE                */
         END;                          /* OHNE AUFLOESUNG             */
         IF IO2^=' ' THEN IOM=IO2; ELSE IOM='^'; /* IO-ANFANG         */
         IF HI2^=' ' THEN HIM=HI2; ELSE HIM='@'; /* HI-ANFANG         */
         SL=SL2;                       /* STANDARD-LEISTE             */
         DO J=0 TO 6 BY 2;             /* DOPPELFELDER                */
         SUBSTR(STD(J+1),1,1)=SUBSTR(STD(J),2,1); /* JUST UEBERTRAGEN */
         STD(J)=' ';                   /* DEFAULT                     */
         END;                          /* DOPPELFELDER                */
         GOTO ERST;          /* 1. SYSIN-RECORD NEUE GRUPPE           */
 MIT(1): GOTO EJECT3;  /* FEHLER */

 /*********************************************************************/
 /*                                                                   */
 /* 120  FMT - GRUPPE                                                 */
 /*                                                                   */
 /*********************************************************************/

 ANF(2): CALL FMT;
 FMT:    PROC;
         TAB2(N+1)=' 
         BIT1='0'B;                    /* BILDZEILEN ENDE             */
         BIT2='0'B;                    /* FORMATBEGINN NICHT HI       */
         WRITE FILE(SYSPRINT) FROM(HORZ); /* STERNZEILE               */
         N3=0; N1=0;                   /* I/O- UND LIT-TABELLENPLATZ  */
         L=1+IL*80; LV=L;              /* LAUFVARIABLE JETZT U.VORHER */
         IB=IL+1;                      /* INDEX D.BILDZ. IM SPEICHER  */
         BZ=1; JS=1; PBZ=1;            /* ZEILE UND SPALTE            */
         IF Z(L)^=' ' THEN             /* UNTERSUCHUNG ZEILE1 SPALTE1 */
         IF Z(L)^=IOM & Z(L)^=HIM THEN L=L+1; /* LITERAL UNERLAUBT    */
 V30:    DO L=L TO 4000 WHILE (Z(L)=''); END; /* MAX.BILD IL+1922     */
         IF Z(L)=IOM THEN DO;          /* I/O-FELD FOLGT              */
         BIT3='1'B; L=L+1;             /* 1. STELLE I/O-FELD (NACH ^) */
         END;                          /* I/O-FELD FOLGT              */
    ELSE IF Z(L)=HIM THEN DO;          /* HI-MARKE                    */
         BIT2=^BIT2; L=L+1; GOTO V30;  /* UMSETZEN, NORMAL WEITER     */
         END;                          /* HI-MARKE                    */
         JS=JS+L-LV; LV=L;             /* SPALTE=VORIGE+LAUFDIFFERENZ */
 V32:    IF JS>80 THEN DO;             /* ALTE ZEILE AUSGEBEN         */
         ITB=TAB2(IB);                 /* INPUT-TEXT BILD             */
         ISTB=ST(IB);                  /* INPUT-STATEMENT BILD        */
         IF BISC=' ' THEN VONC=' ';    /* DIESE ZEILE OHNE I/O-FELD   */
         WRITE FILE(SYSPRINT) FROM(QUB); /* QUELLENBILD               */
         IB=IB+1; BISC=' ';            /* INDEX BILDZEILE IM SPEICHER */
         IF IB>N THEN GOTO V39;        /* ENDE DER BELEGTEN ZEILEN    */
         BZ=BZ+1; PBZ=BZ;              /* ZEILE VORSETZEN             */
         JS=JS-80;                     /* SPALTE ZURUECKSETZEN        */
         GOTO V32;                     /* WEITERE ALTE ZEILE AUSGEBEN */
         END;                          /* ALTE ZEILE AUSGEBEN         */

 /*********************************************************************/
 /*                                                                   */
 /* 130  I/O-FELDER SUCHEN                                            */
 /*                                                                   */
 /*********************************************************************/

         IF BIT3 THEN DO;              /* I/O-FELD                    */
         BIT3='0'B;                    /* SCHALTER I/O-FELD LOESCHEN  */
         N3=N3+1;            /* I/O-TABELLENPLATZ VORSETZEN           */
         PT3=ADDR(TAB3(N3));           /* AUF TABELLENFELD            */
         PZ3=PBZ; PS3=JS;              /* PICTURE BILDZEILE UND SPALTE*/
         ST3=ST(IB); PN3=N3;           /* STATEMENT NR. UND FELDNUMMER*/
         IF BISC=' ' THEN VON=PN3;     /* 1. I/O-FELD DIESE ZEILE     */
         BIS=PN3;                      /* LETZTES I/O-FELD UPDATE     */
         AT3=TRANSLATE(Z(L),
                         '
 
 
 
         L=L+1;                        /* 2. STELLE I/O-FELD          */
         PE3=Z(L);                     /* EVTL. PEN-KONSTANTE         */
         DO L=L TO 4000 WHILE(Z(L) ='-'/* FELDLAENGE WENN FELDHALTUNG */
         ×Z(L)^=' ' & Z(L)^=IOM & Z(L)^=HIM); END; /* ODER KEIN ENDE  */
         FL3=L-LV; PL3=FL3;            /* FELDLAENGE                  */
         END;                          /* I/O-FELD                    */

 /*********************************************************************/
 /*                                                                   */
 /* 140  LITERALE SUCHEN                                              */
 /*                                                                   */
 /*********************************************************************/

    ELSE DO;                           /* LITERALE                    */
         DO L=L+1 TO 4000              /* LITERAL DURCHLAUFEN         */
         WHILE (Z(L)^=IOM & Z(L)^=HIM);/* SONST LITERAL-ENDE          */
         IF Z(L)=' ' THEN DO;          /* BLANK GEFUNDEN              */
         DO J=L+1 TO L+4               /* ABFRAGE AUF 4 BLANKS        */
         WHILE (Z(J)^=IOM & Z(J)^=HIM);/* SONST LITERAL-ENDE          */
         IF Z(J)^='' THEN DO;          /* LITERAL GEHT WEITER         */
         L=J; GOTO V37;                /* VORSETZEN UND IN LOOP       */
         END;                          /* LITERAL GEHT WEITER         */
         END;                          /* ABFRAGE AUF 4 BLANKS        */
         GOTO V38;                     /* LITERAL-ENDE                */
         END;                          /* BLANK GEFUNDEN              */
 V37:    END;                          /* LITERAL DURCHLAUFEN         */
 V38:    N1=N1+1;                      /* LITERALTABELLE VORSETZEN    */
         PT1=ADDR(TAB1(N1));           /* AUF TABELLENFELD            */
         FL1=L-LV; AN1=LV;             /* FELDLAENGE, ANFANGSSTELLE   */
         PZ1=PBZ; PS1=JS;              /* PICTURE BILDZEILE, -SPALTE  */
         ST1=ST(IB);                   /* STATEMENT NR.               */
         IF BIT2 THEN AT1='}'; ELSE AT1='{'; /* HI=D0, SONST C0       */
         END;                          /* LITERALE                    */
         GOTO V30;                     /* NAECHSTES FELD SUCHEN       */

 V39:    ITB=' '; VONC=' ';            /* INPUT-TEXT LOESCHEN         */
         DO J=BZ+1 TO 24;              /* LEERZEILEN                  */
         WRITE FILE(SYSPRINT) FROM(QUB);  /* QUELLENBILD              */
         END;
         WRITE FILE(SYSPRINT) FROM(HORZ); /* STERNZEILE               */
         WRITE FILE(SYSPRINT) FROM(SKIP); ZZAE=0;

 /*********************************************************************/
 /*                                                                   */
 /* 150  FMT - KOPFZEILEN                                             */
 /*                                                                   */
 /*********************************************************************/

         SFM=SUBSTR(FM2,1,INDEX(SUBSTR(FM2,2),' ')); /* SAVE FMT-NAME */
         UT=FM2××'  FMT';              /* FMT-STATEMENT               */
         LA=P151; GOTO OUT1;
 P151:   UT='         DEV   FEAT=IGNORE,TYPE='××DO2; /* DEVICE OPTIONS*/
         LA=P152; GOTO OUT1;
 P152:   DO K=2 TO IL;                 /* INDEX DER BILDZ. IM SPEICHER*/
         UT=TAB2(K); IST1=ST(K);       /* DEV FORTSETZUNGSZEILE       */
         LA=P153; GOTO OUT;
 P153:   END;                          /* INDEX DER BILDZ. IM SPEICHER*/
         IF SUBSTR(CU2,3,1)^=',' THEN DO; /* CORS-POS AUS FELD-NR     */
         PT3=ADDR(TAB3(CU3));          /* AUF TABELLENFELD            */
         SUBSTR(CU2,1,5)=PZ3××','××PS3;/* ZEILE UND SPALTE            */
         END;                          /* CURS-POS AUS FELD-NR        */
         UT='         DPAGE CURSOR=(('××
         SUBSTR(CU2,1,INDEX(SUBSTR(CU2,2),' '))××'))';
         LA=P160; GOTO OUT1;

 /*********************************************************************/
 /*                                                                   */
 /* 160  LITERALE AUFBEREITEN                                         */
 /*                                                                   */
 /*********************************************************************/

 P160:   JC=3;               /* COMPILERZAEHLER B.&GCX IN PGM=IFOX00  */
         DO N1=1 TO N1;                /* LITERAL-TABELLE             */
         PT1=ADDR(TAB1(N1));           /* AUF TABELLENFELD            */
         VAR=''''××SUBSTR(ZG,AN1,FL1)××''','; /* ROHLITERAL           */
         DO J=LENGTH(VAR)-2 TO 2 BY -1;/* LITERAL DURCHLAUFEN         */
         IF SUBSTR(VAR,J,1)=''''×SUBSTR(VAR,J,1)='&' THEN /* ' UND &  */
         VAR=SUBSTR(VAR,1,J)××SUBSTR(VAR,J); /* VERDOPPELN            */
         END;                          /* LITERAL DURCHLAUFEN         */
         IST1=ST1;                     /* STATEMENT NR.               */
 P161:   IF LENGTH(VAR)>240 THEN DO;   /* KRITISCHE LAENGE            */
         UTPIC=JC;           /* COMPILERZAEHLER 5STELLIG MIT BLANKS   */
         JMAX=238+VERIFY(UT,' ');      /* BEI 1STELLIG +5=243 INKL.'',*/
         IF LENGTH(VAR)>JMAX THEN DO;  /* LITERAL ZU LANG, TEILEN     */
         DO JG=LENGTH(VAR)+1-JMAX TO LENGTH(VAR) /* ENDTEIL VORWAERTS */
         WHILE(SUBSTR(VAR,JG,1)^=''); END;       /* WENN BLANK, O.K.  */
         IF JG^<LENGTH(VAR)            /* KEIN BLANK AUF MAXIMALLAENGE*/
         THEN JG=LENGTH(VAR)+1-JMAX;   /* ERZWUNGENE TEILUNG (BLANK)  */
         JZ=-2; /* SONDERZEICHEN=0, -1 FUER MODULUS, -1 FUER JG=1 =0  */
         DO JK=2 TO JG;                /* SONDERZ. D A V O R  SUCHEN  */
         IF SUBSTR(VAR,JK,1)=''''×
            SUBSTR(VAR,JK,1)='&' THEN DO; /* SONDERZEICHEN            */
         JZ=JZ-1; JK=JK+1;  /* SONZ. ABZIEHEN, VERDOPPLUNG UEBERGEHEN */
         END;                          /* SONDERZEICHEN               */
         END;                          /* SONDERZ. D A V O R  SUCHEN  */
         JK=JK-1; /* KORR. ZU JG, WEICHT AB, WENN & ODER ' AUSFAELLT  */
         JZ=JZ+JK;                     /* ECHTES DISPL. AB LIT-ANFANG */
         SUBSTR(VAR,JK,1)='''';        /* ANFANGS-HOCHKOMMA           */
         BZ=PZ1*80+PS1+JZ;             /* BZ ZWISCHENVERWENDUNG       */
         ZEILE1=BZ/80; SPALTE1=MOD(BZ,80)+1; /* POS-ANGABE TEILLITERAL*/
         END;                          /* LITERAL ZU LANG, TEILEN     */
    ELSE GOTO P162;                    /* LITERAL NICHT ZU LANG       */
         END;                          /* KRITISCHE LAENGE            */
         ELSE DO;                      /* NORMALE LAENGE              */
 P162:   JG=1; JK=1; JZ=-1;            /* GRUPPEN-POINTER             */
         ZEILE1=PZ1; SPALTE1=PS1;      /* POS-ANGABE AB LINKS         */
         END;                          /* NORMALE LAENGE              */

 /*********************************************************************/
 /*                                                                   */
 /* 170  LITERALE AUSGEBEN                                            */
 /*                                                                   */
 /*********************************************************************/

         JC=JC+1;            /* COMPILERZAEHLER PRO DFLD ERHOEHEN     */
         UT='         DFLD  ';         /* FUER 1. ZEILE               */
         IF AT1='{' THEN LITV='PROT';  /* X'C0', NORMAL               */
    ELSE LITV='(PROT,HI)';             /* HI-LITERAL                  */
         DO JV=JK TO LENGTH(VAR)       /* PRO ZEILENFUELLUNG          */
         -39+LENGTH(LITV) BY 56;       /* -(LETZTE ZEILE MINUS REST)  */
         SUBSTR(UT,16,56)=SUBSTR(VAR,JV); /* EVTL. NICHT GANZ VOLL    */
         SUBSTR(UT,72,1)='*';          /* FORTSETZUNGSZEICHEN         */
         LA=P171; GOTO OUTXB;          /* EXKLUSIV BLANK              */
 P171:   UT='';                        /* LOESCHEN WEGEN '   DFLD  '  */
         END;                          /* PRO ZEILENFUELLUNG          */
         IF JV>LENGTH(VAR)+1 THEN JV=LENGTH(VAR)+1; /* MAX.VAR+L'VAR+1*/
         SUBSTR(UT,16,56)=SUBSTR(VAR,JV) /* LETZTE ZEILE IM DFLD-STMT */
         ××'POS=('××ZEILE1××','××SPALTE1××'),ATTR='××LITV; /* REST    */
         LA=P172; GOTO OUTXB;          /* EXKLUSIV BLANK              */

 P172:   IF BIT5 THEN DO;              /* MAKRO-AUFLOESUNG            */
         UA='         DC    H''   ,01280,00,  ,  '',C'' 
 (   )';                               /* VORGABE LITERAL             */
         J=FL1-JZ-1;                   /* LITERALTEILLAENGE           */
         FL1=JZ;                       /* RESTLAENGE                  */
         LPU=J+23;                     /* LITERALTEILLAENGE+23        */
         PZU=ZEILE1; PSU=SPALTE1;      /* PICTURE ZEILE, SPALTE       */
         ATU=AT1; LLU=J;               /* ATTRIBUT, LITERALTEILLAENGE */
         IF MOD(J,2)=0 THEN ALN=1; ELSE ALN=2; /* 1=ALIGNMENT NOETIG  */
         JV=JK+1;                      /* OHNE 1. HOCHKOMMA           */
         LA=P173; GOTO OUTXA;          /* EXKLUSIV AUFLOESUNG         */
 P173:   IF JV >LENGTH(VAR)-ALN-51     /* MINUS 53 OHNE ALN-WERT      */
         THEN GOTO P174;               /* WENN NUR 1 ZEILE            */
         DO J=53 TO 1 BY -1 WHILE      /* J=LETZTE ZU VERWERTENDE POS */
         (SUBSTR(VAR,JV+J,1)=''''×SUBSTR(VAR,JV+J,1)='&'); END; /*OHNE*/
         IF J=0 THEN J=52;             /* ALLES SONDERZ., GERADE ZAHL */
         UA='         DC    C'''××SUBSTR(VAR,JV,J)××'''';
         JV=JV+J;                      /* ABGRIFF ERHOEHEN            */
         LA=P173; GOTO OUTXA;          /* EXKLUSIV AUFLOESUNG, ZURUECK*/
 P174:   UA='         DC    C'''××SUBSTR(VAR,JV,LENGTH(VAR)-JV-1)××
         SUBSTR(LAB,ALN,3);            /* LIT-ABSCHLUSS               */
         LA=P175; GOTO OUTXA;          /* EXKLUSIV AUFLOESUNG         */
 P175:   END;                          /* MAKRO-AUFLOESUNG            */

         IF JG>2 THEN DO;              /* NICHT LETZTER LITERALTEIL   */
         VAR=SUBSTR(VAR,1,JG-1)××''',';/* RESTLITERAL                 */
         GOTO P161;                    /* ZURUECK                     */
         END;                          /* NICHT LETZTER LITERALTEIL   */
         END;                          /* LITERAL-TABELLE             */

 /*********************************************************************/
 /*                                                                   */
 /* 180  I/O-FELDER AUSGEBEN                                          */
 /*                                                                   */
 /*********************************************************************/

         DO N3=1 TO N3;                /* I/O-TABELLE                 */
         PT3=ADDR(TAB3(N3));           /* AUF TABELLENFELD            */
         UA='         DC    H''23,-31488,00,  ,  '',C'' 
    ,0,0),C'' ''';                     /* VORGABE I/O-FELD            */
         VAR=',ATTR=';       /* ATTRIBUT INITIALISIEREN, LAENGE=6     */
         IF ATB0   THEN VAR=VAR××',NUM';
         IF ATB1   THEN VAR=VAR××',PROT';
         IF ATB7   THEN VAR=VAR××',NODISP';
    ELSE IF PE3^<'/' THEN DO;          /* DET ODER IDET               */
         IF PE3 ='/' THEN DO;          /* DET                         */
         ATB2='1'B; VAR=VAR××',DET';
         END;                          /* DET                         */
    ELSE DO;                           /* IDET                        */
         ATB6='1'B; VAR=VAR××',IDET';
         IF PE3 >'?' THEN DO;          /* IDET MIT PENFELD            */
         SUBSTR(UA,19,1)='4';          /* LAENGE 24 STATT 23          */
         SUBSTR(UA,62,1)='1';          /* LAENGE  1 STATT  0          */
         PEU=PE3;                      /* INHALT XX STATT 40          */
         END;                          /* IDET MIT PENFELD            */
         END;                          /* IDET                        */
         END;                          /* DET ODER IDET               */
         IF ATB3 THEN VAR=VAR××',HI';  /* HI                          */
         IF ATB4 THEN VAR=VAR××',MOD'; /* MOD                         */
         IF ATB5 THEN                  /* NOSTRIP                     */
         IF PE3^<'/' THEN VAR=VAR××',NOSTRIP'; /* BEI DET ODER IDET   */
    ELSE ATB5='0'B;                    /* NOSTRIP UNWIRKSAM           */
         VAR=VAR××')'; SUBSTR(VAR,7,1)='('; /* KLAMMERN EINSETZEN     */
         IST1=ST3;                     /* STATEMENT NR.               */
         UT='FLD' ××PN3   ××'  DFLD  POS=('××PZ3   ××','××
         PS3   ××'),LTH='××PL3   ;
         IF LENGTH(VAR)> 7 THEN DO;    /* MIT ATTRIBUTEN              */
         IF PEU^=' ' THEN              /* PENFELD                     */
         VAR=VAR××',PEN='''××PE3    ××''''; /* PEN-KONSTANTE          */
         IF LENGTH(VAR)>37 THEN DO;    /* LAENGER ALS 1 ZEILE         */
         SUBSTR(UT,35,1)=','; SUBSTR(UT,72,1)='*'; /* MIT FORTSETZUNG */
         LA=P182; GOTO OUTXB;          /* EXKLUSIV BLANK              */
 P182:   UT=(15)' '××SUBSTR(VAR,2);    /* REST                        */
         END;                          /* LAENGER ALS 1 ZEILE         */
    ELSE SUBSTR(UT,35,37)=VAR;         /* UM ATTRIBUTE ERWEITERN      */
         END;                          /* MIT ATTRIBUTEN              */

         IF BIT5 THEN DO;              /* MAKRO-AUFLOESUNG            */
         PZU=PZ3; PSU=PS3;             /* PICTURE ZEILE, SPALTE       */
         PNU=PN3; LIU=PL3;             /* FELD NR., LTH I/O-FELD      */
         ATU=AT3;                      /* ATTRIBUT UEBERTRAGEN        */
         IF ATU='&' THEN               /* X'50' (PROT,HI)             */
         UA=SUBSTR(UA,1,40)××SUBSTR(UA,40,40); /* VERDOPPELN          */
         END;                          /* MAKRO-AUFLOESUNG            */

         LA=P189; GOTO OUV;            /* AUSGABE LETZTE ZEILE        */
 P189:   END;                          /* I/O-TABELLE                 */
         UT = '         FMTEND';
         GOTO P280;                    /* GRUPPEN-ABSCHLUSS           */

 /*********************************************************************/
 /*                                                                   */
 /* 190  UNTERPROGRAMM AUSGABE IN PROCEDURE                           */
 /*                                                                   */
 /*********************************************************************/

 OUT1:   IST1=ST(01); GOTO OUT;
 OUTXB:  IF ^BIT5 THEN GOTO OUV;       /* EXKLUSIV BLANK OHNE AUFLOES.*/
         WRITE FILE(SYSPRINT) FROM(GEN);
         ZZAE=ZZAE+1; IF ZZAE>60 THEN DO;
         WRITE FILE(SYSPRINT) FROM(SKIP); ZZAE=0; END;
         GOTO LA;                      /* NUR PRINT                   */
 OUT:    UA=UT;
 OUV:    WRITE FILE(SYSPRINT) FROM(GEN);
         ZZAE=ZZAE+1; IF ZZAE>60 THEN DO;
         WRITE FILE(SYSPRINT) FROM(SKIP); ZZAE=0; END;
 OUTXA:  WRITE FILE(SYSOUT) FROM(U);
         ZLUT=ZLUT+1; /* ZEILEN OUTPUT */
         M=1;
 OUT3:   IF SUBSTR(U,M,1)^=' ' THEN ZCUT=ZCUT+1; /* ZEICHEN OUTPUT    */
         M=M+1; IF M^>80 THEN GOTO OUT3;
         GOTO LA;  /* RETURN */
         END;                          /* PROCEDURE                   */

 /*********************************************************************/
 /*                                                                   */
 /* 200  MOD- BZW. MID-GRUPPE                                         */
 /*                                                                   */
 /*********************************************************************/

 ANF(3): UT=MN2××' MSG   TYPE=OUTPUT,SOR=('××SFM××',IGNORE),OPT='××OP2××
         ',NXT='××NX2;
         ISTA=0;                       /* FUER STD-TABELLENFELD       */
         LA=P210; GOTO OUT1;           /* DANN GEMEINSAM              */

 MIT(3):;MIT(4): NA=1; GOTO P212;      /* MITTE, GEMEINSAM            */

 ANF(4): UT=MN2××' MSG   TYPE=INPUT,SOR='××SFM××',OPT='××OP2××
         ',NXT='××NX2;
         ISTA=2;                       /* FUER STD-TABELLENFELD       */
         LA=P210; GOTO OUT1;           /* DANN GEMEINSAM              */

 /*********************************************************************/
 /*                                                                   */
 /* 210  GEMEINSAME KOPFZEILEN                                        */
 /*                                                                   */
 /*********************************************************************/

 P210:   IF SW2='S' THEN ISTA=ISTA+1;  /* STANDARD-WAHL               */
         IF TR2^=' ' & ING=4 THEN DO;  /* TRANCODE BEI MID            */
         TRA2=TR2; AB2=' ';            /* LINKS VERSETZEN             */
         NA=1;                         /* ANFANG BEI TRANCODE         */
         END;                          /* TRANCODE                    */
    ELSE NA=2;                         /* NORMAL-ANFANG               */
         IF BIT5 & SUBSTR(TAB2(NA),1,3)^='SEG' THEN DO; /* NONAME SEG */
         UA='         DC    H''12,4864'',C''        ''';
         LA=P211; GOTO OUTXA;          /* EXKLUSIV AUFLOESUNG         */
 P211:   END;                          /* NONAME SEG                  */
 P212:   IF N=51 THEN DO; BIT4='1'B; N=50; END; /* MIT FORTSETZUNG    */

 /*********************************************************************/
 /*                                                                   */
 /* 220  NORMALFELDER                                                 */
 /*                                                                   */
 /*********************************************************************/

         DO N2=NA TO N;                /* MOD/MID-LOOP                */
         PT2=ADDR(TAB2(N2));           /* AUF TABELLENFELD            */
         CH2T=TRANSLATE(CH2,TR);       /* NUR BLANK UND 0-9 GLEICH    */
         IF CH2T^=CH2 THEN GOTO P260;  /* NICHT NUMERISCH, SONDERFELD */
         IA2=PA2; IB2=PB2; IC2=PC2;    /* VON, BIS, INKREMENT         */
         IF IA2=0 THEN GOTO P222;      /* HOECHSTENS 1 FELD (BIS)     */
         IF IB2=0 THEN DO; IB2=IA2; GOTO P222; END; /* NUR 1 FELD     */
         IF IC2=0 THEN IC2=1;          /* INKREMENT 1 ALS DEFAULT     */
         LA=P221;                      /* LOOP-RUECKSPRUNG            */
         DO IB2=IA2 TO IB2-IC2 BY IC2; /* FELDER VON-BIS OHNE LETZTES */
         GOTO MFLD;                    /* AUSGABE                     */
 P221:   END;                          /* FELDER VON-BIS OHNE LETZTES */
 P222:   IF LH2=' ' THEN DO;           /* OHNE LITERAL                */
         LA=P263; GOTO MFLD;           /* NACH AUSGABE LOOP-ENDE      */
         END;                          /* OHNE LITERAL                */
         IF ING=4 & IB2^=0 THEN DO;    /* MID-FELD VOR LITERAL        */
         LA=P230; GOTO MFLD;           /* NACH AUSGABE LITERAL        */
         END;                          /* MID-FELD VOR LITERAL        */

 /*********************************************************************/
 /*                                                                   */
 /* 230  LITERALE                                                     */
 /*                                                                   */
 /*********************************************************************/

 P230:   UA='         DC    H''016'',X''94         0'',C''FLD     ''';
         KOU=LT2;                      /* LITERAL Z.ZT. AUF 22 BESCHR.*/
         PACK5='õ';                    /* X'A0', VOR EINSPEICH. FL0   */
         DO J=80 TO 20 BY -1 WHILE(ZS2(J)=' '); END; /* ZEILENSTELLEN */
         FL0=J-21;                     /* L'KONSTANTE OHNE HOCHKOMMAS */
         LPU=FL0+16;                   /* FUER AUFLOESUNG LAENGE+16   */
         IST2=0;                       /* KEINE 2. REFERENZ           */
         LA=P263;                      /* AUF ENDE MOD/MID-LOOP       */

 /*********************************************************************/
 /*                                                                   */
 /* 240  LITERAL IM MODFELD                                           */
 /*                                                                   */
 /*********************************************************************/

         IF ING=3 THEN DO;             /* LITERAL IM MODFELD          */
         PT3=ADDR(TAB3(IB2));          /* AUF TABELLENFELD            */
         UT='         MFLD  (FLD'××PN3××','''××SUBSTR(LT2,1,FL0)××''')';
         LZ=LZ+FL3;                    /* FELDLAENGE, NICHT FUELLUNG  */
         GOTO OUVMOD;
         END;                          /* LITERAL IM MODFELD          */

 /*********************************************************************/
 /*                                                                   */
 /* 250  LITERAL BEI MID                                              */
 /*                                                                   */
 /*********************************************************************/

         UT='         MFLD  '''××LT2;
         LZ=LZ+FL0;                    /* LITERAL-LAENGE              */
         SUBSTR(UA,25,1)='1';          /* X'14' STATT '94'            */
         KFU=' ';                      /* KEINE FELDNUMMER            */
         GOTO OUVMID;

 /*********************************************************************/
 /*                                                                   */
 /* 260  SONDERFELD-RECORD                                            */
 /*                                                                   */
 /*********************************************************************/

 P260:   IF SO2='SEG' THEN DO;         /* SEGMENT                     */
         IF LZ^=0 THEN DO; LA=P262; GOTO OUTL; END; /* LAENGENZAEHLER */
 P262:   UT='SEG'××SN2××' SEG   '××KO2;
         IF BIT5 THEN
         UA='         DC    H''12,4864'',C''SEG'××SN2××'''';
         END;                          /* SEGMENT                     */
    ELSE IF SO2='CUR' THEN DO;         /* CURSOR                      */
         IF BIT5 THEN
         UA='         DC    H''016'',X''948000044000'',C''CUR     ''';
         UT='         MFLD  CUR,LTH=004';  LZ=LZ+4; END;
    ELSE IF SO2='PEN' THEN DO;         /* PENFIELD                    */
         IF BIT5 THEN
         UA='         DC    H''016'',X''948000014000'',C''PEN     ''';
         UT='         MFLD  PEN,LTH=001';  LZ=LZ+1; END;
    ELSE IF SO2='PFK' THEN DO;         /* PROGRAM FUNCTION KEY        */
         IF BIT5 THEN
         UA='         DC    H''016'',X''948000014000'',C''PFK     ''';
         UT='         MFLD  PFK,LTH=001';  LZ=LZ+1; END;
    ELSE IF SO2='SCA' THEN DO;         /* SYSTEM CONTROL AREA         */
         IF BIT5 THEN
         UA='         DC    H''016'',X''148800024000'',C''        ''';
         UT='         MFLD  (,SCA),LTH=002';  LZ=LZ+2; END;
    ELSE GOTO P263;                    /* FEHLER                      */
         LA=P263; IST2=0; GOTO OUVN1;
 P263:   END;                          /* MOD/MID-LOOP                */

 /*********************************************************************/
 /*                                                                   */
 /* 270  FORTSETZUNG MOD/MID-GRUPPE NACH ERSTEN 50 RECORDS            */
 /*                                                                   */
 /*********************************************************************/

         IF BIT4 THEN DO;              /* MIT FORTSETZUNG             */
         BIT4='0'B; GOTO P080;         /* FORTS. AUS, ZUM LESEN       */
         END;                          /* MIT FORTSETZUNG             */
         IST2=0;   /* LOESCHEN */
         LA=EJECT; GOTO OUTL;           /* LAENGENZAEHLER AUSGEBEN    */
 EJECT:  UT = '         MSGEND';

 /*********************************************************************/
 /*                                                                   */
 /* 280  GRUPPEN - ABSCHLUSS                                          */
 /*                                                                   */
 /*********************************************************************/

 P280:   LA=P281; GOTO OUT;
 P281:   IF BIT6 THEN GOTO ENDE;       /* SYSIN-ENDE                  */
         UT='         EJECT'; /* GRUPPEN-ENDE */
         LA = EJECT3; GOTO OUT;
 EJECT3: WRITE FILE(SYSPRINT) FROM(SKIP);  ZZAE=0;
         GOTO ERST;          /* 1. SYSIN-RECORD NEUE GRUPPE           */

 /*********************************************************************/
 /*                                                                   */
 /* 290  UNTERROUTINE MFLD-ZUWEISUNGEN                                */
 /*                                                                   */
 /*********************************************************************/

 MFLD:   PT3=ADDR(TAB3(IB2));          /* AUF TABELLENFELD            */
         UA='         DC    H''016'',X''94         0'',C''FLD     ''';
         IF ATB0 THEN PACK5=STD(ISTA); /* NUMERISCH                   */
    ELSE PACK5=STD(ISTA+4);            /* ALPHA                       */
         IF JU2^=' ' THEN ATP=JU2;     /* JUST FORCED                 */
         IF AF2^=' ' THEN AFP=AF2;     /* ATTR/FILL FORCED            */

         IF ATP='R' THEN DO;           /* JUST=R                      */
         ATP='
         END;                          /* JUST=R                      */
    ELSE DO;                           /* JUST=DEFAULT                */
         ATP='ç'; JUSTER='';           /* X'80'                       */
         END;                          /* JUST=DEFAULT                */

         IF FIP^=' ' THEN DO;          /* ATTR/FILL BESETZT           */
         ATFLER=',FILL='××AFP;         /* WENIGSTENS 4STELLIG         */
         IF AFP='YES ' THEN DO;        /* ATTR=YES                    */
         ATP1='1'B; ATFLER=',ATTR=YES'; FIP=' '; FL0=FL3+2; PL0=FL0;
         END;                          /* ATTR=YES                    */
    ELSE DO;                           /* FILL=                       */
         IF AFP='NULL' THEN DO;        /* FILL=NULL                   */
         ATP3='1'B; FIP=' ';
         END;                          /* FILL=NULL                   */
    ELSE IF SUBSTR(AFP,1,1)='X' THEN   /* FILL HEXA                   */
         IF SUBSTR(FIP,2,1)='''' THEN DO; /* HEXA KURZ                */
         SUBSTR(FIP,2,1)=SUBSTR(FIP,1,1); /* VERSCHIEBEN              */
         SUBSTR(FIP,1,1)='0';          /* NULL VORANSTELLEN           */
         END;                          /* HEXA KURZ                   */
    ELSE ATFLER=ATFLER××'''';          /* SONST HOCHKOMMA ANSETZEN    */
         GOTO P292;                    /* AFP UEBERSCHREIBBAR         */
         END;                          /* FILL=                       */
         END;                          /* ATTR/FILL BESETZT           */
    ELSE DO;                           /* ATTR/FILL UNBESETZT         */
         ATFLER='';
 P292:   FL0=FL3; PL0=PL3;             /* NORMAL-LAENGE               */
         END;                          /* ATTR/FILL UNBESETZT         */
         IF ING=4 & PE3^<'/' & ^ATB5 THEN DO; /* MIT,IDET/DET,^NOSTRIP*/
         FL0=FL3-1; PL0=FL0;           /* STRIPPEN                    */
         END;                          /* MIT, IDET/DET, ^NOSTRIP     */
         UT='         MFLD  FLD'××PN3××',LTH='××PL0××JUSTER××ATFLER;
         LZ=LZ+FL0;                    /* LAENGENZAEHLER              */
         IST2=ST3;
 OUVMOD: IF BIT5 THEN DO;              /* MAKRO-AUFLOESUNG            */
         P3U=PN3;                      /* FELD-NR                     */
 OUVMID: UNPK9=PACKP3; NUU='0';        /* ENTPACKEN, RESTORE          */
         CHAR8=TRANSLATE(CHAR8,TR);    /* HEXA-SCHREIBWEISE           */
         IF SUBSTR(FIP,2,1)^<'A' THEN  /* HEXA                        */
         FIU=FIP;                      /* FILL HEXA                   */
         END;                          /* MAKRO-AUFLOESUNG            */

 /*********************************************************************/
 /*                                                                   */
 /* 300  UNTERROUTINE AUSGABE                                         */
 /*                                                                   */
 /*********************************************************************/

 OUVN1:  IST1=ST(N2);
 OUV:    WRITE FILE(SYSPRINT) FROM (GEN);
         ZZAE=ZZAE+1; IF ZZAE>60 THEN DO;
         WRITE FILE(SYSPRINT) FROM(SKIP); ZZAE=0; END;
 OUTXA:  WRITE FILE(SYSOUT) FROM(U);
         ZLUT=ZLUT+1; /* ZEILEN OUTPUT */
         M=1;
 OUT3:   IF SUBSTR(U,M,1)^=' ' THEN ZCUT=ZCUT+1; /* ZEICHEN OUTPUT    */
         M=M+1; IF M^>80 THEN GOTO OUT3;
         GOTO LA;  /* RETURN */

 OUTL:   PLZ=LZ; LZ=0;       /* PICTURE LAENGENZAEHLER                */
         UT='*        SEGMENT LENGTH = '××PLZ;
         IST2=0; GOTO OUT;
 OUT1:   IST1=ST(01); GOTO OUT;
 OUT:    UA=UT; GOTO OUV;

 /*********************************************************************/
 /*                                                                   */
 /* 310  JOB - STATISTIK                                              */
 /*                                                                   */
 /*********************************************************************/

 ENDE:   UT='         END'; LA=ENDE2; GOTO OUT;
 ENDE2:  WRITE FILE(SYSPRINT) FROM(SKIP);
         IST=0; SUBSTR(IT,1,30)=''; SUBSTR(IT,31,50)='JOB - STATISTIK';
         WRITE FILE(SYSPRINT) FROM(INPUT);
         PZL=ZLIN; PZC=ZCIN; /* UMWANDELN */
         WRITE FILE(SYSPRINT) FROM(STSATZ);
         PZL=ZLUT; PZC=ZCUT; /* UMWANDELN */
         SUBSTR(TXT1,20,3)='OUT'; SUBSTR(TXT2,21,3)='OUT';
         WRITE FILE(SYSPRINT) FROM(STSATZ);
 END:    END;

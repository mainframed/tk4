 WAIT: PROC OPTIONS(MAIN);
   DCL BEWERT FILE RECORD,P PTR,F1 FILE PRINT;
   DCL 1 BSATZ BASED(P),
        2 F1 CHAR(1),
        2 RECORD BIT(8),
        2 TIMEX BIN FIXED(31) UNAL,
        2 DATEX FIXED(7),
        2 F2 CHAR(4),
        2 WAIT BIN FIXED(31) UNAL,
        2 EXPIR BIN FIXED(31) UNAL,
        2 PI BIN FIXED(31) UNAL,
        2 PO BIN FIXED(31) UNAL,
        2 REST CHAR(4066);
   DCL 1 ASATZ BASED(P),
        2 F1 CHAR(1),
        2 R BIT(8),
        2 RESTA  CHAR(4094);
   DCL 1 CSATZ BASED(P),
        2 F1 CHAR(1),
        2 REC4 BIT(8),
        2 F2 CHAR(100),
        2 LENGTH BIN FIXED(15) UNAL,
        2 RESTC CHAR(3992);
   DCL 1 XDATE,
        2 F1 CHAR(2),
        2 JAHR PIC'99',
        2 LTAG PIC'999';
   DCL REDATE PIC'(7)9' DEF XDATE;
   DCL (MON(12),VGLTAG,VGLJR,VGLMON) BIN FIXED;
   DCL (WAITS,WAITTAGSUM,WAITMONSUM,PISUM,PIMONSUM,PIS,POS,ZCPU,
   POSUM,POMONSUM) FIXED(15,3);
   DCL (SO,SOPRO,WAITPRO,CPUPRO) FLOAT(15);
   DCL (T1,T2,ELAPS,CPUTAGSUM,CPUMONSUM,ELTAGSUM,ELMONSUM)
       FIXED(15,3);
   DCL (Z1,Z2,Z12) FIXED(13,3);
   Z1,Z2,Z12=0;
   DCL (CPU,START,STOP,START1,STOP1) BIN FIXED(31);
   DCL (STD,MIN,SEC,REST,STD1,MIN1,SEC1) FIXED(10);
   PISUM,POSUM,WAITTAGSUM,WAITMONSUM,PIMONSUM,POMONSUM,ISCH=0;
   T1,T2,ELAPS,ELTAGSUM,ELMONSUM,CPUTAGSUM,CPUMONSUM,ISCHA=0;
   MON(1),MON(3),MON(5),MON(7),MON(8),MON(10),MON(12)=31;
   MON(4),MON(6),MON(9),MON(11)=30;
   OPEN FILE(SYSPRINT) PAGESIZE(69);
   OPEN FILE(F1) PAGESIZE(68);
   ON ENDPAGE(F1) CALL UEBER1;
   GET LIST(START1,STOP1);
   CALL UEBER1;
   START=START1*360000;STOP=STOP1*360000;
   ON ENDPAGE(SYSPRINT) CALL UEBER;
   OPEN FILE(BEWERT) INPUT;
   ON ENDFILE(BEWERT) BEGIN;
   ISCH=1; GO TO RECHNEN; END;
 L1: READ FILE(BEWERT) SET(P);
   IF R^=0 & R^=1 & R^=4 & R^=12 & R^=34 THEN GO TO L1;
   IF TIMEX < START × TIMEX > STOP THEN GO TO L1;
   IF R=0 THEN DO;
   T1=TIMEX;
   T1=T1/100;
   CALL IPL; ISCHA=1;
   GO TO L1;
   END;
   IF R=4 × R=34 THEN DO;
   CPU=UNSPEC(SUBSTR(RESTC,LENGTH,3));
   CPU=CPU/100;
   GO TO L1;
   END;
   REDATE=DATEX;
   IF ISCHA=0 THEN DO;
   T1=TIMEX; T1=T1/100;
   END;
   Z1,Z2=EXPIR/100;
   IF MOD(JAHR,4) =0 THEN MON(2)=29;
   ELSE MON(2)=28;
   CALL KALTAG;
   VGLTAG=KTAG;
   VGLMON=IMONAT;
   VGLJR=JAHR;
   CALL UEBER;
   GO TO BER1;
 L2:
   READ FILE(BEWERT) SET(P);
   IF R^=0 & R^=1 & R^=4 & R^=12 & R^=34 THEN GO TO L2;
   IF TIMEX < START × TIMEX > STOP THEN GO TO L2;
   IF R=4 × R=34 THEN DO;
   CPU=UNSPEC(SUBSTR(RESTC,LENGTH,3));
   ZCPU=CPU; ZCPU=ZCPU/100 + 0.005;
   CPUTAGSUM=CPUTAGSUM+ZCPU;
   GO TO L2;
   END;
   REDATE=DATEX;
   CALL KALTAG;
   IF VGLTAG ^= KTAG THEN GO TO RECHNEN;
   IF R=0 THEN DO;
   IF T1 > (T2+61) THEN ELAPS=0;
   ELSE ELAPS=ABS(T2-T1);
   ELTAGSUM=ELTAGSUM+ELAPS;
   T1=TIMEX/100;
   Z1=-1;
   CALL IPL;;
   GO TO L2;
   END;
 BER1:
   IF Z1=-1 THEN Z1,Z2,T1,T2=EXPIR/100;
   ELSE Z2,T2=EXPIR/100;
   IF Z1>Z2 THEN Z12=Z2+86400-Z1;
   ELSE Z12=Z2-Z1;
   WAITS=WAIT;WAITS=WAITS/100+0.005;
   IF WAITS > Z12 THEN WAITS=Z12;
   WAITTAGSUM=WAITTAGSUM+WAITS;
   PISUM=PISUM+PI;
  POSUM=POSUM+PO;
   PIS=PI; POS=PO;
  STD=TIMEX/360000;
  REST=MOD(TIMEX,360000);
  MIN=REST/6000;
  SEC=MOD(REST,6000)/100;
   STD1=EXPIR/360000;
   REST=MOD(EXPIR,360000);
   MIN1=REST/6000;
   SEC1=MOD(REST,6000)/100;
   IF Z12=0 THEN PIS,POS=0;
  PUT SKIP EDIT
  (RECORD,STD,'.',MIN,'.',SEC,STD1,'.',MIN1,'.',SEC1,VGLTAG,'.',VGLMON,
   '.',VGLJR,
  WAITS,WAITS/60,WAITS/3600,PIS+POS)
  (P'99',COL(6),(2)(P'99',A),P'99',COL(16),(2)(P'99',A),P'99',COL(26),
   (2)(P'99',A),P'99',
  COL(35),P'ZZZ.ZZ9',COL(43),P'ZZZ9V,99',P'ZZ9V,99',
  COL(59),P'ZZZ.ZZZ.ZZ9');
   IF Z12^=0 THEN DO;
   ZW=PIS+POS;
   ZW=ZW/Z12;
   PUT EDIT (ZW)(COL(71),P'ZZ9V,99');
   END;
   Z12=Z12/60;
   PUT EDIT(Z12)(COL(82),P'ZZZ9V,99');
   Z1=Z2;
  GO TO L2;
 RECHNEN:
   IF (T2+61)< T1 THEN ELAPS=T2+86400-T1;
   ELSE ELAPS=T2-T1;
   ELTAGSUM=ELTAGSUM+ELAPS;
   T1=START; Z1=Z2;
   PUT SKIP EDIT((88)'-')(A);
   PUT SKIP EDIT
   ('SUMMEN/TAG:',WAITTAGSUM,WAITTAGSUM/60,
   WAITTAGSUM/3600,
   PISUM+POSUM,(PISUM+POSUM)/ELTAGSUM + 0.5)
   (COL(10),A,COL(35),P'ZZZ.ZZ9',COL(43),P'ZZZ9V,99',
   P'ZZ9V,99',COL(59),P'ZZZ.ZZZ.ZZ9',COL(71),P'ZZ9V');
   PUT SKIP EDIT
   ('ELAPSED TIME =',ELTAGSUM/3600,' (STD)','CPU TIME (STD) =',
    CPUTAGSUM/3600,' (STD)','WAIT TIME=',WAITTAGSUM/3600,' (STD)')
   ((3)(X(5),A,P'BZZ9V,99',A));
   SO=(ELTAGSUM-WAITTAGSUM-CPUTAGSUM)/3600;
   PUT SKIP EDIT('SYSTEM OVERHEAD =',
   SO,' (STD)')
   (X(5),A,P'BZZ9V,99',A);
   IF ELTAGSUM ^= 0 THEN DO;
   PUT SKIP EDIT(' IN % ZUR ELAPSE-TIME')(A);
   CPUPRO=CPUTAGSUM;
   CPUPRO=CPUPRO/ELTAGSUM*100;
   WAITPRO=WAITTAGSUM;
   WAITPRO=WAITPRO/ELTAGSUM*100;
   SOPRO=SO/ELTAGSUM*360000;;
   PUT SKIP EDIT
   ('CPU =',CPUPRO,' %',
    'WAIT =',WAITPRO,' %',
    'S.O.H. =',SOPRO,' %')
   ((3)(X(5),A,P'ZZ9V,99',A));
   CALL LIST2;
   END;
   WAITMONSUM=WAITMONSUM+WAITTAGSUM;
   PIMONSUM=PIMONSUM+PISUM;
   POMONSUM=POMONSUM+POSUM;
   ELMONSUM=ELMONSUM+ELTAGSUM;
   CPUMONSUM=CPUMONSUM+CPUTAGSUM;
   ELTAGSUM,CPUTAGSUM=0;
   WAITTAGSUM,PISUM,POSUM=0;
   VGLTAG=KTAG;
   VGLJR=JAHR;
   VGLMON=IMONAT;
   IF ISCH=0 THEN DO;
   CALL UEBER;
   Z1=-1;
   IF R=0 THEN DO;
   T1=TIMEX/100; CALL IPL;  GO TO L2; END;
   GO TO BER1;
   END;
 ENDE:
   PUT PAGE;
   PUT SKIP(10) EDIT
   ('MONATSSUMMEN FUER HAUPTBELASTUNGSZEIT VON :',
    START/360000,' UHR  BIS ',STOP/360000,' UHR  BIS ZUM ',
   VGLTAG,'.',VGLMON,'.',VGLJR)
   (A,P'Z99V,99',A,P'Z99V,99',(3)(A,P'99'));
   PUT SKIP(2) EDIT
   ('PAGE NUMBER OF ENTIRE SYSTEM =',PIMONSUM+POMONSUM)
   (A,P'ZZZ.ZZZ.ZZ9');
   PUT SKIP EDIT
   ('ELAPSED TIME =',ELMONSUM/3600,' (STD)','CPU TIME =',
   CPUMONSUM/3600,' (STD)','WAIT TIME =',WAITMONSUM/3600,' (STD)')
   ((3)(X(5),A,P'ZZ.ZZ9V,99',A));
   SO=(ELMONSUM-WAITMONSUM-CPUMONSUM)/3600;
   PUT SKIP EDIT
   ('SYSTEM OVERHEAD =',SO,' (STD)')
   (X(5),A,P'ZZ.ZZ9V,99',A);
   IF ELMONSUM^=0 THEN DO;
   SOPRO=SO/ELMONSUM*360000;
   CPUPRO=CPUMONSUM;
   WAITPRO=WAITMONSUM;
   CPUPRO=CPUPRO/ELMONSUM*100;
   WAITPRO=WAITPRO/ELMONSUM*100;
   PUT SKIP EDIT(' IN % ZUR ELAPSE-TIME')(A);
   PUT SKIP EDIT
   ('CPU =',CPUPRO,' %',
    'WAIT =',WAITPRO,' %',
    'S.O.H. =',SOPRO,' %')
   ((3)(X(5),A,P'ZZ9V,99',A));
   END;
   CLOSE FILE(BEWERT);
 KALTAG: PROC;
   I2=0;
   DO I=1 TO 12;
   I1=I2;
   I2=I2+MON(I);
   IF LTAG <= I2 THEN DO;
   IMONAT=I;
   GO TO DRAU;
   END;
   END;
 DRAU: KTAG=LTAG-I1;
   END KALTAG;
 UEBER: PROC;
   PUT PAGE EDIT
   ('TYP','TIME SMF','TIME EXP','DATE','SYSTEM-WAIT','PAGE-NUMBER',
   'EXPIRATION')
   (SKIP(2),A,COL(6),A,COL(16),A,COL(28),A,COL(41),A,COL(60),A,
   COL(80),A);
   PUT SKIP EDIT
   ('HH.MM.SS','HH.HH.SS','TT.MM.JJ','SEC','MIN','STD',
   'TOTAL SYSTEM   /SEC','MIN')
   (COL(6),A,COL(16),A,COL(26),A,COL(38),A,COL(45),A,COL(52),A,
   COL(57),A,COL(83),A);
   PUT SKIP;
   END UEBER;
 IPL: PROC;
  STD=TIMEX/360000;
  REST=MOD(TIMEX,360000);
  MIN=REST/6000;
   SEC=MOD(REST,6000)/100;
   PUT SKIP EDIT
   (RECORD,STD,'.',MIN,'.',SEC)(P'99',COL(6),(2)(P'99',A),P'99');
   END IPL;
 UEBER1: PROC;
   PUT FILE(F1) PAGE EDIT
   ('CPU-,ELAPSE-,WAIT-TIME,SYSTEMOVERHEAD UND PAGES VON ',
    START1,' UHR BIS ',STOP1,' UHR',(77)'=')
   (SKIP,(2)(A,P'ZZ9V,99'),A,SKIP,A);
   PUT FILE(F1) SKIP;
   END UEBER1;
 LIST2: PROC;
   PUT SKIP(2) FILE(F1) EDIT
   ('DATUM: ',VGLTAG,'.',VGLMON,'.',VGLJR,
   'PAGES OF ENTIRE SYSTEM =',PISUM+POSUM,'  /SEC =',
   (PISUM+POSUM)/ELTAGSUM + 0.5)
   ((3)(A,P'99'),X(3),A,P'ZZZZ.ZZZ.ZZ9',A,P'ZZ9V');
   PUT FILE(F1) SKIP EDIT
   ('ELAPSE =',ELTAGSUM/3600,' (STD), WAIT =',WAITTAGSUM/3600,
    ' (STD), CPU =',CPUTAGSUM/3600,' (STD), OVERHEAD =',
    SO,' (STD)')
   ((4)(A,P'ZZZ9V,99'),A);
   PUT FILE(F1) SKIP EDIT
   ('IN % ZUR ELAPSE-TIME :',
    'CPU =',CPUPRO,' %   WAIT =',WAITPRO,' %   S.O.H. =',SOPRO,' %')
   (A,(3)(A,P'ZZ9V,99'),A);
   END LIST2;
   END WAIT;

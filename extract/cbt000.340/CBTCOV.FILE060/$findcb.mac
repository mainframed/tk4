$FINDCB MACRO OBTAINED FROM JIM WALKER - TRIANGLE UNIVERSITIES COMPUTER

FIND CONTROL BLOCK ($FINDCB) MACRO.

THIS MACRO CONVENIENTLY LOCATES THE ADDRESS OF MANY COMMONLY USED
CONTROL BLOCKS FOR THE JOB IN EXECUTION. IT USES ONLY THE REGISTERS
SPECIFIED BY THE CALLER.  NO UNNECESSARY LOADS ARE USED. SOME OF
THE CAPABILITIES ARE TRIVIAL (CVT, TCB, ASCB), BUT OTHERS REQUIRE
SEVERAL CHAINS (JES2 JCT, OS JCT).

THE CAPABILITY FOR A USER JOB TO FIND ITS OWN INTERNAL CONTROL
BLOCKS INCLUDING JES2 CONTROL BLOCKS IS QUITE USEFUL. SOME OF
THE MOST USEFUL EXAMPLES ARE:
         SMF EXITS
         USER TESTING UTILITIES
         SPECIAL UTILITIES CALLABLE BY USERS TO DETERMINE ATTRIBUTES OF
            JOB - SUCH AS ACCOUNT, PROGRAMMER, REMOTE NUMBER, AND OTHER
            USER DATA ADDED TO JES2 CONTROL BLOCKS.

THE CONTROL BLOCKS THAT CAN BE FOUND ARE:

         ACOEF  = ACCOUNTING COEFFICIENTS POINTED TO BY TUCVSCVT
         ACTIM  = I/O TIME, JOB CPU TIME, AND PROGRAMMER NAME TABLE
         ASCB   = ASCB, POINTED TO FROM X'224'
         ASID   = ASID AS FOUND IN THE ASCB
         ASVT   = ASVT POINTED TO BY THE CVT
         ASXB   = ASXB POINTED TO BY ASCB
         CVT    = CVT, ADDRESS OBTAINED FROM X'10'
         FIX    = ADDRESS OF PAGE SERVICES (FROM CVT)
         JCT    = JES2 JCT CHAINED FROM THE ACTIVE JSCB, SSIB, SJB.
                  EITHER TCB OR TCBINT MAY BE USED TO LOCATE THE JSCB.
         JSCB   = ACTIVE JSCB FROM EITHER THE TCB OR TCBINIT.
         LCT    = INITIATOR LCT, OBTAINED EITHER FROM THE TCBINT R4
                  OR THE JSCB QMANAGER POINTER (MINUS AN OFFSET)
         OSACT  = OS ACT, POINTED TO BY THE OS JCT
         OSJCT  = OS JCT, POINTED TO BY THE LCT
         OSSCT  = OS SCT, POINTED TO BY THE LCT
         RB     = RB, POINTED TO BY THE TCB
         SJB    = SJB, POINTED TO BY THE SSIB (SEE JSCB FOR CHAIN)
         SSIB   = SSIB, POINTED TO BY THE JSCB (SEE JSCB FOR CHAIN)
         TCB    = THE TCB POINTED TO BY LOCATION X'21C'
         TCBINT = THE TCB CHAINED FROM THE ASCB, ASXB. WHEN THIS TCB
                  IS REQUESTED, THEN THE JSCB AND LCT CHAINS (IF
                  REQUESTED) ARE STARTED FROM THIS REFERENCE.
                  IF THIS ENTRY IS NOT INCLUDED, THEN THE JSCB,
                  LCT CHAINS WILL START FROM THE TCB FROM X'21C'.
         TCBRCT = THE TCB FOR THE REGION CONTROL, POINTED TO BY ASXB
         TCBSTC = THE TCB FOR THE STC, CHAINED FROM THE RCT TCB.
         TCT    = SMF TIMING CONTROL TABLE, POINTED TO BY EITHER
                  THE INITIATOR TCB OR THE STEP TCB.
         TCTI   = THE IO PORTION OF THE TCT.
         TIOT   = TIOT FOR THE TCB, EITHER STEP OR TCB INIT.
         TQE    = THE TQE, POINTED TO FROM THE TCB
         TUCCVT = TUC VS CVT, POINTED TO BY THE CVT

ASSUME THAT A UTILITY OR SMF EXIT NEEDS TO FIND THE ADDRESS OF ITS OWN
JES2 JCT, TIOT, AND TQE:

         $FINDCB JCT=R10,TIOT=TIOREG,TQE=R3

PUTS THE JCT ADR IN SYMBOLIC REGISTER R10, THE TIOT ADR IN TIOREG, AND
THE TQE ADR IN R3. REGISTERS R10, TIOREG AND R3 ARE THE ONLY REGISTERS
USED BY THE MACRO EXPANSION.


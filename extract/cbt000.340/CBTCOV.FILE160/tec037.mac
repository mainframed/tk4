C     ******************************************************************
C     *                                                                *
C     *  FOR ANY INFORMATION ABOUT THIS STAR TREK PGM. PLEASE CONTACT  *
C     *         RONALD LACHMAN                                         *
C     *         UNIVERSITY OF ILLINOIS                                 *
C     *         COMPUTER CENTER                                        *
C     *         P.0. BOX 4348                                          *
C     *         CHICAGO, ILLINOIS   60680                              *
C     *                                                                *
C     ******************************************************************
C     *                                                                *
C     *                           STAR TREK                            *
C     *                                                                *
C     *    REWRITTEN FOR FORTRAN G1 COMPILER AND TSO BY RON LACHMAN    *
C     *  ASSEMBLER CHARACTER MANIPULATION ROUTINES BY LOU WARSHAWSKY   *
C     *                                                                *
C     *  ADAPTED FROM FORTRAN-10 VERSION BY P. DEWOLF AND R. GABRIEL   *
C     *     AT THE COORDINATED SCIENCE LAB IN U. OF I. IN URBANA       *
C     *                                                                *
C     *        GENERAL IDEA STOLEN FROM PURDUE BY C. GESCHKE           *
C     *                                                                *
C     ******************************************************************
      DOUBLE PRECISION SHIP(3)
      LOGICAL COMPAR
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      DO 111 J=1,10
      DO 111 I=1,10,9
  111 GALAXY(I,J)=0
      DO 112 J=1,10,9
      DO 112 I=2,9
  112 GALAXY(I,J)=0
      CALL MESAGE
1     CALL SETUP
        LOG=0
5     IF(ALLDON.NE.0) GO TO 999
        CALL CHEW
      CALL PROMPT(9,'COMMAND: ')
        CALL SCAN(ITEM,KEY)
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 1234
9      IF(.NOT.COMPAR(ITEM,2,'SR'))GO TO 11
      CALL SRSCAN
        IF (RAN(0).GT.0.025*SKILL)GOTO 5
        CALL KLACT
        CALL ATTACK
      GO TO 5
   11 IF(.NOT.COMPAR(ITEM,2,'ST')) GO TO 10
      CALL STATUS
      GO TO 5
10    IF(.NOT.COMPAR(ITEM,2,'LR'))GO TO 20
      CALL LRSCAN
        IF (RAN(0).GT.0.025*SKILL)GOTO 5
        CALL KLACT
        CALL ATTACK
      GO TO 5
20    IF(.NOT.COMPAR(ITEM,2,'NG')) GO TO 25
        ALLDON=1
        CALL SCORE(0)
        PRINT 3000
      CALLPROMPT(49,'DO YOU WISH TO SEE THE FINAL STATE OF THE GALAXY?')
        CALL CHEW
        IF (JA(DUMMY).NE.0)CALL CHART
      GO TO 1
25    CONTINUE
      IF(.NOT.COMPAR(ITEM,2,'MO'))GO TO 30
      LASTQX=QUADX
      LASTQY=QUADY
      CALL WARP
      IF(IDIDIT.EQ.0 .OR. ALLDON.NE.0) GO TO 5
      IF(QUADX.NE.LASTQX .OR. QUADY.NE.LASTQY) CALL NEWQUA
      IF(ALLDON.NE.0) GO TO 5
      CALL EVENTS
      IF(ALLDON.NE.0) GO TO 5
      CALL KLACT
      CALL ATTACK
      GO TO 5
30    IF(.NOT.COMPAR(ITEM,2,'DO'))GO TO 40
      CALL DOCK
      GO TO 5
40    IF(.NOT.COMPAR(ITEM,2,'WA')) GO TO 50
      CALL SETWRP
      GO TO 5
50    IF(.NOT.COMPAR(ITEM,2,'PT'))GO TO 60
      LASTQX=QUADX
      LASTQY=QUADY
      CALL PHOTON
      IF(IDIDIT.EQ.0 .OR. ALLDON.NE.0) GO TO 5
      IF(QUADX.EQ.LASTQX .AND. QUADY.EQ.LASTQY) GO TO 55
      CALL NEWQUA
      IF(ALLDON.NE.0) GO TO 5
      CALL EVENTS
      IF(ALLDON.NE.0) GO TO 5
55      CONTINUE
        CALL KLACT
        CALL ATTACK
        GOTO 5
60      IF (.NOT.COMPAR(ITEM,2,'SU'))GOTO 65
        CALL SHLDS('U')
        GOTO 66
65      IF (.NOT.COMPAR(ITEM,2,'SD'))GOTO 70
        CALL SHLDS('D')
66      IF(IDIDIT .EQ. 0 .OR. ALLDON .NE. 0) GO TO 5
      CALL KLACT
      CALL ATTACK
      GO TO 5
70    IF(.NOT.COMPAR(ITEM,2,'DA'))GO TO 80
      CALL DREPRT
      GO TO 5
80    IF(.NOT.COMPAR(ITEM,2,'RE')) GO TO 90
      CALL WAIT
      GO TO 5
90    IF(.NOT.COMPAR(ITEM,2,'CH')) GO TO 100
      CALL CHART
      GO TO 5
100   IF(.NOT.COMPAR(ITEM,2,'PH')) GO TO 110
      CALL PHASER
      IF(IDIDIT .EQ. 0.OR.ALLDON.NE.0)GO TO 5
      CALL KLACT
      CALL ATTACK
      GO TO 5
110   IF(.NOT.COMPAR(ITEM,2,'LO')) GO TO 120
      CALL LOGIT(LOG)
      GO TO 5
120   IF(.NOT.COMPAR(ITEM,2,'IM')) GO TO 130
      LASTQX=QUADX
      LASTQY=QUADY
      CALL IMPULS
      IF(IDIDIT .EQ. 0 .OR. ALLDON .NE. 0) GO TO 5
      IF(QUADX.NE.LASTQX .OR. QUADY.NE.LASTQY) CALL NEWQUA
      IF(ALLDON.NE.0) GO TO 5
      CALL EVENTS
      IF(ALLDON.NE.0) GO TO 5
      CALL KLACT
      CALL ATTACK
      GO TO 5
130   IF(.NOT.COMPAR(ITEM,2,'BC'))GO TO 140
      CALL BATLEC
      GO TO 5
140   IF(.NOT.COMPAR(ITEM,2,'AB')) GO TO 150
      CALL ABANDO
      GO TO 5
150     IF (.NOT.COMPAR(ITEM,2,'RA'))GOTO 160
        CALL SCORE(0)
        GOTO 5
160     IF (.NOT.COMPAR(ITEM,2,'DR'))GOTO 170
        CALL DETHRA
        IF (ALLDON.NE.0)GOTO 999
        GOTO 5
170     IF (.NOT.COMPAR(ITEM,2,'TP'))GOTO 180
        LASTQX=QUADX
        LASTQY=QUADY
        CALL TELEPT(LASTQX,LASTQY)
        IF (ALLDON.NE.0)GOTO 999
        GOTO 5
180     IF (.NOT.COMPAR(ITEM,2,'DE'))GOTO 200
        CALL SCORE(0)
        CALL DESTRU
        IF (ALLDON.EQ.0)GOTO 5
        GOTO 999
200     IF (.NOT.COMPAR(ITEM,2,'SG'))GOTO 201
        CALL SAVGAM
        GOTO 5
201   IF (.NOT.COMPAR(ITEM,2,'RG'))GOTO 202
      CALL RETGAM
      GOTO 5
202   IF (.NOT.COMPAR(ITEM,2,'TS')) GO TO 210
      CALL TSO(50,'TPUT WHEN YOU LOGOFF, YOU WILL RETURN TO STARTREK.')
      CALL SYNOP
      GO TO 5
210     IF (.NOT.COMPAR(ITEM,2,'QU'))GOTO 220
        ALLDON=1
        CALL SCORE(0)
        PRINT 3000
      CALLPROMPT(49,'DO YOU WISH TO SEE THE FINAL STATE OF THE GALAXY?')
        CALL CHEW
        IF (JA(DUMMY).GT.0)CALL CHART
        STOP
220      IF(COMPAR(ITEM,2,'CO').OR.COMPAR(ITEM,2,'HE'))GO TO 99
 1234 PRINT 5000
 5000 FORMAT(' WHAT WAS THAT AGAIN ?')
        CALL CHEW
          GO TO 5
99       PRINT 1990
1990    FORMAT (' COMMANDS:')
        PRINT 2000
2000    FORMAT ('   IM  IMPULSE ENGINES'/'   SR  SHORT RANGE SCAN'/
     1'   LR  LONG RANGE SCAN'/'   PT  PHOTON TORPEDOES'/
     2'   MO  MOVE (WARP ENG.)'/'   WA  SET WARP FACTOR'/
     3'   DO  DOCK'/'   SU  SHIELDS UP'/'   TS  POP BACK INTO TSO'/
     4'   SD  SHIELDS DOWN'/'   DA  DAMAGE REPORT'/
     5'   NG  NEW GAME'/'   RE  REST, REPAIR'/'   ST  DISPLAY STATUS'/
     6'   CH  SHOW STAR CHART'/'   PH  FIRE PHASERS'/
     7'   LO  MAKE LOG ENTRY'/'   BC  BATTLE COMPUTER'/
     8'   AB  ABANDON SHIP'/'   TP  TELEPORTER'/
     9'   DR  DEATH RAY'/'   SG  SAVE GAME'/'   RG  RETRIEVE GAME'/
     1'   QU  QUIT'/'   DE  SELF DESTRUCT'/'   CO  COMMANDS'/)
        GOTO 5
999     IF (LOG.NE.0)CALL LOGIT(-1)
        PRINT 3000
3000    FORMAT (' ***************************************************',
     1'***')
      CALLPROMPT(49,'DO YOU WISH TO SEE THE FINAL STATE OF THE GALAXY?')
        CALL CHEW
        IF (JA(DUMMY).GT.0)CALL CHART
      CALL PROMPT(28,'DO YOU WANT TO PLAY AGAIN ? ')
        CALL CHEW
        IF (JA(DUMMY).GT.0)GOTO 1
        STOP
        END
       SUBROUTINE ABANDO
      DOUBLE PRECISION SHIP(3)
      LOGICAL COMPAR
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        IF (COMPAR(SHIP(1),8,'ENTER   '))GOTO 10
        PRINT 1000
1000    FORMAT (' ***YE FAERIE QUEENE HAS NO LIFEBOATS!')
      IDIDIT=0
      RETURN
C--------PRINT ABANDON SHIP MESSAGES
10      PRINT 2000
2000    FORMAT (' ***ABANDON SHIP!  ABANDON SHIP!'/' ***ALL HANDS',
     1' ABANDON SHIP!')
      IDIDIT=1
        PRINT 3000
3000    FORMAT (' CAPTAIN AND CREW ESCAPE IN SHUTTLE CRAFT'/' REMAINDER
     1OF SHIP''S COMPLEMENT BEAM DOWN'/' TO NEAREST HABITABLE',
     1' PLANET')
C--------IF THERE ARE NO STARBASES LEFT, GAME IS OVER
      IF(REMBAS .NE. 0) GO TO 20
      CALL FINISH(9)
      RETURN
C--------IF THERE IS AT LEAST ONE BASE LEFT, YOU GET THE FAERIE QUEENE
20      PRINT 4000
4000    FORMAT ('+YOU ARE CAPTURED BY KLINGONS AND RELEASED TO'/' THE',
     1' FEDERATION IN A PRISONER OF WAR EXCHANGE.'/' STARFLEET PUTS',
     1' YOU IN COMMAND OF ANOTHER SHIP'/' , THE FAERIE QUEENE, WHICH',
     1' IS ANTIQUIDATED BUT,'/' STILL USEABLE. BE MORE CAREFUL THIS',
     1' TIME.')
C--------SELECT BASE AT WHICH TO BEGIN AGAIN
      NB=1
      IF(REMBAS .EQ. 1) GO TO 30
      NB=RAN(0)*REMBAS+1
C--------SET UP QUADRANT AND POSITION F. Q. ADJACENT TO BASE
 30   QUADX=BASEQX(NB)
      QUADY=BASEQY(NB)
40      SECTX=5
        SECTY=5
      CALL NEWQUA
      CALL ASSIGN(QUAD(SECTX,SECTY),4,'.   ')
      DO 50 L=1,3
      SECTX=3.0*RAN(0)-2.0+BASEX
      IF(SECTX .LT. 1 .OR. SECTX .GT. 10) GO TO 50
      SECTY=3.0*RAN(0)-2.0+BASEY
      IF(SECTY .LT. 1 .OR. SECTY .GT. 10) GO TO 50
      IF(COMPAR(QUAD(SECTX,SECTY),4,'.   ')) GO TO 60
 50   CONTINUE
      GO TO 40
 60   CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
      CALL ASSIGN(SHIP(1),24,'FAERI   E QUE   ENE     ')
C--------CLEAR AND RESUPPLY SHIP
      CALL ASSIGN(CONDIT,8,'DOCKED   ')
      DO 70 L=1,12
 70   DAMAGE(L)=0
      ENERGY=3000.0
        INSHLD=2000.0
      SHIELD=2000.0
      TORPS=7
      LSUPRE=0.8
      RETURN
      END
       SUBROUTINE ATTACK
      DOUBLE PRECISION SHIP(3)
      LOGICAL COMPAR
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      INTEGER CDAM(5),CRPTR,PERCEN
      IF(KLHERE .EQ. 0) RETURN
      IF(ALLDON.NE.0) RETURN
      PFAC=1.0/INSHLD
      IHURT=0
      IF(COMPAR(CONDIT,8,'DOCKED  ')) GO TO 110
C--------ALLOW EACH KLINGON IN TURN TO DO HIS DAMNEDEST
      DO 80 L=1,KLHERE
      PROPOR=PFAC*SHIELD
C--------COMPUTE HIT STRENGTH AND DIMINISH SHIELD POWER
      DUSTFA=0.80+0.05*RAN(0)
      HIT=KPOWER(L)*DUSTFA**KAVGD(L)
      IF(SHLDUP .EQ. 0) GO TO 10
      HITSH=PROPOR*HIT
      IF(HITSH .GT. SHIELD) HITSH=SHIELD
      SHIELD=SHIELD-HITSH
      HIT=HIT-HITSH
      IF(PROPOR .GT. 0.1 .AND. HIT .LT. (0.005*ENERGY)) GO TO 80
C--------IT"S A HIT>  PRINT OUT HIT SIZE
 10   IHURT=1
        PRINT 1001,HIT,(SHIP(I),I=1,3),KX(L),KY(L)
1001    FORMAT (' ',F8.2,' UNIT HIT ON THE ',2A5,A3,' FROM KLINGON AT',
     1' SECTOR ',I2,' - ',I2)
C--------DECIDE IF HIT IS CRITICAL
      CHIT=HIT
      CRPTR=0
 20   IF(CHIT .LT. (200.0*RAN(0)+100.0)) GO TO 60
C--------SELECT DEVICE(S) TO BE DAMAGED
22      J=11.0*RAN(0)+1.0
      IF(CRPTR .EQ. 0) PRINT 1000
1000    FORMAT (' ***CRITICAL HIT!   DAMAGED DEVICES:'/)
25      IF(J .EQ. 6) DAMAGE(6)=DAMAGE(6)+0.5*RAN(0)+0.05
      IF(J .NE. 6) DAMAGE(J)=DAMAGE(J)+RAN(0)+0.1
      CDAM(CRPTR+1)=J
      IF(CRPTR .EQ. 0) GO TO 40
      DO 30 LL=1,CRPTR
      IF(CDAM(LL) .EQ. J) GO TO 50
 30   CONTINUE
40      IF (J.EQ.1)PRINT 1100
1100    FORMAT (' S.R. SENSORS')
        IF (J.EQ.2)PRINT 1200
1200    FORMAT (' L.R. SENSORS')
        IF (J.EQ.3)PRINT 1300
1300    FORMAT (' PHASERS')
        IF (J.EQ.4)PRINT 1400
1400    FORMAT (' TORPEDO CONTROL')
        IF (J.EQ.5)PRINT 1500
1500    FORMAT (' LIFE SUPPORT')
        IF (J.EQ.6)PRINT 1600
1600    FORMAT (' WARP ENGINES')
        IF (J.EQ.7)PRINT 1700
1700    FORMAT (' IMPULSE ENGINES')
        IF (J.EQ.8)PRINT 1800
1800    FORMAT (' SHIELDS')
        IF (J.EQ.9)PRINT 1900
1900    FORMAT (' TELEPORTER')
        IF (J.EQ.10)PRINT 2000
2000    FORMAT (' DEATH RAY')
        IF (J .EQ. 11)PRINT 2100
2100    FORMAT (' BATTLE COMPUTER')
      CRPTR=CRPTR+1
 50   CHIT=CHIT-400
      GO TO 20
 60   IF(CRPTR .EQ. 0) GO TO 70
      IF(J .NE. 8) GO TO 70
        PRINT 1002
1002    FORMAT (' ***SHIELDS ARE DOWN')
      SHLDUP=0
 70   CONTINUE
      ENERGY=ENERGY-HIT
 80   CONTINUE
      IF(ENERGY .LE. 0) GO TO 100
      PERCEN=100.0*PFAC*SHIELD+0.5
C--------PRINT MESSAGE IF SHIELDS FULLY PROTECTED STARSHIP
        IF (IHURT.NE.0)GOTO 85
        PRINT 3000,PERCEN
3000    FORMAT (' KLINGONS ATTACK--SHIELD STRENGTH REDUCED TO ',I3,'%')
        GOTO 120
C--------PRINT MESSAGE IF STARSHIP ITSELF SUFFERED HIT(S)
85      CALL ASSIGN(TEMP,4,'DOWN')
        IF (SHLDUP.NE.0) CALL ASSIGN(TEMP,4,'UP, ')
        PRINT 4000,ENERGY,TEMP,PERCEN
4000    FORMAT (' ENERGY LEFT: ',F7.2,'   SHIELDS ',A4,' ',I3,'%.')
      GO TO 120
C--------RETURNING HOME UPON YOUR SHIELD, NOT WITH IT...
 100  CALL FINISH(5)
      RETURN
C--------DOCKED AND SAFE FROM ALL KLINGONS
110     PRINT 2001,(SHIP(I),I=1,3)
2001    FORMAT(' ***KLINGONS ATTACK-- STARBASE SHIELDS PROTECT ',2A5,A3)
C--------AFTER ATTACK, RESET AVERAGE DISTANCE TO KLINGONS
 120  DO 130 L=1,KLHERE
 130  KAVGD(L)=KDIST(L)
      CALL SORTKL
      RETURN
      END
       SUBROUTINE AUTOVE
      DOUBLE PRECISION SHIP(3)
      LOGICAL COMPAR
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C--------INFORM CAPTAIN OF ATTEMPT TO REACH SAFETY
        PRINT 1000,(SHIP(I),I=1,3)
1000    FORMAT (' ***EMERGENCY AUTOMATIC OVERRIDE ATTEMPTS TO HURL THE'
     1/' ',2A5,A3,' SAFELY OUT OF QUADRANT')
C--------TRY TO USE WARP ENGINES
      IF(DAMAGE(6) .EQ. 0) GO TO 10
        PRINT 2000
2000    FORMAT (' WARP ENGINES DAMAGED.')
      GO TO 20
 10   WARPFA=6.0+2.0*RAN(0)
      WFACSQ=WARPFA*WARPFA
      POWER=0.75*ENERGY
      DISTMX=POWER/(4.0*WFACSQ)
      DISTRQ=1.4142+2.0*RAN(0)
      DIST=AMIN1(DISTMX,DISTRQ)
      DIREC=12.0*RAN(0)
      CALL WARPX
      RETURN
C--------TRY TO USE IMPULSE ENGINES
 20   RETURN
      END
       SUBROUTINE BATLEC
      DOUBLE PRECISION SHIP(3)
      LOGICAL COMPAR
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD,ITEM,IW
      IF(DAMAGE(11) .EQ. 0)GO TO 10
        PRINT 1000
1000    FORMAT (' BATTLE COMPUTER INOPERATIVE.')
      RETURN
10      CALL SCAN(ITEM,KEY)
      IF(COMPAR(ITEM,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL '))GOTO 3
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 5
        GOTO 7
4       PRINT 1001
1001    FORMAT ('   *BATTLE COMPUTER COMMANDS*'/' STOP(ST)',
     1'      STOP'/' COURSE(CO)    CALCULATE COURSE'/
     1' DISTANCE(DI)  CALCULATE DISTANCE'/
     1' BOTH(BO)      BOTH COURSE AND DISTANCE'/
     1' PHASER(PH)    CALCULATE ENERGY NEEDED TO KILL')
        GOTO 3
5       CALL SCAN(ITEM,KEY)
      IF(COMPAR(ITEM,2,'ST')) RETURN
3       CALL CHEW
      CALL PROMPT(27,'WORKING.--READY FOR INPUT: ')
        GOTO 10
7       IF (COMPAR(ITEM,2,'PH'))GOTO 100
        IF (COMPAR(ITEM,2,'CO').OR.COMPAR(ITEM,2,'DI').OR.
     +   COMPAR(ITEM,2,'BO')) GO TO 8
        IF (.NOT.COMPAR(ITEM,2,'ST'))GOTO 4
        RETURN
8       CALL SCAN(IW,KEY)
      IF(COMPAR(IW,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL '))GOTO 89
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 89
        GOTO 12
89      CALL CHEW
      CALL PROMPT(23,'QUADRANTS OR SECTORS ? ')
        GOTO 8
12      IF (.NOT.COMPAR(IW,1,'S').AND..NOT.COMPAR(IW,1,'Q'))GOTO 89
        IFAC=1
        IF (COMPAR(IW,1,'Q'))IFAC=10
15      IF (IFAC.EQ.10)GOTO 17
        CALL SCAN(AT,KEY)
      IF(COMPAR(AT,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL '))GOTO 816
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 816
        IY=AT
        CALL SCAN(AT,KEY)
      IF(COMPAR(AT,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL '))GOTO 816
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 816
        IX=AT
        GOTO 25
816     CALL CHEW
16    CALL PROMPT(30,'SECTOR COORDINATES OF TARGET: ')
        GOTO 15
17      CALL SCAN(AT,KEY)
      IF(COMPAR(AT,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL '))GOTO 875
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 875
        IY=AT
        CALL SCAN(AT,KEY)
      IF(COMPAR(AT,2,'ST')) RETURN
        IF (COMPAR(KEY,4,'EOL ')) GO TO 875
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 875
        IX=AT
        GOTO 25
875     CALL CHEW
175   CALL PROMPT(32,'QUADRANT COORDINATES OF TARGET: ')
        GOTO 17
25      IF (IX.LT.1.OR.IX.GT.10.OR.IY.LT.1.OR.IY.GT.10)GOTO 15
      IF(IFAC .EQ. 10 .AND. (IX .GT. 8 .OR. IY .GT. 8))GOTO 17
      X=IX-SECTY
      IF(IFAC .EQ. 10)X=IX-QUADY
      Y=-(IY-SECTX)
      IF(IFAC .EQ. 10)Y=-(IY-QUADX)
      IF(COMPAR(ITEM,2,'DI'))GO TO 70
      IF(X .NE. 0.0)GO TO 55
      ANGLE=1.5707961327
      IF(Y .LT. 0)ANGLE=3.0*ANGLE
      GO TO 60
55    ANGLE=ATAN(Y/X)
      IF(X .LT. 0)ANGLE=ANGLE+3.14159265359
60    COURSE=15.0-ANGLE*1.909859317
      IF(COURSE .GT. 12.00)COURSE=COURSE-12.00
      IF(COMPAR(ITEM,2,'BO'))GOTO 70
        PRINT 8000,COURSE
8000    FORMAT (' COURSE IS: ',F6.3)
      GO TO 5
70    DI=0.1*SQRT(X**2+Y**2)*IFAC
      IF (COMPAR(ITEM,2,'BO'))GOTO 80
        PRINT 9000,DI
9000    FORMAT (' DISTANCE IS: ',F6.2)
      GO TO 5
80      PRINT 9500,COURSE,DI
9500  FORMAT (' COURSE IS: ',F6.3,'   DISTANCE IS: ',F6.2)
      GO TO 5
100      IF(KLHERE .GT. 0)GO TO 110
        PRINT 10000
10000   FORMAT (' NO KLINGONS HERE.')
      GO TO 5
110     TOTL = 0
      DO 120 I=1,KLHERE
      PHAEN=(KPOWER(I)/0.8**KDIST(I))/3
        TOTL = TOTL + PHAEN
        PRINT 11000,KX(I),KY(I),PHAEN
11000   FORMAT (' MAX ENERGY NEEDED TO KILL KLINGON AT SECTOR ',I2,' - '
     1 ,I2,' IS: ',F7.2)
120   CONTINUE
        IF (KLHERE .GT. 1)PRINT 1105,TOTL
1105    FORMAT (' TOTAL ENERGY TO KILL ALL KLINGONS ',F7.2)
      GO TO 5
      END
       SUBROUTINE CHART
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,TEMP(8),RATING,CVT7B/Z3B000000/
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        IF (ALLDON.EQ.0)GOTO 5
        DO 3 I=1,8
        DO 3 J=1,8
3       STARCH(I,J)=1
5       PRINT 1000
1000    FORMAT (' STAR CHART FOR THE KNOWN GALAXY'/'      1    2    3',
     1'    4    5    6    7    8'/'   --------------------------------',
     1'----------')
      DO 50 I=1,8
      DO 40 J=1,8
      IF(STARCH(I,J)) 10,20,30
10      CALL ASSIGN(TEMP(J),4,' .1.')
        IF (I.EQ.QUADX.AND.J.EQ.QUADY) CALL ASSIGN(TEMP(J),4,'#.1.')
      GO TO 40
 20     CALL ASSIGN(TEMP(J),4,' ...')
        IF (I.EQ.QUADX.AND.J.EQ.QUADY) CALL ASSIGN(TEMP(J),4,'#...')
      GO TO 40
30      IF (I.NE.QUADX.OR.J.NE.QUADY)GOTO 35
      CALL ENCODE(GALAXY(I+1,J+1),4,TEMP(J))
      TEMP(J)=TEMP(J)+CVT7B
        GOTO 40
35    CALL ENCODE(GALAXY(I+1,J+1),4,TEMP(J))
 40   CONTINUE
        PRINT 2000,I,(TEMP(K),K=1,8)
2000  FORMAT ('+',I2,8('×',A4),'×',/,'   -----------------------------',
     1'-------------')
 50   CONTINUE
      IDIDIT=1
      RETURN
      END
       SUBROUTINE CHOOSE
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      GO TO 17
   10 PRINT 111
  111 FORMAT('  PLEASE STATE WHETHER YOU CAN PLAY AT NOVICE, FAIR,'/
     *' GOOD, EXPERT OR MASTER LEVEL. (YOU MAY ENTER N,F,G,E OR M)')
   17 CALL PROMPT(29,'WHAT IS YOUR STARSHIP LEVEL? ')
        READ(5,2000) ITEM
2000    FORMAT (A1)
20    SKILL=0
      IF(COMPAR(ITEM,1,'N'))SKILL=1
      IF(COMPAR(ITEM,1,'F'))SKILL=2
      IF(COMPAR(ITEM,1,'G'))SKILL=3
      IF(COMPAR(ITEM,1,'E'))SKILL=4
      IF(COMPAR(ITEM,1,'M'))SKILL=5
      IF(SKILL .EQ.0)GO TO 10
25    CALL PROMPT(37,'DO YOU WANT A SHORT OR A LONG GAME ? ')
        READ(5,2000) ITEM
      LEN=0
      IF(COMPAR(ITEM,1,'S'))LEN=2
      IF(COMPAR(ITEM,1,'L'))LEN=1
        IF (LEN.EQ.0)GOTO 25
C*30    CALL PROMPT(32,'PLEASE TYPE A SECRET PASSWORD : ')
C*        READ(5,5000) PASSWD
C*5000    FORMAT (A8)
        INBASE=RAN(0)*5.+1
        REMBAS=INBASE
        INKLIN=10*(SKILL-.5+RAN(0)*(1.6+SKILL))/LEN
        REMKL=INKLIN
        INCOM=INKLIN*(RAN(0)*.1)+1.1
        REMCOM=INCOM
        INRESO=(INKLIN+2*INCOM)*(11.5-2*SKILL)/LEN
        REMRES=INRESO
        INTIME=INRESO/(INKLIN+2*INCOM)
        REMTIM=INTIME
      RETURN
      END
       SUBROUTINE DEADKL(IX,IY)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(.NOT.COMPAR(QUAD(IX,IY),1,'C'))GO TO 25
C--------CHALK UP A COMMANDER
        PRINT 1000,IX,IY
1000    FORMAT (' ***COMMANDER AT SECTOR ',I2,' - ',I2,' DESTROYED')
      IF(REMCOM .LT. 1)GO TO 12
      DO 10 I=1,REMCOM
      IF(CX(I) .EQ. QUADX .AND. CY(I) .EQ. QUADY)GO TO 15
10    CONTINUE
12      PRINT 1500
1500    FORMAT (' COMMANDER TROUBLE!')
      STOP3
15    CX(I)=CX(REMCOM)
      CY(I)=CY(REMCOM)
        CX(REMCOM)=0
        CY(REMCOM)=0
      REMCOM=REMCOM-1
      GO TO 30
25      PRINT 2000,IX,IY
2000    FORMAT (' ***KLINGON AT SECTOR ',I2,' - ',I2,' DESTROYED.')
C----------COMMANDERS AND KLINGONS COME HERE
30      CALL ASSIGN(QUAD(IX,IY),4,'.   ')
      KILLS=KILLS+1
      REMKL=REMKL-1
      IF(REMKL .NE. 0) GO TO 35
        GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)-100
      ALLDON=1
      RETURN
 35   REMTIM=REMRES/(REMKL+REMCOM+REMCOM)
      GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)-100
      IF(KLHERE .LT. 1)GO TO 44
C---------FIND KLING IN QUADS ARRAY AND REMOVE
      DO 40 I=1,KLHERE
      IF(KX(I) .EQ. IX .AND. KY(I) .EQ. IY)GO TO 45
40    CONTINUE
42      PRINT 2500
2500    FORMAT (' KX AND KY DON''T MATCH!')
      STOP4
44      PRINT 3000
3000    FORMAT (' QUAD KLINGONS GOING UNDER 0!')
      STOP5
45    KLHERE=KLHERE-1
      IF(I .GT. KLHERE)GO TO 55
      DO 50 J=I,KLHERE
      KX(J)=KX(J+1)
      KY(J)=KY(J+1)
      KPOWER(J)=KPOWER(J+1)
        KAVGD(J)=KDIST(J+1)
50      KDIST(J)=KDIST(J+1)
55      KX(KLHERE+1)=0
        KY(KLHERE+1)=0
        KDIST(KLHERE+1)=0
        KAVGD(KLHERE+1)=0
        KPOWER(KLHERE+1)=0
      CALL NEWCND
      RETURN
      END
      SUBROUTINE DESTRU
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD,PASS2
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C*      CALL PROMPT(23,'TYPE YOUR SECRET CODE: ')
C*        READ(5,2000) PASS2
C*2000    FORMAT (A8)
C*        IF (PASS2.NE.PASSWD)GOTO 5
        PRINT 3000
3000    FORMAT (' GOODBYE CRUEL WORLD IT IS ALL OVER ! '/)
        CALL LOGOUT
C*5       PRINT 4000
C*4000    FORMAT (' WRONG CODE !')
        STOP
        END
      SUBROUTINE DETHRA
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,TRY,DUMMY,RATING
        REAL*8 CONDIT,PASSWD
        CALL SCAN(TRY,DUMMY)
        IF (.NOT.COMPAR(DUMMY,4,'EOL '))GOTO 1002
19      IF (DAMAGE(10).EQ.0.)GOTO 1001
        PRINT 17
17      FORMAT (' DEATH RAY IS DAMAGED POSSIBLY BEYOND REPAIR')
        RETURN
1001  IF(.NOT.COMPAR(DUMMY,3,'EOL')) GO TO 1002
        PRINT 1000
1000    FORMAT ('+THERE IS A 15% CHANCE THE DEATH RAY WILL WORK AS',
     1' DESIGNED.')
      CALL PROMPT(30,'DO YOU STILL WANT TO USE IT ? ')
1003    READ(5,1100) TRY
1100    FORMAT (A1)
1002    IF (COMPAR(TRY,1,'Y')) GO TO 10
        IF (COMPAR(TRY,1,'N')) RETURN
        PRINT 16
16      FORMAT (' TYPE YES OR NO')
        GOTO 1003
10      IF (GALAXY(QUADX+1,QUADY+1)-KLHERE*100.LT.10)GOTO 15
        PRINT 14
14      FORMAT (' SPOCK TO CAPTAIN: FEDERATION LAW PROHIBITS TESTING',
     1/,' OF THE DEATH RAY IN A QUADRANT CONTAINING A STARBASE'
     2,/,' REQUEST ABORTED')
        RETURN
15      IF (KLHERE.NE.0)GOTO 13
        PRINT 18
18      FORMAT (' SPOCK TO CAPTAIN: THAT WAS NOT A WISE MOVE',/,
     1' THERE ARE NO KLINGONS IN THIS QUADRANT')
13      DEATH=RAN(0)
        IF (DEATH.GT..05)GOTO 20
        TEMP=ENERGY*.05
        ENERGY=ENERGY-TEMP
12      PRINT 11,TEMP
11      FORMAT (' ENGINEERING TO BRIDGE-- SCOTTY HERE, THE DEATH RAY',
     1/' WILL NOT FIRE AND CAN NOT BE REPAIRED.',
     2/' ENERGY USED = ',F6.2)
        DAMAGE(10)=5
        IF (DEATH.GT..02)CALL ATTACK
        RETURN
20      IF (DEATH.GT..25)GOTO 30
        PRINT 22
22      FORMAT (' ENGINEERING TO BRIDGE-- SCOTTY HERE-- ANTIMATTER',
     1' OVERLOAD !')
        NEWSTR=0
        DO 24 I=1,10
        DO 24 J=1,10
        IF (COMPAR(QUAD(I,J),1,'K'))CALL DEADKL(I,J)
        IF (.NOT.COMPAR(QUAD(I,J),1,'.'))GOTO 24
        NEWSTR=NEWSTR+1
        CALL ASSIGN(QUAD(I,J),4,'*   ')
24      CONTINUE
        IF (NEWSTR.EQ.0)GOTO 21
        PRINT 23,NEWSTR
23      FORMAT (' SULU TO CAPTAIN, ',I2,' NEW STARS HAVE APPEARED IN',
     1/' OUR QUADRANT THEY MUST BE PSEUDO STARS CREATED BY',
     2/' THE DEATH RAY.')
21      CALL ASSIGN(CONDIT,8,'ABSURD  ')
26      TEMP=ENERGY*.15
        ENERGY=ENERGY-TEMP
        PRINT 27,TEMP
27      FORMAT (' ENERGY USED BY DEATH RAY = ',F6.2)
        IF (DEATH.GT..15)CALL ATTACK
        RETURN
30      IF (DEATH.GT..40)GOTO 40
        GALAXY(QUADX+1,QUADY+1)=1000
        CALL FINISH(10)
        RETURN
40      IF (DEATH.GT..55)GOTO 50
        IF (KLHERE.EQ.0)GOTO 44
        PRINT 45,KLHERE,QUADX,QUADY
45      FORMAT (' DEATH RAY SUCCESSFUL ',I1,' KLINGONS IN',
     1/,' QUADRANT ',I2,'-',I2,' DESTROYED.')
        DO 43 I=1,10
        DO 43 J=1,10
43      IF (COMPAR(QUAD(I,J),4,'K   ').OR.COMPAR(QUAD(I,J),4,'C   '))
     +   CALL DEADKL(I,J)
44      TEMP=ENERGY*.15
        ENERGY=ENERGY-TEMP
48      PRINT 49,TEMP
49      FORMAT (' ENERGY USED = ',F6.2)
        RETURN
50      IF (DEATH.GT..75)GOTO 60
        TEMP=ENERGY*.75
        ENERGY=ENERGY-TEMP
        PRINT 55,TEMP
55      FORMAT (' THERMAL REACTOR ENERGY DRAIN !'/
     1' ',F7.2,' UNITS ENERGY BURNED BY DEATH RAY')
        CALL ATTACK
        RETURN
60      IF (DEATH.GT..95)GOTO 70
        KLNOW=1.5*KLHERE
        IF (KLNOW.GT.8)KLNOW=9
        IF (KLNOW-KLHERE.EQ.0)GOTO 65
        I=KLNOW-KLHERE
        PRINT 63,I
63      FORMAT (' DEATH RAY CREATES ',I1,' KLINGONS IN QUADRANT')
        GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)+(KLNOW*100)
     1    -(KLHERE*100)
        REMKL=REMKL+(KLNOW-KLHERE)
        KLHERE=KLNOW
65      PRINT 67
67      FORMAT (' DEATH RAY DISORDERS QUADRANT')
        TEMP=ENERGY*.15
        ENERGY=ENERGY-TEMP
        PRINT 69,TEMP
69      FORMAT (' ENERGY USED = ',F6.2)
        CALL NEWQUA
        CALL ATTACK
        RETURN
70      CALL FINISH(11)
        DO 74 I=1,8
        DO 74 J=1,8
74      GALAXY(I+1,J+1)=GALAXY(I+1,J+1)-((GALAXY(I+1,J+1)/10)*10)
        RETURN
        END
       SUBROUTINE DOCK
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(COMPAR(CONDIT,8,'DOCKED  ')) GO TO 30
      IF(BASEX .EQ. 0) GO TO 3
      IF(IABS(SECTX-BASEX).LE.1 .AND. IABS(SECTY-BASEY).LE.1)GO TO 10
3       PRINT 1000,(SHIP(I),I=1,3)
1000    FORMAT (' ',2A5,A3,' NOT ADJACENT TO BASE.')
        RETURN
10    CALL ASSIGN(CONDIT,8,'DOCKED  ')
      MOVED=0
        PRINT 2000
2000    FORMAT (' DOCKED.')
        IF (COMPAR(SHIP(1),8,'FAERI   '))GOTO 20
      ENERGY=5000.
      SHIELD=3000.
      TORPS=10
      LSUPRE=1.0
      RETURN
20    ENERGY=3000.
      SHIELD=2000.
      TORPS=7
      LSUPRE=0.8
      RETURN
30      PRINT 2500
2500    FORMAT (' ALREADY DOCKED.')
      RETURN
      END
       SUBROUTINE DREPRT
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IDIDIT=1
C--------FIND OUT IF ANYTHING IS DAMAGED
      DO 10 L=1,12
      IF(DAMAGE(L) .GT. 0) GO TO 20
 10   CONTINUE
        PRINT 1000
1000    FORMAT (' ALL DEVICES FUNCTIONAL.')
      RETURN
C--------PRINT OUT TABLE OF DAMAGED DEVICES
20      PRINT 2000
2000    FORMAT (' DEVICE                REPAIR TIME',/)
 101  IF(DAMAGE(1) .LE. 0) GO TO 102
        T=DAMAGE(1)+.005
        PRINT 2100,T
2100    FORMAT (' S.R. SENSORS         ',F5.2)
 102  IF(DAMAGE(2) .LE. 0) GO TO 103
        T=DAMAGE(2)+.005
        PRINT 2200,T
2200    FORMAT (' L.R. SENSORS         ',F5.2)
 103  IF(DAMAGE(3) .LE. 0) GO TO 104
        T=DAMAGE(3)+.005
        PRINT 2300,T
2300    FORMAT (' PHASERS               ',F5.2)
 104  IF(DAMAGE(4) .LE. 0) GO TO 105
        T=DAMAGE(4)+.005
        PRINT 2400,T
2400    FORMAT (' TORPEDO CONTROL       ',F5.2)
 105  IF(DAMAGE(5) .LE. 0) GO TO 106
        T=DAMAGE(5)+.005
        PRINT 2500,T
2500    FORMAT (' LIFE SUPPORT          ',F5.2)
 106  IF(DAMAGE(6) .LE. 0) GO TO 107
        T=DAMAGE(6)+.005
        PRINT 2600,T
2600    FORMAT (' WARP ENGINES          ',F5.2)
 107  IF(DAMAGE(7) .LE. 0) GO TO 108
        T=DAMAGE(7)+.005
        PRINT 2700,T
2700    FORMAT (' IMPULSE ENGINES       ',F5.2)
 108  IF(DAMAGE(8) .LE. 0) GO TO 109
        T=DAMAGE(8)+.005
        PRINT 2800,T
2800    FORMAT (' SHIELDS               ',F5.2)
 109  IF(DAMAGE(9) .LE. 0) GO TO 110
        T=DAMAGE(9)+.005
        PRINT 2900,T
2900    FORMAT (' TELEPORTER            ',F5.2)
 110  IF(DAMAGE(10) .LE. 0) GO TO 111
        T=DAMAGE(10)+.005
        PRINT 3000,T
3000    FORMAT (' DEATH RAY             ',F5.2)
111     IF (DAMAGE(11).LE.0)GOTO 112
        T=DAMAGE(11)+.005
        PRINT 3100,T
3100  FORMAT (' BATTLE COMPUTER       ',F5.2)
112     RETURN
      END
       SUBROUTINE EVENTS
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      REAL LENFAC
      LENFAC=(LEN+1.0)/2.0
C--------DECREMENT FEDERATION RESOURCES AND RECOMPUTE REMAINING TIME
 5    DATE=DATE+TIME
      IF(REMKL .LE. 0) STOP 666
      REMLST=(REMKL+2*REMCOM)*TIME
      REMRES=REMRES-REMLST
      REMTIM=REMRES/(REMKL+2*REMCOM)
      IF(REMTIM .GT. 0) GO TO 10
C--------FEDERATION RESOURCES DEPLETED! END
      CALL FINISH(2)
      RETURN
C--------DECIDE IF LIFE SUPPORT IS ADEQUATE
 10   IF(DAMAGE(5).EQ.0 .OR.COMPAR(CONDIT,8,'DOCKED  ')) GO TO 30
      IF(LSUPRE .GE. TIME .OR. DAMAGE(5) .LE. LSUPRE) GO TO 20
      ALLDON=1
      CALL FINISH(3)
      RETURN
 20   LSUPRE=LSUPRE-TIME
      IF(DAMAGE(5) .GT. TIME) GO TO 30
      LSUPRE=1.0
      IF(.NOT.COMPAR(SHIP(1),8,'ENTER   ')) LSUPRE=0.75
C--------FIX DEVICES
 30   REPAIR=TIME
      IF(COMPAR(CONDIT,8,'DOCKED  ')) REPAIR=10.0*TIME
      DO 40 L=1,12
      IF(DAMAGE(L) .GT. 0) DAMAGE(L)=AMAX1(DAMAGE(L)-REPAIR,0.0)
 40   CONTINUE
C--------SELECT EARLIEST EXTRANEOUS EVENT
 50   LINE=1
      DATMIN=FUTURE(1)
      IF(NEVENT-1) 60,90,70
 60   RETURN
 70   DO 80 L=2,NEVENT
      IF(FUTURE(L) .GE. DATMIN) GO TO 80
      DATMIN=FUTURE(L)
      LINE=L
 80   CONTINUE
C--------IF WITHIN TIME RANGE, CAUSE EXTRANEOUS EVENT TO OCCUR
 90   IF(DATMIN .GT. DATE) RETURN
 100  GO TO (110,120,130,140),LINE
C--------EXTRANEOUS EVENT 1:  SUPERNOVA
 110  TMPDAT=DATE
      DATE=FUTURE(1)
      CALL SNOVA(0,0)
      DATE=TMPDAT
      T=3.0*RAN(0)
 111  IF(RAN(0) .LT. 0.5) GO TO 112
      T=T+3.0*RAN(0)
      GO TO 111
 112  FUTURE(1)=FUTURE(1)+LENFAC*T
      GO TO 50
C--------EXTRANEOUS EVENT 2:  TRACTOR BEAM
 120  IF(REMCOM .EQ. 0) GO TO 122
      IF(COMPAR(CONDIT,8,'DOCKED  ')) GO TO 123
      I=1
      IF(REMCOM .GT. 1) I=RAN(0)*REMCOM+1
      YANK=(CX(I)-QUADX)**2 + (CY(I)-QUADY)**2
      IF(YANK .EQ. 0) GO TO 121
      YANK=SQRT(YANK)
      TIME=0.05*YANK
        PRINT 1000,(SHIP(II),II=1,3),CX(I),CY(I)
1000    FORMAT (' ',2A5,A3,' CAUGHT IN LONG RANGE TRACTOR BEAM--'/
     1'      PULLED TO QUADRANT ',I2,' - ',I2)
      QUADX=CX(I)
      QUADY=CY(I)
      SECTX=10.0*RAN(0)+1
      SECTY=10.0*RAN(0)+1
      CALL NEWQUA
 121  FUTURE(2)=DATE+(0.1+(9.0*RAN(0))/REMCOM)*LENFAC
      GO TO 50
 122  FUTURE(2)=DATE+100000.0
      GO TO 50
 123  FUTURE(2)=DATE+0.1
      GO TO 50
C  ---   EVENT 3  SPACE STORMS -------
130     CONTINUE
      CALL STORM
      RETURN
C       THIS IS WHERE SPACE STORMS WILL GO AGAIN
C ---   EVENT 4 TEMPORARY TRUCE -----
140     DO 141 I=1,12
        IF (DAMAGE(I).GT.0)GOTO 145
141   CONTINUE
        FUTURE(4)=DATE + .3
        RETURN
145     DATE=DATE+.2
        DO 147 I=1,12
147     IF(DAMAGE(I).GT.0)DAMAGE(I)=AMAX1(DAMAGE(I)-1.,0.0)
        PRINT 148
148   FORMAT (' *** TEMPORARY TRUCE ***',/,' *** DEVICES REPAIRED***')
        FUTURE(4)=DATE+(0.15+(9.0*RAN(0))*SKILL/(REMBAS))*LENFAC
        GOTO 50
      END
       SUBROUTINE FINISH(I)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      ALLDON=1
      SAVED=REMRES/INRESO
        PRINT 1000,DATE
1000    FORMAT (' IT IS STARDATE ',F7.2,'.')
      GO TO (100,200,300,400,500,600,700,800,900,4000,4500),I
C--------CASE 1:  GAME HAS BEEN WON
100     PRINT 1100
1100    FORMAT (' YOU HAVE SMASHED THE KLINGON INVASION FLEET AND ',
     1 'SAVED THE FEDERATION.'/,' YOU HAVE BEEN PROMOTED TO COMMODORE ',
     1 'EMERITUS.')
110     PRINT 1101
1101    FORMAT (' LIVE LONG AND PROSPER.')
      CALL SCORE(I)
      RETURN
C--------CASE 2:  FEDERATION RESOURCES DEPLETED
200     PRINT 1200
1200    FORMAT (' THE FEDERATION HAS BEEN CONQUERED.'/' YOUR STARSHIP ',
     1 'IS NOW KLINGON PROPERTY, AND YOU ARE PUT ON TRIAL'/' AS A WAR ',
     1'CRIMINAL.  ON THE BASIS OF YOUR RECORD,')
      IF(REMKL*3 .GT. INKLIN) GO TO 210
        PRINT 1201
1201    FORMAT (' YOU ARE FOUND GUILTY AND SENTENCED TO DEATH BY SLOW ',
     1'TORTURE.')
      CALL SCORE(I)
      RETURN
210     PRINT 1202
1202    FORMAT (' YOU ARE AQUITTED.')
      GO TO 110
C--------CASE 3:  LIFE SUPPORT SYSTEM FAILURE
300     PRINT 1300
1300    FORMAT (' YOUR LIFE SUPPORT SYSTEMS HAVE FAILED.')
310     PRINT 1301
1301    FORMAT (' YOUR STARSHIP IS A DERELICT IN SPACE.')
      GO TO 5000
C--------CASE 4:  ENERGY SUPPLY EXHAUSTED
400     PRINT 1400
1400    FORMAT (' YOUR ENERGY SUPPLY IS EXHAUSTED.')
      GO TO 310
C--------CASE 5:  DEFEATED IN BATTLE
500     PRINT 1500,(SHIP(J),J=1,3)
1500    FORMAT (' THE ',2A5,A3,' HAS BEEN DESTROYED IN BATTLE.'/
     1' DULCE ET DECORUM EST PRO PATRIA MORI.')
      GO TO 5000
C--------CASE 6:  HIT NEGATIVE ENERGY ZONE THREE TIMES
600     PRINT 1600
1600    FORMAT (' YOU HAVE MADE THREE ATTEMPTS TO CROSS THE NEGATIVE ',
     1'ENERGY BARRIER WHICH'/' SURROUNDS THE GALAXY.  YOUR NAVIGATION ',
     1'IS ABOMINABLE.')
      CALL SCORE(I)
      RETURN
C--------CASE 7:  STARSHIP DESTROYED BY ORDINARY NOVA
700     PRINT 1700
1700    FORMAT (' YOUR STARSHIP HAS BEEN DESTROYED BY A NOVA. THAT WAS',
     1' A GREAT SHOT.')
      GO TO 5000
C--------CASE 8:  STARSHIP DESTROYED BY A SUPERNOVA
800     PRINT 1800,(SHIP(J),J=1,3)
1800    FORMAT (' THE ',2A5,A3,' HAS BEEN FRIED BY A SUPERNOVA.'/' NOT',
     1 ' EVEN CINDERS REMAIN.')
      GO TO 5000
C--------CASE 9:  ABANDON SHIP AFTER ALL STARBASES HAVE BEEN DESTROYED
900     PRINT 1900
1900    FORMAT (' YOU HAVE BEEN CAPTURED BY THE KLINGONS. IF YOU STILL'/
     1' HAD A STARBASE TO BE RETURNED TO, YOU WOULD HAVE BEEN'/
     1'  REPATRIATED AND GIVEN ANOTHER CHANCE. SINCE YOU HAVE NO '/
     1' STARBASES, YOU WILL BE MERCILESSLY TORTURED TO DEATH.')
      GO TO 5000
C--------DECIDE FINAL OUTCOME OF GAME AFTER YOUR DEATH
5000      IF(REMKL+REMCOM .EQ. 0) GO TO 5050
      GOODS=REMRES/INRESO
      BADS=(REMKL+2.0*REMCOM)/(INKLIN+2.0*INCOM)
      ADVNTG=GOODS/BADS
      IF(ADVNTG .LT. (1.5+RAN(0))) GO TO 5020
        PRINT 2000
2000    FORMAT (' AS A RESULT OF YOUR ACTIONS, A TREATY WITH THE KLING',
     1 'ON EMPIRE'/' HAS BEEN SIGNED.  THE TERMS OF THE TREATY ARE')
      IF(ADVNTG .LT. (5.0+RAN(0))) GO TO 5010
        PRINT 2001
2001    FORMAT (' FAVORABLE TO THE FEDERATION. CONGRATULATIONS!')
      GO TO 5030
5010    PRINT 2002
2002    FORMAT (' HIGHLY UNFAVORABLE TO THE FEDERATION.')
      GO TO 5030
5020    PRINT 2003
2003    FORMAT (' THE FEDERATION WILL BE DESTROYED.')
 5030 CALL SCORE(I)
      RETURN
C--------STILL ANOTHER CASE--SUCCESSFUL KAMIKAZEE TACTICS
5050    PRINT 3000
3000    FORMAT (' SINCE YOU TOOK THE LAST KLINGON WITH YOU, YOU ARE A',
     1/' MARTYR AND A HERO.  SOMEDAY MAYBE THEY''LL ERECT A'/,
     1' STATUE IN YOUR MEMORY.  REST IN PEACE, AND TRY NOT TO THINK ',
     1/'ABOUT PIGEONS.')
      CALL SCORE(10)
      RETURN
4000    PRINT 3001,SHIP
3001    FORMAT(' OBVIOUSLY, YOU FAILED TO HEED FIRST OFFICER SPOCK''S ',
     1'WARNING:'/' THE DEATH RAY HAS BACKFIRED AND ENTROPY OF THE ',
     *2A5,A3,/' HAS BEEN MAXIMIZED.'/' PERHAPS YOU WILL BE ',
     3'MORE CAUTIOUS IN YOUR AFTERLIFE.')
        GOTO 5070
5070    CALL SCORE(11)
        RETURN
4500    PRINT 3002,SHIP
3002    FORMAT(' YOU WERE WARNED, CAPTAIN KIRK, BUT YOU PAID NO ',
     1/' ATTENTION. THE DEATH RAY HAS ',
     1/' GONE CRAZY. IT HAS DESTROYED ALL THE KLINGONS IN THE ',
     2/' GALAXY, FOR WHICH THE FEDERATION WOULD HAVE ',
     3/' BEEN, IN MOST CASES, EXTREMELY GRATEFUL, BUT IT ALSO ',
     4/' DESTROYED ALL STARBASES AND THE ',2A5,A3,'.',
     5/' IF YOU HAD SURVIVED, YOU DEFINITELY WOULDN''T',
     6/' HAVE BEEN GIVEN A MEDAL.')
        GOTO 5090
5090    CALL SCORE(12)
        RETURN
      END
       SUBROUTINE GETCD
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C--------GET COURSE
5       CALL SCAN(DIREC,KEY)
        IF (COMPAR(KEY,4,'EOL '))GOTO 10
        IF (COMPAR(KEY,4,'NUMR'))GOTO 15
10      CALL CHEW
      CALL PROMPT(8,'COURSE: ')
        GOTO 5
15      IF (DIREC.LT.0.OR.DIREC.GT.12)GOTO 10
16      CALL SCAN(DIST,KEY)
        IF (COMPAR(KEY,4,'EOL '))GOTO 20
        IF (COMPAR(KEY,4,'NUMR'))GOTO 25
20      CALL CHEW
      CALL PROMPT(10,'DISTANCE: ')
        GOTO 16
25      IF (DIST.LT.0..OR.DIST.GT.15.)GOTO 20
        IDIDIT=1
      RETURN
      END
       SUBROUTINE IMPULS
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(DAMAGE(7).NE.0) GO TO 40
C--------READ IN COURSE AND DISTANCE
      IF(ENERGY .LE. 200)GO TO 5
      CALL GETCD
        IF (IDIDIT.EQ.0)RETURN
        IDIDIT=0
      IF(DIREC .LT. 0) RETURN
C--------MAKE SURE STARSHIP HAS SUFFICIENT ENERGY FOR TRIP
      POWER=200.0+100.0*DIST
      IF(POWER .LT. ENERGY) GO TO 20
5       PRINT 1000
1000    FORMAT (' FIRST OFFICER SPOCK:  "CAPTAIN, THE IMPULSE ENGINES'/
     1' REQUIRE 200.0 UNITS TO ENGAGE, PLUS 100.0 UNITS PER ')
      IF(ENERGY .GT. 200.0) GO TO 10
        PRINT 2000
2000    FORMAT (' QUADRANT.  THEY ARE, THEREFORE, USELESS."')
      RETURN
10      E1=.01*(ENERGY-200.0)-.05
        PRINT 3000,E1
3000    FORMAT (' QUADRANT.  THEREFORE, WE CAN GO A MAXIMUM OF'/
     1,F2.2,' QUADRANTS."')
      RETURN
C--------MAKE SURE ENOUGH TIME IS LEFT FOR THE TRIP
 20   TIME=2.0*DIST
      IF(TIME .LT. .80*REMTIM) GO TO 30
        PRINT 4000
4000  FORMAT (' FIRST OFFICER SPOCK: "CAPTAIN, OUR SPEED UNDER IMPULSE',
     1 /' POWER IS ONLY .5 QUADRANTS PER STARDATE.  ARE YOU SURE')
      CALL PROMPT(25,'WE DARE SPEND THE TIME? "')
        CALL CHEW
      IF(JA(DUMMY).NE.0) GO TO 30
      RETURN
C--------ACTIVATE IMPULSE ENGINES AND PAY THE COST
 30   CALL MOVE
      IDIDIT=1
      MOVED=1
      IF(ALLDON.NE.0) RETURN
      ENERGY=ENERGY-POWER
      IF(ENERGY .GT. 0) RETURN
      CALL FINISH(4)
      RETURN
40      PRINT 5000
5000    FORMAT (' IMPULSE ENGINES DAMAGED.')
        IDIDIT=0
      RETURN
      END
      FUNCTION JA(DUMMY)
      LOGICAL COMPAR
10      CALL SCAN(ITEM,KEY)
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 15
      JA=0
        IF (COMPAR(ITEM,1,'N'))RETURN
      JA=1
        IF (COMPAR(ITEM,1,'Y'))RETURN
 15   CALL PROMPT(30,'PLEASE ANSWER WITH YES OR NO: ')
        CALL CHEW
      GO TO 10
      END
       SUBROUTINE KLACT
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(DAMAGE(4) .GT. 0. .OR. DAMAGE(8) .GT. 0.)GO TO 10
      IF(COMPAR(SHIP(1),8,'ENTER   '))GO TO 15
      F1=1.-ENERGY/3000.
      F4=1.-FLOAT(TORPS)/7.
      GO TO 17
   15 F1=1.-ENERGY/5000.
      F4=1.-FLOAT(TORPS)/10.
   17 F2=1.-SHIELD/INSHLD
      F3=1.-REMTIM/INTIME
      F5=1.-FLOAT(REMKL)/FLOAT(INKLIN)
      F6=1.-SHLDUP
      F7=(DAMP(DAMAGE(1))+DAMP(DAMAGE(3))+DAMP(DAMAGE(4))+DAMP(DAMAGE(6)
     +)+DAMP(DAMAGE(8)))/5.0
      X=.1*F1+.4*F2+.3*F4+.2*F6+.1*F7
      Y=.450*F3+.550*F5
        IF (X+AMAX1(Y,0.0).NE.0)GOTO 16
        X=1.0
        Y=1.0
16      IF(RAN(0) .LT. X/(X + AMAX1(Y,0.0)))GO TO 10
      CALL RETRT
      GO TO 20
   10 CALL MOVEIN
20      CALL NEWCND
      RETURN
         END
      SUBROUTINE LOGIT(LOG)
      PRINT 1000
 1000 FORMAT('  SORRY, BUT THE LOG RECORDER IS MALFUNCTIONING.'/
     1'  ENGINEERING HAS BEEN CONTACTED, AND IT WILL BE REPAIRED SOON.')
      RETURN
        END
       SUBROUTINE LRSCAN
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IDIDIT=0
      IF(DAMAGE(2).GT.0) GO TO 40
        PRINT 1000,QUADX,QUADY
1000    FORMAT (' L.R. SCAN FOR QUADRANT ',I2,' - ',I2,/)
      I=QUADX-1
      II=QUADX+1
      J=QUADY-1
      JJ=QUADY+1
      DO 30 L=I,II
        PRINT 2000,(GALAXY(L+1,M+1),M=J,JJ)
2000    FORMAT (' ',3(' ',I5)/)
        DO 20 LL=J,JJ
        IF (L.EQ.0.OR.L.GT.8)GOTO 20
        IF (LL.EQ.0.OR.LL.GT.8)GOTO 20
        STARCH(L,LL)=1
20      CONTINUE
 30   CONTINUE
      IDIDIT=1
      RETURN
40      PRINT 3000
3000    FORMAT(' L.R. SENSORS DAMAGED.')
      RETURN
      END
       SUBROUTINE MOVE
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      ANGLE=((15.0-DIREC)*0.5235988)
      DELTAX=-SIN(ANGLE)
      DELTAY=COS(ANGLE)
      N=10.0*DIST+0.3
      MOVED=1
      STOPED=0
      IF(COMPAR(CONDIT,8,'DOCKED  ')) CALL NEWCND
C--------MOVE WITHIN QUADRANT
      CALL ASSIGN(QUAD(SECTX,SECTY),4,'.   ')
      X=SECTX
      Y=SECTY
      IF(N .EQ. 0) GO TO 15
      DO 10 L=1,N
      X=X+DELTAX
      IX=X+0.5
      IF(IX .LT. 1 .OR. IX .GT. 10) GO TO 40
      Y=Y+DELTAY
      IY=Y+0.5
      IF(IY .LT. 1 .OR. IY .GT. 10) GO TO 40
      IF(.NOT.COMPAR(QUAD(IX,IY),4,'.   ')) GO TO 20
 10   CONTINUE
      DIST=0.1*SQRT(FLOAT((SECTX-IX)**2 + (SECTY-IY)**2))
      SECTX=IX
      SECTY=IY
15    CALL ASSIGN(QUAD(IX,IY),4,'E   ')
        IF (.NOT.COMPAR(SHIP(1),5,'ENTER'))
     +       CALL ASSIGN(QUAD(IX,IY),4,'F   ')
      FINALX=SECTX
      FINALY=SECTY
      GO TO 100
C--------OBJECT ENCOUNTERED ALONG FLIGHT PATH
 20   STOPED=1
      DIST=0.1*SQRT(FLOAT((SECTX-IX)**2 + (SECTY-IY)**2))
C--------OBJECT IS NOT A KLINGON VESSEL
      IF(COMPAR(QUAD(IX,IY),1,'K').OR.COMPAR(QUAD(IX,IY),1,'C')) GOTO 30
        PRINT 1000,IX,IY
1000    FORMAT (' STARSHIP BLOCKED BY OBJECT AT SECTOR ',I2,' - ',I2)
      ENERGY=ENERGY-100.0
      FINALX=X-DELTAX+0.5
        SECTX=FINALX
      FINALY=Y-DELTAY+0.5
        SECTY=FINALY
        CALL ASSIGN(QUAD(SECTX,SECTY),4,'E   ')
        IF (.NOT.COMPAR(SHIP(1),5,'ENTER'))
     +   CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
      IF(ENERGY .GT. 0) GO TO 100
      CALL FINISH(4)
      RETURN
C--------OBJECT IS A KLINGON VESSEL! RAM HIM
 30   SECTX=IX
      SECTY=IY
      CALL RAM
      CALL ASSIGN(QUAD(SECTX,SECTY),4,'E   ')
        IF (.NOT.COMPAR(SHIP(1),5,'ENTER'))
     +    CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
      FINALX=SECTX
      FINALY=SECTY
      GO TO 100
C--------LEAVING QUADRANT! ALLOW KLINGONS A FINAL ATTACK
 40   DO 42 L=1,KLHERE
      FINALD=SQRT(ABS(FLOAT((IX-KX(L))**2 + (IY-KY(L))**2)))
 42   KAVGD(L)=0.5*(FINALD+KDIST(L))
      CALL ATTACK
        IF (ALLDON.NE.0)RETURN
C--------COMPUTE FINAL POSITION--NEW QUADRANT, NEW SECTOR
      X=10*(QUADX-1)+SECTX
      Y=10*(QUADY-1)+SECTY
      IX=X+10.0*DIST*DELTAX+0.5
      IY=Y+10.0*DIST*DELTAY+0.5
C--------CHECK FOR EDGE OF GALAXY
      KINKS=0
 45   KINK=0
      IF(IX .GT. 0) GO TO 50
      IX=-IX+1
      KINK=1
 50   IF(IY .GT. 0) GO TO 55
      IY=-IY+1
      KINK=1
 55   IF(IX .LE. 80) GO TO 60
      IX=160-IX
      KINK=1
 60   IF(IY .LE. 80) GO TO 65
      IY=160-IY
      KINK=1
 65   IF(KINK .EQ. 0) GO TO 70
      KINKS=1
      GO TO 45
 70   IF(KINKS .EQ. 0) GO TO 90
      NKINKS=NKINKS+1
      IF(NKINKS .EQ. 3) GO TO 80
C--------ISSUE REPRIMAND FOR HITTING EDGE OF GALAXY
        PRINT 2000
2000  FORMAT (' YOU HAVE ATTEMPTED TO CROSS THE NEGATIVE ENERGY BARRIE',
     1'R'/' AT THE EDGE OF THE GALAXY. THE THIRD TIME YOU TRY THIS'/
     1' YOU WILL BE DESTROYED.')
      GO TO 90
C--------ONE, TWO, THREE STRIKES, YOU'RE OUT
 80   CALL FINISH(6)
        IDIDIT=0
      RETURN
C--------COMPUTE FINAL POSITION OF STARSHIP IN NEW QUADRANT
 90   QUADX=(IX+9)/10
      QUADY=(IY+9)/10
      SECTX=IX-10*(QUADX-1)
      SECTY=IY-10*(QUADY-1)
        PRINT 3000,QUADX,QUADY
3000    FORMAT (' ENTERING QUADRANT ',I2,' - ',I2)
        CALL ASSIGN(QUAD(SECTX,SECTY),4,'E   ')
        IF (.NOT.COMPAR(SHIP(1),5,'ENTER'))
     +   CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
      RETURN
C--------NO QUADRANT CHANGE! COMPUTE NEW AVG KLINGON DISTANCES
 100  IF(KLHERE .EQ. 0) RETURN
      DO 110 L=1,KLHERE
      FINALD=(FINALX-KX(L))**2 + (FINALY-KY(L))**2
      FINALD=SQRT(FINALD)
      KAVGD(L)=0.5*(KDIST(L)+FINALD)
 110  KDIST(L)=FINALD
      CALL SORTKL
      RETURN
      END
       SUBROUTINE MOVEIN
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,TEM(8,8),OLDH,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C--------KLINGONS MOVE IN
      DO 5 I=1,8
      DO 5 J=1,8
    5 TEM(I,J)=GALAXY(I+1,J+1)
C--------RANDOMLY, BASED ON PLAYER SKILL
      DO 10 II=1,3
      DO 10 JJ=1,3
      I=QUADX+II-2
      J=QUADY+JJ-2
      IF(I .LT. 1 .OR. J .LT. 1 .OR. I .GT. 8 .OR. J .GT. 8)GO TO 10
      IF (RAN(0) .GT. 0.03*SKILL) GO TO 10
C--------NO KLINGONS TO MOVE
      IF(GALAXY(I+1,J+1) .LT. 100 .OR. GALAXY(I+1,J+1) .GT. 999)GOTO 10
C--------ALREADY THERE
      IF (IABS(J-QUADY) + IABS(I-QUADX) .EQ. 0)GO TO 10
      NI=QUADX
      NJ=QUADY
C---------DON'T FLOOD A QUADRANT
      IF(TEM(NI,NJ) .GT. 400)GO TO 10
C--------DONT'T MOVE TO A STAR BASE
      IF(GALAXY(NI+1,NJ+1)-100*(GALAXY(NI+1,NJ+1)/100) .GE. 10)GOTO 10
C--------THEY ARE SMART ENOUGH TO AVOID SUPERNOVA
      IF(GALAXY(NI+1,NJ+1) .GT. 999)GO TO 10
C--------COMMANDERS STAY PUT
      DO 11 KK=1,REMCOM
      IF(CX(KK).EQ.I.AND.CY(KK).EQ.J.AND.GALAXY(I+1,J+1).LT.200)GO
     +TO 10
      IF(CX(KK) .EQ. 0)GO TO 13
   11 CONTINUE
   13 TEM(I,J)=TEM(I,J)-100
      TEM(NI,NJ)=TEM(NI,NJ)+100
      STARCH(I,J)=0
      IF(GALAXY(I+1,J+1)-100*(GALAXY(I+1,J+1)/100).GE.10)STARCH(I,J)=-1
      STARCH(NI,NJ)=0
   10 CONTINUE
      DO 21 I=1,8
      DO 21 J=1,8
   21 GALAXY(I+1,J+1)=TEM(I,J)
C--------IF NEW KLINGONS ENTER STARSHIP QUADRANT, DISPERSE AND ATTACK
      IF(KLHERE .EQ. GALAXY(QUADX+1,QUADY+1)/100)GO TO 100
C--------STARSHIP ALERTED
      OLDH=KLHERE+1
      KLHERE=GALAXY(QUADX+1,QUADY+1)/100
      IF(KLHERE .EQ. 0)GO TO 100
      CALL NEWCND
C--------POSITION KLINGONS FOR ATTACK
      DO 25 I=OLDH,KLHERE
20    KX(I)=RAN(0)*10.+1.
        IX=KX(I)
      KY(I)=RAN(0)*10.+1.
        IY=KY(I)
      IF(.NOT.COMPAR(QUAD(IX,IY),1,'.'))GO TO 20
      CALL ASSIGN(QUAD(IX,IY),4,'K   ')
C--------SORT KLINGONS BY DISTANCE FROM FEDERATION STARSHIP
      KDIST(I)=SQRT(FLOAT((SECTX-IX)**2 + (SECTY-IY)**2))
      IF(I .EQ. 1)GO TO 25
      IM1=I-1
      DO 24 J=1,IM1
      IF(KDIST(J) .LE. KDIST(I))GO TO 24
        TEMP=KDIST(I)
        ITEMP1=KX(I)
        ITEMP2=KY(I)
        LL=I
        MM=I+1
      DO 23 JJ=J,IM1
        LL=LL-1
        MM=MM-1
        KX(MM)=KX(LL)
        KY(MM)=KY(LL)
        KDIST(MM)=KDIST(LL)
23    CONTINUE
        KDIST(J)=TEMP
        KX(J)=ITEMP1
        KY(J)=ITEMP2
24    CONTINUE
25    KPOWER(I)=RAN(0)*50.+375.
      DO 28 L=1,KLHERE
 28   KAVGD(L)=KDIST(L)
  100 RETURN
      END
       SUBROUTINE NEWCND
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        IF (COMPAR(CONDIT,6,'ABSURD'))RETURN
      IF(COMPAR(CONDIT,6,'DOCKED').AND.MOVED.EQ.0.AND.BASEX.NE.0
     +  )RETURN
      CALL ASSIGN(CONDIT,8,'GREEN   ')
      IF(ENERGY .LT. 250) CALL ASSIGN(CONIT,8,'YELLOW  ')
      IF(GALAXY(QUADX+1,QUADY+1) .GT. 99)
     +     CALL ASSIGN(CONDIT,8,'RED     ')
      RETURN
      END
       SUBROUTINE NEWQUA
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      INTEGER QUADNM
        CONDIT=0
5     QUADNM=GALAXY(QUADX+1,QUADY+1)
      IF(QUADNM .GT. 999) GO TO 70
      KLHERE=0.01*QUADNM
      CALL NEWCND
C--------EMPTY QUADRANT AND POSITION STARSHIP
10    DO 15 I=1,10
      DO 15 J=1,10
15    CALL ASSIGN(QUAD(I,J),4,'.   ')
        CALL ASSIGN(QUAD(SECTX,SECTY),4,'E   ')
        IF (.NOT.COMPAR(SHIP(1),5,'ENTER'))
     +  CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
      QUADNM=GALAXY(QUADX+1,QUADY+1)
      IF(QUADNM .LT.100)GO TO 40
C--------POSITION ORDINARY KLINGON VESSELS
      QUADNM=QUADNM-100*KLHERE
      DO 25 I=1,KLHERE
20    KX(I)=RAN(0)*10.+1.
        IX=KX(I)
      KY(I)=RAN(0)*10.+1.
        IY=KY(I)
      IF(.NOT.COMPAR(QUAD(IX,IY),1,'.'))GO TO 20
      CALL ASSIGN(QUAD(IX,IY),4,'K   ')
C--------SORT KLINGONS BY DISTANCE FROM FEDERATION STARSHIP
      KDIST(I)=SQRT(FLOAT((SECTX-IX)**2 + (SECTY-IY)**2))
      IF(I .EQ. 1)GO TO 25
      IM1=I-1
      DO 24 J=1,IM1
      IF(KDIST(J) .LE. KDIST(I))GO TO 24
        TEMP=KDIST(I)
        ITEMP1=KX(I)
        ITEMP2=KY(I)
        LL=I
        MM=I+1
      DO 23 JJ=J,IM1
        LL=LL-1
        MM=MM-1
        KX(MM)=KX(LL)
        KY(MM)=KY(LL)
        KDIST(MM)=KDIST(LL)
23    CONTINUE
        KDIST(J)=TEMP
        KX(J)=ITEMP1
        KY(J)=ITEMP2
24    CONTINUE
25    KPOWER(I)=RAN(0)*50.+375.
      DO 28 L=1,KLHERE
 28   KAVGD(L)=KDIST(L)
C--------IF THIS QUADRANT NEEDS A COMMANDER, PROMOTE ONE KLINGON
      DO 30 I=1,REMCOM
      IF(CX(I) .EQ. QUADX .AND. CY(I) .EQ. QUADY)GO TO 35
      IF(CX(I).EQ. 0)GO TO 40
30    CONTINUE
      GO TO 40
35    CALL ASSIGN(QUAD(IX,IY),4,'C   ')
      DO 38 JJ=1,KLHERE
      IF(KX(JJ) .EQ. IX .AND. KY(JJ) .EQ. IY)GO TO 39
38    CONTINUE
      STOP1
39    KPOWER(JJ)=RAN(0)*100. +1150
C--------IF QUADRANT CONTAINS A STARBASE, CHOOSE ITS POSITION
40    IF(QUADNM .LT. 10)GO TO 50
      QUADNM =QUADNM - 10
45    BASEX=RAN(0)*10. +1.
      BASEY=RAN(0)*10. +1.
      IF(.NOT.COMPAR(QUAD(BASEX,BASEY),1,'.'))GO TO 45
      CALL ASSIGN(QUAD(BASEX,BASEY),4,'B   ')
        GO TO 51
C--------AND FINALLY, THE STARS
50      BASEX=0
        BASEY=0
51      IF(QUADNM .LT. 1)RETURN
      DO 60I=1,QUADNM
55    IX=RAN(0)*10. + 1.
      IY=RAN(0)* 10. +1.
      IF(.NOT.COMPAR(QUAD(IX,IY),1,'.'))GO TO 55
60    CALL ASSIGN(QUAD(IX,IY),4,'*   ')
      RETURN
70    DO 75 I=1,10
      DO 75 J=1,10
75    CALL ASSIGN(QUAD(I,J),4,'.   ')
      KLHERE=0
      NQX=QUADX
      NQY=QUADY
        PRINT 1000,(SHIP(KK),KK=1,3)
1000    FORMAT (' ***RED ALERT!  RED ALERT!',/' ***THE ',2A5,A3,
     1' HAS STOPPED IN A QUADRANT CONTAINING',/' A SUPERNOVA.')
      CALL AUTOVE
      IF(NQX.NE.QUADX .OR. NQY.NE.QUADY) GO TO 5
      CALL FINISH(8)
        IDIDIT=0
      RETURN
      END
       SUBROUTINE NOVCOU(ICX,ICY,DIREC,DIST)
C--------COMPUTE COURSE OF STARSHIP FROM PAIR OF COORDINATES
C--------SUCH AS (-2,1)
      IF(ICX)10,50,90
10    IF(ICY)20,30,40
20    DIREC=7.5
      RETURN
30    DIREC=6.0
      RETURN
40    DIREC=4.5
      RETURN
50    IF(ICY)60,70,80
60    DIREC=9.
      RETURN
70    DIREC=0
      DIST=0
      RETURN
80    DIREC=3.
      RETURN
90    IF(ICY)100,110,120
100   DIREC=10.5
      RETURN
110   DIREC=12.0
      RETURN
120   DIREC=1.5
      RETURN
      END
       SUBROUTINE PHASER
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,TEMP(3),RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IDIDIT=1
      IF(.NOT.COMPAR(CONDIT,8,'DOCKED  '))GO TO 5
      IDIDIT=0
        PRINT 1000
1000    FORMAT (' PHASERS CAN''T BE FIRED THROUGH BASE SHIELDS.')
      RETURN
5     IF(DAMAGE(3) .EQ. 0)GO TO 10
      IDIDIT=0
        PRINT 2000
2000    FORMAT (' PHASER CONTROL DAMAGED.')
      RETURN
10    IF(SHLDUP .EQ. 0)GO TO 20
      IDIDIT=0
        PRINT 3000
3000    FORMAT (' SHIELDS MUST BE DOWN TO FIRE PHASERS.')
      RETURN
20      T=ENERGY-.006
2005    CALL SCAN(POW,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 21
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 999
        GOTO 40
21      PRINT 4000,T
4000    FORMAT (' PHASERS LOCKED ON TARGET.  ENERGY AVAILABLE= ',F7.2)
      CALL PROMPT(14,'UNITS TO FIRE=')
        GOTO 2005
40    IF(POW .LT. ENERGY)GO TO 42
        PRINT 7000,T
7000    FORMAT (' ENERGY AVAILABLE= ',F7.2)
        IDIDIT=0
        RETURN
42    IF(POW .GT. 0)GO TO 43
      IDIDIT=0
      RETURN
43    ENERGY=ENERGY-POW
      IF(KLHERE .EQ. 0)GO TO 55
      KLHR2=KLHERE
      DO 50 I=1,KLHR2
      PHAEN=(KPOWER(1)/0.8**KDIST(1))/3
      IF(PHAEN .GT. POW)PHAEN=POW+.000001
      POW=POW-PHAEN
      DUSTFA=0.80+0.05*RAN(0)
      HIT=3*PHAEN*DUSTFA**KDIST(1)
      KPOWER(1)=KPOWER(1)-HIT
      II=KX(1)
      JJ=KY(1)
      CALL ASSIGN(TEMP,12,'            ')
        IF (COMPAR(QUAD(II,JJ),1,'C'))CALL ASSIGN(TEMP,9,'COMMANDER')
        IF (HIT.GT..005)GOTO 44
        PRINT 8000,TEMP,II,JJ
8000  FORMAT (' VERY SMALL HIT ON KLINGON ',2A4,A2,'AT SECTOR ',I2,' - '
     1,I2)
        GOTO 48
44      PRINT 9000,HIT,TEMP,II,JJ
9000    FORMAT (' ',F7.2,' UNIT HIT ON KLINGON ',2A4,A2,'AT SECTOR ',I2,
     1' - ',I2)
48      IF (POW.LE.0)GOTO 60
        IF (KPOWER(1).LE.0)GOTO 49
        PRINT 10000
10000   FORMAT (' ENERGY NOT GONE.')
        GOTO 50
49      CALL DEADKL(II,JJ)
50      CONTINUE
55      IF (POW.LE.0)RETURN
        PRINT 10500,POW
10500   FORMAT (' ',F6.2,' UNITS EXPENDED ON EMPTY SPACE.')
        IF (REMKL.EQ.0)CALL FINISH(1)
      RETURN
60    IF(KPOWER(1) .LT. 0)GO TO 70
        PRINT 11000,KPOWER(1)
11000   FORMAT (' ',F6.2,' UNITS LEFT.')
      RETURN
70      CALL DEADKL(II,JJ)
      IF(REMKL .EQ. 0) CALL FINISH(1)
      RETURN
999     PRINT 12000
12000   FORMAT (' WHAT WAS THAT AGAIN ?')
        IDIDIT=0
        RETURN
      END
       SUBROUTINE PHOTON
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      INTEGER BURST,HITS(100,2),BOT,TOP,TOP2
      DIMENSION ICOURS(2),XSEC(15),YSEC(15)
      IDIDIT=1
      IF(DAMAGE(4) .EQ. 0)GO TO 10
      IDIDIT=0
        PRINT 1000
1000    FORMAT (' PHOTON TUBES DAMAGED.')
      RETURN
10    IF(TORPS .GT.0)GO TO 15
        PRINT 2000
2000    FORMAT (' NO TORPEDOS LEFT.')
8      IDIDIT=0
      RETURN
15      CALL SCAN(COURSE,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 16
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 999
        GOTO 17
999     PRINT 20000
20000   FORMAT (' WHAT WAS THAT AGAIN ?')
        IDIDIT=0
        RETURN
16      CALL PROMPT(8,'COURSE: ')
        GOTO 15
17      IF (COURSE.GT.12..OR.COURSE.LT.0.)GOTO 8
        N=1
        SPRANG=0.0
        IF (TORPS.LT.3)GOTO 56
        CALL SCAN(ITEM,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 18
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 999
        IF (COMPAR(ITEM,1,'N'))GOTO 56
        IF (COMPAR(ITEM,1,'Y'))GOTO 1905
        GOTO 999
18      CALL PROMPT(8,'BURST ? ')
        CALL CHEW
19      IF (JA(DUMMY).EQ.0)GOTO 56
1905    CALL SCAN(SPRANG,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 20
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 999
        GOTO 25
20    CALL PROMPT(24,'BURST ANGLE (.05-.50) ? ')
        GOTO 1905
25      IF (SPRANG.LT..049.OR.SPRANG.GT..501)GOTO 8
        N=3
C---------BEGIN COURSE CALCULATIONS FOR TORPS.
56      IABORT=0
57    DO 110 I=1,N
      R=RAN(0)
      R=(R+RAN(0))*0.5-0.5
      IF(R .LT. -0.4 .OR. R .GT. 0.4)GO TO 120
      IF(SHLDUP.NE.0 .OR. COMPAR(CONDIT,6,'DOCKED')) R=R+0.001*SHIELD*R
      AC=COURSE+0.25*R
      IF(N .EQ. 1)GO TO  58
      ANGLE=((15.0-AC+(2-I)*SPRANG)*0.5235988)
      GO TO 59
58      ANGLE=((15.0-AC)*0.5235988)
59    DELTAX=-SIN(ANGLE)
      DELTAY=COS(ANGLE)
      X=SECTX
      Y=SECTY
      DO 100 L=1,15
      X=X+DELTAX
      IX=X+0.5
      IF(IX .LT. 1 .OR. IX .GT. 10)GO TO 105
      Y=Y+DELTAY
      IY=Y+0.5
      IF(IY .LT. 1 .OR. IY .GT. 10)GO TO 105
      IF(.NOT.COMPAR(QUAD(IX,IY),1,'.'))GO TO 60
        XSEC(L)=X
        YSEC(L)=Y
      GO TO 100
C--------BEGIN HIT CHECKS
60      LLL=1
6005    LL=1
        IF (L.EQ.1)GOTO (6405,106),LLL
        IF (N.EQ.1)PRINT 7000
7000    FORMAT (' TORPEDO TRACK :')
        IF (N.NE.1)PRINT 7980,I
7980    FORMAT (' TRACK FOR TORPEDO NUMBER ',I1,' :')
        IF (L.GT.5)GOTO 61
      LTEMP=L-1
        PRINT 7100,(XSEC(II),YSEC(II),II=1,LTEMP)
7100    FORMAT (' ',5(' ',F4.1,' - ',F4.1))
        GOTO 64
61      PRINT 7100,(XSEC(II),YSEC(II),II=1,5)
        IF (L.GT.10)GOTO 62
        IF (L.EQ.6)GOTO (6405,106),LLL
      LTEMP=L-1
        PRINT 7100,(XSEC(II),YSEC(II),II=6,LTEMP)
        GOTO 64
62      PRINT 7100,(XSEC(II),YSEC(II),II=6,10)
        IF (L.EQ.11)GOTO (6405,106),LLL
      LTEMP=L-1
        PRINT 7100,(XSEC(II),YSEC(II),II=11,LTEMP)
64      PRINT 7127
7127    FORMAT (' ')
        GOTO (6405,106),LLL
6405    IF(.NOT.COMPAR(QUAD(IX,IY),1,'C'))GO TO 65
C--------COMMANDER HIT
      CALL DEADKL(IX,IY)
      GO TO 110
65    IF(.NOT.COMPAR(QUAD(IX,IY),1,'K'))GO TO 70
C--------ORDINARY KLINGON HIT
      CALL DEADKL(IX,IY)
      GO TO 110
70    IF(.NOT.COMPAR(QUAD(IX,IY),1,'B'))GO TO 75
C--------STARBASE HIT
      CALL ASSIGN(QUAD(IX,IY),4,'.   ')
        MAXLOP=REMBAS
        DO 74 LLLL=1,MAXLOP
        IF (BASEQX(LLLL).NE.QUADX.OR.BASEQY(LLLL).NE.QUADY)GOTO 74
        BASEQX(LLLL)=BASEQX(REMBAS)
        BASEQY(LLLL)=BASEQY(REMBAS)
        BASEQX(REMBAS)=0
        BASEQY(REMBAS)=0
        BASEX=0
        BASEY=0
        REMBAS=REMBAS-1
74      CONTINUE
      GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)-10
        PRINT 7200
7200    FORMAT (' ***STARBASE DESTROYED...CONGRATULATIONS!')
      CALL NEWCND
      GO TO 110
75    IF(.NOT.COMPAR(QUAD(IX,IY),1,'*'))STOP1
C--------STAR HIT - CHECK FOR NOVA RESULTS
      IF(RAN(0) .GE. .05)GO TO 76
      CALL SNOVA(IX,IY)
      RETURN
76    CALL ASSIGN(QUAD(IX,IY),4,'.   ')
        PRINT 7300,IX,IY
7300    FORMAT (' ***STAR AT SECTOR ',I2,' - ',I2,' NOVAS.')
        IF(.NOT.COMPAR(CONDIT,6,'ABSURD'))GALAXY(QUADX+1,QUADY+1)=
     + GALAXY(QUADX+1,QUADY+1)-1
        TOP2=1
        TOP=1
        BOT=1
        KOUNT=0
        ICOURS(1)=0
        ICOURS(2)=0
      HITS(BOT,1)=IX
      HITS(BOT,2)=IY
78    DO 90 MM=BOT,TOP
      DO 90 NN=1,3
      DO 90 J=1,3
      IF((J*NN) .EQ. 4)GO TO 90
      II=HITS(MM,1)+NN-2
      JJ=HITS(MM,2)+J-2
      IF(II .LT. 1 .OR. II .GT. 10)GO TO 90
      IF(JJ .LT. 1 .OR. JJ .GT. 10)GO TO 90
      IF(COMPAR(QUAD(II,JJ),1,'.'))GO TO 90
C--------ANOTHER STAR AFFECTED BY A NOVA
      IF(.NOT.COMPAR(QUAD(II,JJ),1,'*'))GO TO 80
      IF(RAN(0) .GE. .05)GO TO 79
      CALL SNOVA(II,JJ)
      RETURN
79    TOP2=TOP2+1
      HITS(TOP2,1)=II
      HITS(TOP2,2)=JJ
        IF(.NOT.COMPAR(CONDIT,6,'ABSURD'))GALAXY(QUADX+1,QUADY+1)=
     +                   GALAXY(QUADX+1,QUADY+1)-1
        PRINT 7300,II,JJ
      GO TO 89
80    IF(.NOT.COMPAR(QUAD(II,JJ),1,'B'))GO TO 82
C----------NOVA DESTROYS STARBASE
        PRINT 7400,II,JJ
7400    FORMAT (' ***STARBASE AT SECTOR ',I2,' - ',I2,' DESTROYED.')
      GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)-10
      CALL NEWCND
        BASEX=0
        BASEY=0
      GO TO 89
82    IF(.NOT.(COMPAR(QUAD(II,JJ),1,'E').OR.COMPAR(QUAD(II,JJ),1,'F')))
     + GO TO 87
C----------STARSHIP IN A NOVA
        PRINT 7500
7500    FORMAT (' ***STARSHIP BUFFETED BY NOVA.')
      IF(SHLDUP.GT.0)GO TO 83
C-------SHIELDS NOT UP - TAKE ENERGY FROM SHIP ENERGY
      ENERGY=ENERGY-2000
      GO TO 84
83    IF(SHIELD .GE. 2000)GO TO 85
C-------SHIELDS UP - CHECK FOR ENOUGH ENERGY
      DIFF=2000-SHIELD
      ENERGY=ENERGY-DIFF
      SHIELD=0.0
      SHLDUP=0
        PRINT 7600
7600    FORMAT (' ***SHIELDS KNOCKED OUT.')
      DAMAGE(8)=RAN(0)*DIFF*0.0005
C-------CHECK IF STARSHIP SURVIVED NOVA
84    IF(ENERGY .GT. 0)GO TO 86
      CALL FINISH(7)
      RETURN
85    SHIELD=SHIELD-2000.
C--------ADD IN COURSE NOVA CONTRIBUTES TO KICKING STARSHIP
86    ICOURS(1)=ICOURS(1)+IX-II
      ICOURS(2)=ICOURS(2)+IY-JJ
      KOUNT=KOUNT+1
      GO TO 90
C---------KLINGON IN PATH OF NOVA
87    IF(.NOT.COMPAR(QUAD(II,JJ),1,'K'))GO TO 88
      CALL DEADKL(II,JJ)
      GO TO 90
88    IF(.NOT.COMPAR(QUAD(II,JJ),1,'C'))STOP7
C-------COMMANDER IN NOVA
      CALL DEADKL(II,JJ)
      GO TO 90
89    CALL ASSIGN(QUAD(II,JJ),4,'.   ')
90    CONTINUE
C--------IF MORE STARS AFFECTED BY NOVA GO FIND WHAT THEY GOT
      IF(TOP .EQ. TOP2)GO TO 93
      BOT=TOP+1
      TOP=TOP2
      GO TO 78
93    IF(KOUNT .EQ. 0)GO TO 110
C--------STARSHIP AFFECTED BY NOVA - KICK IT AWAY.
      DIST=KOUNT*.1
      CALL NOVCOU(ICOURS(1),ICOURS(2),DIREC,DIST)
      IF(DIST .EQ. 0)GO TO 110
        PRINT 7700
7700    FORMAT (' FORCE OF NOVA DISPLACES STARSHIP.')
      CALL MOVE
      GO TO 110
100   CONTINUE
      STOP2
105     LLL=2
        GOTO 6005
106     PRINT 7800
7800    FORMAT (' TORPEDO MISSED.')
        IF (IABORT.NE.0)GOTO 111
110   CONTINUE
111      IF(.NOT.COMPAR(CONDIT,6,'DOCKED')) TORPS=TORPS-N
      IF(REMKL .EQ. 0) CALL FINISH(1)
      RETURN
C--------MISFIRES
120   IF(N .EQ. 3) GO TO 130
        PRINT 3012
3012    FORMAT (' TORPEDO MISFIRES.')
      AC=1.3*AC
        IABORT=1
      GO TO 58
130     PRINT 3013,I
3013    FORMAT (' TORPEDO NUMBER ',I1,' MISFIRES.')
      IF(I .LT. 3) PRINT 3014
3014    FORMAT (' REMAINDER OF BURST ABORTED.')
      AC=1.3*AC
        N=I
      I=3
        IABORT=1
      GO TO 58
      END
       SUBROUTINE RAM
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD,TEMP(3)
      CALL ASSIGN(TEMP,12,'            ')
      IF(COMPAR(QUAD(SECTX,SECTY),1,'C'))CALL ASSIGN(TEMP,9,'COMMANDER')
        PRINT 1000,(SHIP(I),I=1,3),TEMP,SECTX,SECTY
1000    FORMAT (' ***RED ALERT! RED ALERT!'/' ***COLLISION IMMINENT.'
     1/,' ',2A5,A3,' RAMS KLINGON ',2A4,A2,'AT SECTOR ',I2,' - ',I2)
      CALL DEADKL(SECTX,SECTY)
        PRINT 2000,(SHIP(I),I=1,3)
2000    FORMAT (' ',2A5,A3,' HEAVILY DAMAGED.')
      DO 10 L=1,10
      IF(DAMAGE(L) .LT. 0) GO TO 10
      DAMAGE(L)=DAMAGE(L)+TIME+RAN(0)+0.5
 10   CONTINUE
      DAMAGE(6)=DAMAGE(6)-0.5
      SHLDUP=0
      IF(REMKL .EQ. 0) CALL FINISH(1)
      RETURN
      END
       SUBROUTINE RETRT
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C---------DON'T FORSAKE COMMANDER
      DO 11 KK=1,REMCOM
      IF(CX(KK) .EQ. QUADX .AND. CY(KK) .EQ. QUADY)RETURN
      IF(CX(KK) .EQ. 0) GO TO 13
   11 CONTINUE
C--------RANDOM RETREAT FROM ATTACKED AREA
   13 IF(RAN(0) .GT. 0.23*SKILL)RETURN
C--------NO KLINGONS TO RETREAT
        IF(KLHERE .EQ. 0 .OR. GALAXY(QUADX+1,QUADY+1) .GT. 999)RETURN
      N=KLHERE
      DO 10 J=1,N
C--------RANDOM NUMBER RETREATS
      IF(RAN(0) .GT. 0.20*SKILL)GO TO 10
C--------RETREAT TO A RANDOM ADJACENT QUADRANT
      DO 15 KK =1,18
      NI=RAN(0)*3.-1.
      NJ=RAN(0)*3.-1.
C--------DON'T CROSS GALAXY BOUNDARY
      NI=NI+QUADX
      NJ=NJ+QUADY
      IF(NI .LT. 1 .OR. NJ .LT. 1 .OR. NJ .GT. 8 .OR. NI .GT. 8)GO TO 15
C--------DON'T MOVE TO A STAR BASE
      IF(GALAXY(NI+1,NJ+1)-100*(GALAXY(NI+1,NJ+1)/100).GE.10)GO TO 15
C--------DON'T STAY WHERE YOU ARE!
      IF(QUADX .EQ. NI .AND. QUADY .EQ. NJ)GO TO 15
C--------DON'T MOVE TO A SUPERNOVA
      IF(GALAXY(NI+1,NJ+1) .GT. 999)GO TO 15
C--------DON'T OVERCROWD
      IF(GALAXY(NI+1,NJ+1) .GT. 800)GO TO 15
C--------RETREAT
      GO TO 12
   15 CONTINUE
      GO TO 10
12    GALAXY(QUADX+1,QUADY+1)=GALAXY(QUADX+1,QUADY+1)-100
      GALAXY(NI+1,NJ+1)=GALAXY(NI+1,NJ+1)+100
      STARCH(NI,NJ)=0
      IX=KX(KLHERE)
      IY=KY(KLHERE)
      KDIST(KLHERE)=0
      KPOWER(KLHERE)=0
      KAVGD(KLHERE)=0
      CALL ASSIGN(QUAD(IX,IY),4,'.   ')
      KX(KLHERE)=0
      KY(KLHERE)=0
      KLHERE=KLHERE-1
      PRINT 9000,IX,IY
9000  FORMAT(' KLINGON AT', I3,' -',I3, ' RETREATS')
   10 CONTINUE
      CALL NEWCND
      RETURN
      END
      FUNCTION DAMP(X)
      DAMP=0.
      IF(X .GT. 0.)DAMP=1.
      RETURN
      END
      SUBROUTINE SCAN(AITEM,KEY)
      LOGICAL COMPAR,PERSEN
      DOUBLE PRECISION SHIP(3)
C THIS SUBROUTINE RETURNS THE NEXT ITEM TYPED ON THE CURRENT LINE.
C ITEMS ARE DELIMITED BY SPACES OR TABS OR, IN THE CASE OF NUMBERS,
C BY COMMAS.  KEY WILL HOLD AN ASCII KEYWORD DESCRIBING THE TYPE
C OF ITEM. CHOICES ARE:
C       'ALPH'=ALPHABETIC (FIRST 4 CHARACTERS ARE RETURNED)
C       'NUMR'=NUMERIC (ALWAYS A REAL NUMBER, WHETHER OR NOT A REAL
C                        NUMBER WAS TYPED.)
C       'EOL'=END OF LINE
C       'OTHR'=SOME OTHER CHARACTER. AITEM=CHARACTER
        INTEGER DIVFLA,ALPHA(4),COUNT,CHAR
      INTEGER $0/'0'/,$9/'9'/,$A/'A'/,$Z/'Z'/
        EQUIVALENCE (AITEM1,ITEM)
        AITEM=0
        PERSEN=.FALSE.
        MOD=1
        DIVFLA=0
        SIGN=1
10      CALL INPUT(CHAR)
      IF(COMPAR(CHAR,1,' ')) GO TO 10
        IF (CHAR.GE.$0.AND.CHAR.LE.$9)GOTO 20
        IF (COMPAR(CHAR,1,'.'))GOTO 25
        IF (CHAR.GE.$A.AND.CHAR.LE.$Z)GOTO 30
        IF (COMPAR(CHAR,1,'-'))GOTO 27
      IF (COMPAR(CHAR,1,';')) GO TO 40
C IF IT COMES HERE, AN UNIDENTIFIABLE CHARACTER.
15      CALL ASSIGN(KEY,4,'OTHR')
        ITEM=CHAR
        AITEM=AITEM1
        RETURN
C NUMERALS COME HERE.
20      CALL ASSIGN(KEY,4,'NUMR')
21      CALL DECODE(NUM,1,CHAR)
        AITEM=AITEM*(10.**MOD)+FLOAT(NUM)/(10.**DIVFLA)
        IF (DIVFLA.NE.0)DIVFLA=DIVFLA+1
22      CALL INPUT(CHAR)
      IF(COMPAR(CHAR,1,' ')) GO TO 26
        IF (COMPAR(CHAR,1,'.'))GOTO 25
      IF (COMPAR(CHAR,1,';')) GOTO 99
        IF (CHAR.GE.$0.AND.CHAR.LE.$9)GOTO 21
        GOTO 15
25      IF (PERSEN)GOTO 15
        PERSEN=.TRUE.
      CALL ASSIGN(KEY,4,'NUMR')
        MOD=0
        DIVFLA=1
        GOTO 22
26      AITEM=AITEM*SIGN
   99 CALL BACKUP
        RETURN
27      SIGN=-SIGN
28      CALL INPUT(CHAR)
        IF (CHAR.GE.$0.AND.CHAR.LE.$9)GOTO 20
        GOTO 15
30      CALL ASSIGN(ALPHA(2),12,'            ')
        ALPHA(1)=CHAR
        COUNT=1
32      CALL INPUT(CHAR)
        IF (COMPAR(CHAR,1,' ').OR.COMPAR(CHAR,1,';')) GO TO 35
        IF (CHAR.LT.$A.OR.CHAR.GT.$Z)GOTO 15
        COUNT=COUNT+1
        IF (COUNT.GT.4)GOTO 32
        ALPHA(COUNT)=CHAR
        GOTO 32
35      CALL SQUISH(AITEM,ALPHA(1),ALPHA(2),ALPHA(3),ALPHA(4))
        CALL ASSIGN(KEY,4,'ALPH')
      CALL BACKUP
        RETURN
40      CALL ASSIGN(KEY,4,'EOL ')
        RETURN
        END
       SUBROUTINE SCORE(I)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        DDATE=DATE-INDATE
        RATING=1000*KILLS
        IF (DDATE.EQ.0)GOTO 1011
        RATING=(250*KILLS)/DDATE
1011    IF (COMPAR(SHIP(1),5,'FAERI'))RATING=RATING-400
        IF (I .LT. 0)RETURN
        PRINT 1000,KILLS,DDATE
1000    FORMAT (' ',I2,' KLINGONS IN ',F4.2,' STAR DATES.')
      ITEMP=I+1
        GOTO (10,10,40,20,20,30,30,30,30,40,50,60,70),ITEMP
10      PRINT 2000,RATING
2000    FORMAT (' RATING=',I8)
        RETURN
20      RATING=RATING-400
        PRINT 3000,(SHIP(II),II=1,3),RATING
3000    FORMAT (' ',2A5,A3,' LOST. POSTHUMOUS RATING= ',I6)
        RETURN
30      RATING=RATING-800
        PRINT 4000,(SHIP(II),II=1,3),RATING
4000    FORMAT (' ',2A5,A3,' DESTROYED. POSTHUMOUS RATING= ',I6)
        RETURN
40      RATING=RATING-1600
        PRINT 5000,(SHIP(II),II=1,3),RATING
5000    FORMAT (' ',2A5,A3,' CAPTURED. POSTHUMOUS RATING= ',I6)
        RETURN
50      RATING=RATING+200
        GOTO 20
60      RATING=RATING-3200
        PRINT 6000,SHIP,RATING
6000    FORMAT(' ',2A5,A3,'OBLITERATED BY YOUR OWN DEATH RAY, ',
     1'POSTHUMOUS RATING= ',I6)
        RETURN
70      RATING=RATING-6400
        PRINT 7000,SHIP,RATING
      RETURN
7000    FORMAT(' ',2A5,A3,'GALAXY DESTROYED BY DEATH RAY, ',
     1'POSTHUMOUS RATING= ',I6)
        END
       SUBROUTINE SETUP
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      REAL LENFAC
      ALLDON=0
C--------DECIDE HOW MANY OF EVERYTHING
      CALL CHOOSE
C--------PREPARE THE ENTERPRISE
        CALL ASSIGN(SHIP(1),24,'ENTER   PRISE           ')
      ENERGY=5000.
        INSHLD=3000.0
        SHIELD=3000.0
      SHLDUP = 0
      IDATE = (RAN(0) * 31. +20.)
        DATE=100*IDATE
        INDATE=DATE
      LSUPRE = 1.0
      TWARP = 0.0
      QUADX = RAN(0) * 8. +1.
      QUADY = RAN(0) * 8.+ 1.
      SECTX = RAN(0) *10. +1.
      SECTY = RAN(0) *10. +1.
      TORPS=10
      KILLS=0
      NKINKS=0
      WARPFA=3.0
      WFACSQ=9.0
      DO 3 I=1,12
3     DAMAGE(I)=0.0
      DO 4 I=1,8
      DO 4 J=1,8
 4    STARCH(I,J)=0
C--------PUT STARS IN THE GALAXY
      INSTAR=0
      DO 5 I=1,8
      DO 5 J=1,8
      K = RAN(0) * 9 + 1
      INSTAR=INSTAR+K
5     GALAXY(I+1,J+1)=K
C-------LOCATE STARBASES IN THE GALAXY
      DO 8 I=1, INBASE
7     IX=RAN(0)*8.+1.
      IY=RAN(0)*8.+1.
      IF(GALAXY(IX+1,IY+1) .GT. 10)GO TO 7
      BASEQX(I)=IX
      BASEQY(I)=IY
      STARCH(IX,IY)=-1
8     GALAXY(IX+1,IY+1)=GALAXY(IX+1,IY+1)+10
C--------POSITION ORDINARY KLINGON BATTLE CRUISERS
      CLUMPR = 0.4 + 0.1 * SKILL
      IKLTMP=INKLIN-INCOM
      DO 15 I=1,IKLTMP
12    IX=RAN(0)*8.+1.
      IY=RAN(0)*8.+1.
      IF(GALAXY(IX+1,IY+1) .GT. 899)GO TO 12
      IF(GALAXY(IX+1,IY+1).LT. 100.AND.RAN(0) .LT. CLUMPR)GOTO 12
15    GALAXY(IX+1,IY+1)=GALAXY(IX+1,IY+1)+100
C--------POSITION KLINGON COMMAND SHIPS
      DO 18 I=1,INCOM
16    IX=RAN(0)*8.+1.
      IY=RAN(0)*8.+1.
      IF(GALAXY(IX+1,IY+1) .GT. 899)GO TO 16
      IF(I .EQ. 1)GO TO 17
      IM1=I-1
      DO 1605 JJ=I,IM1
      IF(CX(JJ) .EQ. IX .AND. CY(JJ) .EQ. IY)GO TO 16
1605  CONTINUE
17    GALAXY(IX+1,IY+1)=GALAXY(IX+1,IY+1)+100
      CX(I)=IX
18    CY(I)=IY
      CALL NEWQUA
      IDATE = DATE
C--------INITIALIZE TIMES FOR EXTRANEOUS EVENTS
      LENFAC=(LEN+1.0)/2.0
      FUTURE(1)=DATE+LENFAC*RAN(0)
      FUTURE(2)=DATE+(0.1+(9.0*RAN(0))/INCOM)*LENFAC
        FUTURE(3)=DATE+(0.2+(9.0*RAN(0))/(INBASE*SKILL))*LENFAC
        FUTURE(4)=DATE+(0.15+(9.0*RAN(0))/(INBASE*SKILL))*LENFAC
      NEVENT=4
C--------IF PLAYER IS A NOVICE, PRINT FULL INITIAL MESSAGE
         IF(SKILL .NE. 1)GO TO 20
        PRINT 1000,IDATE,INKLIN,INTIME,INBASE,QUADX,QUADY,SECTX,SECTY
1000    FORMAT (' IT IS STARDATE ',I4,'.  THE FEDERATION IS BEING ',
     1'ATTACKED BY'/' A DEADLY KLINGON INVASION FORCE.  AS COMMAN',
     1'DER OF THE UNITED STARSHIP'/' ENTERPRISE, IT IS YOUR MISSION ',
     1'TO DESTROY THIS INVASION FORCE OF'/,I3,' BATTLE CRUISERS. ',
     1' YOU HAVE ',F5.2,' STARDATES TO COMPLETE YOUR MISSION.'/
     1' AS YOU PROCEED, YOU MAY BE GIVEN MORE TIME.'/' YOU ',
     1'WILL HAVE ',I1,' SUPPORTING STARBASE(S).'/' THE ENTERPRISE ',
     1'IS CURRENTLY IN QUADRANT ',I2,' - ',I2,' SECTOR ',I2,' - ',
     1I2)
      GO TO 30
C--------IF PLAYER IS NOT A NOVICE, PRINT BRIEF INITIAL MESSAGE
20      PRINT 2000,IDATE,INKLIN,INTIME,QUADX,QUADY,SECTX,SECTY,INBASE
2000    FORMAT (' STARDATE: ',I4,/' NUMBER OF KLINGONS: ',I3,/' NUMBER',
     1' OF STARDATES: ',F5.2,/' ENTERPRISE LOCATION: ',I2,' - ',I2,
     1' , ',I2,' - ',I2,/' STARBASES: ',I1)
30      PRINT 3000
3000    FORMAT (' STARBASE LOCATIONS: ')
        PRINT 4000,(BASEQX(I),BASEQY(I),I=1,INBASE)
4000    FORMAT (5(' ',I2,' - ',I2,' '))
        PRINT 5000
5000    FORMAT (' ')
      RETURN
      END
       SUBROUTINE SETWRP
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IDIDIT=0
        CALL SCAN(AITEM,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 20
        IF (COMPAR(KEY,4,'NUMR'))GOTO 30
        PRINT 7000
7000    FORMAT (' WHAT WAS THAT AGAIN ?')
        RETURN
20    CALL PROMPT(13,'WARP FACTOR: ')
      CALL SCAN(AITEM,KEY)
      IF(COMPAR(KEY,4,'NUMR')) GO TO 30
      PRINT 1500
1500  FORMAT(' ENTER A NUMERICAL VALUE.')
      CALL CHEW
      GO TO 20
 30   IF(AITEM .LT. 1.0) GO TO 50
      IF(AITEM .GT. 10.0) GO TO 60
      OLDFAC=WARPFA
      WARPFA=AITEM
      WFACSQ=WARPFA*WARPFA
      IDIDIT=1
C--------GIVE WARNING MESSAGES FOR WARP FACTORS ABOVE WARP 6
      IF(WARPFA .LE. OLDFAC .OR. WARPFA .LE. 6.0) RETURN
      IF(WARPFA .GE. 8.00) GO TO 33
        PRINT 2000
2000    FORMAT (' ENGINEER SCOTT: "AYE, SIR, BUT OUR MAXIMUM SAFE ',
     1'SPEED IS WARP 6."')
      RETURN
 33   IF(WARPFA .EQ. 10.0) GO TO 36
        PRINT 3000
3000    FORMAT (' ENGINEER SCOTT: "AYE, SIR, BUT OUR ENGINES MAY NOT ',
     1'TAKE IT."')
      RETURN
36      PRINT 4000
4000    FORMAT (' ENGINEER SCOTT: "AYE, SIR, WE''LL TRY IT."')
      RETURN
C--------GIVE REFUSAL MESSAGES FOR BAD WARP COMMANDS
50      PRINT 5000
5000    FORMAT (' HELMSMAN SULU: "WE CAN''T GO BELOW WARP 1, SIR."')
      RETURN
60      PRINT 6000
6000    FORMAT (' HELMSMAN SULU: "OUR TOP SPEED IS WARP 10, SIR."')
      RETURN
      END
       SUBROUTINE SHLDS(ITEM)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(DAMAGE(8).NE.0) GO TO 60
        IF (COMPAR(ITEM,1,'D'))GOTO 50
C--------RAISE SHIELDS
 40   IF(SHLDUP.NE.0) GO TO 45
      SHLDUP=1
      IF(.NOT.COMPAR(CONDIT,6,'DOCKED')) ENERGY=ENERGY-50.0
        IF (ENERGY.LE.0)GOTO 70
        PRINT 1000
1000    FORMAT (' SHIELDS RAISED.')
      IDIDIT=1
      RETURN
45      PRINT 2000
2000    FORMAT (' SHIELDS ALREADY UP.')
      IDIDIT=0
      RETURN
C--------LOWER SHIELDS
 50   IF(SHLDUP .EQ. 0) GO TO 55
      SHLDUP=0
        PRINT 3000
3000    FORMAT (' SHIELDS LOWERED.')
      IDIDIT=1
      RETURN
55      PRINT 4000
4000    FORMAT (' SHIELDS ALREADY DOWN.')
      IDIDIT=0
      RETURN
C--------SHIELD DAMAGE
60      PRINT 5000
5000    FORMAT (' SHIELDS DAMAGED AND DOWN.')
      IDIDIT=0
      RETURN
C--------ENERGY TOTALLY DEPLETED
70      PRINT 6000
6000    FORMAT (' SHIELDS USE UP LAST OF ENERGY.')
      CALL FINISH(4)
      RETURN
      END
       SUBROUTINE SNOVA(NSX,NSY)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
C--------IF SCHEDULED SUPERNOVA (NSX=NSY=0), SELECT STAR
      IF(NSX.NE.0) GO TO 50
      NUM=RAN(0)*INSTAR+1
      DO 10 NQX=1,8
      DO 10 NQY=1,8
      NUM=NUM-MOD(GALAXY(NQX+1,NQY+1),10)
      IF(NUM .LE. 0) GO TO 20
 10   CONTINUE
C--------IF STAR IS ALREADY GONE, RETURN EMPTY-HANDED
      RETURN
C--------IF STARSHIP IS IN THIS QUADRANT, CHOOSE STAR EXACTLY
 20   IF(NQX.NE.QUADX .OR. NQY.NE.QUADY) GO TO 70
      NUM=RAN(0)*MOD(GALAXY(NQX+1,NQY+1),10)+1
      DO 30 NSX=1,10
      DO 30 NSY=1,10
      IF(.NOT.COMPAR(QUAD(NSX,NSY),1,'*')) GO TO 30
      NUM=NUM-1
      IF(NUM .EQ. 0) GO TO 50
 30   CONTINUE
      STOP 6661
C--------IF TRIGGERED SUPERNOVA, UNPACK SECTOR COORDINATES
C--------PRINT RED ALERT (INCIPIENT SUPERNOVA) MESSAGE
50      PRINT 1000,NSX,NSY
1000    FORMAT (' ***RED ALERT! RED ALERT!'/' ***INCIPIENT SUPERNOVA ',
     1'DETECTED AT SECTOR ',I2,' - ',I2,'.')
C--------SUPERNOVA TOO NEAR STARSHIP ENDS GAME
      DSQ=(NSX-SECTX)**2 + (NSY-SECTY)**2
      IF(RAN(0) .GT. 1.0/DSQ) GO TO 60
        PRINT 2000
2000    FORMAT (' EMERGENCY AUTOMATIC OVERRIDE ATTEMPTS T*************',
     1/' ****************************************************')
      ALLDON=1
      NQX=QUADX
      NQY=QUADY
      GO TO 80
C--------SUPERNOVA NOT IMMEDIATELY ADJACENT! EMERGENCY OVERRIDE
 60   NQX=QUADX
      NQY=QUADY
      CALL AUTOVE
      IF(NQX .EQ. QUADX .AND. NQY .EQ. QUADY) ALLDON=1
      GO TO 80
C--------IF STARSHIP NOT IN SAME QUADRANT, JUST GET A MESSAGE
70      PRINT 3000,DATE,NQX,NQY
3000    FORMAT (' MESSAGE FROM STARFLEET COMMAND     STARDATE ',F7.2,
     1/'     SUPERNOVA IN QUADRANT ',I2,' - ',I2,'!  CAUTION ADVIS',
     1'ED.')
C--------DESTROY ANY KLINGONS IN SUPERNOVAED QUADRANT
 80   NUM=GALAXY(NQX+1,NQY+1)
      KLDEAD=NUM/100
      IF(KLDEAD .EQ. 0) GO TO 100
        PRINT 85,KLDEAD,NQX,NQY
85      FORMAT(' ',I1,' KLINGONS DESTROYED BY SUPERNOVA ',
     1/,' IN QUADRANT ',I2,' - ',I2)
      REMKL=REMKL-KLDEAD
      IF(REMCOM .EQ. 0) GO TO 100
      MAXLOP=REMCOM
      DO 90 L=1,MAXLOP
      IF(CX(L).NE.NQX .OR. CY(L).NE.NQY) GO TO 90
        PRINT 87
87      FORMAT (' INCLUDING ONE COMMANDER')
      CX(L)=CX(REMCOM)
      CY(L)=CY(REMCOM)
        CX(REMCOM)=0
        CY(REMCOM)=0
      REMCOM=REMCOM-1
 90   CONTINUE
C--------DESTROY ANY BASE IN SUPERNOVAED QUADRANT
 100  IF(REMBAS .EQ. 0) GO TO 120
      MAXLOP=REMBAS
      DO 110 L=1,MAXLOP
      IF(BASEQX(L).NE.NQX .OR. BASEQY(L).NE.NQY) GO TO 110
        PRINT 105
105     FORMAT (' *** STARBASE DESTROYED BY SUPERNOVA')
      BASEQX(L)=BASEQX(REMBAS)
      BASEQY(L)=BASEQY(REMBAS)
        BASEQX(REMBAS)=0
        BASEQY(REMBAS)=0
        BASEX=0
        BASEY=0
      REMBAS=REMBAS-1
 110  CONTINUE
C--------MARK SUPERNOVA IN GALAXY AND IN STAR CHART
 120  GALAXY(NQX+1,NQY+1)=1000
      STARCH(NQX,NQY)=1
      IF(ALLDON.NE.0) CALL FINISH(8)
      RETURN
      END
       SUBROUTINE SORTKL
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      INTEGER SWITCH
      IF(KLHERE .LE.1)RETURN
      MINUS1=KLHERE-1
 10   SWITCH=0
      DO 20 J=1,MINUS1
      IF(KDIST(J) .LE. KDIST(J+1)) GO TO 20
        T=KDIST(J)
        KDIST(J)=KDIST(J+1)
        KDIST(J+1)=T
        T=KAVGD(J)
        KAVGD(J)=KAVGD(J+1)
        KAVGD(J+1)=T
        K=KX(J)
        KX(J)=KX(J+1)
        KX(J+1)=K
        K=KY(J)
        KY(J)=KY(J+1)
        KY(J+1)=K
        T=KPOWER(J)
        KPOWER(J)=KPOWER(J+1)
        KPOWER(J+1)=T
      SWITCH=1
 20   CONTINUE
      IF(SWITCH.NE.0) GO TO 10
      RETURN
      END
       SUBROUTINE SRSCAN
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IF(DAMAGE(1) .NE. 0) GO TO 160
      STARCH(QUADX,QUADY)=1
      DO 150 I=1,10
      GO TO (10,20,30,40,50,60,70,80,90,100), I
10      PRINT 1000,(QUAD(1,J),J=1,10),DATE
1000    FORMAT (' ',10(A1,' '),'  STARDATE       ',F6.1)
      GO TO 150
 20   CALL NEWCND
        PRINT 2000,(QUAD(2,J),J=1,10),CONDIT
2000    FORMAT (' ',10(A1,' '),'  CONDITION      ',A10)
      GO TO 150
30      PRINT 3000,(QUAD(3,J),J=1,10),QUADX,QUADY,SECTX,SECTY
3000    FORMAT (' ',10(A1,' '),'  POSITION       ',I2,' - ',I2,' , ',
     1I2,' - ',I2)
      GO TO 150
40      IF (DAMAGE(5).NE.0)GOTO 44
        PRINT 4000,(QUAD(4,J),J=1,10)
4000    FORMAT (' ',10(A1,' '),'  LIFE SUPPORT   ACTIVE')
        GOTO 150
44      IF (.NOT.COMPAR(CONDIT,6,'DOCKED'))GOTO 45
        PRINT 4100,(QUAD(4,J),J=1,10)
4100    FORMAT (' ',10(A1,' '),'  LIFE SUPPORT   DAMAGED, SUPPORTED ',
     1'BY STARBASE')
        GOTO 150
45      PRINT 4200,(QUAD(4,J),J=1,10),LSUPRE
4200    FORMAT (' ',10(A1,' '),'  LIFE SUPPORT   DAMAGED, RESERVES='
     1,F4.2)
      GO TO 150
50      PRINT 5000,(QUAD(5,J),J=1,10),WARPFA
5000    FORMAT (' ',10(A1,' '),'  WARP FACTOR    ',F4.1)
      GO TO 150
60      PRINT 6000,(QUAD(6,J),J=1,10),ENERGY
6000    FORMAT (' ',10(A1,' '),'  ENERGY         ',F7.2)
      GO TO 150
70      PRINT 7000,(QUAD(7,J),J=1,10),TORPS
7000    FORMAT (' ',10(A1,' '),'  TORPEDOES      ',I2)
      GO TO 150
80      CALL ASSIGN(TEMP,4,'DOWN')
        IF (SHLDUP.NE.0)CALL ASSIGN(TEMP,4,'UP, ')
        JJ=100.00*SHIELD/INSHLD
        PRINT 8000,(QUAD(8,J),J=1,10),TEMP,JJ
8000    FORMAT (' ',10(A1,' '),'  SHIELDS        ',A4,' ',I3,'%')
      GO TO 150
90      PRINT 9000,(QUAD(9,J),J=1,10),REMKL
9000    FORMAT (' ',10(A1,' '),'  KLINGONS LEFT  ',I2)
      GO TO 150
100     PRINT 10000,(QUAD(10,J),J=1,10),REMTIM
10000   FORMAT (' ',10(A1,' '),'  TIME LEFT      ',F5.2)
 150  CONTINUE
      IDIDIT=1
      RETURN
160     PRINT 11000
11000   FORMAT (' S.R. SENSORS DAMAGED.')
      IDIDIT=0
      RETURN
      ENTRY SYNOP
      PRINT 1111,DATE,QUADX,QUADY,SECTX,SECTY,REMTIM,REMKL
 1111 FORMAT(/'     IT IS STARDATE ',F6.1,', YOU ARE IN QUADRANT '/
     +1X,I2,' - ',I2,'; SECTOR ',I2,' - ',I2,'.  YOU HAVE ',
     +F5.2,' STARDATES TO'/' DESTROY THE REMAINING KLINGON ',
     +'INVASION FORCE OF ',I3,' CRUISERS.'/'  GOOD LUCK.')
      RETURN
      ENTRY STATUS
      PRINT 2222,SHIP,DATE,ENERGY,TORPS,REMKL,REMTIM
 2222 FORMAT(' STATUS OF THE ',2A5,A3,' --'/
     *' STARDATE:      ',F7.2/' ENERGY:        ',F7.2/
     *' TORPEDOES:     ',I4/' KLINGONS LEFT: ',I3/
     *' TIME LEFT:     ',F7.2/)
      RETURN
      END
      SUBROUTINE STORM
        RETURN
        END
      SUBROUTINE SAVGAM
      COMMON I(427)
      PRINT 1000
 1000 FORMAT('  *** GAME SAVE INTIATED ***')
      WRITE(21) (I(J),J=1,427)
      PRINT 2000
 2000 FORMAT(' SAVED')
      CALL SCORE(0)
      STOP
      END
      SUBROUTINE RETGAM
      COMMON I(427)
      PRINT 1000
 1000 FORMAT('  *** GAME RETRIEVE INTIATED ***')
      READ(21) (I(J),J=1,427)
      PRINT 2000
 2000 FORMAT(' RETRIEVED')
      REWIND 21
      CALL SYNOP
      CALL SCORE(0)
        RETURN
        END
      SUBROUTINE TELEPT(LASTQX,LASTQY)
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        IF (REMBAS.NE.0)GOTO 10
        CALL FINISH(9)
        RETURN
10      IF (DAMAGE(9).LE.0)GOTO 21
        PRINT 23
23      FORMAT (' TELEPORTER DAMAGED')
        RETURN
21      IF (.NOT.COMPAR(CONDIT,6,'DOCKED'))GOTO 22
        PRINT 24
24      FORMAT (' ENSIGN CHEKHOV TO CAPTAIN: EXCUSE ME, SIR,',
     1/,' BUT SINCE WE ARE ALREADY DOCKED ARE YOU SURE')
      CALL PROMPT(19,'YOU WANT TO MOVE ? ')
        READ 12,ITRY
      IF(COMPAR(ITRY,1,'Y')) GO TO 30
        PRINT 25
25      FORMAT (' DOCTOR MCCOY TO CAPTAIN: THAT''S A GOOD CAPTAIN',
     1/,' HERE, TAKE THIS SPACE SICKNESS TABLET.')
        RETURN
30      CALL ASSIGN(CONDIT,8,'GREEN   ')
22      IF (REMTIM .GT..75)GOTO 26
        PRINT 11
11      FORMAT (' SPOCK TO CAPTAIN: I COMPUTE THAT SUCH AN',
     1' ACTION',/,' WOULD USE ALL OF OUR REMAINING TIME')
      CALL PROMPT(28,'ARE YOU SURE THIS IS WISE ? ')
        READ 12,ITRY
12      FORMAT (A3)
      IF(COMPAR(ITRY,1,'Y')) GO TO 16
        PRINT 13
13      FORMAT (' COMMAND ABORTED')
        RETURN
16      PRINT 17
26      TIME=.75
        DATE=DATE+TIME
        REMLST=(REMKL+2*REMCOM)*TIME
        REMRES=REMRES-REMLST
        REMTIM=REMRES/(REMKL+2*REMCOM)
17      FORMAT (' RECOMPUTING FEDERATION RESOURCES')
        IF (REMTIM.GT.0)GOTO 15
        CALL FINISH(2)
        RETURN
15      NB=1
        IF (REMBAS.EQ.1)GOTO 20
        NB=RAN(0)*REMBAS+1
20      QUADX=BASEQX(NB)
        QUADY=BASEQY(NB)
        IF (LASTQX.NE.QUADX.OR.LASTQY.NE.QUADY)CALL NEWQUA
      CALL ASSIGN(QUAD(SECTX,SECTY),4,'.   ')
        PRINT 173,SHIP
173     FORMAT (' LIEUTENANT UHURU TO CAPTAIN: COMMUNICATIONS',
     1/,' REPORT-- ATTEMPTING TELEPORTATION OF ',2A5,A3,
     1/,' TO DISTANT STARBASE')
174     DO 175 L=1,4
        I = RAN(0)*10.
        SECTX=BASEX+1
        IF (I.GT.3)SECTX=BASEX-1
        IF (I.GT.6)SECTX=BASEX
        SECTY=BASEY-1
        IF (I.GT.4)SECTY=BASEY
        IF (I.GT.7)SECTY=BASEY+1
      IF(.NOT.COMPAR(QUAD(SECTX,SECTY),1,'.')) GO TO 175
      IF(SECTX.LT.1.OR.SECTX.GT.10.OR.SECTY.LT.1.OR.SECTY.GT.10)GOTO 175
        GOTO 178
175     CONTINUE
        IF (LASTQX.EQ.QUADX.AND.LASTQY.EQ.QUADY)GOTO 179
        CALL NEWQUA
        LASTQX=QUADX
        LASTQY=QUADY
        GOTO 174
179     SECTX=RAN(0)*10
        SECTY=RAN(0)*10.
      IF(.NOT.COMPAR(QUAD(SECTX,SECTY),1,'.')) GO TO 179
178   IF(COMPAR(SHIP(1),5,'ENTER'))
     +      CALL ASSIGN(QUAD(SECTX,SECTY),4,'E   ')
      IF(COMPAR(SHIP(1),5,'FAERI'))
     +      CALL ASSIGN(QUAD(SECTX,SECTY),4,'F   ')
        CALL DOCK
        LASTQX=QUADX
        LASTQY=QUADY
        RETURN
        END
      SUBROUTINE TIMWRP
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,TEMP(8)
        REAL*8 CONDIT,PASSWD,PASS2
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
        TMP=(DATE-INDATE)*DIST*RAN(0)/10.
        IF (TMP.GT.0.)PRINT 1000
        T=RAN(0)
        IF (T.GT..66)TMP=-TMP
        REMTIM=TMP+REMTIM
        DATE=DATE-TMP
        IF (REMTIM .LT. 0.)REMTIM=1.5*RAN(0)
1000    FORMAT (' TIME WARP ENTERED.')
      RETURN
      END
       SUBROUTINE WAIT
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      IDIDIT=0
5       CALL SCAN(AITEM,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 10
        IF (.NOT.COMPAR(KEY,4,'NUMR'))GOTO 999
        IF (AITEM.LE.0)RETURN
        IF (AITEM.LT.REMTIM.AND..NOT.COMPAR(CONDIT,3,'RED'))GOTO 50
        GOTO 34
10    CALL PROMPT(11,'HOW LONG ? ')
        CALL CHEW
        GOTO 5
34      CALL SCAN(ITEM,KEY)
        IF (COMPAR(KEY,3,'EOL'))GOTO 35
        IF (.NOT.COMPAR(KEY,4,'ALPH'))GOTO 999
      IF(COMPAR(ITEM,1,'Y')) GO TO 50
        RETURN
35    CALL PROMPT(15,'ARE YOU SURE ? ')
        CALL CHEW
        IF (JA(DUMMY).EQ.0)RETURN
40      IF (AITEM.LE.0)RETURN
50      TEMP=AMIN1(AITEM,.5*RAN(0))
        TIME=TEMP
      CALL ATTACK
      IF(ALLDON.NE.0) RETURN
      IQX=QUADX
      IQY=QUADY
      CALL EVENTS
      IF(ALLDON.NE.0) RETURN
      AITEM=AITEM-TEMP
      IF(QUADX.EQ.IQX .AND. QUADY.EQ.IQY) GO TO 40
        PRINT 4000
4000    FORMAT (' (REMAINDER OF REST & REPAIR PERIOD CANCELLED)')
        CALL ATTACK
      RETURN
999     PRINT 5000
5000    FORMAT (' WHAT WAS THAT AGAIN ?')
        RETURN
      END
       SUBROUTINE WARP
      LOGICAL COMPAR
      DOUBLE PRECISION SHIP(3)
      COMMON GALAXY(10,10), QUAD(10,10), KDIST(10), KX(10), KY(10),
     +   KPOWER(10), CX(10), CY(10), INKLIN, INBASE, INRESO,
     +   INCOM, ENERGY, SHIELD, CONDIT, SHLDUP, DATE, QUADX, QUADY,
     +   SECTX, SECTY, TORPS, REMKL, KILLS, REMBAS, REMRES, SKILL,
     +   REMCOM, INTIME, REMTIM, LEN, PASSWD, SHIP, DIST,
     +   DIREC, WARPFA, IDIDIT, NKINKS, KAVGD(10),TIME,ALLDON,
     +   LSUPRE,DAMAGE(12),BASEQX(10),BASEQY(10),BASEX,BASEY,
     +   WFACSQ,KLHERE,INDATE,TWARP,STARCH(8,8),INSHLD,
     +   INSTAR,FUTURE(10),MOVED,NEVENT,RATING
      INTEGER CF,CI,SHLDUP,QUADX,QUADY,SECTX,SECTY,TORPS,
     +   REMKL,REMBAS,REMCOM,GALAXY,QUAD,STARCH,CX,CY,
     +  ALLDON,BASEQX,BASEQY,BASEX,BASEY,RATING
        REAL*8 CONDIT,PASSWD
      REAL KDIST,KAVGD,KPOWER,LSUPRE,INTIME,INRESO,INDATE,INSHLD
      INTEGER BLOOEY
      IDIDIT=0
      IF(DAMAGE(6) .NE. 0) GO TO 90
C--------READ IN COURSE AND DISTANCE
      CALL GETCD
        IF (IDIDIT.EQ.0)RETURN
        IDIDIT=0
      IF(DIST .EQ. 0) RETURN
C--------MAKE SURE STARSHIP HAS ENOUGH ENERGY TO MAKE THE TRIP
      POWER=4.02*WFACSQ*DIST
      IF(SHLDUP.EQ.1) POWER=2*POWER
      IF(POWER .LT. ENERGY) GO TO 10
        PRINT 1000
1000    FORMAT (' "ENGINEERING TO BRIDGE--'/' WE CAN''T DO IT, SIR.  ',
     1'WE HAVEN''T THE ENERGY."')
      IDIDIT=0
      RETURN
C--------MAKE SURE ENOUGH TIME IS LEFT FOR TRIP
 10   TIME=DIST/WFACSQ
      IF(TIME .LT. 0.80*REMTIM) GO TO 20
        PERCEN=100.0*TIME/REMTIM
        PRINT 2000,PERCEN
2000    FORMAT (' FIRST OFFICER SPOCK:  "CAPTAIN, I COMPUTE THAT SUCH ',
     1/' A TRIP WOULD REQUIRE APPROXIMATELY ',F6.2,'% OF OUR')
      CALL PROMPT(47,'REMAINING TIME.  ARE YOU SURE THIS IS WISE ? " ')
      IF(JA(DUMMY).NE.0) GO TO 20
      IDIDIT=0
      RETURN
        ENTRY WARPX
20      TWARP=0
        BLOOEY=0
      MOVED=1
      IF(WARPFA .LE. 6.0) GO TO 50
C--------DECIDE IF ENGINE DAMAGE WILL OCCUR
      TEMP=(6.0-WARPFA)**2/250.0
      PROB=DIST*TEMP
      IF(PROB .GT. RAN(0)) BLOOEY=1
      IF(BLOOEY.NE.0) DIST=RAN(0)*DIST
C----------DECIDE IF TIME WARP WILL OCCUR
 30   TWARP=0
      IF(WARPFA .LT. 10.0) GO TO 40
      IF(2.0*DIST*TEMP .GT. RAN(0))
     +            TWARP=(DATE-INDATE)*(RAN(0)-.5)
 40   IF(BLOOEY .EQ. 0 .AND. TWARP .EQ. 0) GO TO 50
C--------IF ENGINE DAMAGE OR TIME WARP SHOULD OCCUR, CHECK PATH
      ANGLE=((15.0-DIREC)*0.5235998)
      DELTAX=-SIN(ANGLE)
      DELTAY=COS(ANGLE)
      N=10.0*DIST+0.6
      X=SECTX
      Y=SECTY
      IF(N .EQ. 0) GO TO 48
      DO 45 L=1,N
      X=X+DELTAX
      IX=X+0.5
      IF(IX .LT. 1 .OR. IX .GT. 10) GO TO 48
      Y=Y+DELTAY
      IY=Y+0.5
      IF(IY .LT. 1 .OR. IY .GT. 10) GO TO 48
      IF(COMPAR(QUAD(IX,IY),1,'.')) GO TO 45
        BLOOEY=0
        TWARP=0
 45   CONTINUE
 48   CONTINUE
C--------ACTIVATE WARP ENGINES AND PAY THE COST
 50   CALL MOVE
      IF(ALLDON.NE.0) RETURN
      ENERGY=ENERGY-4.0*WFACSQ*DIST*(SHLDUP+1)
      IF(ENERGY .GT. 0) GO TO 55
      CALL FINISH(4)
      RETURN
 55   TIME=DIST/WFACSQ
C--------ENTER TIME WARP
      IF(TWARP.NE.0) CALL TIMWRP
C--------DAMAGE WARP ENGINES
      IF(BLOOEY .EQ. 0) GO TO 60
        PRINT 3000
3000    FORMAT (' "ENGINEERING TO BRIDGE--'/' SCOTT HERE.  THE WARP EN',
     1'GINES ARE BADLY DAMAGED.'/' WE CAN''T GO ANY FARTHER THAN THIS"')
      DAMAGE(6)=RAN(0)+0.1
 60   IDIDIT=1
      RETURN
C--------NO WARP ENGINES
90      PRINT 4000
4000    FORMAT (' WARP ENGINES DAMAGED.')
      RETURN
      END
      SUBROUTINE MESAGE
      PRINT 1000
      RETURN
 1000 FORMAT('  WELCOME TO STAR TREK.'/' FOR A LIST OF RULES ENTER ',
     *' "GAME TREKRULES".'/)
      END

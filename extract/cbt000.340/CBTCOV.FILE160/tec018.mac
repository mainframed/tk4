C     PROGRAM TO PLAY CASINO BLACKJACK
C      UPDATED BY FRANK BOHAC
      DIMENSION NPIP(104),CARD(104),IPLAY(8),HAND(8,13),CASH(8),BET(7),N
     1DECK(104)
      DATA NPIP/101,2,3,4,5,6,7,8,9,10,10,10,10,101,2,3,4,5,6,7,8,9,10,1
     10,10,10,101,2,3,4,5,6,7,8,9,10,10,10,10,101,2,3,4,5,6,7,8,9,10,10,
     210,10,101,2,3,4,5,6,7,8,9,10,10,10,10,101,2,3,4,5,6,7,8,9,10,10,10
     3,10,101,2,3,4,5,6,7,8,9,10,10,10,10,101,2,3,4,5,6,7,8,9,10,10,10,1
     40/
      DATA CARD/'  AS','  2S','  3S','  4S','  5S','  6S','  7S','  8S',
     1'  9S',' 10S','  JS','  QS','  KS',
     2          '  AH','  2H','  3H','  4H','  5H','  6H','  7H','  8H',
     3'  9H',' 10H','  JH','  QH','  KH',
     4          '  AC','  2C','  3C','  4C','  5C','  6C','  7C','  8C',
     5'  9C',' 10C','  JC','  QC','  KC',
     6          '  AD','  2D','  3D','  4D','  5D','  6D','  7D','  8D',
     7'  9D',' 10D','  JD','  QD','  KD',
     8          '  AS','  2S','  3S','  4S','  5S','  6S','  7S','  8S',
     7'  9S',' 10S','  JS','  QS','  KS',
     6          '  AH','  2H','  3H','  4H','  5H','  6H','  7H','  8H',
     5'  9H',' 10H','  JH','  QH','  KH',
     4          '  AC','  2C','  3C','  4C','  5C','  6C','  7C','  8C',
     3'  9C',' 10C','  JC','  QC','  KC',
     2          '  AD','  2D','  3D','  4D','  5D','  6D','  7D','  8D',
     1'  9D',' 10D','  JD','  QD','  KD'/
      DATA HAND,BLK/105*'    '/
      DATA CHK,CHKY/'N','Y'/
      DATA CASH,BET,ND,IPLAY/15*0.0,9*0/
      DATA NDECK/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,2
     12,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,4
     24,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,6
     36,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,8
     48,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104/
      ITI=5
      ITO=6
      IRAN=IRANST(0)
   70 CALL RNIBM(IRAN,Y)
      MARK=104
      CALL SHFLE(NDECK,MARK,IRAN,ND)
      MARK=0
C     PLAY=BEGINS HERE
      NQ = 8
  100 WRITE(ITO,2)
       DO 900 I=1,NQ
       IPLAY(I)=0
       DO 900 J=1,13
900   HAND(I,J)=BLK
    2 FORMAT(1X,'ENTER NUMBER OF PLAYERS')
      READ(ITI,*)NP
      IF(NP.GE.1.AND.NP.LE.7)GO TO 110
      WRITE(ITO,3)NP
    3 FORMAT(' YOU ENTERED  ',I5,' AS THE NUMBER OF PLAYERS. THIS MUST B
     1E BETWEEN 1 AND 7.')
      GO TO 100
  110 NQ=NP+1
      WRITE(ITO,4)
    4 FORMAT(' ENTER YOUR BANKROLLS')
      READ(ITI,*)(CASH(I),I=1,NP)
      CMAX=0.0
      DO 111 I=1,NP
      IF((CASH(I)-CMAX).GT.0.0) CMAX=CASH(I)
  111 CONTINUE
      CASH(NQ)=10.0*CMAX
      WRITE(ITO,898) CMAX
 898  FORMAT(' ',' THE MAXIMUM BET THIS TABLE WILL ALLOW IS ',F11.2)
  200 WRITE(ITO,5)
    5 FORMAT(' PLACE YOUR BETS')
       DO 996 I=1,NP
       IF(CASH(I).LT.0) GO TO 996
 897      WRITE(ITO,899) I
 899    FORMAT(' ',' PLAYER NO. ',I2)
       READ(ITI,*) BET(I)
      IF(BET(I).LE.CMAX) GO TO 996
      WRITE(ITO,896)
 896   FORMAT(' ',' I CANT ALLOW SUCH A LARGE BET.')
      WRITE(ITO,799)
      GO TO 897
 996   CONTINUE
 799  FORMAT(' ',' PLEASE MAKE ANOTHER BET')
C     DEAL LOOP
      IF(MARK.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
C     INITIALIZE PARAMETERS
      ND=0
      DO 300 ICOUNT=1,2
      DO 300 I=1,NQ
      ND=ND+1
      IPOS=MARK+ND
      IDCD=NDECK(IPOS)
      IPLAY(I)=IPLAY(I)+NPIP(IDCD)
      HAND(I,ICOUNT)=CARD(IDCD)
      JTEMP=MARK+ND
      IF(JTEMP.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
  300 CONTINUE
      MARK=MARK+ND
      IF(MARK.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
      IF(IPLAY(NQ).NE.111)GO TO 400
      WRITE(IT0,6)
    6 FORMAT(' DEALER HAS A NATURAL. YOUR HANDS FOLLOW.'/' ALL OTHER NAT
     1URALS DRAW, ALL OTHER HANDS LOSE.')
      DO 301 I=1,NP
      IF(IPLAY(I).EQ.111)GO TO 301
      CASH(NQ)=CASH(NQ)+BET(I)
      CASH(I)=CASH(I)-BET(I)
  301 CONTINUE
      WRITE(ITO,7)((I,(HAND(I,K),K=1,2)),I=1,NQ)
    7 FORMAT(' PLAYER  ',I2,'  HAS CARDS',13A4)
      GO TO 980
  400 CONTINUE
      WRITE(ITO,8)HAND(NQ,1)
    8 FORMAT(/' DEALERS FACE CARD IS',A4/)
      ND=0
      DO 410 I=1,NP
       IF(CASH(I).LT.0) GO TO 410
      K=1
  402 WRITE(ITO,9)I,(HAND(I,J),J=1,13)
    9 FORMAT(' PLAYER ',I2,' YOUR HAND IS',13A4/' DO YOU WANT ANOTHER CA
     1RD? ANSWER Y OR N')
      READ(ITI,10)ANS
   10 FORMAT(A1)
      IF(ANS.EQ.CHK)GO TO 410
      ND=ND+1
      IPOS=MARK+ND
      IDCD=NDECK(IPOS)
      IPLAY(I)=IPLAY(I)+NPIP(IDCD)
      HAND(I,K+2)=CARD(IDCD)
      K=K+1
      JTEMP=MOD(IPLAY(I),100)
      IF(JTEMP.LE.21)GO TO 402
      WRITE(ITO,11)(HAND(I,J),J=1,13),JTEMP
   11 FORMAT(' YOU BUSTED. YOUR FINAL HAND IS'/13A4/' MINIMUM TOTAL ',
     1'SCORE OF ',I4,' TOO BAD')
      JTEMP=MARK+ND
      IF(JTEMP.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
  401 JTEMP=MARK+ND
      IF(JTEMP.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
  410 CONTINUE
C     DEALER PLAY LOOP
      K=1
  501 WRITE(ITO,12)(HAND(NQ,J),J=1,13)
   12 FORMAT(' DEALERS HAND IS',13A4)
      JT=MOD(IPLAY(NQ),100)
      JALT=JT
      IF(((IPLAY(NQ)-JT)/100).GT.0)JALT=JT+10
      IF((JT.GE.17.OR.JALT.GE.17).AND.(JT.GE.17.OR.JALT.LE.21))GO TO 600
      IF(JALT.LE.21)JT=JALT
      WRITE(ITO,13)JT
   13 FORMAT(' DEALER HAS HAND OF VALUE ',I3,' AND MUST TAKE A CARD')
      ND=ND+1
      IPOS=MARK+ND
      IDCD=NDECK(IPOS)
      IPLAY(NQ)=IPLAY(NQ)+NPIP(IDCD)
      HAND(NQ,K+2)=CARD(IDCD)
      K=K+1
      JTEMP=MARK+ND
      IF(JTEMP.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
      GO TO 501
  600 CONTINUE
      MARK=MARK+ND
      IF(MARK.EQ.104)CALL SHFLE(NDECK,MARK,IRAN,ND)
      IF(JALT.LE.21)JT=JALT
      WRITE(ITO,23)JT
   23 FORMAT(' DEALER STANDS WITH ',I3//)
      IDEAL=JT
      DO 650 I=1,NP
      IF(CASH(I).LT.0) GO TO 650
      JT=MOD(IPLAY(I),100)
      JALT=JT
      IF(((IPLAY(I)-JT)/100).GT.0)JALT=JT+10
      IF(JALT.LE.21)JT=JALT
      IF(JT.LE.21)GO TO 610
      WRITE(ITO,14)I,BET(I)
   14 FORMAT(' PLAYER ',I2,' BUSTED. BANKROLL DECREMENTED ',F11.2)
      CASH(I)=CASH(I)-BET(I)
      CASH(NQ)=CASH(NQ)+BET(I)
      GO TO 650
  610 IF(IPLAY(I).NE.111)GO TO 620
      IF (HAND(I,3).NE.BLK) GO TO 620
      TEMP=1.5*BET(I)
      WRITE(ITO,15)I,TEMP
   15 FORMAT(' PLAYER ',I2,' HAS A NATURAL. BANKROLL INCREMENTED',F11.2)
      CASH(I)=CASH(I)+1.5*BET(I)
      CASH(NQ)=CASH(NQ)-1.5*BET(I)
      GO TO 650
  620 IF(IDEAL.LE.21)GO TO 630
      WRITE(ITO,16)I,BET(I)
   16 FORMAT(' PLAYER ',I2,' DID NOT BUST BUT DEALER DID. BANKROLL INCRE
     1MENTED',F11.2)
      CASH(I)=CASH(I)+BET(I)
      CASH(NQ)=CASH(NQ)-BET(I)
      GO TO 650
  630 IF(JT-IDEAL)631,633,635
  631 WRITE(ITO,17)I,JT,IDEAL,BET(I)
   17 FORMAT(' PLAYER ',I2,' HAS SCORE OF',I3,' WHICH IS BELOW ',
     1'DEALERS SCORE OF',I3/' BANKROLL DECREMENTED',F11.2)
      CASH(I)=CASH(I)-BET(I)
      CASH(NQ)=CASH(NQ)+BET(I)
      GO TO 650
  635 WRITE(ITO,18)I,JT,IDEAL,BET(I)
   18 FORMAT(' PLAYER ',I2,' HAS SCORE ',I3,' WHICH IS ABOVE DEALERS SCO
     1RE OF ',I3/' BANKROLL INCREMENTED',F11.2)
      CASH(I)=CASH(I)+BET(I)
      CASH(NQ)=CASH(NQ)-BET(I)
      GO TO 650
  633 WRITE(ITO,19)I,IDEAL
   19 FORMAT(' PLAYER ',I2,' AND DEALER TIE WITH A SCORE OF ',I2,' BANKR
     1OLL UNCHANGED')
  650 CONTINUE
  980       WRITE(ITO,990)
  990   FORMAT(' ',' ADJUSTED BANKROLLS ')
       DO 999 I=1,NP
      IF(CASH(I).EQ.-9999.99) GO TO 999
       WRITE(ITO,20) I,CASH(I)
  20    FORMAT(' ',' PLAYER ',I2,' HAS ',F11.2,' IN CASH')
       IF(CASH(I).LT.0) CALL REMPL(I,CASH(I),ITO)
 999    CONTINUE
      WRITE(ITO,10020)CASH(NQ)
10020 FORMAT(/,' DEALER    HAS ',F11.2,' IN BANK')
       IF(CASH(NQ).GE.0) GO TO 998
       CALL DLRBRK(ITO)
       GO TO 997
 998  DO 700 I=1,NQ
      IPLAY(I)=0
        DO 700 J=1,13
 700   HAND(I,J)=BLK
       IST=1
       DO 991 I=1,NP
       IF((IST.EQ.1).AND.(CASH(I).LT.0)) GO TO 991
       IST=0
  991     CONTINUE
      IF(IST.EQ.0) GO TO 992
      WRITE(ITO,993)
993     FORMAT(' ',' ALL PLAYERS HAVE BEEN BEATEN!! I WIN!!!')
       GO TO  997
 992      WRITE(ITO,21)
   21 FORMAT(///' EVERYONE WANT TO TRY AGAIN?')
      READ(ITI,10)ANS
      IF(ANS.EQ.CHKY)GO TO 200
 997  WRITE(ITO,22)
   22 FORMAT(' DOES ANYONE WANT TO PLAY?')
      READ(ITI,10)ANS
      IF(ANS.EQ.CHKY)GO TO 100
      STOP
      END
      SUBROUTINE RNIBM(I,Y)
C     ADAPTED FROM IBM SCIENTIFIC SUBROUTINE PACKAGE
      I=I*65539
      IF(I)1,2,2
    1 I=I+2147483647+1
    2 Y=I
      Y=Y*.4656613E-9
      RETURN
      END
      SUBROUTINE SHFLE(NDECK,MARK,IRAN,ND)
      DIMENSION NDECK(104),NTEMP(104),RAN(104)
      ITI=5
      ITO=6
      WRITE(ITO,1)
    1 FORMAT(1X,' EXCUSE ME I MUST SHUFFLE THE CARDS')
      DO 100 I=1,MARK
      CALL RNIBM(IRAN,X)
      RAN(I)=X
  100 NTEMP(I)=NDECK(I)
      IF(MARK-104)110,111,112
  112 WRITE(ITO,2)MARK
    2 FORMAT(' COUNTER OFF. HAS VALUE ',I10)
      STOP
  110 LEFT=104-MARK
      DO 120 I=1,LEFT
      IPOS=MARK+I
  120 NDECK(I)=NDECK(IPOS)
  111 IF(MARK.EQ.104)LEFT=0
      DO 200 I=1,MARK
      DO 200 J=I,MARK
      IF(RAN(I)-RAN(J))200,200,202
  202 TEMP1=RAN(I)
      TEMP2=NTEMP(I)
      RAN(I)=RAN(J)
      NTEMP(I)=NTEMP(J)
      RAN(J)=TEMP1
      NTEMP(J)=TEMP2
  200 CONTINUE
      DO 300 I=1,MARK
      NEW=LEFT+I
  300 NDECK(NEW)=NTEMP(I)
      MARK=LEFT
      ND=0
      WRITE(ITO,3)
    3 FORMAT(1X,' FINISHED SHUFFLING. LETS PLAY CARDS')
      RETURN
      END
       SUBROUTINE DLRBRK(ITO)
       WRITE(ITO,10)
 10   FORMAT(' ',' YOU HAVE BROKEN THE HOUSE! PLAY AGAIN AND GIVE ME A
     1 CHANCE TO WIN MY MONEY BACK')
       RETURN
       END
       SUBROUTINE REMPL(I,CASH,ITO)
      IF(CASH.EQ.-9999.99) RETURN
       CASH = -CASH
       WRITE(ITO,10) I,CASH
 10   FORMAT(' ',' PLAYER ',I2,' !!! YOU OWE THE HOUSE ',F11.2,' !!')
       WRITE(ITO,11)
  11    FORMAT(' ',' WE SEND IN THE BOUNCER WHO DRAGS YOU INTO THE
     1 KITCHEN. SINCE YOU WILL BE SPENDING SOME TIME WASHING DISHES TO')
 12    FORMAT(' ','PAY OFF YOUR DEBT, YOU WONT HAVE TIME (OR MONEY) TO
     4 PLAY BLACKJACK.')
       WRITE(ITO,12)
       WRITE(ITO,15)
 15   FORMAT(' ',' YOU HAVE BEEN REMOVED FROM THE GAME.')
      CASH = -CASH
      CASH = -9999.99
       RETURN
       END

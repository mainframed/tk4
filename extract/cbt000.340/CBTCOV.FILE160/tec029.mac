       INTEGER IDROP(4)/0,0,0,0/
      INTEGER GAME(2)
      INTEGER DEAL
      INTEGER HAND(4,5),CARD(52),ORD(4),TYPE,NUMB(4),NOHAND(4)
      INTEGER ACC(6)
      COMMON  HAND,NCLID,CARD,ACC
      DATA GAME/4HDRAW,4HSTUD/
      JSEED0=IRANST(0)
      ACC(6)=0
C        GIVE EACH PLAYER A SPECIFIC AMOUNT OF MONEY TO BET WITH
      DO 800 IAA=1,4
800   ACC(IAA)=50
      ISTAR=33333
          ISTAR=44444
C        FILL THE DECK WITH THE 52 CARDS
      J=1
      DO 11 I=1,4
      DO 11 N=2,14
      CARD(J)=N*10+I
11    J=J+1
C        PLAY TWENTY ROUNDS OF POKER OR UNTIL ALL BUT ONE OF THE PLAYERS
C        BROKE
      DO 110 IROUND=1,20
      PRINT 402,IROUND
402    FORMAT (////'1ROUND NUMBER  ',I3/)
C        PUT ALL PLAYERS IN THE GAME EXCEPT THOSE WHO ARE BROKE
      NUMD=0
      DO 18 I=1,4
      NUMD=NUMD+IDROP(I)
      IF (IDROP(I).EQ.1) IDROP(I)=0
18     CONTINUE
C        IF ALL BUT ONE ARE BROKE STOP
      IF (NUMD.GE. 6) STOP
C        DECIDE WHETHER TO PLAY FIVE CARD DRAW OR FIVE CARD STUD
      IGAME=RANDOM(JSEED0)*2.+1.
      PRINT 83, GAME(IGAME      )
83    FORMAT (40X, ' THE GAME THIS ROUND IS FIVE CARD ',A4)
C        DECIDE WHETHER OR NOT TO USE WILD CARDS
      IWILD=0
      ITEST=RANDOM(JSEED0)*2.
      IF (ITEST.LT.1) GO TO 81
      IWILD=RANDOM(JSEED0)*13.+2.
      NB=IWILD*100
      CALL OUT(NB)
81    CONTINUE
C      ANTE ONE ON FIRST ROUND OF BETS
      PRINT 1003
1003  FORMAT (80X,' ALL PLAYERS ANTE ONE')
      DO 50 I=1,4
      IF (IDROP(I).NE.2)   CALL ACCOUN(1,6,I)
50     CONTINUE
C        DEAL EACH PLAYER FIVE CARDS
      NCLID=52
      DO 10 I=1,5
      DO 10 N=1,4
10    HAND(N,I)=DEAL(NCLID,CARD)
C        PLAY TWO SETS IF THE GAME IS DRAW ONLY ONE IF STUD
      DO 21 NN=IGAME,2
      DO 12 N=1,4
C        DETERMINE TYPE OF HAND EACH PLAYER HAS
      ORD(N)=TYPE(HAND,N,NUM,IWILD)
12    NUMB(N)=NUM
C        HAVE A ROUND OF BETTING
      CALL BET(ORD,NN,IDROP)
C        IF THIS IS THE SECOND TIME THRU GO TO 22
      IF (NN.GE.2) GO TO 22
      DO 21 N=1,4
C        ORDER THE CARDS SO THAT CARDS ARE SORTED AND PAIRS,THREE OF A K
C        ETC. ARE AT THE BEGINNING
      IF (IDROP(N).EQ.2) GO TO 21
      CALL IORD2(HAND,N,NUMB(N))
C        PRINT EACH PLAYERS HAND
      CALL OUT(N)
C        IF THE PLAYER IS STILL IN LET HIM DRAW CARDS
      IF (IDROP(N).EQ.1) GO TO 21
      CALL DRAW(N,ORD(N))
21    CONTINUE
22    CONTINUE
C        SORT THE CARDS ACORDING TO TYPE WITH BEST FIRST
      DO 13 I=1,4
C        IF THE PLAYER HAS DROPPED THE ORDER OF HIS HAND IS ZERO
      ORD(I)=ORD(I)*(1-IDROP(I))
13    NOHAND(I)=I
      DO 14 I=1,4
      DO 14 J=1,3
      IF (ORD(J).GE.ORD(J+1)) GO TO 14
      CALL EXCH(ORD,NOHAND,J)
14    CONTINUE
      DO 20 I=1,4
      N=NOHAND(I)
C        ORDER THE CARDS IN THE HAND AGAIN
20    CALL IORD2(HAND,N,NUMB(N))
C        PRINT THE FINAL HANDS FOR THE ROUND
C        EXCEPT THOSE PLAYERS WHO ARE OUT OF MONEY
      DO 111 I=1,4
      IF (IDROP(I).EQ.2) GO TO 111
      CALL OUT(I)
111   CONTINUE
C        CHECK TO SEE IF THE PLAYERS WITH THE BEST HANDS HAVE THE SAME T
C        IF SO THEN CHECK WHICH HAND IS HIGHER IN BASE 13
17    JSWIT=0
      DO 15 I=1,3
      IF (ORD(I).NE.ORD(I+1)) GO TO 16
      N1=NOHAND(I)
      N=NOHAND(I+1)
      IF (IEQV(HAND,N1,IWILD).GT.IEQV(HAND,N,IWILD)) GO TO 15
      CALL EXCH(ORD,NOHAND,I)
      JSWIT=JSWIT+1
15    CONTINUE
16    IF (JSWIT.GE.1) GO TO 17
C        PRINT OUT THE WINNERS NUMBER AND THE TYPE OF HAND HE HAD
C        ALSO THE AMOUNT OF MONEY EACH PLAYER HAS LEFT
      NWH=NOHAND(1)
      CALL WINNER(NWH,ORD(1))
C        IF A PLAYER HAS NO MONEY LEFT HE IS OUT OF THE GAME
      DO 110 N=1,4
      IF (ACC(N).LE.0) IDROP(N)=2
110   CONTINUE
      STOP
      END
      INTEGER FUNCTION DEAL(NCLID,CARD)
      INTEGER CARD(52)
C        PICK A RANDOM NUMBER FROM ONE TO THE NUMBER OF CARDS LEFT IN TH
      JSEED0=IRANST(0)
      N=RANDOM(JSEED0)*FLOAT(NCLID)+1.
C        PUT THAT CARD INTO THE HAND
      DEAL=CARD(N)
C        AND PUT IT AT THE END OF THE DECK DECREASING THE NUMBER OF CARD
      CARD(N)=CARD(NCLID)
C        IN THE DECK BY ONE
      CARD(NCLID)=DEAL
      NCLID=NCLID-1
      RETURN
      END
      SUBROUTINE SORT (HAND,N)
      INTEGER HAND(4,5)
C        SORT THE CARDS IN THE HAND USING A SWITCH SORT
4     JSWIT=0
      IN=1
2     IF (HAND(N,IN).LT.HAND(N,IN+1)) GO TO 1
3     IN=IN+1
      IF (IN.NE.5) GO TO 2
      IF (JSWIT.EQ.0) RETURN
      GO TO 4
1     ITEMP=HAND(N,IN)
      HAND(N,IN)=HAND(N,IN+1)
      HAND(N,IN+1)=ITEMP
      JSWIT=1
      GO TO 3
      END
      FUNCTION IEQV(HAND,N,IWILD)
      INTEGER HAND(4,5)
C        CHANGE ALL WILD CARDS TO THE VALUE OF THE CARD THEY REPRESENT
      DO 15 J=1,5
      IF (HAND(N,J)/10.NE.IWILD) GO TO 16
15    CONTINUE
16      IF (J.EQ.1) GO TO 18
      K=J-1
      DO 17 L=1,K
17      HAND(N,L)=HAND(N,J)
C        CONVERT THE HAND INTO A NUMBER IN BASE 13
18    IEQV=0
      IEQV=0
      DO 10 I=1,5
10    IEQV=HAND(N,I)/10*13**(5-I)+IEQV
      RETURN
      END
      INTEGER FUNCTION TYPE(HAND,N,K,IWILD)
      INTEGER IWC(4)
      INTEGER HAND(4,5),DIGIT(5),SUIT(5),TYPVAL(20),L(4) ,A
       DATA TYPVAL/1,2,2,4,2,3,4,8,2,3,3,7,4,7,8,10,8,8,4,4/
      TYPE=0
      NW=0
      DO 12 I=1,5
C        MAKE ALL WILD CARDS HIGHER THAN OTHER CARDS
      IF (HAND(N,I)/10.NE.IWILD) GO TO 12
      IWC(NW+1)=HAND(N,I)
      HAND(N,I)=200
      NW=NW+1
12    CONTINUE
C        SORT THE HAND
      CALL SORT(HAND,N)
C        FIND THE SUIT AND DIGIT OF EACH CARD IN A HAND
      DO 10 I=1,5
      DIGIT(I)=HAND(N,I)/10
10    SUIT(I)=HAND(N,I)-DIGIT(I)*10
C        CHECK FOR A STRAIGHT
      IR2=0
      IROE=0
      DO 20 IA=1,4
      IF(HAND(N,IA)/10.EQ.HAND(N,IA+1)/10+1)     IROE=IROE+1
      IF (HAND(N,IA)/10.EQ.HAND(N,IA+1)/10+2)  IR2=IR2+1
20    CONTINUE
      IF (IROE+IR2.EQ.4-NW.AND.NW.GE.IR2) TYPE=5
C        CHECK FOR A FLUSH
      IFLUSH=0
      A=SUIT(5)
      DO 21 IA=1,4
      IF (SUIT(IA).EQ.A.OR.SUIT(IA).EQ.0) IFLUSH=IFLUSH+1
21    CONTINUE
      IF (IFLUSH.EQ.4.AND.TYPE.EQ.4) TYPE=9
      IF(IFLUSH.EQ.4.AND.TYPE.NE.4) TYPE=6
C        COMPARE CARDS NEXT TO EACH OTHER IN THE HAND TO FORM A BINARY N
C        WILD CARDS MATCH ALL CARDS
      K=1
      DO 11 I=1,4
      IF (DIGIT(I).EQ.DIGIT(I+1).OR.DIGIT(I).EQ.20) K=K+2**(4-I)
11    CONTINUE
C        IN SOME CASES MAKE A MORE EFFICIENT USE OF THE WILD CARDS
      IF (K.EQ.12.AND.NW.EQ.1)   K=17
      IF (K.EQ.14.AND.NW.EQ.2) K=18
      IF (K.EQ.11.AND.NW.EQ.1) K=19
      IF (K.EQ.10.AND.NW.EQ.1) K=20
      IF (TYPVAL(K).GT.TYPE) TYPE=TYPVAL(K)
C        RETURN THE WILD CARDS THEIR PROPER VALUE
      IF (NW.EQ.0) RETURN
      DO 13 I=1,NW
13    HAND(N,I)=IWC(I)
      RETURN
      END
      SUBROUTINE EXCH(ORD,NOHAND,J)
      INTEGER ORD(4),NOHAND(4)
C        EXCHANGE THE POSITIONS IN THE ARRAY ORD, NOHAND IN THE J TH POS
      ITEMP=ORD(J)
      ORD(J)=ORD(J+1)
      ORD(J+1)=ITEMP
      ITEMP=NOHAND(J)
      NOHAND(J)=NOHAND(J+1)
      NOHAND(J+1)=ITEMP
      RETURN
      END
      SUBROUTINE IORD2(HAND,N,TYP)
      INTEGER TYP
      INTEGER IO(5,20),ITH(5),HAND(4,5)
      DATA IO/1,2,3,4,5,4,5,1,2,3,3,4,1,2,5,3,4,5,1,2,2,3,1,4,5,
     22,3,4,5,1,2,3,4,1,5,2,3,4,5,1,1,2,3,4,5,1,2,4,5,3,1,2,3,4,5,
     33,4,5,1,2,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,
     4      1,3,4,5,2,1,2,4,5,3,1,3,4,2,5,1,4,5,2,3/
C        REORDER THE HAND SO THE PAIRS,THREE OF A KIND ETC ARE AT THE BE
C        PUT THE ARRAY HAND INTO A TEMPORARY ARRAY AND TRANSFER THE TEMP
C        ARRAY BACK INTO HAND IN THE CORRECT ORDER
      DO 40 I=1,5
40    ITH(I)=HAND(N,I)
      DO 20 I=1,5
      IC=IO(I,TYP)
20     HAND(N,I)=ITH(IC)
      RETURN
      END
      SUBROUTINE OUT(N)
      INTEGER SUIT(5),HAND(4,5),DIGIT(5)
      REAL*8 NUMS(15),KINDS(4)
      COMMON HAND
      DATA NUMS/'   ONE','   TWO',' THREE','  FOUR','  FIVE','   SIX'
     2,' SEVEN',' EIGHT','  NINE','   TEN','  JACK',' QUEEN','  KING'
     3,'   ACE','  SIXE'/,KINDS/'CLUBS','DIAMONDS','HEARTS','SPADES'/
      IF (N.GT.190) GO TO 12
C        FIND THE DIGIT AND SUIT OF EACH HAND'S CARDS
      DO 10 I=1,5
      DIGIT(I)=HAND(N,I)/10
10    SUIT(I)=HAND(N,I)-DIGIT(I)*10
      PRINT 2,N
C        PRINT THE HAND
      DO 11 I=1,5
      J=DIGIT(I)
      K=SUIT(I)
11    PRINT 1,NUMS(J),KINDS(K)
1     FORMAT (10X,A6,' OF ',A8)
2     FORMAT (5X, 'HAND NUMBER  ',I5)
      RETURN
C        PRINT WHICH CARD IS WILD THIS ROUND
12    NA=N/100
      PRINT 3, NUMS(NA)
3     FORMAT (40X,A6,'S ARE WILD THIS ROUND')
      RETURN
      END
      SUBROUTINE DRAW(N,TYP)
      INTEGER IDRAW(10),HAND(4,5),TYP,CARD(52),DEAL
      COMMON HAND,NCLID,CARD
      DATA IDRAW/3,3,1,2,0,0,0,1,0,0/
C        DRAW A SET NUMBER OF CARDS FOR EACH TYPE HAND
      K=IDRAW(TYP)
      IF (TYP.EQ.1.AND.HAND(N,1)/10.EQ.14) K=K+1
      IF (TYP.NE.1) GO TO 15
C        DRAW ONE CARD TO A FLUSH
      DO 80 ISUIT=1,4
      IFLUSH=0
      DO 80 I=1,5
      IF (HAND(N,I)-HAND(N,I)/10*10.EQ.ISUIT) GO TO 81
      NOTS=I
      GO TO 80
81    IFLUSH=IFLUSH-1
80     CONTINUE
      IF (IFLUSH.EQ.5) GO TO 83
C        ALSO DRAW ONE CARD TO AN OUTSIDE STRAIGHT
      DO 11 J=1,2
      JA=J+2
      DO 12 I=J,JA
       IF (HAND(N,I)/10.NE.HAND(N,I+1)/10+1) GO TO 11
12    CONTINUE
      K=1
      GO TO (13,14),J
11     CONTINUE
15    DO 10 I=1,K
      IW=5-K+I
10    HAND(N,IW)=DEAL(NCLID,CARD)
20    PRINT 1,N,K
1     FORMAT (40X,'PLAYER NUMBER  ',I2,' DRAWS ',I2,' CARDS ')
      RETURN
13    HAND(N,5)=DEAL(NCLID,CARD)
      GO TO 20
14     HAND(N,1)=DEAL(NCLID,CARD)
      GO TO 20
83    HAND(N,NOTS)=DEAL(NCLID,CARD)
      K=1
       GO TO 20
      END
      SUBROUTINE WINNER(IPER,ITYPE)
      COMPLEX*16 TYPAND(10)
      INTEGER HAND(4,5),CARD(52),ACC(6)
      COMMON  HAND,NCLID,CARD,ACC
      DATA TYPAND/'A HIGH CARD','A PAIR','TWO PAIR','THREE OF A KIND',
     *'A STRAIGHT','A FLUSH','A FULL HOUSE','FOUR OF A KIND',
     *'A STRAIGHT FLUSH','FIVE OF A KIND'/
C        PRINT THE TYPE OF HAND THE WINNER HAD
      PRINT 1,IPER,TYPAND(ITYPE)
C        PRINT THE AMOUNT OF THE POT
      PRINT      14,ACC(6)
14    FORMAT(40X,' THE POT WAS $',I3)
      CALL ACCOUN(0,IPER,6)
C        PRINT EACH PLAYERS PRESENT BALANCE
      PRINT 15, ((I,ACC(I)),I=1,4)
15    FORMAT (20X, ' THE PRESENT BALANCES ARE '/
     2   4(20X,' PLAYER NUMBER ',I1,'  $',I4/))
1     FORMAT (40X,'PLAYER NUMBER ',I1,' WINS WITH ',2A8)
      RETURN
      END
      SUBROUTINE BET(ITYP,IC,IDROP)
      REAL INT(10)
      INTEGER ACC(6),HAND(4,5),CARD(52),ITYP(4),IDROP(4),NAMTR(4)
      COMMON HAND,NCLID,CARD,ACC
      G(JA,JB)=(1/FLOAT(JB)*(FLOAT(JA)-.9)**1.2 )
      F(JA,JB)=(1/FLOAT(JB)*(FLOAT(JA)-.7)**1.2 )
C        FILL AMOUNT RAISED LAST ARRAY WITH 0
      JSEED0=IRANST(0)
      DO 444 IAAA=1,4
444    NAMTR(IAAA)=0
C        SET THE NUMBER OF THE PERSON RAISED LAST 'NPR' TO 1
      NPR=1
C        SET ROUND BETTING TO ONE
      IRBET=1
C        SET NUMBER OF RAISES 'NRAISE' TO 1
      NRAISE=1
      N=0
C        SET MAXIMUM SEE TO 9
      MS=9
C        SET MAXIMUM RAISE TO 3
      MR=3
      INT(1)=1
      IF (IC.EQ.2) GO TO 40
40    N=N+1
C        IF THREE PEOPLE ARE OUT OF THE GAME RETURN
      ITOT=0
      DO 300 I=1,4
      IF (IDROP(I).EQ.2) ITOT=ITOT-1
300   ITOT=IDROP(I)+ITOT
      IF (  ITOT.EQ.3)    RETURN
C        THE PLAYER AFTER PLAYER 4 IS PLAYER 1
      IF (N.GT.4) N=1
C        IF THE BETTING HAS GONE ALL THE WAY AROUND AND NO ONE BET RETUR
      IF (NPR.EQ.N.AND.IRBET.NE.1) RETURN
      IRBET=2
      IF (IDROP(N).GE.1) GO TO 40
C        DECIDE HOW MUCH THE PLAYER BETTING IS WILLING TO SEE
C        IF THAT AMOUNT IS GRATER THAN ISEE SEE THAT AMOUNT
      NAMTR(N)=0
      DO 10 I=2,MS
10     INT(I)=INT(I-1)*F(ITYP(N),IC)+INT(I-1)
      A=RANDOM(JSEED0)*INT(MS)
      DO 11 I=1,MS
       IF (A.LT.INT(I)) GO TO 12
11    CONTINUE
12    IBET=I-1
      ISEE=0
      DO 400 IA=1,4
400   ISEE=NAMTR(IA)+ISEE
      IF (ISEE.EQ.0.AND.NRAISE.GT.3) RETURN
C        IF THE AMOUNT HE IS WILLING TO SEE IS LESS THAN ISEE HE IS DROP
      IF (IBET.LT.ISEE) GO TO 20
      CALL ACCOUN(ISEE,6,N)
      PRINT 1001,N,ISEE
1001  FORMAT(80X,' PLAYER NUMBER ',I1,' SEES ',I2)
      IF (NRAISE.GT.3)  GO TO 40
C        FIND OUT HOW MUCH EACH PLAYER IS WILLING TO RAISE
      DO 30 I=2,MR
30    INT(I)=INT(I-1)*G(ITYP(N),IC)+INT(I-1)
      A=RANDOM(JSEED0)*INT(MR)
      DO 31 I=1,MR
      IF (A.LT.INT(I)) GO TO 32
31    CONTINUE
32    IRAISE=I-1
C        IF THE AMOUNT HE IS WILLING TO RAISE IS ZERO GO TO NEXT PLAYER
      IF (IRAISE.EQ.0) GO TO 40
C        ELSE RAISE THAT AMOUNT
      NPR=N
      NRAISE=NRAISE+1
C   PLAYER NUMBER N RAISES    'IRAISE('
      NAMTR(N)=IRAISE
      CALL ACCOUN(IRAISE,6,N)
      PRINT 1000, N,IRAISE
1000  FORMAT (80X,' PLAYER NUMBER ',I1,' RAISES',I3)
      GO TO 40
20    IDROP(N)=1
      PRINT 1002,N
1002  FORMAT (80X,' PLAYER NUMBER ',I1, ' DROPPED')
      GO TO 40
      END
      SUBROUTINE ACCOUN(IAMT,ITO,IFR)
      INTEGER ACC(6),HAND(4,5),CARD(52)
      COMMON HAND,NCLID,CARD,ACC
      IF (ITO.NE.6) GO TO 15
C        PUT AN AMOUNT OF MONEY 'IAMT' FROM PLAYER NUMBER IFR IN THE POT
      ACC(ITO)=ACC(ITO)+IAMT
      ACC(IFR)=ACC(IFR)-IAMT
      RETURN
C        PUT THE POT INTO THE WINNERS HAND
15    ACC(ITO)=ACC(IFR)       +ACC(ITO)
      ACC(IFR)=0
      RETURN
      END

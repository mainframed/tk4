     FVCRDRW: PROCEDURE OPTIONS(MAIN);
         DCL (DECK(52),HAND(2,5),SUIT(2,5),CARD(2,5),FLUSH,
          STRT,STRFL,PR(2),PAIR,FLP,STP,SFLP,FRP,KICK,
          THRP,I,HOLD,XT,HNUM,HDRAW,PTR,J,K,WHERE(3),DRAW,
          WHO,HIGH,ZONK,BRAK(2),FINH(2),RAI,HC(2,2)) FIXED BIN(31);
         DCL RANONLY FIXED BIN(31);
         DCL (TRIP,FOUR,FULL,DRO,TIE,LT) BIT(1);
         DCL (LIMIT,BET,TOTAL(2),POT,HBT) FIXED BIN(31,4);
         DCL CALD FLOAT DEC(6);
      DCL KLOCK OPTIONS(ASM INTER) EXTERNAL ENTRY(FIXED BIN(31));
         DCL NUB CHAR(1);
         DCL (ANS,NAME) VARYING CHAR(20);
        ON CONV BEGIN;
         DCL WITCH(7) LABEL INIT(B1,B2,NEXT,B3,B4,B5,T2);
         PUT SKIP LIST('I DIDN''T QUITE HEAR THAT');
         GO TO WITCH(KICK);
         END;
          /* SET RANDOM NUMBER GENERATOR */
        (NOFIXEDOVERFLOW):
         CALL KLOCK(RANONLY);
        (NOFIXEDOVERFLOW):
         RANONLY = RANONLY + 123759825;
         IF MOD(RANONLY,2)=0 THEN RANONLY = RANONLY +1;
          /* INITIALIZE DECK */
         DO I = 1 TO 52;
          DECK(I) = I - 1;
          END;
         TOTAL = 0;
         CALL FIRST;
         GET EDIT(NAME)(COL(1),A(20));
         CALL TRIM(NAME);
         IF LENGTH(NAME)=0 THEN DO;
          PUT SKIP LIST('THAT ISN''T MUCH OF A NAME, KID');
          NAME = 'KID';
          END;
        KICK = 7;
    T2: PUT SKIP(2) LIST('WHAT IS THE ANTE - LIMIT?');
         GET EDIT(ANS)(COL(1),A(20));
         GET STRING(ANS) LIST(LIMIT);
         IF ((LIMIT>5)×(LIMIT<0)) THEN DO;
          PUT SKIP LIST('THATS TOO HIGH STAKES FOR ME!');
          PUT SKIP LIST('THE LIMIT IS $5.00');
          LIMIT = 5;
          END;

 GAME:   POT = 0;

 TYGM:   DO I = 52 TO 2 BY -1;
          XT = TRUNC(RAND*I)+1;
         HOLD = DECK(I);
          DECK(I) = DECK(XT);
          DECK(XT) = HOLD;
          END;
         PUT SKIP EDIT('ALRIGHT ',NAME,' WE ANTE UP $',LIMIT)
          (A,A,A,F(4,2));
         POT = POT + 2 * LIMIT;
         DO I = 1 TO 2;
          TOTAL(I) = TOTAL(I) - LIMIT;
          END;
            /* DEAL CARDS */
         PTR = 11;
          DO I = 1 TO 5;
          DO J = 1 TO 2;
           HAND(J,I) = DECK(2*(I-1)+J);
           END;
           END;
         DO I = 1 TO 2;
          CALL SIFT(I);
          CALL SORT(HAND,I);
          CALL SORT(SUIT,I);
          CALL SORT(CARD,I);
          END;
         CALL OUTHAND(1);
         CALL ANALYSE(2);
         CALL PLAY(2);
         KICK = 1;
 B1:     PUT SKIP(2) LIST('WHAT IS YOUR BET?');
         GET EDIT(ANS)(COL(1),A(20));
         NUB = SUBSTR(ANS,1,1);
         IF ((NUB='')×(NUB=' ')) THEN GO TO B1;
         IF ((NUB='P')×(NUB='0')) THEN DO;
          CALL PASS(DRO);
          IF DRO THEN GO TO HDROP;
                 ELSE GO TO NEXT;
          END;
         IF NUB = 'D' THEN GO TO HDROP;
         GET STRING(ANS) LIST(HBT);
         IF ((HBT>LIMIT)×(HBT<0))THEN DO;
          PUT SKIP EDIT('THE LIMIT IS ',LIMIT)(A,F(4,2));
          GO TO B1;
          END;
         RAI = 1;
         TOTAL(1) = TOTAL(1) - HBT;
         TOTAL(2) = TOTAL(2) - HBT;
         POT = POT + 2 * HBT;
 REP:    IF BET<0 THEN CALL BLUFF(CALD,BET);
         IF BET = 0 THEN DO;
          PUT SKIP LIST('I CALL');
          GO TO NEXT;
          END;
         IF ((RAND>CALL**RAI)×(RAI>=3)) THEN DO;
          PUT SKIP LIST('I CALL');
          GO TO NEXT;
          END;
         PUT SKIP EDIT('I CALL AND RAISE YOU $',BET)
             (A,F(6,2));
         POT = POT + BET;
         TOTAL(2) = TOTAL(2) - BET;
         RAI = RAI + 1;
 B2: PUT SKIP LIST('DO YOU DROP,CALL, OR RAISE(HOW MUCH?)');
         KICK = 2;
         GET EDIT(ANS) (COL(1),A(20));
         NUB = SUBSTR(ANS,1,1);
         IF ((NUB='')×(NUB=' ')) THEN GO TO B2;
         IF NUB = 'D' THEN GO TO HDROP;
         IF ((NUB='C')×(NUB='0')) THEN DO;
          TOTAL(1) = TOTAL(1) -BET;
          POT = POT + BET;
          GO TO NEXT;
          END;
         IF NUB=' ' THEN GO TO B2;
         GET STRING(ANS) LIST(HBT);
         IF ((HBT>LIMIT)×(HBT<0)) THEN DO;
          PUT SKIP EDIT('THE LIMIT IS',LIMIT)(A,X(1),F(4,2));
          GO TO B2;
          END;
         TOTAL(1) = TOTAL(1) - (BET+HBT);
         TOTAL(2) = TOTAL(2) - HBT;
         POT = POT + (BET + 2 * HBT);
         GO TO REP;
 NEXT:   PUT SKIP(2) EDIT('HOW MANY CARDS DO YOU DRAW, ',NAME,'?')
             (A,A,A);
         PUT SKIP LIST('0, 1, 2, OR 3');
         KICK = 3;
         GET LIST(HNUM);
         IF ((HNUM>3)×(HNUM<0)) THEN DO;
          PUT SKIP LIST('YOU CAN ONLY DRAW 0, 1, 2, OR 3 CARDS');
          GO TO NEXT;
          END;
 B3:     PUT SKIP LIST('WHICH CARD NUMBERS DID YOU DISCARD?');
         KICK = 4;
         DO I = 1 TO HNUM;
          GET LIST(HDRAW);
         IF ((HDRAW>5)×(HDRAW<1)) THEN DO;
          PUT SKIP LIST('THAT''S NOT ONE OF THE CARDS');
          GO TO B3;
          END;
          HAND(1,HDRAW) = DECK(PTR);
         PTR = PTR + 1;
          END;
         IF HNUM=0 THEN PUT SKIP LIST('STICKING PAT, EH');
         PUT SKIP EDIT('I DRAW',DRAW,' CARDS')(A,F(3),A);
         DO I = 1 TO DRAW;
          HAND(2,WHERE(I))= DECK(PTR);
          PTR = PTR + 1;
          END;
         DO I = 1 TO 2;
          CALL SIFT(I);
          CALL SORT(HAND,I);
          CALL SORT(SUIT,I);
          CALL SORT(CARD,I);
          END;
         CALL OUTHAND(1);
         CALL ANALYSE(2);
         CALL PLAY(2);
 B4:      PUT SKIP(2) LIST('WHAT IS YOUR BET?');
         KICK = 5;
         GET EDIT(ANS)(COL(1),A(20));
         NUB = SUBSTR(ANS,1,1);
         IF ((NUB='')×(NUB=' ')) THEN GO TO B4;
         IF NUB = 'D' THEN GO TO HDROP;
         IF NUB = ' ' THEN GO TO B4;
         IF ((NUB='P')×(NUB='0')) THEN DO;
          CALL PASS(DRO);
          IF DRO THEN GO TO HDROP;
                 ELSE GO TO ANAL;
          END;
         GET STRING(ANS) LIST(HBT);
         IF ((HBT>LIMIT)×(HBT<0)) THEN DO;
          PUT SKIP EDIT('THE MAXIMUM BET IS $',LIMIT)
                   (A,A);
          GO TO B4;
          END;
         RAI = 1;
         ZONK = 0;
         TOTAL(1) = TOTAL(1) - HBT;
         POT = POT + HBT;
 REP2:   IF BET<0 THEN DO;
          ZONK = -BET;
          CALL BLUFF(CALD,BET);
          END;
         IF BET=0 THEN DO;
          PUT SKIP EDIT('I DROP, YOU WIN ',NAME)(A,A);
          GO TO CDROP;
          END;
         IF ((RAND>CALD)×(RAI>3)) THEN DO;
          IF ((ZONK=1)×(RAI>=3)×(WHO>1)) THEN DO;
           PUT SKIP LIST('I CALL');
           POT = POT + HBT;
           TOTAL(2) = TOTAL(2) - HBT;
           GO TO ANAL;
           END;
          ELSE DO;
           PUT SKIP LIST('I DROP YOU WIN');
           GO TO CDROP;
           END;
          END;
         ELSE DO;
          PUT SKIP EDIT('I CALL AND RAISE YOU $',BET)(A,F(4,2));
          POT = POT + BET + HBT;
          TOTAL(2) = TOTAL(2) - (BET+ HBT);
          RAI = RAI +1;
 B5:     PUT SKIP LIST('DO YOU DROP, CALL, OR RAISE(HOW MUCH?)');
         KICK = 6;
         GET EDIT(ANS)(COL(1),A(20));
         NUB = SUBSTR(ANS,1,1);
         IF ((NUB='')×(NUB=' ')) THEN GO TO B5;
         IF NUB = 'D' THEN GO TO HDROP;
         IF ((NUB='C')×(NUB='0')) THEN DO;
          TOTAL(1) = TOTAL(1) - BET;
          POT = POT + BET;
          GO TO ANAL;
          END;
         GET STRING(ANS) LIST(HBT);
         IF ((HBT>LIMIT)×(HBT<0)) THEN DO;
          PUT SKIP EDIT('YOU CAN ONLY BET UP TO $',LIMIT)
                (A,F(4,2));
          GO TO B5;
          END;
         TOTAL(1) = TOTAL(1) - (BET+HBT);
         POT = POT + BET + HBT;
         GO TO REP2;
           END;
 ANAL:   CALL SETUP(2);
         CALL ANALYSE(1);
         CALL PLAY(1);
         CALL SETUP(1);
         TIE = '0'B;
         IF FINH(2) > FINH(1) THEN GO TO COMWIN;
         IF FINH(2) < FINH(1) THEN GO TO HUMWIN;
         IF HC(2,1) > HC(1,1) THEN GO TO COMWIN;
         IF HC(2,1) < HC(1,1) THEN GO TO HUMWIN;
         TIE = '1'B;
         IF ((FINH(1)=3)×(FINH(1)=7)) THEN DO;
          IF HC(2,2) > HC(1,2) THEN GO TO COMWIN;
          IF HC(2,2) < HC(1,2) THEN GO TO HUMWIN;
          DO J = 1 TO 2;
          DO I = 1 TO 5;
          IF ((CARD(J,I)^=HC(J,1))&(CARD(J,I)^=HC(J,2)))THEN DO;
           BRAK(J) = CARD(J,I);
           GO TO A1;
           END;
           END;
  A1:      END;
          IF BRAK(2) > BRAK(1) THEN GO TO COMWIN;
          IF BRAK(2) < BRAK(1) THEN GO TO HUMWIN;
          GO TO TRUTY;
          END;
       IF ((FINH(1)=9)×(FINH(1)=6)×(FINH(1)=5)×(FINH(1)=1))THEN DO;
          DO I = 4 TO 1 BY -1;
           IF CARD(1,I) ^= CARD(2,I) THEN DO;
            BRAK(1) = CARD(1,I);
            BRAK(2) = CARD(2,I);
            GO TO OUT;
            END;
            END;
            GO TO TRUTY;
 OUT:      IF BRAK(2) > BRAK(1) THEN GO TO COMWIN;
                                  ELSE GO TO HUMWIN;
          END;
         IF ((FINH(1)=8)×(FINH(1)=2)×(FINH(1)=4)) THEN DO;
          LT = '1'B;
          DO J = 1 TO 2;
          DO I = 5 TO 1 BY -1;
           IF CARD(J,I)^=HC(J,1)THEN DO;
            LT = '0'B;
            BRAK(J) = CARD(J,I);
            GO TO DD;
            END;
           END;

 DD:       END;
          IF LT THEN GO TO TRUTY;
          IF HC(2,1) > HC(1,1) THEN GO TO COMWIN;
                               ELSE GO TO HUMWIN;
          END;
 COMWIN:  CALL OUTHAND(2);
         TOTAL(2) = TOTAL(2) + POT;
         PUT SKIP(2) EDIT('MY ',SHOWHAND(FINH(2),HC,2))(A,A);
         IF TIE THEN DO;
          HC(2,1) = BRAK(2);
          PUT SKIP EDIT('WITH A ',SHOWHAND(1,HC,2))(A,A);
          END;
         PUT SKIP EDIT('BEATS YOUR ',SHOWHAND(FINH(1),HC,1))(A,A);
         IF TIE THEN DO;
          HC(1,1) = BRAK(1);
          PUT SKIP EDIT('WITH A ',SHOWHAND(1,HC,1))(A,A);
          END;
         PUT SKIP(2) EDIT('SO I WIN THE $',POT,' POT.')
               (A,F(6,2),A);
         CALL SCORE;
         GO TO AGN;
 HUMWIN: CALL OUTHAND(2);
         TOTAL(1) = TOTAL(1) + POT;
         PUT SKIP(2) EDIT('YOUR ',SHOWHAND(FINH(1),HC,1))(A,A);
         IF TIE THEN DO;
          HC(1,1) = BRAK(1);
          PUT SKIP EDIT('WITH A ',SHOWHAND(1,HC,1))(A,A);
          END;
         PUT SKIP EDIT('BEATS MY ',SHOWHAND(FINH(2),HC,2))(A,A);
         IF TIE THEN DO;
          HC(2,1) = BRAK(2);
          PUT SKIP EDIT('WITH A ',SHOWHAND(1,HC,2))(A,A);
          END;
          PUT SKIP(2) EDIT('SO YOU WIN THE $',POT,' POT')
                 (A,F(6,2),A);
          CALL SCORE;
          GO TO AGN;
 HDROP:   PUT SKIP(2) EDIT('SINCE YOU DROP, I WIN THE $',
              POT,' POT')(A,F(6,2),A);
          TOTAL(2) = TOTAL(2) + POT;
         CALL SCORE;
         GO TO AGN;
 CDROP: PUT SKIP EDIT('YOU WIN THE $',POT,' POT')(A,F(6,2),A);
         TOTAL(1) = TOTAL(1) + POT;
         CALL SCORE;
         GO TO AGN;
 TRUTY:  CALL OUTHAND(2);
         PUT SKIP(2) EDIT('WE HAVE A TIE!!')(A);
         PUT SKIP LIST('THE POT STAYS AND WE PLAY AGAIN.');
         PUT SKIP LIST('WINNER TAKE ALL!!');
         GO TO TYGM;

 AGN:    PUT SKIP LIST('DO YOU WANT TO PLAY ANOTHER HAND?');
         GET EDIT(ANS)(COL(1),A(10));
         IF SUBSTR(ANS,1,1) = 'Y' THEN GO TO GAME;
         IF TOTAL(1) >0 THEN
     PUT SKIP EDIT('COME BACK SOON ',NAME,' SO I CAN WIN BACK',
         ' SOME OF MY MONEY.')(A,A,A,A);
          ELSE
     PUT SKIP EDIT('COME BACK AND PLAY AGAIN SOMETIME ',NAME)
          (A,A);
         RETURN;
     SIFT: PROCEDURE(T);
         DCL (T,I) FIXED BIN(31);
         DO I = 1 TO 5;
          SUIT(T,I) = HAND(T,I)/13;
          CARD(T,I) = MOD(HAND(T,I),13);
          END;
         RETURN;
         END;
     SORT: PROCEDURE(CA,T);
         DCL (HOLD,T,CA(*,*)) FIXED BIN(31);
         DCL (J,K) FIXED BIN(15);
         DO J = 4 TO 1 BY -1;
         DO K = 1 TO J;
          IF (CA(T,K)>CA(T,K+1)) THEN DO;
           HOLD = CA(T,K+1);
           CA(T,K+1) = CA(T,K);
           CA(T,K) = HOLD;
           END;
           END;
           END;
           RETURN;
           END;
     RED: PROCEDURE(N,S,C);
         DCL (N,P,Q) FIXED BIN(31);
         DCL (S,C) VARYING CHAR(10);
         DCL (SUIT(0:3),CARD(0:12)) VARYING CHAR(10);
         CARD(0) = 'TWO';
         CARD(1) = 'THREE';
         CARD(2) = 'FOUR';
         CARD(3) = 'FIVE';
         CARD(4) = 'SIX';
         CARD(5) = 'SEVEN';
         CARD(6) = 'EIGHT';
         CARD(7) = 'NINE';
         CARD(8) = 'TEN';
         CARD(9) = 'JACK';
         CARD(10) = 'QUEEN';
         CARD(11) = 'KING';
         CARD(12) = 'ACE';
         SUIT(0) = 'HEARTS';
         SUIT(1) = 'DIAMONDS';
         SUIT(2) = 'CLUBS';
         SUIT(3) = 'SPADES';
        P = N/13;
        Q = MOD(N,13);
        S = SUIT(P);
        C = CARD(Q);
         RETURN;
         END;
     OUTHAND: PROCEDURE(T);
         DCL (T,I) FIXED BIN(31);
         DCL (ST,CD) VARYING CHAR(10);
         DCL ZTX VARYING CHAR(9);
         IF T = 1 THEN ZTX = 'YOUR HAND';
                  ELSE ZTX = 'MY HAND';
         PUT SKIP(2) LIST(ZTX);
         PUT SKIP LIST('CARD #');
         DO I = 1 TO 5;
          CALL RED(HAND(T,I),ST,CD);
          PUT SKIP EDIT(I,' ',CD,' OF ',ST)(F(6),A,A,A,A);
          END;
         RETURN;
         END;
     ANALYSE: PROCEDURE(T);
         DCL (DAK,T,IA,IB,I) FIXED BIN(31);
         FLUSH=0; STRT=1; STRFL=0; PAIR=0; PR=0;
         FLP=0; STP=0; SFLP=0; FRP=0; THRP=0;
         TRIP='0'B; FULL='0'B; FOUR='0'B;
          /* FLUSH CHECK */
         DO IA = 1 TO 3;
         DO IB = IA TO 5;
          IF (SUIT(T,IA) = SUIT(T,IB)) THEN FLUSH=FLUSH+1;
                                       ELSE GO TO CHKF;
          END;
 CHKF:   IF FLUSH >= 3 THEN DO;
           FLP = IA;
           GO TO STRAI;
           END;
            ELSE FLUSH = 0;
          END;
          /* STRAIGHT CHECK */
 STRAI:  DO IA = 1 TO 3;
         DO IB = IA TO 5;
          IF (CARD(T,IB) = CARD(T,IB+1)-1) THEN STRT=STRT+1;
               ELSE GO TO CHKST;
           END;
 CHKST: IF STRT >= 3 THEN DO;
          STP = IA;
          GO TO STRFLU;
          END;
            ELSE STRT = 1;
          END;
 STRFLU: IF ((STP=FLP)&(STP>0)) THEN DO;
          STRFL = MIN(STRT,FLUSH);
          END;
          /* 4 OF A KIND */
         DO I = 1 TO 2;
          IF (CARD(T,I) = CARD(T,I+3)) THEN DO;
           FOUR = '1'B;
           FRP = I;
           RETURN;
           END;
          END;
         /* THREE OF A KIND */
         DO I = 1 TO 3;
          IF (CARD(T,I) = CARD(T,I+2)) THEN DO;
           TRIP = '1'B;
           THRP = I;
           GO TO HOUSE;
           END;
         END;
          /* FULL HOUSE */
 HOUSE:  IF TRIP THEN DO;
          IF (THRP=1) THEN DO;
           IF (CARD(T,4)=CARD(T,5)) THEN FULL = '1'B;
           END;
          IF THRP = 3 THEN DO;
           IF(CARD(T,1)=CARD(T,2))THEN FULL='1'B;
           END;
          RETURN;
          END;
           /* PAIRS */
         DAK = 1;
         DO I = 1 TO 4;
          IF ( CARD(T,I) = CARD(T,I+1)) THEN DO;
           PAIR = PAIR + 1;
           PR(DAK) = I;
           DAK = DAK + 1;
           END;
          END;
          RETURN;
          END;
 (NOFIXEDOVERFLOW):
     RAND: PROCEDURE RETURNS(FLOAT BIN(31));
        DCL YFL FLOAT BIN(31);
         RANONLY = RANONLY * 65539;
         IF RANONLY<0 THEN RANONLY = RANONLY + 2147483647+1;
         YFL = RANONLY;
         YFL = YFL * .4656613E-9;
         RETURN(YFL);
         END;
     PLAY: PROCEDURE(T);
         DCL (T,CTT,DAK,DYS,EJL,I) FIXED BIN(31);
         BET=0; DRAW=0; CALD=0;WHERE=0; WHO=0; HIGH=0;
          /* STRAIGHT FLUSH */
         IF STRFL = 5 THEN DO;
          BET = LIMIT;
          CALD = 1;
          DRAW = 0;
          WHO = 9;
          HIGH = CARD(T,5);
          RETURN;
         END;
          /* 4 OF A KIND */
         IF FOUR THEN DO;
          BET = LIMIT;
          CALD = 1;
          DRAW = 1;
          WHO = 8;
          HIGH = CARD(T,FRP);
          DO I = 1 TO 5;
           IF (MOD(HAND(T,I),13)^=CARD(T,FRP)) THEN DO;
            WHERE(1) = I;
            RETURN;
            END;
           END;
          END;
          /* FULL HOUSE */
         IF FULL THEN DO;
          BET = LIMIT;
          CALD = 1;
          DRAW = 0;
          WHO = 7;
          HIGH = CARD(T,THRP);
          RETURN;
          END;
           /* FLUSH */
         IF FLUSH=5 THEN DO;
          IF ((STRT=4)&(STP=1)&(CARD(T,5)=12)&(CARD(T,4)=3))
           THEN DO;
           WHO = 9;
           BET = LIMIT;
           DRAW = 0;
           CALD = 1;
           HIGH = CARD(T,4);
           RETURN;
           END;
          BET=LIMIT;
          CALD=1;
          DRAW=0;
          WHO=6;
          HIGH = CARD(T,5);
          RETURN;
          END;
           /* STRAIGHT */
         IF STRT=5 THEN DO;
          BET=LIMIT;
          CALD=.95;
          DRAW=0;
          WHO=5;
          HIGH= CARD(T,5);
          RETURN;
          END;
            /* THREE OF A KIND */
         IF TRIP THEN DO;
          BET=LIMIT;
          CALD=.9;
          DRAW=2;
          WHO=4;
          HIGH = CARD(T,THRP);
          CTT=1;
          DO I = 1 TO 5;
           IF (MOD(HAND(T,I),13)^=CARD(T,THRP))THEN DO;
            WHERE(CTT) = I;
            CTT = CTT + 1;
            END;
           END;
          RETURN;
          END;
            /* TWO PAIR */
         IF PAIR=2 THEN DO;
          DRAW=1;
          WHO=3;
          HIGH=MAX(CARD(T,PR(1)),CARD(T,PR(2)));
          DO I = 1 TO 5;
           DYS = MOD(HAND(T,I),13);
           IF((DYS^=CARD(T,PR(1)))&(DYS^=CARD(T,PR(2))))
                 THEN WHERE(1) = I;
           END;
          IF HIGH>7 THEN DO;
           BET = LIMIT;
           CALD = .9;
           RETURN;
           END;
          IF HIGH>2 THEN DO;
           BET = .75 * LIMIT;
           CALD = .85;
           RETURN;
           END;
         BET = .5 * LIMIT;
         CALD = .7;
         END;
            /* ONE PAIR */
         IF PAIR=1 THEN DO;
          DRAW=3;
          CTT= 1;
          HIGH = CARD(T,PR(1));
          WHO = 2;
          DO I = 1 TO 5;
           IF (MOD(HAND(T,I),13)^= CARD(T,PR(1)))THEN DO;
           WHERE(CTT) = I;
           CTT = CTT+1;
            END;
            END;
          IF HIGH>8 THEN DO;
           BET = .75 * LIMIT;
           CALD = .7;
           RETURN;
           END;
          IF HIGH>3 THEN DO;
           BET = .5 * LIMIT;
           CALD = .6;
           RETURN;
           END;
          BET = -1;
          CALD=0;
          RETURN;
          END;
           /* NOT MUCH */
         IF FLUSH=4 THEN DO;
         IF ((STP=1)&(CARD(T,5)=12)&(CARD(T,4)=3)) THEN DO;
          WHO = 5;
          BET = LIMIT;
          CALD = .95;
          DRAW = 0;
          HIGH = CARD(T,4);
          RETURN;
          END;
          DRAW = 1;
          WHO = 1;
          BET = -2;
          CALD = 0;
          HIGH = CARD(T,5);
          IF FLP=1 THEN WHERE(1) = 5;
          IF FLP=2 THEN WHERE(1) = 1;
          RETURN;
          END;
         IF STRT=4 THEN DO;
         IF ((STP=1)&(CARD(T,5)=12)&(CARD(T,4)=3)) THEN DO;
          WHO = 5;
          BET = LIMIT;
          CALD = .95;
          DRAW = 0;
          HIGH = CARD(T,4);
          RETURN;
          END;
          IF((RAND>.9)&(CARD(T,5)=12)) THEN GO TO ZILCH;
          DRAW = 1;
          BET = -2;
          WHO = 1;
          HIGH = CARD(T,5);
          CALD = 0;
          IF STP=1 THEN DYS=5;
          IF STP=2 THEN DYS=1;
          DO I = 1 TO 5;
           IF (MOD(HAND(T,I),13)=CARD(T,DYS)) THEN DO;
            WHERE(1) = I;
            RETURN;
            END;
          END;
          END;
         IF FLUSH=3 THEN DO;
          IF ((RAND>.75)&(CARD(T,5)>=11)) THEN GO TO ZILCH;
           DRAW = 2;
           BET = -3;
           WHO = 1;
           HIGH = CARD(T,5);
          CALD = 0;
          IF FLP=1 THEN DO;
           WHERE(1) = 4;
           WHERE(2) = 5;
          END;
          IF FLP=2 THEN DO;
           WHERE(1) = 1;
           WHERE(2) = 5;
           END;
          IF FLP=3 THEN DO;
           WHERE(1) = 1;
           WHERE(2) = 2;
           END;
          RETURN;
          END;
         IF STRT=3 THEN DO;
          IF ((RAND>.64)&(CARD(T,5)>=11)) THEN GO TO ZILCH;
          EJL = 1;
          DRAW = 2;
          BET = -3;
           WHO = 1;
          HIGH = CARD(T,5);
          CALD = 0;
          IF STP=1 THEN DO;
           CTT = 4;
           DYS = 5;
           END;
          IF STP = 2 THEN DO;
           CTT = 1;
           DYS = 5;
           END;
          IF STP=3 THEN DO;
           CTT = 1;
           DYS = 2;
           END;
          DO I = 1 TO 5;
           DAK = MOD(HAND(T,I),13);
           IF ((DAK=CARD(T,CTT))×(DAK=CARD(T,DYS))) THEN DO;
            WHERE(EJL) = I;
            EJL = EJL + 1;
            END;
           END;
          RETURN;
          END;
           /* NOTHING */

 ZILCH:  DRAW = 3;
         BET = -4;
         WHO = 1;
         HIGH = CARD(T,5);
         CALD = 0;
         CTT = 1;
         DO I = 1 TO 5;
          DAK = MOD(HAND(T,I),13);
          IF ((DAK^=CARD(T,5))&(DAK^=CARD(T,4))) THEN DO;
           WHERE(CTT) = I;
           CTT = CTT + 1;
           END;
         END;
         RETURN;
         END;
     LOOK: PROCEDURE(MX,T);
         DCL (MX,T,I) FIXED BIN(31);
         DO I = 1 TO 5;
          IF (MOD(HAND(T,I),13) = MX) THEN DO;
           MX = HAND(T,I);
          RETURN;
          END;
          END;
          END;
     SHOWHAND: PROCEDURE(W,X,Z) RETURNS(VARYING CHAR(40));
         DCL (W,X(*,*),Z) FIXED BIN(31);
         DCL OUT VARYING CHAR(40);
         DCL (CR,SR) VARYING CHAR(10);
         DCL HND(9) LABEL INIT(A,B,C,D,E,F,G,H,I);
         CALL LOOK(X(Z,1),Z);
         CALL RED(X(Z,1),SR,CR);
         GO TO HND(W);
 A:      OUT = CR ×× ' OF ' ×× SR;
         RETURN(OUT);
 B:      OUT= 'PAIR OF ' ×× CR ×× 'S';
         RETURN(OUT);
 C:      OUT = '2 PAIR: ' ×× CR ×× 'S AND ';
         CALL LOOK(X(Z,2),Z);
         CALL RED(X(Z,2),SR,CR);
         OUT = OUT ×× CR ×× 'S';
         RETURN(OUT);
 D:      OUT = 'THREE ' ×× CR  ×× 'S';
         RETURN(OUT);
 E:      OUT = CR ×× ' HIGH STRAIGHT';
         RETURN(OUT);
 F:      OUT = CR ×× ' HIGH FLUSH IN ' ×× SR;
         RETURN(OUT);

 G:      OUT = 'FULL HOUSE: ' ×× CR ×× 'S OVER ';
         CALL LOOK(X(Z,2),Z);
         CALL RED(X(Z,2),SR,CR);
         OUT = OUT ×× CR ×× 'S';
         RETURN(OUT);
 H:      OUT = 'FOUR ' ×× CR ×× 'S';
         RETURN(OUT);
 I:      OUT =  CR ×× ' HIGH STRAIGHT FLUSH IN ' ×× SR;
         RETURN(OUT);
         END;
     SETUP: PROCEDURE(T);
         DCL (T,I) FIXED BIN(31);
         FINH(T) = WHO;
         HC(T,1) = HIGH;
         IF WHO=3 THEN DO;
          IF HIGH = CARD(T,PR(1)) THEN HC(T,2) = CARD(T,PR(2));
                                  ELSE HC(T,2) = CARD(T,PR(1));
        RETURN;
         END;
         IF WHO = 7 THEN DO;
         DO I = 5 TO 1 BY -1;
          IF (CARD(T,I) ^= HC(T,1)) THEN DO;
           HC(T,2) = CARD(T,I);
          RETURN;
          END;
          END;
          END;
          HC(T,2) = 0;
          RETURN;
         END;
     BLUFF: PROCEDURE(C,B);
         DCL C FLOAT DEC(6);
         DCL B FIXED BIN(31,4);
         DCL PROBS(4) FLOAT DEC(6) INIT(.4,.7,.8,.9);
         IF RAND>PROBS(-B) THEN DO;
          C = PROBS(TRUNC(4*RAND)+1);
 CDX:     B = 10 * ((RAND * LIMIT + .05)/10);
          IF B=0 THEN GO TO CDX;
          RETURN;
          END;
          ELSE DO;
           B = 0;
           C = 0;
           RETURN;
           END;
          END;
     SCORE: PROCEDURE;
         DCL ABC VARYING CHAR(6);
         IF TOTAL(1) >0 THEN ABC = 'UP $';
                        ELSE ABC = 'DOWN $';
         IF TOTAL(2) = 0 THEN PUT SKIP(2) LIST('YOU ARE EVEN');
           ELSE PUT SKIP EDIT('YOU ARE ',ABC,ABS(TOTAL(2)))
                (A,A,F(6,2));
         RETURN;
         END;
     PASS: PROCEDURE(QUIT);
         DCL QUIT BIT(1);
         IF BET < 0 THEN CALL BLUFF(CALD,BET);
         IF BET = 0 THEN DO;
          PUT SKIP LIST('I PASS TOO.');
          QUIT = '0'B;
          RETURN;
          END;
         PUT SKIP EDIT('I BET $',BET)(A,F(6,2));
         POT = POT + BET;
          TOTAL(2) = TOTAL(2) - BET;
  RND:   PUT SKIP LIST('DO YOU DROP OR CALL');
          GET EDIT (ANS)(COL(1),A(20));
          NUB = SUBSTR(ANS,1,1);
         IF ((NUB='')×(NUB=' ')) THEN GO TO RND;
         IF NUB = 'D' THEN DO;
          QUIT = '1'B;
          RETURN;
          END;
         IF NUB='C' THEN DO;
          QUIT = '0'B;
          POT = POT + BET;
         TOTAL(1) = TOTAL(1) - BET;
         RETURN;
          END;
         PUT SKIP EDIT('YOU CAN ONLY DROP OR CALL AFTER',
            ' HAVING PASSED ',NAME)(A,A,A);
         GO TO RND;
         END;
     TRIM: PROCEDURE(MTX);
         DCL MTX VARYING CHAR(*);
         DCL I FIXED BIN(15);
         DO I = LENGTH(MTX) TO 1 BY -1;
          IF SUBSTR(MTX,I,1)^=' ' THEN GO TO POTS;
          END;
 POTS:   MTX = SUBSTR(MTX,1,I);
         RETURN;
         END;
     FIRST: PROCEDURE;
         DCL I FIXED BIN(15);
         DCL OUT(7) VARYING CHAR(70) INIT(
 '   * * * TSO FIVE CARD DRAW * * *',
 ' SIT DOWN, MAKE YOURSELF COMFORTABLE AND WE''LL PLAY ALITTLE POKER.',
 'IF YOU WOULD LIKE TO SEE THE RULES OF THE GAME, ENTER RULES.',
 'IF YOU ONLY WISH TO SEE THE ANSWERING SYNTAX ENTER SYNTAX.',
 'IF YOU DON''T WISH TO SEE EITHER, ENTER NO.',
 ' AS I DON''T LIKE TO PLAY WITH STRANGERS, HOW ABOUT TELLING ME',
 'YOUR FIRST NAME.');
         PUT SKIP(2) LIST(OUT(1));
         PUT SKIP(2) LIST(OUT(2));
         DO I = 3 TO 5;
          PUT SKIP LIST(OUT(I));
          END;
         GET EDIT(ANS)(COL(1),A(20));
         NUB = SUBSTR(ANS,1,1);
         IF NUB='R' THEN CALL RULES;
         IF NUB='S' THEN CALL SYNTAX;
         PUT SKIP LIST(OUT(6));
         PUT SKIP LIST(OUT(7));
         RETURN;
         END;
     SYNTAX: PROCEDURE;
         DCL L FIXED BIN(15);
         DCL OUT(12) VARYING CHAR(70) INIT(
 '  SYNTAX OF TSO FIVE CARD DRAW',
 'WHEN ASKED TO BET YOU MAY ENTER DROP ÖD^ IF YOU WISH TO',
 'DROP OUT OF THIS HAND, OR PASS ÖP^ IF YOU WISH TO PASS, OR',
 'ANY AMOUNT YOU WISH TO BET BETWEEN ZERO AND THE LIMIT',
 'THE FORM OF THE WAGER IS D.DD (NO DOLLAR SIGN).  WHEN BETTING',
 'AN EVEN AMOUNT THE DECIMAL POINT AND ANY TRAILING ZEROS MAY',
 'BE DELETED.  WHEN ASKED TO DROP, CALL OR RAISE YOU MAY ENTER',
 'DROP ÖD^, OR CALL ÖC^ IF YOU WISH TO DROP OR MATCH THE',
 'WAGER THE COMPUTER HAS MADE.  YOU MAY ENTER A WAGER OF THE',
 'FORM MENTIONED ABOVE WHICH WILL BE IN ADDITION TO MATCHING',
 'THE COMPUTER''S WAGER. THE CARD NUMBERS YOU ARE ASKED FOR ARE',
 ' ENTERED ON 1 LINE WITH SPACES BETWEEN THEM.');
        DO L = 1 TO 12;
          PUT SKIP LIST(OUT(L));
          END;
         RETURN;
         END;
     RULES: PROCEDURE;
         DCL L FIXED BIN(15);
         DCL OUT(12) VARYING CHAR(70) INIT(
 '     FIVE CARD DRAW IS PLAYED AS FOLLOWS:',
 'FIVE CARDS ARE DEALT TO EACH PLAYER AND AN ANTE EQUAL TO THE LIMIT,',
 'WHICH IS THE MAXIMUM BET, IS PUT IN THE POT.  A ROUND OF BETTING',
 'THEN ENSUES WHERE IN ONE PLAYER BETS (OR PASSES, IN WHICH CASE',
 'IT IS THE OTHER PLAYERS CHANCE TO BET FIRST) AND THE OTHER',
 'PLAYER CAN THEN DROP OUT OF THE HAND , MATCH THE',
 'FIRST PLAYERS BET (CALL), OR RAISE THE FIRST PLAYERS WAGER',
 ' BY ANY AMOUNT FROM ZERO TO THE LIMIT.  EACH PLAYER THEN',
 'DISCARDS 0, 1, 2, OR 3 CARDS FROM HIS HAND AND DRAWS NEW CARDS',
 'FROM THE DECK.  ANOTHER ROUND OF BETTING THE ENSUES TERMINATING',
 'IN EITHER ONE PLAYER DROPING OUT OR A SHOW OF HANDS.  IN',
 'EITHER CASE THE WINNER TAKES THE POT.');
         DO L = 1 TO 12;
          PUT SKIP LIST(OUT(L));
          END;
         CALL SYNTAX;
         RETURN;
         END;
         END; /* END OF MAIN PROCEDURE */

PROC 0
CONTROL NOMSG
  FREE F(SYSPRINT SYSIN SYSPUNCH)
  ISPEXEC VGET (PDSN ODSN JPARM RPDISP PPROJ PLIB PTYPE PMEM OPROJ     -
OLIB                                                                   -
OTYPE OMEM)
DELETE JUSTIFY.REPORT
  CONTROL MSG
IF &RPDISP = T THEN ALLOC F(SYSPRINT) DS(*)
IF &RPDISP = B THEN ALLOC F(SYSPRINT) DS(JUSTIFY.REPORT) NEW           -
SPA(10,10)                                                             -
TR
IF &PDSN = THEN GOTO ALLIN
    ELSE ALLOC F(SYSIN) DS(&PDSN) SHR
GOTO ALLPUN
ALLIN:  +
    IF &PMEM = THEN ALLOC F(SYSIN) DS('&PPROJ..&PLIB..&PTYPE') SHR
       ELSE ALLOC F(SYSIN) DS('&PPROJ..&PLIB..&PTYPE(&PMEM)') SHR
ALLPUN:  +
    IF &ODSN = THEN GOTO AP
    ELSE ALLOC F(SYSPUNCH) DS(&ODSN) SHR
    GOTO DOIT
AP:     +
    IF &OMEM = THEN ALLOC F(SYSPUNCH) DS('&OPROJ..&OLIB..&OTYPE') SHR
       ELSE ALLOC F(SYSPUNCH) DS('&OPROJ..&OLIB..&OTYPE(&OMEM)') SHR
DOIT:   +
   WRITE ** INVOKING JUSTIFY
   $P JUSTIFY  '&JPARM'
   SET &LCC = &LASTCC
   IF &LCC EQ 0 THEN GOTO FREE
          WRITE JUSTIFY ENDED WITH CONDITION CODE = &LCC
          WRITE CC 20  = INVALID PARM
          WRITE CC 4   = SEQUENCING ERROR
          WRITE CC 8   = UNKNOWN ERROR SEE REPORT
FREE:  +
CONTROL NOMSG
  FREE F(SYSPRINT SYSIN SYSPUNCH)
  IF &LCC = 20 THEN EXIT
  IF &RPDISP = B THEN %GENPRINT DSN(JUSTIFY.REPORT) GPCLASS(8)

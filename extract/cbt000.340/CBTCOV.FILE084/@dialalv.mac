         TITLE 'LISTA FUNCTION '                               SS AUG86
*************************************************************  SS NOV85
*                                                              SS NOV85
*      LISTA  FUNCTION                                         SS NOV85
*                                                              SS NOV85
*************************************************************  SS NOV85
         SPACE 2
ISPLISTA DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SPACE 1
* HIERARCHICAL SUPPORT REMOVED                                 SS OCT88
         BAL   R2,ISPSETST              SET STATS PREV TABLE   SS AUG86
         CLI   SPFFUNST+2,C'P'          LISTA   PENDING PROC   SS AUG86
         BE    ISPLTA5                  YES, SET TO REPROCESS  SS AUG86
         L     R14,SPFVTPT         RELOAD VERB POINTER         SS JUL87
         SR    R15,R15             CLEAR FOR IC                SS JUL87
         IC    R15,$TLEX(R14)      SUB FUNCTION CODE           SS JUL87
         L     R15,ISPLTAAT(R15)   GET SUB FUC ADDR            SS JUL87
         BR    R15                      *                      SS JUL87
ISPLTAAT DS    0F                       *                      SS JUL87
         DC    A(ISPLTAAN)    0   NORMAL LISTA                 SS JUL87
         DC    A(ISPTSK00)    4   TASKLIB LIST                 SS JUL87
         DC    A(ISPLKLST)    8   LINKLIST (XA ONLY)           SS JUL87
ISPTSK00 DS    0F                       *                      SS JUL87
         CLI   SPFFUNST+2,C'I'   INACT                         SS JUL87
         BE    ISPTSK01          YES, BUILD NEW TABLE          SS JUL87
         TM    SPFTSVDF+1,X'02'  ALREADY HAVE LIST             SS JUL87
         BO    ISPLTA1           YES, DISPLAY IT               SS JUL87
ISPTSK01 DS    0H                       *                      SS JUL87
         LA    R1,ISPLSTAV        DEF VAR TABLE                SS NOV85
         BAL   R2,ISPVDEFX                                     SS NOV85
         OI    SPFPRBI2,X'02'    SET TASKLIB MODE              SS JUL87
         B     ISPLSTAR          SET UP TABLE                  SS JUL87
ISPLKLST DS    0F                       *                      SS JUL87
ISPLTAAN DS    0F                       *                      SS JUL87
         L     R15,SPFOPER      FIRST BLANK AFTER CMD          SS AUG86
ISPLTART DS    0F                       *                      SS DEC87
         LA    R14,30           MAX LENGTH                     SS AUG86
         LA    R1,ISPLSTAP      PARSE LIST                     SS AUG86
         BAL   R2,ISPPARSI      PARSE IT                       SS AUG86
         C     R15,ISPL8        RETURN CODE                    SS AUG86
         BH    ISPLSTAE         BAD KEYS                       SS DEC87
* DO VDEF                                                      SS NOV85
         LA    R1,ISPLSTAV        DEF VAR TABLE                SS NOV85
         BAL   R2,ISPVDEFX                                     SS NOV85
         CLI   SPFFUNST+2,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTA2            YES   *                      SS AUG86
         TM    SPFTBPF2,SPFTFUNC  AT FUNCTION?                 SS OCT88
         BO    ISPLTA1            YES, SKIP LISTA TEST         SS OCT88
         TM    SPFLAG4,SPFFFUN    AT FUNCTION?                ABL JAN87
         BO    ISPLTA1            YES, SKIP LISTA TEST        ABL JAN87
         CLI   SPFTBPFI+1,2       ALREADY AT LISTA             SS AUG86
         BE    ISPLSTAR           THEN REOPEN TABLE            SS AUG86
ISPLTA1  DS    0H                                             ABL JAN87
         LH    R1,SPFFUNLP+4      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAL   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,100            DISPLAY IF NO OPERANDS      ABL JAN87
         CLI   SPFPRRC,8          ANY OPERANDS?               ABL JAN87
         BER   R3                 NO, DISPLAY TABLE AS IS     ABL JAN87
         B     ISPLSTAR           REOPEN  TABLE                SS AUG86
ISPLTA2  DS    0H                       *                      SS AUG86
         LA    R1,15              PANEL E                      SS NOV85
         LNR   R1,R1              SET FOR SWAP                 SS AUG86
         BAL   R2,ISPSTKI         STACK IT                     SS NOV85
         B     ISPLSTAO           OPEN                         SS NOV85
ISPLSTAH DC    AL2(SPFLISTA-SPWRKC) HOME ADDRESS OFFSET        SS NOV85
ISPLSTAR DS    0H                                              SS NOV85
* RESET TB IF OPEN                                             SS NOV85
         BAL   R2,ISPTBEND                                     SS NOV85
ISPLSTAO DS    0H                                              SS NOV85
* OPEN TB                                                      SS NOV85
         MVC   SPFTBL,SPFCSUF    GET BASE NAME                 SS NOV85
         MVI   SPFTBL+2,C'A'     SET TO PDA                    SS NOV85
         XC    SPFTFLG1(4),SPFTFLG1                            SS NOV85
         XC    SPFTFF(2),SPFTFF                                SS NOV85
         LA    R15,0             NO KEY                        SS NOV85
         LA    R0,ISPLSTAN       VER NAMES                     SS NOV85
         BAL   R2,ISPTBOPN                                     SS NOV85
         BAL   R2,ISPSETST         ALSO INIT STATUS FLAG       SS AUG86
*   TEST PARSE OUTPUT                   *                      SS AUG86
         TM    SPFPRBI2,X'02'      TASK LIB PROCESSING         SS JUL87
         BZ    ISPTSK03                 *                      SS JUL87
         OI    SPFTSVDF+1,X'02'    SET TASK PROCESSING         SS JUL87
         XC    SPFPRBI1(2),SPFPRBI1 FORCE ALL OPTION           SS JUL87
         B     ISPLSTAF            DO IT                       SS JUL87
ISPTSK03 DS    0H                       *                      SS JUL87
         NI    SPFTSVDF+1,255-X'02' CLEAR OLD FLAG             SS JUL87
         OC    SPFPRBI,SPFPRBI     ANY BITS ON                 SS AUG86
         BZ    ISPLSTAD         NO KEYS SET DEFAULT            SS AUG86
         TM    SPFPRBI3,X'01'           ALL OPTION             SS AUG86
         BZ    *+10                     NO                     SS AUG86
         XC    SPFPRBI1(2),SPFPRBI1     YES, CLEAR ALL FLAGS   SS AUG86
         TM    SPFPRBI3,X'02'           SET DEFAULT            SS AUG86
         BZ    *+10                     NO                     SS AUG86
         MVC   SPFTSVDF(2),SPFPRBI1     SET NEW DEFAULTS       SS AUG86
         B     ISPLSTAF                 CONTINUE               SS AUG86
ISPLSTAD DS    0H                       *                      SS AUG86
         MVC   SPFPRBI1(2),SPFTSVDF     GET DEFAULTS           SS AUG86
ISPLSTAF DS    0H                       *                      SS AUG86
* SET UP DSAB SCAN                                             SS NOV85
         L     R2,16              CVT                          SS NOV85
         L     R2,0(,R2)          ACT TCB PT                   SS NOV85
         L     R2,4(,R2)          ACT TCB                      SS NOV85
         TM    SPFTSVDF+1,X'02'   TASKLIB REQUEST              SS JUL87
         BZ    ISPTSK90                 *                      SS JUL87
ISPTSK02 DS    0H                       *                      SS JUL87
         ST    R2,SPFTKTCB       SAVE TCB ADDRESS              SS JUL87
         L     R1,12(,R2)        TIOT ADDRESS                  SS JUL87
         ICM   R2,15,X'28'(R2)   TASK DCB                      SS JUL87
         BZ    ISPLSTAX          NO MORE DCBS, DONE            SS JUL87
         LH    R2,X'28'(,R2)     TIOT OFFSET                   SS JUL87
         LA    R2,0(R1,R2)       TIOT ENTRY                    SS JUL87
         MVC   SPFADDNM,4(R2)    COPY DDNAME                   SS JUL87
         LA    R14,SPFADDNM      POINT TO DDNAME               SS JUL87
         BAL   R2,ISPFDSAB       FIND DSAB                     SS JUL87
         ST    R1,SPFATMP1       SAVE DSAB ADDRESS             SS JUL87
         B     ISPLSTAL          PROCESS IT                    SS JUL87
ISPTSK10 DS    0H                       *                      SS JUL87
         L     R2,SPFTKTCB       RELOAD TCB ADDRESS            SS JUL87
         L     R1,X'28'(,R2)     RELOAD DCB ADDRESS            SS JUL87
ISPTSK11 ICM   R2,15,X'84'(R2)   MOTHER TASK                   SS JUL87
         BZ    ISPLSTAX          ZERO ADDRESS, DONE            SS JUL87
         C     R1,X'28'(,R2)     SAVE DCB ADDRESS              SS JUL87
         BE    ISPTSK11          YES, TRY NEXT                 SS JUL87
         B     ISPTSK02          NEW ONE, PRECESS IT           SS JUL87
ISPTSK90 DS    0H                       *                      SS JUL87
         L     R2,TCBJSCB-TCBRBP(R2)     JSCB                  SS NOV85
         L     R2,JSCDSABQ-IEZJSCB(R2)   DSAB QUE              SS NOV85
         L     R2,12(,R2)                FIRST DSAB            SS NOV85
         ST    R2,SPFATMP1               SAVE TEMP             SS NOV85
* ADD DDN ENTRIES                                              SS NOV85
ISPLSTAL DS    0H                                              SS NOV85
         L     R2,SPFATMP1                                     SS NOV85
         LTR   R2,R2                                           SS NOV85
         BZ    ISPLSTAX           EXIT                         SS NOV85
         USING DSAB,R2                                         SS NOV85
         MVC   SPFAOPT,ISPBLK8                                 SS NOV85
         MVC   SPFADATA,ISPBLK8                                SS NOV85
         XC    SPFATFLG,SPFATFLG                               SS NOV85
         AIF   ('&MVSLEV' GE 'MVS220').MVS22A                  WW JUL88
         SR    R1,R1                                           SS NOV85
         ICM   R1,7,DSABSSVA     SIOT                          SS NOV85
         LA    R1,16(,R1)        OVER SWA HEADER               SS NOV85
         AGO   .MVS22AX                                        WW JUL88
.MVS22A  ANOP                                                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+4+2                NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+4+2               POINT AFTER BSM        SS JUL88
         O     R1,ISPX80                31 BIT MODE            SS JUL88
         BSM   0,R1                     SET MODE               SS JUL88
         L     R1,DSABSIOT              POINT TO SIOT          WW JUL88
.MVS22AX ANOP                                                  SS JUL88
         USING INDMSIOT,R1                                     SS NOV85
         MVC   SPFACLS,SCTOUTPN    SAVE SYSOUT CLASS           SS NOV85
         TM    SCTSBYT1,SCTDUMMY   DUMMY DATASET               SS NOV85
         BZ    *+8                                             SS NOV85
         OI    SPFATFLG,SPFANUCB   NO UCB                      SS NOV85
         TM    SCTSBYT2,SIOTCATL   CATALOG DATASET             SS NOV85
         BZ    ISPLSTA7                                        SS NOV85
         OI    SPFATFLG,SPFATYSE   GOT TYPE                    SS NOV85
         MVC   SPFATYPE,=C'CTLG'                               SS NOV85
ISPLSTA7 DS    0H                                              SS NOV85
* GET DISP AND CDSP FROM SIOT                                  SS JUL88
         MVC   SPFADISP(8),ISPBLK8  CLEAR DISP AND CDSP        SS NOV85
         TM    SCTSDISP,X'10'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'PASS'                               SS NOV85
         TM    SCTSDISP,X'08'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'KEEP'                               SS NOV85
         TM    SCTSDISP,X'04'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'DLET'                               SS NOV85
         TM    SCTSDISP,X'02'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'CTLG'                               SS NOV85
         TM    SCTSDISP,X'01'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'UNCT'                               SS NOV85
         TM    SIOTALTD,X'08'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'KEEP'                               SS NOV85
         TM    SIOTALTD,X'04'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'DLET'                               SS NOV85
         TM    SIOTALTD,X'02'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'CTLG'                               SS NOV85
         TM    SIOTALTD,X'01'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'UNCT'                               SS NOV85
         AIF   ('&MVSLEV' LT 'MVS220').MVS22B                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+2                  NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+2                 POINT AFTER BSM        SS JUL88
         BSM   0,R1                     SET MODE 24            SS JUL88
.MVS22B  ANOP                                                  SS JUL88
         L     R1,DSABTIOT                                     SS NOV85
         USING TIOENTRY,R1                                     SS NOV85
         ST    R1,SPFATMP2        SAVE TIOT ADDR               SS NOV85
         TM    SPFTSVDF+1,X'02'   TASK LIB LIST                SS JUL87
         BZ    ISPTSK20           NO, NORMAL PROCESSING        SS JUL87
         CLC   TIOEDDNM,ISPBLK8   CONCAT                       SS MAY88
         BE    ISPTSK22           YES CONTINUE                 SS MAY88
         CLC   SPFADDNM,TIOEDDNM  NEXT  DDNAME                 SS JUL87
         BNE   ISPTSK10           DIFFERENT, MUST BE NEW       SS JUL87
ISPTSK20 DS    0H                       *                      SS JUL87
         CLC   TIOEDDNM,ISPBLK8   CONCAT                       SS MAY88
         BE    ISPTSK22           YES CONTINUE                 SS MAY88
         MVC   SPFADDNM,TIOEDDNM                               SS JUL87
         LA    R0,1                   CONCAT COUNT = 1         SS MAY88
         STH   R0,SPFACCNT            SET                      SS MAY88
         B     ISPTSK28                 *                      SS MAY88
ISPTSK22 DS    0H                       *                      SS MAY88
         MVC   SPFADDNM,ISPBLK8         *                      SS MAY88
         MVI   SPFADDNM+2,C'#'        FOR CONCAT               SS MAY88
         LH    R1,SPFACCNT            LAST COUNT               SS MAY88
         LA    R1,1(,R1)              ONE MORE                 SS MAY88
         STH   R1,SPFACCNT            NEW COUNT                SS MAY88
         BAL   R2,ISPDECCV            DEC NUMBER               SS MAY88
         MVC   SPFADDNM+5,SPFDCNV3    3 DIGIT NUMBER           SS MAY88
         L     R2,SPFATMP1            RELOAD DSAB ADDR         SS MAY88
         L     R1,DSABTIOT            RELOAD TIOT ADDR         SS MAY88
ISPTSK28 DS    0H                       *                      SS MAY88
         ICM   R0,B'1110',DSABFLG1    FLAGS                    SS NOV85
         ICM   R0,B'0001',TIOELINK    FLAGS                    SS NOV85
         LR    R1,R0                                           SS NOV85
         BAL   R2,ISPHEXCV                                     SS NOV85
         MVC   SPFAFLAG(8),SPFHEXCV                            SS NOV85
         L     R2,SPFATMP1                                     SS NOV85
         MVC   SPFAOCNT,ISPBLK8                                SS NOV85
         LH    R1,DSABOPCT        OPEN COUNT                   SS NOV85
         CH    R1,=H'9'                                        SS NOV85
         BH    ISPLSTA9                                        SS NOV85
         MVC   SPFAOCNT(1),DSABOPCT+1   MOVE NUMBER            SS NOV85
         OI    SPFAOCNT,X'F0'           FIX NUMERIC ZONE       SS NOV85
         B     *+8                                             SS NOV85
ISPLSTA9 MVI   SPFAOCNT,C'*'           ALLOC OVER 9            SS NOV85
         L     R2,SPFATMP1                                     SS NOV85
         TM    SPFATFLG,SPFATYSE                               SS NOV85
         BO    ISPLSTA8                                        SS NOV85
         LA    R1,DSABORG         DSORG                        SS NOV85
         BAL   R2,ISPDSORG                                     SS NOV85
         STCM  R0,15,SPFATYPE                                  SS NOV85
ISPLSTA8 DS    0H                                              SS NOV85
         AIF   ('&MVSLEV' GE 'MVS220').MVS22C                  WW JUL88
         L     R1,SPFATMP2        TIOT ENT ADDR                SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R2,7,TIOEJFCB                                   SS NOV85
         LA    R2,16(,R2)        OVER HEADER                   SS NOV85
         AGO   .MVS22CX                                        WW JUL88
.MVS22C  ANOP                                                  WW JUL88
         L     R2,SPFATMP1              DSAB ADDR              WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+4+2                NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+4+2               POINT AFTER BSM        SS JUL88
         O     R1,ISPX80                31 BIT MODE            SS JUL88
         BSM   0,R1                     SET MODE               SS JUL88
         L     R2,DSABSIOT              POINT TO SIOT          WW JUL88
         L     R2,SJFCBPTR-SIOT(R2)     JFCB ADDR              WW JUL88
.MVS22CX ANOP                                                  SS JUL88
         MVC   SPFADSN,JFCBDSNM-JFCB(R2)                       SS NOV85
         MVC   SPFAMEM,JFCBELNM-JFCB(R2)                       SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCNEW                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'NEW '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCMOD                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'MOD '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCOLD                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'OLD '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCSHARE                      SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'SHR '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCTEMP                       SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'TMP '                               SS NOV85
         AIF   ('&MVSLEV' LT 'MVS220').MVS22D                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+2                  NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+2                 POINT AFTER BSM        SS JUL88
         BSM   0,R1                     SET MODE 24            SS JUL88
         L     R1,SPFATMP2        RELOAD TIOT ADDRESS          SS JUL88
.MVS22D  ANOP                                                  SS JUL88
         L     R2,SPFATMP1        GET DSAB                     SS NOV85
         MVC   SPFASTAT,ISPBLK8                                SS NOV85
         TM    DSABFLG1,DSABPALC  PERMINENT                    SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFASTAT,=C'PRM '                               SS NOV85
         TM    DSABFLG1,DSABCONV  CONVERTABLE                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFASTAT,=C'CNV '                               SS NOV85
         TM    DSABFLG3,DSABVAM   VIO                          SS NOV85
         BZ    ISPLATAA                                        SS NOV85
         MVC   SPFATYPE,=C'VIO '                               SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         B     ISPLSTA5                                        SS NOV85
ISPLATAA DS    0H                                              SS NOV85
         TM    DSABFLG3,DSABCATL  THIS A CATALOG               SS NOV85
         BZ    ISPLATAB                                        SS NOV85
         MVC   SPFATYPE,=C'CTLG'                               SS NOV85
         OI    SPFATFLG,SPFATYSE                               SS NOV85
         B     ISPLSTA2                                        SS NOV85
ISPLATAB DS    0H                                              SS NOV85
         TM    DSABFLG3,DSABVVDS  THIS A CATALOG               SS NOV85
         BZ    ISPLATAC                                        SS NOV85
         MVC   SPFATYPE,=C'VVDS'                               SS NOV85
         OI    SPFATFLG,SPFATYSE                               SS NOV85
         B     ISPLSTA2                                        SS NOV85
ISPLATAC DS    0H                                              SS NOV85
         TM    TIOELINK,TIOESYOT  SYSOUT                       SS NOV85
         BZ    ISPLSTA1           NO TRY TERM                  SS NOV85
         MVC   SPFATYPE,=C'JES '                               SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         MVC   SPFAVOL,=CL6'CLS='                              SS NOV85
         MVC   SPFAVOL+5(1),SPFACLS                            SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA1 DS    0H                                              SS NOV85
         TM    TIOELINK,TIOTTERM                               SS NOV85
         BZ    ISPLSTA2                                        SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         MVC   SPFATYPE,=C'TERM'                               SS NOV85
         B     ISPLSTA5                                        SS NOV85
ISPLSTA2 DS    0H                                              SS NOV85
         CLC   SPFADSN(8),=C'NULLFILE'                         SS NOV85
         BE    ISPLSTA5                                        SS NOV85
         TM    SPFATFLG,SPFANUCB                               SS NOV85
         BO    ISPLSTA5                                        SS NOV85
         SR    R2,R2                                           SS NOV85
         IC    R2,TIOELNGH                                     SS NOV85
         CH    R2,=H'20'         ONE DEV ENTRY LONG            SS NOV85
         BH    ISPLSTA3                                        SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R2,7,TIOEFSRT     UCB ADDR                      SS NOV85
         MVC   SPFAVOL,UCBVOLI-UCBOB(R2) GET VOLUME            SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA5 MVC   SPFAVOL,ISPBLK8                                 SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA3 MVC   SPFAVOL,=C'*MULT*'                              SS NOV85
ISPLSTA4 DS    0H                                              SS NOV85
         L     R2,SPFATMP1       RESET DSAB ADDR               SS NOV85
*        SR    R1,R1                                           SS AUG86
*        ICM   R1,7,DSABSSVA     SIOT                          SS AUG86
         CLI   SPFPRBI2,0               ANY OPTIONS?          ABL JAN87
         BNE   ISPLSA80                 YES, DO FILTERING     ABL JAN87
         CLI   SPFPRBI1,0               ANY OPTIONS?           SS AUG86
         BE    ISPLSTAU                 NO, DO TABLE UPDATE    SS AUG86
ISPLSA80 DS    0H                                             ABL JAN87
         TM    SPFPRBI1,X'80'           TEST OPEN              SS AUG86
         BZ    ISPLSA40                 *                      SS AUG86
         CLI   SPFAOCNT,C'0'            OPEN COUNT ZERO        SS AUG86
         BNE   ISPLSTAU                 NO, THEN OPEN          SS AUG86
ISPLSA40 TM    SPFPRBI1,X'40'           UNOPEN                 SS AUG86
         BZ    ISPLSA20                 *                      SS AUG86
         CLI   SPFAOCNT,C'0'            OPEN COUNT ZERO        SS AUG86
         BE    ISPLSTAU                 NO, THEN OPEN          SS AUG86
ISPLSA20 TM    SPFPRBI1,X'20'           CONCATENATED           SS AUG86
         BZ    ISPLSA10                 *                      SS AUG86
         TM    DSABFLG1,DSABCATM        CAT FLAG               SS AUG86
         BO    ISPLSTAU                 YES                    SS AUG86
ISPLSA10 TM    SPFPRBI1,X'10'           NONCATENATED           SS AUG86
         BZ    ISPLSA08                 *                      SS AUG86
         TM    DSABFLG1,DSABCATM        CAT FLAG               SS AUG86
         BZ    ISPLSTAU                 NO                     SS AUG86
ISPLSA08 TM    SPFPRBI1,X'08'           NULLFILE               SS AUG86
         BZ    ISPLSA04                 *                      SS AUG86
         CLC   SPFADSN(8),=C'NULLFILE'  NULLFILE               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA04 TM    SPFPRBI1,X'04'           ATTRIB                 SS AUG86
         BZ    ISPLSA02                 *                      SS AUG86
         CLC   SPFADSN(8),=C'NULLFILE'  NULLFILE               SS AUG86
         BNE   ISPLSA01                 NETHER TERM OR ATTRIB  SS AUG86
         CLC   SPFATYPE,=C'TERM'        TERMINAL               SS AUG86
         BNE   ISPLSTAU                 NO, JUST DUMMY         SS AUG86
         B      ISPLSA01                NOT TERMINAL           SS AUG86
ISPLSA02 TM    SPFPRBI1,X'02'           TERMINAL               SS AUG86
         BZ    ISPLSA01                 *                      SS AUG86
         CLC   SPFATYPE,=C'TERM'        TERMINAL               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA01 TM    SPFPRBI1,X'01'           TERMINAL               SS AUG86
         BZ    ISPLSA8X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFATYPE,=C'JES '        JES FILE               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA8X TM    SPFPRBI2,X'80'           TMP                    SS AUG86
         BZ    ISPLSA4X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'TMP '        TMP                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA4X TM    SPFPRBI2,X'40'           NEW                    SS AUG86
         BZ    ISPLSA2X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'NEW '        NEW                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA2X TM    SPFPRBI2,X'20'           MOD                    SS AUG86
         BZ    ISPLSA1X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'MOD '        MOD                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA1X TM    SPFPRBI2,X'10'           OLD                    SS AUG86
         BZ    ISPLSAX8                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'OLD '        OLD                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSAX8 TM    SPFPRBI2,X'08'           SHR                    SS AUG86
         BZ    ISPLSTAS                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'SHR '        SHR                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
         B     ISPLSTAS                 SKIP IT                SS AUG86
ISPLSTAU DS    0H                       *                      SS AUG86
         BAL   R2,ISPTBADD                                     SS NOV85
ISPLSTAS DS    0H                       *                      SS AUG86
         L     R2,SPFATMP1       RESET DSAB ADDR               SS NOV85
         L     R2,DSABFCHN                                     SS NOV85
         ST    R2,SPFATMP1       NEW   DSAB ADDR               SS NOV85
         B     ISPLSTAL          LOOP TO TOP                   SS NOV85
* RETURN TO TBDISPL                                            SS NOV85
ISPLSTAX DS    0H                                              SS NOV85
         LA    R15,1                                           SS NOV85
         ST    R15,SPFTTOP                                     SS NOV85
         ST    R15,SPFTTOP2                                    SS JUL87
         BAL   R2,ISPTOP                                       SS NOV85
         LA    R15,100           GO TO TBDISPL                 SS NOV85
         BR    R3                                              SS NOV85
         DROP  R1,R2                                           SS NOV85
ISPLSTAE DS    0H                                              SS NOV85
*        LA    R15,28       INVALID                            SS DEC87
*        BR    R3                                              SS DEC87
         MVC   SPFVZCMD(250),SPFINPUT COPY BAD COMMAND         SS DEC87
         LA    R15,ISPLTAPP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS DEC87
         BAL   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         C     R15,ISPL8          END KEY                      SS DEC87
         BE    ISPLTVQ3           RETURN TO FUNCTION CMD       SS DEC87
         MVC   SPFINPUT(250),SPFZSEL    COPY                   SS DEC87
         LA    R15,SPFINPUT             STARTING ADDRESS       SS DEC87
         LA    R14,30                   LENGTH                 SS DEC87
         LA    R1,C' '                  BLANK                  SS DEC87
         BAL   R2,ISPCLI                FIND BLANK AFTER CMD   SS DEC87
         B     ISPLTART                 RETRY                  SS DEC87
ISPLTA5  DS    0H                       *                      SS AUG86
         L     R15,SPFOPER              BLANK AFTER CMD        SS FEB89
         LA    R14,30                   SCAN FOR OPERAND       SS FEB89
         BAL   R2,ISPCKBLK                                     SS FEB89
         LTR   R15,R15                  ANY                    SS FEB89
         BNZ   ISPLTA1B                 YES, CANNOT PROCESS    SS FEB89
         LH    R1,SPFFUNLP+4      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAL   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,36             GO TO PENDING ACT PROC       SS AUG86
         BR    R3                                              SS NOV85
ISPLTA1B DS    0H                       *                      SS FEB89
         MVC   SPFMSGID,ISPPDSM         GENERIC MESSAGE        SS FEB89
         MVI   SPFMSGID+6,C'1'          PDSM..1B MESSAGE       SS FEB89
         MVI   SPFMSGID+7,C'B'          BUSY MSG               SS FEB89
         LA    R15,100                  TO DISPLAY             SS FEB89
         BR    R3                       RETURN TO ROUTER       SS FEB89
ISPLTAPP DC    CL8'&P.LALTA'            *                      SS OCT88
         LTORG ,                                               SS NOV85
ISPLSTAP DS    0F                                 MATCHES      SS AUG86
***                                               ============ SS AUG86
         DC    X'32',X'000001',CL8'ALL'           A/ALL        SS AUG86
         DC    X'31',X'800000',CL8'OPEN'          O/OP        ABL JAN87
         DC    X'21',X'400000',CL8'CLOSED'      **CL          ABL JAN87
         DC    X'31',X'400000',CL8'UNOPEN'      **U/UN         SS AUG86
         DC    X'21',X'200000',CL8'CATENATE'     *CA          ABL JAN87
         DC    X'21',X'200000',CL8'CONCAT'       *CO          ABL JAN87
         DC    X'22',X'100000',CL8'NONCON'      **NON          SS AUG86
         DC    X'22',X'100000',CL8'NONCAT'      **NON          SS AUG86
         DC    X'34',X'080000',CL8'DUMMY'        *D/DUMMY      SS AUG86
         DC    X'33',X'080000',CL8'NULLFILE'     *N/NULL       SS AUG86
         DC    X'23',X'040000',CL8'ATTRIB'        ATTR         SS AUG86
         DC    X'33',X'020000',CL8'TERMINAL'      T/TERM       SS AUG86
         DC    X'32',X'010000',CL8'JESFILE'       J/JES        SS AUG86
         DC    X'23',X'008000',CL8'TEMPORY'      *TEMP         SS AUG86
         DC    X'22',X'008000',CL8'TMP'          *TMP          SS AUG86
         DC    X'22',X'004000',CL8'NEW'           NEW          SS AUG86
         DC    X'22',X'002000',CL8'MOD'           MOD          SS AUG86
         DC    X'22',X'001000',CL8'OLD'           OLD          SS AUG86
         DC    X'22',X'000800',CL8'SHR'           SHR          SS AUG86
         DC    X'23',X'000200',CL8'TASKLIB'       SET          SS JUL87
         DC    X'22',X'000002',CL8'SETDEF'        SET         ABL JAN87
         DC    X'FF'                    *                      SS AUG86
         DC    X'23',X'000004',CL8'LNKLST'        SET          SS JUL87
         DS    0F                                              SS NOV85
ISPLSTAV DC    H'0',X'10',X'00'                                SS NOV85
         DC    A(VSPFADDN),AL2(SPFADDNM-SPWRKC),H'08'          SS NOV85
         DC    A(VSPFADSN),AL2(SPFADSN-SPWRKC),H'44'           SS NOV85
         DC    A(VSPFAVOL),AL2(SPFAVOL-SPWRKC),H'06'           SS NOV85
         DC    A(VSPFADSB),AL2(SPFADSAB-SPWRKC),H'04'          SS NOV85
         DC    A(VSPFAFLG),AL2(SPFAFLAG-SPWRKC),H'08'          SS NOV85
         DC    A(VSPFACNT),AL2(SPFACCNT-SPWRKC),H'02'          SS NOV85
         DC    X'FF'                                           SS NOV85
VSPFADDN DC    C'(PDSADDN PDSADATA PDSAMEM)'                   SS NOV85
VSPFADSN DC    C'PDSADSN '                                     SS NOV85
VSPFAVOL DC    C'PDSAVOL '                                     SS MAY88
VSPFADSB DC    C'(PDSADSAB PDSAOPT PDSATYPE PDSADISP PDSACDSP PDSAOCNT X
               PDSAALLC PDSASTAT)'                             SS NOV85
VSPFAFLG DC    C'PDSAFLAG '                                    SS NOV85
VSPFACNT DC    C'PDSACCNT '                                    SS NOV85
ISPLSTAN DC    C'(PDSAOPT PDSADDN PDSADATA PDSADSAB PDSATYPE PDSADISP  X
               PDSACDSP PDSAOCNT PDSAFLAG          PDSAVOL PDSADSN     X
               PDSAMEM PDSAALLC PDSASTAT PDSACCNT)'            SS MAY88
         SPACE 2
         TITLE 'LISTV FUNCTION '                               SS AUG86
*************************************************************  SS NOV85
*                                                              SS NOV85
*      LISTV  FUNCTION                                         SS NOV85
*                                                              SS NOV85
*************************************************************  SS NOV85
         SPACE 2
ISPLISTV DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SPACE 1
* HIERARCHICAL SUPPORT REMOVED                                 SS OCT88
         BAL   R2,ISPSETST              SET STATS PREV TABLE   SS AUG86
         CLI   SPFFUNST+3,C'P'          LISTV   PENDING ACT    SS AUG86
         BE    ISPLTVQ5                 YES, LET TBDSP REPROC  SS AUG86
         NI    SPFTSVDF+1,255-X'01'     CLEAR PROMPT FLAG      SS AUG86
*  DO PARSE ON LISTV COMMAND                                   SS NOV85
         L     R15,SPFOPER      FIRST BLANK AFTER CMD          SS NOV85
ISPLSTVH DS    0H                                              SS AUG86
         LA    R14,30           MAX LENGTH                     SS NOV85
         LA    R1,ISPLSTVP      PARSE LIST                     SS NOV85
         BAL   R2,ISPPARSI      PARSE IT                       SS NOV85
         C     R15,ISPL8        RETURN CODE                    SS NOV85
         BH    ISPLSTVE         ERROR                         ABL APR86
         BE    ISPLSTVQ         NO OPTIONS                     SS NOV85
*        TM    SPFPRBI,X'80'+X'40'  ADDR AND GROUP             SS NOV85
         TM    SPFPRBI,X'04'+X'40'  ADDR AND GROUP             SS MAR88
         BO    ISPLSTVK         BOTH ON, CONFLICT              SS NOV85
* CHECK FOR RANGE ON STRING LENGTH 2 OR 5 FOR ADDR OR VOL/GRP  SS NOV85
         LH    R1,SPFPRLN       GET LENGTH                     SS NOV85
         TM    SPFPRBI,X'40'    GROUP                          SS NOV85
         BZ    ISPLSTV2         NO                             SS NOV85
         CH    R1,=H'7'                                        SS NOV85
         BH    ISPLSTVW                                        SS NOV85
         B     ISPLSTV3                                        SS NOV85
ISPLSTV2 DS    0H                                              SS NOV85
         CH    R1,=H'5'         MAX                            SS NOV85
         BH    ISPLSTVW                                        SS NOV85
*        TM    SPFPRBI,X'40'    BY ADDRESS                     SS FEB88
         TM    SPFPRBI,X'04'    BY ADDRESS                     SS MAR88
         BZ    *+12                                            SS NOV85
         CH    R1,=H'2'         MUST BE LESS                   SS NOV85
         BH    ISPLSTVW                                        SS NOV85
ISPLSTV3 DS    0H                                              SS NOV85
         L     R14,SPFPRSR         STRING ADDRESS              SS NOV85
         OC    0(0,R14),ISPBLK8    <<EXECUTED>>                SS NOV85
         EX    R1,*-6              FORCE UPPER CASE            SS NOV85
* DO VDEF                                                      SS NOV85
         LA    R1,ISPLSTVV        DEF VAR TABLE                SS NOV85
         BAL   R2,ISPVDEFX                                     SS NOV85
* STACK 17                                                     SS NOV85
         CLI   SPFTBPFI+1,3       ALREADY AT LISTV?            SS AUG86
         BE    ISPLSTVR           THEN CHECK FOR RESET         SS AUG86
         CLI   SPFFUNST+3,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTV2            YES   *                      SS AUG86
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAL   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         B     ISPLSTVR           CHECK FOR RESET              SS AUG86
ISPLTV2  DS    0H                       *                      SS AUG86
         LA    R1,17              PANEL H                      SS NOV85
         LNR   R1,R1              SET FOR SWAP                 SS AUG86
         BAL   R2,ISPSTKI         STACK IT                     SS NOV85
         B     ISPLSTVO           OPEN                         SS NOV85
ISPLSTVR DS    0H                                              SS NOV85
*  RESET TB IS OPEN AND RESET OPTION                           SS NOV85
         TM    SPFPRBI,X'08'      RESET REQUEST                SS NOV85
         BZ    ISPLSTV1           NO, SKIP END AND OPEN        SS NOV85
         BAL   R2,ISPTBEND                                     SS NOV85
ISPLSTVO DS    0H                                              SS NOV85
* OPEN TB                                                      SS NOV85
         MVC   SPFTBL,SPFCSUF    GET BASE NAME                 SS NOV85
         MVI   SPFTBL+2,C'V'     SET TO PDV                    SS NOV85
         XC    SPFTFLG1(4),SPFTFLG1                            SS NOV85
         XC    SPFTFF(2),SPFTFF                                SS NOV85
*        TM    SPFPRBI,X'40'     ADDRESS ORDER                 SS FEB88
         TM    SPFPRBI,X'04'     ADDRESS ORDER                 SS MAR88
         BZ    ISPLSTVS          NO SORT IN VOL ORDER          SS AUG86
         LA    R15,ISPLSTVM      SORT LIST (BY ADDR)           SS AUG86
         B     ISPLSTVF          COMPLETE                      SS AUG86
ISPLSTVS DS    0H                       *                      SS AUG86
*        OI    SPFTFLG3,SPFTSDEF THIS IS DEFAULT               SS OCT88
*        LA    R15,ISPLSTVG      SORT LIST (BY VOL)            SS OCT88
ISPLSTVF DS    0H                       *                      SS OCT88
*        ST    R15,SPFTSORA             *                      SS AUG86
*        OI    SPFTFLG3,SPFTSORT        *                      SS AUG86
         LA    R15,VSPFVVOL      VOL IS KEY                    SS NOV85
         LA    R0,ISPLSTVN       VER NAMES                     SS NOV85
         BAL   R2,ISPTBOPN                                     SS NOV85
         BAL   R2,ISPSETST         ALSO INIT STATUS FLAG       SS AUG86
*        LA    R1,9              NORMAL SORT                   SS OCT88
         LH    R1,SPFTBPSR       GET SORT DEFAULT              SS OCT88
         TM    SPFPRBI,X'04'     BY ADDRESS ORDER              SS OCT88
         BZ    *+8                      *                      SS OCT88
         LA    R1,3(,R1)         NEXT ENTRY                    SS OCT88
         LR    R0,R1                    *                      SS OCT88
         MVC   SPFTSVX,SPFPRBI2  SAVE OPTION FLAG              SS FEB90
         BAL   R2,ISPSORTI       CALL SORT INIT                SS OCT88
         MVC   SPFPRBI2,SPFTSVX  RESTORE FLAG                  SS FEB90
         LA    R15,1                                           SS NOV85
         ST    R15,SPFTTOP                                     SS NOV85
         ST    R15,SPFTTOP2                                    SS JUL87
         OI    SPFPRBI2,X'80'    TERMINATE IF NO VOLUME FOUND ABL APR86
*  SET UP UCB SCAN                                             SS NOV85
ISPLSTV1 DS    0H                                              SS NOV85
         TM    SPFPRBI,X'40'       GROUP                       SS NOV85
         BO    ISPLSTVA            YES                         SS NOV85
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         XC    0(100,R1),0(R1)     ZERO FOR FRESH START        SS MAY88
         L     R1,16               CVT                         SS NOV85
         L     R1,CVTUCBSC-CVT(R1) IOSSVSUCB  UCB SCAN         SS NOV85
         ST    R1,SPFVTMP2         SAVE ADDRESS                SS NOV85
         B     ISPLSTVL            START LOOP                  SS NOV85
ISPLSTVI DC    X'1000'             IEFEB4UV REQUEST           ABL MAR88
ISPLSTVA DS    0H                                              SS NOV85
*  SET UP CALL FOR IEFEB4UV                                    SS NOV85
         TM    SPFLAG5,SPFXA            XA SYSTEM              SS JUL88
         BO    ISPLSTVX                 YES USE IEFEB4UV       SS JUL88
* SET UP CALL FOR 370 GET GENERIC       *                      SS AUG86
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         XC    0(100,R1),0(R1)     ZERO FOR FRESH START        SS MAY88
         ST    R1,PARMLIST              *                      SS AUG86
         LA    R1,PARMLIST+12           GENERIC NAME           SS AUG86
         ST    R1,PARMLIST+4            PARM 2                 SS AUG86
         LA    R1,SPFUCBA               RETURN UCB ADDR        SS AUG86
         ST    R1,PARMLIST+8            PARM 3                 SS AUG86
         MVC   PARMLIST+12(8),ISPBLK8 PRE BLANK                SS AUG86
         LH    R1,SPFPRLN          GET LENGTH                  SS AUG86
         L     R14,SPFPRSR         GET NAME ADDRESS            SS AUG86
         MVC   PARMLIST+12(0),0(R14)  COPY NAME                SS AUG86
         EX    R1,*-6              COPY FOR LENGTH             SS AUG86
         LA    R1,PARMLIST              *                      SS AUG86
         L     R15,ISPGET3A             ADDRESS OF ROUTINE     SS AUG86
         ST    R15,SPFVTMP2             SAVE RTN ADDRESS       SS AUG86
         BALR  R14,R15                  *                      SS AUG86
         LTR   R15,R15                  *                      SS AUG86
         BNZ   ISPLSTVD                 NONE                   SS AUG86
         OI    SPFPRBI,X'02'            370 GENERIC            SS AUG86
         L     R1,SPFUCBA               *                      SS AUG86
         B     ISPLSTVC                 PROCESS UCB            SS AUG86
ISPLSTVX DS    0H                       *                      SS AUG86
         LA    R1,PARMLIST+8       UNIT TABLE                  SS AUG86
         ST    R1,PARMLIST         SET POINTER                 SS AUG86
         LA    R1,ISPLSTVI         REQUEST FLAG                SS AUG86
         ST    R1,PARMLIST+4       SET POINTER                 SS AUG86
         MVC   PARMLIST+8(8),ISPBLK8  PRE BLANK                SS AUG86
         LH    R1,SPFPRLN          GET LENGTH                  SS AUG86
         L     R14,SPFPRSR         GET NAME ADDRESS            SS AUG86
         MVC   PARMLIST+8(0),0(R14) COPY NAME                  SS AUG86
         EX    R1,*-6              COPY FOR LENGTH             SS AUG86
         SR    R1,R1                    *                      SS AUG86
         ST    R1,PARMLIST+20      ZERO ATTRIBUTE AREA         SS AUG86
         LA    R1,PARMLIST         POINT TO PARMLIST           SS AUG86
         LINK  EP=IEFEB4UV         XA SERVICE ROUTINE          SS AUG86
         LTR   R15,R15                  *                      SS AUG86
         BNZ   ISPLSTVD            NO ENTRIES                  SS AUG86
         L     R15,PARMLIST+16     GET POINTER TO LIST         SS AUG86
         ST    R15,SPFTSV1         SAVE                        SS AUG86
         L     R1,4(,R15)          GET COUNT                   SS AUG86
         LA    R1,1(,R1)           COUNT +1 FOR LOOP           SS AUG86
         STH   R1,SPFTSVH          SAVE COUNT                  SS AUG86
         LA    R15,8(,R15)         FIRST ENTRY                 SS AUG86
         ST    R15,SPFVTMP2        LOOP POINTER                SS AUG86
ISPLSTVL DS    0H                  LOOP                        SS NOV85
         TM    SPFPRBI,X'02'       370 GROUP                   SS AUG86
         BO    ISPLSTVB            YES                         SS AUG86
         TM    SPFPRBI,X'40'       XA GROUP                    SS AUG86
         BZ    ISPLSTVB            NO                          SS AUG86
*  EXTRACT ENTRY FROM UCB LIST                                 SS NOV85
         L     R1,SPFVTMP2       GET POINTER ADDRESS           SS AUG86
         LA    R15,4(,R1)        NEXT ADDRESS                  SS AUG86
         ST    R15,SPFVTMP2      SAVE IT                       SS AUG86
         LH    R15,SPFTSVH       GET COUNT                     SS AUG86
         BCT   R15,ISPLSTVJ      MORE TO DO                    SS AUG86
*  AT END OF LIST FREEMAIN                                     SS NOV85
         L     R1,SPFTSV1        GET LIST ADDRESS              SS AUG86
         L     R0,0(,R1)         SUBPOOL AND LENGTH            SS AUG86
         FREEMAIN R,LV=(0),A=(1) FREE LIST                     SS AUG86
         B     ISPLSTVD                 *                      SS AUG86
ISPLSTVJ DS    0H                       *                      SS AUG86
         STH   R15,SPFTSVH       SAVE COUNT                    SS AUG86
         L     R1,0(,R1)         GET UCB ADDRESS               SS AUG86
         B     ISPLSTVC                                        SS NOV85
ISPLSTVB DS    0H                                              SS NOV85
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         ST    R1,PARMLIST                                     SS NOV85
         LA    R1,ISPLSTVZ                                     SS NOV85
         ST    R1,PARMLIST+4                                   SS NOV85
         LA    R1,SPFUCBA                                      SS NOV85
         ST    R1,PARMLIST+8                                   SS NOV85
         OI    PARMLIST+8,X'80'                                SS NOV85
         LA    R1,PARMLIST                                     SS NOV85
         L     R15,SPFVTMP2        ROUTINE ADDRESS             SS NOV85
         BALR  R14,R15                                         SS NOV85
         LTR   R15,R15                                         SS NOV85
         BNZ   ISPLSTVD            DONE                        SS NOV85
         L     R1,SPFUCBA                                      SS NOV85
ISPLSTVC DS    0H                                              SS NOV85
         USING UCBOB,R1                                        SS NOV85
         CLI   UCBTBYT3,X'20'      REALLY A DASD DEVICE        SS AUG86
         BNE   ISPLSTVL            NO, SKIP IT                 SS AUG86
         TM    UCBSTAT,UCBONLI     IS IT ONLINE                SS NOV85
         BZ    ISPLSTVL            NO, SKIP IT                 SS NOV85
         CLI   UCBVOLI,C' '        ANY VOLUME                  SS NOV85
         BNH   ISPLSTVL            NO VOLUME, SKIP IT          SS NOV85
         TM    UCBSTAT,UCBCHGS+UCBUNLD GOING OFFLINE           SS NOV85
         BNZ   ISPLSTVL            YES, SKIP IT                SS NOV85
         TM    SPFPRBI2,X'0F'      ANY FILTERING               SS APR87
         BZ    ISPLTVV3            NO   *                      SS APR87
         TM    SPFPRBI2,X'08'      SHR TEST                    SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBTYP+1,X'20'      SHARE DASDI                 SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'04'      PRIVATE TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBPRV          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'02'      PUBLIC  TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBPUB          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'01'      STORAGE TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBSTR          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         B     ISPLSTVL            NONE, SKIP THIS ONE         SS APR87
ISPLTVV3 DS    0H                       *                      SS APR87
         LH    R15,SPFPRLN         LENGTH OR PARM              SS NOV85
         L     R14,SPFPRSR         STRING ADDRESS              SS NOV85
         TM    SPFPRBI,X'40'       BY GROUP                    SS AUG86
         BO    ISPLSTV7            YES, USE                    SS AUG86
         CLI   0(R14),C'*'         ALL VOLUMES                 SS APR87
         BE    ISPLSTV7            YES, USE THIS ONE           SS APR87
         CLI   0(R14),C':'         ALL VOLUMES                 SS APR87
         BE    ISPLSTV7            YES, USE THIS ONE           SS APR87
*        TM    SPFPRBI,X'40'       BY ADDRESS                  SS FEB88
         TM    SPFPRBI,X'04'       BY ADDRESS                  SS MAR88
         BO    ISPLSTV4            YES                         SS NOV85
         CLC   UCBVOLI(0),0(R14)   <<EXECUTED>>                SS NOV85
         EX    R15,*-6                                         SS NOV85
         BNE   ISPLSTVL            NOT THE ONE                 SS NOV85
         B     ISPLSTV7                                        SS NOV85
ISPLSTV4 CLC   UCBNAME(0),0(R14)   <<EXECUTED>>                SS NOV85
         EX    R15,*-6                                         SS NOV85
         BNE   ISPLSTVL            NOT THE ONE                 SS NOV85
         B     ISPLSTV7                                        SS NOV85
*  ADD / REPLACE VOL ENTRIES                                   SS NOV85
ISPLSTV7 DS    0H                                              SS NOV85
         OI    SPFPRBI2,X'40'      AT LEAST ONE VOLUME FOUND  ABL APR86
         ST    R1,SPFVTMP1         SAVE UCB FOR NOW            SS NOV85
         NI    SPFPRBI,255-X'01'   CLEAR FLAG BEFORE           SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         BAL   R2,ISPGET           SEE IF DUP                  SS NOV85
         LTR   R15,R15             FOUND ONE                   SS NOV85
         BNZ   ISPLSTV5            NO                          SS NOV85
         BAL   R2,ISPDEL1          DELETE OLD ONE              SS JUL87
ISPLSTV5 DS    0H                                              SS NOV85
         L     R1,SPFVTMP1         RESET R1                    SS NOV85
         ST    R1,SPFVUCBA                                     SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         MVC   SPFVDATA,ISPBLK8                                SS NOV85
ISPLSTV6 DS    0H                                              SS NOV85
         MVC   SPFVOPT,ISPBLK8                                 SS NOV85
         MVC   SPFVINDC,ISPBLK8                                SS NOV85
         MVC   SPFVSTAT,ISPBLK8                                SS NOV85
         BAL   R2,ISPVSTAI         STATUS SUBROUTINE           SS NOV85
         MVC   SPFVTCYL(8),ISPBLK8                             SS NOV85
         MVC   SPFVXNUM(16),SPFVTCYL                           SS NOV85
         MVC   SPFVVSIZ,ISPBLK8                                SS NOV85
         TM    SPFPRBI,X'10'       NOSPACE                     SS NOV85
         BO    ISPLSTV8            ADD ENTRY                   SS NOV85
         TM    SPFPRBI,X'20'       SPACE                       SS JUL88
         BO    ISPLSTV9            GET SPACE                   SS NOV85
         CLI   SPFSPAC,C'N'        NOSPACE DEFAULT             SS JUL88
         BE    ISPLSTV8            YES, ADD ENTRY              SS JUL88
ISPLSTV9 DS    0H                       *                      SS JUL88
         BAL   R2,ISPVSPAI         VOLUME SPACE  BUILD  SUB    SS NOV85
         LTR   R15,R15             ALL OK                      SS APR87
         BZ    ISPLSTV8            YES                         SS APR87
         CLC   SPFVDATA(2),=C'*R'  VTOC RESERVED CODE?        ABL MAY88
         BE    ISPLSTV8            YES, BRANCH                ABL MAY88
         CLC   SPFVDATA(2),=C'*V'  VTOC ENQUEUED CODE?        ABL MAY88
         BE    ISPLSTV8            YES, BRANCH                ABL MAY88
         MVC   SPFVDATA,ISPLSPCE   VTOC ERROR CODE             SS APR87
ISPLSTV8 DS    0H                                              SS NOV85
* CAN DO ADD NOW                                               SS JUL87
         BAL   R2,ISPTBADD                                     SS NOV85
         B     ISPLSTVL            CONTINUE WITH NEXT UCB      SS NOV85
         SPACE 1
* RETURN TO DISPLAY                                            SS NOV85
ISPLSTVD DS    0H                                              SS NOV85
         LA    R15,100             GO TO TBDISPL               SS NOV85
         TM    SPFPRBI2,X'40'      AT LEAST ONE VOLUME FOUND? ABL APR86
         BOR   R3                  YES, RETURN                ABL APR86
         MVC   SPFMSGID,ISPPDSM    ERROR MESSAGE              ABL APR86
         MVI   SPFMSGID+6,C'8'     NO MATCHING VOLUME         ABL APR86
         MVI   SPFMSGID+7,C'A'                                ABL APR86
         BR    R3                  OPTIONAL ?                  SS AUG86
         TM    SPFPRBI2,X'80'      TERMINATE IF NONE?         ABL APR86
         BNOR  R3                  NO, RETURN                 ABL APR86
         L     R14,ISP$ENDA             POINT TO FUNCTION      SS AUG86
         ST    R14,SPFVTPT              *                      SS AUG86
         LA    R15,16                   *                      SS AUG86
         BR    R3                       *                      SS AUG86
         SPACE 1
*         LISTV WITH NO OPERANDS                               SS AUG86
ISPLSTVQ DS    0H                                              SS NOV85
         CLI   SPFFUNST+3,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTVQ2           YES, PROMPT                  SS AUG86
         CLI   SPFTBPFI+1,3       ALREADY AT LISTV?            SS AUG86
         BE    ISPLTVQ2           YES PROMPT                   SS FEB89
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS FEB89
         LNR   R1,R1                    *                      SS FEB89
         BAL   R2,ISPSTKI         SWAP PANEL                   SS FEB89
         B     ISPLTVQ7           DISPLAY                      SS FEB89
ISPLTVQ5 DS    0H                       *                      SS AUG86
         L     R15,SPFOPER              BLANK AFTER CMD        SS FEB89
         LA    R14,30                   SCAN FOR OPERAND       SS FEB89
         BAL   R2,ISPCKBLK                                     SS FEB89
         LTR   R15,R15                  ANY                    SS FEB89
         BNZ   ISPLTV1B                 YES, CANNOT PROCESS    SS FEB89
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAL   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,36             PENDING ACT PROCE            SS AUG86
         BR    R3                 RETURN TO ROUTER             SS AUG86
ISPLTV1B DS    0H                       *                      SS FEB89
         MVC   SPFMSGID,ISPPDSM         GENERIC MESSAGE        SS FEB89
         MVI   SPFMSGID+6,C'1'          PDSM..1B MESSAGE       SS FEB89
         MVI   SPFMSGID+7,C'B'          BUSY MSG               SS FEB89
ISPLTVQ7 DS    0H                       *                      SS AUG86
         LA    R15,100            GO TO DISPLAY                SS AUG86
         BR    R3                 RETURN TO ROUTER             SS AUG86
ISPLTVQ2 DS    0H                       *                      SS AUG86
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'2'    NO OPERAND    MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'V'                                 SS NOV85
ISPLTVQ1 DS    0H                       *                      SS AUG86
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG86
         MVC   SPFVZCMD+1(249),SPFVZCMD      RIPPLE            SS AUG86
ISPLTVQ8 DS    0H                                              SS DEC87
         LA    R15,ISPLTVPP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS AUG86
         BAL   R2,ISPSINGI        DISPLAY PANEL                SS AUG86
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS AUG86
         NI    SPFTSVDF+1,255-X'01'     CLEAR PROMPT FLAG      SS AUG86
         C     R15,ISPL8          END KEY                      SS AUG86
         BE    ISPLTVQ3           RETURN TO FUNCTION CMD       SS AUG86
         OI    SPFTSVDF+1,X'01'         SET   PROMPT FLAG      SS AUG86
         MVC   SPFINPUT(250),SPFZSEL    COPY                   SS AUG86
         LA    R15,SPFINPUT             STARTING ADDRESS       SS AUG86
         LA    R14,30                   LENGTH                 SS AUG86
         LA    R1,C' '                  BLANK                  SS AUG86
         BAL   R2,ISPCLI                FIND BLANK AFTER CMD   SS AUG86
         B     ISPLSTVH                 RETRY PARSE            SS AUG86
ISPLTVPP DC    CL8'&P.LVLTV'                                   SS OCT88
ISPLTVQ3 DS    0H                       *                      SS AUG86
         TM    SPFLAG4,SPFFFUN          FROM FUNCTION          SS AUG86
         BO    ISPLTVQ4                 YES, GO BACK           SS AUG86
         LA    R15,100                  GO TO PREV DISPLAY     SS AUG86
         BR    R3                       RETURN TO ROUTER       SS AUG86
ISPLTVQ4 DS    0H                       *                      SS AUG86
         L     R14,ISP$FUNA             POINT TO FUNCTION      SS AUG86
         ST    R14,SPFVTPT              *                      SS AUG86
         LA    R15,16                   *                      SS AUG86
         BR    R3                       *                      SS AUG86
         SPACE 1
* INVALID RANGE ON STRING                                      SS NOV85
ISPLSTVW DS    0H                                              SS NOV85
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'3'    TOO LONG      MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'V'                                 SS NOV85
         B     ISPLSTVE                                       ABL APR86
         SPACE 1
* KEY CONFLICT                                                 SS NOV85
ISPLSTVK DS    0H                                              SS NOV85
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'7'    KEY CONFLICT  MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'A'                                 SS NOV85
         SPACE 1
ISPLSTVE DS    0H                                              SS AUG86
         TM    SPFTSVDF+1,X'01'   SET PROMPT MODE              SS AUG86
         BO    ISPLTVQ1           PROMPT WITH MESSAGE          SS AUG86
         MVC   SPFVZCMD(250),SPFINPUT COPY BAD COMMAND         SS DEC87
         B     ISPLTVQ8           PROMPT WITH MESSAGE          SS DEC87
         SPACE 2
ISPLSTVG DC    C'(PDSVVOL,C,A)'   SORT LISTV ON VOL            SS AUG86
ISPLSTVM DC    C'(PDSVXADD,C,A)'  SORT LISTV ON ADDR           SS AUG86
ISPLSTVP DS    0F                                              SS NOV85
         DC    X'80',X'800000',CL8' '                          SS FEB88
*                      80  ON TO ALLOW * AND :                 SS FEB88
         DC    X'33',X'040000',CL8'ADDRESS'                    SS FEB88
         DC    X'34',X'400000',CL8'GROUP'                      SS AUG86
         DC    X'34',X'400000',CL8'GENERIC'                    SS AUG86
         DC    X'34',X'200000',CL8'SPACE'                      SS NOV85
         DC    X'36',X'100000',CL8'NOSPACE'                    SS NOV85
         DC    X'31',X'100000',CL8'NO'                         SS NOV85
         DC    X'34',X'080000',CL8'RESET'                      SS NOV85
         DC    X'21',X'000800',CL8'SHARED'                     SS NOV85
         DC    X'21',X'000400',CL8'SHR'                        SS NOV85
         DC    X'23',X'000400',CL8'PRIVATE'                    SS NOV85
         DC    X'22',X'000200',CL8'PUBLIC'                     SS NOV85
         DC    X'23',X'000100',CL8'STORAGE'                    SS NOV85
         DC    X'FF'                                           SS NOV85
ISPLSTVZ DC    X'20'        UCB SCAN FOR DASD                  SS NOV85
         SPACE 2
         DS    0F                                              SS NOV85
ISPLSTVV DC    H'0',X'08',X'00'                                SS NOV85
         DC    A(VSPFVVOL),AL2(SPFVVOL-SPWRKC),H'06'           SS NOV85
         DC    A(VSPFVXAD),AL2(SPFVXADD-SPWRKC),H'02'          SS AUG86
         DC    A(VSPFVUCB),AL2(SPFVUCBA-SPWRKC),H'04'          SS NOV85
         DC    A(VSPFVDAT),AL2(SPFVDATA-SPWRKC),H'08'          SS NOV85
         DC    X'FF'                                           SS NOV85
VSPFVVOL DC    C'PDSVVOL '                                     SS NOV85
VSPFVXAD DC    C'PDSVXADD '                                    SS AUG86
VSPFVUCB DC C'(PDSVUCBA PDSVOPT PDSVADDR PDSVATTR PDSVCNT  PDSVTCYL    X
               PDSVTTRK  PDSVXNUM PDSVDSCB PDSVLCYL PDSVLTRK PDSVSTAT  X
               PDSVVSIZ)'                                      SS NOV85
VSPFVDAT DC    C'(PDSVDATA PDSVTYPE PDSVVTOC PDSVINDC)'        SS NOV85
ISPLSTVN DC    C'(PDSVOPT PDSVDATA PDSVUCBA PDSVTYPE PDSVADDR PDSVVTOC X
               PDSVATTR PDSVCNT PDSVTCYL PDSVTTRK PDSVXNUM PDSVDSCB    X
               PDSVLCYL PDSVLTRK PDSVINDC PDSVSTAT PDSVVSIZ PDSVXADD)'
*              ABOVE  TABLE LAST EDIT                          SS AUG86
         SPACE 5                                               SS NOV85
*                                                              SS NOV85
*   ISPVSTAT SUBROUTINE  BUILD VOLUME STATS                    SS NOV85
*                                                              SS NOV85
ISPVSTAT DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         MVC   SPFVADDR(3),UCBNAME CUU                         SS NOV85
         MVI   SPFVADDR+3,C' '     BLANK                       SS NOV85
         MVC   SPFVXADD(2),UCBCHAN CUU IN HEX                  SS AUG86
         IC    R0,UCBNAME          GET C OF CUU               ABL JAN87
         SLL   R0,28               DROP ZONE                  ABL JAN87
         SRL   R0,28               SHIFT BACK                 ABL JAN87
         STC   R0,SPFVXADD         RESET C OF CUU             ABL JAN87
         IC    R0,UCBUSER+1            ASSUME MVS/XA          ABL FEB87
         L     R15,16                                         ABL FEB87
         TM    CVTDCB-CVT(R15),X'80'   CVTMVSE (XA)?          ABL FEB87
         BO    *+8                     YES, BRANCH            ABL FEB87
         IC    R0,UCBUSER                                     ABL APR86
         LR    R1,R0               ONE BYTE ONLY              ABL APR86
         BAL   R2,ISPDECCV         CONVERT DO DEC              SS NOV85
         MVC   SPFVCNT,SPFDCNV3    GET VALUE                   SS NOV85
         MVI   SPFVCNT+3,C' '                                  SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
         TM    UCBSTAB,UCBBPRV     PRIVATE                     SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'PRIV'                               SS NOV85
         TM    UCBSTAB,UCBBPUB     PUBLIC                      SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'PUB '                               SS NOV85
         TM    UCBSTAB,UCBBSTR     STORAGE                     SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'STOR'                               SS NOV85
         TM    UCBSTAT,UCBRESV     RESERVED                    SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'RESV'                               SS NOV85
         TM    UCBSTAT,UCBPRES     PERMINAT RESIDENT           SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'PRES'                               SS NOV85
         TM    UCBSTAT,UCBSYSR     SYSTEM RESIDENT             SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'SYSR'                               SS NOV85
         MVC   SPFVINDC(4),ISPBLK8  RESET INDC AREA            SS NOV85
         TM    UCBSTAT,UCBALOC     ALLOCATED                   SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC,C'A'                                   SS NOV85
         TM    UCBSTAB,UCBPGFL     PAGE DATASET                SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+1,C'P'                                 SS NOV85
         TM    UCBTYP+1,X'20'      SHARED DEVICE FLAG          SS APR87
         BZ    *+8                                             SS APR87
         MVI   SPFVINDC+3,C'S'     SHARED VOLUME               SS APR87
         TM    UCBTYP+1,X'08'      VIRT DASD 3330V             SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+3,C'M'     MASS STORE                  SS NOV85
         TM    UCBSTAB,UCBBNUL     CATALOG (NOT ALWAYS SET)    SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+2,C'C'                                 SS NOV85
         MVC   SPFVTYPE,ISPBLK8                                SS NOV85
         LA    R1,UCBTYP                                       SS NOV85
         BAL   R2,ISPDEVTC                                     SS NOV85
         STH   R15,SPFVCSIZ        TRK/CYL                     SS NOV85
         BAL   R2,ISPDEVNM         GET DEVICE TYPE NAME        SS NOV85
         LTR   R15,R15                                         SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVTYPE,0(R15)                                 SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
* SET VTOC ADDRESS IN SPFVVTOC                                 SS NOV85
         SR    R0,R0                                           SS NOV85
         ICM   R1,3,UCBVTOC       GET TT OF TTR0               SS NOV85
         ICM   R1,12,=X'0000'     CLEAR                        SS NOV85
         LH    R15,SPFVCSIZ                                    SS NOV85
         DR    R0,R15                                          SS NOV85
         SLL   R1,16              SHIFT CC                     SS NOV85
         OR    R1,R0              ADD IN HH                    SS NOV85
         BAL   R2,ISPHEXCV        CONVERT TO HEX               SS NOV85
         MVC   SPFVVTOC,SPFHEXCV  MOVE IT                      SS NOV85
         BR    R3                                              SS NOV85
         DROP  R4                                              SS NOV85
         LTORG ,                        *                      SS MAR87
*                                                              SS NOV85
*   ISPVSPAC SUBROUTINE  BUILD VOLUME SPACE AND DSCB F4 INFO   SS NOV85
*                                                              SS NOV85
ISPVSPAC DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SR    R15,R15         SET ZERO RC                     SS APR87
         CLI   SPFVINDC+3,C'M'     MASS STORE                  SS NOV85
         BER   R3                  SKIP LSPACE                 SS NOV85
         CLI   SPFSPWA,C'Y'        WAIT FOR SPACE              SS JUL88
         BE    ISPVSPAE            YES, GET SPACE NOW          SS JUL88
*        L     R2,16                                          ABL MAY88
*        TM    CVTDCB-CVT(R2),X'80'    CVTMVSE--XA?           ABL MAY88
*        BNO   ISPVSPAD                NO, BRANCH             ABL MAY88
         L     R2,SPFVUCBA         POINT TO UCB               ABL MAY88
*        SH    R2,=H'15'           OFFSET TO UCBIOSF1         ABL MAY88
*        TM    0(R2),X'80'         RESERVED?                  ABL MAY88
*        BNO   ISPVSPAD            NO, BRANCH                 ABL MAY88
         CLI   UCBSQC-UCBCMSEG(R2),0  ANY RESERVE COUNT        SS JUL88
         BZ    ISPVSPAD            NO, CHECK FOR ENQ           SS JUL88
         MVC   SPFVDATA,ISPLSPCR   VTOC RESERVED CODE         ABL MAY88
         LA    R15,4               SET ERROR RETURN           ABL MAY88
         BR    R3                  SKIP LSPACE                ABL MAY88
ENQTESTV ENQ   (*-*,*-*,E,*-*,SYSTEMS),RET=TEST,MF=L          ABL MAY88
         ORG   ENQTESTV+4                                     ABL MAY88
SYSVTOC  DC    CL8'SYSVTOC '              FOR VTOC ENQUE TEST ABL MAY88
ISPLSPCR DC    CL8'*RESERVE'                                  ABL MAY88
ISPLSPCV DC    CL8'*VTOCENQ'                                  ABL MAY88
ISPVSPAD DS    0H                                             ABL MAY88
         AIF ('&MVSLEV' LT 'MVS13X').NMVS13A                  ABL MAY88
         XC    PARMLIST(48),PARMLIST                          ABL MAY88
         GQSCAN AREA=(WORKTBL,296),                           ABL MAY88X
               RESNAME=(SYSVTOC,SPFVVOL,06),                  ABL MAY88X
               REQLIM=1,SCOPE=ALL,MF=(E,PARMLIST)             ABL MAY88
         SR    R1,R1                                          ABL MAY88
         CH    R15,=H'4'           ALLOCATED?                 ABL MAY88
         BE    ISPVSPAE            NO, EXIT                   ABL MAY88
         MVC   SPFVDATA,ISPLSPCV   VTOC RESERVED CODE         ABL MAY88
         LA    R15,4               SET ERROR RETURN           ABL MAY88
         BR    R3                  SKIP LSPACE                ABL MAY88
.NMVS13A ANOP                      ,                          ABL MAY88
ISPVSPAE DS    0H                                             ABL MAY88
         L     R0,SPFVUCBA         GET UCB ADDR                SS NOV85
         BAL   R2,ISPLSPAC         UPDATE SPACE                SS NOV85
         LTR   R15,R15             ZERO RC                     SS APR87
         BNZR  R3                  SKIP, BAD RC                SS APR87
* SHOULD ALSO READ DSCB F4 FOR MORE INFOMATION                 SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
         LA    R1,UCBVOLI          LOCATION OF VOLUME          SS NOV85
         BAL   R2,ISPFMT4          GET DSCB FORMAT 4           SS NOV85
         LTR   R15,R15                                         SS NOV85
         BNZR  R3                  SKIP, BAD RC                SS NOV85
         LH    R1,DS4DSREC-DS4IDFMT+SPFDSCB                    SS NOV85
         BAL   R2,ISPDECCV                                     SS NOV85
         MVC   SPFVDSCB,SPFDCNV4                               SS NOV85
         MVC   SPFVINDC+4(4),ISPBLK8   RESET INDC AREA         SS NOV85
         TM    DS4VTOCI-DS4IDFMT+SPFDSCB,DS4IVTOC  INDEX VTOC  SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+4,C'I'                                 SS NOV85
         TM    DS4VSIND-DS4IDFMT+SPFDSCB,X'80'     VSAM OWNED  SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+5,C'V'                                 SS NOV85
         SR    R1,R1                                           SS NOV85
         ICM   R1,3,DS4VSCRA-DS4IDFMT+SPFDSCB      CRA         SS NOV85
         LTR   R1,R1                               ANY         SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+6,C'R'                                 SS NOV85
         LA    R1,DS4VTOCE-DS4IDFMT+SPFDSCB                    SS NOV85
         SR    R0,R0                                           SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R0,3,2(R1)      CC OF LOWER LIMIT               SS NOV85
         ICM   R2,3,4(R1)      HH OF LOWER LIMIT               SS NOV85
         MH    R0,SPFVCSIZ     CC TIMES TRK/CYL                SS NOV85
         ALR   R2,R0           RELATIVE TRK OF LOWER LIMIT     SS NOV85
         LR    R15,R2          SAVE HERE                       SS NOV85
         ICM   R0,3,6(R1)      CC OF UPPER LIMIT               SS NOV85
         ICM   R2,3,8(R1)      HH OF UPPER LIMIT               SS NOV85
         MH    R0,SPFVCSIZ     CC TIMES TRK/CYL                SS NOV85
         ALR   R2,R0           RELATIVE TRK OF UPPER LIMIT     SS NOV85
         SLR   R2,R15          DIFFERANCE                      SS NOV85
         LA    R1,1                                            SS NOV85
         ALR   R1,R2           VTOC SIZE IN TRKS               SS NOV85
         BAL   R2,ISPDECCV                                     SS NOV85
         MVC   SPFVVSIZ,SPFDCNV4                               SS NOV85
         SR    R15,R15         SET ZERO RC                     SS APR87
         BR    R3                                              SS NOV85
         DROP  R4                                              SS NOV85
         LTORG ,                        *                      SS MAR87

000100 IDENTIFICATION DIVISION.
000200     SKIP1
000300 PROGRAM-ID.    SLSYREPT.
000400     SKIP1
000500 AUTHOR.        FRANK G. BOLAN.
000600     SKIP1
000700 INSTALLATION.  SANTA FE INTERNATIONAL
000800                505 SOUTH MAIN STREET
000900                P.O. BOX 1401
001000                ORANGE, CALIFORNIA 92668
001100     SKIP1
001200 REMARKS.      ***************************************************
001300               *      THIS PROGRAM READS A DIALOG MANAGER TABLE  *
001400               * CREATES A EXTRACT FILE, SORTS AND RECREATES THE *
001500               * TABLE THEN PRODUCES A SOFTWARE REPORT.          *
001600               ***************************************************
001700     EJECT
001800 ENVIRONMENT DIVISION.
001900     SKIP1
002000 CONFIGURATION SECTION.
002100 SOURCE-COMPUTER.           IBM-370.
002200 OBJECT-COMPUTER.           IBM-370.
002300     SKIP1
002400 INPUT-OUTPUT SECTION.
002500     SKIP1
002600 FILE-CONTROL.
002700     SKIP1
002800     SELECT SLSY-RECS
002900        ASSIGN TO UT-S-RI.
003000     SELECT REPT-OUTPUT
003100        ASSIGN TO UT-S-RO.
003200     SELECT SORT-FILE
003300        ASSIGN TO UT-S-SORTWK01.
003400     EJECT
003500 DATA DIVISION.
003600     SKIP1
003700 FILE SECTION.
003800 FD  SLSY-RECS
003900     RECORDING MODE IS F
004000     LABEL RECORDS ARE STANDARD
004100     RECORD CONTAINS 266 CHARACTERS
004200     BLOCK CONTAINS 0 RECORDS
004300     DATA RECORDS ARE SLSY-RECORD.
004400     SKIP1
004500 01  SLSY-RECORD                  PIC X(266).
004600     EJECT
004700 FD  REPT-OUTPUT
004800     RECORDING MODE IS F
004900     LABEL RECORDS ARE STANDARD
005000     RECORD CONTAINS 133 CHARACTERS
005100     BLOCK CONTAINS 0 RECORDS
005200     DATA RECORDS ARE REPORT-RECORD.
005300     SKIP1
005400 01  REPORT-RECORD.
005500     05  PRINTCC                  PIC X(001).
005600     05  PRINTLINE                PIC X(132).
005700     EJECT
005800 SD  SORT-FILE
005900     RECORDING MODE IS F.
006000     SKIP1
006100 01  SORT-RECORD.
006200     05  SORT-KEY1.
006300         10  CONTROL-FIELDS       PIC X(001).
006400         10  VEND-OUTS            PIC X(010).
006500         10  FMID-OUTS            PIC X(010).
006600     05  IDTE-OUTS            PIC X(008).
006700     05  VERS-OUTS            PIC X(010).
006800     05  SERI-OUTS            PIC X(010).
006900     05  SORT-KEY2.
007000         10  DESC-OUTS            PIC X(040).
007100     05  STAT-OUTS            PIC X(010).
007200     05  CONT-OUTS            PIC X(015).
007300     05  BUDG-OUTS            PIC X(007).
007400     05  COST-OUTS            PIC X(007).
007500     05  PCST-OUTS            PIC X(007).
007510     05  VPHN-OUTS            PIC X(014).
007520     05  HPHN-OUTS            PIC X(014).
007530     05  WPHN-OUTS            PIC X(004).
007600     EJECT
007700 WORKING-STORAGE SECTION.
007800 01  VDEF-KEYS.
007900     10  VEND1V               PIC X(007) VALUE '(VEND1)'.
008000     10  FMID1V               PIC X(007) VALUE '(FMID1)'.
008100 01  VDEF-SCREEN.
008200     10  VENDV                PIC X(006) VALUE '(VEND)'.
008300     10  FMIDV                PIC X(006) VALUE '(FMID)'.
008400     10  IDTEV                PIC X(006) VALUE '(IDTE)'.
008500     10  VERSV                PIC X(006) VALUE '(VERS)'.
008600     10  SERIV                PIC X(006) VALUE '(SERI)'.
008700     10  DESCV                PIC X(006) VALUE '(DESC)'.
008800     10  STATV                PIC X(006) VALUE '(STAT)'.
008900     10  CONTV                PIC X(006) VALUE '(CONT)'.
009000     10  BUDGV                PIC X(006) VALUE '(BUDG)'.
009100     10  COSTV                PIC X(006) VALUE '(COST)'.
009200     10  PCSTV                PIC X(006) VALUE '(PCST)'.
009210     10  VPHNV                PIC X(006) VALUE '(VPHN)'.
009220     10  HPHNV                PIC X(006) VALUE '(HPHN)'.
009230     10  WPHNV                PIC X(006) VALUE '(WPHN)'.
009300 01  VCREATE-KEYS.
009400     10  VEND1C               PIC X(007) VALUE '(VEND1 '.
009500     10  FMID1C               PIC X(006) VALUE 'FMID1)'.
009600 01  VCREATE-VARS.
009700     10  VENDC                PIC X(006) VALUE '(VEND '.
009800     10  FMIDC                PIC X(005) VALUE 'FMID '.
009900     10  IDTEC                PIC X(005) VALUE 'IDTE '.
010000     10  VERSC                PIC X(005) VALUE 'VERS '.
010100     10  SERIC                PIC X(005) VALUE 'SERI '.
010200     10  DESCC                PIC X(005) VALUE 'DESC '.
010300     10  STATC                PIC X(005) VALUE 'STAT '.
010400     05  CONTC                PIC X(005) VALUE 'CONT '.
010500     05  BUDGC                PIC X(005) VALUE 'BUDG '.
010600     05  COSTC                PIC X(005) VALUE 'COST '.
010700     05  PCSTC                PIC X(005) VALUE 'PCST '.
010710     05  VPHNC                PIC X(005) VALUE 'VPHN '.
010720     05  HPHNC                PIC X(005) VALUE 'HPHN '.
010730     05  WPHNC                PIC X(005) VALUE 'WPHN)'.
010800 01  VARS.
010900     10  VEND1                PIC X(010).
011000     10  FMID1                PIC X(010).
011100     10  VEND                 PIC X(010).
011200     10  FMID                 PIC X(010).
011300     10  IDTE                 PIC X(008).
011400     10  VERS                 PIC X(010).
011500     10  SERI                 PIC X(010).
011600     10  DESC                 PIC X(040).
011700     10  STAT                 PIC X(010).
011800     05  CONT                 PIC X(015).
011900     05  BUDG                 PIC X(007).
012000     05  COST                 PIC X(007).
012100     05  PCST                 PIC X(007).
012110     05  VPHN                 PIC X(014).
012120     05  HPHN                 PIC X(014).
012130     05  WPHN                 PIC X(004).
012200     SKIP1
012300 01  SPF-KEYWORD-PARMS.
012400     10  LENG           PIC 9(09) COMP VALUE 6.
012500     10  CHAR           PIC X(05) VALUE 'CHAR '.
012600     10  PANEL          PIC X(08) VALUE SPACE.
012700     10  VMOVE          PIC X(05) VALUE 'MOVE '.
012800     10  VLOCATE        PIC X(07) VALUE 'LOCATE '.
012900     10  NUMB           PIC S9(08) COMP VALUE +1.
013000 01  SPF-FUNCTION-CALLS.
013100     10  VDEFINE        PIC X(08) VALUE 'VDEFINE '.
013200     10  VREPLACE       PIC X(09) VALUE 'VREPLACE '.
013300     10  VCOPY          PIC X(06) VALUE 'VCOPY '.
013400     10  VDISPLAY       PIC X(08) VALUE 'DISPLAY '.
013500     10  TBSKIP         PIC X(07) VALUE 'TBSKIP '.
013600     10  TBOPEN         PIC X(07) VALUE 'TBOPEN '.
013700     10  TBCLOSE        PIC X(08) VALUE 'TBCLOSE '.
013800     10  TBCREATE       PIC X(09) VALUE 'TBCREATE '.
013900     10  TBDISPL        PIC X(08) VALUE 'TBDISPL '.
014000     10  TBERASE        PIC X(08) VALUE 'TBERASE '.
014100     10  TBADD          PIC X(06) VALUE 'TBADD '.
014200     10  TBGET          PIC X(06) VALUE 'TBGET '.
014300     10  VGET           PIC X(05) VALUE 'VGET '.
014400 01  SPF-TABLES.
014500     10  SLSY           PIC X(05) VALUE 'SLSY '.
014600     SKIP1
014700 01  DETAIL-LINE.
014800     05  CC-CONTROL               PIC X(001) VALUE SPACE.
014900     05  DETAIL-DATA              PIC X(132).
015000     SKIP1
015100 01  SUB-HEADING-LINE.
015200     05  SH-CONTROL               PIC X(001) VALUE '0'.
015300     05  SH-DETAIL                PIC X(132).
015400     SKIP1
015500 01  SLSY-HEADING.
015600     05  FILLER                   PIC X(001) VALUE '1'.
015700     05  HEAD-DATE                PIC X(008) VALUE SPACES.
015800     05  FILLER                   PIC X(022) VALUE ' '.
015900     05  HEADING-DETAIL    PIC X(015) VALUE 'SOFTWARE BUDGET'.
015910     05  HEADING-DETAIL    PIC X(018) VALUE ' REPORT        '.
016000     05  FILLER                   PIC X(018) VALUE ' '.
016100     05  HEAD-TIME                PIC X(008).
016200     05  FILLER                   PIC X(027) VALUE ' '.
016300     05  FILLER                   PIC X(005) VALUE 'PAGE '.
016400     05  OUT-PAGE                 PIC Z,ZZ9.
016500 01  CNT-COUNTERS.
016600     05  REPORT-LINE-COUNT        PIC S9(004) VALUE ZERO.
016700 01  CON-CONSTANTS.
016800     05  CON-TRUE                 PIC X(001)  VALUE 'T'.
016900     05  CON-FALSE                PIC X(001)  VALUE 'F'.
017000     05  CON-EJECT                PIC X(001)  VALUE '1'.
017100     05  CON-SKIP1                PIC X(001)  VALUE ' '.
017200     05  CON-SKIP2                PIC X(001)  VALUE '0'.
017300     05  CON-IBM                  PIC X(001)  VALUE 'A'.
017400     05  CON-NON-IBM              PIC X(001)  VALUE 'B'.
017500     05  CON-SKIP3                PIC X(001)  VALUE '-'.
017600     05  PLUS-1                   PIC S99     VALUE +1.
017700     05  TAX                      PIC S9V99    VALUE +0.06.
017800     05  BUDG-TOT                 PIC S9(7)   VALUE +0.
017900     05  COST-TOT                 PIC S9(7)   VALUE +0.
018000     05  DIFF-TOT                 PIC S9(7)   VALUE +0.
018100     05  BUDG-WRK                 PIC S9(7)   VALUE +0.
018200     05  COST-WRK                 PIC S9(7)   VALUE +0.
018300     05  DIFF-WRK                 PIC S9(7)   VALUE +0.
018400     05  PLUS-2                   PIC S99     VALUE +2.
018500     05  PLUS-3                   PIC S99     VALUE +3.
018600     05  PAGE-LIMIT               PIC S99     VALUE +55.
018700     SKIP2
018800 01  SWT-SWITCHES.
018900     05  SWT-END-OF-INPUT         PIC X(001).
019000         88  END-OF-INPUT                     VALUE 'T'.
019100     05  SWT-END-OF-DATA          PIC X(001).
019200         88  END-OF-DATA                      VALUE 'T'.
019300 01  STA-STORAGE.
019400     05  PAGE-COUNT               PIC 9(003)  VALUE ZERO.
019500     05  TBL-KEY-WORK             PIC X(020)  VALUE SPACES.
019600     05  RTN-CODE                 PIC X(004)  VALUE SPACES.
019700     05  SLSY-SUB.
019800         10  FILLER               PIC X(001)  VALUE SPACES.
019900         10  FILLER               PIC X(011)  VALUE 'VENDOR ID  '.
020000         10  FILLER               PIC X(001)  VALUE SPACES.
020100         10  FILLER               PIC X(011)  VALUE 'PRODUCT #  '.
020200         10  FILLER               PIC X(001)  VALUE SPACES.
020300         10  FILLER               PIC X(011)  VALUE 'VERSION #  '.
020400         10  FILLER               PIC X(012)  VALUE SPACES.
020500         10  FILLER               PIC X(011)  VALUE 'DESCRIPTION'.
020600         10  FILLER               PIC X(022)  VALUE SPACES.
020700         10  FILLER               PIC X(011)  VALUE 'BUDGETED   '.
020800         10  FILLER               PIC X(003)  VALUE SPACES.
020900         10  FILLER               PIC X(011)  VALUE 'CURRENT    '.
021000         10  FILLER               PIC X(003)  VALUE SPACES.
021100         10  FILLER               PIC X(011)  VALUE 'DIFFERENCE '.
021200         10  FILLER               PIC X(003)  VALUE SPACES.
021300         10  FILLER               PIC X(011)  VALUE 'STATUS     '.
021400     05  SLSY-DETAIL.
021500         10  FILLER               PIC X(002)  VALUE SPACES.
021600         10  VEND-OUT1            PIC X(010)  VALUE SPACES.
021700         10  FILLER               PIC X(002)  VALUE SPACES.
021800         10  FMID-OUT1            PIC X(010)  VALUE SPACES.
021900         10  FILLER               PIC X(002)  VALUE SPACES.
022000         10  VERS-OUT1            PIC X(010)  VALUE SPACES.
022100         10  FILLER               PIC X(002)  VALUE SPACES.
022200         10  DESC-OUT1            PIC X(040)  VALUE SPACES.
022300         10  FILLER               PIC X(002)  VALUE SPACES.
022400         10  BUDG-OUT1            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
022500         10  FILLER               PIC X(005)  VALUE SPACES.
022600         10  COST-OUT1            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
022700         10  FILLER               PIC X(005)  VALUE SPACES.
022800         10  DIFF-OUT1            PIC $Z,ZZZ,ZZ9- VALUE ZERO.
022900         10  FILLER               PIC X(003)  VALUE SPACES.
023000         10  STAT-OUT1            PIC X(010)  VALUE SPACES.
023100     SKIP2
023200     05  SLSY-TOTAL.
023300         10  FILLER               PIC X(001)  VALUE '0'.
023400         10  FILLER               PIC X(011)  VALUE 'TOTAL '.
023500         10  FILLER               PIC X(068)  VALUE ALL '='.
023600         10  BUDG-TOTAL           PIC $Z,ZZZ,ZZ9 VALUE ZERO.
023700         10  FILLER               PIC X(005)  VALUE SPACES.
023800         10  COST-TOTAL           PIC $Z,ZZZ,ZZ9 VALUE ZERO.
023900         10  FILLER               PIC X(005)  VALUE SPACES.
024000         10  DIFF-TOTAL           PIC $Z,ZZZ,ZZ9- VALUE ZERO.
024100     05  GRAND-TOTAL.
024200         10  FILLER               PIC X(001)  VALUE '0'.
024300         10  FILLER            PIC X(011)  VALUE 'GRAND TOTAL'.
024400         10  FILLER               PIC X(068)  VALUE ALL '='.
024500         10  BUDG-GTOT            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
024600         10  FILLER               PIC X(005)  VALUE SPACES.
024700         10  COST-GTOT            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
024800         10  FILLER               PIC X(005)  VALUE SPACES.
024900         10  DIFF-GTOT            PIC $Z,ZZZ,ZZ9- VALUE ZERO.
025000     05  TAX-TOTAL.
025100         10  FILLER               PIC X(001)  VALUE '0'.
025200         10  FILLER               PIC X(011)  VALUE 'TAX  '.
025300         10  FILLER               PIC X(068)  VALUE ALL '*'.
025400         10  BUDG-TAX             PIC $Z,ZZZ,ZZ9 VALUE ZERO.
025500         10  FILLER               PIC X(005)  VALUE SPACES.
025600         10  COST-TAX             PIC $Z,ZZZ,ZZ9 VALUE ZERO.
025700         10  FILLER               PIC X(005)  VALUE SPACES.
025800         10  DIFF-TAX             PIC $Z,ZZZ,ZZ9- VALUE ZERO.
025900     SKIP2
026000 01  TDT-PROCESS-DATE.
026100     05  DATE-OF-RUN-YY           PIC 99.
026200     05  DATE-OF-RUN-MM           PIC 99.
026300     05  DATE-OF-RUN-DD           PIC 99.
026400 01  TDT-PROCESS-TIME.
026500     05  TIME-OF-RUN-HH           PIC 99.
026600     05  TIME-OF-RUN-MM           PIC 99.
026700     05  TIME-OF-RUN-SS           PIC 99.
026800     05  TIME-OF-RUN-TT           PIC 99.
026900 01  TDT-DATE-OF-RUN.
027000     05  DATE-OF-RUN-MM           PIC 99.
027100     05  FILLER                   PIC X(001) VALUE '/'.
027200     05  DATE-OF-RUN-DD           PIC 99.
027300     05  FILLER                   PIC X(001) VALUE '/'.
027400     05  DATE-OF-RUN-YY           PIC 99.
027500 01  TDT-TIME-OF-RUN.
027600     05  TIME-OF-RUN-HH           PIC 99.
027700     05  FILLER                   PIC X(001) VALUE ':'.
027800     05  TIME-OF-RUN-MM           PIC 99.
027900     05  FILLER                   PIC X(001) VALUE ':'.
028000     05  TIME-OF-RUN-SS           PIC 99.
028100 01  MAC-A-REC.
028200         10  CONTROL-FIELD        PIC X(001).
028300         10  TBL-KEY.
028400             15  VEND-OUT         PIC X(010).
028500             15  FMID-OUT         PIC X(010).
028600         10  IDTE-OUT             PIC X(008).
028700         10  VERS-OUT             PIC X(010).
028800         10  SERI-OUT             PIC X(010).
028900         10  DESC-OUT             PIC X(040).
029000         10  STAT-OUT             PIC X(010).
029100         10  CONT-OUT             PIC X(015).
029200         10  BUDG-OUT             PIC X(007).
029300         10  COST-OUT             PIC X(007).
029400         10  PCST-OUT             PIC X(007).
029410         10  VPHN-OUT             PIC X(014).
029420         10  HPHN-OUT             PIC X(014).
029430         10  WPHN-OUT             PIC X(004).
029500     EJECT
029600 PROCEDURE DIVISION.
029700     SKIP2
029800 1010-MAINLINE.
029900     SKIP1
030000     PERFORM 2010-HOUSEKEEPING
030100        THRU 2010-EXIT.
030200     CALL 'ISPLINK' USING TBOPEN SLSY.
030300     MOVE 10 TO LENG.
030400     CALL 'ISPLINK' USING VDEFINE VEND1V VEND1 CHAR LENG.
030500     MOVE 10 TO LENG.
030600     CALL 'ISPLINK' USING VDEFINE VENDV VEND CHAR LENG.
030700     MOVE 10 TO LENG.
030800     CALL 'ISPLINK' USING VDEFINE FMID1V FMID1 CHAR LENG.
030900     MOVE 10 TO LENG.
031000     CALL 'ISPLINK' USING VDEFINE FMIDV FMID CHAR LENG.
031100     MOVE 08 TO LENG.
031200     CALL 'ISPLINK' USING VDEFINE IDTEV IDTE CHAR LENG.
031300     MOVE 10 TO LENG.
031400     CALL 'ISPLINK' USING VDEFINE VERSV VERS CHAR LENG.
031500     MOVE 10 TO LENG.
031600     CALL 'ISPLINK' USING VDEFINE SERIV SERI CHAR LENG.
031700     MOVE 40 TO LENG.
031800     CALL 'ISPLINK' USING VDEFINE DESCV DESC CHAR LENG.
031900     MOVE 10 TO LENG.
032000     CALL 'ISPLINK' USING VDEFINE STATV STAT CHAR LENG.
032100     MOVE 15 TO LENG.
032200     CALL 'ISPLINK' USING VDEFINE CONTV CONT CHAR LENG.
032300     MOVE 07 TO LENG.
032400     CALL 'ISPLINK' USING VDEFINE BUDGV BUDG CHAR LENG.
032500     MOVE 07 TO LENG.
032600     CALL 'ISPLINK' USING VDEFINE COSTV COST CHAR LENG.
032700     MOVE 07 TO LENG.
032800     CALL 'ISPLINK' USING VDEFINE PCSTV PCST CHAR LENG.
032810     MOVE 14 TO LENG.
032820     CALL 'ISPLINK' USING VDEFINE VPHNV VPHN CHAR LENG.
032821     MOVE 14 TO LENG.
032822     CALL 'ISPLINK' USING VDEFINE HPHNV HPHN CHAR LENG.
032850     MOVE 04 TO LENG.
032860     CALL 'ISPLINK' USING VDEFINE WPHNV WPHN CHAR LENG.
032900     SKIP1
033000     OPEN OUTPUT SLSY-RECS.
033100     MOVE CON-FALSE TO SWT-END-OF-DATA.
033200     PERFORM 2011-READ-RECORD
033300        UNTIL END-OF-DATA.
033400     CALL 'ISPLINK' USING TBCLOSE SLSY.
033500     CALL 'ISPLINK' USING TBERASE SLSY.
033600     CLOSE SLSY-RECS.
033700     PERFORM 2012-SORT.
033800     CALL 'ISPLINK' USING TBCREATE SLSY VCREATE-KEYS VCREATE-VARS.
033900     MOVE CON-FALSE TO SWT-END-OF-INPUT.
034000     MOVE CON-FALSE TO SWT-END-OF-DATA.
034100     OPEN INPUT SLSY-RECS.
034200     PERFORM 2014-RECREATE
034300        UNTIL END-OF-DATA.
034400     CALL 'ISPLINK' USING TBCLOSE SLSY.
034500     CLOSE SLSY-RECS.
034600     MOVE CON-FALSE TO SWT-END-OF-INPUT.
034700     OPEN INPUT SLSY-RECS.
034800     PERFORM 3010-READ-RECORD
034900        UNTIL END-OF-INPUT.
035000     SKIP1
035100     CLOSE SLSY-RECS.
035200     PERFORM 2015-SORT.
035300     MOVE CON-FALSE TO SWT-END-OF-INPUT.
035400     ON 1 ADD 70 TO REPORT-LINE-COUNT.
035500     MOVE ZERO TO PAGE-COUNT.
035600     OPEN INPUT SLSY-RECS.
035700     MOVE ZERO TO BUDG-WRK.
035800     MOVE ZERO TO BUDG-TOT.
035900     MOVE ZERO TO COST-WRK.
036000     MOVE ZERO TO COST-TOT.
036100     MOVE ZERO TO DIFF-TOT.
036200     MOVE ZERO TO DIFF-WRK.
036300     PERFORM 3010-READ-RECORD
036400        UNTIL END-OF-INPUT.
036500     SKIP1
036600     PERFORM 4010-CLOSE-ALL-FILES
036700        THRU 4010-EXIT.
036800     GOBACK.
036900     SKIP2
037000 1010-EXIT.
037100     EJECT
037200 2010-HOUSEKEEPING.
037300     SKIP2
037400     ACCEPT TDT-PROCESS-DATE FROM DATE.
037500     ACCEPT TDT-PROCESS-TIME FROM TIME.
037600     MOVE CORRESPONDING TDT-PROCESS-DATE TO TDT-DATE-OF-RUN.
037700     MOVE CORRESPONDING TDT-PROCESS-TIME TO TDT-TIME-OF-RUN.
037800     MOVE TDT-DATE-OF-RUN TO HEAD-DATE.
037900     MOVE TDT-TIME-OF-RUN TO HEAD-TIME.
038000     MOVE SPACES TO SH-DETAIL.
038100     OPEN OUTPUT REPT-OUTPUT.
038200     SKIP2
038300 2010-EXIT.
038400     EJECT
038500 2011-READ-RECORD.
038600     MOVE ZERO TO RETURN-CODE.
038700     CALL 'ISPLINK' USING TBSKIP SLSY.
038800     IF RETURN-CODE GREATER THAN 0 THEN
038900      MOVE CON-TRUE TO SWT-END-OF-DATA.
039000     IF NOT END-OF-DATA
039100      THEN
039200       MOVE VEND   TO VEND-OUT
039300       MOVE FMID   TO FMID-OUT
039400       MOVE IDTE   TO IDTE-OUT
039500       MOVE VERS   TO VERS-OUT
039600       MOVE SERI   TO SERI-OUT
039700       MOVE DESC   TO DESC-OUT
039800       MOVE STAT   TO STAT-OUT
039900       MOVE CONT   TO CONT-OUT
040000       MOVE BUDG   TO BUDG-OUT
040100       MOVE COST   TO COST-OUT
040200       MOVE PCST   TO PCST-OUT
040210       MOVE VPHN   TO VPHN-OUT
040220       MOVE HPHN   TO HPHN-OUT
040230       MOVE WPHN   TO WPHN-OUT.
040300     IF NOT END-OF-DATA
040400       THEN
040500       IF VEND NOT EQUAL 'IBM       '
040600         THEN
040700          MOVE CON-NON-IBM TO CONTROL-FIELD.
040800     IF NOT END-OF-DATA
040900       THEN
041000       IF VEND EQUAL 'IBM       '
041100         THEN
041200          MOVE CON-IBM TO CONTROL-FIELD.
041300     IF NOT END-OF-DATA
041400       PERFORM 2013-WRITE-REC THRU 2013-EXIT.
041500 2012-SORT.
041600     SKIP2
041700     SORT SORT-FILE ON ASCENDING KEY SORT-KEY1
041800      USING SLSY-RECS GIVING SLSY-RECS.
041900 2012-EXIT.
042000     EJECT
042100 2013-WRITE-REC.
042200     SKIP2
042300     WRITE SLSY-RECORD FROM MAC-A-REC.
042400 2013-EXIT.
042500     EJECT
042600 2014-RECREATE.
042700     READ SLSY-RECS INTO MAC-A-REC
042800        AT END
042900          MOVE CON-TRUE TO SWT-END-OF-DATA.
043000     IF NOT END-OF-DATA
043100     THEN
043200       MOVE VEND-OUT   TO VEND1
043300       MOVE FMID-OUT   TO FMID1
043400       MOVE VEND-OUT   TO VEND
043500       MOVE FMID-OUT   TO FMID
043600       MOVE IDTE-OUT   TO IDTE
043700       MOVE VERS-OUT   TO VERS
043800       MOVE SERI-OUT   TO SERI
043900       MOVE DESC-OUT   TO DESC
044000       MOVE STAT-OUT   TO STAT
044100       MOVE CONT-OUT   TO CONT
044200       MOVE BUDG-OUT   TO BUDG
044300       MOVE COST-OUT   TO COST
044400       MOVE PCST-OUT   TO PCST
044410       MOVE VPHN-OUT   TO VPHN
044420       MOVE HPHN-OUT   TO HPHN
044430       MOVE WPHN-OUT   TO WPHN.
044500     IF NOT END-OF-DATA
044600     THEN
044700       IF TBL-KEY NOT EQUAL TBL-KEY-WORK
044800         THEN
044900          MOVE TBL-KEY TO TBL-KEY-WORK
045000          MOVE ZERO TO RETURN-CODE
045100          CALL 'ISPLINK' USING TBADD SLSY.
045200 2014-EXIT.
045300     EXIT.
045400 2015-SORT.
045500     SKIP2
045600     SORT SORT-FILE ON ASCENDING KEY SORT-KEY2
045700      USING SLSY-RECS GIVING SLSY-RECS.
045800 2015-EXIT.
045900     EXIT.
046000 3010-READ-RECORD.
046100     SKIP2
046200     READ SLSY-RECS INTO MAC-A-REC
046300        AT END
046400           MOVE CON-TRUE TO SWT-END-OF-INPUT.
046500     IF NOT END-OF-INPUT
046600        THEN
046700        PERFORM 3011-PRINT-THE-REPORT
046800           THRU 3011-EXIT.
046900     IF END-OF-INPUT
047000        THEN
047100        COMPUTE BUDG-WRK = (BUDG-TOT * TAX)
047200        COMPUTE COST-WRK = (COST-TOT * TAX)
047300        COMPUTE DIFF-WRK = (COST-WRK - BUDG-WRK)
047400        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
047500        MOVE BUDG-TOT TO BUDG-TOTAL
047600        MOVE COST-TOT TO COST-TOTAL
047700        MOVE DIFF-TOT TO DIFF-TOTAL
047800        MOVE SLSY-TOTAL TO DETAIL-LINE
047900        WRITE REPORT-RECORD FROM DETAIL-LINE
048000        MOVE BUDG-WRK TO BUDG-TAX
048100        MOVE COST-WRK TO COST-TAX
048200        MOVE DIFF-WRK TO DIFF-TAX
048300        MOVE TAX-TOTAL TO DETAIL-LINE
048400        WRITE REPORT-RECORD FROM DETAIL-LINE
048500        COMPUTE BUDG-TOT = (BUDG-TOT + BUDG-WRK)
048600        COMPUTE COST-TOT = (COST-TOT + COST-WRK)
048700        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
048800        MOVE BUDG-TOT TO BUDG-GTOT
048900        MOVE COST-TOT TO COST-GTOT
049000        MOVE DIFF-TOT TO DIFF-GTOT
049100        MOVE GRAND-TOTAL TO DETAIL-LINE
049200        WRITE REPORT-RECORD FROM DETAIL-LINE.
049300     SKIP2
049400 3010-EXIT.
049500     EJECT
049600 3011-PRINT-THE-REPORT.
049700     SKIP2
049800     MOVE VEND-OUT TO VEND-OUT1.
049900     MOVE FMID-OUT TO FMID-OUT1.
050000     MOVE BUDG-OUT TO BUDG-OUT1.
050100     MOVE BUDG-OUT TO BUDG-WRK.
050200     MOVE COST-OUT TO COST-WRK.
050300     COMPUTE BUDG-TOT = (BUDG-TOT + BUDG-WRK).
050400     COMPUTE COST-TOT = (COST-TOT + COST-WRK).
050500     COMPUTE DIFF-WRK = (COST-WRK - BUDG-WRK).
050600     MOVE VERS-OUT TO VERS-OUT1.
050700     MOVE DESC-OUT TO DESC-OUT1.
050800     MOVE COST-OUT TO COST-OUT1.
050900     MOVE STAT-OUT TO STAT-OUT1.
051000     MOVE DIFF-WRK TO DIFF-OUT1.
051100     MOVE SLSY-SUB TO SH-DETAIL.
051200     MOVE SLSY-DETAIL TO DETAIL-LINE.
051300     ON 1 ADD 70 TO REPORT-LINE-COUNT.
051400     ADD 1 TO REPORT-LINE-COUNT.
051500     IF REPORT-LINE-COUNT GREATER THAN PAGE-LIMIT
051600        THEN
051700        MOVE ZERO TO REPORT-LINE-COUNT
051800        PERFORM 3012-SLSY-HEADER THRU 3012-EXIT.
051900     WRITE REPORT-RECORD FROM DETAIL-LINE.
052000     MOVE SPACES TO DETAIL-LINE.
052100 3011-EXIT.
052200     EJECT
052300 3012-SLSY-HEADER.
052400     SKIP2
052500     ADD 1 TO PAGE-COUNT.
052600     MOVE PAGE-COUNT TO OUT-PAGE.
052700     WRITE REPORT-RECORD FROM SLSY-HEADING.
052800     WRITE REPORT-RECORD FROM SUB-HEADING-LINE.
052900 3012-EXIT.
053000     EJECT
053100 4010-CLOSE-ALL-FILES.
053200     SKIP2
053300     CLOSE SLSY-RECS
053400           REPT-OUTPUT.
053500     SKIP2
053600 4010-EXIT.
053700     EJECT

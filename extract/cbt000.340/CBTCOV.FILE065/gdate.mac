000100 IDENTIFICATION DIVISION.
000200     SKIP1
000300 PROGRAM-ID.    GDATE.
000400     SKIP1
000500 AUTHOR.        FRANK G. BOLAN.
000600     SKIP1
000700 INSTALLATION.  SANTA FE INTERNATIONAL
000800                505 SOUTH MAIN STREET
000900                P.O. BOX 1401
001000                ORANGE, CALIFORNIA 92668
001100                (714) 558-1300.
001200     SKIP1
001300 REMARKS.      ***************************************************
001400               *      THIS PROGRAM CALCULATES THE CURRENT DAY OF *
001500               * WEEK, WEEK OF MONTH AND WEEK OF YEAR FROM A     *
001600               * GREGORIAN DATE PROVIDED IN A INPUT FIELD. THE   *
001700               * INPUT FIELD ALSO MAY CONTAIN A NUMERIC FIELD    *
001800               * WHICH CAN BE USED TO CALCULATE A STOP DATE.     *
001900               *                                                 *
002000               * THE FOLLOWING DATA NAMES CONTAIN DATA AS FOLLOWS*
002100               *   INPUT-START-DATE     MM/DD/YY                 *
002200               *   INPUT-DURATION       NNN                      *
002300               *   INPUT-STOP-DATE      MM/DD/YY                 *
002400               *   START-DATE           DATE FROM INPUT FIELD    *
002500               *   START-DOWDTE         START DAY OF WEEK        *
002600               *   START-WOMDTE         START WEEK OF MONTH      *
002700               *   START-WOYDTE         START WEEK OF YEAR       *
002800               *   STOP-DATE            CALCULATED STOP DATE     *
002900               *   STOP-DOWDTE          STOP DAY OF WEEK         *
003000               *   STOP-WOMDTE          STOP WEEK OF MONTH       *
003100               *   START-DAY-OF-WEEK    IE MONDAY OR TUESDAY     *
003200               *   STOP-DAY-OF-WEEK     IE WEDNESDAY OR THURSDAY *
003300               *   DATE-DURATION        TIME FROM START TO STOP  *
003400               *                                                 *
003500               *                                                 *
003600               *                                                 *
003700               *  CALL 'GDATE' USING DATE-IN DATE-OUT.           *
003800               *                                                 *
003900               *  01 DATE-IN.                                    *
004000               *     05 INPUT-START-DATE.                        *
004100               *        10 START-INPUT-MM PIC X(002).            *
004200               *        10 FILLER         PIC X(001) VALUE '/'.  *
004300               *        10 START-INPUT-DD PIC X(002).            *
004400               *        10 FILLER         PIC X(001) VALUE '/'.  *
004500               *        10 START-INPUT-YY PIC X(002).            *
004600               *     05 INPUT-DURATION    PIC X(003).            *
004700               *     05 INPUT-STOP-DATE.                         *
004800               *        10 STOP-INPUT-MM  PIC X(002).            *
004900               *        10 FILLER         PIC X(001) VALUE '/'.  *
005000               *        10 STOP-INPUT-DD  PIC X(002).            *
005100               *        10 FILLER         PIC X(001) VALUE '/'.  *
005200               *        10 STOP-INPUT-YY  PIC X(002).            *
005300               *                                                 *
005400               *  01 DATE-OUT.                                   *
005500               *     05 START-DATE.                              *
005600               *        10 STRT-MM        PIC X(002).            *
005700               *        10 FILLER         PIC X(001) VALUE '/'.  *
005800               *        10 STRT-DD        PIC X(002).            *
005900               *        10 FILLER         PIC X(001) VALUE '/'.  *
006000               *        10 STRT-YY        PIC X(002).            *
006100               *     05 STOP-DATE.                               *
006200               *        10 STOP-MM        PIC X(002).            *
006300               *        10 FILLER         PIC X(001) VALUE '/'.  *
006400               *        10 STOP-DD        PIC X(002).            *
006500               *        10 FILLER         PIC X(001) VALUE '/'.  *
006600               *        10 STOP-YY        PIC X(002).            *
006700               *     05 START-DAY-OF-WEEK PIC X(9) VALUE SPACES. *
006800               *     05 STOP-DAY-OF-WEEK  PIC X(9) VALUE SPACES. *
006900               *     05 START-DOWDTE      PIC 9  VALUE 0.        *
007000               *     05 START-WOMDTE      PIC 9  VALUE 0.        *
007100               *     05 START-WOYDTE      PIC 99 VALUE 0.        *
007200               *     05 STOP-DOWDTE       PIC 9  VALUE 0.        *
007300               *     05 STOP-WOMDTE       PIC 9  VALUE 0.        *
007400               *     05 STOP-WOYDTE       PIC 99 VALUE 0.        *
007500               *     05 DATE-DURATION     PIC 999 VALUE 0.       *
007600               *                                                 *
007700               *                                                 *
007800               ***************************************************
007900     EJECT
008000 ENVIRONMENT DIVISION.
008100     SKIP1
008200 CONFIGURATION SECTION.
008300 SOURCE-COMPUTER.           IBM-370.
008400 OBJECT-COMPUTER.           IBM-370.
008500     SKIP1
008600 DATA DIVISION.
008700     SKIP1
008800 FILE SECTION.
008900 WORKING-STORAGE SECTION.
009000     SKIP1
009100 01  WS-DATE-CONVERSION-FIELDS.
009200     05  JUL.
009300         10 JUL-YY                PIC 99   VALUE 0.
009400         10 JUL-DDD               PIC 999  VALUE 0.
009500     05  CUR-DAY                  PIC 999  VALUE 0.
009600     05  FDOY                     PIC S9   VALUE +2.
009700     05  WRK-JUL.
009800         10  WRKYEAR              PIC 99   VALUE 79.
009900         10  WRKDAY               PIC 999  VALUE 001.
010000     05  NEXT-DOWDTE              PIC S9   VALUE +1.
010100     05  MAX-DAYS                 PIC S999 VALUE +365.
010200     05  DURATION                 PIC S999 VALUE +0.
010300     05  DOW                      PIC S9   VALUE +0.
010400     05  DOWDTE                   PICTURE S9 VALUE +0.
010500     05  WOYDTE                   PICTURE S99 VALUE +1.
010600     05  WOMDTE                   PICTURE S99 VALUE +1.
010700     05  WOY                      PIC S99  VALUE +1.
010800     05  WOM                      PIC S99  VALUE +1.
010900     05  WRKMON                   PIC S9999 VALUE +0031.
011000     05  JUL-DATE                 PIC 9(5) VALUE 0.
011100     05  WS-DIVIDEND              PIC 9(5) VALUE 0.
011200     05  WS-REMAINDER             PIC 9(5) COMP VALUE 0.
011300     05  MON                      PIC X(09) VALUE 'MONDAY   '.
011400     05  TUE                      PIC X(09) VALUE 'TUESDAY  '.
011500     05  WED                      PIC X(09) VALUE 'WEDNESDAY'.
011600     05  THR                      PIC X(09) VALUE 'THURSDAY '.
011700     05  FRI                      PIC X(09) VALUE 'FRIDAY   '.
011800     05  SAT                      PIC X(09) VALUE 'SATURDAY '.
011900     05  SUN                      PIC X(09) VALUE 'SUNDAY   '.
012000     05  I                        PIC 9(2) VALUE 0.
012100     05  K                        PIC 9(2) VALUE 0.
012200     05  W                        PIC 9(3) VALUE 0.
012300     05  X                        PIC 9(3) VALUE 0.
012400     05  Y                        PIC 9(3) VALUE 0.
012500     05  Z                        PIC 9(3) VALUE 0.
012600     05  GREG-DATE.
012700         10  GREG-MM              PIC 9(2) VALUE 0.
012800         10  GREG-DD              PIC 9(2) VALUE 0.
012900         10  GREG-YY              PIC 9(2) VALUE 0.
013000 01  DATE-IN.
013100         05  INPUT-START-DATE.
013200             10  START-INPUT-MM   PIC X(002) VALUE SPACES.
013300             10  FILLER           PIC X(001) VALUE '/'.
013400             10  START-INPUT-DD   PIC X(002) VALUE SPACES.
013500             10  FILLER           PIC X(001) VALUE '/'.
013600             10  START-INPUT-YY   PIC X(002) VALUE SPACES.
013800         05  INPUT-DURATION       PIC X(003) VALUE SPACES.
013810         05  INPUT-STOP-DATE.
013820             10  STOP-INPUT-MM    PIC X(002) VALUE SPACES.
013830             10  FILLER           PIC X(001) VALUE '/'.
013840             10  STOP-INPUT-DD    PIC X(002) VALUE SPACES.
013850             10  FILLER           PIC X(001) VALUE '/'.
013860             10  STOP-INPUT-YY    PIC X(002) VALUE SPACES.
013900 01  DATE-OUT.
014000     05  START-DATE.
014100         10  STRT-MM              PIC 9(2) VALUE 0.
014200         10  FILLER               PIC X(001) VALUE '/'.
014300         10  STRT-DD              PIC 9(2) VALUE 0.
014400         10  FILLER               PIC X(001) VALUE '/'.
014500         10  STRT-YY              PIC 9(2) VALUE 0.
014600     05  STOP-DATE.
014700         10  STOP-MM              PIC 9(2) VALUE 0.
014800         10  FILLER               PIC X(001) VALUE '/'.
014900         10  STOP-DD              PIC 9(2) VALUE 0.
015000         10  FILLER               PIC X(001) VALUE '/'.
015100         10  STOP-YY              PIC 9(2) VALUE 0.
015200     05  START-DAY-OF-WEEK        PIC X(9) VALUE SPACES.
015300     05  STOP-DAY-OF-WEEK         PIC X(9) VALUE SPACES.
015400     05  START-DOWDTE             PICTURE 9 VALUE 0.
015500     05  START-WOMDTE             PICTURE 9 VALUE 0.
015600     05  START-WOYDTE             PICTURE 99 VALUE 0.
015700     05  STOP-DOWDTE              PICTURE 9 VALUE 0.
015800     05  STOP-WOMDTE              PICTURE 9 VALUE 0.
015900     05  STOP-WOYDTE              PICTURE 99 VALUE 0.
015910     05  DATE-DURATION            PICTURE 999 VALUE 0.
016000     EJECT
016100 01  DAY-TABLE-VALUES.
016200     05  JAN                      PIC S99   VALUE +31.
016300     05  FEB                      PIC S99   VALUE +28.
016400     05  MAR                      PIC S99   VALUE +31.
016500     05  APR                      PIC S99   VALUE +30.
016600     05  MAY                      PIC S99   VALUE +31.
016700     05  JUN                      PIC S99   VALUE +30.
016800     05  JULY                     PIC S99   VALUE +31.
016900     05  AUG                      PIC S99   VALUE +31.
017000     05  SEP                      PIC S99   VALUE +30.
017100     05  OCT                      PIC S99   VALUE +31.
017200     05  NOV                      PIC S99   VALUE +30.
017300     05  DEC                      PIC S99   VALUE +31.
017400 01  DAY-TABLE REDEFINES DAY-TABLE-VALUES.
017500     05  DAYS   OCCURS 12 TIMES   PIC S99.
017600     EJECT
017700 01  CON-CONSTANTS.
017800     05  CON-TRUE                 PIC X(001)  VALUE 'T'.
017900     05  CON-FALSE                PIC X(001)  VALUE 'F'.
018000     05  PLUS-1                   PIC S99     VALUE +1.
018100     05  PLUS-2                   PIC S99     VALUE +2.
018200     05  PLUS-3                   PIC S99     VALUE +3.
018300     05  PLUS-4                   PIC S99     VALUE +4.
018400     05  PLUS-8                   PIC S99     VALUE +8.
018500     05  PLUS-24                  PIC S99     VALUE +24.
018600     05  PLUS-28                  PIC S99     VALUE +28.
018700     05  PLUS-29                  PIC S99     VALUE +29.
018800     05  PLUS-31                  PIC S99     VALUE +31.
018900     05  PLUS-79                  PIC S99     VALUE +79.
019000     05  PLUS-365                 PIC S999    VALUE +365.
019100     05  PLUS-366                 PIC S999    VALUE +366.
019200     SKIP2
019300     05  SWT-DAY-OF-WEEK-SET      PIC X(001).
019400         88  DAY-OF-WEEK-SET                  VALUE 'T'.
019500     05  SWT-GREG-SET             PIC X(001).
019600         88  GREG-SET                         VALUE 'T'.
019700     05  SWT-DATE-INPUT           PIC X(001).
019800         88  DATE-INPUT                       VALUE 'T'.
019900     05  SWT-DURATION-OK          PIC X(001).
020000         88  DURATION-OK                      VALUE 'T'.
020100     05  SWT-DUR-INPUT            PIC X(001).
020200         88  DUR-INPUT                        VALUE 'T'.
020300     EJECT
020400 01  TDT-PROCESS-DATE.
020500     05  DATE-OF-RUN-YY           PIC 99.
020600     05  DATE-OF-RUN-MM           PIC 99.
020700     05  DATE-OF-RUN-DD           PIC 99.
020800 01  TDT-DATE-OF-RUN.
020900     05  DATE-OF-RUN-MM           PIC 99.
021000     05  FILLER                   PIC X(001) VALUE '/'.
021100     05  DATE-OF-RUN-DD           PIC 99.
021200     05  FILLER                   PIC X(001) VALUE '/'.
021300     05  DATE-OF-RUN-YY           PIC 99.
021400     EJECT
021500 PROCEDURE DIVISION USING PARM.
021600     SKIP2
021700 1010-MAINLINE.
021800     SKIP1
021900     MOVE CON-FALSE TO SWT-DATE-INPUT.
022000     MOVE CON-FALSE TO SWT-DUR-INPUT.
022100     IF START-INPUT-MM NUMERIC THEN
022200        THEN MOVE CON-TRUE TO SWT-DATE-INPUT
022300     ELSE
022400        MOVE CON-FALSE TO SWT-DATE-INPUT
022500        MOVE PLUS-8 TO RETURN-CODE.
022600     IF START-INPUT-DD NUMERIC THEN
022700        THEN MOVE CON-TRUE TO SWT-DATE-INPUT
022800     ELSE
022900        MOVE CON-FALSE TO SWT-DATE-INPUT
023000        MOVE PLUS-8 TO RETURN-CODE.
023100     IF START-INPUT-YY NUMERIC THEN
023200        THEN MOVE CON-TRUE TO SWT-DATE-INPUT
023300     ELSE
023400        MOVE CON-FALSE TO SWT-DATE-INPUT
023500        MOVE PLUS-8 TO RETURN-CODE.
023600     IF INPUT-DURATION NUMERIC THEN
023700        THEN MOVE CON-TRUE TO SWT-DUR-INPUT
023800     ELSE
023900        MOVE CON-FALSE TO SWT-DUR-INPUT
024000        MOVE PLUS-4 TO RETURN-CODE.
024100     SKIP1
024200     PERFORM 2010-HOUSEKEEPING
024300        THRU 2010-EXIT.
024400     SKIP1
024500     PERFORM 3010-GREG-TO-JUL THRU 3010-EXIT.
024600     SKIP1
024700     GOBACK.
024800     SKIP2
024900 1010-EXIT.
025000     EJECT
025100 2010-HOUSEKEEPING.
025200     SKIP2
025300     ACCEPT TDT-PROCESS-DATE FROM DATE.
025400     MOVE CORRESPONDING TDT-PROCESS-DATE TO TDT-DATE-OF-RUN.
025500     MOVE ZERO TO DOWDTE
025600                  WOMDTE
025700                  WOYDTE.
025800     MOVE CON-TRUE TO SWT-DURATION-OK.
025900     IF DUR-INPUT
026000        MOVE INPUT-DURATION TO DURATION
026100        MOVE CON-FALSE TO SWT-DURATION-OK
026200     ELSE
026300        MOVE CON-TRUE TO SWT-DURATION-OK.
026400     IF DATE-INPUT
026500        MOVE START-INPUT-MM TO GREG-MM
026600        MOVE START-INPUT-DD TO GREG-DD
026700        MOVE START-INPUT-YY TO GREG-YY
026800     ELSE
026900        MOVE DATE-OF-RUN-MM IN TDT-DATE-OF-RUN
027000           TO GREG-MM IN GREG-DATE
027100        MOVE DATE-OF-RUN-DD IN TDT-DATE-OF-RUN
027200           TO GREG-DD IN GREG-DATE
027300        MOVE DATE-OF-RUN-YY IN TDT-DATE-OF-RUN
027400           TO GREG-YY IN GREG-DATE.
027500     SKIP2
027600 2010-EXIT.
027700     EJECT
027800 3010-GREG-TO-JUL.
027900     SKIP2
028000     PERFORM 3015-RESET THRU 3015-EXIT.
028100     COMPUTE JUL-DATE = GREG-DD + (GREG-YY * 1000).
028200     MOVE JUL-DATE TO JUL.
028300     PERFORM 3011-GO-FOR-IT THRU 3011-EXIT.
028400     MOVE DOWDTE TO START-DOWDTE.
028500     MOVE WOMDTE TO START-WOMDTE.
028600     MOVE WOYDTE TO START-WOYDTE.
028700     MOVE GREG-MM TO STRT-MM.
028800     MOVE GREG-DD TO STRT-DD.
028900     MOVE GREG-YY TO STRT-YY.
029000     PERFORM 3017-JUL-TO-GREG.
029100     PERFORM 3015-RESET THRU 3015-EXIT.
029200     COMPUTE JUL-DATE = GREG-DD + (GREG-YY * 1000).
029300     MOVE JUL-DATE TO JUL.
029400     PERFORM 3011-GO-FOR-IT THRU 3011-EXIT.
029500     MOVE DOWDTE TO STOP-DOWDTE.
029600     MOVE WOMDTE TO STOP-WOMDTE.
029700     MOVE WOYDTE TO STOP-WOYDTE.
029800     MOVE GREG-MM TO STOP-MM.
029900     MOVE GREG-DD TO STOP-DD.
030000     MOVE GREG-YY TO STOP-YY.
030100     IF START-DOWDTE = 1 MOVE SAT TO START-DAY-OF-WEEK.
030200     IF START-DOWDTE = 2 MOVE SUN TO START-DAY-OF-WEEK.
030300     IF START-DOWDTE = 3 MOVE MON TO START-DAY-OF-WEEK.
030400     IF START-DOWDTE = 4 MOVE TUE TO START-DAY-OF-WEEK.
030500     IF START-DOWDTE = 5 MOVE WED TO START-DAY-OF-WEEK.
030600     IF START-DOWDTE = 6 MOVE THR TO START-DAY-OF-WEEK.
030700     IF START-DOWDTE = 7 MOVE FRI TO START-DAY-OF-WEEK.
030800     IF STOP-DOWDTE = 1 MOVE SAT TO STOP-DAY-OF-WEEK.
030900     IF STOP-DOWDTE = 2 MOVE SUN TO STOP-DAY-OF-WEEK.
031000     IF STOP-DOWDTE = 3 MOVE MON TO STOP-DAY-OF-WEEK.
031100     IF STOP-DOWDTE = 4 MOVE TUE TO STOP-DAY-OF-WEEK.
031200     IF STOP-DOWDTE = 5 MOVE WED TO STOP-DAY-OF-WEEK.
031300     IF STOP-DOWDTE = 6 MOVE THR TO STOP-DAY-OF-WEEK.
031400     IF STOP-DOWDTE = 7 MOVE FRI TO STOP-DAY-OF-WEEK.
031500     DISPLAY 'START DATE   = ' START-DATE
031600             '  DAY        = ' START-DAY-OF-WEEK
031700             '  DOW        = ' START-DOWDTE
031800             '  WOM        = ' START-WOMDTE
031900             '  WOY        = ' START-WOYDTE.
032000     DISPLAY 'STOP DATE    = ' STOP-DATE
032100             '  DAY        = ' STOP-DAY-OF-WEEK
032200             '  DOW        = ' STOP-DOWDTE
032300             '  WOM        = ' STOP-WOMDTE
032400             '  WOY        = ' STOP-WOYDTE
032500             'DURATION     = ' DATE-DURATION.
032600     SKIP2
032700 3010-EXIT.
032800     EJECT
032900 3011-GO-FOR-IT.
033000     DIVIDE JUL-YY BY 4 GIVING WS-DIVIDEND REMAINDER WS-REMAINDER.
033100     IF WS-REMAINDER = 0
033200        THEN
033300         MOVE PLUS-29 TO FEB.
033400     COMPUTE I = GREG-MM
033500     COMPUTE K = 1.
033600     IF K NOT EQUAL I
033700        THEN
033800        PERFORM 3012-DAY-LOAD UNTIL K = I.
033900     MOVE JUL-DATE TO JUL.
034000     MOVE CON-FALSE TO SWT-DAY-OF-WEEK-SET.
034100     PERFORM 3013-CALCULATE-DAY-OF-WEEK
034200        UNTIL DAY-OF-WEEK-SET.
034300 3011-EXIT.
034400     EJECT
034500 3012-DAY-LOAD.
034600     COMPUTE JUL-DATE = JUL-DATE + DAYS(K).
034700     COMPUTE K = K + 1.
034800     SKIP2
034900 3012-EXIT.
035000     EJECT
035100 3013-CALCULATE-DAY-OF-WEEK.
035200     IF JUL-YY GREATER THAN WRKYEAR
035300       THEN
035400          COMPUTE FDOY = FDOY + NEXT-DOWDTE
035500          COMPUTE WRKYEAR = WRKYEAR + 1
035600          MOVE PLUS-1 TO WOYDTE
035700          MOVE PLUS-1 TO WOMDTE
035800          MOVE PLUS-1 TO NEXT-DOWDTE
035900          DIVIDE WRKYEAR BY 4 GIVING WS-DIVIDEND
036000                REMAINDER WS-REMAINDER.
036100     IF FDOY GREATER THAN 7
036200          MOVE PLUS-1 TO FDOY.
036300     IF WS-REMAINDER = 0
036400        AND
036500        JUL-YY NOT EQUAL 00
036600          THEN
036700            MOVE PLUS-2 TO NEXT-DOWDTE.
036800     IF WRKYEAR = 00 THEN MOVE PLUS-1 TO NEXT-DOWDTE.
036900     IF WRK-JUL = JUL
037000        THEN
037100         MOVE FDOY TO DOWDTE
037200         MOVE PLUS-1 TO WOMDTE
037300         MOVE PLUS-1 TO WOYDTE
037400         MOVE CON-TRUE TO SWT-DAY-OF-WEEK-SET.
037500     IF WRKYEAR = JUL-YY
037600        THEN
037700          MOVE FDOY TO DOWDTE
037800          MOVE PLUS-1 TO WOMDTE
037900          MOVE PLUS-1 TO WOYDTE
038000          COMPUTE WRKMON = PLUS-31
038100          COMPUTE I = 1
038200          PERFORM 3014-SET-DAY-OF-WEEK
038300            UNTIL WRKDAY = JUL-DDD
038400          MOVE CON-TRUE TO SWT-DAY-OF-WEEK-SET.
038500     SKIP2
038600 3013-EXIT.
038700     EJECT
038800 3014-SET-DAY-OF-WEEK.
038900     COMPUTE DOWDTE = DOWDTE + 1.
039000     IF WRKDAY GREATER THAN WRKMON
039100        THEN
039200          MOVE PLUS-1 TO WOMDTE
039300          ADD  PLUS-1 TO I
039400          COMPUTE WRKMON = WRKMON + DAYS(I).
039500     IF DOWDTE GREATER THAN 7
039600        THEN
039700          MOVE PLUS-1 TO DOWDTE
039800          ADD  PLUS-1 TO WOMDTE
039900          ADD  PLUS-1 TO WOYDTE.
040000     COMPUTE WRKDAY = WRKDAY + 1.
040100     SKIP2
040200 3014-EXIT.
040300     EJECT
040400 3015-RESET.
040500     MOVE PLUS-2 TO FDOY.
040600     MOVE PLUS-79 TO WRKYEAR.
040700     MOVE PLUS-1 TO WRKDAY,
040800                    NEXT-DOWDTE,
040900                    WOMDTE
041000                    WOYDTE.
041100     MOVE PLUS-28 TO FEB.
041200     SKIP2
041300 3015-EXIT.
041400     EJECT
041500 3017-JUL-TO-GREG.
041600     DIVIDE JUL-YY BY 4 GIVING WS-DIVIDEND
041700        REMAINDER WS-REMAINDER.
041800     MOVE PLUS-28 TO FEB.
041900     MOVE PLUS-365 TO MAX-DAYS.
042000     IF WS-REMAINDER = 0
042100        AND JUL-YY NOT EQUAL 00
042200          THEN
042300            MOVE PLUS-366 TO MAX-DAYS
042400            MOVE PLUS-29 TO FEB.
042500     COMPUTE I = 1.
042600     MOVE CON-FALSE TO SWT-GREG-SET.
042700     COMPUTE JUL-DDD = JUL-DDD + DURATION.
042800     IF JUL-DDD GREATER THAN MAX-DAYS
042900        THEN
043000         PERFORM 3019-BIG-DATE UNTIL DURATION-OK.
043100     MOVE JUL-YY TO GREG-YY.
043200     MOVE JUL-DDD TO CUR-DAY.
043300     IF CUR-DAY LESS THAN 32
043400         MOVE I TO GREG-MM
043500         COMPUTE GREG-DD = CUR-DAY
043600         MOVE CON-TRUE TO SWT-GREG-SET.
043700     IF CUR-DAY GREATER THAN 31
043800        PERFORM 3018-SET-GREG-DATE UNTIL GREG-SET.
043900     SKIP2
044000 3017-EXIT.
044100     EJECT
044200 3018-SET-GREG-DATE.
044300     IF CUR-DAY GREATER THAN 31
044400        COMPUTE CUR-DAY = CUR-DAY - DAYS(I).
044500     IF CUR-DAY = 31 AND I = 1
044600        COMPUTE I = I + 1
044700        COMPUTE CUR-DAY = CUR-DAY - DAYS(I).
044800     IF CUR-DAY = 30 AND I = 1
044900        COMPUTE I = I + 1
045000        COMPUTE CUR-DAY = CUR-DAY - DAYS(I).
045100     IF CUR-DAY LESS THAN 30
045200        OR CUR-DAY = 30
045300        THEN
045400         COMPUTE I = I + 1
045500         MOVE I TO GREG-MM
045600         COMPUTE GREG-DD = CUR-DAY
045700         MOVE CON-TRUE TO SWT-GREG-SET.
045800     IF CUR-DAY EQUAL 31
045900         COMPUTE I = I + 1
046000         MOVE I TO GREG-MM
046100         COMPUTE GREG-DD = CUR-DAY
046200         MOVE CON-TRUE TO SWT-GREG-SET.
046300     COMPUTE I = I + 1.
046400     SKIP2
046500 3018-EXIT.
046600     EJECT
046700 3019-BIG-DATE.
046800     IF JUL-DDD GREATER THAN MAX-DAYS
046900        THEN
047000         COMPUTE JUL-DDD = JUL-DDD - MAX-DAYS
047100         COMPUTE JUL-YY = JUL-YY + 1
047200         PERFORM 3020-LEAP-CHECK
047300     ELSE
047400       MOVE CON-TRUE TO SWT-DURATION-OK.
047500 3019-EXIT.
047600     EJECT
047700 3020-LEAP-CHECK.
047800     EJECT
047900     DIVIDE JUL-YY BY 4 GIVING WS-DIVIDEND
048000        REMAINDER WS-REMAINDER.
048100     MOVE PLUS-28 TO FEB.
048200     MOVE PLUS-365 TO MAX-DAYS.
048300     IF WS-REMAINDER = 0
048400        AND JUL-YY NOT EQUAL 00
048500          THEN
048600            MOVE PLUS-366 TO MAX-DAYS
048700            MOVE PLUS-29 TO FEB.
048800 3020-EXIT.
048900     EJECT

000100 IDENTIFICATION DIVISION.
000200     SKIP1
000300 PROGRAM-ID.    SOFTRPT4.
000400     SKIP1
000500 AUTHOR.        FRANK G. BOLAN.
000600     SKIP1
000700 INSTALLATION.  SANTA FE INTERNATIONAL
000800                505 SOUTH MAIN STREET
000900                P.O. BOX 1401
001000                ORANGE, CALIFORNIA 92668
001100     SKIP1
001200 REMARKS.      ***************************************************
001300               *      THIS PROGRAM READS A DIALOG MANAGER TABLE  *
001400               * CREATES A EXTRACT FILE, SORTS AND RECREATES THE *
001500               * TABLE THEN PRODUCES A SOFTWARE REPORT.          *
001600               ***************************************************
001700     EJECT
001800 ENVIRONMENT DIVISION.
001900     SKIP1
002000 CONFIGURATION SECTION.
002100 SOURCE-COMPUTER.           IBM-370.
002200 OBJECT-COMPUTER.           IBM-370.
002300     SKIP1
002400 INPUT-OUTPUT SECTION.
002500     SKIP1
002600 FILE-CONTROL.
002700     SKIP1
002800     SELECT SOFT-RECS
002900        ASSIGN TO UT-S-RI.
003000     SELECT REPT-OUTPUT
003100        ASSIGN TO UT-S-RO.
003200     SELECT SORT-FILE
003300        ASSIGN TO UT-S-SORTWK01.
003400     EJECT
003500 DATA DIVISION.
003600     SKIP1
003700 FILE SECTION.
003800 FD  SOFT-RECS
003900     RECORDING MODE IS F
004000     LABEL RECORDS ARE STANDARD
004100     RECORD CONTAINS 266 CHARACTERS
004200     BLOCK CONTAINS 0 RECORDS
004300     DATA RECORDS ARE SOFT-RECORD.
004400     SKIP1
004500 01  SOFT-RECORD                  PIC X(266).
004600     EJECT
004700 FD  REPT-OUTPUT
004800     RECORDING MODE IS F
004900     LABEL RECORDS ARE STANDARD
005000     RECORD CONTAINS 133 CHARACTERS
005100     BLOCK CONTAINS 0 RECORDS
005200     DATA RECORDS ARE REPORT-RECORD.
005300     SKIP1
005400 01  REPORT-RECORD.
005500     05  PRINTCC                  PIC X(001).
005600     05  PRINTLINE                PIC X(132).
005700     EJECT
005800 SD  SORT-FILE
005900     RECORDING MODE IS F.
006000     SKIP1
006100 01  SORT-RECORD.
006200     05  SORT-KEY1.
006300         10  CONTROL-FIELDS       PIC X(001).
006400         10  VEND-OUTS            PIC X(010).
006500         10  FMID-OUTS            PIC X(010).
006600     05  IDTE-OUTS            PIC X(008).
006700     05  VERS-OUTS            PIC X(010).
006800     05  SERI-OUTS            PIC X(010).
006900     05  SORT-KEY2.
007000         10  DESC-OUTS            PIC X(040).
007100     05  STAT-OUTS            PIC X(010).
007200     05  CONT-OUTS            PIC X(015).
007300     05  BUDG-OUTS            PIC X(007).
007400     05  COST-OUTS            PIC X(007).
007500     05  PCST-OUTS            PIC X(007).
007510     05  VPHN-OUTS            PIC X(014).
007520     05  HPHN-OUTS            PIC X(014).
007530     05  WPHN-OUTS            PIC X(004).
007600     EJECT
007700 WORKING-STORAGE SECTION.
007800 01  VDEF-KEYS.
007900     10  VEND1V               PIC X(007) VALUE '(VEND1)'.
008000     10  FMID1V               PIC X(007) VALUE '(FMID1)'.
008100 01  VDEF-SCREEN.
008200     10  VENDV                PIC X(006) VALUE '(VEND)'.
008300     10  FMIDV                PIC X(006) VALUE '(FMID)'.
008400     10  IDTEV                PIC X(006) VALUE '(IDTE)'.
008500     10  VERSV                PIC X(006) VALUE '(VERS)'.
008600     10  SERIV                PIC X(006) VALUE '(SERI)'.
008700     10  DESCV                PIC X(006) VALUE '(DESC)'.
008800     10  STATV                PIC X(006) VALUE '(STAT)'.
008900     10  CONTV                PIC X(006) VALUE '(CONT)'.
009000     10  BUDGV                PIC X(006) VALUE '(BUDG)'.
009100     10  COSTV                PIC X(006) VALUE '(COST)'.
009200     10  PCSTV                PIC X(006) VALUE '(PCST)'.
009210     10  VPHNV                PIC X(006) VALUE '(VPHN)'.
009220     10  HPHNV                PIC X(006) VALUE '(HPHN)'.
009230     10  WPHNV                PIC X(006) VALUE '(WPHN)'.
009300 01  VCREATE-KEYS.
009400     10  VEND1C               PIC X(007) VALUE '(VEND1 '.
009500     10  FMID1C               PIC X(006) VALUE 'FMID1)'.
009600 01  VCREATE-VARS.
009700     10  VENDC                PIC X(006) VALUE '(VEND '.
009800     10  FMIDC                PIC X(005) VALUE 'FMID '.
009900     10  IDTEC                PIC X(005) VALUE 'IDTE '.
010000     10  VERSC                PIC X(005) VALUE 'VERS '.
010100     10  SERIC                PIC X(005) VALUE 'SERI '.
010200     10  DESCC                PIC X(005) VALUE 'DESC '.
010300     10  STATC                PIC X(005) VALUE 'STAT '.
010400     05  CONTC                PIC X(005) VALUE 'CONT '.
010500     05  BUDGC                PIC X(005) VALUE 'BUDG '.
010600     05  COSTC                PIC X(005) VALUE 'COST '.
010700     05  PCSTC                PIC X(005) VALUE 'PCST '.
010710     05  VPHNC                PIC X(005) VALUE 'VPHN '.
010711     05  HPHNC                PIC X(005) VALUE 'HPHN '.
010720     05  WPHNC                PIC X(005) VALUE 'WPHN)'.
010800 01  VARS.
010900     10  VEND1                PIC X(010).
011000     10  FMID1                PIC X(010).
011100     10  VEND                 PIC X(010).
011200     10  FMID                 PIC X(010).
011300     10  IDTE                 PIC X(008).
011400     10  VERS                 PIC X(010).
011500     10  SERI                 PIC X(010).
011600     10  DESC                 PIC X(040).
011700     10  STAT                 PIC X(010).
011800     05  CONT                 PIC X(015).
011900     05  BUDG                 PIC X(007).
012000     05  COST                 PIC X(007).
012100     05  PCST                 PIC X(007).
012110     05  VPHN                 PIC X(014).
012120     05  HPHN                 PIC X(014).
012130     05  WPHN                 PIC X(004).
012200     SKIP1
012300 01  SPF-KEYWORD-PARMS.
012400     10  LENG           PIC 9(09) COMP VALUE 6.
012500     10  CHAR           PIC X(05) VALUE 'CHAR '.
012600     10  PANEL          PIC X(08) VALUE SPACE.
012700     10  VMOVE          PIC X(05) VALUE 'MOVE '.
012800     10  VLOCATE        PIC X(07) VALUE 'LOCATE '.
012900     10  NUMB           PIC S9(08) COMP VALUE +1.
013000 01  SPF-FUNCTION-CALLS.
013100     10  VDEFINE        PIC X(08) VALUE 'VDEFINE '.
013200     10  VREPLACE       PIC X(09) VALUE 'VREPLACE '.
013300     10  VCOPY          PIC X(06) VALUE 'VCOPY '.
013400     10  VDISPLAY       PIC X(08) VALUE 'DISPLAY '.
013500     10  TBSKIP         PIC X(07) VALUE 'TBSKIP '.
013600     10  TBOPEN         PIC X(07) VALUE 'TBOPEN '.
013700     10  TBCLOSE        PIC X(08) VALUE 'TBCLOSE '.
013800     10  TBCREATE       PIC X(09) VALUE 'TBCREATE '.
013900     10  TBDISPL        PIC X(08) VALUE 'TBDISPL '.
014000     10  TBERASE        PIC X(08) VALUE 'TBERASE '.
014100     10  TBADD          PIC X(06) VALUE 'TBADD '.
014200     10  TBGET          PIC X(06) VALUE 'TBGET '.
014300     10  VGET           PIC X(05) VALUE 'VGET '.
014400 01  SPF-TABLES.
014500     10  SOFT           PIC X(05) VALUE 'SOFT '.
014700     SKIP1
014800 01  DETAIL-LINE.
014900     05  CC-CONTROL               PIC X(001) VALUE SPACE.
015000     05  DETAIL-DATA              PIC X(132).
015100     SKIP1
015200 01  SUB-HEADING-LINE.
015300     05  SH-CONTROL               PIC X(001) VALUE '0'.
015400     05  SH-DETAIL                PIC X(132).
015500     SKIP1
015600 01  SOFT-HEADING.
015700     05  FILLER                   PIC X(001) VALUE '1'.
015800     05  HEAD-DATE                PIC X(008) VALUE SPACES.
015900     05  FILLER                   PIC X(022) VALUE ' '.
016000     05  HEADING-DETAIL           PIC X(033) VALUE SPACES.
016100     05  FILLER                   PIC X(018) VALUE ' '.
016200     05  HEAD-TIME                PIC X(008).
016300     05  FILLER                   PIC X(027) VALUE ' '.
016400     05  FILLER                   PIC X(005) VALUE 'PAGE '.
016500     05  OUT-PAGE                 PIC Z,ZZ9.
016600 01  CNT-COUNTERS.
016700     05  REPORT-LINE-COUNT        PIC S9(004) VALUE ZERO.
016800 01  CON-CONSTANTS.
016900     05  CON-TRUE                 PIC X(001)  VALUE 'T'.
017000     05  CON-FALSE                PIC X(001)  VALUE 'F'.
017100     05  CON-EJECT                PIC X(001)  VALUE '1'.
017200     05  CON-SKIP1                PIC X(001)  VALUE ' '.
017300     05  CON-SKIP2                PIC X(001)  VALUE '0'.
017400     05  CON-IBM                  PIC X(001)  VALUE 'A'.
017500     05  CON-NON-IBM              PIC X(001)  VALUE 'B'.
017600     05  CON-SKIP3                PIC X(001)  VALUE '-'.
017700     05  PLUS-1                   PIC S99     VALUE +1.
017800     05  TAX                      PIC S9V99    VALUE +0.06.
017900     05  BUDG-TOT                 PIC S9(7)   VALUE +0.
018000     05  COST-TOT                 PIC S9(7)   VALUE +0.
018100     05  DIFF-TOT                 PIC S9(7)   VALUE +0.
018200     05  BUDG-WRK                 PIC S9(7)   VALUE +0.
018300     05  COST-WRK                 PIC S9(7)   VALUE +0.
018400     05  DIFF-WRK                 PIC S9(7)   VALUE +0.
018500     05  PLUS-2                   PIC S99     VALUE +2.
018600     05  PLUS-3                   PIC S99     VALUE +3.
018700     05  PAGE-LIMIT               PIC S99     VALUE +52.
018800     05  DIF-DES                 PIC X(011)  VALUE 'DIFFERENCE '.
018900     05  PSR-DES                 PIC X(011)  VALUE 'PSR SUPPORT'.
019000     05  HEADING-DETAIL1.
019100         10  FILLER    PIC X(015) VALUE 'SOFTWARE BUDGET'.
019200         10  FILLER    PIC X(018) VALUE ' REPORT        '.
019300     05  HEADING-DETAIL2.
019400         10  FILLER    PIC X(015) VALUE 'PSR SUPPORT REP'.
019500         10  FILLER    PIC X(018) VALUE 'ORT            '.
019510     05  HEADING-DETAIL3.
019520         10  FILLER    PIC X(015) VALUE 'PRODUCTS SUPPOR'.
019530         10  FILLER    PIC X(018) VALUE 'TED            '.
019600     SKIP2
019700 01  SWT-SWITCHES.
019800     05  SWT-END-OF-INPUT         PIC X(001).
019900         88  END-OF-INPUT                     VALUE 'T'.
020000     05  SWT-END-OF-DATA          PIC X(001).
020100         88  END-OF-DATA                      VALUE 'T'.
020200 01  STA-STORAGE.
020300     05  PAGE-COUNT               PIC 9(003)  VALUE ZERO.
020400     05  TBL-KEY-WORK             PIC X(020)  VALUE SPACES.
020500     05  RTN-CODE                 PIC X(004)  VALUE SPACES.
020600     05  SOFT-SUB.
020700         10  FILLER               PIC X(001)  VALUE SPACES.
020800         10  FILLER               PIC X(011)  VALUE 'VENDOR ID  '.
020900         10  FILLER               PIC X(001)  VALUE SPACES.
021000         10  FILLER               PIC X(011)  VALUE 'PRODUCT #  '.
021100         10  FILLER               PIC X(001)  VALUE SPACES.
021200         10  FILLER               PIC X(011)  VALUE 'VERSION #  '.
021300         10  FILLER               PIC X(012)  VALUE SPACES.
021400         10  FILLER               PIC X(011)  VALUE 'DESCRIPTION'.
021500         10  FILLER               PIC X(022)  VALUE SPACES.
021600         10  FILLER               PIC X(011)  VALUE 'BUDGETED   '.
021700         10  FILLER               PIC X(003)  VALUE SPACES.
021800         10  FILLER               PIC X(011)  VALUE 'CURRENT    '.
021900         10  FILLER               PIC X(003)  VALUE SPACES.
022000         10  DIFER-DES            PIC X(011)  VALUE 'DIFFERENCE '.
022100         10  FILLER               PIC X(003)  VALUE SPACES.
022200         10  FILLER               PIC X(011)  VALUE 'STATUS     '.
022300     05  SOFT-SUB2.
022400         10  FILLER               PIC X(001)  VALUE SPACES.
022500         10  FILLER               PIC X(011)  VALUE ALL '='.
022600         10  FILLER               PIC X(001)  VALUE SPACES.
022700         10  FILLER               PIC X(011)  VALUE ALL '='.
022800         10  FILLER               PIC X(001)  VALUE SPACES.
022900         10  FILLER               PIC X(011)  VALUE ALL '='.
023000         10  FILLER               PIC X(001)  VALUE SPACES.
023100         10  FILLER               PIC X(042)  VALUE ALL '='.
023200         10  FILLER               PIC X(001)  VALUE SPACES.
023300         10  FILLER               PIC X(011)  VALUE ALL '='.
023400         10  FILLER               PIC X(003)  VALUE SPACES.
023500         10  FILLER               PIC X(011)  VALUE ALL '='.
023600         10  FILLER               PIC X(003)  VALUE SPACES.
023700         10  FILLER               PIC X(011)  VALUE ALL '='.
023800         10  FILLER               PIC X(003)  VALUE SPACES.
023900         10  FILLER               PIC X(011)  VALUE ALL '='.
024000     05  SOFT-DETAIL.
024100         10  FILLER               PIC X(002)  VALUE SPACES.
024200         10  VEND-OUT1            PIC X(010)  VALUE SPACES.
024300         10  FILLER               PIC X(002)  VALUE SPACES.
024400         10  FMID-OUT1            PIC X(010)  VALUE SPACES.
024500         10  FILLER               PIC X(002)  VALUE SPACES.
024600         10  VERS-OUT1            PIC X(010)  VALUE SPACES.
024700         10  FILLER               PIC X(002)  VALUE SPACES.
024800         10  DESC-OUT1            PIC X(040)  VALUE SPACES.
024900         10  FILLER               PIC X(002)  VALUE SPACES.
025000         10  BUDG-OUT1            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
025100         10  FILLER               PIC X(005)  VALUE SPACES.
025200         10  COST-OUT1            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
025300         10  FILLER               PIC X(005)  VALUE SPACES.
025400         10  DIFF-OUT1            PIC $Z,ZZZ,ZZ9- VALUE ZERO.
025500         10  FILLER               PIC X(003)  VALUE SPACES.
025600         10  STAT-OUT1            PIC X(010)  VALUE SPACES.
025700     SKIP2
025800     05  SOFT-TOTAL.
025900         10  FILLER               PIC X(001)  VALUE '0'.
026000         10  FILLER               PIC X(011)  VALUE 'TOTAL '.
026100         10  FILLER               PIC X(068)  VALUE ALL '='.
026200         10  BUDG-TOTAL           PIC $Z,ZZZ,ZZ9 VALUE ZERO.
026300         10  FILLER               PIC X(005)  VALUE SPACES.
026400         10  COST-TOTAL           PIC $Z,ZZZ,ZZ9 VALUE ZERO.
026500         10  FILLER               PIC X(005)  VALUE SPACES.
026600         10  DIFF-TOTAL           PIC $Z,ZZZ,ZZ9- VALUE ZERO.
026700     05  GRAND-TOTAL.
026800         10  FILLER               PIC X(001)  VALUE '0'.
026900         10  FILLER            PIC X(011)  VALUE 'GRAND TOTAL'.
027000         10  FILLER               PIC X(068)  VALUE ALL '='.
027100         10  BUDG-GTOT            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
027200         10  FILLER               PIC X(005)  VALUE SPACES.
027300         10  COST-GTOT            PIC $Z,ZZZ,ZZ9 VALUE ZERO.
027400         10  FILLER               PIC X(005)  VALUE SPACES.
027500         10  DIFF-GTOT            PIC $Z,ZZZ,ZZ9- VALUE ZERO.
027600     05  TAX-TOTAL.
027700         10  FILLER               PIC X(001)  VALUE '0'.
027800         10  FILLER               PIC X(011)  VALUE 'TAX  '.
027900         10  FILLER               PIC X(068)  VALUE ALL '*'.
028000         10  BUDG-TAX             PIC $Z,ZZZ,ZZ9 VALUE ZERO.
028100         10  FILLER               PIC X(005)  VALUE SPACES.
028200         10  COST-TAX             PIC $Z,ZZZ,ZZ9 VALUE ZERO.
028300         10  FILLER               PIC X(005)  VALUE SPACES.
028400         10  DIFF-TAX             PIC $Z,ZZZ,ZZ9- VALUE ZERO.
028500     SKIP2
028600 01  TDT-PROCESS-DATE.
028700     05  DATE-OF-RUN-YY           PIC 99.
028800     05  DATE-OF-RUN-MM           PIC 99.
028900     05  DATE-OF-RUN-DD           PIC 99.
029000 01  TDT-PROCESS-TIME.
029100     05  TIME-OF-RUN-HH           PIC 99.
029200     05  TIME-OF-RUN-MM           PIC 99.
029300     05  TIME-OF-RUN-SS           PIC 99.
029400     05  TIME-OF-RUN-TT           PIC 99.
029500 01  TDT-DATE-OF-RUN.
029600     05  DATE-OF-RUN-MM           PIC 99.
029700     05  FILLER                   PIC X(001) VALUE '/'.
029800     05  DATE-OF-RUN-DD           PIC 99.
029900     05  FILLER                   PIC X(001) VALUE '/'.
030000     05  DATE-OF-RUN-YY           PIC 99.
030100 01  TDT-TIME-OF-RUN.
030200     05  TIME-OF-RUN-HH           PIC 99.
030300     05  FILLER                   PIC X(001) VALUE ':'.
030400     05  TIME-OF-RUN-MM           PIC 99.
030500     05  FILLER                   PIC X(001) VALUE ':'.
030600     05  TIME-OF-RUN-SS           PIC 99.
030700 01  MAC-A-REC.
030800         10  CONTROL-FIELD        PIC X(001).
030900         10  TBL-KEY.
031000             15  VEND-OUT         PIC X(010).
031100             15  FMID-OUT         PIC X(010).
031200         10  IDTE-OUT             PIC X(008).
031300         10  VERS-OUT             PIC X(010).
031400         10  SERI-OUT             PIC X(010).
031500         10  DESC-OUT             PIC X(040).
031600         10  STAT-OUT             PIC X(010).
031700         10  CONT-OUT             PIC X(015).
031800         10  BUDG-OUT             PIC X(007).
031900         10  COST-OUT             PIC X(007).
032000         10  PCST-OUT             PIC X(007).
032010         10  VPHN-OUT             PIC X(014).
032020         10  HPHN-OUT             PIC X(014).
032030         10  WPHN-OUT             PIC X(004).
032100     EJECT
032200 PROCEDURE DIVISION.
032300     SKIP2
032400 1010-MAINLINE.
032500     SKIP1
032600     PERFORM 2010-HOUSEKEEPING
032700        THRU 2010-EXIT.
032800     CALL 'ISPLINK' USING TBOPEN SOFT.
032900     MOVE 10 TO LENG.
033000     CALL 'ISPLINK' USING VDEFINE VEND1V VEND1 CHAR LENG.
033100     MOVE 10 TO LENG.
033200     CALL 'ISPLINK' USING VDEFINE VENDV VEND CHAR LENG.
033300     MOVE 10 TO LENG.
033400     CALL 'ISPLINK' USING VDEFINE FMID1V FMID1 CHAR LENG.
033500     MOVE 10 TO LENG.
033600     CALL 'ISPLINK' USING VDEFINE FMIDV FMID CHAR LENG.
033700     MOVE 08 TO LENG.
033800     CALL 'ISPLINK' USING VDEFINE IDTEV IDTE CHAR LENG.
033900     MOVE 10 TO LENG.
034000     CALL 'ISPLINK' USING VDEFINE VERSV VERS CHAR LENG.
034100     MOVE 10 TO LENG.
034200     CALL 'ISPLINK' USING VDEFINE SERIV SERI CHAR LENG.
034300     MOVE 40 TO LENG.
034400     CALL 'ISPLINK' USING VDEFINE DESCV DESC CHAR LENG.
034500     MOVE 10 TO LENG.
034600     CALL 'ISPLINK' USING VDEFINE STATV STAT CHAR LENG.
034700     MOVE 15 TO LENG.
034800     CALL 'ISPLINK' USING VDEFINE CONTV CONT CHAR LENG.
034900     MOVE 07 TO LENG.
035000     CALL 'ISPLINK' USING VDEFINE BUDGV BUDG CHAR LENG.
035100     MOVE 07 TO LENG.
035200     CALL 'ISPLINK' USING VDEFINE COSTV COST CHAR LENG.
035300     MOVE 07 TO LENG.
035400     CALL 'ISPLINK' USING VDEFINE PCSTV PCST CHAR LENG.
035410     MOVE 14 TO LENG.
035420     CALL 'ISPLINK' USING VDEFINE VPHNV VPHN CHAR LENG.
035430     MOVE 14 TO LENG.
035440     CALL 'ISPLINK' USING VDEFINE HPHNV HPHN CHAR LENG.
035450     MOVE 04 TO LENG.
035460     CALL 'ISPLINK' USING VDEFINE WPHNV WPHN CHAR LENG.
035500     SKIP1
035600     OPEN OUTPUT SOFT-RECS.
035610     MOVE HEADING-DETAIL1 TO HEADING-DETAIL.
035700     MOVE CON-FALSE TO SWT-END-OF-DATA.
035800     PERFORM 2011-READ-RECORD
035900        UNTIL END-OF-DATA.
036200     CLOSE SOFT-RECS.
036300     PERFORM 2012-SORT.
036500     MOVE CON-FALSE TO SWT-END-OF-INPUT.
036600     MOVE CON-FALSE TO SWT-END-OF-DATA.
036700     OPEN INPUT SOFT-RECS.
037000     CALL 'ISPLINK' USING TBCLOSE SOFT.
037100     CLOSE SOFT-RECS.
037200     MOVE CON-FALSE TO SWT-END-OF-INPUT.
037300     OPEN INPUT SOFT-RECS.
037400     PERFORM 3010-READ-RECORD
037500        UNTIL END-OF-INPUT.
037600     SKIP1
037700     CLOSE SOFT-RECS.
037800     OPEN INPUT SOFT-RECS.
037900     MOVE CON-FALSE TO SWT-END-OF-INPUT.
038000     ON 1 ADD 70 TO REPORT-LINE-COUNT.
038100     MOVE ZERO TO PAGE-COUNT.
038300     MOVE ZERO TO BUDG-WRK.
038400     MOVE ZERO TO BUDG-TOT.
038500     MOVE ZERO TO COST-WRK.
038600     MOVE ZERO TO COST-TOT.
038700     MOVE ZERO TO DIFF-TOT.
038800     MOVE ZERO TO DIFF-WRK.
038900     PERFORM 3013-READ-RECORD
039000        UNTIL END-OF-INPUT.
039100     SKIP1
039200     CLOSE SOFT-RECS.
039300     PERFORM 2015-SORT.
039400     MOVE CON-FALSE TO SWT-END-OF-INPUT.
039500     ON 1 ADD 70 TO REPORT-LINE-COUNT.
039600     MOVE ZERO TO PAGE-COUNT.
039700     OPEN INPUT SOFT-RECS.
039800     MOVE ZERO TO BUDG-WRK.
039900     MOVE ZERO TO BUDG-TOT.
040000     MOVE ZERO TO COST-WRK.
040100     MOVE ZERO TO COST-TOT.
040200     MOVE ZERO TO DIFF-TOT.
040300     MOVE ZERO TO DIFF-WRK.
040400     PERFORM 301X-READ-RECORD
040500        UNTIL END-OF-INPUT.
040600     SKIP1
040700     PERFORM 4010-CLOSE-ALL-FILES
040800        THRU 4010-EXIT.
040900     GOBACK.
041000     SKIP2
041100 1010-EXIT.
041200     EJECT
041300 2010-HOUSEKEEPING.
041400     SKIP2
041500     ACCEPT TDT-PROCESS-DATE FROM DATE.
041600     ACCEPT TDT-PROCESS-TIME FROM TIME.
041700     MOVE CORRESPONDING TDT-PROCESS-DATE TO TDT-DATE-OF-RUN.
041800     MOVE CORRESPONDING TDT-PROCESS-TIME TO TDT-TIME-OF-RUN.
041900     MOVE TDT-DATE-OF-RUN TO HEAD-DATE.
042000     MOVE TDT-TIME-OF-RUN TO HEAD-TIME.
042100     MOVE SPACES TO SH-DETAIL.
042200     OPEN OUTPUT REPT-OUTPUT.
042300     SKIP2
042400 2010-EXIT.
042500     EJECT
042600 2011-READ-RECORD.
042700     MOVE ZERO TO RETURN-CODE.
042800     CALL 'ISPLINK' USING TBSKIP SOFT.
042900     IF RETURN-CODE GREATER THAN 0 THEN
043000      MOVE CON-TRUE TO SWT-END-OF-DATA.
043100     IF NOT END-OF-DATA
043200      THEN
043300       MOVE VEND   TO VEND-OUT
043400       MOVE FMID   TO FMID-OUT
043500       MOVE IDTE   TO IDTE-OUT
043600       MOVE VERS   TO VERS-OUT
043700       MOVE SERI   TO SERI-OUT
043800       MOVE DESC   TO DESC-OUT
043900       MOVE STAT   TO STAT-OUT
044000       MOVE CONT   TO CONT-OUT
044100       MOVE BUDG   TO BUDG-OUT
044200       MOVE COST   TO COST-OUT
044300       MOVE PCST   TO PCST-OUT
044310       MOVE VPHN   TO VPHN-OUT
044320       MOVE HPHN   TO HPHN-OUT
044330       MOVE WPHN   TO WPHN-OUT.
044400     IF NOT END-OF-DATA
044500       THEN
044600       IF VEND NOT EQUAL 'IBM       '
044700         THEN
044800          MOVE CON-NON-IBM TO CONTROL-FIELD.
044900     IF NOT END-OF-DATA
045000       THEN
045100       IF VEND EQUAL 'IBM       '
045200         THEN
045300          MOVE CON-IBM TO CONTROL-FIELD.
045400     IF NOT END-OF-DATA
045500       PERFORM 2013-WRITE-REC THRU 2013-EXIT.
045600 2012-SORT.
045700     SKIP2
045800     SORT SORT-FILE ON ASCENDING KEY SORT-KEY1
045900      USING SOFT-RECS GIVING SOFT-RECS.
046000 2012-EXIT.
046100     EJECT
046200 2013-WRITE-REC.
046300     SKIP2
046400     WRITE SOFT-RECORD FROM MAC-A-REC.
046500 2013-EXIT.
046600     EJECT
046700 2014-RECREATE.
046800     READ SOFT-RECS INTO MAC-A-REC
046900        AT END
047000          MOVE CON-TRUE TO SWT-END-OF-DATA.
047100     IF NOT END-OF-DATA
047200     THEN
047300       MOVE VEND-OUT   TO VEND1
047400       MOVE FMID-OUT   TO FMID1
047500       MOVE VEND-OUT   TO VEND
047600       MOVE FMID-OUT   TO FMID
047700       MOVE IDTE-OUT   TO IDTE
047800       MOVE VERS-OUT   TO VERS
047900       MOVE SERI-OUT   TO SERI
048000       MOVE DESC-OUT   TO DESC
048100       MOVE STAT-OUT   TO STAT
048200       MOVE CONT-OUT   TO CONT
048300       MOVE BUDG-OUT   TO BUDG
048500       MOVE COST-OUT   TO COST
048600       MOVE PCST-OUT   TO PCST
048610       MOVE VPHN-OUT   TO VPHN
048620       MOVE HPHN-OUT   TO HPHN
048630       MOVE WPHN-OUT   TO WPHN.
048700     IF NOT END-OF-DATA
048800     THEN
048900       IF TBL-KEY NOT EQUAL TBL-KEY-WORK
049000         THEN
049100          MOVE TBL-KEY TO TBL-KEY-WORK
049200          MOVE ZERO TO RETURN-CODE
049300          CALL 'ISPLINK' USING TBADD SOFT.
049400 2014-EXIT.
049500     EXIT.
049600 2015-SORT.
049700     SKIP2
049800     SORT SORT-FILE ON ASCENDING KEY SORT-KEY2
049900      USING SOFT-RECS GIVING SOFT-RECS.
050000 2015-EXIT.
050100     EXIT.
050200 3010-READ-RECORD.
050300     SKIP2
050400     READ SOFT-RECS INTO MAC-A-REC
050500        AT END
050600           MOVE CON-TRUE TO SWT-END-OF-INPUT.
050610     MOVE DIF-DES TO DIFER-DES.
050620     MOVE HEADING-DETAIL1 TO HEADING-DETAIL.
050700     IF NOT END-OF-INPUT
050800        THEN
050830             IF CONT-OUT NOT EQUAL 'UNSUPPORTED    '
050840                THEN
050850             IF STAT-OUT NOT EQUAL 'CANCEL    '
050860                THEN
050900        PERFORM 3011-PRINT-THE-REPORT
051000           THRU 3011-EXIT.
051100     IF END-OF-INPUT
051200        THEN
051300        COMPUTE BUDG-WRK = (BUDG-TOT * TAX)
051400        COMPUTE COST-WRK = (COST-TOT * TAX)
051500        COMPUTE DIFF-WRK = (COST-WRK - BUDG-WRK)
051600        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
051700        MOVE BUDG-TOT TO BUDG-TOTAL
051800        MOVE COST-TOT TO COST-TOTAL
051900        MOVE DIFF-TOT TO DIFF-TOTAL
052000        MOVE SOFT-TOTAL TO DETAIL-LINE
052100        WRITE REPORT-RECORD FROM DETAIL-LINE
052200        MOVE BUDG-WRK TO BUDG-TAX
052300        MOVE COST-WRK TO COST-TAX
052400        MOVE DIFF-WRK TO DIFF-TAX
052500        MOVE TAX-TOTAL TO DETAIL-LINE
052600        WRITE REPORT-RECORD FROM DETAIL-LINE
052700        COMPUTE BUDG-TOT = (BUDG-TOT + BUDG-WRK)
052800        COMPUTE COST-TOT = (COST-TOT + COST-WRK)
052900        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
053000        MOVE BUDG-TOT TO BUDG-GTOT
053100        MOVE COST-TOT TO COST-GTOT
053200        MOVE DIFF-TOT TO DIFF-GTOT
053300        MOVE GRAND-TOTAL TO DETAIL-LINE
053400        WRITE REPORT-RECORD FROM DETAIL-LINE.
053500     SKIP2
053501 3010-EXIT.
053502     EJECT
053510 301X-READ-RECORD.
053520     SKIP2
053530     READ SOFT-RECS INTO MAC-A-REC
053540        AT END
053550           MOVE CON-TRUE TO SWT-END-OF-INPUT.
053551     MOVE DIF-DES TO DIFER-DES.
053552     MOVE HEADING-DETAIL3 TO HEADING-DETAIL.
053560     IF NOT END-OF-INPUT
053570        THEN
053591             IF CONT-OUT EQUAL 'UNSUPPORTED    '
053592                THEN
053593        PERFORM 3011-PRINT-THE-REPORT
053594           THRU 3011-EXIT.
053595     IF END-OF-INPUT
053596        THEN
053597        COMPUTE BUDG-WRK = (BUDG-TOT * TAX)
053598        COMPUTE COST-WRK = (COST-TOT * TAX)
053599        COMPUTE DIFF-WRK = (COST-WRK - BUDG-WRK)
053600        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
053601        MOVE BUDG-TOT TO BUDG-TOTAL
053602        MOVE COST-TOT TO COST-TOTAL
053603        MOVE DIFF-TOT TO DIFF-TOTAL
053604        MOVE SOFT-TOTAL TO DETAIL-LINE
053605        WRITE REPORT-RECORD FROM DETAIL-LINE
053606        MOVE BUDG-WRK TO BUDG-TAX
053607        MOVE COST-WRK TO COST-TAX
053608        MOVE DIFF-WRK TO DIFF-TAX
053609        MOVE TAX-TOTAL TO DETAIL-LINE
053610        WRITE REPORT-RECORD FROM DETAIL-LINE
053611        COMPUTE BUDG-TOT = (BUDG-TOT + BUDG-WRK)
053612        COMPUTE COST-TOT = (COST-TOT + COST-WRK)
053613        COMPUTE DIFF-TOT = (COST-TOT - BUDG-TOT)
053614        MOVE BUDG-TOT TO BUDG-GTOT
053615        MOVE COST-TOT TO COST-GTOT
053616        MOVE DIFF-TOT TO DIFF-GTOT
053617        MOVE GRAND-TOTAL TO DETAIL-LINE
053618        WRITE REPORT-RECORD FROM DETAIL-LINE.
053619     SKIP2
053710 301X-EXIT.
053720     EJECT
053800 3011-PRINT-THE-REPORT.
053900     SKIP2
054000     MOVE VEND-OUT TO VEND-OUT1.
054100     MOVE FMID-OUT TO FMID-OUT1.
054200     MOVE BUDG-OUT TO BUDG-OUT1.
054300     MOVE BUDG-OUT TO BUDG-WRK.
054400     MOVE COST-OUT TO COST-WRK.
054500     COMPUTE BUDG-TOT = (BUDG-TOT + BUDG-WRK).
054600     COMPUTE COST-TOT = (COST-TOT + COST-WRK).
054700     COMPUTE DIFF-WRK = (COST-WRK - BUDG-WRK).
054800     MOVE VERS-OUT TO VERS-OUT1.
054900     MOVE DESC-OUT TO DESC-OUT1.
055000     MOVE COST-OUT TO COST-OUT1.
055100     MOVE STAT-OUT TO STAT-OUT1.
055200     MOVE DIFF-WRK TO DIFF-OUT1.
055400     MOVE SOFT-SUB TO SH-DETAIL.
055500     MOVE SOFT-DETAIL TO DETAIL-LINE.
055600     ON 1 ADD 70 TO REPORT-LINE-COUNT.
055700     ADD 1 TO REPORT-LINE-COUNT.
055800     IF REPORT-LINE-COUNT GREATER THAN PAGE-LIMIT
055900        THEN
056000        MOVE ZERO TO REPORT-LINE-COUNT
056100        PERFORM 3012-SOFT-HEADER THRU 3012-EXIT.
056200     WRITE REPORT-RECORD FROM DETAIL-LINE.
056300     MOVE SPACES TO DETAIL-LINE.
056400 3011-EXIT.
056500     EJECT
056600 3012-SOFT-HEADER.
056700     SKIP2
056800     ADD 1 TO PAGE-COUNT.
056900     MOVE PAGE-COUNT TO OUT-PAGE.
057100     WRITE REPORT-RECORD FROM SOFT-HEADING.
057200     WRITE REPORT-RECORD FROM SUB-HEADING-LINE.
057300     MOVE SOFT-SUB2 TO SH-DETAIL.
057400     WRITE REPORT-RECORD FROM SUB-HEADING-LINE.
057500 3012-EXIT.
057600     EJECT
057700 3013-READ-RECORD.
057800     SKIP2
057900     READ SOFT-RECS INTO MAC-A-REC
058000        AT END
058100           MOVE CON-TRUE TO SWT-END-OF-INPUT.
058200     IF NOT END-OF-INPUT
058300        THEN
058400         IF PCST-OUT NOT EQUAL '0000000'
058500        THEN
058600        PERFORM 3014-PRINT-THE-REPORT
058700           THRU 3014-EXIT.
058800     IF END-OF-INPUT
058900        THEN
059200        COMPUTE DIFF-WRK = (DIFF-WRK * TAX)
059300        MOVE BUDG-TOT TO BUDG-TOTAL
059400        MOVE BUDG-TOT TO COST-TOTAL
059500        MOVE DIFF-TOT TO DIFF-TOTAL
059600        MOVE SOFT-TOTAL TO DETAIL-LINE
059700        WRITE REPORT-RECORD FROM DETAIL-LINE
059800        MOVE BUDG-TOT TO BUDG-TAX
059900        MOVE BUDG-TOT TO COST-TAX
060000        MOVE DIFF-WRK TO DIFF-TAX
060100        MOVE TAX-TOTAL TO DETAIL-LINE
060200        WRITE REPORT-RECORD FROM DETAIL-LINE
060300        COMPUTE BUDG-TOT = (0)
060400        COMPUTE COST-TOT = (0)
060500        COMPUTE DIFF-TOT = (DIFF-TOT + DIFF-WRK)
060600        MOVE BUDG-TOT TO BUDG-GTOT
060700        MOVE BUDG-TOT TO COST-GTOT
060800        MOVE DIFF-TOT TO DIFF-GTOT
060900        MOVE GRAND-TOTAL TO DETAIL-LINE
061000        WRITE REPORT-RECORD FROM DETAIL-LINE.
061100     SKIP2
061200 3013-EXIT.
061300     EJECT
061400 3014-PRINT-THE-REPORT.
061500     SKIP2
061600     MOVE VEND-OUT TO VEND-OUT1.
061700     MOVE FMID-OUT TO FMID-OUT1.
061900     MOVE BUDG-OUT TO BUDG-WRK.
062000     MOVE COST-OUT TO COST-WRK.
062100     MOVE PCST-OUT TO DIFF-WRK.
062200     COMPUTE BUDG-TOT = (0)
062300     COMPUTE COST-TOT = (0)
062400     COMPUTE DIFF-TOT = (DIFF-TOT + DIFF-WRK).
062500     MOVE VERS-OUT TO VERS-OUT1.
062600     MOVE DESC-OUT TO DESC-OUT1.
062700     MOVE BUDG-TOT TO COST-OUT1.
062710     MOVE BUDG-TOT TO BUDG-OUT1.
062800     MOVE STAT-OUT TO STAT-OUT1.
062900     MOVE DIFF-WRK TO DIFF-OUT1.
063000     MOVE PSR-DES TO DIFER-DES.
063100     MOVE SOFT-SUB TO SH-DETAIL.
063200     MOVE SOFT-DETAIL TO DETAIL-LINE.
063300     ON 1 ADD 70 TO REPORT-LINE-COUNT.
063400     ADD 1 TO REPORT-LINE-COUNT.
063500     IF REPORT-LINE-COUNT GREATER THAN PAGE-LIMIT
063600        THEN
063700        MOVE ZERO TO REPORT-LINE-COUNT
063800        PERFORM 3015-SOFT-HEADER THRU 3015-EXIT.
063900     WRITE REPORT-RECORD FROM DETAIL-LINE.
064000     MOVE SPACES TO DETAIL-LINE.
064100 3014-EXIT.
064200     EJECT
064300 3015-SOFT-HEADER.
064400     SKIP2
064500     ADD 1 TO PAGE-COUNT.
064600     MOVE PAGE-COUNT TO OUT-PAGE.
064700     MOVE HEADING-DETAIL2 TO HEADING-DETAIL.
064800     WRITE REPORT-RECORD FROM SOFT-HEADING.
064900     WRITE REPORT-RECORD FROM SUB-HEADING-LINE.
065000     MOVE SOFT-SUB2 TO SH-DETAIL.
065100     WRITE REPORT-RECORD FROM SUB-HEADING-LINE.
065200 3015-EXIT.
065300     EJECT
065400 4010-CLOSE-ALL-FILES.
065500     SKIP2
065600     CLOSE SOFT-RECS
065700           REPT-OUTPUT.
065800     SKIP2
065900 4010-EXIT.
066000     EJECT

1
-
-            CATPTPCH - A CATALOG PRINT AND/OR PUNCH PROGRAM
+            _______________________________________________
-THIS PROGRAM IS USED TO PRINT AND/OR PUNCH ENTRIES IN O/S CATALOG DATA
0THE LISTING SHOWS ALL INDEXES, CATALOGED DATA SET ENTRIES, CONTROL VOLU
0POINTERS, AND ALIAS ENTRIES IN THE CATALOG, AND GIVES SOME INFORMATION
0SPACE UTILIZATION.  THE PUNCHED OUTPUT IS IN THE FORM OF CONTROL CARDS
0THE IEHPROGM UTILITY.
-
-
-                            ACKNOWLEDGEMENT
+                            ________________
-THE PROGRAM DESCRIBED IN THIS DOCUMENT WAS DERIVED FROM A TYPE III PROG
0DISTRIBUTED BY IBM UNDER THE PROGRAM NUMBER 360D-00.1.020. KENT W. CHRI
0IS THE AUTHOR OF THAT PROGRAM AND ITS DOCUMENTATION.  MUCH OF THE PROGR
0AND THIS DOCUMENT REMAIN ESSENTIALLY IDENTICAL TO MR. CHRISTIANSEN'S OR
0AND THIS AUTHOR IS INDEBTED TO HIM.
-
-
-COMMENTS, QUESTIONS AND CORRECTIONS CONCERNING THIS PROGRAM WOULD BE
0APPRECIATED IF ADDRESSED TO:
-
-                            DARRELL D. WILCOX
                             KING COUNTY SYSTEMS SERVICES
                             ROOM E-208 KING COUNTY COURTHOUSE
                             THIRD AT JAMES STREETS
                             SEATTLE, WASHINGTON   98104
1 A. PURPOSE
+    _______
-    THE PURPOSE OF THE PROGRAM IS TO PROVIDE A COMPLETE AND EFFICIENT M
0    MAINTAINING AN O/S CATALOG DATA SET.  THE PROGRAM PROVIDES TWO FUNC
0    ACCOMPLISH THIS GOAL; THEY MAY BE USED SEPARATELY OR JOINTLY.

-    THE FIRST FUNCTION IS TO PROVIDE A LISTING OF ALL ENTRIES IN A CATA
0    INCLUDING UNUSED INDEXES (THE UTILITY IEHLIST DOES NOT SHOW UNUSED
0    INDEXES).  THE NUMBER OF BLOCKS IN THE CATALOG BEING USED, AND THE
0    NUMBER STILL AVAILABLE ARE ALSO PRINTED.

-    THE SECOND FUNCTION IS TO PRODUCE CONTROL CARDS FOR THE UTILITY IEH
0    WHICH CAN BE USED TO RECREATE OR REORGANIZE THE CATALOG.  THE CONTR
0    CONTAIN A SEQUENCE NUMBER IN COLUMNS 73 - 80 AND THEY MUST BE SORTE
0    ASCENDING SEQUENCE PRIOR TO USING.

-    BY REMOVING THE CARDS FOR UNWANTED ENTRIES, FULL CONTROL OVER THE C
0    OF A CATALOG CAN BE RETAINED.
- B. ADVANTAGES
+    __________
-    THIS PROGRAM LISTS EVEN UNUSED INDEXES IN THE CATALOG, THUS ALLOWIN
0    TO BE REMOVED.  ALSO, ALL AVAILABLE CORE IS USED TO BUFFER CATALOG
0    BLOCKS, THUS REDUCING THE I/O ACTIVITY INVERSELY WITH THE AMOUNT OF
0    (ONLY ONE I/O IS REQUIRED FOR THE CATALOG IF ALL USED BLOCKS WILL F
0    CORE).
- C. ACCESS METHODS
+    ______________
-    QSAM IS USED FOR THE SYSIN AND SYSPRINT FILES.  EXCP IS USED TO REA
0    CATALOG DATA SET.
1 D. RESTRICTIONS
+    ____________
-    ONLY SIXTEEN O/S CATALOGS MAY HAVE CONTROL CARDS PUNCHED FOR THEM I
0    EXECUTION OF THE PROGRAM.  ANY NUMBER OF CATALOGS MAY BE LISTED.  T
0    MAXIMUM NUMBER OF BLOCKS THAT MAY BE SHOWN IN THE STATISTICS IS 9,9
0    (SEE "PROGRAM REQUIREMENTS" ALSO, IF YOU ARE RUNNING A VS SYSTEM).
- E. PROGRAM REQUIREMENTS
+    ____________________
-    BOTH THE MAIN PROGRAM AND THE CATALOG ACCESS SUBROUTINE HAVE A CORE
0    CLEARING OPERATION AFTER A GETMAIN.  THE CODE GENERATED IS DEPENDEN
0    WHETHER THE CPU IS A 360 OR A 370.  BOTH PROGRAMS ARE WRITTEN AS MA
0    AND HAVE THE KEYWORK PARAMETER SYSTEM= .  THE DEFAULT VALUE IS
0    'SYSTEM=360'.  ADDITIONALLY, THE CATALOG ACCESS PROGRAM HAS THE KEY
0    PARAMETER MAXCORE= .  THIS IS USED TO PUT AN UPPER LIMIT ON HOW MUC
0    WILL BE REQUESTED FROM O/S.  THE DEFAULT IS 'MAXCORE=16777208' (ALL
0    ADDRESSABLE CORE) AND THE MINIMUM IS 296.  FOR ANY CPU RUNNING VS,
0    VALUE MUST BE CHANGED TO BE THE MAXIMUM (OR LESS) AMOUNT OF CORE TO
0    PAGED IN FOR THIS PROGRAM AT ONE TIME.  A SINGLE CHANNEL PROGRAM IS
0    STRUCTED TO FILL CORE FROM THE CATALOG.  HENCE ALL THOSE PAGES MUST
0    REAL CORE WHEN THE I/O IS STARTED.  YOU HAVE BEEN WARNED.
-       CORE -4096 BYTES RESERVED FOR ABEND, EOV, ETC.
0             7200 BYTES - PROGRAM
0             QSAM ACCESS METHOD
0             BUFFERS - BUFNO TIMES (BLKSIZE+IOB)
0       DD CARDS -
0         SYSPRINT - FOR OUTPUT LISTING; SHOULD BE BLOCKED; PROGRAM WILL
0                    BLOCK SIZE DOWNWARD TO A MULTIPLE OF LRECL; THE DEF
0                    VALUE IS 'BLKSIZE = LRECL = '100'; USES ASA CARRIAG
0                    CONTROL CHARACTERS.
1       SYSIN - FOR CONTROL CARDS; SHOULD BE UNBLOCKED TO MINIMIZE CORE
0             REQUIRED EVEN IN LARGE REGIONS.
0       DDCARD - ANY NAME, USED TO ALLOCATE THE DEVICE WITH THE CATALOG
0             SET.
0       PCHFILE - REQUIRED ONLY IF PUNCHING IS REQUESTED; X IS A HEX DIG
0             STARTING WITH 0 UP TO F USED TO UNIQUELY DEFINE THE DD NAM
0             MULTIPLE PUNCH REQUESTS - THE FIRST PUNCH REQUEST GOES OUT
0             PCHFILE0, THE SECOND TO PCHFILE1, ETC.; SHOULD BE BLOCKED;
0             GRAM WILL ADJUST BLKSIZE DOWN TO A MULTIPLE OF LRECL; THE
0             VALUE IS 'BLKSIZE=LRECL=80'.
- F. TECHNICAL NARRATIVE OF PROGRAM LOGIC
+     ___________________________________
-    THE PROGRAM BEGINS BY OPENING SYSIN AND SYPRINT DATA SETS.  A TEST
0    ON WHETHER 12K OF CORE IS AVAILABLE.  IF AVAILABLE, 5376 BYTES ARE
0    HIGH LEVEL INDEX BLOCKS.  OTHERWISE, THE BLOCKS WILL BE READ AND RE
0    REQUIRED.  A CONTROL CARD IS READ AND ANALYZED, AND SWITCHES SET TO
0    THE FLOW THROUGH THE PROGRAM.  NEXT, THE VOLUME INDEX CONTROL ENTRY
0    IS READ AND STATISTICS COMPUTED (IF A LISTING IS REQUESTED).

-    THE PROGRAM THEN LOCATES THE FIRST HIGH LEVEL INDEX, DATA SET, ALIA
0    CONTROL VOLUME ENTRY.  IF IT IS NOT AN INDEX ENTRY, THE PROGRAM PRI
0    AND/OR PUNCHES THIS INFORMATION.  IF IT IS AN INDEX ENTRY, THE PROG
0    FOLLOWS THE CHAIN OF INDEX POINTERS, BUILDING A QUEUE OF THESE NAME
0    GOES, UNTIL THE END OF THE CHAIN OR A DATA SET ENTRY IS FOUND.  THE
0    QUALIFIED NAME IS BUILT FROM THE QUEUE AND IS PRINTED AND/OR PUNCHE

-    AFTER CHASING DOWN THE FIRST CHAIN, THE PROGRAM LOOKS FOR ANOTHER E
0    THE END OF THE CURRENT INDEX CHAIN TO PROCESS.  WHEN ALL ENTRIES AT
0    LOWEST LEVEL ARE PROCESSED, THE PROGRAM GOES UP ONE LEVEL AND ACROS
0    ING TO FIND ANOTHER INDEX ENTRY, AND SO ON.
1    WHEN ALL THE HIGHEST LEVEL ENTRIES HAVE BEEN PROCESSED, THE PROGRAM
0    FINISHED WITH THE CATALOG.  THE NEXT CONTROL CARD IS READ, ANALYZED
0    PERFORMED.

-    IF ERROR CONDITIONS CAUSE BRANCHING TO AN ERROR ROUTINE, A MESSAGE
0    WRITTEN TO SYSPRINT; OR IF SYSPRINT CAN NOT BE OPENED, TO A SYSTEM
0    MESSAGE BLOCK VIA WTO, ROUTCDE=(11).
- G. PROBABLE MODIFICATION AREAS
+    ___________________________
-    THE PROGRAM HAS A DEVICE-TYPE TO SYMBOLIC-NAME CONVERSION TABLE.  A
0    DEVICES ARE INTRODUCED, THIS TABLE SHOULD BE CHANGED SO THAT THE EI
0    DIGIT HEXIDECIMAL DEVICE CODE (E.G., 30C02001) CAN BE CONVERTED INT
0    SYMBOLIC NAME (E.G., 2314).  ENTRIES CAN BE ADDED, DELETED, OR CHAN
0    WITHOUT CHANGING THE PROGRAM LOGIC.  (PERFORMANCE NOTE: PLACE MOST
0    QUENTLY USED CODES FIRST IN THE TABLE).

-    TO PUNCH MORE THAN SIXTEEN CATALOGS, THE DDNAME IN THE PUNCHER DCB
0    MODIFIED, OR, PRODUCE ALL PUNCHOUT ON A SINGLE FILE, BUT USE A TWO
0    HIGH ORDER FIELD IN THE SEQUENCE NUMBER TO SEPARATE THE DECKS (E.G.
0    CATALOG SEQUENCE NUMBER FORMAT COULD BE X00XXXXX, THE SECOND COULD
0    X01XXXXX, WHERE THE X'S ARE UNDER PROGRAM CONTROL).  THE LEFTMOST (
0    ORDER) POSITION OF THE SEQUENCE NUMBER IS USED BY THIS PROGRAM TO P
0    CATALOG REBUILD CONTROL CARDS INTO THEIR PROPER ORDER.  FOR EXAMPLE
0    INDEX BUILDING MUST BE DONE BEFORE DATA SET CATALOGING.  FIVE DIGIT
0    SEQUENCING SHOULD BE SUFFICIENT FOR ABOUT 70,000 CATALOG ENTRIES.

-    IF THE CATALOG CONTAINS CONTROL VOLUME POINTERS BUILT PRIOR TO RELE
0    (I THINK) YOU WILL HAVE TO CHANGE THE DEFAULT CONTROL VOLUME SYMBOL
0    LOCATED AT DFLTCVDT IN THIS PROGRAM.
1 H. OPERATING INSTRUCTIONS
+    ______________________
-       CONTROL CARD
0             COLUMN
              1-5
0             PRINT - PRINT ONLY
0             PUNCH - PUNCH ONLY
0             PTPCH - PRINT AND PUNCH
0       THE CONTROL CARD FORMAT IS
0             COLUMNS
              1-5    7-12
0             PRINT   SERIAL
0       "SERIAL" IS THE 6 CHARACTER VOLUME SERIAL OF THE CATALOG VOLUME,
0       INCLUDING HIGH-ORDER ZEROS IF PRESENT.
-    TYPICAL JCL
-    //JOBNAME JOB ACCT, PROGRAMMER, ETC.
0    //STEPNAME EXEC PGM=CATPTPCH
0    //SYSUDUMP DD SYSOUT=A
0    //SYSPRINT DD SYSOUT=A,DCB=BLKSIZE=BLKSIZE
0    //PCHFILE0 DD SYSOUT=B,DCB=BLKSIZE=BLKSIZE
0    //DDNAME  DD UNIT=UNIT,DISP=OLD,VOL=SER=SERIAL
0    //SYSIN  DD *,DCB=BLKSIZE=80 'DCB=BLKSIZE=80' USED ONLY TO CONSERVE
0    PTPCH SERIAL
0    /*
0    NOTE:  FOR PRINTING ONLY, THE PCHFILE0 DD CARD IS NOT NEEDED
1 I. MESSAGES AND RETURN CODES
+    _________________________
-    1. "OPEN FAILED FOR 'SYSPRINT'
0       THIS MESSAGE WILL APPEAR ON THE SYSTEM MESSAGE DATASET (JCL) LIS
0       SELF EXPLANATORY.  NO FUNCTIONS ARE PERFORMED.
0       PROGRAM TERMINATES.  RETURN CODE IS 16.
-    2. "REQUEST CODE NOT RECOGNIZED - FOLLOWING NOT DONE - CONTROL CARD
0       REQUEST WAS NOT 'PRINT', 'PUNCH' OR 'PTPCH'.
0       FUNCTION IS NOT PERFORMED (OBVIOUSLY).  NEXT CONTROL CARD IS REA
0       RETURN CODE IS 8.
-    3. "ERROR IN READING INDEX BLOCK - INDEX CONTROL ENTRY FOUND AT TTR
0       AN INDEX CONTROL ENTRY WAS FOUND WHEN IT SHOULD NOT HAVE OCCURRE
0       TTR = TTR GIVES THE ADDRESS WHERE IT WAS FOUND.  THE CURRENT FUN
0       TERMINATED AND THE NEXT CONTROL CARD READ.  RETURN CODE IS 8.
-    4. "INVALID ENTRY TYPE FOUND AT TTR = TTR"
0       AN ENTRY WAS FOUND THAT WAS NOT RECOGNIZABLE.
0       THE FIELD CONTAINING THE NUMBER OF HALFWORDS FOLLOWING IS USED T
0       IDENTIFY AN ENTRY.
0       CATALOG MANAGEMENT MAY HAVE BEEN CHANGED.  THE CURRENT FUNCTION
0       TERMINATED AND THE NEXT CONTROL CARD READ.  RETURN CODE IS 8.
-    5. "NO DDCARD FOR CATALOG VOLUME - FOLLOWING NOT DONE - CONTROL CAR
0       A DD CARD WAS NOT INCLUDED FOR THE VOLUME THAT WAS TO BE USED.
0       FUNCTION IS NOT PERFORMED AND THE NEXT CONTROL CARD IS READ.  RE
0       CODE IS 8.
-    6. "NO INDEX CONTROL ENTRY FOUND AT TTR = TTR"
0       AN ENTRY OTHER THAN AN INDEX CONTROL ENTRY WAS FOUND WHEN IT SHO
0       HAVE OCCURED.  THE TTR = TTR GIVES THE ADDRESS OF THE BLOCK READ
0       CURRENT FUNCTION IS TERMINATED AND THE NEXT CONTROL CARD READ.
0       CODE IS 8.
1    7. "INVALID FLAGS IN GEN. INDEX FOUND AT TTR = TTR"
0       BITS OTHER THAN FOR THE EMPTY AND DELETE OPTIONS WERE ON IN THE
0       GENERATION INDEX ENTRY, LOCATED AT TTR = TTR.  THE CURRENT FUNCT
0       TERMINATED AND THE NEXT CONTROL CARD IS READ.  RETURN CODE IS 8.
-    8. "COULD NOT OPEN DDCARD 'DDNAME' - FOLLOWING NOT DONE - CONTROL C
0       IMAGE"  THE DD CARD NAMED 'DDNAME' DID NOT OPEN.  THE FUNCTION I
0       PERFORMED AND THE NEXT CONTROL CARD IS READ UNLESS THE 'DDNAME'
0       "SYSIN", IN WHICH CASE THE FUNCTION PRINTED IS MEANINGLESS AND T
0       GRAM WILL TERMINATE.  RETURN CODE IS 8.
-    9. "DEVICE TYPE NOT FOUND IN TABLE FOR DDCARD NAMED 'DDNAME' - FOLL
0       NOT DONE - CONTROL CARD IMAGE"
0       THE EIGHT DIGIT DEVICE TYPE FOR THE CATALOG VOLUME WAS NOT FOUND
0       DEVICE-TYPE TO SYMBOLIC-NAME CONVERSION TABLE.  HENCE THE SYMBOL
0       FOR THE CVOL PARAMETER, WHICH IS USED ON EVERY CARD, CANNOT BE D
0       MINED.  THE FUNCTION IS NOT PERFORMED, AND THE NEXT CONTROL CARD
0       READ.  RETURN CODE IS 8.
-   10. "TOO MANY PUNCH REQUESTS - FOLLOWING NOT DONE - CONTROL CARD IMA
0       MORE THAN SIXTEEN PUNCH REQUESTS WERE MADE DURING A SINGLE EXECU
0       THE FUNCTION IS NOT PERFORMED AND THE NEXT CONTROL CARD IS READ.
0       RETURN CODE IS 8.  NO FURTHER PUNCH REQUEST WILL BE PERFORMED.
-    11. "DEVICE TYPE NOT FOUND IN TABLE - SPACE PROVIDED IN CARD NUMBER
0       XXXXXXXX FOR 6 CHARACTER DEVICE NAME"
0       AN EIGHT DIGIT DEVICE CODE WAS NOT FOUND IN THE DEVICE-TYPE TO S
0       NAME TABLE.  ROOM WAS LEFT IN (OR NEAR) CARD WITH A SEQUENCE NUM
0       XXXXXXXX FOR A SYMBOLIC NAME TO BE INSERTED.  ACTION:  ENTER THE
0       BOLIC NAME IN THE CARD BEFORE SORTING.  EXECUTION CONTINUES.
0       RETURN CODE IS 8.

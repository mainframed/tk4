//VSAMLINK JOB (G437443,'A=H467,B=090,D=T24'),GREY
//*  LINK VSAMDIAG INTO SYS1.LINKLIB WITH AUTHORIZATION
//*********************************************************************
//*                                                                   *
//*                    VSAMDIAG                                       *
//*                                             VERSION    19 JUN 1978*
//*                                                        30 APR 1979*
//*                                                        22 NOV 1979*
//*                                FALSE ERROR CODE 24     25 MAR 1980*
//*********************************************************************
//*
//*  A - GENERALITIES
//*  B - INDEX TESTS
//*  C - DATA TESTS
//*  D - PROCEDURES
//*  E - MESSAGES AND CODES
//*  F - DATA AREAS
//*  G - PROGRAMS ORGNAIZATION
//*
//*
//*
//*              *****************************
//*              A      GENERALITIES         A
//*              *****************************
//*
//*  THIS PROGRAM IS IBM PROPERTY AND IS INTERNAL USE ONLY.
//*  VSAMDIAG IS NOT SUPPORTED, BUT ANY PROBLEM ENCOUNTERED WILL
//*  WILL BE LOOKED AT ON A BEST EFFORT BASIS. PLEASE SUBMIT THE
//*  PORTABLE FAILING DATA SET TO: VSAM CT.  ATTN. JERRY GREY.
//*  THE INSTALL DECK CONTAINS THE OBJECT DECK FOR VSAMDIAG AND
//*  THE NECESSARY LINKAGE EDITOR CONTROL CARDS TO LINK VSAMDIAG
//*  INTO SYS1.LINKLIB WITH AUTHORIZATION.
//*
//*  VSAMDIAG IS A FIELD DEVELOPED VSAM DATA SET DIAGNOSTIC
//*  PROGRAM. IT IS MAINLY DESIGNED TO EXAMINE SEPARATLY THE INDEX
//*  COMPONENT AND THE DATA COMPONENT OF A VSAM KSDS.
//*  EXAMINATION OF THE INDEX COMPONENT IS MAINLY DONE BY A
//*  CROSS-CHECKING OF THE VERTICAL AND HORIZONTAL POINTERS IN
//*  THE INDEX CI'S AND FURTHER CHECKING THE WHOLE DATA COMPONENT
//*  DESCRIBED BY THE INDEXES.
//*  EXAMINATION OF THE DATA COMPONENT IS DONE BY LOGICAL SEQUENTIAL
//*  READING OF ALL THE DATA CI'S ALLOCATED, EVEN FOR FREE SPACE CI'S.
//*  RECORD IS CHECKED, AS WELL AS KEY SEQUENCE AND FREE SPACE GOOD
//*  ERASURE. UPDATE INTEGRITY OF SPANNED RECORDS IS ALSO CHECKED.
//*  VSAMDIAG DOES NOT MODIFY ANYTHING IN THE DATA SET, BUT ONLY
//*  INDICATES IF THERE IS A DATA INTEGRITY PROBLEM, AND WHAT IS
//*  WRONG IN THAT CASE.
//*  VSAMDIAG CAN ALSO SEARCH THROUGH THE INDEXES TO RETRIEVE THE
//*  CI OF EACH LEVEL IN WHICH A KEY GIVEN AS AN ARGUMENT SHOULD BE.
//*  THIS IS ACCOMPLISHED BY HORIZONTAL SCANNING OF THE INDEX, AND
//*  IS COMPLIMENTARY OF OTHER USUAL GET DIRECT METHODS. YOU CAN
//*  ALSO RETRIEVE THE DATA CI THAT SHOULD CONTAINE THE GIVEN KEY.
//*
//*
//*                    ********************
//*                    B  INDEX TESTS     B
//*                    ********************
//*
//*  1-HIGH LEVEL INDEX NOT UNIQUE
//*  2-HORIZONTAL POINTER POINTING TO ITSELF
//*  3-INDEX LEVELS INTERMIXED
//*  4-MISSING CI IN HORIZONTAL CHAIN
//*  5-MISSING VERTICAL POINTER(S)
//*  6-LONG LOOP IN HORIZONTAL CHAIN
//*  7-DUPLICATE VERTICAL POINTER
//*  8-DUPLICATE BASE RBA IN SEQUENCE SET
//*  9-DUPLICATE KEYS IN THE INDEXES
//*  10-OUT-OF-SEQUENCE KEYS IN THE INDEXES
//*  11-SEOF INSIDE THE INDEX COMPONENT
//*  12-DATA CI NOT DESCRIBED BY INDEXES
//*  13-BAD HIGH LEVEL INDEX RBA
//*  14-BAD FIRST SEQUENCE SET INDEX RBA VALUE
//*  15-INCORRECT HIGH USED RBA IN DATA
//*  16-INCORRECT HIGH USED RBA IN INDEX
//*  17-INCONSISTENT EXTENT ALLOCATION
//*  18-LOSS OF A CI IN THE INDEX
//*  19-LOSS OF A CA IN THE DATA
//*  20-HORIZONTAL CHAIN BROKEN IN ANY INDEX LEVEL
//*  21-INCORRECT BASE RBA IN T THE SEQEUNCE SET
//*  22-TOO MANY POINTERS IN THE SEQUENCE SET
//*
//*     RUNNIG ON A MODEL 168 UP, THE INDEX TEST TAKES LESS
//*   TWO MINUTES ELAPSED TIME FOR A KSDS WITH ABOUT 50,000
//*   DATA CIS. (IE: ONE MILLION 200 BYTE RECORDS)
//*
//*                  **********************
//*                  C   DATA  TESTS      C
//*                  **********************
//*
//*  1-INCONSISTENT CIDF IN A FREE SPACE CI
//*  2-SEOF IN A FREE SPACE CI
//*  3-FREE SPACE CI NOT EMPTY
//*  4-SOME RDF ERRORS
//*  5-DATA CI OVERFLOW
//*  6-UPDATE FAILURE IN SEGMENTS OF A SPANNED RECORD
//*  7-INCOMPLETE SPANNED RECORD
//*  8-INCORRECT KEY SEQUENCE
//*  9-SEOF IN A DATA CI
//*  10-RECORD LONGER THAN MAXIMUM RECORD LENGTH
//*  11-MISSING ENDING SEOF
//*  12-SOME DATA IN A FREE SPACE CI
//*    AS THE DATA TESTS MUST READ ALL THE DATA CI'S, IT USES
//*  ASYNCHRONOUS PROCESSING TO OPTIMIZE ITS PERFORMANCE. YOU CAN
//*  SPECIFY, IN THE SYSIN DDCARD, THE NUMBER OF BUFFERS THAT YOU
//*  WISH IN ORDER TO OBTAIN THE BEST PASS TIME. THE DEFAULT VALUE
//*  OF THREE SHOULD BE GOOD IN MOST CASES. NOTE, TOO MANY BUFFERS
//*  MAY RESULT IN EXCESSIVE PAGINATION.
//*
//*
//*     TO ESTIMATE THE NECESSARY TIME TO RUN THE DATA TEST,
//*   GET THE HURBA(HIGH USED RBA) AND THE DATA CISIZE FROM
//*   THE CATALOG FOR THE DATA SET TO TEST:
//*
//*      ELAPSED TIME = (HURBA * 0.03) / CISIZE
//*      (IN SECONDS)
//*    FOR A FULL 3330, CISIZE = 1024, ABOUT ONE HOUR.
//*
//*                   *********************
//*                   D    PROCEDURES     D
//*                   *********************
//*
//*    JCL NEEDED
//*       (STEPCAT)... WHERE IS THE CLUSTER TO TEST DEFINED
//*       (STEPLIB)... WHERE IS VSAMDIAG
//*       (VSAMDS) ... DESCRIBE THE DATA SET TO TEST
//*       (SYSPRINT).. DIAGNOSTIC OUTPUT(IF ABSENT TO OPERATOR)
//*       (SNAP) ..... SNAP OF CI'S IN ERROR
//*                         -SNAP OF CI'S WHEN AN INPUT
//*                          KEY IS GIVEN
//*                         -SNAP OF LVLWA'S (IF SNAP OPTION)
//*       (SYSUDUMP).. TO GET DUMP IF DEBUG OPTION OF ABEND
//*       (SYSIN) .... TO GIVE PARAMETERS
//*
//*   OPTIONS FOR SYSIN:
//*                     SNAP....-WILL PROVIDE SNAP OF LVLWA'S
//*                     DEBUG...-DUMP AT INDEX TEST TERMINATION
//*                     INDXTEST-TO EXECUTE THE INDEX TESTS
//*                     DATATEST-TO EXECUTE THE DATA TESTS
//*                     NBUFF=NN-TO SPECIFY THE NUMBER OF BUFFERS
//*                              FOR DATA TEST.(01 TO 99)
//*                     KEY= DCX(...)
//*                          DCC(...) TO SEARCH A KEY (IF DATATEST)
//*                                   OR SNAP ALL INDEX LEVELS
//*                                   CROSSED(IF INDXTEST)
//*      IF SYSIN NOT SPECIFIED, THE DEFAULT TEST OPTIONS ARE:
//*               --NODEBUG  NOSNAP  NODATATEST INDXTEST  NBUFF=3
//*
//*    KEYWORDS ARE NOT POSITIONAL. THERE ARE NO RESTRICTION ON
//*  THE NUMBER OF SYSIN CARDS. FOR KEY = PARAMETER, FIELD DCX(...)
//*  DEFINES A HEX FIELD IN THE KEY AND MUST NOT EXCEED 14 DIGITS,
//*  WITH AN EVEN NUMBER OF DIGITS. FIELD DCC(...) DEFINES A
//*  CHARACTER FIELD IN THE KEY.
//*
//*    KEY FIELDS CAN BE CONCATINATED ON SEVERAL SYSIN CARDS. EACH
//*  CARD CONTAINING A PORTION OF THE KEY MUST BEGIN WITH KEY =.
//*  LENGTH OF THE KEY SEARCHED IS THE TOTAL LENGTH OF THE KEY
//*  FIELDS. MAXIMUM LENGTH IS 256.
//*
//*    EXAMPLE SYSIN CARD:
//*      //SYSIN DD *
//*        SNAP  INDXTEST KEY= DCX(03274C)
//*        KEY= DCC(ABCDEF)  DCC(GHI) DCX(FF0011)
//*        KEY= DCC(JKL   MN)       DEBUG
//*     OPTIONS IN EFFECT:
//*            SNAP   INDXTEST   DEBUG
//*
//*     THE KEY SEARCHED FOR IS:
//*        03274CC1C2C3C4C5C6C7C8C9FF0011D1D2D3404040D4D5
//*      WITH A KEY LENGTH OF 23.
//*
//*      NOTE: IF THE KEY USED AS THE ARGUMENT IS TO BE COMPARED
//*            WITH LONGER KEYS, IT IS REAR PADDED WITH FFFF.
//*
//*
//*                 *******************************
//*                 E    MESSAGES  AND CODES      E
//*                 *******************************
//*
//*  001 ... DS TESTED IS NOT A KSDS
//*      ATTEMPTED TO RUN VSAMDIAG ON A NON-KSDS FILE.
//*
//*  002 ... DS WAS NOT CLOSED - LEFT OPEN -
//*      VSAMDIAG FOUND THAT THE CLUSTER WAS NOT PROPERLY CLOSED.
//*      THE ONLY TEST DONE IS ON THE ARDB CHAIN, AND THE CLUSTER
//*      IS LEFT OPEN.
//*
//*  003 ... DS WAS NOT CLOSED - WAS IN CREATE MODE
//*      VSAMDIAG FOUND THAT THE CLUSTER WAS NOT PROPERLY CLOSED,
//*      AND WAS IN LOAD/CREATE MODE. IN THIS CASE VERIFY WILL ONLY
//*      SET THE HIGH USED RBA TO ZERO. THE CLUSTER MUST BE RECREATED.
//*
//*  004 ... DATA COMP CONTAINS NN% FREE CI REUSABLE
//*      THIS MESSAGE WILL APPEAR WHEN THERE IS NO SEVERE ERROR. IT
//*      GIVES THE PERCENTAGE OF FREE SPACE IN THE DATA COMPONENT.
//*
//*  005 ... ** INDEX INTEGRITY PROBLEM DETECTED **
//*      VSAMDIAG DETECTED AN ERROR IN THE INDEX COMPONENT. THERE
//*      COULD BE AN EXPOSURE TO LOSE DATA IF USING STANDARD
//*      RECOVERY PROCEDURES OR VERIFY. INDEXES MUST BE EXAMINED
//*      WITH THE HELP OF THE CONCURRENT MSG 00I, BEFORE USING THE
//*      CLUSTER. SAVE THE CLUSTER VIA IEHDASDR IF POSSIBLE.
//*
//*  006 ... ** NO ERROR DETECTED IN INDEXES **
//*      IT'S OK, BUT DON'T FORGET DATATEST .. IF YOU DOUBT
//*
//*  007 ... GETMAIN ERROR RC NNNN
//*      VSAMDIAG UNABLE TO OBTAIN STORAGE FOR LVLWAS. THE DATA SET
//*      IS PROBABLY TOO LARGE FOR THE REGION SPECIFIED. INCREASE
//*      REGION SIZE OR EXAMINE THE RETURN CODE NNNN(GETMAIN R15)
//*
//*  008 ... ** WARNING ** SAVE DS VIA IEHDASDR BEFORE ANY USE
//*      ...DO NOT RUN VERIFY
//*      PLEASE, DO IT.
//*
//*  009 ... ** SEVERE ERROR; NO FURTHER PROCESS DONE **
//*      VSAMDIAG ENCOUNTERED A SEVERE ERROR AND COULD NOT CONTINUE
//*      TESTING. ABEND CODE IS U002. LOOK FIRST IN MSG LOG FOR A
//*      POSSIBLE OPEN RETURN CODE FROM VSAM. IF NOT, THIS MESSAGE
//*      MUST BE PROCEDED BY MSG 00I.
//*
//*  010 ... ** NO ERROR DETECTED IN DATA **
//*      VSAMDIAG DID NOT DETECT ANY ERRORS IN THE DATA COMPONENT.
//*
//*  011 ... DATA COMP CONTAINS NNNNNNNN RECORDS
//*      ALL THESE RECORDS CONTAIN VALID AND IN-SEQUENCE KEYS.
//*
//*  012 ... DATA COMP CONTAINS NNNNNNNN DELETED CI(S)
//*      THE COUNT OF CI'S IN WHICH ALL RECORDS HAVE BEEN DELETED.
//*      THESE CI'S ARE NOT AVAILABLE AS FREE SPACE, AND WILL ONLY
//*      BE REUSED IF RECORDS INSERTED CONTAIN KEYS THAT ARE IN
//*      THE OLD RANGE OF KEYS FOR THAT CI.
//*
//*  013 ... ** DATA INTEGRITY PROBLEM DETECTED **
//*      VSAMDIAG DETECTED AN ERROR IN THE DATA COMPONENT.
//*      THERE IS AN EXPOSURE TO LOSE DATA IF USING STANDARD
//*      RECOVERY PROCEDURES. YOU SHOULD PRINT THE ENTIRE CA
//*      IN ERROR BEFORE MODIFYING THE DATA SET.
//*
//*  014 ... PROBABLE LOOP IN HORIZONTAL POINTERS
//*      ... RUN INDEX TEST
//*      VSAMDIAG IS PROTECTED AGAINST POSSIBLE HORIZONTAL POINTER
//*      LOOP IN THE SEQUENCE SET WHEN RUNNING DATATEST. YOU SHOULD
//*      RUN INDXTEST PRIOR TO DATATEST.
//*
//*  015 ... SEOF INSIDE SEQUENCE SET - RUN INDEX TEST
//*      WHILE RUNNING DATATEST, VSAMDIAG ENCOUNTERED AN UNEXPECTED
//*      SEOF IN THE SEQUENCE SET. INDXTEST SHOULD BE RUN PRIOR TO
//*      TO DATATEST. THE DIAGNOSTIC WILL BE MORE ACCURATE.
//*
//*  016 ... KEY SEACRH OK * SSRBA N/A * CIRBA N *
//*      THE KEY PASSED VIA SYSIN HAS BEEN FOUND. N IS THE RBA OF
//*      THE DATA CI CONTAINING THE RECORD. IF YOU GAVE A SNAP DD,
//*      THIS CI IS SNAPPED.
//*
//*  00D ... ERROR CODE NN * SSRBA N1 * CIRBA N2 *
//*      VSAMDIAG DETECTED AN ERROR IN DATA COMPONENT CHECKING.
//*      FIELD N1 IS THE RBA OF THE SEQUENCE SET INDEX CI, AND
//*      FIELD N2 IS THE RBA OF THE CURRENT DATA CI. SEE NN ERROR
//*      CODE IN THE TABLE BELOW.
//*
//*  100 ... ** REC MANAGEMENT ERROR - RPL FDBK = NNNNNN
//*      THERE WAS A BAD RETURN CODE ON A GETIX MACRO. IF YOU
//*      RAN WITH THE DEBUG OPTION YOU MAY FIND WHY YOU GOT THE
//*      NNNNNN RETURN CODE IN THE RPL.
//*
//*  00I ... ERROR CODE NN * CIN/I-RBA N1 LVL N2 * CIN/-RBA N3
//*      ... LVL N4 * RBA N5 * RBA N6
//*      VSAMDIAG DETECTED AN ERROR IN CROSS TESTING THE INDEXES.
//*      FIELDS N1,N2,N3,N4,N5,N6, VARIES UPON THE ERROR CODE AND
//*      ARE EXPLAINED IN THE TABLE BELOW.
//*
//*      ERROR CODE TABLE FOR MESSAGE 00I:
//*   X AFTER THE ERROR CODE INDICATES A SEVERE ERROR, AND VSAMDIAG
//*   TERMINATES TESTING.
//*
//*   N1,N3 ARE THE CI NUMBER AND RBA IN HEX.
//*   N2,N4 ARE THE INDEX LEVELS.
//*   N5,N6 ARE THE RBA IN HEX.
//* ________________________________________________________________
//* × 02- × HI USED RBA NOT ON CI BOUNDARY      × NONE             ×
//* ×     × DATA COMPONENT                      ×                  ×
//* × 03- × HI ALLOCATED RBA NOT ON CI BOUNDARY × NONE             ×
//* ×     × DATA COMPONENT                      ×                  ×
//* × 04- × HI USED RBA GREATER THAN HI ALLOC.  × NONE             ×
//* ×     × DATA COMPONENT                      ×                  ×
//* × 05- × HI USED RBA NOT ON CA BOUNDARY      × NONE             ×
//* ×     × DATA COMPONENT                      ×                  ×
//* × 06- × HI ALLOCATED RBA NOT ON CA BOUNDARY × NONE             ×
//* ×     × DATA COMPONENT                      ×                  ×
//* × 07- × HI USED RBA GREATER THAN HI ALLOC.  × NONE             ×
//* ×     × INDEX COMPONENT                     ×                  ×
//* × 08- × HI USED RBA NOT ON CI BOUNDARY      × NONE             ×
//* ×     × INDEX COMPONENT                     ×                  ×
//* × 09- × HI ALLOCATED RBA NOT ON CI BOUNDARY × NONE             ×
//* ×     × INDEX COMPONENT                     ×                  ×
//* × 10- × HI LEVEL INDEX NOT UNIQUE           × N1 IS HI LVL IX  ×
//* ×     ×                                     × N3 IS HHP FOUND  ×
//* × 11-X× INDEX LEVELS INTERMIXED             × N1 IS PREVIOUS CI×
//* ×     ×                                     × N3 IS NEXT CI    ×
//* × 12- × MISSING CI IN HORIZONTAL CHAIN OR   × N1 IS CI EXPECTED×
//* ×     × LOOP START AT CURRENT LVL(SEE 15).  ×                  ×
//* × 13-X× CI WITH HHP POINTING TO ITSELF.     × N1 IS CI IN ERROR×
//* ×     ×                                     ×                  ×
//* × 14- × CI ON HORIZONTAL CHAIN NOT POINTED  × N1 IS CURRENT CI ×
//* ×     × TO BY NEXT HIGHER LEVEL INDEX.      ×                  ×
//* × 15-X× LONG LOOP IN HORIZONTAL CHAIN.(YOU  × N1 LAST CI IN THE×
//* ×     × WILL GET N ERROR12 AND ONE ERROR(15)× LOOP             ×
//* × 16- × BAD KEY SEQUENCE INSIDE OR          × N1 CURRENT CI    ×
//* ×     × BETWEEN INDEXES.                    × N3 PREVIOUS CI   ×
//* × 17- × DUPLICATE KEYS INSIDE OR BETWEEN    × N1 CURRENT CI    ×
//* ×     × INDEXES.                            × N3 PREVIOUS CI   ×
//* × 18- × BAD IXP IN A SEQUENCE SET(IXP OR    × N1 SEQ SET CI    ×
//* ×     × FREE POINTER OUT OF CI/CA.          ×                  ×
//* × 19- × 1ST SEQ SET RBA IN AMDSB DOES NOT   × N5 RBA FOUND     ×
//* ×     × MATCH WITH ONE FOUND VIA IXP'S.     × N6 EXPECTED RBA  ×
//* × 20- × DUPLICATE IXP ON THIS LEVEL         × N2 IS THE LEVEL  ×
//* ×     × (ONLY FOR INDEX SET).               ×                  ×
//* × 21- × HORIZONTAL CHAIN IS TOO LONG.(TABLE × N1 IS FIRST OVER ×
//* ×     × OVERFLOW - INTERMEDIATE LVL).       × FLOWING CI       ×
//* × 22- × CI IS IN NO CHAIN.(NOT POINTED TO). × NONE             ×
//* ×     × (ALWAYS WITH ERRORS 12,14,21)       ×                  ×
//* × 23- × BASE RBA NOT ON CA BOUNDARY         × N1 CURRENT CI    ×
//* ×     ×                                     ×                  ×
//* × 24- × BAD INDEX HI USED.( HIGHEST RBA     × N5 RBA FOUND     ×
//* ×     × FOUND + CISZ NOT EQUAL TO HI USED)  × N6 HI USED RBA   ×
//* × 25- × TOO MANY IXP'S OR FREE POINTERS     × N1 CURRENT CI    ×
//* ×     × IN SEQ. SET(TABLE OVERFLOW).        ×                  ×
//* × 26- × BAD DATA HIGH USED( GREATEST BRBA   × N5 COMPUTED RBA  ×
//* ×     × FOUND + CA SIZE NOT EQUAL TO HI USED× N6 CATALOG RBA   ×
//* × 27-X× SEOF INSIDE INDEX.                  × N1 IS EOF CI     ×
//* ×     ×                                     ×                  ×
//* × 28- × DATA CA NOT POINTED TO BY SEQ SET.  × NONE             ×
//* ×     × (COUNT OF SEQ SET CIS * CA SIZE NOT ×                  ×
//* ×     × EQUAL TO DATA HIGH USED).           ×                  ×
//* × 29- × INDEX CI(S) NOT USED IN THE INDEX.  × NUMBER OF UNUSED ×
//* ×     × (COUNT OF CI'S READ * CISZ NOT      ×                  ×
//* ×     × EQUAL TO INDEX HIGH USED).          ×                  ×
//* × 30- × BASE RBA IN THE UNIQUE SEQUENCE SET × NONE             ×
//* ×     × IS INVALID.                         ×                  ×
//* × 31- × BAD LEVEL FOUND FOR HIGH LEVEL.     × N2 EXPECTED LEVEL×
//* ×     × (PROCESSING CONTINUES ASSUMES HLI OK× N4 LEVEL FOUND   ×
//* × 37- × DATA CI NOT DESCRIBED BY THE SEQ SET× N1 SEQ SET IN ERR×
//* ×     × (IXP OR FREE SPACE POINTER).        ×                  ×
//* × 66- × DUPLICATE BASE RBA IN SEQUENCE SET  × N1,N3 ARE THE    ×
//* ×     ×                                     × CI'S INVOLVED    ×
//* ________________________________________________________________
//*
//*
//*       ERROR CODE TABLE FOR MESSAGE 00D:
//*
//* _______________________________________________
//* × 40- × BAD CIDF IN A FREE SPACE CI.          ×
//* ×     ×                                       ×
//* × 41- × SEOF IN A FREE SPACE CI.              ×
//* ×     ×                                       ×
//* × 42- × FREE SPACE CI CONTAINS SOME DATA. THE ×
//* ×     × CIDF INDICATES AN EMPTY CI.           ×
//* × 43- × THERE IS SOME DATA IN REMAINING FREE  ×
//* ×     × SPACE OF A DATA CI                    ×
//* × 44- × LEFT RDF WITHOUT PRECEDING RIGTH RDF  ×
//* ×     ×                                       ×
//* × 45- × MISSING LEFT RDF WHEN PAIRED          ×
//* ×     ×                                       ×
//* × 46  × DISCREPENCY IN UPDATE NUMBERS OF SPND ×
//* ×     × RECORD SEQMENTS. PROBABLY ONE         ×
//* ×     × SEQMENT NOT WRITTEN.                  ×
//* × 47- × TRUNCATED SPANNED RECORD. THE SPANNED ×
//* ×     × RECORD IS INTERRUPTED BY A FREE CI OR ×
//* ×     × ANOTHER RECORD.                       ×
//* × 48- × SEOF IN DATA CI. THIS CI IS NOT A FREE×
//* ×     × SPACE CI.                             ×
//* × 49- × MISSING FIRST SEQMENT OF A SPANNED    ×
//* ×     × RECORD.                               ×
//* × 50- × DUPLICATE CONSECUTIVE KEYS IN A CI OR ×
//* ×     × BETWEEN TWO DATA CIS.                 ×
//* × 51- × OUT-OF-SEQUENCE KEYS IN A CI OR       ×
//* ×     × BETWEEN TWO CIS.                      ×
//* × 52- × RECORD LONGER THAN MAX LRECL.         ×
//* ×     ×                                       ×
//* × 53- × MISSING ENDING SEOF. (WHEN NOT AT END ×
//* ×     × OF AN EXTENT).                        ×
//* × 54- × CI OVERFLOW FOR LAST RDF RECORD       ×
//* ×     ×                                       ×
//* × 55- × KEY SEARCHED FOR HAS NOT BEEN FOUND   ×
//* ×     ×                                       ×
//* _______________________________________________
//*
//* ABEND CODES:
//*            S000 U000 - REQUESTED BY DEBUG OPTION.
//*            S000 U001 - ALWAYS AFTER MSG 005 OR 013.
//*            S000 U002 - AFTER MSG 009 OR IF KSDS NOT CLOSED.
//*
//*
//*                   *************************
//*                   F    DATA  AREAS        F
//*                   *************************
//*
//*
//* CI BUFFERS:
//*           GOTTEN VIA SNAP DD CARD. THEY ARE AUTOMATICALLY
//*           DUMPED WHEN AN ERRO IS FOUND ON A CI (WITH MSG
//*           00I OR 00D WHERE THE RBA IS GIVEN).
//*
//*           DISPLACEMENTS IN HEX:
//*
//*      '00'... NEXT BUFFER POINTER
//*      '04'... CI NUMBER IN HEX
//*      '08'... CORRESPONDING RBA IN HEX
//*      '0C'... RPL ADDRESS (ONLY FOR DATA CI BUFFERS)
//*      '20'... BEGINNING OF CI
//*
//*
//* LVLWA:
//*           ONE PER LEVEL OF INDEX. ONLY FOR INDEX TEST.
//*           THE LVLWA CONTAINS THE TABLES FOR HORIZONTAL
//*           POINTERS, BASE RBAS, AND VERTICAL POINTERS.
//*           GOTTEN VIA THE SNAP PARAMETER IN SYSIN AND
//*           PROVIDING A SNAP DD CARD.
//*
//*           DISPLACEMENTS IN HEX:
//*
//*      '00'... LWANXT............PTR TO NEXT LVLWA
//*      '04'... LWAPRV............PTR TO PREVIOUS LVLWA
//*      '08'... LWAFLG............FLAGS
//*      '--'... LWASWKS..X'80'....SWITCH FOR KEY SEARCHING
//*      '--'... LWAFIL...X'40'....FIRST INDEX IN LEVEL
//*      '09'... LWALVL............INDEX LEVEL(ONE BYTE)
//*      '0C'... LWALL.............LENGTH OF LVLWA
//*      '10'... TITLE.............'INDEX LEVEL N '
//*      '20'... LWAHHN............TITLE ' HHN '
//*      '24'... LWAHHF............POINTER TO FIRST HHP
//*      '28'... LWAHHSP...........SCAN PTR FOR HHPS
//*      '2C'... LWAHHL............POINTER TO LAST HHP
//*      '30'... LWAHHE............POINTER TO END OF HHP AREA
//*      '34'... LWAHHCT...........COUNT OF HHPS
//*      '40'... LWAIXN............TITLE 'IXN'
//*      '44'... LWAIXF............POINTER TO FISRT IXP
//*      '48'... LWAIXSP...........SCAN PTR FOR IXPS
//*      '4C'... LWAIXL............POINTER TO LAST IXP
//*      '50'... LWAIXE............POINTER TO END OF IXP AREA
//*      '54'... LWAIXPCT..........COUNT OF IXPS
//*      '60'... LWABRN............TITLE 'BRBA'
//*      '64'... LWABRF............POINTER TO FIRST BRBA
//*      '68'... LWABRSP...........SCAN POINTER FOR BRBAS
//*      '6C'... LWABRL............POINTER TO LAST BRBA
//*      '70'... LWABRE............POINTER TO END OF BRBA AREA
//*      '74'... LWABRCT...........COUNT OF BRBAS
//*      '78'... LWABRGR...........LARGEST BRBA FOUND
//*      '80'... LWACRBA...........CURRENT RBA
//*      '84'... LWAFCCT...........COUNT OF FREE CIS IN SEQ SET
//*      '88'... LWAFCCU...........COUNT OF FREE CIS IN DATA
//*
//*
//* IXPWA:
//*         FILLED WITH VERTICAL POINTERS FOR EACH SEQUENCE SET CI.
//*         USED ONLY IN DATA TEST.
//*
//*         DISPLACEMENTS IN HEX:
//*      '00'... IXPLL.............LENGTH OF IXPWA
//*      '04'... IXPT..............TITLE ' IXP '
//*      '08'... IXPF..............POINTER TO FIRST IXP
//*      '0C'... IXPSP.............SCAN POINTER TO IXPS
//*      '10'... IXPL..............POINTER TO LAST IXP
//*      '14'... IXPBRBA...........CURRENT BASE RBA
//*      '20'... IXPIXP............BEGINNING OF IXP ENTRIES
//*      DLMTR EQU X'FFFFFFFF'  DELIMITER BETWEEN FREE SPACE
//*                             ENTRIES AND DATA CI ENTRIES.
//*
//*
//*                  *******************************
//*                  G   PROGRAM  ORGANIZATION     G
//*                  *******************************
//*
//*    VSAMDIAG IS ORGANIZED INTO ONE LOAD MODULE MADE UP OF
//*    THREE MODULES, EACH CONTAINING ONE CSECT.
//*
//*    LOAD MODULE NAME ......... VSAMDIAG
//*    MODULE LENGTH............. 23712 (X'5CA0')
//*    CSECT NAMES............... VSAMHAT (ROUTER MODULE)
//*               ............... VSAMQCT (INDEX TEST)
//*               ............... VSAMKST (DATA  TEST)
//*    ENTRY POINT............... VSAMHAT
//*
//*   ****** NOTE FOR VS2 USERS ******
//*      IF YOU WISH TO RUN THIS PROGRAM ON A VSAM CATALOG,
//*      VSAMDIAG MU BE LINKEDITED WITH AUTHORIZATION.
//* ***************************************************************
//LINK EXEC PGM=IEWL,PARM='AC=1'
//SYSPRINT DD  SYSOUT=A
//SYSLMOD  DD  DSN=SYS1.LINKLIB,DISP=SHR
//SYSUT1  DD  UNIT=3330,SPACE=(CYL,(5,1))
//SYSLIN  DD  *
ESD      
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
RLD      
END                            15741SC103 020178298
ESD      
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
RLD      
RLD      
END 
ESD      
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
TXT 
RLD      
RLD      
END 
 ENTRY VSAMHAT
 NAME VSAMDIAG(R)
/*

         MACRO
&LABEL   READIN &DSECT=
&LABEL   CSECT
*        SAVE  (14,12)
         SAVE  (14,12)
         BALR  R12,R0
         USING *,R12
         ST    R13,SAVE+4
         LA    R13,SAVE
         ST    R13,8(R13)
*        REGISTER                 REGISTER EQUATES
         REGISTER                 REGISTER EQUATES
         SR    R7,R7              CLEAR INPUT RECORD COUNTER
         SR    R8,R8              CLEAR OUTPUT RECORD COUNTER
*OPENPRNT OPEN (PRINTOUT,OUTPUT)  OPEN PRINT DATA SET
OPENPRNT OPEN  (PRINTOUT,OUTPUT)  OPEN PRINT DATA SET
         TM    PRINTOUT+48,X'10'  TEST IF OPEN O.K.
         BNO   OPENFAIL           NO
*OPENIN  OPEN  (INPUT,INPUT)      OPEN INPUT DATA SET
OPENIN   OPEN  (INPUT,INPUT)      OPEN INPUT DATA SET
         TM    INPUT+48,X'10'     TEST IF OPEN O.K.
         BO    OPENOUT            YES
         MVC   PRTLINE+3(8),=C'INPUT   ' MOVE DDNAME TO MESSAGE
         MVC   PRTLINE+12(11),=C'OPEN FAILED'
*        PUT   PRINTOUT,PRTLINE   PRINT ERROR MESSAGE
         PUT   PRINTOUT,PRTLINE   PRINT ERROR MESSAGE
         B     OPENFAIL
*OPENOUT OPEN  (OUTPUT,OUTPUT)    OPEN OUTPUT DATA SET
OPENOUT  OPEN  (OUTPUT,OUTPUT)    OPEN OUTPUT DATA SET
         TM    OUTPUT+48,X'10'    TEST IF OPEN O.K.
         BO    READ               YES
         MVC   PRTLINE+3(8),=C'OUTPUT  ' MOVE DDNAME TO MESSAGE
         MVC   PRTLINE+12(11),=C'OPEN FAILED'
*        PUT   PRINTOUT,PRTLINE   PRINT ERROR MESSAGE
         PUT   PRINTOUT,PRTLINE   PRINT ERROR MESSAGE
OPENFAIL L     R13,SAVE+4         EXIT AFTER SETTING RETURN CODE TO 16
*        RETURN (14,12),RC=16
         RETURN (14,12),RC=16
*READ    GET   INPUT              READ INPUT RECORD
READ     GET   INPUT              READ INPUT RECORD
         LA    R7,1(R7)           INCREMENT INPUT RECORD COUNTER
         LR    R4,R1              SAVE INPUT RECORD ADDRESS
         AIF   ('&DSECT' EQ '').EXIT
         USING &DSECT,R4          ESTABLISH ADDRESSABILITY
.EXIT    MEND

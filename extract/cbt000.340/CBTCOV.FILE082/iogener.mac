         MACRO
&NAME    IOGENER  &GEN=
* ****************** MICROFICHE FLAGS *********************** SUPT CODE
* A079500-081500                                                 S22027
* A269510-269560,274050-274450,298975-298995,356570-356920       S99228
* A363070-363420,443210-443280,656050-656400,749600-749900       S99228
* A788000-790000,786840-796960,823600-823700,902330-902450,907700S99228
* A175200,322560,322680-322920,810000-812800                     S22029
* C165800-165850,272000-272300                                   S99228
* D162000                                                        S99228
* A175200,322560,322680-322860,808560,808680-808860              S22029
* C172000-173000                                                 S22029
* D176000                                                        S22029
* A272430-273034,653946-653994,744502-744512,                    S22028
* A901020-901160,907600,933800                                   S22028
* C273035-273036,648500                                          S22028
* D298512,298520-298929                                          S22028
* A259920                                                        A44890
* C061500,259530                                                 A44890
* A759000                                                         M1582
* C061500                                                         M1582
* A818000                                                         M6293
* C061500,805700-809000                                           M6293
* A165700,219200,378500,385500,402500,450700                     S21101
* C061500,194500-197500                                          S21101
* D157500,404000                                                 S21101
* A161500                                                         M5953
* C061500                                                         M5953
* C061500,086500                                                 A41024
* A073500,096200,100500-101000,105500-106500,444000,921500       A41027
* C061500,082500,084200,085500,091000,095000,097500,099000,      A41027
* D076000,079500-081500,107000                                   A41027
* A875000,876500,934500                                          A50191
* A280700,286000,290500,460500,744980,460640,460850              A48245
* C280700,727700                                                 A48245
* D459700,779700,585700                                          A48245
* C061500,106500-106600                                          A48273
* A442001-442005,473520-473900,934550                            A48276
* D460570-460920                                                 S22026
* A092080-092400,095540-095660,143520-143880,469550-469950       S22026
* A623060-623420,907580-907900,934200,949200                     S22026
* A312900,764500                                                 S22025
* C311500,767500,769500                                          S22025
* C061500                                                        S22025
* D460500,465200,460570-460640,460850                            S22025
* A341500                                                       SA56889
* A402915                                                       SA53632
* A205500,207000                                                SA55383
* A106700                                                       SA53628
* A356500,382500                                                SA55925
* C390500                                                       SA55925
* A026000,035000,491500,919500                                  SA57685
* C872500,937500,001999                                         SA57685
* D001500-001998                                                SA57685
* C005500-006500,934550                                         SA59501
* C347000,350000                                                SA60341
* A312920                                                       SA59034
* C219420,253500-254000                                         SA59034
* A201700,202500,859500                                         SA61781
* D341600-341700                                                SA62991
* A139300,140500                                                SA65910
*  RENUMBERED  269000-272850                                    SA68050
* A901080,933800,938420,947460                                  SA68050
* A470500                                                       SA69087
* D072500,152000,156500,184000,190000,198500,242000,272360       S21903
* D298995,340500,383200,447500,498000,776000,817200,854000       S21903
* D904000,923000,925000,926500,927000,927700,930000,938500       S21903
* D943440,943580-943620                                          S21903
* A813500                                                       SA64363
*A356640,379500                                                 SA69649
*C352000                                                        SA69649
*D352000-356500,394000                                          SA69649
* A269900                                                       OY03846
* C165800,269580,298975,356530,363070,442001,443205,473520      OY03846
* C848530,947580                                                OY03846
* D269200,271500,274050                                         OY03846
*A140700                                                        OY05148
.**********************************************************************
IEDQKA01 CSECT
&NAME    EQU   *
         ENTRY &NAME
         TITLE 'ACTIVATE (&NAME)- I/O GENERATOR SUBROUTINE (IEDQKA02)'
*                                                                     *
***********************************************************************
*                                                                     *
*  TITLE:  ACTIVATE AND IO GENERATOR SUBROUTINE (MIEDQKA)             *
*                                                                     *
         AIF   ('&GEN' NE 'MINI').TAG1                          SA59501
*  MODULE NAME = IEDQKD (MINI)                                        *
         AGO   .TAG5                                            SA59501
.TAG1    AIF   ('&GEN' NE 'STSP').TAG2                          SA59501
*  MODULE NAME = IEDQKC (STSP)                                        *
         AGO   .TAG5                                            SA59501
.TAG2    AIF   ('&GEN' NE 'BISC').TAG3                          SA59501
*  MODULE NAME = IEDQKB (BISC)                                        *
         AGO   .TAG5                                            SA59501
.TAG3    AIF   ('&GEN' NE 'QTAM').TAG4                          SA59501
*  MODULE NAME = IEDQKE (QTAM)                                        *
         AGO   .TAG5                                            SA59501
.TAG4    ANOP                                                   SA59501
*  MODULE NAME = IEDQKA (BOTH)(BLANK)                                 *
.TAG5    ANOP                                                   SA59501
*                                                                     *
*  DESCRIPTIVE NAME = ACTIVATE AND I/O GENERATOR ROUTINE              *
*                                                                     *
*  COPYRIGHT = 'NONE'                                                 *
*                                                                     *
*  STATUS:  CHANGE LEVEL 5                                            *
*                                                                     *
*FUNCTION -- THE FUNCTION OF THIS MODULE IS TO CONSTRUCT CHANNEL      *
*   PROGRAMS FOR INITIAL CONTACT, CONTINUE, AND RESET SEQUENCES.      *
*                                                                     *
*ENTRY POINTS --                                                      *
*   ACTIVATE                                                          *
*        CALLING SEQUENCE                                             *
*        L     R15,ADDR OF ACTIVATE                                   *
*        BR    R15                                                    *
*                                                                     *
*   I/O GENERATOR SUBROUTINE                                          *
*        L     12,ADDR OF I/O GENERATOR SUBROUTINE                    *
*        BALR  5,12                                                   *
*                                                                     *
*INPUT -- REGISTERS SET BY CALLER                                     *
*   FOR 'ACTIVATE' --                                                 *
*   R1  ADDR OF ERB OR BUFFER                                         *
*   R13 ADDR OF AVTSAVE2                                              *
*                                                                     *
*   FOR 'I/O GENERATOR' --                                            *
*   R13 ADDR OF AVTSAVE2                                              *
*   R2  LCB ADDRESS                                                   *
*   R5  RETURN ADDRESS                                                *
*                                                                     *
*OUTPUT -- REGISTERS AT EXIT                                          *
*   FOR 'ACTIVATE' --                                                 *
*   R11 DISPATCHER BASE                                               *
*   R13 ADDR OF AVTSAVE2                                              *
*                                                                     *
*   FOR 'I/O GENERATOR SUBROUTINE' --                                 *
*   R5  RETURN ADDRESS                                                *
*   R13 ADDR OF AVTSAVE2                                              *
*                                                                     *
*EXTERNAL ROUTINES --                                                 *
*   'IEDQTNT'-- USED TO CONVERT TWO BYTE TNT OFFSET TO TERMIANL       *
*   TABLE ENTRY ADDRESS.                                              *
*                                                                     *
*   SVC 0 -- EXCP                                                     *
*   SVC 35--WTO                                                SA57685*
*EXITS-NORMAL --                                                      *
*   'ACTIVATE' - RETURNS TO DISPATCHER TO DISPATCH NEXT READY STCB OR *
*   TO POST A CHAIN OF BUFFERS TO MH.                                 *
*                                                                     *
*   'I/O GENERATOR SUBROUTINE' - RETURNS TO CALLER                    *
*                                                                     *
*EXITS-ERROR -- NONE                                                  *
*                                                                     *
*TABLES/WORK AREAS -- DSECTS OF CONTROL BLOCKS AS EXPANDED BY MACROS  *
*        DCBD  DSORG=TX
*        TAVTD
*        TCCWD
*        TDEBD
*        TDISPD
*        TLCBD
*        TPRFD
*        TPRIOR
*        TQCBD
*        TQCBED
*        TSCBD
*        TSTCBD
*        TTSID
*        TTNTD
*        TTPD
*        TTRMD
*                                                                     *
*ATTRIBUTES                                                           *
*   'ACTIVATE' -- REUSABLE,REFRESHABLE                                *
*                                                                     *
*   'I/O GENERATOR SUBROUTINE' - RE-ENTRANT,REFRESHABLE - WHEN        *
*                                ENTERED FROM ACTIVATE.               *
*   PROBLEM PROGRAM MODE, ENABLED.  WHEN ENTERED FROM IGG019R0        *
*   -SUPERVISOR MODE, DISABLED.                                       *
*                                                                     *
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         *
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      *
*   SET.                                                              *
*                                                                     *
***********************************************************************
         EJECT
         ENTRY IEDQKA02
         DC    AL1(DSPMCPL2)            STCB OFFSET
         DC    AL1(0)
*    ACTIVATE IS ENTERED HERE WHEN GIVEN CONTROL BY THE DISPATCHER.   *
*
ACTIVATE EQU   *                        ENTRY PT FROM DISPATCHER
         SPACE 3
         USING *,15                     LINK REGISTER
         USING IHADCB,RDCB              DCB REGISTER
         USING IEDQTRM,RTERM            TERM ENTRY REGISTER
         USING AVTSAVE2,RAVT            AVT SAVE REGISTER
         USING IEDQLCB,RLCB             LCB REGISTER
         USING IEDQLCBX,RWKC            LCB EXTENSION ADDR       S99228
         USING IEDQCCW,RCCW             CCW REGISTER
         USING IEDQDISP,RSUPBASE        DISPATCHER BASE
         SPACE 3
* REGISTER DEFINITIONS
R0       EQU   0                        MODULE WORK REG
RPARM    EQU   1                        PARAMETER REG
RLCB     EQU   2                        LCB BASE
RTPCDE   EQU   3                        PTS TO CURR TP FIELD IN LCB
RDCB     EQU   4                        DCB BASE
R2       EQU   5                        WORK REGISTER
RWKA     EQU   6                        WORK REG
RWKB     EQU   7                        WORK REG
RTERM    EQU   8                        TERM ENTRY BASE
RWKC     EQU   9                        WORK REGISTER
RCCW     EQU   10                       CCW BASE
RSUPBASE EQU   11                       DISPATCHER BASE
RMOD     EQU   11                       PTS TO MODEL CCW'S
RBASE    EQU   12                       BASE ADDRESS FOR I/O GENERATOR
RAVT     EQU   13                       AVT BASE ADDRESS
REXPND   EQU   14                       LINK REG FOR EXPAND ROUTINE
RLNK1    EQU   15                       WORK REG
         EJECT
         STM   11,15,12(13)             SAVE REQUIRED REGISTERS
&NAME    IEDHJN ID                                               S22025
         LR    RLCB,RPARM               ERB ADDRESS
         TM    PRFTIC-IEDQPRF(RPARM),CCWTIC ERB OR BUFFER
         BZ    ITSERB                   BRANCH IF ERB
         L     RLCB,PRFLCB-1-IEDQPRF(RPARM) SET LCB BASE
         B     ITSLCB                   CONTINUE
ITSERB   EQU   *
         SH    RLCB,LCBBKUP             BACK UP TO LCB
ITSLCB   EQU   *
         L     RDCB,LCBDCBPT            DCB BASE
         AIF   ('&GEN' EQ 'BISC').L6
         AIF   ('&GEN' EQ 'MINI').L6
         AIF   ('&GEN' EQ 'QTAM').L6
         TM    LCBTSOB,LCBTSBUF         IS THIS A TS BUFFER?        TSO
         BZ    TSO1                     BRANCH ON NO                TSO
         L     RWKA,AVTTSOPT            GET ADDRESS OF TS SCHED     TSO
         L     RWKA,TSISCHED-IEDQTSI(,RWKA)                         TSO
         BAL   RTPCDE,24(RWKA)          BRANCH TO ROUTINE           TSO
TSO1     EQU   *                                                    TSO
.L6      ANOP
         LA    RBASE,BUILD              IOGEN SUBROUTINE            TSO
         BALR  R2,RBASE                 LINK TO IO GEN
         LM    11,15,12(13)             RESTORE REGISTERS
         MVC   LCBTTCIN,LCBTTBIN        TO BE CONNECTED IS NOW CON-
         SPACE 2                                                 A41027
         L     RWKB,DCBMH-1 .           GET MH -CB ADDRESS FOR POA41027
         SR    RWKC,RWKC .              CLEAR POST LIST FOR FINALA41027
*                                         EXIT TO DISPATCHER     A41027
         SPACE 2                                                 A41027
*        UNIT EXCEPTION BIT WILL BE SET WHEN AA CONTINUE OR ABORTA41027
* SEQUENCE CAN NOT BE SENT (EX. 1030, 2260L, ETC.)               A41027
         TM    LCBCSW+3,UNEX            NO RESTART ON CONTINUE
*                                         REQUEST
         BZ    NOTUNEX                  BRANCH NO
         SPACE
         L     RPARM,LCBLSPCI-1         BUFFER TO POST
         MVI   PRFPRI-IEDQPRF(RPARM),PRIMHBFR POST PRIORITY
         NI    PRFSTAT1-IEDQPRF(RPARM),PRFNLSTF 'LAST BUFFWR'
         ST    RWKB,PRFQCBA-1-IEDQPRF(RPARM) ST SET POST ADDRESS
         B     DSPPOST                  POST BUFFER TO MH
NOTUNEX  EQU   *
         AIF   ('&GEN' EQ 'STSP').Z0 .                           S22027
         AIF   ('&GEN' EQ 'MINI' OR '&GEN' EQ 'QTAM').Z0 .       S22027
         TM    LCBSTICS+1,CBRDCAST .    BROADCAST MESSAGES       S22027
         BO    EXITDSP .                BRANCH IF YES            S22027
.Z0      ANOP                                                    S22027
         TM    LCBSTAT2,LCBMSGNN        MSG GEN
         BO    EXITDSP .                BRANCH YES               A41027
         SPACE 2                                                 A41027
         TM    LCBSTAT1,LCBRECVN        RECEIVE STATE
         AIF   ('&GEN' NE 'MINI').Z1
         BO    EXITDSP .                YES                      A41027
         AGO   .Z2
.Z1      ANOP
         BZ    NOTRCV                   NO
         CLI   LCBCPA+24,CCWPOLL        AUTOPOLL IN USE
         BNE   EXITDSP .                NO                       A41027
         SPACE
*        WANT TO OPEN LIST FOR SEND STCB OR POLL DELAY           A41024
         CLI   DCBINTVL,AVTEZERO .      POLL DELAY  SPECIFIED    A41024
         BNE   ITSHERE .                BRANCH IF YES            A41024
         LA    RWKA,LCBSTCBA-5          RECEIVE STCB -4
         CLI   LCBRSKEY,BUFFVTO         BUFFERED LCB
         BNE   LOOPPOLL                 BRANCH IF NO
         SPACE
         LA    RWKA,LCBRSKEY            ADJUST FOR LOOP CONTROL
LOOPPOLL EQU   *
         L     RWKA,STCBLINK-1-IEDQSTCB(RWKA) NEXT STCB IN CHAIN
         CLI   STCBPRI-IEDQSTCB(RWKA),0 LAST STCB (QEVENT)
         BE    EXITDSP .                YES                      A41027
         CLI   STCBVTO-IEDQSTCB(RWKA),SENDVTO SEND STCB
         BE    ITSHERE                  YES
         AIF   ('&GEN' EQ 'MINI').CONC1A .                       S22026
         CLI   STCBVTO-IEDQSTCB(RWKA),CSVTO .                    S22026
*                                       CONC SCHEDULER           S22026
         BE    ITSHERE .                BRANCH IF YES            S22026
.CONC1A  ANOP .                                                  S22026
         CLI   STCBVTO-IEDQSTCB(RWKA),BUFFVTO BUFFERED SEND STCB
         BNE   LOOPPOLL                 NO TRY NEXT STCB
         SPACE
ITSHERE  EQU   *
         MVI   LCBCPA+32,CCWNOP         NOP FIRST TIC
         B     EXITDSP .                EXIT                     A41027
         SPACE 2                                                 A41027
NOTRCV   EQU   *
.Z2      ANOP
*                                                                A41027
*        FOR DEVICES THAT ARE NOT SELECTED BUFFERS ARE POSTED NOWA41027
         SPACE
         TM    LCBSTAT2,LCBRESP         POST BUFFER NOW
         BNZ   POST                     YES, CONVERSE RESPONSE
* INSTEAD OF LINE END APPENDAGE                                  A41027
*                                                                A41027
         TM    LCBSTICS+1,CBISYNC+CSTNCTL+CTWX CAN TERMINAL BE
*                                         SELECTED
         BNZ   EXITDSP .                NOT START STOP CONTENTIONA41027
         SPACE
         TM    LCBSTICS+2,CWTTA         WORLD TRADR
         BNZ   EXITDSP .                YES                      A41027
POST     EQU   *
         L     RWKA,LCBERBCH-1          ADDRESS OF FIRST BUFFER
         LR    RWKC,RWKA .              SAVE POINTER TO POST LISTA41027
LOOP     EQU   *
         ST    RWKB,AVTEZERO(,RWKA)     QCB ADDRESS FOR POST
         MVI   4(RWKA),PRIMHBFR         SET POST PRIORITY
         L     RWKA,4(,RWKA)            LINK ADDRESS NEXT BUFFER
         LA    RWKA,AVTEZERO(,RWKA)     CLEAR HI ORDER BYTE
         LTR   RWKA,RWKA                IS THERE A NEXT BUFFER
         BNZ   LOOP                     YES
         SPACE
         XC    LCBERBCH,LCBERBCH .      RESET FIELD FOR LATER USEA41027
         LR    RPARM,RWKC .             ASSUME LOCAL DEVICE      A41027
         TM    LCBSTICS+1,CLOCAL+CAUDIO . LOCAL DEVICE           A48273
         BNZ   DSPCHAIN .               BR YES, EXCP WILL BE     A48273
*                                         AT BUFFER ASSOCIATION  A41027
         TM    LCBSTICS+2,CNOIDLES      NO IDLES LOOP (2260R)   SA53628
         BO    DSPCHAIN                 BRANCH IF YES,EXCP DONE SA53628
*                                         BUFFER ASSOCIATION    SA53628
EXITDSP  EQU   *                                                 A41027
         SPACE
         LA    RPARM,LCBFLAG1 .         EXCP PARAMETER (IOB)     A41027
         SVC   EXCP                                              A41027
         SPACE 2                                                 A41027
         LR    RPARM,RWKC .             POST PARAMETER LIST      A41027
         B     DSPCHAIN .               EXIT TO POST BUFFERS OR  A41027
*                                         DISPATCH NEXT STCB     A41027
         EJECT
*        C O D I N G    T E C H N I Q U E S
         SPACE 1
*     THE CHANNEL PROGRAM CONSTRUCTED IS BASED UPON THE CHARACTER-
* ISTICS OF THE DEVICE (OBTAINED FROM THE DEVICE CHARACTERISTICS
* FOR THIS TERMINAL OR LINE ENTRY).  THE I/O GENERATOR SUBROUTINE
* TESTS CHARACTERISTICS BITS AND TRANSFERS CONTROL TO THE 'EXPAND'
* ROUTINE (DESCRIBED BELOW) PASSSING AN OFFSET INTO A MODEL CCW
* TABLE.
*  E. G. REXPND (REG14)=A(EXPAND)
*        BALR  RLNK1,REXPND
*        DC    AL2(MODCCW08-MODCCW)
*     THIS SEQUENCE BUILDS A DISABLE-ENABLE SEQUENCE.
*     THE MODEL CCW TABLE CONSISTS OF TWO BYTE ENTRIES.
* THE FIRST BYTE IS AN OFFSET INTO A SECOND TABLE (EXPANDER TABLE).
* THE SECOND BYTE CONTAINS THE CCW FLAGS FOR THE CCW BEING BUILT.
* THE EXPAND ROUTINE MOVES THE SPECIFIED FLAGS FOR THE CCW
* THE EXPAND ROUTINE MOVES THE SPECIFIED FLAGS INTO THE CCW AND
* UTILIZES THE ONE BYTE INDEX (FROM THE MODEL CCW TABLE) TO ACCESS
* THE FOLLOWING INFORMATION FROM THE EXPANDER TABLE:
*     EACH ENTRY IN THE EXPANDER TABLE HAS THE FOLLOWING FORMAT:
*        DC    AL2(OFFSET TO A ROUTINE THAT ESTABLISHES ADDRESS
*                  AND COUNT)
*        DC    AL1(CCWDISAB)            CCW OP CODE
*        DC    AL1(TPDISAB)             TP OP CODE
*     THE EXPAND ROUTINE PASSES CONTROL TO AN EXPANDER SUBROUTINE
* (BY BRANCHING TO ORGRTN INDEXED BY THE 2 BYTE OFFSET) THAT COM-
* PUTES CCWDATA ADDRESS AND COUNT.  UPON REGAINING CONTROL, THE
* EXPAND ROUTINE MOVES THE CCWOP CODE INTO THE CCW AND THE TP OP
* CODE INTO THE LCB FROM THE EXPANDER TABLE.
*     RETURNING AGIN TO THE EXAMPLE, THE FIRST CCW IN THE SEQUENCE
* (DISABLE) HAS BEEN BUILT.  A REGISTER IS ADJUSTED TO POINT TO THE
* ENTRY IN THE MODEL CCW TABLE AND A TEST IS PERFORMED FOR THE LAST
* ENTRY.  IF THIS IS NOT THE LAST ENTRY THE ABOVE ACTION IS PER-
* FORMED AGAIN TO CONSTRUCT THE NEXT CCW (THE ENABLE).  EXPAND RE-
* TURNS TO IN-LINE CODE OF THE I/O GENERATOR WHEN THE LAST ENTRY
* IS REACHED.
         SPACE 2
* CONTROL IS GIVEN TO BUILD WHEN ENTERED FROM AN APPENDAGE.           *
BUILD    EQU   *
IEDQKA02 EQU   *
         USING *,RBASE
         L     RDCB,LCBDCBPT
         LA    RWKA,LCBCPA+16           START ON 3RD CCW
         ST    RWKA,LCBSTART-1          PARAMETER FOR IOS
         NI    LCBCSW+3,AVTEFF-UNEX     RESET SWITCH
         LH    RWKC,LCBTTBIN            TERMINAL TO BE CONNECTED
         AIF   ('&GEN' EQ 'MINI').L7
         LTR   RWKC,RWKC                SPECIFIC CONNECTION
         BNZ   CONNECT1                 BRANCH YES
         TM    LCBSTAT2,LCBDIAL         DIAL LINE
         BZ    NONDIAL                  NO
         SPACE
         LH    RWKC,LCBLNENT            ADDRESS OF LINE ENTRY
         LTR   RWKC,RWKC                DO WE HAVE LINE ENTRY
         BNZ   CONNECT1                 BRANCH YES
         SPACE
NONDIAL  EQU   *
         SR    RTERM,RTERM              CLEAR FOR INDEXING
         IC    RTERM,LCBUCBX            RLN-1
         SLL   RTERM,2                  MULTIPLY FOR INDESX
         L     RTERM,DCBINVLI(RTERM)    ILIST FOR THIS LINE
         LA    RTERM,AVTEZERO(,RTERM)   CLEAR HI ORDER BYTE
         AIF   ('&GEN' EQ 'BISC' OR '&GEN' EQ 'QTAM').LAA1
         L     RWKA,LCBINVPT-1          CURRENT INVITATION LIST
         CLI   0(RWKA),X'FE'            IS THIS END OF LIST
         BE    LEND                    END OF LIST              SA65910
         CLI   1(RWKA),X'FE'           IS THIS END OF LIST      SA65910
         BNE   NOTEND                  BRANCH NO                SA65910
LEND     EQU   *                                                SA65910
         BNE   NOTEND                   BRANCH ON NO
.LAA1    ANOP
         BCTR  RTERM,0                  BACK UP
         BCTR  RTERM,0                  NOW TWO
         AIF   ('&GEN' EQ 'BISC' OR '&GEN' EQ 'QTAM').LAA2
         B     CONNECT0
NOTEND   EQU   *
         SR    RWKC,RWKC                CLEAR FOR IC
         IC    RWKC,2(RTERM)            ENTRY WIDTH
         BCTR  RWKC,0                   REDUCE BY ONE
         IC    RWKC,0(RWKA,RWKC)        GET ENTRY INDEX
         SLL   RWKC,1                   MULTIPLY BY TWO
         SR    RTERM,RWKC               GET ACTUAL ENTRY OFFSET
CONNECT0 EQU   *
.LAA2    ANOP
         LH    RWKC,AVTEZERO(,RTERM)    REPRESENATIVE ENTRY
         TM    LCBSTAT2,LCBMSGNN       IS THIS A MESSAGE GEN    SA65910
         BNO   CONNECT1                BRANCH NO                SA65910
         TM    LCBSTAT2,LCBDIAL         DIAL LINE               OY05148
         BO    CONNECT1                 YES, BRANCH             OY05148
         STH   RWKC,LCBTTBIN           REPRESENATIVE ENTRY      SA65910
CONNECT1 EQU   *
.L7      ANOP
         N     RWKC,AVTCLRHI            CLEAR NEGATIVE PROPAGATION
         L     RWKB,AVTRNMPT            ADDRESS OF TNT
         USING IEDQTNTD,RWKB
         BAL   RWKA,TNTDCODE            LNK TO ROUTINE
         DROP RWKB
         AIF   ('&GEN' EQ 'MINI').CONC2A .                       S22026
         TM    TRMDEVFL+1,TRMCONC .     CONC                     S22026
         BNO   NOTCONC .                BRANCH IF NO             S22026
         L     RWKA,TRMDESTQ-1 .        QCB ADDR                 S22026
         TM    QCBDSFLG-IEDQQCB(RWKA),QCBDRQQ .                  S22026
*                                       DATA READY QUE           S22026
         BO    NOTCONC .                BRANCH IF YES            S22026
         TM    LCBSTAT1,LCBSENDN .      LCB SENDING              S22026
         BNO   NOTSEND .                BRANCH IF NO             S22026
         TM    TRMDEVFL,X'20' .         ADDRESSING CHARS         S22026
         BO    NOTCONC .                BRANCH IF YES            S22026
NOTSEND  EQU   * .                                               S22026
         LH    RWKB,QCBEXTO-IEDQQCB(RWKA) .                      S22026
*                                       QCB EXTENSION OFFSET     S22026
         AR    RWKA,RWKB .              COMPUTE ADDR             S22026
         L     RTERM,QCBECONC-IEDQQCBE-1(RWKA) .                 S22026
*                                       CONC TERM ADDR           S22026
NOTCONC  EQU   * .                                               S22026
.CONC2A  ANOP .                                                  S22026
         LA    REXPND,EXPAND            SET-UP LINK FOR EXPAND
         LH    RWKA,TRMSIO              SIO COUNTER
         LA    RWKA,1(,RWKA)            BUMP
         STH   RWKA,TRMSIO              ST BACK
         SR    RWKA,RWKA                CLEAR WORK REGISTER
         IC    RWKA,TRMCHCIN            INDEX INTO CHARACTERISTIC
         BCTR  RWKA,R0                  DECREMENT FOR N-1TH ENTRY
         SLL   RWKA,2                   MULTIPLY FOR OFFSET
         A     RWKA,AVTCSTCS            ADD TABLE START
         MVC   LCBSTICS-1(4),0(RWKA)    CHARACTERISTICS TO LCB
         AIF   ('&GEN' EQ 'BISC').LA1
         AIF   ('&GEN' EQ 'MINI').LA1
         AIF   ('&GEN' EQ 'QTAM').LA1
         TM    LCBSTICS,C5041           1050/2741 LINE?             TSO
         BZ    TSO10                    NO                          TSO
         TM    LCBTSOB,LCB2741N         IS IT A 2741?               TSO
         BNO   S1050                    NO. USE 1050 CH'STICS       TSO
         MVC   LCBSTICS(3),D41STICS     2741 DEVICE CH'STICS        TSO
         B     TSO10                                                TSO
S1050    EQU   *                                                    TSO
         MVC   LCBSTICS(3),D50STICS     1050 CH'STICS               TSO
TSO10    EQU   *                                                    TSO
.LA1     ANOP
         TM    LCBSTAT1,LCBCONT         REQU%EST FOR CONTINUE
         BNZ   CONTINUE                 BRANCH YES
         MVI   LCBINCAM,AVTEZERO        RESET ERROR COUNTER
         SPACE
         TM    LCBSTAT2,LCBMSGNN        MSGEN
         BO    MSGGEN                   YES
         TM    LCBSTAT1,LCBSENDN        SEND STATE
         BO    WRITINIT                 YES
         TM    LCBSTAT2,LCBRESP         OWE A RESPONSE
         BZ    READ                     NO
         BAL   R0,WRRESP                BUILD RESPONSE
READ     EQU   *
         AIF   ('&GEN' EQ 'MINI').L4A3                          OY03846
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         NI    LCBMSGFM,LCBACKI         CLEAR BSC CONTROL, LEAVE S99228
*                                       ACK COUNTER              S99228
         TM    LCBXFLAG,LCBGPCTV        GENERAL POLL IN PROGRESS?S99228
         BO    KEEPSET                  YES, NO RESET ACK-1      S99228
.L4A3    ANOP                                                    S99228
         MVI   LCBERCCW+12,FLAG         SET ONLY SILI FLAG IN CCWS99228
         MVI   LCBMSGFM,AVTEZERO        RESET FORMAT BITS AND AC S99228
KEEPSET  EQU   *                                                 S99228
*                                         COUNTER                S21101
         L     RWKC,LCBLSPCI-1           ADDRESS FO FIRST BUFFER
         LH    RWKA,AVTKEYLE             SIZE OF A UNIT
         CH    RWKA,DCBBUFSI            COMPARE WITH DCB OPERAND
         BNH   SETSIZE                  BRANCH DCB LESS OR EQUAL
         LH    RWKA,DCBBUFSI            DCB PARAMETER
SETSIZE  EQU   *
          SR    RWKB,RWKB                CLEAR WORK REGISTER
         AIF   ('&GEN' EQ 'MINI').L8
         AIF   ('&GEN' EQ 'BISC').L8
         AIF   ('&GEN' EQ 'QTAM').L8
** TSO---CHECK FOR CORRECT DATA COUNT                               TSO
**                                                                  TSO
         TM    LCBTSOB,LCBTSBUF         IS THIS A TSO BUFFER        TSO
         BO    TSOB                     DO NOT RESERVE CHARS     S22029
*                                       FOR TIME-SHARING MSGS    S22029
.L8      ANOP
         IC    RWKB,DCBRESER            IDLES RESERVED FOR HEADER
TSOB     EQU   *                                                 S22029
         STC   RWKB,LCBISZE             SET IDLES COUNT IN LCB
         LA    RWKB,PRFSHDR-PRFSUNIT(,RWKB) BUMP BY HEADER SIZE
         SR    RWKA,RWKB                 DATA COUNT FOR 1ST VUFFER
          STH  RWKA,CCWCOUNT-CCW(,RWKC) ESTABLISH COUNT
         IC    RWKA,PRFOPCDE-IEDQPRF(,RWKC) SAVE OP CODE
         LA    RWKB,PRFSUNIT-IEDQPRF(RWKB,RWKC) START ADDRESS-CCW
         ST     RWKB,PRFIOADR-1-IEDQPRF(,RWKC) SET IN CCW
         STC    RWKA,PRFOPCDE-IEDQPRF(,RWKC) RESTORE OP CODE
         NI    PRFSTAT1-IEDQPRF(RWKC),PRFNHDRF 'TEXT' BIT OFF
         EJECT
*
*        * * * * * * * * * * * * * * * * * * * * * * * * * *
*        *                                                 *
*        *     R E A D    I N I T I A L    L O G I C       *
*        *                                                 *
*        * * * * * * * * * * * * * * * * * * * * * * * * * *
         SPACE 3
         NI    LCBSTAT2,AVTEFF-LCBRESP  TURN OFF RESPONSE BIT
         LA    RCCW,LCBCPA              SET CCW BASE
         LA    RTPCDE,LCBTPCD           SET TP OP CODE BASE
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW00-MODCCW)
         AIF   ('&GEN' EQ 'MINI').L10
         TM    LCBSTAT2,LCBDIAL         DIAL LINE?
         BZ    NOSWITCH                 BRANCH IF NOT
         SPACE 5
******** D I A L    L I N E S ********
         SPACE 2
         TM    LCBSTAT2,LCBNEGRP        NEG RESPL TO POLLING
         BO    ENAB                     YES, WANT TO DISCONNECT
         TM    LCBSTAT1,LCBCTLMD        DIAL UP READ
         BZ    CONNECT .                NO                       S21101
         SPACE 5                                                 S21101
* D I A L    C O N N E C T I O N
         NI    LCBSTAT1,AVTEFF-LCBCTLMD RESET SWITCH
         AIF   ('&GEN' NE '').L11
         TM    LCBSTAT2,LCBSYNC         BSC LINE
         BZ    NODLUPBS                 BRANCH NO
.L11     ANOP
         AIF   ('&GEN' EQ 'STSP').L12
         AIF   ('&GEN' EQ 'QTAM').L12
         TM    LCBTPCD+11,DISDLEOT      WRITE DISCONNECT        SA61781
         BO    GODISCON                 BR YES                  SA61781
         OI    LCBTPCD+11,DISDLEOT      SET TO WRITE DISCONNECT SA61781
*                                         PRIOR TO NEXT DISABLE SA61781
         LA    RTPCDE,ONE(,RTPCDE)      ADJUST TP CODE BASE     SA61781
         LA    RCCW,EIGHT(,RCCW)        ADJUST CCW BASE         SA61781
         ST    RCCW,LCBSTART-1          SET START ADDRESS       SA61781
         B     NODISCON                 CONTINUE                SA61781
GODISCON EQU   *                                                SA61781
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW01-MODCCW)
         B     NEXT                     CONTINUE                SA61781
NODISCON EQU   *                                                SA61781
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE    SA61781
         DC    AL2(MODCCW02-MODCCW)                             SA61781
NEXT     EQU   *                                                SA61781
         SPACE
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         CLI   IDLOC+1(RWKC),0          ID SPECIFIED
         BE    NOTANID                  BRANCH IF NO ID
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW14-MODCCW)
         B     WREOT                    GO WRITE EOT ONLY       SA55383
NOTANID  EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPNAD
         DC    AL2(MODCCW15-MODCCW)
WREOT    EQU   *                                                SA55383
         BALR  RLNK1,REXPND             LINK TO EXPNAD
         DC    AL2(MODCCW16-MODCCW)
.L12     ANOP
         AIF   ('&GEN' EQ 'BISC').L222
NODLUPBS EQU   *
         BALR  RLNK1,REXPND             BUILD DISABLE DIAL
         DC    AL2(MODCCW02-MODCCW)
         TM    LCBSTICS+1,CTWX
         BZ    BLDPADS                  BUILD WRITE PADS
         BALR  RLNK1,REXPND             READ TERM ID
         DC    AL2(MODCCW32-MODCCW)
         BALR  RLNK1,REXPND             WRITE CPU ID  AND READ
         DC    AL2(MODCCW18-MODCCW)
BLDPADS  EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW36-MODCCW)
         B     CONNECT .                BUILD REST OF CANNEL PROGAM
.L222    ANOP
         EJECT
* E N A B L E    C O N N E C T I O N
ENAB     EQU   *
         NI    LCBSTAT2,AVTEFF-LCBNEGRP NEGATIVE RESPONSE OFF
         MVI   LCBTSTSW,AVTEZERO        INDICATE LINE NOT CONNECTED
         AIF   ('&GEN' NE '').L14
         TM    LCBSTAT2,LCBSYNC         BSC LINE
         BZ    NOBSD                    NO
.L14     ANOP
         AIF   ('&GEN' EQ 'STSP').L15
         AIF   ('&GEN' EQ 'QTAM').L15
         L     RWKA,LCBSCBA-1           GET SCB POINTER          S21101
         USING IEDQSCB,RWKA .                                    S21101
         OI    SCBBSCFM,SCBNOEOT        SET RECEIPT OF EOT AS   SA59034
*                                         PENDING               SA59034
         DROP  RWKA .                                            S21101
         TM    LCBTPCD+11,DISDLEOT      NEED DLE EOT PRIOR TO DISAB
         BO    SNDLEEOT                 BRANCH IF YES
         SPACE
         OI    LCBTPCD+11,DISDLEOT      SET FOR NEXT TIME-LINE END
*                                         WILL RESET IF DLE EOT
*                                         RECEIVED
         LA    RTPCDE,1(,RTPCDE)        ADJUST TP OP CODE BASE
         LA    RCCW,8(,RCCW)            RESET CCW BASE
         ST    RCCW,LCBSTART-1          AND SET START ADDRESS
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW7B-MODCCW)
         B     NXTBSCCW                 CONTINUE BUILDING
SNDLEEOT EQU   *
         SPACE
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW07-MODCCW)     DISABLE SEQUENCE
         SPACE
NXTBSCCW EQU   *
         CLI   DCBINTVL,TONEOPT         WRITE TONE REQUESTED
         BNE   NOTONE                   BRANCH IF NO
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW7A-MODCCW)
         SPACE
NOTONE   EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW10-MODCCW)
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         CLI   IDLOC+1(RWKC),0          CPU ID SPECIFED
         BE    NOBSID                   NO
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW11-MODCCW)
NOBSID   EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW12-MODCCW)
.L15     ANOP
         AIF   ('&GEN' EQ 'BISC').L16
         AIF   ('&GEN' EQ 'QTAM').L16A
         SPACE
NOBSD    EQU   *
         MVI   LCBTPCD+11,X'AB'         SET FIRST TIME SWITCH   TSO
         TM    LCBSTICS,C5041 .         THIS A 5041 LINE            TSO
         BZ    TSO99 .                  NO                          TSO
         NI    LCBTSOB,X'FF'-LCB2741N . RESET 2741 FLAG IF ON       TSO
TSO99    EQU   * .                                                  TSO
         L     RLNK1,DCBTRANS-1 .       POINT TO TABLE OR LIST      TSO
         TM    0(RLNK1),X'80' .         IS IT TRANLIST MACRO        TSO
         BZ    TSO20 .                  NO                          TSO
         MVC   AVTPARM3(4),OPTLIST .    SKELETON PARAM LIST         TSO
         IC    RWKB,1(,RLNK1) .         OPTION FIELD OFFSET         TSO
         STC   RWKB,AVTPARM3+2 .        TO PARM LIST                TSO
         LA    RPARM,AVTPARM3 .         PARM LIST POINTER           TSO
         LA    RAVT,72(,RAVT) .         KICK DOWN FOR UI            TSO
         STM   2,12,28(RAVT) .          SAME AS IEDQUI DOES         TSO
         LA    REXPND,LOCRTN .          SET UP RETURN            S22025
         ST    REXPND,12(,RAVT) .       SAVE IT                  S22025
         LR    RWKC,RAVT                LOAD CALLERS ADDR        S22025
         LA    RAVT,72(RAVT)            BUMP TO NEXT SAVEAREA    S22025
         ST    RWKC,4(RAVT)             STORE BACK CHAIN         S22025
         ST    RAVT,8(RWKC)             STORE FORWARD CHAIN
         L     RWKC,CVTPTR .                                        TSO
         L     RWKC,AVTCVTPT(,RWKC) .                               TSO
         L     RWKC,0(,RWKC) .          POINT TO AVT                TSO
         L     RBASE,AVTMSGS-1-IEDQAVTD(RWKC)                    S22025
*                                       VCON LIST ADDR           S22025
         L     RBASE,20(,RBASE) .       OFFSET TO AE VCON=20        TSO
         LR    RDCB,RLCB .              AE USES 4 FOR LCB           TSO
         BR    RBASE .                  TO IEDQAE                   TSO
LOCRTN   EQU   * .                                                  TSO
         SH    RAVT,H72 .               RESTORE AVTPOINTER          TSO
         LA    REXPND,EXPAND .          RESTORE CALL REG            TSO
         LTR   RLNK1,RLNK1 .            SEE IF OPTION FLD PRESENT   TSO
         BZ    TSO20 .                  NO. NOTHING TO DO
         XC    0(4,RLNK1),0(RLNK1) .    YES. ZERO FOR NEXT USE      TSO
TSO20    EQU   * .                                                  TSO
.L16A    ANOP
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW08-MODCCW)
         SPACE 2
         AIF   ('&GEN' EQ 'QTAM').L16B
         TM    LCBTSOB,LCB2741N         THIS A 2741                 TSO
         BO    NOSWITCH                 USED LEASED CODE
         TM    LCBSTICS,C5041           1050/2741 LINE?             TSO
         BO    SPEC41                   YES. PUT UP SPECIAL CCWS    TSO
.L16B    ANOP
         TM    LCBSTICS+1,CAUDIO        AUDIO
         BNZ   NOSWITCH                 NO
         EJECT
.L16     ANOP
* C O N N E C T I O N    P R E V I O U S L Y    D O N E
         SPACE 1
CONNECT  EQU   *
         AIF   ('&GEN' NE '').L17
         TM    LCBSTICS+1,CBISYNC       BY SYNC LINE
         BZ    NOTBSCD
.L17     ANOP
         AIF   ('&GEN' EQ 'STSP').L18
         AIF   ('&GEN' EQ 'QTAM').L18
         L     RWKA,LCBSCBA-1           GET SCB ADDRESS
         USING IEDQSCB,RWKA
         TM    SCBBSCFM,SCBNOEOT .      DID WE SEND A MSG        S21101
         BO    SENDEOT                  BR IF NOT               SA59034
         OI    SCBBSCFM,SCBNOEOT        SET RECEIPT OF EOT AS   SA59034
*                                         PENDING               SA59034
         BALR  RLNK1,REXPND             BUILD READ ENQ
         DC    AL2(MODCCW17-MODCCW)
SENDEOT  EQU   *
         DROP RWKA
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW16-MODCCW)
.L18     ANOP
         AIF   ('&GEN' EQ 'BISC').L10
NOTBSCD  EQU   *
         TM    LCBSTICS+1,CTWX          TWX
         BZ    NOSWITCH                 NO
         AIF   ('&GEN' EQ 'QTAM').L18A                           A44890
         TM    LCBTSOB,LCBINHBN    INHIBITS TO BE DONE             TSO
         BZ    NOTWIN .                 BRANCH NO
*
         BALR  RLNK1,REXPND
         DC    AL2(MODCCW19-MODCCW)
NOTWIN   EQU   *
.L18A    ANOP                                                    A44890
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW18-MODCCW)
.L10     ANOP
         SPACE 5
********       L E A S E D    L I N E S      ********
         SPACE 2
NOSWITCH EQU   *
         TM    LCBSTICS+1,CCONTENT      CONTENTION
         BO    CONTT
         AIF   ('&GEN' EQ 'BISC').Z4
         TM    LCBSTICS+1,CLOCAL+CAUDIO  LOCAL OR AUDIO
         AIF   ('&GEN' NE 'MINI').Z3
         BZ    TRSTCTL
         AGO   .M4
.Z3      ANOP
         BZ    NOLOC                    NO
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         CLI   IDLOC+1(RWKC),0          CPU ID FOR AUDIO
         BE    NOIDAUD                  NONE SPECIFIED
         SPACE
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW63-MODCCW)
NOIDAUD  EQU   *
         TM    LCBSTICS,C3270           3270 DEVICE?             S99228
         BZ    NOC3270                  BRANCH NO                S99228
         TM    LCBSTICS+ONE,CLOCAL      LOCAL DEVICE?            S99228
         BZ    NOC3270                  BRANCH NO                S99228
         LA    RCCW,LCBCPA+16           SET CCW ADDR             S99228
         BALR  RLNK1,REXPND             LINK TO EXPAND           S99228
         DC    AL2(MODCCW73-MODCCW)     3270 LOCAL READ CH PGM   S99228
NOC3270  EQU   *                                                 S99228
         AIF   ('&GEN' EQ 'QTAM').M4                            OY03846
         TM    LCBTSOB,LCBTSBUF .       IS THIS A TSO LINE          TSO
         BZ    NOSW1 .                  BRANCH NO                   TSO
         MVC   LCBSTART,LCBLSPCI .      START READ ON BUFFER        TSO
NOSW1    EQU   *
.M4      ANOP
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW64-MODCCW)
         AIF   ('&GEN' EQ 'MINI').Z5
NOLOC    EQU   *
.Z4      ANOP
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         TM    LCBXFLAG,LCBGPCTV        GENERAL POLL IN PROGRESS?S99228
         BO    SAMESET                  YES, NO RESET ACK CNTR   S99228
         OI    LCBMSGFM,LCBACKI         FIRST ACK ON P MPT IC OD S99228
SAMESET  EQU   *                                                 S99228
.L413    ANOP                                                    S99228
         BAL   RWKB,ILIST               LOCATE INVITATION LIST   S99228
         AIF   ('&GEN' EQ 'QTAM').L446                           S22028
         AIF   ('&GEN' EQ 'BISC').L446                           S22028
         L     RWKA,TRMDESTQ-1          GET ADDRESS OF QCB       S22028
         TM    QCBFLAG-IEDQQCB(RWKA),QCBTSSES IS THIS TSO SESSIONS22028
         BZ    AUTOPOLL                 BRANCH ON NO             S22028
         TM    LCBSTICS+2,CNOIDLES      IS THIS 2260 REMOTE         TSO
         BO    CHKRESTR                 BRANCH ON YES         S22028TSO
         TM    LCBSTICS,C3270           IS THIS A 3270 TERM   S22028TSO
         BZ    AUTOPOLL                 BRANCH ON NO             S22028
         TM    LCBSTICS+1,CBISYNC       IS THIS A 3270 REMOTE    S22028
         BZ    AUTOPOLL                 BRANCH ON NO             S22028
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         TM    LCBXFLAG,LCBERPND        SOH%R PENDING?           S99228
         BO    AUTOPOLL                 BRANCH YES               S99228
         L     RWKA,TRMDESTQ-ONE        RESTORE DEST QCB ADDR    S99228
CHKRESTR EQU   *                                                 S22028
         CLI   LCBTPCD+11,X'BE'         IS START MI TO BE SENT   S22028
         BE    SNDSMI                   BRANCH ON YES            S22028
         TM    QCBTSOF2-IEDQQCB(RWKA),QCBDSSMI HAS START MI GONE S22028
         BO    AUTOPOLL                 YES, BRANCH              S22028
         MVI   LCBTPCD+11,X'BE'         SET TP CODE FOR SMI         TSO
         TM    LCBSTICS,C3270           IS THIS A 3270 TERM   S22028TSO
         BO    WRADD327                 BRANCH ON YES         S22028TSO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE        TSO
         DC    AL2(MODCCW51-MODCCW)                                 TSO
         BR    R2                       RETURN                      TSO
WRADD327 EQU   *                                              S22028TSO
         MVI   LCBMSGFM,AVTEZERO        RESET ACK COUNTER     S22028TSO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE  S22028TSO
         DC    AL2(MODCCW44-MODCCW)                           S22028TSO
SNDSMI   EQU   *                        TSO
         TM    QCBTSOF2-IEDQQCB(RWKA),QCBDSSMI HAS WCC BEEN SENT S22028
         BO    CHK3270R                 YES, BRANCH              S22028
SNDSMI1  EQU   *                                                 S22028
         LA    RTPCDE,LCBTPCD           RESET TP CODE BASE          TSO
         LA    RCCW,LCBCPA              RESET CCW AREA BASE         TSO
         ST    RCCW,LCBSTART-1          START ADDRESS FOR IOS       TSO
         OI    QCBTSOF2-IEDQQCB(RWKA),QCBDSSMI SET START MI SENT    TSO
         TM    LCBSTICS,C3270           IS THIS A 3270 TERM   S22028TSO
         BO    SNDRESTR                 BRANCH ON YES         S22028TSO
         MVI   LCBTPCD+11,AVTEZERO      RESET TP CODE               TSO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE        TSO
         DC    AL2(MODCCW90-MODCCW)                                 TSO
SNDRESTR EQU   *                                              S22028TSO
         CLI   QCBSATCT-IEDQQCB(RWKA),ZERO IS THIS LINE ZERO    SA68050
         BNE   SNDREST1                 NO, BRANCH              SA68050
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE    SA68050
         DC    AL2(MODCCW93-MODCCW)                             SA68050
         BR    R2                       RETURN                  SA68050
SNDREST1 EQU   *                                                SA68050
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE  S22028TSO
         DC    AL2(MODCCW92-MODCCW)                           S22028TSO
         BR    R2                       RETURN                S22028TSO
CHK3270R EQU   *                                                 S22028
         TM    LCBSTICS,C3270           IS THIS A 3270 TERM   S22028TSO
         BZ    SNDSMI1                  NO, BRANCH               S22028
         MVI   LCBTPCD+11,AVTEZERO      RESET TP CODE            S22028
         B     AUTOPOLL                 BRANCH                   S22028
AUTOPOLL EQU   *                                                 S22028
         BAL   RWKB,ILIST               LOCATE INVITATION LIST   S22028
.L446    ANOP                                                    S22028
         TM    3(RWKC),AUTOPL           AUTO POLL IN USE         S22028
         BZ    TRSTCTL                  BRANCH NO                S22028
         L     RWKA,LCBSCBA-1 .         GET CURRENT WCB ADDRESS
         USING IEDQSCB,RWKA
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN EXTENDED LOCK
         BM    TRSTCTL .                BRANCH YES, DON'T WANT A
*                                         DIFFERENT SOURCE TERMINAL
         DROP  RWKA
* A U T O P O L L    L I N E
         SPACE 1
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         TM    LCBXFLAG,LCBERPND        SOH%R MESSAGE PENDING?   S99228
         BO    GETSOHR                  BRANCH YES               S99228
         TM    LCBXFLAG,LCBGPCTV        GENERAL POLL IN PROGRESS?S99228
         BZ    AUTOREG                  BRANCH NO                S99228
GETSOHR  EQU   *                                                 S99228
         NI    LCBXFLAG,LCBGPSTP        RESET GENERAL POLL INDIC S99228
         BALR  RLNK1,REXPND             BRANCH TO EXPAND ROUTINE S99228
         DC    AL2(MODCCW28-MODCCW)     GENPOLL READ INIT OFFSET S99228
AUTOREG  EQU   *                                                 S99228
.L423    ANOP                                                    S99228
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW26-MODCCW)
         SPACE 2
         SPACE 2
.Z5      ANOP
* L O C A L    D E V I C E
         SPACE 1
* C O N T E N T I O N    L I N E
         SPACE 1
CONTT    EQU   *                        LEASED+DIALWITH ENABLE AND
*                                         DIAL REQUESTS.
         AIF   ('&GEN' EQ 'BISC').L19
         AIF   ('&GEN' EQ 'STSP').L20
         AIF   ('&GEN' EQ 'MINI').L21
         AIF   ('&GEN' EQ 'QTAM').L20                            A48245
         TM    LCBSTICS+1,CBISYNC       BSC DEVICE
         BZ    NOTBSC                   NO
.L19     ANOP
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW22-MODCCW)
         AIF   ('&GEN' EQ 'BISC').L22
NOTBSC   EQU   *
.L20     ANOP
         TM    LCBTSOB,LCB2741N         2741 TERM?                  TSO
         BZ    TRY2                                                 TSO
         AIF   ('&GEN' EQ 'QTAM').L201                           A48245
         TM    LCBTSOB,LCBTSBUF         TSO IN CONTROL
         BZ    ITSTCAM                  BRANCH IF NO
         SPACE
         CLI   LCBTPCD+11,X'AB'         FIRST TIME                  TSO
         BNE   NORM41                   SEND EOT NOW                TSO
         MVI   LCBTPCD+11,0             CLEAR FIRST TIME INDIC      TSO
         BALR  RLNK1,REXPND                                         TSO
         DC    AL2(MODCCW54-MODCCW)                                 TSO
         SPACE
NORM41   EQU   *                                                    TSO
         BALR  RLNK1,REXPND                                         TSO
         DC    AL2(MODCCW52-MODCCW)                                 TSO
.L201    ANOP                                                    A48245
ITSTCAM  EQU   *
         CLI   LCBTPCD+11,X'AB'         FIRST TIME
         BNE   NOTFIRST                 BRANCH NO
         MVI   LCBTPCD+11,0             RESET FIRST TIME SWITCH
         BALR  RLNK1,REXPND             LINK TO EXAPND
         DC    AL2(MODCCW21-MODCCW)
NOTFIRST EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW20-MODCCW)
         SPACE
TRY2     EQU   *                                                    TSO
.L21     ANOP
         TM    LCBSTICS+2,CWTTA         WTTA
         BZ    NOTWTTA                  NO
         BALR  RLNK1,REXPND             LINK TO EXPND
         DC    AL2(MODCCW21-MODCCW)
NOTWTTA  EQU   *
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW20-MODCCW)
.L22     ANOP
         SPACE 2
* T R A N S    O R    S T A T I O N    C T R L
         SPACE 1
TRSTCTL  EQU   *                        STNCTL+DIAL LINE WITH ENAB
*                                         AND DIAL REQUESTS
         AIF   ('&GEN' EQ 'MINI').L22A
         AIF   ('&GEN' EQ 'QTAM').L22A
         AIF   ('&GEN' EQ 'BISC').L22A
CHK50HBN TM    LCBTSOB,LCBINHBN         ARE INHIBITS BEING USED     TSO
         BZ    STCTLC                   BRANCH ON NO                TSO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE        TSO
         DC    AL2(MODCCW91-MODCCW)                                 TSO
STCTLC   EQU   *                                                    TSO
.L22A    ANOP
         AIF   ('&GEN' EQ 'MINI').L433                          OY03846
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         NI    LCBXFLAG,LCBGPSTP        RESET GENERAL POLL INDIC S99228
.L433    ANOP                                                    S99228
         BALR  RLNK1,REXPND             GO TO EXPAND RTNE
         DC    AL2(MODCCW28-MODCCW)
         SPACE
         AIF   ('&GEN' EQ 'MINI').LE
         AIF   ('&GEN' EQ 'BISC').LE
         AIF   ('&GEN' EQ 'QTAM').LE
SPEC41   EQU   *                                                    TSO
         MVC   LCBSTICS,D41STICS        RESET CH'STICS              TSO
         MVI   LCBTPCD+10,X'AE'         SPECIAL CHECK INDICATOR     TSO
         BALR  RLNK1,REXPND             BUILD CCW'S                 TSO
         DC    AL2(MODCCW70-MODCCW)                                 TSO
.LE      ANOP
         EJECT
*
*
*        R E A D  C O N T I N U E   L O G I C
*
*
         SPACE 3
CONTINUE EQU   *
         XI    LCBSTAT1,LCBCONT         RESET CONTINUE INDICATOR
         NI    LCBSTAT2,AVTEFF-LCBRESP  RESET RESPONSE BIT
         L     RWKA,LCBCPA+12           OCNINUTE CCW
         MVC   0(8,RWKA),LCBCPA+16      REBUILD BUFFER CCW
         NI    CCWFLAGS-CCW(RWKA),AVTEFF-CCWSLI SWITCH FOR LINE END
*                                       UNIT HAS WRAPPED VIA PCI
         LA    RCCW,LCBCPA+16           CONTINUE POINT
         LA    RTPCDE,LCBTPCD+2         TP OP CODE BASE
         NI    LCBMSGFM,LCBNAK+LCBACKI+LCBEOT+LCBOLT RESET FLAGS S22025
         TM    LCBCHAIN,LCBABRTN        ABORT REQUEST
         BZ    NOABORT                  NO
         AIF   ('&GEN' EQ 'BISC').L80
         L     RWKA,DCBSCTAD-1          GET SCT ADDRESS
         CLI   AVTEZERO(RWKA),AVTEZERO  EOT SEQUENCE DEFINED
         BE    ABRTEXIT                 BRANCH IF NO
         SPACE
.L80     ANOP
         L     RWKA,LCBSCBA-1           CURRENT SCB
         USING IEDQSCB,RWKA             SCB REGISTER            SA59034
         NI    SCBBSCFM,AVTEFF-SCBNOEOT RESET EOT FLAG          SA59034
         AIF   ('&GEN' NE '' AND '&GEN' NE 'BISC').L80A          S22025
         TM    LCBMSGFM,LCBEOT .        RVI REQUEST              S22025
         BO    NOABORT                  BRANCH YES               S22025
.L80A    ANOP                                                    S22025
         BALR  RLNK1,REXPND             BUILD SEQUENCE
         DC    AL2(MODCCW72-MODCCW)
         BR    R2                       RETURN
         SPACE
NOABORT  EQU   *
         TM    LCBSTATE,LCBRECVN        READ CONTINUE
         BZ    SEND                     NO WRITE CONTINUE
         SPACE
         AIF   ('&GEN' NE '').L23
         TM    LCBSTAT2,LCBSYNC         BSC LINE
         BZ    NOBSC1                   NO
.L23     ANOP
         AIF   ('&GEN' EQ 'MINI').L24
         AIF   ('&GEN' EQ 'STSP').L24
         AIF   ('&GEN' EQ 'QTAM').L24
         SPACE
         L     RWKA,LCBSCBA-1           CURRENT SCB
         TM    SCBBSCFM,SCBTRNSP+SCBNONTR TYPE MSG DETERMINED YETS21101
         BZ    NOBSC1                   BRANCH NO DONT KNOW FORMAT
         L     RWKB,DCBMH-1             MH QCB ADDRES
         L     RWKC,TRMDESTQ-1  .       PICKUP DEST QCB          S22029
         DROP  RWKC                                              S99228
         USING IEDQQCB,RWKC                                      S22029
         TM    QCBDSFLG,QCBALTMH        IS TERMINAL CONNECTED TO S22029
*                                       AN ALTERNATE MH          S22029
         BZ    NOALTMH                  NO - USE OWNING MH LC    S22029
         L     RWKB,AVTEZERO(RWKB)      GET ALTERNATE MH QCB ADDRS22029
         DROP  RWKC
NOALTMH  EQU   *                        TEST FOR LC=IN OR OUT    S22029
         USING IEDQLCBX,RWKC            LCB EXTENSION ADDR       S99228
         TM    4(RWKB),LCIN             LCIN SPECIFIED
         BZ    ITSLCOUT                 NO
         TM    SCBBSCFM,SCBTRNSP .      RECEIVEING TRANSPARNET   S21101
         BZ    NOBSC1                   NO, IT'S LCIN
         DROP  RWKA
         SPACE
ITSLCOUT EQU   *
         BALR  RLNK1,REXPND             GO TO EXPAND
         DC    AL2(MODCCW45-MODCCW)
.L24     ANOP
NOBSC1   EQU   *
         AIF   ('&GEN' EQ 'BISC').Z6
         TM    LCBSTICS+2,CCHECK        CHECKING
         BNZ   TESTCONT                 YES
ABRTEXIT EQU   *
         OI    LCBCSW+3,UNEX            INDICATE NO RESTART
         BR    R2                       RETURN
TESTCONT EQU   *
         TM    LCBSTICS+2,CCONTIN       CONINUTE POSSIBLE
         BZ    NOCONT                   NO
.Z6      ANOP
         BALR  RLNK1,REXPND
         DC    AL2(MODCCW46-MODCCW)
         SPACE
NOCONT   EQU   *
         BALR  RLNK1,REXPND             BUILD SEQUENCE
         DC    AL2(MODCCW56-MODCCW)     OFFSET TO SEQUENCE
         BR    R2                       REUTRN
SEND     EQU   *
         AIF   ('&GEN' NE '').L25
         TM    LCBSTICS+1,CBISYNC       BSC DEVICE
         BZ    NBS                      NO
.L25     ANOP
         AIF   ('&GEN' EQ 'STSP').L26
         AIF   ('&GEN' EQ 'MINI').L26
         AIF   ('&GEN' EQ 'QTAM').L26
         BALR  RLNK1,REXPND
         DC    AL2(MODCCW48-MODCCW)
         BR    R2                       RETURN
.L26     ANOP
         AIF   ('&GEN' EQ 'BISC').L27
NBS      EQU   *
         SPACE 1                                                SA62991
         BALR  RLNK1,REXPND             BUILD CCW
         DC    AL2(MODCCW50-MODCCW)
.L27     ANOP
         EJECT
WRRESP   EQU   *
         TM    LCBSTICS+2,CCHECK        CPABLE OF RESPONSE
         BZ    EXRESP1                  NO
         SPACE
         LA    RCCW,LCBERCCW+8          RESET CCW BASE
         ST    RCCW,LCBSTART-1          START ADDRESS
         LA    RTPCDE,LCBTPCD+2         SET TP OP CODE BASE     SA60341
.L28     ANOP
         AIF   ('&GEN' EQ 'STSP').L29
         AIF   ('&GEN' EQ 'MINI').L29
         AIF   ('&GEN' EQ 'QTAM').L29
         TM    LCBSTAT2,LCBSYNC         BSC
         BNO   TESTNAK                  BR NO                   SA60341
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION    SA60341
         TM    LCBXFLAG,LCBGPCTV        GENR'L POLL IN PROGRESS SA60341
         BO    WRACK                    BR YES                  SA60341
         BALR  RLNK1,REXPND             GO WRITE RESET          SA60341
         DC    AL2(MODCCW72-MODCCW)     RESET MODEL CCW         SA60341
         B     EXRESP                   EXIT                    SA60341
TESTNAK  EQU   *                                                SA60341
.L29     ANOP
         SPACE
         TM    LCBMSGFM,LCBNAK .        REQUEST FOR NAK RESPONSE S21101
         BNZ   WRACK                    BR YES                  SA69649
         AIF   ('&GEN' EQ 'MINI').L443                          OY03846
         TM    LCBSTICS,CUMASK          2260 UNDER GENPOLL?      S99228
         BZ    REGRESP                  NO SEND NORMAL RESP      S99228
.L443    ANOP                                                   SA69649
WRACK    EQU   *                                                SA69649
         BALR  RLNK1,REXPND             LINK TO EXPAND RTN       S99228
         DC    AL2(MODCCW60-MODCCW)     EXPANDER OFFSET          S99228
         B     EXRESP                   SKIP SPECIFIC POLL CODE  S99228
REGRESP  EQU   *                                                 S99228
         TM    LCBSTICS+2,CCONTIN       1030 OR 1060 TERMINAL?  SA55925
         BZ      WRACK                  YES-BRANCH TO WRITE     SA55925
*                                        CIRCLE Y NOT CIRCLE A  SA55925
         AIF   ('&GEN' EQ 'BISC').L4R1
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW58-MODCCW)
.L4R1    ANOP
EXRESP   EQU   *
         TM    LCBSTAT2,LCBMSGNN        MSGGEN
         BZ    EXRESP1                  NO
         LA    RCCW,LCBCPA              SET TO CAHNGE TIC
         OI    LCBERCCW+12,CCWCD        CHANGE FLAGS
         ST    RCCW,LCBERCCW+16         SET IN CCW
         MVI   LCBERCCW+16,CCWTIC       SET COMMAND CODE
         BR    R2                       RETURN DO EXCP
EXRESP1  EQU   *
         LA    RCCW,LCBCPA+16           ESET CCW BASE
         AIF   ('&GEN' EQ 'MINI').L453                          OY03846
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         TM    LCBXFLAG,LCBGPCTV        GENERAL POLL IN PROGRESS?S99228
         BZ    INAMESS                  NO, NO SET SPEC WRITE RE S99228
         OI    LCBERCCW+12,CCWCC+CCWSLI SET FLAGS FOR NO INTRPT  S99228
         LA    RCCW,LCBCPA+32           LOAD ADDR READ RESP IN T S99228
INAMESS  EQU   *                                                 S99228
.L453    ANOP                                                    S99228
         ST    RCCW,LCBERCCW+16         SET TIC ADDRESS
         MVI   LCBERCCW+16,CCWTIC       SET COMMAND CODE
         LA    RTPCDE,LCBTPCD+2         RESET TP OP CODE BASE
         NI    LCBSTAT2,AVTEFF-LCBRESP  RESET
         LR    RWKB,R0                  RETURN ADDRESS
         BR    RWKB                     RETURN
         EJECT
*        ***************************************************
*        *                                                 *
*        *     W R I T E    I N I T I A L    L O G I C     *
*        *                                                 *
*        ***************************************************
         SPACE 3
MSGGEN   EQU   *
         LA    RCCW,LCBCPA+16           ADDJUST TO BYPASS MSGEN CCW
         LA    RTPCDE,LCBTPCD+2         ADJUST TP OP CODE BASE
         L     RWKA,LCBSCBA-1           GET SCB BASE            SA59034
         NI    SCBBSCFM-IEDQSCB(RWKA),AVTEFF-SCBNOEOT RESET EOT SA59034
*                                         FLAG TO FORCE ENQ     SA59034
         B     DIALTEST                 CONTINUE BUILDING
WRITINIT EQU   *
         LA    RCCW,LCBCPA              SET CCW BASE
         LA    RTPCDE,LCBTPCD           TP OP CODE AREA
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW30-MODCCW)
*              TIC (WRITE IDLES)
         LA    RWKA,LCBCPA              DATA DDRESS FOR TIC
         ST    RWKA,LCBCPA+8            SAVE IN TIC COMMAND
         MVI   LCBCPA+8,CCWTIC          TIC OP CODE
         LA    RTPCDE,ONE(R0,RTPCDE)    BUMP TP REGISTER
         LA    RCCW,EIGHT(R0,RCCW)      BUMP CCW BASE
         MVI   LCBCPA+12,FLAG           FLAG INDICATES WHICH WRITE
*                                       IDLES TO USE AFTER CONTACT
DIALTEST EQU   *
         AIF   ('&GEN' NE '' AND '&GEN' NE 'BISC').Z66A          S21101
*                                                                S21101
*        SCBNOEOT IS SET FOR BSC DIAL LINE WITH SEND PRIORITY BY S21101
* LINE END APPENDAGE ON OUTPUT AND BY SEND SCHEDULER WHEN BYPASSIS21101
* CONTROL TO RECEIVE SCHEDULER (ALTERNATE SEND AND RECEIVE ON BSCS21101
* DIAL LINE.  WHENEVER AN EOT IS TRANSMITTED ON A BSC LDIAL LINE S21101
* LINE MUST BE MONITORED FOR A RECEVE OPERATION.  FOR SEND PRIORIS21101
* AN EOT IS NOT SENT AT THE END OF A MESSAGE IN ORDER TO FLUSH THS21101
* OUTPUT QUEUE.  THE TERMINAL IS STILL IN TEXT MODE AND THE ACK  S21101
* COUNTER MUST NOT BE RESET.   THIS HAS A BEARING ON THE WRITE   S21101
* INITIAL CONTACT  CHANNEL PROGRAM.  THERE IS NO LINE BID        S21101
* REQUIRED.  THE CHANNEL PROGRAM WILL START ON THE WRITE ESCAPE  S21101
* SEQUENCE OR ON THEWRITE IDLES LOOP.  SCBNOEOT IS RESET IN THIS S21101
* MODULE ON A DISABLE OR BY ERP OR LINE END .  ERP OR LINE END WIS21101
* RESET THE BIT ON A TCAM OR DEVICE ABORT (I. E. AN EOT WAS SENT S21101
* OR RECEVIED.)                                                  S21101
*                                                                S21101
         NI    LCBMSGFM,LCBACKI .       RESET FORMAT BITS EXCEPT S21101
*                                         ACK COUNTER            S21101
         L     RWKA,LCBSCBA-1 .         GET SCB BASE             S21101
         USING IEDQSCB,RWKA .                                    S21101
         TM    SCBBSCFM,SCBNOEOT .      BSC DIAL SEND PRIORITY INS21101
*                                         TEXT MODE              S21101
         DROP  RWKA .                                            S21101
         BO    LETACK .                 BRANCH IF YES            S21101
         MVI   LCBMSGFM,AVTEZERO .      RESET FORMAT BITS AND ACKS21101
*                                         COUNTER                S21101
LETACK   EQU   *                                                 S21101
.Z66A    ANOP                                                    S21101
         TM    LCBSTAT2,LCBRESP         OWE A RESPOSE
         BZ    NORP                     NO
         NI    LCBSTAT2,AVTEFF-LCBRESP  RESET RESPOSNE BIT
         SPACE
         AIF   ('&GEN' NE 'BISC').Z15A
         OI    LCBSTAT1,LCBCVRSP        INDICATE CONVERSE FOR LINEND
*                                         FOR POSSIBLE ERRORS
         B     STIDLES                  START ON WRITE IDLES (MSGGEN)
         AGO   .Z15
.Z15A    ANOP
         AIF   ('&GEN' EQ 'MINI').Z15XX
         AIF   ('&GEN' EQ 'QTAM').Z15XX
         AIF   ('&GEN' EQ 'BISC').Z15XX
         TM    LCBTSOB,LCBTSBUF         IS THIS TIME SHARING BUFFER TSO
         BO    SNDRSP                   BRANCH ON YES               TSO
.Z15XX   ANOP
         CLC   LCBTTBIN,LCBTTCIN        SAME TERMINAL
         BE    OWERSP                   YES
         SPACE
SNDRSP   EQU   *
         TM    LCBSTAT2,LCBMSGNN        MSGGEN
         BNZ   OWERSP                   YES
SNDRSP1  EQU   *                                                SA55925
         BAL   R0,WRRESP                BUILD RESPO55SE
         B     NORP                     RESUME CHANNEL PROG BUILD
         SPACE
OWERSP   EQU   *
         AIF   ('&GEN' NE '').L32
         OI    LCBMSGFM,LCBACKI .       FIRST CONVERSATIONAL REPLS21101
*                                         IS ODD ACK             S21101
         TM    LCBSTAT2,LCBSYNC         BSC
         BNZ   STIDLES                  BRANCH YES
.L32     ANOP
         TM    LCBSTICS+2,CNOIDLES      IS THIS 2260 REMOTE
         BO    TSMSGN                   BRANCH ON YES
         TM    LCBSTICS+2,C2760         2760
         BO    STIDLES                  YES, START ON DILESOR MSGGEN
         SPACE
         TM    LCBSTICS+2,CCONTIN       CAPABLE OF RESPONS
         BZ    SNDRSP1                  BRANCH IF NOT           SA55925
         BALR  RLNK1,REXPND             WR EOA AND TIC
         DC    AL2(MODCCW62-MODCCW)
         SPACE
.Z15     ANOP
         AIF   ('&GEN' EQ 'MINI').L35
NORP     EQU   *
         TM    LCBSTAT2,LCBDIAL         DIAL LINE
         BZ    WRLSD                    NO, LEASED LINE
         SPACE 3
********       D I A L    L I N E S      ********
         SPACE 2
         CLI   LCBTSTSW,AVTEFF          THIS A DIAL UP REQUEST
         MVI   LCBTSTSW,F0              RESET FOR SUBSEQUENT SNED
         AIF   ('&GEN' NE 'BISC').LI2A
         BNE   WRLSD
         AGO   .LI1
.LI2A    ANOP
         BNE   NODIALUP                 NO
         AIF   ('&GEN' EQ 'BISC').LI1
         AIF   ('&GEN' NE '').LI2
         TM    LCBSTAT2,LCBSYNC        BSC LINE
         BZ    NOSYNC                  NO
.LI1     ANOP
         L     RWKA,LCBSCBA-1 .         GET SCB POINTER          S21101
         USING IEDQSCB,RWKA .                                    S21101
         NI    SCBBSCFM,AVTEFF-SCBNOEOT RESET EOT FLAG           S21101
         DROP  RWKA .                                            S21101
         MVI   LCBMSGFM,AVTEZERO .      RESET ALL BITS           S21101
         TM    LCBTPCD+11,DISDLEOT .    WRITE DLE EOT            S21101
         BO    GODLEEOT .               YES                      S21101
         OI    LCBTPCD+11,DISDLEOT      SET FOR THE NEXT TIME   SA53632
*                                         SO AS TO WRITE ABORT  SA53632
*                                         SEQUENCE BEFORE DISAB SA53632
         LA    RTPCDE,ONE(,RTPCDE) .    ADJUST TP CODE BASE      S21101
         LA    RCCW,EIGHT(,RCCW) .      ADJUST CCW BASE          S21101
         ST    RCCW,LCBSTART-1 .        SET START ADDRESS        S21101
         B     NOSYNC .                 CONTINUE                 S21101
GODLEEOT EQU   * .                                               S21101
         BALR  RLNK1,REXPND            LINK TO EXPAND
         DC    AL2(MODCCW01-MODCCW)
         B     NEXTCCW
NOSYNC   EQU   *
.LI2     ANOP
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW02-MODCCW)
NEXTCCW  EQU   *
         AIF   ('&GEN' EQ 'BISC').L36
         TM    LCBSTICS+1,CTWX          TWX
         BZ    NOTTWX
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW32-MODCCW)
         BR    R2                       RETURN
NOTTWX   EQU   *
         AIF   ('&GEN' EQ 'STSP').L37
         AIF   ('&GEN' EQ 'QTAM').L37
         TM    LCBSTICS+1,CBISYNC
         BZ    STSTOP
.L36     ANOP
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         CLI   IDLOC+1(RWKC),AVTEZERO   ANY ID'S FOR CPU
         BE    NOID                     BRANCHNO
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW14-MODCCW)
         B     ENDTEST                  CONTINUE IN LINE TESTING
NOID     EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW15-MODCCW)
ENDTEST  EQU   *
         TM    LCBSTICS+2,CENDCTL       END/END CONTROL
         BNZ   ENDCTL                   BRANCH IF END-END CTL
         SH    RCCW,H8                  BAK UP TO PREVIOUX
         OI    CCWFLAGS,CCWSLI          SET FLAG FOR APPENDAGE
         BR    R2                       RETURN
ENDCTL   EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW41-MODCCW)
         BR    R2                       RETURN
.L37     ANOP
         AIF   ('&GEN' EQ 'BISC').L35
STSTOP   EQU   *
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW36-MODCCW)
         TM    LCBSTICS+1,CSTNCTL       STATION CONTROL
         BO    WRMLPT                   BRANCH YES
NODIALUP EQU   *
         TM    LCBSTICS+1,CTWX          TWX
         BZ    WRLSD                    NO
         NI    LCBSTICS+1,AVTEFF-CTWX   TURNOFF TWX BIT
*                                         BUFFERS WILL BE POSTED
*                                         TO MH BY ACTIVATE
.L35     ANOP
         AIF   ('&GEN' NE 'BISC').M6
OWERSP   EQU   *
.M6      ANOP
STIDLES  EQU   *
         LA    RWKA,LCBCPA              WRITE IDLES ADDRESS
         ST    RWKA,LCBSTART-1          SET IOS PARAMETER
         BR    R2                       RETURN
         SPACE 3
*********      L E A S E D    L I N E S        *********
         SPACE 2
         AIF   ('&GEN' NE 'MINI').N1
NORP     EQU   *
         NI    LCBSTAT2,AVTEFF-LCBRESP
.N1      ANOP
WRLSD    EQU   *
         TM    LCBSTICS+1,CLOCAL+CAUDIO LOCAL OR AUDIO
         BZ    NOAUD                    NO
         MVC   LCBTTCIN,LCBTTBIN        SET CONNECTION DESIRED
TSMSGN   EQU   *
         TM    LCBSTAT2,LCBMSGNN        MSGGEN
         BZ    NOTMSGN                  NO
         LA    RCCW,LCBCPA              START POINT
         ST    RCCW,LCBSTART-1          START OF CHAN PROG
         AIF   ('&GEN' EQ 'BISC').TS11                          OY03846
         AIF   ('&GEN' EQ 'MINI').TS11                           A48276
         TM    LCBSTICS+2,CNOIDLES      IS IT 2260R              A48276
         BO    TSRESP                   IF SO, BUILD ACK RESP    A48276
.TS11    ANOP                                                    A48276
         BR    R2                       RETURN
NOTMSGN  EQU   *
*        SIMULATE 'ADDRESSING' SEQUENCE FOR 2260 LOCAL FOR SCREEN
* TO MODIFY  WRITE COMMAND.
         AIF   ('&GEN' EQ 'MINI').L4R6                          OY03846
         TM    LCBSTICS,C3270           3270 DEVICE?             S99228
         BZ    NOL3270                  BRANCH NO                S99228
         TM    LCBSTICS+ONE,CLOCAL      LOCAL DEVICE?            S99228
         BZ    NOL3270                  BRANCH NO                S99228
         OI    LCBCHAIN,LCBEXCP         EXCP AT ASSOCIATION      S99228
         OI    LCBCPA+12,CPAEXCP        LCBSTART AT LCBCPA+16    S99228
         LA    RCCW,LCBCPA+16           SET CCW ADDR             S99228
         BALR  RLNK1,REXPND             LINK TO EXPAND           S99228
         DC    AL2(MODCCW74-MODCCW)     3270 LOCAL WRITE CH PGM  S99228
         BR    R2                       RETURN TO ACTIVATE       S99228
NOL3270  EQU   *                                                 S99228
.L4R6    ANOP
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW29-MODCCW)
         OI    LCBCHAIN,LCBEXCP         DO EXCP AT ASSOCIAION
         BR    R2 .                     RETURN TO ACTIVATE       A41027
NOAUD    EQU   *
         TM    LCBSTICS+1,CCONTENT+CXMITCTL CONTENTION OR XMITCTL
         BZ    WRMLPT
         SPACE 2
* C O N T E N T I O N    L I N E
         SPACE 1
         AIF   ('&GEN' NE '').L38
         TM    LCBSTICS+1,CBISYNC       BSC DEVICE
         BZ    NOBSCCT
.L38     ANOP
         AIF   ('&GEN' EQ 'STSP').L39
         AIF   ('&GEN' EQ 'MINI').L41
         AIF   ('&GEN' EQ 'QTAM').L39
         L     RWKA,LCBSCBA-1           GET SCB POINTER          S21101
         USING IEDQSCB,RWKA .                                    S21101
         TM    SCBBSCFM,SCBNOEOT .      DIAL WITH SEND PRIORITY  S21101
*                                         IN TEXT MODE           S21101
         DROP  RWKA .                                            S21101
         BZ    NOTEOT .                 BRANCH IF NO             S21101
         SPACE 1                                                 S21101
         TM    LCBSTICS+2,CENDCTL .     END TO END CONTROLS      S21101
         BO    ENDCTL .                 BRANCH IF YES TO BUILD   S21101
*                                         WRITE ESCAPE  AND READ S21101
         SPACE 1                                                 S21101
         OI    LCBSTAT2,LCBRESP .       SET FOR ACTIVATE TO POST S21101
*                                         BUFFERS.  THERE IS NO  S21101
*                                         SELECTION SEQUENCE.    S21101
         B     STIDLES .                START ON WRITE SYNS      S21101
         SPACE 2                                                 S21101
NOTEOT   EQU   *                                                 S21101
         TM    LCBSTICS+2,CENDCTL       END - END CONTROLS
         BZ    ITSCPU                   NO, MUST BE CPU
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW40-MODCCW)
         BR    R2                       RETURN
         SPACE
ITSCPU   EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW43-MODCCW)
         BR    R2                       RETURN
.L39     ANOP
         AIF   ('&GEN' EQ 'BISC').L40
NOBSCCT  EQU   *
         TM    LCBSTICS+2,CWTTA         WORLD TRADE
         BZ    NOWTTA                   BR NO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW42-MODCCW)
NOWTTA   EQU   *
         TM    LCBTSOB,LCB2741N         SEE IF 2741 TERM            TSO
         BZ    NOTS                     BRANCH NO
         TM    LCBTSOB,LCBCIRCD         CIRCLE D SENT LAST          TSO
         BO    TSNOD                                                TSO
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW38-MODCCW)
         SPACE 2
.L41     ANOP
NOTS     EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW39-MODCCW)
         AIF   ('&GEN' EQ 'MINI').L40
TSNOD    EQU   *                                                    TSO
         LA    RWKA,LCBCPA              START I/O ON IDLES          TSO
         ST    RWKA,LCBSTART-1                                      TSO
         BR    R2                                                   TSO
         SPACE
.L40     ANOP
* M U L T I P O I N T    L I N E
         SPACE 1
WRMLPT   EQU   *                        LEASED +DIAL-2740,1050
         AIF   ('&GEN' EQ 'MINI').L40A                           S22026
         AIF   ('&GEN' EQ 'STSP').L40A                           S22026
         AIF   ('&GEN' EQ 'QTAM').L40A                           S22026
         TM    LCBSTICS+1,CBRDCAST .   FAST SELECT ?             S22026
         BNO   NOFSTSEL .              BRANCH NO                 S22026
         BALR  RLNK1,REXPND .          GO TO EXPAND              S22026
         DC    AL2(MODCCWFS-MODCCW) .                            S22026
NOFSTSEL EQU   * .                                               S22026
.L40A    ANOP                                                    S22026
         TM    LCBSTICS+2,CNOIDLES      NO IDLES DEFINED
         BNZ   ITSTV                    BRANCH YES
         AIF   ('&GEN' EQ 'BISC' OR '&GEN' EQ 'STSP').L40B      SA69087
         AIF   ('&GEN' EQ 'MINI' OR '&GEN' EQ 'QTAM').L40B      SA69087
         TM    LCBSTAT2,LCBSYNC         BSC ?                   SA69087
         BZ    NTSOBSC                  NO, NOT BI-SYNC         SA69087
         MVI   LCBTPCD+11,0             RESET WCC FLAG IF ON    SA69087
NTSOBSC  EQU   *                                                SA69087
.L40B    ANOP                                                   SA69087
         BALR  RLNK1,REXPND             GO TO EXPAND ROUTINE
         DC    AL2(MODCCW44-MODCCW)
ITSTV    EQU   *
         BALR  RLNK1,REXPND             LINK TO EXPAND
         DC    AL2(MODCCW51-MODCCW)
         OI    LCBCHAIN,LCBEXCP         EXCP TO BE DONE LATER
         AIF   ('&GEN' EQ 'BISC').TS12                          OY03846
         AIF   ('&GEN' EQ 'MINI').TS12                           A48276
*  CAN GET HERE FOR MSGGEN RESP ON 2260R. MAKE SURE IS MSGGEN    A48276
* BECAUSE CAN GET HERE FOR ANY 2260R WRITE.                      A48276
         TM    LCBSTAT2,LCBMSGNN        IS IT A MSGGEN           A48276
         BCR   8,R2                     BR NO. DO NOT WANT RESP  A48276
*                                       TO NON-MSGGEN WRITES     A48276
TSRESP   EQU   *                                                 A48276
         LA    RCCW,LCBERCCW+12         RESPONSE AREA FOR 2260R  A48276
*                                       MSGGEN MESSAGES          A48276
         ST    RCCW,LCBCPA+48           READ AREA FOR RESPONSE   A48276
         MVI   LCBCPA+48,CCWREAD        READ COMMAND             A48276
         LA    RCCW,2                   READ COUNT               A48276
         ST    RCCW,LCBCPA+52           COUNT TO CCW             A48276
         MVI   LCBTPCD+6,TPRSPMG        RESP MSG INDEX           A48276
         LA    RCCW,LCBCPA+48           FOR TIC TO RESP          A48276
         ST    RCCW,LCBCPA+8            FOLLOW MSGGEN WRITE      A48276
         MVI   LCBCPA+8,CCWTIC          STORE TIC                A48276
         MVI   LCBCPA+4,CCWCC           COMMAND CHAIN            A18276
.TS12    ANOP                                                    A48276
         BR    R2                       RETURN
         EJECT
*
*        *****************************************
*        *                                       *
*        *     E X P A N D    R O U T I N E      *
*        *****************************************
         SPACE 1
*        THIS ROUTINE EXPAND THE SUBSET OF CHANNEL PROGRAM PROVIDED
*              FIRST  - BUILD CCW IN CHANNEL PROGRAM AREA(LCBCPA).
*              SECOND - SET-UP TP CODE IN LCBTPCD.
         SPACE 2
EXPAND   DS    0H
         LA    RMOD,MODCCW              LOAD MODEL CHAN PROG TABLE AD.
         AH    RMOD,0(RLNK1)            ADD OFFSET
EXLOOP0  EQU   *
         LA    REXPND,EXPAND            REATORE REXPND REGISTER
         CLI   0(RMOD),X'FF'            END OF SUBSET
         BE    2(RLNK1)                 YES,RETURN
         LA    REXPND,EXPRTN            SET-UP RETURN ADDRESS
         SR    RWKB,RWKB                CLEAR WORK REGISTER
         SR    RWKA,RWKA                CLEAR REGISTER
         STM   RWKA,RWKB,CCW            CLEAR CCW
         IC    RWKA,0(RMOD)             OFFSET IN EXPANDEER TABLE
         LH    RWKA,ORGTB1(RWKA)        GET OFFSET FOR EXPANDER ROUTINE
         B     ORGRTN(RWKA)             AND BRANCH
*
* RETURN HER FROM EXPANDER ROUTINES
* RWKA CONTAINS THE CCW DATA ADDRESS
*
EXPRTN   EQU   *
         ST    RWKA,CCWADDR-1           SET DATA ADDRES
         SR    RWKB,RWKB                CLEAR REGISTER
         IC    RWKB,0(RMOD)             OFFSET IN EXPANDER TABLE
         IC    RWKA,ORGTB1+2(RWKB)      PICK-UP OP CODE
         STC   RWKA,CCWOPCDE            AND STORE IT
EXPRTN0  EQU   *                                                SA57685
         MVC   CCWFLAGS(1),1(RMOD)      YES, SET PROVIDED FLAGS
*
* SET-UP TP CODE IN LCB(LCBTPCD)
*        FOR EACH CCW A TP CODE IS REQUIRED
*
         IC    RWKB,ORGTB1+3(RWKB)      PICK-UP TP CODE
         STC   RWKB,ZERO(R0,RTPCDE)     SET TP OP CODE
         LA    RTPCDE,ONE(R0,RTPCDE)    BUMP TP OP CODE POINTER
         LA    RCCW,EIGHT(R0,RCCW)      BUMP CCW BASE
*
* RETURN HERE FROM EXPANDER ROUTINES WHEN NO EXPAND IS REQUIRED
*
         LA    RMOD,TWO(R0,RMOD)        POINT TO NEXT INTRY
         B     EXLOOP0                  BUILD NEXT CCW
         EJECT
*
*        E X P A N D E R    R O U T I N E S
*        THE FUCTION OF THE EXPANDER ROUTINES IS ...
*              - SET THE COUNT IN THE CCW
*              - LOAD THE CCW DATA ADDRESS IN RWKA
*              - RETURN TO THE EXPAND ROUTINE (EXPRTN)
*
         SPACE 3
ORGRTN   DS    0H
         SPACE 2
*        SENSE EXPANDER
*        EXPANDERS FOR ANY VALID ADDRESS
NOPRT    EQU   *
PREPRT   EQU   *
RDSKPRT  EQU   *
DISBLRT  EQU   *
ENABLRT  EQU   *
SNSRT    EQU   *
         LA    RWKA,LCBCSWSV            SET SENSE FIELD
         MVI   LCBCSWSV,AVTEFF          INITIALIZE SENSE BYTE     M1582
         MVI   CCWCOUNT+1,X'01'         SET COUNT=1
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
         SPACE 2
*        WRITE SPECIAL CHARACTERS EXPANDER
WRACKRT  EQU   *
         TM    LCBMSGFM,LCBNAK .        NAK REQUEST              S21101
         BO    WRNACKRT            IF YES, TAKE BRANCH
         SPACE
         AIF   ('&GEN' EQ 'STSP' OR '&GEN' EQ 'MINI').Z10
         AIF   ('&GEN' EQ 'QTAM').Z10
         XI    LCBMSGFM,LCBACKI .       FLIP ACK COUNTER         S21101
         TM    LCBCHAIN,LCBABRTN .      ABROT REQUEST FOR RVI    S22025
         BO    ITSRVI .                 BRANCH IF YES            S22025
         TM    LCBMSGFM,LCBACKI .       IF ON, WRITE ACK-0       S21101
         BNZ   ACK0                     BRANCH IF ACK0 REQUEST
.Z10     ANOP
         B     ACK1                     MUST BE ACK 1
         SPACE
         AIF   ('&GEN' EQ 'STSP' OR '&GEN' EQ 'MINI').Z11
         AIF   ('&GEN' EQ 'QTAM').Z11
WRDLETRT EQU   *
         LA    RWKB,1(,RWKB) .          INDEX INTO TABLE         S22025
ITSRVI   EQU   * .                                               S22025
         LA    RWKB,8(,RWKB) .          INDEX INTO TABLE         S22025
WRENQRT  EQU   *
         LA    RWKB,1(,RWKB)
.Z11     ANOP
WRNACKRT EQU   *
         NI    LCBCHAIN,AVTEFF-LCBABRTN RESET ABORT REQUEST      S22025
         NI    LCBMSGFM,X'FF'-LCBNAK-LCBEOT RESET FLAGS          S22025
         LA    RWKB,1(RWKB)
ACK1     EQU   *
         LA    RWKB,1(,RWKB)
ACK0     EQU   *
         LA    RWKB,1(RWKB)
WRIDLRT  EQU   *
         LA    RWKB,1(RWKB)
WRPADRT  EQU   *
         LA    RWKB,1(RWKB)
         AIF   ('&GEN' EQ 'MINI').R65XX
         AIF   ('&GEN' EQ 'QTAM').R65XX
         AIF   ('&GEN' EQ 'BISC').R65XX
         B     SKPCHK                                               TSO
.R65XX   ANOP
WREOART  EQU   *
         AIF   ('&GEN' EQ 'MINI').R66XX
         AIF   ('&GEN' EQ 'QTAM').R66XX
         AIF   ('&GEN' EQ 'BISC').R66XX
         TM    LCBTSOB,LCBTSBUF         IS THIS TIME SHARING BUFFER TSO
         BZ    SKPCHK                   BRANCH ON NO                TSO
         TM    LCBSTICS+2,CNOIDLES      IS THIS 2260 REMOTE         TSO
         BO    WREOTRT                  BRANCH ON YES               TSO
SKPCHK   EQU   *                                                    TSO
.R66XX   ANOP
         LA    RWKB,1(RWKB)
WREOTRT  EQU   *
         L     RWKA,DCBSCTAD-1          ADDR OF SPEC CHAR TABLE
         IC    RWKB,0(RWKA,RWKB)        PICK-UP OFFSET
         AR    RWKA,RWKB                POINT TO CURRENT ENTRY
         MVC   CCWCOUNT+1(1),0(RWKA)    MOVE COUNT IN CCW
         LA    RWKA,1(RWKA)             SET-UP DATA ADDRESS
         AIF   ('&GEN' EQ 'BISC').L65
         AIF   ('&GEN' EQ 'MINI').L65
         CLI   0(RWKA),X'1F'            SENDING EOT                 TSO
         BNE   TSLV                     NO                          TSO
         TM    LCBSTICS,C2741           2741 TERM                   TSO
         BZ    TSLV                     NO                          TSO
         MVI   CCWCOUNT+1,X'01'         1 EOT 6OR 2741              TSO
TSLV     EQU   *                                                    TSO
.L65     ANOP
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
*        WRITE POLLING CHARACTERS EXPANDER
WRPOLRT  EQU   *
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         IC    RWKA,TWO(,RWKC)          SIZE OF EACH ENTRY
         BCTR  RWKA,0                   DECREMENT FOR INDEX BYTE
         STC   RWKA,CCWCOUNT+1          SET CCWC OUNT
         AIF   ('&GEN' EQ 'STSP' OR '&GEN' EQ 'MINI').L463       S99228
         AIF   ('&GEN' EQ 'QTAM').L463                           S99228
         BAL   RWKB,GLCBXA              LOCATE LCB EXTENSION     S99228
         TM    LCBXFLAG,LCBERPND        SOH%R MESSAGE PENDING?   S99228
         BZ    STANDARD                 BRANCH NO                S99228
         NI    LCBXFLAG,LCBERSTP        RESET ERP POLL INDIC     S99228
         L     RWKA,LCBXRADR            LOAD ERP POLL CHAR ADDR  S99228
         BR    REXPND                   RETURN TO EXPAND ROUTINE S99228
STANDARD EQU   *                                                 S99228
.L463    ANOP                                                    S99228
         L     RWKA,LCBINVPT-ONE        LOAD CURRENT ENTRY ADDR  S99228
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
*        READ RESPONSE EXPANDER
*            READ IN BUFFER FOR RECEIVING
*            READ IN LCBERCCW FOR SENDING
RDRSPSRT EQU   *
         MVI   CCWCOUNT+1,9             SET RESONSE COUNT
         LA    RWKA,LCBERCCW+12         RESPONSE AREA
         BR    REXPND             RETURN TO EXPAND ROUTINE
RDRSPRT  EQU   *
         L     RWKC,LCBLSPCI-1          GET HEADER BUFFER ADDRESS
         LH    RWKA,PRFCOUNT-IEDQPRF(,RWKC) ^ET ORIGINAL COUNT
         LA    RWKB,2                   ASSUME TWO CHARACTER RESP
*                                         (FOR NON 2260 LOCAL)
         TM    LCBTSOB,LCBTSBUF .       IS IT TSO                   TSO
         BZ    TS2260 .                 BR IF NO                    TSO
         TM    LCBTSOB,LCB2741N .       IS IT A 2741                TSO
         BO    TS2741 .                 BR IF YES                   TSO
         TM    LCBSTICS+1,CTWX .        IS IT TWX                   TSO
         BO    TS2741 .                 BR IF YES                   TSO
TS2260   EQU   *
*
         TM    LCBSTICS+1,CLOCAL        2260 LOCAL
         BZ    NOTALOC                  BRANCH IF NOT 2260 LOCAL
         TM    LCBTSOB,LCBTSBUF .       IS THIS TSO LOCAL
         BZ    TS2741 .                 BRANCH NO
         BCTR  RWKB,0 .                 YES. NO READ RESPONSE
         SPACE
TS2741   EQU   *
         BCTR  RWKB,0                   ADJUST TO ONE CHARACTER
NOTALOC  EQU   *
         AIF   ('&GEN' EQ 'QTAM' OR '&GEN' EQ 'MINI').L473       S99228
.L473    ANOP                                                    S99228
         SR    RWKA,RWKB                ADJUST ORIGINAL COUNT
         STH   RWKA,PRFCOUNT-IEDQPRF(,RWKC) RESET BUFFER COUNT
         L     RWKA,PRFIOADR-1-IEDQPRF(,RWKC) DATA ADDESS
         AR    RWKA,RWKB                BUMP BUFFER DATA ADDRESS
         ST    RWKA,PRFIOADR-1-IEDQPRF(,RWKC) REST BUFFER ADATA ADDR
         SR    RWKA,RWKB                BACK TO ORIGINAL DATA ADDRESS
*                                         FOR READ RESPONSE
         STC   RWKB,CCWCOUNT+1          SET READ RESPONSE COUNT
*                                         2260 LOCAL ALLOW ONE CHAR
*                                         MESSAGE
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
*        RETURN TO ACTIVATE
*            TIC BUFFER FOR READ OP
*            TIC WRITE IDLE FOR WRITE OP
TCCONRT  EQU   *
         L     RWKA,LCBCPA+12           RESTART CCW
         B     LEAVE                    EXIT
         SPACE 2
TCBUFRT  EQU   *
         L     RWKA,LCBLSPCI-1          BUFFER ADDRESS
         AIF   ('&GEN' EQ 'MINI').L66                             M6293
         AIF   ('&GEN' EQ 'STSP').L66                             M6293
         AIF   ('&GEN' EQ 'QTAM').L66                             M6293
         TM    LCBSTAT2,LCBSYNC .       IS THIS A BISYNC LINE     M6293
         BNO   NOTSYNC .                BRANCH, IF NOT            M6293
* FOR BISYNC LINES, IF AUTOPOLL, THE AUTOPOLL INDEX BYTE SHOULD   M6293
* ALWAYS BE REMOVED SINCE THE EOA STRING IS ALWAYS PRESENT.  IF   M6293
* LC=OUT IS SPECIFIED, THE EOA CHARACTERS WILL BE REMOVED BY LINE M6293
* APPENDAGE IN THE SCAN ROUTINE.                                  M6293
         CLI   LCBCPA+24,CCWPOLL .      IS THIS LINE AUTOPOLL     M6293
         BE    ADDIDLE .                BRANCH IF SO              M6293
         B     RETACT .                 DO NOT REMOVE INDEX       M6293
NOTSYNC  EQU   * .                                                M6293
         AIF   ('&GEN' EQ 'BISC').L67A                            M6293
         SPACE
         L     RWKC,TRMDESTQ-1          PICK UP DEST QCB         S22029
         DROP  RWKC
         USING IEDQQCB,RWKC
         TM    QCBDSFLG,QCBALTMH        IS TERMINAL CONNECTED TO S22029
*                                       AN ALTERNATE MH          S22029
         BZ    USEOWNMH                 NO - USE OWNING MH LC    S22029
         DROP  RWKC
         L     RWKC,DCBMH-1             GET MH QCB               S22029
         L     RWKC,AVTEZERO(RWKC)      GET ALTERNATE MH QCB     S22029
         B     LCTEST                   CHECK FOR LC=IN OR OUT   S22029
         USING IEDQLCBX,RWKC            LCB EXTENSION ADDR       S99228
.L66     ANOP                                                    S22029
USEOWNMH L     RWKC,DCBMH-1             GET MH QCB               S22029
LCTEST   TM    FOUR(RWKC),LCIN          LC=IN SPECIFIED          S22029
         BO    RETACT                   YES                      S22029
         TM    LCBSTICS+1,CCONTENT+CTWX+CLOCAL+CAUDIO NONEOA DEVICE
         BNZ   RETACT                   BRANCH IF YES
         TM    LCBSTICS+2,CNOIDLES      2260 REMOTE             SA64363
         BO    RETACT                   BR YES, DON'T BUMP IDLESSA64363
         L     RWKC,DCBSCTAD-1          GET SCT ADDRESS
         IC    RWKB,1(RWKC)             GET EOA OFFSET
         AR    RWKC,RWKB                POINT TO START OF SEQUENCE
         CLI   0(RWKC),X'01'            COUNT OF 1 MEANS A HARDWARE
*                                         GENERATED SEQUENCE TO BE
*                                         REMOVED
         BNE   RETACT                   LESS THAN OR MORE THAN ONE
*                                       CHAR, DON'T ADJUST IDLES
.L67A    ANOP                                                     M6293
ADDIDLE  EQU   *
         IC    RWKB,LCBISZE             IDLES RESERVED
         LA    RWKB,1(,RWKB)            BUMP IDLES COUNT
         STC   RWKB,LCBISZE             SET IN LCB
RETACT   EQU   *
         IC    RWKB,LCBISZE             GET NUMBER OF IDLES
         LA    RWKB,PRFSHDR-PRFSUNIT(,RWKB) IDLES +PREFIX SIZE
         STH   RWKB,PRFSIZE-IEDQPRF(RWKA) PRE SET PREFIX SIZE
LEAVE    EQU   *
         TM    LCBSTICS+1,CLOCAL        LOCAL CEVICE
         BZ    NOLOCL                   NO
         TM    LCBSTICS,C3270           3270 DEVICE?             S99228
         BO    NOLOCL                   BRANCH YES               S99228
         L     RWKB,LCBINVPT-1          INVITATION ENTRY
         MVC   LCBCPA+16(1),0(RWKB)     SET MODIFIED READ
NOLOCL   EQU   *
         ST    RWKA,CCWADDR-1
         MVI   CCWOPCDE,CCWTIC          SET TIC OP CODE
         BR    R2                       RETURN TO ACTIVATE ROUTINE
         SPACE 2
TCIDLRT  EQU   *
         LA    RWKA,LCBCPA              WRITE IDLES LOCATION
         B     NOLOCL                   USE COMMON EXIT
         SPACE 3
         AIF   ('&GEN' EQ 'MINI').Z12
*        POLL EXPANDER
POLLRT   EQU   *                        BUILD POLL COMMANDS FOR
*                                         ALL AUTOPOLL
         BAL   RWKB,ILIST               FIND LILIST ADDRESS
         IC    RWKA,ONE(,RWKC)          NO. OF ACTIVE ENTIRES
         LR    RWKB,RWKA                CLEAR REG EXCEPT LO-ORDER
         IC    RWKB,TWO(,RWKC)          SIZE OF EACH ENTRY
         MR    RWKB-1,RWKA              PRODUCT OF SIZE AND NUMBER
         AIF   ('&GEN' NE '').L68
         TM    LCBSTAT2,LCBSYNC         BSC LINE
         BZ    STSP                     BRANCH NO
.L68     ANOP
         AIF   ('&GEN' EQ 'STSP').L69
         AIF   ('&GEN' EQ 'QTAM').L69
         SPACE
         LA    RWKB,1(,RWKB)            ADJUST -EOT AT END OF BSC
*                                         LIST
.L69     ANOP
STSP     EQU   *
         LA    RWKA,LCBCPA+24           SET CCW ADDRESS
         CR    RWKA,RCCW                THIS FIRST POLL
         BE    FRSTPOLL                 BRANCH FIRST POLL
         SPACE
         LA    RWKA,8(,RWKC)            SAT OF ENTRIES
OUT      EQU   *
         STH   RWKB,CCWCOUNT            SET COUNT
         BR    REXPND                   REUTR TO EXPAND
         SPACE
FRSTPOLL EQU   *
         L     RWKA,LCBINVPT-1          STARTING ADDRESS
         LA    RWKB,8(RWKB,RWKC)        BUMP TO I END OF LIST
         SR    RWKB,RWKA                COUNT
         B     OUT                      USE COMMON EXIT
.Z12     ANOP
         SPACE
ILIST    EQU   *
         SR    RWKA,RWKA                CLEAR WORK REGISTER
         IC    RWKA,LCBUCBX             RLN-1
         SLL   RWKA,2                   MULTILPY BY 4
         L     RWKC,DCBINVLI(RWKA)      ILIST FOR LINE
         SR    RWKA,RWKA                CLEAR WORK REGISTER
         BR    RWKB                     RETURN
         AIF   ('&GEN' EQ 'MINI').L483                          OY03846
         SPACE 2
*        THIS SUBROUTINE LOCATES THE LCB EXTENSION ABOVE THE     S99228
*        CHANNEL PROGRAM AREA                                    S99228
         SPACE 1
GLCBXA   EQU   *                                                 S99228
         SR    RWKA,RWKA                CLEAR LENGTH REGISTER    S99228
         IC    RWKA,DCBEIOBX            INSERT LCB LENGTH        S99228
         SH    RWKA,AVTHA4              REDUCE LCB LENGTH BY     S99228
         SH    RWKA,AVTHA4              8 BYTES FOR ADDR LCB EXT S99228
         LA    RWKC,ZERO(RWKA,RLCB)     LOAD LCB EXTENSION ADDR  S99228
         BR    RWKB                     RETURN TO CALLER         S99228
.L483    ANOP                                                    S99228
         SPACE 2
         AIF   ('&GEN' EQ 'MINI').Z13
TCRDXRT  EQU   *                        READ TO READ RESINDEX-AUTOP
         LA    RWKA,T24(RCCW)           ADDR OF READ RESP
         BR    REXPND                   RETURN TO EXPAND
*        TIC EXPANDERS
TCPOLRT  EQU   *                        TIC TO POLL CCW I.E. PREV.
         MVI   CCWCOUNT+1,1             SET TIC COUNT FOR LATER NOP
         LA    RWKA,LCBCPA+48           ADDRESS OF 2ND POLL
         BR    REXPND
.Z13     ANOP
         LA    RWKA,LCBCPA              LOAD WRITE IDLE ADDRESS
         BR    REXPND                   RETURN TO EXPAND ROUTINE
TCSKPRT  EQU   *
         LA    RWKA,LCBCPA              TIC TO READ SKIP
         MVC   LCBCPA+13(3),LCBLSPCI    SET CURRENT CCW ADDRESS
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
*    WRITE ADDRESSING CHARS AND CIAL COMMANDS.
DIALRT   EQU   *
         OI    LCBTPCD+11,DISDLEOT      SET TO WRITE DISCONNECT SA61781
*                                         PRIOR TO NEXT DISABLE SA61781
WRADRRT  EQU   *
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS PRESENT
         BZ    NOOPT                    BRANCH NO
         SPACE
         IC    RWKB,TRMOPNO             SIZE OF OPTION TABLE
         LA    RWKB,3(,RWKB)            ACCOUNT FOR OFFSET AND
*                                         OPTION NUMBER
NOOPT    EQU   *
         LH    RWKC,TRMDEVFL            DEVICE FLAGS
         LTR   RWKC,RWKC                BUFSZ SPECIFIED
         BNL   NOBUFSZ                  BRANCH IF NO
         LA    RWKB,THREE(R0,RWKB)      ADJUST FOR BUFSX FIELD
NOBUFSZ  EQU   *
         LA    RWKB,TRMCHCIN+1(RWKB)    POINT TO DEVICE DEPENDENT
*                                         AREA BYPASSING OPTION S
         AIF   ('&GEN' EQ 'MINI').L71
         SLL   RWKC,17                  SHIFT DIAL BIT
         LTR   RWKC,RWKC                DIAL DIGITS PRESENT
         BNL   NODIGITS                 BRANCH NO
         SR    RWKA,RWKA                CLEAR WORK REGISTER
         IC    RWKA,ZERO(R0,RMOD)       OFFSET INTO EXPANDER TABLE
         IC    RWKA,ORGTB1+2(RWKA)      CCW OP CODE
         STC   RWKA,LCBERCCW            PUT IN WORK AREA
         IC    RWKA,ZERO(R0,RWKB)       COUNT OF DIAL OR ADDR  SEQ
         CLI   LCBERCCW,CCWDIAL         THIS A DIAL BUILD
********
* NOTE * FOLLOWING CODE IS ONLY EXECUTED WHILE SYSTEM IS ENABLED
********
         BNE   NOTDLBLD                BRANCH NO                SA57685
         STM   R0,RLNK1,AVTSAVE3       SAVE REGS                SA57685
         L     RWKC,DCBDEBAD           GET DEB                  SA57685
         IC    RWKA,LCBUCBX            RLN                      SA57685
         SLL   RWKA,2                  TIMES 4                  SA57685
         L     RWKC,DEBUCBAD-DEBNMSUB(RWKC,RWKA)   GET UCB ADRS SA57685
         TM    UCBTYP2(RWKC),AUTOCALL  AUTOCALL FEATURE         SA57685
         BO    DIALBLD                 BRANCH YES               SA57685
         MVC   WTO+22(3),UCBID(RWKC)   LINE NUMBER              SA57685
         MVI   WTO+26,C' '             SET BLANK                SA57685
         MVC   WTO+27(11),WTO+26       BLANK AREA               SA57685
         IC    RWKA,0(,RWKB)           COUNT OF DIGITS          SA57685
         BCTR  RWKA,0                  DECREMENT FOR MOVE       SA57685
         EX    RWKA,MOVEDIGT           SET DIGITS               SA57685
         OI    WTO+26,X'F0'            SET ZONE                 SA57685
         BCTR  RWKA,0                  COUNT FOR ZONE MOVE      SA57685
         EX    RWKA,MOVEZONE           SET ZONES                SA57685
WTO      WTO   'IED158I  DIAL    ,                    ',               C
               ROUTCDE=8,DESC=3                                 SA57685
         LM    R0,RLNK1,AVTSAVE3       RESTORE REGS             SA57685
         ST    RLCB,CCWADDR-1          SET VLD PROTECT CMD ADDR SA57685
         MVI   CCWOPCDE,CCWENAB        SET COMMAND              SA57685
         MVI   CCWCOUNT+1,X'01'        SET COUNT OF 1           SA57685
         SR    RWKB,RWKB               CLEAR REGISTER           SA57685
         IC    RWKB,AVTEZERO(RMOD)     OFFSET IN EXPANDER TABLE SA57685
         B     EXPRTN0                 RETURN                   SA57685
*   EXCUTED   INSTRUCTIONS                                      SA57685
MOVEDIGT MVC   WTO+26(1),1(RWKB)       SET DIAL DIGITS          SA57685
MOVEZONE MVZ   WTO+27(1),WTO+26        SET ZONE                 SA57685
NOTDLBLD EQU   *                                                SA57685
***********************************************************************
         LA    RWKB,1(RWKA,RWKB)        BUMP PAST DAIL DIGITS
DIALBLD  EQU   *
NODIGITS EQU   *
.L71     ANOP
         MVC   CCWCOUNT+1(ONE),ZERO(RWKB) SET COUNT
         ST    R2,LCBLINK-1 .           SAVE LINK REG            A50191
         TM    LCBSTICS+2,CNOIDLES .    2260 REMOTE              A50191
         BNZ   TESTCHAR .               BRANCH IF YES            A50191
NOCHAR   EQU   * .                                               A50191
         L     R2,LCBLINK-1 .           RESTORE LINK REG         A50191
         LA    RWKA,1(,RWKB)            POINT TO DEVICE CHARACTERS
         AIF   ('&GEN' EQ 'MINI').Z71XX
         AIF   ('&GEN' EQ 'QTAM').Z71XX
         AIF   ('&GEN' EQ 'BISC').Z71XX
         TM    LCBTSOB,LCBTSBUF         IS THIS TIME SHARING BUFFER TSO
         BZ    NOTS2260                 BRANCH ON NO                TSO
         TM    LCBSTICS+2,CNOIDLES      IS THIS 2260 REMOTE         TSO
         BZ    NOTS2260                 BRANCH ON NO                TSO
         CLI   0(RWKB),THREE            IS COUNT THREE              TSO
         BNE   NOTS2260                 BRANCH ON NO                TSO
         CLI   3(RWKB),X'E0'            IS SCREEN BEING ERASED      TSO
         BNE   NOTS2260                 BRANCH ON NO                TSO
         MVI   LCBTPCD+10,X'BD'         SET INDICATOR IN LCB        TSO
NOTS2260 EQU   *                                                    TSO
.Z71XX   ANOP
         BR    REXPND                   RETURN TO EXPAND
         SPACE 2
TESTCHAR EQU   * .                                               A50191
         SPACE
*        TEST FOURTH ADDRESSING CHARACTER FOR X'FF' IF 2260    * A50191
*        REMOTE.  IF YES, MOVE CORRECT CONTROL CHARACTER FOR   * A50191
*        CURRENT TRANSMISSION FROM FIRST DATA BYTE IN BUFFER.  * A50191
         SPACE
         CLI   FOUR(RWKB),AVTEFF .      CONTROL CHAR IN BUFFER   A50191
         BNE   NOCHAR .                 BRANCH IF NO             A50191
         CLI   ZERO(RWKB),FOUR .        FOUR CHARS SPECIFIED     A50191
         BNE   NOCHAR .                 BRANCH IF NO             A50191
         NC    LCBERBCH,LCBERBCH .      BUFFER IN ERB            A50191
         BZ    NOCHAR .                 BRANCH IF NO             A50191
         L     R2,LCBERBCH-1 .          GET BUFFER ADDRESS       A50191
         TM    PRFSTAT1-IEDQPRF(R2),PRFNHDRN HEADER BUFFER       A50191
         BO    NOCHAR .                 BRANCH IF NO             A50191
         TM    PRFSTAT1-IEDQPRF(R2),PRFCNCLN CANCELLED MESSAGE   A50191
         BO    NOCHAR .                 BRANCH IF YES            A50191
         TM    LCBSTAT2,LCBMSGNN .      MSGGEN MESSAGE           A50191
         BO    NOCHAR .                 BRANCH IF YES            A50191
         SR    RWKC,RWKC .              CLEAR WORK REGISTER      A50191
         IC    RWKC,PRFSCAN+1-IEDQPRF(R2) GET IDLES COUNT        A50191
         LA    RWKC,PRFSHDR-IEDQPRF(RWKC,R2) FIRST DATA BYTE     A50191
         CLI   ZERO(RWKC),XA0 .         WRITE DC                 A50191
         BE    SCREENOK .               BRANCH IF YES            A50191
         CLI   ZERO(RWKC),XB0 .         WRITE AT LINE ADDRESS    A50191
         BE    SCREENOK .               BRANCH IF YES            A50191
         CLI   ZERO(RWKC),XE0 .         WRITE ERASE              A50191
         BE    SCREENOK .               BRANCH IF NO             A50191
         CLI   EQU3(RWKB),XB0 .         WLA                      A50191
         BE    NOCHARX .                BRANCH IF YES            A50191
         CLI   EQU3(RWKB),XE0 .         WRITE ERASE              A50191
         BE    NOCHARX .                BRANCH IF YES            A50191
         MVI   EQU3(RWKB),XA0 .         WDC IS DEFAULT           A50191
         B     NOCHARX .                RETURN TO MAINLINE       A50191
SCREENOK EQU   * .                                               A50191
         MVC   EQU3(1,RWKB),ZERO(RWKC)  SET CONTROL CHARACTER    A50191
NOCHARX  EQU   * .                                               A50191
         SR    RWKC,RWKC .              CLEAR WORK REGISTER      A50191
         IC    RWKC,CCWCOUNT+1 .        ADDR STRING LENGTH       A50191
         BCTR  RWKC,R0 .                DECREMENT COUNT BY ONE   A50191
         STC   RWKC,CCWCOUNT+1 .        RESET NEW COUNT          A50191
         B     NOCHAR .                 RETURN TO MAINLINE       A50191
         SPACE 2
         AIF   ('&GEN' EQ 'MINI').L72
*        DIAL EXPANDER
*        READ TERM/IDENTIFICATION EXPANDER
RDTERMRT EQU   *
         MVI   CCWCOUNT+1,24            MAC COUNT TWX ID
         LA    RWKA,LCBERCCW            DATA ADDRESXS
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         SPACE 2
         SPACE 2
WTTRSPRT EQU   *
         LA    RWKA,LCBERCCW            DATA ADDRESS
         MVI   CCWCOUNT+1,24            SET COUNT FOR READ
         BR    REXPND                   RETURN
.L72     ANOP
*   EXPANDER FOR CONTINUE OPERATIONS
RDEOBRT  EQU   *
         MVI   CCWCOUNT+1,9             SET COUNT
         LA    RWKA,LCBERCCW+12         READ ID ENQ
         BR    REXPND                   RETURN TO EXPAND ROUTINE
         AIF   ('&GEN' EQ 'MINI').L73
         AIF   ('&GEN' EQ 'STSP').L74
         AIF   ('&GEN' EQ 'QTAM').L74
RDIDRT   EQU   *
RDRSPEQ  EQU   *
RDENQRT  EQU   *
         MVI   CCWCOUNT+1,17            MAX COUNT RD ID ENQ
         LA    RWKA,LCBERCCW+7          RESPONSE AREA
         BR    REXPND                   RETURN
WRTONERT EQU   *
         L     RWKA,AVTTONE             GET ADDDRESS OF COUNT
         MVC   CCWCOUNT,0(RWKA)         SET CCW COUNT
         LA    RWKA,2(,RWKA)            BUMP TO FF SEQUENCE
         BR    REXPND                   RETURN TO EXPAND
RDLCRT   EQU   *
         LA    RWKA,LCBERCCW+12         READ AREA
         MVI   CCWCOUNT+1,1             ASSUME NONTRANSPARENT
         L     RWKC,LCBSCBA-1            URRNET SCB
         USING IEDQSCB,RWKC
         TM    SCBBSCFM,SCBTRNSP .      RECEIVEING RRANSPARENT   S21101
         BCR   8,REXPND                 BRANCH NON-TRANSP.
         MVI   CCWCOUNT+1,2             SET COUN T
         BR    REXPND                   RETURN
         DROP  RWKC
         SPACE
.L74     ANOP
WRCPURT  EQU   *                        WRITE CPU ID
*        WRITE CPU/IDENTIFICATION EXPANDER
         BAL   RWKB,ILIST               GET ILIST ADDRESS
         L     RWKB,IDLOC(,RWKC)        GET ADDRESS OF CPU ID
         B     NODIGITS                 USE COMMON CODE
         SPACE
WRWCCRT  LA    RWKA,WCCSEQU             ADDRESS OF WCC SEQUENCS22028TSO
         MVI   CCWCOUNT+1,X'05'         SET COUNT TO 5        S22028TSO
         BR    REXPND                   RETURN                S22028TSO
WRWCCR1  LA    RWKA,WCCNOMDT            ADDR WCC, NO MDT        SA68050
         MVI   CCWCOUNT+1,X'05'         SET COUNT TO 5          SA68050
         BR    REXPND                   RETURN                  SA68050
         SPACE
RDWCCRT  MVI   CCWCOUNT+1,X'09'         SET COUNT TO 9        S22028TSO
         LA    RWKA,LCBERCCW+12         RESPONSE ADDRESS      S22028TSO
         BR    REXPND                   RETURN                S22028TSO
         AIF   ('&GEN' EQ 'BISC').L73
         SPACE 2
BREAKCCW EQU   *
WRSMIRT  LA    RWKA,SMISEQU             ADDRESS OF SMI SEQUENCE     TSO
         MVI   CCWCOUNT+1,X'03'         SET COUNT TO THREE          TSO
         BR    REXPND                   RETURN                      TSO
         SPACE
         AIF   ('&GEN' EQ 'QTAM').L73                            A48245
RDACKRT  MVI   CCWCOUNT+1,X'01'         SET COUNT TO ONE            TSO
         LA    RWKA,LCBERCCW+12         RESPONSE ADDRESS            TSO
         BR    REXPND                   RETURN                      TSO
.L73     ANOP                                                    S99228
WRSEL    EQU   *                                                 S99228
* 3270 LOCAL SELECT EXPANDER                                     S99228
         SR    RWKA,RWKA                CLEAR ADDR REGISTER      S99228
         MVI   CCWCOUNT+ONE,ONE         SET DATA COUNT AT ONE    S99228
         BR    REXPND                   RETURN                   S99228
         SPACE
H8       DC    H'8'
LCBBKUP  DC    AL2(LCBERB-IEDQLCB)      OFFSET ERB FROM LCB
H72      DC    H'72' .                                              TSO
*  OPTLIST--OFFSET TO IEDQAE,LENGTH,OFFSET TO OPT FIELD,REG 15 INDIC
OPTLIST  DC    AL1(20),XL3'040010' .    PARM LIST FOR IEDQAE        TSO
*  E Q U A T E S  D I R E C T O R Y
*
*        D E V I C E    C H A R A C T E R I S T I C S
*
* BYTE 2
CBISYNC  EQU   X'80'
C3270    EQU   X'04'                    3270 DEVICE              S99228
         AIF   ('&GEN' EQ 'MINI').L73C                           S22026
         AIF   ('&GEN' EQ 'STSP').L73C                           S22026
         AIF   ('&GEN' EQ 'QTAM').L73C                           S22026
CBRDCAST EQU   X'40' .                                           S22026
.L73C    ANOP                                                    S22026
CTWX     EQU   X'20'
CSTNCTL  EQU   X'10'
CXMITCTL EQU   X'08'
CCONTENT EQU   X'04'
CLOCAL   EQU   X'02'
CAUDIO   EQU   X'01'
* BYTE 3
CWTTA    EQU   X'40'                    WORLD TRADE TELEGRAPH
CENDCTL  EQU   X'20'                    END TO END CONTROLS (2780)
CCHECK   EQU   X'10'                    CHECKING
CBFRD    EQU   X'08'                    BUFFERED TERM.
CCONTIN  EQU   X'04'                    CAPABLE OF CONTINUE OPER.
CNOIDLES EQU   X'02'                   NO IDLES DEFINED
C2760    EQU   X'01'                    2760
* BYTE 1
CINHIBIT EQU   X'80'                    USE READ INHIBIT CCW'S
CBREAK   EQU   X'40'                    TERM HAS REVERSE BREAK FEATURE
CATTEN   EQU   X'20'                    TERM HAS ATTENTION FEATURE
C5041    EQU   X'10'                    2741'S AND 1050'S SUPPORTED
C2741    EQU   X'08'                    2741 ON THIS LINE
*
IDLOC    EQU   4                        OFFSET INTO ILIST
AUTOPL   EQU   X'01'                    AUTOPOLL FLAG IN ILIST
CUMASK   EQU   X'01'                    CU ENTRY DVC CHARS TABLE S99228
F0       EQU   X'F0'                    MASK USED FOR DAIL UP
AUTOCALL EQU   X'80'                   UBC MASK-AUTOCALL        SA57685
UCBTYP2  EQU   X'11'                   UCB OFFSET TO DIAL FEAT  SA57685
UCBID    EQU   X'0D'                   UCB OFFSET TO UCB ID     SA57685
SENDVTO  EQU   X'0E'                    SEND STCB FOR LEASED LINE
UNEX     EQU   X'01'                    UNIT EXCEPTION IN CSW-FLG
*                                         FOR NO RESTART
EXCP     EQU   0 .                      EXCP MASK                A41027
THREE    EQU   3
ONE      EQU   1
FLAG     EQU   X'20'                    USED IN WRITE IDLES LOOP
CPAEXCP  EQU   X'08'                    3270 INITIAL EXCP FLAG   S99228
TWO      EQU   2
T24      EQU   24
FOUR     EQU   4
EIGHT    EQU   8
LCIN     EQU   X'80'                    MASK FOR LCIN
ZERO     EQU   X'00'
* *   T E M P O R A R Y                                             TSO
CVTPTR   EQU   16 .                                                 TSO
TONEOPT  EQU   X'01'                    MASK FOR TONE GENERATION
D41STICS DC    XL3'F80400'              2741                        TSO
D50STICS DC    XL3'301014'               050                        TSO
SMISEQU  DC    XL3'02BD03'                                          TSO
WCCSEQU  DC    XL5'0227F1C303'                                S22028TSO
WCCNOMDT DC    XL5'0227F1C203'                                  SA68050
DISDLEOT EQU   X'01'                    FLAG TO WRITE DLE EOT
CSVTO    EQU   X'20' .                  CONC SCH VTO             S22026
BUFFVTO  EQU   X'1A'                    BUFFRERED TERMINAL VTO
TPRSPMG  EQU   X'28'                    RD RESP MSGEN 2260R     SA59501
XA0      EQU   X'A0' .                  WRITE DC                 A50191
XB0      EQU   X'B0' .                  WRITE AT LINE ADDRESS    A50191
XE0      EQU   X'E0' .                  WRITE ERASE              A50191
EQU3     EQU   3 .                      CONSTANT                 A50191
*
*        E X P A N D E R S    T A B L E
*
*        EACH ENTRY IN THIS TABLE PROVIDES...
*              - TWO BYTES OFFSET INTHE EXPANDER ROUTINES
*              - ONE BYTE OP CODE CCW
*              - ONE BYTE TP CODE EXPANDER
*
*
ORGTB1   DS    0H
         SPACE 3
         AIF   ('&GEN' EQ 'BISC').L58
SNSCW    DC    AL2(SNSRT-ORGRTN)
         DC    AL1(CCWSENSE)
         DC    AL1(TPNULL)
         SPACE 1
NOPCCW   EQU   *
         DC    AL2(NOPRT-ORGRTN)
         DC    AL1(CCWNOP)
         DC    AL1(TPNULL)
         SPACE 1
.L58     ANOP
RDSKPCW  DC    AL2(RDSKPRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDSKIP)
         SPACE 1
TCSKPCW  DC    AL2(TCSKPRT-ORGRTN)
         DC    AL1(CCWTIC)
         DC    AL1(TPNULL)
         SPACE 1
WREOTCW  DC    AL2(WREOTRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWREOT)
         SPACE 1
WRPOLCW  DC    AL2(WRPOLRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRPOLL)
         SPACE 1
RDRSPCW  DC    AL2(RDRSPRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDRESP)
         SPACE 1
TCBUFCW  DC    AL2(TCBUFRT-ORGRTN)
         SPACE 1
PREPCW   DC    AL2(PREPRT-ORGRTN)
         DC    AL1(CCWPREP)
         DC    AL1(TPNULL)
         SPACE 1
         AIF   ('&GEN' EQ 'MINI').Z9
POLLCW   DC    AL2(POLLRT-ORGRTN)
         DC    AL1(CCWPOLL)
         DC    AL1(TPNULL)
         SPACE 1
TCRDXCW  DC    AL2(TCRDXRT-ORGRTN)
         DC    AL1(CCWTIC)
         DC    AL1(TPNULL)
         SPACE 1
TCPOLCW  DC    AL2(TCPOLRT-ORGRTN)
         DC    AL1(CCWTIC)
         DC    AL1(0)                   0 TP CODE FOR LINE END TABLE
         SPACE 1
.Z9      ANOP
WRIDLCW  DC    AL2(WRIDLRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRIDLE)
         SPACE 1
TCIDLCW  DC    AL2(TCIDLRT-ORGRTN)
         SPACE 1
WRPADCW  DC    AL2(WRPADRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRPAD)
         SPACE 1
         AIF   ('&GEN' EQ 'MINI').L60
         AIF   ('&GEN' EQ 'STSP').L60
         AIF   ('&GEN' EQ 'QTAM').L60
RDENQCW  EQU   *                        READ ENQ
         DC    AL2(RDENQRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDENQ)
         SPACE
.L60     ANOP
WRADRCW  DC    AL2(WRADRRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRAD)              ADDRESSING SEQUENCE
         SPACE 1
WREOACW  DC    AL2(WREOART-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWREOA)
         SPACE 1
         AIF   ('&GEN' EQ 'MINI').L61
DISBLCW  DC    AL2(DISBLRT-ORGRTN)
         DC    AL1(CCWDISAB)
         DC    AL1(TPNULL)
         SPACE 1
DIALCW   DC    AL2(DIALRT-ORGRTN)
         DC    AL1(CCWDIAL)
         DC    AL1(TPNULL)
         SPACE 1
ENABLCW  DC    AL2(ENABLRT-ORGRTN)
         DC    AL1(CCWENAB)
         DC    AL1(TPENABLE)
         SPACE 1
RDTERMCW DC    AL2(RDTERMRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPTWXID)
         SPACE 1
WRCPUCW  DC    AL2(WRCPURT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRCPU)
         SPACE 1
WTTRSPCW EQU   *
         DC    AL2(WTTRSPRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDRSPD)
.L61     ANOP
RDRSPSCW DC    AL2(RDRSPSRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDRSPD)
         SPACE
WRACKCW  DC    AL2(WRACKRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRACK)
         SPACE
TCCONCW  EQU   *
         DC    AL2(TCCONRT-ORGRTN)
         DC    AL1(CCWTIC)
         DC    AL1(TPNULL)
         SPACE
RDEOBCW  EQU   *
         DC    AL2(RDEOBRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDRPEB)
         SPACE
         AIF   ('&GEN' EQ 'STSP').L62C
         AIF   ('&GEN' EQ 'MINI').L63
         AIF   ('&GEN' EQ 'QTAM').L62B                           A48245
WRENQCW  EQU   *
         DC    AL2(WRENQRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRENQ)
         SPACE
RSPENQCW EQU   *
         DC    AL2(RDRSPEQ-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRSPENQ)
RDLCOUT  EQU   *
         DC    AL2(RDLCRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDLC)
         SPACE
WRDLETCW EQU   *
         DC    AL2(WRDLETRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRDLET)
         SPACE
RDIDENQ  EQU   *
         DC    AL2(RDENQRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDIDNQ)            READ ID ENQ
         SPACE
WRTONECW EQU   *
         DC    AL2(WRTONERT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRTONE)
RDIDAK   EQU   *
         DC    AL2(RDIDRT-ORGRTN)
         DC    AL1(CCWREAD)
         DC    AL1(TPRDIDAK)
.L62C    ANOP
WRWCCCW  DC    AL2(WRWCCRT-ORGRTN)                            S22028TSO
         DC    AL1(CCWWRITE)                                  S22028TSO
         DC    AL1(TPNULL)                                    S22028TSO
WRWCCC1  DC    AL2(WRWCCR1-ORGRTN)                              SA68050
         DC    AL1(CCWWRITE)                                    SA68050
         DC    AL1(TPNULL)                                      SA68050
RDWCCCW  DC    AL2(RDWCCRT-ORGRTN)                            S22028TSO
         DC    AL1(CCWREAD)                                   S22028TSO
         DC    AL1(0)                                         S22028TSO
         AIF   ('&GEN' EQ 'BISC').L63
WRSMICW  DC    AL2(WRSMIRT-ORGRTN)                                  TSO
         DC    AL1(CCWWRITE)                                        TSO
         DC    AL1(TPNULL)                                          TSO
RDACKCW  DC    AL2(RDACKRT-ORGRTN)                                  TSO
         DC    AL1(CCWREAD)                                         TSO
         DC    AL1(0)                                               TSO
IHRSPCW  DC    AL2(RDRSPRT-ORGRTN)                                  TSO
         DC    AL1(CCWINHIB)                                        TSO
         DC    AL1(TPRDRESP)                                        TSO
.L62B    ANOP                                                    A48245
WRBRKCW  EQU   *
         DC    AL2(BREAKCCW-ORGRTN)
         DC    AL1(CCWBREAK)
         DC    AL1(TPNULL)
.L63     ANOP
RESETCCW EQU   *
         DC    AL2(WREOTRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPRESET)
         SPACE
WRACKNAK EQU   *
         DC    AL2(WRACKRT-ORGRTN)
         DC    AL1(CCWWRITE)
         DC    AL1(TPWRAKNK)
SELCTCW  EQU   *                                                 S99228
         DC    AL2(WRSEL-ORGRTN)                                 S99228
         DC    AL1(CCWSEL)                                       S99228
         DC    AL1(TPNULL)                                       S99228
         EJECT
*
*        M O D E L S    C H A N N E L S    P R O G R A M
*                          T A B L E
*
*
*        THIS TABLE IS A SET OF SUBSETS
*        EACH SUBSET IS AN ELEMENT OF MODEL CHANNEL PROGRAM
*
*        THE LAST BYTE OF EACH SUBSET IS THE END ELEMENT X'FF'
*        (NOT NEEDED FOR THE LAST SUBSET OF A CHANNEL PROGRAM)
*
*        EACH ENTRY IN A SUBSET CONSISTS OF TWO BYTES.
*    *** BYTE1   OFFSET IN EXPANDERS TABLE
*    *** BYTE2     CCW/FLAGS  BYTE
*
         SPACE 3
MODCCW   DS    0H
MODCCW00 EQU   *
         DC    AL1(RDSKPCW-ORGTB1)
         DC    XL1'B0'
         DC    AL1(TCSKPCW-ORGTB1)
         DC    XL1'00'
         DC    X'FF'
         AIF   ('&GEN' EQ 'MINI').L42
         AIF   ('&GEN' EQ 'STSP').L41A
         AIF   ('&GEN' EQ 'QTAM').L41A
MODCCW01 EQU   *
         DC    AL1(WRDLETCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(DISBLCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(DIALCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
.L41A    ANOP
MODCCW02 EQU   *
         DC    AL1(DISBLCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(DIALCW-ORGTB1)
         DC    XL1'60'
         DC    XL1'FF'
         AIF   ('&GEN' EQ 'STSP').L43
         AIF   ('&GEN' EQ 'QTAM').L43
MODCCW07 EQU   *
         DC    AL1(WRDLETCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
MODCCW7B EQU   *
         DC    AL1(DISBLCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(ENABLCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
MODCCW7A EQU   *
         DC    AL1(WRTONECW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
.L43     ANOP
         AIF   ('&GEN' EQ 'BISC').L44
MODCCW08 EQU   *
         DC    AL1(DISBLCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)        FLAGS
         DC    AL1(ENABLCW-ORGTB1)
         DC    AL1(0)                   NO GLAGS
         DC    XL1'FF'
.L44     ANOP
         AIF   ('&GEN' EQ 'STSP').L45
         AIF   ('&GEN' EQ 'QTAM').L45
MODCCW10 EQU   *
         DC    AL1(RDIDENQ-ORGTB1)
         DC    AL1(CCWSLI)
         DC    X'FF'
MODCCW11 EQU   *
         DC    AL1(WRCPUCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
MODCCW12 EQU   *
         DC    AL1(WRACKCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(TCBUFCW-ORGTB1)
MODCCW14 EQU   *
         DC    AL1(WRCPUCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
MODCCW15 EQU   *
         DC    AL1(WRENQCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RDIDAK-ORGTB1)
         DC    AL1(0)
         DC    X'FF'
MODCCW16 EQU   *
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
MODCCW17 EQU   *
         DC    AL1(RDENQCW-ORGTB1)
         DC    AL1(0)
         DC    AL1(WRACKCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(TCBUFCW-ORGTB1)
.L45     ANOP
         AIF   ('&GEN' EQ 'BISC').L46
MODCCW18 EQU   *
         DC    AL1(WRCPUCW-ORGTB1)      WRTIE CPU ID
         DC    AL1(CCWCC+CCWSLI)        FLAGS
         DC    AL1(RDRSPCW-ORGTB1)      READ RESPONSE
         DC    AL1(CCWCD)
         DC    AL1(TCBUFCW-ORGTB1)
.L42     ANOP
MODCCW20 EQU   *
         DC    AL1(WREOTCW-ORGTB1)
         DC    XL1'60'
MODCCW21 EQU   *
         DC    AL1(PREPCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(SNSCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(RDRSPCW-ORGTB1)
         DC    AL1(CCWCD)
         DC    AL1(TCBUFCW-ORGTB1)
         AIF   ('&GEN' NE '').L47
.L46     ANOP
MODCCW22 EQU   *                        BSC POINT - POINT
         DC    AL1(PREPCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(RDENQCW-ORGTB1)      READ ENQ
         DC    AL1(0)                   NO FLAGS
         DC    AL1(WRACKCW-ORGTB1)      WRITE ACK
         DC    AL1(CCWCC+CCWSLI)        FLAGS
         DC    AL1(TCBUFCW-ORGTB1)
.L47     ANOP
         AIF   ('&GEN' EQ 'MINI').Z8
MODCCW26 EQU   *                        AUTOPOLL  CCW'S
         DC    AL1(WREOTCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(POLLCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(TCPOLCW-ORGTB1)
         DC    XL1'00'
         DC    AL1(TCRDXCW-ORGTB1)
         DC    XL1'00'
         DC    AL1(POLLCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(TCPOLCW-ORGTB1)
         DC    XL1'00'
         DC    AL1(RDRSPCW-ORGTB1)
         DC    XL1'80'
         DC    AL1(TCBUFCW-ORGTB1)
.Z8      ANOP
MODCCW28 EQU   *                        MULTIPT READ INT.
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(WRPOLCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(RDRSPCW-ORGTB1)
         DC    XL1'80'
         DC    AL1(TCBUFCW-ORGTB1)
MODCCW29 EQU   *
         AIF   ('&GEN' EQ 'BISC').L46A
         SPACE 1
         DC    AL1(NOPCCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
.L46A    ANOP
         SPACE 1
MODCCW30 EQU   *
         DC    AL1(WRIDLCW-ORGTB1)
         DC    AL1(CCWCD+CCWSKIP)       FLAGS FOR WRITE IDLES
         DC    XL1'FF'
         AIF   ('&GEN' EQ 'BISC').L48
         AIF   ('&GEN' EQ 'MINI').L49A
MODCCW32 EQU   *
         DC    AL1(RDTERMCW-ORGTB1)
         DC    XL1'20'
         DC    X'FF'
.L48     ANOP
MODCCW36 EQU   *
         DC    AL1(WRPADCW-ORGTB1)
         DC    XL1'80'
         DC    XL1'FF'
         AIF   ('&GEN' EQ 'BISC').L50
.L49     ANOP
MODCCW38 EQU   *                        START STOP CONTENTION-WRITE
         DC    AL1(WREOACW-ORGTB1)
         DC    AL1(CCWCD)
         DC    AL1(TCIDLCW-ORGTB1)
.L49A    ANOP
MODCCW39 EQU   *
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(WREOACW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(WRPADCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(TCIDLCW-ORGTB1)
         AIF   ('&GEN' NE '').L51
.L50     ANOP
MODCCW40 EQU   *                        PT - PT BSC WRITE INITIAL
         DC    AL1(WRENQCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RSPENQCW-ORGTB1)
         DC    AL1(0)
MODCCW41 EQU   *
         DC    AL1(WRADRCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RDRSPSCW-ORGTB1)
         DC    AL1(0)                   NO FLAGS
         DC    X'FF'
         AIF   ('&GEN' EQ 'BISC').L52
.L51     ANOP
         AIF   ('&GEN' EQ 'MINI').L53
MODCCW42 EQU   *
         DC    AL1(WRPADCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(WRADRCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(WTTRSPCW-ORGTB1)
         DC    AL1(0)
         DC    AL1(WREOACW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(TCIDLCW-ORGTB1)
         AIF   ('&GEN' EQ 'STSP').L53
         AIF   ('&GEN' EQ 'QTAM').L53
.L52     ANOP
MODCCW43 EQU   *
         DC    AL1(WRENQCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RDRSPSCW-ORGTB1)
         DC    AL1(0)
         DC    X'FF'
.L53     ANOP
MODCCW44 EQU   *                        MULTI-POINT WRITE INITIAL
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(WRADRCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(RDRSPSCW-ORGTB1)
         DC    AL1(0)                   INTERRUPT ON RESPONSE
MODCCW62 EQU   *
         DC    AL1(WREOACW-ORGTB1)
         DC    XL1'80'
         DC    AL1(TCIDLCW-ORGTB1)
         AIF   ('&GEN' EQ 'STSP').L54
         AIF   ('&GEN' EQ 'MINI').L54
         AIF   ('&GEN' EQ 'QTAM').L54
MODCCW45 EQU   *
         DC    AL1(WRACKNAK-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RDLCOUT-ORGTB1)
         DC    AL1(CCWCD)
         DC    AL1(TCCONCW-ORGTB1)
.L54     ANOP
MODCCW46 EQU   *
         DC    AL1(WRACKNAK-ORGTB1)
         DC    XL1'60'                  FLAGS
         DC    AL1(TCCONCW-ORGTB1)
         AIF   ('&GEN' EQ 'MINI').L55
         AIF   ('&GEN' EQ 'STSP').L55
         AIF   ('&GEN' EQ 'QTAM').L55
         SPACE
MODCCW48 EQU   *
         DC    AL1(RDEOBCW-ORGTB1)
         DC    AL1(0)                   NO FLGS
         DC    X'FF'
MODCCWFS EQU   * .                                               S22026
         DC    AL1(WREOTCW-ORGTB1) .   WRITE EOT FOR SELECTION   S22026
         DC    AL1(CCWCC+CCWSLI) .                               S22026
         DC    AL1(WRADRCW-ORGTB1) .   WRITE ADDRESSING CHARS    S22026
         DC    XL1'60' .                                         S22026
         DC    AL1(TCIDLCW-ORGTB1) .   TIC TO WRITE IDLES        S22026
         DC    X'FF' .                                           S22026
.L55     ANOP
         AIF   ('&GEN' EQ 'BISC').LB
MODCCW50 EQU   *
         DC    AL1(RDEOBCW-ORGTB1)
         DC    X'60'                    FLAGS
         DC    AL1(TCCONCW-ORGTB1)
.LB      ANOP
         SPACE 1
MODCCW51 EQU   *
         DC    AL1(WREOTCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(WRADRCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(RDRSPSCW-ORGTB1)
         DC    AL1(0)
         DC    X'FF'
         AIF   ('&GEN' EQ 'BISC').L56
         AIF   ('&GEN' EQ 'MINI').L56
         AIF   ('&GEN' EQ 'QTAM').L56
         SPACE 1
MODCCW52 EQU   *                                                    TSO
         DC    AL1(WREOTCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
MODCCW54 EQU   *
         DC    AL1(PREPCW-ORGTB1)
         DC    X'60'
         DC    AL1(SNSCW-ORGTB1)
         DC    XL1'60'
         DC    AL1(IHRSPCW-ORGTB1)
         DC    XL1'80'
         DC    AL1(TCBUFCW-ORGTB1)                                  TSO
.L56     ANOP
MODCCW56 EQU   *
         DC    AL1(WRACKNAK-ORGTB1)
         DC    AL1(0)                   NO FLGAS
         DC    X'FF'
         AIF   ('&GEN' EQ 'BISC').L57
MODCCW58 EQU   *
         DC    AL1(WREOACW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
.L57     ANOP
MODCCW60 EQU   *
         DC    AL1(WRACKCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    X'FF'
         AIF   ('&GEN' EQ 'MINI').M7
MODCCW63 EQU   *
         DC    AL1(WRCPUCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
.M7      ANOP
MODCCW64 EQU   *
         DC    AL1(RDRSPCW-ORGTB1)
         DC    AL1(CCWCD+CCWSLI)
         DC    AL1(TCBUFCW-ORGTB1)
         AIF   ('&GEN' EQ 'BISC').LD
         AIF   ('&GEN' EQ 'MINI').LD
         AIF   ('&GEN' EQ 'QTAM').LD
         SPACE
MODCCW19 EQU   *
         DC    AL1(WRCPUCW-ORGTB1)
         DC    AL1(CCWCC+CCWSLI)
         DC    AL1(IHRSPCW-ORGTB1)
         DC    AL1(CCWCD)
         DC    AL1(TCBUFCW-ORGTB1)
MODCCW70 EQU   *                                                    TSO
         DC    AL1(WREOTCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(PREPCW-ORGTB1)                                   TSO
         DC    XL1'60'                                              TSO
         DC    AL1(WRPADCW-ORGTB1)                                  TSO
         DC    XL1'80'                                              TSO
         DC    AL1(TCBUFCW-ORGTB1)                                  TSO
MODCCW90 EQU   *                                                    TSO
         DC    AL1(WRSMICW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(RDACKCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(WREOTCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(WRPOLCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(RDRSPCW-ORGTB1)                                  TSO
         DC    XL1'80'                                              TSO
         DC    AL1(TCBUFCW-ORGTB1)                                  TSO
MODCCW91 EQU   *                                                    TSO
         DC    AL1(WREOTCW-ORGTB1)                                  TSO
         DC    AL1(CCWCC+CCWSLI)                                    TSO
         DC    AL1(WRPOLCW-ORGTB1)                                  TSO
         DC    XL1'60'                                              TSO
         DC    AL1(IHRSPCW-ORGTB1)                                  TSO
         DC    XL1'80'                                              TSO
         DC    AL1(TCBUFCW-ORGTB1)                                  TSO
MODCCW92 EQU   *                                              S22028TSO
         DC    AL1(WRWCCCW-ORGTB1)                            S22028TSO
         DC    XL1'60'                                        S22028TSO
         DC    AL1(RDWCCCW-ORGTB1)                            S22028TSO
         DC    XL1'60'                                        S22028TSO
         DC    AL1(WREOTCW-ORGTB1)                            S22028TSO
         DC    AL1(0)                                         S22028TSO
         DC    X'FF'                                          S22028TSO
MODCCW93 DC    AL1(WRWCCC1-ORGTB1)                              SA68050
         DC    XL1'60'                                          SA68050
         DC    AL1(RDWCCCW-ORGTB1)                              SA68050
         DC    XL1'60'                                          SA68050
         DC    AL1(WREOTCW-ORGTB1)                              SA68050
         DC    AL1(0)                                           SA68050
         DC    X'FF'                                            SA68050
.LD      ANOP
MODCCW72 EQU   *
         DC    AL1(RESETCCW-ORGTB1)
         DC    AL1(0)
         DC    X'FF'
         AIF   ('&GEN' EQ 'MINI').L4R5                          OY03846
MODCCW73 EQU   *   3270 LOCAL READ CHANNEL PROGRAM               S99228
         DC    AL1(SELCTCW-ORGTB1)                               S99228
         DC    AL1(CCWCC+CCWSLI)                                 S99228
         DC    AL1(TCBUFCW-ORGTB1)                               S99228
MODCCW74 EQU   *   3270 LOCAL WRITE CHANNEL PROGRAM              S99228
         DC    AL1(SELCTCW-ORGTB1)                               S99228
         DC    AL1(CCWCC+CCWSLI)                                 S99228
         DC    X'FF'                                             S99228
.L4R5    ANOP
         EJECT
*        DCBD  DSORG=TX
         DCBD  DSORG=TX
         EJECT
*        TAVTD
         TAVTD
         EJECT
*        TCCWD
         TCCWD
         EJECT
*        TDEBD
         TDEBD
         EJECT
*        TDISPD
         TDISPD
         EJECT
*        TLCBD
         TLCBD
         EJECT
*        TPRFD
         TPRFD
         EJECT
*        TPRIOR
         TPRIOR
         EJECT
*        TQCBD
         TQCBD
         EJECT
*        TQCBED
         TQCBED
         EJECT
*        TSCBD
         TSCBD
         EJECT
*        TSTCBD
         TSTCBD
         EJECT
*        TTSID
         TTSID
         EJECT
*        TTNTD
         TTNTD
         EJECT
*        TTPD
         TTPD
         EJECT
*        TTRMD
         TTRMD
         MEND

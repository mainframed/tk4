               XM21 - DATA SET COMPARE
               -----------------------



1  INTRODUCTION
   ------------


   THIS JOB PROVIDES THE FACILITY TO 'COMPARE', AT RECORD
   LEVEL, ANY TWO DATA SETS CONTAINING THE SAME FORMAT RECORDS.


   THE 'COMPARE' INSTRUCTIONS ARE PROVIDED BY CARD INPUT.
   A REPORT IS PRODUCED SHOWING RECORDS THAT HAVE BEEN FOUND
   TO BE UNEQUAL TOGETHER WITH A SUMMARY OF THE 'COMPARE'
   DETAILS.


2  JOB CONTROL CARDS
   -----------------

   //XM21GEN           JOB        (PROJECT CONTROL TASK CODE)
   //                  CLASS=D
   //S1                EXEC XM21
   //XM21.DS011        DD         1ST DATA SET
   //XM21.DS021        DD         2ND DATA SET
   //XM21.CONCARD      DD         *
       CONTROL CARDS HERE
   /*


   OR WHERE CHECKPOINTS ARE TO BE TAKEN CHANGE


   //S1                EXEC XM21          TO
   //S1                EXEC XM21CP


   SEE U19011OJ FOR CATALOGUED PROCEDURE


3  PARM INFORMATION
   ----------------


   NO PARM INFORMATION OR SYMBOLIC PARAMETERS ARE REQUIRED.


4  CONTROL CARD FORMATS
   --------------------

   A   COLS 1 -  4 CONTAIN CARD CODE 'XM21'
   B   COL  5      CONTAINS 'BLANK' (CARD CODE DELIMITER)
   C   COLS 6 - 80 CONTAIN THE OPERATION CODE(S) WHICH
                   SPECIFY THE 'COMPARE' INSTRUCTIONS.
       THE GENERAL FORMAT FOR CODING THE OPERATION CODES
       IS AS FOLLOWS:-


           1  VARIABLE LENGTH OPERATION CODE OR FIXED
              LENGTH IF ABBREVIATED COMMANDS ARE USED,
              E.G. F INSTEAD OF FORMAT.


          11  '=' DELIMITS OPERATION CODE


         111  ENTRIES FOLLOW OPERATION CODE


          1V  '/' DELIMITS ENTRY IF NOT LAST FOR THAT OPERATION


           V  'BLANK' DELIMITS LAST ENTRY ON CARD


          V1  ENTRIES CONSIST OF SUB-ENTRIES DELIMITED BY ','


         V11  IF ENTRY IS NOT CODED THEN THE DEFAULT VALUE IS TAKEN.


THE TYPES OF OPERATION AND THEIR FORMATS ARE AS FOLLOWS:-



A   FORMAT (F)


    CONTAINS TWO ENTRIES INDICATING



    1    FORMAT OF INPUT RECORDS (F)


   11    NUMBER OF RECORDS TO BE READ FROM
         THE FIRST DATA SET BEFORE A CHECKPOINT
         IS TAKEN (N)


         I.E. XM21 FORMAT=F/N
         OR  XM21 F=F/N
              WHERE F CAN TAKE THE VALUES:-


               IS = INDEX SEQUENTIAL FILES (IN WHICH
                    CASE N CANNOT BE CODED)
                           ------


             IBM = NORMAL SEQUENTIALLY ORGANISED FILE


             HBS = SEQUENTIAL FILES WITH HBS BLOCKING
                     I.E. UNDEFINED IBM RECORDS BLOCKED
                     BY SUBROUTINE D3301.


            AND N CAN TAKE VALUES      0 - 999,999,999
               (0 INDICATES NO CHECKPOINT TO BE TAKEN)


    DEFAULT VALUES:      FORMAT=IBM/0
    --------------

    E.G. XM21 FORMAT=IBM/2000
         XM21 FORMAT=IS
         XM21 FORMAT=/4000
         XM21 F=HBS/9000


    N.B. IF FILE IS INDEX SEQUENTIAL AND RECORDS ARE
         FIXED UNBLOCKED WITH RELATIVE KEY POSITION OF
         ZERO THEN THE KEY IS NOT WRITTEN AS PART OF
         RECORD BUT THIS PROGRAM WILL TREAT IT AS PART
                ---
         OF RECORD.  THIS IS AS IN CASE OF F300 WHEN
         RECORDS ARE WRITTEN AS 1125 BYTE RECORDS WITH
         KEY OF 5 BYTES.  THIS PROGRAM TREATS IT AS
         1130 BYTE RECORD, WITH KEY AS 1ST 5 BYTES.


B   KEY (K)


    CONTAINS A MAXIMUM OF TEN ENTRIES WHICH INDICATE THE
    KEY FIELDS IN THE RECORDS AND THEIR DIRECTION.


    ONLY RECORDS WITH EQUAL KEYS WILL BE COMPARED.  THE
    RECORD TO BE REPORTED AS 'EXTRA' DEPENDS ON FORMAT
    AND DIRECTION OF KEY FIELDS.


    IF KEY FIELD HAS DESCENDING DIRECTION THEN RECORD WITH
    HIGHER KEY FIELD WILL BE REPORTED AS EXTRA.  IF KEY
    FIELD HAS ASCENDING DIRECTION THEN RECORD WITH LOWER
    KEY FIELD WILL BE REPORTED AS EXTRA.  THE KEY FIELDS
    ARE TAKEN IN THE ORDER THEY APPEAR ON THE CONTROL CARD.
   I.E. XM21 K=NONE
   OR   XM21 KEY=N,L,F,S/N,L,F,D/....
        WHERE NONE INDICATES NO KEYS
           N = DISPLACEMENT IN DECIMAL OF KEY IN RECORD
               AND TAKES VALUES 0 - 10000


           L = LENGTH OF KEY IN RECORD AND TAKES
               VALUES 1 - 10000 IF BINARY FIELD
                      1 - 16    IF PACKED FIELD


           F = FORMAT OF KEY AND TAKES
               VALUES P = PACKED DECIMAL
                      B = BINARY


           S = SEQUENCING OF KEY FIELD(S)
               VALUES A = ASCENDING
                      D = DESCENDING


   DEFAULT VALUE  XM21 KEY=NONE
   -------------


    CONTINUATION OF KEY CARDS IS ALLOWED


   E.G. XM21 KEY=0,2,P,D/2,235,B,A
   OR   XM21 KEY=0,2,P,D/
        XM21 KEY=2,235,B,A
   OR   XM21 K=0,2,P,D/2,235,B,A


C  COMPARE (C)
   -------


    CONTAINS A MAXIMUM OF TEN ENTRIES WHICH INDICATE THE
   FIELDS THAT ARE TO BE COMPARED.  (N.B. THE FIELD MUST
   ALWAYS HAVE SAME IDSPLACEMENT WITHIN DATA SET 1 AS
   WITHIN DATA SET 2)


   I.E.  XM21 C=ALL
         XM21 C=N,L,F/...
         XM21 COMPARE=N,B,M/....
         XM21 COMPARE=N,R/...


   WHERE ALL INDICATES COMPARE ALL THE RECORD


       N = DISPLACEMENT IN DECIMAL OF COMPARE FIELD
           WITHIN THE RECORD AND TAKES VALUES 1 - 10000


   L = LENGTH OF COMPARE FIELD AND TAKES
       VALUES 1 - 10000 IF BINARY COMPARE FIELD
         OR   1 - 16    IF PACKED COMPARE FIELD


   F = FORMAT OF COMPARE FIELD AND TAKES VALUES
       P = PACKED
       B = BINARY


   B = MASK AND TAKES THE VALUE OF TWO HEX DIGITS


   M = INDICATES BIT COMPARE.  I.E. THOSE BITS
       TO BE COMPARED ARE THOSE WHICH ARE SET ON
       IN THE MASK.


   R = INDICATES REST OF RECORD IS TO BE COMPARED
       AND IS TO BE TREATED AS BINARY.

   DEFAULT VALUE  XM21 COMPARE=ALL
   ------- -----


   COMTINUATION OF COMPARE CARDS IS ALLOWED.

   E.G.  XM21 COMPARE=0,FE,M/1,5,P/6,2,B/9,R
   OR    XM21 COMPARE=0,FE,M/
         XM21 COMPARE=I,5,P/6,2,B/
         XM21 COMPARE=9,R


         XM21 COMPARE=ALL IS EQUIVALENT TO
         XM21 COMPARE=0,R


D  PRINT (P)


   CONTAINS THREE ENTRIES WHICH INDICATE
   1     HOW RECORDS ARE TO BE PRINTED (A)
  11     MAXIMUM NUMBER 'UNEQUAL' RECORDS TO BE REPORTED (N)
         (COMPARE CONTINUES BUT PRINTING STOPS)

 111     NUMBER OF CONSECUTIVE 'UNEQUAL' RECORDS BEFORE
         TERMINATION OF JOB (B)

   I.E.  XM21 PRINT=A/N/B
   OR    XM21 P=A/N/B

         WHERE A = FORMAT IN WHICH RECORDS ARE TO BE PRINTED
                   AND TAKES VALUES
                   C = PRINT RECORDS DIRECTLY AS CHARACTER
                   X = RECORDS TO BE PRINTED IN 2 CHARACTER
                       PER BYTE HEXADECIMAL FORMAT

         N = CAN TAKE VALUES 0 - 999,999,999
             OR ALL IN WHICH CASE ALL INEQUALITIES
             ARE REPORTED.

         B = CAN TAKE VALUES 0 - 999,999,999

   DEFAULT VALUE:     PRINT=X/50/10
   -------------

   E.G.  XM21 P=C
         XM21 P=C/ALL/5
         XM21 PRINT=//2 IS EQUIVALENT TO
         XM21 PRINT=X/50/2

E  TITLE (T)

   CONTAINS ONE ENTRY WHICH IS 60 BYTES REPORT TITLE
   (T) TO BE INSERTED IN HEADINGS.

   I.E. DEFAULT VALUE = 'BLANK' TITLE
        -------------

F  EXIT (E)

   CONTAINS 2 ENTRIES WHICH INDICATE THE NAMES OF EXIT
   ROUTINES I.E.USER WRITTEN PROGRAM TO BE GIVEN CONTROL
   EITHER

   1     PRIOR TO RECORD COMPARE (X)

  11     WHEN UNEQUAL COMPARE IS FOUND (Y)

         I.E. EXIT=X/Y
         OR   E=X/Y

         WHERE X AND Y ARE ALPHAMERIC NAMES, 8 BYTES LONG.
         ALL 8 BYTES MUST BE CODED INCLUDING BLANKS.


         THE EXIT ROUTINE PARAMETERS (USING STANDARD HBS
         LINKAGE) ARE

         P1 1ST DATA SET RECORD
         P2 1ST DATA SET RECORD LENGTH (HALFWORD)
         P3 2ND DATA SET RECORD
         P4 2ND DATA SET RECORD LENGTH (HALFWORD)
         P5 ADDRESS OF ROUTINE TO RECOMPARE RECORDS AGAIN
            (FOR SECOND EXIT ROUTINE ONLY)

         DEFAULT VALUE :  NO EXIT ROUTINES
         -------------

         E.G. XM21 EXIT=SNAP    /EXIT2TWO

         NOTES FOR CODING EXIT ROUTINE
         -----------------------------

         1    TO FIND UNEQUAL BYTE CODE CLCL R6,R8 (WHEN
              COMPARING THE WHOLE RECORD).

         2    RETURN TO ADDRESS AT P5 BY L      R1,4(R13)
                                         ST     R10,12(,R1)
                                         MODOUT

5  OUTPUT REPORTS
   --------------

   A     CARD VALIDATION REPORT

         INDICATES ALL CARD INPUT AND ANY INVALIDITY.
         (UNDERLINING ANY INVALIDITY).

         THESE INVALIDITIES ARE

         A    INVALID ENTRY
         B    INVALID CARD CODE
         C    INVALID DELIMITER (AFTER CARD CODE)
         D    INVALID OPERATION
         E    MORE THAN 10 KEY ENTRIES
         F    MORE THAN 10 COMPARE ENTRIES
         G    CONTINUATION CARD EXPECTED

         NOTES:-  MESSAGE D APPEARS ON DUPLICATE OPERATION.
                  MESSAGE A APPEARS IF ENTRY IS INVALID FOR
                  ANY REASON (E.G. RECORD LENGTH 0, INVALID
                  ENTRY, DELIMITER OR VALUE OF DISPLACEMENT/
                  COUNT TOO LARGE)

   B     COMPARISON REPORT

         INDICATES ANY 'UNEQUAL' RECORDS ON DATA SETS WITH MESSAGE.

         A    EXTRA RECORD
         B    UNEQUAL RECORDS
         C    KEY NOT PRESENT
         D    COMPARE FIELD NOT PRESENT
         E    KEY NOT PACKED

         THIS IS FOLLOWED BY INDICATION TO WHICH DATA SET
         RECORD BELONGS (INCLUDING DS NAME) RECORD NUMBER
         AND LENGTH.

         BYTES OF RECORDS ARE UNDERLINED AS FOLLOWS

         BLANK  BYTE COMPARED AND EQUAL
           *    BYTE COMPARED AND UNEQUAL
           -    BYTE NOT COMPARED
           K    BYTE PART OF KEY FIELD
           P    BYTE IN COMPARE FIELD WITH FORMAT ERROR
           F    BYTE IN KEY WITH FORMAT ERROR I.E. NOT PACKED

         N.B. BEWARE WHEN USING BIT COMPARE, UNDERLINE MAY BE
              BLANK WHEN BYTES MAY BE UNEQUAL.

         A SUMMARY IS ALSO PRINTED SHOWING

         1   RECORDS COMPARED = XXX
        11   RECORDS UNEQUAL  = XXX
         (THESE TOTALS INCLUDE ONLY PAIRS OF RECORDS COMPARED
         AND NOT EXTRA RECORDS).
       111   EXTRA RECORDS ON DATA SET 1 = XXX
        1V   EXTRA RECORDS ON DATA SET 2 = XXX
         (THESE TOTALS INCLUDE ONLY RECORDS WITH KEYS FOR
         WHICH WHERE IS NO MATCH ON THE OTHER DATA SET).

         N.B. NUMBER OF RECORDS ON 1ST DATA SET = (1) + (111)
                                   2ND DATA SET = (1) + (1V)

         A TERMINATION MESSAGE IS PRINTED WHEN REQUIRED AS
         IMPLIED BY THE MESSAGE.

         (A) PRINTING TERMINATED AFTER XXX RECORDS
         (B) COMPARE TERMINATED AFTER XXX CONSECUTIVE UNEQUAL
             RECORDS
         (C) INVALID HBS BLOCKING
         (D) RECORD LENGTH TOO LARGE
         (E) KEYS INCONSISTENT (INDEX SEQUENTIAL ONLY)

6  ERROR CONDITIONS
   ----------------

   PROGRAM WILL TERMINATE WITH RETURN CODE OF 8 IF ANY ERROR
   IS FOUND IN CARD VALIDATION OR IN CASES 5B(B) TO 5B(E) ABOVE.

7  CONSOLE MESSAGES
   ----------------

   NONE

8  SPECIAL NOTES & RESTRICTIONS
   ----------------------------

   (A) MAXIMUM 'RECORD' LENGTH IS 10,000
   (B) 'RECORD' LENGTH IS TAKEN FROM THE LRECL
       PARAMETER OF DCB FIELD
   (C) JOB WILL RUN IN 64K PARTITION.

9   EXAMPLE
   -------

   A     TO COMPARE TWO TAPE FILES WITH VARIABLE BLOCKED
         RECORDS WITH BLOCKSIZE OF 7,000 BYTES AND TAKING
         CHECKPOINTS EVERY 30,000 RECORDS.  THE FILES ARE
         IN ASCENDING BRANCH NUMBER (2 BYTES PACKED AT
         DISPLACEMENT 2) AND ROLL NUMBER ORDER (5 BYTES BINARY
         AT DISPLACEMENT 4).  5 BYTES FROM DISPLACEMENT
         28 ARE NOT TO BE COMPARED AND BIT 0 OF THE BYTE
         AT DISPLACEMENT 43 IS NOT TO BE COMPARED.

         PRINTING IS IN HEX FORMAT AND IS TO BE TERMINATED
         AFTER 50 RECORDS, AND COMPARE IS TO BE TERMINATED
         AFTER 3 CONSECUTIVE ERRORS.

         //F215GEN         JOB    (BOR,5050),
         //                CLASS=D
         //S1              EXEC XM21CP
         //XM21.DS01I      DD  DSN=BOR.F215A,DISP=OLD,UNIT=(2400-3,,DEFE
         //                    LABEL=(2,BLP),VOL=SER=ANY1,
         //                    DCB=(BLKSIZE=7000,RECFM=VB)
         //XM21.DS02I      DD   DSN=BOR,F215B,DISP=OLD,UNIT=(2400-3,,DEF
         //                     DCB=(BLKSIZE=7000,RECFM=VB)
         //XM21.CONCARD    DD   *
         XM21 FORMAT=/30000
         XM21 KEY=2,2,P,A,/4,5,B,A
         XM21 COMPARE=0,28,B/33,10,B/43,7F,M/44,R
         XM21 TITLE=            MAIN FILE COMPARE
         XM21 PRINT=/50/3
         /*

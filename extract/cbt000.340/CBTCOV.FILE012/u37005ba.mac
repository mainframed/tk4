TRANSLATE ICL-1900 CARD OR TAPE CODE TO IBM
PURPOSE
THIS PROGRAM WIL TRANSLATE ICL CARD CODE OR ICL7-TRK MAGNETIC TAPE CODE
EBCDIC. A TRANSLATED COPY OF THE DATA SET WILL BE PRODUCED.
RESTRICTION
SINCE WSCC DO NOT HAVE 7-TRK TAPE UNITS, THE ICL TAPE WOULD FIRST HAVE T
COPIED
FROM 7-TRK TO 9-TRK TAPE AT AN IBM INSTALLATION. THE 7-TRK TAPE DRIVE US
HAVE THE FOLLOWING FEATURES:-
ODD PARITY
556 B.P.1.
TRANSLATE FEATURE(OFF OR NOT PRESENT)
DATA-CONVERT FEATURE (OFF OR NOT PRESENT)
THE 9-TRK TAPE PRODUCED AS A RESULT IS THE INPUT TO THE TRANSLATE PROGRA
IN THE CASE OF ICL CARDS THERE IS NO RESTRICTION. THE CARDS CAN BE READ
BY THE WSCC CARD READER.
INPUT FORMAT
THE 9TRK TAPE INPUT WILL BE THE SAME FORMAT EXACTLY AS THE ICL 7-TRK TAP
THE SAME NUMBER OF CHARACTERS, SAME BLOCKING ETC. THE ONLY DIFFERENCE WI
THAT BECAUSE
AN ICL 'CHARACTER'(QUATER OF 24-BIT WORD)IS 6 BITS AND AN IBM CHARACTER
THE MOST SIGNIFICANT 2 BITS OF EVERY BYTE WILL BE ZERO.
ONCE TRANSLATED TO EBCDIC, OF COURSE, THIS WILL NOT BE SO.
THE FIRST THREE BLOCKS WILL BE STANDARD ICL TAPE FORMAT:
1. HEADER. 10 OR MORE ICL-WORDS LONG, 40 BYTES PLUS.
FILE NAME, DATE WRITTEN, GENERATION NUMBER ETC.
2. ICL TAPE MARK, 1 BYTE,= TRANSLATED.
3. QUALIFIER BLOCK, 20 ICL-WORDS, 80 BYLES.
MAXIMUM BLOCK SIZE - OTHER FIELDS NOT IMPORTANT.
HHE REMAINING BLOCKS WILL BE DATA BLOCKS, FIXED/VARIABLE,BLOCKES/UNBLOCK
NEITHER FORMAT IS THE SAME AS IBM.
EVERY LOGICAL RECORD WHETHER FIXED OR VARIABLE, BLOCKED/
UNBLOCKED HAS A SINGLE WORD BINARY RECORD LENGTH AS THE FIRST WORD.
THERE IS NO BLOCK LENGTH WORD, EVEN FOR VARIANCLE RECORDS.
THIS,AND THE FACT THAT THE THREE HEADER BLOCKS ARE ALWAYS PRESENT, MEANS
THE TRANSLATE PROGRAM MUST ALWAYS READ THE INPUT TAPE AS FORMAT U WITH A
 BLOCKSIZE OF 4096(1024 WORDS IS THE MAXIMUM ICL BLOCKSIZE)
BINARY FIELDS
IF THE BLOCKS TO BE TRANSLATED CONTAIN BINARY FIELDS(24-BIT WORDS CONTAI
BINARY VALUE) THE TRANSLATE PROGRAM TREATS THESE DIFFERENTLY, AS FOLLOWS
1. EACH BYTE THAT IS PART OF A 4-BYTE BINARY FIELD IS TRANSLATED TO A DI
CODE BECAUSE 7-TRK ICL TAPE CODE HAS A DIFFERENT BIT-PATTERN FROM THE BI
PATTERN IN CORE FOR THE SAME CHARACTER.
2. THE TRANSLATED 4-BYTE WORD IS SHUFFLED TO THE RIGHT SO THAT IS OCCUPI
RIGHT-MOST 24-BITS OF AN IBM 32-BIT WORD, THE TOP 8 BEING ZERO.
THIS WORD IS NOW AN EXACT REPLICA OF THE WORD AS IT APPEARS IN CORE FOR
1900 MACHINE AND CAN BE MANIPULATED AS A FULL WORD BINARY NUMBER BY ANY
READING THE TRANSLATED TAPE.
WHERE ARE THESE BINARY FIELDS?
IN ORDER TO CARRY OUT THE PROCESSING DESCRIBED ABOVE, THE TRANSLATE PROG
TO KNOW WHERE THESE BINARY FIELDS ARE.
THIS IS DONE BY OFFERING A MAP TO PROGRAM OF BLANKS AND 'X'S SO THAT EAC
BINASRY FIELD IN THE PHYSICAL RECORD(NOT THE LOGICAL ONE)IS REPRESENTED
4'X'S IN THE CORRESPONDING POSITION IN THE MAP.
THIS MAP MUST BE A LOAD MODULE WRITTEN IN ASSEMBLER AND PUT INTO A LIBRA
TO RUNNING THE PROGRAM.
IT MUST ALSO BE AT LEAST AS BIG AS THE LASRGEST PHYSICAL RECORD
RO BE ENCOUNTERED.
THE PARM PARAMETER
THE PROGRAM'S TREATMENT OF THE PARM PARAMETER FOR THE FOLLOWING PARM VAL
CARD   CARD IMAGES ASSUMED, NO MAP,
       ALL CHARACTERS TRANSLATED TO EBCDIC.
'NAME'  MAGNETIC TAPE INPUT IS ASSUMED. A MAP IS LOADED INTO CORE
HAVING MEMBER NAME 'NAME'. CHARACTER IN THE RECORD HAVING
AN X IN THE CORRESPONDING MAP POSITION WILL BE TREATED AS
PREVIOUSLY DESCRIBED, AND THE REST TO EBCDIC. IF THE MAP IS NOT
FOUND THE PROGRAM WILL ABEND ON S806.
NOMAP  MAGNETIC TAPE INPUT IS ASSUMED. NO MAP IS LOADED AND NO
'SPECIAL' TRANSLATE ETC. TAKES PLACE. ALL CHARACTERS ARE
TRANSLATED TO EBCDIC.
THE OUTPUT FORMAT
THE FIRST THREE BLOCKS ON THE INPUT TAPE(THE HEADER BLOCKS) ARE NOT WRIT
THE OUTPUT DATA SET.
INSTEAD, THEY ARE PRINTED IN CHARACTER AND HEX TO ENABLE THE USER TO CHE
HEADER DATA.
FILE NAME, CREATION DATA ETC. ALL BINARY FIELDS ARE TREATED AS PREVIOUSL
DESCRIBED.
THE DATA BLOCKS ARE THEN TRANSLATED,ONE UNDEFINED BLOCK AT A TIME, AND O
THE OUTPUT DATA SET.
THIS MEANS THAT FIXED LENGTH BLOCKED/UNBLOCKED RECORDS CAN BE READ BY A
SUBSEQUENT USER PROGRAM AS NORMAL IBM F/FB FORMAT.
ASSUMPTIONS
1. THE MAP, IF PRESENT, IS AT LEAST AS BIG AS THE LARGEST PHYSICAL RECOR
2. THERE IS ONLY ONE DATA SET ON THE TAPE.
3. THE FIRST TAPE-MARK ENCOUNTERED AFTER THE SECOND BLOCK IS THE END OF
4. BINARY FIELDS ARE FULL WORDS. I.E. THERE ARE NO HALFWORDS AND NO MIXE
CHARACTER/BINARY WORDS.
(THE X'S IN THE MAP ARE IN GROUPS OF FOUR CONTIGUOUS BYTES.)
WHAT IT WON'T DO
1. WORK OUT WHERE BINARY FIELDS ARE IN VARIABLE RECORDS IF THESE ARE IN
VARAIBLE PORTION.
2.PRODUCE THE OUTPUT FOR VARIABLE RECORDS WHICH CAN SUBSEQUENTLY BE READ
SUCH OUTPUT CAN ONLY BE READ AS FORMAT U.
3. REMOVE THE FIRST WORD(RECORD SIZE IN WORDS)FROM LOGICAL RECORDS.
4.DEAL WITH MIXED CHARACTER/BINARY WORDS.
5. READ MORE THAN ONE(THE FIRST)DATA SET FROM THE INPUT TAPE.
THE JCL REQUIRED
(A_ CARD INPUT
//  EXEC  PGM=UT11900T,PARM='CARD'
//INPUT  DD  *
ICL CARDS OR CARD IMAGES ON IBM TAPE
//OUTPUT  DD  UNIT=2400,DISP=(KEEP),VOL=SER=SCRTCH,
//    LABEL=(,NL),
//    DCB=(BLKSIZE=4096,RECFM=U)
//SYSPRINT  DD  SYSOUT=A  (NO SPACE OF DCB REQUIRED.
PROGRAM SAYS RECFM=U,BLKSIZE=133)
(B) TAPE INPUT
//    EXEC  PGM=UT11900T,PARM=NOMAP
//    EXEC  PGM=UT11900T,PARM=NAME
//STEPLIB  DD  DSN=WS,LINKLIB,DISP=SHR
//  DD  DISP=SHR,DSN=MAP LIBRARY ETC.
//INPUT DD UNIT=2400,LABEL=(,NL),
//    VOL=SER=ICLIN,
//    DISP=OLD,
//    DCB=(RECFM=U,BLKSIZE=4096)
//OUTPUT  DD  UNIT=2400,DISP=(,KEEP),
//    LABEL=(,NL),VOL=SER=SCRTCH,
//    DCB=(RECFM=U,BLKSIZE=4096)
//SYSPRINT  DD  SYSOUT=A,BLKSIZE=4096)
(C) TO CREATE THE MAP(EXAMPLE)
//    EXEC ASMFCL
//ASM.SYSPUNCH  DD  DUMMY,DSN=X
//ASM.SYSIN  DD  *
NAME  CSECT
COMMENT(S) IF ANY
DC  C'XXXX'
DC  CL100' '
DC  C'XXXXXXXX'
//LKED.SYSLMOD  DD  DISP=SHR,DSN=MAP LIBRARY(NAME)
NOTES
(A) THE CARD FOR ALL ALPHANUMERIC CHARACTERS AND A FEW SPECIAL CHARACTER
THE SAME FOR IBM AND ICL. THEREFORE A TRANSLATE WOULD NOT BE NECESSARY I
WERE KNOWN THAT THE INPUT WAS RESTICTED TO THESE. THEY ARE:
A - Z
0 - 9
BLANK
FULL STOP    .
ASTERISK    *
MINUS    -
SLASH    /
COMMA    ,
PER CENT    %
NUMBER    #
AT SIGN    @
THE FOLLOWING ICL CHARACTERS HAVE NO EQUIVALENT IBM CHARACTER :
    LEFT SQUARE BRACKET
    RIGHT SQUARE BRACKET
    VERTICAL ARROW
    HORIZONTAL ARROW
Ö   SAME CODE BUT WOULD BE TAKEN AS $ ON WSCC MACHINE
THE FOLLOWING IBM CHARACTERS HAVE NO EQUIVALENCE ICL CHARACTER
1   PL/1 SYMBOL
^   PL/1 SYMBOL
_   PL/1 SYMBOL
    CENT
ICL CHARACTERS FOR WHICH THERE IS NO EQUIVALENT WILL BE TRANSLATED TO
NON-PRINTABLE VALUES(UNLESS OF COURSE THEY ARE PART OF A BINARY FIELD).
(B) HEADER-BLOCK FORMAT (BLOCK 1)
WORD 1   HDDR
WORD 2    VOLUME SERIAL NUMBER
WORD 3-5  FILE NAME
WORD 6    REEL SEQUENCE NUMBER
WORD 7    GENERATION NUMBER
WORD 8    RETENTION PERIOD
WORD9    DATE WRITTEN IN DAYS FROM 1899
WORDS 10 + DO NOT MATTER
THE SECOND WORD OF BLOCK 3 IS THE MAXIMUM BLOCKSIZE, THE REST DO NOT MAT

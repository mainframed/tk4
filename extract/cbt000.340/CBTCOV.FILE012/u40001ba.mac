Z0600
GENERALISED SELECTION ROUTINE
U. GENERAL DESCRIPTION
THIS ROUTINE, WHEN LINKED TOGETHER WITH APPROPRIATE INPUT AND
OUTPUT ROUTINES, WILL PROVIDE A SELECTIVE PRINT/COPY OF ANY
TYPE OF FILE.
THE PRINTOUT IS PROVIDED IN HEXADECIMAL, WITH CHARACTER
TRANSLATION (IBM DUMP FORMAT). THE SELECTION OF RECORDS IS
ACHIEVED BY A SET OF CONTROL CARDS.
AN I/O ERROR HANDLING ROUTINE Z9953 MAY ALSO BE INCORPORATED
WHICH IS USEFUL IF COPYING A MAGNETIC TAPE WITH KNOWN ERRORS.
APART FROM SELECTION ACHIEVED BY THE MAIN MODULE THERE IS A
FACILITY FOR A USER TO ADD HIS OWN SELECTION ROUTINES.
AT PRESENT THE MODULE IS INCORPORATED IN TWO PROGRAMS VIZ.
Z06VBS AND Z06QSAM. THE FORMER WILL READ AND PRINT/COPY DATA
SETS IN VARIABLE BLOCKED SPANNED FORMAT (E.G. THE IMS LOG)
WHILE THE LATTER WILL PROCESS ANY OTHER TYPE OF QUEUED
SEQUENTIAL FILE.
2. CONTROL CARDS
2.1 GENERAL RULES FOR CODING CONTROL CARDS:
A. ALL KEYWORDS MUST BEGIN IN CARD COLUMN 1.
B. EMBEDDED BLANKS ARE NOT ALLOWED, EXCEPT IN THE FIELDS
OF ID VALUE STATEMENTS, PRINTIF STATEMENTS (WHERE THE
FIELDS MUST THEN BE IN QUOTES), AND IN THE TITLE
STATEMENT.
C. WITH THE EXCEPTION OF ID VALUE STATEMENTS THERE MAY
BE ONLY 1 CARD OF EACH TYPE.
D. CONTROL CARDS MAY BE FED IN ANY ORDER WITH THE FOLLOW-
ING EXCEPTION - THE ID VALUE STATEMENTS MUST COME
AFTER ALL OTHERS, AND BE IN THE ORDER IN WHICH THEY
ARE TO BE PROCESSED.
E. IT IS NOT PERMITTED TO HAVE AN ID CONTROL STATEMENT
(AND ID VALUE STATEMENTS) WITH A PRINTIF STATEMENT,
OR VICE-VERSA.
2.2 TITLE STATEMENT.
TITLE = ... UP TO 74 CHARACTERS
CARD COLUMNS 7-80 ARE USED AS PART OF PAGE HEADING AFTER THE
CARD EDIT PHASE IS COMPLETE.
DEFAULT - GENERAL PAGE HEADING.
2.3 OUTPUT STATEMENT.
OUTPUT = (PRINT)
OUTPUT = (COPY)
OUTPUT = BOTH)
SPECIFIES WHICH OUTPUT(S) REQUIRED. (SPECIFYING COPY GIVES
A STRAIGHT COPY OF SELECTED RECORDS.)
DEFAULT - PRINT SELECTD RECORDS, AND IF 'SYSUT2' DD CARDS
HAVE BEEN CORRECTLY PROVIDED, COPY SELECTED RECORDS TO SYSUT2
ALSO (SEE JCL REQUIREMENTS).
2.4 STARTAT STATEMENT.
STARTAT = N
SPECIFIES THE FIRST RECORD TO BE PROCESSED BY THE SELECT
ROUTINES (IF ANY) AND PRINTED/COPIED.
DEFAULT IS 1.
2.5 ONEIN STATEMENT.
ONEIN = N
THIS TEST ALLOWS FOR A 'THINNING OUT' OF THE FILE, E.G.
ONEIN = 11 WILL SELECT RECORDS 1, 12, 23 ETC. IF RECORDS
11, 22, 33 ETC., ARE REQUIRED USE 'STARTAT = 11' AND 'ONEIN = 11'
DEFAULT IS 1.
2.6 STOPAFT STATEMENT.
STOPAFT = N
SPECIFIES THE MAXIMUM NUMBER OF RECORDS TO BE PRINTED/COPIED
AFTER SELECTION. WHEN THIS NUMBER HAS BEEN REACHED THE PROGRAM
TERMINATES.
DEFAULT IS 30.
2.7 ID CONTROL STATEMENT.
IDOFFSET = N, FORMAT = X
'IDOFFSET' SPECIFIES THE DISPLACEMENT FROM THE BEGINNING OF EACH
LOGICAL RECORD, OF THE SENIOR BYTE OF THE FIELD TO BE COMPARED
WITH THE VALUES IN THE FOLLOWING ID VALUE CARDS. THIS FIELD
SHOULD BE IN ASCENDING SEQUENCE.
DEFAULT IS 0, THE MAXIMUM IS 4095.
'FORMAT' SPECIFIES THE TYPE OF FIELD IN THE FOLLOWING ID VALUE
CARDS, THE CONVERSIONS, WHERE NECESSARY, AND THE TYPE OF
COMPARE OPERATION TO BE USED.
OPTIONS ARE:-
   OPTION                     ID   CARD                     CONVERSION C
     C    ANY EBCDIC CHARACTER IN ONE COLUMN PUNCH CODE        NONE
                              (MAX 30 CHARS.)
     P    *ANY (UNSIGNED) NUMBER (MAX 7 DIGITS)             TO 4-BYTE
                                                              PACKED
     X    ANY EBCDIC CODE IN 2-CHARACTER FORMAT (MAX 7 BYEE) INTERNAL
                                                             360 CODE
DEFAULT IS C.
(IF BOTH KEYWORDS APPEAR, 'IDOFFSET' MUST BE FIRST.)
* LEADING ZEROS NEED NOT BE PUNCHED AS THE FIELD IS ASSUMED
TO BE 4 BYTES IN LENGTH.
2.8 ID VALUE STATEMENTS.
EACH OF THE VALUE STATEMENTS WILL BE PRINTED ON A NEW PAGE,
FOLLOWED BY THE RECORD(S) SELECTED DUE TO IT.
IDLOW = FIELD
PROGRAM WILL PRINT/COPY RECORDS EQUAL TO OR GREATER THAN FIELD
UNTIL 'STOPAFT' OR END-OF-FILE IS REACHED.
IDLOW = FIELD, IDHIGH = FIELD
PROGRAM WILL PRINT/COPY RECORDS BETWEEN AND EQUAL TO THE TWO
VALUES, THEN WILL GO BACK TO READ MORE ID VALUE CARDS.
IDHIGH = FIELD
PROGRAM WILL PRINT/COPY RECORDS LESS THAN OR EQUAL TO FIELD,
THEN WILL GO BACK TO READ MORE ID VALUE CARDS.
IDEQU = FIELD
PROGRAM WILL PRINT/COPY RECORDS EQUAL TO FIELD, THEN WILL GO
BACK TO READ ID VALUE CARDS.
2.9 PRINTIF STATEMENT.
PRINTIF = (OFFSET, OPERATOR, VALUE), FORMAT = X
PROGRAM WILL PRINT/COPY ALL RECORDS THAT SATISFY THE PRINTIF
STATEMENT.
'OFFSET' IS THE DISPLACEMENT FROM THE BEGINNING OF EACH LOGICAL
RECORD, OF THE SENIOR BYTE OF THE FIELD TO BE COMPARED WITH
'VALUE'.
'OPERATOR' STATES THE COMDITION FOR SELECTION AND CAN BE ONE OF
THE FOLLOWING:-
LT - PRINT/COPY IF RECORD FIELD IS LESS THAN 'VALUE'
GT - PRINT/COPY IF RECORD FIELD IS GREATER THAN 'VALUE'
EQ - PRINT/COPY IF RECORD FIELD IS EQUAL TO 'VALUE'
NE - PRINT/COPY IF RECORD IF NOT EQUAL TO 'VALUE'
GE - PRINT/COPY IF RECORD FIRLD IS GREATER THAN OR EQUAL
TO 'VALUE'
LE - PRINT/COPY IF RECORD FIELD IS LESS THEN OR EQUAL TO
'VALUE'
'VALUE' IS WHAT IS TO BE COMPARED WITH THE RECORD FIELD. THE
FORMAT OF IT IS DEFINED BY THE FORMAT KEYWORD. SEE 'ID
CONTROL STATEMENT' FOR AN EXPLANATION OF THIS.
2.10 USER MODULES CONTROL STATEMENTS.
MOD = NAME
MOD1 = NAME
MOD2 = NAME
THE USER MODULES MUST BE MEMBERS OF THE PARTITIONED DATA SET
DEFINED BY DDNAME 'SYSLIB'. 'NAME' IS THE MEMBER NAME OF THE
MODULE (SEE 'WRITING A USER SELECTION MODULE).
2.11 END CONTROL STATEMENT.
END
SPECIFIES THE END OF THE Z0600 CONTROL CARDS. THE USER SELECTION
MODULES MAY USE THE SAME CARD INPUT DATA SET, AND PRINT DATA SET
AS Z0600, AND ANY CONTROL CARDS FOR A USER MODULE MAY FOLLOW THE
END CARD.
2.12 EXAMPLED:
A. IDOFFSET = 10,FORMAT = P
IDLOW = 17,IDHIGH = 24
IDEQU = 24731
PROGRAM WILL PRINT/COPY ALL RECORDS THAT HAVE A 4-BYTE PACKED FIELD
(DISPLACEMENT 10 BYTES FROM THE BEGINNING) WITH VALUES 17 TO 24
INCLUSIVE AND 24731 (FIELD MUST BE IN ASCENDING SEQUENCE)
B. IDOFFSET = 1
IDLOW = 'ABC DE F'
PROGRAM WILL PRINT/COPY ALL RECORDS ONCE THE FIELD BEGINNING IN BYTE
2 HAS BECOME EQUAL TO ABC DE F.
C. PRINTIF = (16,GE,6B402B),FORMAT = X
PROGRAM WILL PRINT/COPY ALL RECORDS THAT HAVE A VALUE GREATER THAN
OR EQUAL TO X'6B402B' IN A FIELD BEGINNING AT DISPLACMENT 16 OF
THE RECORD.
3. JCL REQUIRED
THE FOLLOWING DD CARDS ARE REQUIRED:
SYSPRINT - STANDARD PRINT FILE
SYSLIB - LOAD LIBRARY CONTAINING USER EXIT ROUTINES
SYSNADSET - USED AS A PRINT FILE BY Z9953 IF IT FINDS
AN I/O ERROR IN THE INPUT FILE
SYSIN - CONTROL CARD FILE
3.1 EXEC STATEMENT
THIS SHOULD SPECIFY PROCEDURE Z06 OR Z06VBS TO RUN Z060SAM OR
Z06VBS RESPECTIVELY. THESE PROVIDE DD STATEMENTS FOR THE PRINT
DATA SET (SYSPRINT) AND THE I/O ERROR PRINT DATA SET (SYNADSET)
REQUIRED BY THE I/O ERROR HANDLER MODULE Z9953. BOTH THESE PRINT
FILES HAVE SYMBOLIC SOUT TO CHANGE THE SYSOUT CLASS. THERE IS A
FURTHER PROCEDURE, SELECT, WHICH IS USED THEN WRITING A USER EXIT
ROUTINE.
3.2 SYSUT1 DD STATEMENT.
REQUIRED. IT DEFINES THE SEQUENTIAL INPUT FILE.
3.3 SYSUT2 DD STATEMENT.
OPTIONAL. DEFINES AN OUTPUT SEQUENTIAL FILE ONTO WHICH SELECTED
RECORDS ARE TO COPIED. IF THE OUTPUT FILE IS TO HAVE THE SAME
DCB PARAMETERS AS THE INPUT FILE, THAY NEED NOT BE CODED.
NB WHEN USING Z06QSAM FOR FIXED LENGTH RECORDS, IT IS POSSIBLE
TO CHANGE THE RECORD LENGTH TO TRUNCATE RECORDS OR TO ADD
(RUBBISH) DATA, AS THE PROGRAM USES PUT MOVE MODE IN QSAM.
3.4 SYSLIB DD STATEMENT.
OPTIONAL. DEFINES A PDS (LIBRARY) IN WHICH A USER MODULE
RESIDES. REQUIRED ONLY IF MOD = CONTROL HAS BEEN USED.
3.5 SYSIN DD STATEMENT
OPTIONAL. DEFINES CONTROL CARD INPUT FILE (USUALLY DD *). IF
OMITTED, THEN DEFAULT OPTIONS ARE TAKEN.
4. ERROR MESSAGES AND ABENDS
ALL CONTROL CARDS ARE EDITED AND PRINTED. IF ANY ARE REJECTED
THE REASON IS GIVEN ALONGSIDE THE CARD AND THE PROGRAM TAKES
DEFAULT VALUES IF POSSIBLE.
OTHER MESSAGES ARE AS FOLLOWS:-
Z0600A - OUTPUT COPY SPECIFIED, BUT CANNOT OPEN FILE
THE OUTPUT CONTROL CARD SPECIFIER COPY OR BOTH, BUT THE DD
CARDS FOR SYSUT2 WERE EITHER MISSING OR MISPUNCHED. THE
PROGRAM TERMINATES AFTER COMPLETION OF THE VARD EDIT PHASE.
Z0600B - CANNOT OPEN SYSUT1 - DD CARD MAY BE MISSING
THE DD CARDS FOR SYSUT1 ARE EITHER MISSING OR MISPUNCHED.
THE PROGRAM TERMINATES AFTER COMPLETION OF THE CARD EDIT
PHASE.
Z0600C Z06 TERMINATED BY EXIT ROUTINE
A USER EXIT ROUTINE HAS PASSED A CONDITION CODE TO Z0600 TO
CAUSE TERMINATION.
Z0600D INVALID RETURN CODE FROM EXIT ROUTINE
A USER EXIT ROUTINE HAS PASSED AN INVALID CONDITION CODE TO
Z0600.
ABEND CODE USER 12 - A PROGRAM ERROR, PLEASE REFER TO TECHNICAL
SUPPORT GROUP.
ABEND CODE USER 996 - THE SYSPRINT DATA-SET COULD BOT BE OPENED -
DD CARDS ARE EITHER MISSING OR MISSPUNCHED.
5. WRITING A USER MODULE
THE USER MODULES ARE ONLY GIVEN CONTROL IF THE STARTAT, ID,
PRINTIF AND ONEIN TESTS (WHERE SPECIFIED) ARE SATISFIED.
THE ADDRESS OF A PARAMETER LIST IS PASSED IN REGISTER ONE. THE
PARAMETER LIST IS AS FOLLOWS:
ADDRESS OF CARD DCB (FULLWORD)
ADDRESS OF RPINT DCB (FULLWORD)
ADDRESS OF RECORD TO BE PROCESSED (FULLWORD)
LENGTH OF RECORD TO BE PROCESSED (HALFWORD)
ON RETURN FROM THE USER MODULE, Z0600 CHECKS THE CONDITION CODE
IN REGISTER 15, ACTS AS FOLLOWS:
R15 = 0 - RECORD TO BE PRINTED/COPIED
R15 = 4 - RECORD NOT TO BE PRINTED
R15 = 8 - PROCESSING TO BE TERMINATED
A PROCEDURE SELECT IS AVAILABLE TO SIMPLIFY WRITING A USER EXIT
ROUTINE FOR Z06VBS. THIS ENABLES VARIOUS TESTS TO BE CODED (IN
ASSEMBLER). IF THE TESTS ARE SUCCESSFUL BRANCH TO ACCEPT, IF
UNSUCCESSFUL TO REJECT AND TO TERMINATE PROCESSING TO STOP, WHICH
PASSES APPROPRIATE CONDITION CODES TO Z0600. THE SELECTION MODULE
CREATED IS CALLED Z06MOD.
E.G. // EXEC SELECT,VOL=LA1000
// ASM.COMPARE DD *
ASSEMBLER CLC  4(1,RECORD)=X'03'
          BE   ACCEPT
          B    REJECT
// GO.SYSIN DD *
Z06 CONTROL MOD=Z06MOD
CARDS STOPAFT=1000
6. WRITING INPUT AND OUTPUT MODULES
THE ENTRY POINTS OF THE INPUT AND OUTPUT MODULES ARE CALLED INPUT AND OU
RESPECTIVELY. ON ENTRY, REGISTER 1 POINTS TO A PARAMETER LIST AS FOLLOWS
ADDRESS OF CARD DCB (FULLWORD)
ADDRESS OF PRINT DCB (FULLWORD)
ADDRESS OF RECORD TO BE PROCESSED (FULLWORD)
LENGTH OF RECORD TO BE PROCESSED (HALFWORD)
THE INPUT ROUTINE MUST INSERT THE RECORD ADDRESS AND LENGTH INTO THIS
PARAMETER LIST.
ON RETURN FROM THE INPUT ROUTINE, Z0600 CHECKS FOR CONDITION CODES AS
FOLLOWS
R15 = 0 RECORD PROCESSED NORMALLY
R15 = 4 END OF FILE
R15 = 8 ERROR IN INPUT ROUTINE
ON RETURN FROM THE OUTPUT ROUTINE, Z0600 CHECKS FOR CONDITION CODES
R15 = 0 RECORD PROCESSED NORMALLY
R15 = 4 PROCESSING TO BE TERMINATED
R15 = 8 ERROR IN OUTPUT ROUTINE.

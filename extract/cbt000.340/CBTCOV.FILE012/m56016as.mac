         MACRO
&NAME    HEXPRINT &H,&C,&L,&SP,&MF=I
.*
.*  THE HEXPRINT MACRO TRANSLATES ANY STRING OF EBCDIC CHARACTERS
.*  INTO A STRING OF HEX CHARACTERS (READY FOR PRINTING A DUMP IMAGE).
.*  IT WILL OPTIONALLY INSERT A GIVEN NUMBER OF SPACES AFTER EACH NTH
.*  CHARACTER.
.*  THERE ARE FOUR POSITIONAL PARAMETERS....
.*   1.  ADDRESS OF ORIGINAL DATA TO BE TRANSLATED.
.*   2.  ADDRESS OF RECEIVING AREA FOR TRANSLATED DATA.
.*   3.  LENGTH OF ORIGINAL DATA TO BE TRANSLATED.  THE RECEIVING AREA
.*       LENGTH IS THE USERS RESPONSIBILITY AND MUST BE AT LEAST TWICE
.*       THE LENGTH OF THE ORIGINAL DATA (OR LONGER IF SEPARATOR
.*       BLANKS ARE REQUESTED).
.*   4.  DEFINITION OF SEPARATOR BLANKS TO BE INSERTED AS.....
.*       (NO. OF ORIGINAL BYTES TO BE TRANSLATED AS ONE BLOCK, NO. OF
.*       BLANKS TO FOLLOW EACH BLOCK).
.*       BY DEFAULT NO SEPARATOR BLANKS ARE PROVIDED.
.*
.*  EXAMPLE....    'HEXPRINT  FROM,TO,100,(5,1)'
.*
         GBLB  &GTSGHEX
         LCLC  &GNAME
&GNAME   SETC  '&NAME'
         AIF   ('&MF' EQ 'L').LROUT
         AIF   ('&MF(1)' EQ 'E' AND N'&MF EQ 2).EROUT
         AIF   ('&MF' NE 'I').E1
         CNOP  0,4
&NAME    BAL   1,*+36
&GNAME   SETC  ''
.LROUT   ANOP
&GNAME TSGINNRB (A,A,H,AL1,AL1),(&C,&H,&L,&SP(1),&SP(2)),(,,1),MF=&MF
         DC    CL16'0123456789ABCDEF',V(TSGHEXPT)
         AIF   ('&MF' EQ 'I').C1
         MEXIT
.EROUT   ANOP
&NAME    IHBINNRA &MF(2)
.C1 TSGINNRC (A,A,A,A,A),(,,H,C,C),(&C,&H,&L,&SP(1),&SP(2)),MF=&MF(1)
         L     15,28(1,0)          SET GR15 -> ENTRY POINT ADDRESS.
         BALR  14,15               LINK TO CONVERT.
         AIF   (&GTSGHEX).END
&GTSGHEX SETB  1
TSGHEXPT CSECT
         STM   0,7,20(13)          SAVE REGISTERS.
         LM    4,5,0(1)            SET GR4 -> CHAR, GR5 -> HEX FIELD.
         LH    0,8(1,0)            SET GR0 = LENGTH OF HEX FIELD.
         SR    3,3                 SET GR3 = 0.
         SR    6,6                 SET GR6 = 0.
         SR    7,7                 SET GR7 = 0.
         IC    6,10(1,0)           SET GR6 = NUMBER OF HEX BETWEEN BLNK
         IC 7,11(1,0)              SET GR7 = NUMBER OF BLANKS.
         IC    3,0(5,0)            SET HEX BYTE IN LO-ORDER BYTE GR3.
         SLDL  2,28                SET HEX VALUE IN LO-ORDER BYTE GR2.
         SRL   3,28                SET HEX VALUE IN LO-ORDER BYTE GR3.
         IC    2,12(1,2)           SET CHARACTER IN LO-ORDER BYTE GR2.
         IC    3,12(1,3)           SET CHARACTER IN LO-ORDER BYTE GR3.
         STC   2,0(4,0)            STORE CHARACTER.
         STC   3,1(4,0)            STORE CHARACTER.
         LA    4,2(4,0)            INCREMENT GR4 FOR NEXT CHAR BYTE.
         LA    5,1(5,0)            INCREMENT GR5 FOR NEET HEX BYTE.
         BCT   6,72(15,0)          LOOP UNTIL BLANKS REQUIRED.
         AR    4,7                 INCREMENT GR4 FOR BLANKS.
         IC    6,10(1,0)           RESTORE GR6 FOR LOOP.
         BCT   0,26(15,0)          LOOP UNTIL HEX CHARS EXHAUSTED.
         LM    0,7,20(13)          RESTORE REGISTERS.
         BR    14                  RETURN.
&SYSECT  CSECT
         MEXIT
.E1      MNOTE 12,'***  IHB002  INVA6ID MF OPERAND SPECIFIED-&MF'
.END     MEND

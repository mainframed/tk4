         MACRO
&NAME   $FINDCB  &ACOEF=,&ACTIM=,&ASCB=,&ASID=,&ASVT=,&ASXB=,          C
               &CVT=,&FIX=,&JCT=,&JSCB=,&LCT=,&OSACT=,&OSJCT=,&OSSCT=, C
               &RB=,&SJB=,&SSIB=,&TCB=,&TCBINT=,&TCBRCT=,&TCBSTC=,     C
               &TCT=,&TCTI=,&TIOT=,&TQE=,&TUCCVT=
.*       REFER TO THE DESCRIPTION AFTER THE MEND STATEMENT FOR THE
.*       MEANING OF THE DIFFERENT OPERANDS.
.*       THIS MACRO MAY BE USED TO OBTAIN THE ADDRESS OF ANY OR ALL OF
.*       THE CONTROL BLOCKS DEFINED IN THE CALLING PROTOTYPE STATMENT.
.*       BY GIVING A REGISTER (EITHER ABSOLUTE OR SYMBOLIC) FOR ANY OF
.*       THE SPECIFIED KEYWORD PARAMETERS, THE MACRO INSTRUCTION WILL
.*       WILL RETURN THE REQUESTED CONTROL BLOCK IN THAT REGISTER. NO
.*       REGISTERS OTHER THAN THOSE SPECIFIED ARE DESTROYED.
.*       THE FETCH CHAIN CAN BE STARTED AT A GIVEN BLOCK IN THE CHAIN
.*       BY SPECIFYING THE REGISTER POINTING TO THE CONTROL BLOCK
.*       ENCLOSED IN BRACKETS [].
.*
.*       IE. A TIOT REQUEST EXPANDS TO THE FOLLOWING
.*       $FINDCB  TIOT=X1         CALL
.*       L     X1,X'21C'          LOAD CURRENT TCB
.*       L     X1,X'0C'(,X1)      LOAD TIOT
.*       $FINDCB  TCB=[X3],TIOT=X1     CALL
.*       L     X1,X'0C'(,X3)      LOAD TIOT
.*
.*         THIS MACRO WAS CREATED 20 FEBRUARY, 1979
.*         THE LAST UPDATE FOR THIS MACRO WAS 07 JUNE, 1979
.*         A PROGRAM DESCRIPTION IS AVAILABLE AFTER THE MEND STATEMENT
.*
         GBLB  &FINDDN       GLOBAL TO SET EQUATES
         LCLC  &R1,&R2,&R3,&R4,&R5,&R6,&R7,&R8,&R9 REGISTER SYMBOLS FOR
         LCLC  &R10,&R11,&R12,&R13,&R14,&R15,&R16  CHAIN 1
         LCLC  &R17,&R18,&R19,&R20,&R21,&R22,&R23
         LCLC  &R24,&R25,&R26,&R27,&R28
         LCLC  &S1,&S2,&S3,&S4,&S5,&S6,&S7,&S8,&S9 REGISTER
         LCLC  &S10,&S11,&S12,&S13,&S14,&S15,&S16  SYMBOLS
         LCLC  &S17,&S18,&S19,&S20,&S21            FOR CHAIN 2
         LCLC  &T1,&T2,&T3,&T4,&T5,&T6,&T7,&T8     REGISTER SYMBOLS FOR
.*                                                 CHAIN 3
.*
.*       INCLUDE OFFSET EQUATES FIRST TIME ONLY
         AIF   (&FINDDN).EQUDONE  SKIP IT EQUATES ARE DONE
&FINDDN  SETB  1             INDICATE THAT IT IS DONE
$$FASID  EQU   X'24'         'ASCBASID' - ADDRESS OF ASID
$$FASXB  EQU   X'6C'         'ASCBASXB' - ADDRESS OF ASXB
$$FFTCB  EQU   X'04'         'ASXBFTCB' - ADDRESS OF FIRST TCB
$$FASVT  EQU   X'22C'        'CVTASVT'  - ADDRESS OF ASVT
$$FVSCVT EQU   X'CC'         'CVTUSER'  - ADDRESS OF TUC VS CVT
$$VPSIB  EQU   X'324'        'CVTVPSIB' - ADDRESS OF PAGE SERVICES
$$FCVT   EQU   X'10'         'FLCCVT'   - ADDRESS OF CVT
$$FOSACT EQU   X'27'         'JCTACTAD' - ADDRESS OF OS ACT (3 BYTE)
$$FJSCA  EQU   X'15C'        'JSCBACT'  - ADDRESS OF ACTIVE JSCB
$$FQMPI  EQU   X'F4'         'JSCBQMPI' - ADDRESS OF QUE MAN IN LCT
$$FSSIB  EQU   X'13C'        'JSCBSSIB' - ADDRESS OF SSIB
$$FOSJCT EQU   X'10'         'LCTJCTAD' - ADDRESS OF OS JCT
$$FOSSCT EQU   X'14'         'LCTSCTAD' - ADDRESS OF OS SCT
$$FASCBO EQU   X'224'        'PSAAOLD'  - ADDRESS OF CURRENT ASCB
$$FTCBO  EQU   X'21C'        'PSATOLD'  - ADDRESS OF CURRENT TCB
$$FLCTQ  EQU   X'F8'         'QMGR1'    - OFFSET OF QUE MAMAGER AREA
$$FJCT   EQU   X'60'         'SJBJCT'   - ADDRESS OF JES2 JCT
$$FSJB   EQU   X'20'         'SSIBSUSE' - ADDRESS OF JES SJB (SUBSYS)
$$FLCTR4 EQU   X'40'         'TCBGRS4'  - REGISTER 4 POINTS TO LCT
$$FJSCB  EQU   X'B4'         'TCBJSCB'  - ADDRESS OF CURRENT JSCB
$$FLTC   EQU   X'88'         'TCBLTC'   - ADDRESS OF LAST TCB
$$FRB    EQU   X'00'         'TCBRBP'   - ADDRESS OF LAST RB
$$FTCT   EQU   X'A4'         'TCBTCT'   - ADDRESS OF MAIN TCT
$$FTIOT  EQU   X'0C'         'TCBTIO'   - ADDRESS OF TIOT
$$FTQE   EQU   X'78'         'TCBTME'   - ADDRESS OF TASK TQE
$$FTCTI  EQU   X'0C'         'TCTIOTBL' - ADDRESS OF IO PART OF TCT
$$FACOEF EQU   X'40'         'TUCACOEF' - ADDRESS OF ACCOUNT TABLE
$$FACTIM EQU   X'3C'         'TUCACTIM' - ADDRESS OF CONVERSION
.EQUDONE ANOP  ,             CONTINUE
.*       ALL EQUATES ARE ESTABLISHED
.*
.*       PROCESS CHAIN 1, BACK TO FRONT
         AIF   (T'&TCBRCT EQ 'O' AND T'&TCBSTC EQ 'O' AND T'&TCBINT EQ '
               'O').NOTCBFT  JUMP IF NOT PART OF TCB CHAIN
         AIF   (T'&OSACT EQ 'O').RROSACT USE OSACT
         AIF   ('&OSACT'(1,1) EQ '[').RROSACT IGNORE OSACT
&R1      SETC  '&OSACT'      SET FOR OS ACT
.RROSACT AIF   (T'&OSJCT NE 'O').ROSJCT USE OS JCT
&R2      SETC  '&R1'         CARRY DOWN
         AGO   .NROSJCT      GO DO REST
.ROSJCT  AIF   ('&OSJCT'(1,1) NE '[').UROSJCT START WITH
&R2      SETC  '&OSJCT'(2,K'&OSJCT-2)  MOVE REGISTER
         AGO   .RROSJCT      JUMP TO NEXT CHECK
.UROSJCT ANOP  ,
&R2      SETC  '&OSJCT'      SET TO PUT VALUE HERE
.NROSJCT ANOP  ,
&R3      SETC  '&R2'         CARRY DOWN
.RROSJCT AIF   (T'&OSSCT EQ 'O').RROSSCT
         AIF   ('&OSSCT' EQ '[').RROSSCT IGNORE
&R5      SETC  '&OSSCT'      SET REG FOR OS SCT
.RROSSCT AIF   (T'&LCT NE 'O').RLCT
         AIF   ('&R3' EQ '').RRS3 USE OS SCT INSTEAD
&R4      SETC  '&R3'         REGISTER FROM SCT CHAIN
         AGO   .NRLCT        TO NEXT CHECK
.RRS3    ANOP  ,
&R4      SETC  '&R5'         REGISTER FROM JCT CHAIN
         AGO   .NRLCT        TO NEXT CHECK
.RLCT    AIF   ('&LCT'(1,1) NE '[').URLCT USE LCT
&R4      SETC  '&LCT'(2,K'&LCT-2)      MOVE IN SYMBOL
         AGO   .RRLCT        GO TO NEXT CHECK
.URLCT   ANOP  ,
&R4      SETC  '&LCT'        SET FOR STORAGE SYMBOL
.NRLCT   ANOP  ,
&R6      SETC  '&R4'         CARRY SYMBOL DOWN
.RRLCT   AIF   (T'&JCT EQ 'O').RRJCT
         AIF   ('&JCT'(1,1) EQ '[').RRJCT IGNORE START
&R8      SETC  '&JCT'        SET LOAD SYMBOL
.RRJCT   AIF   (T'&SJB NE 'O').RSJB
&R9      SETC  '&R8'         CARRY REGISTER DOWN
         AGO   .NRSJB        GO TO NEXT CHECK
.RSJB    AIF   ('&SJB'(1,1) NE '[').URSJB  USE SJB
&R9      SETC  '&SJB'(2,K'&SJB-2)      MOVE REGISTER
         AGO   .RRSJB        GO TO NEXT CHECK
.URSJB   ANOP  ,
&R9      SETC  '&SJB'        PUT OUT REGISTER
.NRSJB   ANOP  ,
&R10     SETC  '&R9'         CARRY DOWN
.RRSJB   AIF   (T'&SSIB NE 'O').RSSIB
&R11     SETC  '&R10'        CARRY REGISTER DOWN
         AGO   .NRSSIB       GO TO NEXT CHECK
.RSSIB   AIF   ('&SSIB'(1,1) NE '[').URSSIB USE SSIB
&R11     SETC  '&SSIB'(2,K'&SSIB-2)    MOVE REGISTER
         AGO   .RRSSIB       GO TO NEXT CHECK
.URSSIB  ANOP  ,
&R11     SETC  '&SSIB'       PUT OUT REGISTER
.NRSSIB  ANOP  ,
&R12     SETC  '&R11'        CARRY DOWN
.RRSSIB  AIF   (T'&JSCB NE 'O').RJSCB
&R13     SETC  '&R12'        CARRY REGISTER DOWN
         AGO   .NRJSCB       TO NEXT CHECK
.RJSCB   AIF   ('&JSCB'(1,1) NE '[').URJSCB USE JSCB
&R13     SETC  '&JSCB'(2,K'&JSCB-2)    MOVE IN SYMBOL
         AGO   .RRJSCB       GO TO NEXT CHECK
.URJSCB  ANOP  ,
&R13     SETC  '&JSCB'       SET FOR STORAGE SYMBOL
.NRJSCB  ANOP  ,
&R14     SETC  '&R13'        CARRY DOWN
.RRJSCB  AIF   (T'&TCTI EQ 'O').RRTCTI
         AIF   ('&TCTI'(1,1) EQ '[').RRTCTI IGNORE START
&R15     SETC  '&TCTI'       SET LOAD SYMBOL
.RRTCTI  AIF   (T'&TCT NE 'O').RTCT
&R16     SETC  '&R15'        CARRY REGISTER DOWN
         AGO   .NRTCT        GO TO NEXT CHECK
.RTCT    AIF   ('&TCT'(1,1) NE '[').URTCT  USE TCT
&R16     SETC  '&TCT'(2,K'&TCT-2)      MOVE REGISTER
         AGO   .RRTCT        GO TO NEXT CHECK
.URTCT   ANOP  ,
&R16     SETC  '&TCT'        PUT OUT REGISTER
.NRTCT   ANOP  ,
&R17     SETC  '&R16'        CARRY DOWN
.RRTCT   AIF   (T'&TIOT EQ 'O').RRTIOT
         AIF   ('&TIOT'(1,1) EQ '[').RRTIOT IGNORE START
&R18     SETC  '&TIOT'       SET LOAD SYMBOL
.RRTIOT  AIF   (T'&TCBINT NE 'O').TCBI
         AIF   ('&R6' EQ '').RRS6 JUMP IF NO R6
&R7      SETC  '&R6'         SET SAME AS LAST
         AGO   .NRTIOT       GO TO END
.RRS6    AIF   ('&R14' EQ '').RRS14 JUMP IF NO R14
&R7      SETC  '&R14'        SET SAME AS LAST
         AGO   .NRTIOT       GO TO END
.RRS14   AIF   ('&R17' EQ '').RRS17    NEXT LONGEST
&R7      SETC  '&R17'        SET NEXT LONGEST
         AGO   .NRTIOT       TO END OF CHAIN
.RRS17   ANOP  ,             LAST ENTRY IN NODE
&R7      SETC  '&R18'        SET SAME AS LAST
         AGO   .NRTIOT       GO TO END
.TCBI    AIF   ('&TCBINT'(1,1) NE '[').USTCBI USE TCB
&R7      SETC  '&TCBINT'(2,K'&TCBINT-2) MOVE IN SYMBOL
         AGO   .NOTCBI       QUIT
.USTCBI  ANOP  ,
&R7      SETC  '&TCBINT'     SET FOR TCB SYMBOL
.NRTIOT  ANOP  ,             ENTRANCE FOR NULL
&R19     SETC  '&R7'         CARRY SYMBOL DOWN
.NOTCBI  AIF   (T'&TCBSTC NE 'O').TCBSTC
&R20     SETC  '&R19'        CARRY REGISTER DOWN
         AGO   .NLTBSTC      GO TO NEXT CHECK
.TCBSTC  AIF   ('&TCBSTC'(1,1) NE '[').USTBSTC USE TCBSTC
&R20     SETC  '&TCBSTC'(2,K'&TCBSTC-2)  MOVE REGISTER
         AGO   .NOTBSTC      GO TO NEXT CHECK
.USTBSTC ANOP  ,
&R20     SETC  '&TCBSTC'     PUT OUT REGISTER
.NLTBSTC ANOP  ,
&R21     SETC  '&R20'        CARRY DOWN
.NOTBSTC AIF   (T'&TCBRCT NE 'O').TCBRCT
&R22     SETC  '&R21'        CARRY REGISTER DOWN
         AGO   .NLTBRCT      GO TO NEXT CHECK
.TCBRCT  AIF   ('&TCBRCT'(1,1) NE '[').USTBRCT USE TCBRCT
&R22     SETC  '&TCBRCT'(2,K'&TCBRCT-2)  MOVE REGISTER
         AGO   .NOTBRCT      GO TO NEXT CHECK
.USTBRCT ANOP  ,
&R22     SETC  '&TCBRCT'     PUT OUT REGISTER
.NLTBRCT ANOP  ,
&R23     SETC  '&R22'        CARRY DOWN
.NOTCBFT ANOP  ,             ENTRY FOR NOT TCB CHAIN
.NOTBRCT AIF   (T'&ASXB NE 'O').ASXB
&R24     SETC  '&R23'        CARRY REGISTER DOWN
         AGO   .NLASXB       GO TO NEXT CHECK
.ASXB    AIF   ('&ASXB'(1,1) NE '[').USASXB USE ASXB
&R24     SETC  '&ASXB'(2,K'&ASXB-2)    MOVE REGISTER
         AGO   .NOASXB       GO TO NEXT CHECK
.USASXB  ANOP  ,
&R24     SETC  '&ASXB'       PUT OUT REGISTER
.NLASXB  ANOP  ,
&R25     SETC  '&R24'        CARRY DOWN
.NOASXB  AIF   (T'&ASID EQ 'O').NOASID
         AIF   ('&ASID'(1,1) EQ '[').NOASID IGNORE START
&R27     SETC  '&ASID'       SET STORE REGISTER
.NOASID  AIF   (T'&ASCB NE 'O').ASCB
         AIF   ('&R25' EQ '').NOR25    USE ASID INSTEAD
&R26     SETC  '&R25'        CARRY DOWN
         AGO   .NLASCB       TO NEXT CHECK
.NOR25   ANOP  ,
&R26     SETC  '&R27'        CARRY LONGER CHAIN DOWN
         AGO   .NLASCB       TO NEXT CHECK
.ASCB    AIF   ('&ASCB'(1,1) NE '[').USASCB USE ASCB
&R26     SETC  '&ASCB'(2,K'&ASCB-2)    MOVE IN SYMBOL
         AGO   .NOASCB       GO TO NEXT CHECK
.USASCB  ANOP  ,
&R26     SETC  '&ASCB'       SET FOR STORAGE SYMBOL
.NLASCB  ANOP  ,
&R28     SETC  '&R26'        CARRY SYMBOL DOWN
.NOASCB  ANOP  ,
.*       ALL REGISTERS FOR CHAIN 1 ESTABLISHED
.*
.*       PROCESS CHAIN 2, BACK TO FRONT
         AIF   (T'&TCBRCT NE 'O' OR T'&TCBSTC NE 'O' OR T'&TCBINT NE 'O'
               ').TCBFET     JUMP IF TCB CHAIN DONE FOR LCT
         AIF   (T'&OSACT EQ 'O').NOOSACT USE OSACT
         AIF   ('&OSACT'(1,1) EQ '[').NOOSACT IGNORE OSACT
&S1      SETC  '&OSACT'      SET FOR OS ACT
.NOOSACT AIF   (T'&OSJCT NE 'O').OSJCT USE OS JCT
&S2      SETC  '&S1'         CARRY DOWN
         AGO   .NLOSJCT      GO DO REST
.OSJCT   AIF   ('&OSJCT'(1,1) NE '[').USOSJCT START WITH
&S2      SETC  '&OSJCT'(2,K'&OSJCT-2)  MOVE REGISTER
         AGO   .NOOSJCT      JUMP TO NEXT CHECK
.USOSJCT ANOP  ,
&S2      SETC  '&OSJCT'      SET TO PUT VALUE HERE
.NLOSJCT ANOP  ,
&S3      SETC  '&S2'         CARRY DOWN
.NOOSJCT AIF   (T'&OSSCT EQ 'O').NOOSSCT
         AIF   ('&OSSCT' EQ '[').NOOSSCT IGNORE
&S5      SETC  '&OSSCT'      SET REG FOR OS SCT
.NOOSSCT AIF   (T'&LCT NE 'O').LCT
         AIF   ('&S3' EQ '').NOS3 USE OS SCT INSTEAD
&S4      SETC  '&S3'         REGISTER FROM SCT CHAIN
         AGO   .NLLCT        TO NEXT CHECK
.NOS3    ANOP  ,
&S4      SETC  '&S5'         REGISTER FROM JCT CHAIN
         AGO   .NLLCT        TO NEXT CHECK
.LCT     AIF   ('&LCT'(1,1) NE '[').USLCT USE LCT
&S4      SETC  '&LCT'(2,K'&LCT-2)      MOVE IN SYMBOL
         AGO   .NOLCT        GO TO NEXT CHECK
.USLCT   ANOP  ,
&S4      SETC  '&LCT'        SET FOR STORAGE SYMBOL
.NLLCT   ANOP  ,
&S6      SETC  '&S4'         CARRY SYMBOL DOWN
.NOLCT   AIF   (T'&JCT EQ 'O').NOJCT
         AIF   ('&JCT'(1,1) EQ '[').NOJCT IGNORE START
&S8      SETC  '&JCT'        SET LOAD SYMBOL
.****************************** PATTERN FOR STRAIGHT THROUGH CARRY .**
.NOJCT   AIF   (T'&SJB NE 'O').SJB                                 .**
&S9      SETC  '&S8'         CARRY REGISTER DOWN                   .**
         AGO   .NLSJB        GO TO NEXT CHECK                      .**
.SJB     AIF   ('&SJB'(1,1) NE '[').USSJB  USE SJB                 .**
&S9      SETC  '&SJB'(2,K'&SJB-2)      MOVE REGISTER               .**
         AGO   .NOSJB        GO TO NEXT CHECK                      .**
.USSJB   ANOP  ,                                                   .**
&S9      SETC  '&SJB'        PUT OUT REGISTER                      .**
.NLSJB   ANOP  ,                                                   .**
&S10     SETC  '&S9'         CARRY DOWN                            .**
.****************************** PATTERN FOR STRAIGHT THROUGH CARRY .**
.NOSJB   AIF   (T'&SSIB NE 'O').SSIB
&S11     SETC  '&S10'        CARRY REGISTER DOWN
         AGO   .NLSSIB       GO TO NEXT CHECK
.SSIB    AIF   ('&SSIB'(1,1) NE '[').USSSIB USE SSIB
&S11     SETC  '&SSIB'(2,K'&SSIB-2)    MOVE REGISTER
         AGO   .NOSSIB       GO TO NEXT CHECK
.USSSIB  ANOP  ,
&S11     SETC  '&SSIB'       PUT OUT REGISTER
.NLSSIB  ANOP  ,
&S12     SETC  '&S11'        CARRY DOWN
.NOSSIB  AIF   (T'&JSCB NE 'O').JSCB
         AIF   ('&S6' EQ '').NOS6 USE ASID INSTEAD
&S7      SETC  '&S6'         CARRY DOWN
         AGO   .NLJSCB       TO NEXT CHECK
.NOS6    ANOP  ,
&S7      SETC  '&S12'        CARRY LONGER CHAIN DOWN
         AGO   .NLJSCB       TO NEXT CHECK
.JSCB    AIF   ('&JSCB'(1,1) NE '[').USJSCB USE JSCB
&S7      SETC  '&JSCB'(2,K'&JSCB-2)    MOVE IN SYMBOL
         AGO   .NOJSCB       GO TO NEXT CHECK
.USJSCB  ANOP  ,
&S7       SETC  '&JSCB'       SET FOR STORAGE SYMBOL
.NLJSCB  ANOP  ,
&S13     SETC  '&S7'         CARRY SYMBOL DOWN
.NOJSCB  AIF   (T'&TCTI EQ 'O').NOTCTI
         AIF   ('&TCTI'(1,1) EQ '[').NOTCTI IGNORE START
&S15     SETC  '&TCTI'       SET LOAD SYMBOL
.NOTCTI  AIF   (T'&TCT NE 'O').TCT
&S16     SETC  '&S15'        CARRY REGISTER DOWN
         AGO   .NLTCT        GO TO NEXT CHECK
.TCT     AIF   ('&TCT'(1,1) NE '[').USTCT  USE TCT
&S16     SETC  '&TCT'(2,K'&TCT-2)      MOVE REGISTER
         AGO   .NOTCT        GO TO NEXT CHECK
.USTCT   ANOP  ,
&S16     SETC  '&TCT'        PUT OUT REGISTER
.NLTCT   ANOP  ,
&S17     SETC  '&S16'        CARRY DOWN
.NOTCT   AIF   (T'&TIOT EQ 'O').NOTIOT
         AIF   ('&TIOT'(1,1) EQ '[').NOTIOT IGNORE START
&S18     SETC  '&TIOT'       SET LOAD SYMBOL
.TCBFET  ANOP  ,             ENTRY FOR TCB CHAIN DONE IN OTHER
.NOTIOT  AIF   (T'&TQE EQ 'O').NOTQE
         AIF   ('&TQE'(1,1) EQ '[').NOTQE IGNORE START
&S19     SETC  '&TQE'        SET LOAD SYMBOL
.NOTQE   AIF   (T'&RB EQ 'O').NORB
         AIF   ('&RB'(1,1) EQ '[').NORB IGNORE START
&S20     SETC  '&RB'         SET LOAD SYMBOL
.NORB    AIF   (T'&TCB NE 'O').TCB     REGISTER
         AIF   ('&S13' EQ '').NOS13    FIND LONGER CHAIN
&S14     SETC  '&S13'        SET LONGEST
         AGO   .NLTCB        TO END OF CHAIN
.NOS13   AIF   ('&S17' EQ '').NOS17    NEXT LONGEST
&S14     SETC  '&S17'        SET NEXT LONGEST
         AGO   .NLTCB        TO END OF CHAIN
.NOS17   AIF   ('&S18' EQ '').NOS18
&S14     SETC  '&S18'        SET TO CHAIN
         AGO   .NLTCB        TO END OF CHAIN
.NOS18   AIF   ('&S19' EQ '').NOS19
&S14     SETC  '&S19'        SET TO CHAIN
         AGO   .NLTCB        TO END OF CHAIN
.NOS19   ANOP  ,
&S14     SETC  '&S20'        SET FOR LAST CHAIN
         AGO   .NLTCB        TO END OF CHAIN
.TCB     AIF   ('&TCB'(1,1) NE '[').USTCB USE TCB
&S14     SETC  '&TCB'(2,K'&TCB-2) MOVE IN SYMBOL
         AGO   .NOTCB        QUIT
.USTCB   ANOP  ,
&S14     SETC  '&TCB'        SET FOR TCB SYMBOL
.NLTCB   ANOP  ,
&S21     SETC  '&S14'        SET TO BOTH
.NOTCB   ANOP  ,             END OF CHECK
.*       END OF CHAIN 2 PROCESSING
.*
.*       PROCESS CHAIN 3
         AIF   (T'&ACOEF EQ 'O').NOACOEF
         AIF   ('&ACOEF'(1,1) EQ '[').NOACOEF IGNORE START
&T1      SETC  '&ACOEF'      SET LOAD SYMBOL
.NOACOEF AIF   (T'&ACTIM EQ 'O').NOACTIM
         AIF   ('&ACTIM'(1,1) EQ '[').NOACTIM IGNORE START
&T3      SETC  '&ACTIM'      SET LOAD SYMBOL
.NOACTIM AIF   (T'&TUCCVT NE 'O').TUCCVT
         AIF   ('&T1' EQ '').NOT1 USE ASID INSTEAD
&T2      SETC  '&T1'         CARRY DOWN
         AGO   .NLTUCVT      TO NEXT CHECK
.NOT1    ANOP  ,
&T2      SETC  '&T3'         CARRY LONGER CHAIN DOWN
         AGO   .NLTUCVT      TO NEXT CHECK
.TUCCVT  AIF   ('&TUCCVT'(1,1) NE '[').USTUCVT USE TUCCVT
&T2      SETC  '&TUCCVT'(2,K'&TUCCVT-2) MOVE IN SYMBOL
         AGO   .NOTUCVT      GO TO NEXT CHECK
.USTUCVT ANOP  ,
&T2      SETC  '&TUCCVT'     SET FOR STORAGE SYMBOL
.NLTUCVT ANOP  ,
&T4      SETC  '&T2'         CARRY SYMBOL DOWN
.NOTUCVT AIF   (T'&ASVT EQ 'O').NOASVT
         AIF   ('&ASVT'(1,1) EQ '[').NOASVT  IGNORE START
&T6      SETC  '&ASVT'       SET LOAD SYMBOL
.NOASVT  AIF   (T'&FIX EQ 'O').NOFIX
         AIF   ('&FIX'(1,1) EQ '[').NOFIX  IGNORE START
&T7      SETC  '&FIX'        SET LOAD SYMBOL
.********************************* PATTERN FOR A NODE .**.**.**.**.**
.NOFIX   AIF   (T'&CVT NE 'O').CVT                                .**
         AIF   ('&T4' EQ '').NOT4 FIND LONGEST                    .**
&T5      SETC  '&T4'         CARRY REGISTER DOWN                  .**
         AGO   .NLCVT        GO TO NEXT CHECK                     .**
.NOT4    AIF   ('&T6' EQ '').NOT6 FIND LONGEST                    .**
&T5      SETC  '&T6'         CARRY REGISTER DOWN                  .**
         AGO   .NLCVT        GO TO NEXT CHECK                     .**
.NOT6    ANOP  ,             SET LAST POSSIBLE                    .**
&T5      SETC  '&T7'         SET CHAIN ALONG                      .**
         AGO   .NLCVT        GO TO END                            .**
.CVT     AIF   ('&CVT'(1,1) NE '[').USCVT USE CVT                 .**
&T5      SETC  '&CVT'(2,K'&CVT-2)      MOVE REGISTER              .**
         AGO   .NOCVT        GO TO NEXT CHECK                     .**
.USCVT   ANOP  ,                                                  .**
&T5      SETC  '&CVT'        PUT OUT REGISTER                     .**
.NLCVT   ANOP  ,                                                  .**
&T8      SETC  '&T5'         CARRY DOWN                           .**
.********************************* PATTERN FOR A NODE .**.**.**.**.**
.NOCVT   ANOP  ,             END OF CHAIN 3
.*       CHAIN 3 PROCESSING FINISHED
.*
&NAME    DS    0H
.*       DO LOAD STATEMENTS FOR CHAIN 1
         AIF   ('&R28' EQ '').SKPR28   SKIP THIS LOAD
         L     &R28,$$FASCBO      --> ASCB
.SKPR28  AIF   ('&R27' EQ '').SKPR27   SKIP THIS LOAD
         LH    &R27,$$FASID(,&R26) IS THE ASID
.SKPR27  AIF   ('&R25' EQ '').SKPR25   SKIP THIS LOAD
         L     &R25,$$FASXB(,&R26) --> ASXB
.SKPR25  AIF   ('&R23' EQ '').SKPR23   SKIP THIS LOAD
         L     &R23,$$FFTCB(,&R24) --> FIRST TCB (RCT)
.SKPR23  AIF   ('&R21' EQ '').SKPR21   SKIP THIS LOAD
         L     &R21,$$FLTC(,&R22) --> STC INIT TCB (STC)
.SKPR21  AIF   ('&R19' EQ '').SKPR19   SKIP THIS LOAD
         L     &R19,$$FLTC(,&R20) --> ORIGINATOR TCB (INT)
.SKPR19  AIF   ('&R18' EQ '').SKPR18   SKIP THIS LOAD
         L     &R18,$$FTIOT(,&R7) --> TIOT
.SKPR18  AIF   ('&R17' EQ '').SKPR17   SKIP THIS LOAD
         L     &R17,$$FTCT(,&R7)  --> TCT
.SKPR17  AIF   ('&R15' EQ '').SKPR15   SKIP THIS LOAD
         L     &R15,$$FTCTI(,&R16) --> TCTIOTBL
.SKPR15  AIF   ('&R14' EQ '').SKPR14   SKIP THIS LOAD
         L     &R14,$$FJSCB(,&R7) --> JSCB (CURRENT)
         L     &R14,$$FJSCA(,&R14) --> JSCB (ACTIVE)
.SKPR14  AIF   ('&R12' EQ '').SKPR12   SKIP THIS LOAD
         L     &R12,$$FSSIB(,&R13) --> SSIB
.SKPR12  AIF   ('&R10' EQ '').SKPR10   SKIP THIS LOAD
         L     &R10,$$FSJB(,&R11) --> SJB
.SKPR10  AIF   ('&R8' EQ '').SKPR8     SKIP THIS LOAD
         L     &R8,$$FJCT(,&R9)   --> JES2 JCT
.SKPR8   AIF   ('&R6' EQ '').SKPR6     SKIP THIS LOAD
         L     &R6,$$FLCTR4(,&R7) --> LCT
.SKPR6   AIF   ('&R5' EQ '').SKPR5     SKIP THIS LOAD
         L     &R5,$$FOSSCT(,&R4) --> OS SCT
.SKPR5   AIF   ('&R3' EQ '').SKPR3     SKIP THIS LOAD
         L     &R3,$$FOSJCT(,&R4) --> OS JCT
.SKPR3   AIF   ('&R1' EQ '').SKPR1     SKIP THIS LOAD
         L     &R1,$$FOSACT(,&R2) --> OS ACT (-10)
         LA    &R1,16(,&R1)       --> OS ACT
.SKPR1   ANOP  ,             END OF CHAIN 2
.*       LOAD STATMENTS FOR CHAIN 1 FINISHED
.*
.*       DO LOAD STATEMENTS FOR CHAIN 2
         AIF   ('&S21' EQ '').SKPS21   SKIP THIS LOAD
         L     &S21,$$FTCBO       --> CURRENT TCB
.SKPS21  AIF   ('&S20' EQ '').SKPS20   SKIP THIS LOAD
         L     &S20,$$FRB(,&S14)  --> RB
.SKPS20  AIF   ('&S19' EQ '').SKPS19   SKIP THIS LOAD
         L     &S19,$$FTQE(,&S14) --> TQE
.SKPS19  AIF   ('&S18' EQ '').SKPS18   SKIP THIS LOAD
         L     &S18,$$FTIOT(,&S14) --> TIOT
.SKPS18  AIF   ('&S17' EQ '').SKPS17   SKIP THIS LOAD
         L     &S17,$$FTCT(,&S14) --> TCT
.SKPS17  AIF   ('&S15' EQ '').SKPS15   SKIP THIS LOAD
         L     &S15,$$FTCTI(,&S16) --> TCTIOTBL
.SKPS15  AIF   ('&S13' EQ '').SKPS13   SKIP THIS LOAD
         L     &S13,$$FJSCB(,&S14) --> JSCB (CURRENT)
         L     &S13,$$FJSCA(,&S13) --> JSCB (ACTIVE)
.SKPS13  AIF   ('&S12' EQ '').SKPS12   SKIP THIS LOAD
         L     &S12,$$FSSIB(,&S7) --> SSIB
.SKPS12  AIF   ('&S10' EQ '').SKPS10   SKIP THIS LOAD
         L     &S10,$$FSJB(,&S11) --> SJB
.SKPS10  AIF   ('&S8' EQ '').SKPS8     SKIP THIS LOAD
         L     &S8,$$FJCT(,&S9)   --> JES2 JCT
.SKPS8   AIF   ('&S6' EQ '').SKPS6     SKIP THIS LOAD
         L     &S6,$$FQMPI(,&S7)  --> LCT
         B     FND2&SYSNDX        BRANCH AROUND OFFSET
FND1&SYSNDX DC A($$FLCTQ)         LOAD OFFSET TO QMANG AREA
FND2&SYSNDX S  &S6,FND1&SYSNDX    REDUCE TO START OF LCT
.SKPS6   AIF   ('&S5' EQ '').SKPS5     SKIP THIS LOAD
         L     &S5,$$FOSSCT(,&S4) --> OS SCT
.SKPS5   AIF   ('&S3' EQ '').SKPS3     SKIP THIS LOAD
         L     &S3,$$FOSJCT(,&S4) --> OS JCT
.SKPS3   AIF   ('&S1' EQ '').SKPS1     SKIP THIS LOAD
         L     &S1,$$FOSACT(,&S2) --> OS ACT (-10)
         LA    &S1,16(,&S1)       --> OS ACT
.SKPS1   ANOP  ,             END OF CHAIN 2
.*       END OF CHAIN 2 PROCESSING
.*
.*       BEGIN CHAIN 3 PROCESSING
         AIF   ('&T8' EQ '').SKPT8     SKIP THIS LOAD
         L     &T8,$$FCVT         --> CVT
.SKPT8   AIF   ('&T7' EQ '').SKPT7     SKIP THIS LOAD
         L     &T7,$$VPSIB(,&T5)  --> CVTVPSIB (PAGE SERVICES)
.SKPT7   AIF   ('&T6' EQ '').SKPT6     SKIP THIS LOAD
         L     &T6,$$FASVT(,&T5)  --> ASVT
.SKPT6   AIF   ('&T4' EQ '').SKPT4     SKIP THIS LOAD
         L     &T4,$$FVSCVT(,&T5) --> TUCVSCVT
.SKPT4   AIF   ('&T3' EQ '').SKPT3     SKIP THIS LOAD
         L     &T3,$$FACTIM(,&T2) --> TUCACTIM
.SKPT3   AIF   ('&T1' EQ '').SKPT1     SKIP THIS LOAD
         L     &T1,$$FACOEF(,&T2) --> TUCACOEF
.SKPT1   ANOP  ,             END OF CHAIN 3
.*       PROCESSING FINISHED WITH CHAIN 3
.*
         MEND
*
*        ACOEF  = ACCOUNTING COEFFICIENTS POINTED TO BY TUCVSCVT
*        ACTIM  = I/O TIME, JOB CPU TIME, AND PROGRAMMER NAME TABLE
*        ASCB   = ASCB, POINTED TO FROM X'224'
*        ASID   = ASID AS FOUND IN THE ASCB
*        ASVT   = ASVT POINTED TO BY THE CVT
*        ASXB   = ASXB POINTED TO BY ASCB
*        CVT    = CVT, ADDRESS OBTAINED FROM X'10'
*        FIX    = ADDRESS OF PAGE SERVICES (FROM CVT)
*        JCT    = JES2 JCT CHAINED FROM THE ACTIVE JSCB, SSIB, SJB.
*                 EITHER TCB OR TCBINT MAY BE USED TO LOCATE THE JSCB.
*        JSCB   = ACTIVE JSCB FROM EITHER THE TCB OR TCBINIT.
*        LCT    = INITIATOR LCT, OBTAINED EITHER FROM THE TCBINT R4
*                 OR THE JSCB QMANAGER POINTER (MINUS AN OFFSET)
*        OSACT  = OS ACT, POINTED TO BY THE OS JCT
*        OSJCT  = OS JCT, POINTED TO BY THE LCT
*        OSSCT  = OS SCT, POINTED TO BY THE LCT
*        RB     = RB, POINTED TO BY THE TCB
*        SJB    = SJB, POINTED TO BY THE SSIB (SEE JSCB FOR CHAIN)
*        SSIB   = SSIB, POINTED TO BY THE JSCB (SEE JSCB FOR CHAIN)
*        TCB    = THE TCB POINTED TO BY LOCATION X'21C'
*        TCBINT = THE TCB CHAINED FROM THE ASCB, ASXB. WHEN THIS TCB
*                 IS REQUESTED, THEN THE JSCB AND LCT CHAINS (IF
*                 REQUESTED) ARE STARTED FROM THIS REFERENCE.
*                 IF THIS ENTRY IS NOT INCLUDED, THEN THE JSCB,
*                 LCT CHAINS WILL START FROM THE TCB FROM X'21C'.
*        TCBRCT = THE TCB FOR THE REGION CONTROL, POINTED TO BY ASXB
*        TCBSTC = THE TCB FOR THE STC, CHAINED FROM THE RCT TCB.
*        TCT    = SMF TIMING CONTROL TABLE, POINTED TO BY EITHER
*                 THE INITIATOR TCB OR THE STEP TCB.
*        TCTI   = THE IO PORTION OF THE TCT.
*        TIOT   = TIOT FOR THE TCB, EITHER STEP OR TCB INIT.
*        TQE    = THE TQE, POINTED TO FROM THE TCB
*        TUCCVT = TUC VS CVT, POINTED TO BY THE CVT
*
*        THE FOLLOWING CHAINS ARE USED IN THIS MACRO;
*    CHAIN 1                 OFF ASCB OLD
*        X'224'
*        28×
*         ASCB----¼
*        27×26  25×26
*         ASID   ASXB
*               23×24
*               TCBRCT
*               21×22
*               TCBSTC
*               19×20
*               TCBINT---¼------¼------¼
*               18× 7  17× 7  14× 7  6 × 7
*                TIOT   TCT    JSCB   LCT-----¼
*                      15×16  12×13  5 × 4  3 × 4
*                       TCTI   SSIB  OSSCT  OSJCT
*                             10×11         1 × 2
*                              SJB          OSACT
*                             8 × 9
*                              JCT
*
*    CHAIN 2                 OFF TCB OLD
*        X'21C'
*        21×
*         TCB-----¼------¼------¼------¼
*        20×14  19×14  18×14  17×14  13×14
*         RB     TQE    TIOT   TCT    JSCB----¼
*                             15×16  12× 7  6 × 7
*                              TCTI   SSIB   LCT-----¼
*                                    10×11  5 × 4  3 × 4
*                                     SJB   OSSCT  OSJCT
*                                    8 × 9         1 × 2
*                                     JCT          OSACT
*
*    CHAIN 3                 OFF CVT
*         X'10'
*        8 ×
*         CVT-----¼------¼
*        7 × 5  6 × 5  4 × 5
*         FIX    ASVT  TUCCVT---¼
*                      3 × 2  1 × 2
*                      ACTIM  ACOEF
*
*  THE SYMBOLIC REGISTER ON THE LEFT HAND SIDE OF THE '×' IS USED
*   TO INDICATE WHETHER OR NOT THE LOAD INSTRUCTION IS DESIRED.
*  THE CHAIN IS ESTABLISHED FROM LAST TO FIRST USING THE CONTINUING
*   (LONGER) CHAINS TO PROVIDE THE NODES FOR THE BRANCHES.
*  TO ADD A NEW ENTRY, OR A CHAIN OF ENTRIES:
*   A. LOCATE THE POSITION WHERE THE NEW ENTRY BELONGS ON THE
*      CHAINING DIAGRAM.
*   B. IF THE ADDITION IS AN EXTENSION OF AN EXISTING CHAIN THEN
*      ESTABLISH NEW SYMBOLIC REGISTERS FOR THE NEW INSTRUCTIONS
*      BEGINNING WITH THE END OF THE CHAIN AND WORKING FORWARD.
*   C. IF THE ADDITION IS A PARALLEL CHAIN, THEN USE THE RIGHT HAND
*      SYMBOLIC REGISTER NUMBER AS THE RIGHT HAND NUMBER AT THE
*      BEGINNING OF THE NEW CHAIN. FINISH NUMBERING THE REST OF THE
*      CHAIN FROM LAST TO FIRST. FOLLOW THE DIAGRAM FOR THE SSIB TO
*      SJB TO JCT AS AN EXAMPLE. (&S7 IS THE COMMON REGISTER OF THE
*      JSCB BLOCK. THE VALUE OF &S13 WILL EQUAL THE VALUE OF &S7 IF
*      THE CHAIN IS LOADED FROM THE TCB. &S13 WILL BE NULL AND &S7
*      WILL BE THE REGISTER OF THE JSCB IF THE JSCB IS PROVIDED AS
*      A STARTING ADDRESS.)
*   D. CODE THE PROPER SETC AND AIF STATEMENTS TO SET THE NEW SYMBOLIC
*      REGISTERS. USE THE EXISTING STATEMENTS AS A GUIDE. ALSO BUILD
*      UP THE CONDITIONAL LOAD STATEMENTS. THE NEW CODE SHOULD BE
*      PLACED IN THE MACRO IN THE LOGICAL RELATIONSHIP TO THE REST
*      OF THE CHAINS. IE., PUT THE CODE BETWEEN THE INSTRUCTIONS THAT
*      THE CHAINING DIAGRAM INDICATE.
*
*  THE FOLLOWING TABS WERE USED IN THE MAIN PART OF THE MACRO:
*   TAB ON(10,16,30,35,40)
*

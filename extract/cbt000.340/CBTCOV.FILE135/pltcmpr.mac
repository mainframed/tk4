PROC 0 DEBUG
CONTROL NOLIST NOFLUSH NOMSG NOPROMPT
IF &DEBUG NE &STR() THEN +
  CONTROL LIST NOFLUSH MSG CONLIST SYMLIST PROMPT
ATTN +
  DO
    DELETE '&DSPRFX..&DSYS..&TSYS..*'
    FREEALL
    EXIT
  END
IF &SYSPREF EQ &STR() THEN +
  DO
    SET &DSPRFX EQ &SYSUID
  END
ELSE +
  IF &SYSPREF EQ &SYSUID THEN +
    DO
      SET &DSPRFX EQ &SYSUID
    END
  ELSE +
    DO
      SET &DSPRFX EQ &SYSPREF
    END
ISPEXEC CONTROL ERRORS RETURN
FREE F(SYSIN,SYSOUT,SORTIN,SORTOUT,SYSUT1,SYSUT2,SYSPRINT)
SET &RC EQ 0
SET &INDSN1 EQ &STR()
SET &INLR1 EQ &STR()
SET &OUTLR1 EQ &STR()
SET &SRTFLDS1 EQ &STR()
SET &STPOS11 EQ &STR()
SET &FLNGTH11 EQ &STR()
SET &STPOS12 EQ &STR()
SET &FLNGTH12 EQ &STR()
SET &STPOS13 EQ &STR()
SET &FLNGTH13 EQ &STR()
SET &SYNSI11 EQ &STR( SORT FIELDS=COPY )
SET &SYNSI12 EQ &STR()
SET &SYNSI13 EQ &STR()
SET &SYNSIWK1 EQ &STR()
SET &BLKSIZE1 EQ &STR()
SET &LENSUM1 EQ &STR()
SET &INDSN2 EQ &STR()
SET &INLR2 EQ &STR()
SET &OUTLR2 EQ &STR()
SET &SRTFLDS2 EQ &STR()
SET &STPOS11 EQ &STR()
SET &FLNGTH11 EQ &STR()
SET &STPOS21 EQ &STR()
SET &FLNGTH21 EQ &STR()
SET &STPOS22 EQ &STR()
SET &FLNGTH22 EQ &STR()
SET &STPOS23 EQ &STR()
SET &FLNGTH23 EQ &STR()
SET &SYNSI21 EQ &STR( SORT FIELDS=COPY )
SET &SYNSI22 EQ &STR()
SET &SYNSI23 EQ &STR()
SET &SYNSIWK2 EQ &STR()
SET &BLKSIZE2 EQ &STR()
SET &LENSUM2 EQ &STR()
SET &DSYS EQ &STR(D&SUBSTR(1:2,&SYSDATE)&SUBSTR(4:5,&SYSDATE)&SUBSTR(7:+
8,&SYSDATE))
SET &TSYS EQ &STR(T&SUBSTR(1:2,&SYSTIME)&SUBSTR(4:5,&SYSTIME)&SUBSTR(7:+
8,&SYSTIME))
ISPEXEC DISPLAY PANEL(PLTCMPR1)
SET &RC EQ &LASTCC
RESTART: +
IF &RC = 8 THEN +
  DO
    ALLOC F(SYSUT1) NEW DELETE UNIT(VIO) SPACE(4) CYL
    ALLOC F(SYSUT2) NEW DELETE UNIT(VIO) SPACE(4) CYL
    ALLOC F(SYSIN) DA(*)
    ALLOC F(SYSPRINT) DA(*)
    EXIT
  END
WHATIF DATASET('&DSPRFX..&DSYS..&TSYS..SORTOUT1')  CATALOGED
IF &LASTCC EQ 0 THEN +
  DELETE '&DSPRFX..&DSYS..&TSYS..SORTOUT1'
WHATIF DATASET('&DSPRFX..&DSYS..&TSYS..SORTOUT2')  CATALOGED
IF &LASTCC EQ 0 THEN +
  DELETE '&DSPRFX..&DSYS..&TSYS..SORTOUT2'
WHATIF DATASET('&DSPRFX..&DSYS..&TSYS..SYSPRINT')  CATALOGED
IF &LASTCC EQ 0 THEN +
  DELETE '&DSPRFX..&DSYS..&TSYS..SYSPRINT'
IF &STR(&SRTFLDS1) NE &STR() THEN +
  SET &SYNSI11 EQ &STR( SORT FIELDS=&STR(&SRTFLDS1) )
IF &STR(&SRTFLDS2) NE &STR() THEN +
  SET &SYNSI21 EQ &STR( SORT FIELDS=&STR(&SRTFLDS2) )
IF &STPOS11 EQ &STR() THEN +
  DO
    IF &STPOS21 EQ &STR() THEN +
      DO
        ALLOC F(SYSUT1) DA('&INDSN1') SHR
        ALLOC F(SYSUT2) DA('&INDSN2') SHR
        GOTO COMPRTN
      END
  END
IF &STPOS11 EQ &STR() THEN +
  DO
    ALLOC F(SYSUT1) DA('&INDSN1') SHR
    GOTO CHECKDS2
  END
IF &INLR1 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM002) CURSOR(INLR1)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &OUTLR1 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM003) CURSOR(OUTLR1)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &FLNGTH11 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM004) CURSOR(FLNGTH11)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &STPOS12 NE &STR() THEN +
  DO
    IF &FLNGTH12 EQ &STR() THEN +
      DO
        ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM005) CURSOR(FLNGTH12)
        SET &RC EQ &LASTCC
        GOTO RESTART
      END
  END
IF &STPOS13 NE &STR() THEN +
  DO
    IF &FLNGTH13 EQ &STR() THEN +
      DO
        ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM006) CURSOR(FLNGTH13)
        SET &RC EQ &LASTCC
        GOTO RESTART
      END
  END
SET &LENSUM1 EQ &FLNGTH11
IF &FLNGTH12 NE &STR() THEN +
  SET &LENSUM1 EQ &EVAL(&LENSUM1+&FLNGTH12)
IF &FLNGTH13 NE &STR() THEN +
  SET &LENSUM1 EQ &EVAL(&LENSUM1+&FLNGTH13)
IF &LENSUM1 NE &OUTLR1 THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM007) CURSOR(OUTLR1)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
SET &BLKSIZE1 EQ &EVAL((19069/&OUTLR1)*&OUTLR1)
SET &SYNSI12 EQ &STR( RECORD TYPE=F,LENGTH=(&STR(&INLR1)) )
SET &SYNSIWK1 EQ &STR(&STPOS11,&FLNGTH11)
IF &STPOS12 NE &STR() THEN +
  SET &SYNSIWK1 EQ &STR(&SYNSIWK1,&STPOS12,&FLNGTH12)
IF &STPOS13 NE &STR() THEN +
  SET &SYNSIWK1 EQ &STR(&SYNSIWK1,&STPOS13,&FLNGTH13)
SET &SYNSI13 EQ &STR( OUTREC FIELDS=(&SYNSIWK1) )
/*   SORT ROUTINE   */
ERROR OFF
FREE A(A,B,FBSO)
ATTR A RECFM(F B) LRECL(80) BLKSIZE(3120)
ATTR B RECFM(F B) LRECL(121) BLKSIZE(2420)
ATTR FBSO RECFM(F B) LRECL(&OUTLR1) BLKSIZE(&BLKSIZE1)
ALLOC F(SYSIN) NEW DELETE SPACE(1 1) TRACKS USING(A) UNIT(VIO)
ALLOC F(SYSOUT) NEW DELETE SPACE(1 1) TRACKS USING(B) UNIT(VIO)
ALLOC F(SORTIN) DA('&INDSN1') SHR
ALLOC F(SORTOUT) DA('&DSPRFX..&DSYS..&TSYS..SORTOUT1') NEW CATALOG +
  UNIT(SYSTSO) SPACE(100 5) USING(FBSO) TRACKS
OPENFILE SYSIN OUTPUT
SET &SYSIN EQ &STR(&SYNSI11)
PUTFILE SYSIN
SET &SYSIN EQ &STR(&SYNSI12)
PUTFILE SYSIN
SET &SYSIN EQ &STR(&SYNSI13)
PUTFILE SYSIN
CLOSFILE SYSIN
$ SORT
IF &LASTCC NE 0 THEN +
  DO
    ERROR +
      DO
        CLOSFILE SYSOUT
        FREE F(SYSIN,SYSOUT,SORTIN,SORTOUT)
        FREE A(A,B,FBSO)
        ALLOC F(SYSIN) DA(*)
        ALLOC F(SYSPRINT) DA(*)
        DELETE '&DSPRFX..&DSYS..&TSYS..*'
        ISPEXEC CONTROL DISPLAY REFRESH
        EXIT
      END
    ISPEXEC CONTROL DISPLAY LINE START(1)
    OPENFILE SYSOUT INPUT
    GETSOUT1: +
    GETFILE SYSOUT
    WRITE &SYSOUT
    GOTO GETSOUT1
  END
ERROR OFF
FREE F(SYSIN,SYSOUT,SORTIN,SORTOUT)
FREE A(A,B,FBSO)
ALLOC F(SYSUT1) DA('&DSPRFX..&DSYS..&TSYS..SORTOUT1') SHR
CHECKDS2: +
IF  &STPOS21 EQ &STR() THEN +
  DO
    ALLOC F(SYSUT2) DA('&INDSN2') SHR
    GOTO COMPRTN
  END
IF &INLR2 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM002) CURSOR(INLR2)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &OUTLR2 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM003) CURSOR(OUTLR2)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &FLNGTH21 EQ &STR() THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM004) CURSOR(FLNGTH21)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
IF &STPOS22 NE &STR() THEN +
  DO
    IF &FLNGTH22 EQ &STR() THEN +
      DO
        ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM005) CURSOR(FLNGTH22)
        SET &RC EQ &LASTCC
        GOTO RESTART
      END
  END
IF &STPOS23 NE &STR() THEN +
  DO
    IF &FLNGTH23 EQ &STR() THEN +
      DO
        ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM006) CURSOR(FLNGTH23)
        SET &RC EQ &LASTCC
        GOTO RESTART
      END
  END
SET &LENSUM2 EQ &FLNGTH21
IF &FLNGTH22 NE &STR() THEN +
  SET &LENSUM2 EQ &EVAL(&LENSUM2+&FLNGTH22)
IF &FLNGTH23 NE &STR() THEN +
  SET &LENSUM2 EQ &EVAL(&LENSUM2+&FLNGTH23)
IF &LENSUM2 NE &OUTLR2 THEN +
  DO
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM007) CURSOR(OUTLR2)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
SET &BLKSIZE2 EQ &EVAL((19069/&OUTLR2)*&OUTLR2)
SET &SYNSI22 EQ &STR( RECORD TYPE=F,LENGTH=(&STR(&INLR2)) )
SET &SYNSIWK2 EQ &STR(&STPOS21,&FLNGTH21)
IF &STPOS22 NE &STR() THEN +
  SET &SYNSIWK2 EQ &STR(&SYNSIWK2,&STPOS22,&FLNGTH22)
IF &STPOS23 NE &STR() THEN +
  SET &SYNSIWK2 EQ &STR(&SYNSIWK2,&STPOS23,&FLNGTH23)
SET &SYNSI23 EQ &STR( OUTREC FIELDS=(&SYNSIWK2) )
/*   SORT ROUTINE   */
ERROR OFF
FREE A(A,B,FBSO)
ATTR A RECFM(F B) LRECL(80) BLKSIZE(3120)
ATTR B RECFM(F B) LRECL(121) BLKSIZE(2420)
ATTR FBSO RECFM(F B) LRECL(&OUTLR2) BLKSIZE(&BLKSIZE2)
ALLOC F(SYSIN) NEW DELETE SPACE(1 1) TRACKS USING(A) UNIT(VIO)
ALLOC F(SYSOUT) NEW DELETE SPACE(1 1) TRACKS USING(B) UNIT(VIO)
ALLOC F(SORTIN) DA('&INDSN2') SHR
ALLOC F(SORTOUT) DA('&DSPRFX..&DSYS..&TSYS..SORTOUT2') NEW CATALOG +
  UNIT(SYSTSO) SPACE(100 5) USING(FBSO) TRACKS
OPENFILE SYSIN OUTPUT
SET &SYSIN EQ &STR(&SYNSI21)
PUTFILE SYSIN
SET &SYSIN EQ &STR(&SYNSI22)
PUTFILE SYSIN
SET &SYSIN EQ &STR(&SYNSI23)
PUTFILE SYSIN
CLOSFILE SYSIN
$ SORT
IF &LASTCC NE 0 THEN +
  DO
    ERROR +
      DO
        CLOSFILE SYSOUT
        FREE F(SYSIN,SYSOUT,SORTIN,SORTOUT)
        FREE A(A,B,FBSO)
        ALLOC F(SYSIN) DA(*)
        ALLOC F(SYSPRINT) DA(*)
        DELETE '&DSPRFX..&DSYS..&TSYS..*'
        ISPEXEC CONTROL DISPLAY REFRESH
        EXIT
      END
    ISPEXEC CONTROL DISPLAY LINE START(1)
    OPENFILE SYSOUT INPUT
    GETSOUT2: +
    GETFILE SYSOUT
    WRITE &SYSOUT
    GOTO GETSOUT2
  END
ERROR OFF
FREE F(SYSIN,SYSOUT,SORTIN,SORTOUT)
FREE A(A,B,FBSO)
ALLOC F(SYSUT2) DA('&DSPRFX..&DSYS..&TSYS..SORTOUT2') SHR
COMPRTN: +
FREE A(FB121)
ATTR FB121 RECFM(F B A) LRECL(121) BLKSIZE(3993)
ALLOC F(SYSPRINT) DA('&DSPRFX..&DSYS..&TSYS..SYSPRINT') NEW CATALOG +
  UNIT(SYSTSO) SPACE(1 1) USING(FB121) TRACKS
ALLOC F(SYSIN) DUMMY
$ IEBCOMPR
SET &RC EQ &LASTCC
IF &RC EQ 0 THEN +
  DO
    FREE F(SYSIN,SYSPRINT,SYSUT1,SYSUT2)
    FREE A(FB121)
    DELETE '&DSPRFX..&DSYS..&TSYS..*'
    ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM001)
    SET &RC EQ &LASTCC
    GOTO RESTART
  END
FREE F(SYSIN,SYSPRINT,SYSUT1,SYSUT2)
FREE A(FB121)
ISPEXEC BROWSE DATASET('&DSPRFX..&DSYS..&TSYS..SYSPRINT')
DELETE '&DSPRFX..&DSYS..&TSYS..*'
ISPEXEC DISPLAY PANEL(PLTCMPR1) MSG(PLTCM000)
SET &RC EQ &LASTCC
GOTO RESTART
END

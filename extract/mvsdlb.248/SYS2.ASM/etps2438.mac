./  CHANGE NAME=ETPS
**                                                              JW12131
**  5/10/12  BROWSE fixes:                   Juergen Winkelmann JW12131
**           - display current line number                 ETHZ JW12131
**             in title line                                    JW12131
**           - fixed scroll logic bugs                          JW12131
**           - fixed wrong position of ruler line               JW12131
**           - fixed various invalid or missing                 JW12131
**             initializations                                  JW12131
**                                                              JW12131
**  5/10/12  EDIT mixed case support:        Juergen Winkelmann JW12131
**           - PF12/24 toggles between CAPS                ETHZ JW12131
**             and ASIS modes                                   JW12131
**                                                              JW12131
**  5/10/12  EDIT "SCROLL ===>" field        Juergen Winkelmann JW12131
**           support:                                      ETHZ JW12131
**           - PAGE:   Scroll keys move full page               JW12131
**           - HALF:   Scroll keys move half page               JW12131
**           - CSR:    Scroll keys move to cursor position      JW12131
**           - MAX:    Scroll keys move to TOP/BOTTOM once      JW12131
**                     (setting is not made permanent)          JW12131
**           - number: Scroll keys move number of lines         JW12131
**                                                              JW12131
**  5/10/12  Adaption to the MVS 3.8j        Juergen Winkelmann JW12131
**           Tur(n)key distribution                        ETHZ JW12131
**           and a few minor bug and handling fixes:            JW12131
**           - Authorized userids: HERC01, HERC02, IBMUSER      JW12131
**           - Default dataset password: SECRET                 JW12131
**           - Set EXCPFLG1 and EXCPFLG2 to reenable EXCP       JW12131
**             attention exit                                   JW12131
**           - Remove "POST ...,BRANCH=YES" macro and           JW12131
**             code branch entry to POST manually instead       JW12131
**           - Fixed wrong field attributes of the DSNAME       JW12131
**             field in BROWSE and EDIT                         JW12131
**           - Fixed detection of "AID only" situation          JW12131
**             (i.e. no screen modifications were made, so just JW12131
**             an AID and the cursor position are received)     JW12131
**           - Expand logon screen back to 24 lines             JW12131
**             (removed Wayne's reduction from 4/09/85)         JW12131
**           - Minor EDIT fixes (see ETPSEDT3 change log)       JW12131
./ DELETE  SEQ1=05920008,SEQ2=05920008
EXCPFLG1 DC    X'01'     0=STRAIGHT EXCP, 1=ETPS ACCESS METHOD  JW12131
./ DELETE  SEQ1=07070008,SEQ2=07120008
./ DELETE  SEQ1=07170008,SEQ2=07170008
         TITLE 'ETPS - parameters, etc'                         JW12131
./ DELETE  SEQ1=07230008,SEQ2=07630008
./ DELETE  SEQ1=08150008,SEQ2=08150008
         MVI   AIDROW,20           cursor row                   JW12131
./ DELETE  SEQ1=08240008,SEQ2=08240008
         LM    R4,R6,TERMINPT+84     pick up responses          JW12131
./ DELETE  SEQ1=08450008,SEQ2=08450008
         CLC   0(8,R1),SPACES        end of table               JW12131
./ DELETE  SEQ1=08470008,SEQ2=08470008
         CLC   33(8,R4),0(R1)           authorized userid       JW12131
./ DELETE  SEQ1=08490008,SEQ2=08490008
         LA    R1,8(,R1)             bump to next user in table JW12131
./ DELETE  SEQ1=08520008,SEQ2=08520008
         DC    CL8'IBMUSER'          MVS 3.8j ..                JW12131
         DC    CL8'HERC01 '                .. Tur(n)key ..      JW12131
         DC    CL8'HERC02 '                          .. users   JW12131
./ DELETE  SEQ1=08540008,SEQ2=08540008
MASTPASS DC    CL8'SECRET'                                      JW12131
./ DELETE  SEQ1=08560008,SEQ2=08560008
         MVC   USERID(8),33(R4)       save userid               JW12131
./ DELETE  SEQ1=08680008,SEQ2=08680008
         MVC   USERID(8),USERTABL     set USERID=first in table JW12131
./ DELETE  SEQ1=08850008,SEQ2=08850008
./ DELETE  SEQ1=17920008,SEQ2=17920008
         DC    A(LOGSCR20)                                      JW12131
         DC    A(LOGSCR21)                                      JW12131
         DC    A(LOGSCR22)                                      JW12131
         DC    A(LOGSCR23)                                      JW12131
         DC    X'80',AL3(LOGSCR24)                              JW12131
./ DELETE  SEQ1=17940008,SEQ2=17940008
         DC    AL1(80),X'04'         , SBA = 0                  JW12131
./ DELETE  SEQ1=18240008,SEQ2=18240008
LOGSCR14 DC    AL1(76),X'04',CL16'** P   P       '              JW12131
 DC C'                      ×( (×                                 ' 131
LOGSCR15 DC    AL1(76),X'04',CL16'** PPPP        '              JW12131
 DC C'                      ×) )×                                 ' 131
LOGSCR16 DC    AL1(76),X'04',CL16'** P           '              JW12131
 DC C'                      ×( (×                                 ' 131
LOGSCR17 DC    AL1(76),X'04',CL16'** P   ROCESSING'             JW12131
 DC C'                      ×) )×                                 ' 131
LOGSCR18 DC    AL1(76),X'04',CL16'*   '                         JW12131
./ DELETE  SEQ1=18260008,SEQ2=18260008
LOGSCR19 DC    AL1(76),X'04',CL16'**  SS         '              JW12131
./ DELETE  SEQ1=18280008,SEQ2=18290008
LOGSCR20 DC    AL1(17),X'04',CL16'** S           '              JW12131
LOGSCR21 DC    AL1(75),X'04',CL16'**  SS         '              JW12131
./ DELETE  SEQ1=18330008,SEQ2=18330008
LOGSCR22 DC    AL1(75),X'04',CL16'**    S        '              JW12131
./ DELETE  SEQ1=18370008,SEQ2=18370008
LOGSCR23 DC    AL1(77),X'04',CL16'** SSS  YSTEM  '              JW12131
./ DELETE  SEQ1=18410009,SEQ2=18420008
         DC    X'05',CL17'Version 2.4-3.8j '                    JW12131
LOGSCR24 DC    AL1(80),X'04',79C'*'                             JW12131
./ DELETE  SEQ1=19390008,SEQ2=19400009
         DC    CL47' TO TERMINATE ETPS'                         JW12131
         DC    CL16'Version 2.4-3.8j'                           JW12131
./ DELETE  SEQ1=19650008,SEQ2=19650008
         DC    X'04'                                            JW12131
./ DELETE  SEQ1=20140008,SEQ2=20140008
         DC    X'04'                                            JW12131
./ DELETE  SEQ1=33910008,SEQ2=33910008
         LA    R15,0(R1,15)             msg address in buffer   JW12131
./ DELETE  SEQ1=35420008,SEQ2=35420008
EXCPFLG2 DC    X'01'   0=STRAIGHT EXCP, 1=ETPS ACCESS METHOD    JW12131
./ DELETE  SEQ1=39540008,SEQ2=39550008
         C     R5,=F'4'                 AID + Cursor only?      JW12131
         BL    TRETURN                  yes, return             JW12131
./ DELETE  SEQ1=39660008,SEQ2=39670008
         L     R15,TERMOUT+4            get first line on scrn  JW12131
         CLC   5(4,R15),=CL4'EDIT'      is it an EDIT screen?   JW12131
         BNE   REPCAP1                  no, upper-case          JW12131
         LA    R15,8                    data field start column JW12131
         CR    R14,R15                  is it a data field      JW12131
         BNE   REPCAP1                  no, uppercase           JW12131
         CLI   CAPSASIS,C'A'            ASIS requested?         JW12131
         BE    REPASI1                  yes, don't upper-case   JW12131
REPCAP1  EX    R6,REPLYCAP              upper-case the input    JW12131
REPASI1  EX    R6,REPLYMVC              move it into the line   JW12131
./ DELETE  SEQ1=40180008,SEQ2=40190008
         L     R15,TERMOUT+4            get first line on scrn  JW12131
         CLC   5(4,R15),=CL4'EDIT'      is it an EDIT screen?   JW12131
         BNE   REPCAP2                  no, upper-case          JW12131
         LA    R15,8                    data field start column JW12131
         CR    R14,R15                  is it a data field      JW12131
         BNE   REPCAP2                  no, uppercase           JW12131
         CLI   CAPSASIS,C'A'            ASIS requested?         JW12131
         BE    REPASI2                  yes, don't upper-case   JW12131
REPCAP2  EX    R6,REPLYCAP              upper-case the input    JW12131
REPASI2  EX    R6,REPLYMVC              move it into the line   JW12131
./ DELETE  SEQ1=52630008,SEQ2=52640008
*        PRINT GEN                                              JW12131
***                                                             JW12131
*** The MVS 3.8j POST macro doesn't support branch entry,       JW12131
*** so we expand it manually here                               JW12131
***                                                             JW12131
*        POST  (11),ASCB=(13),ERRET=AFTPOST,BRANCH=YES,ECBKEY=0 JW12131
         SR    R10,R10                     set post code        JW12131
         LA    R15,X'800'(R0,R0)           set ..               JW12131
         SLL   R15,20(R0)                   .. cross addr ..    JW12131
         OR    R11,R15                                 .. bit   JW12131
         LA    R12,AFTPOST                 ERRET in R12         JW12131
         LA    R0,16*0                     ECBKEY in R0         JW12131
         OR    R10,R15                     set ECBKEY flag bit  JW12131
         L     R15,16(R0,R0)               get CVT pointer      JW12131
         L     R15,CVT0PT01-CVTMAP(R0,R15) get POST address     JW12131
         BALR  R14,R15                     branch entry         JW12131
./  CHANGE NAME=ETPSBRO3
         ST    R0,COUNT           put zero in count             JW12131
./ DELETE  SEQ1=04120000,SEQ2=04120000
CMDINPUT DC    CL40' '                                          JW12131
./ DELETE  SEQ1=04400002,SEQ2=04400002
         L     R6,TERMTOP          first row                    JW12131
         L     R6,0(,R6)           pick up address of line 1    JW12131
         L     R7,HOLDTOP          restore hold area directory  JW12131
./ DELETE  SEQ1=04440000,SEQ2=04440000
         UNPK  61(5,R6),DOUBLE+5(3)                             JW12131
         LA    R6,2(,R14)                                       JW12131
./ DELETE  SEQ1=05070002,SEQ2=05080000
         MVC   0(2,R6),=X'5105'                                 JW12131
         LA    R6,2(,R6)           point to data line           JW12131
./ DELETE  SEQ1=06430000,SEQ2=06440000
         CLI   PFKFLAG,0           PFkey pressed?               JW12131
         BNE   PFK                 yes, go process              JW12131
./ DELETE  SEQ1=07120000,SEQ2=07130000
./ DELETE  SEQ1=07150002,SEQ2=07150002
         CLI   0(R3),X'00'    anything entered in command line? JW12131
         BNE   CMDENTRD           yes, then use it              JW12131
         MVC   22(40,R3),CMDINPUT no, blank out input field     JW12131
CMDENTRD LA    R14,22(,R3)        address command input field   JW12131
./ DELETE  SEQ1=07850000,SEQ2=07860000
         LA    R14,27(,R3)         point to possible operand    JW12131
         CLC   22(5,R3),=C'DOWN '                               JW12131
./ DELETE  SEQ1=07880000,SEQ2=07880000
         LA    R14,22(,R3)         point to possible operand    JW12131
./ DELETE  SEQ1=07900000,SEQ2=07900000
DOWN14   CLI   0(R14),C'M'         max requested?               JW12131
         BE    BOTTOM              yes, go to the bottom        JW12131
./ DELETE  SEQ1=08920000,SEQ2=08930000
         LA    R14,25(,R3)         point to possible operand    JW12131
         CLC   22(3,R3),=C'UP '                                 JW12131
./ DELETE  SEQ1=08950000,SEQ2=08950000
         LA    R14,22(,R3)         point to possible operand    JW12131
./ DELETE  SEQ1=08970000,SEQ2=08970000
UP14     CLI   0(R14),C'M'         max requested?               JW12131
         BE    TOP                 yes, go to the top           JW12131
./  CHANGE NAME=ETPSEDT3
*                                                               JW12131
*   5/10/12  EDIT mixed case support:        Juergen Winkelmann JW12131
*            - PF12/24 toggles between CAPS                ETHZ JW12131
*              and ASIS modes                                   JW12131
*                                                               JW12131
*   5/10/12  "SCROLL ===>" field support:    Juergen Winkelmann JW12131
*            - PAGE:   Scroll keys move full page          ETHZ JW12131
*            - HALF:   Scroll keys move half page               JW12131
*            - CSR:    Scroll keys move to cursor position      JW12131
*            - MAX:    Scroll keys move to TOP/BOTTOM once      JW12131
*                      (setting is not made permanent)          JW12131
*            - number: Scroll keys move number of lines         JW12131
*                                                               JW12131
*   5/10/12  MVS 3.8 adaption and minor      Juergen Winkelmann JW12131
*            bug and handling fixes:                       ETHZ JW12131
*            - updated help screen                              JW12131
*            - fixed abend S0C4 in SUBMIT processing            JW12131
*            - fixed abend S0C4 when issuing message ETPS1051   JW12131
*            - fixed abend S0C7 when requesting numeric         JW12131
*              scroll amount from command line                  JW12131
*            - fixed incomplete initialization of extra "gas"   JW12131
*              lines, which caused display of garbage lines     JW12131
*              and data corruption                              JW12131
*            - return cursor to home position unless            JW12131
*              it is in a data row                              JW12131
*            - move cursor to the leftmost field position if it JW12131
*              is in a line number field                        JW12131
*            - change userid length in SPFSTOW to 7 characters  JW12131
*            - repositioned MYSAVE macro call to make           JW12131
*              IFOX00 happy                                     JW12131
*                                                               JW12131
         MVI   CAPSASIS,C'C'            initialize CAPS mode    JW12131
*                                                               JW12131
         MVC   EDSCRLS,=CL4'HALF'       initial scroll amount   JW12131
         MVI   EDSCRFLG,0               initialize flag byte    JW12131
         OI    EDSCRFLG,EDSCHALF        request SCROLL HALF     JW12131
*                                                               JW12131
         LA    R1,160                   2 cards                 JW12131
         L     R7,EDTLAST1              end of GETMAINed area   JW12131
         SR    R7,R1                    first filler card       JW12131
         MVI   72(R7),X'00'             indicate blank card     JW12131
         LA    R7,80(,7)                second filler card      JW12131
         MVI   72(R7),X'00'             indicate blank card     JW12131
         CLI   CAPSASIS,C'A'     ASIS mode active?              JW12131
         BE    *+14              yes, go say so                 JW12131
         MVC   12(5,R7),CAPS     indicate CAPS mode             JW12131
         B     *+10              continue                       JW12131
         MVC   12(5,R7),ASIS     indicate ASIS mode             JW12131
*                                                               JW12131
*                                                               JW12131
         MVC   77(4,R8),EDSCRLS  set current scroll amount      JW12131
         NI    EDSCRFLG,X'FF'-EDSCRMAX reset SCROLL MAX flag    JW12131
./ DELETE  SEQ1=01950000,SEQ2=01950000
         LA    R1,3                subtract first 3 rows        JW12131
./ DELETE  SEQ1=02000000,SEQ2=02000000
         LA    R15,80(,R3)      add one line                    JW12131
         CR    R15,R4           more data to display?           JW12131
*                                                               JW12131
         CLI   0(R2),X'4C'         is it PF24                   JW12131
         BE    *+12                yes                          JW12131
         CLI   0(R2),X'7C'         is it PF12                   JW12131
         BNE   *+28                no                           JW12131
         CLI   CAPSASIS,C'A'       ASIS mode active?            JW12131
         BE    *+12                yes, go toggle               JW12131
         MVI   CAPSASIS,C'A'       indicate ASIS mode           JW12131
         B     EDLINES             continue                     JW12131
         MVI   CAPSASIS,C'C'       indicate CAPS mode           JW12131
         B     EDLINES             continue                     JW12131
./ DELETE  SEQ1=03190000,SEQ2=03190000
         LA    R4,TERMINPT+8      pick up SCROLL    (1st scrn)  JW12131
./ DELETE  SEQ1=03230000,SEQ2=03230000
         BNE   EDSCRLN                  nope                    JW12131
./ DELETE  SEQ1=03270000,SEQ2=03270000
         LA    R4,TERMINPT+8(R1)   pick up SCROLL    (2nd scrn) JW12131
*                                                               JW12131
EDSCRLN  DS    0H               pick up SCROLL field            JW12131
*                                                               JW12131
         L     R5,0(,R4)        point to terminal input         JW12131
         CLI   0(R5),X'00'      line changed?                   JW12131
         BE    EDLINES2         no, go check FIND/CHNG          JW12131
*                                                               JW12131
*  set end of field = R14                                       JW12131
*                                                               JW12131
         LA    R14,80(,R5)      set end of SCROLL field         JW12131
*                                                               JW12131
         MVC   EDSCROS,EDSCRLS  remember previous SCROLL field  JW12131
         MVI   EDSCRLS,C' '     clear SCROLL field ..           JW12131
         MVC   EDSCRLS+1(3),EDSCRLS     .. in work area         JW12131
*                                                               JW12131
*  set length of input in SCROLL field                          JW12131
*                                                               JW12131
         LA    R15,4            length of SCROLL field          JW12131
*                                                               JW12131
         CLI   0(R14),X'41'     if not alphanumeric             JW12131
         BH    *+14                                             JW12131
         BCTR  R14,0            decrement base address          JW12131
         BCT   R15,*-10         try previous                    JW12131
         B     EDLINES2         nothing found, check FIND/CHNG  JW12131
*                                                               JW12131
         BCTR  R15,0            decrement for EXecute           JW12131
         EX    R15,SCRMOVE1     move SCROLL field to work area  JW12131
*                                                               JW12131
* evaluate SCROLL field                                         JW12131
*                                                               JW12131
         MVI   EDSCRFLG,0       initialize flag byte            JW12131
         CLI   EDSCRLS,C'P'     scroll whole page?              JW12131
         BNE   EDSCRNP          no, check for half page         JW12131
         MVC   EDSCRLS,=CL4'PAGE' set SCROLL field              JW12131
         OI    EDSCRFLG,EDSCPAGE request SCROLL PAGE            JW12131
         B     EDLINES2         continue                        JW12131
EDSCRNP  CLI   EDSCRLS,C'H'     scroll half page?               JW12131
         BE    EDSCRHP          yes, go set it                  JW12131
         CLI   EDSCRLS,C'C'     scroll to cursor position?      JW12131
         BNE   EDSCRNC          no, check for max               JW12131
         MVC   EDSCRLS,=CL4'CSR' set SCROLL field               JW12131
         OI    EDSCRFLG,EDSCRCSR request SCROLL CSR             JW12131
         B     EDLINES2         continue                        JW12131
EDSCRNC  CLI   EDSCRLS,C'M'     scroll max?                     JW12131
         BE    EDSCRMX          yes, go set it                  JW12131
         MVC   EDDWORD(4),EDSCRLS remember SCROLL field         JW12131
         MVC   EDSCRLS,=CL4'0000'  reinitialize SCROLL field    JW12131
         LA    R15,EDSCRLS+3    address of last char in field   JW12131
         LA    R14,EDDWORD+3    address of last char remembered JW12131
         LA    R5,4             maximum number of digits        JW12131
EDSCRDIG CLI   0(R14),C'0'      is it a digit?                  JW12131
         BL    EDSCRNDG         no, ignore                      JW12131
         OI    EDSCRFLG,EDSCRFND yes, indicate digit found and  JW12131
         MVC   0(1,R15),0(R14)        right justify in field    JW12131
         BCTR  R15,0            address previous char in field  JW12131
EDSCRNDG BCTR  R14,0            address previous original char  JW12131
         BCT   R5,EDSCRDIG      go check it                     JW12131
         TM    EDSCRFLG,EDSCRFND at least one digit found?      JW12131
         BNO   EDSCRHP          no, default to HALF             JW12131
         CLC   EDSCRLS,=CL4'0000' greater than zero?            JW12131
         BE    EDSCRMX          no, default to SCROLL MAX       JW12131
         OI    EDSCRFLG,EDSCRNUM request numeric SCROLL         JW12131
         PACK  EDDWORD(8),EDSCRLS(4) pack SCROLL field          JW12131
         CVB   R5,EDDWORD       convert scroll amount to binary JW12131
         ST    R5,EDSCRAMT      store scroll amount             JW12131
         B     EDLINES2         continue                        JW12131
EDSCRMX  OI    EDSCRFLG,EDSCRMAX request SCROLL MAX             JW12131
         MVC   EDSCRLS,EDSCROS  set SCROLL field to old value   JW12131
         B     EDLINES2         continue                        JW12131
EDSCRHP  MVC   EDSCRLS,=CL4'HALF' set SCROLL field              JW12131
         OI    EDSCRFLG,EDSCHALF request SCROLL HALF            JW12131
         LA    R4,4(,4)           pick up FIND/CHNG strings     JW12131
./ DELETE  SEQ1=03380007,SEQ2=03380007
         LA    R14,40(,R5)      set end of field                JW12131
         BCTR  R15,0            decrement for EXecute           JW12131
SCRMOVE1 MVC   EDSCRLS(1),77(R5)  to be executed (SCROLL field) JW12131
         BCTR  R15,0            decrement for EXecute           JW12131
./ DELETE  SEQ1=03840000,SEQ2=03860000
./ DELETE  SEQ1=04050000,SEQ2=04050000
         LA    R1,3               subtract first 3 rows         JW12131
./ DELETE  SEQ1=05560007,SEQ2=05590000
*                                                               JW12131
         L     R6,SCROWS1        pick up number of rows         JW12131
         CLI   SPLIT,2           am I in split screen           JW12131
         BNE   *+8               nope, just use it              JW12131
         L     R6,SCROWS2        must be screen 2               JW12131
         LA    R1,3              subtract first 3 rows          JW12131
         SR    R6,R1             max lines on screen            JW12131
         XR    R0,R0             clear R0 for multiply          JW12131
         LA    R1,80             LRECL in memory times ..       JW12131
         MR    R0,R6              .. screen size ..             JW12131
         LA    R1,80(,R1)         .. plus **EOF* line ..        JW12131
         ST    R1,EDFULLPG        .. is a full screen of data   JW12131
         L     R1,EDTLAST1       end of file minus begin ..     JW12131
         S     R1,EDTFIRST         .. of file is file size      JW12131
         C     R1,EDFULLPG       does file fit on one screen?   JW12131
         BH    *+12              no, go enable scrolling        JW12131
         NI    EDSCRFLG,X'FF'-EDSCENBL disable scrolling        JW12131
         B     *+8               continue                       JW12131
         OI    EDSCRFLG,EDSCENBL enable scrolling               JW12131
         TM    EDSCRFLG,EDSCENBL   is scrolling possible?       JW12131
         BNO   NOSCROLL            no, don't scroll             JW12131
./ DELETE  SEQ1=05980000,SEQ2=05980000
NOSCROLL CLC   EDCOMMND(7),=C'RFIND  '                          JW12131
         CLI   AIDROW,3            is cursor in data row?       JW12131
         BNL   EDDTACSR            yes, go check column         JW12131
         MVI   AIDROW,1            move cursor to home row      JW12131
         MVI   AIDCOL,21           move cursor to home column   JW12131
         B     EDTSHOW             continue                     JW12131
EDDTACSR CLI   AIDCOL,7            is cursor in data field      JW12131
         BH    EDTSHOW             yes, leave it alone          JW12131
         MVI   AIDCOL,1            no, move to start of ..      JW12131
*                                   .. line number field        JW12131
*                                                               JW12131
./ DELETE  SEQ1=07280000,SEQ2=07280000
         BNE   EDRESCR            just display the changed line JW12131
./ DELETE  SEQ1=07300000,SEQ2=07300000
         B     EDRESCR            just display the changed line JW12131
./ DELETE  SEQ1=07360000,SEQ2=07360000
         B     EDRESCR             re-display                   JW12131
./ DELETE  SEQ1=07420000,SEQ2=07420000
         B     EDRESCR             re-display                   JW12131
./ DELETE  SEQ1=07560000,SEQ2=07560000
         BE    EDMORSCR         no, just bump default           JW12131
./ DELETE  SEQ1=07590000,SEQ2=07590000
         BE    EDMORSCR         no, just bump default           JW12131
./ DELETE  SEQ1=07650000,SEQ2=07650000
         BL    EDMORSCR         just bump default               JW12131
./ DELETE  SEQ1=07780000,SEQ2=07780000
         BZ    EDMORSCR         just bump default               JW12131
FWRDNUM  LR    R15,R1           forward SCROLL R1 lines         JW12131
         AR    R1,R6             add one page                   JW12131
         LA    R1,1(,R1)         add one line                   JW12131
./ DELETE  SEQ1=07870000,SEQ2=07870000
./ DELETE  SEQ1=07890000,SEQ2=07900000
         BH    EDMORMAX          bottom of data reached         JW12131
         LR    R1,R15            number of lines back in R1     JW12131
         XR    R0,R0             clear R0                       JW12131
         LA    R14,80            LRECL in memory ..             JW12131
         MR    R0,R14             .. times number of lines ..   JW12131
         A     R1,EDTCURR1        .. is new position            JW12131
         ST    R1,EDTCURR1       scroll data                    JW12131
         LR    R1,R15            number of lines back in R1     JW12131
         XR    R0,R0             clear R0                       JW12131
         IC    R0,AIDROW         get cursor row                 JW12131
         LA    R15,2             number of header lines         JW12131
         CR    R0,R15            is cursor in header?           JW12131
         BNH   CSRHOME           yes, send it home              JW12131
         CLI   R1,0              will data be scrolled at all?  JW12131
         BE    EDRESCR           no, just re-display            JW12131
         SR    R0,R1             subtract scroll amount         JW12131
         CR    R0,R15            can cursor be scrolled?        JW12131
         BNH   CSRHOME           no, send it home               JW12131
         STC   R0,AIDROW         yes, scroll cursor             JW12131
         B     EDTSHOW           display                        JW12131
CSRHOME  MVI   AIDROW,1          move cursor to home row        JW12131
         MVI   AIDCOL,21         move cursor to home column     JW12131
         B     EDTSHOW           display                        JW12131
./ DELETE  SEQ1=07920000,SEQ2=08000000
NUMPACK  PACK  EDDWORD(8),22(1,R3)                              JW12131
EDMORSCR DS    0H                                               JW12131
*                   bump the screen as defined in SCROLL field  JW12131
         TM    EDSCRFLG,EDSCRMAX scroll max requested?          JW12131
         BO    EDMORMAX          yes, do it                     JW12131
         TM    EDSCRFLG,EDSCRNUM numeric scroll requested?      JW12131
         BNO   FWRDCSR           no, check cursor               JW12131
         L     R1,EDSCRAMT       yes, load scroll amount ..     JW12131
         B     FWRDNUM            .. and do it                  JW12131
FWRDCSR  TM    EDSCRFLG,EDSCRCSR scroll to cursor requested?    JW12131
         BNO   FWRDPAGE          no, check page                 JW12131
         XR    R1,R1             clear R1                       JW12131
         IC    R1,AIDROW         get cursor row                 JW12131
         LA    R0,3              number of header lines         JW12131
         CR    R1,R0             scroll one page if cursor ..   JW12131
         BNH   FWRDCSRP           .. is in header or first line JW12131
         SR    R1,R0             compute scroll amount ..       JW12131
         B     FWRDNUM            .. and do it                  JW12131
FWRDCSRP LR    R1,R6             number of data lines on screen JW12131
         B     FWRDNUM           scroll and check cursor        JW12131
FWRDPAGE LR    R1,R6             number of data lines on screen JW12131
         TM    EDSCRFLG,EDSCPAGE scroll one page requested?     JW12131
         BNO   FWRDHALF          no, default to half page       JW12131
         B     FWRDNUM           scroll one page                JW12131
FWRDHALF SRL   R1,1              divide by two                  JW12131
         B     FWRDNUM           scroll half page               JW12131
./ DELETE  SEQ1=08030000,SEQ2=08080000
*                   bump the screen and backup one page         JW12131
         L     R1,EDTLAST1       end of file minus a full ..    JW12131
         S     R1,EDFULLPG        .. page minus current ..      JW12131
         S     R1,EDTCURR1        .. line is scroll byte amount JW12131
         XR    R0,R0             clear R0                       JW12131
         LA    R15,80            LRECL in memory                JW12131
         DR    R0,R15            divide and ..                  JW12131
         B     FWRDNUM            .. scroll to the bottom       JW12131
./ DELETE  SEQ1=08120000,SEQ2=08120000
         BE    EDPRESCR         no, just bump default           JW12131
./ DELETE  SEQ1=08150000,SEQ2=08150000
         BE    EDPRESCR         no, just bump default           JW12131
./ DELETE  SEQ1=08210000,SEQ2=08210000
         BE    EDPRESCR         no, just bump default           JW12131
./ DELETE  SEQ1=08340000,SEQ2=08340000
         BE    EDPRESCR         no, just bump default           JW12131
BACKNUM  LR    R15,R1            backward SCROLL R1 lines       JW12131
./ DELETE  SEQ1=08460000,SEQ2=08460000
./ DELETE  SEQ1=08480000,SEQ2=08570000
         BL    EDPREMAX          top of data reached            JW12131
         ST    R1,EDTCURR1       scroll data                    JW12131
         LR    R1,R15            number of lines back in R1     JW12131
         XR    R0,R0             clear R0                       JW12131
         IC    R0,AIDROW         get cursor row                 JW12131
         LA    R15,2             number of header lines         JW12131
         CR    R0,R15            is cursor in header?           JW12131
         BNH   CSRHOME           yes, send it home              JW12131
         CLI   R1,0              will data be scrolled at all?  JW12131
         BE    EDRESCR           no, just re-display            JW12131
         AR    R0,R1             add scroll amount              JW12131
         AR    R15,R6            number of data lines on screen JW12131
         CR    R15,R0            can cursor be scrolled?        JW12131
         BL    CSRHOME           no, send it home               JW12131
         STC   R0,AIDROW         yes, scroll cursor             JW12131
         B     EDTSHOW           display                        JW12131
EDPRESCR DS    0H                                               JW12131
*                 back up the screen as defined in SCROLL field JW12131
         TM    EDSCRFLG,EDSCRMAX scroll max requested?          JW12131
         BO    EDPREMAX          yes, do it                     JW12131
         TM    EDSCRFLG,EDSCRNUM numeric scroll requested?      JW12131
         BNO   BACKCSR           no, check cursor               JW12131
         L     R1,EDSCRAMT       yes, load scroll amount ..     JW12131
         B     BACKNUM            .. and do it                  JW12131
BACKCSR  TM    EDSCRFLG,EDSCRCSR scroll to cursor requested?    JW12131
         BNO   BACKPAGE          no, check page                 JW12131
         XR    R0,R0             clear R0                       JW12131
         IC    R0,AIDROW         get cursor row                 JW12131
         LA    R1,2              number of header lines         JW12131
         CR    R0,R1             scroll one page if cursor  ..  JW12131
         BNH   BACKCSRP           .. is in header               JW12131
         AR    R1,R6             number of data lines on screen JW12131
         CR    R1,R0             scroll one page if cursor  ..  JW12131
         BNH   BACKCSRP           .. is in last line            JW12131
         SR    R1,R0             compute scroll amount ..       JW12131
         B     BACKNUM            .. and do it                  JW12131
BACKCSRP LR    R1,R6             number of data lines on screen JW12131
         B     BACKNUM           scroll and check cursor        JW12131
BACKPAGE LR    R1,R6             number of data lines on screen JW12131
         TM    EDSCRFLG,EDSCPAGE scroll one page requested?     JW12131
         BNO   BACKHALF          no, default to half page       JW12131
         B     BACKNUM           scroll and check cursor        JW12131
BACKHALF SRL   R1,1              divide by two                  JW12131
         B     BACKNUM           scroll half page               JW12131
./ DELETE  SEQ1=08590000,SEQ2=08600000
         L     R1,EDTCURR1       current line minus first ..    JW12131
         S     R1,EDTFIRST        .. line is scroll byte amount JW12131
         XR    R0,R0             clear R0                       JW12131
         LA    R15,80            LRECL in memory                JW12131
         DR    R0,R15            divide and ..                  JW12131
         B     BACKNUM            .. scroll to the top          JW12131
./ DELETE  SEQ1=08720000,SEQ2=08730000
         MVC   SUBRB(SUBLENG),SUBCONRB initialize DYNALLOC RB   JW12131
         LA    R1,SUBRB     \                                   JW12131
         ST    R1,SUBSUBP    \                                  JW12131
         OI    SUBSUBP,X'80'  \                                 JW12131
         LA    R1,SUBTEXT1     \                                JW12131
         ST    R1,SUBTEXTA      \                               JW12131
         LA    R1,SUBDDNAM       \                              JW12131
         ST    R1,SUBTEXT1        \                             JW12131
         LA    R1,SUBCLS           \ //SUBJOB DD FREE=CLOSE,    JW12131
         ST    R1,SUBTEXT2         / //       SYSOUT=(A,INTRDR) JW12131
         LA    R1,SUBFRE          /                             JW12131
         ST    R1,SUBTEXT3       /                              JW12131
         LA    R1,SUBPGM        /                               JW12131
         ST    R1,SUBTEXT4     /                                JW12131
         OI    SUBTEXT4,X'80' /                                 JW12131
         LA    R1,SUBSUBP    /                                  JW12131
         DYNALLOC           /                                   JW12131
./ DELETE  SEQ1=10510015,SEQ2=10510015
         MVC   MSGBUFF+8(5),EDTSAVMM                            JW12131
./ DELETE  SEQ1=10730000,SEQ2=10730000
         MVI   MSGBUFF,C' '                                     JW12131
         MVC   MSGBUFF+1(19),MSGBUFF                            JW12131
         MVC   MSGBUFF(18),WTOMS51+17                           JW12131
         LA    R1,MSGBUFF                                       JW12131
./ DELETE  SEQ1=10770000,SEQ2=10770000
         MVI   MSGBUFF,C' '                                     JW12131
         MVC   MSGBUFF+1(19),MSGBUFF                            JW12131
         MVC   MSGBUFF(19),WTOMS61+17                           JW12131
         LA    R1,MSGBUFF                                       JW12131
CAPS     DC    C'CAPS '                                         JW12131
ASIS     DC    C'asis '                                         JW12131
*                                                               JW12131
         DS    0F        DYNALLOC request block skeleton        JW12131
SUBCONRB DC    X'14'     length = 20                            JW12131
         DC    X'01'     \                                      JW12131
         DC    X'00'      --> flags                             JW12131
         DC    X'00'     /                                      JW12131
         DC    8F'0'     addcons to be initialized at runtime   JW12131
         DC    X'0001'   \                                      JW12131
         DC    X'0001'    \                                     JW12131
         DC    X'0006'     \                                    JW12131
         DC    CL8'SUBJOB'  \                                   JW12131
         DC    X'0018'       \                                  JW12131
         DC    X'0001'        \                                 JW12131
         DC    X'0001'         \ //SUBJOB DD SYSOUT=(A,INTRDR), JW12131
         DC    CL2'A'          / //          FREE=CLOSE         JW12131
         DC    X'0019'        /                                 JW12131
         DC    X'0001'       /                                  JW12131
         DC    X'0006'      /                                   JW12131
         DC    CL8'INTRDR' /                                    JW12131
         DC    X'001C'    /                                     JW12131
         DC    X'0000'   /                                      JW12131
SUBLENG  EQU   *-SUBCONRB length of skeleton for MVC            JW12131
./ DELETE  SEQ1=11050000,SEQ2=11050000
         DC    CL4' '                                           JW12131
./ DELETE  SEQ1=11150000,SEQ2=11160007
         DC    CL24' '                                          JW12131
./ DELETE  SEQ1=11270011,SEQ2=11270011
./ DELETE  SEQ1=11310011,SEQ2=11310011
         DC    A(EDTBLANK)                                      JW12131
./ DELETE  SEQ1=11350011,SEQ2=11350011
         DC    A(EDTBLANK)                                      JW12131
./ DELETE  SEQ1=11400011,SEQ2=11400011
         DC    A(EHC)                                           JW12131
         DC    A(EHD)                                           JW12131
         DC    A(EDTBLANK)                                      JW12131
         DC    A(EHE)                                           JW12131
         DC    A(EHF)                                           JW12131
         DC    A(EDTBLANK)                                      JW12131
         DC    A(EHG)                                           JW12131
         DC    A(EHH)                                           JW12131
         DC    A(EHI)                                           JW12131
         DC    A(EHJ)                                           JW12131
         DC    A(EHK+X'80000000')                               JW12131
./ DELETE  SEQ1=11470011,SEQ2=11570011
EH2 DC AL1(45),X'04',CL46'Command line commands are:                 '
EH3 DC AL1(46),X'04',CL47' ABEND-S0C1   SAVE-save current END-end save'
EH4 DC AL1(45),X'04',CL46' SUB---submit CAN--end nosave   F---find   '
EH5 DC AL1(45),X'04',CL46' C-----change                              '
EH6 DC AL1(45),X'04',CL46'Line prefix commands are:                  '
EH7 DC AL1(45),X'04',CL46' D-delete line   R-repeat line  C-copy line'
EH8 DC AL1(45),X'04',CL46' A-after (used with copy)                  '
EH9 DC AL1(45),X'04',CL46'Note that line prefix commands must not be '
EHA DC AL1(45),X'04',CL46'mixed, except for copy-after. Do not delete'
EHB DC AL1(45),X'04',CL46'and repeat lines on the same screen, nor   '
EHC DC AL1(45),X'04',CL46'copy and delete/repeat lines on the same   '
EHD DC AL1(45),X'04',CL46'screen.                                    '
EHE DC AL1(45),X'04',CL46'SCROLL field:                              '
EHF DC AL1(45),X'04',CL46' Enter HALF, PAGE, CSR, MAX or a number    '
EHG DC AL1(45),X'04',CL46'PFkey assignments:                         '
EHH DC AL1(46),X'04',CL47' PF01-help        PF02-split   PF03-end save'
EHI DC AL1(45),X'04',CL46' PF04-end nosave  PF05-rfind   PF06-change '
EHJ DC AL1(45),X'04',CL46' PF07-backward    PF08-forward PF09-swap   '
EHK DC AL1(45),X'04',CL46' PF12-toggle caps                          '
./ DELETE  SEQ1=11620000,SEQ2=11620000
         MYSAVE   ,                                             JW12131
./ DELETE  SEQ1=12350000,SEQ2=12350000
         MVC   SPFUID(7),0(R4)    USERID                        JW12131
./  CHANGE NAME=ETPSMACS
*                                                               JW12131
EDSCRAMT DS    F        current scroll amount (binary)          JW12131
EDFULLPG DS    F        number of bytes on a full EDIT screen   JW12131
*                                                               JW12131
EDSCRLS  DS    CL4      current scroll amount (text)            JW12131
EDSCROS  DS    CL4      previous scroll amount (text)           JW12131
EDSCRFLG DS    X        scroll flags                            JW12131
EDSCRMAX EQU   B'10000000' SCROLL MAX requested                 JW12131
EDSCRNUM EQU   B'01000000' numeric SCROLL requested             JW12131
EDSCRCSR EQU   B'00100000' SCROLL CSR requested                 JW12131
EDSCPAGE EQU   B'00010000' SCROLL PAGE requested                JW12131
EDSCHALF EQU   B'00001000' SCROLL HALF requested                JW12131
EDSCRRSV EQU   B'00000100' reserved                             JW12131
EDSCENBL EQU   B'00000010' enable scrolling                     JW12131
EDSCRFND EQU   B'00000001' digit (0-9) found in SCROLL field    JW12131
*                                                               JW12131
SUBSUBP  DS    F        DYNALLOC parameter for submit command   JW12131
SUBRB    DS    2F       request block for INTRDR allocation     JW12131
SUBTEXTA DS    F        pointer to SUBTEXT1                     JW12131
         DS    2F                                               JW12131
SUBTEXT1 DS    F        pointer to DDNAME                       JW12131
SUBTEXT2 DS    F        pointer to SYSOUT CLASS                 JW12131
SUBTEXT3 DS    F        pointer to FREE=CLOSE                   JW12131
SUBTEXT4 DS    F        pointer to INTRDR                       JW12131
SUBDDNAM DS    7H       \                                       JW12131
SUBCLS   DS    4H        \ //SUBJOB DD SYSOUT=(A,INTRDR),       JW12131
SUBPGM   DS    7H        / //          FREE=CLOSE               JW12131
SUBFRE   DS    2H       /                                       JW12131
ACBWORK  DS    XL(ACBSIZ) work area for GENCB ACB               JW12131
RPLWORK  DS    XL(RPLSIZ) work area for GENCB RPL               JW12131
MODWORK  DS    XL(MODSIZ) work area for MODCB RPL               JW12131
SUBACB   DS    F        ACB for submit command                  JW12131
SUBRPL   DS    F        RPL for submit command                  JW12131
./ DELETE  SEQ1=02220000,SEQ2=02400000
./  CHANGE NAME=ETPSTSO
**                                                              JW12131
** Updated 5/10/12 - Authorization through RAC added.           JW12131
**   On systems with resource access control active the ETPSTSO JW12131
**   command is executed only if the user has read access to    JW12131
**   profile ETPSAUTH in the FACILITY class.                    JW12131
**                                                              JW12131
./ DELETE  SEQ1=00550009,SEQ2=00550009
         L     R3,CVTPTR        * get CVT address               JW12131
         ICM   R3,B'1111',CVTSAF(R3) SAFV defined ?             JW12131
         BZ    GOAHEAD          * no RAC, go execute            JW12131
         USING SAFV,R3          * addressability of SAFV        JW12131
         CLC   SAFVIDEN(4),SAFVID SAFV initialized ?            JW12131
         BNE   GOAHEAD          * no RAC, go execute            JW12131
         DROP  R3               * SAFV no longer needed         JW12131
         RACHECK ENTITY=ETPSAUTH,CLASS='FACILITY',ATTR=READ     JW12131
         LTR   R15,R15          * RAC authorization granted?    JW12131
         BNZ   RETURN           * no, exit                      JW12131
GOAHEAD  LOAD  EP=ETPS          * load ETPS                     JW12131
./ DELETE  SEQ1=00620009,SEQ2=00620009
        DELETE EP=ETPS          * delete ETPS                   JW12131
ETPSAUTH DC    CL39'ETPSAUTH'   * facility name to authorize    JW12131
SAFVID   DC    CL4'SAFV'        * SAFV eye catcher              JW12131
         CVT   DSECT=YES                                        JW12131
         IHAPSA ,                                               JW12131
CVTSAF   EQU   248 CVTSAF doesn't exist but is a reserved field in 3.8J
         ICHSAFV  DSECT=YES     * map SAFV                      JW12131

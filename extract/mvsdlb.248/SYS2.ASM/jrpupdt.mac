./ CHANGE NAME=JRPAMAC
./ DELETE  SEQ1=00110000,SEQ2=00110000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00150000,SEQ2=00150000
*              MODIFIED = 10/26/13                              JW13299
J1DRPLL  DS    F                   length of RPL for FREEMAIN   JW13299
J1DNIBL  DS    F                   length of NIB for FREEMAIN   JW13299
J1DRETWT DS    F                   retry wait time              JW13299
./ CHANGE NAME=JRPDMAC
./ DELETE  SEQ1=00110000,SEQ2=00110000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00150000,SEQ2=00150000
*              MODIFIED = 10/26/13                              JW13299
J1DRPLL  DS    F                   length of RPL for FREEMAIN   JW13299
J1DNIBL  DS    F                   length of NIB for FREEMAIN   JW13299
J1DRETWT DS    F                   retry wait time              JW13299
./ CHANGE NAME=JRPTMAC
./ DELETE  SEQ1=00180000,SEQ2=00190000
J1TUID   DC    CL8' '                                           JW13299
         DC    X'11C84A',X'1DF8'      *EOL*  ROW 7  COL 43      JW13299
./ DELETE  SEQ1=00310000,SEQ2=00310000
         DC    X'F5C3115D7F',X'1DF02842F5'                      JW13299
./ DELETE  SEQ1=00350000,SEQ2=00510000
J1DCMDSV DC    CL8'         '                                   JW13299
CLERDATA DC    XL8'115A501DF02842F5'                            JW13299
         DC    C'1=UNSOL   2=NOUNSOL 3=LOGOFF   4=$DU      5=$SU      6X
               =$PU     PA1=WRAP'                               JW13299
CLERDAT2 DC    XL8'115B601DF02842F5'                            JW13299
         DC    C'7=$DPRT4  8=$SPRT4  9=$PPRT4  10=$CPRT4  11=$EPRT4  12X
               =ALTSCN  PA2=NOWRAP'                             JW13299
CLERDATL EQU   *-CLERDATA                                       JW13299
J1DENDSC DC    X'115CF01DF02842F7'                              JW13299
         DC    C'Enter JRP command ==>'                         JW13299
         DC    X'2902C04042F613'                                JW13299
J1DCMDLN DC    50C' ',X'1DF011'                                 JW13299
J1DADD1  DC    X'C150'                                          JW13299
         DC    X'1DF02842F4'                                    JW13299
J1DAREA1 DC    80C' ',X'11'                                     JW13299
J1DADD2  DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
J1DAREA2 DC    80C' '                                           JW13299
J1DOUTL2 EQU   *-J1DOUTBF              length of narrow screen  JW13299
         ORG   J1DAREA1                now for the wide screen  JW13299
         DC    132C' ',X'11'                                    JW13299
J1DADD5  DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
J1DAREA5 DC    132C' '                                          JW13299
J1DOUTL5 EQU   *-J1DOUTBF              length of wide screen    JW13299
         DS    0F                                               JW13299
J1DOUTLN DS    H                       default to narrow screen JW13299
MOREDATA DC    XL10'F1C3115B601DF02842F2'                       JW13299
         DC    CL12'More...     '                               JW13299
J1D80    DC    80C' ',X'11'            narrow screen skeleton   JW13299
         DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
         DC    80C' '                                           JW13299
J1D80L   EQU   *-J1D80                                          JW13299
J1D132   DC    132C' ',X'11'           wide screen skeleton     JW13299
         DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
         DC    132C' '                                          JW13299
J1D132L  EQU   *-J1D132                                         JW13299
J1DM2    DS    0F                                               JW13299
./ DELETE  SEQ1=00560000,SEQ2=00570000
         DC    X'5A505B605CF0',C'TEND'                          JW13299
J1DM3    DS    0F                                               JW13299
         DC    X'C150C260C3F0C540C650'                          JW13299
         DC    X'C760C8F04A404B504C60'                          JW13299
         DC    X'4DF04F405050D160D2F0'                          JW13299
         DC    X'D440D550D660D7F0D940'                          JW13299
         DC    X'5A505B605CF05E405F50'                          JW13299
         DC    X'606061F0E340E450E560'                          JW13299
         DC    X'E6F0',C'TEND'                                  JW13299
J1DM4    DS    0F                                               JW13299
./ DELETE  SEQ1=00630000,SEQ2=00630000
         DC    X'606061F0E340E450E560'                          JW13299
./ DELETE  SEQ1=00660000,SEQ2=00670000
         DC    X'F350F460',C'TEND'                              JW13299
J1DM5    DS    0F                                               JW13299
         DC    X'C2C4C4C8C64CC8504AD4'                          JW13299
         DC    X'4CD84E5C5060D2E4D4E8'                          JW13299
         DC    X'D66CD8F05AF45CF85E7C'                          JW13299
         DC    X'6140E3C4E5C8E74CE950'                          JW13299
         DC    X'6BD46DD86F5CF160F3E4'                          JW13299
         DC    X'F5E8',C'TEND'                                  JW13299
J1DADTB2 DS    F                   secondary screen's addresses JW13299
J1DCOLS2 DS    F                   secondary screen's columns   JW13299
J1DCOLM2 DS    F                   secondary screen's send size JW13299
./ DELETE  SEQ1=00950000,SEQ2=00950000
J1DUSERL DS    X                   length of userid for RAC     JW13299
J1DUSER  DS    CL8                                              JW13299
J1DPSWDL DS    X                   length of userid for RAC     JW13299
J1DRCRE  RACINIT ENVIR=CREATE,MF=L create RAC environment       JW13299
J1DRCHK  RACHECK ATTR=READ,MF=L    check authorization          JW13299
J1DRDEL  RACINIT ENVIR=DELETE,MF=L delete RAC environment       JW13299
./ CHANGE NAME=JRP100
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
*             MODIFIED = 10/26/13                               JW13299
*                JW  - 10/26/13 - Various fixes and updates     JW13299
               SF=(E,P1DATACH)       continuation line adjusted JW13299
         ATTACH  EP=JRP120,PARAM=((R7),(R8),(R6),(R2)),ECB=(R5),       X
               SF=(E,P1DATACH)       continuation line adjusted JW13299
./ CHANGE NAME=JRP120
./ DELETE  SEQ1=00090000,SEQ2=00090000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00130000,SEQ2=00130000
*              MODIFIED = 10/26/13                              JW13299
./ DELETE  SEQ1=00190000,SEQ2=00190000
*                PASS INFO TO P110 VIA LINK,ATTACH JRP200 SUBTASK,    *
./ DELETE  SEQ1=02040000,SEQ2=02040000
               AREALEN=256,ECB=(R6),RTYPE=(DFSYN,DFASY)         JW13299
*                                                               JW13299
**     get length of data received                              JW13299
*                                                               JW13299
         LA    R8,QRLENGTH                 target for length    JW13299
         SHOWCB AM=VTAM,RPL=(R5),FIELDS=(RECLEN),                      X
               AREA=(R8),LENGTH=4          inspect RPL          JW13299
         LTR   R15,R15                     result ok?           JW13299
         BNZ   P1FATALF                    no, get out of here  JW13299
*                                                               JW13299
**     only PFkeys not handled in JRP121 are taken care of here JW13299
*                                                               JW13299
         CLI   P1DINPUT,X'F3'              PF3 pressed?         JW13299
         BNE   CHKPF12                     no, go check PF12    JW13299
         MVC   P1DINPUT+6(6),=C'LOGOFF'    LOGOFF               JW13299
         B     P1PROCSS                                         JW13299
CHKPF12  CLI   P1DINPUT,X'7C'              PF12 pressed         JW13299
         BNE   P1PROCSS                    no, go process       JW13299
         MVC   P1DINPUT+6(6),=C'ALTSCN'    ALTSCN               JW13299
         CLI   P1DINPUT,X'88'              query reply?         JW13299
         BE    P1CMDCLL                    yes, skip translate  JW13299
./ DELETE  SEQ1=02530000,SEQ2=02530000
*                                                               JW13299
**     process query reply                                      JW13299
*                                                               JW13299
         CLI   P1DINPUT,X'88'    query reply?                   JW13299
         BNE   CHKCMD            no, go check command           JW13299
         LA    R10,P1DINPUT+1    point past the AID             JW13299
         L     R8,QRLENGTH       get data length                JW13299
         SLR   R9,R9             clear for inserts              JW13299
         BCT   R8,QUERYPRS       decrement for AID              JW13299
         B     TRM32782          just in case the AID was it    JW13299
QUERYPRS CLI   2(R10),X'81'      query reply ID?                JW13299
         BNE   NXTSBFLD          no, ignore this structured fld JW13299
         CLI   3(R10),X'A6'      query reply implicit partition JW13299
         BE    QUERYIMP          yes, process it                JW13299
NXTSBFLD ICM   R9,3,0(R10)       load structured field length   JW13299
         SR    R8,R9             subtract it from data length   JW13299
         BNP   TRM32782          end of query structured fields JW13299
         AR    R10,R9            point to next sub-field        JW13299
         B     QUERYPRS          examine it                     JW13299
QUERYIMP CLI   1(R10),17         length less than seventeen?    JW13299
         BL    TRM32782          yes, ignore                    JW13299
         CLI   6(R10),11         parameter lng less than eleven JW13299
         BL    TRM32782          yes, ignore                    JW13299
         CLI   7(R10),1          implicit partition sizes?      JW13299
         BE    CHK32783          yes, check for model 3 screen  JW13299
TRM32782 XC    J1DADTBL(24),J1DADTBL clear everything           JW13299
         LA    R10,J1DM2         get address table              JW13299
         ST    R10,J1DADTBL      primary screen                 JW13299
         ST    R10,J1DADTB2      alternate screen               JW13299
         MVI   J1DCOLS+3,X'50'   set line length                JW13299
         MVI   J1DCOLS2+3,X'50'  alternate screen line length   JW13299
         MVI   J1DCOLM1+3,X'4F'  set send length                JW13299
         MVI   J1DCOLM2+3,X'4F'  alternate screen send length   JW13299
         B     P1CMRST           receive next input             JW13299
CHK32783 CLI   14(R10),X'50'     80 columns?                    JW13299
         BNE   CHK32785          no, check for model 5 screen   JW13299
         CLI   16(R10),X'20'     32 lines?                      JW13299
         BNE   CHK32784          no, check for model 4 screen   JW13299
         XC    J1DADTBL(24),J1DADTBL clear everything           JW13299
         LA    R10,J1DM2         get address table              JW13299
         ST    R10,J1DADTBL      primary screen                 JW13299
         LA    R10,J1DM3         get address table              JW13299
         ST    R10,J1DADTB2      alternate screen               JW13299
         MVI   J1DCOLS+3,X'50'   set line length                JW13299
         MVI   J1DCOLS2+3,X'50'  alternate screen line length   JW13299
         MVI   J1DCOLM1+3,X'4F'  set send length                JW13299
         MVI   J1DCOLM2+3,X'4F'  alternate screen send length   JW13299
         B     P1CMRST           receive next input             JW13299
CHK32784 CLI   16(R10),X'2B'     43 lines?                      JW13299
         BNE   TRM32782          no, assume model 2 screen      JW13299
         XC    J1DADTBL(24),J1DADTBL clear everything           JW13299
         LA    R10,J1DM2         get address table              JW13299
         ST    R10,J1DADTBL      primary screen                 JW13299
         LA    R10,J1DM4         get address table              JW13299
         ST    R10,J1DADTB2      alternate screen               JW13299
         MVI   J1DCOLS+3,X'50'   set line length                JW13299
         MVI   J1DCOLS2+3,X'50'  alternate screen line length   JW13299
         MVI   J1DCOLM1+3,X'4F'  set send length                JW13299
         MVI   J1DCOLM2+3,X'4F'  alternate screen send length   JW13299
         B     P1CMRST           receive next input             JW13299
CHK32785 CLI   14(R10),X'84'     132 columns?                   JW13299
         BNE   TRM32782          no, assume model 2 screen      JW13299
         CLI   16(R10),X'1B'     27 lines?                      JW13299
         BNE   TRM32782          no, assume model 2 screen      JW13299
         XC    J1DADTBL(24),J1DADTBL clear everything           JW13299
         LA    R10,J1DM2         get address table              JW13299
         ST    R10,J1DADTBL      primary screen                 JW13299
         LA    R10,J1DM5         get address table              JW13299
         ST    R10,J1DADTB2      alternate screen               JW13299
         MVI   J1DCOLS+3,X'50'   set line length                JW13299
         MVI   J1DCOLS2+3,X'84'  alternate screen line length   JW13299
         MVI   J1DCOLM1+3,X'4F'  set send length                JW13299
         MVI   J1DCOLM2+3,X'83'  alternate screen send length   JW13299
         B     P1CMRST           receive next input             JW13299
*                                                               JW13299
**     command entered, analyze and execute                     JW13299
*                                                               JW13299
CHKCMD   CLC   P1DINPUT+6(5),=C'RESET'                          JW13299
./ DELETE  SEQ1=02820000,SEQ2=02820000
** set command line, PFKey lines, last line and data line       JW13299
./ DELETE  SEQ1=02840000,SEQ2=03050000
P1PRISC  DS    0H                                               JW13299
         MVI   CLEAR,X'F5'       erase write is CLEAR           JW13299
         LA    R10,J1DM2         get model 2 address table      JW13299
         ST    R10,J1DADTBL      primary screen                 JW13299
         MVI   J1DCOLS+3,X'50'   set line length                JW13299
         MVI   J1DCOLM1+3,X'4F'  set send length                JW13299
         B     P1CMNSCN                                         JW13299
P1ALTSC  DS    0H                                               JW13299
         MVI   CLEAR,X'7E'       erase write alternate is CLEAR JW13299
         MVC   J1DADTBL(12),J1DADTB2 initialize alternate sizes JW13299
         L     R10,J1DADTBL      get address table              JW13299
         LA    R8,J1DM2          model 2 address table          JW13299
         CR    R8,R10            alternate defined as model 2?  JW13299
         BE    P1PRISC           yes, use primary               JW13299
P1CMNSCN DS    0H                                               JW13299
         MVI   P1DINPUT,X'6D'              ;CLEAR AID BYTE      JW13299
SCNLOOP  CLC   2(4,R10),=C'TEND'           ;END OF SCREEN TABLE JW13299
         BE    J1CSETS                     ;YEH, GO SET IT UP   JW13299
         LA    R10,2(R10)                  ;NO BUMP AGAIN       JW13299
         B     SCNLOOP                                          JW13299
J1CSETS  DS    0H                                               JW13299
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    J1C80             yes, use narrow skeleton       JW13299
         LA    R8,J1DOUTL5       no, use wide skeleton          JW13299
         MVC   J1DAREA1(100),J1D132 copy first part of skeleton JW13299
         MVC   J1DAREA1+100(J1D132L-100),J1D132+100 second part JW13299
         MVI   J1DAREA5,C'-'     prime separator line           JW13299
         MVC   J1DAREA5+1(130),J1DAREA5 fill separator line     JW13299
         B     J1CWIDTH          go common                      JW13299
J1C80    LA    R8,J1DOUTL2       use narrow skeleton            JW13299
         MVC   J1DAREA1(J1D80L),J1D80 copy skeleton             JW13299
         MVI   J1DAREA2,C'-'     prime separator line           JW13299
         MVC   J1DAREA2+1(78),J1DAREA2 fill separator line      JW13299
J1CWIDTH STH   R8,J1DOUTLN       store length for send          JW13299
         MVC   J1DENDSC+1(2),0(R10)        ;SET COMMAND LINE    JW13299
         S     R10,=F'2'                   ;FIND MORE DATA LINE JW13299
         MVC   MOREDATA+3(2),0(R10)        ;SET MOREDATA LINE   JW13299
         MVC   CLERDAT2+1(2),0(R10)        set PFKey data ln 2  JW13299
         S     R10,=F'2'                   find PFKey data ln 1 JW13299
         MVC   CLERDATA+1(2),0(R10)        set PFKey data ln 1  JW13299
         B     P1CKLCLS                                         JW13299
./ DELETE  SEQ1=03370000,SEQ2=03390000
         MVC   AREA(8),J1DUSER-J1TWA(R7)                        JW13299
         MVI   AREA+8,C'/'                                      JW13299
         MVC   AREA+9(8),J1DPSWD                                JW13299
./ DELETE  SEQ1=04960000,SEQ2=04970000
P1DINPUT DC    256C' '                                          JW13299
QRLENGTH DS    F                                                JW13299
./ DELETE  SEQ1=06310000,SEQ2=06310000
** initialize primary and alternate screen as model 2,          JW13299
** just in case WSF QUERY isn't supported                       JW13299
./ DELETE  SEQ1=06330000,SEQ2=06400000
         XC      J1DADTBL(24),J1DADTBL         clear everything JW13299
         LA      R10,J1DM2                     get address tbl  JW13299
         ST      R10,J1DADTBL                  primary screen   JW13299
         ST      R10,J1DADTB2                  alternate screen JW13299
         MVI     J1DCOLS2+3,X'50'              alternate screen JW13299
./ DELETE  SEQ1=06440000,SEQ2=06620000
         MVI     J1DCOLM2+3,X'4F'              alternate screen JW13299
         MVC     J1TUID(8),J1SCMDSV      blank user id          JW13299
         MVC     J1TPWD(8),J1SCMDSV      blank password         JW13299
./ DELETE  SEQ1=06680000,SEQ2=06690000
         INQUIRE RPL=(R6),OPTCD=LOGONMSG,AREA=J1DTXT,AREALEN=80,       X
               ACB=(R3),NIB=(R5)                                JW13299
./ DELETE  SEQ1=06750000,SEQ2=06750000
         LA      R4,8                    changed to 8 bytes     JW13299
./ DELETE  SEQ1=06820000,SEQ2=06830000
         CLI     0(R2),C' '              end of data ???        JW13299
./ DELETE  SEQ1=06850000,SEQ2=06850000
         CLI     0(R2),C'/'              is there a password    JW13299
./ DELETE  SEQ1=06890000,SEQ2=06900000
         LA      R4,8                    changed to 8 bytes SKV+JW13299
         B       *+10                    skip move              JW13299
CONTLOOP MVC     0(1,R1),0(R2)           move one byte          JW13299
         LA      R1,1(R1)                ;JUST INCREMENT REGS   JW13299
./ DELETE  SEQ1=06990000,SEQ2=06990000
*                                                               JW13299
** ask this guy what he can do for us and check for RC=0        JW13299
*                                                               JW13299
         SEND  RPL=(R6),AREA=QUERY,RECLEN=LQUERY,CHAIN=ONLY,           X
               RESPOND=(EX,NFME,NRRN),BRACKET=(BB,NEB),                X
               OPTCD=(SYN,CA)                                   JW13299
         LTR   R15,R15                                          JW13299
         BNZ   FREEMAIN                                         JW13299
*                                                               JW13299
         MVC     J1DTXT(8),J1TUID        move user id and ..    JW13299
         MVC     J1DTXT+11(8),J1TPWD      .. passwd to msg area JW13299
./ DELETE  SEQ1=07050000,SEQ2=07060000
         SEND  RPL=(R6),AREA=(R7),RECLEN=(R10),BRACKET=(NBB,EB),       X
               OPTCD=(SYN,CA),RESPOND=(EX,FME)                  JW13299
./ DELETE  SEQ1=07280000,SEQ2=07290000
         DC    CL8' '                                           JW13299
         DC    X'11C84A',X'1DF8'     *EOL*  ROW 7 COL 43        JW13299
./ DELETE  SEQ1=07410000,SEQ2=07410000
         DC    X'F5C31140401DF02842F5'                          JW13299
./ DELETE  SEQ1=07450000,SEQ2=07610000
J1SCMDSV DC    CL8'         '                                   JW13299
CLERDT1  DC    XL8'115A501DF02842F5'                            JW13299
         DC    C'1=UNSOL   2=NOUNSOL 3=LOGOFF   4=$DU      5=$SU      6X
               =$PU     PA1=WRAP'                               JW13299
CLERDT2  DC    XL8'115B601DF02842F5'                            JW13299
         DC    C'7=$DPRT4  8=$SPRT4  9=$PPRT4  10=$CPRT4  11=$EPRT4  12X
               =ALTSCN  PA2=NOWRAP'                             JW13299
CLERDT1L EQU   *-CLERDT1                                        JW13299
J1SENDSC DC    X'115CF01DF02842F7'                              JW13299
         DC    C'Enter JRP command ==>'                         JW13299
         DC    X'2902C04042F613'                                JW13299
         DC    50C' ',X'1DF011'                                 JW13299
J1SADD1  DC    X'C150'                                          JW13299
         DC    X'1DF02842F4'                                    JW13299
J1SAREA1 DC    80C' ',X'11'                                     JW13299
J1SADD2  DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
J1SAREA2 DC    80C' '                                           JW13299
J1SOUTL2 EQU   *-J1SOUTBF              length of narrow screen  JW13299
         ORG   J1SAREA1                now for the wide screen  JW13299
         DS    CL132,XL1                                        JW13299
J1SADD5  DS    XL2                                              JW13299
         DS    XL5                                              JW13299
J1SAREA5 DS    CL132                                            JW13299
J1SOUTL5 EQU   *-J1SOUTBF              length of wide screen    JW13299
         DS    0F                                               JW13299
J1SOUTLN DC    AL2(J1SOUTL2)           default to narrow screen JW13299
MOREDAT1 DC    XL10'F1C3115B601DF02842F2'                       JW13299
         DC    CL12'More...     '                               JW13299
J1S80    DC    80C' ',X'11'            narrow screen skeleton   JW13299
         DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
         DC    80C' '                                           JW13299
J1S80L   EQU   *-J1S80                                          JW13299
J1S132   DC    132C' ',X'11'           wide screen skeleton     JW13299
         DC    X'C260'                                          JW13299
         DC    X'1DF02842F7'                                    JW13299
         DC    132C' '                                          JW13299
J1S132L  EQU   *-J1S132                                         JW13299
J1SM2    DS    0F                                               JW13299
./ DELETE  SEQ1=07660000,SEQ2=07670000
         DC    X'5A505B605CF0',C'TEND'                          JW13299
J1SM3    DS    0F                                               JW13299
         DC    X'C150C260C3F0C540C650'                          JW13299
         DC    X'C760C8F04A404B504C60'                          JW13299
         DC    X'4DF04F405050D160D2F0'                          JW13299
         DC    X'D440D550D660D7F0D940'                          JW13299
         DC    X'5A505B605CF05E405F50'                          JW13299
         DC    X'606061F0E340E450E560'                          JW13299
         DC    X'E6F0',C'TEND'                                  JW13299
J1SM4    DS    0F                                               JW13299
./ DELETE  SEQ1=07730000,SEQ2=07730000
         DC    X'606061F0E340E450E560'                          JW13299
./ DELETE  SEQ1=07760000,SEQ2=07780000
         DC    X'F350F460',C'TEND'                              JW13299
./ DELETE  SEQ1=07800000,SEQ2=07900000
         DC    X'C2C4C4C8C64CC8504AD4'                          JW13299
         DC    X'4CD84E5C5060D2E4D4E8'                          JW13299
         DC    X'D66CD8F05AF45CF85E7C'                          JW13299
         DC    X'6140E3C4E5C8E74CE950'                          JW13299
         DC    X'6BD46DD86F5CF160F3E4'                          JW13299
         DC    X'F5E8',C'TEND'                                  JW13299
J1SEND   EQU   *                                                JW13299
QUERY    DC    X'F3000501FF02'           WSF QUERY              JW13299
LQUERY   EQU   *-QUERY                   length of WSF QUERY    JW13299
./ CHANGE NAME=JRP121
./ DELETE  SEQ1=00090000,SEQ2=00090000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00130000,SEQ2=00130000
*              MODIFIED = 10/26/13                              JW13299
./ DELETE  SEQ1=01240000,SEQ2=01260000
         CLI  J1DTXT1,X'6D'              clear key flag on ??   JW13299
         BNE  CHKPF1                     no, see if PF1         JW13299
*        B    CHKPF1                     bypass clear screen    JW13299
./ DELETE  SEQ1=02020000,SEQ2=02160000
PF01CMD  DC   CL80'UNSOL               '                        JW13299
PF02CMD  DC   CL80'NOUNSOL             '                        JW13299
PF03CMD  DC   CL80'LOGOFF              '                        JW13299
PF04CMD  DC   CL80'$DU                 '                        JW13299
PF05CMD  DC   CL80'$SU                 '                        JW13299
PF06CMD  DC   CL80'$PU                 '                        JW13299
PF07CMD  DC   CL80'$DPRT4              '                        JW13299
PF08CMD  DC   CL80'$SPRT4              '                        JW13299
PF09CMD  DC   CL80'$PPRT4              '                        JW13299
PF10CMD  DC   CL80'$CPRT4              '                        JW13299
PF11CMD  DC   CL80'$EPRT4              '                        JW13299
PF12CMD  DC   CL80'ALTSCN              '                        JW13299
PA01CMD  DC   CL80'WRAP                '                        JW13299
PA02CMD  DC   CL80'NOWRAP              '                        JW13299
         MVI   J1DAREA1-1,C'6'           command echo is yellow JW13299
         MVI   J1DAREA1-1,C'4'           return to green output JW13299
         CLC   J1DHLD(6),=C'LOGOFF'      was this a LOGOFF cmd  JW13299
         BE    P1CMPOK                   yeh, gotta tell him OK JW13299
         B     CKHELP                    disabled, doesn't work JW13299
./ DELETE  SEQ1=06790000,SEQ2=06790000
         CLC   8(4,R14),=C'TEND'                                JW13299
./ DELETE  SEQ1=06810000,SEQ2=06810000
         CLC   10(4,R14),=C'TEND'                               JW13299
./ DELETE  SEQ1=06830000,SEQ2=06840000
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    *+18              yes, use narrow geometry       JW13299
         MVI   J1DAREA5,C' '     prime separator line           JW13299
         MVC   J1DAREA5+1(130),J1DAREA5 clear separator line    JW13299
         B     NOBUMP            go common                      JW13299
         MVI   J1DAREA2,C' '     prime separator line           JW13299
         MVC   J1DAREA2+1(78),J1DAREA2 clear separator line     JW13299
./ DELETE  SEQ1=06870000,SEQ2=06880000
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    *+18              yes, use narrow geometry       JW13299
         MVI   J1DAREA5,C'-'     prime separator line           JW13299
         MVC   J1DAREA5+1(130),J1DAREA5 fill separator line     JW13299
         B     *+14              go common                      JW13299
         MVI   J1DAREA2,C'-'     prime separator line           JW13299
         MVC   J1DAREA2+1(78),J1DAREA2 fill separator line      JW13299
./ DELETE  SEQ1=06960000,SEQ2=06970000
         SEND  RPL=(R2),OPTCD=(SYN,SPEC,CA),AREA=MOREDATA,RECLEN=22,   X
               CHAIN=ONLY,STYPE=REQ,CHNGDIR=CMD,BRACKET=(NBB,NEB) 13288
./ DELETE  SEQ1=07080000,SEQ2=07090000
SENDBACK MVC   CLERDATA-2(2),=X'F1C3'        insert WRITE & WCC JW13299
         SEND  RPL=(R2),OPTCD=(SYN,SPEC,CA),AREA=CLERDATA-2,           X
               CHAIN=ONLY,STYPE=REQ,BRACKET=(NBB,NEB),CHNGDIR=CMD,     X
               RECLEN=CLERDATL+2                                JW13299
         MVC   CLERDATA-2(1),CLERDATA-3      remove WRITE ..    JW13299
         MVI   CLERDATA-1,C' '                         .. & WCC JW13299
./ DELETE  SEQ1=07140000,SEQ2=07170000
NOBUMP   MVI   J1DAREA1,C' '     prime output line              JW13299
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    J1C80             yes, use narrow geometry       JW13299
         MVC   J1DAREA1+1(130),J1DAREA1 clear output line       JW13299
         MVC   J1DADD5(2),2(R14) set separator line address     JW13299
         B     J1CWIDTH          go common                      JW13299
J1C80    MVC   J1DAREA1+1(78),J1DAREA1 clear output line        JW13299
         MVC   J1DADD2(2),2(R14) set separator line address     JW13299
J1CWIDTH MVC   J1DADD1(2),0(R14) set output line address        JW13299
./ DELETE  SEQ1=07220000,SEQ2=07220000
         LH    R6,J1DOUTLN                                      JW13299
         BCTR  R6,R0             decrement address              JW13299
         LA    R5,1(,R5)         increment length               JW13299
./ CHANGE NAME=JRP122
./ DELETE  SEQ1=00090000,SEQ2=00090000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00130000,SEQ2=00130000
*              MODIFIED = 10/26/13                              JW13299
./ DELETE  SEQ1=01050000,SEQ2=01060000
         MVC   J1DUSER(8),J1DTXT                                JW13299
         CLI   J1DTXT+11,C' '                                   JW13299
./ DELETE  SEQ1=01080000,SEQ2=01080000
         MVC   J1DPSWD(8),J1DTXT+11                             JW13299
./ DELETE  SEQ1=01130000,SEQ2=01130000
         MVC   J1TUID(8),J1DUSER                                JW13299
./ DELETE  SEQ1=01250000,SEQ2=01270000
         MVC   JTWTO901+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO901+51(7),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO901+64(2),=C'20'    SET RC                  JW13299
         LA    R5,J1TRQBF                                       JW13299
         LA    R6,J1TRQBFL                                      JW13299
         MVC   J1TERRLN(80),JTUNERR                             JW13299
         B     P1TLGERR                                         JW13299
./ DELETE  SEQ1=01480000,SEQ2=01510000
         MVC   JTWTO900+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO900+49(1),=C'('                             JW13299
         MVC   JTWTO900+50(8),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO900+58(1),=C')'                             JW13299
./ DELETE  SEQ1=01700000,SEQ2=01700000
         LH    R6,J1DOUTLN                                      JW13299
./ DELETE  SEQ1=01730000,SEQ2=01760000
         LA    R1,JTWTO901              POINT TO OUR MESSAGE    JW13299
         MVC   JTWTO901+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO901+51(7),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO901+64(2),=C'08'    SET RC                  JW13299
./ DELETE  SEQ1=01970000,SEQ2=02000000
         LA    R1,JTWTO901              POINT TO OUR MESSAGE    JW13299
         MVC   JTWTO901+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO901+51(7),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO901+64(2),=C'04'    SET RC                  JW13299
./ DELETE  SEQ1=02210000,SEQ2=02240000
         LA    R1,JTWTO901              POINT TO OUR MESSAGE    JW13299
         MVC   JTWTO901+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO901+51(7),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO901+64(2),=C'16'    SET RC                  JW13299
./ DELETE  SEQ1=02420000,SEQ2=02420000
         MVC   J1TERRLN(80),JTAUERR                             JW13299
./ DELETE  SEQ1=02450000,SEQ2=02480000
         LA    R1,JTWTO901              POINT TO OUR MESSAGE    JW13299
         MVC   JTWTO901+19(8),J1DUSER   SET USERNAME IN MSG     JW13299
         MVC   JTWTO901+51(7),J1TLUID   SET VTAM LU NAME IN MSG JW13299
         MVC   JTWTO901+64(2),=C'12'    SET RC                  JW13299
./ DELETE  SEQ1=02920000,SEQ2=02920000
JSAUERR  DC    CL80'JRP005T - NOT AUTHORIZED FOR JRP'           JW13299
JSUNERR  DC    CL80'JRP006T - CONDITION UKNOWN..TERMINATING'    JW13299
./ DELETE  SEQ1=02940000,SEQ2=02970000
JSWTO900 WTO   'JRP900I - USER XXXXXXXX HAS LOGGED ON TO JRP  12345678 X
                 ',ROUTCDE=(8,9),MF=L                           JW13299
JSWTO901 WTO   'JRP901I - USER XXXXXXXX INVALID LOGON ATTEMPT (1234567)X
                 RC=XX ',ROUTCDE=(8,9),MF=L                     JW13299
./ DELETE  SEQ1=03100000,SEQ2=03100000
JTAUERR  DC    CL80'JRP005T - NOT AUTHORIZED FOR JRP'           JW13299
JTUNERR  DC    CL80'JRP006T - CONDITION UKNOWN..TERMINATING'    JW13299
./ DELETE  SEQ1=03120000,SEQ2=03150000
JTWTO900 WTO   'JRP900I - USER XXXXXXXX HAS LOGGED ON TO JRP  12345678 X
                 ',ROUTCDE=(8,9),MF=L                           JW13299
JTWTO901 WTO   'JRP901I - USER XXXXXXXX INVALID LOGON ATTEMPT (1234567)X
                 RC=XX ',ROUTCDE=(8,9),MF=L                     JW13299
./ CHANGE NAME=JRP123
./ DELETE  SEQ1=00080000,SEQ2=00080000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00120000,SEQ2=00120000
*              MODIFIED = 10/26/13                              JW13299
./ DELETE  SEQ1=00750000,SEQ2=00750000
*             CHANGE ACTIVITY = 10/26/13 RACified               JW13299
*                               10/26/13 sample code removed    JW13299
./ DELETE  SEQ1=00820000,SEQ2=00900000
./ DELETE  SEQ1=00960000,SEQ2=00970000
UINV     EQU   4                         RAC flag: invalid user JW13299
PINV     EQU   8                         RAC flag: invalid pswd JW13299
*                                                               JW13299
./ DELETE  SEQ1=01090000,SEQ2=01090000
*            J1DUSER  8 BYTE USERID FIELD                       JW13299
*                                                               JW13299
./ DELETE  SEQ1=01170000,SEQ2=01390000
         L     R1,CVTPTR                 get CVT address        JW13299
         ICM   R1,B'1111',CVTSAF(R1)     SAFV defined ?         JW13299
         BZ    RTNOK                     no RAC, allow logon    JW13299
         USING SAFV,R1                   addressability of SAFV JW13299
         CLC   SAFVIDEN(4),SAFVID        SAFV initialized?      JW13299
         BNE   RTNOK                     no RAC, allow logon    JW13299
         DROP  R1                        SAFV no longer needed  JW13299
         TR    J1DUSER(8),TR00TO40       pad userid with blanks JW13299
         LA    R1,8                      maximum userid length  JW13299
         LA    R3,J1DUSER                get userid address     JW13299
         TRT   J1DUSER(8),FNDBLANK       find first blank       JW13299
         BZ    *+10                      no blank, skip compute JW13299
         SR    R1,R3                     compute userid length  JW13299
         BZ    RTNBUSR                   no userid entered      JW13299
         STC   R1,J1DUSERL               store length for RAC   JW13299
         TR    J1DPSWD(8),TR00TO40       pad passwd with blanks JW13299
         LA    R1,8                      maximum passwd length  JW13299
         LA    R3,J1DPSWD                get passwd address     JW13299
         TRT   J1DPSWD(8),FNDBLANK       find first blank       JW13299
         BZ    *+10                      no blank, skip compute JW13299
         SR    R1,R3                     compute userid length  JW13299
         BZ    RTNBPWD                   no passwd entered      JW13299
         STC   R1,J1DPSWDL               store length for RAC   JW13299
         LA    R3,J1DUSERL               get RAC format userid  JW13299
         LA    R4,J1DPSWDL               get RAC format passwd  JW13299
         MVC   J1DRCRE(J1DMCREL),J1DMCRE init parameter list    JW13299
         RACINIT USERID=(3),PASSWRD=(4),MF=(E,J1DRCRE)          JW13299
         LTR   R15,R15                   user authenticated?    JW13299
         BZ    CHKAUTH                   yes, check authorized  JW13299
         STC   R15,J1DPSWD               save return code       JW13299
         TM    J1DPSWD,UINV              user invalid?          JW13299
         BO    RTNBUSR                   yes, fail bad userif   JW13299
         TM    J1DPSWD,PINV              password invalid?      JW13299
         BO    RTNBPWD                   yes, fail bad password JW13299
         B     RTNUNKN                   no, unknown error      JW13299
CHKAUTH  MVC   J1DRCHK(J1DMCHKL),J1DMCHK init parameter list    JW13299
         LA    R3,FACILITY               address of class name  JW13299
         LA    R4,JRPAUTH                address of entity name JW13299
         RACHECK CLASS=(3),ENTITY=((4)),MF=(E,J1DRCHK)          JW13299
         LR    R3,R15                    remember return code   JW13299
         MVC   J1DRDEL(J1DMDELL),J1DMDEL init parameter list    JW13299
         RACINIT MF=(E,J1DRDEL)          delete RAC environment JW13299
         LTR   R3,R3                     authorization granted? JW13299
         BZ    RTNOK                     yes, allow logon       JW13299
         B     RTNAUTH                   not authorized         JW13299
./ DELETE  SEQ1=01430000,SEQ2=01450000
RTNBUSR  LA    R15,12                     set bad user          JW13299
./ DELETE  SEQ1=01500000,SEQ2=01520000
RTNBPWD  LA    R15,8                      set bad password      JW13299
*                                                               JW13299
*   not authorized                                              JW13299
*                                                               JW13299
RTNAUTH  LA    R15,16                     set not authorized    JW13299
         B     JRPRTRN                    return to caller      JW13299
*                                                               JW13299
*   unknown bad                                                 JW13299
*                                                               JW13299
RTNUNKN  LA    R15,20                     set bad unknown       JW13299
         B     JRPRTRN                    return to caller      JW13299
./ DELETE  SEQ1=01580000,SEQ2=01590000
JRPRTRN  XC    J1DPSWD(8),J1DPSWD         clear password        JW13299
./ DELETE  SEQ1=01620000,SEQ2=02240000
TR00TO40 DC    X'40'                     translate X'00' ..     JW13299
         DC    255AL1(*-TR00TO40)                   .. to X'40' JW13299
FNDBLANK DC    256X'00'                  find ..                JW13299
         ORG   FNDBLANK+X'40'               .. first ..         JW13299
         DC    X'01'                               .. blank     JW13299
         ORG   ,                         reset location counter JW13299
SAFVID   DC    CL4'SAFV'                 SAFV eye catcher       JW13299
J1DMCRE  RACINIT ENVIR=CREATE,MF=L       create RAC environment JW13299
J1DMCREL EQU   *-J1DMCRE                 length of plist        JW13299
J1DMCHK  RACHECK ATTR=READ,MF=L          check authorization    JW13299
J1DMCHKL EQU   *-J1DMCHK                 length of plist        JW13299
J1DMDEL  RACINIT ENVIR=DELETE,MF=L       delete RAC environment JW13299
J1DMDELL EQU   *-J1DMDEL                 length of plist        JW13299
FACILITY DC    X'08'                     address of class lng   JW13299
         DC    C'FACILITY'               class name             JW13299
JRPAUTH  DC    CL39'JRPAUTH'             resource name          JW13299
         CVT   DSECT=YES                                        JW13299
         IHAPSA ,                                               JW13299
CVTSAF   EQU   248 CVTSAF doesn't exist but is a reserved field JW13299
         ICHSAFV  DSECT=YES              map SAFV               JW13299
./ CHANGE NAME=JRP300
./ DELETE  SEQ1=00100000,SEQ2=00100000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00140000,SEQ2=00140000
*              MODIFIED = 10/26/13                              JW13299
         LA    R15,10              initialize ..                JW13299
         ST    R15,J1DRETWT               .. retry delay        JW13299
./ DELETE  SEQ1=03800000,SEQ2=03810000
         CLC   J1DRETLM(2),H15     is it at 15                  JW13299
         BNE   P3WAIT              no - don't notify operator   JW13299
         LA    R15,10              reinitialize ..              JW13299
         ST    R15,J1DRETWT                 .. retry delay      JW13299
./ DELETE  SEQ1=03960000,SEQ2=03960000
         STIMER WAIT,BINTVL=J1DRETWT wait for a while           JW13299
         L     R15,J1DRETWT        get current retry delay      JW13299
         SLL   R15,1               double delay next time       JW13299
         ST    R15,J1DRETWT        set next delay               JW13299
         LM     R0,R1,J1DNIBL      NIB length and address       JW13299
         FREEMAIN RC,A=(R1),LV=(R0) free NIB                    JW13299
         LM     R0,R1,J1DRPLL      RPL length and address       JW13299
         FREEMAIN RC,A=(R1),LV=(R0) free RPL                    JW13299
         ST    R0,J1DNIBL       NIB length for FREEMAIN         JW13299
         ST    R0,J1DRPLL       RPL length for FREEMAIN         JW13299
         LA    R15,10              reinitialize ..              JW13299
         ST    R15,J1DRETWT                 .. retry delay      JW13299
./ DELETE  SEQ1=06540000,SEQ2=06540000
         MVC   J1DRETLM(2),H15     set to 15                    JW13299
         LM     R0,R1,J1DNIBL      NIB length and address       JW13299
         FREEMAIN RC,A=(R1),LV=(R0) free NIB                    JW13299
         LM     R0,R1,J1DRPLL      RPL length and address       JW13299
         FREEMAIN RC,A=(R1),LV=(R0) free RPL                    JW13299
H15      DC    H'15'             we do 14 retries (27 minutes)  JW13299
./ CHANGE NAME=JRP310
./ DELETE  SEQ1=00090000,SEQ2=00090000
*             AUTHOR = Mike Schortman                           JW13299
*                      Scott Vetter                             JW13299
*                      Juergen Winkelmann                       JW13299
./ DELETE  SEQ1=00130000,SEQ2=00130000
*              MODIFIED = 10/26/13                              JW13299
./ DELETE  SEQ1=01660000,SEQ2=01670000
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    *+18              yes, use narrow geometry       JW13299
         MVI   J1DAREA5,C' '     prime separator line           JW13299
         MVC   J1DAREA5+1(130),J1DAREA5 clear separator line    JW13299
         B     NOBUMP            go common                      JW13299
         MVI   J1DAREA2,C' '     prime separator line           JW13299
         MVC   J1DAREA2+1(78),J1DAREA2 clear separator line     JW13299
./ DELETE  SEQ1=01700000,SEQ2=01710000
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    *+18              yes, use narrow geometry       JW13299
         MVI   J1DAREA5,C'-'     prime separator line           JW13299
         MVC   J1DAREA5+1(130),J1DAREA5 fill separator line     JW13299
         B     *+14              go common                      JW13299
         MVI   J1DAREA2,C'-'     prime separator line           JW13299
         MVC   J1DAREA2+1(78),J1DAREA2 fill separator line      JW13299
./ DELETE  SEQ1=01730000,SEQ2=01750000
NOBUMP   MVI   J1DAREA1,C' '     prime output line              JW13299
         CLI   J1DCOLS+3,X'50'   narrow screen?                 JW13299
         BE    J1C80             yes, use narrow geometry       JW13299
         MVC   J1DAREA1+1(130),J1DAREA1 clear output line       JW13299
         MVC   J1DADD5(2),2(R14) set separator line address     JW13299
         B     J1CWIDTH          go common                      JW13299
J1C80    MVC   J1DAREA1+1(78),J1DAREA1 clear output line        JW13299
         MVC   J1DADD2(2),2(R14) set separator line address     JW13299
J1CWIDTH MVC   J1DADD1(2),0(R14) set output line address        JW13299
         MVI   J1DAREA1-1,C'3'   unsolicited messages are pink  JW13299
./ DELETE  SEQ1=01790000,SEQ2=01790000
         LH    R5,J1DOUTLN                                      JW13299
         MVI   J1DAREA1-1,C'4'   return to green output         JW13299
         BCTR  R6,R0             decrement address              JW13299
         LA    R5,1(,R5)         increment length               JW13299
./ ENDUP

//SMFE35  JOB MSGLEVEL=1
//STEPB  EXEC  ASMFCL
//ASM.SYSIN DD *
         TITLE   'SMFE35-E35SMF'
* STATUS--CHANGE LEVEL 0000                                           *
* FUNCTION-THIS VERSION OF THE E35 SORT EXIT RE-INSERTS THE SYSTEM    *
*    ORIENTED RECORDS(SOR) INTO THE FINAL MERGED OUTPUT IN THE        *
*    FOLLOWING SEQUENCE-                                              *
*    1-ALL DUMP HDR RECORDS                                           *
*    2-ALL DUMP TLR RECORDS                                           *
*    3-ALL OTHER SYSTEM ORIENTED RECORDS IN THE SEQUENCE IN           *
*    WHICH THEY WERE GENERATED BY SYSTEM MANAGEMENT                   *
*    FACILITIES                                                       *
*    THE SORT WILL THEN PLACE INTO THE FINAL MERGED OUTPUT            *
*    THE SORTED JOB ORIENTED RECORDS                                  *
*    OPERATION ---                                                    *
*    UPON INITIAL ENTRY,THE HDR/TLR DATA SET IS OPENED.THE DATA       *
*    RECORDS ARE SCANNED FOR RECORD TYPE 2(DUMP HDR).EACH TIME        *
*    A TYPE 2 IS FOUND AND A RETURN IS MADE TO THE SORT TO HAVE       *
*    THE RECORD INSERT INTO THE FINAL OUTPUT.WHEN EODAD IS REACHED    *
*    THE SET IS CLOSED & RE-OPENED.THIS SCAN IS PERFORMED AGAIN,      *
*    THIS TIME FOR TYPE 3(DUMP TLR) AND ARE INSERTED AGAIN.AT         *
*    EODAD FOR THE SECOND TIME,THIS SET IS CLOSED PERMANENTLY.        *
*    THE OTHER TEMPORARY SET IS OPENED AND A LOOP IS EXECUTED         *
*    INSERTING EACH RECORD AS IT IS GOTTEN UNTIL EODAD IS             *
*    REACHED.AT THIS POINT,ALL SYSTEM ORIENTED RECORDS HAVE           *
*    BEEN PROCESSED AND AFTER CLOSING THE SET RETURN IS MADE TO       *
*    THE SORT WITH A RETURN CODE INDICATING THAT NO RETURN IS TO      *
*    BE MADE TO THIS EXIT.                                            *
* ENTRY POINTS--                                                      *
*         E35                                                         *
* INPUT- A-REGISTER 1 POINTS TO A WORD PARAMETER LIST THAT CONTAINS-  *
*    1-ADDRESS OF RECORD LEAVING MERGE                                *
*    2-ADDRESS OF RECORD IN OUTPUT AREA                               *
*    3-SEQUENCE CHECK SWITCH (SET TO SUPPRESS SEQUENCE CHECKING       *
*    WHILE THIS ROUTINE IS ACTIVE                                     *
*    B-2 TEMPORARY DATA SETS CREATED BY THE E15 EXIT ROUTINE.         *
*    THE FIRST CONTAINS ALL OF THE HEADERS AND TRAILERS FROM          *
*    THE DUMP TAPE(S) INPUTTED TO THE SORT                            *
*    THE SECOND CONTAINS ALL OTHER SYSTEM ORIENTED RECORDS            *
*    FROM THE DUMP TAPE(S) INPUTTED TO THE SORT                       *
* OUTPUT--SEE FUNCTION                                                *
*    RETURN CODES USED-RC=0 NO ACTION,RC=8 DO NOT RETURN,             *
*    RC=12 INSERT RECORD                                              *
* EXTERNAL REFERENCES--N/A                                            *
* EXITS,NORMAL--TO OS/SORT                                            *
* EXITS,ERROR--N/A                                                    *
* TABLES/WORK AREAS--N/A                                              *
* ATTRIBUTES--NON-REENTRANT,NON-REUSABLE                              *
* CHARACTER CODE DEPENDENCY--NONE                                     *
* NOTES-THE BUFFER USED IN THIS ROUTINE WAS DEFINED TO HOLD A         *
*    MAXIMUM RECORD SIZE OF 600 BYTES.  SOME INSTALLATIONS USE @YM00553
*    LARGER RECORDS AND SHOULD REDEFINE THIS BUFFER TO HOLD           *
*    THEIR MAXIMUM LOGICAL RECORD SIZE.                               *
*                                                                     *
R01      EQU   1                   PARAMETER REGISTER
ONE      EQU   1
R02      EQU   2                   WORK REGISTER
III      EQU   X'03'
IV       EQU   4
V        EQU   5
VIII     EQU   8
R08      EQU   8                   SOR ADDRESS REGISTER
R10      EQU   10                  WORKING REGISTER FOR SORT RECD ADDR
R11      EQU   11                  PARAMETER LIST ADDRESS REGISTER
R12      EQU   12                  BASE REGISTER
R13      EQU   13                  SAVE AREA ADDRESS REGISTER
R15      EQU   15                  ENTRY POINT REGISTER
XXIV     EQU   24
INSERT   EQU   X'01'
JTERM    EQU   X'05'
ONCE     EQU   X'20'               1ST SOR PROCESS SWITCH
CLOSONCE EQU   X'24'               SWITCH MASKS/HDRS DONE & 1ST SOR
ONCEOVER EQU   X'DF'
INSOFF   EQU   X'FE'
CLOSED   EQU   X'02'               FINAL END OF DS ACTIVITY
CLOSEA   EQU   X'04'               HDR/TRL PROCESSING FINISHED
OPENA    EQU   X'08'               HDR/TRL HAS BEEN OPENED
PASS2    EQU   X'10'               HDR/TRL CLOSED ONCE BEFORE
E35      CSECT
*D 068000-080500                                               @YM00553
*A 026000,067500                                               @YM00553
*A 050000,059500,066000-067500                                   A35184
         USING *,R12               ESTABLISH ADDRESSABILTY
         SAVE  (14,12)             SAVE CALLER'S REGS
         LR    R12,R15             LOAD BASE ADDRESS
         ST    R13,SAVDS+IV        CHAIN SORT SAVEAREA TO E35
         LR    R02,R13             RETAIN ADDRESS OF SORT'S AREA
         LA    R13,SAVDS           ADDRESS OF E35 SAVE AREA
         ST    R13,VIII(R02)       CHAIN E35 SAVEAREA TO SORT
         LR    R11,R01             RETAIN PARAMETER LIST ADDRESS
         LA    R02,IV              CREATE NO SEQ CHECK BIT
         ST    R02,VIII(R11)       PLACE IN SORT PARM LIST
         TM    BITS,CLOSEA         IS HDR SET CLOSED
         BO    E35PROC             YES,BYPASS HDR INSERTIONS
         TM    BITS,OPENA          IS HDR SET OPEN
         BO    E35XCPTA            YES,BYPASS OPENING
         OPEN  E35DCBA             NO,OPEN FOR FIRST SCAN
         OI    BITS,OPENA          TURN ON OPEN INDICATOR
E35XCPTA GET   E35DCBA,HTBUFF      GET A HDR/TLR RECORD          A35184
         CLC   V(ONE,R01),ID       IS THIS THE RIGHT TYPE
         BNE   E35XCPTA            NO,GET NEXT RECORD
         B     E35INRTN            YES,GO TO INSERT RETURN
E35EODID CLOSE E35DCBA             CLOSE HDR/TLR SET
         TM    BITS,PASS2          HAS SET BEEN CLOSED ONCE
         BO    E35XCPTB            SET END OF PHASE BIT AND GO ON
         MVI   ID,III              NO,CHANGE ID BEING SCANNED FOR
         OPEN  E35DCBA             OPEN HDR/TLR SET SECOND TIME
         OI    BITS,PASS2          INDICATE HDR/TLR SET CLOSED ONCE
         B     E35XCPTA            GO PERFORM SCAN
E35XCPTB OI    BITS,CLOSONCE       SET SWITCHES TO INDICATE HDR SET
*                                  SET CLOSED AND FIRST TIME FOR
*                                  SOR PROCESSING
         B     E35PROC             YES,GO PROCESS REST OF SOR'S
E35PROC  L     R08,SORSAV          LOAD ADDRESS OF CURRENT SOR
         LTR   R08,R08             IS IT ZERO
         BNE   E35PRCS             NO,DATA SET IS OPEN
         OPEN  E35DCB              OPEN DATA SET CREATED AT E15 EXIT
E35PRCS  GET   E35DCB,BUFF         GET THE FIRST RECORD          A35184
         ST    R01,SORSAV          SAVE THE ADDRESS OF RECORD
E35INRTN L     R13,SAVDS+IV        ADDRESS OF SORT SAVE AREA
         ST    R01,XXIV(R13)       ADDRESS OF RECD INTO SORT SAVEAREA
         RETURN (14,12),RC=12      RETURN TO SORT W/RC=INSERT
E35EODAD CLOSE E35DCB              CLOSE SOR SET
         OI    BITS,CLOSED         TURN ON CLOSED BIT
E35ENDB  L     R13,SAVDS+IV
         RETURN (14,12),RC=8       DO NOT RETURN
SAVDS    DS    18F                 REGISTER SAVE AREA
SORSAV   DC    F'0'                SOR ADDRESS
BITS     DC    X'00'               INITIALIZE SWITCH
ID       DC    X'02'               INITIALIZE ID
E35DCB   DCB   DSORG=PS,MACRF=GM,DDNAME=SORDATA,EODAD=E35EODAD   A35184
E35DCBA  DCB   DSORG=PS,MACRF=GM,DDNAME=HDRDATA,EODAD=E35EODID   A35184
HTBUFF   DS    CL18                BUFFER FOR HDR/TLR RECORDS    A35184
BUFF     DS    CL608               BUFF TO REBUILD SEGMTED REC @YM00553
         END
//LKED.SYSLMOD DD   DSNAME=SMF1.EXITS,DISP=(OLD,KEEP),                 C
//             UNIT=2314,VOLUME=SER=231400
//LKED.SYSIN   DD *
 NAME E35(R)

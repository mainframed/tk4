//MSSIVP  JOB  MSGLEVEL=(1,1)
//*********************************************************************
//*  MSSIVP REQUIRES THAT FOUR SCRATCH CARTRIDGES BE AVAILABLE IN   ***
//*  IN THE 3850 MSS.                                               ***
//*********************************************************************
//MSSIVPS1 EXEC PGM=IDCAMS
//*********************************************************************
//*  MSSIVPS1 CREATES TWO VIRTUAL VOLUMES FOR THE MSSIVP JOB.       ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//IVPS1DS1 DD UNIT=(3330V,,DEFER),DISP=OLD,VOL=(PRIVATE,SER=FE3850)
//SYSIN DD *
   TRACE ON
   TUNE DISPLAY
   CREATEV VOL(FE3850) OWNER(FEPSR) FILE(IVPS1DS1) CNT(2) DERAS
//MSSIVPS2 EXEC PGM=IEBDG
//*********************************************************************
//*  MSSIVPS2 CREATES THREE DATASETS OF 800 BYTE RECORDS SEQUENTIALLY**
//* NUMBERED IN BYTES 791 THRU 800. THESE DATASETS ARE MADE UP OF 800**
//* BYTE RECORDS BLOCKED 4 RECORDS TO A BLOCK. TWO DATASETS SPAN TWO***
//* CARTRIDGES.  ONE FROM CYLINDER 199, HEAD 16 TO CYLINDER 231, HEAD 8
//*  AND THE OTHER FROM CYLINDER 180, HEAD 0 TO CYLINDER 212, HEAD 19.*
//*  THE ISAM DATASET IS TO CAUSE CYLINDER FAULTS TO OCCUR.         ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//IVPS2DS1  DD  DSN=MSSIVP2,UNIT=3330V,DISP=(NEW,PASS),
//  DCB=(RECFM=FB,LRECL=800,BLKSIZE=3200,DSORG=IS,OPTCD=MY,
//  KEYLEN=10,RKP=790,NTM=4,CYLOFL=10),
//  SPACE=(ABSTR,(627,3420,38)),
//  VOL=(PRIVATE,SER=FE3851)
//IVPS2DS2 DD DSN=MSSIVP1,UNIT=3330V,DISP=(NEW,PASS),
//  DCB=(RECFM=FB,LRECL=800,BLKSIZE=3200),SPACE=(ABSTR,(600,3798)),
//  VOL=(PRIVATE,SER=FE3850)
//IVPS2DS3  DD  DSN=MSSIVP3,UNIT=3330V,DISP=(NEW,PASS),
//  DCB=(RECFM=FB,LRECL=800,BLKSIZE=3200),
//  SPACE=(3200,(3500),RLSE,,ROUND),
//  VOL=(PRIVATE,SER=FE3851)
//SYSIN DD *
   DSD OUTPUT=(IVPS2DS1)
   FD  NAME=FIELD1,LENGTH=300,STARTLOC=1,FORMAT=AN,ACTION=RP
   FD  NAME=FIELD2,LENGTH=300,STARTLOC=301,FORMAT=RA,ACTION=RP
   FD  NAME=FIELD3,LENGTH=10,STARTLOC=791,PICTURE=10,                  C
   P'0000000001',INDEX=1
  CREATE QUANTITY=2395,NAME=(FIELD1,FIELD2,FIELD3),FILL=X'FE'
   END
  DSD OUTPUT=(IVPS2DS2)
   FD  NAME=FIELD4,LENGTH=300,STARTLOC=1,FORMAT=AN,ACTION=RP
   FD  NAME=FIELD5,LENGTH=300,STARTLOC=301,FORMAT=BI,ACTION=RP
   FD  NAME=FIELD6,LENGTH=10,STARTLOC=791,PICTURE=10,                  C
   P'0000000001',INDEX=1
  CREATE QUANTITY=2395,NAME=(FIELD4,FIELD5,FIELD6),FILL=X'FE'
  END
  DSD OUTPUT=(IVPS2DS3)
   FD  NAME=FIELD7,LENGTH=300,STARTLOC=1,FORMAT=AN,ACTION=RP
   FD  NAME=FIELD8,LENGTH=300,STARTLOC=301,FORMAT=BI,ACTION=RP
   FD  NAME=FIELD9,LENGTH=10,STARTLOC=791,PICTURE=10,                  C
   P'0000000001',INDEX=1
  CREATE QUANTITY=2395,NAME=(FIELD7,FIELD8,FIELD9),FILL=X'FE'
  END
//MSSIVPS3 EXEC PGM=IDCAMS,COND=EVEN
//*********************************************************************
//*  STEP MSSIVPS3 USES THE STOREV MACRO TO FORCE DESTAGEING OF THE ***
//*  THREE DATASETS CREATED IN MSSIVPS2.                            ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//IVPS3DS1 DD UNIT=3330V,DISP=OLD,VOL=(PRIVATE,SER=FE3850)
//IVPS3DS2 DD UNIT=3330V,DISP=OLD,VOL=(PRIVATE,SER=FE3851)
//SYSIN DD *
  STOREV VOL(FE3850) FILE(IVPS3DS1)
  STOREV VOL(FE3851) FILE(IVPS3DS2)
//MSSIVPS4 EXEC PGM=IDCAMS,COND=EVEN
//*********************************************************************
//*  STEP MSSIVPS4 ACTIVATES THE VOLUMES DEACTIVATED IN MSSIVPS3.   ***
//*  DATA REUSE IS PREVENTED BY THE DERAS ATTRIBUTE ON THE VOLUMES. ***
//*  THEREFORE, THE DATA WILL BE RESTAGED DURING MSSIVPS5 & MSSIVPS6***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//IVPS4DS1 DD UNIT=(3330V,,DEFER),DISP=OLD,
//  VOL=(PRIVATE,SER=(FE3850,FE3851))
//SYSIN DD *
  ADDV VOL(FE3850)
  ADDV  VOL(FE3851)
//MSSIVPS5 EXEC PGM=IEBCOMPR
//*********************************************************************
//*  MSSIVPS5 COMPARES THE TWO SEQUENTIAL DATASETS CREATED IN       ***
//*  MSSIVPS2.  THE DATASETS ARE DELETED IN THIS STEP.              ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//SYSIN DD DUMMY
//SYSUT1 DD DSN=MSSIVP1,UNIT=3330V,DISP=(OLD,DELETE)
//SYSUT2 DD DSN=MSSIVP3,UNIT=3330V,DISP=(OLD,DELETE)
//MSSIVPS6  EXEC  PGM=IEBISAM,PARM=UNLOAD
//*********************************************************************
//*  MSSIVPS6 UNLOADS THE ISAM DATASET CREATED IN MSSIVPS2.         ***
//**  IT DELETES BOTH DATASETS AND IS TO CAUSE CYLINDER FAULTS.     ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//SYSUT1  DD  DSN=MSSIVP2,UNIT=3330V,DISP=(OLD,DELETE)
//SYSUT2  DD  DSN=MSSIVP4,UNIT=SDG00,DISP=(NEW,DELETE),
//  VOL=(PRIVATE,SER=FE3850),SPACE=(3200,(3500)),
//  DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)
//MSSIVPS7 EXEC PGM=IDCAMS,COND=EVEN
//*********************************************************************
//*  MSSIVPS7 SCRATCHES THE TWO VOLUMES CREATED IN MSSIVPS1.        ***
//*  THIS STEP ALSO USES COND=EVEN TO ATTEMPT PROPER CLEAN-UP.      ***
//*********************************************************************
//SYSPRINT DD SYSOUT=A
//IVPS7DS1 DD VOL=(PRIVATE,SER=FE3850),UNIT=3330V,DISP=OLD
//IVPS7DS2 DD VOL=(PRIVATE,SER=FE3851),UNIT=3330V,DISP=OLD
//SYSIN DD *
  SCRATCHV VOL(FE3850) FILE(IVPS7DS1)
  SCRATCHV VOL(FE3851) FILE(IVPS7DS2)
   TRACE OFF
//****************************** NOTE *********************************
//*                                                                 ***
//*  PROPER EXECUTION OF THE IVP IS INDICATED BY ALL STEPS EXECUTED ***
//*  WITH CONDITION CODES EQUAL TO ZERO AND NO STEPS BYPASSED.      ***
//*  NO UNUSUAL CONDITIONS SHOULD OCCUR.  SDA SHOULD BE EXECUTED    ***
//*  AFTER THE IVP TO CHECK FOR 3850 ERRORS THAT MAY HAVE BEEN      ***
//*  LOGGED IN SYS1.LOGREC.                                         ***
//*  TRACE REPORTS SHOULD BE RUN TO RECORD STAGING ACTIVITY FOR     ***
//*  FUTURE REFERENCE.                                              ***
//*                                                                 ***
//*********************************************************************

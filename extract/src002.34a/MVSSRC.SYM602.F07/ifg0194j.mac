         TITLE 'IFG0194J                      MESSAGE ROUTINE'   Y02134
IFG0194J CSECT
         ENTRY IFG0204J                 ENTRY POINT FOR CLOSE    Y02134
         ENTRY IFG0554J                 ENTRY POINT FOR EOV      Y02134
IFG0204J EQU   IFG0194J                 ALIAS ENTRY POINT        Y02134
IFG0554J EQU   IFG0194J                 ALIAS ENTRY POINT        Y02134
*                                                                     *
***********************************************************************
*
*        VS 2 RELEASE 03.824  ADDITIONS/CHANGES/DELETIONS      @G24LSFS
*272505                                                        @G24LSFS
*        VS 2 RELEASE 03.818  ADDITIONS/CHANGES/DELETIONS
*A000                                                          @G18MSBS
*C000271660,271866,271890,272010                               @G18MSBS
*D000271868-271871                                             @G18MSBS
*        VS 2 RELEASE 03 DELETIONS/CHANGES                            *
*0000265988                                                    @ZA00014
*0000105042,105146-105211,105918-106008                        @ZA00700
*0000107312-107329                                             @ZM32752
*0000284178-284477                                             @ZA00018
*0000383255,384935,385544,388899,390648                        @ZA01278
*0000104587,104593,104597,105510,105562,105640,105718,105864,  @ZA01544
*105900,106044,106386,106404,107016,107034,107574,107592,      @ZA01544
*108096,108114,108654,108672,109418,109423,115977,115982,      @ZA01544
*129977,130077,130082,130601,130622,130627,143977,143982,      @ZA01544
*153061,153067,153077,153197,153351,153357,153367,153477,      @ZA01544
*153487,153641,153647,153657,153767,251200,256702,256703,      @ZA01544
*256717,256719,256721,256722,256725,257290,257445,257796,      @ZA01544
*257896,258869,259700,260700,263200,265685,265958,265988,      @ZA01544
*266000,266220,267120,267200,267520,267640,282700,283200,      @ZA01544
*283766,283776,283788,283798,283804,284562,284568,284688,      @ZA01544
*284694,284862,284940,284952,285042,285048,285078,285114,      @ZA01544
*285120-286122,286146,286152,286158,286164,298200,307700,      @ZA01544
*308350,308690,308773,308838,309670,309681,309694,309728,      @ZA01544
*309754,309768,309964,310079,310214,310349,310484,317700,      @ZA01544
*366227-366717,370700-382700,393232,393340                     @ZA01544
*0000384935                                                    @ZA02505
*0000285078                                                    @ZM30627
*0000285635                                                    @ZM34658
*        VS 2 RELEASE 04 DELETIONS/CHANGES                            *
*0000044520,044540,044560,044580,044600,044620,044640,044660,  @ZA02881
*044680,044700,044720,044740,044760,044780,044800,044820,      @ZA02881
*044840,044860,044880,044900,044920,288342,288344,288396-      @ZA02881
*288421,288928.288929,309670,309675-310538,310585,310608,      @ZA02881
*386700,389103,389610,389934,390150,393448,401200,401540,      @ZA02881
*401542                                                        @ZA02881
*0000100000-248200,256200,256739,256781,256815,257146,257247,  @ZA03694
*273003-283704                                                 @ZA03694
*0000                                                          @ZA03184
*0000                                                          @ZA03196
*0000385346-385347,385546,453950                               @ZA04633
*0000385618                                                    @ZA07691
*0000385727                                                    @ZA06693
*0000272513                                                    @ZA05096
*A284486-284493                                                @ZA10463
*0000283800,283804                                             @ZA12197
*               VS2 SU32 DELETIONS                                    *
*                                                              @G32DSMI
*0000                                                          @ZA12572
*0000                                                          @ZA16016
*             VS 2 RELEASE 037 DELETIONS/CHANGES                      *
*                                                                     *
*0000387687,387729,389069,389093,389528,389547,389902,389910   @ZA18541
*390531,390533,403651,403654,404108,404111                     @ZA18541
*38542737-807                                                  @ZA17796
*C000390536                                                    @ZA19630
*0000288410-288432,385636                                      @ZA18506
*00004524                                                      @ZA20470
*0000,D38569437,D38569537                                      @ZA28467
*D34381702-24387702                                            @ZA30562
* MODULE NAME = IFG0194J (OS/VS2)                                     *
*                                                                     *
* DESCRIPTIVE NAME =  MESSAGE ROUTINE                                 *
*                                                                     *
* COPYRIGHT = NONE                                                    *
*                                                                     *
* STATUS = RELEASE 2, LEVEL 0                                         *
*                                                                     *
* FUNCTION =                                                          *
*        1. CONSTRUCTS MESSAGES FOR TAPE AND DIRECT ACCESS STRING BY  *
*        INSERTING THE APPROPRIATE INFORMATION SUCH AS LABEL TYPE,    *
*        VOLUME SERIAL, DENSITY, JOB/STEP NAME.                       *
*                                                                     *
*        2. WRITES THE MESSAGE.                                       *
*           ANY MESSAGE REQUIRING A REPLY IS WRITTEN AS A NORMAL      *
*           WRITE TO OPERATOR FOLLOWED BY A MESSAGE REQUESTING        *
*           THE REPLY.                                                *
*                                                                     *
*        3. WRITES MESSAGE TO TSO TERMINAL WHERE APPROPRIATE:         *
*           A. MOUNT MESSAGE;                                         *
*           B. EXPIRATION DATE MESSAGE;                               *
*           C. FILE PROTECT MESSAGE;                                  *
*           D. WTOR FILE PROTECT MESSAGE.                             *
*                                                                     *
*        4. WRITES SMF RECORD 19.                                     *
*                                                                     *
*        5. REWINDS AND UNLOADS TAPE UNIT.                            *
*           DEQUEUES TAPE VOLUME SERIAL WITH IEC502E MESSAGE   @ZA18506
*           IF INDICATED IN UCB.                               @ZA18506
*                                                                     *
*        6. DIRECTS VIRTUAL VOLUME MOUNT/DEMOUNT REQUESTS             *
*           TO THE SSC ROUTINE.                                       *
*                                                                     *
* NOTES = SEE BELOW                                                   *
*                                                                     *
*    DEPENDENCIES =                                                   *
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     *
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   *
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      *
*                                                                     *
*    RESTRICTIONS = NONE                                              *
*                                                                     *
*    REGISTER CONVENTIONS =                                           *
*            R2 POINTS TO DCB                                         *
*            R4 POINTS TO OPEN WORK AREA                              *
*            R5 POINTS TO THE RESIDENT ROUTINE                        *
*            R6 POINTS TO THE WTG TABLE                               *
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            *
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 *
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    *
*            R10 POINTS TO THE UCB                                    *
*                                                                     *
*     PATCH LABEL = SEE THIRD LABEL BEFORE ORG STATEMENT AT END       *
*                   OF LISTING.                                       *
*                                                                     *
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            *
*                                                                     *
*     PROCESSOR = ASSEMBLER XF                                        *
*                                                                     *
*     MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON    *
*                   ORG STATEMENT AT END OF LISTING                   *
*                                                                     *
*     ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,         *
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, *
*                  LINK PACK AREA RESIDENT/PAGEABLE.                  *
*                                                                     *
* ENTRY POINT =                                                       *
*        IFG0194J FROM OPEN                                           *
*        IFG0204J FROM CLOSE                                          *
*        IFG0554J FROM EOV                                            *
*                                                                     *
*     PURPOSE = ISSUE MESSAGES.                                       *
*                                                                     *
*     LINKAGE = AS FOLLOWS -                                          *
*               MVC   DXRETMOD,IDRETURN          RETURN MOD ID        *
*               MVI   DXRETCOD,OFFSET            RETURN OFFSET IN R14 *
*               LA    R0,PARMS                   LOAD PARMS IN R0     *
*               LA    R1,PARMS                   LOAD PARMS IN R1     *
*               LA    R14,MSGOFSET               LOAD OFFSET TO MSG   *
*               IECRES LOAD,MODID=ID4J,BRCODE=(14),BRANCH=QUEUED      *
*                                                                     *
* INPUT = ABOVE LINKAGE AND STANDARD OPEN/CLOSE/EOV REGISTERS         *
*         AND WORKAREAS.                                              *
*                                                                     *
* OUTPUT = THE FOLLOWING MESSAGES:                                    *
*                                                                     *
*IEC501A M DDD,VOLSER,LBL,DENS,JOBNAME,STEPNAME,DSNAME                *
*                                                                     *
*IEC501E M DDD,VOLSER,LBL,DENS,JOBNAME,STEPNAME,DSNAME                *
*                                                                     *
*IEC502E XX DDD,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ                 *
*IEC502E JOBNAME,STEPNAME,DSNAME                                      *
*                                                                     *
*IEC502E XX DDD,VOLSER,LBL,DDNAME-CODE,JOBNAME,STEPNAME,DSNAME        *
*                                                                     *
*IEC507D E DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                         *
*                                                                     *
*IEC509A F DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                         *
*                                                                     *
*IEC510D F DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                         *
*                                                                     *
*IEC135A U DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                  @G32DSMI
*                                                                     *
*IEC534D A DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME                     *
*                                                                     *
*IEC704A L DDD,VOLSER,LBL,DEN,JOBNAME,STEPNAME,DSNAME                 *
*                                                                     *
*IEC512I SEC VOL DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME               *
*                                                                     *
*IEC512I I/O ERR DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME               *
*                                                                     *
*IEC512I LBL ERR DDD,VOLSER,LBL,VOLREQ,LBLREQ,                        *
*IEC512I JOBNAME,STEPNAME,DSNAME                                      *
*                                                                     *
*IEC513D I/O ERR DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME               *
*                                                                     *
*IEC705I TAPE ON DDD,VOLSER,LBL,DEN,JOBNAME,STEPNAME,DSNAME           *
*                                                                     *
*IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR DATA SET         *
*                                                                     *
*IEC254D SHOULD JOBNAME USE (DDNAME,DDD,VOLSER) FOR CREATING          *
*        A NEW CHECKPOINT DATA SET                                    *
*                                                                     *
*IEC255D JOBNAME IS (DDNAME,DDD,VOLSER) A SECURE                      *
*        CHECKPOINT VOLUME                                            *
*                                                                     *
*IEC256A JOBNAME (DDNAME,DDD,VOLSER) IS NO LONGER A SECURE            *
*        CHECKPOINT VOLUME                                            *
*                                                                     *
*00 IECNNNY REPLY 'REPLY OPTIONS'                                     *
*                                                                     *
* EXIT-NORMAL = CALLER                                                *
*               NOTE-REGS 4-13 NOT DESTROYED.                         *
*                                                                     *
* EXIT-ERROR = DMABCOND SET LOCK ERROR                                *
*              ICBMNTDE ERROR - 737-30 ABEND                          *
*                                                                     *
* EXTERNAL REFERENCES = SEE BELOW                                     *
*                                                                     *
*    ROUTINES = IFG019RA,EXCP,LSPACE,TPUT,IOSGEN,WTO,VOLSTAT,SETLOCK. *
*                                                                     *
*    DATA AREAS = SEE PARAMETERS OF IECDSECS AND IECEQU MACRO.        *
*                                                                     *
*    CONTROL BLOCK = SEE PARAMETERS OF IECDSECS AND IECEQU MACRO.     *
*                                                                     *
* TABLES = XCTLTABL.                                                  *
*                                                                     *
* MACROS = IECDSECS,IECEQU,IECRES,XCTLTABL,DMABCOND,WTO,WTOR,TPUT,    *
*          SETLOCK,MODESET,IOSGEN,EXCP,OIL,IECDIOCM,ICBMNTDE.         *
*                                                                     *
* CHANGE ACTIVITY = SEE DELETIONS/CHANGES SECTION AFTER CSECT CARD.   *
*                                                                     *
***********************************************************************
         EJECT
*
         USING FORCORE,RCORE            WORK AREA
         USING WTG,RWTG                 WHERE-TO-GO TABLE        Y02080
         USING IHADCB,RDCB              RDCB POINTS TO DCB       Y02134
         USING USERPRML,RPARC           RPARC POINTS TO CURRENT  Y02134
         USING TIOENTRY,RTIOT           RTIOT POINTS TO ENTRY    Y02134
         USING UCBOB,RUCB               UCB
         USING WTOBUFFR,RD              BASE FOR WTO AREA      @ZA01544
         BALR  RBASE,R0                 SET BASE REGISTER
         USING *,RBASE
*
         L     RET,WTO00100(RET)        GET MSG RTN ADDR       @ZA03694
         BR    RET                      GOTO MESSAGE ROUTINE   @ZA03694
*
WTO00100 DS    0F                       MESSAGE TABLE          @ZA03694
         DC    A(IEC502E1)              EOV - CLOSE POSITIONING  YM7526
         DC    A(IEC501A)               COMPLETE MOUNT MESSAGE   Y02134
         DC    A(IEC502E2)              ASCII DISMOUNT MESSAGE   Y02134
         DC    A(IEC502E3)              REJECT VOLUME            Y02134
         DC    A(IEC501E)               LOOK AHEAD MOUNT MESSAGE Y02134
         DC    A(IEC507D)               EXPIRATION DATE MESSAGE  Y02134
         DC    A(IEC509A)               FILE PROTECT MESSAGE     Y02134
         DC    A(IEC510D)               WTOR FILE PROTECT MSG    Y02134
         DC    A(IEC534D)               WTOR DESTROY LABEL MSG   Y02134
         DC    A(IEC704A)               WTOR CREATE SL MSG       Y02134
         DC    A(IEC512IS)              SEC VOL MESSAGE          Y02134
         DC    A(IEC512II)              I/O ERROR MESSAGE        Y02134
         DC    A(IEC705I)               TAPE ATTRIBUTE MESSAGE   Y02134
         DC    A(IEC254D)               REQ FOR NEW CHKPT D/S    Y02083
         DC    A(IEC255D)               QUERY CHKPT VOL STATUS   Y02083
         DC    A(IEC256A)               REVOKE CHKPT VOL STATUS  Y02083
         EJECT
         DC    A(IEC512IL)              LBL ERR MSG            @ZA02881
         DC    A(IEC513D)               OPER I/O ERROR MESSAGE @ZA03196
         DC    A(IEC135A)               REMOVE FILE PROT RING  @G32DSMI
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        RETURN TO CALLER                                        Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO01000 EQU   *                                                 Y02134
*                                                                Y02134
         LM    RTIOT,RET,DXREGSAV       RESTORE REGISTERS        Y02134
         LM    R0,R1,DXREG0             RESTORE REGISTERS        Y02134
*                                                                Y02134
         XR    RET,RET                  CLEAR RETURN REGISTER    Y02134
         IC    RET,DXRETCOD             LOAD RETURN OFFSET       Y02134
         IECRES LOAD,MODID=DXRETMOD,BRCODE=(RET),BRANCH=QUEUED   Y02134
         EJECT                                                 @G32DSMI
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        ISSUE WTO                                               Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO02000 EQU   *                                                 Y02134
*                                                                Y02134
         XR    R0,R0                    CLEAR FOR MULTI LINE WTO Y02134
         WTO   MF=(E,WTOAREA)           ISSUE WTO SVC          @ZA01544
         BR    RET                      RETURN R1=WTO ID         YM7310
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        ISSUE WTOR                                              Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO03000 EQU   *                                                 Y02134
*                                                                Y02134
         ST    RET,DXREGE               SAVE RETURN ADDRESS      Y02134
         LH    R1,WTOLNGTH              LOAD LENGTH OF MESSAGE @ZA01544
         LA    R1,WTOAREA+WTOCODES-WTOEND(R1) END OF LINE 1    @ZA01544
         OC    WTOCODES-WTOCODES(L'WTOCODES,R1),WTORCODE WTOR  @ZA01544
*                                                                YM7526
         MVC   WTODRCDS,WTOCODES-WTOCODES(R1) SAVE CODES       @ZA01544
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO MULTI-LINE WTO   Y02134
         LR    RB,R1                    SAVE MSG ID FOR DOM    @ZM30627
*                                                                Y02134
         L     RET,DXREGE               RESTORE RETURN ADDRESS   Y02134
         MVC   WTOMSID2,MSG1STRT        SAVE MSG ID            @ZA01544
         MVC   WTOMSG1(L'IECREPLY),IECREPLY SETUP REPLY MSG    @ZA01544
         MVC   MSG1STRT(L'WTOMSID2),WTOMSID2 RESTORE MSG ID    @ZA01544
         SR    R1,R1                    ZERO REG FOR INSERT    @ZA01544
         IC    R1,K0(RC)                GET REPLY MSG LENGTH   @ZA01544
         BCTR  R1,R0                    DECREMENT FOR EXECUTE  @ZA01544
         EX    R1,MOVE4                 MOVE IN REPLY INFO     @ZA01544
         LA    R1,K1(R1)                RESET LENGTH           @ZA01544
         LA    R1,L'IECREPLY(R1)        GET MSG LENGTH         @ZA01544
         STH   R1,WTOLNGTH              STORE LENGTH           @ZA01544
         LA    R1,WTOAREA+WTOCODES-WTOEND(R1) END OF LINE 1    @ZA01544
         MVC   WTOCODES-WTOCODES(L'WTOCODES,R1),WTODRCDS R & D @ZA01544
*                                                                Y02134
         MVC   WTOSWTCH,WTORFLAG        SET FOR WTOR           @ZA01544
         LA    R1,DXECB                 LOAD POINTER TO ECB      Y02134
         ST    R1,WTOECBAD              SAVE ECB POINTER       @ZA01544
         L     R1,DXREG1                LOAD REPLY POINTER       Y02134
         ST    R1,WTORPLYP              SAVE REPLY POINTER     @ZA01544
*                                       AND LENGTH             @ZA01544
*                                                                Y02134
         MVI   DXECB,K0                 INITIALIZE ECB FOR WTOR  Y02134
*                                                                Y02134
         WTOR  MF=(E,WTORAREA)          ISSUE WTOR SVC         @ZA01544
*                                                                Y02134
         STM   RB,RET,DXCCW2            SAVE REGISTERS         @ZM30627
*
         BAL   RET,WTO04000             LINK TO TELL TERMINAL  @ZA03694
*
         LM    RTIOT,RET,DXREGSAV       RESTORE CALLERS REGS   @ZM30627
         LM    R0,R1,DXREG0             RESTORE 0 AND 1        @ZM30627
         IECRES WAIT                    WAIT FOR REPLY         @ZM30627
         MVI   DXECB,ECBCOD7F           SET TO NO ERROR        @ZA02881
         LM    RB,RET,DXCCW2            RESTORE REGS           @ZM30627
*
         DOM   MSG=(11)                 DOM MESSAGE            @ZM30627
*
         XR    RB,RB                    CLEAR REG FOR IC       @ZA02881
         IC    RB,DXREG1                GET REPLY LENGTH       @ZA02881
         L     R1,DXREG1                GET REPLY BUFFER       @ZA02881
         BCTR  RB,0                     DECREMENT FOR MOVE     @ZA02881
         EX    RB,FOLD                  FOLD REPLY             @ZA02881
         BR    RET                      RETURN                   Y02134
MOVE4    MVC   WTOMSG1+L'IECREPLY(R0),K1(RC) REPLY INFO        @ZA01544
FOLD     OC    IECREPLY-IECREPLY(R0,R1),BLANKS FOLD REPLY      @ZA02881
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        ISSUE TPUT MESSAGE                                      Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO04000 EQU   *                                                 Y02134
*                                                                Y02134
         TM    WTOTSOSW,X80             TEST IF ALREADY ISSUED @ZA01544
         BO    WTO04020                 BRANCH IF MSG ISSUED     Y02134
*                                                                Y02134
         L     RF,DXASCBAD              LOAD CURRENT ASCB ADDR   Y02134
         L     RF,ASCBTSB-ASCB(,RF)     LOAD TSB ADDRESS         Y02134
         LTR   RF,RF                    TEST FOR TERMINAL TASK   Y02134
         BZ    WTO04020                 BRANCH IF NOT            Y02134
*                                                                Y02134
         LA    R0,L'IEC108I             GET LENGTH OF MESSAGE    Y02134
         STCM  R0,B'0011',WTOSWTCH      SAVE LENGTH            @ZA01544
         LA    R1,MSG1STRT              POINT TO TSO MSG       @ZA01544
         MVC   MSG1STRT(L'IEC108I),IEC108I TSO MSG TO BUFFER   @ZA01544
*                                                                Y02134
         L     RF,DXJSCBAD              GET JSCB ADDRESS         Y02134
         MVC   WTOLNGTH(L'JSCBTJID),JSCBTJID-IEZJSCB(RF) ID    @ZA01544
         L     RF,JSCBPSCB-IEZJSCB(,RF) GET THE PSCB ADDRESS     Y02134
         LTR   RF,RF                    PSCB INITIALIZED         Y02134
         BZ    WTO04010                 DEFAULT TPUT W/MSG ID    Y02134
*                                                                Y02134
         MODESET EXTKEY=ZERO            NEED KEY 0 FOR THE PSCB  YM4814
         L     RF,PSCBUPT-PSCB(,RF)     GET UPT ADDRESS          Y02134
         TM    UPTSWS-UPT(RF),UPTMID    IS MESSAGE ID REQUIRED   Y02134
         BO    WTO04010                 BRANCH IF REQUIRED       Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6725
*                                                                Y02134
         LA    R0,L'IEC108I+WTOMSGID-WTOINSTR GET LENGTH - ID    Y02134
         STCM  R0,B'0011',WTOSWTCH      SAVE LENGTH            @ZA01544
         LA    R1,WTOINSTR-WTOMSGID+MSG1STRT POINT PASSED      @ZA01544
*                                       MESSAGE ID             @ZA01544
*                                                                Y02134
WTO04010 EQU   *                        ISSUE TERMINAL MSG       Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6725
*                                                                Y02134
         ICM   R0,B'1111',WTOMSG1       LOAD ID AND LENGTH     @ZA01544
         TPUT  (1),(0),R                SEND MSG TO TERMINAL     Y02134
*                                                                Y02134
         OI    WTOTSOSW,X80             SET TSO SWITCH         @ZA01544
*                                                                Y02134
WTO04020 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        GET MESSAGE WORK AREA                                   Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO05000 EQU   *                                                 Y02134
*                                                                Y02134
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134
         L     RD,IECMSGQA-IECPREFX(,RF) LOAD WORK AREA POINTER  Y02134
         LTR   RD,RD                    TEST FOR VALID POINTER   Y02134
         BNZ   WTO05010                 BRANCH, WORK AREA VALID  Y02134
*                                                                Y02134
         IECRES GET,LV=WTOBUFFL,PREFIX=YES,ID=MSGS,              Y02134X
               STM=(R2,RF,IECREGSV-IECPREFX(RF))                 Y02134
*                                                                Y02134
         LR    RD,R1                    LOAD WORK AREA POINTER   Y02134
         ST    RD,IECMSGQA-IECPREFX(,RF) SAVE MESSAGE WORK AREA  Y02134
*                                                                Y02134
WTO05010 EQU   *                        INITIALIZE WTO BUFFER    Y02134
*                                                                Y02134
         MVI   WTOBUFFR,BLANK           SET UP,                @ZA01544
*                                       PROPAGATE BLANKS       @ZA01544
         MVC   WTOBUFFR+K1(WTOEND2-WTOBUFFR),WTOBUFFR BLANKS   @ZA01544
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                              @Y30LSFY
***************************************************************@Y30LSBS
*                                                              @Y30LSFY
*        VIRTUAL DASD MOUNT AND DEMOUNT ROUTINES               @Y30LSFY
*                                                              @Y30LSFY
***************************************************************@Y30LSBS
*                                                              @Y30LSFY
WTO08900 EQU   *                        VIRTUAL DASD MOUNT RTN @Y30LSFY
***************************************************************@Y30LSFY
         XC    WTOBUFFR(MNTSIZE+MNTXLGTH+K4),WTOBUFFR CLEAR    @G18MSBS
*                                       PARMAMETER LIST        @G18MSBS
         ST    RD,MNTSIZE+MNTXLGTH(,RD) SAVE WTOBUFFR ADDRESS  @G18MSBS
*                                                              @Y30LSFY
         BAL   RET,WTO09110             MOVE VOLSER TO UCB     @Y30LSFY
*                                                              @Y30LSFY
         CLC   SCRTCH,K0(R1)            REQ FOR SCRATCH VOLUME @Y30LSFY
         BNE   WTO08910                 BRANCH NO              @Y30LSFY
         OI    MNTFLAGS-ICBMNTD1(RD),SCRPACK SET SCR VOL FLAG  @G18MSBS
         CLI   WTGMODNM+K4,EOVID        WAS EOV THE CALLER?    @Y30LSFY
         BNE   WTO08910                 NO                     @Y30LSFY
*                                       EOV MOUNT SCRATCH REQ  @Y30LSFY
         OI    MNTFLAGS-ICBMNTD1(RD),SCNDRY+MNTLSTX SET SCNDRY @G18MSBS
*                                       AND MNT LST EXT FLAGS  @G18MSBS
         LA    RF,MNTSIZE(,RD)          GET ADDRESS OF MOUNT   @G18MSBS
*                                       LIST EXTENSION AND     @G18MSBS
         ST    RF,MNTEXTP-ICBMNTD1(,RD) MOVE IT TO LIST        @G18MSBS
         LR    RD,RF                    SETUP FOR EXTENSION    @G18MSBS
         LA    RF,DXJBF                 WORK AREA JFCB         @Y30LSFY
         ST    RF,MNTXJFCB-MNTXT(,RD)   MOVE JFCB PTR TO LIST  @G18MSBS
         L     RF,DXJSCBAD              LOAD JSCB ADDRESS      @G18MSBS
         L     RF,JSCBJCT-IEZJSCB(,RF)  GET JCT PTR FROM JSCB  @G18MSBS
         LA    RF,SWAPREFX+JCTJNAME-JCTABLE(,RF) GET PTR OF    @G18MSBS
*                                       JOB NAME               @G18MSBS
         ST    RF,MNTXJOBN-MNTXT(,RD)   AND SAVE IT IN EXT     @G18MSBS
         L     RF,DXJSCBAD              RELOAD JSCB ADDRESS    @G18MSBS
         L     RF,JSCSCT-IEZJSCB(,RF)   GET SCT PTR FROM JSCB  @G18MSBS
         LA    RF,SWAPREFX+SCTSNUMB-SCTABLE(,RF) GET PTR OF    @G18MSBS
*                                       STEP NUMBER            @G18MSBS
         ST    RF,MNTXSTEP-MNTXT(,RD)   AND SAVE IT IN EXT     @G18MSBS
         L     RD,MNTXLGTH(,RD)         RELOAD PARMLIST        @G18MSBS
         B     WTO08920                 DON'T MOVE IN VOLSER   @Y30LSFY
*                                                              @Y30LSFY
WTO08910 EQU   *                        NOT A SCRATCH REQUEST  @Y30LSFY
*                                                              @Y30LSFY
         MVC   MNTVOLID-ICBMNTD1(K6,RD),K0(R1) VOLSER TO LIST  @G18MSBS
*                                                              @Y30LSFY
WTO08920 EQU   *                        ISSUE MOUNT MACRO      @Y30LSFY
*                                                              @Y30LSFY
         ICBMNTDE TYPE=MNT,VUA=UCBCHA,MF=(E,(RD))              @Y30LSFY
*                                                              @Y30LSFY
         LTR   RF,RF                    ANY ERRORS             @Y30LSFY
         BNZ   WTO10050                 BRANCH IF ERRORS       @Y30LSFY
*                                                              @Y30LSFY
         BAL   RET,WTO09150             SET THE MOUNT BIT      @Y30LSFY
*                                                              @Y30LSFY
         B     WTO01000                 BRANCH TO EXIT         @Y30LSFY
         EJECT
***************************************************************@Y30LSFY
WTO08950 EQU   *                        VIRT DASD DEMOUNT RTN  @Y30LSFY
***************************************************************@Y30LSFY
         XC    WTOBUFFR(K30),WTOBUFFR   CLEAR PARM LIST        @Y30LSFY
         BAL   RET,WTO09100             GET VOLSER & UNIT      @ZA05096
*                                                              @Y30LSFY
         ICBMNTDE TYPE=DMNT,VOLID=WTOVOLSR,VUA=UCBCHA,         @G24LSFS*
               MF=(E,(RD))
*                                                              @Y30LSFY
         LTR   RF,RF                    ANY ERRORS             @Y30LSFY
         BNZ   WTO10050                 BRANCH IF ERRORS       @Y30LSFY
*                                                              @Y30LSFY
         BAL   RET,WTO09400             LINK TO CLEAR UCB      @Y30LSFY
*                                                              @Y30LSFY
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT VOLSER    @Y30LSFY
*                                                              @Y30LSFY
         LR    RET,RB                   RESTORE RETURN REG     @Y30LSFY
         BR    RET                      RETURN                 @Y30LSFY
*                                                              @Y30LSFY
         EJECT
*
***********************************************************************
*
*        ASCII DDNAME-CODE MESSAGE ROUTINE
*
***********************************************************************
*
WTO09000 EQU   *                        DDNAME-CODE RTN        @ZA03694
*
         L     R1,DXREG1                LOAD ASCII CODE        @ZA03694
         LTR   R1,R1                    TEST FOR AL CODE         Y02134
         BZ    WTO09008                 BRANCH, ASSUME NOT AL    Y02134
*                                                                Y02134
         MVC   WTOADDN(L'TIOEDDNM),TIOEDDNM MOVE IN DDNAME     @ZA01544
         LA    RF,WTOADDN+L'TIOEDDNM+K1 POINT TO LAST CHAR     @ZA01544
*                                                                Y02134
WTO09002 EQU   *                        SET UP DDNAME-CODE       Y02134
*                                                                Y02134
         BCTR  RF,R0                    LOOKING FOR LAST CHAR    Y02134
         CLI   K0(RF),BLANK             FIND END OF DDNAME       Y02134
         BE    WTO09002                 BRANCH IF NOT AT END     Y02134
*                                                                Y02134
         MVI   K1(RF),DASH              FORM DDNAME-CODE         Y02134
         STC   R1,K2(,RF)               STORE CODE               Y02134
         OI    K2(RF),CHAR0             SET TO PRINT CODE        Y02134
*                                                                Y02134
WTO09008 EQU   *                        RETURN                 @ZA03694
*
         BR    RET                      RETURN                 @ZA03694
*
         EJECT
*
*****************************************************************Y02134
*                                                                Y02134
*        MOVE VOLUME SERIAL AND UNIT ID TO MESSAGE               Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09100 EQU   *                        CHECK UCB VOLSER         YM3916
*                                                                Y02134
         LA    R1,UCBVOLI               POINT TO UCB VOLSER      YM3916
         CLC   UCBVOLI,ZEROS            CHECK FOR VOL SER        YM3916
         BNZ   WTO09102                 BRANCH IF UCB = VOLSER @ZA01544
         LA    R1,DXVOLSR1              ASSUME VOLSER AT DXVOLSR1YM3916
*                                                              @ZA01544
WTO09102 EQU   *                        R1 POINTS TO VOLSER    @ZA01544
*                                                              @ZA01544
         MVC   WTOUNIT,UCBNAME          LOGICAL UNIT ADDR      @ZA01544
         MVC   WTOVOLSR,K0(R1)          VOLUME SERIAL NO.      @ZA01544
         B     WTO09106                 RETURN                 @ZA01544
*                                                                YM3916
WTO09105 EQU   *                        R1 POINTS TO VOLSER      YM3916
*                                                                YM3916
         MVC   WTOUNIT,UCBNAME          LOGICAL UNIT ADDR      @ZA01544
         MVC   WTOVOLSR,K0(R1)          VOLUME SERIAL NO.      @ZA01544
*                                                                Y02134
         CLC   SCRTCH,WTOVOLSR          CHECK FOR NON SPECIFIC @ZA01544
         BNE   WTO09106                 BRANCH NOT SCRTCH        YM3916
*                                                                Y02134
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE REQUEST Y02134
         BNO   WTO09106                 BRANCH IF NOT PRIVATE    YM3916
*                                                                Y02134
         MVC   WTOVOLSR,PRIVAT          ASK FOR PRIVATE VOL    @ZA01544
*                                                                Y02134
WTO09106 EQU   *                        RETURN                 @ZA12197
*                                                                Y02134
         CLI   WTOVOLSR,BLANK           IS VOLSER PRESENT      @ZA01544
         BCR   K7,RET                   RETURN IF PRESENT      @ZA01544
         MVI   WTOVOLSR,COMMA           PUT IN COMMA FOR       @ZA01544
*                                       SKIPPED FIELD          @ZA01544
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        MOVE VOLUME SERIAL TO UCB                               Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09110 EQU   *                                                 Y02134
*                                                                Y02134
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134
*                                                                Y02134
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082
*                                                                Y02134
WTO09120 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X
               RELATED=(LOCAL,IFG0194J(WTO09140))                Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082
*                                                                Y02134
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134
         BNZ   WTO10000                 BRANCH IF SETLOCK ERROR  Y02134
*                                                                Y02134
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082
*                                                                Y02134
         XC    UCBVOLI,UCBVOLI          CLEAR VOL SERIAL NO.     Y02134
*                                                                Y02134
         CLC   SCRTCH,K0(R1)            CHECK FOR SCRATCH        Y02134
         BE    WTO09130                 BRANCH FOR SCRATCH VOL   Y02134
*                                                                Y02134
         MVC   UCBVOLI,K0(R1)           MOVE VOLUME SER TO UCB   Y02134
*                                                                Y02134
WTO09130 EQU   *                        RELEASE LOCK             Y02134
*                                                                Y02134
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02134
*                                                                Y02134
WTO09140 SETLOCK RELEASE,TYPE=LOCAL,                             Y02134X
               RELATED=(LOCAL,IFG0194J(WTO09120))                Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         DM KEY                   Y02082
*                                                                Y02134
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134
         BNZ   WTO10000                 BRANCH IF SETLOCK ERROR  Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        SET UP DOM MESSAGE ID
*        NOTE - DOM IS ISSUED FOR MOUNT MESSAGES ONLY
*        OTHER MESSAGES ARE INFORMATIONAL
*        WTOR MSGS ARE DOMED BY WTO EXCEPT 2 LINE WTOR WHERE THE
*        MSG IS MULTI-LINE.
*        DOM NOT SUPPORTED FOR DA BECAUSE OF UCB CHANGES
*
*        R1 HAS WTO ID ON ENTRY TO THIS ROUTINE
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09150 EQU   *                        SET UP DOM MSG ID      @ZA00018
*                                                                Y02134
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082
*                                                                Y02134
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   YM7310
         BO    WTO09170                 BYPASS DOM               YM7310
*                                                                YM7310
         XC    UCBFSER,UCBFSER          CLEAR MCS IDS            YM7310
         STCM  R1,B'0111',UCBFSER       SAVE DOM ID              YM7310
         OI    UCBSTAB,UCBBNUL          SET DOM INDICATOR        YM7310
*
         CLC   SCRTCH,WTOVOLSR          CHECK FOR NON SPECIFIC @ZA10463
         BE    WTO09160                 BRANCH SCRATCH         @ZA10463
*
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE REQ   @ZA10463
         BNO   WTO09170                 BRANCH IF NOT PRIVATE  @ZA10463
WTO09160 EQU   *                                               @ZA10463
         OI    UCBSTAB,UCBBPRV          SET PRIVATE INDICATOR  @ZA10463
*
***********************************************************************
*
*        SET THE MOUNT BIT
*
***********************************************************************
*                                                                YM7310
WTO09170 EQU   *                        RETURN                   YM7310
*                                                                YM7310
         OIL   UCBDMCT,UCBMOUNT,REF=UCBOB,WREGS=(,,RF) MOUNT ON@ZA00018
*
         MODESET EXTKEY=DATAMGT         DM KEY                   Y02082
*                                                                YM7310
         BR    RET                      RETURN                   YM7310
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        FINISH MESSAGE                                          Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09300 EQU   *                                                 Y02134
*                                                                Y02134
         L     RF,WTGPREFX              FETCH PREFIX ADDRESS   @ZM30627
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGS           @ZM30627
         L     RF,DXTCBADR              LOAD CURRENT TCB ADDRESS Y02134
         L     RF,TCBTIO-TCB(,RF)       LOAD TIOT ADDRESS        Y02134
         MVC   WTOJOB,TIOCNJOB-TIOT(RF) JOB NAME               @ZA01544
         MVC   WTOSTEP,TIOCSTEP-TIOT(RF) STEP NAME             @ZA01544
         OC    WTOJOB,BLANKS            FOLD TO UPPER CASE     @ZA01544
         CLI   WTOJOB,BLANK             IS JOBNAME PRESENT     @ZA01544
         BNE   WTO09310                 BRANCH IF PRESENT      @ZA01544
         MVI   WTOJOB,COMMA             PUT IN COMMA FOR       @ZA01544
*                                       SKIPPED FIELD          @ZA01544
WTO09310 EQU   *                                               @ZA01544
*                                                                Y02134
         OC    WTOSTEP,BLANKS           FOLD TO UPPER CASE     @ZA01544
         CLI   WTOSTEP,BLANK            IS STEPNAME PRESENT    @ZA01544
         BNE   WTO09311                 BRANCH IF PRESENT      @ZA01544
         MVI   WTOSTEP,COMMA            PUT IN COMMA FOR       @ZA01544
*                                       SKIPPED FIELD          @ZA01544
WTO09311 EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02134
*                                                                Y02134
*        REMOVE BLANKS FROM MESSAGE                            @ZA01544
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        NO. OF CHARACTERS TO MOVE (1 CHAR TO LEFT TO REMOVE BLANKS) =
*              LENGTH OF THE FIELD
*              - 1 (BECAUSE CHARACTER 1 DOES NOT MOVE)
*              + 1 (FOR THE BLANK OFF THE END TO PAD WITH)
*              - 1 (BECAUSE MVC REQUIRES 1 LESS THAN TOTAL)
*
*        NO. OF CHARACTERS TO CHECK FOR BLANK =
*              LENGTH OF THE FIELD
*              - 1 (BECAUSE NO NEED TO CHECK THE LAST ONE)
*
*        THEREFORE NUMBER TO TEST = NUMBER TO MOVE
*
         LA    RF,WTOEND-WTOUNIT+K1     LENGTH OF LINE 1 SCAN  @ZA01544
         LA    R1,WTOUNIT-K1            INIT FOR LOOP          @ZA01544
*                                                                Y02134
WTO09312 EQU   *                        LOOP TO REMOVE BLANKS    Y02134
*                                                                Y02134
         CLI   K1(R1),BLANK             LOOK FOR BLANKS          Y02134
         BNE   WTO09316                 BRANCH GET NEXT          Y02134
*                                                                Y02134
         CLI   K0(R1),COMMA             COMMA PRESENT            Y02134
         BNE   WTO09314                 BRANCH TO INSERT COMMA   Y02134
*                                                                Y02134
         EX    RF,MOVE1                 MVC   K1(R0,R1),K2(R1)   Y02134
         B     WTO09318                 BRANCH TO CHECK NEXT     Y02134
*                                                                Y02134
WTO09314 EQU   *                        SET COMMA AT STRING END  Y02134
*                                                                Y02134
         MVI   K1(R1),COMMA             MOVE IN COMMA            Y02134
*                                                                Y02134
WTO09316 EQU   *                        CHECK NEXT CHARACTER     Y02134
*                                                                Y02134
         LA    R1,K1(,R1)               INCREMENT TO NEXT BYTE   Y02134
*                                                                Y02134
WTO09318 EQU   *                        TEST FOR END OF LINE 1   Y02134
*                                                                Y02134
         BCT   RF,WTO09312              CHECK NEXT CHARACTER     Y02134
         LR    RB,R1                    SAVE POINTER TO END+1  @ZA01544
         MVI   K0(R1),BLANK             BLANK LAST COMMA       @ZA01544
         MVI   WTOBREAK,COMMA           SET MSG BREAK CHAR     @ZA01544
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        REMOVE BLANKS FROM WTOINSTR FIELD                     @ZA01544
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IN ORDER TO LEFT JUSTIFY WTOINSTR FIELD:
*        NO. OF CHARACTERS TO MOVE (1 CHAR TO LEFT TO REMOVE BLANKS) =
*              LENGTH OF THE FIELD (ALREADY INCLUDES BLANK AT END)
*              - 1 (BECAUSE CHARACTER 1 DOES NOT MOVE)
*              - 1 (BECAUSE MVC REQUIRES 1 LESS THAN TOTAL)
*
*        NO. OF CHARACTERS TO CHECK FOR BLANK = 1
*
         LA    RF,WTOUNIT-WTOINSTR-K2   GET MOVE LENGTH          YM3855
         LA    R1,WTOINSTR-K1           MOVE ADDRESS -1        @ZA01544
*                                                                Y02134
         CLI   WTOINSTR,BLANK           BLANK = D OR K MSG     @ZA01544
         BNE   WTO09319                 BRANCH IF CHAR EXISTS    Y02134
         EX    RF,MOVE1                 MVC   K1(R0,R1),K2(R1)   Y02134
*                                                                Y02134
WTO09319 EQU   *                        REMOVE BLANKS (WTOINSTR) YM3855
*                                                                Y02134
*        NO. OF CHARACTERS TO MOVE (1 CHAR TO LEFT TO REMOVE BLANKS) =
*              LENGTH OF THE FIELD
*              + 1 (TO INCLUDE LEADING BLANK)
*              - 1 (BECAUSE CHARACTER 1 DOES NOT MOVE)
*              + 1 (FOR THE BLANK OFF THE END TO PAD WITH)
*              - 1 (BECAUSE MVC REQUIRES 1 LESS THAN TOTAL)
*
*        NO. OF CHARACTERS TO CHECK FOR BLANK= UNTIL NON-BLANK IS FOUND
*
         LA    R1,WTOUNIT-K2-K1         MOVE ADDRESS -1        @ZA01544
         LR    RF,RB                    GET END POINTER        @ZA01544
         SR    RF,R1                    GET MOVE LENGTH        @ZA01544
*                                                                Y02134
WTO09320 EQU   *                        LOOP TO REMOVE BLANKS    Y02134
*                                                                Y02134
         CLI   K1(R1),BLANK             LOOK FOR BLANKS          Y02134
         BNE   WTO09332                 BRANCH GET NEXT        @ZM30627
*                                                                Y02134
         EX    RF,MOVE1                 MVC   K1(R0,R1),K2(R1)   Y02134
         BCTR  RB,R0                    DECREMENT END POINTER  @ZA01544
*                                                                Y02134
         BCT   R1,WTO09320              DECREMENT AND BRANCH     Y02134
         EJECT
*                                                              @ZA01544
************************************************************** @ZA01544
*                                                              @ZA01544
*        ADD WTO PARAMETERS TO MESSAGE AND SPLIT INTO TWO      @ZA01544
*        LINES IF THE TEXT IS GREATER THAN 34 BYTES OR THREE   @ZA01544
*        LINES IF THE TEXT IS GREATER THAN 104 BYTES           @ZA01544
*                                                              @ZA01544
*        INPUT: RB = ADDRESS OF END OF MESSAGE TEXT + 1        @ZA01544
*               COMPRESSED MESSAGE STARTING AT 'WTOMSGID'      @ZA01544
*                                                              @ZA01544
*        OUTPUT: COMPLETED MESSAGE(S) READY FOR WTO(R)         @ZA01544
*                                                              @ZA01544
************************************************************** @ZA01544
*                                                              @ZA01544
WTO09330 EQU   *                                               @ZA01544
         L     RF,WTGPREFX              FETCH PREFIX ADDRESS   @ZA01544
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGS           @ZA01544
WTO09332 EQU   *                                               @ZM30627
         LA    R1,MSG1MAX               GET MAX END OF MESSAGE @ZA01544
         CR    R1,RB                    WILL MSG FIT ON 1 LINE @ZA01544
         BL    WTO09335                 NO, BRANCH             @ZA01544
         LR    R1,RB                    POINT TO END+1         @ZA01544
         BCTR  R1,R0                    POINT TO END           @ZA01544
         B     WTO09345                 SKIP BREAK             @ZA01544
WTO09335 EQU   *                                               @ZA01544
         BCTR  R1,R0                    ADJUST START           @ZA01544
         CLC   K0(K1,R1),WTOBREAK       NATURAL BREAK          @ZA01544
         BE    WTO09340                 YES, BRANCH            @ZA01544
         B     WTO09335                 GO CHECK NEXT          @ZA01544
WTO09340 CLI   K0(R1),BLANK             BLANK ON END           @ZA01544
         BNE   WTO09345                 NO, BRANCH             @ZA01544
         BCT   R1,WTO09340              REMOVE BLANK FROM END  @ZA01544
WTO09345 LA    R4,K1(,R1)               SAVE PTR TO LAST BLANK @ZA01544
         LA    R2,WTOMSGID              POINT TO MSG START     @ZA01544
         SR    R1,R2                    GET MOVE LENGTH        @ZA01544
         EX    R1,MOVE2                 SPLIT MSG              @ZA01544
*MOVE2   MVC   MSG1STRT(R0),WTOMSGID                           @ZA01544
         EX    R1,FOLD1                 FOLD BLANKS            @ZA01544
         MVC   WTOSWTCH,WTOFLAGS        SET WTO FLAGS          @ZA01544
         LA    R1,MSG1STRT-WTOMSG1+K1(,R1) GET MSG 1 LENGTH    @ZA01544
         STH   R1,WTOLNGTH              STORE IN WTO PARMS     @ZA01544
         LA    R1,WTOMSG1-WTOBUFFR(R1,RD)  GET POINTER TO END  @ZA01544
         XC    WTOCODES-WTOEND(K4,R1),WTOCODES-WTOEND(R1) CODE @ZA01544
         MVC   WTOCODES+K2-WTOEND(L'WTODCODE,R1),WTODCODE DA   @ZA01544
         TM    UCBTBYT3,UCB3DACC        TEST FOR DA DEVICE     @ZA01544
         BO    WTO09350                 BRANCH IF DA           @ZA01544
         MVC   WTOCODES+K2-WTOEND(L'WTOTCODE,R1),WTOTCODE TAPE @ZA01544
WTO09350 OC    WTOCODES-WTOEND(K4,R1),WTODRCDS ROUT & DESC     @ZA01544
         MVC   WTOLINE1-WTOEND(L'WTOD,R1),WTOD LINE 1 TYPE     @ZA01544
         MVI   WTONLINE-WTOEND(R1),K2  INDICATE 2 LINES        @ZA01544
         MVC   WTOLGTH2-WTOEND(L'WTOLGTHE,R1),WTOLGTHE SET     @ZA01544
*                                       LENGTH AND TYPE-LINE 2 @ZA01544
         CR    R4,RB                    2ND LINE NEEDED        @ZA01544
         BE    WTO09375                 IF NOT, BRANCH         @ZA01544
         MVI   WTONLINE-WTOEND(R1),K3   INDICATE 3 LINES       @ZA01544
         LA    RC,WTOMSG2-WTOCODES(R1)  POINT TO LINE 2        @ZA01544
         MVC   WTOLINE2-WTOMSG2(K2,RC),WTOD RESET LINE TYPE    @ZA01544
         MVC   WTOMSID2-WTOMSG2(K8,RC),MSG1STRT PROPAGATE ID   @ZA01544
         LA    R1,62(R4)                MAX END OF LINE 2      @ZA01544
         LR    RA,R4                    SAVE PTR TO LINE 1 END @ZA01544
         CR    R1,RB                    MSG FIT ON 2 LINES     @ZA01544
         BL    WTO09355                 NO, BRANCH             @ZA01544
         LR    R1,RB                    POINT TO END+1         @ZA01544
         BCTR  R1,R0                    POINT TO END           @ZA01544
         B     WTO09365                 SKIP BREAK             @ZA01544
WTO09355 EQU   *                                               @ZA01544
         BCTR  R1,R0                    ADJUST START           @ZA01544
         CLC   K0(K1,R1),WTOBREAK       NATURAL BREAK          @ZA01544
         BE    WTO09360                 YES, BRANCH            @ZA01544
         B     WTO09355                 GO CHECK NEXT          @ZA01544
WTO09360 CLI   K0(R1),BLANK             BLANK ON END           @ZA01544
         BNE   WTO09365                 NO, BRANCH             @ZA01544
         LA    RA,K1(RA)                ADJUST LINE BEGIN      @ZA01544
         BCT   R1,WTO09360              REMOVE BLANK FROM END  @ZA01544
WTO09365 LA    R4,K1(,R1)               SAVE PTR TO LAST BLANK @ZA01544
         SR    R1,RA                    GET LENGTH OF LINE 2   @ZA01544
         EX    R1,MOVE3                 SPLIT MESSAGE          @ZA01544
         EX    R1,FOLD2                 FOLD BLANKS            @ZA01544
         LA    R1,WTOEND2-WTOMSG2+K1(R1) LINE 2 LENGTH         @ZA01544
         STCM  R1,B'0011',WTOLGTH2-WTOLGTH2(RC) STORE LENGTH   @ZA01544
         LA    RC,WTOEND2-WTOEND2(R1,RC) POINT TO END          @ZA01544
         MVC   WTOLGTH2-WTOMSG2(L'WTOLGTHE,RC),WTOLGTHE        @ZA01544
         CR    R4,RB                    LINE 3 NEEDED          @ZA01544
         BE    WTO09375                 NO, BRANCH             @ZA01544
         CLI   WTOBREAK,BLANK           CHKPT MESSAGE          @ZA01544
         BNE   WTO09370                 NO, BRANCH             @ZA01544
         LA    R4,K1(R4)                BEGINING OF LAST LINE  @ZA01544
         LR    RA,R4                    SET FOR EXECUTE MOVE   @ZA01544
         LR    R1,RB                    POINT TO END+1         @ZA01544
         BCTR  R1,R0                    POINT TO END           @ZA01544
         SR    R1,R4                    GET LENGTH OF MOVE     @ZA01544
         EX    R1,MOVE3                 MOVE LAST LINE         @ZA01544
WTO09370 EQU   *                                               @ZA01544
         SR    RB,R4                    GET LENGTH OF LINE 3   @ZA01544
         BCTR  RB,R0                    DECREMENT FOR OR       @ZA01544
         EX    RB,FOLD2                 FOLD BLANKS            @ZA01544
         LA    RB,WTOEND2-WTOMSG2+K1(,RB) LINE 3 LNGTH         @ZA01544
         STCM  RB,B'0011',WTOLGTH2-WTOMSG2(RC) STORE LENGTH    @ZA01544
         MVC   WTOLINE2-WTOMSG2(L'WTODE,RC),WTODE LINE 3 TYPE  @ZA01544
         MVC   WTOMSID2-WTOMSG2(K8,RC),MSG1STRT PROPAGATE ID   @ZA01544
WTO09375 EQU   *                                               @ZM34658
         L     RF,WTGPREFX              FETCH PREFIX ADDRESS   @ZM34658
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS        @ZM34658
         BR    RET                      RETURN                 @ZA01544
*                                                                Y02134
MOVE1    MVC   K1(R0,R1),K2(R1)         FILL BLANKS ON LEFT AND  Y02134
*                                       PROPAGTE BLANKS ON RIGHT Y02134
*                                                              @ZA01544
MOVE2    MVC   MSG1STRT(R0),WTOMSGID    SPLIT MSG              @ZA01544
*                                                              @ZA01544
FOLD1    OC    MSG1STRT(R0),BLANKS                             @ZA01544
*                                                              @ZA01544
MOVE3    MVC   WTOEND2-WTOMSG2(R0,RC),K0(RA) SPLIT FOR LINE 3  @ZA01544
*                                                              @ZA01544
FOLD2    OC    WTOEND2-WTOMSG2(R0,RC),BLANKS                   @ZA01544
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        CLEAR UCB FOR UNLOAD                                    Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09400 EQU   *                                                 Y02134
*                                                                Y02134
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134
         ST    RD,IECREGSV-IECPREFX(,RF) SAVE REGISTER 13        Y02134
         LA    RD,IECREGSV+K4-IECPREFX(,RF) IOSGEN SAVE AREA     Y02134
*                                                                Y02134
         MODESET EXTKEY=ZERO            KEY 0 FOR IOSGEN         Y02082
*                                                                Y02134
         IOSGEN UCBFLG,UCB=(RUCB),VAR=ON,TABLE=UCBNRY  NOT READY YM5390
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082
         L     RD,IECREGSV-IECPREFX(,RF) RESTORE REGISTER 13     Y02134
*                                                                Y02134
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134
*                                                                Y02134
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082
*                                                                Y02134
WTO09410 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X
               RELATED=(LOCAL,IFG0194J(WTO09420))                Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082
*                                                                Y02134
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134
         BNZ   WTO10000                 BRANCH IF SETLOCK ERROR  Y02134
*                                                                Y02134
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082
*                                                                Y02134
         XC    UCBVOLI,UCBVOLI          CLEAR VOL SERIAL NO.     Y02134
         NI    UCBDMCT,ALLBITS-UCBMOUNT RESET MOUNT BIT          YM7503
         NI    UCBJBNR,ALLBITS-UCBMONT  SET PASS TO 0            YM1472
         NI    UCBSTAB,ALLBITS-(UCBBPRV+UCBBPUB) SET PRIVATE   @ZA02881
*                                       AND PUBLIC TO ZERO     @ZA02881
         NI    UCBSTAT,ALLBITS-UCBDADI  SET SL TO 0              YM1472
*                                                                Y02134
         L     RF,UCBEXTPT              LOAD UCB EXTENSION PTR   Y02146
         USING UCBCMEXT,RF              RF POINTS TO EXTENSION   Y02146
         NI    UCBFLP1,ALLBITS-UCBNSRCH RESET NONSCRATCH         YM7503
         DROP  RF                                                Y02146
*                                                                Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE UNIT       Y02134
         BNO   WTO09415                 BRANCH IF NOT TAPE       Y02134
*                                                                Y02134
         XC    UCBFSER,UCBFSER          CLEAR MCS IDS            Y02134
         XC    UCBFSCT,UCBFSCT          CLEAR FILE COUNTERS      Y02134
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE SEQ COUNTERS  Y02134
         NI    UCBWGT,ALLBITS-UCBREW    SET REWIND OFF           YM3925
         NI    UCBSTAB,ALLBITS-(UCBBNUL+UCBBSTR) CLR DOM FLG   @ZA02881
*                                       AND SET AL TO ZERO     @ZA02881
         NI    UCBTFL1,ALLBITS-(UCBNLTP+UCBNSLTP+UCBDQDSP) NL/ @ZA18506*
                                        NSL/DEQ RESET          @ZA18506
WTO09415 EQU   *                        RELEASE LOCAL LOCK       Y02134
*                                                                Y02134
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      YM3221
*                                                                YM3221
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02134
*                                                                Y02134
WTO09420 SETLOCK RELEASE,TYPE=LOCAL,                             Y02134X
               RELATED=(LOCAL,IFG0194J(WTO09410))                Y02134
*                                                                Y02134
         MODESET EXTKEY=DATAMGT         DM KEY                   Y02082
*                                                                Y02134
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134
         BNZ   WTO10000                 BRANCH IF SETLOCK ERROR  Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*
***********************************************************************
*
*        CLEAR DISPOSITION FOR VOLUME REJECT
*
***********************************************************************
*
WTO09450 EQU   *                        CLEAR DISPOSITION      @ZA00700
*
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS    @ZA00700
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS      @ZA00700
*
         MODESET EXTKEY=ZERO            SETLOCK KEY            @ZA00700
*
WTO09460 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA00700X
               RELATED=(LOCAL,IFG0194J(WTO09470))              @ZA00700
*
         LM    R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS      @ZA00700
*
         NI    UCBSTAB,ALLBITS-(UCBBPRV+UCBBPUB) SET PRIVATE   @ZA02881
*                                       AND PUBLIC TO ZERO     @ZA02881
         NI    UCBJBNR,ALLBITS-UCBMONT  SET PASS TO 0          @ZA00700
*
WTO09470 SETLOCK RELEASE,TYPE=LOCAL,                           @ZA00700X
               RELATED=(LOCAL,IFG0194J(WTO09460))              @ZA00700
*
         MODESET EXTKEY=DATAMGT         DM KEY                 @ZA00700
*
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS    @ZA00700
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS   @ZA00700
*
         BR    RET                      RETURN                 @ZA00700
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        GET DSNAME FOR MESSAGE                                  Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09500 EQU   *                                                 Y02134
*                                                                Y02134
         LA    R1,DXJBF                 WORK AREA JFCB           Y02134
         CLC   DXDSAB,DXDSABAD          CONCATENATION CHECK      Y02134
         BE    WTO09510                 BRANCH IF NO CONCATENATN Y02134
         LA    R1,TIOEJFCB              POINTER TO JFCB PREFIX   Y02134
         IECRES LOCJFCB,(R1)            LOCATE JFCB              Y02134
*                                                                Y02134
WTO09510 EQU   *                        R1 POINTS TO DSNAME      Y02134
*                                                                Y02134
         TM    JFCBIND2-INFMJFCB(R1),JFCTEMP TEMPORARY DATA SET  Y02134
         BO    WTO09530                 YES, DSNAME NOT REQUIRED Y02134
         L     RF,CVTPTR                LOAD CVT POINTER         Y02134
         L     RF,CVTMSLT-CVT(,RF)      MASTER SCHED LINK TABLE  Y02134
         TM    BAMONITR-BASE(RF),BADSN  MONITOR DSNAMES ACTIVE   Y02080
         BNO   WTO09530                 NO, BRANCH               Y02134
*                                                                Y02134
WTO09520 EQU   *                        DSNAME TO MESSAGE        Y02134
*                                                                Y02134
         MVC   WTODSN,JFCBDSNM-INFMJFCB(R1)  MOVE DSNAME       @ZA01544
*                                                                Y02134
WTO09530 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                              @ZA18506
************************************************************** @ZA18506
*                                                              @ZA18506
*        DEQ TAPE VOLUME SERIAL IF UCB INDICATES TO DO SO.     @ZA18506
*        MESSAGE AREA ADDRESS PASSED IN RD.                    @ZA18506
*                                                              @ZA18506
************************************************************** @ZA18506
*                                                              @ZA18506
WTO09550 EQU   *                                               @ZA18506
*                                                              @ZA18506
         TM    UCBTBYT3,UCB3TAPE        IS IT A TAPE           @ZA18506
         BZR   RET                      RETURN IF NO           @ZA18506
         TM    UCBTFL1,UCBDQDSP         IS DEQ REQUIRED        @ZA18506
         BZR   RET                      RETURN IF NOT          @ZA18506
*                                                              @ZA18506
*        USE MESSAGE AREA ADDRESSED BY RD                      @ZA18506
*                                                              @ZA18506
         ST    RET,DEQRTN               SAVE RETURN            @ZA18506
         MVC   DEQLIST,DEQPLIST         MOVE PARMLIST FOR DEQ  @ZA18506
         L     R1,DXJSCBAD              ACTIVE JSCB            @ZA18506
         USING IEZJSCB,R1                                      @ZA18506
         L     R0,JSCBTCBP              INITIATOR TCB          @ZA18506
         DROP  R1                                              @ZA18506
         LA    RF,UCBVOLI               ADDRESS VOLSER IF UCB  @ZA18506
         CLC   UCBVOLI,ZEROS            IS VOLSER IN UCB       @ZA18506
         BNZ   WTO09560                 BR IF VOLSER IN UCB    @ZA18506
         LA    RF,DXVOLSR1              ADDRESS VOLSER         @ZA18506
*                                                              @ZA18506
WTO09560 EQU   *                        DEQ VOLUME SERIAL      @ZA18506
*                                                              @ZA18506
         DEQ   (,(RF)),TCB=(0),MF=(E,DEQ),RET=HAVE DEQ VOLSER  @ZA18506
*                                                              @ZA18506
         L     RET,DEQRTN               RESTORE RETURN         @ZA18506
         B     WTO05010                 BLANK BUFFER & RETURN  @ZA18506
*                                                              @ZA18506
DEQPLIST DS    0F                       DEQ PARMLIST           @ZA18506
         DEQ   (SYSZVOLS,,6,SYSTEM),TCB=0,MF=L DEQ PARMLIST    @ZA18506
DEQPLTH  EQU   *-DEQPLIST               LENGTH OF PARMLIST     @ZA18506
SYSZVOLS DC    C'SYSZVOLS'              MAJOR NAME             @ZA18506
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        GET LABEL TYPE FOR TAPE MESSAGE FROM UCB                Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09600 EQU   *                                                 Y02134
*                                                                Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134
         BNO   WTO09645                 BRANCH IF NOT TAPE     @ZA01544
*                                                                Y02134
         TM    UCBSTAT,UCBDADI          TEST FOR SL VOLUME       Y02134
         BNO   WTO09610                 BRANCH IF NOT SL         Y02134
         MVC   WTOLBLTP(L'SLCHAR),SLCHAR MOVE SL TO MESSAGE    @ZA01544
         B     WTO09640                 BRANCH TO RETURN         Y02134
*                                                                Y02134
WTO09610 EQU   *                        TEST FOR AL TAPE         Y02134
*                                                                Y02134
         TM    UCBSTAB,UCBBSTR          TEST FOR ANSI VOLUME     Y02134
         BNO   WTO09620                 BRANCH IF NOT ANSI VOL   Y02134
         MVC   WTOLBLTP(L'ALCHAR),ALCHAR MOVE AL TO MESSAGE    @ZA01544
         B     WTO09640                 BRANCH TO RETURN         Y02134
*                                                                Y02134
WTO09620 EQU   *                        TEST FOR NL TAPE         Y02134
*                                                                Y02134
         TM    UCBTFL1,UCBNLTP          TEST FOR NL VOLUME       Y02134
         BNO   WTO09630                 BRANCH IF NOT NL VOL     Y02134
         MVC   WTOLBLTP(L'NLCHAR),NLCHAR MOVE NL TO MESSAGE    @ZA01544
         B     WTO09640                 BRANCH TO RETURN         Y02134
*                                                                Y02134
WTO09630 EQU   *                        TEST FOR NSL TAPE        Y02134
*                                                                Y02134
         TM    UCBTFL1,UCBNSLTP         TEST FOR NSL VOLUME      Y02134
         BNO   WTO09640                 BRANCH, VOL NOT IDENTIFD Y02134
         MVC   WTOLBLTP(L'NSLCHAR),NSLCHAR MOVE NSL TO MSSAGE  @ZA01544
*                                                                Y02134
WTO09640 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         CLI   WTOLBLTP,BLANK           IS LABEL TYPE PRESENT  @ZA01544
         BCR   K7,RET                   RETURN IF PRESENT      @ZA01544
         MVI   WTOLBLTP,COMMA           PUT IN COMMA FOR       @ZA01544
*                                       SKIPPED FIELD          @ZA01544
WTO09645 EQU   *                        RETURN                 @ZA01544
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        GET LABEL TYPE FOR TAPE MESSAGE FROM JFCB               Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09650 EQU   *                                                 Y02134
*                                                                Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134
         BNO   WTO09698                 BRANCH IF NOT TAPE     @ZA02881
*                                                                YM4647
WTO09654 EQU   *                        TEST FOR DENSITY       @ZA02881
*                                                              @ZA02881
         TM    DXDEBMOD,DEN1600         IS THIS NINE TRK UNIT  @ZA02881
         BO    WTO09658                 BRANCH TO TEST DEN     @ZA02881
*                                                              @ZA02881
         BZ    WTO09668                 BRANCH, DENSITY IS 200 @ZA02881
*                                                              @ZA02881
         TM    DXDEBMOD,DCBDEN08        TEST FOR 800 BPI       @ZA02881
         BZ    WTO09666                 BRANCH IF 556          @ZA02881
         B     WTO09664                 BRANCH, MOVE 800 BPI   @ZA02881
*                                                              @ZA02881
WTO09658 EQU   *                        TEST FOR 1600 BPI      @ZA02881
*                                                              @ZA02881
         CLI   DXDEBMOD,DX800           IS THIS 800 BPI        @ZA02881
         BE    WTO09664                 BRANCH, MOVE 800 BPI   @ZA02881
*                                                              @ZA02881
         CLI   DXDEBMOD,DCBD6250        IS THIS 6250 BPI       @ZA02881
         BE    WTO09662                 BRANCH, MOVE 6250 BPI  @ZA02881
*                                                              @ZA02881
         CLI   DXDEBMOD,DCBD1600        IS THIS 1600 BPI       @ZA02881
         BNE   WTO09670                 BRANCH TO SKIP         @ZA02881
*                                                              @ZA02881
         MVC   WTODEN(L'BPICN160),BPICN160 MOVE IN 1600 BPI    @ZA02881
         B     WTO09670                 BRANCH TO GET LBL TYPE @ZA02881
*                                                              @ZA02881
WTO09662 EQU   *                        SET 6250 BPI           @ZA02881
*                                                              @ZA02881
         MVC   WTODEN(L'BPICN625),BPICN625  MOVE IN 6250 BPI   @ZA02881
         B     WTO09670                 BRANCH TO GET LBL TYPE @ZA02881
*                                                              @ZA02881
WTO09664 EQU   *                        SET 800 BPI            @ZA02881
*                                                              @ZA02881
         MVC   WTODEN(L'BPICON80),BPICON80 MOVE IN 800 BPI     @ZA02881
         B     WTO09670                 BRANCH TO GET LBL TYPE @ZA02881
*                                                              @ZA02881
WTO09666 EQU   *                        SET 556 BPI            @ZA02881
*                                                              @ZA02881
         MVC   WTODEN(L'BPICON55),BPICON55 MOVE IN 556 BPI     @ZA02881
         B     WTO09670                 BRANCH TO GET LBL TYPE @ZA02881
*                                                              @ZA02881
WTO09668 EQU   *                        SET 200 BPI            @ZA02881
*                                                              @ZA02881
         MVC   WTODEN(L'BPICON20),BPICON20 MOVE IN 200 BPI     @ZA02881
*                                                              @ZA02881
WTO09670 EQU   *                                               @ZA02881
*
         CLI   WTODEN,BLANK             IS DENSITY PRESENT     @ZA02881
         BNE   WTO09674                 RETURN IF PRESENT      @ZA02881
         MVI   WTODEN,COMMA             PUT IN COMMA FOR       @ZA02881
*                                       SKIPPED FIELD          @ZA02881
WTO09674 EQU   *                        FIND LABEL TYPE        @ZA02881
*
         TM    JFCBLTYP,JFCBLP          CHECK FOR BLP REQUEST  @ZA02881
         BNO   WTO09678                 BR IF NOT BLP REQUEST  @ZA02881
         MVC   WTOLBLTP(L'BLPCHAR),BLPCHAR MOVE BLP TO MESSAGE @ZA02881
         B     WTO09694                 BRANCH TO RETURN       @ZA02881
*                                                              @ZA02881
WTO09678 EQU   *                        TEST FOR SL REQUEST    @ZA02881
*                                                              @ZA02881
         TM    JFCBLTYP,JFCSL           CHECK FOR SL REQUEST   @ZA02881
         BNO   WTO09682                 BR IF NOT SL REQUEST   @ZA02881
         MVC   WTOLBLTP(L'SLCHAR),SLCHAR MOVE SL TO MESSAGE    @ZA02881
         B     WTO09694                 BRANCH TO RETURN       @ZA02881
*                                                              @ZA02881
WTO09682 EQU   *                        TEST FOR AL REQUEST    @ZA02881
*                                                              @ZA02881
         TM    JFCBLTYP,JFCBAL          TEST FOR AL REQUEST    @ZA02881
         BNO   WTO09686                 BR IF NOT AL REQUEST   @ZA02881
         MVC   WTOLBLTP(L'ALCHAR),ALCHAR MOVE AL TO MESSAGE    @ZA02881
         B     WTO09694                 BRANCH TO RETURN       @ZA02881
*                                                              @ZA02881
WTO09686 EQU   *                        TEST FOR NL REQUEST    @ZA02881
*                                                              @ZA02881
         TM    JFCBLTYP,JFCNL           CHECK FOR NL REQUEST   @ZA02881
         BNO   WTO09690                 BR IF NOT NL REQUEST   @ZA02881
         MVC   WTOLBLTP(L'NLCHAR),NLCHAR MOVE NL TO MESSAGE    @ZA02881
         B     WTO09694                 BRANCH TO RETURN       @ZA02881
*                                                              @ZA02881
WTO09690 EQU   *                        TEST FOR NSL REQUEST   @ZA02881
*                                                              @ZA02881
         TM    JFCBLTYP,JFCNSL          CHECK FOR NSL REQUEST  @ZA02881
         BNO   WTO09694                 BR IF NOT NSL REQEST   @ZA02881
         MVC   WTOLBLTP(L'NSLCHAR),NSLCHAR MOVE NSL TO MSG     @ZA02881
*                                                              @ZA02881
WTO09694 EQU   *                                               @ZA02881
*                                                                Y02134
         CLI   WTOLBLTP,BLANK           LABEL TYPE PRESENT     @ZA01544
         BCR   K7,RET                   YES, BRANCH            @ZA02881
         MVI   WTOLBLTP,COMMA           PUT IN COMMA FOR       @ZA01544
*                                       SKIPPED FIELD          @ZA01544
WTO09698 EQU   *                        RETURN                 @ZA02881
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        GET SPACE INFORMATION AND WRITE SMF RECORD 19           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO09700 EQU   *                                                 Y02134
*                                                                Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134
         BO    WTO09740                 BRANCH IF TAPE           Y02134
*                                                                Y02134
         TM    UCBDMCT,UCBMOUNT         UNSATISFIED MOUNT        YM7503
         BO    WTO09740                 BRANCH IF PENDING        YM7503
*                                                                YM7503
         XR    R1,R1                    CLEAR REG FOR LSPACE     Y02134
         L     RF,CVTPTR                LOAD CVT POINTER         Y02134
         L     RF,CVTMSLT-CVT(,RF)      MASTER SCHED LINK TABLE  Y02134
         TM    BAMONITR-BASE(RF),BASPACE MONITOR SPACE ACTIVE    Y02080
         BNO   WTO09710                 BRANCH IF NO             Y02080
         LA    R1,WTOSPACE              POINTER TO SPACE AREA  @ZA01544
*                                                                Y02134
WTO09710 EQU   *                        TEST FOR SMF ACTIVE      Y02134
*                                                                Y02134
         L     RF,CVTPTR                LOAD CVT POINTER         Y02134
         L     RF,CVTSMCA-CVT(,RF)      GET SMCA ADDRESS         Y02134
         LTR   RF,RF                    TEST FOR SMF SYSTEM      Y02134
         BZ    WTO09720                 BRANCH IF NON-SMF SYSTEM Y02134
*                                                                Y02134
         TM    SMCAOPT-SMCABASE(RF),SMCAVOL TEST IF SMF VOL ACCT Y02134
         BZ    WTO09720                 BRANCH IF NO ACCT'G      Y02134
*                                                                Y02134
         LA    RF,X80                   SET UP LSPACE SMF FLAG   Y02134
         SLL   RF,K24                   MOVE FLAG TO BIT 0       Y02134
         OR    R1,RF                    PUT FLAG INTO PARM REG   Y02134
*                                                                Y02134
WTO09720 EQU   *                        CALL LSPACE              Y02134
*                                                                Y02134
         LTR   R1,R1                    IS LSPACE SVC REQUIRED   Y02134
         BZ    WTO09740                 BRANCH IF NOT, RETURN    Y02134
*                                                                Y02134
         LA    R0,UCBOB                 PT TO UCB IN REG 0       Y02134
LSPACE   EQU   78                       LSPACE SVC NUMBER        YM3925
         SVC   LSPACE                   ISSUE SPACE SVC          Y02134
*                                                                Y02134
         CLI   WTOSPACE,BLANK           INFO PRESENT           @ZA01544
         BE    WTO09735                 NO, BRANCH             @ZA01544
         LA    R1,WTODEN                POINT TO END OF SPACE  @ZA01544
         LA    RF,WTOSPACE              POINT TO BEGIN         @ZA01544
         SR    R1,RF                    FIND LENGTH            @ZA01544
         BCTR  R1,R0                    DECREMENT              @ZA01544
WTO09722 CLI   K0(RF),COMMA             IS THIS A COMMA        @ZA01544
         BE    WTO09725                 YES, BRANCH            @ZA01544
         CLI   K0(RF),BLANK             IS THIS A BLANK        @ZA01544
         BNE   WTO09730                 NO, BRANCH             @ZA01544
         CLI   K1(RF),BLANK             IS THIS THE END        @ZA01544
         BE    WTO09740                 YES, BRANCH            @ZA01544
WTO09725 NI    K0(RF),LOWCASE           MAKE LOWER CASE        @ZA01544
WTO09730 LA    RF,K1(RF)                CHECK NEXT CHAR        @ZA01544
         BCT   R1,WTO09722              GO CHECK NEXT          @ZA01544
         BR    RET                      RETURN                 @ZA01544
WTO09735 MVI   WTOSPACE,COMMA           SET FOR SKIPPED FIELD  @ZA01544
WTO09740 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        REWIND UNLOAD TAPE UNIT                                 Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                YM1472
*        NOTE- THIS ROUTINE MUST BE EXECUTED BEFORE CLEARING     YM1472
*              THE MESSAGE AREA. SEE LABEL WTO05000.             YM1472
*                                                                YM1472
*****************************************************************YM1472
*                                                                Y02134
WTO09800 EQU   *                                                 Y02134
*                                                                Y02134
         TM    UCBFL1,UCBNOTRD          TEST IF NOT READY        YM7503
         BO    WTO09820                 BRANCH NOT READY         YM7503
*                                                                YM7503
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134
         BNO   WTO09810                 BRANCH IF NOT TAPE       Y02134
*                                                                YM7503
         TM    UCBDMCT,UCBMOUNT         UNSATISFIED MOUNT        YM7503
         BO    WTO09805                 BRANCH TO UNLOAD         YM7503
*                                                                YM6449
*        VOLSTAT (0)                    ISSUE VOLUME STATISTICS  A46383
*                                                                YM6449
         CLC   UCBVOLI,ZEROS            CHECK FOR VOL SER        YM6449
         BNZ   WTO09802                 BRANCH IF GOOD VOL SER   YM6449
*                                                                YM6449
         MODESET EXTKEY=ZERO            UCB KEY                  YM6449
*                                                                YM6449
         MVC   UCBVOLI,DXVOLSR1         SETUP VOL SER            YM6449
*                                                                YM6449
         MODESET EXTKEY=DATAMGT         DATA MNGT KEY            YM6449
*                                                                YM6449
WTO09802 EQU   *                        VOL SER IN UCB           YM6449
*                                                                YM6449
*                                                                YM6441
         LCR   R0,RUCB                  LOAD UCB FOR VOLSTAT     YM6441
*                                                                YM6441
WTO09803 EQU   *                        INITIALIZE FOR VOLSTAT   YM6441
*                                                                YM6441
         L     R1,DXTCBADR              LOAD TCB ADDRESS         YM6449
         L     R1,TCBTIO-TCB(R1)        LOAD JOBNAME POINTER     YM6449
VOLSTAT  EQU   91                       VOLSTAT SVC NUMBER       YM3925
         SVC   VOLSTAT                  VOLSTAT SVC              YM6449
*                                                                YM7503
WTO09805 EQU   *                        REWIND UNLOAD TAPE       YM7503
*                                                                Y02134
         MVC   DXREGA+K1,DXDEBUCB+K1    SAVE WORK AREA UCB       YM4647
         STCM  RUCB,B'0111',DXDEBUCB+K1 SET UP UCB ADDRESS       YM4647
*                                                                YM4647
         MVC   DXCCW1,REWDUNLD          REWIND AND UNLOAD CCW    Y02134
         EXCP  DXIOB                    REWIND AND UNLOAD        Y02134
*                                                                Y02134
         STM   RB,RET,DXCCW2            SAVE REGS 11 - 14        Y02134
         LM    RTIOT,RET,DXREGSAV       RESTORE REGISTERS        Y02134
         LM    R0,R1,DXREG0             RESTORE REGISTERS        Y02134
*                                                                Y02134
         IECRES WAIT                    WAIT FOR IMMED CHAN END  Y02134
*                                                                Y02134
         LM    RB,RET,DXCCW2            RESTORE REGS 11 - 14     Y02134
*                                                                YM4647
         MVC   DXREGA+K1,DXDEBUCB+K1    RESTORE REG 10 SAVE AREA YM4647
         STCM  RUCB,B'0111',DXDEBUCB+K1 RESTORE WORK AREA UCB    YM4647
         L     RUCB,DXREGA              RESTORE REG 10           YM4647
*                                                                YM4647
         XC    DXCCW2,DXCCW2            CLEAR SAVE AREA          Y02134
         XC    DXCCW3,DXCCW3            CLEAR SAVE AREA          Y02134
         B     WTO09820                 BRANCH TO RETURN         YM6449
*                                                                YM6449
WTO09810 EQU   *                        DIRECT ACCESS            YM6449
*                                                                YM7503
         TM    UCBDMCT,UCBMOUNT         UNSATISFIED MOUNT        YM7503
         BO    WTO09820                 BRANCH TO EXIT           YM7503
*                                                                YM6449
*        VOLSTAT (0)                    ISSUE VOLUME STATISTICS  A46383
*                                                                YM6449
         CLC   UCBVOLI,ZEROS            CHECK FOR VOL SER        YM6449
         BNZ   WTO09812                 BRANCH IF GOOD VOL SER   YM6449
*                                                                YM6449
         MODESET EXTKEY=ZERO            UCB KEY                  YM6449
*                                                                YM6449
         MVC   UCBVOLI,DXVOLSR1         SETUP VOL SER            YM6449
*                                                                YM6449
         MODESET EXTKEY=DATAMGT         DATA MNGT KEY            YM6449
*                                                                YM6449
WTO09812 EQU   *                        VOL SER IN UCB           YM6449
*                                                                YM6449
         LCR   R0,RUCB                  LOAD UCB FOR VOLSTAT     YM6441
         L     R1,DXTCBADR              LOAD TCB ADDRESS         YM6449
         L     R1,TCBTIO-TCB(R1)        LOAD JOBNAME POINTER     YM6449
         SVC   VOLSTAT                  VOLSTAT SVC              YM6449
*                                                                YM6449
WTO09820 EQU   *                        RETURN                   YM6449
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        REWIND TAPE UNIT                                        Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                YM1472
*        NOTE- THIS ROUTINE MUST BE EXECUTED BEFORE CLEARING     YM1472
*              THE MESSAGE AREA. SEE LABEL WTO05000.             YM1472
*                                                                YM1472
*****************************************************************YM1472
*                                                                Y02134
WTO09850 EQU   *                                                 Y02134
*                                                                Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134
         BNO   WTO09860                 BRANCH IF NOT TAPE       Y02134
*                                                                YM3925
         MODESET EXTKEY=ZERO            UCB KEY                  YM3925
*                                                                YM3925
         NI    UCBDMCT,ALLBITS-UCBMOUNT RESET UNSATISFIED MOUNT  YM7503
         XC    UCBFSER,UCBFSER          CLEAR MCS IDS            YM3925
         XC    UCBFSCT,UCBFSCT          CLEAR FILE COUNTERS      YM3925
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE SEQ COUNTERS  YM3925
*                                                                YM3925
         MODESET EXTKEY=DATAMGT         RESET TO DM KEY          YM3925
*                                                                YM7503
         TM    UCBFL1,UCBNOTRD          TEST FOR NOT READY TAPE  YM7503
         BO    WTO09860                 BRANCH IF NOT READY      YM7503
*                                                                Y02134
         MVC   DXREGA+K1,DXDEBUCB+K1    SAVE WORK AREA UCB       YM4647
         STCM  RUCB,B'0111',DXDEBUCB+K1 SET UP UCB ADDRESS       YM4647
*                                                                YM4647
         MVC   DXCCW1,REWIND            REWIND CCW               Y02134
         EXCP  DXIOB                    REWIND                   Y02134
*                                                                Y02134
         STM   RB,RET,DXCCW2            SAVE REGS 11 - 14        Y02134
         LM    RTIOT,RET,DXREGSAV       RESTORE REGISTERS        Y02134
         LM    R0,R1,DXREG0             RESTORE REGISTERS        Y02134
*                                                                Y02134
         IECRES WAIT                    WAIT FOR IMMED CHAN END  Y02134
*                                                                Y02134
         LM    RB,RET,DXCCW2            RESTORE REGS 11 - 14     Y02134
*                                                                YM4647
         MVC   DXREGA+K1,DXDEBUCB+K1    RESTORE REG 10 SAVE AREA YM4647
         STCM  RUCB,B'0111',DXDEBUCB+K1 RESTORE WORK AREA UCB    YM4647
         L     RUCB,DXREGA              RESTORE REG 10           YM4647
*                                                                YM4647
         XC    DXCCW2,DXCCW2            CLEAR SAVE AREA          Y02134
         XC    DXCCW3,DXCCW3            CLEAR SAVE AREA          Y02134
*                                                                YM3925
         MODESET EXTKEY=ZERO            UCB KEY                  YM3925
*                                                                YM3925
         OI    UCBWGT,UCBREW            SET REWIND BIT FOR SCHED YM3925
*                                                                YM3925
         MODESET EXTKEY=DATAMGT         RESET TO DM KEY          YM3925
*                                                                Y02134
WTO09860 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         BR    RET                      RETURN                   Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        AN ERROR HAS BEEN DETECTED                              Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
WTO10000 EQU   *                                                 Y02134
*                                                                Y02134
         DMABCOND PCK,SETLOCK           SETLOCK ERROR ROUTINE    Y02134
         EJECT
***************************************************************@Y30LSBS
*                                                              @Y30LSBS
*        SSC  MOUNT/DEMOUNT FAILURE - 737-30 ABEND             @Y30LSBS
*                                                              @Y30LSFY
***************************************************************@Y30LSBS
*                                                              @Y30LSFY
WTO10050 EQU   *                        MOUNT/DEMOUNT ERROR    @Y30LSFY
         STH   R0,K0(,R1)               SAVE REASON CODE       @Y30LSBS
         LR    RB,R1                    PASS PARM LIST PTR     @Y30LSBS
         DMABCOND ERR111,ID4J0P         XCTL TO PROB DET       @Y30LSBS
*                                                              @Y30LSFY
***************************************************************@Y30LSBS
         EJECT
*****************************************************************Y02083
*                                                                Y02083
*        MOVE JOB NAME TO CHECKPOINT SECURITY MESSAGE            Y02083
*                                                                Y02083
*        INPUT: RB = ADDRESS OF NEXT AVAILABLE MESSAGE SLOT      Y02083
*                                                                Y02083
*        OUTPUT: JOB NAME IN MESSAGE                             Y02083
*                RB     = ADDRESS OF FIRST BLANK BYTE            Y02083
*                         AFTER THE JOB NAME                     Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
WTO10100 L     RF,DXTCBADR              GET TCB ADDRESS          Y02083
         L     RF,TCBTIO-TCB(,RF)       GET TIOT ADDRESS         Y02083
         MVC   K0(K8,RB),TIOCNJOB-TIOT(RF) JOB NAME TO MESSAGE   Y02083
         BAL   RF,WTO10200              FIND END OF JOB NAME     Y02083
         BR    RET                      RETURN                   Y02083
         EJECT
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*        MOVE DDNAME, UNIT ADDRESS, AND VOLUME SERIAL TO         Y02083
*        CHECKPOINT SECURITY MESSAGE                             Y02083
*                                                                Y02083
*        INPUT: RB = ADDRESS OF NEXT AVAILABLE MESSAGE SLOT      Y02083
*                                                                Y02083
*        OUTPUT: DDNAME, UNIT ADDRESS, AND VOLUME SERIAL IN      Y02083
*                MESSAGE                                         Y02083
*                RB = ADDRESS OF FIRST BLANK AFTER VOLUME        Y02083
*                     SERIAL AND RIGHT PARENTHESIS               Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
WTO10150 MVI   K0(RB),LEFTPAR           DROP IN LEFT PARENTHESIS Y02083
         MVC   K1(K8,RB),TIOEDDNM       MOVE IN DD NAME          Y02083
         BAL   RF,WTO10200              FIND END OF DD NAME      Y02083
         MVI   K0(RB),COMMA             DROP IN COMMA            Y02083
         MVC   K1(K3,RB),UCBNAME        MOVE IN UNIT ADDRESS     Y02083
         MVI   K4(RB),COMMA             DROP IN COMMA            Y02083
         LA    RB,K5(,RB)               BUMP TO START OF VOL ID  Y02083
         MVC   K0(K6,RB),UCBVOLI        MOVE IN VOLUME SERIAL    Y02083
         OC    K0(K6,RB),BLANKS         FOLD ZEROS TO BLANKS     Y02083
         BAL   RF,WTO10200              FIND END OF VOL ID       Y02083
         MVI   K0(RB),RIGHTPAR          DROP IN RIGHT PAREN      Y02083
         LA    RB,K1(,RB)               POINT TO AFTER PAREN     Y02083
         BR    RET                      RETURN                   Y02083
*                                                                Y02083
WTO10200 CLI   K0(RB),BLANK             LOOK FOR BLANK           Y02083
         BCR   EQ,RF                    RETURN WHEN BLANK FOUND  Y02083
         LA    RB,K1(,RB)               BUMP TO NEXT BYTE        Y02083
         B     WTO10200                 LOOP BACK                Y02083
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*              CONSTANTS                                         Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
CHARK    EQU   C'K'                     KEEP CHARACTER ID        Y02134
CHARR    EQU   C'R'                     RETAIN CHARACTER ID      Y02134
DASH     EQU   C'-'                     HYPHEN SEPARATOR         Y02134
SWAPREFX EQU   16                       PREFIX OF QUEUE ELEMENT@G18MSBS
ERR111   EQU   111                      MSS FAILURE CODE       @Y30LSFY
LOWCASE  EQU   X'BF'                    FOLD CHARACTER TO      @ZA01544
*                                       LOWER CASE             @ZA01544
EOVID    EQU   C'5'                     EOV ID CHARACTER       @Y30LSFY
LEFTPAR  EQU   C'('                     ( CHARACTER CONSTANT     Y02083
RIGHTPAR EQU   C')'                     ) CHARACTER CONSTANT     Y02083
EQ       EQU   8                        BRANCH MASK              Y02083
CLOSEID  DC    CL3'020'                 CLOSE ID               @ZA03196
OPENID   DC    CL3'019'                 OPEN IDENTIFIER        @ZA06693
PRIVAT   DC    CL6'PRIVAT'              PRIVATE SCRTCH REQUEST   Y02134
SCRTCH   DC    CL6'SCRTCH'              SCRTCH VOLUME SERIAL     Y02134
ZEROS    DC    XL6'00'                  ZERO VOLUME SERIAL       Y02134
REWDUNLD DC    X'0F00000020000050'      REWIND UNLOAD CCW        Y02134
REWIND   DC    X'0700000020000050'      REWIND CCW               Y02134
*                                                                Y02134
*              0AL2(0),B'123456789ABCDEF0'                       YM7526
WTOFLAGS DC    0AL2(0),B'1000000001000000' MCS MULTI-LINE FLAGS  YM7526
WTOTCODE DC    0AL2(0),B'0010100000000000' TAPE POOL ROUT CODE   YM7526
WTODCODE DC    0AL2(0),B'0001010000000000' DA POOL ROUT CODE     YM7526
WTOD     DC    0XL3'00',X'2000',X'00'   LINE 1 DELIMITER         Y02134
WTODE    DC    XL2'3000'                LINE 2 DELIMITER         Y02134
WTOLGTHE DC    XL4'00041000'            LENGTH AND TYPE E      @ZA01544
*                                                                Y02134
NLCHAR   DC    CL2'NL'                  NL LABEL TYPE            Y02134
ALCHAR   DC    CL2'AL'                  AL LABEL TYPE            Y02134
SLCHAR   DC    CL2'SL'                  SL LABEL TYPE            Y02134
NSLCHAR  DC    CL3'NSL'                 NSL LABEL TYPE           Y02134
BLPCHAR  DC    CL3'BLP'                 BLP LABEL REQUEST        YM4647
*                                                                Y02134
BPICON80 DC    0CL7' ',C'800',X'00',C'BPI' 800 BPI               Y02134
BPICON55 DC    0CL7' ',C'556',X'00',C'BPI' 556 BPI               Y02134
BPICON20 DC    0CL7' ',C'200',X'00',C'BPI' 200 BPI               Y02134
BPICN160 DC    0CL8' ',C'1600',X'00',C'BPI' 1600 BPI             YM1157
BPICN625 DC    0CL8' ',C'6250',X'00',C'BPI' 6250 BPI             YM1157
*                                                                Y02134
BLANKS   DC    CL80' '                  BLANK VOLUME SERIAL      Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        REPLY OUTSTANDING MESSAGE                               Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IECREPLY DC    0CL18'IECREPLY'          REPLY MESSAGE          @ZA01544
         DC    AL2(IECEND-IECREPLY)     WTOR MESSAGE LENGTH      Y02134
WTORFLAG DC    0XL2'8000',B'1000000000000000' WTOR MCS INDICATOR Y02134
         DC    C'IECNNNY REPLY '        MESSAGE                @ZA01544
IECEND   EQU   *                        END OF MESSAGE           YM1238
*              DESC=(2),ROUT=(1)        ROUTING & DESCRIPTOR CDS YM7526
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
WTORCODE DC    0AL4(0),B'0100000000000000',B'1000000000000000'   YM7526
*                                                                Y02134
*00 IECNNNY REPLY 'REPLY OPTIONS'                              @ZA02881
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR DATA SET    Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC108I  DC    0CL60'IEC108I'           TSO MESSAGE              Y02134
         DC    C'IEC108I OPERATOR ACTION HAS BEEN ' TSO OPER MSG YM3925
         DC    C'REQUESTED FOR YOUR DATA SET' TSO OPER MSG       YM3925
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
         XCTLTABL ID=(ID4J0P,0P),BRT=SHORT                     @ZA03694
*                                                              @Y30LSBS
         EJECT
*                                                              @Y30LSBS
***************************************************************@Y30LSBS
*                                                              @Y30LSBS
WTOPAGE2 DS    0H                       PAGE TWO OF MODULE     @Y30LSBS
*                                                              @Y30LSBS
***************************************************************@Y30LSBS
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC501A MOUNT MESSAGE                                   YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC501A  DS    0H                       MOUNT MESSAGE RTN      @ZA03694
*                                                                Y02134
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE         @ZA03694
         BAL   RET,IEC502E4             LINK TO UNLOAD UCB     @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                              @Y30LSFY
         LA    R1,DXVOLSR2              POINT TO VOLUME TO MNT @Y30LSFY
*                                                              @Y30LSFY
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS @Y30LSFY
         BZ    WTO20110                 BRANCH NO              @Y30LSFY
         TM    UCBTBYT2,UCBRVDEV        TEST FOR VIRTUAL DASD  @Y30LSFY
         BO    WTO08900                 BRANCH YES UCBRVDEV RTN@Y30LSFY
*                                                              @Y30LSFY
WTO20110 EQU   *                        NOT VIRTUAL DASD       @Y30LSFY
*                                                              @Y30LSFY
         MVC   WTOMSGID(L'MIEC501A),MIEC501A MOUNT MESSAGE     @ZA03694
         MVC   WTODRCDS,IEC501AC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09105             GET VOLSER & UNIT        YM3916
*                                                                Y02134
         BAL   RET,WTO09110             MOVE VOLSER TO UCB       Y02134
*                                                                Y02134
         BAL   RET,WTO09650             LINK TO GET LABEL,DEN    Y02134
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
         BAL   RET,WTO09150             SET THE MOUNT BIT        Y02134
*                                                                Y02134
         BAL   RET,WTO04000             LINK TO TELL TERMINAL    Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC501A M DDD,VOLSER,LBL,DENS,JOBNAME,STEPNAME,DSNAME           YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC501A DC    CL16'IEC501A M'          MOUNT VOLUME           @ZA03694
*              DESC=(2),ROUT=()         ROUTING & DESCRIPTOR CDS
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC501AC DC    0AL4(0),B'0100000000000000',B'0000000000000000' @ZA01278
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC501E LOOK AHEAD MOUNT MESSAGE                        YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC501E  DS    0H                       LOOK AHEAD MOUNT RTN   @ZA03694
*                                                                Y02134
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE         @ZA03694
         BAL   RET,IEC502E4             LINK TO UNLOAD UNIT    @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                              @ZM32752
         MVC   WTOMSGID(L'MIEC501E),MIEC501E MOUNT MESSAGE     @ZA01544
         MVC   WTODRCDS,IEC501EC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @Y30LSBS
*                                                                Y02134
         LA    R1,DXVOLSR3              POINT TO LOOKAHEAD VOL @ZA03660
         BAL   RET,WTO09105             GET VOLSER & UNIT        YM3916
*                                                                Y02134
         BAL   RET,WTO09110             MOVE VOLSER TO UCB       Y02134
*                                                                Y02134
         BAL   RET,WTO09650             LINK TO GET LABEL,DEN    Y02134
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
         BAL   RET,WTO09150             SET THE MOUNT BIT        Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC501E M DDD,VOLSER,LBL,DENS,JOBNAME,STEPNAME,DSNAME           YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC501E DC    CL16'IEC501E M'          MOUNT VOLUME           @ZA03694
*              DESC=(3),ROUT=()         ROUTING & DESCRIPTOR CDS
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC501EC DC    0AL4(0),B'0100000000000000',B'0000000000000000' @ZA02505
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC502E K VOLUME DISPOSITION MESSAGE                  @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC502E1 DS    0H                       VOLUME DISP RTN        @ZA03694
*                                                                Y02134
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY ACTIVITY   YM7503
         BNZ   WTO01000                 BRANCH YES, SKIP         Y02134
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            YM7526
         BNO   WTO01000                 BRANCH IF NOT TAPE       YM7526
         CLC   UCBFSCT,ZEROS            REWIND INDICATED         YM7843
         BNZ   WTO01000                 BRANCH IF NOT TO RETURN  YM7843
*                                                                YM3916
*****************************************************************YM3916
*                                                                YM3916
*        IF EXACTLY TWO UNITS ARE SPECIFIED BYPASS REWIND SO     YM7526
*        LOOKAHEAD MOUNT DOES NOT WAIT FOR REWIND TO FINISH.     YM7526
*                                                                YM3916
*****************************************************************YM3916
*                                                                YM3916
         MODESET EXTKEY=ZERO            UCB KEY                  YM7526
*                                                                YM7526
         XC    UCBFSER,UCBFSER          CLEAR MCS IDS            YM7526
         XC    UCBFSCT,UCBFSCT          CLEAR FILE COUNTERS      YM7526
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE SEQ COUNTERS  YM7526
*                                                                YM7526
         MODESET EXTKEY=DATAMGT         RESET TO DM KEY          YM7526
*                                                                YM7526
         BALR  RET,0                    BASE ADDRESS           @ZA03184
         USING *,RET                    ESTABLISH BASE REG     @ZA03184
*
         CLC   DXVOLSR3,ZEROS           CHECK IF LOOKAHEAD MOUNT YM7526
         BZ    WTO20212                 BRANCH IF NOT          @ZA03184
         LA    RF,TIOEFSRT-K1-TIOENTRY+K4+K4 LEN FOR TWO UNITS   YM7526
         CLM   RF,B'0001',TIOENTRY      CHECK FOR TWO UNITS      YM7526
         BE    WTO01000                 BRANCH IF TWO            YM7526
*
WTO20212 EQU   *                        CHECK DISPOSITION      @ZA03184
*
         CLC   CLOSEID,WTGMODNM+K3      CHECK FOR CLOSE        @ZA03184
         BNE   WTO20218                 BRANCH IF EOV          @ZA03184
         TM    DXDCBLST,PLISTOP2        CHECK FOR DISP         @ZA03184
         BNZ   WTO20218                 BRANCH IF NOT DISP     @ZA03184
         TM    UCBJBNR,UCBMONT          CHECK FOR DISP=PASS    @ZA03184
         BO    WTO20218                 BRANCH IF VOL RETAINED @ZA03184
         TM    UCBSTAB,UCBBPRV          TEST FOR DISP=KEEP     @ZA03184
         BZ    WTO20218                 BRANCH IF PUBLIC VOL   @ZA03184
         TM    UCBTFL1,UCBNLTP+UCBNSLTP TEST IF NL,NSL, OR BLP @ZA03184
         BZ    WTO20218                 BRANCH NOT NL          @ZA03184
         B     IEC502E                  ISSUE IEC502E K        @ZA03184
         DROP  RET                                             @ZA03184
*                                                                YM3916
WTO20218 EQU   *                        REWIND VOLUME            YM7526
*                                                                YM3916
         BAL   RET,WTO09850             REWIND TAPE VOL          Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
         EJECT
*
***********************************************************************
*
*        IEC502E DDNAME-CODE ASCII ERROR DISMOUNT MESSAGE
*
***********************************************************************
*
IEC502E2 DS    0H                       ASCII ERROR MSG RTN    @ZA03694
*
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
         LA    RB,MIEC502E              SET ASCII INDICATOR    @ZA04633
         B     IEC502E5                 ISSUE IEC502E MSG      @ZA04633
         DROP  RET                                             @ZA03694
         EJECT
*
***********************************************************************
*
*        IEC502E R REJECT VOLUME SPECIFIED BY DXVOLSR1
*
***********************************************************************
*
IEC502E3 DS    0H                       REJECT MESSAGE RTN     @ZA03694
*
         BAL   RET,WTO09450             CLEAR FOR REJECT       @ZA00700
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
         B     IEC502E                  ISSUE IEC502E MSG      @ZA03694
         DROP  RET                                             @ZA03694
         EJECT
*
***********************************************************************
*
*        IEC502E DISMOUNT MESSAGE
*
***********************************************************************
*
IEC502E  DS    0H                       DISMOUNT MESSAGE RTN   @ZA03694
*
         LA    RET,WTO01000             PREPARE RETURN REG       Y02134
*                                                                Y02134
IEC502E4 EQU   *                        ENTER FROM INTERNAL CALL Y02134
*                                                                Y02134
         LR    RB,RET                   SAVE RETURN REGISTER     Y02134
*                                                                Y02134
IEC502E5 EQU   *                                               @ZA04633
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR     @ZA03196
         BO    WTO20242                 BRANCH IF NO ERROR       YM3916
         TM    DXECB,ECBCOMPL           TEST FOR I/O ERROR     @ZA03196
         BNO   WTO20242                 BRANCH IF NONE           YM7488
*                                                                Y02134
         BAL   RET,IEC512IA             LINK TO I/O ERROR MSG    Y02134
         DROP  RET                                             @ZA03694
*                                                                Y02134
WTO20242 EQU   *                        ISSUE DISMOUNT MESSAGE @ZA03694
*                                                                Y02134
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
         TM    UCBDMCT,UCBMOUNT         UNSATISFIED MOUNT        YM7503
         BO    WTO20244                 BRANCH TO ISSUE MSG ONLY YM7526
*                                                                YM7503
         TM    UCBFL1,UCBNOTRD          TEST FOR UNIT UNLOADED   Y02134
         BNO   WTO20244                 BRANCH TO ISSUE MSG    @ZA07691
         LA    R1,MIEC502E              GET ASCII INDICATOR    @ZA07691
         CR    RB,R1                    TEST FOR ASCII MSG     @ZA07691
         BNE   WTO20290                 RETURN                 @ZA07691
         LA    RB,WTO01000              PREPARE RETURN REG     @ZA07691
         B     WTO20290                 RETURN                 @ZA07691
*                                                                YM7526
WTO20244 EQU   *                        DISMOUNT VOLUME        @ZA03694
*                                                                Y02134
         DROP  RET                                             @ZA03694
         BAL   RET,WTO09800             LINK TO REWIND UNLOAD    YM1472
*                                                                YM1472
         MODESET EXTKEY=ZERO            GO TO KEY ZERO         @ZA17796
         NI    UCBVOPT,X'ED'            CLEAR ERROR RECOV      @ZA17796
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGT KEY   @ZA17796
*
         BAL   RET,WTO05000             LINK TO GET MSG AREA   @ZA18506
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
*
         BAL   RET,WTO09550             DEQ VOLSER IF REQUIRED @ZA18506
         USING *,RET                    REESTABLISH 2ND BASE   @ZA18506
*                                                              @Y30LSFY
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS @Y30LSFY
         BZ    WTO20246                 BRANCH NO              @ZA03694
         TM    UCBTBYT2,UCBRVDEV        TEST FOR VIRTUAL DASD  @Y30LSFY
         BO    WTO08950                 BRANCH YES UCBRVDEV RTN@Y30LSFY
*                                                              @Y30LSFY
WTO20246 EQU   *                        NOT VIRTUAL DASD       @ZA03694
*                                                                Y02134
         MVC   WTOMSGID(L'MIEC502E),MIEC502E DISMOUNT MESSAGE  @ZA01544
         MVC   WTODRCDS,IEC502EC        ROUT & DESC CODES      @ZA01544
*                                                                Y02134
         TM    UCBJBNR,UCBMONT          TEST FOR DISP=PASS       Y02134
         BNO   WTO20248                 BRANCH NOT DISP=PASS     Y02134
         MVI   WTOINSTR,CHARR           MOVE IN PASS INDICATOR @ZA01544
*                                                                Y02134
WTO20248 EQU   *                        TEST FOR PUBLIC VOLUME   Y02134
*                                                                Y02134
         TM    UCBSTAB,UCBBPUB          TEST FOR PUBLIC          Y02134
         BNO   WTO20252                 BRANCH NOT PUBLIC        YM7526
*
WTO20250 EQU   *                        DEFAULT DISMOUNT       @ZA00700
*
         MVI   WTOINSTR+K1,CHARD        MOVE D TO MSG          @ZA01544
         B     WTO20254                 BRANCH TO FINISH         YM7526
*                                                                Y02134
WTO20252 EQU   *                        TEST FOR PRIVATE VOLUME  Y02134
*                                                                Y02134
         TM    UCBSTAB,UCBBPRV          TEST FOR PRIVATE         Y02134
         BNO   WTO20254                 BRANCH NOT PRIVATE       Y02134
         MVI   WTOINSTR+K1,CHARK        MOVE K TO MSG          @ZA01544
*                                                                YM7526
WTO20254 EQU   *                        DETERMINE DEFAULT        Y02134
*                                                                Y02134
         CLI   WTOINSTR+K1,BLANK        TEST IF DISP SPECIFIED @ZA01544
         BNE   WTO20256                 BRANCH IF DISP SPECIFIED Y02134
         CLI   WTOINSTR,CHARR           CHECK FOR PASS         @ZA01544
         BE    WTO20250                 BRANCH TO GET PUBLIC   @ZA00700
*                                                                Y02134
         MVI   WTOINSTR,CHARR           SET IND TO REJECT      @ZA01544
         B     WTO20258                 BYPASS DSN AND SPACE   @ZA03694
*                                                                Y02134
WTO20256 EQU   *                        LSPACE AND DSNAME      @ZA03694
*                                                                Y02134
         DROP  RET                                             @ZA03694
         BAL   RET,WTO09700             LINK TO GET SPACE INFO   YM7526
*                                                                YM7526
*   DON'T PRINT DSNAME IF DISMOUNT IS FROM OPEN AS THE         @ZA06693
*   JFCB ADDRESS DOES NOT REFLECT THE CORRECT DATASET.         @ZA06693
         CLC   OPENID,WTGMODNM+K3       IS IT OPEN             @ZA06693
         BE    WTO20258                 YES - SKIP DSNAME      @ZA06693
*                                                              @ZA06693
         TM    DCBOFLGS,DCBOCON         CONCATENATION?         @ZA04633
         LA    RET,WTO20258             ESTABLISH RETURN ADDR  @ZA04633
         BNO   WTO09500                 BR TO GET DSNAME       @ZA04633
         L     R1,DXDSAB                GET DSAB ADDR          @ZA04633
         L     R1,DSABBCHN-DSAB(R1)     GET PREVIOUS DSAB ADDR @ZA04633
         L     R1,DSABTIOT-DSAB(R1)     GET TIOT ENTRY ADDR    @ZA04633
         LA    R1,TIOEJFCB-TIOENTRY(R1) GET PTR TO JFCB PREFIX @ZA04633
         IECRES LOCJFCB,(R1)            LOCATE JFCB            @ZA04633
         BAL   RET,WTO09510             LINK TO GET DSNAME     @ZA04633
*                                                                Y02134
WTO20258 EQU   *                        TEST FOR ASCII         @ZA03694
*                                                                Y02134
         BALR  RET,0                    BASE ADDRESS           @ZA03694
         USING *,RET                    ESTABLISH BASE REG     @ZA03694
         LA    R1,MIEC502E              GET ASCII INDICATOR    @ZA03694
         CR    RB,R1                    TEST FOR ASCII MSG     @ZA03694
         BNE   WTO20260                 BRANCH NOT ASCII       @ZA03694
         LA    RB,WTO01000              PREPARE RETURN REG     @ZA03694
         DROP  RET                                             @ZA03694
*
         BAL   RET,WTO09000             GET DDNAME-CODE        @ZA03694
*
WTO20260 EQU   *                        FINISH MESSAGE         @ZA03694
*
         BAL   RET,WTO09100             GET VOLSER & UNIT        YM3916
*                                                                Y02134
         BAL   RET,WTO09600             LINK TO GET LABEL TYPE   Y02134
*                                                                Y02134
         BAL   RET,WTO09400             LINK TO CLEAR UCB        Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
WTO20290 EQU   *                        RETURN                   Y02134
*                                                                Y02134
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT             YM1472
         LR    RET,RB                   RESTORE RETURN REG       Y02134
         BR    RET                      RETURN                   Y02134
*
***********************************************************************
*
*IEC502E XX DDD,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ
*IEC502E JOBNAME,STEPNAME,DSNAME
*
*IEC502E XX DDD,VOLSER,LBL,DDNAME-CODE,JOBNAME,STEPNAME,DSNAME
*        DISMOUNT MESSAGE
*
***********************************************************************
*
MIEC502E DC    CL16'IEC502E'            K,D,R,RK,RD            @ZA03694
*              DESC=(3),ROUT=()         ROUTING & DESCRIPTOR CDS
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC502EC DC    0AL4(0),B'0010000000000000',B'0000000000000000' @ZA01278
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC507D EXPIRATION DATE MESSAGE                         YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC507D  DS    0H                       EXPIRATION DATE RTN    @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC507D),MIEC507D EXPIRATION MSG    @ZA03694
         MVC   WTODRCDS,IEC507DC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @Y30LSBS
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        Y02134
*                                                                Y02134
         L     R1,DXREG0                LOAD DSNAME POINTER      Y02134
         BAL   RET,WTO09520             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02134
         LA    RC,IEC507DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC507D E DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                  @ZA02881
*        R 00,'U' TO USE OR                                      Y02134
*        R 00,'M' TO UNLOAD                                      Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC507D DC    CL16'IEC507D E'          EXPIRATION DATE MSG    @ZA03694
*              DESC=(2,7),ROUT=(1)   ROUTING & DESCRIPTOR CDS  @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC507DC DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                Y02134
IEC507DL DC    AL1(IEC507DE-IEC507DR)   LENGTH OF REPLY        @ZA01544
IEC507DR DC    C'''U''-USE OR ''M''-UNLOAD'                    @ZA01544
IEC507DE EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC509A FILE PROTECT MESSAGE                            YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC509A  DS    0H                       FILE PROTECT RTN       @ZA03694
*                                                                Y02134
         BAL   RET,WTO09800             LINK TO REWIND UNLOAD    Y02134
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC509A),MIEC509A FILE PROTECT MSG  @ZA03694
         MVC   WTODRCDS,IEC509AC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        YM3840
*                                                                Y02134
         BAL   RET,WTO09400             LINK TO CLEAR UCB        Y02134
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
         BAL   RET,WTO09150             SET THE MOUNT BIT        Y02134
*                                                                Y02134
         BAL   RET,WTO04000             LINK TO TELL TERMINAL    Y02134
*                                                                Y02134
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT SERIAL      YM1487
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC509A F DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                    YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC509A DC    CL16'IEC509A F'          FILE PROTECTED VOLUME  @ZA03694
*              DESC=(2),ROUT=()         ROUTING & DESCRIPTOR CDS
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC509AC DC    0AL4(0),B'0100000000000000',B'0000000000000000' @ZA01278
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC510D FILE PROTECT MESSAGE                            YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC510D  DS    0H                       FILE PROTECT WTOR RTN  @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC510D),MIEC510D FILE PROTECT MSG  @ZA03694
         MVC   WTODRCDS,IEC510DC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        YM3822
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02134
         LA    RC,IEC510DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC510D F DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                  @ZA02881
*        R 00,'U' TO USE OR                                      Y02134
*        R 00,'F' TO UNLOAD                                      Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC510D DC    CL16'IEC510D F'          FILE PROTECTED VOLUME  @ZA03694
*              DESC=(2,7),ROUT=(1)    ROUTING & DESCRIPTOR CDS @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC510DC DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                Y02134
IEC510DL DC    AL1(IEC510DE-IEC510DR)   LENGTH OF REPLY        @ZA01544
IEC510DR DC    C'''U''-USE OR ''F''-UNLOAD'                    @ZA01544
IEC510DE EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                              @G32DSMI
***************************************************************@G32DSMI
*                                                              @G32DSMI
*        IEC135A REMOVE FILE PROTECT RING MESSAGE              @G32DSMI
*                                                              @G32DSMI
***************************************************************@G32DSMI
*                                                              @G32DSMI
IEC135A  EQU   *                        ISSUE MESSAGE IEC135A  @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09800             LINK TO REWIND UNLOAD  @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO05000             LINK TO GET MSG AREA   @G32DSMI
         USING *,RET                    BASE FOR MESSAGE       @G32DSMI
*                                                              @G32DSMI
         MVC   WTOMSGID(L'MIEC135A),MIEC135A  MOVE IN MESSAGE  @G32DSMI
         MVC   WTODRCDS,IEC135AC        ROUTING & DESC CODES   @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09100             GET VOLSER AND UNIT    @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09400             LINK TO CLEAR UCB      @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09500             LINK TO GET DSNAME     @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09300             FINISH MESSAGE         @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO02000             LINK TO ISSUE WTO      @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO09150             SET THE MOUNT BIT      @G32DSMI
*                                                              @G32DSMI
         BAL   RET,WTO04000             LINK TO TELL TERMINAL  @G32DSMI
*                                                              @G32DSMI
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT VOL SER   @G32DSMI
         B     WTO01000                 BRANCH TO EXIT         @G32DSMI
*                                                              @G32DSMI
*                                                              @G32DSMI
***************************************************************@G32DSMI
*                                                              @G32DSMI
*        REMOVE FILE PROTECT RING MESSAGE                      @G32DSMI
*                                                              @G32DSMI
***************************************************************@G32DSMI
*                                                              @G32DSMI
MIEC135A DC    CL16'IEC135A U'          REMOVE FILE PROT RING  @G32DSMI
*              DESC=(2),ROUT=(1)        ROUTING & DESCRIPTOR   @G32DSMI
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0' @G32DSMI
IEC135AC DC    0AL4(0),B'0100000000000000',B'0010000000000000' @G32DSMI
*                                                              @G32DSMI
*                                                              @G32DSMI
*IEC135A U DDD,VOLSER,JOBNAME,STEPNAME,DSNAME                  @G32DSMI
*                                                              @G32DSMI
***************************************************************@G32DSMI
*                                                              @G32DSMI
        EJECT
*****************************************************************Y02134
*                                                                Y02134
*        IEC534D DESTROY LABEL MESSAGE                           YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC534D  DS    0H                       DESTROY LABEL RTN      @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC534D),MIEC534D DESTROY LABEL MSG @ZA03694
         MVC   WTODRCDS,IEC534DC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        Y02134
*                                                                Y02134
         BAL   RET,WTO09600             LINK TO GET LABEL TYPE   YM1238
*                                                                Y02134
         L     R1,DXREG0                GET DSNAME ADDRESS       YM3855
         BAL   RET,WTO09510             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02134
         LA    RC,IEC534DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC534D A DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME              @ZA02881
*        R 00,'U' TO USE OR                                      Y02134
*        R 00,'M' TO UNLOAD                                      Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC534D DC    CL16'IEC534D A'          DESTROY LABEL REQUEST  @ZA03694
*              DESC=(2,7),ROUT=(1)    ROUTING & DESCRIPTOR CDS @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC534DC DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                Y02134
IEC534DL DC    AL1(IEC534DE-IEC534DR)   LENGTH OF REPLY        @ZA01544
IEC534DR DC    C'''U''-USE OR ''M''-UNLOAD'                    @ZA01544
IEC534DE EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC704A STANDARD LABEL CREATE MESSAGE                   Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC704A  DS    0H                       CREATE LABEL RTN       @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC704A),MIEC704A CREATE LABEL MSG  @ZA03694
         MVC   WTODRCDS,IEC704AC        ROUT & DESC CODES      @ZA01544
*                                                                Y02134
         LA    R1,ZEROS                 POINT TO VOLSER OF ZERO  Y02134
         CLC   DXVOLSR2,SCRTCH          NON-SPECIFIC REQUEST     YM3855
         BE    WTO20410                 NO VOLSER IF SCRTCH    @ZA03694
         LA    R1,DXVOLSR2              POINT TO VOL SER         YM3855
*                                                                YM3855
WTO20410 EQU   *                        GET VOLSER AND UNIT    @ZA03694
*                                                                YM3855
         DROP  RET                                             @ZA03694
         BAL   RET,WTO09105             GET VOLSER & UNIT        YM3916
*                                                                Y02134
         BAL   RET,WTO09650             LINK TO GET LABEL, DEN   Y02134
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02134
         LA    RC,IEC704AL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         CLC   DXVOLSR2,SCRTCH          SCRATCH REQUEST        @ZA02881
         BE    WTO20420                 YES, BRANCH            @ZA02881
         LA    RC,IEC704UL              POINT TO ALTERNATE     @ZA02881
*                                       REPLY MSG LENGTH       @ZA02881
WTO20420 EQU   *                        ISSUE WTOR             @ZA02881
*                                                                YM3855
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC704A L DDD,VOLSER,LBL,DEN,JOBNAME,STEPNAME,DSNAME          @ZA02881
*        R 00,'VOLSER,OWNER INFORMATION'                         Y02134
*        R 00,'M' TO UNLOAD                                      Y02134
*        R 00,'U' TO USE - ONLY APLICABLE FOR SCRATCH REQUEST  @ZA02881
*                                                                Y02134
*        IF VOLSER IS NOT SCRTCH IT APPEARS IN MESSAGE           YM3855
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC704A DC    CL16'IEC704A L'          CREATE STD LABEL MSG   @ZA03694
*              DESC=(2,7),ROUT=(1)    ROUTING & DESCRIPTOR CDS @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC704AC DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                Y02134
IEC704AL DC    AL1(IEC704AE-IEC704AR)   LENGTH OF REPLY        @ZA01544
IEC704AR DC    C'''VOLSER,OWNER INFORMATION'' OR ''M'''        @ZA01544
IEC704AE EQU   *                                               @ZA01544
*                                                              @ZA01544
IEC704UL DC    AL1(IEC704UE-IEC704UR)   LENGTH OF REPLY        @ZA02881
IEC704UR DC    C'''VOLSER,OWNER INFORMATION'',''M''OR''U'''    @ZA02881
IEC704UE EQU   *                                               @ZA02881
*                                                              @ZA02881
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC512I SECURITY VOLUME MESSAGE                         YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512IS DS    0H                       SECURITY MSG RTN       @ZA03694
*                                                                Y02134
         LA    RC,WTO01000              LOAD MOUNT RETURN ADR  @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'IEC512I1),IEC512I1 SEC VOL MSG       @ZA03694
*
         B     IEC512I                  FINISH MESSAGE         @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC512I SEC VOL DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME          YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512I1 DC    CL16'IEC512I SEC VOL'    SECURITY MESSAGE       @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC512I I/O ERROR MESSAGE
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512II DS    0H                       I/O ERROR MSG RTN      @ZA03694
*                                                                Y02134
         LA    RET,WTO01000             LOAD MOUNT RETURN ADR  @ZA03694
*
IEC512IA EQU   *                        INTERNAL ENTRY         @ZA03694
*
         LR    RC,RET                   SAVE RETURN REG        @ZA03694
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'IEC512I2),IEC512I2 I/O ERR MSG       @ZA03694
         B     IEC512I                  FINISH MESSAGE         @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC512I I/O ERR DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME          YM1238
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512I2 DC    CL16'IEC512I I/O ERR'    I/O ERROR MESSAGE      @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC512I LABEL ERROR MESSAGE
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512IL DS    0H                       LABEL ERROR MSG RTN    @ZA03694
*
         LA    RC,WTO01000              LOAD MOUNT RETURN ADR  @ZA03694
*
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'IEC512I3),IEC512I3 I/O ERR MSG       @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
         LA    R1,DXVOLSR2              POINT TO VOL RQSTD     @ZA03694
         BAL   RET,WTO09105             LINK TO GET VOLSER     @ZA03694
*
         BAL   RET,WTO09674             GET LABEL TYPE         @ZA03694
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOVOL2,WTOVOLSR         REQUESTED VOL          @ZA03694
         MVC   WTOLBL2,WTOLBLTP         REQUESTED LABEL        @ZA03694
         MVC   WTOVOLSR,BLANKS          RESET                  @ZA03694
         MVC   WTOLBLTP,BLANKS          RESET                  @ZA03694
*
         B     IEC512I                  FINISH MESSAGE         @ZA03694
         DROP  RET                                             @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*
*IEC512I LBL ERR DDD,VOLSER,LBL,VOLREQ,LBLREQ,JOBNAME,STEPNAME,DSNAME
*
*****************************************************************Y02134
*                                                                Y02134
IEC512I3 DC    CL16'IEC512I LBL ERR'    LABEL ERROR MESSAGE    @ZA03694
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC512I SEC VOL - I/O ERROR - LABEL ERROR MESSAGE
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC512I  DS    0H                       ERROR MESSAGE          @ZA03694
*                                                                Y02134
         BALR  RET,0                    ADDRESSABILITY         @ZA03694
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTODRCDS,IEC512IC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        Y02134
*                                                                Y02134
         BAL   RET,WTO09600             LINK TO GET LABEL TYPE   Y02134
*                                                              @ZA02881
         BAL   RET,WTO09500             LINK TO GET DSNAME     @ZA02881
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
         MVI   DXECB,ECBCOD7F           SET ECB COMPLETE       @ZA03196
         LR    RET,RC                   RESTORE RETURN REGISTER  Y02134
         BR    RET                      RETURN                   Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC512I SEC VOL - I/O ERR - LBL ERR MESSAGE
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC512I DC    CL16'IEC512I'            ERROR MESSAGE          @ZA03694
*              DESC=(4),ROUT=(2,10)     ROUTING & DESCRIPTOR CDS YM7526
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC512IC DC    0AL4(0),B'0001000000000000',B'0100000001000000'   YM7526
*                                                              @ZA02881
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*
***********************************************************************
*
*        IEC513D I/O ERROR OPERATOR INTERVENTION MESSAGE
*
***********************************************************************
*
IEC513D  DS    0H                       I/O ERROR OPER MSG     @ZA03196
*
         BAL   RET,WTO05000             LINK TO GET MSG AREA   @ZA03196
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC513D),MIEC513D I/O ERR MSG       @ZA03196
         MVC   WTODRCDS,IEC513DC        ROUT & DESC CODES      @ZA03196
         DROP  RET                                             @ZA03196
*
         BAL   RET,WTO09100             GET VOLSER & UNIT      @ZA03196
*
         BAL   RET,WTO09600             LINK TO GET LABEL TYPE @ZA03196
*
         BAL   RET,WTO09500             LINK TO GET DSNAME     @ZA03196
*
         BAL   RET,WTO09300             FINISH MESSAGE         @ZA03196
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         LA    RC,IEC513DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03196
         BAL   RET,WTO03000             LINK TO ISSUE WTOR     @ZA03196
*
         B     WTO01000                 RETURN                 @ZA03196
*
***********************************************************************
*
*IEC513D I/O ERR DDD,VOLSER,LBL,JOBNAME,STEPNAME,DSNAME        @ZA03196
*        R 00,'U' TO ABEND OR                                  @ZA03196
*        R 00,'M' TO MOUNT A NEW TAPE                          @ZA03196
*
***********************************************************************
*
MIEC513D DC    CL16'IEC513D I/O ERR'    I/O ERROR MESSAGE      @ZA03196
*              DESC=(2,7),ROUT=(1,10)    OUTING & DESCRIPTOR   @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0' @ZA03196
IEC513DC DC    0AL4(0),B'0100001000000000',B'1000000001000000' @ZA18541
*
IEC513DL DC    AL1(IEC513DE-IEC513DR)   LENGTH OF REPLY        @ZA03196
IEC513DR DC    C'''U''-ABEND OR ''M''-MOUNT SCRATCH'           @ZA19630
IEC513DE EQU   *                                               @ZA03196
*
***********************************************************************
*
         EJECT
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*        IEC705I TAPE ATTRIBUTE MESSAGE                          Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
IEC705I  DS    0H                       TAPE ATTRIBUTE MSG RTN @ZA03694
*                                                                Y02134
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02134
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTOMSGID(L'MIEC705I),MIEC705I TAPE ATTRIBUTES   @ZA01544
         MVC   WTODRCDS,IEC705IC        ROUT & DESC CODES      @ZA01544
         DROP  RET                                             @ZA03694
*                                                                Y02134
         BAL   RET,WTO09100             GET VOLSER & UNIT        Y02134
*                                                                Y02134
         BAL   RET,WTO09650             LINK TO GET LABEL, DEN   Y02134
*                                                                Y02134
         BAL   RET,WTO09500             LINK TO GET DSNAME       Y02134
*                                                                Y02134
         BAL   RET,WTO09300             FINISH MESSAGE           Y02134
*                                                                Y02134
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02134
*                                                                Y02134
         B     WTO01000                 BRANCH TO EXIT           Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
*IEC705I TAPE ON DDD,VOLSER,LBL,DEN,JOBNAME,STEPNAME,DSNAME      Y02134
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
MIEC705I DC    CL16'IEC705I TAPE ON'    TAPE ATTRIBUTES MSG    @ZA03694
*              DESC=(4),ROUT=()         ROUTING & DESCRIPTOR CDS
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC705IC DC    0AL4(0),B'0001000000000000',B'0000000000000000' @ZA01278
*                                                                Y02134
*****************************************************************Y02134
*                                                                Y02134
         EJECT
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*        IEC254D REQUEST TO CREATE A NEW CHKPT DATA SET          Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC254D  DS    0H                       CHECKPOINT CREATE RTN  @ZA03694
*
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*
         MVC   WTODRCDS,IEC254D4        DESC &ROUT CDS         @ZA01544
         MVC   WTOMSGID(L'IEC254D1),IEC254D1 MSG SEG 1         @ZA01544
         DROP  RET                                             @ZA03694
         LA    RB,WTOMSGID+L'IEC254D1   INIT POSITION PTR      @ZA01544
*                                                                Y02083
         BAL   RET,WTO10100             GET JOB NAME             Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   K0(L'IEC254D2,RB),IEC254D2 MSG SEG 2              Y02083
         DROP  RET                                             @ZA03694
         LA    RB,L'IEC254D2(,RB)       BUMP POSITION PTR        Y02083
*                                                                Y02083
         BAL   RET,WTO10150             GET DDNAME,UNIT, & VOLID Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   K0(L'IEC254D3,RB),IEC254D3 MSG SEG 3              Y02083
         DROP  RET                                             @ZA03694
         LA    RB,L'IEC254D3(,RB)       BUMP POSITION PTR        Y02083
*                                                                Y02083
         MVI   WTOBREAK,BLANK           SET MSG BREAK CHAR     @ZA01544
         BAL   RET,WTO09330             GO FINISH MESSAGE      @ZA01544
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         LA    RC,IEC254DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02083
*                                                                Y02083
         B     WTO01000                 BRANCH TO EXIT           Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*IEC254D SHOULD JOBNAME USE (DDNAME,DDD,VOLSER) FOR CREATING     Y02083
*        A NEW CHECKPOINT DATA SET                               Y02083
*
*        R 00,'YES' TO ALLOW CREATION OR                       @ZA03196
*        R 00,'NO'  TO DISSALLOW                               @ZA03196
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC254D1 DC    C'IEC254D SHOULD '       IEC254D SEG 1            Y02083
IEC254D2 DC    C' USE '                 IEC254D SEG 2            Y02083
IEC254D3 DC    C' FOR CREATING A NEW CHECKPOINT DATA SET' SEG 3  Y02083
*              DESC=(2,7),ROUT=(1)   ROUTING & DESCRIPTOR CDS  @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC254D4 DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                YM7526
IEC254DL DC    AL1(IEC254DE-IEC254DR)   LENGTH OF REPLY        @ZA01544
IEC254DR DC    C'''YES'' OR ''NO'''                            @ZA01544
IEC254DE EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02083
*                                                                Y02083
         EJECT
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*        IEC255D QUERY CHKPT VOLUME SECURE STATUS                Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC255D  DS    0H                       SECURE VOL CHKPT RTN   @ZA03694
*
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   WTODRCDS,IEC255D4        DESC &ROUT CDS         @ZA01544
         MVC   WTOMSGID(L'IEC255D1),IEC255D1 MSG SEG 1         @ZA01544
         DROP  RET                                             @ZA03694
         LA    RB,WTOMSGID+L'IEC255D1   INIT POSITION PTR      @ZA01544
*                                                                Y02083
         BAL   RET,WTO10100             GET JOB NAME             Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   K0(L'IEC255D2,RB),IEC255D2 MSG SEG 2              Y02083
         DROP  RET                                             @ZA03694
         LA    RB,L'IEC255D2(,RB)       BUMP POSITION PTR        Y02083
*                                                                Y02083
         BAL   RET,WTO10150             GET DDNAME,UNIT, & VOLID Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   K0(L'IEC255D3,RB),IEC255D3 MSG SEG 3              Y02083
         DROP  RET                                             @ZA03694
         LA    RB,L'IEC255D3(,RB)       BUMP POSITION PTR        Y02083
*                                                                Y02083
         MVI   WTOBREAK,BLANK           SET MSG BREAK CHAR     @ZA01544
         BAL   RET,WTO09330             GO FINISH MESSAGE      @ZA01544
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         LA    RC,IEC255DL              POINT TO REPLY         @ZA01544
*                                       MESSAGE LENGTH         @ZA01544
         DROP  RET                                             @ZA03694
         BAL   RET,WTO03000             LINK TO ISSUE WTOR       Y02083
*                                                                Y02083
         B     WTO01000                 BRANCH TO EXIT           Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*IEC255D JOBNAME IS (DDNAME,DDD,VOLSER) A SECURE                 Y02083
*        CHECKPOINT VOLUME                                       Y02083
*
*        R 00,'YES' IF SECURE OR                               @ZA03196
*        R 00,'NO'  IF NOT SECURE                              @ZA03196
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC255D1 DC    C'IEC255D '              IEC255D SEG 1            Y02083
IEC255D2 DC    C' IS '                  IEC255D SEG 2            Y02083
IEC255D3 DC    C' A SECURE CHECKPOINT VOLUME' IEC255D SEG 3      Y02083
*              DESC=(2,7),ROUT=(1)   ROUTING & DESCRIPTOR CDS  @ZA18541
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC255D4 DC    0AL4(0),B'0100001000000000',B'1000000000000000' @ZA18541
*                                                                Y02083
IEC255DL DC    AL1(IEC255DE-IEC255DR)   LENGTH OF REPLY        @ZA01544
IEC255DR DC    C'''YES'' OR ''NO'''                            @ZA01544
IEC255DE EQU   *                                               @ZA01544
*                                                              @ZA01544
*****************************************************************Y02083
*                                                                Y02083
         EJECT
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*        IEC256A REVOKE SECURE STATUS OF CHKPT VOLUME            Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC256A  DS    0H                       REVOKE SECURE VOL RTN  @ZA03694
*
         BAL   RET,WTO05000             LINK TO GET MESSAGE AREA Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   WTODRCDS,IEC256A4        DESC &ROUT CDS         @ZA01544
         MVC   WTOMSGID(L'IEC256A1),IEC256A1 MSG SEG 1         @ZA01544
         DROP  RET                                             @ZA03694
         LA    RB,WTOMSGID+L'IEC256A1   INIT POSITION PTR      @ZA01544
*                                                                Y02083
         BAL   RET,WTO10100             GET JOB NAME             Y02083
*                                                                Y02083
         LA    RB,K1(,RB)               LEAVE A BLANK            Y02083
*                                                                Y02083
         BAL   RET,WTO10150             GET DDNAME,UNIT, & VOLID Y02083
         USING *,RET                    ESTABLISH BASE         @ZA03694
*                                                                Y02083
         MVC   K0(L'IEC256A2,RB),IEC256A2 MSG SEG 2            @ZA03694
         DROP  RET                                             @ZA03694
         LA    RB,L'IEC256A2(,RB)       BUMP POSITION PTR      @ZA03694
*                                                                Y02083
         MVI   WTOBREAK,BLANK           SET MSG BREAK CHAR     @ZA01544
         BAL   RET,WTO09330             GO FINISH MESSAGE      @ZA01544
*                                                                Y02083
         BAL   RET,WTO02000             LINK TO ISSUE WTO        Y02083
*                                                                Y02083
         B     WTO01000                 BRANCH TO EXIT           Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
*IEC256A JOBNAME (DDNAME,DDD,VOLSER) IS NO LONGER A SECURE       Y02083
*        CHECKPOINT VOLUME                                       Y02083
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
IEC256A1 DC    C'IEC256A '              IEC256A SEG 1            Y02083
IEC256A2 DC    C' IS NO LONGER A SECURE CHECKPOINT VOLUME' SEG 2
*              DESC=(3),ROUT=(2)        ROUTING & DESCRIPTOR CDS YM7885
*              0AL4(0),B'123456789ABCDEF0',B'123456789ABCDEF0'   YM7526
IEC256A4 DC    0AL4(0),B'0010000000000000',B'0100000000000000'   YM7885
*                                                                Y02083
*****************************************************************Y02083
*                                                                Y02083
         EJECT
*                                                                Y02134
         XCTLTABL BRT=YES,LENGTH=                              @ZA02881
*                                                                Y02134
         EJECT
WTOBUFFR DSECT                                                 @ZA01544
WTORAREA EQU   WTOBUFFR                 OFFSET FOR WTOR        @ZA01544
WTORPLYL DS    0X                       WTOR REPLY LENGTH      @ZA01544
WTORPLYP DS    A                        WTOR REPLY ADDRESS     @ZA01544
WTOECBAD DS    A                        WTOR ECB ADDRESS       @ZA01544
WTOAREA  DS    0A                       QFFSET FOR WTO         @ZA01544
WTOMSG1  DS    0A                       OFFSET TO LINE 1       @ZA01544
WTOLNGTH DS    H                        LINE 1 LENGTH          @ZA01544
WTOSWTCH DS    H                        MCS FLAGS              @ZA01544
MSG1STRT DS    0C                       START OF MESSAGE       @ZA01544
         ORG   WTOBUFFR+44                                     @ZA01544
WTOMSGID DS    CL7                      LINE 1 MESSAGE ID      @ZA01544
         DS    C                        BLANK                  @ZA01544
WTOINSTR DS    CL7                      MESSAGE INSTRUCTION    @ZA01544
         DS    C                        BALNK                  @ZA01544
WTOUNIT  DS    CL3                      UNIT ADDRESS           @ZA01544
         DS    C                        COMMA                  @ZA01544
WTOVOLSR DS    CL6                      VOLUME SERIAL NUMBER   @ZA01544
         DS    C                        COMMA                  @ZA01544
WTOSPACE DS    0CL30                    SPACE INFORMATION      @ZA02881
WTOLBLTP DS    CL3                      LABEL TYPE             @ZA02881
         DS    C                        COMMA                  @ZA01544
WTOVOL2  DS    CL6                      REQUESTED VOL SER      @ZA02881
         DS    C                        COMMA                  @ZA02881
WTOLBL2  DS    CL3                      REQUESTED LBL TYPE     @ZA02881
         DS    17C                                             @ZA02881
WTODEN   DS    0CL8                     DENSITY                @ZA01544
WTOADDN  DS    CL10                     DDNAME                 @ZA01544
         DS    C                        COMMA                  @ZA01544
WTOJOB   DS    CL8                      JOBNAME                @ZA01544
         DS    C                        COMMA                  @ZA01544
WTOSTEP  DS    CL8                      STEPNAME               @ZA01544
         DS    C                        COMMA                  @ZA01544
WTODSN   DS    CL44                     DSNAME                 @ZA01544
WTOEND   DS    0X                       END OF MESSAGE TEXT    @ZA01544
WTOCODES DS    XL4                      DESC AND ROUT CODES    @ZA01544
WTOLINE1 DS    XL3                      LINE 1 TYPE            @ZA01544
WTONLINE DS    X                        NUMBER OF LINES        @ZA01544
WTOMSG2  DS    0X                       LINE 2                 @ZA01544
WTOLGTH2 DS    XL2                      LINE 2 LENGTH          @ZA01544
WTOLINE2 DS    XL2                      LINE 2 TYPE            @ZA01544
WTOMSID2 DS    CL8                      MESSAGE ID FOR LINE 2  @ZA01544
WTOEND2  DS    0C                       END LINE 2             @ZA01544
         ORG   WTOBUFFR+250                                    @ZA01544
WTOBREAK DS    C                        MESSAGE BREAK CHAR     @ZA01544
WTODRCDS DS    XL4                      DESC AND ROUTE SAVE    @ZA01544
WTOTSOSW DS    X                        TSO TPUT SWITCH        @ZA01544
MSG1MAX  EQU   WTOMSGID+34              OFFSET TO LINE 1 END   @ZA20470
WTOBUFFL EQU   256                      LENGTH OF BUFFER       @ZA01544
         ORG   WTOBUFFR                                        @ZA18506
*                                                              @ZA18506
*        PARMLIST FOR DEQ VOLSER SUBROUTINE                    @ZA18506
*                                                              @ZA18506
DEQRTN   DS    F                        RETURN ADDRESS SAVE    @ZA18506
DEQLIST  DS    0CL(DEQPLTH)             DEQ PARMLIST           @ZA18506
         DS    F                        FULLWORD FOR TCB       @ZA18506
DEQ      EQU   *                        MACRO PARMLIST SKIPS   @ZA18506*
                                        TCB ADDRESS            @ZA18506
         IECDSECS CVT,ASCB,TCB,JSCB,TIOT,PSCB,UPT,SMF,BASE,PSA,  Y02134X
               UCB,DCB,MAIN,PREFX,WTG,DSAB,EXPAND=YES          @ZA04633
         IECEQU
         EJECT
         IECDIOCM                                                Y02134
         EJECT
         ICBMNTDE MF=(L,MAP),TYPE=MNT
SCRPACK  EQU   X'10'                    FLAG BIT FOR SCRATCH   @G18MSBS
SCNDRY   EQU   X'20'                    SECONDARY ALLOC FLAG   @G18MSBS
MNTLSTX  EQU   X'08'                    MOUNT LIST EXT FLAG    @G18MSBS
MNTSIZE  EQU   *-ICBMNTD1               SIZE OF MOUNT LIST     @G18MSBS
         EJECT
         IEZMNTXT
MNTSAVE  DS    A                        MOUNT LIST PTR SAVED   @G18MSBS
         EJECT
JCTABLE  DSECT
         IEFAJCTB                                              @G18MSBS
         EJECT
SCTABLE  DSECT                                                 @G18MSBS
         IEFASCTB                                              @G18MSBS
         EJECT
         END

         TITLE 'IDA019RU - AIX UPGRADE DRIVER                          *
                        '
IDA019RU CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP00001-@MAINENT)
         DC    AL1(16)                                             0001
         DC    C'IDA019RU  78.201'                                 0001
IDAXGPLH DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP01049-IDAXGPLH)
         ENTRY IDAXGPLH
         DROP  @15
@PROLOG  BALR  @11,0                                               0001
@PSTART  LA    @10,4095(,@11)                                      0001
         USING @PSTART,@11                                         0001
         USING @PSTART+4095,@10                                    0001
         AH    @15,4(,@15)                                         0001
         BR    @15                                                 0001
@EP00001 DS    0H                                                  0002
*   RPARM1=AMBPAMBL;                /* LOAD POINTER TO AMBL          */
         L     RPARM1,AMBPAMBL(,RAMB)                              0184
*   GOTO UPGROUT;                   /* BRANCH TO APPROPRIATE ROUTINE */
         SLR   @15,@15                                             0185
         IC    @15,RPLREQ(,RRPL)                                   0185
         SLA   @15,2                                               0185
         L     @15,BRANCH(@15)                                     0185
         BR    @15                                                 0185
*UPGGET:                                                           0186
*                                                                  0186
*/********************************************************************/
*/* DO WORK FOR A GET UPDATE - SAVE NEW RECORD IN PLHLLOR            */
*/********************************************************************/
*                                                                  0186
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
UPGGET   IDASVR14
*   IF PLHLLOR=0 THEN               /* IF SA FOR OLD RECORD NEEDED   */
         L     @15,PLHLLOR(,RPLH)                                  0187
         LTR   @15,@15                                             0187
         BNZ   @RF00187                                            0187
*     DO;                                                          0188
*       RESPECIFY                                                  0189
*        (RWORK1,                                                  0189
*         R15) RESTRICTED;                                         0189
*       IF UPTLLEN<AMDRKP+AMDKEYLN THEN/* LLEN SMALL         @ZA10856*/
         L     @09,AMBLBIB(,RPARM1)                                0190
         L     @09,BIBUPT(,@09)                                    0190
         L     @08,AMBDSB(,RAMB)                                   0190
         LH    @07,AMDRKP(,@08)                                    0190
         AH    @07,AMDKEYLN(,@08)                                  0190
         CH    @07,UPTLLEN(,@09)                                   0190
         BNH   @RF00190                                            0190
*         UPTLLEN=AMDRKP+AMDKEYLN;  /* INCLUDE BASE KEY      @ZA10856*/
         STH   @07,UPTLLEN(,@09)                                   0191
*       RWORK1=UPTLLEN;             /* LOAD LENGTH OF SAVE AREA      */
@RF00190 L     @09,AMBLBIB(,RPARM1)                                0192
         L     @09,BIBUPT(,@09)                                    0192
         LH    RWORK1,UPTLLEN(,@09)                                0192
*I01:                                                              0193
*       DO;                         /* IDACALL(IDAGETWS)             */
I01      DS    0H                                                  0194
*         CALL IDAGETWS;            /* EXIT TO IDAGETWS              */
         L     @15,@CV01385                                        0194
         BALR  @14,@15                                             0194
*         GEN(BALR @11,0);          /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*         GEN(USING *,@11);         /* ESTABLISH ADDRESSING          */
         USING *,@11
*         GEN(USING *+4095,R10);    /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*         GEN(LA    R10,4095(@11)); /* LOAD SECOND BASE              */
         LA    R10,4095(@11)
*         GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE      */
         L     R10,=A(@PSTART+4095)
*         GEN(USING @PSTART+4095,R10);/* ESTABLISH SECOND BASE       */
         USING @PSTART+4095,R10
*         GEN(L     @11,=A(@PSTART));/* RELOAD BASE                  */
         L     @11,=A(@PSTART)
*         GEN(USING @PSTART,@11);   /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*       END I01;                    /* GET SAVE AREA                 */
*       IF R15^=0 THEN              /* IF NO CORE AVAILABLE          */
         LTR   R15,R15                                             0204
         BZ    @RF00204                                            0204
*         DO;                                                      0205
*           RPLERREG='08'X;         /* SET LOGICAL ERROR             */
         MVI   RPLERREG(RRPL),X'08'                                0206
*           RPLCMPON=RPLUPGER;      /* OCCURRED DURING UPGRADE       */
         MVI   RPLCMPON(RRPL),X'04'                                0207
*           RPLERRCD=RPLNOVRT;      /* ERROR WAS NOT ENUF CORE       */
         MVI   RPLERRCD(RRPL),X'28'                                0208
*           GEN(IDARST14);          /* RELOAD RETURN ADDRESS         */
         IDARST14
*           RETURN CODE(RPLERREG);  /* EXIT MODULE                   */
         SLR   @15,@15                                             0210
         IC    @15,RPLERREG(,RRPL)                                 0210
@EL00001 DS    0H                                                  0210
@EF00001 DS    0H                                                  0210
@ER00001 BR    @14                                                 0210
*         END;                                                     0211
*       ELSE                        /* IF CORE WAS OBTAINED          */
*         PLHLLOR=RWORK1;           /* SET ADDRESS OF SAVE AREA      */
@RF00204 ST    RWORK1,PLHLLOR(,RPLH)                               0212
*       RESPECIFY                                                  0213
*        (RWORK1,                                                  0213
*         R15) UNRESTRICTED;                                       0213
*     END;                                                         0214
*   IF UPTLLEN>MAXMOVE THEN         /* IF SAVED PORTION TOO BIG F MVC*/
@RF00187 L     @15,AMBLBIB(,RPARM1)                                0215
         L     @15,BIBUPT(,@15)                                    0215
         LH    @15,UPTLLEN(,@15)                                   0215
         C     @15,@CF01390                                        0215
         BNH   @RF00215                                            0215
*     DO;                                                          0216
*       RESPECIFY                                                  0217
*        (RWORK2,                                                  0217
*         RWORK3,                                                  0217
*         RWORK4,                                                  0217
*         RWORK5) RESTRICTED;                                      0217
*       RWORK2=PLHLLOR;             /* LOAD FLD ADDR TO RECIEVE RCD  */
         L     RWORK2,PLHLLOR(,RPLH)                               0218
*       RWORK3=UPTLLEN;             /* LOAD LENGTH OF SAVED RECORD   */
         LR    RWORK3,@15                                          0219
*       RWORK5=RWORK3;              /* COPY LENGTH                   */
         LR    RWORK5,RWORK3                                       0220
*       IF RPLLOC=ON THEN           /* IF LOCATE MODE                */
         TM    RPLLOC(RRPL),B'10000000'                            0221
         BNO   @RF00221                                            0221
*         RWORK4=RCDADDR;           /* LOAD PTR TO RECORD            */
         L     @15,RPLAREA(,RRPL)                                  0222
         L     RWORK4,RCDADDR(,@15)                                0222
*       ELSE                        /* IF NOT LOCATE MODE            */
*         RWORK4=RPLAREA;           /* POINT TO USERS AREA           */
         B     @RC00221                                            0223
@RF00221 L     RWORK4,RPLAREA(,RRPL)                               0223
*       MVCL(RWORK2,RWORK4);        /* MOVE RECORD                   */
@RC00221 MVCL  RWORK2,RWORK4                                       0224
*       RESPECIFY                                                  0225
*        (RWORK2,                                                  0225
*         RWORK3,                                                  0225
*         RWORK4,                                                  0225
*         RWORK5) UNRESTRICTED;                                    0225
*     END;                                                         0226
*   ELSE                            /* IF RCD LENGTH OK FOR MVC      */
*     DO;                                                          0227
         B     @RC00215                                            0227
@RF00215 DS    0H                                                  0228
*       RESPECIFY                                                  0228
*         RWORK2 RESTRICTED;                                       0228
*       IF RPLLOC=ON THEN           /* IF LOCATE MODE                */
         TM    RPLLOC(RRPL),B'10000000'                            0229
         BNO   @RF00229                                            0229
*         RWORK2=RCDADDR;           /* LOAD RECORD ADDRESS           */
         L     @15,RPLAREA(,RRPL)                                  0230
         L     RWORK2,RCDADDR(,@15)                                0230
*       ELSE                        /* IF NOT LOCATE MODE            */
*         RWORK2=RPLAREA;           /* LOAD RECORD ADDR              */
         B     @RC00229                                            0231
@RF00229 L     RWORK2,RPLAREA(,RRPL)                               0231
*       PLHLLOR->RECORD(1:UPTLLEN)=RWORK2->RECORD(1:UPTLLEN);/* SAVE
*                                      ALL OLD KEYS                  */
@RC00229 L     @15,PLHLLOR(,RPLH)                                  0232
         L     @07,AMBLBIB(,RPARM1)                                0232
         L     @07,BIBUPT(,@07)                                    0232
         LH    @07,UPTLLEN(,@07)                                   0232
         BCTR  @07,0                                               0232
         EX    @07,@SM01575                                        0232
*       RESPECIFY                                                  0233
*         RWORK2 UNRESTRICTED;                                     0233
*     END;                                                         0234
*   IF AMBTRACE^=ZERO THEN          /* IS IDATRACE ACTIVE?   @ZA29388*/
@RC00215 L     @15,AMBTRACE(,RAMB)                                 0235
         LTR   @15,@15                                             0235
         BZ    @RF00235                                            0235
*     DO;                           /*                       @ZA29388*/
*       CALL IDA019ST;              /* CALL IDATRACE         @ZA29388*/
         L     @15,@CV01414                                        0237
         BALR  @14,@15                                             0237
*       GEN(DC X'010E');            /* TRACE ID              @ZA29388*/
         DC X'010E'
*     END;                          /*                       @ZA29388*/
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
@RF00235 DS    0H                                                  0240
         IDARST14
*   RETURN CODE(0);                 /* PROCESSING DONE FOR GET       */
         SLR   @15,@15                                             0241
         BR    @14                                                 0241
         EJECT
*UPGPUT:                                                           0242
*                                                                  0242
*/********************************************************************/
*/* DO WORK FOR A PUT - DECIDE IF UPGRADE IS NEEDED                  */
*/********************************************************************/
*                                                                  0242
*   IF RPLRLEN<UPTLLEN THEN         /* IF RECORD TOO SMALL           */
UPGPUT   L     @15,AMBLBIB(,RPARM1)                                0242
         L     @15,BIBUPT(,@15)                                    0242
         L     @05,RPLRLEN(,RRPL)                                  0242
         CH    @05,UPTLLEN(,@15)                                   0242
         BNL   @RF00242                                            0242
*     DO;                                                          0243
*       RPLERREG='08'X;             /* SET LOGICAL ERROR             */
         MVI   RPLERREG(RRPL),X'08'                                0244
*       RPLCMPON=RPLUPGER;          /* OCCURRED DURING UPGRADE       */
         MVI   RPLCMPON(RRPL),X'04'                                0245
*       RPLERRCD=RPLINLEN;          /* INVALID LENGTH                */
         MVI   RPLERRCD(RRPL),X'6C'                                0246
*       IF AMBTRACE^=ZERO THEN      /* IS IDATRACE ACTIVE?   @ZA29388*/
         L     @15,AMBTRACE(,RAMB)                                 0247
         LTR   @15,@15                                             0247
         BZ    @RF00247                                            0247
*         DO;                       /*                       @ZA29388*/
*           GEN(IDASVR14);          /* SAVE RETURN ADDRESS   @ZA29388*/
         IDASVR14
*           CALL IDA019ST;          /* CALL IDATRACE         @ZA29388*/
         L     @15,@CV01414                                        0250
         BALR  @14,@15                                             0250
*           GEN(DC X'010E');        /* TRACE ID              @ZA29388*/
         DC X'010E'
*           GEN(IDARST14);          /* RESTORE RETURN ADDRESS@ZA29388*/
         IDARST14
*         END;                      /*                       @ZA29388*/
*       RETURN CODE(RPLERREG);      /* EXIT MODULE                   */
@RF00247 SLR   @15,@15                                             0254
         IC    @15,RPLERREG(,RRPL)                                 0254
         BR    @14                                                 0254
*     END;                                                         0255
*                                                                  0255
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CHANGE IN ANY AIX KEY                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0256
*   RESPECIFY                                                      0256
*    (RWORK1,                                                      0256
*     RWORK2,                                                      0256
*     RWORK3,                                                      0256
*     RWORK5) RESTRICTED;                                          0256
@RF00242 DS    0H                                                  0257
*   IF RPLUPD=ON THEN               /* IF PUT NO UPDATE              */
         TM    RPLUPD(RRPL),B'00000010'                            0257
         BNO   @RF00257                                            0257
*     DO;                                                          0258
*       RWORK1=ADDR(IDAUPT);        /* POINT TO UPGRADE TABLE        */
         L     @15,AMBLBIB(,RPARM1)                                0259
         L     RWORK1,BIBUPT(,@15)                                 0259
*       RESPECIFY                                                  0260
*         IDAUPT BASED(RWORK1);                                    0260
*       RWORK3=OFF;                 /* USE RWORK3 AS A SWITCH        */
         SLR   RWORK3,RWORK3                                       0261
*       DO RWORK2=UPTNOENT TO 1 BY-1 WHILE RWORK3=OFF;/* LOOP THRU 0262
*                                      UPT                           */
         SLR   RWORK2,RWORK2                                       0262
         IC    RWORK2,UPTNOENT(,RWORK1)                            0262
         B     @DE00262                                            0262
@DL00262 LTR   RWORK3,RWORK3                                       0262
         BNZ   @DC00262                                            0262
*         RESPECIFY                                                0263
*           OLDKEY BASED(PLHLLOR+UPTRKP);                          0263
*         RESPECIFY                                                0264
*           NEWKEY BASED(RWORK5);                                  0264
*         IF RPLLOC=ON THEN         /* IF LOCATE MODE                */
         TM    RPLLOC(RRPL),B'10000000'                            0265
         BNO   @RF00265                                            0265
*           RWORK5=RCDADDR;         /* LOAD POINTER TO RECORD        */
         L     @15,RPLAREA(,RRPL)                                  0266
         L     RWORK5,RCDADDR(,@15)                                0266
*         ELSE                      /* ELSE NOT LOCATE MODE          */
*           RWORK5=RPLAREA;         /* LOAD POINTER TO RECORD        */
         B     @RC00265                                            0267
@RF00265 L     RWORK5,RPLAREA(,RRPL)                               0267
*         RWORK5=RWORK5+UPTRKP;     /* POINT TO KEY                  */
@RC00265 LH    @15,UPTRKP(,RWORK1)                                 0268
         ALR   RWORK5,@15                                          0268
*         IF UPTF1NOP=OFF&          /* IF VALID ENTRY                */
*             NEWKEY(1:UPTLNCDE+1)^=OLDKEY(1:UPTLNCDE+1) THEN/* IF 0269
*                                      KEY CHANGED                   */
         TM    UPTF1NOP(RWORK1),B'00010000'                        0269
         BNZ   @RF00269                                            0269
         AL    @15,PLHLLOR(,RPLH)                                  0269
         SLR   @08,@08                                             0269
         IC    @08,UPTLNCDE(,RWORK1)                               0269
         EX    @08,@SC01577                                        0269
         BE    @RF00269                                            0269
*           RWORK3=ON;                                             0270
         LA    RWORK3,1                                            0270
*         ELSE                      /* IF NONE OF THE ABOVE          */
*           RWORK1=RWORK1+LENGTH(UPTAXENT);/* POINT TO NEXT ENTRY    */
         B     @RC00269                                            0271
@RF00269 AL    RWORK1,@CF00229                                     0271
*       END;                                                       0272
@RC00269 BCTR  RWORK2,0                                            0272
@DE00262 CL    RWORK2,@CF00054                                     0272
         BNL   @DL00262                                            0272
@DC00262 DS    0H                                                  0273
*       IF RWORK3=OFF THEN          /* IF NO KEY CHANGED             */
         LTR   RWORK3,RWORK3                                       0273
         BNZ   @RF00273                                            0273
*         DO;                       /*                       @ZA29388*/
*           IF AMBTRACE^=ZERO THEN  /* IS IDATRACE ACTIVE?   @ZA29388*/
         L     @15,AMBTRACE(,RAMB)                                 0275
         LTR   @15,@15                                             0275
         BZ    @RF00275                                            0275
*             DO;                   /*                       @ZA29388*/
*               GEN(IDASVR14);      /* SAVE RETURN ADDRESS   @ZA29388*/
         IDASVR14
*               CALL IDA019ST;      /* CALL IDATRACE         @ZA29388*/
         L     @15,@CV01414                                        0278
         BALR  @14,@15                                             0278
*               GEN(DC X'010E');    /* TRACE ID              @ZA29388*/
         DC X'010E'
*               GEN(IDARST14);      /* RESTORE RETURN ADDRESS@ZA29388*/
         IDARST14
*             END;                  /*                       @ZA29388*/
*           RETURN CODE(0);         /* NO UPGRADE IS NEEDED          */
@RF00275 SLR   @15,@15                                             0282
         BR    @14                                                 0282
*         END;                                                     0283
*     END;                          /*                       @ZA29388*/
@RF00273 DS    0H                                                  0285
*   RESPECIFY                                                      0285
*    (RWORK2,                                                      0285
*     RWORK3,                                                      0285
*     RWORK5) UNRESTRICTED;                                        0285
@RF00257 DS    0H                                                  0286
         EJECT
*                                                                  0286
*/********************************************************************/
*/* START UPGRADE - GET EXCLUSIVE CONTROL OF IDAUPT                  */
*/********************************************************************/
*                                                                  0286
*UPGERASE:                                                         0286
*   GEN REFS(PLHRETO,PLHRET1)(IDASVR14);/* SAVE RETURN ADDRESS       */
UPGERASE IDASVR14
*   PLHAMB=RAMB;                    /* SAVE PTR TO AMB               */
         ST    RAMB,PLHAMB(,RPLH)                                  0287
*   RESPECIFY                                                      0288
*     IDAAMB BASED(PLHAMB);                                        0288
*   RESPECIFY                                                      0289
*    (RAMB,                                                        0289
*     RBUFC) UNRESTRICTED;                                         0289
*GETUPT:                                                           0290
*   RWORK1=BIBUPT;                  /* LOAD ADDR OF UPT              */
GETUPT   L     @15,AMBLBIB(,RPARM1)                                0290
         L     RWORK1,BIBUPT(,@15)                                 0290
*   TS(UPTRSC);                     /* TRY TO GET EXCLUSIVE CONTROL  */
         TS    UPTRSC(RWORK1)                                      0291
*   BC(8,GOTUPT);                   /* BRANCH IF SUCCESSFUL          */
         BC    8,GOTUPT                                            0292
*   DO;                                                            0293
*                                                                  0293
*     /***************************************************************/
*     /*                                                             */
*     /* DEFER REQUEST                                               */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0294
*     PLHDRRSC=ADDR(UPTRSC);        /* POINT TO RESOURCE             */
         LA    @15,UPTRSC(,RWORK1)                                 0294
         ST    @15,PLHDRRSC(,RPLH)                                 0294
*     PLHDRMSK='80'X;               /* LOAD MASK                     */
         MVI   PLHDRMSK(RPLH),X'80'                                0295
*     RESPECIFY                                                    0296
*      (RWORK0,                                                    0296
*       RAMB) RESTRICTED;                                          0296
*     RAMB=ADDR(IDAAMB);            /* RELOAD AMB POINTER            */
         L     RAMB,PLHAMB(,RPLH)                                  0297
*     RWORK0=GENRES;                /* INDICATE GENERAL RESOURCE     */
         LA    RWORK0,16                                           0298
*I02:                                                              0299
*     DO;                           /* IDACALL(IDADRQ)               */
I02      DS    0H                                                  0300
*       CALL IDADRQ;                /* EXIT TO IDADRQ                */
         L     @15,@CV01384                                        0300
         BALR  @14,@15                                             0300
*       GEN(BALR @11,0);            /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*       GEN(USING *,@11);           /* ESTABLISH ADDRESSING          */
         USING *,@11
*       GEN(USING *+4095,R10);      /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*       GEN(LA    R10,4095(@11));   /* LOAD SECOND BASE              */
         LA    R10,4095(@11)
*       GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE        */
         L     R10,=A(@PSTART+4095)
*       GEN(USING @PSTART+4095,R10);/* ESTABLISH SECOND BASE         */
         USING @PSTART+4095,R10
*       GEN(L     @11,=A(@PSTART)); /* RELOAD BASE                   */
         L     @11,=A(@PSTART)
*       GEN(USING @PSTART,@11);     /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*     END I02;                                                     0309
*     RESPECIFY                                                    0310
*      (RWORK0,                                                    0310
*       RAMB) UNRESTRICTED;                                        0310
*   END;                                                           0311
*   GOTO GETUPT;                    /* TRY TO GET UPT AGAIN          */
         B     GETUPT                                              0312
         EJECT
*GOTUPT:                                                           0313
*                                                                  0313
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE UPGRADE TABLE                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0313
*   RPARM1=BIBUPT;                  /* LOAD PTR TO UPT               */
GOTUPT   L     @15,AMBLBIB(,RPARM1)                                0313
         L     @15,BIBUPT(,@15)                                    0313
         LR    RPARM1,@15                                          0313
*   IF RPLLOC=ON THEN               /* IF LOCATE REQUEST             */
         TM    RPLLOC(RRPL),B'10000000'                            0314
         BNO   @RF00314                                            0314
*     RPARM1->UPTNEW=RCDADDR;       /* COPY ADDR POINTER             */
         L     @15,RPLAREA(,RRPL)                                  0315
         L     @15,RCDADDR(,@15)                                   0315
         ST    @15,UPTNEW(,RPARM1)                                 0315
*   ELSE                            /* IF NOT LOCATE MODE            */
*     RPARM1->UPTNEW=RPLAREA;       /* SET PTR TO NEW RECORD         */
         B     @RC00314                                            0316
@RF00314 L     @15,RPLAREA(,RRPL)                                  0316
         ST    @15,UPTNEW(,RPARM1)                                 0316
*   RPARM1->UPTOLD=PLHLLOR;         /* SET PTR TO OLD RECORD SAVED   */
@RC00314 L     @15,PLHLLOR(,RPLH)                                  0317
         ST    @15,UPTOLD(,RPARM1)                                 0317
*   RESPECIFY                                                      0318
*    (RWORK2,                                                      0318
*     RWORK3,                                                      0318
*     RWORK4) RESTRICTED;                                          0318
*   IF RPLERREG^=0 THEN             /* IF ERROR PROCESSING BASE      */
         CLI   RPLERREG(RRPL),0                                    0319
         BE    @RF00319                                            0319
*     DO;                                                          0320
*                                                                  0320
*       /*************************************************************/
*       /*                                                           */
*       /* SWAP UPTNEW AND UPTOLD POINTERS                           */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0321
*       RWORK2=RPARM1->UPTNEW;      /* SAVE UPTNEW                   */
         L     RWORK2,UPTNEW(,RPARM1)                              0321
*       RPARM1->UPTNEW=RPARM1->UPTOLD;/* NEW IS NOW OLD              */
         ST    @15,UPTNEW(,RPARM1)                                 0322
*       RPARM1->UPTOLD=RWORK2;      /* OLD IS NOW NEW                */
         ST    RWORK2,UPTOLD(,RPARM1)                              0323
*       UPTBEREG=RPLERREG;          /* COPY BASE RPLERREG            */
         IC    @15,RPLERREG(,RRPL)                                 0324
         STC   @15,UPTBEREG(,RWORK1)                               0324
*       UPTBERCD=RPLERRCD;          /* COPY BASE RPLERRCD            */
         IC    @15,RPLERRCD(,RRPL)                                 0325
         STC   @15,UPTBERCD(,RWORK1)                               0325
*       RPLFDBWD=0;                 /* ZERO FEEDBACK WORD            */
         SLR   @15,@15                                             0326
         ST    @15,RPLFDBWD(,RRPL)                                 0326
*     END;                                                         0327
*   RPARM1->UPTBRPL=ADDR(IFGRPL);   /* SAVE POINTER TO BASE RPL      */
@RF00319 ST    RRPL,UPTBRPL(,RPARM1)                               0328
*   RPARM1->UPTSARES=RUNNING;       /* UPGRADE IS RUNNING            */
         MVI   UPTSARES(RPARM1),B'11111111'                        0329
*   RESPECIFY                                                      0330
*     NEWKEY BASED(RPARM1->UPTNEW+RWORK1->UPTRKP);                 0330
*   RESPECIFY                                                      0331
*     OLDKEY BASED(RPARM1->UPTOLD+RWORK1->UPTRKP);                 0331
*   RWORK2=RWORK1;                  /* SAVE POINTER TO UPT           */
         LR    RWORK2,RWORK1                                       0332
*   DO RWORK3=UPTNOENT TO 1 BY-1    /* LOOP THRU UPT ENTRIES         */
*         WHILE RPLERREG=0;         /* WHILE NO ERROR DETECTED       */
         SLR   RWORK3,RWORK3                                       0333
         IC    RWORK3,UPTNOENT(,RWORK1)                            0333
         B     @DE00333                                            0333
@DL00333 CLI   RPLERREG(RRPL),0                                    0333
         BNE   @DC00333                                            0333
*     UPTF1ATV=OFF;                 /* RESET ACTIVE BIT              */
*     UPTF1NRF=OFF;                 /* RESET NO RECORD FOUND BIT     */
*     UPTF1UPG=OFF;                 /* RESET IN UPGRADE BIT          */
         NI    UPTF1ATV(RWORK1),B'10110110'                        0336
*     UPTF1BKO=OFF;                 /* RESET BACKOUT BIT             */
*     UPTF1ERA=OFF;                 /* RESET BASE FUNCTION ERASE     */
*     UPTF1PUD=OFF;                 /* RESET BASE FUNCTION PUT UPDATE*/
*     UPTF1PNU=OFF;                 /* RESET BASE FUNCTION PUT NUP   */
*     UPTF1LOG=OFF;                 /* RESET LOGICAL ERROR BIT       */
*     UPTF1PHY=OFF;                 /* RESET PHYSICAL ERROR BIT      */
         NI    UPTF1BKO(RWORK1),B'00000011'                        0342
*     IF UPTF1NOP=OFF&              /* IF VALID ENTRY                */
*         (RPLREQ=RPLERASE×         /* USER REQUEST IS ERASE         */
*         RPLUPD=OFF×               /* USER REQUEST IS PUT NUP       */
*         NEWKEY(1:UPTLNCDE+1)^=OLDKEY(1:UPTLNCDE+1)) THEN/* IF AIX
*                                      KEY HAS CHANGED               */
         TM    UPTF1NOP(RWORK1),B'00010000'                        0343
         BNZ   @RF00343                                            0343
         CLI   RPLREQ(RRPL),5                                      0343
         BE    @RT00343                                            0343
         TM    RPLUPD(RRPL),B'00000010'                            0343
         BZ    @RT00343                                            0343
         LH    @15,UPTRKP(,RWORK1)                                 0343
         L     @09,UPTNEW(,RPARM1)                                 0343
         ALR   @09,@15                                             0343
         AL    @15,UPTOLD(,RPARM1)                                 0343
         SLR   @04,@04                                             0343
         IC    @04,UPTLNCDE(,RWORK1)                               0343
         EX    @04,@SC01579                                        0343
         BE    @RF00343                                            0343
@RT00343 DS    0H                                                  0344
*       DO;                                                        0344
*         RESPECIFY                                                0345
*          (RWORK5,                                                0345
*           R15) RESTRICTED;                                       0345
*         CALL XPANDBFR;            /* BUILD RPLAREA FIELD           */
         BAL   @14,XPANDBFR                                        0346
*         IF UPTRPL->RPLERREG=0 THEN/* IF CORE WAS AVAIL     @ZA19598*/
         L     @04,UPTRPL(,RWORK1)                                 0347
         CLI   RPLERREG(@04),0                                     0347
         BNE   @RF00347                                            0347
*           DO;                                                    0348
*             UPTRPL->RPLBUFL=UPTBG;/* SET RPLAREA FIELD LENGTH      */
         LH    @03,UPTBG(,RWORK1)                                  0349
         ST    @03,RPLBUFL(,@04)                                   0349
*             UPTRPL->RPLPOST=ON;   /* POST UPGRADE RPL              */
         OI    RPLPOST(@04),B'01000000'                            0350
*             UPTRPL->RPLFDBWD=0;   /* ZERO FEEDBACK FIELD           */
         SLR   @03,@03                                             0351
         ST    @03,RPLFDBWD(,@04)                                  0351
*             RWORK5=UPTRPL->RPLDACB->ACBAMBL->AMBLDTA;/* LOAD ADDR
*                                      OF BASE AMB                   */
         L     @04,RPLDACB(,@04)                                   0352
         L     @04,ACBAMBL(,@04)                                   0352
         L     RWORK5,AMBLDTA(,@04)                                0352
*             IF(RWORK5->AMBLSR=ON×RWORK5->AMBGSR=ON) THEN/* IF    0353
*                                                              SHRING*/
         TM    AMBLSR(RWORK5),B'01100000'                          0353
         BZ    @RF00353                                            0353
*               CALL GETPLH;        /* GET UPGRADE PLH               */
         BAL   @14,GETPLH                                          0354
*             IF RPLERREG=0 THEN    /* IF NO ERROR                   */
@RF00353 CLI   RPLERREG(RRPL),0                                    0355
         BNE   @RF00355                                            0355
*               DO;                                                0356
*                 UPTF1ATV=ON;      /* INDICATE ACTIVE ENTRY         */
*                 UPTF1UPG=ON;      /* INDICATE AIX IN THIS UPGRADE  */
         OI    UPTF1ATV(RWORK1),B'01000001'                        0358
*                 IF RPLREQ=RPLERASE THEN/* IF BASE FUNCTION IS ERASE*/
         CLI   RPLREQ(RRPL),5                                      0359
         BNE   @RF00359                                            0359
*                   DO;                                            0360
*                     IF RPARM1->UPTBEREG=0 THEN/* IF CHANGE TO BASE
*                                      FAILED                @ZA10895*/
         CLI   UPTBEREG(RPARM1),0                                  0361
         BNE   @RF00361                                            0361
*                       UPTF1ERA=ON;/* SET ERASE BIT                 */
         OI    UPTF1ERA(RWORK1),B'00010000'                        0362
*                     ELSE          /* IF ERROR PROCESSING BASE      */
*                       UPTF1PNU=ON;/* INSERT OLD RECORD             */
         B     @RC00361                                            0363
@RF00361 OI    UPTF1PNU(RWORK1),B'00001000'                        0363
*                   END;                                           0364
*                 ELSE              /* BASE FUNCTION IS PUT          */
*                   IF RPLUPD=OFF THEN/* IS UPDATE BIT OFF IN RPL    */
         B     @RC00359                                            0365
@RF00359 TM    RPLUPD(RRPL),B'00000010'                            0365
         BNZ   @RF00365                                            0365
*                     DO;                                          0366
*                       IF RPARM1->UPTBEREG=0 THEN/* IF CHANGE TO  0367
*                                      BASE FAILED           @ZA10895*/
         CLI   UPTBEREG(RPARM1),0                                  0367
         BNE   @RF00367                                            0367
*                         UPTF1PNU=ON;/* BASE FUNCTION IS PUT NUP    */
         OI    UPTF1PNU(RWORK1),B'00001000'                        0368
*                       ELSE        /* IF ERROR PROCESSING BASE      */
*                         UPTF1ERA=ON;/* SET ERASE BIT               */
         B     @RC00367                                            0369
@RF00367 OI    UPTF1ERA(RWORK1),B'00010000'                        0369
*                     END;                                         0370
*                   ELSE            /* UPDATE BIT IS ON              */
*                     UPTF1PUD=ON;  /* BASE FUNCTION IS PUT UPDATE   */
         B     @RC00365                                            0371
@RF00365 OI    UPTF1PUD(RWORK1),B'00000100'                        0371
*                 UPTPASS=DPASS1;   /* INITIALIZE PASS INDICATOR     */
@RC00365 DS    0H                                                  0372
@RC00359 MVI   UPTPASS(RWORK1),X'01'                               0372
*               END;                                               0373
*           END;                                                   0374
*         ELSE                      /* IF NO CORE FOR        @ZA19598*/
*           RPLFDBWD=UPTRPL->RPLFDBWD;/* UPTRPL AREA         @ZA19598*/
         B     @RC00347                                            0375
@RF00347 L     @04,UPTRPL(,RWORK1)                                 0375
         L     @04,RPLFDBWD(,@04)                                  0375
         ST    @04,RPLFDBWD(,RRPL)                                 0375
*         RESPECIFY                                                0376
*          (RWORK5,                                                0376
*           R15) UNRESTRICTED;                                     0376
@RC00347 DS    0H                                                  0377
*       END;                                                       0377
*     RWORK1=RWORK1+LENGTH(UPTAXENT);/* POINT TO NEXT ENTRY          */
@RF00343 AL    RWORK1,@CF00229                                     0378
*   END;                                                           0379
         BCTR  RWORK3,0                                            0379
@DE00333 LTR   RWORK3,RWORK3                                       0379
         BP    @DL00333                                            0379
@DC00333 DS    0H                                                  0380
         EJECT
*                                                                  0380
*/********************************************************************/
*/* DO UPGRADE -                                                     */
*/********************************************************************/
*                                                                  0380
*   IF RPLERREG=0 THEN              /* IF NO ERROR AS YET            */
         CLI   RPLERREG(RRPL),0                                    0380
         BNE   @RF00380                                            0380
*     DO;                                                          0381
*       RWORK1=RWORK2;              /* RESTORE UPT BASE              */
         LR    RWORK1,RWORK2                                       0382
*       RESPECIFY                                                  0383
*        (RWORK2,                                                  0383
*         RWORK3,                                                  0383
*         RWORK4) UNRESTRICTED;                                    0383
*       DO UNTIL UPTPWS=OFF;        /* LOOP UNTIL BIT SET TO OFF     */
*                                                                  0384
@DL00384 DS    0H                                                  0385
*         /***********************************************************/
*         /*                                                         */
*         /* LOOP UNTIL UPGRADE IS COMPLETE OR TERMINATED            */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0385
*         UPTPWS=OFF;               /* WILL STAY OFF UNTIL TET ON    */
         NI    UPTPWS(RWORK1),B'01111111'                          0385
*         RWORK1=RWORK1-LENGTH(UPTAXENT);/* BACK UP BASE             */
         SL    RWORK1,@CF00229                                     0386
*         DO UNTIL UPTF1LST=ON;     /* LOOP UNTIL LAST ENTRY         */
@DL00387 DS    0H                                                  0388
*           RWORK1=RWORK1+LENGTH(UPTAXENT);/* POINT TO NEXT ENTRY    */
         AL    RWORK1,@CF00229                                     0388
*           IF UPTF1ATV=ON THEN     /* IF ENTRY IS ACTIVE            */
         TM    UPTF1ATV(RWORK1),B'01000000'                        0389
         BNO   @RF00389                                            0389
*             DO;                                                  0390
*               DO WHILE(UPTRPL->RPLPOST=OFF);/* IF NO POST  @ZA14791*/
         B     @DE00391                                            0391
@DL00391 DS    0H                                                  0392
*                 CALL HOLD;        /* HOLD UNTIL I/O COMPLETE       */
         BAL   @14,HOLD                                            0392
*               END;                /*                       @ZA14791*/
@DE00391 L     @15,UPTRPL(,RWORK1)                                 0393
         TM    RPLPOST(@15),B'01000000'                            0393
         BZ    @DL00391                                            0393
*               IF UPTRPL->RPLERREG^=0 THEN/* IF ANY ERROR           */
         CLI   RPLERREG(@15),0                                     0394
         BE    @RF00394                                            0394
*                 CALL ERRPROC;     /* DO ERROR PROCESSING           */
         BAL   @14,ERRPROC                                         0395
*               IF UPTF1RTY=OFF&    /* IF NO RETRY NEEDED            */
*                   UPTF1ATV=ON THEN/* IF ENTRY STILL ACTIVE         */
@RF00394 TM    UPTF1ATV(RWORK1),B'01000000'                        0396
         BNO   @RF00396                                            0396
         TM    UPTF1RTY(RWORK1),B'00000010'                        0396
         BNZ   @RF00396                                            0396
*                 CALL PASS;        /* CALL PASS ROUTINE             */
         SLR   @04,@04                                             0397
         IC    @04,UPTPASS(,RWORK1)                                0397
         SLA   @04,2                                               0397
         L     @15,PASSTAB-4(@04)                                  0397
         BALR  @14,@15                                             0397
*               UPTF1RTY=OFF;       /* RESET RETRY BIT               */
@RF00396 NI    UPTF1RTY(RWORK1),B'11111101'                        0398
*               IF UPTF1ATV=ON THEN /* IF ENTRY STILL ACTIVE         */
         TM    UPTF1ATV(RWORK1),B'01000000'                        0399
         BNO   @RF00399                                            0399
*                 DO;                                              0400
*                   IF UPTRPL->RPLERREG^=0 THEN/* IF ANY ERROR       */
         L     @15,UPTRPL(,RWORK1)                                 0401
         CLI   RPLERREG(@15),0                                     0401
         BE    @RF00401                                            0401
*                     CALL ERRPROC; /* CHECK FOR FATAL ERROR         */
         BAL   @14,ERRPROC                                         0402
*                   RPARM1->UPTPWS=ON;/* SET BIT TO CONTINUE SCAN    */
@RF00401 OI    UPTPWS(RPARM1),B'10000000'                          0403
*                 END;                                             0404
*             END;                                                 0405
@RF00399 DS    0H                                                  0406
*         END;                                                     0406
@RF00389 DS    0H                                                  0406
@DE00387 TM    UPTF1LST(RWORK1),B'10000000'                        0406
         BNO   @DL00387                                            0406
*         RWORK1=RPARM1;            /* RELOAD PTR TO UPT             */
         LR    RWORK1,RPARM1                                       0407
*       END;                                                       0408
@DE00384 TM    UPTPWS(RWORK1),B'10000000'                          0408
         BNZ   @DL00384                                            0408
*     END;                                                         0409
*   IF RPARM1->UPTBEREG^=0 THEN     /* IF ERROR WAS FROM BASE        */
@RF00380 CLI   UPTBEREG(RPARM1),0                                  0410
         BE    @RF00410                                            0410
*     DO;                                                          0411
*       RPLERREG=RPARM1->UPTBEREG;  /* RESTORE BASE ERROR REG        */
         IC    @15,UPTBEREG(,RPARM1)                               0412
         STC   @15,RPLERREG(,RRPL)                                 0412
*       RPLERRCD=RPARM1->UPTBERCD;  /* RESTORE BASE ERROR CODE       */
         IC    @15,UPTBERCD(,RPARM1)                               0413
         STC   @15,RPLERRCD(,RRPL)                                 0413
*       RPARM1->UPTBEREG=0;         /* ZERO OLD COPY                 */
         MVI   UPTBEREG(RPARM1),X'00'                              0414
*       RPARM1->UPTBERCD=0;         /* ZERO OLD COPY                 */
         MVI   UPTBERCD(RPARM1),X'00'                              0415
*       IF RPLCMPON^=0 THEN         /* IF ANY ERROR                  */
         CLI   RPLCMPON(RRPL),0                                    0416
         BE    @RF00416                                            0416
*         RPLCMPON=RPLBASUM;        /* UPGRADE MAY NOT BE COMPLETE   */
         MVI   RPLCMPON(RRPL),X'01'                                0417
*     END;                                                         0418
@RF00416 DS    0H                                                  0419
         EJECT
*                                                                  0419
*/********************************************************************/
*/* TERMINATE UPGRADE                                                */
*/********************************************************************/
*                                                                  0419
*   RWORK1=RPARM1;                  /* POINT TO UPT                  */
@RF00410 LR    RWORK1,RPARM1                                       0419
*   RESPECIFY                                                      0420
*     RWORK2 RESTRICTED;                                           0420
*   DO RWORK2=UPTNOENT TO 1 BY-1;   /* LOOP THRU UPT ENTRIES         */
         SLR   RWORK2,RWORK2                                       0421
         IC    RWORK2,UPTNOENT(,RWORK1)                            0421
         B     @DE00421                                            0421
@DL00421 DS    0H                                                  0422
*     IF UPTF1NOP=OFF&              /* IF VALID ENTRY                */
*         UPTRPL->RPLAREA^=0 THEN   /* IF RPLAREA FIELD EXISTS       */
         TM    UPTF1NOP(RWORK1),B'00010000'                        0422
         BNZ   @RF00422                                            0422
         L     @15,UPTRPL(,RWORK1)                                 0422
         L     @07,RPLAREA(,@15)                                   0422
         LTR   @07,@07                                             0422
         BZ    @RF00422                                            0422
*       DO;                                                        0423
*         STM(RRPL,RPARM1,RPARM1->UPTR15);/* SAVE REGISTERS          */
         STM   RRPL,RPARM1,UPTR15(RPARM1)                          0424
*         RWORK2=UPTRPL->RPLBUFL;   /* LOAD RPLAREA FIELD LENGTH     */
         L     RWORK2,RPLBUFL(,@15)                                0425
*         RWORK1=UPTRPL->RPLAREA;   /* LOAD RPLAREA FIELD ADDRESS    */
         LR    RWORK1,@07                                          0426
*         RESPECIFY                                                0427
*           RAMB RESTRICTED;                                       0427
*         RAMB=ADDR(IDAAMB);        /* POINT TO AMB                  */
         L     RAMB,PLHAMB(,RPLH)                                  0428
*I03:                                                              0429
*         DO;                       /* IDACALL(IDARELWS)             */
I03      DS    0H                                                  0430
*           CALL IDARELWS;          /* EXIT TO IDARELWS              */
         L     @15,@CV01386                                        0430
         BALR  @14,@15                                             0430
*           GEN(BALR @11,0);        /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*           GEN(USING *,@11);       /* ESTABLISH ADDRESSING          */
         USING *,@11
*           GEN(USING *+4095,R10);  /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*           GEN(LA    R10,4095(@11));/* LOAD SECOND BASE             */
         LA    R10,4095(@11)
*           GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE    */
         L     R10,=A(@PSTART+4095)
*           GEN(USING @PSTART+4095,R10);/* ESTABLISH SECOND BASE     */
         USING @PSTART+4095,R10
*           GEN(L     @11,=A(@PSTART));/* RELOAD BASE                */
         L     @11,=A(@PSTART)
*           GEN(USING @PSTART,@11); /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*         END I03;                  /* RELEASE WORK SPACE            */
*         RESPECIFY                                                0440
*           RAMB UNRESTRICTED;                                     0440
*         LM(RRPL,RPARM1,RPARM1->UPTR15);/* RESTORE REGISTERS        */
         LM    RRPL,RPARM1,UPTR15(RPARM1)                          0441
*         UPTRPL->RPLAREA=0;        /* ZERO RPLAREA FIELD ADDRESS    */
         SLR   @15,@15                                             0442
         L     @07,UPTRPL(,RWORK1)                                 0442
         ST    @15,RPLAREA(,@07)                                   0442
*         UPTRPL->RPLBUFL=0;        /* ZERO BUFFER LENGTH            */
         ST    @15,RPLBUFL(,@07)                                   0443
*       END;                                                       0444
*     RESPECIFY                                                    0445
*       RWORK3 RESTRICTED;                                         0445
@RF00422 DS    0H                                                  0446
*     RWORK3=UPTRPL->RPLDACB->ACBAMBL->AMBLDTA;/* LOAD BASE AMB PTR  */
         L     @15,UPTRPL(,RWORK1)                                 0446
         L     @15,RPLDACB(,@15)                                   0446
         L     @15,ACBAMBL(,@15)                                   0446
         L     RWORK3,AMBLDTA(,@15)                                0446
*     IF(RWORK3->AMBLSR=ON×RWORK3->AMBGSR=ON)&/* IF ANY RES SHRING   */
*         UPTF1UPG=ON THEN          /* IF ENTRY WAS IN UPGRADE       */
         TM    AMBLSR(RWORK3),B'01100000'                          0447
         BZ    @RF00447                                            0447
         TM    UPTF1UPG(RWORK1),B'00000001'                        0447
         BNO   @RF00447                                            0447
*       CALL RELPLH;                /* RELEASE PLH                   */
         BAL   @14,RELPLH                                          0448
*     RESPECIFY                                                    0449
*       RWORK3 UNRESTRICTED;                                       0449
@RF00447 DS    0H                                                  0450
*     RWORK1=RWORK1+LENGTH(UPTAXENT);/* POINT TO NEXT ENTRY          */
         AL    RWORK1,@CF00229                                     0450
*   END;                                                           0451
         BCTR  RWORK2,0                                            0451
@DE00421 CL    RWORK2,@CF00054                                     0451
         BNL   @DL00421                                            0451
*   RESPECIFY                                                      0452
*     RWORK2 UNRESTRICTED;                                         0452
*   RWORK1=RPARM1;                  /* RELOAD POINTER TO UPT         */
         LR    RWORK1,RPARM1                                       0453
*   UPTRSC=0;                       /* RELEASE UPT RESOURCE          */
         MVI   UPTRSC(RWORK1),X'00'                                0454
*   RRPL=RPARM1->UPTBRPL;           /* RELOAD USER RPL POINTER       */
         L     RRPL,UPTBRPL(,RPARM1)                               0455
*   RPARM1=ACBAMBL;                 /* RELOAD AMBL ADDRESS           */
         L     @15,RPLDACB(,RRPL)                                  0456
         L     RPARM1,ACBAMBL(,@15)                                0456
*   RESPECIFY                                                      0457
*     RAMB RESTRICTED;                                             0457
*   RAMB=PLHAMB;                    /* RESTORE PTR TO AMB            */
         L     @15,PLHAMB(,RPLH)                                   0458
         LR    RAMB,@15                                            0458
*   IF AMBTRACE^=ZERO THEN          /* IS IDATRACE ACTIVE?   @ZA29388*/
         L     @15,AMBTRACE(,@15)                                  0459
         LTR   @15,@15                                             0459
         BZ    @RF00459                                            0459
*     DO;                           /*                       @ZA29388*/
*       CALL IDA019ST;              /* CALL IDATRACE         @ZA29388*/
         L     @15,@CV01414                                        0461
         BALR  @14,@15                                             0461
*       GEN(DC X'000E');            /* TRACE ID              @ZA29388*/
         DC X'000E'
*     END;                          /*                       @ZA29388*/
*   GEN(IDARST14);                  /* RELOAD RETURN ADDRESS         */
@RF00459 DS    0H                                                  0464
         IDARST14
*   RETURN CODE(RPLERREG);          /* RETURN TO IDA019R4            */
         SLR   @15,@15                                             0465
         IC    @15,RPLERREG(,RRPL)                                 0465
         BR    @14                                                 0465
*   RESPECIFY                                                      0466
*     RAMB UNRESTRICTED;                                           0466
         EJECT
*HOLD:                                                             0467
*                                                                  0467
*/********************************************************************/
*/* THIS ROUTINE WILL WAIT FOR I/O OR RETURN TO USER                 */
*/********************************************************************/
*                                                                  0467
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0467
HOLD     DS    0H                                                  0468
*   GEN(IDASVR14);                  /* SAVE RETURN REGISTER          */
         IDASVR14
*   STM(R15,RPARM1,RPARM1->UPTR15); /* SAVE REGISTERS                */
         STM   R15,RPARM1,UPTR15(RPARM1)                           0469
*   IF RPLASY=OFF THEN              /* IF SYNCH USER REQUEST         */
         TM    RPLASY(RRPL),B'00001000'                            0470
         BNZ   @RF00470                                            0470
*     DO;                                                          0471
*       R1=ADDR(UPTRPL->RPLECB);    /* POINT TO ECB                  */
         L     R1,UPTRPL(,RWORK1)                                  0472
         LA    R1,RPLECB(,R1)                                      0472
*       GEN(WAIT ECB=(1));          /* WAIT FOR I/O TO COMPLETE      */
         WAIT ECB=(1)
*     END;                                                         0474
*   ELSE                            /* OTHERWISE, ASYCH RESUEST      */
*     DO;                                                          0475
         B     @RC00470                                            0475
@RF00470 DS    0H                                                  0476
*       RPARM1->UPTSARES=WAITING;   /* UPGRADE IS WAITING            */
         MVI   UPTSARES(RPARM1),B'00000000'                        0476
*       IF UPTRPL->RPLPOST=ON THEN  /* IF I/O IS NOW COMPLETE        */
         L     @15,UPTRPL(,RWORK1)                                 0477
         TM    RPLPOST(@15),B'01000000'                            0477
         BNO   @RF00477                                            0477
*         DO;                                                      0478
*           TS(RPARM1->UPTSARES);   /* TRY TO REGAIN CONTROL         */
         TS    UPTSARES(RPARM1)                                    0479
*           GEN(BZ  CONTINUE);      /* BRANCH IF CONTROL REGAINED    */
         BZ  CONTINUE
*         END;                                                     0481
*       RAMB=UPTRPL->RPLDACB->ACBAMBL->AMBLDTA;/* GET AMB    @ZA28276*/
@RF00477 L     @15,UPTRPL(,RWORK1)                                 0482
         L     @15,RPLDACB(,@15)                                   0482
         L     @15,ACBAMBL(,@15)                                   0482
         L     RAMB,AMBLDTA(,@15)                                  0482
*       RRPL=0;                     /* SET SW FOR NO RETURN  @ZA19555*/
         SLR   RRPL,RRPL                                           0483
*I04:                                                              0484
*       DO;                         /* IDACALL(IDARSTRT)             */
I04      DS    0H                                                  0485
*         CALL IDARSTRT;            /* EXIT TO IDARSTRT              */
         L     @15,@CV01452                                        0485
         BALR  @14,@15                                             0485
*         GEN(BALR @11,0);          /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*         GEN(USING *,@11);         /* ESTABLISH ADDRESSING          */
         USING *,@11
*         GEN(L     @11,=A(@PSTART));/* RELOAD BASE                  */
         L     @11,=A(@PSTART)
*         GEN(USING @PSTART,@11);   /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*       END I04;                    /* EXIT THRU RESTART     @ZA19555*/
*     END;                                                         0491
*CONTINUE:                                                         0492
*   LM(R15,RPARM1,RPARM1->UPTR15);  /* LOAD REGISTERS FROM UPT       */
@RC00470 DS    0H                                                  0492
CONTINUE LM    R15,RPARM1,UPTR15(RPARM1)                           0492
*   GEN(IDARST14);                  /* RESTORE RETURN REGISTER       */
         IDARST14
*   RETURN;                         /* RETURN TO USER                */
@EL00002 DS    0H                                                  0494
@EF00002 DS    0H                                                  0494
@ER00002 BR    @14                                                 0494
*   END HOLD;                                                      0495
         EJECT
*PASS1:                                                            0496
*                                                                  0496
*/********************************************************************/
*/*                                                                  */
*/* USER FUNCTION            UNIQUE KEYS            NON-UNIQUE KEYS  */
*/*  1. ERASE                 GET UPD OLD KEY        GET UPD OLD KEY */
*/*  2. PUT NUP               PUT NUP NEW KEY        GET UPD NEW KEY */
*/*  3. PUT UPDATE            PUT NUP NEW KEY        GET UPD NEW KEY */
*/*                                                                  */
*/********************************************************************/
*                                                                  0496
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0496
PASS1    DS    0H                                                  0497
*   GEN(IDASVR14);                  /* SAVE RETURN REGISTER          */
         IDASVR14
*   IF UPTF1ERA=ON THEN             /* IF BASE RECORD BEING ERASED   */
         TM    UPTF1ERA(RWORK1),B'00010000'                        0498
         BNO   @RF00498                                            0498
*     DO;                                                          0499
*       UPTF1KEY=UPTOKEY;           /* INDICATE OLD KEY NEEDED       */
         NI    UPTF1KEY(RWORK1),B'11111011'                        0500
*       CALL GETUPD;                /* GET OLD KEY FOR UPDATE        */
         BAL   @14,GETUPD                                          0501
*     END;                                                         0502
*   ELSE                            /* IF NONE OF THE ABOVE          */
*     DO;                                                          0503
         B     @RC00498                                            0503
@RF00498 DS    0H                                                  0504
*       UPTF1KEY=UPTNKEY;           /* INDICATE NEW KEY              */
         OI    UPTF1KEY(RWORK1),B'00000100'                        0504
*       IF UPTF1NUK=OFF THEN        /* IF UNIQUE KEYS                */
         TM    UPTF1NUK(RWORK1),B'00100000'                        0505
         BNZ   @RF00505                                            0505
*         CALL PUTNUP;              /* PUT INSERT NEW KEY            */
         BAL   @14,PUTNUP                                          0506
*       ELSE                        /* IF NON-UNIQUE KEYS            */
*         CALL GETUPD;              /* GET RECORD IF EXISTS          */
         B     @RC00505                                            0507
@RF00505 BAL   @14,GETUPD                                          0507
*     END;                                                         0508
@RC00505 DS    0H                                                  0509
*   UPTPASS=DPASS2;                 /* SET NEXT PASS                 */
@RC00498 MVI   UPTPASS(RWORK1),X'02'                               0509
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END PASS1;                                                     0511
@EL00003 DS    0H                                                  0511
@EF00003 DS    0H                                                  0511
@ER00003 BR    @14                                                 0511
*PASS2:                                                            0512
*                                                                  0512
*/********************************************************************/
*/*                                                                  */
*/* WAIT FOR ALL PASS 1 I/O TO COMPLETE                              */
*/*                                                                  */
*/********************************************************************/
*                                                                  0512
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0512
PASS2    DS    0H                                                  0513
*   RESPECIFY                                                      0513
*     R14 RESTRICTED;                                              0513
*   UPTPASS=DPASS4;                 /* SET TO GO TO PASS 3           */
         MVI   UPTPASS(RWORK1),X'04'                               0514
*   RESPECIFY                                                      0515
*     R14 UNRESTRICTED;                                            0515
*   END PASS2;                                                     0516
@EL00004 DS    0H                                                  0516
@EF00004 DS    0H                                                  0516
@ER00004 BR    @14                                                 0516
         EJECT
*PASS4:                                                            0517
*                                                                  0517
*/********************************************************************/
*/*                                                                  */
*/* USER FUNCTION            UNIQUE KEYS            NON-UNIQUE KEYS  */
*/*  1. ERASE                 ERASE OLD KEY          PUT UPD OLD KEY */
*/*  2. PUT NUP                (DONE)                PUT UPD NEW KEY */
*/*  3. PUT UPDATE            GET UPD OLD KEY        PUT UPD NEW KEY */
*/*                                                                  */
*/********************************************************************/
*                                                                  0517
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0517
PASS4    DS    0H                                                  0518
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   IF(UPTF1PNU=ON)&                /* IF USER REQ PUT NUP           */
*       UPTF1NUK=OFF THEN           /* IF UPGRADE ACB HAS UNIQUE KEYS*/
         TM    UPTF1PNU(RWORK1),B'00001000'                        0519
         BNO   @RF00519                                            0519
         TM    UPTF1NUK(RWORK1),B'00100000'                        0519
         BNZ   @RF00519                                            0519
*     UPTF1ATV=OFF;                 /* THIS PART OF UPGRADE COMPLETE */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0520
*   ELSE                            /* IF NONE OF THE ABOVE          */
*     DO;                                                          0521
         B     @RC00519                                            0521
@RF00519 DS    0H                                                  0522
*       IF UPTF1LOP^=UPTLOPGU THEN  /* PASS 1 OPERATION NOT GET UPD  */
         CLI   UPTF1LOP(RWORK1),B'01000000'                        0522
         BE    @RF00522                                            0522
*         DO;                                                      0523
*           IF UPTF1PNU=ON THEN     /* IF BASE FUNCTION PUT NUP      */
         TM    UPTF1PNU(RWORK1),B'00001000'                        0524
         BNO   @RF00524                                            0524
*             UPTF1ATV=OFF;         /* UPGRADE IS COMPLETE           */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0525
*           ELSE                    /* IF NOT PUT NUP                */
*             DO;                                                  0526
         B     @RC00524                                            0526
@RF00524 DS    0H                                                  0527
*               UPTF1KEY=UPTOKEY;   /* PROCESS OLD KEY               */
         NI    UPTF1KEY(RWORK1),B'11111011'                        0527
*               CALL GETUPD;        /* GET UPD OLD KEY               */
         BAL   @14,GETUPD                                          0528
*             END;                                                 0529
*         END;                                                     0530
*       ELSE                        /* PASS 1 OPERATION WAS GET UPD  */
*         IF UPTF1NRF=ON THEN       /* IF NO RECORD WAS FOUND        */
         B     @RC00522                                            0531
@RF00522 TM    UPTF1NRF(RWORK1),B'00001000'                        0531
         BNO   @RF00531                                            0531
*           DO;                                                    0532
*             UPTF1NRF=OFF;         /* RESET BIT                     */
         NI    UPTF1NRF(RWORK1),B'11110111'                        0533
*             IF UPTF1KEY=UPTOKEY THEN/* IF OLD KEY WAS NOT FOUND    */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0534
         BNZ   @RF00534                                            0534
*               UPTF1ATV=OFF;       /* UPGRADE PROCESSING IS COMPLETE*/
         NI    UPTF1ATV(RWORK1),B'10111111'                        0535
*             ELSE                  /* IF NEW KEY WAS NOT FOUND      */
*               CALL PUTNUP;        /* INSERT NEW KEY                */
         B     @RC00534                                            0536
@RF00534 BAL   @14,PUTNUP                                          0536
*           END;                                                   0537
*         ELSE                      /* IF RECORD WAS FOUND           */
*           DO;                                                    0538
         B     @RC00531                                            0538
@RF00531 DS    0H                                                  0539
*             IF UPTF1KEY=UPTOKEY THEN/* IF OLD KEY WAS FOUND        */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0539
         BNZ   @RF00539                                            0539
*               DO;                                                0540
*                 IF UPTF1NUK=ON THEN/* IF NOT UNIQUE KEYS           */
         TM    UPTF1NUK(RWORK1),B'00100000'                        0541
         BNO   @RF00541                                            0541
*                   CALL PUTUPD;    /* PUT UPD OLD KEY               */
         BAL   @14,PUTUPD                                          0542
*                 ELSE              /* IF UNIQUE KEYS                */
*                   CALL ERAUPD;    /* ERASE OLD KEY                 */
         B     @RC00541                                            0543
@RF00541 BAL   @14,ERAUPD                                          0543
*               END;                                               0544
*             ELSE                  /* IF NEW KEY WAS FOUND          */
*               CALL PUTUPD;        /* PUT UPD KEY KEY               */
         B     @RC00539                                            0545
@RF00539 BAL   @14,PUTUPD                                          0545
*           END;                                                   0546
@RC00539 DS    0H                                                  0547
*     END;                                                         0547
@RC00531 DS    0H                                                  0547
@RC00522 DS    0H                                                  0548
*   UPTPASS=DPASS5;                 /* GO TO PASS 5 NEXT             */
@RC00519 MVI   UPTPASS(RWORK1),X'05'                               0548
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END PASS4;                                                     0550
@EL00005 DS    0H                                                  0550
@EF00005 DS    0H                                                  0550
@ER00005 BR    @14                                                 0550
         EJECT
*PASS5:                                                            0551
*                                                                  0551
*/********************************************************************/
*/*                                                                  */
*/* USER FUNCTION            UNIQUE KEYS            NON-UNIQUE KEYS  */
*/*  1. ERASE                 (DONE)                 (DONE)          */
*/*  2. PUT NUP               (DONE)                 (DONE)          */
*/*  3. PUT UPDATE            ERASE OLD KEY          GET UPD OLD KEY */
*/*                                                                  */
*/********************************************************************/
*                                                                  0551
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0551
PASS5    DS    0H                                                  0552
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   IF(UPTF1PNU=ON)×                /* IF PUT NUP                    */
*       UPTF1ERA=ON THEN            /* OR ERASE                      */
         TM    UPTF1PNU(RWORK1),B'00011000'                        0553
         BZ    @RF00553                                            0553
*     UPTF1ATV=OFF;                 /* PROCESSING IS COMPLETE        */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0554
*   ELSE                            /* IF NEITHER OF THE ABOVE       */
*     DO;                                                          0555
         B     @RC00553                                            0555
@RF00553 DS    0H                                                  0556
*       UPTF1KEY=UPTOKEY;           /* PROCESS OLD KEY               */
         NI    UPTF1KEY(RWORK1),B'11111011'                        0556
*       IF UPTF1NUK=OFF THEN        /* IF UNIQUE KEYS                */
         TM    UPTF1NUK(RWORK1),B'00100000'                        0557
         BNZ   @RF00557                                            0557
*         DO;                                                      0558
*           CALL ERAUPD;            /* ERASE OLD KEY                 */
         BAL   @14,ERAUPD                                          0559
*         END;                                                     0560
*       ELSE                        /* IF NON-UNIQUE KEYS            */
*         DO;                                                      0561
         B     @RC00557                                            0561
@RF00557 DS    0H                                                  0562
*           CALL GETUPD;            /* GET UPD OLD KEY               */
         BAL   @14,GETUPD                                          0562
*         END;                                                     0563
*     END;                                                         0564
@RC00557 DS    0H                                                  0565
*   UPTPASS=DPASS6;                 /* NEXT PASS IS PASS 6           */
@RC00553 MVI   UPTPASS(RWORK1),X'06'                               0565
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END PASS5;                                                     0567
@EL00006 DS    0H                                                  0567
@EF00006 DS    0H                                                  0567
@ER00006 BR    @14                                                 0567
         EJECT
*PASS6:                                                            0568
*                                                                  0568
*/********************************************************************/
*/*                                                                  */
*/* USER FUNCTION            UNIQUE KEYS            NON-UNIQUE KEYS  */
*/*  1. ERASE                 (DONE)                 (DONE)          */
*/*  2. PUT NUP               (DONE)                 (DONE)          */
*/*  3. PUT UPDATE            (DONE)                 PUT UPD OLD KEY */
*/*                                                                  */
*/********************************************************************/
*                                                                  0568
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0568
PASS6    DS    0H                                                  0569
*   RESPECIFY                                                      0569
*     R14 RESTRICTED;                                              0569
*   IF UPTF1LOP=UPTLOPER THEN       /* IF LAST OPERATION WAS ERASE   */
         CLI   UPTF1LOP(RWORK1),B'10000000'                        0570
         BNE   @RF00570                                            0570
*     UPTF1ATV=OFF;                 /* THEN PROCESSING COMPLETE      */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0571
*   ELSE                            /* IF NOT ERASE                  */
*     DO;                                                          0572
         B     @RC00570                                            0572
@RF00570 DS    0H                                                  0573
*       GEN(IDASVR14);              /* SAVE RETURN ADDRESS           */
         IDASVR14
*       CALL PUTUPD;                /* PUT UPDATE OLD KEY            */
         BAL   @14,PUTUPD                                          0574
*       GEN(IDARST14);              /* RESTORE RETURN ADDRESS        */
         IDARST14
*     END;                                                         0576
*   UPTPASS=DPASS7;                 /* NEXT PASS IS PASS 7           */
@RC00570 MVI   UPTPASS(RWORK1),X'07'                               0577
*   RESPECIFY                                                      0578
*     R14 UNRESTRICTED;                                            0578
*   END PASS6;                                                     0579
@EL00007 DS    0H                                                  0579
@EF00007 DS    0H                                                  0579
@ER00007 BR    @14                                                 0579
*PASS7:                                                            0580
*                                                                  0580
*/********************************************************************/
*/*                                                                  */
*/* USER FUNCTION            UNIQUE KEYS            NON-UNIQUE KEYS  */
*/*  1. ERASE                 (DONE)                 (DONE)          */
*/*  2. PUT NUP               (DONE)                 (DONE)          */
*/*  3. PUT UPDATE            (DONE)                 (DONE)          */
*/*                                                                  */
*/********************************************************************/
*                                                                  0580
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0580
PASS7    DS    0H                                                  0581
*   RESPECIFY                                                      0581
*     R14 RESTRICTED;                                              0581
*   UPTF1ATV=OFF;                   /* ALL PROCESSING IS COMPLETE    */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0582
*   RESPECIFY                                                      0583
*     R14 UNRESTRICTED;                                            0583
*   END PASS7;                                                     0584
@EL00008 DS    0H                                                  0584
@EF00008 DS    0H                                                  0584
@ER00008 BR    @14                                                 0584
         EJECT
*PASS8:                                                            0585
*                                                                  0585
*/********************************************************************/
*/* FIRST BACKOUT PASS -                                             */
*/*   . IF LOGICAL ERROR WITH NEW KEY, NO BACKOUT IS NEEDED          */
*/*   . IF LOGICAL ERROR WITH OLD KEY, NEW KEY MUST BE REMOVED       */
*/*   . IF NO ERROR - (OTHER AIX HAD ERROR)                          */
*/*   . . IF LAST OPERATION WAS PUT, GET RECORD WRITTEN              */
*/*   . . IF LAST OPERATION WAS ERASE, PUT NUP RECORD ERASED         */
*/*   . . IF LAST OPERATION WAS GET UPD -                            */
*/*   . . . IF OLD KEY WAS GOTTEN, GET UPD NEW KEY                   */
*/*   . . . OTHER WISE, DONE                                         */
*/********************************************************************/
*                                                                  0585
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0585
PASS8    DS    0H                                                  0586
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   IF UPTF1LOG=ON×UPTF1PHY=ON THEN /* IF LAST OPERATION FAILED      */
         TM    UPTF1LOG(RWORK1),B'01100000'                        0587
         BZ    @RF00587                                            0587
*     DO;                                                          0588
*       IF UPTF1KEY=UPTNKEY THEN    /* IF TRYING TO PROCESS NEW KEY  */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0589
         BNO   @RF00589                                            0589
*         UPTF1ATV=OFF;             /* NO RECOVERY IS NEEDED         */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0590
*       ELSE                        /* IF OLD KEY BEING PROCESSED    */
*         DO;                                                      0591
         B     @RC00589                                            0591
@RF00589 DS    0H                                                  0592
*           UPTF1KEY=UPTNKEY;       /* SET TO PROCESS NEW KEY        */
         OI    UPTF1KEY(RWORK1),B'00000100'                        0592
*           CALL GETUPD;            /* GET UPDATE NEW KEY            */
         BAL   @14,GETUPD                                          0593
*         END;                                                     0594
*     END;                                                         0595
*   ELSE                            /* IF LAST OPERATION WAS OK      */
*     IF UPTF1LOP=UPTLOPPU×         /* IF LAST OPERATION PUT UPDATE  */
*         UPTF1LOP=UPTLOPPN THEN    /* IF LAST OPERATION WAS PUT NUP */
         B     @RC00587                                            0596
@RF00587 CLI   UPTF1LOP(RWORK1),B'00100000'                        0596
         BE    @RT00596                                            0596
         CLI   UPTF1LOP(RWORK1),B'00010000'                        0596
         BNE   @RF00596                                            0596
@RT00596 DS    0H                                                  0597
*       CALL GETUPD;                /* GET LAST RECORD WRITTEN       */
         BAL   @14,GETUPD                                          0597
*     ELSE                          /* LAST OP ERASE OR GET UPDATE   */
*       IF UPTF1LOP=UPTLOPER THEN   /* IF LAST OPERATION ERASE       */
         B     @RC00596                                            0598
@RF00596 CLI   UPTF1LOP(RWORK1),B'10000000'                        0598
         BNE   @RF00598                                            0598
*         CALL PUTNUP;              /* INSERT RECORD ERASED          */
         BAL   @14,PUTNUP                                          0599
*       ELSE                        /* NOT ERASE - IS GET UPDATE     */
*         IF UPTF1KEY=UPTNKEY×      /* IF LAST OPERATION GOT NEW KEY */
*             UPTF1ERA=ON THEN      /* IF BASE FUNCTION ERASE        */
         B     @RC00598                                            0600
@RF00598 TM    UPTF1KEY(RWORK1),B'00000100'                        0600
         BO    @RT00600                                            0600
         TM    UPTF1ERA(RWORK1),B'00010000'                        0600
         BNO   @RF00600                                            0600
@RT00600 DS    0H                                                  0601
*           UPTF1ATV=OFF;           /* BACKOUT IS COMPLETE           */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0601
*         ELSE                      /* IF OLD KEY AND NOT ERASE      */
*           DO;                                                    0602
         B     @RC00600                                            0602
@RF00600 DS    0H                                                  0603
*             UPTF1KEY=UPTNKEY;     /* PROCESS NEW KEY               */
         OI    UPTF1KEY(RWORK1),B'00000100'                        0603
*             CALL GETUPD;          /* GET UPDATE NEW KEY            */
         BAL   @14,GETUPD                                          0604
*           END;                                                   0605
*   UPTPASS=DPASS9;                 /* SET NEXT PASS                 */
@RC00600 DS    0H                                                  0606
@RC00598 DS    0H                                                  0606
@RC00596 DS    0H                                                  0606
@RC00587 MVI   UPTPASS(RWORK1),X'09'                               0606
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END PASS8;                                                     0608
@EL00009 DS    0H                                                  0608
@EF00009 DS    0H                                                  0608
@ER00009 BR    @14                                                 0608
         EJECT
*PASS9:                                                            0609
*                                                                  0609
*/********************************************************************/
*/*  SECOND BACKOUT PASS -                                           */
*/*  . IF PROCESSING NEW KEY -                                       */
*/*  . . IF LAST OPERATION WAS ERASE OR PUT UPDATE, THEN DONE        */
*/*  . . IF LAST OPERATION WAS GET UPD, THEN PUT UPD NEW NEW         */
*/*  . IF PROCESSING OLD KEY -                                       */
*/*  . . IF LAST OPERATION WAS PUT, THEN GET UPD NEW KEY             */
*/*  . . IF LAST OPERATION WAS GET UPDATE, THEN PUT UPD OLD KEY      */
*/********************************************************************/
*                                                                  0609
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0609
PASS9    DS    0H                                                  0610
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   IF UPTF1KEY=UPTNKEY THEN        /* IF NEW KEY BEING PROCESSED    */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0611
         BNO   @RF00611                                            0611
*     DO;                                                          0612
*       IF UPTF1LOP=UPTLOPER×       /* IF NEW KEY ERASED             */
*           UPTF1LOP=UPTLOPPU THEN  /* IF NEW KEY PUT UPDATED        */
         CLI   UPTF1LOP(RWORK1),B'10000000'                        0613
         BE    @RT00613                                            0613
         CLI   UPTF1LOP(RWORK1),B'00100000'                        0613
         BNE   @RF00613                                            0613
@RT00613 DS    0H                                                  0614
*         UPTF1ATV=OFF;             /* THEN PROCESSING COMPLETE      */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0614
*       ELSE                        /* IF LAST OPERATION GET UPDATE  */
*         CALL PUTUPD;              /* THEN PUT UPDATE NEW KEY       */
         B     @RC00613                                            0615
@RF00613 BAL   @14,PUTUPD                                          0615
*     END;                                                         0616
*   ELSE                            /* IF OLD KEY BEING PROCESSED    */
*     IF UPTF1LOP=UPTLOPPN×         /* IF LAST OPERATION PUT NUP     */
*         UPTF1LOP=UPTLOPPU THEN    /* IF LAST OPERATION PUT UPDATE  */
         B     @RC00611                                            0617
@RF00611 CLI   UPTF1LOP(RWORK1),B'00010000'                        0617
         BE    @RT00617                                            0617
         CLI   UPTF1LOP(RWORK1),B'00100000'                        0617
         BNE   @RF00617                                            0617
@RT00617 DS    0H                                                  0618
*       DO;                                                        0618
*         UPTF1KEY=UPTNKEY;         /* SWITCH TO NEW KEY             */
         OI    UPTF1KEY(RWORK1),B'00000100'                        0619
*         CALL GETUPD;              /* GET UPDATE NEW KEY            */
         BAL   @14,GETUPD                                          0620
*       END;                                                       0621
*     ELSE                          /* LAST OPERATION WAS GET UPDATE */
*       CALL PUTUPD;                /* PUT UPDATE OLD KEY            */
         B     @RC00617                                            0622
@RF00617 BAL   @14,PUTUPD                                          0622
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
@RC00617 DS    0H                                                  0623
@RC00611 DS    0H                                                  0623
         IDARST14
*   END PASS9;                                                     0624
@EL00010 DS    0H                                                  0624
@EF00010 DS    0H                                                  0624
@ER00010 BR    @14                                                 0624
         EJECT
*   RESPECIFY                                                      0625
*     IFGRPL BASED(UPTRPL);                                        0625
*   RESPECIFY                                                      0626
*     IDAAIX BASED(RPLAREA);                                       0626
*GETUPD:                                                           0627
*                                                                  0627
*/********************************************************************/
*/* THIS PROCEDURE ISSUES A GET UPD FOR THE AIX RECORD SPECIFIED BY  */
*/* UPTF1KEY                                                         */
*/********************************************************************/
*                                                                  0627
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0627
GETUPD   DS    0H                                                  0628
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   UPTF1LOP=UPTLOPGU;              /* SET LAST OPERATION            */
         MVI   UPTF1LOP(RWORK1),B'01000000'                        0629
*   RPLREQ=RPLGET;                  /* SET UPGRADE RPL FOR GET       */
         L     @04,UPTRPL(,RWORK1)                                 0630
         MVI   RPLREQ(@04),X'00'                                   0630
*   RPLUPD=ON;                      /* SET UPGRADE RPL TO UPDATE     */
         OI    RPLUPD(@04),B'00000010'                             0631
*   IF UPTF1KEY=UPTOKEY THEN        /* IF OLD KEY REQUESTED          */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0632
         BNZ   @RF00632                                            0632
*     RPLARG=RPARM1->UPTOLD+UPTRKP; /* POINT TO OLD KEY              */
         LH    @03,UPTRKP(,RWORK1)                                 0633
         AL    @03,UPTOLD(,RPARM1)                                 0633
         ST    @03,RPLARG(,@04)                                    0633
*   ELSE                            /* IF NEW KEY WAS REQUESTED      */
*     RPLARG=RPARM1->UPTNEW+UPTRKP; /* POINT TO NEW KEY              */
         B     @RC00632                                            0634
@RF00632 L     @04,UPTRPL(,RWORK1)                                 0634
         LH    @03,UPTRKP(,RWORK1)                                 0634
         AL    @03,UPTNEW(,RPARM1)                                 0634
         ST    @03,RPLARG(,@04)                                    0634
*   CALL R4INT;                     /* GET RECORD                    */
@RC00632 BAL   @14,R4INT                                           0635
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END GETUPD;                                                    0637
@EL00011 DS    0H                                                  0637
@EF00011 DS    0H                                                  0637
@ER00011 BR    @14                                                 0637
         EJECT
*PUTUPD:                                                           0638
*                                                                  0638
*/********************************************************************/
*/* THIS  PROCEDURE REBUILDS AND REWRITES THE NEW AIX RECORD         */
*/*   KEY TYPE       UPGRADE        BACKOUT                          */
*/*    OLD            KEY REMOVED    KEY ADDED                       */
*/*    NEW            KEY ADDED      KEY REMOVED                     */
*/********************************************************************/
*                                                                  0638
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0638
PUTUPD   DS    0H                                                  0639
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   IF UPTF1NRF=ON THEN             /* IF NO RECORD WAS FOUND        */
         TM    UPTF1NRF(RWORK1),B'00001000'                        0640
         BNO   @RF00640                                            0640
*     DO;                                                          0641
*       UPTF1NRF=OFF;               /* RESET INDICATOR               */
         NI    UPTF1NRF(RWORK1),B'11110111'                        0642
*       IF UPTF1KEY=UPTNKEY THEN    /* IF NEW KEY WAS EXPECTED       */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0643
         BNO   @RF00643                                            0643
*         CALL PUTNUP;              /* INSERT NEW KEY                */
         BAL   @14,PUTNUP                                          0644
*     END;                                                         0645
*   ELSE                            /* IF RECORD WAS FOUND           */
*     DO;                                                          0646
         B     @RC00640                                            0646
@RF00640 DS    0H                                                  0647
*       RESPECIFY                                                  0647
*        (RWORK2,                                                  0647
*         R15) RESTRICTED;                                         0647
*       IF UPTF1KEY=UPTOKEY THEN    /* IF OLD KEY WAS READ           */
         TM    UPTF1KEY(RWORK1),B'00000100'                        0648
         BNZ   @RF00648                                            0648
*         DO;                                                      0649
*           IF AMDDST=ON THEN       /* IF KEYED DATA SET             */
         L     @14,PLHAMB(,RPLH)                                   0650
         L     @14,AMBDSB(,@14)                                    0650
         TM    AMDDST(@14),B'10000000'                             0650
         BNO   @RF00650                                            0650
*             RWORK2=RPARM1->UPTOLD+AMDRKP;/* PT TO OLD KEY  @ZA10889*/
         LH    RWORK2,AMDRKP(,@14)                                 0651
         AL    RWORK2,UPTOLD(,RPARM1)                              0651
*           ELSE                    /* IF ESDS                       */
*             RWORK2=ADDR(PLHCRPL->RPLDDDD);/* POINT TO CURRENT RBA  */
         B     @RC00650                                            0652
@RF00650 L     RWORK2,PLHCRPL(,RPLH)                               0652
         LA    RWORK2,RPLDDDD(,RWORK2)                             0652
*           IF UPTF1BKO=ON THEN     /* IF BACKOUT IN PROGRESS        */
@RC00650 TM    UPTF1BKO(RWORK1),B'10000000'                        0653
         BNO   @RF00653                                            0653
*             CALL ADDEND;          /* ADD OLD KEY TO END            */
         BAL   @14,ADDEND                                          0654
*           ELSE                    /* IF NOT BACKOUT                */
*             CALL REMPTR;          /* REMOVE KEY FROM RECORD        */
         B     @RC00653                                            0655
@RF00653 BAL   @14,REMPTR                                          0655
*         END;                                                     0656
*       ELSE                        /* IF NEW KEY RECORD WAS READ    */
*         DO;                                                      0657
         B     @RC00648                                            0657
@RF00648 DS    0H                                                  0658
*           IF AMDDST=ON THEN       /* IF KEYED DATA SET             */
         L     @14,PLHAMB(,RPLH)                                   0658
         L     @14,AMBDSB(,@14)                                    0658
         TM    AMDDST(@14),B'10000000'                             0658
         BNO   @RF00658                                            0658
*             RWORK2=RPARM1->UPTNEW+AMDRKP;/* PT TO NEW KEY  @ZA10889*/
         LH    RWORK2,AMDRKP(,@14)                                 0659
         AL    RWORK2,UPTNEW(,RPARM1)                              0659
*           ELSE                    /* IF ESDS                       */
*             RWORK2=ADDR(PLHCRPL->RPLDDDD);/* POINT TO CURRENT RBA  */
         B     @RC00658                                            0660
@RF00658 L     RWORK2,PLHCRPL(,RPLH)                               0660
         LA    RWORK2,RPLDDDD(,RWORK2)                             0660
*           CALL REMPTR;            /* REMOVE ANY IF THERE           */
@RC00658 BAL   @14,REMPTR                                          0661
*           IF UPTF1BKO=OFF THEN    /* IF BACKOUT NOT IN PROGRESS    */
         TM    UPTF1BKO(RWORK1),B'10000000'                        0662
         BNZ   @RF00662                                            0662
*             CALL ADDEND;          /* ADD KEY TO END                */
         BAL   @14,ADDEND                                          0663
*           ELSE                    /* IF NO NEED TO ADD PTR TO END  */
*             R15=0;                /* THEN NO ERROR                 */
         B     @RC00662                                            0664
@RF00662 SLR   R15,R15                                             0664
*         END;                                                     0665
@RC00662 DS    0H                                                  0666
*       IF R15=0 THEN               /* IF NO ERROR                   */
@RC00648 SLR   @14,@14                                             0666
         CR    R15,@14                                             0666
         BNE   @RF00666                                            0666
*         DO;                                                      0667
*           IF AIXPC=0 THEN         /* IF NO PTRS LEFT               */
         L     @07,UPTRPL(,RWORK1)                                 0668
         L     @07,RPLAREA(,@07)                                   0668
         CH    @14,AIXPC(,@07)                                     0668
         BNE   @RF00668                                            0668
*             CALL ERAUPD;          /* ERASE RECORD                  */
         BAL   @14,ERAUPD                                          0669
*           ELSE                    /* IF AT LEAST ONE PTR LEFT      */
*             DO;                                                  0670
         B     @RC00668                                            0670
@RF00668 DS    0H                                                  0671
*               UPTF1LOP=UPTLOPPU;  /* SET LAST OPERATION            */
         MVI   UPTF1LOP(RWORK1),B'00100000'                        0671
*               RPLREQ=RPLPUT;      /* SET UPGRADE RPL FOR PUT       */
         L     @14,UPTRPL(,RWORK1)                                 0672
         MVI   RPLREQ(@14),X'01'                                   0672
*               CALL R4INT;         /* PUT UPD RECPRD                */
         BAL   @14,R4INT                                           0673
*             END;                                                 0674
*         END;                                                     0675
@RC00668 DS    0H                                                  0676
*       RESPECIFY                                                  0676
*        (RWORK2,                                                  0676
*         R15) UNRESTRICTED;                                       0676
@RF00666 DS    0H                                                  0677
*     END;                                                         0677
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
@RC00640 DS    0H                                                  0678
         IDARST14
*   END PUTUPD;                                                    0679
@EL00012 DS    0H                                                  0679
@EF00012 DS    0H                                                  0679
@ER00012 BR    @14                                                 0679
         EJECT
*PUTNUP:                                                           0680
*                                                                  0680
*/********************************************************************/
*/* WRITES A NEW RECORD                                              */
*/********************************************************************/
*                                                                  0680
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0680
PUTNUP   DS    0H                                                  0681
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   UPTF1LOP=UPTLOPPN;              /* SET LAST OPERATION            */
         MVI   UPTF1LOP(RWORK1),B'00010000'                        0682
*   RPLREQ=RPLPUT;                  /* SET UPGRADE RPL FOR PUT       */
         L     @04,UPTRPL(,RWORK1)                                 0683
         MVI   RPLREQ(@04),X'01'                                   0683
*   RPLUPD=OFF;                     /* SET UPGRADE RPL FOR INSERT    */
         NI    RPLUPD(@04),B'11111101'                             0684
*   CALL BLDNEW;                    /* BUILD NEW AIX RECORD          */
         BAL   @14,BLDNEW                                          0685
*   RESPECIFY                                                      0686
*     R15 RESTRICTED;                                              0686
*   CALL ADDEND;                    /* ADD NEW KEY TO END            */
         BAL   @14,ADDEND                                          0687
*   IF R15=0 THEN                   /* IF NO ERROR                   */
         LTR   R15,R15                                             0688
         BNZ   @RF00688                                            0688
*     CALL R4INT;                   /* INSERT RECORD                 */
         BAL   @14,R4INT                                           0689
*   RESPECIFY                                                      0690
*     R15 UNRESTRICTED;                                            0690
@RF00688 DS    0H                                                  0691
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END PUTNUP;                                                    0692
@EL00013 DS    0H                                                  0692
@EF00013 DS    0H                                                  0692
@ER00013 BR    @14                                                 0692
         EJECT
*ERAUPD:                                                           0693
*                                                                  0693
*/********************************************************************/
*/* INITIATES THE ERASE OF AN AIX RECORD                             */
*/********************************************************************/
*                                                                  0693
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0693
ERAUPD   DS    0H                                                  0694
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   UPTF1LOP=UPTLOPER;              /* INDICATE LAST OPERATION       */
         MVI   UPTF1LOP(RWORK1),B'10000000'                        0695
*   IF UPTF1NRF=OFF THEN            /* IF RECORD WAS FOUND           */
         TM    UPTF1NRF(RWORK1),B'00001000'                        0696
         BNZ   @RF00696                                            0696
*     DO;                                                          0697
*       RPLREQ=RPLERASE;            /* SET RPL TO DO ERASE           */
         L     @04,UPTRPL(,RWORK1)                                 0698
         MVI   RPLREQ(@04),X'05'                                   0698
*       CALL R4INT;                 /* GO TO IDA019R4                */
         BAL   @14,R4INT                                           0699
*     END;                                                         0700
*   ELSE                            /* NO RECORD WAS FOUND           */
*     UPTF1NRF=OFF;                 /* RESET BIT                     */
         B     @RC00696                                            0701
@RF00696 NI    UPTF1NRF(RWORK1),B'11110111'                        0701
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
@RC00696 DS    0H                                                  0702
         IDARST14
*   END ERAUPD;                                                    0703
@EL00014 DS    0H                                                  0703
@EF00014 DS    0H                                                  0703
@ER00014 BR    @14                                                 0703
         EJECT
*BLDNEW:                                                           0704
*                                                                  0704
*/********************************************************************/
*/* BUILDS THE HEADER PORTION OF A NEW RECORD                        */
*/********************************************************************/
*                                                                  0704
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0704
BLDNEW   DS    0H                                                  0705
*   RESPECIFY                                                      0705
*     R14 RESTRICTED;                                              0705
*   AIXFG=0;                        /* ZERO FLAG FIELD               */
         L     @15,UPTRPL(,RWORK1)                                 0706
         L     @04,RPLAREA(,@15)                                   0706
         MVI   AIXFG(@04),X'00'                                    0706
*   AIXPC=0;                        /* INITIALLY NO PTR PRESENT      */
         SLR   @03,@03                                             0707
         STH   @03,AIXPC(,@04)                                     0707
*   AIXKL=UPTLNCDE+1;               /* SET KEY LENGTH                */
         LA    @03,1                                               0708
         SLR   @00,@00                                             0708
         IC    @00,UPTLNCDE(,RWORK1)                               0708
         ALR   @03,@00                                             0708
         STC   @03,AIXKL(,@04)                                     0708
*   RPLRLEN=LENGTH(IDAAIX)+AIXKL;   /* SAY RECORD HAS HEADER         */
         AL    @03,@CF00220                                        0709
         ST    @03,RPLRLEN(,@15)                                   0709
*   IF AMDDST=ON THEN               /* IF KEYED DATA SET             */
         L     @15,PLHAMB(,RPLH)                                   0710
         L     @15,AMBDSB(,@15)                                    0710
         TM    AMDDST(@15),B'10000000'                             0710
         BNO   @RF00710                                            0710
*     DO;                                                          0711
*       AIXPKP=ON;                  /* INDICATE POINTERS ARE KEYS    */
         OI    AIXPKP(@04),B'00000001'                             0712
*       AIXPL=AMDKEYLN;             /* PTR LENGTH IS BASE KEY LENGTH */
         LH    @15,AMDKEYLN(,@15)                                  0713
         STC   @15,AIXPL(,@04)                                     0713
*     END;                                                         0714
*   ELSE                            /* IF ESDS                       */
*     AIXPL=LENGTH(RPLDDDD);        /* PTR LENGTH IS 4 BYTES         */
         B     @RC00710                                            0715
@RF00710 L     @15,UPTRPL(,RWORK1)                                 0715
         L     @15,RPLAREA(,@15)                                   0715
         MVI   AIXPL(@15),X'04'                                    0715
*   IF RPLRLEN+AIXPL>RPLBUFL THEN   /* IF NOT ENUF ROOM FOR BASE KEY
*                                                            @ZA24902*/
@RC00710 L     @15,UPTRPL(,RWORK1)                                 0716
         L     @04,RPLAREA(,@15)                                   0716
         SLR   @03,@03                                             0716
         IC    @03,AIXPL(,@04)                                     0716
         AL    @03,RPLRLEN(,@15)                                   0716
         C     @03,RPLBUFL(,@15)                                   0716
         BNH   @RF00716                                            0716
*     DO;                                                          0717
*       GEN(IDASVR14);              /* SAVE RETURN ADDRESS           */
         IDASVR14
*       CALL XPANDBFR;              /* GET ROOM IN BUFFER            */
         BAL   @14,XPANDBFR                                        0719
*       GEN(IDARST14);              /* RESTORE RETURN ADDRESS        */
         IDARST14
*       IF RPLERREG^=0 THEN         /* IF ANY ERROR                  */
         L     @15,UPTRPL(,RWORK1)                                 0721
         CLI   RPLERREG(@15),0                                     0721
         BE    @RF00721                                            0721
*         RETURN CODE(RPLERREG);    /* EXIT PROCEDURE                */
         SLR   @04,@04                                             0722
         IC    @04,RPLERREG(,@15)                                  0722
         LR    @15,@04                                             0722
@EL00015 DS    0H                                                  0722
@EF00015 DS    0H                                                  0722
@ER00015 BR    @14                                                 0722
*     END;                                                         0723
@RF00721 DS    0H                                                  0724
*   IF UPTF1KEY=UPTOKEY THEN        /* IF RECORD WITH OLD KEY REQTED */
@RF00716 TM    UPTF1KEY(RWORK1),B'00000100'                        0724
         BNZ   @RF00724                                            0724
*     AIXKY(1:UPTLNCDE+1)=OLDKEY(1:UPTLNCDE+1);/* MOVE IN OLD KEY    */
         L     @15,UPTRPL(,RWORK1)                                 0725
         L     @15,RPLAREA(,@15)                                   0725
         SLR   @04,@04                                             0725
         IC    @04,UPTLNCDE(,RWORK1)                               0725
         LH    @03,UPTRKP(,RWORK1)                                 0725
         AL    @03,UPTOLD(,RPARM1)                                 0725
         EX    @04,@SM01586                                        0725
*   ELSE                            /* IF RECORD WITH NEW KEY REQTED */
*     AIXKY(1:UPTLNCDE+1)=NEWKEY(1:UPTLNCDE+1);/* MOVE IN NEW KEY    */
         B     @RC00724                                            0726
@RF00724 L     @15,UPTRPL(,RWORK1)                                 0726
         L     @15,RPLAREA(,@15)                                   0726
         SLR   @04,@04                                             0726
         IC    @04,UPTLNCDE(,RWORK1)                               0726
         LH    @03,UPTRKP(,RWORK1)                                 0726
         AL    @03,UPTNEW(,RPARM1)                                 0726
         EX    @04,@SM01588                                        0726
*   RESPECIFY                                                      0727
*     R14 UNRESTRICTED;                                            0727
*   END BLDNEW;                                                    0728
         B     @EL00015                                            0728
         EJECT
*ADDEND:                                                           0729
*                                                                  0729
*/********************************************************************/
*/* ADDS A POINTER TO THE END OF AN AIX RECORD                       */
*/*   INPUT = RWORK2 POINTS TO THE NEW POINTER                       */
*/*   OUTPUT = AIXPC AND UPTRPL RPLRLEN IS INCREMENTED TO REFLECT NEW*/
*/*               POINTER ADDED                                      */
*/********************************************************************/
*                                                                  0729
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0729
ADDEND   DS    0H                                                  0730
*   RESPECIFY                                                      0730
*    (RWORK2,                                                      0730
*     RWORK3,                                                      0730
*     R14) RESTRICTED;                                             0730
*   IF AIXPC=AIXPCMAX THEN          /* IF COUNT AT THE MAXIMUM       */
         L     @15,UPTRPL(,RWORK1)                                 0731
         L     @04,RPLAREA(,@15)                                   0731
         CLC   AIXPC(2,@04),@CH01063                               0731
         BNE   @RF00731                                            0731
*     DO;                                                          0732
*       RPLERREG='08'X;             /* SET LOGICAL ERROR             */
         MVI   RPLERREG(@15),X'08'                                 0733
*       RPLCMPON=RPLUPGER;          /* ERROR DURING UPGRADE          */
         MVI   RPLCMPON(@15),X'04'                                 0734
*       RPLERRCD=RPLNXPTR;          /* MAX PTRS EXCEEDED             */
         MVI   RPLERRCD(@15),X'94'                                 0735
*       RETURN CODE('08'X);         /* EXIT WITH ERROR               */
         LA    @15,8                                               0736
@EL00016 DS    0H                                                  0736
@EF00016 DS    0H                                                  0736
@ER00016 BR    @14                                                 0736
*     END;                                                         0737
*   ELSE                            /* IF OK TO BUMP COUNT           */
*     DO;                                                          0738
@RF00731 DS    0H                                                  0739
*       GEN(IDASVR14);              /* SAVE RETURN ADDRESS           */
         IDASVR14
*       RESPECIFY                                                  0740
*         R14 UNRESTRICTED;                                        0740
*       IF AMDDST=ON THEN           /* IF KEYED DATA SET             */
         L     @04,PLHAMB(,RPLH)                                   0741
         L     @04,AMBDSB(,@04)                                    0741
         TM    AMDDST(@04),B'10000000'                             0741
         BNO   @RF00741                                            0741
*         RWORK2=RPARM1->UPTNEW+AMDRKP;/* POINT TO CURRENT KEY       */
         LH    RWORK2,AMDRKP(,@04)                                 0742
         AL    RWORK2,UPTNEW(,RPARM1)                              0742
*       ELSE                        /* IF ESDS                       */
*         RWORK2=ADDR(PLHCRPL->RPLDDDD);/* POINT TO CURRENT RBA      */
         B     @RC00741                                            0743
@RF00741 L     RWORK2,PLHCRPL(,RPLH)                               0743
         LA    RWORK2,RPLDDDD(,RWORK2)                             0743
*       CALL REMPTR;                /* REMOVE PTR IF ALREADY PRESENT */
@RC00741 BAL   @14,REMPTR                                          0744
*       IF RPLRLEN+AIXPL>RPLBUFL THEN/* IF NEW RCD TOO BIG           */
         L     @04,UPTRPL(,RWORK1)                                 0745
         L     @03,RPLAREA(,@04)                                   0745
         SLR   @00,@00                                             0745
         IC    @00,AIXPL(,@03)                                     0745
         AL    @00,RPLRLEN(,@04)                                   0745
         C     @00,RPLBUFL(,@04)                                   0745
         BNH   @RF00745                                            0745
*         DO;                                                      0746
*           CALL XPANDBFR;          /* EXPAND BUFFER                 */
         BAL   @14,XPANDBFR                                        0747
*           IF RPLERREG^=0 THEN     /* IF FAILED TO EXPAND BUFFER    */
         L     @04,UPTRPL(,RWORK1)                                 0748
         CLI   RPLERREG(@04),0                                     0748
         BE    @RF00748                                            0748
*             DO;                                                  0749
*               GEN(IDARST14);      /* RESTORE RETURN ADDRESS        */
         IDARST14
*               RETURN CODE(RPLERREG);/* EXIT WITH RETURN CODE       */
         L     @04,UPTRPL(,RWORK1)                                 0751
         SLR   @15,@15                                             0751
         IC    @15,RPLERREG(,@04)                                  0751
         BR    @14                                                 0751
*             END;                                                 0752
*         END;                                                     0753
@RF00748 DS    0H                                                  0754
*       RWORK3=ADDR(AIXKY)+AIXKL+AIXPC*AIXPL;/* POINT TO NEW PTR SPOT*/
@RF00745 L     @04,UPTRPL(,RWORK1)                                 0754
         L     @04,RPLAREA(,@04)                                   0754
         LA    RWORK3,AIXKY(,@04)                                  0754
         SLR   @03,@03                                             0754
         IC    @03,AIXKL(,@04)                                     0754
         ALR   RWORK3,@03                                          0754
         LH    @03,AIXPC(,@04)                                     0754
         SLR   @09,@09                                             0754
         IC    @09,AIXPL(,@04)                                     0754
         MR    @08,@03                                             0754
         ALR   RWORK3,@09                                          0754
*       AIXPC=AIXPC+1;              /* BUMP POINTER COUNT            */
         LA    @15,1                                               0755
         ALR   @03,@15                                             0755
         STH   @03,AIXPC(,@04)                                     0755
*       IF AIXPC>ONE THEN           /* TEST IF DUPLICATE KEY @XM08525*/
         CR    @03,@15                                             0756
         BNH   @RF00756                                            0756
*         DO;                       /* CREATED               @XM08525*/
*           RPARM1->UPTBRPL->RPLERRCD=RPLMOKEY;/* SET UNIQUE @XM08525*/
         L     @04,UPTBRPL(,RPARM1)                                0758
         MVI   RPLERRCD(@04),X'08'                                 0758
*           RPARM1->UPTBRPL->RPLCMPON=RPLUPGER;/* CREATED IN @XM08525*/
         MVI   RPLCMPON(@04),X'04'                                 0759
*         END;                      /* BASE RPL FEEDBACK.@XM08525    */
*       RWORK3->AIXPTR(1:AIXPL)=RWORK2->AIXPTR(1:AIXPL);/* MOVE IN 0761
*                                      NEW PTR                       */
@RF00756 L     @04,UPTRPL(,RWORK1)                                 0761
         L     @03,RPLAREA(,@04)                                   0761
         SLR   @15,@15                                             0761
         IC    @15,AIXPL(,@03)                                     0761
         LR    @03,@15                                             0761
         BCTR  @03,0                                               0761
         EX    @03,@SM01590                                        0761
*       RPLRLEN=RPLRLEN+AIXPL;      /* BUMP RECORD LENGTH            */
         AL    @15,RPLRLEN(,@04)                                   0762
         ST    @15,RPLRLEN(,@04)                                   0762
*       GEN(IDARST14);              /* RESTORE RETURN ADDRESS        */
         IDARST14
*       RETURN CODE(0);             /* EXIT NO ERROR                 */
         SLR   @15,@15                                             0764
         BR    @14                                                 0764
*     END;                                                         0765
*   RESPECIFY                                                      0766
*    (RWORK2,                                                      0766
*     RWORK3) UNRESTRICTED;                                        0766
*   END ADDEND;                                                    0767
         EJECT
*REMPTR:                                                           0768
*                                                                  0768
*/********************************************************************/
*/* SCANS AIX RECORD FOR A POINTER AND REMOVES IT IF FOUND           */
*/*   INPUT = RWORK2 POINTS TO THE POINTER TO BE REMOVED             */
*/*   OUTPUT = AIXPC AND RPLRLEN ARE DECREMENTED IF POINTER IS FOUND */
*/*             AND REMOVED                                          */
*/********************************************************************/
*                                                                  0768
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0768
*                                                                  0768
REMPTR   DS    0H                                                  0769
*   /*****************************************************************/
*   /*                                                               */
*   /* RWORK2 POINTS TO THE PTR TO BE REMOVED IF FOUND               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0769
*   RESPECIFY                                                      0769
*    (RWORK2,                                                      0769
*     RWORK3,                                                      0769
*     RWORK4,                                                      0769
*     RWORK5) RESTRICTED;                                          0769
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   RWORK3=ADDR(AIXKY)+AIXKL;       /* POINT TO FIRST PTR            */
         L     @04,UPTRPL(,RWORK1)                                 0771
         L     @04,RPLAREA(,@04)                                   0771
         LA    RWORK3,AIXKY(,@04)                                  0771
         SLR   @03,@03                                             0771
         IC    @03,AIXKL(,@04)                                     0771
         ALR   RWORK3,@03                                          0771
*   DO RWORK4=AIXPC TO 1 BY-1;      /* LOOP THRU ALL PTRS            */
         LH    RWORK4,AIXPC(,@04)                                  0772
         B     @DE00772                                            0772
@DL00772 DS    0H                                                  0773
*     IF RWORK2->AIXPTR(1:AIXPL)=   /* IF INPUT POINTER              */
*         RWORK3->AIXPTR(1:AIXPL) THEN/* MATCHES PTR IN AIX RCD      */
         L     @04,UPTRPL(,RWORK1)                                 0773
         L     @04,RPLAREA(,@04)                                   0773
         SLR   @03,@03                                             0773
         IC    @03,AIXPL(,@04)                                     0773
         LR    @04,@03                                             0773
         BCTR  @04,0                                               0773
         EX    @04,@SC01592                                        0773
         BNE   @RF00773                                            0773
*       DO;                                                        0774
*         RWORK5=RWORK4*AIXPL-AIXPL;/* LOAD BYTES LEFT IN RECORD     */
         LR    @15,RWORK4                                          0775
         MR    @14,@03                                             0775
         SLR   @15,@03                                             0775
         LR    RWORK5,@15                                          0775
*         IF RWORK5^=0 THEN         /* IF ANY BYTES TO MOVE          */
         LTR   RWORK5,RWORK5                                       0776
         BZ    @RF00776                                            0776
*           DO;                                                    0777
*             IF RWORK5<=MAXMOVE THEN/* IF SMALL ENUF FOR MVC        */
         C     RWORK5,@CF01390                                     0778
         BH    @RF00778                                            0778
*               DO;                                                0779
*                 RESPECIFY                                        0780
*                   R14 RESTRICTED;                                0780
*                 R14=RWORK3+AIXPL; /* POINT TO NEXT PTR             */
         ALR   @03,RWORK3                                          0781
         LR    R14,@03                                             0781
*                 RWORK3->CORE(1:RWORK5)=R14->CORE(1:RWORK5);      0782
         LR    @15,RWORK5                                          0782
         BCTR  @15,0                                               0782
         EX    @15,@SM01594                                        0782
*                 RESPECIFY                                        0783
*                   R14 UNRESTRICTED;                              0783
*               END;                /* OVERLAY RECORD                */
*             ELSE                  /* IF MOVE LONG NEEDED           */
*               DO;                                                0785
         B     @RC00778                                            0785
@RF00778 DS    0H                                                  0786
*                 STM(RRPL,RPARM1,RPARM1->UPTR15);/* SAVE REGISTERS  */
         STM   RRPL,RPARM1,UPTR15(RPARM1)                          0786
*                 RWORK2=RWORK3;    /* LOAD TO ADDRESS               */
         LR    RWORK2,RWORK3                                       0787
*                 RWORK4=RWORK3+AIXPL;/* LOAD FROM ADDRESS           */
         L     @04,UPTRPL(,RWORK1)                                 0788
         L     @04,RPLAREA(,@04)                                   0788
         LR    RWORK4,RWORK3                                       0788
         SLR   @03,@03                                             0788
         IC    @03,AIXPL(,@04)                                     0788
         ALR   RWORK4,@03                                          0788
*                 RWORK3=RWORK5;    /* LOAD TO LENGTH                */
         LR    RWORK3,RWORK5                                       0789
*                 MVCL(RWORK2,RWORK4);/* OVERLAY PTR                 */
         MVCL  RWORK2,RWORK4                                       0790
*                 LM(RRPL,RPARM1,RPARM1->UPTR15);/* RESTORE REGISTERS*/
         LM    RRPL,RPARM1,UPTR15(RPARM1)                          0791
*               END;                                               0792
*           END;                                                   0793
@RC00778 DS    0H                                                  0794
*         RPLRLEN=RPLRLEN-AIXPL;    /* REDUCE AIX RECORD LENGTH      */
@RF00776 L     @04,UPTRPL(,RWORK1)                                 0794
         L     @03,RPLAREA(,@04)                                   0794
         L     @00,RPLRLEN(,@04)                                   0794
         SLR   @15,@15                                             0794
         IC    @15,AIXPL(,@03)                                     0794
         SLR   @00,@15                                             0794
         ST    @00,RPLRLEN(,@04)                                   0794
*         AIXPC=AIXPC-1;            /* REDUCE AIX PTR COUNTER        */
         LH    @04,AIXPC(,@03)                                     0795
         BCTR  @04,0                                               0795
         STH   @04,AIXPC(,@03)                                     0795
*       END;                                                       0796
*     ELSE                          /* IF PTRS DO NOT MATCH          */
*       RWORK3=RWORK3+AIXPL;        /* POINT TO NEXT PTR             */
         B     @RC00773                                            0797
@RF00773 L     @04,UPTRPL(,RWORK1)                                 0797
         L     @04,RPLAREA(,@04)                                   0797
         SLR   @03,@03                                             0797
         IC    @03,AIXPL(,@04)                                     0797
         ALR   RWORK3,@03                                          0797
*   END;                                                           0798
@RC00773 BCTR  RWORK4,0                                            0798
@DE00772 LTR   RWORK4,RWORK4                                       0798
         BP    @DL00772                                            0798
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   RETURN CODE(0);                 /* RETURN NO ERROR               */
         SLR   @15,@15                                             0800
@EL00017 DS    0H                                                  0800
@EF00017 DS    0H                                                  0800
@ER00017 BR    @14                                                 0800
*   RESPECIFY                                                      0801
*    (RWORK2,                                                      0801
*     RWORK3,                                                      0801
*     RWORK4,                                                      0801
*     RWORK5) UNRESTRICTED;                                        0801
*   END REMPTR;                                                    0802
         EJECT
*ERRPROC:                                                          0803
*                                                                  0803
*/********************************************************************/
*/* THIS  PROCEDURE DOES INITIAL ERROR PROCESSING.  CALLS BADERROR   */
*/*           IF BACKOUT IS NEEDED.                                  */
*/********************************************************************/
*                                                                  0803
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0803
ERRPROC  DS    0H                                                  0804
*   GEN(IDASVR14);                  /* SAVE RETURN REGISTER          */
         IDASVR14
*   PLHCRPL->RPLCMPON=RPLUPGER;     /* SET COMPONENT CODE            */
         L     @04,PLHCRPL(,RPLH)                                  0805
         MVI   RPLCMPON(@04),X'04'                                 0805
*   IF RPLERREG^='08'X THEN         /* IF NO A LOGICAL ERROR         */
         L     @04,UPTRPL(,RWORK1)                                 0806
         CLI   RPLERREG(@04),8                                     0806
         BE    @RF00806                                            0806
*     CALL BADERROR;                /* DETERMINE RECOVERY            */
         BAL   @14,BADERROR                                        0807
*   ELSE                            /* IF IS A LOGICAL ERROR         */
*     DO;                                                          0808
         B     @RC00806                                            0808
@RF00806 DS    0H                                                  0809
*       IF RPLERRCD^=RPLNOREC THEN  /* IF NOT NO RECORD FOUND        */
         L     @04,UPTRPL(,RWORK1)                                 0809
         CLI   RPLERRCD(@04),16                                    0809
         BE    @RF00809                                            0809
*         DO;                                                      0810
*           IF RPLERRCD^=RPLINBUF THEN/* IF NOT NOT ENUF BUFFER      */
         CLI   RPLERRCD(@04),44                                    0811
         BE    @RF00811                                            0811
*             CALL BADERROR;        /* DETERMINE RECOVERY            */
         BAL   @14,BADERROR                                        0812
*           ELSE                    /* IF IS NOT ENUF BUFFER         */
*             DO;                                                  0813
         B     @RC00811                                            0813
@RF00811 DS    0H                                                  0814
*               RPLERREG=0;         /* ZERO ERROR REG                */
         L     @04,UPTRPL(,RWORK1)                                 0814
         MVI   RPLERREG(@04),X'00'                                 0814
*               IF RPLPLHPT->PLHSRINV=ON THEN/* IF RECORD IS  SPANNED*/
         L     @03,RPLPLHPT(,@04)                                  0815
         TM    PLHSRINV(@03),B'00010000'                           0815
         BNO   @RF00815                                            0815
*                 RPLRLEN=RPLBUFL+RPLBUFL;/* GUESS AT RECORD LENGTH  */
         L     @03,RPLBUFL(,@04)                                   0816
         LR    @00,@03                                             0816
         ALR   @00,@03                                             0816
         ST    @00,RPLRLEN(,@04)                                   0816
*               CALL XPANDBFR;      /* EXPAND THE BUFFER             */
@RF00815 BAL   @14,XPANDBFR                                        0817
*               IF RPLERREG^=0 THEN /* IF UNABLE TO EXPAND BUFFER    */
         L     @04,UPTRPL(,RWORK1)                                 0818
         CLI   RPLERREG(@04),0                                     0818
         BE    @RF00818                                            0818
*                 CALL BADERROR;    /* DETERMINE RECOVERY            */
         BAL   @14,BADERROR                                        0819
*               ELSE                /* IF NO ERROR                   */
*                 DO;                                              0820
         B     @RC00818                                            0820
@RF00818 DS    0H                                                  0821
*                   PLHCRPL->RPLCMPON=0;/* ZERO COMPONENT CODE       */
         L     @04,PLHCRPL(,RPLH)                                  0821
         MVI   RPLCMPON(@04),X'00'                                 0821
*                   UPTF1RTY=ON;    /* WILL RETRY I/O                */
         OI    UPTF1RTY(RWORK1),B'00000010'                        0822
*                   CALL R4INT;     /* START I/O                     */
         BAL   @14,R4INT                                           0823
*                 END;                                             0824
*             END;                                                 0825
*         END;                                                     0826
*       ELSE                        /* IF NO RECORD FOUND            */
*         DO;                                                      0827
         B     @RC00809                                            0827
@RF00809 DS    0H                                                  0828
*           PLHCRPL->RPLCMPON=0;    /* ZERO COMPONENT CODE           */
         L     @04,PLHCRPL(,RPLH)                                  0828
         MVI   RPLCMPON(@04),X'00'                                 0828
*           RPLFDBWD=0;             /* ZERO ERROR CODES              */
         L     @04,UPTRPL(,RWORK1)                                 0829
         SLR   @03,@03                                             0829
         ST    @03,RPLFDBWD(,@04)                                  0829
*           UPTF1NRF=ON;            /* INDICATE NO RECORD FOUND      */
         OI    UPTF1NRF(RWORK1),B'00001000'                        0830
*         END;                                                     0831
*     END;                                                         0832
@RC00809 DS    0H                                                  0833
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
@RC00806 DS    0H                                                  0833
         IDARST14
*   END ERRPROC;                                                   0834
@EL00018 DS    0H                                                  0834
@EF00018 DS    0H                                                  0834
@ER00018 BR    @14                                                 0834
         EJECT
*BADERROR:                                                         0835
*                                                                  0835
*/********************************************************************/
*/* THIS  PROCEDURE INITIATES THE BACKOUT PROCESS.  IF BACKOUT       */
*/*         PROCESSING IS ALREADY IN PROGRESS, THE AIX GETTING THE   */
*/*         ERROR IS DEACTIVATED.                                    */
*/********************************************************************/
*                                                                  0835
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0835
BADERROR DS    0H                                                  0836
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   RESPECIFY                                                      0837
*    (RWORK2,                                                      0837
*     RWORK3) RESTRICTED;                                          0837
*   IF UPTF1BKO=ON THEN             /* IF ALREADY IN BACKOUT         */
         TM    UPTF1BKO(RWORK1),B'10000000'                        0838
         BNO   @RF00838                                            0838
*     DO;                                                          0839
*       UPTF1ATV=OFF;               /* IGNORE THIS AIX               */
         NI    UPTF1ATV(RWORK1),B'10111111'                        0840
*       PLHCRPL->RPLCMPON=ERRTAB(PLHCRPL->RPLCMPON+1);/* INDICATE  0841
*                                      UPGRADE MAY BE BAD            */
         L     @04,PLHCRPL(,RPLH)                                  0841
         SLR   @03,@03                                             0841
         IC    @03,RPLCMPON(,@04)                                  0841
         SLR   @00,@00                                             0841
         IC    @00,ERRTAB(@03)                                     0841
         STC   @00,RPLCMPON(,@04)                                  0841
*     END;                                                         0842
*   ELSE                            /* IF FIRST BAD ERROR            */
*     DO;                                                          0843
         B     @RC00838                                            0843
@RF00838 DS    0H                                                  0844
*       IF RPLERREG='0C'X THEN      /* IF PHYSICAL ERROR             */
         L     @04,UPTRPL(,RWORK1)                                 0844
         CLI   RPLERREG(@04),12                                    0844
         BNE   @RF00844                                            0844
*         DO;                                                      0845
*           PLHCRPL->RPLERREG='0C'X;/* SET PHYSICAL ERROR DETECTED   */
         L     @03,PLHCRPL(,RPLH)                                  0846
         MVI   RPLERREG(@03),X'0C'                                 0846
*           PLHCRPL->RPLCMPON=RPLUPGER;/* OCCURRED DURING UPGRADE    */
         MVI   RPLCMPON(@03),X'04'                                 0847
*           PLHCRPL->RPLERRCD=RPLERRCD;/* COPY ERROR CODE            */
         IC    @00,RPLERRCD(,@04)                                  0848
         STC   @00,RPLERRCD(,@03)                                  0848
*           UPTF1PHY=ON;            /* INDICATE PLYSICAL THIS AIX    */
         OI    UPTF1PHY(RWORK1),B'00100000'                        0849
*         END;                                                     0850
*       ELSE                        /* IF NOT PHYSICAL ERROR         */
*         DO;                                                      0851
         B     @RC00844                                            0851
@RF00844 DS    0H                                                  0852
*           UPTF1LOG=ON;            /* INDICATE LOGICAL ERROR        */
         OI    UPTF1LOG(RWORK1),B'01000000'                        0852
*           PLHCRPL->RPLERREG='08'X;/* SET ERROR REGISTER            */
         L     @04,PLHCRPL(,RPLH)                                  0853
         MVI   RPLERREG(@04),X'08'                                 0853
*           PLHCRPL->RPLERRCD=RPLERRCD;/* COPY ERROR CODE            */
         L     @03,UPTRPL(,RWORK1)                                 0854
         IC    @00,RPLERRCD(,@03)                                  0854
         STC   @00,RPLERRCD(,@04)                                  0854
*         END;                                                     0855
*       RWORK2=RPARM1;              /* LOAD POINTER TO UPT           */
@RC00844 LR    RWORK2,RPARM1                                       0856
*       DO RWORK3=RWORK2->UPTNOENT TO 1 BY-1;/* LOOP THRU ALL UPT  0857
*                                      ENTRIES                       */
         SLR   RWORK3,RWORK3                                       0857
         IC    RWORK3,UPTNOENT(,RWORK2)                            0857
         B     @DE00857                                            0857
@DL00857 DS    0H                                                  0858
*         IF RWORK2->UPTF1UPG=ON THEN/* IF AIX IN THIS UPGRADE       */
         TM    UPTF1UPG(RWORK2),B'00000001'                        0858
         BNO   @RF00858                                            0858
*           DO;                                                    0859
*             IF RPLERREG='0C'X THEN/* IF PHYSICAL ERROR             */
         L     @04,UPTRPL(,RWORK1)                                 0860
         CLI   RPLERREG(@04),12                                    0860
         BNE   @RF00860                                            0860
*               RWORK2->UPTF1ATV=OFF;/* NO BACKOUT IS POSSIBLE       */
         NI    UPTF1ATV(RWORK2),B'10111111'                        0861
*             ELSE                  /* IF LOGICAL ERROR              */
*               DO;                                                0862
         B     @RC00860                                            0862
@RF00860 DS    0H                                                  0863
*                 RWORK2->UPTPASS=DPASS8;/* SET FOR RECOVERY PASS    */
         MVI   UPTPASS(RWORK2),X'08'                               0863
*                 RWORK2->UPTF1ATV=ON;/* AGAIN ACTIVE                */
         OI    UPTF1ATV(RWORK2),B'01000000'                        0864
*                 RWORK2->UPTF1BKO=ON;/* SET BACKOUT STARTED         */
         OI    UPTF1BKO(RWORK2),B'10000000'                        0865
*               END;                                               0866
*           END;                                                   0867
@RC00860 DS    0H                                                  0868
*         RWORK2=RWORK2+LENGTH(UPTAXENT);/* POINT TO NEXT ENTRY      */
@RF00858 AL    RWORK2,@CF00229                                     0868
*       END;                                                       0869
         BCTR  RWORK3,0                                            0869
@DE00857 LTR   RWORK3,RWORK3                                       0869
         BP    @DL00857                                            0869
*       RPLFDBWD=0;                 /* ZERO ERROR INDIC              */
         L     @04,UPTRPL(,RWORK1)                                 0870
         SLR   @03,@03                                             0870
         ST    @03,RPLFDBWD(,@04)                                  0870
*     END;                                                         0871
*   RESPECIFY                                                      0872
*    (RWORK2,                                                      0872
*     RWORK3) UNRESTRICTED;                                        0872
@RC00838 DS    0H                                                  0873
*   GEN(IDARST14);                  /* RESTORE RETURN REGISTER       */
         IDARST14
*   END BADERROR;                                                  0874
@EL00019 DS    0H                                                  0874
@EF00019 DS    0H                                                  0874
@ER00019 BR    @14                                                 0874
         EJECT
*XPANDBFR:                                                         0875
*                                                                  0875
*/********************************************************************/
*/* EXPANDS THE UPTRPL RPLAREA                                       */
*/********************************************************************/
*                                                                  0875
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0875
XPANDBFR DS    0H                                                  0876
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   RESPECIFY                                                      0877
*    (RWORK2,                                                      0877
*     RWORK3,                                                      0877
*     RWORK4,                                                      0877
*     RWORK5) RESTRICTED;                                          0877
*   RWORK4=RPLAREA;                 /* LOAD ADDRESS OLD AREA         */
         L     @04,UPTRPL(,RWORK1)                                 0878
         L     RWORK4,RPLAREA(,@04)                                0878
*   RWORK5=RPLBUFL;                 /* LOAD OLD AREA LENGTH          */
         L     RWORK5,RPLBUFL(,@04)                                0879
*   STM(RRPL,RPARM1,RPARM1->UPTR15);/* SAVE REGISTERS                */
         STM   RRPL,RPARM1,UPTR15(RPARM1)                          0880
*   IF RWORK5^=0 THEN               /* IF RPLAREA EXISTS             */
         LTR   RWORK5,RWORK5                                       0881
         BZ    @RF00881                                            0881
*     DO;                                                          0882
*       IF AMDDST=ON THEN           /* IF BASE IS KEYED DATA SET     */
         L     @04,PLHAMB(,RPLH)                                   0883
         L     @04,AMBDSB(,@04)                                    0883
         TM    AMDDST(@04),B'10000000'                             0883
         BNO   @RF00883                                            0883
*         RWORK2=AMDKEYLN;          /* LOAD PTR LENGTH               */
         LH    RWORK2,AMDKEYLN(,@04)                               0884
*       ELSE                        /* IF BASE IS ESDS               */
*         RWORK2=LENGTH(RPLDDDD);   /* PTR LENGTH IS 4               */
         B     @RC00883                                            0885
@RF00883 LA    RWORK2,4                                            0885
*       RWORK2=RWORK2+RPLRLEN;      /* LOAD NEW BUFFER LENGTH        */
@RC00883 L     @04,UPTRPL(,RWORK1)                                 0886
         AL    RWORK2,RPLRLEN(,@04)                                0886
*     END;                                                         0887
*   ELSE                            /* RPLAREA DOES NOT EXIST        */
*     RWORK2=UPTBG;                 /* USE INITIAL VALUE             */
         B     @RC00881                                            0888
@RF00881 LH    RWORK2,UPTBG(,RWORK1)                               0888
*   RPLBUFL=RWORK2;                 /* SAVE BYTES NEEDED             */
@RC00881 L     @04,UPTRPL(,RWORK1)                                 0889
         ST    RWORK2,RPLBUFL(,@04)                                0889
*   RWORK1=RWORK2;                  /* COPY BYTES NEEDED             */
         LR    RWORK1,RWORK2                                       0890
*   RESPECIFY                                                      0891
*    (RAMB,                                                        0891
*     R15) RESTRICTED;                                             0891
*   RAMB=ADDR(IDAAMB);              /* RESTORE POINTER TO AMB        */
         L     RAMB,PLHAMB(,RPLH)                                  0892
*I05:                                                              0893
*   DO;                             /* IDACALL(IDAGETWS)             */
I05      DS    0H                                                  0894
*     CALL IDAGETWS;                /* EXIT TO IDAGETWS              */
         L     @15,@CV01385                                        0894
         BALR  @14,@15                                             0894
*     GEN(BALR @11,0);              /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*     GEN(USING *,@11);             /* ESTABLISH ADDRESSING          */
         USING *,@11
*     GEN(USING *+4095,R10);        /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*     GEN(LA    R10,4095(@11));     /* LOAD SECOND BASE              */
         LA    R10,4095(@11)
*     GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE          */
         L     R10,=A(@PSTART+4095)
*     GEN(USING @PSTART+4095,R10);  /* ESTABLISH SECOND BASE         */
         USING @PSTART+4095,R10
*     GEN(L     @11,=A(@PSTART));   /* RELOAD BASE                   */
         L     @11,=A(@PSTART)
*     GEN(USING @PSTART,@11);       /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*   END I05;                        /* GET NEW BUFFER                */
*   RESPECIFY                                                      0904
*    (R14,                                                         0904
*     R15) RESTRICTED;              /*                       @XA16126*/
*   RPARM1=BIBUPT;                  /* RELOAD PTR TO UPT             */
         L     @04,AMBLBIB(,RPARM1)                                0905
         L     @04,BIBUPT(,@04)                                    0905
         LR    RPARM1,@04                                          0905
*   RESPECIFY                                                      0906
*     RAMB UNRESTRICTED;                                           0906
*   IF R15^=0 THEN                  /* IF ANY ERROR                  */
         LTR   R15,R15                                             0907
         BZ    @RF00907                                            0907
*     DO;                                                          0908
*       LM(RRPL,RPARM1,RPARM1->UPTR15);/* RESTORE REGISTERS          */
         LM    RRPL,RPARM1,UPTR15(RPARM1)                          0909
*       RPLERREG='08'X;             /* SET LOGICALL ERROR            */
         L     @04,UPTRPL(,RWORK1)                                 0910
         MVI   RPLERREG(@04),X'08'                                 0910
*       RPLCMPON=RPLUPGER;          /* ERROR DURING UPGRADE          */
         MVI   RPLCMPON(@04),X'04'                                 0911
*       RPLERRCD=RPLNOVRT;          /* NO MO CORE                    */
         MVI   RPLERRCD(@04),X'28'                                 0912
*       GEN(IDARST14);              /* RESTORE RETURN ADDR   @XA16126*/
         IDARST14
*       RETURN CODE(R15);           /* EXIT ROUTINE                  */
@EL00020 DS    0H                                                  0914
@EF00020 DS    0H                                                  0914
@ER00020 BR    @14                                                 0914
*     END;                                                         0915
*   RESPECIFY                                                      0916
*     R15 UNRESTRICTED;                                            0916
@RF00907 DS    0H                                                  0917
*   RESPECIFY                                                      0917
*     R14 RESTRICTED;                                              0917
*   R14=RWORK1;                     /* SAVE BUFFER ADDRESS IF ANY    */
         LR    R14,RWORK1                                          0918
*   LM(RRPL,RWORK5,RPARM1->UPTR15); /* RESTORE REGISTERS             */
         LM    RRPL,RWORK5,UPTR15(RPARM1)                          0919
*   RWORK2=R14;                     /* COPY RESULT ADDR              */
         LR    RWORK2,R14                                          0920
*   RESPECIFY                                                      0921
*     R14 UNRESTRICTED;                                            0921
*   RPLAREA=RWORK2;                 /* SAVE NEW AREA ADDR            */
         L     @04,UPTRPL(,RWORK1)                                 0922
         ST    RWORK2,RPLAREA(,@04)                                0922
*   IF RWORK5^=0 THEN               /* IF RPLAREA ORIGINALLY EXISTED */
         LTR   RWORK5,RWORK5                                       0923
         BZ    @RF00923                                            0923
*     DO;                                                          0924
*       RWORK3=RWORK5;              /* COPY OLD AREA LENGTH          */
         LR    RWORK3,RWORK5                                       0925
*       MVCL(RWORK2,RWORK4);        /* MOVE OLD AREA INTO NEW AREA   */
         MVCL  RWORK2,RWORK4                                       0926
*       LM(RRPL,RWORK5,RPARM1->UPTR15);/* RESTORE REGISTERS          */
         LM    RRPL,RWORK5,UPTR15(RPARM1)                          0927
*       RWORK1=RWORK4;              /* POINT TO START OF OLD AREA    */
         LR    RWORK1,RWORK4                                       0928
*       RWORK2=RWORK5;              /* COPY LENGTH OF OLD AREA       */
         LR    RWORK2,RWORK5                                       0929
*       RESPECIFY                                                  0930
*         RAMB RESTRICTED;                                         0930
*       RAMB=ADDR(IDAAMB);          /* RESTORE POINTER TO AMB        */
         L     RAMB,PLHAMB(,RPLH)                                  0931
*I06:                                                              0932
*       DO;                         /* IDACALL(IDARELWS)             */
I06      DS    0H                                                  0933
*         CALL IDARELWS;            /* EXIT TO IDARELWS              */
         L     @15,@CV01386                                        0933
         BALR  @14,@15                                             0933
*         GEN(BALR @11,0);          /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*         GEN(USING *,@11);         /* ESTABLISH ADDRESSING          */
         USING *,@11
*         GEN(USING *+4095,R10);    /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*         GEN(LA    R10,4095(@11)); /* LOAD SECOND BASE              */
         LA    R10,4095(@11)
*         GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE      */
         L     R10,=A(@PSTART+4095)
*         GEN(USING @PSTART+4095,R10);/* ESTABLISH SECOND BASE       */
         USING @PSTART+4095,R10
*         GEN(L     @11,=A(@PSTART));/* RELOAD BASE                  */
         L     @11,=A(@PSTART)
*         GEN(USING @PSTART,@11);   /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*       END I06;                    /* RELEASE BUFFER                */
*       RESPECIFY                                                  0943
*         RAMB UNRESTRICTED;                                       0943
*     END;                                                         0944
*   LM(RRPL,RPARM1,RPARM1->UPTR15); /* RESTORE REGISTERS             */
@RF00923 LM    RRPL,RPARM1,UPTR15(RPARM1)                          0945
*   RESPECIFY                                                      0946
*    (RWORK2,                                                      0946
*     RWORK3,                                                      0946
*     RWORK4,                                                      0946
*     RWORK5) UNRESTRICTED;                                        0946
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END XPANDBFR;                                                  0948
         B     @EL00020                                            0948
         EJECT
*   RESPECIFY                                                      0949
*     RAMB RESTRICTED;                                             0949
*   RESPECIFY                                                      0950
*     IDAAMB BASED(RAMB);                                          0950
*R4INT:                                                            0951
*                                                                  0951
*/********************************************************************/
*/* THIS  PROCEDURE INTERFACES WITH IDA019R4 TO DO THE I/O AGAINST   */
*/*           THE AIX                                                */
*/********************************************************************/
*                                                                  0951
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0951
R4INT    DS    0H                                                  0952
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   STM(R15,RPARM1,RPARM1->UPTR15); /* SAVE REGISTERS 15 - 12        */
         STM   R15,RPARM1,UPTR15(RPARM1)                           0953
*   RRPL=ADDR(IFGRPL);              /* POINT TO UPGRADE RPL          */
         L     RRPL,UPTRPL(,RWORK1)                                0954
*   RESPECIFY                                                      0955
*     IFGRPL BASED(RRPL);                                          0955
*   RPARM1=ACBAMBL;                 /* LOAD POINTER TO AMBL          */
         L     @04,RPLDACB(,RRPL)                                  0956
         L     RPARM1,ACBAMBL(,@04)                                0956
*   RAMB=RPARM1->AMBLDTA;           /* POINT TO DATA AMB             */
         L     RAMB,AMBLDTA(,RPARM1)                               0957
*   RPLH=RPLPLHPT;                  /* POINT TO PLH                  */
         L     RPLH,RPLPLHPT(,RRPL)                                0958
*   RPLFDBWD=0;                     /* ZERO FEEDBACK FIELD           */
         SLR   @04,@04                                             0959
         ST    @04,RPLFDBWD(,RRPL)                                 0959
*   RPLECB=0;                       /* ZERO ECB                      */
         ST    @04,RPLECB(,RRPL)                                   0960
*   BIBUPT->UPTLSA=R13;             /* SAVE CURENT SA PTR            */
         L     @04,AMBLBIB(,RPARM1)                                0961
         L     @04,BIBUPT(,@04)                                    0961
         ST    R13,UPTLSA(,@04)                                    0961
*   R13=ADDR(BIBUPT->UPTSA);        /* PT TO UPT SA SO THAT IDAWAIT
*                                      WILL RETURN TO IDA019RU       */
         LA    R13,UPTSA(,@04)                                     0962
*   BIBUPT->UPTR14=ADDR(AFTR4);     /* SET IDAWAIT RETURN POINT      */
         LA    @00,AFTR4                                           0963
         ST    @00,UPTR14(,@04)                                    0963
*   R14=ADDR(COMPIO);               /* SET ADDR OF ROUTINE TO RECIEVE
*                                      CONTROL WHEN I/O IS COMPLETE  */
         LA    R14,COMPIO                                          0964
*   RESPECIFY                                                      0965
*     R15 RESTRICTED;                                              0965
*   R15=ADDR(IDA019R4);             /* POINT TO IDA019R4             */
         L     R15,@CV01395                                        0966
*   GOTO BR15ROUT;                  /* EXIT TO IDA019R4              */
         BR    R15                                                 0967
*   RESPECIFY                                                      0968
*     R15 UNRESTRICTED;                                            0968
*AFTR4:                                                            0969
*   R13=RPARM1->UPTLSA;             /* RESTORE CURRENT SA PTR        */
AFTR4    L     R13,UPTLSA(,RPARM1)                                 0969
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   RETURN;                         /* EXIT PROCEDURE                */
@EL00021 DS    0H                                                  0971
@EF00021 DS    0H                                                  0971
@ER00021 BR    @14                                                 0971
*COMPIO:                                                           0972
*   GEN;                                                           0972
COMPIO   DS    0H                                                  0972
*                                   /* RESTORE BASE REGISTER         */
    BALR  @11,0                     LOAD ADDR OF REENTRY
    USING *,@11                     ESTABLISH ADDRESSING
    USING *+4095,@10                ESTABLISH SECOND BASE
    LA  @10,4095(@11)               LOAD SECOND BASE
    L @10,=A(@PSTART+4095)          RELOAD SECOND BASE
    USING @PSTART+4095,@10          ESTABLIST SECOND BASE
    L     @11,=A(@PSTART)           RELOAD BASE ADDRESS
    USING @PSTART,@11               REESTABLISH BASE
*   RPARM1=RPLDACB->ACBAMBL->AMBLBIB->BIBUPT;/* POINT TO UPT         */
         L     @04,RPLDACB(,RRPL)                                  0973
         L     @04,ACBAMBL(,@04)                                   0973
         L     @04,AMBLBIB(,@04)                                   0973
         L     RPARM1,BIBUPT(,@04)                                 0973
*   IF RPARM1->UPTBRPL->RPLASY=ON THEN/* IF USER IS ASYNCH           */
         L     @04,UPTBRPL(,RPARM1)                                0974
         TM    RPLASY(@04),B'00001000'                             0974
         BNO   @RF00974                                            0974
*     DO;                                                          0975
*       RPLPOST=ON;                 /* SET POST BIT                  */
         OI    RPLPOST(RRPL),B'01000000'                           0976
*       TS(RPARM1->UPTSARES);       /* TRY TO GET CONTROL            */
         TS    UPTSARES(RPARM1)                                    0977
*       GEN(BZ CONTINUE);           /* BR IF HAVE CONTROL            */
         BZ CONTINUE
*     END;                                                         0979
*   ELSE                            /* IF USER IS SYNCH              */
*     DO;                                                          0980
         B     @RC00974                                            0980
@RF00974 DS    0H                                                  0981
*       RWORK1=RRPL;                /* SAVE POINTER TO RPL           */
         LR    RWORK1,RRPL                                         0981
*       R1=ADDR(RPLECB);            /* PT TO ECB IN UPGRADE RPL      */
         LA    @04,RPLECB(,RRPL)                                   0982
         LR    R1,@04                                              0982
*       GEN(POST (1));              /* POST UPGRADE ECB              */
         POST (1)
*       RRPL=RWORK1;                /* RESTORE PTR TO RPL            */
         LR    RRPL,RWORK1                                         0984
*     END;                                                         0985
*   LM(R14,RPARM1,SSAR14);          /* RESTORE REGISTERS             */
@RC00974 LM    R14,RPARM1,SSAR14(R13)                              0986
*   GEN(BR R14);                    /* RETURN TO CALLER              */
         BR R14
*   END R4INT;                                                     0988
         B     @EL00021                                            0988
*   RESPECIFY                                                      0989
*     IDAAMB BASED(PLHAMB);                                        0989
*   RESPECIFY                                                      0990
*     RAMB UNRESTRICTED;                                           0990
         EJECT
*GETPLH:                                                           0991
*                                                                  0991
*/********************************************************************/
*/* THIS  PROCEDURE OBTAINS A PLH TO BE USED WITH AIX PROCESSING     */
*/********************************************************************/
*                                                                  0991
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0991
GETPLH   DS    0H                                                  0992
*   RESPECIFY                                                      0992
*     RWORK5 RESTRICTED;                                           0992
*   RESPECIFY                                                      0993
*     IFGRPL BASED(RRPL);                                          0993
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   STM(RRPL,RPARM1,RPARM1->UPTR15);/* SAVE REGISTERS                */
         STM   RRPL,RPARM1,UPTR15(RPARM1)                          0995
*   RESPECIFY                                                      0996
*     RAMB RESTRICTED;                                             0996
*   RAMB=RWORK5;                    /* POINT TO BASE DATA AMB        */
         LR    RAMB,RWORK5                                         0997
*   RRPL=UPTRPL;                    /* POINT TO UPGRADE RPL          */
         L     RRPL,UPTRPL(,RWORK1)                                0998
*   CALL XGPLH;                     /* GET UPGRADE PLH               */
         BAL   @14,XGPLH                                           0999
*   RESPECIFY                                                      1000
*     RAMB UNRESTRICTED;                                           1000
*   IF RPLH=0 THEN                  /* IF NO PLH IS AVAILABLE        */
         SLR   @08,@08                                             1001
         CR    RPLH,@08                                            1001
         BNE   @RF01001                                            1001
*     DO;                                                          1002
*       RPLPLHPT=0;                 /* LAST PLH CANNOT BE USED       */
         ST    @08,RPLPLHPT(,RRPL)                                 1003
*       RRPL=RPARM1->UPTBRPL;       /* RESTORE BASE RPL PTR          */
         L     RRPL,UPTBRPL(,RPARM1)                               1004
*       RPLERREG='08'X;             /* SET LOGICAL ERROR             */
         MVI   RPLERREG(RRPL),X'08'                                1005
*       RPLCMPON=RPLBASER;          /* DURING BASE PROCESSING        */
         MVI   RPLCMPON(RRPL),X'00'                                1006
*       RPLERRCD=RPLNOPLH;          /* ERROR IS NO PLH               */
         MVI   RPLERRCD(RRPL),X'40'                                1007
*     END;                                                         1008
*   RPARM1=RPLDACB->ACBAMBL->AMBLBIB->BIBUPT;/* POINT TO UPT @ZA04706*/
@RF01001 L     @08,RPLDACB(,RRPL)                                  1009
         L     @08,ACBAMBL(,@08)                                   1009
         L     @08,AMBLBIB(,@08)                                   1009
         L     RPARM1,BIBUPT(,@08)                                 1009
*   LM(RRPL,RPARM1,RPARM1->UPTR15); /* RESTORE REGISTERS             */
         LM    RRPL,RPARM1,UPTR15(RPARM1)                          1010
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   RETURN CODE(RPLERREG);          /* EXIT TO CALLER                */
         SLR   @15,@15                                             1012
         IC    @15,RPLERREG(,RRPL)                                 1012
@EL00022 DS    0H                                                  1012
@EF00022 DS    0H                                                  1012
@ER00022 BR    @14                                                 1012
*   RESPECIFY                                                      1013
*     RWORK5 UNRESTRICTED;                                         1013
*   END GETPLH;                                                    1014
         EJECT
*RELPLH:                                                           1015
*                                                                  1015
*/********************************************************************/
*/* THIS  PROCEDURE RELEASES THE PLH USED TO PROCESS THE AIX         */
*/********************************************************************/
*                                                                  1015
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               1015
RELPLH   DS    0H                                                  1016
*   GEN(IDASVR14);                  /* SAVE RETURN ADDRESS           */
         IDASVR14
*   STM(RRPL,RPARM1,RPARM1->UPTR15);/* SAVE REGISTERS                */
         STM   RRPL,RPARM1,UPTR15(RPARM1)                          1017
*   RRPL=UPTRPL;                    /* POINT TO UPGRADE RPL          */
         L     RRPL,UPTRPL(,RWORK1)                                1018
*   RPLH=RPLPLHPT;                  /* LOAD ADDR PLH TO RELEASE      */
         L     RPLH,RPLPLHPT(,RRPL)                                1019
*   RPARM1=ACBAMBL;                 /* POINT TO UPGRADE AMBL         */
         L     @04,RPLDACB(,RRPL)                                  1020
         L     RPARM1,ACBAMBL(,@04)                                1020
*   RESPECIFY                                                      1021
*     RAMB RESTRICTED;                                             1021
*   RAMB=RPARM1->AMBLDTA;           /* LOAD ADDR OF AMB              */
         L     RAMB,AMBLDTA(,RPARM1)                               1022
*   RESPECIFY                                                      1023
*     RBUFC RESTRICTED;             /*                       @ZA24684*/
*   RBUFC=0;                        /* ZERO REG TO SUBTRACT ALL      */
         SLR   RBUFC,RBUFC                                         1024
*I07:                                                              1025
*   DO;                             /* IDACALL(IDASBF)               */
I07      DS    0H                                                  1026
*     CALL IDASBF;                  /* EXIT TO IDASBF                */
         L     @15,@CV01387                                        1026
         BALR  @14,@15                                             1026
*     GEN(BALR @11,0);              /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*     GEN(USING *,@11);             /* ESTABLISH ADDRESSING          */
         USING *,@11
*     GEN(USING *+4095,R10);        /* ESTABLISH SECOND BASE         */
         USING *+4095,R10
*     GEN(LA    R10,4095(@11));     /* LOAD SECOND BASE              */
         LA    R10,4095(@11)
*     GEN(L     R10,=A(@PSTART+4095));/* RELOAD SECOND BASE          */
         L     R10,=A(@PSTART+4095)
*     GEN(USING @PSTART+4095,R10);  /* ESTABLISH SECOND BASE         */
         USING @PSTART+4095,R10
*     GEN(L     @11,=A(@PSTART));   /* RELOAD BASE                   */
         L     @11,=A(@PSTART)
*     GEN(USING @PSTART,@11);       /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*   END I07;                        /* SUBTRACT BUFFERS              */
*   PLHFLG1=0;                      /* ZERO FLAG BYTE 1              */
         MVI   PLHFLG1(RPLH),X'00'                                 1036
*   PLHFLG2=0;                      /* ZERO FLAG BYTE 2              */
         MVI   PLHFLG2(RPLH),X'00'                                 1037
*   PLHFLG3=0;                      /* ZERO FLAG BYTE 3              */
         MVI   PLHFLG3(RPLH),X'00'                                 1038
*   PLHEFLGS=0;                     /* ZERO EXCEPTION FLAGS          */
         SLR   @15,@15                                             1039
         STH   @15,PLHEFLGS(,RPLH)                                 1039
*   PLHINVAL=ON;                    /* RESET INVALID FLAG            */
         OI    PLHINVAL(RPLH),B'00000010'                          1040
*   PLHAVL=0;                       /* MAKE PLH AVAILABLE            */
         MVI   PLHAVL(RPLH),X'00'                                  1041
*   PLHARDB=0;                      /* ZERO ARDB POINTER     @XA16126*/
         ST    @15,PLHARDB(,RPLH)                                  1042
*   RAMB->AMBUPLH->PLHDRCUR=RAMB->AMBUPLH->PLHDRCUR-1;/* REDUCE    1043
*                                      CURRENT PLH COUNT             */
         L     @15,AMBUPLH(,RAMB)                                  1043
         LH    @00,PLHDRCUR(,@15)                                  1043
         BCTR  @00,0                                               1043
         STH   @00,PLHDRCUR(,@15)                                  1043
*   RESPECIFY                                                      1044
*     RAMB UNRESTRICTED;                                           1044
*   RPARM1=RPARM1->AMBLBIB->BIBUPT; /* RELOAD POINTER TO UPT         */
         L     @03,AMBLBIB(,RPARM1)                                1045
         L     @03,BIBUPT(,@03)                                    1045
         LR    RPARM1,@03                                          1045
*   LM(RRPL,RPARM1,RPARM1->UPTR15); /* RESTORE REGISTERS             */
         LM    RRPL,RPARM1,UPTR15(RPARM1)                          1046
*   GEN(IDARST14);                  /* RESTORE RETURN ADDRESS        */
         IDARST14
*   END RELPLH;                                                    1048
@EL00023 DS    0H                                                  1048
@EF00023 DS    0H                                                  1048
@ER00023 BR    @14                                                 1048
         EJECT
*IDAXGPLH:                                                         1049
*                                                                  1049
*/********************************************************************/
*/* THIS  PROCEDURE GETS A PLH FROM THE PLH POOL                     */
*/*   INPUT = POINTER TO RPL IN RRPL                                 */
*/*   OUTPUT = RPLH HAS POINTER TO PLH IF ONE AVAILABLE              */
*/*            RPLH HAS ZERO IF NONE AVAILABLE                       */
*/********************************************************************/
*                                                                  1049
*   ENTRY;                          /* EXTERNAL ENTRY                */
@EP01049 DS    0H                                                  1050
*XGPLH:                                                            1050
*   RESPECIFY                                                      1050
*    (RWORK1,                                                      1050
*     RWORK2,                                                      1050
*     RWORK3,                                                      1050
*     RWORK4,                                                      1050
*     RWORK5,                                                      1050
*     R14) RESTRICTED;                                             1050
XGPLH    DS    0H                                                  1051
*   RESPECIFY                                                      1051
*     RAMB RESTRICTED;                                             1051
*   RESPECIFY                                                      1052
*     IDAAMB BASED(RAMB);                                          1052
*                                                                  1052
*   /*****************************************************************/
*   /*                                                               */
*   /* TRY TO GET LAST PLACEHOLDER USED                              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1053
*   RPLH=RPLPLHPT;                  /* LOAD PTR LAST PLH USED        */
         L     RPLH,RPLPLHPT(,RRPL)                                1053
*   IF RPLH^=0 THEN                 /* IF LAST PLH EXISTS            */
         LTR   RPLH,RPLH                                           1054
         BZ    @RF01054                                            1054
*     DO;                                                          1055
*       IF PLHMRPL=RRPL THEN        /* IF PLH STILL POINTS BACK      */
         C     RRPL,PLHMRPL(,RPLH)                                 1056
         BNE   @RF01056                                            1056
*         DO;                                                      1057
*           TS(PLHAVL);             /* TRY TO REGAIN PLH             */
         TS    PLHAVL(RPLH)                                        1058
*           BC(8,REPLH);            /* BRANCH IF PLH REGAINED        */
         BC    8,REPLH                                             1059
*         END;                                                     1060
*     END;                                                         1061
@RF01056 DS    0H                                                  1062
*FNDPLH:                                                           1062
*                                                                  1062
*   /*****************************************************************/
*   /*                                                               */
*   /* SEARCH FOR A NEVER-ASSIGNED PLACEHOLDER                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1062
*   IF AMBPH^=0 THEN                /* IF AMBPH POINTER PRESENT      */
@RF01054 DS    0H                                                  1062
FNDPLH   L     @15,AMBPH(,RAMB)                                    1062
         LTR   @15,@15                                             1062
         BZ    @RF01062                                            1062
*     RPLH=AMBPH;                   /* POINT TO PLH HEADER           */
         LR    RPLH,@15                                            1063
*   ELSE                            /* AMBUPLH PTR MUST BE PRESENT   */
*     RPLH=AMBUPLH;                 /* POINT TO PLH HEADER           */
         B     @RC01062                                            1064
@RF01062 L     RPLH,AMBUPLH(,RAMB)                                 1064
*   RPLH=RPLH+LENGTH(IDAPLHDR);     /* POINT TO FIRST PLH            */
@RC01062 AL    RPLH,@CF00088                                       1065
*   DO UNTIL RPLH=0;                /* LOOP THRU PLH CHAIN           */
@DL01066 DS    0H                                                  1067
*     IF PLHMRPL=0 THEN             /* IF PLH NEVER ASSIGNED         */
         L     @15,PLHMRPL(,RPLH)                                  1067
         LTR   @15,@15                                             1067
         BNZ   @RF01067                                            1067
*       DO;                                                        1068
*         TS(PLHAVL);               /* TRY TO GET PLH                */
         TS    PLHAVL(RPLH)                                        1069
*         BC(8,REPLH);              /* BRANCH IF PLH GOTTEN          */
         BC    8,REPLH                                             1070
*       END;                                                       1071
*     RPLH=PLHCHAIN;                /* POINT TO NEXT PLH             */
@RF01067 L     RPLH,PLHCHAIN(,RPLH)                                1072
*   END;                                                           1073
*                                                                  1073
@DE01066 SLR   @15,@15                                             1073
         CR    RPLH,@15                                            1073
         BNE   @DL01066                                            1073
*   /*****************************************************************/
*   /*                                                               */
*   /* TRY TO FIND FIRST PLACEHOLDER AVAILABLE                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1074
*   IF AMBPH^=0 THEN                /* IF AMBPH POINTER PRESENT      */
         L     @00,AMBPH(,RAMB)                                    1074
         CR    @00,@15                                             1074
         BE    @RF01074                                            1074
*     RPLH=AMBPH;                   /* POINT TO PLH HEADER           */
         LR    RPLH,@00                                            1075
*   ELSE                            /* AMBUPLH PTR MUST BE PRESENT   */
*     RPLH=AMBUPLH;                 /* POINT TO PLH HEADER           */
         B     @RC01074                                            1076
@RF01074 L     RPLH,AMBUPLH(,RAMB)                                 1076
*   RPLH=RPLH+LENGTH(IDAPLHDR);     /* POINT TO FIRST PLH            */
@RC01074 AL    RPLH,@CF00088                                       1077
*   DO UNTIL RPLH=0;                /* LOOP THRU PLH CHAIN           */
@DL01078 DS    0H                                                  1079
*     TS(PLHAVL);                   /* TRY TO GET PLH                */
         TS    PLHAVL(RPLH)                                        1079
*     BC(8,REPLH);                  /* BRANCH IF PLH GOTTEN          */
         BC    8,REPLH                                             1080
*     RPLH=PLHCHAIN;                /* POINT TO NEXT PLH             */
         L     RPLH,PLHCHAIN(,RPLH)                                1081
*   END;                                                           1082
@DE01078 LTR   RPLH,RPLH                                           1082
         BNZ   @DL01078                                            1082
*REPLH:                                                            1083
*   IF RPLH^=0 THEN                 /* IF A PLH WAS FOUND            */
REPLH    LTR   RPLH,RPLH                                           1083
         BZ    @RF01083                                            1083
*     DO;                                                          1084
*       RPLPLHPT=RPLH;              /* POINT RPL TO PLH              */
         ST    RPLH,RPLPLHPT(,RRPL)                                1085
*       PLHMRPL=RRPL;               /* POINT MASTER RPL TO RPL       */
         ST    RRPL,PLHMRPL(,RPLH)                                 1086
*       PLHCRPL=RRPL;               /* POINT CURRENT RPL TO RPL      */
         ST    RRPL,PLHCRPL(,RPLH)                                 1087
*       PLHRETO=PLHRETOS;           /* RESET PDL OFFSET      @ZA16007*/
         LH    @15,PLHRETOS(,RPLH)                                 1088
         STH   @15,PLHRETO(,RPLH)                                  1088
*       RWORK3=ADDR(IFGACB);        /* LOAD PTR TO ACB       @ZA14829*/
         L     RWORK3,RPLDACB(,RRPL)                               1089
*       GEN(LA RWORK3,0(RWORK3));   /* DROP HI ORD BYTE      @ZA14829*/
         LA RWORK3,0(RWORK3)
*       PLHACB=RWORK3;              /* SET ACB PTR IN PLH    @ZA14829*/
         ST    RWORK3,PLHACB(,RPLH)                                1091
*       PLHASCB=PSAAOLD;            /* SAVE ASCB ADDRESS             */
         L     @15,PSAAOLD                                         1092
         ST    @15,PLHASCB(,RPLH)                                  1092
*       IF AMBPH^=0 THEN            /* IF AMBPH POINTER PRESENT      */
         L     @15,AMBPH(,RAMB)                                    1093
         LTR   @15,@15                                             1093
         BZ    @RF01093                                            1093
*         RPLH=AMBPH;               /* POINT TO PLH HEADER           */
         LR    RPLH,@15                                            1094
*       ELSE                        /* AMBUPLH PTR MUST BE PRESENT   */
*         RPLH=AMBUPLH;             /* POINT TO PLH HEADER           */
         B     @RC01093                                            1095
@RF01093 L     RPLH,AMBUPLH(,RAMB)                                 1095
*       RPLH->PLHDRCUR=RPLH->PLHDRCUR+1;/* ADD ONE TO CURR           */
@RC01093 LA    @15,1                                               1096
         AH    @15,PLHDRCUR(,RPLH)                                 1096
         STH   @15,PLHDRCUR(,RPLH)                                 1096
*       IF RPLH->PLHDRCUR>RPLH->PLHDRMAX THEN/* IF NEW HIGH          */
         CH    @15,PLHDRMAX(,RPLH)                                 1097
         BNH   @RF01097                                            1097
*         RPLH->PLHDRMAX=RPLH->PLHDRCUR;/* SAVE NEW HIGH             */
         STH   @15,PLHDRMAX(,RPLH)                                 1098
*       RPLH=RPLPLHPT;              /* RESTORE PLH POINTER           */
@RF01097 L     RPLH,RPLPLHPT(,RRPL)                                1099
*     END;                                                         1100
*   ELSE                            /* IF NO PLH WAS FOUND           */
*     IF AMBLSR=OFF&AMBGSR=OFF THEN /* IF NO SHARING                 */
         B     @RC01083                                            1101
@RF01083 TM    AMBLSR(RAMB),B'01100000'                            1101
         BNZ   @RF01101                                            1101
*       DO;                                                        1102
*         RWORK3=R14;               /* SAVE RETURN ADDRESS   @ZA04706*/
         LR    RWORK3,R14                                          1103
*         RPARM1=RRPL;              /* SAVE POINTER TO RPL           */
         LR    RPARM1,RRPL                                         1104
*I08:                                                              1105
*         DO;                       /* IDACALL(IDAPGETM)             */
I08      DS    0H                                                  1106
*           CALL IDAPGETM;          /* EXIT TO IDAPGETM              */
         L     @15,@CV01557                                        1106
         BALR  @14,@15                                             1106
*           GEN(BALR @11,0);        /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*           GEN(USING *,@11);       /* ESTABLISH ADDRESSING          */
         USING *,@11
*           GEN(L     @11,=A(@PSTART));/* RELOAD BASE                */
         L     @11,=A(@PSTART)
*           GEN(USING @PSTART,@11); /* ESTABLISH ADDRESSING          */
         USING @PSTART,@11
*         END I08;                  /* GET PARM FIELD                */
*         IF RRPL^=0 THEN           /* IF NO ERROR                   */
         LTR   RRPL,RRPL                                           1112
         BZ    @RF01112                                            1112
*           DO;                                                    1113
*             RESPECIFY                                            1114
*               IDABLPRM BASED(R1);                                1114
*             BLPFSTAD=ON;          /* INDICATE DSA                  */
         OI    BLPFSTAD(R1),B'00000001'                            1115
*             RWORK1=ADDR(IDABLPRM);/* SAVE ACB ADDR                 */
         LR    RWORK1,R1                                           1116
*             R1=ADDR(BLPOCODE);    /* PTR TO PARM LIST              */
         LA    @15,BLPOCODE(,R1)                                   1117
         LR    R1,@15                                              1117
*             RESPECIFY                                            1118
*               R15 RESTRICTED;                                    1118
*             SVC(19);              /* ADD STRING                    */
         SVC   19                                                  1119
*             RWORK2=R15;           /* SAVE RETURN CODE              */
         LR    RWORK2,R15                                          1120
*             R1=RWORK1;            /* POINT TO PARM LIST            */
         LR    R1,RWORK1                                           1121
*I09:                                                              1122
*             DO;                   /* IDACALL(IDAPFREE)             */
I09      DS    0H                                                  1123
*               CALL IDAPFREE;      /* EXIT TO IDAPFREE              */
         L     @15,@CV01562                                        1123
         BALR  @14,@15                                             1123
*               GEN(BALR @11,0);    /* LOAD ADDR OF REENTRY          */
         BALR @11,0
*               GEN(USING *,@11);   /* ESTABLISH ADDRESSING          */
         USING *,@11
*               GEN(L     @11,=A(@PSTART));/* RELOAD BASE            */
         L     @11,=A(@PSTART)
*               GEN(USING @PSTART,@11);/* ESTABLISH ADDRESSING       */
         USING @PSTART,@11
*             END I09;              /* FREE PARM LIST                */
*             R15=RWORK2;           /* RESTORE ERROR CODE            */
         LR    R15,RWORK2                                          1129
*           END;                                                   1130
*         ELSE                      /* IF ANY ERROR                  */
*           R15=-1;                 /* SET R15 NOT ZERO              */
         B     @RC01112                                            1131
@RF01112 SLR   R15,R15                                             1131
         BCTR  R15,0                                               1131
*         R14=RWORK3;               /* RESTORE RETURN ADDR   @ZA04706*/
@RC01112 LR    R14,RWORK3                                          1132
*         RRPL=RPARM1;              /* RESTORE RRPL POINTER          */
         LR    RRPL,RPARM1                                         1133
*         IF R15=0 THEN             /* IF NO ERROR                   */
         LTR   R15,R15                                             1134
         BZ    @RT01134                                            1134
*           GOTO FNDPLH;            /* TRY AGAIN ABOVE               */
*         RESPECIFY                                                1136
*           R15 UNRESTRICTED;                                      1136
*       END;                                                       1137
*   RETURN;                         /* EXIT IDAXGPLH                 */
         B     @EL00001                                            1138
*   RESPECIFY                                                      1139
*    (RWORK1,                                                      1139
*     RWORK2,                                                      1139
*     RWORK3,                                                      1139
*     RWORK4,                                                      1139
*     RWORK5,                                                      1139
*     RBUFC,                        /*                       @ZA24684*/
*     R14) UNRESTRICTED;                                           1139
*   END IDA019RU                                                   1140
*                                                                  1140
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (LCGPLSSW)                                       */
*/*%INCLUDE SYSLIB  (IDAREGS )                                       */
*/*%INCLUDE SYSLIB  (IFGRPL  )                                       */
*/*%INCLUDE SYSLIB  (IDARMRCD)                                       */
*/*%INCLUDE SYSLIB  (IFGACB  )                                       */
*/*%INCLUDE SYSLIB  (IFGEXLST)                                       */
*/*%INCLUDE SYSLIB  (IDAAMBL )                                       */
*/*%INCLUDE SYSLIB  (IDAAMB  )                                       */
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                       */
*/*%INCLUDE SYSLIB  (IDAPLH  )                                       */
*/*%INCLUDE SYSLIB  (IDABIB  )                                       */
*/*%INCLUDE SYSLIB  (IDAUPT  )                                       */
*/*%INCLUDE SYSLIB  (IDAWSHD )                                       */
*/*%INCLUDE SYSLIB  (IDABLPRM)                                       */
*/*%INCLUDE SYSLIB  (IDAAIR  )                                       */
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */
*                                                                  1140
*       ;                                                          1140
         B     @EL00001                                            1140
@DATA    DS    0H
@CH01063 DC    H'32767'
@SM01575 MVC   RECORD(0,@15),RECORD(RWORK2)
@SC01577 CLC   NEWKEY(0,RWORK5),OLDKEY(@15)
@SC01579 CLC   NEWKEY(0,@09),OLDKEY(@15)
@SM01586 MVC   AIXKY(0,@15),OLDKEY(@03)
@SM01588 MVC   AIXKY(0,@15),NEWKEY(@03)
@SM01590 MVC   AIXPTR(0,RWORK3),AIXPTR(RWORK2)
@SC01592 CLC   AIXPTR(0,RWORK2),AIXPTR(RWORK3)
@SM01594 MVC   CORE(0,RWORK3),CORE(R14)
@DATD    DSECT
         DS    0F
IDA019RU CSECT
         DS    0F
@CF00054 DC    F'1'
@CF00220 DC    F'5'
@CF00229 DC    F'12'
@CF00088 DC    F'16'
@CF01390 DC    F'255'
@DATD    DSECT
         DS    0D
IDA019RU CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
@CV01384 DC    V(IDADRQ)
@CV01385 DC    V(IDAGETWS)
@CV01386 DC    V(IDARELWS)
@CV01387 DC    V(IDASBF)
@CV01395 DC    V(IDA019R4)
@CV01414 DC    V(IDA019ST)
@CV01452 DC    V(IDARSTRT)
@CV01557 DC    V(IDAPGETM)
@CV01562 DC    V(IDAPFREE)
         DS    0D
HWORD4   DC    H'4'
         DS    CL2
BRANCH   DC    AL4(UPGGET)
         DC    AL4(UPGPUT)
         DC    3A(0)
         DC    AL4(UPGERASE)
PASSTAB  DC    AL4(PASS1)
         DC    AL4(PASS2)
         DC    A(0)
         DC    AL4(PASS4)
         DC    AL4(PASS5)
         DC    AL4(PASS6)
         DC    AL4(PASS7)
         DC    AL4(PASS8)
         DC    AL4(PASS9)
         DS    1XL4
ERRTAB   DC    AL1(1)
         DC    AL1(1)
         DC    AL1(3)
         DC    AL1(3)
         DC    AL1(5)
         DC    AL1(5)
IDA019RU CSECT
    LTORG
    IDAPATCH
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IDA019RU CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
RWORK0   EQU   @00
RRPL     EQU   @01
R1       EQU   @01
RPLH     EQU   @02
RAMB     EQU   @03
RBUFC    EQU   @04
RWORK1   EQU   @05
RWORK2   EQU   @06
RWORK3   EQU   @07
RWORK4   EQU   @08
RWORK5   EQU   @09
RPARM1   EQU   @12
R13      EQU   @13
R14      EQU   @14
R15      EQU   @15
R10      EQU   @10
R11      EQU   @11
PSA      EQU   0
FLCRNPSW EQU   PSA
FLCROPSW EQU   PSA+8
FLCICCW2 EQU   PSA+16
PSAEEPSW EQU   PSA+132
PSAESPSW EQU   PSA+136
FLCSVILC EQU   PSAESPSW+1
PSAEPPSW EQU   PSA+140
FLCPIILC EQU   PSAEPPSW+1
FLCPICOD EQU   PSAEPPSW+2
PSAPICOD EQU   FLCPICOD+1
FLCTEA   EQU   PSAEPPSW+4
FLCPER   EQU   PSA+152
FLCMCLA  EQU   PSA+168
FLCIOEL  EQU   FLCMCLA+4
FLCIOA   EQU   FLCMCLA+16
FLCFSA   EQU   FLCMCLA+80
PSAAOLD  EQU   PSA+548
PSASUPER EQU   PSA+552
PSASUP1  EQU   PSASUPER
PSASUP2  EQU   PSASUPER+1
PSASUP3  EQU   PSASUPER+2
PSASUP4  EQU   PSASUPER+3
PSACLHT  EQU   PSA+640
PSALKSA  EQU   PSA+696
PSAHLHI  EQU   PSA+760
PSADSSFL EQU   PSA+836
PSADSSF1 EQU   PSADSSFL
PSADSSF3 EQU   PSADSSFL+2
PSADSSF4 EQU   PSADSSFL+3
PSARSVT  EQU   PSA+896
IFGRPL   EQU   0
RPLCOMN  EQU   IFGRPL
RPLIDWD  EQU   RPLCOMN
RPLREQ   EQU   RPLIDWD+2
RPLLEN   EQU   RPLIDWD+3
RPLPLHPT EQU   RPLCOMN+4
RPLECB   EQU   RPLCOMN+8
RPLPOST  EQU   RPLECB
RPLFDBWD EQU   RPLCOMN+12
RPLFDBK  EQU   RPLFDBWD+1
RPLRTNCD EQU   RPLFDBK
RPLERREG EQU   RPLRTNCD
RPLCNDCD EQU   RPLFDBK+1
RPLCMPON EQU   RPLCNDCD
RPLFDB2  EQU   RPLCMPON
RPLERRCD EQU   RPLCNDCD+1
RPLFDB3  EQU   RPLERRCD
RPLKEYLE EQU   RPLCOMN+16
RPLDACB  EQU   RPLCOMN+24
RPLAREA  EQU   RPLCOMN+32
RPLARG   EQU   RPLCOMN+36
RPLOPTCD EQU   RPLCOMN+40
RPLOPT1  EQU   RPLOPTCD
RPLLOC   EQU   RPLOPT1
RPLASY   EQU   RPLOPT1
RPLECBSW EQU   RPLOPT1
RPLOPT2  EQU   RPLOPTCD+1
RPLADR   EQU   RPLOPT2
RPLUPD   EQU   RPLOPT2
RPLOPT3  EQU   RPLOPTCD+2
RPLNXTRP EQU   RPLCOMN+44
RPLRLEN  EQU   RPLCOMN+48
RPLBUFL  EQU   RPLCOMN+52
RPLOPTC2 EQU   RPLCOMN+56
RPLOPT5  EQU   RPLOPTC2
RPLWRTYP EQU   RPLOPT5
RPLOPT6  EQU   RPLOPTC2+1
RPLUNTYP EQU   RPLOPT6
RPLOPT7  EQU   RPLOPTC2+2
RPLCNOPT EQU   RPLOPT7
RPLOPT8  EQU   RPLOPTC2+3
RPLRBAR  EQU   RPLCOMN+60
RPLAIXID EQU   RPLRBAR+2
RPLDDDD  EQU   RPLRBAR+4
RPLEXTDS EQU   RPLCOMN+68
RPLEXTD1 EQU   RPLEXTDS
IFGACB   EQU   0
ACBCOMN  EQU   IFGACB
ACBLENG  EQU   ACBCOMN+2
ACBLENG2 EQU   ACBLENG
ACBAMBL  EQU   ACBCOMN+4
ACBJWA   EQU   ACBAMBL
ACBMACRF EQU   ACBCOMN+12
ACBMACR1 EQU   ACBMACRF
ACBADR   EQU   ACBMACR1
ACBCNV   EQU   ACBMACR1
ACBMACR2 EQU   ACBMACRF+1
ACBBUFPL EQU   ACBCOMN+20
ACBMACR3 EQU   ACBBUFPL
ACBRECFM EQU   ACBCOMN+24
ACBCCTYP EQU   ACBCOMN+25
ACBOPT   EQU   ACBCOMN+26
ACBDSORG EQU   ACBOPT
ACBCROPS EQU   ACBDSORG
ACBEXLST EQU   ACBCOMN+36
ACBDDNM  EQU   ACBCOMN+40
ACBAMETH EQU   ACBDDNM+3
ACBOFLGS EQU   ACBCOMN+48
ACBEXFG  EQU   ACBOFLGS
ACBIOSFG EQU   ACBOFLGS
ACBINFLG EQU   ACBCOMN+50
ACBUJFCB EQU   ACBCOMN+52
ACBBLKSZ EQU   ACBCOMN+60
IFGEXLST EQU   0
EXLCOMN  EQU   IFGEXLST
EXLLEN   EQU   EXLCOMN+2
EXLEODF  EQU   EXLCOMN+5
EXLSYNF  EQU   EXLCOMN+10
EXLLERF  EQU   EXLCOMN+15
EXLSCIPF EQU   EXLCOMN+20
EXLUPADF EQU   EXLSCIPF
EXLSCIPS EQU   EXLUPADF
EXLSCIPA EQU   EXLUPADF
EXLSCIPK EQU   EXLUPADF
EXLSCIPP EQU   EXLCOMN+21
EXLLGNF  EQU   EXLCOMN+25
EXLJRNF  EQU   EXLCOMN+30
EXLOPNF  EQU   EXLCOMN+35
IFGEXLEF EQU   0
EXLENTRY EQU   IFGEXLEF
EXLFLAG  EQU   EXLENTRY
EXLENFL  EQU   EXLFLAG
EXLEXITP EQU   EXLENTRY+1
IDAAMBL  EQU   0
AMBLEOV  EQU   IDAAMBL+12
AMBLEFLG EQU   AMBLEOV
AMBLDDNM EQU   IDAAMBL+16
AMBLIDF  EQU   AMBLDDNM
AMBLQ    EQU   AMBLIDF+7
AMBLVC   EQU   IDAAMBL+28
AMBLTYPE EQU   IDAAMBL+30
AMBLSHAR EQU   IDAAMBL+33
AMBLFLG1 EQU   IDAAMBL+35
AMBLFLG2 EQU   IDAAMBL+36
AMBLDTA  EQU   IDAAMBL+52
AMBLBIB  EQU   IDAAMBL+60
IDAAMB   EQU   0
AMBPH    EQU   IDAAMB+12
AMBDSB   EQU   IDAAMB+20
AMBEOVR  EQU   IDAAMB+24
AMBFLG0  EQU   AMBEOVR
AMBFLG1  EQU   IDAAMB+25
AMBDSORG EQU   IDAAMB+26
AMBIOBAD EQU   IDAAMB+28
AMBINFL  EQU   IDAAMB+42
AMBDEBPT EQU   IDAAMB+44
AMBOFLGS EQU   IDAAMB+48
AMBFLG2  EQU   IDAAMB+49
AMBEOVPT EQU   IDAAMB+56
AMBPAMBL EQU   IDAAMB+76
AMBUPLH  EQU   IDAAMB+80
AMBCSWD1 EQU   IDAAMB+84
AMBAFLG  EQU   AMBCSWD1
AMBLSR   EQU   AMBAFLG
AMBGSR   EQU   AMBAFLG
AMBTRACE EQU   IDAAMB+120
IDAAMDSB EQU   0
AMDATTR  EQU   IDAAMDSB+1
AMDDST   EQU   AMDATTR
AMDNEST  EQU   IDAAMDSB+4
AMDRKP   EQU   IDAAMDSB+6
AMDKEYLN EQU   IDAAMDSB+8
AMDHLRBA EQU   IDAAMDSB+28
AMDSSRBA EQU   IDAAMDSB+32
AMDATTR3 EQU   IDAAMDSB+40
AMDSTAT  EQU   IDAAMDSB+48
IDAPLHDR EQU   0
PLHDRMAX EQU   IDAPLHDR+8
PLHDRCUR EQU   IDAPLHDR+10
IDAPLH   EQU   0
PLHAVL   EQU   IDAPLH
PLHFLG1  EQU   IDAPLH+2
PLHFLG2  EQU   IDAPLH+3
PLHEFLGS EQU   IDAPLH+4
PLHSRINV EQU   PLHEFLGS
PLHINVAL EQU   PLHEFLGS
PLHFLG3  EQU   IDAPLH+6
PLHAFLGS EQU   IDAPLH+7
PLHACB   EQU   IDAPLH+8
PLHMRPL  EQU   IDAPLH+16
PLHCRPL  EQU   IDAPLH+20
PLHCRBA  EQU   IDAPLH+28
PLHJORBA EQU   PLHCRBA
PLHJCODE EQU   IDAPLH+40
PLHRSCS  EQU   IDAPLH+43
PLHARDB  EQU   IDAPLH+44
PLHDIOB  EQU   IDAPLH+76
PLHAMB   EQU   IDAPLH+108
PLHCHAIN EQU   IDAPLH+112
PLHRETO  EQU   IDAPLH+116
PLHRETOS EQU   IDAPLH+118
PLHRET1  EQU   IDAPLH+120
PLHEOVPT EQU   IDAPLH+180
PLHIXSPL EQU   IDAPLH+200
PLHSSRBA EQU   PLHIXSPL
PLHWAX   EQU   IDAPLH+232
PLHLLOR  EQU   IDAPLH+236
PLHKEYPT EQU   IDAPLH+248
PLHDRRSC EQU   IDAPLH+252
PLHDRMSK EQU   IDAPLH+264
PLHTMRPL EQU   IDAPLH+265
PLHASCB  EQU   IDAPLH+272
PLHEND   EQU   IDAPLH+280
IDABIB   EQU   0
BIBHDR   EQU   IDABIB
BIBFLG1  EQU   BIBHDR+1
BIBUPT   EQU   IDABIB+8
BIBRTNS  EQU   IDABIB+60
IDAUPT   EQU   0
UPTHDR   EQU   IDAUPT
UPTFLG0  EQU   UPTHDR+1
UPTPWS   EQU   UPTFLG0
UPTNEW   EQU   IDAUPT+4
UPTOLD   EQU   IDAUPT+8
UPTRSC   EQU   IDAUPT+12
UPTNOENT EQU   IDAUPT+13
UPTLLEN  EQU   IDAUPT+14
UPTSA    EQU   IDAUPT+16
UPTBRPL  EQU   UPTSA
UPTLSA   EQU   UPTSA+4
UPTBEREG EQU   UPTSA+8
UPTBERCD EQU   UPTSA+9
UPTSARES EQU   UPTSA+11
UPTR14   EQU   UPTSA+12
UPTR15   EQU   UPTSA+16
UPTAXENT EQU   IDAUPT+88
UPTRPL   EQU   UPTAXENT
UPTF1LOP EQU   UPTRPL
UPTFLG1  EQU   UPTAXENT+4
UPTF1LST EQU   UPTFLG1
UPTF1ATV EQU   UPTFLG1
UPTF1NUK EQU   UPTFLG1
UPTF1NOP EQU   UPTFLG1
UPTF1NRF EQU   UPTFLG1
UPTF1KEY EQU   UPTFLG1
UPTF1RTY EQU   UPTFLG1
UPTF1UPG EQU   UPTFLG1
UPTF1BKO EQU   UPTFLG1+1
UPTF1LOG EQU   UPTFLG1+1
UPTF1PHY EQU   UPTFLG1+1
UPTF1ERA EQU   UPTFLG1+1
UPTF1PNU EQU   UPTFLG1+1
UPTF1PUD EQU   UPTFLG1+1
UPTRKP   EQU   UPTAXENT+6
UPTPASS  EQU   UPTAXENT+8
UPTLNCDE EQU   UPTAXENT+9
UPTBG    EQU   UPTAXENT+10
IDAWSHD  EQU   0
WSHDACHN EQU   IDAWSHD+4
WSHDSLT  EQU   IDAWSHD+28
WSHDSAD  EQU   WSHDSLT
@NM00057 EQU   WSHDSAD
WSHDSGMW EQU   WSHDSLT+4
WSHDSFM  EQU   WSHDSGMW
WSHDSFLG EQU   WSHDSGMW+10
IDABLPRM EQU   0
BLPBUFLP EQU   IDABLPRM+4
BLPUACB  EQU   BLPBUFLP
BLPFLAGS EQU   IDABLPRM+10
BLPFLAG1 EQU   BLPFLAGS
BLPFSTAD EQU   BLPFLAG1
BLPFLAG2 EQU   BLPFLAGS+1
BLPOCODE EQU   IDABLPRM+12
BLPCORE  EQU   IDABLPRM+16
BLPGFLG  EQU   BLPCORE
BLPIOACB EQU   IDABLPRM+24
BLPBUFL  EQU   0
BLPBRLFG EQU   BLPBUFL+4
IDAAIX   EQU   0
AIXFG    EQU   IDAAIX
AIXPKP   EQU   AIXFG
AIXPL    EQU   IDAAIX+1
AIXPC    EQU   IDAAIX+2
AIXKL    EQU   IDAAIX+4
AIXKY    EQU   IDAAIX+5
SSA      EQU   0
SSAR14   EQU   SSA+12
RCDADDR  EQU   0
AIXPTR   EQU   0
UPGROUT  EQU   0
PASS     EQU   0
RECORD   EQU   0
NEWKEY   EQU   0
OLDKEY   EQU   0
BR15ROUT EQU   0
CORE     EQU   0
ALTKEY   EQU   0
PLHKEY   EQU   0
PLHPDL   EQU   0
PLHPDLE  EQU   0
PLHRRN   EQU   0
PLHEXTEN EQU   PLHEND
PLHBMWRK EQU   PLHEXTEN+5
PSARSVTE EQU   PSARSVT
FLC      EQU   PSA
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
PSARSAV  EQU   PSARSVTE+60
PSARSTK  EQU   PSARSVTE+56
PSAESAV3 EQU   PSARSVTE+52
PSAESTK3 EQU   PSARSVTE+48
PSAESAV2 EQU   PSARSVTE+44
PSAESTK2 EQU   PSARSVTE+40
PSAESAV1 EQU   PSARSVTE+36
PSAESTK1 EQU   PSARSVTE+32
PSAPSAV  EQU   PSARSVTE+28
PSAPSTK  EQU   PSARSVTE+24
PSAMSAV  EQU   PSARSVTE+20
PSAMSTK  EQU   PSARSVTE+16
PSASSAV  EQU   PSARSVTE+12
PSASSTK  EQU   PSARSVTE+8
PSANSTK  EQU   PSARSVTE+4
PSACSTK  EQU   PSARSVTE
PLHBMSV5 EQU   PLHEXTEN+24
PLHBMSV4 EQU   PLHEXTEN+20
PLHBMSV3 EQU   PLHEXTEN+16
PLHBMSV2 EQU   PLHEXTEN+12
PLHBMSV1 EQU   PLHEXTEN+8
PLHRDCNT EQU   PLHEXTEN+6
PLHBMSOV EQU   PLHBMWRK
PLHBEUC  EQU   PLHBMWRK
PLHBMRDF EQU   PLHBMWRK
@NM00053 EQU   PLHEXTEN+4
PLHRESR1 EQU   PLHEXTEN
SSANEXT  EQU   SSA+8
SSALAST  EQU   SSA+4
@NM00090 EQU   SSA
@NM00065 EQU   AIXFG
BLPBFLCT EQU   BLPBUFL+6
@NM00064 EQU   BLPBUFL+5
@NM00063 EQU   BLPBRLFG
BLPBFLST EQU   BLPBRLFG
BLPBUFSZ EQU   BLPBUFL
BLPERFLG EQU   IDABLPRM+51
@NM00062 EQU   IDABLPRM+49
BLPOFLGS EQU   IDABLPRM+48
@NM00061 EQU   IDABLPRM+28
BLPDSORG EQU   BLPIOACB+3
@NM00060 EQU   BLPIOACB
BLPGAD   EQU   BLPCORE+5
BLPGSP   EQU   BLPCORE+4
BLPGSZ   EQU   BLPCORE+1
BLPGPG   EQU   BLPGFLG
BLPGREQ  EQU   BLPGFLG
BLPOACB  EQU   IDABLPRM+13
BLPFRSTR EQU   BLPFLAG2
BLPFIOSR EQU   BLPFLAG2
BLPFINDX EQU   BLPFLAG2
BLPFDATA EQU   BLPFLAG2
BLPFPRIM EQU   BLPFLAG2
BLPFPATH EQU   BLPFLAG2
BLPFUPGR EQU   BLPFLAG2
BLPFPART EQU   BLPFLAG2
BLPFBFRF EQU   BLPFLAG1
BLPFIOBF EQU   BLPFLAG1
BLPFGSR  EQU   BLPFLAG1
BLPFLSR  EQU   BLPFLAG1
BLPFDEL  EQU   BLPFLAG1
BLPFBLD  EQU   BLPFLAG1
BLPFDBDC EQU   BLPFLAG1
BLPSTRNO EQU   IDABLPRM+9
BLPKEYLN EQU   IDABLPRM+8
BLPIOPLH EQU   BLPUACB
@NM00059 EQU   IDABLPRM+2
BLPACBST EQU   IDABLPRM+1
BLPACBID EQU   IDABLPRM
WSHDSBM  EQU   WSHDSGMW+11
WSHDSFNO EQU   WSHDSFLG
WSHDSBV  EQU   WSHDSGMW+8
WSHDSONX EQU   WSHDSGMW+4
WSHDSFLN EQU   WSHDSFM+1
WSHDSFSP EQU   WSHDSFM
WSHDKEY7 EQU   @NM00057
@NM00058 EQU   @NM00057
WSHDOCHN EQU   IDAWSHD+24
WSHDGMRA EQU   IDAWSHD+20
WSHDNUS  EQU   IDAWSHD+18
WSHDGMWA EQU   IDAWSHD+8
WSHDNEXT EQU   WSHDACHN+1
WSHDGMTB EQU   WSHDACHN
WSHDLEN  EQU   IDAWSHD+2
WSHDPOOL EQU   IDAWSHD+1
WSHDID   EQU   IDAWSHD
@NM00056 EQU   UPTSA+10
UPTLEN   EQU   UPTHDR+2
UPTID    EQU   UPTHDR
BIBVSRTP EQU   IDABIB+104
BIBASCB  EQU   IDABIB+100
BIBDDNM  EQU   IDABIB+92
BIBSTPNM EQU   IDABIB+84
BIBJOBNM EQU   IDABIB+76
BIBSIOAP EQU   BIBRTNS+12
BIBASYRT EQU   BIBRTNS+8
BIBCEAPP EQU   BIBRTNS+4
BIBINTRF EQU   BIBRTNS
BIBVGTT  EQU   IDABIB+56
BIBPSAB  EQU   IDABIB+52
BIBCSL   EQU   IDABIB+48
BIBWSHD  EQU   IDABIB+44
BIBVCRT  EQU   IDABIB+40
BIBHEBFQ EQU   IDABIB+36
BIBHEBPT EQU   IDABIB+32
BIBPRSPH EQU   IDABIB+28
BIBSPHPT EQU   IDABIB+24
BIBPAMBL EQU   IDABIB+20
BIBDACB  EQU   IDABIB+16
BIBVMT   EQU   IDABIB+12
@NM00055 EQU   IDABIB+5
BIBFLG2  EQU   IDABIB+4
BIBLEN   EQU   BIBHDR+2
@NM00054 EQU   BIBFLG1
BIBCKPT  EQU   BIBFLG1
BIBREST  EQU   BIBFLG1
BIBVIRT  EQU   BIBFLG1
BIBID    EQU   BIBHDR
PLHERRET EQU   IDAPLH+276
PLHECB   EQU   IDAPLH+268
@NM00052 EQU   IDAPLH+266
@NM00051 EQU   PLHTMRPL
PLHTMIOB EQU   PLHTMRPL
PLHTMINX EQU   PLHTMRPL
PLHTMDTA EQU   PLHTMRPL
PLHTMDIW EQU   PLHTMRPL
PLHTMBUF EQU   PLHTMRPL
PLHTERM  EQU   PLHTMRPL
PLHR13   EQU   IDAPLH+260
PLHPARM1 EQU   IDAPLH+256
PLHSLRBA EQU   IDAPLH+244
PLHSRCSG EQU   IDAPLH+242
PLHNOSEG EQU   IDAPLH+240
PLHXPLH  EQU   PLHWAX
@NM00050 EQU   PLHIXSPL+8
PLHIXBFC EQU   PLHIXSPL+4
PLHHIREC EQU   PLHSSRBA
PLHISPLP EQU   IDAPLH+196
PLHRBUFC EQU   IDAPLH+192
PLHIBUFC EQU   IDAPLH+188
PLHNRBA  EQU   IDAPLH+184
PLHDDDD  EQU   PLHEOVPT
PLHAR14  EQU   IDAPLH+176
@NM00049 EQU   IDAPLH+172
@NM00048 EQU   IDAPLH+168
PLHASAVE EQU   IDAPLH+164
PLHSAVE6 EQU   IDAPLH+104
PLHSAVE5 EQU   IDAPLH+100
PLHSAVE4 EQU   IDAPLH+96
PLHSAVE3 EQU   IDAPLH+92
PLHSAVE2 EQU   IDAPLH+88
PLHSAVE1 EQU   IDAPLH+84
PLHARET  EQU   IDAPLH+80
PLHIIOB  EQU   PLHDIOB
PLHSRSID EQU   IDAPLH+74
PLHRDFC  EQU   IDAPLH+72
PLHRDFP  EQU   IDAPLH+68
PLHFSP   EQU   IDAPLH+64
PLHRECP  EQU   IDAPLH+60
PLHNBUFC EQU   IDAPLH+56
PLHDBUFC EQU   IDAPLH+52
PLHLRECL EQU   IDAPLH+48
@NM00047 EQU   PLHRSCS
PLHDBPER EQU   PLHRSCS
PLHDSERR EQU   PLHRSCS
PLHASYER EQU   PLHRSCS
@NM00046 EQU   PLHRSCS
PLHBUFHD EQU   PLHRSCS
PLHINEOV EQU   PLHRSCS
PLHEOVR  EQU   IDAPLH+42
PLHRCODE EQU   IDAPLH+41
PLHUCODE EQU   PLHJCODE
PLHJNRBA EQU   IDAPLH+36
PLHJRNLL EQU   IDAPLH+32
PLHUPECB EQU   PLHJORBA
PLHDSIDA EQU   IDAPLH+24
PLHBFRNO EQU   IDAPLH+15
PLHFRCNT EQU   IDAPLH+14
PLHRMIN  EQU   IDAPLH+13
PLHDSTYP EQU   IDAPLH+12
PLHRAE   EQU   PLHAFLGS
PLHRABWD EQU   PLHAFLGS
PLHIOSID EQU   PLHAFLGS
PLHDBDC  EQU   PLHAFLGS
PLHVAMB  EQU   PLHAFLGS
PLHIOSRQ EQU   PLHAFLGS
PLHDRLM  EQU   PLHAFLGS
PLHEOVDF EQU   PLHFLG3
PLHRVRS  EQU   PLHFLG3
PLHBWD   EQU   PLHFLG3
PLHSLVLD EQU   PLHFLG3
PLHRAHD  EQU   PLHFLG3
PLHSRBSG EQU   PLHFLG3
@NM00045 EQU   PLHEFLGS+1
PLHRSTRT EQU   PLHEFLGS+1
PLHDSCAN EQU   PLHEFLGS
PLHEODX  EQU   PLHEFLGS
PLHNOADV EQU   PLHEFLGS
PLHSKPER EQU   PLHEFLGS
PLH1ST   EQU   PLHEFLGS
PLHNOSPC EQU   PLHEFLGS
PLHIWAIT EQU   PLHFLG2
PLHSVADV EQU   PLHFLG2
PLHCIINS EQU   PLHFLG2
PLHKRE   EQU   PLHFLG2
PLHADDTE EQU   PLHFLG2
PLHKEYMD EQU   PLHFLG2
PLHSQINS EQU   PLHFLG2
PLHUPD   EQU   PLHFLG2
@NM00044 EQU   PLHFLG1
PLHDRPND EQU   PLHFLG1
PLHASYRQ EQU   PLHFLG1
PLHRDEXC EQU   PLHFLG1
PLHSSR   EQU   PLHFLG1
PLHASKBF EQU   PLHFLG1
PLHENDRQ EQU   PLHFLG1
PLHEOVW  EQU   PLHFLG1
PLHATV   EQU   IDAPLH+1
PLHIOSDQ EQU   IDAPLHDR+12
PLHDRREQ EQU   IDAPLHDR+4
PLHELTH  EQU   IDAPLHDR+2
PLHCNT   EQU   IDAPLHDR+1
PLHID    EQU   IDAPLHDR
AMDEXCP  EQU   AMDSTAT+44
AMDNCAS  EQU   AMDSTAT+40
AMDNCIS  EQU   AMDSTAT+36
AMDASPA  EQU   AMDSTAT+32
AMDRETR  EQU   AMDSTAT+28
AMDUPR   EQU   AMDSTAT+24
AMDIREC  EQU   AMDSTAT+20
AMDDELR  EQU   AMDSTAT+16
AMDNLR   EQU   AMDSTAT+12
AMDNEXT  EQU   AMDSTAT+10
AMDNIL   EQU   AMDSTAT+8
AMDSTSP  EQU   AMDSTAT
@NM00043 EQU   IDAAMDSB+41
@NM00042 EQU   AMDATTR3
AMDLM    EQU   AMDATTR3
AMDWAIT  EQU   AMDATTR3
AMDBIND  EQU   AMDATTR3
AMDFAULT EQU   AMDATTR3
AMDUNQ   EQU   AMDATTR3
AMDPARDB EQU   IDAAMDSB+36
AMDMAXRR EQU   AMDSSRBA
AMDNSLOT EQU   AMDHLRBA
AMDLRECL EQU   IDAAMDSB+24
AMDCINV  EQU   IDAAMDSB+20
AMDFSCI  EQU   IDAAMDSB+16
AMDFSCA  EQU   IDAAMDSB+14
AMDCIPCA EQU   IDAAMDSB+12
AMDPCTCI EQU   IDAAMDSB+11
AMDPCTCA EQU   IDAAMDSB+10
AMDAXRKP EQU   AMDNEST
AMDLEN   EQU   IDAAMDSB+2
AMDSPAN  EQU   AMDATTR
AMDRRDS  EQU   AMDATTR
AMDRANGE EQU   AMDATTR
AMDORDER EQU   AMDATTR
AMDREPL  EQU   AMDATTR
AMDSDT   EQU   AMDATTR
AMDWCK   EQU   AMDATTR
AMDSBID  EQU   IDAAMDSB
AMBVIOT  EQU   IDAAMB+116
AMBSZCP  EQU   IDAAMB+114
AMBSZFW  EQU   IDAAMB+112
AMBSZWR  EQU   IDAAMB+110
AMBSZRD  EQU   IDAAMB+108
AMBEXEX  EQU   IDAAMB+100
AMBWSHD  EQU   IDAAMB+96
AMBCPA   EQU   IDAAMB+92
AMBBM2SH EQU   IDAAMB+88
AMBRDCNT EQU   AMBCSWD1+2
@NM00041 EQU   AMBCSWD1+1
@NM00040 EQU   AMBAFLG
AMBCFX   EQU   AMBAFLG
AMBSIS   EQU   AMBAFLG
AMBDFR   EQU   AMBAFLG
AMBICI   EQU   AMBAFLG
@NM00039 EQU   AMBAFLG
AMBPIXP  EQU   IDAAMB+72
@NM00038 EQU   IDAAMB+68
AMBIWA   EQU   IDAAMB+64
AMBWKA   EQU   IDAAMB+60
AMBAMBXN EQU   AMBEOVPT
AMBEDB   EQU   IDAAMB+52
AMBRPT   EQU   IDAAMB+50
AMBPUG   EQU   AMBFLG2
AMBBUSY  EQU   AMBOFLGS
AMBEXFG  EQU   AMBOFLGS
@NM00037 EQU   AMBOFLGS
AMBOPEN  EQU   AMBOFLGS
@NM00036 EQU   AMBOFLGS
AMBDEBAD EQU   AMBDEBPT+1
AMBIFLGS EQU   AMBDEBPT
AMBAMETH EQU   IDAAMB+43
AMBUPX   EQU   AMBINFL
AMBUCRA  EQU   AMBINFL
AMBSCRA  EQU   AMBINFL
AMBCAT   EQU   AMBINFL
@NM00035 EQU   AMBINFL
@NM00034 EQU   AMBINFL
AMBTIOT  EQU   IDAAMB+40
@NM00033 EQU   IDAAMB+38
AMBDDSN  EQU   IDAAMB+35
AMBCDSN  EQU   IDAAMB+32
AMBIOMB  EQU   AMBIOBAD
@NM00032 EQU   AMBDSORG+1
AMBDORGA EQU   AMBDSORG+1
@NM00031 EQU   AMBDSORG
AMBINBUF EQU   AMBFLG1
AMBJRN   EQU   AMBFLG1
AMBUBF   EQU   AMBFLG1
AMBSPEED EQU   AMBFLG1
AMBPCAT  EQU   AMBFLG1
AMBMCAT  EQU   AMBFLG1
AMBTYPE  EQU   AMBFLG1
AMBCREAT EQU   AMBFLG1
@NM00030 EQU   AMBFLG0
AMBPSDS  EQU   AMBFLG0
AMBCACB  EQU   IDAAMB+16
AMBBUFC  EQU   IDAAMB+8
AMBLINK  EQU   IDAAMB+4
AMBLEN   EQU   IDAAMB+2
AMBRSC   EQU   IDAAMB+1
AMBID    EQU   IDAAMB
AMBLCMB  EQU   IDAAMBL+64
AMBLIX   EQU   IDAAMBL+56
AMBLMIDS EQU   IDAAMBL+42
AMBLNIDS EQU   IDAAMBL+41
@NM00029 EQU   IDAAMBL+40
AMBLNUM  EQU   IDAAMBL+38
AMBLNST  EQU   IDAAMBL+37
@NM00028 EQU   AMBLFLG2
AMBLSTAG EQU   AMBLFLG2
@NM00027 EQU   AMBLFLG2
AMBLDUMY EQU   AMBLFLG1
AMBLCAT  EQU   AMBLFLG1
AMBLUCRA EQU   AMBLFLG1
AMBLSCRA EQU   AMBLFLG1
AMBLVVIC EQU   AMBLFLG1
AMBLUPD  EQU   AMBLFLG1
AMBLCINV EQU   AMBLFLG1
AMBLFULL EQU   AMBLFLG1
AMBLLEN  EQU   IDAAMBL+34
@NM00026 EQU   AMBLSHAR
AMBLWRIT EQU   AMBLSHAR
AMBLCATO EQU   AMBLSHAR
AMBLPRIM EQU   AMBLSHAR
AMBLID   EQU   IDAAMBL+32
@NM00025 EQU   IDAAMBL+31
@NM00024 EQU   AMBLTYPE
AMBLFIX  EQU   AMBLTYPE
AMBLBASE EQU   AMBLTYPE
AMBLAIX  EQU   AMBLTYPE
AMBLUPGR EQU   AMBLTYPE
AMBLPATH EQU   AMBLTYPE
AMBLENO  EQU   AMBLVC+1
AMBLVRT  EQU   AMBLVC
AMBLXPT  EQU   IDAAMBL+24
AMBLDFR  EQU   AMBLQ
AMBLESDS EQU   AMBLQ
AMBLKSDS EQU   AMBLQ
AMBLUBF  EQU   AMBLQ
AMBLFSTP EQU   AMBLQ
AMBLLSR  EQU   AMBLQ
AMBLGSR  EQU   AMBLQ
AMBLDDC  EQU   AMBLQ
AMBLDCI  EQU   AMBLIDF+4
AMBLCACB EQU   AMBLIDF
@NM00023 EQU   AMBLEOV+2
AMBLCOMP EQU   AMBLEOV+1
AMBLESET EQU   AMBLEFLG
AMBLWAIT EQU   AMBLEFLG
AMBLACB  EQU   IDAAMBL+8
AMBLSCHN EQU   IDAAMBL+4
AMBLPCHN EQU   IDAAMBL
EXLEADDR EQU   EXLEXITP
@NM00022 EQU   EXLENFL
EXLLNK   EQU   EXLENFL
EXLACTM  EQU   EXLENFL
EXLSPEC  EQU   EXLENFL
EXLOPNP  EQU   EXLCOMN+36
@NM00021 EQU   EXLOPNF
EXLOPNK  EQU   EXLOPNF
EXLOPNA  EQU   EXLOPNF
EXLOPNS  EQU   EXLOPNF
EXLJRNP  EQU   EXLCOMN+31
@NM00020 EQU   EXLJRNF
EXLJRNK  EQU   EXLJRNF
EXLJRNA  EQU   EXLJRNF
EXLJRNS  EQU   EXLJRNF
EXLLGNP  EQU   EXLCOMN+26
@NM00019 EQU   EXLLGNF
EXLLGNK  EQU   EXLLGNF
EXLLGNA  EQU   EXLLGNF
EXLLGNS  EQU   EXLLGNF
EXLUPADP EQU   EXLSCIPP
@NM00018 EQU   EXLUPADF
EXLUPADK EQU   EXLSCIPK
EXLUPADA EQU   EXLSCIPA
EXLUPADS EQU   EXLSCIPS
EXLLERP  EQU   EXLCOMN+16
@NM00017 EQU   EXLLERF
EXLLERK  EQU   EXLLERF
EXLLERA  EQU   EXLLERF
EXLLERS  EQU   EXLLERF
EXLSYNP  EQU   EXLCOMN+11
@NM00016 EQU   EXLSYNF
EXLSYNK  EQU   EXLSYNF
EXLSYNA  EQU   EXLSYNF
EXLSYNS  EQU   EXLSYNF
EXLEODP  EQU   EXLCOMN+6
@NM00015 EQU   EXLEODF
EXLEODK  EQU   EXLEODF
EXLEODA  EQU   EXLEODF
EXLEODS  EQU   EXLEODF
@NM00014 EQU   EXLCOMN+4
EXLLEN2  EQU   EXLLEN
EXLSTYP  EQU   EXLCOMN+1
EXLID    EQU   EXLCOMN
ACBAPID  EQU   ACBCOMN+72
ACBCBMWA EQU   ACBCOMN+68
ACBUAPTR EQU   ACBCOMN+64
ACBLRECL EQU   ACBCOMN+62
ACBMSGLN EQU   ACBBLKSZ
ACBBUFSP EQU   ACBCOMN+56
@NM00013 EQU   ACBUJFCB+1
ACBOPTN  EQU   ACBUJFCB
ACBVVIC  EQU   ACBINFLG
ACBUCRA  EQU   ACBINFLG
ACBSCRA  EQU   ACBINFLG
ACBCAT   EQU   ACBINFLG
ACBIJRQE EQU   ACBINFLG
ACBJEPS  EQU   ACBINFLG
@NM00012 EQU   ACBINFLG
ACBERFLG EQU   ACBCOMN+49
ACBBUSY  EQU   ACBIOSFG
ACBLOCK  EQU   ACBEXFG
@NM00011 EQU   ACBOFLGS
ACBDSERR EQU   ACBOFLGS
ACBOPEN  EQU   ACBOFLGS
ACBEOV   EQU   ACBOFLGS
@NM00010 EQU   ACBOFLGS
ACBDEB   EQU   ACBDDNM+5
ACBERFL  EQU   ACBDDNM+4
ACBAM    EQU   ACBAMETH
ACBINFL  EQU   ACBDDNM+2
ACBTIOT  EQU   ACBDDNM
ACBUEL   EQU   ACBEXLST
ACBPASSW EQU   ACBCOMN+32
ACBMSGAR EQU   ACBCOMN+28
@NM00009 EQU   ACBDSORG+1
ACBDORGA EQU   ACBDSORG+1
@NM00008 EQU   ACBDSORG
ACBCRNRE EQU   ACBCROPS
ACBCRNCK EQU   ACBCROPS
ACBASA   EQU   ACBCCTYP
@NM00007 EQU   ACBCCTYP
ACBRECAF EQU   ACBRECFM
ACBJBUF  EQU   ACBBUFPL+2
ACBMACR4 EQU   ACBBUFPL+1
@NM00006 EQU   ACBMACR3
ACBNCFX  EQU   ACBMACR3
ACBSIS   EQU   ACBMACR3
ACBDFR   EQU   ACBMACR3
ACBICI   EQU   ACBMACR3
ACBGSR   EQU   ACBMACR3
ACBLSR   EQU   ACBMACR3
@NM00005 EQU   ACBMACR3
ACBBUFNI EQU   ACBCOMN+18
ACBBUFND EQU   ACBCOMN+16
ACBSTRNO EQU   ACBCOMN+15
ACBBSTNO EQU   ACBCOMN+14
ACBAIX   EQU   ACBMACR2
ACBDSN   EQU   ACBMACR2
ACBRST   EQU   ACBMACR2
ACBLOGON EQU   ACBMACR2
ACBSKP   EQU   ACBMACR2
@NM00004 EQU   ACBMACR2
ACBUBF   EQU   ACBMACR1
ACBOUT   EQU   ACBMACR1
ACBIN    EQU   ACBMACR1
ACBDIR   EQU   ACBMACR1
ACBSEQ   EQU   ACBMACR1
ACBBLK   EQU   ACBCNV
ACBADD   EQU   ACBADR
ACBKEY   EQU   ACBMACR1
ACBINRTN EQU   ACBCOMN+8
ACBIBCT  EQU   ACBJWA
ACBLEN2  EQU   ACBLENG2
ACBSTYP  EQU   ACBCOMN+1
ACBID    EQU   ACBCOMN
RPLERMSA EQU   RPLCOMN+72
RPLEMLEN EQU   RPLCOMN+70
RPLACTIV EQU   RPLCOMN+69
RPLBRANC EQU   RPLEXTD1
RPLNIB   EQU   RPLEXTD1
@NM00003 EQU   RPLEXTD1
RPLEXIT  EQU   RPLEXTD1
RPLNEXIT EQU   RPLEXTD1
RPLEXSCH EQU   RPLEXTD1
@NM00002 EQU   RPLRBAR+3
@NM00001 EQU   RPLAIXID
RPLAXPKP EQU   RPLAIXID
RPLAIXPC EQU   RPLRBAR
RPLRSV88 EQU   RPLOPT8
RPLUNCON EQU   RPLOPT8
RPLACTV  EQU   RPLOPT8
RPLSESS  EQU   RPLOPT8
RPLPEND  EQU   RPLOPT8
RPLODPRM EQU   RPLOPT8
RPLODACP EQU   RPLOPT8
RPLODACQ EQU   RPLOPT8
RPLRSV78 EQU   RPLOPT7
RPLRSV77 EQU   RPLOPT7
RPLRLSOP EQU   RPLOPT7
RPLTPOST EQU   RPLOPT7
RPLQOPT  EQU   RPLOPT7
RPLCNIMM EQU   RPLCNOPT
RPLCNANY EQU   RPLCNOPT
RPLCNALL EQU   RPLCNOPT
RPLRSV68 EQU   RPLOPT6
RPLRSV67 EQU   RPLOPT6
RPLLOCK  EQU   RPLOPT6
RPLNCOND EQU   RPLOPT6
RPLCOND  EQU   RPLOPT6
RPLEOT   EQU   RPLUNTYP
RPLEOM   EQU   RPLUNTYP
RPLEOB   EQU   RPLUNTYP
RPLWROPT EQU   RPLOPT5
RPLNODE  EQU   RPLOPT5
RPLERACE EQU   RPLWRTYP
RPLEAU   EQU   RPLWRTYP
RPLNERAS EQU   RPLWRTYP
RPLPSOPT EQU   RPLOPT5
RPLSSNIN EQU   RPLOPT5
RPLDLGIN EQU   RPLOPT5
RPLCHAIN EQU   RPLNXTRP
RPLOPT4  EQU   RPLOPTCD+3
RPLALIGN EQU   RPLOPT3
RPLFMT   EQU   RPLOPT3
RPLFLD   EQU   RPLOPT3
RPLVFY   EQU   RPLOPT3
RPLBLK   EQU   RPLOPT3
RPLSFORM EQU   RPLOPT3
RPLEODS  EQU   RPLOPT3
RPLNSP   EQU   RPLOPT2
RPLWAITX EQU   RPLOPT2
RPLLRD   EQU   RPLOPT2
RPLBWD   EQU   RPLOPT2
RPLCNV   EQU   RPLOPT2
RPLADD   EQU   RPLADR
RPLKEY   EQU   RPLOPT2
RPLECBIN EQU   RPLECBSW
RPLGEN   EQU   RPLOPT1
RPLKGE   EQU   RPLOPT1
RPLSKP   EQU   RPLOPT1
RPLSEQ   EQU   RPLOPT1
RPLDIR   EQU   RPLOPT1
RPLDAF   EQU   RPLARG+2
RPLSAF   EQU   RPLARG
RPLTCBPT EQU   RPLCOMN+28
RPLCCHAR EQU   RPLCOMN+20
RPLSTRID EQU   RPLCOMN+18
RPLKEYL  EQU   RPLKEYLE
RPLRDSOH EQU   RPLFDB3
RPLRLG   EQU   RPLFDB3
RPLLGFRC EQU   RPLFDB3
RPLREOT  EQU   RPLFDB3
RPLREOM  EQU   RPLFDB3
RPLREOB  EQU   RPLFDB3
RPLSV32  EQU   RPLFDB3
RPLUINPT EQU   RPLFDB3
RPLSTSAV EQU   RPLFDB2
RPLCUERR EQU   RPLFDB2
RPLDLGFL EQU   RPLFDB2
RPLIOERR EQU   RPLFDB2
RPLDVUNS EQU   RPLFDB2
RPLATND  EQU   RPLFDB2
RPLRVID  EQU   RPLFDB2
RPLERLK  EQU   RPLFDB2
RPLSTAT  EQU   RPLFDBWD
RPLWAIT  EQU   RPLECB
RPLLEN2  EQU   RPLLEN
RPLSTYP  EQU   RPLIDWD+1
RPLID    EQU   RPLIDWD
@NM00089 EQU   PSA+3668
PSASTAK  EQU   PSA+3072
@NM00088 EQU   PSA+1048
PSAUSEND EQU   PSA+1048
PSARV062 EQU   PSA+1044
PSACDAL  EQU   PSA+1040
PSAWTCOD EQU   PSA+1036
PSAATCVT EQU   PSA+1032
PSAPCPSW EQU   PSA+1024
PSAPIR2  EQU   PSA+1020
PSARV059 EQU   PSA+1018
PSASVC13 EQU   PSA+1016
PSALSFCC EQU   PSA+1012
PSASFACC EQU   PSA+1008
PSASTOP  EQU   PSA+992
PSASTART EQU   PSA+976
PSARSPSW EQU   PSA+968
PSASRPSW EQU   PSA+960
PSARV045 EQU   PSA+892
PSARV044 EQU   PSA+888
PSARV043 EQU   PSA+884
PSARV042 EQU   PSA+880
PSARV041 EQU   PSA+876
PSARV040 EQU   PSA+872
PSARV025 EQU   PSA+868
PSADSSED EQU   PSA+868
PSADSSPR EQU   PSA+864
PSADSSFW EQU   PSA+860
PSADSS14 EQU   PSA+856
PSADSSPP EQU   PSA+848
PSADSSRP EQU   PSA+840
PSADSS05 EQU   PSADSSF4
PSADSS10 EQU   PSADSSF4
PSADSSVE EQU   PSADSSF4
PSADSSDE EQU   PSADSSF4
PSADSSC0 EQU   PSADSSF4
PSADSSIE EQU   PSADSSF4
PSADSS12 EQU   PSADSSF4
PSADSSRC EQU   PSADSSF4
PSARV057 EQU   PSADSSF3
PSARV056 EQU   PSADSSF3
PSARV055 EQU   PSADSSF3
PSADSSMC EQU   PSADSSF3
PSADSSRW EQU   PSADSSF3
PSADSSNM EQU   PSADSSF3
PSADSSES EQU   PSADSSF3
PSADSSGP EQU   PSADSSF3
PSADSSF2 EQU   PSADSSFL+1
PSADSSPI EQU   PSADSSF1
PSADSSOI EQU   PSADSSF1
PSADSSSP EQU   PSADSSF1
PSADSSTP EQU   PSADSSF1
PSADSSDW EQU   PSADSSF1
PSADSSDD EQU   PSADSSF1
PSADSSDM EQU   PSADSSF1
PSADSSMV EQU   PSADSSF1
PSADSSTS EQU   PSA+816
PSADSSWK EQU   PSA+812
PSADSSR3 EQU   PSA+808
PSADSSR2 EQU   PSA+804
PSADSSRS EQU   PSA+800
PSASTOR  EQU   PSA+796
PSACPUSA EQU   PSA+794
PSAVSTAP EQU   PSA+792
PSAWKVAP EQU   PSA+788
PSAWKRAP EQU   PSA+784
PSAMCHIC EQU   PSA+783
PSARV061 EQU   PSA+782
PSASYMSK EQU   PSA+781
PSAMCHFL EQU   PSA+780
PSACR0   EQU   PSA+776
PSAPSWSV EQU   PSA+768
PSALITA  EQU   PSA+764
PSACLHS  EQU   PSAHLHI
PSALKR15 EQU   PSALKSA+60
PSALKR14 EQU   PSALKSA+56
PSALKR13 EQU   PSALKSA+52
PSALKR12 EQU   PSALKSA+48
PSALKR11 EQU   PSALKSA+44
PSALKR10 EQU   PSALKSA+40
PSALKR9  EQU   PSALKSA+36
PSALKR8  EQU   PSALKSA+32
PSALKR7  EQU   PSALKSA+28
PSALKR6  EQU   PSALKSA+24
PSALKR5  EQU   PSALKSA+20
PSALKR4  EQU   PSALKSA+16
PSALKR3  EQU   PSALKSA+12
PSALKR2  EQU   PSALKSA+8
PSALKR1  EQU   PSALKSA+4
PSALKR0  EQU   PSALKSA
PSARV023 EQU   PSACLHT+52
PSALOCAL EQU   PSACLHT+48
PSACMSL  EQU   PSACLHT+44
PSAOPTL  EQU   PSACLHT+40
PSATPACL EQU   PSACLHT+36
PSATPDNL EQU   PSACLHT+32
PSATPNCL EQU   PSACLHT+28
PSAIOSLL EQU   PSACLHT+24
PSAIOSUL EQU   PSACLHT+20
PSAIOSCL EQU   PSACLHT+16
PSAIOSSL EQU   PSACLHT+12
PSASALCL EQU   PSACLHT+8
PSAASML  EQU   PSACLHT+4
PSADISPL EQU   PSACLHT
PSASRSA  EQU   PSA+636
PSARV050 EQU   PSA+634
PSADSSGO EQU   PSA+633
PSARECUR EQU   PSA+632
PSAHLHIS EQU   PSA+628
PSAIPCSA EQU   PSA+624
@NM00087 EQU   PSA+621
PSAIPCDM EQU   PSA+620
PSAIPCD  EQU   PSA+616
@NM00086 EQU   PSA+613
PSAIPCRM EQU   PSA+612
PSAIPCR  EQU   PSA+608
PSAMCHEX EQU   PSA+600
PSAMPSW  EQU   PSA+592
PSAEXPS2 EQU   PSA+584
PSAEXPS1 EQU   PSA+576
PSAPIREG EQU   PSA+572
PSARSREG EQU   PSA+568
PSAGPREG EQU   PSA+556
PSARV022 EQU   PSASUP4
PSARV021 EQU   PSASUP4
PSARV020 EQU   PSASUP4
PSARV019 EQU   PSASUP4
PSARV018 EQU   PSASUP4
PSARV017 EQU   PSASUP4
PSARV016 EQU   PSASUP4
PSARV015 EQU   PSASUP4
PSARV014 EQU   PSASUP3
PSAULCMS EQU   PSASUP3
PSARV012 EQU   PSASUP3
PSAESTA  EQU   PSASUP3
PSASPR   EQU   PSASUP3
PSAPSREG EQU   PSASUP3
PSAPI2   EQU   PSASUP3
PSAIOSUP EQU   PSASUP3
PSALCR   EQU   PSASUP2
PSARTM   EQU   PSASUP2
PSAACR   EQU   PSASUP2
PSAIPCE2 EQU   PSASUP2
PSAIPCES EQU   PSASUP2
PSAIPCEC EQU   PSASUP2
PSAGTF   EQU   PSASUP2
PSAIPCRI EQU   PSASUP2
PSATYPE6 EQU   PSASUP1
PSATCTL  EQU   PSASUP1
PSADISP  EQU   PSASUP1
PSALOCK  EQU   PSASUP1
PSAPI    EQU   PSASUP1
PSAEXT   EQU   PSASUP1
PSASVC   EQU   PSASUP1
PSAIO    EQU   PSASUP1
PSAANEW  EQU   PSA+544
PSATOLD  EQU   PSA+540
PSATNEW  EQU   PSA+536
PSALCCAR EQU   PSA+532
PSALCCAV EQU   PSA+528
PSAPCCAR EQU   PSA+524
PSAPCCAV EQU   PSA+520
PSACPULA EQU   PSA+518
PSACPUPA EQU   PSA+516
PSAPSA   EQU   PSA+512
FLCHDEND EQU   PSA+512
FLCCRSAV EQU   FLCMCLA+280
FLCGRSAV EQU   FLCMCLA+216
FLCFPSAV EQU   FLCMCLA+184
FLCFLA   EQU   FLCMCLA+88
FLCRGNCD EQU   FLCMCLA+84
FLCFSAA  EQU   FLCFSA+1
@NM00085 EQU   FLCFSA
@NM00084 EQU   FLCMCLA+72
FLCMCIC  EQU   FLCMCLA+64
@NM00083 EQU   FLCMCLA+20
FLCIOAA  EQU   FLCIOA+1
@NM00082 EQU   FLCIOA
@NM00081 EQU   FLCMCLA+15
@NM00080 EQU   FLCMCLA+14
@NM00079 EQU   FLCMCLA+12
FLCLCL   EQU   FLCMCLA+8
FLCIOELA EQU   FLCIOEL+1
@NM00078 EQU   FLCIOEL
FLCCHNID EQU   FLCMCLA
@NM00077 EQU   PSA+160
FLCMTRCD EQU   PSA+157
@NM00076 EQU   PSA+156
FLCPERA  EQU   FLCPER+1
@NM00075 EQU   FLCPER
@NM00074 EQU   PSA+151
FLCPERCD EQU   PSA+150
FLCMCNUM EQU   PSA+149
@NM00073 EQU   PSA+148
FLCTEAA  EQU   FLCTEA+1
@NM00072 EQU   FLCTEA
PSAPIPC  EQU   PSAPICOD
PSAPIMC  EQU   PSAPICOD
PSAPIPER EQU   PSAPICOD
PSARV049 EQU   FLCPICOD
FLCPILCB EQU   FLCPIILC
@NM00071 EQU   FLCPIILC
@NM00070 EQU   PSAEPPSW
FLCSVCN  EQU   PSAESPSW+2
FLCSILCB EQU   FLCSVILC
@NM00069 EQU   FLCSVILC
@NM00068 EQU   PSAESPSW
FLCEICOD EQU   PSAEEPSW+2
PSASPAD  EQU   PSAEEPSW
@NM00067 EQU   PSA+128
FLCINPSW EQU   PSA+120
FLCMNPSW EQU   PSA+112
FLCPNPSW EQU   PSA+104
FLCSNPSW EQU   PSA+96
FLCENPSW EQU   PSA+88
FLCTRACE EQU   PSA+84
FLCTIMER EQU   PSA+80
FLCCVT2  EQU   PSA+76
FLCCAW   EQU   PSA+72
FLCCSW   EQU   PSA+64
FLCIOPSW EQU   PSA+56
FLCMOPSW EQU   PSA+48
FLCPOPSW EQU   PSA+40
FLCSOPSW EQU   PSA+32
FLCEOPSW EQU   PSA+24
@NM00066 EQU   FLCICCW2+4
FLCCVT   EQU   FLCICCW2
FLCICCW1 EQU   FLCROPSW
FLCIPPSW EQU   FLCRNPSW
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RC00361 EQU   @RC00359
@RC00367 EQU   @RC00365
@RF00355 EQU   @RC00347
@RC00524 EQU   @RC00522
@RC00534 EQU   @RC00531
@RC00541 EQU   @RC00539
@RC00589 EQU   @RC00587
@RC00613 EQU   @RC00611
@RF00643 EQU   @RC00640
@RC00653 EQU   @RC00648
@RC00724 EQU   @EL00015
@RC00811 EQU   @RC00809
@RC00818 EQU   @RC00809
@RT01134 EQU   FNDPLH
@RF01101 EQU   @EL00001
@RC01083 EQU   @EL00001
@ENDDATA EQU   *
         END   IDA019RU,(C'PLS1036',0701,78201)

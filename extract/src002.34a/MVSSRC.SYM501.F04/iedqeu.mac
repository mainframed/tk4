EU01     TITLE '''IEDQEU'' - TCAM OPEN/CLOSE SUBTASK'
IEDQEU   CSECT
*A-000000-999999                                               @X31X8N0
         SPACE 3
******************** MICROFICHE FLAGS *********************** SUPT CODE
*A022600-023200,061000,148100-148500,188200-189400,344200-345600,Y01004
*A415000,474200-475600,548020-548040,578060-578540,586867-586881,Y01004
*A614040-614320,641000,662450,665000,667000,800600-800700,       Y01004
*A821802-821948,834000,875703-875754                             Y01004
*C072000,226000,306000,414000,436000,522000,548000,578000,586840,Y01004
*C630000,640000,662400,662800-662900,663200,664000,666000,744000,Y01004
*C748000,800500                                                  Y01004
*D228000-300000,308000,330000,438000,586845,587800,624000-626000,Y01004
*D630600-638000,642000-656000,662200,663000,668000,752000,       Y01004
*D764000-776000,854000-856000                                    Y01004
*C567000                                                         X02004
*A413000,865000                                                  X03039
*C012080,026000-028000,701600,786200-786300                      X03039
*D320000-328000,398200-399800,573001-573010,587233,614080-614200,X03039
*D786000-786100,786480-786880,844000-846000,875500-875600,875742,X03039
*D883500,888000,911500                                           X03039
*C012080                                                       @Z30X8NM
*C586785,586840-586860                                           Y05330
*D586786,586867-586874,586881,800500-800700                      Y05330
*C022000-037000,044000,060000,061000,064000,070000,072000,088000 Y02027
*C120000,178000,304000,340000,344200-345600,369500,370000,374000 Y02027
*C400000,402000,404000,408000,414000,415000,474200,474200-514000 Y02027
*C548000,548020,548040,564000,564300,565200,565500,567000,568000 Y02027
*C570000,586720,586920,587020,587080,587213,587216,604000,614040 Y02027
*C662300,663100,663500,750000,754000,762000,778200,778300,778600 Y02027
*C778700,780000,798000,821808,821818,821840,821848               Y02027
*C821850,821852,821874,821898,821900,826000,834000,875748,911500 Y02027
*D046000,148100-148500,210000,212000,312000,320000-328000        Y02027
*D360000-362000,366000,368000,376000,398200-399800,406000,416000 Y02027
*D430000-440000,456000-468000,516000-522000,548160,548240        Y02027
*D548320-549840,564600,564900,565800-566700,567300,573000-578540 Y02027
*D582000-584000,586840-586850,587110,587165,614080-614320,660000 Y02027
*D786480-786880,821810-821816,821820-821828,821838,821842,821854 Y02027
*D821906-821946,828000,840000-846000,849400-849800,864000-874000 Y02027
*D875500-875600,875730-875745,875760,875880                      Y02027
*A060500,061500,071000,073000,188000-198000,225000,340300-341500 Y02027
*A345800-347760,371000-373000,375000,414500,420400-421600,445000 Y02027
*A449000-452000,472500-473500,474250-514000,548010,548030        Y02027
*A548050-548070,569000,571000,579270-579830,608400-609600        Y02027
*A614020-659640,663520-663580,746600-747200,751000,754080-755920 Y02027
*A778650,821851,834080-835920,875749,892060-893800,911570-911920 Y02027
*A821600,848000                                                 SA55382
*A028000,368000,376000,548000,614000,656000,8757000              S22027
*C586890                                                        SA55382
*C786000                                                         S22027
*D884000                                                         S22027
*D656720-656740,656770-656790                                   SA53603
*A820400                                                        SA53603
*C046000,152000-154000,207200,656000,656190,657120,684000        S22025
*C830000,832000                                                  S22025
*A701200                                                         A47139
*C150000,701600,882500                                           A42393
*C150000,882500                                                  S21101
*C656350                                                         A42382
*D657040-657080                                                  S21101
*A656080                                                         A42396
*A206600,206900,586950,656760,656890                             A48269
*C820000                                                         A48269
*D819540,819820                                                  A48269
*A656320                                                         A49227
*D656330,656390                                                  A49227
*A776000                                                        SA51082
*C149000-150000,612000,730000                                   SA51082
*D718000                                                        SA51082
*A662000                                                        SA51092
*D670000                                                        SA51092
*A466000                                                        SA52507
*A594000                                                        SA53625
*A586400,586950                                                 SA52971
*C172000,587050-587490,890000                                   SA52971
*D206300-207500,586855-586857,656025-657190,818070-821600       SA52971
*A573001-573010                                                 SA56920
*C586700-586830                                                 SA59162
*C586700                                                        SA59000
*A778000                                                        SA59000
*A778300                                                        SA62376
*A586710,586750,587030,821607                                   SA63961
*A398000,786400                                                 SA64000
*D413000,448400-455000,800500-801500                            SA64000
*D586790                                                        SA63957
*A586860,586890                                                 SA63957
*A587228                                                        SA65388
*A587213                                                        SA66619
*A587010,734000,875970                                          SA67159
*A780000                                                        SA68210
*D345060-345120                                                 OX03937
*A 224000,754000                                                OY00490
*D 310000-312000                                                OY00490
* A587030                                                       OY03851
* C587036-587040                                                OY03851
*A735400                                                        OY03924
*D322000                                                         Y06327
*C628840                                                       @ZA00906
*A647690                                                       @ZA00235
*D648840                                                       @ZA00235
*C587012,587014                                                @YA04902
*A192000                                                       @ZA00907
*A780120,780480                                                @YA05169
*C780540                                                       @YA05169
*A587010                                                       @YA06283
*D587020,587031                                                @YA06283
*A476850,875990                                                @SA71519
*A631640,635640                                                @ZA01155
*D629240-630440                                                @SA70283
*D780180                                                       @ZA02065
*A780240                                                       @ZA02065
*D677000-686000                                                @YA07682
*D586460-586520                                                @SA72476
*A780520                                                       @ZA02602
*C478200                                                       @ZA02056
*D190100-190200,354000,356000,481850-481970,564100             @ZA02601
*D746600-747300                                                @ZA02601
*C214000-222000,333000,346080-347040,347440-347760             @ZA02601
*C502300-503500548071-548311,586720-586730,638840-643240       @ZA02601
*C656040-656440,754320,754560-755600,762000,786100-786300      @ZA02601
*C821818-821840,821882-821888,821904-821948                    @ZA02601
*A482050,482350,637640,643640,754160,835120,875724,893170      @ZA02601
*A420400,421600,428000,448000,467000,472500                    @YA08086
*C790000,794000-808000                                         @YA08086
*D474000,787000                                                @YA08086
*A332000,223000                                                @SA70894
*D329000,756000-760000                                         @SA70894
*C904000                                                       @SA74021
*A477650                                                       @SA73573
*420000                                                        @SA74065
*A428000,862000                                                @ZA03745
*A628840                                                       @ZA03123
*A633240                                                       @YA09127
*C482055,482070,781020,780540-780600                           @YA09755
*D780360,835150-835160                                         @YA09755
*A781080,830000,882000                                         @YA09755
*A344200,347440                                                @ZA04027
*C587225-587228                                                @YA10244
*A488000                                                       @ZA05000
*D494000-497000                                                @ZA05000
*A332500,875995                                                @XA11307
*C586400                                                       @XA11307
*C490000-502000                                                @Z40X9NG
*A876000                                                       @Z40X9NG
*C821866-821880                                                @ZA06620
*A568000                                                       @SA76288
*C568600-568800                                                @SA76288
*A781110                                                       @YA11505
*C586920                                                       @OZ07798
*A568500                                                       @OS76679
*D568600-568700                                                @OS76679
*C587080-587159                                                @OY12440
*C341200,834400,649240                                         @OZ09293
*C488600                                                       @OZ09920
*C617240,626840-628440,629640,630440                           @OY12956
*D633340-633440                                                @OY12956
*A833000,894000,621240,637040                                  @OY12956
*C420500-420700,812000                                         @OZ09921
*A834000,806900                                                @OZ09921
*D408000                                                       @OZ09956
*A332000,332700                                                @OZ09951
*A199000,549271,835120                                         @OZ11167
*C629640,630440                                                @OZ14179
*C633240,636320                                                @OY14493
*A632440,835680,875997,636200,636840                           @OY14493
*D628840-630840                                                @OY14493
*D587116,821761-821782                                         @OY15028
*C587089-587113,821670-821684,821705-821712,821726-821740      @OY15028
*C821754                                                       @OY15028
*D781110-781560                                                @OZ17603
*A586730                                                       @OZ18783
*C632640                                                       @OZ24771
*           TCAM 10.0 CHANGES                                  @G36XRNP
*A875998,480200-480400,633452                                  @G36XRNP
*C510000-512000,548000,568590,586950,636260,636290,735700      @G36XRNP
*D833300,480250-480300                                         @G36XRNP
*                                                              @G36XRNP
*A448500,472700                                                @OZ27843
*C579550,570000-571000                                         @OZ26305
*A579620                                                       @OZ28213
*C636210                                                       @OZ27547
*A636270                                                       @OZ27547
*C587128-587146                                                @OS80123
*A568300                                                       @OZ29235
*A196000                                                       @OY20422
*A618440                                                       @OZ30337
*A420400,908000                                                @OY20522
*D474750,474950                                                @OY20522
*C658440-658840                                                @OZ32188
*D633454-633456                                                @OZ33239
***********************************************************************
*                                                                     *
*TITLE: 'IEDQEU' OPEN/CLOSE SUBTASK                                   *
*                                                                     *
*  MODULE NAME = IEDQEU   (TCAM,INITIALIZATION)                @G36XRNP
*                                                                     *
*  DESCRIPTIVE NAME = OPEN/CLOSE SUBTASK                              *
*                                                                     *
*  COPYRIGHT = 'NONE'                                                 *
*                                                                     *
*  STATUS:  CHANGE LEVEL 10.0                                  @G36XRNP
*                                                                     *
*FUNCTION: THIS ROUTINE IS A LOGICAL EXTENSION OF APPL PROG OPEN AND  *
*   CLOSE EXECUTORS.  IT ALLOCATES AND DEALLOCATES MAIN STORAGE IN    *
*   THE MCP REGION OR PARTITION FOR CONTROL BLOCKS NECESSARY TO       *
*   COMPLETE THE CROSS-PARTITION DATA TRANSFER INTERFACE, INCLUDING   *
*   ONE LCB PER PCB, ONE PEB PER PCB, AND ONE PEWA + SCB + TRT        *
*   PER PROCESS ENTRY IN CSA. THE PEWAS AND PEBS ARE CHAINED AT       *
*   OPEN AND DECHAINED AT CLOSE OFF THE TCX.                          *
*   IF CHECKPOINT IS ACTIVE, THE TTR TABLE IS SEARCHED.  IF           *
*   MATCHING ENTRY IS FOUND IN CKREQ- TTR TABLE, THE FLAG BYTE        *
*   IS ZEROED.                                                        *
*                                                                     *
*   AT OPEN TIME, ERROR CHECKS ARE PERFORMED FOR INVALID QNAME        *
*   AND PROCESS ENTRY IN USE.  IN ADDITION, OPEN                      *
*   PERFORMS PARTIAL INITIALIZATION OF THESE CONTROL BLOCKS.  IT      *
*   LOADS AND DELETES GET SCHEDULER, PUT SCHEDULER, POINT-MCP         *
*   ROUTINE AS REQUIRED BY PROCESS ENTRY TYPE, THE ADDRESSES OF       *
*   THE SCHEDULERS ARE PLACED IN THE AVT AND ADDR OF QCBS IN TCX.     *
*
*   IF MESSAGES ARE ON THE QCB-FEFO CHAIN, IT BUILDS AN ERB TO        *
*   START THE READ AHEAD PROCESS.  IF NO MESSAGES ARE ON ANY          *
*   PRIORITY LEVEL QCB, THE STCB IS MOVED FROM THE RAQCB TO           *
*   DEST. QCB.                                                        *
*                                                                     *
*   IF USER HAS SPECIFIED QBACK=YES ON TPROCESS, THIS MODULE     S22027
*   LOADS AND DELETES THE QRESET EXECUTOR.                            *
*                                                                     *
*        AT CLOSE TIME, THE PEWA IS FLAG AS CLOSING.                  *
*        FOR INPUT DCBS, THE BUFFERS ON THE READ AHEAD QUEUE ARE      *
*   PUT ON THE RETURN BUFFER QCB, THE SEQ. NO. IS RESTORED IN         *
*   THE TERMINAL TABLE, AND THE MESSAGE PUT BACK IN THE FEFO          *
*   CHAIN. THE LAST MESSAGE IS MARKED SERVICED.                       *
*        FOR OUTPUT DCBS, THE MESSAGE ON THE READ AHEAD QUEUE         *
*   IS  POSTED TO THE MESSAGE HANDLER AFTER ADJUSTING SIZE AND        *
*   FORCING EOM. BUFFERS ON THE ERB CHAIN ARE POSTED TO THE           *
*   RETURN BUFFER QUEUE. THE ERB IS REMOVE FROM THE BUFFER            *
*   RETURN QCB IF NECESSARY.                                          *
*      THE WAITING EXECUTOR IS POSTED COMPLETE VIA XMPOST.            *
*                                                                     *
*ENTRY POINT:                                                         *
*        IEDQEU                                                       *
*INPUT:                                                               *
*   1  - ADDRESS OF SPECIAL OPEN CLOSE RCB                            *
*   11 - DISPATCHER ADDRESS                                           *
*   13 - REGISTER SAVEAREA ADDRESS                                    *
*   15 - ENTRY POINT ADDRESS                                          *
*OUTPUT:                                                              *
*    NONE                                                             *
*EXTERNAL ROUTINES:                                                   *
*        POST - CROSS MEMORY                                          *
*        LOAD                                                         *
*        GETMAIN                                                      *
*        IEDQA1 - USED TO VALIDATE QNAME AND GET TT OFFSET            *
*EXITS-NORMAL:                                                        *
*        OPEN-DSPDISP,DSPPOST                                         *
*        CLOSE-DSPDISP OR DSPCHAIN(BUFFER POSTING)                    *
*EXITS-ERROR:                                                         *
*        SAME AS 'NORMAL' EXCEPT RCBERR IN RCB CONTAINS ERROR CODE    *
*        X'01' GETMAIN FAILURE                                        *
*        X'0F' INVALID QNAME                                          *
*        X'0C' PROC ENTRY IN USE                                      *
*TABLES/WORKAREAS:                                                    *
*        AVT                                                          *
*        QCB                                                          *
*        TERMINAL ENTRY                                               *
*        SCB                                                          *
*        LCB                                                          *
*        PEWA                                                         *
*        PCB                                                          *
*        RCB                                                          *
*ATTRIBUTES -- REUSABLE,REENTERANT,PROBLEM PROGRAM MODE.              *
*                                                                     *
*NOTES: THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL         *
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  *
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   *
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     *
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          *
***********************************************************************
         EJECT
*                                        *
*  S Y M B O L I C    R E G I S T E R S  *
*                                        *
         SPACE
RZERO    EQU   0
RPARM    EQU   1                        PARAMETER REGISTER
RRECB    EQU   2                        RECB BASE REGISTER       Y02027
RPENTRY  EQU   3                        ADDRESS OF PROCESS ENTRY
RQCB     EQU   4                        ADDR OF DESTINATION QCB
RPCB     EQU   5                        ADDRESS OF PROCESS CONTROL BLK
RCOUNT   EQU   6                        GETMAIN BYTE COUNTER
RWORK    EQU   7                        ADDR OF GETMAIN WORKAREA
RTEMP    EQU   8                        GENERAL WORK REGISTER
RLCB     EQU   9                        ADDR OF LINK CONTROL BLOCK
RPEWA    EQU   10                       PROCESS ENTRY WORKAREA
RDISP    EQU   11                       DISPATCHER BASE REGISTER
RBASE    EQU   12                       CSECT BASE REGISTER
RSAVE    EQU   13                       SAVEAREA & AVT BASE REG
RETURN   EQU   14                       RETURN ADDRESS
RENTRY   EQU   15                       ENTRY POINT ADDRESS
         SPACE 2
IEDQEU   IEDHJN
         DC    AL1(DSPMCPL4)            STCB VTO = 6             S22025
         DC    AL3(*-1)                 STCB ADDRESS             S22025
         BALR  RBASE,RZERO              ESTABLISH
         USING *,RBASE                           ADDRESSABILITY
         EJECT
*                                                   *
* I N I T I A L I Z E   B A S E   R E G I S T E R S *
*                                                   *
         SPACE 2
         USING IEDQDISP,RDISP           DISPATCHER ADDRESSABILITY
         USING AVTSAVE2,RSAVE           AVT ADDRESSABILITY      SA52971
         USING IEDQPCB,RPCB             PROCESS CONTROL BLOCK
*                                       ADDRESSABILITY
         USING IEDQRECB,RRECB           SET RECB BASE REGISTER   Y02027
         USING IEDQQCB,RQCB
         USING IEDQTRM,RPENTRY
         USING IEDQPEWA,RPEWA           BASE REGISTER FOR PROCESS
*                                       ENTRY WORKAREA
*****************************************************************Y02027
*              GET ADDRESS OF PROCESS ENTRY                      Y02027
*****************************************************************Y02027
         USING IEDQPEB,RWORK            SET PEB BASE REGISTER    Y02027
         USING IEDQTCX,RETURN           BASE FOR TCX             Y02027
         LR    RRECB,RPARM              SAVE RCB ADDRESS         Y02027
         TM    RECBKEY,OPENFLG          OPEN OR CLOSE.           Y02027
         BNO   CLOSE                    BRANCH IF CLOSE.         Y02027
         LA    RPARM,RCBDSNM            PT TO PROC ENTRY ID      Y02027
         SR    RLCB,RLCB                SET SWITCH TO ZERO       Y02027
         LA    RZERO,EIGHT              LOAD MAXIMUM LENGTH      Y02027
         LA    RENTRY,SEVEN(RPARM)      ADDR LAST CHAR         @ZA00907
NAMELOOP EQU   *                                               @ZA00907
         CLI   ZERO(RENTRY),BLANK       END OF NAME            @ZA00907
         BNE   SEARCH                   BR IF YES              @ZA00907
         BCTR  RENTRY,ZERO              DECREMENT NAME PTR     @ZA00907
         BCT   RZERO,NAMELOOP           LOOK AT NEXT CHAR      @ZA00907
         B     ABORT1                   NO NAME                @ZA00907
SEARCH   EQU   *                                               @ZA00907
         L     RENTRY,AVTMSGS-ONE       GET VCON TABLE ADDRESS   Y02027
         L     RENTRY,EIGHT(RENTRY)     LOAD ADDRESS OF IEDQA1   Y02027
         BAL   RETURN,FOUR(RENTRY)      SEARCH TERMNAME TABLE    Y02027
         LTR   RENTRY,RENTRY            PROCESS ENTRY FOUND      Y02027
         BZ    ABORT1                   BRANCH-NO                Y02027
         LR    RPARM,RENTRY             TERM NAME TABLE OFFSET   Y02027
         STH   RPARM,RECBQCBA+ONE       SAVE PROC ENTRY OFFSET   Y02027
         L     RENTRY,AVTRNMPT          ADDRESS OF CONVERSION RTNY02027
         BALR  RETURN,RENTRY            GET PROC ENTRY ADDRESS   Y02027
         LR    RPENTRY,RPARM            ADDRESS OF PROCESS ENTRY Y02027
         TM    TRMSTATE,TRMPROC         IS TPROCESS BIT ON     @OY20422
         BZ    ABORT1                   NO, FAIL OPEN          @OY20422
         TM    TRMSTATE,TRMLINE+TRMLIST   TPROCESS ONLY BIT ON @OY20422
         BNZ   ABORT1                   NO, NOT A TPROCESS ENT @OY20422
         NC    TRMSTAT(THREE),TRMSTAT   IS PROCESS ENTRY IN USE. Y02027
         BNZ   ABORT2                   BRANCH IN USE            Y02027
         L     RQCB,TRMDESTQ-1          DESTINATION QCB ADDRESS
         TM    QCBDSFLG,QSPEC           PUT TPROCESS ENTRY?    @OZ11167
         BZ    OUTPUT                   BR, YES                @OZ11167
         CLI   RCBDCBMA,ZERO            IS OPEN FOR OUTPUT     @OZ11167
         BE    ABORT4                   YES,INVALID OPEN       @OZ11167
         B     OPENOK                   CONT OPEN              @OZ11167
OUTPUT   EQU   *                                               @OZ11167
         CLI   RCBDCBMA,ZERO            OUTPUT DCB             @OZ11167
         BNE   ABORT4                   NO,  INVALID OPEN      @OZ11167
OPENOK   EQU   *                                               @OZ11167
         L     RPCB,QCBDCBAD-1          ADDRESS OF PROCESS CONTROL
*                                       BLOCK
         EJECT
***************************************************************@ZA02601
*              GET CORE FOR PEB                                @ZA02601
***************************************************************@ZA02601
         SR    RCOUNT,RCOUNT            CLEAR FOR ICM          @ZA02601
         ICM   RCOUNT,HIGH,PCBUCNT      GET PCB COUNT          @ZA02601
         BNZ   PWRKA                    BRANCH NOT FIRST USE   @ZA02601
         LA    RWORK,SPCSANFP           SUBPOOL FOR PEB        @ZA02601
         LA    RCOUNT,PEBSIZE           SIZE OF PEB            @ZA02601
         BAL   RETURN,GETMS             GET PEB CORE           @ZA02601
         ST    RPARM,PCBPEBAD           STORE PEB ADDR IN PCB  @ZA02601
         LR    RWORK,RPARM              COPY PEB ADDRESS       @ZA02601
         MVC   PEBASID,RCBASID          APPL ASID              @ZA02601
         MVC   PEBASCB,RCBASCB          APPL ASCB ADDRESS      @ZA02601
         MVC   PEBTCB,RCBTCB            APPL TCB ADDRESS       @ZA02601
         MVC   PCBJOBNA,RCBJOBNM        APPL JOBNAME TO PCB    @ZA02601
         ST    RPCB,PEBPCB              STORE PCB ADDR IN PEB  @ZA02601
         NC    PCBLCBAD+1(3),PCBLCBAD+1 NEED AN LCB            @SA70894
         BNZ   PWRKA                    BRANCH NOT FIRST USE   @SA70894
         LA    RCOUNT,LCBLEN            SIZE OF LINE CONTROL BLOCK
         LA    RWORK,SPLCB              SUBPOOL FOR LCB IN MCP   Y02027
         BAL   RETURN,GETMS             GET MAIN STORAGE FOR LCB Y01004
* C O M P L E T E   L C B   I N I T I A L I Z A T I O N
         LR    RLCB,RPARM               ADDRESS OF LINE OCB      Y02027
         STCM  RLCB,ADDR,PCBLCBAD+ONE   PUT LCB ADDRESS INTO PCB Y01004
         USING IEDQLCB,RLCB             LINE CONTROL BLOCK       Y02027
         MVI   LCBFLAG1,X'C2'           IOS FLAGS
         MVI   LCBECBCC,X'7F'           NORMAL COMPLETION CODE
         ST    RPCB,LCBDCBPT            PCB ADDRESS
PWRKA    EQU   *
         TM    DCBOFLGS-IHADCB(RPCB),OPEN    PCB OPEN          @OZ09951
         BO    PCBOPEN                  YES, BRANCH            @OZ09951
         OI    DCBOFLGS-IHADCB(RPCB),OPEN  SET PCB AS OPEN     @SA70894
         XC    PCBCNT,PCBCNT            INITIALIZE 'PUT' COUNT @XA11307
*                                        TO ZERO               @XA11307
PCBOPEN  EQU   *                                               @OZ09951
         L     RWORK,PCBPEBAD           LOAD PEB ADDR FROM PCB @ZA02601
         CLC   PEBASID,RCBASID          ASID'S MATCH           @ZA02601
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601
         CLC   PEBASCB,RCBASCB          ASCB ADDRESS'S MATCH   @ZA02601
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601
         CLC   PEBTCB,RCBTCB            TCB ADDRESS'S MATCH    @ZA02601
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601
         CLC   PCBJOBNA,RCBJOBNM        JOB NAMES MATCH        @ZA02601
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601
         SR    RLCB,RLCB                INITIALIZE SWITCH TO ZERO
         SR    RCOUNT,RCOUNT            CLEAR COUNTER TO ZERO
         IC    RCOUNT,AVTSCBSZ          STATION CONTROL BLOCK SIZE
         LA    RCOUNT,PEWASIZE(,RCOUNT) ADD IN PEWA SIZE.        Y02027
         CLI   RCBDCBMA,ZERO            TEST FOR INPUT DCB       Y02027
         LA    RWORK,SPCSANFP           SUBPOOL FOR PEWA IN CSA  Y02027
         BE    NOTRT                    BRANCH IF NOT INPUT      Y02027
         LA    RCOUNT,TRTLEN(,RCOUNT)   ADD TRT TABLE LENGTH   @OZ09293
NOTRT    EQU   *                                                 Y02027
         LA    RCOUNT,LCBCHAIN-IEDQLCB+FOUR(RCOUNT) LCB BUMP    OY00490
         BAL   RETURN,GETMS             BRANCH TO GETMAIN
*                                       SUBROUTINE
         LA    RPEWA,LCBCHAIN-IEDQLCB+FOUR(RPARM) PEWA ADDR.    OY00490
         BAL   RETURN,LOCK              GO GET LOCK            @ZA04027
         L     RPARM,CVTPTR             LOAD CVT ADDRESS         Y02027
         L     RETURN,CVTAQAVT-CVT(RPARM)  LOAD TCX ADDRESS      Y02027
         L     RENTRY,TCXPEWAC          ADDRESS OF 1ST PEWA IN   Y02027
*                                       CHAIN                    Y02027
CHAINPEW ST    RENTRY,PEWALINK          POINTER TO PREVIOUS HD OFY02027
*                                       CHAIN                    Y02027
         CS    RENTRY,RPEWA,TCXPEWAC    CHAIN NEW PEWA ON FRONT  Y02027
         BNE   CHAINPEW                 OF OLD CHAIN             Y02027
         EJECT
         L     RWORK,PCBPEBAD           ADDRESS OF PEB         @ZA02601
         SR    RCOUNT,RCOUNT            CLEAR FOR ICM          @ZA02601
         IC    RCOUNT,PCBUCNT           GET PCB COUNT          @ZA02601
         LTR   RCOUNT,RCOUNT            FIRST USE OF PCB       @ZA02601
         BNZ   HAVEPEB                  BRANCH NOT FIRST USE   @ZA02601
         L     RENTRY,TCXPEBC           ADDRESS 1ST PEB IN CHAIN Y02027
CHAINPEB ST    RENTRY,PEBLINK           PT TO PREV HD OF CHAIN   Y02027
         CS    RENTRY,RWORK,TCXPEBC     CHAIN NEW PEB ON         Y02027
         BNE   CHAINPEB                 FRONT OF OLD CHAIN       Y02027
HAVEPEB  EQU   *                                               @ZA02601
         BAL   RETURN,UNLOCKIT          UNLOCK                 @ZA04027
*                                   *
* INITIALIZE PROCESS ENTRY WORKAREA *
*                                   *
         AH    RCOUNT,HONE              INCREMENT USE COUNT BY ONE
         STC   RCOUNT,PCBUCNT           PUT NEW USE COUNT IN PCB
         TM    TRMSTAT+3,QR             HAS QUEUE RESET FUNCTION S22027
*                                       BEEN REQUESTED           S22027
         ST    RPEWA,TRMSTAT            STORE PEWA ADDR.         Y02027
         BNO   CONTINU                  BRANCH IF NO Q-RESET.    Y02027
         L     RETURN,CVTPTR            CVT ADDR.                Y02027
         L     RETURN,CVTAQAVT-CVT(,RETURN) TCX ADDR.            Y02027
         LOAD  EP=IEDQGQ                LOAD Q-RESET MODULE      Y02027
         ST    RZERO,TCXQRQ             STORE GQ ADDR IN TCX.    Y02027
         OI    PEWAGSW+ONE,ARESET       INDICATE Q-RESET PRESENT.Y02027
CONTINU  EQU   *                                                 S22027
         ST    RPCB,PEPCBAD             ADDRESS OF PROCESS
*                                       CONTROL BLOCK
         ST    RPENTRY,PEWAPROC         BACK CHAIN TO PROCESS ENTRY
         LA    RQCB,PERAQCB             ADDRESS OF MAIN STORAGE QCB
         MVI   QCBDSFLG,RAQCBKEY        QCB KEY FIELD
         MVC   QCBELCHN(3),AVTDELAD+1   STORE ADDRESS OF DUMMY LAST
*                                       ELEMENT IN ELEMENT CHAIN
*                                       FIELD OF QCB
         MVI   QCBPRI,RAQCBPRI          PRIORITY FIELD
         MVC   PEWALREC,RCBDCBLR        MOVE DCBLRECL TO PEWA.   Y02027
         MVC   PEWAOPTC,RCBDCBOP        MOVE OPTION BYTE TO PEWA.Y02027
         MVC   PEWAPETO,RECBQCBA+ONE    MOVE PROC ENTRY OFFSET   Y02027
         L     RTEMP,TRMDESTQ-1         DESTINATION QCB ADDRESS
         MVC   PEWADEB,RCBDEBAD         APPL PROG DEB ADDRESS    Y02027
         L     RCOUNT,CVTPTR            LOAD CVT ADDR.           Y02027
         L     RCOUNT,CVTAQAVT-CVT(RCOUNT) LOAD TCX ADDR.        Y02027
         CLI   0(RTEMP),QCBFQCB         PUT PROCESS ENTRY
         BE    PUT                      BRANCH IF YES
         NI    QCBFLAG-IEDQQCB(RTEMP),AVTEFF-QCBSDFFO          @SA74065
*                                       SET QCB NOT SENDING    @SA74065
         OI    PEWAOPT2,PEWAIN          SET INPUT INDICATOR.     Y02027
         LA    RZERO,TRMTPIN            GET TPROCESS FIELD FLG @OY20522
         LR    RPARM,RPENTRY            GET TPROCESS ADDR      @OY20522
         L     RENTRY,AVTDDFT           DEV DEP LOOKUP RTN ADDR@OY20522
         ST    RSAVE,PEWASAVE           SAVE R13 PTR           @OY20522
         LA    RSAVE,PEWASAVE+FOUR      SAVE AREA- CALLED RTN  @OY20522
         BALR  RETURN,RENTRY            GET DEV DEP INFO       @OY20522
         L     RSAVE,PEWASAVE           RESTORE R13            @OY20522
         USING IEDPROC,RENTRY           ADDRESSABILITY         @OY20522
         MVI   RCBSQ,ZERO               CLEAR SECURE Q FLG     @OY20522
         LTR   RENTRY,RENTRY            DEV DEP INFO SPEC?     @OY20522
         BZ    NODEVDEP                 BR, NO                 @OY20522
         TM    PROFLAG,PROSECQ          SECURE Q SPEC          @OY20522
         BNO   NOSECURE                 BR, NO                 @OY20522
         MVI   RCBSQ,SECURE             SET SECURE Q FLG       @OY20522
NOSECURE EQU   *                                               @OY20522
         TM    PROFLAG,PRODATE          DATE=YES ON TPROCESS   @OY20522
         BNO   NODEVDEP                 BR, NO                 @OY20522
         OI    PEWAOPT2,PEWADATE        SET DATE=YES FOR TPDATE@OY20522
NODEVDEP EQU   *                                               @OY20522
         DROP  RENTRY                                          @OY20522
         TM    RCBDCBMA,POINT           IS IT POINT            @OZ09921
         BNO   NOTPTS                   BR,NO                  @OZ09921
         NC    TCXPNTQ+1-IEDQTCX(3,RCOUNT),TCXPNTQ+1-IEDQTCX(RCOUNT)
*                                       POINT RTN LOADED       @OZ09921
         BNZ   NOTPTS                   BR YES                 @OZ09921
         MVI   MNAME+FIVE,PTS           POINT MODULE SUFFIX.     Y02027
         BAL   RETURN,LOADER            LOAD POINT MODULE.       Y02027
         ST    RZERO,TCXPNTQ-IEDQTCX(RCOUNT) POINT RTN. ADDR.    Y02027
NOTPTS   EQU   *                                               @YA08086
         LA    RETURN,0(0,RPEWA)
         LA    RTEMP,LCBCHAIN-IEDQLCB   LCB OFFSET
         SR    RETURN,RTEMP             DUMMY LCB ADDRESS
         ST    RETURN,PEWALCBA          SET UP FOR GET/READ MH
         MVI   LCBFLAG1-IEDQLCB(RETURN),XC2  DUMMY IOS FLAGS   @ZA03745
         CLI   TCXGETQ+ONE-IEDQTCX(RCOUNT),AVTEZERO            @YA08086
*                                        ALREADY LOADED        @YA08086
         BNE   NOTEW                    BRANCH IF YES          @YA08086
         MVI   MNAME+5,GS               MODULE IDENTIFIER
         BAL   RETURN,LOADER            GO LOAD MODULE
         ST    RZERO,TCXGETQ-IEDQTCX(RCOUNT) GET SCHD. ADDR.     Y02027
         AH    RZERO,AVTHA2             BUMP PAST OFFSET
         ST    RZERO,AVTEW              GET SCHEDULER
NOTEW    EQU   *                                               @YA08086
         L     RPARM,TCXGETQ-IEDQTCX(RCOUNT) QCB ADDR - IEDQEW @OZ27843
         L     RPARM,EIGHT(RPARM)       GET STCB PTR           @OZ27843
         ST    RPARM,PEWASTCB           PUT STCB PTR IN DUMMY  @OZ27843
*                                        QCB                   @OZ27843
         L     RPARM,PEWALCBA           ADDRESS OF DUMMY LCB     Y02027
         MVC   LCBTTCIN-IEDQLCB(2,RPARM),PEWAPETO SET UP TO TT   Y02027
         MVC   LCBTTBIN-IEDQLCB(2,RPARM),PEWAPETO ENTRY OFFSET   Y02027
         B     CLEANUP1                 PREPARE TO RETURN        Y02027
         EJECT
PUT      EQU   *
         XC    PERAQCB(4),PERAQCB       CLEAR FOR PUT ENTRY     SA52507
         CLI   AVTEC+1,AVTEZERO         ALREADY LOADED         @YA08086
         BNE   PUT1                     BRANCH IF YES          @YA08086
         MVI   MNAME+5,PS               MODULE IDENTIFIER
         BAL   RETURN,LOADER            GO LOAD MODULE
         ST    RZERO,TCXPUTQ-IEDQTCX(RCOUNT) PUT SCHD. ADDR.     Y02027
         ST    RZERO,AVTEC              PUT SCHEDULER ADDRESS  @YA08086
PUT1     EQU   *                                               @YA08086
         L     RPARM,TCXPUTQ-IEDQTCX(RCOUNT) QCB ADDR - IEDQEC @OZ27843
         L     RPARM,EIGHT(RPARM)       GET STCB PTR           @OZ27843
         ST    RPARM,PEWASTCB           PUT STCB PTR IN DUMMY  @OZ27843
*                                        QCB                   @OZ27843
         OI    PEWAOPT2,PEWAOUT         SET OUTPUT INDICATOR.    Y02027
         OI    PEWAGSW+ONE,NEEDHDRN     SET NEED HDR FLAG IN PEWAY02027
         LA    RPARM,PEWAQCBS           MAKE STCB POINT          Y02027
         ST    RPARM,PEWAQCBS           TO ITSELF                Y02027
         MVI   PEWAQCBS,PSVTO           PUT SCHED. VTO           Y02027
         SPACE
CLEANUP1 EQU   *                                                 Y02027
         LA    RPARM,PERAQCB            MAIN STG QCB             Y02027
         STCM  RPARM,ADDR,PERCQCB+ONE   SET DUMMY LCB            Y02027
         MVC   PEWAGSW(1),RCBDCBRF      PUT RECFM IN PEWA        Y02027
         OI    PEWAGSW,RETRIEVE         SET RETREIVE OK FLAG     Y02027
         MVC   PEWAFLG1(1),RCBDCBF1     PUT DCBFLAG1 IN PEWA     Y02027
         MVC   PEWACBUF,AVTDELAD        MOVE IN DUMMY ADDR.      Y02027
         OI    TRMDEVFL,HEX80           INDICATE BUFSIZE SPEC.   Y02027
         TM    TRMSTATE,TRMOPTFN        OPTION FLDS SPECIFIED-   Y02027
         BO    COMPOPTF                 BRANCH-YES.              Y02027
         LA    RPARM,TRMOPTBL           ADDR OF BUFSIZE FLD.     Y02027
         B     SETBFZ                   GO SET BUFFER SIZE.      Y02027
COMPOPTF EQU   *                                                 Y02027
         SR    RPARM,RPARM              CLAER REG.               Y02027
         IC    RPARM,TRMOPNO            LOAD NO. OF OPT FLDS.    Y02027
         LA    RPARM,TRMOPT+ONE(RPARM)  GET ADDR OF BUFSIZE FLD  Y02027
SETBFZ   EQU   *                                                 Y02027
         TM    RCBDCBDS,PHYSSEQ         TEST FOR PHYS. SEQ.      Y02027
         BO    BUFLTST                  BRANCH IF YES.           Y02027
MOVEBFZ  EQU   *                                                 Y02027
         MVC   ZERO(TWO,RPARM),PCBBFSZE MOVE BUFSIZE FROM PCB.   Y02027
         B     SETCNT                   GO SET UNIT COUNT.       Y02027
BUFLTST  EQU   *                                                 Y02027
         NC    RCBDCBBU,RCBDCBBU        IS BUFSIZE IN DCB.       Y02027
         BZ    MOVEBFZ                  BUFSIZE NOT IN DCB.      Y02027
         MVC   ZERO(TWO,RPARM),RCBDCBBU MOVE BUFSIZE OF DCB.     Y02027
SETCNT   EQU   *                                                 Y02027
         SR    RENTRY,RENTRY            CLEAR REG.               Y02027
         LR    RETURN,RENTRY            CLEAR REG.               Y02027
         ICM   RENTRY,THREE,ZERO(RPARM) BUFFER SIZE              Y02027
         STCM  RENTRY,THREE,PEWASOWA    STORE BUFSIZE IN PEWA.   Y02027
         LH    RZERO,AVTKEYLE           LOAD UNIT SIZE           Y02027
         DR    RETURN,RZERO             COMPUTE UNIT/BUFFER.     Y02027
         LTR   RETURN,RETURN            TEST FOR REMAINDER.      Y02027
         BZ    STORE                    GO STORE UNIT/BUFFER.    Y02027
         LA    RENTRY,ONE(,RENTRY)      ROUND TO NEXT UNIT.      Y02027
STORE    EQU   *                                                 Y02027
         STC   RENTRY,PEUNCT            STORE UNIT COUNT IN PEWA.Y02027
         MVC   PEWABFCT,PCBBUFMX        MOVE BUFMAX TO PEWA.     Y02027
         LA    RZERO,AVTBFRTB           BUFFER RETURN QCB ADDR.  Y02027
         LA    RPARM,AVTINOUT           MH PARAMETER.            Y02027
         STM   RZERO,RPARM,PEWASCB      INITIALIZE SCB FLDS.     Y02027
         CLI   RCBDCBMA,NULL            TEST DCB TYPE.           Y02027
         BE    EXITTST                  BRANCH IF OUTPUT DCB.    Y02027
         OI    PEWAFLG,MHOK             SET MH OK FLAG IN PEWA.  Y02027
         NI    PEWAOPTC,PARTOFF         CLEAR PART BUF FLAG    @SA71519
*****   MOVE GET SCHEDULER STCB FROM READ-AHEAD QCB STCB.        Y02027
*****     CHAIN TO STCB CHAIN OF THE DESTINATION QCB.            Y02027
STCBMOVE EQU   *                                                 Y02027
         L     RQCB,TRMDESTQ-ONE        ADDR OF DEST QCB         Y02027
         LA    RENTRY,QCBSTVTO-IEDQQCB(RQCB) LOAD STCB CHAIN ADDRY02027
         ST    RENTRY,QCBSTVTO-IEDQQCB(RQCB) CHAIN STCB TO ITSELFY02027
         MVI   QCBSTVTO-IEDQQCB(RQCB),GETSCHD  SET FOR GET SCHD, Y02027
         L     RENTRY,CVTPTR            LOAD CVT ADDR.           Y02027
         L     RENTRY,CVTAQAVT-CVT(RENTRY) LOAD TCX ADDR.        Y02027
         L     RENTRY,TCXGETQ-IEDQTCX(RENTRY) LOAD GET SCHD ADDR.Y02027
         LA    RENTRY,EIGHT(RENTRY)     POINT TO GET SCHD STCB   Y02027
         ST    RENTRY,PEWAQCBS          STORE STCB IN STCB OF    Y02027
*                                       READ AHEAD QCB           Y02027
*                                                                Y02027
         L     RQCB,TRMDESTQ-ONE        GET DEST QCB ADDR        Y02027
         OI    QCBFLAG,QCBPROC          PROCESS QCB FLAG.        Y02027
         TM    QCBDSFLG,QCBHELD         REUSEABILITY IN        @SA73573
         BO    CKPTTST                  YES-BYPASS READ-AHEAD  @SA73573
         SR    RETURN,RETURN            CLEAR REG.               Y02027
         USING IEDQPQCB,RQCB            PRIORITY QCB BASE        Y02027
         LA    RQCB,IEDQPQCB-IEDQQCB(RQCB)  GET ADDRESS OF       Y02027
*                                       PRIORITY QCB             Y02027
QLOOP    EQU   *                                                 Y02027
         NC    QCBFFEFO,QCBFFEFO        TEST FOR COMPLETE MSG.   Y02027
         BNZ   ERBFIX                   BUILD ERB TO BRING MSG-  Y02027
*                                        ONTO RD-AHEAD QUEUE.    Y02027
         NC    QCBPRIPQ,QCBPRIPQ        TEST FOR LAST PRIRITY QCBY02027
         BZ    CKPTTST                  TEST FOR CHECK POINT     Y02027
         LA    RQCB,QCBPSIZE(RQCB)      PT TO NEXT LEVEL QCB   @ZA02056
         LA    RETURN,ONE(,RETURN)      INCREMENT PRI. QCB CNTR. Y02027
         B     QLOOP                    CHECK NEXT PRIORITY QCB. Y02027
         EJECT                                                   Y02027
*****    START READ- AHEAD PROCESS HERE.                         Y02027
ERBFIX   EQU   *                                                 Y02027
         USING IEDQSCB,RWORK            SET UP SCB BASE REG.     Y02027
         LA    RWORK,PEWASCB            LOAD SCB ADDR.           Y02027
         MVC   SCBDESTQ,TRMDESTQ        MOVE DEST. QCB ADDR.     Y02027
         MVC   SCBSCHDR,QCBFFEFO        MOVE DISK/CORE REC. NO.  Y02027
         MVC   SCBSCSEG,QCBFFEFO        MOVE DISK/CORE REC NO.   Y02027
         STC   RETURN,SCBPRI            SET PRIORITY IN SCB      Y02027
         LA    RTEMP,PEERB              ERB ADDR IN PEWA.        Y02027
         USING LCBERB,RTEMP             SET UP ERB BASE.         Y02027
         XC    LCBERB(TWELVE),LCBERB    CLEAR ERB                Y02027
         LA    RENTRY,AVTDSIOB          DISK I/O QCB ADDR.       Y02027
         ST    RENTRY,LCBERBQB-ONE      PUT ADDR OF QCB IN ERB.  Y02027
         ST    RWORK,LCBSCBA-ONE        STORE SCB ADDR IN LCB.   Y02027
         MVI   LCBERBKY,ERBKEY          PUT ERB KEY IN ERB.      Y02027
         MVI   LCBERBPY,ERBPRI          PUT PRIORITY IN ERB.     Y02027
         MVC   LCBERBCT(ONE),PEWABFCT   MOVE BUFFER LIMIT.       Y02027
         OI    PEWAFLG,ERBBUSY          SET ERB BUSY FLAG.       Y02027
         L     RQCB,TRMDESTQ-ONE        DESTINATION QCB ADDRESS  Y02027
         USING IEDQQCB,RQCB                                      Y02027
         OI    QCBFLAG,QCBSDFFO         SET SEND FLAG.           Y02027
         L     RWORK,PEWALCBA           DUMMY LCB ADDR.          Y02027
         MVI   LCBSTAT1-IEDQLCB(RWORK),LCBSENDN SET LCB SENDING. Y02027
         LA    RLCB,FOUR                INDICATE ERB FOR DSPPOST.Y02027
         L     RWORK,TRMDESTQ-ONE       DEST QCB CONTAINS STCB   Y02027
         LA    RPENTRY,PERAQCB          ADDRESS OF QCB TO WHICH  Y02027
*                                       STCB IS TO BE MOVED      Y02027
         BAL   RETURN,DSPUNAVR          PUT STCB IN RAQCB        Y02027
         LR    RPARM,RTEMP              ERB TO BE POSTED         Y02027
         L     RPENTRY,PEWAPROC         RESTORE TT ADDRESS       Y02027
         B     CKPTTST                  SET  CKREQ-TTR TABLE     Y02027
         EJECT                                                   Y02027
*****   ERB IS READY TO BE POSTED TO THE ASYNC READY QUEUE.    @G36XRNP
CKPTTST  EQU   *                                                 Y02027
         LA    RTEMP,EXITTST            SET EXIT ADDRESS         Y02027
CKPTRTN  EQU   *                                                 Y02027
         TM    AVTCKFLG,AVTCKTAC        IS TCAM CKPT ACTIVE    @G36XRNP
         BNOR  RTEMP                    BRANCH IF NO CHKPT     @ZM46636
         L     RENTRY,AVTTCB            GET TCAM TCB ADDRESS   @G36XRNP
         USING IEDQTCB,RENTRY           TCB ADDRESSABILITY     @G36XRNP
         LA    RENTRY,TCBDEB-(DEBDEBAD-DEBNMSUB) GET ADDR OF   @G36XRNP
*                                       TCAM DEB CHAIN AS      @G36XRNP
*                                       DUMMY 1ST DEB          @G36XRNP
         DROP  RENTRY                   TCB ADDRESSABILITY     @G36XRNP
         USING DEBNMSUB,RENTRY          DEB ADDRESSABILITY     @G36XRNP
         DROP  RETURN                   TCX ADDRESSABILITY     @G36XRNP
         USING IHADCB,RETURN            DCB ADDRESSABILITY     @G36XRNP
CKPTLOOP EQU   *                                               @G36XRNP
         L     RENTRY,DEBDEBAD          GET ADDR OF NEXT DEB   @G36XRNP
         L     RETURN,DEBDCBAD          GET ADDR OF DCB        @G36XRNP
         TM    DCBDSRG2,DCBDSGTQ        IS THIS TCAM QUEUE     @G36XRNP
*                                       DATA SET               @G36XRNP
         BNO   CKPTLOOP                 NO, GET NEXT DEB       @G36XRNP
         TM    DCBOPTCD,CHECKPT         IS THIS THE TCAM       @G36XRNP
*                                       CHKPT DCB              @G36XRNP
         BNO   CKPTLOOP                 NO, GET NEXT DEB       @G36XRNP
         L     RENTRY,DCBIOBAD          GET CHKPT WORKAREA     @G36XRNP
         TM    TRMSTATE,TRMHELDN        CHECK FOR SYNC=YES       Y02027
         BZR   RTEMP                    BRANCH IF SYNC=NO        Y02027
         SR    RETURN,RETURN            CLEAR REGISTER           Y02027
         DROP  RENTRY                   DEB ADDRESSABILITY     @G36XRNP
         DROP  RETURN                   DCB ADDRESSABILITY     @G36XRNP
         USING IEDQCKPD,RENTRY          CKPT WORK AREA BASE REG@G36XRNP
         IC    RETURN,CKPCKRQS          NUMB OF CKREQS SPECIFIED Y02027
         LTR   RETURN,RETURN            TEST FOR ZERO CKREQS     Y02027
         BZR   RTEMP                    BRANCH IF ZERO CKREQS    Y02027
         LA    RETURN,CKPCKRNO(,RETURN) NUMBER OF CKREQ DSK RECS Y02027
         L     RENTRY,CKPCTTRB          GET CKREQ-TTR TABLE      Y02027
*                                                                Y02027
*              LOOK FOR PROC ENTRY IN CKREQ-TTR TABLE            Y02027
*                                                                Y02027
QNB40    EQU   *
         TM    CKPCTFLG(RENTRY),CKPCTDER CHECK FOR DISK ERROR    Y02027
         BO    QNB42                    BRANCH IF DISK ERROR     Y02027
         CLC   CKPCTTTR(TWO,RENTRY),PEWAPETO COMPARE OFFSETS.    Y02027
         BE    QNB89                    BRANCH IF TT OFFSETS =   Y02027
QNB42    EQU   *                                                 Y02027
         LA    RENTRY,CKPCTTRL(,RENTRY) MOVE TO NEXT ENTRY       Y02027
         BCT   RETURN,QNB40             SCAN CKREQ-TTR TABLE     Y02027
         BR    RTEMP                    BRANCH ENTRY FOUND       Y02027
QNB89    EQU   *                                                 Y02027
         MVI   CKPCTFLG(RENTRY),ZERO    ZERO BYTE IN CKREQ-TTR TBY02027
         BR    RTEMP                    EXIT                     Y02027
EXITTST  EQU   *                                                 Y02027
         MVC   RCBDEBTA,PEWAPETO        MOVE PROC ENRTY OFFSET.  Y02027
         STCM  RPEWA,ADDR,RCBDEBPW      STORE PEWA ADDR.         Y02027
         STCM  RPCB,ADDR,RCBDEBPC       STORE PCB ADDR.          Y02027
         MVC   RCBPEBAD,PCBPEBAD+ONE    MOVE PEB ADDR.           Y02027
CLEANUP  EQU   *                                                 Y02027
         TM    RECBKEY,OPENFLG          TEST FOR OPEN.           Y02027
         BO    OPENBR                   BRANCH IF OPEN           Y02027
         LA    RZERO,AIBKEY-IEDQAIB     ADJUST FOR AIB         @YA09755
         LA    RETURN,ZERO(RRECB)       COPY RCB ADDRESS       @ZA02601
         SR    RETURN,RZERO             NOW AT AIB             @ZA02601
         CLC   AIBECBA-IEDQAIB(FOUR,RETURN),QOT1               @YA09755
*                                        ENTRY FROM RTM        @YA09755
         BNE   NOTRTM                   NO, BRANCH             @ZA02601
         MVI   ZERO(RETURN),ZERO        FREE AIB               @ZA02601
         B     NOPOST                   SKIP POST              @ZA02601
NOTRTM   EQU   *                                               @ZA02601
         L     RETURN,CVTPTR            LOAD CVT ADDR            Y02027
         L     RETURN,CVTAQAVT-CVT(,RETURN) LOAD TCX ADDR.       Y02027
         USING IEDQTCX,RETURN           TCX ADDRESSABILITY     @G36XRNP
         MVC   RCBPEBAD,TCXASCB+ONE     MOVE MCP ASCB ADDR       Y02027
         LA    RETURN,AVTOPCOB+FOUR     GET CLOSEDOWN ECB ADDR   Y02027
         STCM  RETURN,ADDR,RCBOPECB     AND PUT IN RCB           Y02027
         MVC   RCBAVTBT,AVTBIT1         PASS BITS TO A.P. CLOSE  Y02027
         B     ERROR                    SKIP CLEAR OF RETURN CD@ZA02601
OPENBR   EQU   *                                                 Y02027
         XC    RCBERR,RCBERR            STORE  NORMAL RETURN CODEY02027
ERROR    EQU   *
***** ISSUE CROSS MEMORY POST TO APPLICATION PGM ECB.            Y02027
         LR    RPENTRY,RPARM            SAVE ACROSS POST         Y02027
         SR    RZERO,RZERO              CLEAR COMPLETION CODE  @ZA05000
         IC    RZERO,RCBERR             PICK UP COMP CODE      @ZA05000
         L     RPARM,CVTPTR             CVT PTR                @ZA05000
         ICM   RPARM,ALL,CVTAQAVT-CVTMAP(RPARM)  TCX ADDR      @ZA05000
         L     RETURN,PCBPEBAD          PEB ADDR               @ZA05000
         CLC   RCBASID+TWO(2),TCXASID-IEDQTCX(RPARM)           @OZ09920
*                                       IS A.P. A SUBTASK OF   @ZA05000
*                                         THE MCP              @ZA05000
         BNE XMPOST                     BR NO FOR XMPOST       @ZA05000
         L     RPARM,RCBPECB            GET ECB ADDR           @ZA05000
         POST  (1),(0)                  DO NORMAL POST         @ZA05000
         B     NOPOST                   BYPASS XMPOST          @ZA05000
XMPOST   EQU   *                                               @ZA05000
*        ISSUE SVC 102 TO HAVE SRB SCHEDULED IN APPLICATION    @Z40X9NG
*        PROGRAM'S MEMORY TO DO POST                           @Z40X9NG
         LA    RPARM,RCBPECB            POINT TO PARM LIST     @Z40X9NG
         USING SSRBSECT,RPARM           PARM LIST ADDRESS      @Z40X9NG
         MVI   SSRBENTC,SSRBCODE        SET ENTRY CODE         @Z40X9NG
         STC   RZERO,SSRBCC             SET COMPLETION CODE    @Z40X9NG
         AQCTL                          ISSUE SVC 102          @Z40X9NG
         DROP  RPARM                                           @Z40X9NG
NOPOST   EQU   *                                               @ZA02601
         LR    RPARM,RPENTRY            RESTORE REG.             Y02027
         B     BTAB(RLCB)               BRANCH TO PROPER EXIT.   Y02027
BTAB     EQU   *                                                 Y02027
         B     DSPDISP                  RETURN TO DISPATCHER.  @G36XRNP
         BAL   RETURN,DSPPOST           RETURN AND POST ELEMENT@G36XRNP
         B     CLEANPUT                 CHAIN IN ELEMENTS.       Y02027
CLEANPUT EQU   *
         L     RPEWA,AVTSAVE2+4         RESTORE ELEMENT ADDR     Y02027
         LR    RPARM,RPEWA              ADDRESS OF ELEMENT CHAIN
ENDLOOP  EQU   *
         CLC   5(3,RPEWA),AVTFZERO      END OF CHAIN
         BE    OK                       BRANCH IF YES
         CLC   5(3,RPEWA),AVTDELAD+1    END OF CHAIN
         BE    SETEND                   BRANCH IF YES
         L     RPEWA,4(0,RPEWA)         ADDRESS OF NEXT ELEMENT
         B     ENDLOOP                  GO CHECK THIS ONE
SETEND   EQU   *
         XC    5(3,RPEWA),5(RPEWA)      SET END OF CHAIN INDICATOR
OK       EQU   *
         BAL   RETURN,DSPCHAIN          BRANCH TO DISPATCHER   @G36XRNP
         EJECT                                                   Y02027
ABORT1   EQU   *                        PROCESS ENTRY NOT FOUND. Y02027
         MVI   RCBERR,NTFND             SET RETURN CODE FOR POST.Y02027
         B     ERROR                    POST APPLIC. ECB COMPLETEY02027
ABORT2   EQU   *                        PROC. ENTRY IN USE.      Y02027
         MVI   RCBERR,INUSE             SET RETURN CODE.         Y02027
         B     ERROR                    GO POST APPLIC. ECB COMP.Y02027
ABORT3   EQU   *                                               @ZA02601
         MVI   RCBERR,PCBINVLD          SET INVALID PCB RETURN @ZA02601
         B     ERROR                    POST APPL ECB COMPLETE @ZA02601
ABORT4   EQU   *                                               @OZ11167
         MVI   RCBERR,INVAL             INVALID OPEN  043-2    @OZ11167
         B     ERROR                    POST ECB COMPLETE      @OZ11167
         EJECT
*
*  THIS SECTION HANDLES CLOSE REQUESTS FOR PROCESS ENTRIES
*
CLOSE    EQU   *
*                                               *
         SR    RLCB,RLCB                SET SWITCH TO ZERO
         L     RPEWA,RCBDSNM            LOAD PEWA ADDR FROM RCB. Y02027
*                                       IS TERMINATING           Y02027
         L     RPENTRY,PEWAPROC         LOAD PROC ENTRY ADDR.    Y02027
         L     RQCB,TRMDESTQ-ONE        LOAD DEST. QCB ADDR.     Y02027
         LR    RCOUNT,RQCB              SAVE QCB ADDRESS         Y02027
         L     RPCB,QCBDCBAD-ONE        PCB ADDR.                Y02027
         OI    PEWAFLG,CFLG             TURN ON CLOSE FLAG.      Y02027
         TM    QCBDSFLG,QCBHELD         IS REUS PROCESSING THIS@SA76288
*                                        QUEUE NOW             @SA76288
         BNO   SETQCB1                  CONTINUE IF NO         @SA76288
         MVI   RCBERR,ZERO              RESET RCB POSTED FLAG  @OZ29235
         XC    PEWAELEM+8(2),PEWAELEM+8  SET SPECIAL ELEMENT   @SA76288
*                                       NOT IN USE FOR QEW     @SA76288
         LA    RCOUNT,QCBSTVTO          ADDR OF STCB           @OS76679
         ICM   RLCB,ADDR,QCBSTCHN       IS GET SCHED           @OS76679
         CR    RCOUNT,RLCB               DEST QCB              @OS76679
         BE    DSPDISP                  BR YES, DELAY PROCESSIN@OS76679
*                                        UNTIL REUS IS COMPLETE@OS76679
         LR    RPENTRY,RQCB             QCB TO WHICH STCB IS   @OS76679
*                                        TO BE MOVED           @OS76679
         LA    RWORK,PERAQCB            ADDR OF QCB NOW        @OS76679
*                                        CONTAINING THE STCB   @OS76679
         BAL   RETURN,DSPUNAV           MOVE SCHED             @G36XRNP
SETQCB1  EQU   *                                               @SA76288
         TM    PEWAGSW+ONE,RESETACT     QRESET IN PROGRESS       Y02027
         BNO   NQRESET                  BR,NO                  @OZ26305
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ26305
*                                      IEDQGQ WILL POST RCB    @OZ26305
         B     DSPDISP                  WAIT FOR QGQ POST      @OZ26305
NQRESET  EQU   *                                               @OZ26305
         CLI   QCBDSFLG,QCBFQCB         PUT PROCESS ENTRY
         BE    PUTQCBX                  BRANCH IF YES
*****************************************************************Y02027
******                     CLOSE INPUT DCB.                      Y02027
*****************************************************************Y02027
         TM    PEWAFLG,ERBBUSY          IS ERB BUSY.             Y02027
         BNO   QCBTEST                  BR NO, CONT CLOSE      @OZ26305
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ26305
*                                        IEDQEW WILL POST RCB  @OZ26305
         B     DSPDISP                  WAIT FOR IEDQEW POST   @OZ26305
QCBTEST  EQU   *                                                 Y02027
         L     RPARM,PEWALCBA           GET LCB ADDR           @OZ28213
         TM    LCBSTAT1-IEDQLCB(RPARM),LCBRCLLN    RETRIEVE?   @OZ28213
         BNO   NORTV                    BR, NO                 @OZ28213
         LA    RPARM,PEERB              GET ERB ADDR           @OZ28213
         LA    RLCB,PERAQCB             GET ADDR OF R.A. QCB   @OZ28213
         ST    RLCB,ZERO(RPARM)         R.A. QCB IN ERB        @OZ28213
         MVI   FOUR(RPARM),PRIBFRTB     ERB PRIORITY           @OZ28213
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ28213
*                                        IEDQEW WILL POST RCB  @OZ28213
         BAL   RETURN,DSPPOST           REPOST ERB TO GET OUT  @OZ28213
*                                        OF RETRIEVE MODE      @OZ28213
NORTV    EQU   *                                               @OZ28213
         L     RPARM,QCBSTVTO           LOAD STCB PTR            Y02027
         CLI   0(RPARM),GETSCHD         GET SCHED IN DEST QCB    Y02027
         BNE   REMOVEIT                 BR IF YES                Y02027
         MVC   QCBSTCHN,QCBSLINK        MOVE HM PTR              Y02027
         B     PUTQCB                   BR                       Y02027
REMOVEIT STCM  RPARM,SEVEN,QCBSLINK     REMOVE SCHED             Y02027
         DROP  RETURN                                            Y02027
         USING IEDQRECB,RRECB           SET UP BASE REG.         Y02027
         EJECT
PUTQCB   EQU   *
         LA    RQCB,PERAQCB             MAIN STORAGE QCB ADDRESS
         CLI   QCBDSFLG-IEDQQCB(RCOUNT),QCBFQCB  PUT QCB
         BNE   NOTPUT                   BRANCH IF NO           @XA11307
         ST    RPARM,AVTDOUBL           SAVE REG1 CONTENTS     @XA11307
         L     RPARM,PCBLCBAD           GET LCB ADDRESS        @XA11307
         CLI   LCBPRI-IEDQLCB(RPARM),PUTDELAY   IS LCB FROM    @XA11307
*                                        PUT TIME DELAY        @XA11307
         BNE   NOGET2                   BRANCH IF NO           @XA11307
         L     RENTRY,AVTHG02           ADDRESS OF SUBTASK TO  @XA11307
*                                        REMOVE LCB FROM       @XA11307
*                                        TIME DELAY            @XA11307
         BALR  RETURN,RENTRY            REMOVE LCB FROM DELAY  @XA11307
NOGET2   EQU   *                                               @XA11307
         L     RPARM,AVTDOUBL           RESTORE REG1 CONTENTS  @XA11307
         B     NOGET                    BR TO CONTINUE CLOSE   @XA11307
NOTPUT   EQU   *                                               @XA11307
         NC    EOMSAVE+1(2),EOMSAVE+1   MSG TO FLAG SERVICED
         BZ    CKPECBUF                 BRANCH IF YES           SA59000
         LA    RZERO,AVTDSIOB           DISK I/O QCB ADDRESS
         L     RPARM,EOMSAVE            BFR TO FLAG SERVICED
         MVI   PRFPRI-IEDQPRF(RPARM),PRIDKSRV MARK MSG TO BE SERVY02027
         MVI   PRFTIC-IEDQPRF(RPARM),TIC                         Y02027
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961
         BO    STOP                     BRANCH IF YES           SA63961
         TM    RCBTCBFL,TERM            IS APPL TERMINATING    @ZA02601
         BZ    SERVICE                  BRANCH IF NO           @ZA02601
         OI    PCBOFLG1,PCBABEND        SET PCB ABEND FLAG     @OZ18783
         TM    PCBOFLG1,PCBSFLAG        OMIT MSG SERVICING      SA59162
         BNO   SERVICE                  BRANCH IF NO            SA59162
STOP     EQU   *                                                SA63961
         LA    RZERO,AVTBFRTB           BUFFER RETURN QUEUE     SA59162
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB RETURN PRTY       SA59162
SERVICE  EQU   *                                                SA59162
         STCM  RZERO,ADDR,ONE(RPARM)    PUT QCB ADDR. IN BUFFER. Y01004
         LA    RTEMP,PEWASCB            SCB ADDRESS
         XC    EOMSAVE(4),EOMSAVE       SET NONE OTHER
         TM    PCBOFLG1,PCBABEND+PCBSFLAG  NO SERVICING WANTED  SA63957
         BNO   SERVX                    BRANCH IF NO            SA63957
         ICM   RZERO,ADDR,PERAQCB+ONE   TOP OF READ-AHEAD QUEUE  Y05330
         ST    RPARM,PERAQCB            TOP OF READ-AHEAD QUEUE SA63957
         STCM  RZERO,ADDR,FIVE(RPARM)   RE-LINK CHAIN            Y05330
         B     SERVY                    GO SET FEFO             SA63957
         SPACE
SERVX    EQU   *                                                SA63957
         BAL   RETURN,SETFEFO          BESURE FRFO PTR IS CORRECSA55382
SERVY    EQU   *                                                SA63957
         NI    PCBOFLG1,AVTEFF-PCBABEND CLEAR ABEND FLAG        SA63957
         L     RPARM,PEWARCB            LOAD RCB ADDRESS       @OZ07798
         BAL   RETURN,DSPPOST           REPOST SPECIAL ELEMENT @G36XRNP
         SPACE 1
*                                                                     *
*        IF MESSAGE IS READ AHEAD BUT NOT SENT TO APPL PROG, RESET    *
*        FEFO POINTER TO ALLOW MSG TO BE READ NEXT TIME DCB OPENS.    *
*
ENQUEUE  EQU   *
         CLC   QCBELCHN(3),AVTDELAD+1   READ AHEAD Q EMPTY     @YA06283
         BE    NOGET                    BR, IF YES             @YA06283
         L     RETURN,PERAQCB           BUFFER ADDRESS         @YA04902
         TM    PRFSTAT1-IEDQPRF(RETURN),PRFDUPLN               @YA04902
*                                       RECALLED BUFFER?       @YA04902
         BO    RETCLEAN                 BRANCH IF YES           SA67159
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961
         BO    NOUPDTE                  YES, BRANCH             OY03851
         TM    PEWAOPT2,OVERFLOW        WORKAREA OVERFLOW        Y02027
         BNO   NOOFLO                   BRANCH IF NO           @OY12440
*                                                              @OY12440
*        MESSAGE THAT CAUSED WORKAREA OVERFLOW MUST BE         @OY12440
*        DISCARDED BY MARKING IT SERVICED RATHER THAN          @YA12440
*        REINSERTING IT IN THE FEFO CHAIN                      @YA12440
         MVC   QCBELCHN(3),PRFLINK-IEDQPRF(RETURN)  REMOVE     @YA12440
*                                  BUFFER FROM READ-AHEAD QUEUE@YA12440
         NI    PRFSTAT1-IEDQPRF(RETURN),PRFNLSTF  FLAG AS EOM  @YA12440
         MVI   PRFPRI-IEDQPRF(RETURN),PRIDKSRV SERVICED PRTY   @YA12440
         LA    RPARM,AVTDSIOB           DISK I/O QCB           @YA12440
         ST    RPARM,PRFQCBA-1-IEDQPRF(,RETURN) SET QCB ADDR   @YA12440
         MVI   AVTDOUBL+4,ZERO          SET NO OVERFLOW        @YA12440
         SR    RZERO,RZERO              CLEAR FOR IC           @OY15028
         IC    RZERO,PRFTQBCK-IEDQPRF(RETURN) GET PRIORITY     @OY15028
*                                        LEVEL INDEX           @OY15028
         LA    RPARM,QCBPSIZE           SIZE OF PRILVL QCB     @OY15028
         MR    RZERO,RZERO              OFFSET TO PRIO QCB     @OY15028
         LA    RPARM,IEDQPQCB-IEDQQCB(RPARM,RCOUNT) GET ADDR   @OY15028
*                                        OF PRIORITY QCB       @OY15028
         MVC   PRFSRCE-IEDQPRF(L3,RETURN),QCBFFEFO-IEDQPQCB(RPARM)
*                                        SET FEFO PTR FOR FA   @OY15028
         LR    RPARM,RETURN             SET DISPATCHER PARM    @OY15028
         NI    PEWAOPT2,AVTEFF-OVERFLOW SET NO OVERFLOW        @OY12440
         LR    RTEMP,RPENTRY            SAVE PROCESS ENTRY     @OY12440
         LR    RZERO,RQCB               SAVE DEST QUEUE        @OY12440
         XC    FIVE(3,RPARM),FIVE(RPARM)   CLEAR LINK FIELD    @OS80123
         L     RPENTRY,PEWARCB          GET CLOSE ELEM ADDR    @OS80123
         STCM  RPARM,ADDR,FIVE(RPENTRY) CHAIN BUFF TO CLOSE ELE@OS80123
         LR    RPARM,RPENTRY            GET ELEM ADDR          @OS80123
         BAL   RETURN,DSPCHAIN          CHAIN ELEM ON RDY Q    @OS80123
NOOFLO   EQU   *                                               @OY12440
*        FIND CORRECT PRIORITY LEVEL QCB                              *
         NC    PRFSIZE-IEDQPRF(,RETURN),PRFSIZE-IEDQPRF(RETURN)  S22027
*                                       QUICK CLOSE BUFFER       S22027
         BZ    NOUPDTE                  BRANCH IF YES            S22027
         LA    RTEMP,IEDQPQCB-IEDQQCB(0,RCOUNT) FIRST PRTY LEVEL QCB
         SR    RZERO,RZERO              CLEAR WORK REGISTER      A49227
         IC    RZERO,PRFTQBCK-IEDQPRF(RETURN) SCB PRTY INDEX     A49227
         LA    RPARM,QCBPEND-IEDQPQCB   PRTY QCB LENGTH          A49227
         MR    RZERO,RZERO              PRTY QCB OFFSET          A49227
         AR    RTEMP,RPARM              CORRECT PRTY QCB         A49227
         LA    RPARM,PRFCRCD-IEDQPRF(,RETURN) SET THIS RCD PTR  SA52971
         TM    PRFSTAT1-IEDQPRF(RETURN),PRFNHDRN IS IT A HEADER SA52971
         BNO   HDR                      YES, GOT THE ONE DESIREDSA52971
         LA    RPARM,PRFCHDR-IEDQPRF(,RETURN) GET HEADER PTR    SA52971
HDR      EQU   *                                                SA52971
         TM    L'PRFCRCD-1(RPARM),CPBQTYPE IS THIS CORE PRT     SA52971
         BNZ   DISKONLY                 NO, WE'RE SET           SA52971
         MVC   AVTDOUBL+1(3),AVTEZERO(RPARM) GET QUEUED HEADER'SSA52971
         L     RENTRY,AVTDOUBL          ADDRESS.                 Y02027
         MVC   PRFIOADR-IEDQPRF(3,RENTRY),QCBFFEFO-IEDQPQCB(RTEMP) 6619
*                                       SET FEFO ADDRESS IN COPYSA66619
         LA    RPARM,PRFCRCD-IEDQPRF(RENTRY) SET PROPER FEFO ADD.Y02027
DISKONLY EQU   *                                                SA52971
         MVC   QCBFFEFO-IEDQPQCB(3,RTEMP),AVTEZERO(RPARM) BACK  SA52971
*                                       UP FEFO CHAIN          @YA10244
         NC    QCBLFEFO-IEDQPQCB(3,RTEMP),QCBLFEFO-IEDQPQCB(RTEMP)
*                                       IS LFEFO ZERO          @YA10244
         BNZ   NOFEFO                   NO, LFEFO IS OK        @YA10244
         MVC   QCBLFEFO-IEDQPQCB(3,RTEMP),AVTEZERO(RPARM)      @YA10244
*                                       RESET LFEFO            @YA10244
NOFEFO   EQU   *                                               @YA10244
         TM    PRFTIC-IEDQPRF(RETURN),PRFRESET QRESET BUFFER    SA65388
         BO    NOUPDTE                  BRANCH IF YES           SA65388
         MVC   TRMOUTSQ,PRFTQBCK+1-IEDQPRF(RETURN)    RESTORE    A42396
*                                        THE SEQUENCE NUMBER     A42396
NOUPDTE  EQU   *                                                 S22027
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QCB ADDRESS
XLOOP    EQU   *
         ST    RTEMP,PRFQCBA-1-IEDQPRF(0,RETURN) QCB ADDR IN HDR
         MVI   PRFPRI-IEDQPRF(RETURN),PRIBFRTB BUFFER RETURN PRTY
         CLC   PRFLINK-IEDQPRF(3,RETURN),AVTDELAD+1 END OF CHAIN
         BE    GETBFR                   BRANCH IF YES
         CLC   PRFLINK-IEDQPRF(3,RETURN),AVTFZERO END OF CHAIN
         BE    GETBFR                   BRANCH IF YES
         L     RETURN,PRFLINK-1-IEDQPRF(0,RETURN) NEXT BFR IN CHAIN
         B     XLOOP                    GO CHECK NEXT BUFFER     S22025
GETBFR   EQU   *
NOGET    EQU   *
         CLC   QCBELCHN(3),AVTDELAD+1   ELEMENT CHAIN EMPTY
         BE    INIT                     BRANCH IF YES
         NC    QCBELCHN(2),QCBELCHN     CHAIN EMPTY
         BZ    INIT                     BRANCH IF YES
         LA    RTEMP,PEERB              ERB ADDRESS             SA53625
         XC    LCBERBCH-LCBERB(3,RTEMP),LCBERBCH-LCBERB(RTEMP)  SA53625
*                                       CLEAR EMPTY BFR POINTER SA53625
         L     RTEMP,QCBELCHN-1         ADDR OF BUFFERS TO RETURNY02027
*                                       TO POOL OR BUFFER TO POST
*                                       TO MESSAGE HANDLER
         XC    QCBELCHN(3),QCBELCHN     SET AS EMPTY CHAIN
         LA    RLCB,EIGHT               SET FLAG TO INDICATE THERY02027
*                                       IS A CHAIN OF ELEMENTS TO
*                                       BE POSTED
         ST    RTEMP,AVTSAVE2+4         SAVE ELEMENT ADDR        Y02027
         CLI   QCBDSFLG-IEDQQCB(RCOUNT),QCBFQCB     PUT QCB
         BNE   INIT                     BRANCH IF NO            SA51082
         CLI   PRFPRI-IEDQPRF(RTEMP),PRIAPBFR  EOM BFR TO MH     Y02027
         BE    CLEANPUT                 BRANCH IF YES           SA51082
         EJECT
INIT     EQU   *
         ST    RLCB,AVTSAVE2            SAVE INDEX REG           Y02027
         NI    QCBFLAG-IEDQQCB(RCOUNT),AVTEFF-QCBSDFFO  SET QCB  Y02027
*                                       NOT SENDING              Y02027
         BAL   RTEMP,CKPTRTN            GO RESET CKPT-TTR ENTRY  Y02027
         L     RQCB,AVTTCB              LOAD MCP TCB ADDR.       Y02027
         L     RQCB,TCBDEB-IEDQTCB(RQCB) LOAD ADDR OF 1ST DEB.   Y02027
CHLCK011 EQU   *                                                 Y02027
         LA    RQCB,ZERO(,RQCB)         ZERO HIGH ORDER BYTE.    Y02027
         LTR   RQCB,RQCB                TEST DEB ADDR FOR ZERO   Y02027
         BZ    CHLCK060                 BR IF END OF CHAIN     @OY12956
*                                       TO CHECK FOR NCP TERM  @OY12956
         L     RETURN,DEBDCBAD-DEBNMSUB(RQCB)  LOAD DCB ADDR     Y02027
         TM    DCBDSORG+ONE-IHADCB(RETURN),IEDQLINE  IS IT LINE  Y02027
*                                       DCB                      Y02027
         BZ    CHLCK03                  BRANCH IF NOT LINE DCB.  Y02027
         TM    DCBOFLGS-IHADCB(RETURN),OPEN  IS DCB OPEN       @OZ30337
         BNO   CHLCK03                  BR, NO                 @OZ30337
         L     RLCB,DCBIOBAD-IHADCB(RETURN) IOB ADDR.            Y02027
         LA    RENTRY,LCBFLAG1-IEDQLCB  DISPLACEMENT FOR LCB.    Y02027
         SR    RLCB,RENTRY              LCB ADDR.                Y02027
         XR    RENTRY,RENTRY            CLEAR INDEX REG.         Y02027
         IC    RENTRY,DCBEIOBX-IHADCB(RETURN) LGTH OF LCB.       Y02027
         XR    RTEMP,RTEMP              CLEAR LOOP CONTROLL.     Y02027
         IC    RTEMP,DEBNMEXT-DEBNMSUB(RQCB)  NUMB LINES IN GRP  Y02027
         LA    RCOUNT,CHLCK021          RETURN REG             @OY12956
CHLCK02  EQU   *                                                 Y02027
         AR    RLCB,RENTRY              PT. TO NEXT LCB.         Y02027
         ICM   RETURN,ADDR,LCBSCBA-IEDQLCB(RLCB) LOAD SCB ADDR   Y02027
         TM    SCBSTATE-IEDQSCB(RETURN),SCBLCK1N CHK FOR LOCK    Y02027
*                                       MODE                     Y02027
         BO    CHLCK04                  BRANCH IF LOCK MODE.     Y02027
CHLCK021 EQU   *                                                 Y02027
         BCT   RTEMP,CHLCK02            CHK ALL LINES IN GRP.    Y02027
CHLCK03  EQU   *                                                 Y02027
         L     RQCB,DEBDEBAD-DEBNMSUB(RQCB)  PT TO NAXT DEB      Y02027
         B     CHLCK011                 CHK NEXT DEB.            Y02027
*** SEE IF LINE IS LOCKED TO PROCESS PGM. BEING CLOSED.          Y02027
CHLCK04  EQU   *                                                 Y02027
         L     RPARM,RCBDSNM            GET PEWA ADDR FROM RCB @OY12956
         CLC   PEWAPETO-IEDQPEWA(2,RPARM),LCBINSRC  IS PROCESS @OY12956
*                                        ENTRY LOCKED IN.      @OY12956
         BNER  RCOUNT                   BR, NO                 @OY12956
         LH    RPARM,LCBTTCIN-IEDQLCB(RLCB)    TNT OFFSET        Y02027
         N     RPARM,AVTCLRHI           CLEAR HIGH ORDER HALF.   Y02027
         STM   RZERO,RENTRY,AVTSAVE2+12  SAVE OVER DISPCALL    @ZA01155
         L     RENTRY,AVTRNMPT          TNT CONVERSION LOGIC.    Y02027
         BALR  RETURN,RENTRY            COMPUTE TERM ENTRY ADDR  Y02027
         LM    RETURN,RENTRY,AVTSAVE2+X44   RESTORE REGS       @OZ24771
         TM    LCBINSRC+TWO,X30         LOCK RESPONSE DUE      @OY14493
         BNZ   CHKBD                    BR YES                 @OY14493
         OI    SCBSTATE-IEDQSCB(RETURN),SCBMSGLN FORCE MSG LOCK@OY14493
         TM    LCBINSRC+TWO,X40         HM IN PROGRESS         @OY14493
         BOR   RCOUNT                   BR YES                 @OY14493
CHKBD    EQU   *                                               @OY14493
         NI    SCBSTATE-IEDQSCB(RETURN),UNLOCK RESET LOCK MODE @OY14493
         CLI   LCBINSRC+TWO,AVTEZERO    IS TERM IN EXTENDED    @OY14493
*                                       LOCK WAITING FOR       @OY14493
*                                       TERMINAL INPUT         @OY14493
         BNE   CHKBD1                   BR NO                  @OY14493
         BR    RCOUNT                   GET NEXT DEB OR TNT    @OY14493
CHKBD1   EQU   *                                               @OY14493
         TM    LCBINSRC+TWO,X80         BD IN PROGRESS         @OY14493
         MVC   LCBINSRC(3),AVTFZERO     CLEAR LCBINSRC         @OY14493
         BOR   RCOUNT                   YES, DB WILL POST LCB  @OY14493
*** POST LCB TO ITSELF.                                          Y02027
         ST    RLCB,LCBRCB               POST LCB TO ITSELF.     Y02027
         XC    LCBLINK,LCBLINK          CLEAR LINK FIELD.        Y02027
         MVI   LCBPRI,PRIEDISP          SET LCB PRIORITY.        Y02027
         LR    RPARM,RLCB               PT. RCB PTR. TO LCB.     Y02027
         BAL   RETURN,DSPPOSTR          POST LCB TO READY QUEUE. Y02027
         LM    RZERO,RENTRY,AVTSAVE2+12  RESTORE REGS          @ZA01155
         BR    RCOUNT                   CHECK NEXT ENTRY       @OY12956
CHLCK060 EQU   *                                               @OY12956
*                                       CHECK NCP TERMINALS    @OY12956
         TM    AVTSAVTF,AVTVTMCP        IS 3705 RUNNING        @OY12956
         BZ    CHLCK061                 BR,NO                  @OY12956
         LA    RCOUNT,CHLCK06A          RETURN ADDR            @OY12956
         L     RENTRY,AVTRNMPT          TERM NAME TABLE        @OY12956
         LH    RQCB,TNTLEN-IEDQTNTD(RENTRY)  NUM TNT ENTRIES   @OY12956
         N     RQCB,AVTCLRHI            CLEAR HI ORDER HALF    @OY12956
         SR    RTEMP,RTEMP              CLEAR FOR TNT LOOP     @OY12956
CHLCK06A EQU   *                                               @OY12956
         LA    RTEMP,ONE(RTEMP)         BUMP TO NEXT ENTRY     @OY12956
         LR    RPARM,RTEMP              INPUT TO TNT           @OY12956
         CLR   RQCB,RTEMP               END OF TNT             @OY12956
         BL    CHLCK061                 BR,YES                 @OY12956
         L     RENTRY,AVTRNMPT          TERM NAME TABLE        @OY12956
         BALR  RETURN,RENTRY            GET TERM ENTRY ADDR    @OY12956
         DROP  RPENTRY                  DROP TPROCESS TRM ENTRY@OY14493
         USING IEDNTRM,RPARM            TERM ENTRY ADDRESSABILI@OZ27547
         LA    RENTRY,TRMPRFSZ          TRM NEG PREFIX         @OZ27547
         SR    RPARM,RENTRY             BACK UP TO PREFIX      @OZ27547
         TM    TRMSTATE,XE0             IS IT TERM ENTRY       @OY12956
         BNZR  RCOUNT                   NO,CHECK NEXT ENTRY    @OY12956
         TM    TRMDSORG,TRMLGB          IS IT AN LGB           @OY12956
         BOR   RCOUNT                   YES, GET NEXT ENTRY    @OY12956
         TM    TRMSTATE,TRMPREF         IS IT NCP TERM         @G36XRNP
         BNOR  RCOUNT                   NO, GET NEXT ENTRY     @OY12956
         CLI   TRMTYPE,TRMLUNT          LOWER THAN LU          @OZ27547
         BLR   RCOUNT                   YES, GET NEXT ENTRY    @OZ27547
         CLI   TRMTYPE,TRMPSNA          HIGHER THAN PRESNA     @OZ27547
         BHR   RCOUNT                   YES, GET NEXT ENTRY    @OZ27547
         L     RETURN,TRMDESTQ-1        GET QCB ADDR           @OY12956
         LA    RENTRY,QCBPRFSZ          GET NEG PREFIX         @ZM47556
         SR    RETURN,RENTRY            BACK UP TO QCB PREFIX  @ZM47556
         TM    QCBSTAT1-IEDNQCB(RETURN),QCBPLCBN  PLCB ASSIGNED@OY12956
         BNOR  RCOUNT                   NO, CHECK NEXT TNT ENTR@OY12956
         ICM   RLCB,SEVEN,QCBPLCBA-IEDNQCB(RETURN) PLCB ADDR   @OY14493
         ICM   RETURN,ADDR,LCBSCBA-IEDQLCB(RLCB)  GET SCB ADDR @OY12956
         TM    SCBSTATE-IEDQSCB(RETURN),SCBLCK1N  IS IT LOCKED @OY12956
         BO    CHLCK04                  BR, YES                @OY12956
         BR    RCOUNT                   GET NEXT TNT ENTRY     @OY12956
CHLCK061 EQU   *                                                 Y02027
*** DELINK AND FREE CORE OF THE PEWA(SCB&T.R.T.)                 Y02027
         USING IEDQTRM,RPENTRY          TPROCESS TRM ENTRY     @OY14493
         L     RQCB,TRMDESTQ-1          RESTORE DEST QCB ADDR    Y02027
         DROP  RPEWA                    CHANGE PEWA BASE       @OY12956
         USING IEDQPEWA,RCOUNT                                 @OY12956
         SR    RCOUNT,RCOUNT            CLEAR REG                Y02027
         ICM   RCOUNT,SEVEN,RCBDSNM+ONE LOAD PEWA ADDR FROM RCB  Y02027
         BZ    PCBTEST                  BRANCH IF NO PEWA.       Y02027
         BAL   RETURN,LOCK              GET LOCAL AND CMS LOCKS@ZA02601
PEWADLNK EQU   *                                               @ZA02601
         L     RETURN,CVTPTR            LOAD CVT ADDR.           Y02027
         L     RETURN,CVTAQAVT-CVT(RETURN) LOAD TCX ADDR.        Y02027
         LA    RETURN,TCXPEWAC-IEDQTCX-PEWALINK+IEDQPEWA(RETURN)
*                                       DUMMY FIRST PEWA       @ZA02601
PEWADLN1 EQU   *                                               @ZA02601
         LR    RENTRY,RETURN            COPY PEWA ADDRESS      @ZA02601
         ICM   RETURN,ALL,PEWALINK-IEDQPEWA(RENTRY) NEXT PEWA  @ZA02601
         BZ    FREEPEWA                 END OF PEWA CHAIN      @ZA02601
         CR    RETURN,RCOUNT            THIS PEWA TO DELINK    @ZA02601
         BNE   PEWADLN1                 NO, GET NEXT PEWA      @ZA02601
         L     RETURN,PEWALINK-IEDQPEWA(RETURN) NEXT PEWA      @ZA02601
         CS    RCOUNT,RETURN,PEWALINK-IEDQPEWA(RENTRY)         @ZA02601
*                                       REMOVE PEWA            @ZA02601
         BNE   PEWADLNK                 RETRY IF FAILED        @ZA02601
FREEPEWA EQU   *                                                 Y02027
         BAL   RETURN,UNLOCKIT          RELEASE LOCKS          @ZA02601
         TM    PEWAGSW+ONE,ARESET       TEST FOR Q-RESET SPECD.  Y02027
         BNO   NOQRESET                 BRANCH IF NOT SPECIFID   Y02027
         DELETE EP=IEDQGQ               DELETE Q-RESET MODULE.   Y02027
         L     RPENTRY,PEWAPROC         LOAD PROC. ENTRY ADDR.   Y02027
         OI    TRMSTAT+THREE,QR         RESET Q-RESET SWITCH.    Y02027
NOQRESET EQU   *                                                 Y02027
         DROP  RCOUNT                                            Y02027
         USING IEDQPEWA,RPEWA           SET BASE.                Y02027
         SR    RCOUNT,RCOUNT            ZERO WORK REG.           Y02027
         IC    RCOUNT,AVTSCBSZ          PICK UP SCB SIZE.        Y02027
          LA    RCOUNT,PEWASIZE(,RCOUNT) ADD PEWA SIZE FOR FREEMZA00235
         TM    PEWAOPT2,PEWAIN          INPUT DCB                Y02027
         BNO   NOTRT1                   BR IF NOT INPUT          Y02027
         LA    RCOUNT,TRTLEN(,RCOUNT)   ADD TRT TABLE LENGTH   @OZ09293
NOTRT1   EQU   *                                                 Y02027
         LA    RTEMP,LCBCHAIN-IEDQLCB+FOUR ADJUST FOR LCB       OY00490
         AR    RCOUNT,RTEMP             ADD TO LENGTH           OY00490
         SR    RPEWA,RTEMP              ADDRESS TO FREE         OY00490
         LA    RTEMP,AVTDOUBL           PT. TO PEWA ADDR.        Y02027
         ST    RPEWA,AVTDOUBL           STORE PEWA ADDR.         Y02027
         BAL   RETURN,FREEMS            GO FREE PEWA.            Y02027
         B     PCBTEST                  GO CHECK PCB USE COUNT.  Y02027
         EJECT
         SPACE 1
*****************************************************************Y02027
******                       CLOSE OUTPUT DCB.                   Y02027
*****************************************************************Y02027
PUTQCBX  EQU   *                                                 Y02027
         SR    RENTRY,RENTRY            CLEAR FOR ICM            Y02027
         ICM   RENTRY,ADDR,PERAQCB+ONE  LOAD READ AHEAD ADDR.    Y02027
         BZ    NOBUF                    BRANCH IF RD-AHD EMPTY.  Y02027
         NI    PRFSTAT1-IEDQPRF(RENTRY),AVTEFF-PRFNLSTN  FLAG    Y02027
*                                       BUFFER AS EOM            Y02027
         MVC   PRFQCBA-IEDQPRF(THREE,RENTRY),PCBMH MH ADDR IN BFRY02027
         TM    RCBTCBFL,TERM            IS APPL TERMINATING    @ZA02601
         BZ    NOFLAG                   BRANCH IF NO           @ZA02601
         LA    RETURN,PEWASCB           LOAD SCB ADDR.           Y02027
         OI    SCBERR4-IEDQSCB(RETURN),SCBAPERR SET ERROR FLAG.  Y02027
NOFLAG   EQU   *                                                 Y02027
         LR    RETURN,RENTRY            COPY UNIT ADDR.          Y02027
         NC    NINE(2,RETURN),NINE(RETURN) LAST UNIT?          @OZ32188
         BZ    SETTIC                   BR, YES                @OZ32188
         ICM   RENTRY,SEVEN,NINE(RETURN)  NO, GET NEXT UNIT    @OZ32188
         B     NOFLAG                   CONT SCAN              @OZ32188
SETTIC   EQU   *                                               @OZ32188
         MVI   ELEVEN(RETURN),TWO       SET INVALID TIC ADDR.    Y02027
NOBUF    EQU   *                                                 Y02027
         LA    RQCB,PERAQCB
         LA    RTEMP,PEERB              ERB ADDRESS             SA51092
         LA    RENTRY,AVTBFRTB-FOUR     SIMULATE ELEMENT.        Y02027
         SR    RPARM,RPARM              CLEAR FOR ICM.           Y01004
         ICM   RPARM,ADDR,AVTBFRTB+ONE  TOP OF BUFFER RETURN Q.  Y01004
ERBLOOP  EQU   *                                                SA51092
         CLI   RECBPRI-IEDQRECB(RPARM),AVTEZERO END OF QUEUE    SA51092
         BE    NOTINQ                   BRANCH IF YES           SA51092
         CLR   RPARM,RTEMP              IS ERB IN QUEUE          Y01004
         BE    REMOVE                   BRANCH IF YES.           Y01004
         LR    RENTRY,RPARM             SAVE ELEMENT ADDR        Y02027
         ICM   RPARM,ADDR,RECBLINK-IEDQRECB(RPARM)  NEXT ELEMENT Y01004
         B     ERBLOOP                  GO CHECK THIS ONE       SA51092
REMOVE   EQU   *                                                SA51092
         DROP  RRECB                                             Y02027
         USING IEDQRECB,RENTRY          SET BASE.                Y02027
         MVC   RECBLINK(3),RECBLINK-IEDQRECB(RPARM) REMOVE ERB   Y02027
         DROP  RENTRY                                            Y02027
         USING IEDQRECB,RRECB           SET BASE.                Y02027
*                                       REMOVE ERB FROM QUEUE   SA51092
NOTINQ   EQU   *                                                SA51092
         ICM   RPARM,ADDR,QCBELCHN      GET ADDRESS OF PARTIAL   Y01004
*                                       BUFFER.                  Y01004
         CLM   RPARM,APPRI,AVTFZERO     WAS PARTIAL BUFFER SAVED Y01004
         BE    EMPTY                    BRANCH IF NO.            Y01004
         MVC   LCBERBCH-LCBERB(3,RTEMP),PRFLINK-IEDQPRF(RPARM)
         LH    RTEMP,PRFSIZE-IEDQPRF(0,RPARM)  BYTES OF DATA IN BFR
         N     RTEMP,AVTCLRHI           CLEAR HIGH-ORDER HALF
         CLI   TRMCHCIN,0               RECDEL SPECIFIED
         BE    NOBCTR                   BRANCH IF YES
         BCTR  RTEMP,0                  ACCOUNT FOR RECDEL BYTE
NOBCTR   EQU   *
         STH   RTEMP,PRFSIZE-IEDQPRF(0,RPARM) UPDATE PREFIX
         LA    RTEMP,PEWASCB            SCB ADDRESS
         L     RPARM,PRFLCB-1-IEDQPRF(0,RPARM) LCB ADDRESS
         ST    RTEMP,LCBSCBA-1-IEDQLCB(0,RPARM) SCB ADDRESS
         ST    RPEWA,LCBERCCW-IEDQLCB(,RPARM) SAVE PEWA ADDRESS  A47139
         OI    LCBERBST-IEDQLCB(RPARM),LCBDLNKN  DELINK SWITCH   A42393
         SPACE 2
EMPTY    EQU   *
         LA    RPARM,PEERB              PUT SCHEDULER'S ERB
         NC    LCBERBCH-LCBERB(2,RPARM),LCBERBCH-LCBERB(RPARM)
*                                       ERB EMPTY
         BE    PUTQCB                   BRANCH IF YES
         LR    RTEMP,RPARM              ERB ADDRESS
         L     RPARM,LCBERBCH-1-LCBERB(0,RPARM) ADDR OF FIRST BFR
         LA    RTEMP,AVTBFRTB
RLOOP    EQU   *
         ST    RTEMP,0(0,RPARM)         BFR RETURN QCB ADDR
         MVI   4(RPARM),PRIBFRTB        BFR RETURN PRIORITY
         NC    5(2,RPARM),5(RPARM)      END OF CHAIN
         BZ    TESTQCB                  BRANCH IF YES           SA51082
         L     RPARM,4(0,RPARM)         GET ADDR OF NEXT BUFFER
         B     RLOOP                    GO FIX THIS ONE
         SPACE 2
RETCLEAN EQU   *                                                SA67159
         ST    RQCB,PEWAELEM            SET QCB ADDRESS         SA67159
         MVI   PEWAELEM+4,RETPRI        SET PRIORITY            SA67159
         MVI   PEWAELEM+10,BLANK        SET RETRIEVE TERMINATIONSA67159
         LA    RPARM,PEWAELEM           ELEMENT ADDRESS         SA67159
         OI    PEWAFLG,CLOSFLG          SET CLOSEDOWN IN SESSIONSA67159
         BAL   RETURN,DSPPOST           POST ELEM TO EW        @G36XRNP
         EJECT
PCBTEST  EQU   *
         SR    RCOUNT,RCOUNT            CLEAR REGISTER TO ZERO
         IC    RCOUNT,PCBUCNT           PCB USE COUNT
         BCTR  RCOUNT,RZERO             DECREMENT USE COUNT BY 1 Y01004
         STC   RCOUNT,PCBUCNT           PUT NEW USE COUNT IN PCB
         LTR   RCOUNT,RCOUNT            IS PCB USE COUNT ZERO    Y01004
         BNZ   DELETER                  BRANCH IF NO             Y02027
CLSPCB   EQU   *                                                 Y02027
         NI    DCBOFLGS-IHADCB(RPCB),AVTEFF-OPEN SET PCB UNOPENED
         MVI   PCBOFLG,NULL             CLEAR FLAG BYTE          Y02027
         XC    PCBASID,PCBASID          CLEAR ASID OF A.P.       Y02027
*** DELINK AND FREE THE PEB POINTED TO BY PCB.                   Y02027
         BAL   RETURN,LOCK              GET LOCAL AND CMS LOCKS@ZA02601
PEBDLNK  EQU   *                                               @ZA02601
         L     RWORK,PCBPEBAD           LOAD PEB PTR.            Y02027
         SR    RETURN,RETURN            CLEAR FOR STCM         @ZA02601
         STCM  RETURN,ALL,PEBTCB-IEDQPEB(RWORK) CLEAR TCB ADDR @ZA02601
         L     RETURN,CVTPTR            LOAD CVT ADDR.           Y02027
         L     RETURN,CVTAQAVT-CVT(RETURN) LOAD TCX ADDR         Y02027
         LA    RETURN,TCXPEBC-IEDQTCX(RETURN) ADDR OF PEB CHAIN@ZA02601
PEBDLNK1 EQU   *                                               @ZA02601
         LR    RENTRY,RETURN            COPY PEB ADDRESS       @ZA02601
         ICM   RETURN,ALL,PEBLINK-IEDQPEB(RENTRY) NEXT PEB     @ZA02601
         BZ    FREEPEB1                 END OF CHAIN           @ZA02601
         CR    RETURN,RWORK             THIS PEB TO DELINK     @ZA02601
         BNE   PEBDLNK1                 NO, GET NEXT PEB       @ZA02601
         L     RETURN,PEBLINK-IEDQPEB(RETURN) NEXT PEB         @ZA02601
         CS    RWORK,RETURN,PEBLINK-IEDQPEB(RENTRY) REMOVE-PEB @ZA02601
         BNE   PEBDLNK                  RETRY IF CS FAILED     @ZA02601
FREEPEB1 EQU   *                                               @ZA02601
         BAL   RETURN,UNLOCKIT          RELEASE LOCKS          @ZA02601
         LA    RWORK,DELETER            EXIT ADDRESS           @ZA02601
FREEPEB  EQU   *                                                 Y02027
         LA    RCOUNT,PEBSIZE           LOAD SIZE FOR FREEMAIN.  Y02027
         LA    RTEMP,PCBPEBAD           ADDR OF PTR TO PEB.      Y02027
         BAL   RETURN,FREEMS            GO FREE PEB.             Y02027
         XC    PCBJOBNA,PCBJOBNA        CLEAR JOBNAME          @ZA02601
         BR    RWORK                    EXIT SUBROUTINE        @ZA02601
         SPACE 2                                                SA51082
TESTQCB  EQU   *                                                SA51082
         NC    QCBELCHN(2),QCBELCHN     BUFFER SAVED            SA51082
         BNZ   PUTQCB                   BRANCH IF YES           SA51082
         LA    RTEMP,PEERB              ERB ADDRESSABILITY      SA51082
         MVC   QCBELCHN(3),LCBERBCH-LCBERB(RTEMP) SAVE CHAIN    SA51082
         XC    LCBERBCH-LCBERB(3,RTEMP),LCBERBCH-LCBERB(RTEMP)  SA51082
*                                       CLEAR CHAIN TO ZERO     SA51082
         B     PUTQCB                   CONTINUE TO CLOSE       SA51082
         EJECT
CKPECBUF EQU   *                                                SA59000
         CLC   PEWACBUF+ONE(THREE),AVTDELAD+ONE BUFFER TO RETURN Y02027
         BE    ENQUEUE                  BRANCH IF NO            SA62376
         CLC   PEWACBUF+ONE(THREE),AVTFZERO  !UFFER TO RETURN    Y02027
         BE    ENQUEUE                  BRANCH IF NO            SA62376
         STM   RETURN,RBASE,AVTSAVE3+12 SAVE REGISTERS          SA59000
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QUEUE     SA59000
         L     RPARM,PEWACBUF           FIRST BUFFER ON QUEUE.   Y02027
         MVC   PEWACBUF+ONE(THREE),PRFLINK-IEDQPRF(RPARM) CLOSE- Y02027
*                                                       CHAIN.   Y02027
         ST    RTEMP,PRFQCBA-1-IEDQPRF(,RPARM) SET QCB ADDRESS  SA59000
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB SET PRIORITY      SA59000
         XC    PRFLINK-IEDQPRF(3,RPARM),PRFLINK-IEDQPRF(RPARM)  SA59000
*                                       SET LINK FIELD TO ZERO  SA59000
         BAL   RETURN,DSPPOSTR          PUT BFR ON READY QUEUE  SA59000
         LM    RETURN,RBASE,AVTSAVE3+12 RESTORE REGISTERS       SA59000
         B     CKPECBUF                 CONTINUE CHAIN SCAN     SA59000
         EJECT
DELETER  EQU   *                                                 Y02027
         STM   RETURN,RBASE,AVTSAVE3+12  SAVE REGS              SA68210
         L     RTEMP,AVTSAVTP           SECONDARY AVT           SA68210
         LA    RTEMP,0(,RTEMP)          CLEAR HIGH BYTE        @YA05169
         TM    AVTSAVTF,AVTVTMCP        VTAM IN MCP?             X03039
         BZ    DONE                     NO IT IS NOT IN THE SYSTMX03039
         LA    RPARM,SAVTRQCH-IEDNSVTD-FOUR(RTEMP) INIT PREVIOUS
*                                                     ENTRY     SA68210
         L     RTEMP,SAVTRQCH-IEDNSVTD(RTEMP) APP PROG QUEUE   @ZA02065
GETNEXT  EQU   *                                                SA68210
         LA    RTEMP,ZERO(RTEMP)        CLEAR HO BYTE           SA68210
         LTR   RTEMP,RTEMP              END OF QUEUE           @YA05169
         BZ    DONE                     YES, BRANCH            @YA05169
         CLM   RTEMP,ADDR,AVTDELAD+1    DUMMY ELEMENT?         @ZA02602
         BE    DONE                     BR YES                 @ZA02602
         LR    RCOUNT,RTEMP             COPY RCB ADDRESS       @YA09755
         SH    RCOUNT,SIXTEEN           BACK UP TO AIB         @YA09755
         CLM   RPCB,ADDR,AIBPCBAD+1-IEDQAIB(RCOUNT)            @YA09755
*                                        AIB FOR THIS PCB      @YA09755
         BE    FOUND                    BRANCH IF YES          @YA09755
         LR    RPARM,RTEMP              SAVE (PREVIOUS) ENTRY   SA68210
         L     RTEMP,FOUR(RTEMP)        GET NEXT ENTRY          SA68210
         B     GETNEXT                  GO PROCESS NEXT ENTRY   SA68210
FOUND    EQU   *                                                SA68210
         MVI   AIBSTATE-IEDQAIB(RCOUNT),AIBFREE  FREE AIB      @YA09755
         MVC   AIBLINK-AIBKEY(3,RPARM),AIBLINK-AIBKEY(RTEMP)   @YA09755
*                                       DELINK ENTRY            SA68210
         LM    RETURN,RBASE,AVTSAVE3+12 RESTORE REGS            SA68210
DONE     EQU   *                                                SA68210
         L     RTEMP,TRMDESTQ-1         DESTINATION QCB ADDRESS
         XC    TRMSTAT(L3),TRMSTAT      CLEAR PROCESS ENTRY WORK X03039
*                                       AREA POINTER             X03039
         NI    TRMSTAT+3,QR             RESTORE QRESET FLAG      S22027
         CLI   0(RTEMP),QCBFQCB         PUT PROCESS ENTRY
         BE    DELETE1                                         @YA08086
         MVC   9(3,RTEMP),13(RTEMP)     RESTORE DEST SCHED STCB
DELETE1  EQU   *                                               @YA08086
*                                                              @YA08086
*  IF THERE ARE NO ACTIVE PCB'S, DELETE THE                    @YA08086
*  SCHEDULERS NOW                                              @YA08086
*                                                              @YA08086
         L     RLCB,AVTSAVE2            RESTORE INDEX REG        Y02027
         L     RTEMP,AVTPCBPT                                  @YA08086
PCBLOOP  EQU   *                                               @YA08086
         LA    RTEMP,0(,RTEMP)          CLEAR HIGH-ORDER BYTE  @YA08086
         LTR   RTEMP,RTEMP              NO ACTIVE PCB'S        @YA08086
         BZ    DELETE2                  BRANCH IF YES          @YA08086
         CLI   PCBUCNT-IEDQPCB(RTEMP),ZERO  PCB ACTIVE         @YA08086
         BNE   CLEANUP                  BRANCH IF YES          @YA08086
         L     RTEMP,PCBLINK-1-IEDQPCB(,RTEMP)  NEXT PCB       @YA08086
         B     PCBLOOP                  YES CHECK THIS ONE     @YA08086
DELETE2  EQU   *                                               @YA08086
         L     RTEMP,CVTPTR             CVT ADDR               @YA08086
         L     RTEMP,CVTAQAVT-CVT(,RTEMP)  TCX ADDR            @YA08086
         CLI   TCXPUTQ+ONE-IEDQTCX(RTEMP),AVTEZERO             @YA08086
*                                       DELETE PUT SCHED       @YA08086
         BE    TRYEW                    BRANCH IF NO           @YA08086
         MVI   MNAME+5,PS               MODULE IDENTIFIER      @YA08086
         BAL   RETURN,DELE              DELETE PUT SCHEDULER   @YA08086
         XC    AVTEC,AVTEC              CLEAR DISP TABLE ENTRY @YA08086
         XC    TCXPUTQ-IEDQTCX(,RTEMP),TCXPUTQ-IEDQTCX(RTEMP)  @YA08086
*                                       CLEAR TCX PUT SCHED ADD@YA08086
*                                       CLEAR TCX PUT SCHED ADD@YA08086
TRYEW    EQU   *                                               @YA08086
         CLI   TCXGETQ+ONE-IEDQTCX(RTEMP),AVTEZERO  DELETE     @YA08086
*                                       GET SCHED              @YA08086
         BE    CLEANUP                  BRANCH IF NO           @YA08086
         MVI   MNAME+5,GS               MODULE IDENTIFIER      @YA08086
         BAL   RETURN,DELE              DELETE GET SCHEDULER   @YA08086
         XC    AVTEW,AVTEW              CLEAR DISP TABLE ENTRY @YA08086
         XC    TCXGETQ-IEDQTCX(,RTEMP),TCXGETQ-IEDQTCX(RTEMP)  @YA08086
*                                       CLEAR GET SCHED ADDR   @YA08086
*                                       CLEAR GET SCHED ADDR   @YA08086
         CLI   TCXPNTQ+1-IEDQTCX(RTEMP),AVTEZERO  POINT LOADED @OZ09921
         BE    CLEANUP                  BR NO                  @OZ09921
         MVI   MNAME+5,PTS              MODULE IDENTIFIER      @YA08086
         BAL   RETURN,DELE              DELETE POINT           @OZ09921
         XC    TCXPNTQ-IEDQTCX(,RTEMP),TCXPNTQ-IEDQTCX(RTEMP)  @OZ09921
*                                       CLEAR POINT ADDR       @OZ09921
         B     CLEANUP                  BR TO EXIT             @OZ09921
DELE     EQU   *
         DELETE EPLOC=MNAME
         BR    RETURN                   RETURN TO CALLER
SETFEFO  EQU   *                                                SA55382
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961
         BO    DSPPOSTR                 BRANCH IF YES           SA63961
         NC    PERAQCB+1(3),PERAQCB+1  IS BUFFER ON READ AHEAD  SA55382
         BZ    DSPPOSTR                NO, POST                 SA55382
         CLC   PERAQCB+1(3),AVTDELAD+1 DUMMY END ON RD AHD      SA55382
         BE    DSPPOSTR                YES POST                 SA55382
         L     RPENTRY,PERAQCB         GET PTR FORM READ ADHEADQSA55382
         CLC   PRFTQBCK-IEDQPRF(1,RPENTRY),PRFTQBCK-IEDQPRF(RPARM) 5382
*                                      SAME PRIORITY            SA55382
         BNE   DSPPOSTR                NO, POST                 SA55382
         LA    RWORK,PRFCRCD-IEDQPRF(RPENTRY) ASSUME HDR       @OY15028
         TM    PRFSTAT1-IEDQPRF(RPENTRY),PRFNHDRN IS IT HDR     SA55382
         BNO   HDROK                   YES, FINISH              SA55382
         LA    RWORK,PRFCHDR-IEDQPRF(RPENTRY) GET HDR ADDRESS  @OY15028
HDROK    EQU   *                                                SA55382
         TM    TWO(RWORK),DISK          IS IT DISK POINTER     @OY15028
         BNZ   DISKFEFO                 BRANCH IF YES          @OY15028
         ICM   RWORK,ADDR,AVTEZERO(RWORK) CORE COPY OF HDR     @OY15028
         LA    RWORK,PRFCRCD-IEDQPRF(RWORK) GET DISK POINTER   @OY15028
DISKFEFO EQU   *                                                SA55382
         MVC   PRFSRCE-IEDQPRF(3,RPARM),AVTEZERO(RWORK) SET    @OY15028
*                                       FEFO POINTER FOR FA    @OY15028
         B     DSPPOSTR                POST THE BUFFER          SA55382
         EJECT
* S U B R O U T I N E S                                          Y01004
         SPACE 2
GETMS    EQU   *                        GETMAIN SUBROUTINE.      Y01004
*              FOR GETMAIN, REG 6=SIZE AND REG 7=SUBPOOL         Y02027
         GETMAIN RC,LV=(RCOUNT),SP=(RWORK)                     @ZA02601
         LTR   RENTRY,RENTRY            WAS GETMAIN SUCCESSFUL @ZA02601
         BZ    GO                       BRANCH IF YES          @ZA02601
         SR    RLCB,RLCB                CLEAR REGISTER NINE    @ZA02601
         MVI   RCBERR,ERRCODE           SET OUT-OF-CORE RETURN @ZA02601
         CLM   RLCB,HIGH,PCBUCNT        FIRST OPEN FOR PCB     @ZA02601
         BNE   ERROR                    NO, BRANCH             @ZA02601
         BAL   RWORK,FREEPEB            FREE GOTTEN            @ZA02601
*                                       CONTROL BLOCKS         @ZA02601
         B     ERROR                    GO ACTIVATE PUT/WRITE.   Y01004
GO       EQU   *                                                 Y01004
         LR    RWORK,RPARM              ADDRESS OF GOTTEN AREA   Y02027
CLEARLP  MVI   ZERO(RWORK),ZERO         ZERO BYTE                Y02027
         LA    RWORK,ONE(,RWORK)        PT TO NEXT BYTE          Y02027
         BCT   RCOUNT,CLEARLP           ZERO ENTIRE AREA         Y02027
         BR    RETURN                   RETURN TO CALLER.        Y01004
         SPACE 2
FREEMS   EQU   *                        FREEMAIN SUBROUTINE.     Y01004
         NC    ONE(L3,RTEMP),ONE(RTEMP) IS AN AREA TO BE FREED   Y01004
         BCR   EIGHT,RETURN             RETURN TO CALLER IF NO.  Y01004
         ST    RTEMP,AVTSAVE3+FOUR      STORE POINTER TO ADDR  @ZA06620
*                                        OF AREA TO BE FREED   @ZA06620
         ST    RCOUNT,AVTSAVE3          SET BYTE COUNT IN FREE-@ZA06620
*                                        MAIN PARM LIST        @ZA06620
         MVI   AVTSAVE3+NINE,SPCSANFP   SET SUB POOL NUMBER    @ZA06620
         MVI   AVTSAVE3+EIGHT,MACTYPE   SET MACRO TYPE         @ZA06620
         LA    RPARM,AVTSAVE3           FREEMAIN PARM LIST ADDR@ZA06620
         FREEMAIN ,MF=(E,(1))           FREE MAIN STORAGE      @ZA02601
         SR    RPARM,RPARM              CLEAR FOR STCM         @ZA02601
         STCM  RPARM,ADDR,ONE(RTEMP)    CLEAR POINTER          @ZA02601
         BR    RETURN                   RETURN TO CALLER.        Y01004
         SPACE 2
LOADER   EQU   *                        LOAD SUBROUTINE.         Y01004
         L     RTEMP,CVTPTR             GET CVT ADDRESS          Y01004
         L     RTEMP,CVTLINK-CVT(RTEMP) ADDR. OF LINKLIB DCB.    Y02027
         LOAD  EPLOC=MNAME              TEMP. OMIT DCB ADDR      Y02027
         BR    RETURN                   RETURN TO CALLER.        Y01004
LOCK     EQU   *                                               @ZA02601
         STM   RZERO,RENTRY,RCBSAVE     SAVE REGS              @ZA02601
         MODESET MODE=SUP               GET IN SUPER STATE     @ZA02601
         MODESET EXTKEY=SUPR            GET INTO KEY ZERO      @ZA02601
LOCALGET SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA02601X
               RELATED=(PEBPEWA,IEDQEU(LOCALREL),IEDQOT01(LOCALREL),IGGX
               02046(LOCALREL))                                @ZA02601
CMSGET   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                  @ZA02601X
               RELATED=(PEBPEWA,IEDQEU(CMSREL),IEDQOT01(CMSREL),IGG0204X
               6(CMSREL))                                      @ZA02601
         LM    RZERO,RENTRY,RCBSAVE     RESTORE REGS           @ZA02601
         BR    RETURN                   RETURN TO CALLER       @ZA02601
UNLOCKIT EQU   *                                               @ZA02601
         STM   RZERO,RENTRY,RCBSAVE     SAVE REGS              @ZA02601
CMSREL   SETLOCK RELEASE,TYPE=CMS,                             @ZA02601X
               RELATED=(PEBPEWA,IEDQEU(CMSGET),IEDQOT01(CMSGET),IGG0204X
               6(CMSGET))                                      @ZA02601
LOCALREL SETLOCK RELEASE,TYPE=LOCAL,                           @ZA02601X
               RELATED=(PEBPEWA,IEDQEU(LOCALGET),IEDQOT01(LOCALGET),IGGX
               02046(LOCALGET))                                @ZA02601
         USING *,RETURN                 ADDRESSABILITY         @ZA02601
         MODESET EXTKEY=TCAM            RETURN TO TCAM KEY     @ZA02601
         MODESET MODE=PROB              RETURN TO PROBLEM STATE@ZA02601
         DROP  RETURN                                          @ZA02601
         LM    RZERO,RENTRY,RCBSAVE     RESTORE REGS           @ZA02601
         BR    RETURN                   RETURN TO CALLER       @ZA02601
         EJECT                                                 @ZA02601
*   C O N S T A N T S   A N D   E Q U A T E S   *
*                                               *
         DS    0H
PATCH    DC    10F'0'                   PATCH AREA               Y02027
HONE     DC    H'1'                     SET HALFWORD TO 1        S22025
SIXTEEN  DC    H'16'                    CONSTANT               @YA09755
MNAME    DC    CL8'IEDQE'               BASE FOR MODULE ID       S22025
XE0      EQU   X'E0'                    TERM ENTRY MASK        @OY12956
PTS      EQU   C'S'                     POINT ROUTINE SUFFIX.    Y02027
POINT    EQU   X'04'                    RCB MASK FOR POINT     @OZ09921
TWELVE   EQU   12                       CONSTANT                 Y02027
GETSCHD  EQU   X'10'                    GET SCHD. VTO.           Y02027
PSVTO    EQU   X'12'                    PUT SCHEDULAR VTO        Y02027
SPLCB    EQU   250                      SUBPOOL FOR LCB IN MCP   Y02027
TRTLEN   EQU   256                      TRT TABLE LEN          @OZ09293
FOURTEEN EQU   14                       OBVIOUS.                 Y02027
HEX80    EQU   X'80'                    OBVIOUS.                 Y02027
PHYSSEQ  EQU   X'40'                    PHYSICAL SEQ. BIT.       Y02027
THREE    EQU   3                        OBVIOUS.                 Y02027
NULL     EQU   0                        OBVIOUS.                 Y02027
ERBKEY   EQU   0                        ERB KEY.                 Y02027
ERBPRI   EQU   X'D0'                    ERB PRIORITY.            Y02027
NTFND    EQU   X'0F'                    PROC. ENTRY NOT FND.     Y02027
INUSE    EQU   X'0C'                    PROC. ENTRY IN USE       Y02027
INVAL    EQU   X'0F'                    INVALID OPEN 043-2     @OZ11167
QSPEC    EQU   X'70'                    TYPE QUEUING SPECIFIED @OZ11167
*                                       10=REUS,20=NREUS,40=COR@OZ11167
PCBINVLD EQU   X'20'                    PCB ALREADY IN USE     @ZA02601
TERM     EQU   X'C0'                    NORM AND ABNORM TERM   @ZA02601
QOT1     DC    C'QOT1'                  SPECIAL ID FOR RTM     @ZA02601
TERMNATE EQU   X'40'                    BIT IN RECB TO INDIC. A.PY02027
*                                       IS IN TERMINATOR MODULE. Y02027
TWNTY3   EQU   23                       NUMB OF BITS FOR SHIFT.  Y02027
IEDQLINE EQU   X'40'                    BIT IN DSORG+1 FOR TCAM  Y02027
UNLOCK   EQU   X'D7'                    UNLOCK BITS.             Y02027
X30      EQU   X'30'                    EQUATE                   Y02027
X80      EQU   X'80'                    EQUATE                   Y02027
X40      EQU   X'40'                    HM FLAG IN LCBINSRC+2  @OY14493
ABND     EQU   X'80'                    ABEND BIT IN TCBFLGS.    Y02027
ELEVEN   EQU   11                       EQUATE                   Y02027
SECURE   EQU   1                        SECURE QUEUES            Y02027
TIC      EQU   X'08'                    TIC                      Y02027
SEVEN    EQU   7                        MASK FOR ICM/STCM        Y02027
GS       EQU   C'W'
PS       EQU   C'C'
ZERO     EQU   0
DISK     EQU   3                                                SA55382
EIGHT    EQU   8                                                SA55382
ERRCODE  EQU   1
OPENFLG  EQU   X'08'
RAQCBPRI EQU   5
RAQCBKEY EQU   0
APPRI    EQU   6
XC2      EQU   X'C2'                    DUMMY IOS FLAGS        @ZA03745
PRFRESET EQU   X'20'                    QRESET BUFFER FLAG      SA65388
OPEN     EQU   X'10'                    PCB OPEN FLAG
CLOSFLG  EQU   X'40'                    CLOSE-IN-PROGRESS FLAG
ONE      EQU   1                        OFFSET OF ONE.           Y01004
TWO      EQU   2                        OFFSET OF TWO.           Y01004
L3       EQU   3                        OFFSET OF THREE.         Y01004
FOUR     EQU   4                        OFFSET OF FOUR.          Y01004
FIVE     EQU   5                        OFFSET OF FIVE.          Y01004
SIX      EQU   6                        OFFSET OF SIX.           Y01004
ADDR     EQU   7                        ICM/STCM/CLM MASK FOR    Y01004
*                                       ADDRESSES.               Y01004
HIGH     EQU   8                        ICM/STCM MASK          @ZA02601
ALL      EQU   15                       ICM/STCM MASK          @ZA02601
NINE     EQU   9                        OFFSET OF NINE.          Y01004
SPCSANFP EQU   231                      SUBPOOL FOR CSA, USER    Y02027
*                                         KEY, & NOT FTCH PROT.  Y02027
MACTYPE  EQU   X'20'                    GETMAIN/FREEMAIN MACRO   Y01004
*                                       TYPE.                    Y01004
*                                       AREA PREFIX              S22027
*                                       BY IEDQGQ
QR       EQU   X'01'                    QUEUE RESET FLAG         S22027
BLANK    EQU   X'40'                    RETRIEVE TERMINATION    SA67159
RETPRI   EQU   X'50'                    RETRIEVE ELEM PRIORITY  SA67159
PARTOFF  EQU    X'FD'                    TURN OFF PART BUF     @SA71519
PUTDELAY EQU   X'D6'                    PUT TIME DELAY FLAG    @XA11307
X44      EQU   X'44'                    OFFSET OF REG 14       @OY14493
CHECKPT  EQU   X'20'                    TCAM CHECKPOINT        @G36XRNP
         EJECT
*        PARAMETER LIST FOR SCHEDULE SRB FUNCTION OF SVC 102 * @Z40X9NG
         SPACE 1                                               @Z40X9NG
SSRBSECT DSECT                                                 @Z40X9NG
SSRBENTC DS    XL1                      ENTRY CODE             @Z40X9NG
SSRBCODE EQU   X'2C'                    ENTRY CODE = '2C'      @Z40X9NG
SSRBECBA DS    AL3                      ADDRESS OF ECB         @Z40X9NG
SSRBASCB DS    A                        ADDRESS OF ASCB        @Z40X9NG
SSRBCC   DS    XL1                      COMPLETION CODE        @Z40X9NG
         DS    XL1                      UNUSED                 @Z40X9NG
SSRBASID DS    H                        ASID                   @Z40X9NG
SSRBTCB  DS    A                        TCB ADDRESS            @Z40X9NG
         SPACE 4                                               @Z40X9NG
***********************************************************************
*                *                                                    *
*    SSRBENTC    *                      SSRBECBA                      *
*                *                                                    *
***********************************************************************
*                                                                     *
*                              SSRBASCB                               *
*                                                                     *
***********************************************************************
*                *                 *                                  *
*    SSRBCC      *                 *             SSRBASID             *
*                *                 *                                  *
***********************************************************************
*                                                                     *
*                              SSRBTCB                                *
*                                                                     *
***********************************************************************
         EJECT                                                 @Z40X9NG
*                                    *
* * * *    D  S  E  C  T  S    * * * *
*                                    *
         SPACE 2                                               @YA09755
         TAIBD                                                 @YA09755
         EJECT                                                 @YA09755
         TCPBD 3330                                              S21101
         EJECT
         TPRIOR
         TTCBD
         TAVTD ,                        ADDRESS VECTOR TABLE    SA52971
         TRECBD                         RESOURCE CONTROL BLOCK
*****************************************************************Y02027
*****    RCB EXTENSION FOR TCAM APPLICATION OPEN/CLOSE.          Y02027
*****************************************************************Y02027
RCBPECB  DS    F                        A. P. PECB ADDR          Y02027
RCBASCB  DS    F                        A. P. ASCB ADDR          Y02027
RCBERRET DS    0F                       ERROR RTN ADDR           Y02027
RCBASID  DS    F                        APPLIC. PGM ASID ADDR.   Y02027
RCBTCB   DS    F                        APPLIC. PGM TCB ADDR.    Y02027
RCBDCBMA DS    H                        DCBMACRF FROM APPLIC.    Y02027
RCBTCBFL DS    0X                       APPLIC. TCB FLAGS.       Y02027
RCBDCBDS DS    H                        DCBDSORG FROM APPLIC.    Y02027
RCBDSNM  DS    CL8                      PROCESS QUEUE NAME.      Y02027
RCBDEBAD DS    F                        DEB ADDR FOR APPLIC. DCB.Y02027
RCBDCBBU DS    H                        DCBBUFL FROM APPLIC.     Y02027
RCBDCBLR DS    H                        DCBLRECL FROM APPLIC.    Y02027
RCBDCBOP DS    X                        DCBOPTCD FROM APPLIC.    Y02027
RCBDCBRF DS    X                        DCBRECFM FROM APPLICATIONY02027
RCBDCBF1 DS    X                        DCBFLAG1 FROM APPLICATIONY02027
RCBERR   DS    X                        ERROR INDICATOR          Y02027
RCBJOBNM DS    CL8                      JOBNAME                  Y02027
RCBSAVE  DS    18F                      SAVE AREA FOR IEDQEU   @ZA02601
RCBEND   DS    0X                       END OF DSECT.            Y02027
         ORG   RCBTCB
RCBDEBTA DS    H                        OFFSET IN T.T. FOR ENTRY.Y02027
RCBOPECB DS    0AL3                     OPCTL ECB ADDRESS        Y02027
RCBDEBPW DS    AL3                      ADDR. OF PEWA.           Y02027
RCBDEBPC DS    AL3                      ADDR. OF PCB.            Y02027
         DS    2F                       QNAME                    Y02027
RCBSQ    DS    0X                       SECURE QUEUE FLAG        Y02027
RCBAVTBT DS    X                        AVTBIT1 ON RETURN FROM EUY02027
RCBPEBAD DS    AL3                      ADDR OF PEB IN CSA.      Y02027
RCBSIZE  EQU   RCBEND-RECBKEY           SIZE OF DSECT.           Y02027
         TQCBD
         TTNTD                                                 @OY12956
         TDISPD
         TTRMD
         TSCBD
         TLCBD
LCBLEN   EQU   LCBCPA+56-IEDQLCB        APPL PGM LCB LENGTH    @SA74021
         TPEWAD
         TPCBD
         EJECT
         TPROCD                                                @OY20522
         TPRFD
         DCBD  DSORG=TX
         TDEBD
         IHAPSA                                                  Y02027
CVT      DSECT                                                   Y02027
         CVT                                                     Y02027
         TTCXD                                                   Y02027
         TCKPD                                                   Y02027
         TPEBD                                                   Y02027
         END

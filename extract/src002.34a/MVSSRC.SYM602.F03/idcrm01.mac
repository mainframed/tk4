         TITLE '********** IDCRM01:  IMPORTRA FUNCTION SUPPORT ROUTINE *
                ********'
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
IDCRM01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL1(16)                                             0002
         DC    C'IDCRM01   78.177'                                 0002
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @12,0                                               0002
@PSTART  LA    @11,4095(,@12)                                      0002
         LA    @10,4095(,@11)                                      0002
         LA    @09,4095(,@10)                                      0002
         LA    @08,4095(,@09)                                      0002
         LA    @07,4095(,@08)                                      0002
         LA    @06,4095(,@07)                                      0002
         USING @PSTART,@12                                         0002
         USING @PSTART+4095,@11                                    0002
         USING @PSTART+8190,@10                                    0002
         USING @PSTART+12285,@09                                   0002
         USING @PSTART+16380,@08                                   0002
         USING @PSTART+20475,@07                                   0002
         USING @PSTART+24570,@06                                   0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @05,@01                                             0002
         USING @DATD,@05                                           0002
         ST    @13,@SA00001+4                                      0002
         LM    @00,@01,20(@13)                                     0002
         ST    @05,8(,@13)                                         0002
         LR    @13,@05                                             0002
         MVC   @PC00001(12),0(@01)                                 0002
*                                                                  0366
*        /************************************************************/
*        /*                                                          */
*        /*   THIS IS THE HIGHEST LEVEL OF PROCESSING FOR THE        */
*        /*   IMPORTRA ROUTINE.                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0367
*        OLDERID2 = NEWERID2;                                      0367
         L     @04,@PC00001                                        0367
         L     @04,GDTTR2(,@04)                                    0367
         MVC   @TS00001(95),NEWERID2(@04)                          0367
         MVC   OLDERID2(95,@04),@TS00001                           0367
*        NEWID2 = 'RMBG';                                          0368
*                                                                  0368
         MVC   NEWID2(4,@04),@CC01300                              0368
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE FIELDS FOR MESSAGE OUTPUT                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0369
*        DDSTRU = ADDR(PRINTTAB);                                  0369
         LA    @04,PRINTTAB                                        0369
         ST    @04,DDSTRU                                          0369
*        DARGLIST = ''B;                                           0370
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0370
*        DEFSTID = 0;                                              0371
         MVI   DEFSTID,X'00'                                       0371
*        DARGSMOD = 'MP0';                                         0372
*                                                                  0372
         MVC   DARGSMOD(3,@04),@CC00945                            0372
*        SETRC = 0;                                                0373
*                                                                  0373
         SLR   @04,@04                                             0373
         STH   @04,SETRC                                           0373
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE POINTER TO INPUT IOCS AND SET ENDFLAG TO OFF */
*        /*                                                          */
*        /************************************************************/
*                                                                  0374
*        PINIOCS = NULLPTR;            /*INPUT IOCS                  */
         ST    @04,PINIOCS                                         0374
*        ENDFLAG = OFF;                /*INITIALIZE ENDFLAG TO OFF   */
*                                                                  0375
         NI    ENDFLAG,B'01111111'                                 0375
*        /************************************************************/
*        /*                                                          */
*        /*  SET POUTIOCS TO NULLPTR IN CASE WE NEVER ENTER          */
*        /*  THE MAIN LOOP.                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0376
*        POUTIOCS = NULLPTR;                                       0376
*                                                                  0376
         ST    @04,POUTIOCS                                        0376
*        /************************************************************/
*        /*                                                          */
*        /*  SET AN INITIAL VALUE FOR THE BLOCKSIZE OF THE           */
*        /*  PORTABLE DATA SET.                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0377
*        BLKSIZ = 2048;                                            0377
         MVC   BLKSIZ(4),@CF01302                                  0377
*        IF ADDR(OUTDD) ^= NULLPTR                                 0378
*          THEN                                                    0378
         L     @15,@PC00001+4                                      0378
         C     @04,FDTPTR+4(,@15)                                  0378
         BE    @RF00378                                            0378
*UIO:        DO;                                                   0379
*                                                                  0379
UIO      DS    0H                                                  0380
*            /********************************************************/
*            /*                                                      */
*            /*  SET UP ADDRESSABILITY TO THE UIOINFO OPTION BYTE AND*/
*            /*  ZERO IT OUT.                                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  0380
*            RESPECIFY IOINFOPT BASED(IOINFPTR);                   0380
*            IOINFPTR = ADDR(IOINFBYT);                            0381
         LA    @04,IOINFBYT                                        0381
         ST    @04,IOINFPTR                                        0381
*            IOINFBYT = ''B;                                       0382
*                                                                  0382
         MVI   IOINFBYT,X'00'                                      0382
*            /********************************************************/
*            /*                                                      */
*            /*  ZERO OUT THE RETURN AREA FOR THE DATA SET NAME, AND */
*            /*  SET THE LENGTH OF THE AREA IN THE FIRST TWO BYTES.  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0383
*            DSNRET = ''B;                                         0383
         XC    DSNRET(52),DSNRET                                   0383
*            DSNRETAL = LENGTH(DSNRET);                            0384
*                                                                  0384
         MVC   DSNRETAL(2),@CH01741                                0384
*            /********************************************************/
*            /*                                                      */
*            /*  ISSUE A UIOINFO TO GET THE DUMMY NAME TO BE USED TO */
*            /*  OPEN ANY VSAM OBJECTS BEING IMPORTED.  THE          */
*            /*  PARAMETERS PASSED TO UIOINFO ARE:                   */
*            /*                                                      */
*            /*  (1) THE GDT                                         */
*            /*  (2) AN OPTION BYTE WITH THE DATA SET NAME BIT ON    */
*            /*  (3) A WORD CONTAINING THE ADDRESS OF A RETURN AREA  */
*            /*      FOR THE DATA SET NAME                           */
*            /*  (4) THE ADDRESS OF THE DDNAME FOR THE DD CARD FOR   */
*            /*      OBJECTS BEING IMPORTED                          */
*            /*                                                      */
*            /********************************************************/
*                                                                  0385
*            IOINFDSN = ON;                                        0385
         OI    IOINFDSN(@04),B'00100000'                           0385
*            DSNRETPT = ADDR(DSNRET);                              0386
*                                                                  0386
         LA    @15,DSNRET                                          0386
         ST    @15,DSNRETPT                                        0386
*            /********************************************************/
*            /*                                                      */
*            /*  ISSUE THE UIOINFO, AND TEST THE CONDITION CODE      */
*            /*                                                      */
*            /********************************************************/
*                                                                  0387
*            CALL IDCIOSI0(GDTTBL,IOINFOPT,DSNRETPT,OUTDDVAL);     0387
*                                                                  0387
         L     @15,@PC00001                                        0387
         ST    @15,@AL00001                                        0387
         ST    @04,@AL00001+4                                      0387
         LA    @04,DSNRETPT                                        0387
         ST    @04,@AL00001+8                                      0387
         L     @04,@PC00001+4                                      0387
         L     @04,FDTPTR+4(,@04)                                  0387
         LA    @04,OUTDDVAL(,@04)                                  0387
         ST    @04,@AL00001+12                                     0387
         MVI   @AL00001+12,X'80'                                   0387
         L     @15,GDTIFO(,@15)                                    0387
         LA    @01,@AL00001                                        0387
         BALR  @14,@15                                             0387
*            RESPECIFY RTNREG RSTD;                                0388
*            TESTRC = RTNREG;                                      0389
         STH   RTNREG,TESTRC                                       0389
*            RESPECIFY RTNREG UNRSTD;                              0390
*            IF TESTRC ^= 0                                        0391
*              THEN                                                0391
         LH    @04,TESTRC                                          0391
         LTR   @04,@04                                             0391
         BZ    @RF00391                                            0391
*                DO;                                               0392
*                ENDFLAG = ON;                                     0393
         OI    ENDFLAG,B'10000000'                                 0393
*                DARGSMOD = IMPMSG;                                0394
         L     @04,DDSTRU                                          0394
         MVC   DARGSMOD(3,@04),@CC00945                            0394
*                DARGSENT = IOINFMSG;                              0395
         MVI   DARGSENT(@04),X'18'                                 0395
*                CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);             0396
         L     @04,@PC00001                                        0396
         ST    @04,@AL00001                                        0396
         LA    @15,@CF00119                                        0396
         ST    @15,@AL00001+4                                      0396
         LA    @15,DDSTRU                                          0396
         ST    @15,@AL00001+8                                      0396
         MVI   @AL00001+8,X'80'                                    0396
         L     @15,GDTPRT(,@04)                                    0396
         LA    @01,@AL00001                                        0396
         BALR  @14,@15                                             0396
*                SETRC = LASTCC12;                                 0397
         MVC   SETRC(2),@CH00035                                   0397
*                END;                                              0398
*            END UIO;                                              0399
*                                                                  0399
@RF00391 DS    0H                                                  0400
*        RESPECIFY IDAAMDSB BASED(DSCCATPT);                       0400
*                                                                  0400
@RF00378 DS    0H                                                  0401
*        /************************************************************/
*        /*                                                          */
*        /*  IF INDATASET WAS SPECIFIED BY THE USER, OBTAIN THE      */
*        /*  FULLY QUALIFIED NAME OF THE DATASET BY ISSUING THE      */
*        /*  UQUAL MACRO.                                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0401
*        IF INDSFUQ = ON & ADDR(INDS) ^= NULLPTR                   0401
*          THEN                                                    0401
         L     @04,@PC00001+4                                      0401
         L     @04,FDTPTR+92(,@04)                                 0401
         TM    INDSFUQ(@04),B'10000000'                            0401
         BNO   @RF00401                                            0401
         LTR   @04,@04                                             0401
         BZ    @RF00401                                            0401
*            DO;                                                   0402
*                                                                  0402
*            /********************************************************/
*            /*                                                      */
*            /*  CLEAR THE STORAGE TO BE USED FOR THE PARAMETER      */
*            /*  LIST PASSED TO UQUAL AND SET THE ENTRY NAME AND     */
*            /*  PASSWORD POINTERS IN THE UQUAL PARAMETER LIST.      */
*            /*                                                      */
*            /********************************************************/
*                                                                  0403
*            QUALLIST = ''B;                                       0403
         XC    QUALLIST(12),QUALLIST                               0403
*            QUALADDR = ADDR(INDSVAL);                             0404
         LA    @15,INDSVAL(,@04)                                   0404
         ST    @15,QUALADDR                                        0404
*            IF INDSPLN ^= 0                                       0405
*              THEN                                                0405
         CLI   INDSPLN(@04),0                                      0405
         BE    @RF00405                                            0405
*                QUALPAS = ADDR(INDSPAS);                          0406
         LA    @04,INDSPAS(,@04)                                   0406
         ST    @04,QUALPAS                                         0406
*            QUALLEN = INDSLEN;                            /*@OZ19704*/
*                                                                  0407
@RF00405 L     @04,@PC00001+4                                      0407
         L     @04,FDTPTR+92(,@04)                                 0407
         SLR   @15,@15                                             0407
         IC    @15,INDSLEN(,@04)                                   0407
         STH   @15,QUALLEN                                         0407
*            /********************************************************/
*            /*                                                      */
*            /*  ISSUE THE UQUAL TO OBTAIN THE FULLY QUALIFIED       */
*            /*  NAME FOR THE DATASET.  TEST THE RETURN CODE FROM    */
*            /*  UQUAL TO DETERMINE IF PROCESSING IS TO CONTINUE.    */
*            /*                                                      */
*            /********************************************************/
*                                                                  0408
*            CALL IDCSAQL0(GDTTBL,QUALADDR,QUALLEN,QUALCAT,QUALPAS);/*
*                                                             OZ19704*/
*                                                                  0408
         L     @04,@PC00001                                        0408
         ST    @04,@AL00001                                        0408
         LA    @15,QUALADDR                                        0408
         ST    @15,@AL00001+4                                      0408
         LA    @15,QUALLEN                                         0408
         ST    @15,@AL00001+8                                      0408
         LA    @15,QUALCAT                                         0408
         ST    @15,@AL00001+12                                     0408
         LA    @15,QUALPAS                                         0408
         ST    @15,@AL00001+16                                     0408
         MVI   @AL00001+16,X'80'                                   0408
         L     @15,GDTQAL(,@04)                                    0408
         LA    @01,@AL00001                                        0408
         BALR  @14,@15                                             0408
*            RESPECIFY RTNREG RSTD;                                0409
*            TESTRC = RTNREG;                                      0410
         STH   RTNREG,TESTRC                                       0410
*            RESPECIFY RTNREG UNRSTD;                              0411
*            IF TESTRC ^= 0                                        0412
*              THEN                                                0412
         LH    @04,TESTRC                                          0412
         LTR   @04,@04                                             0412
         BZ    @RF00412                                            0412
*                DO;                                               0413
*                SETRC = LASTCC12;                                 0414
         MVC   SETRC(2),@CH00035                                   0414
*                ENDFLAG = ON;                                     0415
         OI    ENDFLAG,B'10000000'                                 0415
*                END;                                              0416
*            END;                                                  0417
*                                                                  0417
@RF00412 DS    0H                                                  0418
*        /************************************************************/
*        /*                                                          */
*        /*  OPEN INPUT DATA SET - THE PORTABILITY VOLUME AS         */
*        /*  SPECIFIED IN THE IN OR THE INDS PARAMETER               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0418
*        IF ADDR(IN) ^= NULLPTR                                    0418
*          THEN                                                    0418
@RF00401 L     @04,@PC00001+4                                      0418
         L     @15,FDTPTR(,@04)                                    0418
         LTR   @15,@15                                             0418
         BZ    @RF00418                                            0418
*            CALL OPENPROC('I',ADDR(INDDVAL),NULLPARM,0,           0419
*              BLKSIZ,ADDR(PINIOCS));                              0419
         LA    @15,@CC00753                                        0419
         ST    @15,@AL00001                                        0419
         L     @04,FDTPTR+56(,@04)                                 0419
         LA    @04,INDDVAL(,@04)                                   0419
         ST    @04,@AFTEMPS+36                                     0419
         LA    @04,@AFTEMPS+36                                     0419
         ST    @04,@AL00001+4                                      0419
         LA    @04,NULLPARM                                        0419
         ST    @04,@AL00001+8                                      0419
         LA    @04,@CF00119                                        0419
         ST    @04,@AL00001+12                                     0419
         LA    @04,BLKSIZ                                          0419
         ST    @04,@AL00001+16                                     0419
         LA    @04,PINIOCS                                         0419
         ST    @04,@AFTEMPS+40                                     0419
         LA    @04,@AFTEMPS+40                                     0419
         ST    @04,@AL00001+20                                     0419
         LA    @01,@AL00001                                        0419
         BAL   @14,OPENPROC                                        0419
*          ELSE                                                    0420
*            CALL OPENPROC('I',NULLPARM,ADDR(INDSVAL),0,           0420
*               BLKSIZ,ADDR(PINIOCS));                             0420
*                                                                  0420
         B     @RC00418                                            0420
@RF00418 LA    @04,@CC00753                                        0420
         ST    @04,@AL00001                                        0420
         LA    @04,NULLPARM                                        0420
         ST    @04,@AL00001+4                                      0420
         L     @04,@PC00001+4                                      0420
         L     @04,FDTPTR+92(,@04)                                 0420
         LA    @04,INDSVAL(,@04)                                   0420
         ST    @04,@AFTEMPS+36                                     0420
         LA    @04,@AFTEMPS+36                                     0420
         ST    @04,@AL00001+8                                      0420
         LA    @04,@CF00119                                        0420
         ST    @04,@AL00001+12                                     0420
         LA    @04,BLKSIZ                                          0420
         ST    @04,@AL00001+16                                     0420
         LA    @04,PINIOCS                                         0420
         ST    @04,@AFTEMPS+40                                     0420
         LA    @04,@AFTEMPS+40                                     0420
         ST    @04,@AL00001+20                                     0420
         LA    @01,@AL00001                                        0420
         BAL   @14,OPENPROC                                        0420
*        /************************************************************/
*        /*                                                          */
*        /*  TEST FOR SUCCESSFUL OPEN.  IF OPEN UNSUCCESSFUL         */
*        /*  RETURN TO CALLING PROCESSOR                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0421
*        RESPECIFY RTNREG RSTD;                                    0421
@RC00418 DS    0H                                                  0422
*        TESTRC = RTNREG;                                          0422
         STH   RTNREG,TESTRC                                       0422
*        RESPECIFY RTNREG UNRSTD;                                  0423
*        IF TESTRC ^= 0                                            0424
*          THEN                                                    0424
         LH    @04,TESTRC                                          0424
         LTR   @04,@04                                             0424
         BZ    @RF00424                                            0424
*            DO;                                                   0425
*            DARGSENT = ERROPENP;                                  0426
         L     @04,DDSTRU                                          0426
         MVI   DARGSENT(@04),X'0E'                                 0426
*            DARGSMOD = IMPMSG;                                    0427
         MVC   DARGSMOD(3,@04),@CC00945                            0427
*            CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                 0428
         L     @04,@PC00001                                        0428
         ST    @04,@AL00001                                        0428
         LA    @15,@CF00119                                        0428
         ST    @15,@AL00001+4                                      0428
         LA    @15,DDSTRU                                          0428
         ST    @15,@AL00001+8                                      0428
         MVI   @AL00001+8,X'80'                                    0428
         L     @15,GDTPRT(,@04)                                    0428
         LA    @01,@AL00001                                        0428
         BALR  @14,@15                                             0428
*            ENDFLAG = ON;                                         0429
         OI    ENDFLAG,B'10000000'                                 0429
*            SETRC = LASTCC12;                                     0430
         MVC   SETRC(2),@CH00035                                   0430
*            END;                                                  0431
*                                                                  0431
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP READING CATALOG INFORMATION FROM THE PORTABLE      */
*        /*  DATA SET WHILE A PHYSICAL END OF FILE IS FOUND.         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0432
*MPLOOP: DO WHILE ENDFLAG = OFF;                                   0432
*                                                                  0432
@RF00424 DS    0H                                                  0432
MPLOOP   B     @DE00432                                            0432
@DL00432 DS    0H                                                  0433
*          /**********************************************************/
*          /*                                                        */
*          /*  INITIALIZATIONS FOR THIS ITERATION OF THE IMPORTRA    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0433
*          POUTIOCS = NULLPTR;           /*OUTPUT IOCS               */
         SLR   @04,@04                                             0433
         ST    @04,POUTIOCS                                        0433
*          IMPFLG2 = '00'X;            /*IMPORT FLAGS                */
         MVI   IMPFLG2,X'00'                                       0434
*          IMPMFLAG = '00'X;           /*IMPORT MESSAGE FLAGS@OZ17068*/
         MVI   IMPMFLAG,X'00'                                      0435
*          CPSWD = NULLPTR;            /*OBJECT PASSWORD POINTER     */
         ST    @04,CPSWD                                           0436
*          CATRCVWK = ''B;             /*RECOVERY VOLSER             */
         XC    CATRCVWK(10),CATRCVWK                               0437
*          RCVLN = LENGTH(CATRCVWK);   /*SET THE LENGTH OF THE       */
         MVC   RCVLN(2),@CH00037                                   0438
*                                      /*RECOVERY WORK AREA          */
*                                                                  0439
*          /**********************************************************/
*          /*                                                        */
*          /*  SET ADDRESSABILITY FOR THE ALLAGL.  INITIALIZE        */
*          /*  VARIABLES USED TO CONTROL THE DYNAMIC ALLOCATION      */
*          /*  OF VOLUMES.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0439
*          RESPECIFY ALLAGL BASED(ALLPTR);                         0439
*          DEALLOC = OFF;                                          0440
         NI    DEALLOC,B'01111111'                                 0440
*          UNIQD = OFF;                                            0441
         NI    UNIQD,B'01111111'                                   0441
*          UNIQI = OFF;                                            0442
         NI    UNIQI,B'01111111'                                   0442
*          DALCINDX = 0;                                           0443
*                                                                  0443
         ST    @04,DALCINDX                                        0443
*          DO I = 1 TO CMPNUM;                                     0444
         LA    @04,1                                               0444
         ST    @04,I                                               0444
@DL00444 DS    0H                                                  0445
*            FVTPTR(I) = NULLPTR;        /*ZERO FVT POINTERS         */
         LR    @15,@04                                             0445
         SLA   @15,2                                               0445
         SLR   @14,@14                                             0445
         ST    @14,FVTPTR-4(@15)                                   0445
*          END;                                                    0446
*                                                                  0446
         AL    @04,@CF00221                                        0446
         ST    @04,I                                               0446
         C     @04,@CF00165                                        0446
         BNH   @DL00444                                            0446
*          PFVTPTR = NULLPTR;            /*ZERO PATH FVT             */
         SLR   @04,@04                                             0447
         ST    @04,PFVTPTR                                         0447
*                                        /*POINTER                   */
*          PTRCTACB = NULLPTR;         /*ZERO OUT CATALOG ACB        */
         ST    @04,PTRCTACB                                        0448
*                                      /*POINTER                     */
*                                                                  0449
*          /**********************************************************/
*          /*                                                        */
*          /*  INITIALIZE ALL OF THE SPECIAL FVT POINTERS USED FOR   */
*          /*  USERCATALOGS, ALIASES, GDG BASES, AND NON-VSAMS TO 0. */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0449
*          UCFVTPTR = NULLPTR;                                     0449
         ST    @04,UCFVTPTR                                        0449
*          ALFVTPTR = NULLPTR;                                     0450
         ST    @04,ALFVTPTR                                        0450
*          GDFVTPTR = NULLPTR;                                     0451
         ST    @04,GDFVTPTR                                        0451
*          NVFVTPTR = NULLPTR;                                     0452
*                                                                  0452
         ST    @04,NVFVTPTR                                        0452
*          /**********************************************************/
*          /*                                                        */
*          /*  PROCESS THE TIME STAMP RECORD WHICH IS THE FIRST      */
*          /*  RECORD ON THE PORTABILITY VOLUME  THIS RECORD GIVES   */
*          /*  THE TIME AND DATE THE DATA SET WAS EXPORTED.          */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0453
*          /**********************************************************/
*          /*                                                        */
*          /*  READ THE TIME STAMP RECORD FROM THE PORTABLE DATA SET */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0453
*          IOCSPTR = PINIOCS;                                      0453
*                                                                  0453
         L     @04,PINIOCS                                         0453
         ST    @04,IOCSPTR                                         0453
*          CALL IDCIOGT0 (GDTTBL,IOCSPTR);                         0454
*                                                                  0454
         L     @04,@PC00001                                        0454
         ST    @04,@AL00001                                        0454
         LA    @15,IOCSPTR                                         0454
         ST    @15,@AL00001+4                                      0454
         MVI   @AL00001+4,X'80'                                    0454
         L     @15,GDTGET(,@04)                                    0454
         LA    @01,@AL00001                                        0454
         BALR  @14,@15                                             0454
*          RESPECIFY RTNREG RSTD;                                  0455
*          TESTRC = RTNREG;                                        0456
         STH   RTNREG,TESTRC                                       0456
*          RESPECIFY RTNREG UNRSTD;                                0457
*          IF TESTRC ^= 0                                          0458
*            THEN                                                  0458
*                                                                  0458
         LH    @04,TESTRC                                          0458
         LTR   @04,@04                                             0458
         BZ    @RF00458                                            0458
*              /******************************************************/
*              /*                                                    */
*              /*  COULD NOT READ RECORD FROM PORTABILITY VOLUME.    */
*              /*  INDICATE ERROR  AND RETURN TO CALLING PROCESSOR   */
*              /*  THIS MAY BE THE END OF FILE.  IF SO, THIS IS THE  */
*              /*  THE NORMAL METHOD OF TERMINATING A RECOVERY       */
*              /*  IMPORT COMMAND.                                   */
*              /*                                                    */
*              /******************************************************/
*                                                                  0459
*              ENDFLAG = ON;                                       0459
*                                                                  0459
         OI    ENDFLAG,B'10000000'                                 0459
*          /**********************************************************/
*          /*                                                        */
*          /*  IF THE VALUE OF ENDFLAG IS OFF, THEN PROCEED WITH     */
*          /*  WITH THE IMPORTATION OF THE CURRENT OBJECT.           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0460
*          IF ENDFLAG = OFF                                        0460
*            THEN                                                  0460
@RF00458 TM    ENDFLAG,B'10000000'                                 0460
         BNZ   @RF00460                                            0460
*NOTEND:       DO;                                                 0461
*                                                                  0461
NOTEND   DS    0H                                                  0462
*              /******************************************************/
*              /*                                                    */
*              /*  SAVE INFORMATION PASSED BY EXPORT GIVING NUMBER OF*/
*              /*  COMPONENTS IN CLUSTER AND FLAG BYTE INDICATING    */
*              /*  WHETHER INHIBITTARGET WAS SPECIFIED AT EXPORT TIME*/
*              /*                                                    */
*              /******************************************************/
*                                                                  0462
*              CONRCPTR = IOCDAD;                                  0462
*                                                                  0462
         L     @04,IOCSPTR                                         0462
         L     @04,IOCDAD(,@04)                                    0462
         ST    @04,CONRCPTR                                        0462
*              /******************************************************/
*              /*                                                    */
*              /*  CHECK TO SEE THAT THIS IS A PORTABLE DATA SET -   */
*              /*  CHECK FOR TIME STAMP FLAGS SET IN FIRST RECORD.   */
*              /*  IF FLAGS INCORRECT, RETURN WITH ERROR             */
*              /*                                                    */
*              /******************************************************/
*                                                                  0463
*              IF HEADFLG1 ^= HDFL1CAT × HEADFLG2 ^=HDFL2TSP       0463
*                THEN                                              0463
         CLI   HEADFLG1(@04),X'FF'                                 0463
         BNE   @RT00463                                            0463
         CLI   HEADFLG2(@04),X'FF'                                 0463
         BE    @RF00463                                            0463
@RT00463 DS    0H                                                  0464
*                  DO;                                             0464
*                  DEFSTID = PORTERR;                              0465
         MVI   DEFSTID,X'01'                                       0465
*                  ENDFLAG = ON;                                   0466
         OI    ENDFLAG,B'10000000'                                 0466
*                  END;                                            0467
*                                                                  0467
*                                                                  0467
*              NUMOBJ = TEXOJCT;                                   0468
@RF00463 LA    @04,8                                               0468
         L     @15,CONRCPTR                                        0468
         ALR   @15,@04                                             0468
         SLR   @14,@14                                             0468
         IC    @14,TEXOJCT(,@15)                                   0468
         STH   @14,NUMOBJ                                          0468
*              IMPFLG = TEXFLG;                                    0469
*                                                                  0469
         MVC   IMPFLG(1),TEXFLG(@15)                               0469
*              /******************************************************/
*              /*                                                    */
*              /*  LIST EXPORT TIME STAMP INFORMATION USING TEXT     */
*              /*  PROCESSOR INTERFACE                               */
*              /*                                                    */
*              /******************************************************/
*                                                                  0470
*              DARGCNT = 2;                                        0470
         LA    @14,2                                               0470
         L     @03,DDSTRU                                          0470
         STH   @14,DARGCNT(,@03)                                   0470
*              DARGINS(1) = 1;                                     0471
         MVC   DARGINS(2,@03),@CH00221                             0471
*              DARGINL(1) = LENGTH(TIMEDATE);                      0472
         STH   @04,DARGINL(,@03)                                   0472
*              DARGDTM(1) = ADDR(TIMEDATE);                        0473
         LA    @02,TIMEDATE(,@15)                                  0473
         ST    @02,DARGDTM(,@03)                                   0473
*              DARGINS(2) = 2;                                     0474
         STH   @14,DARGINS+8(,@03)                                 0474
*              DARGINL(2) = LENGTH(TIMEODAY);                      0475
         STH   @04,DARGINL+8(,@03)                                 0475
*              DARGDTM(2) = ADDR(TIMEODAY);                        0476
         LA    @04,TIMEODAY(,@15)                                  0476
         ST    @04,DARGDTM+8(,@03)                                 0476
*              DARGSENT = TIMEMSG;                                 0477
*                                                                  0477
         MVI   DARGSENT(@03),X'0C'                                 0477
*              CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);               0478
         L     @04,@PC00001                                        0478
         ST    @04,@AL00001                                        0478
         LA    @15,@CF00119                                        0478
         ST    @15,@AL00001+4                                      0478
         LA    @15,DDSTRU                                          0478
         ST    @15,@AL00001+8                                      0478
         MVI   @AL00001+8,X'80'                                    0478
         L     @15,GDTPRT(,@04)                                    0478
         LA    @01,@AL00001                                        0478
         BALR  @14,@15                                             0478
*              DARGLIST = ''B;                                     0479
         L     @04,DDSTRU                                          0479
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0479
*              DARGSMOD = IMPMSG;                                  0480
*                                                                  0480
         MVC   DARGSMOD(3,@04),@CC00945                            0480
*              /******************************************************/
*              /*                                                    */
*              /*  SET GETEOF TO OFF TO INDICATE THAT NO LOWER LEVEL */
*              /*  PROCESSOR HAS GOTTEN AN END OF FILE.              */
*              /*                                                    */
*              /******************************************************/
*                                                                  0481
*              GETEOF = OFF;                                       0481
*                                                                  0481
         NI    GETEOF,B'01111111'                                  0481
*              /******************************************************/
*              /*                                                    */
*              /*  NOW TEST THE TIME STAMP TO DETERMINE IF THE OBJECT*/
*              /*  TO BE IMPORTED IS A NONVSAM.                      */
*              /*                                                    */
*              /******************************************************/
*                                                                  0482
*              IF TEXNVS = ON                                      0482
*                THEN                                              0482
         L     @04,CONRCPTR                                        0482
         TM    TEXNVS+8(@04),B'00000100'                           0482
         BNO   @RF00482                                            0482
*NVSAM:            DO;                                             0483
*                                                                  0483
NVSAM    DS    0H                                                  0484
*                  /**************************************************/
*                  /*                                                */
*                  /*  INDICATE THAT NVSMPROC IS TO READ A           */
*                  /*  CONTROL RECORD FROM THE PORTABLE DATA         */
*                  /*  SET.                                          */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0484
*                  NVSMRDSW = OFF;                                 0484
*                                                                  0484
         NI    NVSMRDSW,B'01111111'                                0484
*                  /**************************************************/
*                  /*                                                */
*                  /*  WE HAVE A NON-VSAM OBJECT TO IMPORT.  CALL    */
*                  /*  NVSMPROC TO HANDLE THE ACTUAL IMPORTATION.    */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0485
*                  CALL NVSMPROC;                                  0485
         BAL   @14,NVSMPROC                                        0485
*                  RESPECIFY RTNREG RSTD;                          0486
*                  TESTRC = RTNREG;                                0487
         STH   RTNREG,TESTRC                                       0487
*                  RESPECIFY RTNREG UNRSTD;                        0488
*                                                                  0488
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF THE RETURN CODE FROM NVSMPROC IS 12, THEN A*/
*                  /*  TERMINATING ERROR HAS BEEN DETECTED, SO THAT  */
*                  /*  ENDFLAG MUST BE SET TO ON.  OTHERWISE, SETRC  */
*                  /*  BECOMES THE MAXIMUM OF ITS CURRENT VALUE, AND */
*                  /*  THAT OF TESTRC.                               */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0489
*                  IF TESTRC ^= 0                                  0489
*                    THEN                                          0489
         LH    @04,TESTRC                                          0489
         LTR   @04,@04                                             0489
         BZ    @RF00489                                            0489
*                      IF TESTRC = LASTCC12                        0490
*                        THEN                                      0490
         C     @04,@CF00035                                        0490
         BNE   @RF00490                                            0490
*                          DO;                                     0491
*                          ENDFLAG = ON;                           0492
         OI    ENDFLAG,B'10000000'                                 0492
*                          SETRC = MAX(TESTRC,SETRC);              0493
         LH    @15,SETRC                                           0493
         CR    @04,@15                                             0493
         BNL   *+6
         LR    @04,@15                                             0493
         STH   @04,SETRC                                           0493
*                          END;                                    0494
*                        ELSE                                      0495
*                          DO;                                     0495
         B     @RC00490                                            0495
@RF00490 DS    0H                                                  0496
*                          SETRC = MAX(SETRC,TESTRC);              0496
*                                                                  0496
         LH    @04,SETRC                                           0496
         LH    @15,TESTRC                                          0496
         CR    @04,@15                                             0496
         BNL   *+6
         LR    @04,@15                                             0496
         STH   @04,SETRC                                           0496
*                      /**********************************************/
*                      /*                                            */
*                      /*  DO REPEATED GETS UNTIL AN EOF IS FOUND.   */
*                      /*  THIS REORIENTS THE PROCESSOR TO THE       */
*                      /*  BEGINNING OF THE NEXT VALID ITEM IF ANY.  */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0497
*                          DO WHILE GETEOF = OFF;                  0497
         B     @DE00497                                            0497
@DL00497 DS    0H                                                  0498
*                            CALL IDCIOGT0(GDTTBL,PINIOCS);        0498
         L     @04,@PC00001                                        0498
         ST    @04,@AL00001                                        0498
         LA    @15,PINIOCS                                         0498
         ST    @15,@AL00001+4                                      0498
         MVI   @AL00001+4,X'80'                                    0498
         L     @15,GDTGET(,@04)                                    0498
         LA    @01,@AL00001                                        0498
         BALR  @14,@15                                             0498
*                            RESPECIFY RTNREG RSTD;                0499
*                            TESTRC = RTNREG;                      0500
         STH   RTNREG,TESTRC                                       0500
*                            RESPECIFY RTNREG UNRSTD;              0501
*                            IF TESTRC = 16                        0502
*                              THEN                                0502
         LH    @04,TESTRC                                          0502
         C     @04,@CF00483                                        0502
         BNE   @RF00502                                            0502
*                                GETEOF = ON;                      0503
         OI    GETEOF,B'10000000'                                  0503
*                          END;                                    0504
@RF00502 DS    0H                                                  0504
@DE00497 TM    GETEOF,B'10000000'                                  0504
         BZ    @DL00497                                            0504
*                          END;                                    0505
*                  END NVSAM;                                      0506
*                                                                  0506
*                ELSE                                              0507
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE TIMESTAMP TO DETERMINE IF THE OBJECT */
*                  /*  IS A GDG BASE.                                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0507
*                  IF TEXGDG = ON                                  0507
*                    THEN                                          0507
         B     @RC00482                                            0507
@RF00482 L     @04,CONRCPTR                                        0507
         TM    TEXGDG+8(@04),B'00000010'                           0507
         BNO   @RF00507                                            0507
*GDGBASE:              DO;                                         0508
*                                                                  0508
GDGBASE  DS    0H                                                  0509
*                      /**********************************************/
*                      /*                                            */
*                      /*  CALL GDGPROC TO HANDLE GDG BASES.         */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0509
*                      CALL GDGPROC;                               0509
         BAL   @14,GDGPROC                                         0509
*                      RESPECIFY RTNREG RSTD;                      0510
*                      TESTRC = RTNREG;                            0511
         STH   RTNREG,TESTRC                                       0511
*                      RESPECIFY RTNREG UNRSTD;                    0512
*                                                                  0512
*                      /**********************************************/
*                      /*                                            */
*                      /*  TEST THE RETURN CODE FROM GDGPROC.  IF IT */
*                      /*  IS 12, THEN SET ENDFLAG TO BE ON TO       */
*                      /*  TERMINATE FURTHER PROCESSING.  OTHERWISE, */
*                      /*  SET THE VALUE OF SETRC TO BE THE MAXIMUM  */
*                      /*  OF ITS CURRENT VALUE, AND THE VALUE OF    */
*                      /*  TESTRC.                                   */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0513
*                      RESPECIFY RTNREG RSTD;                      0513
*                      TESTRC = RTNREG;                            0514
         STH   RTNREG,TESTRC                                       0514
*                      RESPECIFY RTNREG UNRSTD;                    0515
*                      IF TESTRC ^= 0                              0516
*                        THEN                                      0516
         LH    @04,TESTRC                                          0516
         LTR   @04,@04                                             0516
         BZ    @RF00516                                            0516
*                          IF TESTRC = LASTCC12                    0517
*                            THEN                                  0517
         C     @04,@CF00035                                        0517
         BNE   @RF00517                                            0517
*                              DO;                                 0518
*                              ENDFLAG = ON;                       0519
         OI    ENDFLAG,B'10000000'                                 0519
*                              SETRC = MAX(TESTRC,SETRC);          0520
         LH    @15,SETRC                                           0520
         CR    @04,@15                                             0520
         BNL   *+6
         LR    @04,@15                                             0520
         STH   @04,SETRC                                           0520
*                              END;                                0521
*                            ELSE                                  0522
*                              DO;                                 0522
         B     @RC00517                                            0522
@RF00517 DS    0H                                                  0523
*                              SETRC = MAX(TESTRC,SETRC);          0523
*                                                                  0523
         LH    @04,TESTRC                                          0523
         LH    @15,SETRC                                           0523
         CR    @04,@15                                             0523
         BNL   *+6
         LR    @04,@15                                             0523
         STH   @04,SETRC                                           0523
*                          /******************************************/
*                          /*                                        */
*                          /*  DO REPEATED GETS UNTIL AN EOF IS      */
*                          /*  FOUND.  THIS REORIENTS THE PROCESSOR  */
*                          /*  TO THE BEGINNING OF THE NEXT VALID    */
*                          /*  ITEM ON THE PORTABLE DATA SET.        */
*                          /*                                        */
*                          /******************************************/
*                                                                  0524
*                              DO WHILE GETEOF = OFF;              0524
         B     @DE00524                                            0524
@DL00524 DS    0H                                                  0525
*                                CALL IDCIOGT0(GDTTBL,PINIOCS);    0525
         L     @04,@PC00001                                        0525
         ST    @04,@AL00001                                        0525
         LA    @15,PINIOCS                                         0525
         ST    @15,@AL00001+4                                      0525
         MVI   @AL00001+4,X'80'                                    0525
         L     @15,GDTGET(,@04)                                    0525
         LA    @01,@AL00001                                        0525
         BALR  @14,@15                                             0525
*                                RESPECIFY RTNREG RSTD;            0526
*                                TESTRC = RTNREG;                  0527
         STH   RTNREG,TESTRC                                       0527
*                                RESPECIFY RTNREG UNRSTD;          0528
*                                IF TESTRC = 16                    0529
*                                  THEN                            0529
         LH    @04,TESTRC                                          0529
         C     @04,@CF00483                                        0529
         BNE   @RF00529                                            0529
*                                    GETEOF = ON;                  0530
         OI    GETEOF,B'10000000'                                  0530
*                              END;                                0531
@RF00529 DS    0H                                                  0531
@DE00524 TM    GETEOF,B'10000000'                                  0531
         BZ    @DL00524                                            0531
*                              END;                                0532
*                                                                  0532
*                      END GDGBASE;                                0533
*                                                                  0533
*                    ELSE                                          0534
*                                                                  0534
*                      /**********************************************/
*                      /*                                            */
*                      /*  IF THE TIMESTAMP INDICATES THAT WE HAVE   */
*                      /*  A USERCATALOG POINTER TO REESTABLISH      */
*                      /*  IN THE CATALOG, CALL UCATPROC TO HANDLE   */
*                      /*  THE USER CATALOG, AND ITS ALIASES IF ANY. */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0534
*                      IF TEXUCT = ON                              0534
*                        THEN                                      0534
         B     @RC00507                                            0534
@RF00507 L     @04,CONRCPTR                                        0534
         TM    TEXUCT+8(@04),B'00000001'                           0534
         BNO   @RF00534                                            0534
*USERCAT:                  DO;                                     0535
USERCAT  DS    0H                                                  0536
*                          CALL UCATPROC;                          0536
*                                                                  0536
         BAL   @14,UCATPROC                                        0536
*                          /******************************************/
*                          /*                                        */
*                          /*  TEST THE RETURN CODE FROM UCATPROC.   */
*                          /*  IF IS IS 12, THEN UCATPROC ENCOUNTERED*/
*                          /*  A TERMINATING ERROR.  SET ENDFLAG     */
*                          /*  TO ESCAPE THE CURRENT LOOP.  OTHERWISE*/
*                          /*  MAKE SETRC EQUAL TO THE MAXIMUM OF ITS*/
*                          /*  PRESENT VALUE AND THAT OF TESTRC.     */
*                          /*                                        */
*                          /******************************************/
*                                                                  0537
*                          RESPECIFY RTNREG RSTD;                  0537
*                          TESTRC = RTNREG;                        0538
         STH   RTNREG,TESTRC                                       0538
*                          RESPECIFY RTNREG UNRSTD;                0539
*                                                                  0539
*                          IF TESTRC ^= 0                          0540
*                            THEN                                  0540
         LH    @04,TESTRC                                          0540
         LTR   @04,@04                                             0540
         BZ    @RF00540                                            0540
*                              IF TESTRC = LASTCC12                0541
*                                THEN                              0541
         C     @04,@CF00035                                        0541
         BNE   @RF00541                                            0541
*                                  DO;                             0542
*                                  ENDFLAG = ON;                   0543
         OI    ENDFLAG,B'10000000'                                 0543
*                                  SETRC = MAX(TESTRC,SETRC);      0544
         LH    @15,SETRC                                           0544
         CR    @04,@15                                             0544
         BNL   *+6
         LR    @04,@15                                             0544
         STH   @04,SETRC                                           0544
*                                  END;                            0545
*                                ELSE                              0546
*                                  DO;                             0546
         B     @RC00541                                            0546
@RF00541 DS    0H                                                  0547
*                                  SETRC = MAX(TESTRC,SETRC);      0547
*                                                                  0547
         LH    @04,TESTRC                                          0547
         LH    @15,SETRC                                           0547
         CR    @04,@15                                             0547
         BNL   *+6
         LR    @04,@15                                             0547
         STH   @04,SETRC                                           0547
*                              /**************************************/
*                              /*                                    */
*                              /*  DO REPEATED GETS TO REACH AN EOF. */
*                              /*                                    */
*                              /**************************************/
*                                                                  0548
*                                  DO WHILE GETEOF = OFF;          0548
         B     @DE00548                                            0548
@DL00548 DS    0H                                                  0549
*                                    CALL IDCIOGT0(GDTTBL,PINIOCS);
         L     @04,@PC00001                                        0549
         ST    @04,@AL00001                                        0549
         LA    @15,PINIOCS                                         0549
         ST    @15,@AL00001+4                                      0549
         MVI   @AL00001+4,X'80'                                    0549
         L     @15,GDTGET(,@04)                                    0549
         LA    @01,@AL00001                                        0549
         BALR  @14,@15                                             0549
*                                    RESPECIFY RTNREG RSTD;        0550
*                                    TESTRC = RTNREG;              0551
         STH   RTNREG,TESTRC                                       0551
*                                    RESPECIFY RTNREG UNRSTD;      0552
*                                    IF TESTRC = 16                0553
*                                      THEN                        0553
         LH    @04,TESTRC                                          0553
         C     @04,@CF00483                                        0553
         BNE   @RF00553                                            0553
*                                        GETEOF = ON;              0554
         OI    GETEOF,B'10000000'                                  0554
*                                  END;                            0555
@RF00553 DS    0H                                                  0555
@DE00548 TM    GETEOF,B'10000000'                                  0555
         BZ    @DL00548                                            0555
*                                  END;                            0556
*                          END USERCAT;                            0557
*                                                                  0557
*                        ELSE                                      0558
*                                                                  0558
*VSAM:                     DO;                                     0558
*                                                                  0558
         B     @RC00534                                            0558
@RF00534 DS    0H                                                  0558
VSAM     DS    0H                                                  0559
*                          /******************************************/
*                          /*                                        */
*                          /*     PROCESS IMPORTATION OF A           */
*                          /*  CLUSTER OR AN AIX.                    */
*                          /*                                        */
*                          /******************************************/
*                                                                  0559
*                          CALL CLUSPROC;                          0559
         BAL   @14,CLUSPROC                                        0559
*                          RESPECIFY RTNREG RSTD;                  0560
*                          TESTRC = RTNREG;                        0561
         STH   RTNREG,TESTRC                                       0561
*                          RESPECIFY RTNREG UNRSTD;                0562
*                                                                  0562
*                          IF TESTRC ^= 0                          0563
*                            THEN                                  0563
         LH    @04,TESTRC                                          0563
         LTR   @04,@04                                             0563
         BZ    @RF00563                                            0563
*                              IF TESTRC = LASTCC12                0564
*                                THEN                              0564
         C     @04,@CF00035                                        0564
         BNE   @RF00564                                            0564
*                                  DO;                             0565
*                                  ENDFLAG = ON;                   0566
         OI    ENDFLAG,B'10000000'                                 0566
*                                  SETRC = MAX(TESTRC,SETRC);      0567
         LH    @15,SETRC                                           0567
         CR    @04,@15                                             0567
         BNL   *+6
         LR    @04,@15                                             0567
         STH   @04,SETRC                                           0567
*                                  END;                            0568
*                                ELSE                              0569
*                                  DO;                             0569
         B     @RC00564                                            0569
@RF00564 DS    0H                                                  0570
*                                  SETRC = MAX(TESTRC,SETRC);      0570
*                                                                  0570
         LH    @04,TESTRC                                          0570
         LH    @15,SETRC                                           0570
         CR    @04,@15                                             0570
         BNL   *+6
         LR    @04,@15                                             0570
         STH   @04,SETRC                                           0570
*                              /**************************************/
*                              /*                                    */
*                              /*  DO REPEATED GETS TO REACH AN EOF. */
*                              /*                                    */
*                              /**************************************/
*                                                                  0571
*                                  DO WHILE GETEOF = OFF;          0571
         B     @DE00571                                            0571
@DL00571 DS    0H                                                  0572
*                                    CALL IDCIOGT0(GDTTBL,PINIOCS);
         L     @04,@PC00001                                        0572
         ST    @04,@AL00001                                        0572
         LA    @15,PINIOCS                                         0572
         ST    @15,@AL00001+4                                      0572
         MVI   @AL00001+4,X'80'                                    0572
         L     @15,GDTGET(,@04)                                    0572
         LA    @01,@AL00001                                        0572
         BALR  @14,@15                                             0572
*                                    RESPECIFY RTNREG RSTD;        0573
*                                    TESTRC = RTNREG;              0574
         STH   RTNREG,TESTRC                                       0574
*                                    RESPECIFY RTNREG UNRSTD;      0575
*                                    IF TESTRC = 16                0576
*                                      THEN                        0576
         LH    @04,TESTRC                                          0576
         C     @04,@CF00483                                        0576
         BNE   @RF00576                                            0576
*                                        GETEOF = ON;              0577
         OI    GETEOF,B'10000000'                                  0577
*                                  END;                            0578
@RF00576 DS    0H                                                  0578
@DE00571 TM    GETEOF,B'10000000'                                  0578
         BZ    @DL00571                                            0578
*                                  END;                            0579
*                                                                  0579
*                          /******************************************/
*                          /*                                        */
*                          /*  IF CLUSPROC HAS SET THE IMPF2DEL BIT, */
*                          /*  THEN THE OBJECT THAT WAS DEFINED MUST */
*                          /*  BE DELETED.                           */
*                          /*                                        */
*                          /******************************************/
*                                                                  0580
*                          IF IMPF2DEL = ON                        0580
*                            THEN                                  0580
@RC00564 DS    0H                                                  0580
@RF00563 TM    IMPF2DEL,B'01000000'                                0580
         BNO   @RF00580                                            0580
*DELVSAM:                      DO;                                 0581
*                                                                  0581
DELVSAM  DS    0H                                                  0582
*                              /**************************************/
*                              /*                                    */
*                              /*  CTGPLPTR AND CTGFVPTR POINT TO    */
*                              /*  THE CPL AND THE FVT FOR THE OBJECT*/
*                              /*  DEFINED.  PRINT A MESSAGE         */
*                              /*  INDICATING THAT THE OBJECT IS TO  */
*                              /*  BE DELETED.                       */
*                              /*                                    */
*                              /**************************************/
*                                                                  0582
*                              CTGPLPTR = PTRCPL;                  0582
         L     @04,PTRCPL                                          0582
         ST    @04,CTGPLPTR                                        0582
*                              CTGFVPTR = CTGFVT;                  0583
         L     @04,CTGFVT(,@04)                                    0583
         ST    @04,CTGFVPTR                                        0583
*                              DARGSMOD = IMPMSG;                  0584
         L     @04,DDSTRU                                          0584
         MVC   DARGSMOD(3,@04),@CC00945                            0584
*                              DARGSENT = IDELFAIL;                0585
*                                                                  0585
         MVI   DARGSENT(@04),X'09'                                 0585
*                              CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);
*                                                                  0586
         L     @04,@PC00001                                        0586
         ST    @04,@AL00001                                        0586
         LA    @15,@CF00119                                        0586
         ST    @15,@AL00001+4                                      0586
         LA    @15,DDSTRU                                          0586
         ST    @15,@AL00001+8                                      0586
         MVI   @AL00001+8,X'80'                                    0586
         L     @15,GDTPRT(,@04)                                    0586
         LA    @01,@AL00001                                        0586
         BALR  @14,@15                                             0586
*                              DARGLIST = ''B;                     0587
         L     @04,DDSTRU                                          0587
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0587
*                              DARGSMOD = IMPMSG;                  0588
*                                                                  0588
         MVC   DARGSMOD(3,@04),@CC00945                            0588
*                              /**************************************/
*                              /*                                    */
*                              /*  CALL CPLPROC TO BUILD A CPL FOR   */
*                              /*  THE CMS DELETE OPERATION.         */
*                              /*  THEN CALL DELTPROC TO DELETE THE  */
*                              /*  OBJECT.                           */
*                              /*                                    */
*                              /**************************************/
*                                                                  0589
*                              CALL CPLPROC('D',DCPLPTR,CTGFVENT,  0589
*                                 NULLPARM,CPSWD);                 0589
*                                                                  0589
         LA    @04,@CC00751                                        0589
         ST    @04,@AL00001                                        0589
         LA    @04,DCPLPTR                                         0589
         ST    @04,@AL00001+4                                      0589
         L     @04,CTGPLPTR                                        0589
         L     @04,CTGFVT(,@04)                                    0589
         LA    @04,CTGFVENT(,@04)                                  0589
         ST    @04,@AL00001+8                                      0589
         LA    @04,NULLPARM                                        0589
         ST    @04,@AL00001+12                                     0589
         LA    @04,CPSWD                                           0589
         ST    @04,@AL00001+16                                     0589
         LA    @01,@AL00001                                        0589
         BAL   @14,CPLPROC                                         0589
*                              RESPECIFY RTNREG RSTD;              0590
*                              TESTRC = RTNREG;                    0591
         STH   RTNREG,TESTRC                                       0591
*                              RESPECIFY RTNREG UNRSTD;            0592
*                              IF TESTRC ^= 0                      0593
*                                THEN                              0593
         LH    @04,TESTRC                                          0593
         LTR   @04,@04                                             0593
         BZ    @RF00593                                            0593
*                                  DO;                             0594
*                                  ENDFLAG = ON;                   0595
         OI    ENDFLAG,B'10000000'                                 0595
*                                  SETRC = MAX(SETRC,TESTRC);      0596
         LH    @15,SETRC                                           0596
         CR    @15,@04                                             0596
         BNL   *+6
         LR    @15,@04                                             0596
         STH   @15,SETRC                                           0596
*                                  END;                            0597
*                                                                  0597
*                              /**************************************/
*                              /*                                    */
*                              /*  SET THE CTGTYPE FIELD OF THE      */
*                              /*  CPL.                              */
*                              /*                                    */
*                              /**************************************/
*                                                                  0598
*                              DCPLPTR -> CTGTYPE = FVTPTR(1)->    0598
*                                 CTGFVTYP;                        0598
@RF00593 L     @04,DCPLPTR                                         0598
         L     @01,FVTPTR                                          0598
         MVC   CTGTYPE(1,@04),CTGFVTYP(@01)                        0598
*                              CALL DELTPROC(DCPLPTR);             0599
*                                                                  0599
         LA    @04,DCPLPTR                                         0599
         ST    @04,@AL00001                                        0599
         LA    @01,@AL00001                                        0599
         BAL   @14,DELTPROC                                        0599
*                              RESPECIFY RTNREG RSTD;              0600
*                              TESTRC = RTNREG;                    0601
         STH   RTNREG,TESTRC                                       0601
*                              RESPECIFY RTNREG UNRSTD;            0602
*                              IF TESTRC ^= 0                      0603
*                                THEN                              0603
         LH    @04,TESTRC                                          0603
         LTR   @04,@04                                             0603
         BZ    @RF00603                                            0603
*                                  SETRC = MAX(SETRC,TESTRC);      0604
         LH    @15,SETRC                                           0604
         CR    @15,@04                                             0604
         BNL   *+6
         LR    @15,@04                                             0604
         STH   @15,SETRC                                           0604
*                              END DELVSAM;                        0605
@RF00603 DS    0H                                                  0606
*                          /*********************************@OZ17068*/
*                          /*                                @OZ17068*/
*                          /*  TEST THE IMPORTRA MESSAGE     @OZ17068*/
*                          /*  FLAGS AND PRINT THE MESSAGES  @OZ17068*/
*                          /*  INDICATED. THESE MESSAGES ARE @OZ17068*/
*                          /*  TO BE PRINTED AFTER THE DELETE@OZ17068*/
*                          /*  MESSAGE IF IMPF2DEL IS ON.    @OZ17068*/
*                          /*                                @OZ17068*/
*                          /*********************************@OZ17068*/
*                                                          /*@OZ17068*/
*                          IF IMPMFIMF = ON /*IMPORTRA FAILED@OZ17068*/
*                            THEN                          /*@OZ17068*/
@RF00580 TM    IMPMFIMF,B'10000000'                                0606
         BNO   @RF00606                                            0606
*                              DO;                         /*@OZ17068*/
*                              CTGPLPTR = PTRCPL;          /*@OZ17068*/
         L     @04,PTRCPL                                          0608
         ST    @04,CTGPLPTR                                        0608
*                              CTGFVPTR = CTGFVT;          /*@OZ17068*/
         L     @04,CTGFVT(,@04)                                    0609
         ST    @04,CTGFVPTR                                        0609
*                              DARGLIST = ''B;             /*@OZ17068*/
         L     @04,DDSTRU                                          0610
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0610
*                              DARGSMOD = IMPMSG;          /*@OZ17068*/
         MVC   DARGSMOD(3,@04),@CC00945                            0611
*                              DARGSENT = MPRAFAIL;        /*@OZ17068*/
         MVI   DARGSENT(@04),X'15'                                 0612
*                              DARGILP = LENGTH(FENTNAME); /*@OZ17068*/
         MVC   DARGILP(2,@04),@CH00605                             0613
*                              DARGDBP =                   /*@OZ17068*/
*                                  FVTPTR(1)->CTGFVENT;    /*@OZ17068*/
         L     @01,FVTPTR                                          0614
         L     @15,CTGFVENT(,@01)                                  0614
         ST    @15,DARGDBP(,@04)                                   0614
*                                                          /*@OZ17068*/
*                              CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);
         L     @04,@PC00001                                        0615
         ST    @04,@AL00001                                        0615
         LA    @15,@CF00119                                        0615
         ST    @15,@AL00001+4                                      0615
         LA    @15,DDSTRU                                          0615
         ST    @15,@AL00001+8                                      0615
         MVI   @AL00001+8,X'80'                                    0615
         L     @15,GDTPRT(,@04)                                    0615
         LA    @01,@AL00001                                        0615
         BALR  @14,@15                                             0615
*                                                          /*@OZ17068*/
*                              DARGLIST = ''B;             /*@OZ17068*/
         L     @04,DDSTRU                                          0616
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0616
*                              DARGSMOD = IMPMSG;          /*@OZ17068*/
         MVC   DARGSMOD(3,@04),@CC00945                            0617
*                              END;                        /*@OZ17068*/
*                                                          /*@OZ17068*/
*                          IF IMPMFDNM = ON /*DUMMY NAME IN  @OZ17068*/
*                            THEN           /*CATALOG        @OZ17068*/
@RF00606 TM    IMPMFDNM,B'01000000'                                0619
         BNO   @RF00619                                            0619
*                              DO;                         /*@OZ17068*/
*                              DARGLIST = ''B;             /*@OZ17068*/
         L     @04,DDSTRU                                          0621
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0621
*                              DARGSMOD = IMPMSG;          /*@OZ17068*/
         MVC   DARGSMOD(3,@04),@CC00945                            0622
*                              DARGSENT = DNMINCAT;        /*@OZ17068*/
         MVI   DARGSENT(@04),X'1C'                                 0623
*                                                          /*@OZ17068*/
*                              CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);
         L     @04,@PC00001                                        0624
         ST    @04,@AL00001                                        0624
         LA    @15,@CF00119                                        0624
         ST    @15,@AL00001+4                                      0624
         LA    @15,DDSTRU                                          0624
         ST    @15,@AL00001+8                                      0624
         MVI   @AL00001+8,X'80'                                    0624
         L     @15,GDTPRT(,@04)                                    0624
         LA    @01,@AL00001                                        0624
         BALR  @14,@15                                             0624
*                                                          /*@OZ17068*/
*                              DARGLIST = ''B;             /*@OZ17068*/
         L     @04,DDSTRU                                          0625
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0625
*                              DARGSMOD = IMPMSG;          /*@OZ17068*/
         MVC   DARGSMOD(3,@04),@CC00945                            0626
*                              END;                        /*@OZ17068*/
*                        END VSAM;                                 0628
@RF00619 DS    0H                                                  0629
*              END NOTEND;                                         0629
@RC00534 DS    0H                                                  0629
@RC00507 DS    0H                                                  0629
@RC00482 DS    0H                                                  0630
*          /**********************************************************/
*          /*                                                        */
*          /*  IF THE DEALLOC BIT IS SET, THERE IS SOMETHING TO      */
*          /*  DYNAMICALLY UNALLOCATE.  ISSUE THE UDEALLOC MACRO.    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0630
*          IF DEALLOC = ON                                         0630
*            THEN                                                  0630
@RF00460 TM    DEALLOC,B'10000000'                                 0630
         BNO   @RF00630                                            0630
*              CALL IDCSADL0(GDTTBL,ALLAGL);                       0631
*                                                                  0631
         L     @04,@PC00001                                        0631
         ST    @04,@AL00001                                        0631
         L     @01,ALLPTR                                          0631
         ST    @01,@AL00001+4                                      0631
         MVI   @AL00001+4,X'80'                                    0631
         L     @15,GDTDLC(,@04)                                    0631
         LA    @01,@AL00001                                        0631
         BALR  @14,@15                                             0631
*          /*************************************************@OZ16022*/
*          /*                                                @OZ16022*/
*          /*  TEST FOR ANY SPECIAL MESSAGES TO BE LISTED    @OZ16022*/
*          /*  ERROR OR INFORMATIONAL                        @OZ16022*/
*          /*                                                @OZ16022*/
*          /*************************************************@OZ16022*/
*                                                          /*@OZ16022*/
*          IF DEFSTID ^= NORMSTAT                          /*@OZ16022*/
*            THEN                                          /*@OZ16022*/
@RF00630 CLI   DEFSTID,0                                           0632
         BE    @RF00632                                            0632
*              DO;                                         /*@OZ16022*/
*              DARGSENT = DEFSTID;                         /*@OZ16022*/
         IC    @04,DEFSTID                                         0634
         L     @01,DDSTRU                                          0634
         STC   @04,DARGSENT(,@01)                                  0634
*                                                          /*@OZ16022*/
*              CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);      /*@OZ16022*/
         L     @04,@PC00001                                        0635
         ST    @04,@AL00001                                        0635
         LA    @15,@CF00119                                        0635
         ST    @15,@AL00001+4                                      0635
         LA    @15,DDSTRU                                          0635
         ST    @15,@AL00001+8                                      0635
         MVI   @AL00001+8,X'80'                                    0635
         L     @15,GDTPRT(,@04)                                    0635
         LA    @01,@AL00001                                        0635
         BALR  @14,@15                                             0635
*                                                          /*@OZ16022*/
*              END;                                        /*@OZ16022*/
*                                                          /*@OZ16022*/
*          /**********************************************************/
*          /*                                                        */
*          /*  RESET THE VALUES IN THE DARGLIST.                     */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0637
*          DARGLIST = ''B;                                         0637
@RF00632 L     @04,DDSTRU                                          0637
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0637
*          DARGSMOD = IMPMSG;                                      0638
         MVC   DARGSMOD(3,@04),@CC00945                            0638
*          DEFSTID = NORMSTAT;                                     0639
*                                                                  0639
         MVI   DEFSTID,X'00'                                       0639
*          /**********************************************************/
*          /*                                                        */
*          /*  FREE ANY STORAGE GOTTEN DURING THIS ITERATION THAT    */
*          /*  HAS NOT ALREADY BEEN FREED.                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0640
*          CALL IDCSAFP0(GDTTBL,GPID);                             0640
*                                                                  0640
         L     @04,@PC00001                                        0640
         ST    @04,@AL00001                                        0640
         LA    @15,GPID                                            0640
         ST    @15,@AL00001+4                                      0640
         MVI   @AL00001+4,X'80'                                    0640
         L     @15,GDTFPL(,@04)                                    0640
         LA    @01,@AL00001                                        0640
         BALR  @14,@15                                             0640
*        END MPLOOP;                                               0641
@DE00432 TM    ENDFLAG,B'10000000'                                 0641
         BZ    @DL00432                                            0641
*        OLDERID2 = NEWERID2;                                      0642
         L     @04,@PC00001                                        0642
         L     @15,GDTTR2(,@04)                                    0642
         MVC   @TS00001(95),NEWERID2(@15)                          0642
         MVC   OLDERID2(95,@15),@TS00001                           0642
*        NEWID2 = 'RMEL';                                          0643
*                                                                  0643
         MVC   NEWID2(4,@15),@CC01330                              0643
*        /************************************************************/
*        /*                                                          */
*        /*   TERMINATION PROCESSING WILL LIST APPROPRIATE ERROR     */
*        /*   MESSAGES, AND INDICATE THE FINAL STATUS OF IMPORT      */
*        /*   IN LASTCC.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0644
*        IF GDTDBG = NULLPTR                                       0644
*          THEN;                                                   0644
         L     @04,GDTDBG(,@04)                                    0644
         LTR   @04,@04                                             0644
         BZ    @RT00644                                            0644
*          ELSE                                                    0646
*            CALL IDCDB010 (GDTTBL,'RMFN');                        0646
*                                                                  0646
         L     @04,@PC00001                                        0646
         ST    @04,@AL00001                                        0646
         LA    @15,@CC01331                                        0646
         ST    @15,@AL00001+4                                      0646
         MVI   @AL00001+4,X'80'                                    0646
         L     @15,GDTDBG(,@04)                                    0646
         LA    @01,@AL00001                                        0646
         BALR  @14,@15                                             0646
*        /************************************************************/
*        /*                                                          */
*        /*  CLOSE ANY OPEN DATA SETS                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0647
*        IF POUTIOCS ^= NULLPTR                                    0647
*          THEN                                                    0647
@RT00644 L     @04,POUTIOCS                                        0647
         LTR   @04,@04                                             0647
         BZ    @RF00647                                            0647
*            CALL IDCIOCL0 (GDTTBL,POUTIOCS);/*                    0648
*                                        OUTPUT - THE CLUSTER        */
*                                                                  0648
         L     @04,@PC00001                                        0648
         ST    @04,@AL00001                                        0648
         LA    @15,POUTIOCS                                        0648
         ST    @15,@AL00001+4                                      0648
         MVI   @AL00001+4,X'80'                                    0648
         L     @15,GDTCLS(,@04)                                    0648
         LA    @01,@AL00001                                        0648
         BALR  @14,@15                                             0648
*        IF PINIOCS ^= NULLPTR         /*INPUT - PORTABLE DATA SET   */
*          THEN                                                    0649
@RF00647 L     @04,PINIOCS                                         0649
         LTR   @04,@04                                             0649
         BZ    @RF00649                                            0649
*            CALL IDCIOCL0 (GDTTBL,PINIOCS);                       0650
*                                                                  0650
         L     @04,@PC00001                                        0650
         ST    @04,@AL00001                                        0650
         LA    @15,PINIOCS                                         0650
         ST    @15,@AL00001+4                                      0650
         MVI   @AL00001+4,X'80'                                    0650
         L     @15,GDTCLS(,@04)                                    0650
         LA    @01,@AL00001                                        0650
         BALR  @14,@15                                             0650
*        /************************************************************/
*        /*                                                          */
*        /*  ISSUE FINAL COMPLETION MESSAGE INDICATING WHETHER       */
*        /*  IMPORT WAS SUCCESSFUL OR NOT.                           */
*        /*  SET LASTCC TO INDICATE SUCCESS OR FAILURE TO THE        */
*        /*  AMS EXECUTIVE                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0651
*        IF (SETRC > LASTCC00) & (GDTECT ^= NULLPTR)               0651
*          THEN                                                    0651
@RF00649 SLR   @04,@04                                             0651
         CH    @04,SETRC                                           0651
         BNL   @RF00651                                            0651
         L     @15,@PC00001                                        0651
         C     @04,GDTECT(,@15)                                    0651
         BE    @RF00651                                            0651
*            DARGSENT = TSOFAIL;       /*IMPORTRA FAILED             */
         L     @04,DDSTRU                                          0652
         MVI   DARGSENT(@04),X'0F'                                 0652
*          ELSE                                                    0653
*            IF SETRC < LASTCC12                           /*@ZA16093*/
*              THEN                                                0653
         B     @RC00651                                            0653
@RF00651 LH    @04,SETRC                                           0653
         C     @04,@CF00035                                        0653
         BNL   @RF00653                                            0653
*                DARGSENT = IMPTGOOD;  /*IMPORTRA SUCCESSFUL         */
         L     @04,DDSTRU                                          0654
         MVI   DARGSENT(@04),X'01'                                 0654
*              ELSE                                                0655
*                DARGSENT = IMPTFAIL;                              0655
*                                                                  0655
         B     @RC00653                                            0655
@RF00653 L     @04,DDSTRU                                          0655
         MVI   DARGSENT(@04),X'03'                                 0655
*        LASTCC = SETRC;                                           0656
@RC00653 DS    0H                                                  0656
@RC00651 L     @04,@PC00001+8                                      0656
         LH    @15,SETRC                                           0656
         STH   @15,LASTCC(,@04)                                    0656
*        DARGSMOD = UNIVMSG;                                       0657
         L     @15,DDSTRU                                          0657
         MVC   DARGSMOD(3,@15),@CC00981                            0657
*        DARGDBP = ADDR(LASTCC);                                   0658
         ST    @04,DARGDBP(,@15)                                   0658
*        DARGILP = LENGTH(LASTCC);                                 0659
*                                                                  0659
         MVC   DARGILP(2,@15),@CH00157                             0659
*        CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);                    0660
*                                                                  0660
         L     @04,@PC00001                                        0660
         ST    @04,@AL00001                                        0660
         LA    @15,@CF00119                                        0660
         ST    @15,@AL00001+4                                      0660
         LA    @15,DDSTRU                                          0660
         ST    @15,@AL00001+8                                      0660
         MVI   @AL00001+8,X'80'                                    0660
         L     @15,GDTPRT(,@04)                                    0660
         LA    @01,@AL00001                                        0660
         BALR  @14,@15                                             0660
*        /************************************************************/
*        /*                                                          */
*        /*  ISSUE THE UEPIL MACRO TO RETURN TO THE AMS EXECUTIVE.   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0661
*        CALL IDCSAEP0(GDTTBL,MODID,LASTCC);                       0661
         L     @04,@PC00001                                        0661
         ST    @04,@AL00001                                        0661
         LA    @15,MODID                                           0661
         ST    @15,@AL00001+4                                      0661
         L     @15,@PC00001+8                                      0661
         ST    @15,@AL00001+8                                      0661
         MVI   @AL00001+8,X'80'                                    0661
         L     @15,GDTEPL(,@04)                                    0661
         LA    @01,@AL00001                                        0661
         BALR  @14,@15                                             0661
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - CLUSPROC                               */
*        /*                                                          */
*        /*  FUNCTION - READ CATALOG AND DATA RECORDS FROM THE       */
*        /*  PORTABILITY VOLUME, USE CATALOG INFORMATION FROM THE    */
*        /*  FROM CATALOG RECORDS PLUS INFORMATION FROM THE AMS      */
*        /*  COMMAND TO PERFORM A CATALOG DEFINE FOR THE             */
*        /*  OBJECT, COPY DATA INTO THE DATA SET AFTER SUCCESSFUL    */
*        /*  DEFINITION IN THE CATALOG                               */
*        /*  CLUSPROC PROCESSES EXPORTED KSDS'S, RRDS'S,             */
*        /*  ESDS'S, AND AIX'S AS WELL AS THEIR ASSOCIATED           */
*        /*  PATHS.                                                  */
*        /*                                                          */
*        /*  INPUT - FUNCTION DEFINITION TABLE                       */
*        /*                                                          */
*        /*  OUTPUT- A RECREATED CLUSTER OR AIX                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0662
*CLUSPROC: PROCEDURE;                                              0662
*                                                                  0662
@EL00001 L     @13,4(,@13)                                         0662
@EF00001 L     @00,@SIZDATD                                        0662
         LR    @01,@05                                             0662
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0662
         BR    @14                                                 0662
CLUSPROC STM   @14,@12,@SA00002                                    0662
*        /************************************************************/
*        /*                                                          */
*        /*  PERFORM INITIALIZATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0663
*        OLDERID2 = NEWERID2;                                      0663
         L     @04,@PC00001                                        0663
         L     @04,GDTTR2(,@04)                                    0663
         MVC   @TS00001(95),NEWERID2(@04)                          0663
         MVC   OLDERID2(95,@04),@TS00001                           0663
*        NEWID2 = 'RMCP';                                          0664
*                                                                  0664
         MVC   NEWID2(4,@04),@CC01335                              0664
*        /************************************************************/
*        /*                                                          */
*        /*  COMPUTE HOW MANY OBJECTS THERE ARE TO BE                */
*        /*  IMPORTED EXCLUSIVE OF PATHS AND SET THE                 */
*        /*  KSDSFLAG ACCORDINGLY.                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0665
*        IF IMPASSOC = OFF                                         0665
*          THEN                                                    0665
*                                                                  0665
         TM    IMPASSOC,B'00100000'                                0665
         BNZ   @RF00665                                            0665
*            /********************************************************/
*            /*                                                      */
*            /*  THERE ARE NO PATH ASSOCIATIONS PRESENT.             */
*            /*  THE NUMBER OF COMPONENTS IS EQUAL TO                */
*            /*  THE NUMBER OF OBJECTS PRESENT IN THE                */
*            /*  PORTABILITY DATA SET.                               */
*            /*                                                      */
*            /********************************************************/
*                                                                  0666
*            NUMCOMP = NUMOBJ;                                     0666
*                                                                  0666
         LH    @04,NUMOBJ                                          0666
         STH   @04,NUMCOMP                                         0666
*          ELSE                                                    0667
*                                                                  0667
*            /********************************************************/
*            /*                                                      */
*            /*  THERE ARE PATH ASSOCIATIONS PRESENT.  USE           */
*            /*  THE IMPBASE BIT TO DETERMINE IF AN INDEX            */
*            /*  COMPONENT HAS BEEN EXPORTED.                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  0667
*            IF IMPBASE = ON                                       0667
*              THEN                                                0667
*                                                                  0667
         B     @RC00665                                            0667
@RF00665 TM    IMPBASE,B'00010000'                                 0667
         BNO   @RF00667                                            0667
*                /****************************************************/
*                /*                                                  */
*                /*  THERE IS AN INDEX COMPONENT ON THE              */
*                /*  PORTABILITY DATA SET.  SET THE VALUE            */
*                /*  OF NUMCOMP TO BE THREE.                         */
*                /*                                                  */
*                /****************************************************/
*                                                                  0668
*                NUMCOMP = 3;                                      0668
*                                                                  0668
         MVC   NUMCOMP(2),@CH00165                                 0668
*              ELSE                                                0669
*                                                                  0669
*                /****************************************************/
*                /*                                                  */
*                /*  IMPBASE IS OFF, INDICATING THAT THERE           */
*                /*  IS NO INDEX COMPONENT.  SET NUMCOMP TO          */
*                /*  BE TWO.                                         */
*                /*                                                  */
*                /****************************************************/
*                                                                  0669
*                NUMCOMP = 2;                                      0669
*                                                                  0669
         B     @RC00667                                            0669
@RF00667 MVC   NUMCOMP(2),@CH00157                                 0669
*        /************************************************************/
*        /*                                                          */
*        /*  IF NUMCOMP IS 3, WE ARE IMPORTING A KSDS, SO            */
*        /*  THE KSDSFLAG IS SET TO ON.  OTHERWISE                   */
*        /*  THE OBJECT BEING IMPORTED IS NOT A KSDS, AND            */
*        /*  THE KSDSFLAG MUST BE SET TO OFF.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0670
*        IF NUMCOMP = 3                                            0670
*          THEN                                                    0670
@RC00667 DS    0H                                                  0670
@RC00665 CLC   NUMCOMP(2),@CH00165                                 0670
         BNE   @RF00670                                            0670
*            KSDSFLAG = ON;                                        0671
         OI    KSDSFLAG,B'10000000'                                0671
*          ELSE                                                    0672
*            KSDSFLAG = OFF;                                       0672
*                                                                  0672
*                                                                  0672
         B     @RC00670                                            0672
@RF00670 NI    KSDSFLAG,B'01111111'                                0672
*        /************************************************************/
*        /*                                                          */
*        /*  SET ADDRESS OF  CONTROL RECORD BUFFER WHICH WILL        */
*        /*  CONTAIN DICTIONARY FOR CATALOG RECORDS                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0673
*        CONRCPTR = ADDR(CONRCARE);                                0673
*                                                                  0673
@RC00670 LA    @04,CONRCARE                                        0673
         ST    @04,CONRCPTR                                        0673
*        /************************************************************/
*        /*                                                          */
*        /*  ZERO OUT THE AREA THAT HOLDS THE CONTROL RECORD         */
*        /*  BEGIN BY INITIALIZING THE VALUES OF ZSIZE, ZPTR         */
*        /*  AND ZCNTRL.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0674
*        ZSIZE = LENGTH(CONRCARE);                                 0674
         MVC   ZSIZE(2),@CH00920                                   0674
*        ZPTR = CONRCPTR;                                          0675
         ST    @04,ZPTR                                            0675
*        ZCNTRL = ON;                                              0676
*                                                                  0676
         OI    ZCNTRL,B'10000000'                                  0676
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP CLEARING OUT THE BUFFER FOR THE CONTROL            */
*        /*  RECORD.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0677
*        DO WHILE (ZCNTRL = ON);                                   0677
         B     @DE00677                                            0677
@DL00677 DS    0H                                                  0678
*          IF ZSIZE > 256                                          0678
*            THEN                                                  0678
         LH    @04,ZSIZE                                           0678
         LA    @15,256                                             0678
         CR    @04,@15                                             0678
         BNH   @RF00678                                            0678
*              DO;                                                 0679
*              ZAREA(1:256) = ZER(1:256);                          0680
         L     @14,ZPTR                                            0680
         MVC   ZAREA(256,@14),ZER                                  0680
*              ZSIZE = ZSIZE - 256;                                0681
         SLR   @04,@15                                             0681
         STH   @04,ZSIZE                                           0681
*              ZPTR = ZPTR + 256;                                  0682
         ALR   @14,@15                                             0682
         ST    @14,ZPTR                                            0682
*              END;                                                0683
*            ELSE                                                  0684
*              DO;                                                 0684
         B     @RC00678                                            0684
@RF00678 DS    0H                                                  0685
*              ZAREA(1:ZSIZE) = ZER(1:ZSIZE);                      0685
         L     @04,ZPTR                                            0685
         LH    @15,ZSIZE                                           0685
         BCTR  @15,0                                               0685
         EX    @15,@SM01777                                        0685
*              ZCNTRL = OFF;                                       0686
         NI    ZCNTRL,B'01111111'                                  0686
*              END;                                                0687
*        END;                                                      0688
*                                                                  0688
@RC00678 DS    0H                                                  0688
@DE00677 TM    ZCNTRL,B'10000000'                                  0688
         BO    @DL00677                                            0688
*        /************************************************************/
*        /*                                                          */
*        /*  PROCESS CATALOG INFORMATION FROM THE PORTABILITY VOLUME */
*        /*                                                          */
*        /************************************************************/
*                                                                  0689
*        OLDERID2 = NEWERID2;                                      0689
         L     @04,@PC00001                                        0689
         L     @04,GDTTR2(,@04)                                    0689
         MVC   @TS00001(95),NEWERID2(@04)                          0689
         MVC   OLDERID2(95,@04),@TS00001                           0689
*        NEWID2 = 'RMCT';                                          0690
*                                                                  0690
         MVC   NEWID2(4,@04),@CC01336                              0690
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT THE CPL TO BE EMPLOYED FOR THE DEFINE         */
*        /*  FUNCTION.  IF NOT CONSTRUCTED SUCCESSFULLY, RETURN TO   */
*        /*  THE CALLING PROCESSOR WITH AN ERROR INDICATOR           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0691
*        CALL CPLPROC('F',PTRCPL,NULLPARM,NULLPARM,NULLPARM);      0691
         MVC   @AL00001(20),@AL00691                               0691
         LA    @04,PTRCPL                                          0691
         ST    @04,@AL00001+4                                      0691
         LA    @01,@AL00001                                        0691
         BAL   @14,CPLPROC                                         0691
*        RESPECIFY RTNREG RSTD;                                    0692
*        TESTRC = RTNREG;                                          0693
         STH   RTNREG,TESTRC                                       0693
*        RESPECIFY RTNREG UNRSTD;                                  0694
*        IF TESTRC ^= 0                                            0695
*          THEN                                                    0695
         LH    @04,TESTRC                                          0695
         LTR   @04,@04                                             0695
         BZ    @RF00695                                            0695
*            RETURN CODE(LASTCC12);                                0696
         LA    @15,12                                              0696
         L     @14,@SA00002                                        0696
         LM    @00,@12,@SA00002+8                                  0696
         BR    @14                                                 0696
*        CTGPLPTR = PTRCPL;                                        0697
*                                                                  0697
*                                                                  0697
@RF00695 L     @04,PTRCPL                                          0697
         ST    @04,CTGPLPTR                                        0697
*CATLOOP:  DO I = 1 TO NUMCOMP;                                    0698
*                                                                  0698
CATLOOP  LA    @04,1                                               0698
         B     @DE00698                                            0698
@DL00698 DS    0H                                                  0699
*        /************************************************************/
*        /*                                                          */
*        /*  READ CONTROL RECORD FROM PORTABLE DATA SET, CONTAINING  */
*        /*  DICTIONARY FOR CATALOG INFORMATION.                     */
*        /*  IF UNSUCCESSFUL, RETURN TO CALLING PROCESSOR.           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0699
*        CALL IDCIOGT0 (GDTTBL,PINIOCS);                           0699
*                                                                  0699
         L     @04,@PC00001                                        0699
         ST    @04,@AL00001                                        0699
         LA    @15,PINIOCS                                         0699
         ST    @15,@AL00001+4                                      0699
         MVI   @AL00001+4,X'80'                                    0699
         L     @15,GDTGET(,@04)                                    0699
         LA    @01,@AL00001                                        0699
         BALR  @14,@15                                             0699
*        RESPECIFY RTNREG RSTD;                                    0700
*        TESTRC = RTNREG;                                          0701
         STH   RTNREG,TESTRC                                       0701
*        RESPECIFY RTNREG UNRSTD;                                  0702
*        IF TESTRC ^= 0                                            0703
*          THEN                                                    0703
         LH    @04,TESTRC                                          0703
         LTR   @04,@04                                             0703
         BZ    @RF00703                                            0703
*            RETURN CODE(LASTCC12);                                0704
*                                                                  0704
         LA    @15,12                                              0704
         L     @14,@SA00002                                        0704
         LM    @00,@12,@SA00002+8                                  0704
         BR    @14                                                 0704
*        /************************************************************/
*        /*                                                          */
*        /*  MOVE CONTROL RECORD JUST READ INTO BUFFER               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0705
*        TFVTLEN = IOCDAD -> HEADLN;                               0705
*                                                                  0705
@RF00703 L     @04,IOCSPTR                                         0705
         L     @01,IOCDAD(,@04)                                    0705
         LH    @15,HEADLN(,@01)                                    0705
         STH   @15,TFVTLEN                                         0705
*        CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);                   0706
*                                                                  0706
         LA    @15,TFVTLEN                                         0706
         ST    @15,@AL00001                                        0706
         ST    @04,@AL00001+4                                      0706
         LA    @04,CONRCPTR                                        0706
         ST    @04,@AL00001+8                                      0706
         LA    @01,@AL00001                                        0706
         BAL   @14,MVDAPROC                                        0706
*        IF HEADFLG1 = HDFL1CAT                                    0707
*          THEN                                                    0707
         L     @04,CONRCPTR                                        0707
         CLI   HEADFLG1(@04),X'FF'                                 0707
         BNE   @RF00707                                            0707
*HDCAT:      DO;                                                   0708
*                                                                  0708
HDCAT    DS    0H                                                  0709
*            /********************************************************/
*            /*                                                      */
*            /*  GET A BUFFER FOR THE NEXT RECORD WHICH WILL BE      */
*            /*  A DATA RECORD CONTAINING CATALOG LOCATE WORK AREA   */
*            /*  IF CORE IS NOT OBTAINED SUCCESSFULLY, RETURN TO     */
*            /*  THE CALLING PROCEDURE                               */
*            /*                                                      */
*            /********************************************************/
*                                                                  0709
*                                                                  0709
*            TOTLEN = ASSRECLN;                                    0709
*                                                                  0709
         L     @04,CONRCPTR                                        0709
         LH    @04,ASSRECLN(,@04)                                  0709
         ST    @04,TOTLEN                                          0709
*            CALL IDCSAGP0 (GDTTBL,TOTLEN,WORKAR(I),GPID,SETZERO); 0710
*                                                                  0710
         L     @04,@PC00001                                        0710
         ST    @04,@AL00001                                        0710
         LA    @15,TOTLEN                                          0710
         ST    @15,@AL00001+4                                      0710
         L     @15,I                                               0710
         SLA   @15,2                                               0710
         LA    @15,WORKAR-4(@15)                                   0710
         ST    @15,@AL00001+8                                      0710
         LA    @15,GPID                                            0710
         ST    @15,@AL00001+12                                     0710
         LA    @15,SETZERO                                         0710
         ST    @15,@AL00001+16                                     0710
         MVI   @AL00001+16,X'80'                                   0710
         L     @15,GDTGPL(,@04)                                    0710
         LA    @01,@AL00001                                        0710
         BALR  @14,@15                                             0710
*            RESPECIFY RTNREG RSTD;                                0711
*            TESTRC = RTNREG;                                      0712
         STH   RTNREG,TESTRC                                       0712
*            RESPECIFY RTNREG UNRSTD;                              0713
*            IF TESTRC ^= 0                                        0714
*              THEN                                                0714
         LH    @04,TESTRC                                          0714
         LTR   @04,@04                                             0714
         BZ    @RF00714                                            0714
*                DO;                                               0715
*                DEFSTID = NOSTORAG;                               0716
         MVI   DEFSTID,X'04'                                       0716
*                DARGSMOD = UNIVMSG;                               0717
         L     @04,DDSTRU                                          0717
         MVC   DARGSMOD(3,@04),@CC00981                            0717
*                RETURN CODE(LASTCC12);                            0718
         LA    @15,12                                              0718
         L     @14,@SA00002                                        0718
         LM    @00,@12,@SA00002+8                                  0718
         BR    @14                                                 0718
*                END;                                              0719
*                                                                  0719
*            /********************************************************/
*            /*                                                      */
*            /*  NOW READ A DATA RECORD WHICH WILL CONTAIN THE       */
*            /*  CATALOG FIELD INFORMATION WHICH IS REFERENCED BY    */
*            /*  THE DICTIONARY CONTAINED IN THE CONTROL RECORD      */
*            /*  IF AN ERROR IS ENCOUNTERED, RETURN TO CALLING       */
*            /*  PROCESSOR                                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  0720
*            CALL GETPROC(WORKAR(I),ASSRECLN);                     0720
*                                                                  0720
@RF00714 L     @04,I                                               0720
         SLA   @04,2                                               0720
         LA    @04,WORKAR-4(@04)                                   0720
         ST    @04,@AL00001                                        0720
         L     @04,CONRCPTR                                        0720
         LA    @04,ASSRECLN(,@04)                                  0720
         ST    @04,@AL00001+4                                      0720
         LA    @01,@AL00001                                        0720
         BAL   @14,GETPROC                                         0720
*            RESPECIFY RTNREG RSTD;                                0721
*            TESTRC = RTNREG;                                      0722
         STH   RTNREG,TESTRC                                       0722
*            RESPECIFY RTNREG UNRSTD;                              0723
*            IF TESTRC ^= 0                                        0724
*              THEN                                                0724
         LH    @04,TESTRC                                          0724
         LTR   @04,@04                                             0724
         BZ    @RF00724                                            0724
*                RETURN CODE(LASTCC12);                            0725
*                                                                  0725
         LA    @15,12                                              0725
         L     @14,@SA00002                                        0725
         LM    @00,@12,@SA00002+8                                  0725
         BR    @14                                                 0725
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FVT TO CORRESPOND TO THIS RECORD OF        */
*            /*  CATALOG INFORMATION.  FVTPROC WILL GET CORE         */
*            /*  AND BUILD FPLS FROM INFORMATION IN THE DICTIONARY   */
*            /*  AND WORK AREA.                                      */
*            /*  IF AN ERROR IS ENCOUNTERED, RETURN TO CALLING       */
*            /*  PROCESSOR                                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  0726
*            DICTPTR = ADDR(VARDATA);                              0726
*                                                                  0726
@RF00724 L     @04,CONRCPTR                                        0726
         LA    @04,VARDATA(,@04)                                   0726
         ST    @04,DICTPTR                                         0726
*            CALL FVTPROC(DICTPTR,WORKAR(I),FVTPTR(I));            0727
*                                                                  0727
         LA    @04,DICTPTR                                         0727
         ST    @04,@AL00001                                        0727
         L     @04,I                                               0727
         SLA   @04,2                                               0727
         LA    @15,WORKAR-4(@04)                                   0727
         ST    @15,@AL00001+4                                      0727
         LA    @04,FVTPTR-4(@04)                                   0727
         ST    @04,@AL00001+8                                      0727
         LA    @01,@AL00001                                        0727
         BAL   @14,FVTPROC                                         0727
*            RESPECIFY RTNREG RSTD;                                0728
*            TESTRC = RTNREG;                                      0729
         STH   RTNREG,TESTRC                                       0729
*            RESPECIFY RTNREG UNRSTD;                              0730
*            IF TESTRC ^= 0                                        0731
*              THEN                                                0731
         LH    @04,TESTRC                                          0731
         LTR   @04,@04                                             0731
         BZ    @RF00731                                            0731
*                RETURN CODE(LASTCC12);                            0732
*                                                                  0732
         LA    @15,12                                              0732
         L     @14,@SA00002                                        0732
         LM    @00,@12,@SA00002+8                                  0732
         BR    @14                                                 0732
*            /********************************************************/
*            /*                                                      */
*            /*  PLACE THE FVT POINTER IN   PROPER FIELD.THE CLUSTER */
*            /*  FVT POINTER WILL BE PLACED IN THE CPL.  THE DATA OR */
*            /*  INDEX OBJECT FVT POINTERS WILL BE PLACED IN CLUSTER */
*            /*  OR AIX FVT.                                         */
*            /*                                                      */
*            /********************************************************/
*                                                                  0733
*            RESPECIFY CTGFV BASED(CTGFVPTR);                      0733
@RF00731 DS    0H                                                  0734
*            CTGFVPTR = FVTPTR(I);                                 0734
         L     @04,I                                               0734
         SLA   @04,2                                               0734
         L     @04,FVTPTR-4(@04)                                   0734
         ST    @04,CTGFVPTR                                        0734
*            IF CTGFVTYP = CTGTCL × CTGFVTYP = CTGTAIX             0735
*              THEN                                                0735
         CLI   CTGFVTYP(@04),C'C'                                  0735
         BE    @RT00735                                            0735
         CLI   CTGFVTYP(@04),C'G'                                  0735
         BNE   @RF00735                                            0735
@RT00735 DS    0H                                                  0736
*                DO;                                               0736
*                CTGFVT = FVTPTR(I);                               0737
*                                                                  0737
         L     @04,I                                               0737
         SLA   @04,2                                               0737
         L     @04,FVTPTR-4(@04)                                   0737
         L     @01,CTGPLPTR                                        0737
         ST    @04,CTGFVT(,@01)                                    0737
*                /****************************************************/
*                /*                                                  */
*                /*  SET POINTER TO MASTER PASSWORD FOR CLUSTER IF   */
*                /*  PROTECTION INFORMATION EXISTS.                  */
*                /*                                                  */
*                /****************************************************/
*                                                                  0738
*                IF CTGFVSTY ^= NULLPTR                            0738
*                  THEN                                            0738
         L     @04,CTGFVPTR                                        0738
         L     @04,CTGFVSTY(,@04)                                  0738
         LTR   @04,@04                                             0738
         BZ    @RF00738                                            0738
*                    CPSWD = CTGFVSTY -> CTGFLPT(1);               0739
*                                                                  0739
         L     @04,CTGFLPT(,@04)                                   0739
         ST    @04,CPSWD                                           0739
*                END;                                              0740
*              ELSE                                                0741
*                DO;                                               0741
         B     @RC00735                                            0741
@RF00735 DS    0H                                                  0742
*                IF CTGFVTYP = CTGTDATA                            0742
*                  THEN                                            0742
         L     @04,CTGFVPTR                                        0742
         CLI   CTGFVTYP(@04),C'D'                                  0742
         BNE   @RF00742                                            0742
*                    DO;                                           0743
*                    CTGFVPTR = CTGFVT;                            0744
         L     @04,CTGPLPTR                                        0744
         L     @04,CTGFVT(,@04)                                    0744
         ST    @04,CTGFVPTR                                        0744
*                    CTGFVDCH = FVTPTR(I);                         0745
         L     @15,I                                               0745
         SLA   @15,2                                               0745
         L     @15,FVTPTR-4(@15)                                   0745
         ST    @15,CTGFVDCH(,@04)                                  0745
*                    END;                                          0746
*                  ELSE                                            0747
*                    DO;                                           0747
         B     @RC00742                                            0747
@RF00742 DS    0H                                                  0748
*                    CTGFVPTR = CTGFVT;                            0748
         L     @04,CTGPLPTR                                        0748
         L     @04,CTGFVT(,@04)                                    0748
         ST    @04,CTGFVPTR                                        0748
*                    CTGFVICH = FVTPTR(I);                         0749
         L     @15,I                                               0749
         SLA   @15,2                                               0749
         L     @15,FVTPTR-4(@15)                                   0749
         ST    @15,CTGFVICH(,@04)                                  0749
*                    END;                                          0750
*                END;                                              0751
@RC00742 DS    0H                                                  0752
*            END HDCAT;                                            0752
@RC00735 DS    0H                                                  0753
*        END CATLOOP;                                              0753
*                                                                  0753
@RF00707 LA    @04,1                                               0753
         AL    @04,I                                               0753
@DE00698 ST    @04,I                                               0753
         CH    @04,NUMCOMP                                         0753
         BNH   @DL00698                                            0753
*        /************************************************************/
*        /*                                                          */
*        /*  IF A DATA SET WAS A UNIQUE DATA SET (HAVING ITS OWN     */
*        /*  DATA SPACE) PRIOR TO EXPORT, IT WILL AGAIN BE DEFINED   */
*        /*  AS A UNIQUE DATA SET.    IUNIQPRC WILL DETERMINE IF THE */
*        /*  DATA SET WAS UNIQUE AND IF SO, CONSTRUCT THE NULL SPACE */
*        /*  FVT REQUIRED FOR DEFINE                                 */
*        /*  IF IUNIQPRC DOES NOT COMPLETE SUCCESSFULLY, CONTROL     */
*        /*  WILL BE RETURNED TO THE CALLING PROCESSOR               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0754
*        CALL IUNIQPRC;                                            0754
*                                                                  0754
         BAL   @14,IUNIQPRC                                        0754
*        RESPECIFY RTNREG RSTD;                                    0755
*        TESTRC = RTNREG;                                          0756
         STH   RTNREG,TESTRC                                       0756
*        RESPECIFY RTNREG UNRSTD;                                  0757
*        IF TESTRC ^= 0                                            0758
*          THEN                                                    0758
         LH    @04,TESTRC                                          0758
         LTR   @04,@04                                             0758
         BZ    @RF00758                                            0758
*            RETURN CODE(LASTCC12);                                0759
         LA    @15,12                                              0759
         L     @14,@SA00002                                        0759
         LM    @00,@12,@SA00002+8                                  0759
         BR    @14                                                 0759
*        /************************************************************/
*        /*                                                          */
*        /*  MODIFY FVT'S WITH INFORMATION FROM THE AMS COMMAND      */
*        /*  PARAMETER - OBJECT.  THE ENTRYNAME MAY BE MODIFIED VIA  */
*        /*  THE NEWNAME PARAMETER. LISTVOLS AND DNAME  ARE          */
*        /*  CONSTRUCTED FROM INFORMATION IN THE AMS COMMAND.        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0760
*        CTGFVPTR = CTGFVT;                                        0760
*                                                                  0760
@RF00758 L     @04,CTGPLPTR                                        0760
         L     @04,CTGFVT(,@04)                                    0760
         ST    @04,CTGFVPTR                                        0760
*        /************************************************************/
*        /*                                                          */
*        /*  MATCH OBJECT PARAMETER WITH CORRECT FVT BY MATCHING     */
*        /*  ENTRYNAME FROM ENTNAME FPL WITH OBJECTNAME              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0761
*        IF ADDR(OBJTS) ^= NULLPTR                                 0761
*          THEN                                                    0761
         L     @04,@PC00001+4                                      0761
         L     @04,FDTPTR+8(,@04)                                  0761
         LTR   @04,@04                                             0761
         BZ    @RF00761                                            0761
*OBJCTLP:  DO FX = 1 TO NUMCOMP;                                   0762
OBJCTLP  LA    @04,1                                               0762
         B     @DE00762                                            0762
@DL00762 DS    0H                                                  0763
*              CTGFVPTR = FVTPTR(FX);                              0763
         SLA   @04,2                                               0763
         L     @04,FVTPTR-4(@04)                                   0763
         ST    @04,CTGFVPTR                                        0763
*OBJENTLP:     DO IX = 1 TO OBJTSCNT;                              0764
*                                                                  0764
OBJENTLP LA    @04,1                                               0764
         B     @DE00764                                            0764
@DL00764 DS    0H                                                  0765
*              /******************************************************/
*              /*                                                    */
*              /*  IF A MATCH IS FOUND BETWEEN THE FVT AND THE       */
*              /*  NAME IN THE OBJECTS PARAMETER, PROCESS THE        */
*              /*  INPUT INFORMATION SPECIFIED FOR THAT OBJECT.      */
*              /*                                                    */
*              /******************************************************/
*                                                                  0765
*              IF OBJNMPTR(IX)->OBJNMVAL(1:44) = FENTNAME(1:44)    0765
*                THEN                                              0765
         SLA   @04,2                                               0765
         L     @15,@PC00001+4                                      0765
         L     @01,FDTPTR+12(,@15)                                 0765
         AL    @01,@CF01779                                        0765
         L     @04,OBJNMPTR(@04,@01)                               0765
         L     @01,CTGFVPTR                                        0765
         L     @01,CTGFVENT(,@01)                                  0765
         CLC   OBJNMVAL(44,@04),FENTNAME(@01)                      0765
         BNE   @RF00765                                            0765
*OBJMATCH:         DO;                                             0766
OBJMATCH DS    0H                                                  0767
*                  IMPF2OBJ = ON;                                  0767
*                                                                  0767
         OI    IMPF2OBJ,B'00100000'                                0767
*                  /**************************************************/
*                  /*                                                */
*                  /*   PROCESS  THE FILE PARAMETER                  */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0768
*                  IF OBJFLPTR(IX) ^= NULLPTR                      0768
*                    THEN                                          0768
         L     @04,IX                                              0768
         SLA   @04,2                                               0768
         L     @15,@PC00001+4                                      0768
         L     @01,FDTPTR+20(,@15)                                 0768
         AL    @01,@CF01779                                        0768
         L     @04,OBJFLPTR(@04,@01)                               0768
         LTR   @04,@04                                             0768
         BZ    @RF00768                                            0768
*                      CTGFVIND=ADDR(OBJFLPTR(IX) -> OBJFLVAL);    0769
*                                                                  0769
         LA    @04,OBJFLVAL(,@04)                                  0769
         L     @01,CTGFVPTR                                        0769
         ST    @04,CTGFVIND(,@01)                                  0769
*                  /**************************************************/
*                  /*                                                */
*                  /*  CALL LVLRPROC TO CONSTRUCT THE LIST OF VOLUME */
*                  /*  SERIAL NUMBERS IF VOLUMES SPECIFIED IN THE    */
*                  /*  AMS COMMAND FOR THIS OBJECT                   */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0770
*                  IF LISTVPTR(IX) ^= NULLPTR                      0770
*                    THEN                                          0770
@RF00768 SLR   @04,@04                                             0770
         L     @15,IX                                              0770
         SLA   @15,2                                               0770
         L     @14,@PC00001+4                                      0770
         L     @01,FDTPTR+24(,@14)                                 0770
         AL    @01,@CF01779                                        0770
         C     @04,LISTVPTR(@15,@01)                               0770
         BE    @RF00770                                            0770
*                      DO;                                         0771
*                                                                  0771
*                      /**********************************************/
*                      /*  IF VOLUMES IS SPECIFIED AT THE CLUSTER    */
*                      /*  LEVEL, REMOVE THE DATA AND IF APPLICABLE  */
*                      /*  INDEX FVT VOLUME LIST POINTERS(S).  THIS  */
*                      /*  WILL ALLOW PROPAGATION OF THE CLUSTER      /
*                      /*  LEVEL VOLUME LIST.  IF VOLUMES IS NOT     */
*                      /*  SPECIFIED ATH THE DATA/INDEX LEVEL(S).    */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0772
*                      IF FX = 1                           /*@OZ32365*/
*                        THEN                              /*@OZ32365*/
         CLC   FX(4),@CF00221                                      0772
         BNE   @RF00772                                            0772
*                          DO;                             /*@OZ32365*/
*                          FVTPTR(2)->CTGFVVLT = NULLPTR;  /*@OZ32365*/
         L     @01,FVTPTR+4                                        0774
         ST    @04,CTGFVVLT(,@01)                                  0774
*                          IF FVTPTR(3) ^= NULLPTR         /*@OZ32365*/
*                            THEN                          /*@OZ32365*/
         L     @15,FVTPTR+8                                        0775
         CR    @15,@04                                             0775
         BE    @RF00775                                            0775
*                              FVTPTR(3)->CTGFVVLT=NULLPTR;/*@OZ32365*/
         ST    @04,CTGFVVLT(,@15)                                  0776
*                            ELSE;                         /*@OZ32365*/
@RF00775 DS    0H                                                  0778
*                          END;                            /*@OZ32365*/
*                        ELSE;                             /*@OZ32365*/
*                                                                  0779
@RF00772 DS    0H                                                  0780
*                      /**********************************************/
*                      /*                                            */
*                      /*  CONSTRUCT VOLUMES SERIAL LIST.  IF        */
*                      /*  UNSUCCESSFUL, RETURN TO CALLING PROCESSOR */
*                      /*                                            */
*                      /**********************************************/
*                                                                  0780
*                      CALL LVLRPROC(IX,NULLPARM,NULLPARM,FVTPTR(FX),
*                         FVTPTR(1)->CTGFVTYP);                    0780
*                                                                  0780
         LA    @04,IX                                              0780
         ST    @04,@AL00001                                        0780
         LA    @04,NULLPARM                                        0780
         ST    @04,@AL00001+4                                      0780
         LA    @04,NULLPARM                                        0780
         ST    @04,@AL00001+8                                      0780
         L     @04,FX                                              0780
         SLA   @04,2                                               0780
         LA    @04,FVTPTR-4(@04)                                   0780
         ST    @04,@AL00001+12                                     0780
         L     @04,FVTPTR                                          0780
         ST    @04,@AL00001+16                                     0780
         LA    @01,@AL00001                                        0780
         BAL   @14,LVLRPROC                                        0780
*                      RESPECIFY RTNREG RSTD;                      0781
*                      TESTRC = RTNREG;                            0782
         STH   RTNREG,TESTRC                                       0782
*                      RESPECIFY RTNREG UNRSTD;                    0783
*                      IF TESTRC ^= 0                              0784
*                        THEN                                      0784
         LH    @04,TESTRC                                          0784
         LTR   @04,@04                                             0784
         BZ    @RF00784                                            0784
*                          RETURN CODE(LASTCC12);                  0785
*                                                                  0785
         LA    @15,12                                              0785
         L     @14,@SA00002                                        0785
         LM    @00,@12,@SA00002+8                                  0785
         BR    @14                                                 0785
*                      END;                                        0786
@RF00784 DS    0H                                                  0787
*                  END OBJMATCH;                                   0787
@RF00770 DS    0H                                                  0788
*              END OBJENTLP;                                       0788
@RF00765 LA    @04,1                                               0788
         AL    @04,IX                                              0788
@DE00764 ST    @04,IX                                              0788
         L     @15,@PC00001+4                                      0788
         LA    @15,FDTPTR+8(,@15)                                  0788
         C     @04,OBJTSCNT(,@15)                                  0788
         BNH   @DL00764                                            0788
*        END OBJCTLP;                                              0789
*                                                                  0789
         LA    @04,1                                               0789
         AL    @04,FX                                              0789
@DE00762 ST    @04,FX                                              0789
         CH    @04,NUMCOMP                                         0789
         BNH   @DL00762                                            0789
*        /************************************************************/
*        /*                                                          */
*        /*  MIGRATE THE FILE INFORMATION JUST OBTAINED              */
*        /*  FROM THE SCAN OF THE OBJECTS LIST TO THE PROPER         */
*        /*  LEVEL.  BEGIN BY TESTING TO DETERMINE IF THERE          */
*        /*  IS FILE INFORMATION AT THE CLUSTER OR AIX               */
*        /*  LEVEL.                                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0790
*        IF (FVTPTR(1) -> CTGFVIND) ^= NULLPTR                     0790
*          THEN                                                    0790
@RF00761 SLR   @04,@04                                             0790
         L     @01,FVTPTR                                          0790
         L     @15,CTGFVIND(,@01)                                  0790
         CR    @15,@04                                             0790
         BE    @RF00790                                            0790
*            DO;                                                   0791
*                                                                  0791
*            /********************************************************/
*            /*                                                      */
*            /*  FILE INFORMATION WAS SPECIFIED AT THE               */
*            /*  CLUSTER OR AIX LEVEL.  TEST TO DETERMINE            */
*            /*  IF THIS INFORMATION NEEDS TO BE MIGRATED            */
*            /*  TO THE DATA OR INDEX LEVEL.                         */
*            /*                                                      */
*            /********************************************************/
*                                                                  0792
*            IF (FVTPTR(2) -> CTGFVIND) = NULLPTR                  0792
*              THEN                                                0792
         L     @14,FVTPTR+4                                        0792
         C     @04,CTGFVIND(,@14)                                  0792
         BNE   @RF00792                                            0792
*                FVTPTR(2) -> CTGFVIND = FVTPTR(1) ->              0793
*                   CTGFVIND;                                      0793
*                                                                  0793
         ST    @15,CTGFVIND(,@14)                                  0793
*            /********************************************************/
*            /*                                                      */
*            /*  TEST FOR THE EXISTENCE OF AN INDEX PRIOR            */
*            /*  TO TESTING FOR THE PRESENCE OF FILE INFOR-          */
*            /*  MATION.                                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0794
*            IF FVTPTR(3) ^= NULLPTR                               0794
*              THEN                                                0794
@RF00792 SLR   @04,@04                                             0794
         L     @15,FVTPTR+8                                        0794
         CR    @15,@04                                             0794
         BE    @RF00794                                            0794
*                IF (FVTPTR(3) -> CTGFVIND) = NULLPTR              0795
*                  THEN                                            0795
         C     @04,CTGFVIND(,@15)                                  0795
         BNE   @RF00795                                            0795
*                    FVTPTR(3) -> CTGFVIND =                       0796
*                       FVTPTR(1) -> CTGFVIND;                     0796
         L     @04,FVTPTR                                          0796
         L     @04,CTGFVIND(,@04)                                  0796
         ST    @04,CTGFVIND(,@15)                                  0796
*            END;                                                  0797
*                                                                  0797
@RF00795 DS    0H                                                  0797
@RF00794 DS    0H                                                  0798
*        /************************************************************/
*        /*                                                          */
*        /*  IF THERE IS STILL NO FILE INFORMATION AT THE            */
*        /*  DATA AND INDEX LEVELS, ATTEMPT TO SUPPLY                */
*        /*  DEFAULT INFORMATION USING THE OUTFILE PARAMETER         */
*        /*  IF THAT WAS SPECIFIED BY THE USER.                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0798
*        IF FVTPTR(2) -> CTGFVIND = NULLPTR                        0798
*           & ADDR(OUTDD) ^= NULLPTR                               0798
*          THEN                                                    0798
@RF00790 SLR   @04,@04                                             0798
         L     @15,FVTPTR+4                                        0798
         C     @04,CTGFVIND(,@15)                                  0798
         BNE   @RF00798                                            0798
         L     @14,@PC00001+4                                      0798
         L     @14,FDTPTR+4(,@14)                                  0798
         CR    @14,@04                                             0798
         BE    @RF00798                                            0798
*            FVTPTR(2) -> CTGFVIND = ADDR(OUTDDVAL);               0799
*                                                                  0799
         LA    @04,OUTDDVAL(,@14)                                  0799
         ST    @04,CTGFVIND(,@15)                                  0799
*        IF FVTPTR(3) ^= NULLPTR                                   0800
*          THEN                                                    0800
@RF00798 SLR   @04,@04                                             0800
         L     @15,FVTPTR+8                                        0800
         CR    @15,@04                                             0800
         BE    @RF00800                                            0800
*            IF FVTPTR(3) -> CTGFVIND = NULLPTR                    0801
*               & ADDR(OUTDD) ^= NULLPTR                           0801
*              THEN                                                0801
         C     @04,CTGFVIND(,@15)                                  0801
         BNE   @RF00801                                            0801
         L     @14,@PC00001+4                                      0801
         L     @14,FDTPTR+4(,@14)                                  0801
         CR    @14,@04                                             0801
         BE    @RF00801                                            0801
*                FVTPTR(3) -> CTGFVIND = ADDR(OUTDDVAL);           0802
         LA    @04,OUTDDVAL(,@14)                                  0802
         ST    @04,CTGFVIND(,@15)                                  0802
*                                                                  0803
*        /************************************************************/
*        /*                                                          */
*        /*  PUT THE VOLUME INFORMATION INTO THE FVTS AT             */
*        /*  THE PROPER LEVEL--DATA AND POSSIBLY INDEX.              */
*        /* FIRST CHECK THE DATA FVT TO SEE IF CTGFVVLT IS ZERO      */
*        /* IF IT IS- REPRODUCE THE VOLUME LIST REFERENCED FROM      */
*        /* THE CLUSTER FVT AND POINT TO IT FROM THE DATA FVT        */
*        /* IF AN INDEX FVT ALSO EXISTS DO THE SAME.                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0803
*        IF FVTPTR(2) -> CTGFVVLT = NULLPTR                        0803
*          THEN                                                    0803
*                                                                  0803
@RF00801 DS    0H                                                  0803
@RF00800 L     @04,FVTPTR+4                                        0803
         L     @15,CTGFVVLT(,@04)                                  0803
         LTR   @15,@15                                             0803
         BNZ   @RF00803                                            0803
*            /******************************************************/
*            /*                                                    */
*            /* THERE IS NO VOLLIST FROM DATA SO MOVE THAT AT      */
*            /* THE CLUSTER.                                       */
*            /*                                                    */
*            /******************************************************/
*                                                                  0804
*            DO;                                                   0804
*                                                                  0804
*            TOTLEN = (FVTPTR(1) -> CTGFVVLT->FLISTLN) + 2;        0805
*                                                                  0805
         L     @01,FVTPTR                                          0805
         L     @01,CTGFVVLT(,@01)                                  0805
         LA    @00,2                                               0805
         AH    @00,FLISTLN(,@01)                                   0805
         ST    @00,TOTLEN                                          0805
*            CTGFVPTR = FVTPTR(2);                                 0806
*                                                                  0806
         ST    @04,CTGFVPTR                                        0806
*            CALL IDCSAGP0(                                        0807
*             GDTTBL,                                              0807
*             TOTLEN,               /* LENGTH OF STORAGE         */
*             CTGFVVLT,             /* ADDRESS OF STORAGE        */
*             GPID,                                                0807
*             SETZERO);                                            0807
*                                                                  0807
         L     @15,@PC00001                                        0807
         ST    @15,@AL00001                                        0807
         LA    @14,TOTLEN                                          0807
         ST    @14,@AL00001+4                                      0807
         LA    @04,CTGFVVLT(,@04)                                  0807
         ST    @04,@AL00001+8                                      0807
         LA    @04,GPID                                            0807
         ST    @04,@AL00001+12                                     0807
         LA    @04,SETZERO                                         0807
         ST    @04,@AL00001+16                                     0807
         MVI   @AL00001+16,X'80'                                   0807
         L     @15,GDTGPL(,@15)                                    0807
         LA    @01,@AL00001                                        0807
         BALR  @14,@15                                             0807
*            RESPECIFY RTNREG RSTD;                                0808
*            TESTRC = RTNREG;                                      0809
         STH   RTNREG,TESTRC                                       0809
*            RESPECIFY RTNREG UNRSTD;                              0810
*                                                                  0810
*            /****************************************************/
*            /*                                                  */
*            /* STORAGE REQUEST FAILED FOR VOL LIST              */
*            /*                                                  */
*            /****************************************************/
*                                                                  0811
*            IF TESTRC ^= 0                                        0811
*              THEN                                                0811
         LH    @04,TESTRC                                          0811
         LTR   @04,@04                                             0811
         BZ    @RF00811                                            0811
*                DO;                                               0812
*                                                                  0812
*                DEFSTID = NOSTORAG;                               0813
         MVI   DEFSTID,X'04'                                       0813
*                DARGSMOD = UNIVMSG;                               0814
         L     @04,DDSTRU                                          0814
         MVC   DARGSMOD(3,@04),@CC00981                            0814
*                RETURN CODE(LASTCC12);                            0815
*                                                                  0815
         LA    @15,12                                              0815
         L     @14,@SA00002                                        0815
         LM    @00,@12,@SA00002+8                                  0815
         BR    @14                                                 0815
*                END;                                              0816
*                                                                  0816
*            /****************************************************/
*            /*                                                  */
*            /* MOVE THE VOLUME LIST FROM THE CLUSTER TO THE     */
*            /* DATA FVT VOLUME LIST CREATED BY ABOVE UGPOOL     */
*            /*                                                  */
*            /****************************************************/
*                                                                  0817
*            FVTPTR(2)->CTGFVVLT->FLISTVOL(1 : TOTLEN) =           0817
*              FVTPTR(1) -> CTGFVVLT->FLISTVOL(1 : TOTLEN);        0817
*                                                                  0817
@RF00811 L     @04,FVTPTR+4                                        0817
         L     @01,CTGFVVLT(,@04)                                  0817
         L     @15,TOTLEN                                          0817
         BCTR  @15,0                                               0817
         L     @14,FVTPTR                                          0817
         L     @14,CTGFVVLT(,@14)                                  0817
         EX    @15,@SM01780                                        0817
*              IF FVTPTR(2) -> CTGFVIND = NULLPTR & UNIQD = ON     0818
*                THEN                                              0818
         L     @15,CTGFVIND(,@04)                                  0818
         LTR   @15,@15                                             0818
         BNZ   @RF00818                                            0818
         TM    UNIQD,B'10000000'                                   0818
         BNO   @RF00818                                            0818
*                  DO;                                             0819
*                                                                  0819
*                    /**********************************************/
*                    /*                                          */
*                    /* DYNAMICALLY ALLOCATE THE DATA COMPONENT  */
*                    /* VOLUMES AS REFERENCED FROM DATA FVT      */
*                    /*                                          */
*                    /********************************************/
*                                                                  0820
*                    CALL DALCPROC ('A',                           0820
*                      FVTPTR(2)->CTGFVVLT,                        0820
*                      FVTPTR(2)->CTGFVIND,                        0820
*                      DALCINDX);                                  0820
*                                                                  0820
         LA    @15,@CC00755                                        0820
         ST    @15,@AL00001                                        0820
         LA    @15,CTGFVVLT(,@04)                                  0820
         ST    @15,@AL00001+4                                      0820
         LA    @04,CTGFVIND(,@04)                                  0820
         ST    @04,@AL00001+8                                      0820
         LA    @04,DALCINDX                                        0820
         ST    @04,@AL00001+12                                     0820
         LA    @01,@AL00001                                        0820
         BAL   @14,DALCPROC                                        0820
*                    IF DEFSTID ^= NORMSTAT                        0821
*                      THEN                                        0821
         CLI   DEFSTID,0                                           0821
         BE    @RF00821                                            0821
*                        /****************************************/
*                        /*                                      */
*                        /* ALLOCATION FAILED FOR DATA VOLUMES   */
*                        /* LIST.                                */
*                        /*                                      */
*                        /****************************************/
*                        DO;                                       0822
*                                                                  0822
*                        DARGSMOD = DEFMODID;                      0823
         L     @04,DDSTRU                                          0823
         MVC   DARGSMOD(3,@04),@CC00996                            0823
*                        RETURN CODE(LASTCC12);                    0824
*                                                                  0824
         LA    @15,12                                              0824
         L     @14,@SA00002                                        0824
         LM    @00,@12,@SA00002+8                                  0824
         BR    @14                                                 0824
*                        END;                                      0825
*                    END;                                          0826
*                END;                                              0827
*            ELSE                                                  0828
*                                                                  0828
*            IF UNIQD = ON                                         0828
*              THEN                                                0828
         B     @RC00803                                            0828
@RF00803 TM    UNIQD,B'10000000'                                   0828
         BNO   @RF00828                                            0828
*                IF FVTPTR(2) -> CTGFVIND = NULLPTR                0829
*                  THEN                                            0829
         L     @04,FVTPTR+4                                        0829
         L     @15,CTGFVIND(,@04)                                  0829
         LTR   @15,@15                                             0829
         BNZ   @RF00829                                            0829
*                    DO;                                           0830
*                    /********************************************/
*                    /*                                          */
*                    /* DYNAMICALLY ALLOCATE THE DATA COMPONENT  */
*                    /* VOLUMES AS REFERENCED FROM DATA FVT      */
*                    /*                                          */
*                    /********************************************/
*                                                                  0831
*                    CALL DALCPROC ('A',                           0831
*                      FVTPTR(2)->CTGFVVLT,                        0831
*                      FVTPTR(2)->CTGFVIND,                        0831
*                      DALCINDX);                                  0831
*                                                                  0831
         LA    @15,@CC00755                                        0831
         ST    @15,@AL00001                                        0831
         LA    @15,CTGFVVLT(,@04)                                  0831
         ST    @15,@AL00001+4                                      0831
         LA    @04,CTGFVIND(,@04)                                  0831
         ST    @04,@AL00001+8                                      0831
         LA    @04,DALCINDX                                        0831
         ST    @04,@AL00001+12                                     0831
         LA    @01,@AL00001                                        0831
         BAL   @14,DALCPROC                                        0831
*                    IF DEFSTID ^= NORMSTAT                        0832
*                      THEN                                        0832
         CLI   DEFSTID,0                                           0832
         BE    @RF00832                                            0832
*                        /****************************************/
*                        /*                                      */
*                        /* ALLOCATION FAILED FOR DATA VOLUMES   */
*                        /* LIST.                                */
*                        /*                                      */
*                        /****************************************/
*                        DO;                                       0833
*                                                                  0833
*                        DARGSMOD = DEFMODID;                      0834
         L     @04,DDSTRU                                          0834
         MVC   DARGSMOD(3,@04),@CC00996                            0834
*                        RETURN CODE(LASTCC12);                    0835
*                                                                  0835
         LA    @15,12                                              0835
         L     @14,@SA00002                                        0835
         LM    @00,@12,@SA00002+8                                  0835
         BR    @14                                                 0835
*                        END;                                      0836
*                    END;                                          0837
@RF00832 DS    0H                                                  0838
*          /********************************************************/
*          /*                                                      */
*          /* INDEX FVT MIGRATION - MOVE CLUSTER VOL LIST IF THERE */
*          /* IS NONE AT INDEX FVT - IF THERE IS AN INDEX FVT      */
*          /*                                                      */
*          /********************************************************/
*                                                                  0838
*          IF FVTPTR(3) ^= NULLPTR                                 0838
*            THEN                                                  0838
@RF00829 DS    0H                                                  0838
@RF00828 DS    0H                                                  0838
@RC00803 SLR   @04,@04                                             0838
         L     @15,FVTPTR+8                                        0838
         CR    @15,@04                                             0838
         BE    @RF00838                                            0838
*              DO;                                                 0839
*                                                                  0839
*                IF FVTPTR(3) -> CTGFVVLT = NULLPTR                0840
*                  THEN                                            0840
         C     @04,CTGFVVLT(,@15)                                  0840
         BNE   @RF00840                                            0840
*                    /********************************************/
*                    /*                                          */
*                    /* THE INDEX FVT HAS NO VOL LIST MOVE IT    */
*                    /* FROM THE CLUSTER .                       */
*                    /*                                          */
*                    /********************************************/
*                    DO;                                           0841
*                                                                  0841
*                    TOTLEN = (FVTPTR(1)->CTGFVVLT->FLISTLN) + 2;  0842
         L     @04,FVTPTR                                          0842
         L     @04,CTGFVVLT(,@04)                                  0842
         LA    @14,2                                               0842
         AH    @14,FLISTLN(,@04)                                   0842
         ST    @14,TOTLEN                                          0842
*                    CTGFVPTR = FVTPTR(3);                         0843
*                                                                  0843
         ST    @15,CTGFVPTR                                        0843
*                    CALL IDCSAGP0 (GDTTBL,                        0844
*                     TOTLEN,                                      0844
*                     CTGFVVLT,                                    0844
*                     GPID,                                        0844
*                     SETZERO);                                    0844
*                                                                  0844
         L     @04,@PC00001                                        0844
         ST    @04,@AL00001                                        0844
         LA    @14,TOTLEN                                          0844
         ST    @14,@AL00001+4                                      0844
         LA    @15,CTGFVVLT(,@15)                                  0844
         ST    @15,@AL00001+8                                      0844
         LA    @15,GPID                                            0844
         ST    @15,@AL00001+12                                     0844
         LA    @15,SETZERO                                         0844
         ST    @15,@AL00001+16                                     0844
         MVI   @AL00001+16,X'80'                                   0844
         L     @15,GDTGPL(,@04)                                    0844
         LA    @01,@AL00001                                        0844
         BALR  @14,@15                                             0844
*                     RESPECIFY RTNREG RSTD;                       0845
*                     TESTRC = RTNREG;                             0846
         STH   RTNREG,TESTRC                                       0846
*                     RESPECIFY RTNREG UNRSTD;                     0847
*                                                                  0847
*                     IF TESTRC ^= 0                               0848
*                       THEN                                       0848
         LH    @04,TESTRC                                          0848
         LTR   @04,@04                                             0848
         BZ    @RF00848                                            0848
*                         /****************************************/
*                         /*                                      */
*                         /* STORAGE REQUEST FAILED FOR INDEX VOL */
*                         /* LIST.                                */
*                         /*                                      */
*                         /****************************************/
*                         DO;                                      0849
*                                                                  0849
*                           DEFSTID = NOSTORAG;                    0850
         MVI   DEFSTID,X'04'                                       0850
*                           DARGSMOD = UNIVMSG;                    0851
         L     @04,DDSTRU                                          0851
         MVC   DARGSMOD(3,@04),@CC00981                            0851
*                           RETURN CODE(LASTCC);                   0852
*                                                                  0852
         L     @04,@PC00001+8                                      0852
         LH    @15,LASTCC(,@04)                                    0852
         L     @14,@SA00002                                        0852
         LM    @00,@12,@SA00002+8                                  0852
         BR    @14                                                 0852
*                         END;                                     0853
*                     /********************************************/
*                     /*                                          */
*                     /* MOVE THE VOL LIST FROM THE CLUSTER TO THE*/
*                     /* INDEX FVT VOL LIST CREATED BY ABOVE      */
*                     /* UGPOOL                                   */
*                     /*                                          */
*                     /********************************************/
*                                                                  0854
*                     FVTPTR(3)->CTGFVVLT->FLISTVOL(1 : TOTLEN)=   0854
*                     FVTPTR(1)->CTGFVVLT->FLISTVOL(1:TOTLEN);     0854
*                                                                  0854
@RF00848 L     @04,FVTPTR+8                                        0854
         L     @01,CTGFVVLT(,@04)                                  0854
         L     @15,TOTLEN                                          0854
         BCTR  @15,0                                               0854
         L     @14,FVTPTR                                          0854
         L     @14,CTGFVVLT(,@14)                                  0854
         EX    @15,@SM01780                                        0854
*                IF FVTPTR(3) -> CTGFVIND = NULLPTR & UNIQI = ON   0855
*                  THEN                                            0855
         L     @15,CTGFVIND(,@04)                                  0855
         LTR   @15,@15                                             0855
         BNZ   @RF00855                                            0855
         TM    UNIQI,B'10000000'                                   0855
         BNO   @RF00855                                            0855
*                    DO;                                           0856
*                    /********************************************/
*                    /*                                          */
*                    /* DYNAMICALLY ALLOCATE THE INDEX COMPONENT */
*                    /* VOLUMES AS REFERENCED FROM INDEX FVT     */
*                    /*                                          */
*                    /********************************************/
*                                                                  0857
*                    CALL DALCPROC ('A',                           0857
*                      FVTPTR(3)->CTGFVVLT,                        0857
*                      FVTPTR(3)->CTGFVIND,                        0857
*                      DALCINDX);                                  0857
*                                                                  0857
         LA    @15,@CC00755                                        0857
         ST    @15,@AL00001                                        0857
         LA    @15,CTGFVVLT(,@04)                                  0857
         ST    @15,@AL00001+4                                      0857
         LA    @04,CTGFVIND(,@04)                                  0857
         ST    @04,@AL00001+8                                      0857
         LA    @04,DALCINDX                                        0857
         ST    @04,@AL00001+12                                     0857
         LA    @01,@AL00001                                        0857
         BAL   @14,DALCPROC                                        0857
*                    IF DEFSTID ^= NORMSTAT                        0858
*                      THEN                                        0858
         CLI   DEFSTID,0                                           0858
         BE    @RF00858                                            0858
*                        /****************************************/
*                        /*                                      */
*                        /* ALLOCATION FAILED FOR INDEX VOLUMES  */
*                        /* LIST.                                */
*                        /*                                      */
*                        /****************************************/
*                        DO;                                       0859
*                                                                  0859
*                        DARGSMOD = DEFMODID;                      0860
         L     @04,DDSTRU                                          0860
         MVC   DARGSMOD(3,@04),@CC00996                            0860
*                        RETURN CODE(LASTCC12);                    0861
*                                                                  0861
         LA    @15,12                                              0861
         L     @14,@SA00002                                        0861
         LM    @00,@12,@SA00002+8                                  0861
         BR    @14                                                 0861
*                        END;                                      0862
*                    END;                                          0863
*                END;                                              0864
*            ELSE                                                  0865
*              IF FVTPTR(3) -> CTGFVIND = NULLPTR & UNIQI = ON     0865
*                THEN                                              0865
         B     @RC00840                                            0865
@RF00840 L     @04,FVTPTR+8                                        0865
         L     @15,CTGFVIND(,@04)                                  0865
         LTR   @15,@15                                             0865
         BNZ   @RF00865                                            0865
         TM    UNIQI,B'10000000'                                   0865
         BNO   @RF00865                                            0865
*                  DO;                                             0866
*                    /********************************************/
*                    /*                                          */
*                    /* DYNAMICALLY ALLOCATE THE INDEX COMPONENT */
*                    /* VOLUMES AS REFERENCED FROM INDEX FVT     */
*                    /*                                          */
*                    /********************************************/
*                                                                  0867
*                    CALL DALCPROC ('A',                           0867
*                      FVTPTR(3)->CTGFVVLT,                        0867
*                      FVTPTR(3)->CTGFVIND,                        0867
*                      DALCINDX);                                  0867
*                                                                  0867
         LA    @15,@CC00755                                        0867
         ST    @15,@AL00001                                        0867
         LA    @15,CTGFVVLT(,@04)                                  0867
         ST    @15,@AL00001+4                                      0867
         LA    @04,CTGFVIND(,@04)                                  0867
         ST    @04,@AL00001+8                                      0867
         LA    @04,DALCINDX                                        0867
         ST    @04,@AL00001+12                                     0867
         LA    @01,@AL00001                                        0867
         BAL   @14,DALCPROC                                        0867
*                    IF DEFSTID ^= NORMSTAT                        0868
*                      THEN                                        0868
         CLI   DEFSTID,0                                           0868
         BE    @RF00868                                            0868
*                        /****************************************/
*                        /*                                      */
*                        /* ALLOCATION FAILED FOR INDEX VOLUMES  */
*                        /* LIST.                                */
*                        /*                                      */
*                        /****************************************/
*                        DO;                                       0869
*                                                                  0869
*                        DARGSMOD = DEFMODID;                      0870
         L     @04,DDSTRU                                          0870
         MVC   DARGSMOD(3,@04),@CC00996                            0870
*                        RETURN CODE(LASTCC12);                    0871
*                                                                  0871
         LA    @15,12                                              0871
         L     @14,@SA00002                                        0871
         LM    @00,@12,@SA00002+8                                  0871
         BR    @14                                                 0871
*                        END;                                      0872
*                    END;                                          0873
@RF00868 DS    0H                                                  0874
*            END;                                                  0874
*                                                                  0874
@RF00865 DS    0H                                                  0874
@RC00840 DS    0H                                                  0875
*        /************************************************************/
*        /*                                                          */
*        /* ZERO OUT THE VOLUME LIST POINTER AT CLUSTER FVT          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0875
*        FVTPTR(1) -> CTGFVVLT = NULLPTR;                          0875
*                                                                  0875
@RF00838 L     @04,FVTPTR                                          0875
         SLR   @15,@15                                             0875
         ST    @15,CTGFVVLT(,@04)                                  0875
*        /************************************************************/
*        /*                                                          */
*        /*  SET CTGFVWKA TO POINT TO A WORK AREA FOR THE            */
*        /*  VOLUME SERIAL NUMBER OF THE CATALOG RECOVERY            */
*        /*  VOLUME.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0876
*        FVTPTR(1) -> CTGFVWKA = ADDR(CATRCVWK);                   0876
*                                                                  0876
         LA    @15,CATRCVWK                                        0876
         ST    @15,CTGFVWKA(,@04)                                  0876
*        /************************************************************/
*        /*                                                          */
*        /*  SAVE CPL, FVTS, AND FPLS PRIOR TO INVOKING CATALOG      */
*        /*  MANAGEMENT BECAUSE THESE CONTROL BLOCKS MAY BE ALTERED  */
*        /*  BY CATALOG MANAGEMENT.  IF THE OBJECT NAME IS A         */
*        /*  DUPLICATE, IT MAY BE DELETED THEN REDEFINED, IN WHICH   */
*        /*  CASE IT WILL BE NECESSARY TO RESTORE THE CONTROL BLOCKS */
*        /*                                                          */
*        /************************************************************/
*                                                                  0877
*        TFVTLEN = LENGTH(CTGFV) + (LENGTH(CTGFL) + 8) * CFPLNUM + 0877
*          LENGTH(IDAAMDSB);                                       0877
*                                                                  0877
         LH    @04,CFPLNUM                                         0877
         MH    @04,@CH00312                                        0877
         LA    @04,188(,@04)                                       0877
         STH   @04,TFVTLEN                                         0877
*        SAVCPL = PTRCPL -> FIELDR(1:LENGTH(CTGPL) + 16);          0878
*                                                                  0878
         L     @04,PTRCPL                                          0878
         MVC   SAVCPL(44),FIELDR(@04)                              0878
*        /************************************************************/
*        /*                                                          */
*        /*  WHEN THE FVT'S WERE CONSTRUCTED, DOUBLE THE AREA NEEDED */
*        /*  WAS OBTAINED FOR THE FVT SAVE AREA                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0879
*        DO I = 1 TO NUMCOMP;                                      0879
         LA    @04,1                                               0879
         B     @DE00879                                            0879
@DL00879 DS    0H                                                  0880
*          SAVFVT(I) = FVTPTR(I) + TFVTLEN;                        0880
*                                                                  0880
         SLA   @04,2                                               0880
         LH    @15,TFVTLEN                                         0880
         AL    @15,FVTPTR-4(@04)                                   0880
         ST    @15,SAVFVT-4(@04)                                   0880
*          CALL MVDAPROC(TFVTLEN,FVTPTR(I),SAVFVT(I));             0881
*                                                                  0881
         LA    @15,TFVTLEN                                         0881
         ST    @15,@AL00001                                        0881
         LA    @15,FVTPTR-4(@04)                                   0881
         ST    @15,@AL00001+4                                      0881
         LA    @04,SAVFVT-4(@04)                                   0881
         ST    @04,@AL00001+8                                      0881
         LA    @01,@AL00001                                        0881
         BAL   @14,MVDAPROC                                        0881
*        END;                                                      0882
*                                                                  0882
         LA    @04,1                                               0882
         AL    @04,I                                               0882
@DE00879 ST    @04,I                                               0882
         CH    @04,NUMCOMP                                         0882
         BNH   @DL00879                                            0882
*        /************************************************************/
*        /*                                                          */
*        /*  INVOKE CATALOG MANAGEMENT TO DEFINE THE CLUSTER         */
*        /*  OR AIX AND ITS COMPONENTS.                              */
*        /*  SET IMPF2NER TO BE ON TO INDICATE THAT CTLGPROC         */
*        /*  IS NOT TO PRINT ANY MESSAGES FOR A VSAM                 */
*        /*  CATALOG RETURN CODE OF 8.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0883
*        IMPF2NER = ON;                                            0883
         OI    IMPF2NER,B'00001000'                                0883
*        CALL CTLGPROC(PTRCPL);                                    0884
         LA    @04,PTRCPL                                          0884
         ST    @04,@AL00001                                        0884
         LA    @01,@AL00001                                        0884
         BAL   @14,CTLGPROC                                        0884
*        RESPECIFY RTNREG RSTD;                                    0885
*        TESTRC = RTNREG;                                          0886
         STH   RTNREG,TESTRC                                       0886
*        RESPECIFY RTNREG UNRSTD;                                  0887
*                                                                  0887
*        /************************************************************/
*        /*                                                          */
*        /*  RESET IMPF2NER TO BE OFF.  ALL CATALOG ERROR            */
*        /*  MESSAGES ARE TO BE PRINTED ON ALL OTHER CALLS           */
*        /*  TO VSAM CATALOG MANAGEMENT.                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0888
*        IMPF2NER = OFF;                                           0888
         NI    IMPF2NER,B'11110111'                                0888
*        IF TESTRC ^= 0                                            0889
*          THEN                                                    0889
         LH    @04,TESTRC                                          0889
         LTR   @04,@04                                             0889
         BZ    @RF00889                                            0889
*DEFERR:     DO;                                                   0890
*                                                                  0890
DEFERR   DS    0H                                                  0891
*            /********************************************************/
*            /*                                                      */
*            /*  IF THE CATALOG RETURN CODE INDICATES A DUPLICATE    */
*            /*  ENTRY NAME EXISTS, CALL CPLPROC TO BUILD A CPL      */
*            /*  FOR A CMS DELETE OPERATION.  IF THIS IS SUCCESSFUL  */
*            /*  CALL DELTPROC TO INVOKE CATALOG MANAGEMENT.         */
*            /*  IF THE CATALOG DEFINE FAILED FOR ANY OTHER REASON,  */
*            /*  RETURN TO THE CALLING PROCESSOR                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0891
*            IF CATLGRC ^= DUPNAME                                 0891
*              THEN                                                0891
         CLC   CATLGRC(2),@CH00039                                 0891
         BE    @RF00891                                            0891
*                DO;                                               0892
*                DARGSMOD = IMPMSG;                                0893
         L     @04,DDSTRU                                          0893
         MVC   DARGSMOD(3,@04),@CC00945                            0893
*                DARGSENT = MPRAFAIL;                              0894
         MVI   DARGSENT(@04),X'15'                                 0894
*                DARGILP = LENGTH(FENTNAME);                       0895
         MVC   DARGILP(2,@04),@CH00605                             0895
*                DARGDBP = FVTPTR(1) -> CTGFVENT;                  0896
*                                                                  0896
         L     @01,FVTPTR                                          0896
         L     @15,CTGFVENT(,@01)                                  0896
         ST    @15,DARGDBP(,@04)                                   0896
*                CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);             0897
*                                                                  0897
         L     @04,@PC00001                                        0897
         ST    @04,@AL00001                                        0897
         LA    @15,@CF00119                                        0897
         ST    @15,@AL00001+4                                      0897
         LA    @15,DDSTRU                                          0897
         ST    @15,@AL00001+8                                      0897
         MVI   @AL00001+8,X'80'                                    0897
         L     @15,GDTPRT(,@04)                                    0897
         LA    @01,@AL00001                                        0897
         BALR  @14,@15                                             0897
*                DARGLIST = ''B;                                   0898
         L     @04,DDSTRU                                          0898
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0898
*                DARGSMOD = IMPMSG;                                0899
         MVC   DARGSMOD(3,@04),@CC00945                            0899
*                RETURN CODE(LASTCC08);                            0900
         LA    @15,8                                               0900
         L     @14,@SA00002                                        0900
         LM    @00,@12,@SA00002+8                                  0900
         BR    @14                                                 0900
*                END;                                              0901
*              ELSE                                                0902
*DUPENT:         DO;                                               0902
@RF00891 DS    0H                                                  0902
DUPENT   DS    0H                                                  0903
*                OLDERID2 = NEWERID2;                              0903
         L     @04,@PC00001                                        0903
         L     @04,GDTTR2(,@04)                                    0903
         MVC   @TS00001(95),NEWERID2(@04)                          0903
         MVC   OLDERID2(95,@04),@TS00001                           0903
*                NEWID2 = 'RMDV';                                  0904
*                                                                  0904
         MVC   NEWID2(4,@04),@CC01359                              0904
*                /****************************************************/
*                /*                                                  */
*                /*  CALL CPLPROC TO BUILD THE CPL.  IF IT SHOULD    */
*                /*  FAIL FOR ANY REASON RETURN TO THE CALLER WITH   */
*                /*  A TERMINAL ERROR INDICATED.                     */
*                /*                                                  */
*                /****************************************************/
*                                                                  0905
*                CALL CPLPROC('D',DCPLPTR,FVTPTR(1)->CTGFVENT,     0905
*                   NULLPARM,CPSWD);                               0905
*                                                                  0905
         LA    @04,@CC00751                                        0905
         ST    @04,@AL00001                                        0905
         LA    @04,DCPLPTR                                         0905
         ST    @04,@AL00001+4                                      0905
         L     @04,FVTPTR                                          0905
         LA    @04,CTGFVENT(,@04)                                  0905
         ST    @04,@AL00001+8                                      0905
         LA    @04,NULLPARM                                        0905
         ST    @04,@AL00001+12                                     0905
         LA    @04,CPSWD                                           0905
         ST    @04,@AL00001+16                                     0905
         LA    @01,@AL00001                                        0905
         BAL   @14,CPLPROC                                         0905
*                RESPECIFY RTNREG RSTD;                            0906
*                TESTRC = RTNREG;                                  0907
         STH   RTNREG,TESTRC                                       0907
*                RESPECIFY RTNREG UNRSTD;                          0908
*                IF TESTRC ^= 0                                    0909
*                  THEN                                            0909
         LH    @04,TESTRC                                          0909
         LTR   @04,@04                                             0909
         BZ    @RF00909                                            0909
*                    RETURN CODE(LASTCC12);                        0910
*                                                                  0910
         LA    @15,12                                              0910
         L     @14,@SA00002                                        0910
         LM    @00,@12,@SA00002+8                                  0910
         BR    @14                                                 0910
*                /****************************************************/
*                /*                                                  */
*                /*  SET THE CTGTYPE FIELD OF THE CPL.               */
*                /*                                                  */
*                /****************************************************/
*                                                                  0911
*                DCPLPTR -> CTGTYPE = FVTPTR(1) -> CTGFVTYP;       0911
*                                                                  0911
@RF00909 L     @04,DCPLPTR                                         0911
         L     @01,FVTPTR                                          0911
         MVC   CTGTYPE(1,@04),CTGFVTYP(@01)                        0911
*                /****************************************************/
*                /*                                                  */
*                /*  CALL DELTPROC TO INVOKE VSAM CATALOG MANAGEMENT */
*                /*                                                  */
*                /****************************************************/
*                                                                  0912
*                CALL DELTPROC(DCPLPTR);                           0912
*                                                                  0912
         LA    @04,DCPLPTR                                         0912
         ST    @04,@AL00001                                        0912
         LA    @01,@AL00001                                        0912
         BAL   @14,DELTPROC                                        0912
*                RESPECIFY RTNREG RSTD;                            0913
*                TESTRC = RTNREG;                                  0914
         STH   RTNREG,TESTRC                                       0914
*                RESPECIFY RTNREG UNRSTD;                          0915
*                IF TESTRC ^= 0                                    0916
*                  THEN                                            0916
*                                                                  0916
         LH    @04,TESTRC                                          0916
         LTR   @04,@04                                             0916
         BZ    @RF00916                                            0916
*                    /************************************************/
*                    /*                                              */
*                    /*  THE DELETE OF THE DUPLICATE ENTRY           */
*                    /*  HAS FAILED.  RETURN WITH ERROR INDICATED.   */
*                    /*                                              */
*                    /************************************************/
*                                                                  0917
*                    DO;                                           0917
*                    DARGSMOD = IMPMSG;                            0918
         L     @04,DDSTRU                                          0918
         MVC   DARGSMOD(3,@04),@CC00945                            0918
*                    DARGSENT = MPRAFAIL;                          0919
         MVI   DARGSENT(@04),X'15'                                 0919
*                    DARGILP = LENGTH(FENTNAME);                   0920
         MVC   DARGILP(2,@04),@CH00605                             0920
*                    DARGDBP = FVTPTR(1) -> CTGFVENT;              0921
*                                                                  0921
         L     @01,FVTPTR                                          0921
         L     @15,CTGFVENT(,@01)                                  0921
         ST    @15,DARGDBP(,@04)                                   0921
*                    CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);         0922
*                                                                  0922
         L     @04,@PC00001                                        0922
         ST    @04,@AL00001                                        0922
         LA    @15,@CF00119                                        0922
         ST    @15,@AL00001+4                                      0922
         LA    @15,DDSTRU                                          0922
         ST    @15,@AL00001+8                                      0922
         MVI   @AL00001+8,X'80'                                    0922
         L     @15,GDTPRT(,@04)                                    0922
         LA    @01,@AL00001                                        0922
         BALR  @14,@15                                             0922
*                    DARGLIST = ''B;                               0923
         L     @04,DDSTRU                                          0923
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0923
*                    DARGSMOD = IMPMSG;                            0924
         MVC   DARGSMOD(3,@04),@CC00945                            0924
*                    RETURN CODE(LASTCC08);                        0925
         LA    @15,8                                               0925
         L     @14,@SA00002                                        0925
         LM    @00,@12,@SA00002+8                                  0925
         BR    @14                                                 0925
*                    END;                                          0926
*                                                                  0926
*                /**************************************************/
*                /*                                                  */
*                /*  THE PREVIOUSLY EXISTING ENTRY HAS               */
*                /*  BEEN DELETED.  RESTORE THE CPL TO               */
*                /*  ITS STATE PRIOR TO INVOKING                     */
*                /*  CATALOG MANAGEMENT DEFINE.                      */
*                /*                                                  */
*                /***************************************************/
*                                                                  0927
*                SAVCPLLN = LENGTH(CTGPL) + 16;                    0927
@RF00916 LA    @04,44                                              0927
         ST    @04,SAVCPLLN                                        0927
*                PTRCPL -> FIELDR(1:SAVCPLLN)                      0928
*                   = SAVCPL;                                      0928
*                                                                  0928
         L     @01,PTRCPL                                          0928
         BCTR  @04,0                                               0928
         EX    @04,@SM01784                                        0928
*                DO I = 1 TO NUMCOMP;                              0929
*                                                                  0929
         LA    @04,1                                               0929
         B     @DE00929                                            0929
@DL00929 DS    0H                                                  0930
*                  CALL MVDAPROC(TFVTLEN,SAVFVT(I),                0930
*                      FVTPTR(I));                                 0930
*                                                                  0930
         LA    @15,TFVTLEN                                         0930
         ST    @15,@AL00001                                        0930
         SLA   @04,2                                               0930
         LA    @15,SAVFVT-4(@04)                                   0930
         ST    @15,@AL00001+4                                      0930
         LA    @04,FVTPTR-4(@04)                                   0930
         ST    @04,@AL00001+8                                      0930
         LA    @01,@AL00001                                        0930
         BAL   @14,MVDAPROC                                        0930
*                  /*************************************************/
*                  /*                                                */
*                  /*  REINITIALIZE VOLUME SERIAL LIST               */
*                  /*  RETURN CODE FIELDS FOR DATA AND               */
*                  /*  INDEX COMPONENTS (IF EXISTANT).               */
*                  /*                                                */
*                  /*************************************************/
*                                                                  0931
*                  CTGFVPTR = FVTPTR(I);                           0931
         L     @04,I                                               0931
         SLA   @04,2                                               0931
         L     @04,FVTPTR-4(@04)                                   0931
         ST    @04,CTGFVPTR                                        0931
*                  IF  CTGFVVLT ^= NULLPTR                         0932
*                    THEN                                          0932
         L     @04,CTGFVVLT(,@04)                                  0932
         LTR   @04,@04                                             0932
         BZ    @RF00932                                            0932
*                      DO J = 1 TO                                 0933
*                         (FLISTLN/LENGTH(FVOLSERL));              0933
         LA    @04,1                                               0933
         B     @DE00933                                            0933
@DL00933 DS    0H                                                  0934
*                        FVOLRTN(J) = 0;                           0934
         LR    @15,@04                                             0934
         SLA   @15,3                                               0934
         L     @01,CTGFVPTR                                        0934
         L     @01,CTGFVVLT(,@01)                                  0934
         ALR   @01,@15                                             0934
         AL    @01,@CF01786                                        0934
         SLR   @00,@00                                             0934
         STCM  @00,3,FVOLRTN-2(@01)                                0934
*                      END;                                        0935
*                                                                  0935
         AL    @04,@CF00221                                        0935
@DE00933 ST    @04,J                                               0935
         L     @01,CTGFVPTR                                        0935
         L     @01,CTGFVVLT(,@01)                                  0935
         LH    @00,FLISTLN(,@01)                                   0935
         SRDA  @00,32                                              0935
         D     @00,@CF00039                                        0935
         CR    @04,@01                                             0935
         BNH   @DL00933                                            0935
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF A UNIQUE DATA SET DEFINED,                 */
*                  /*  RESTORE THE VOLUME FVT.                       */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0936
*                  IF (FVTPTR(1) -> CTGFVVCH) ^= NULLPTR           0936
*                    THEN                                          0936
@RF00932 L     @04,FVTPTR                                          0936
         L     @04,CTGFVVCH(,@04)                                  0936
         LTR   @04,@04                                             0936
         BZ    @RF00936                                            0936
*                      DO;                                         0937
*                      IUNIQFVT = ''B;                             0938
         XC    IUNIQFVT(92),IUNIQFVT                               0938
*                      FVTPTR(1) -> CTGFVVCH -> CTGFVTYP           0939
*                         = CTGFVVOL;                              0939
         MVI   CTGFVTYP(@04),C'V'                                  0939
*                      END;                                        0940
*                                                                  0940
*                END;                                              0941
*                                                                  0941
@RF00936 LA    @04,1                                               0941
         AL    @04,I                                               0941
@DE00929 ST    @04,I                                               0941
         CH    @04,NUMCOMP                                         0941
         BNH   @DL00929                                            0941
*                /****************************************************/
*                /*                                                  */
*                /*  INVOKE CATALOG MANAGEMENT TO DEFINE             */
*                /*  THE OBJECT.  IF DEFINE FAILS RETURN             */
*                /*  TO CALLING PROCESSOR.                           */
*                /*                                                  */
*                /****************************************************/
*                                                                  0942
*                CTGPLPTR = PTRCPL;                                0942
*                                                                  0942
         L     @04,PTRCPL                                          0942
         ST    @04,CTGPLPTR                                        0942
*                CALL CTLGPROC(PTRCPL);                            0943
*                                                                  0943
         LA    @04,PTRCPL                                          0943
         ST    @04,@AL00001                                        0943
         LA    @01,@AL00001                                        0943
         BAL   @14,CTLGPROC                                        0943
*                RESPECIFY RTNREG RSTD;                            0944
*                TESTRC = RTNREG;                                  0945
         STH   RTNREG,TESTRC                                       0945
*                RESPECIFY RTNREG UNRSTD;                          0946
*                IF TESTRC ^= 0                                    0947
*                  THEN                                            0947
         LH    @04,TESTRC                                          0947
         LTR   @04,@04                                             0947
         BZ    @RF00947                                            0947
*                    DO;                                           0948
*                    DARGSMOD = IMPMSG;                            0949
         L     @04,DDSTRU                                          0949
         MVC   DARGSMOD(3,@04),@CC00945                            0949
*                    DARGSENT = MPRAFAIL;                          0950
         MVI   DARGSENT(@04),X'15'                                 0950
*                    DARGILP = LENGTH(FENTNAME);                   0951
         MVC   DARGILP(2,@04),@CH00605                             0951
*                    DARGDBP = FVTPTR(1) -> CTGFVENT;              0952
*                                                                  0952
         L     @01,FVTPTR                                          0952
         L     @15,CTGFVENT(,@01)                                  0952
         ST    @15,DARGDBP(,@04)                                   0952
*                    CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);         0953
*                                                                  0953
         L     @04,@PC00001                                        0953
         ST    @04,@AL00001                                        0953
         LA    @15,@CF00119                                        0953
         ST    @15,@AL00001+4                                      0953
         LA    @15,DDSTRU                                          0953
         ST    @15,@AL00001+8                                      0953
         MVI   @AL00001+8,X'80'                                    0953
         L     @15,GDTPRT(,@04)                                    0953
         LA    @01,@AL00001                                        0953
         BALR  @14,@15                                             0953
*                    DARGLIST = ''B;                               0954
         L     @04,DDSTRU                                          0954
         XC    DARGLIST(20,@04),DARGLIST(@04)                      0954
*                    DARGSMOD = IMPMSG;                            0955
         MVC   DARGSMOD(3,@04),@CC00945                            0955
*                    RETURN CODE(LASTCC08);                        0956
         LA    @15,8                                               0956
         L     @14,@SA00002                                        0956
         LM    @00,@12,@SA00002+8                                  0956
         BR    @14                                                 0956
*                    END;                                          0957
*                                                                  0957
*                /****************************************************/
*                /*                                                  */
*                /*  RESET THE VALUE OF DEFSTID TO NORMSTAT TO       */
*                /*  INDICATE THAT THE ORIGINAL DEFINE ERROR HAS     */
*                /*  BEEN CLEARED.                                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  0958
*                DEFSTID = NORMSTAT;                               0958
*                                                                  0958
@RF00947 MVI   DEFSTID,X'00'                                       0958
*                END DUPENT;                                       0959
*            END DEFERR;                                           0960
*                                                                  0960
*                                                                  0960
*        /********************************************************/
*        /*                                                      */
*        /*  CHECK TO SEE IF A RECOVERY VOLSER HAS BEEN          */
*        /*  RETURNED BY CATALOG.  IF SO, PRINT IT.              */
*        /*                                                      */
*        /********************************************************/
*                                                                  0961
*        DARGSMOD = DEFMODID;                                      0961
@RF00889 L     @04,DDSTRU                                          0961
         MVC   DARGSMOD(3,@04),@CC00996                            0961
*        IF CATRCWKA ^= ZEROS                                      0962
*          THEN                                                    0962
         CLC   CATRCWKA(6),ZEROS                                   0962
         BE    @RF00962                                            0962
*            DO;                                                   0963
*            DARGSENT = RCVYVOLM;                                  0964
         MVI   DARGSENT(@04),X'15'                                 0964
*            DARGILP = LENGTH(CATRCWKA);                           0965
         MVC   DARGILP(2,@04),@CH00041                             0965
*            DARGDBP = ADDR(CATRCWKA);                             0966
*                                                                  0966
         LA    @15,CATRCWKA                                        0966
         ST    @15,DARGDBP(,@04)                                   0966
*            CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                 0967
*                                                                  0967
         L     @04,@PC00001                                        0967
         ST    @04,@AL00001                                        0967
         LA    @15,@CF00119                                        0967
         ST    @15,@AL00001+4                                      0967
         LA    @15,DDSTRU                                          0967
         ST    @15,@AL00001+8                                      0967
         MVI   @AL00001+8,X'80'                                    0967
         L     @15,GDTPRT(,@04)                                    0967
         LA    @01,@AL00001                                        0967
         BALR  @14,@15                                             0967
*            END;                                                  0968
*                                                                  0968
*        /********************************************************/
*        /*                                                      */
*        /*  CLUSTER HAS BEEN DEFINED SUCCESSFULLY.              */
*        /*  ISSUE ALLOCATION MESSAGES                           */
*        /*                                                      */
*        /********************************************************/
*                                                                  0969
*        DARGSENT = VOLDATA;                                       0969
@RF00962 L     @04,DDSTRU                                          0969
         MVI   DARGSENT(@04),X'09'                                 0969
*        CTGFVPTR = CTGFVT -> CTGFVDCH;                            0970
*                                                                  0970
         L     @04,CTGPLPTR                                        0970
         L     @04,CTGFVT(,@04)                                    0970
         L     @04,CTGFVDCH(,@04)                                  0970
         ST    @04,CTGFVPTR                                        0970
*        /********************************************************/
*        /*                                                      */
*        /*  FIRST ISSUE THE VOLUME ALLOCATION MESSAGE           */
*        /*  FOR THE DATA COMPONENT AND THEN FOR THE             */
*        /*  INDEX IF ANY EXISTS.  ONE CALL TO THE TEXT          */
*        /*  PROCESSOR WILL PRINT THE ENTIRE VOLUME              */
*        /*  FOR ONE COMPONENT.                                  */
*        /*                                                      */
*        /********************************************************/
*                                                                  0971
*        DO I = 2 TO NUMCOMP;                                      0971
         LA    @04,2                                               0971
         B     @DE00971                                            0971
@DL00971 DS    0H                                                  0972
*          IF CTGFVVLT ^= NULLPTR                                  0972
*            THEN                                                  0972
         L     @04,CTGFVPTR                                        0972
         L     @04,CTGFVVLT(,@04)                                  0972
         LTR   @04,@04                                             0972
         BZ    @RF00972                                            0972
*              DO;                                                 0973
*              DARGDBP = CTGFVVLT + 2;                             0974
         L     @15,DDSTRU                                          0974
         LA    @14,2                                               0974
         ALR   @14,@04                                             0974
         ST    @14,DARGDBP(,@15)                                   0974
*              DARGILP = CTGFVVLT -> FLISTLN;                      0975
         LH    @04,FLISTLN(,@04)                                   0975
         STH   @04,DARGILP(,@15)                                   0975
*              DARGCNT = 1;                                        0976
         LA    @14,1                                               0976
         STH   @14,DARGCNT(,@15)                                   0976
*              DARGINS(1) = 1;                                     0977
         STH   @14,DARGINS(,@15)                                   0977
*              DARGPCT(1) = DARGILP/8;                             0978
*                                                                  0978
         LR    @00,@04                                             0978
         SRDA  @00,32                                              0978
         D     @00,@CF00039                                        0978
         STH   @01,DARGPCT(,@15)                                   0978
*              CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);               0979
*                                                                  0979
         L     @04,@PC00001                                        0979
         ST    @04,@AL00001                                        0979
         LA    @15,@CF00119                                        0979
         ST    @15,@AL00001+4                                      0979
         LA    @15,DDSTRU                                          0979
         ST    @15,@AL00001+8                                      0979
         MVI   @AL00001+8,X'80'                                    0979
         L     @15,GDTPRT(,@04)                                    0979
         LA    @01,@AL00001                                        0979
         BALR  @14,@15                                             0979
*              END;                                                0980
*          CTGFVPTR = CTGFVT -> CTGFVICH;                          0981
@RF00972 L     @04,CTGPLPTR                                        0981
         L     @04,CTGFVT(,@04)                                    0981
         L     @04,CTGFVICH(,@04)                                  0981
         ST    @04,CTGFVPTR                                        0981
*          DARGSENT = VOLINDEX;                                    0982
         L     @04,DDSTRU                                          0982
         MVI   DARGSENT(@04),X'0A'                                 0982
*        END;                                                      0983
*                                                                  0983
*                                                                  0983
         LA    @04,1                                               0983
         AL    @04,I                                               0983
@DE00971 ST    @04,I                                               0983
         CH    @04,NUMCOMP                                         0983
         BNH   @DL00971                                            0983
*        DARGSMOD=IMPMSG;                                          0984
*                                                                  0984
         L     @04,DDSTRU                                          0984
         MVC   DARGSMOD(3,@04),@CC00945                            0984
*        /************************************************************/
*        /*                                                          */
*        /*  DEALLOCATE VOLUMES WHICH HAVE BEEN DYNAMICALLY          */
*        /*  ALLOCATED.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0985
*        IF DALCINDX > 0                                           0985
*          THEN                                                    0985
         L     @04,DALCINDX                                        0985
         LTR   @04,@04                                             0985
         BNP   @RF00985                                            0985
*            CALL DALCPROC('D',NULLPARM,NULLPARM,DALCINDX);        0986
*                                                                  0986
         MVC   @AL00001(12),@AL00986                               0986
         LA    @04,DALCINDX                                        0986
         ST    @04,@AL00001+12                                     0986
         LA    @01,@AL00001                                        0986
         BAL   @14,DALCPROC                                        0986
*        /************************************************************/
*        /*                                                          */
*        /*  ALLOCATE THE CLUSTER IF IT WAS NOT ALLOCATED BY JCL.    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0987
*        IF ADDR(OUTDD) = NULLPTR                                  0987
*          THEN                                                    0987
@RF00985 L     @04,@PC00001+4                                      0987
         L     @04,FDTPTR+4(,@04)                                  0987
         LTR   @04,@04                                             0987
         BNZ   @RF00987                                            0987
*            DO;                                                   0988
*            ALLPTR = ADDR(ALLLIST);                               0989
         LA    @04,ALLLIST                                         0989
         ST    @04,ALLPTR                                          0989
*            ALLAGL = ''B;                                         0990
         XC    ALLAGL(31,@04),ALLAGL(@04)                          0990
*            ALLDSN = FVTPTR(1) -> CTGFVENT;                       0991
         L     @01,FVTPTR                                          0991
         L     @15,CTGFVENT(,@01)                                  0991
         ST    @15,ALLDSN(,@04)                                    0991
*            ALLOPTVL = OFF;                                       0992
*            ALLOPTDS = ON;                                        0993
         OI    ALLOPTDS(@04),B'01000000'                           0993
         NI    ALLOPTVL(@04),B'01111111'                           0993
*            ALLSTSOD = ON;                                        0994
         OI    ALLSTSOD(@04),B'00000001'                           0994
*            ALLDSPKP = ON;                                        0995
*                                                                  0995
         OI    ALLDSPKP(@04),B'00001000'                           0995
*            CALL IDCSAAL0(GDTTBL,ALLAGL);                         0996
*                                                                  0996
         L     @15,@PC00001                                        0996
         ST    @15,@AL00001                                        0996
         ST    @04,@AL00001+4                                      0996
         MVI   @AL00001+4,X'80'                                    0996
         L     @15,GDTALC(,@15)                                    0996
         LA    @01,@AL00001                                        0996
         BALR  @14,@15                                             0996
*            IF TESTRC = 0                                         0997
*              THEN                                                0997
         LH    @04,TESTRC                                          0997
         LTR   @04,@04                                             0997
         BNZ   @RF00997                                            0997
*                DEALLOC = ON;                                     0998
         OI    DEALLOC,B'10000000'                                 0998
*              ELSE                                                0999
*                RETURN CODE(LASTCC12);                            0999
         B     @RC00997                                            0999
@RF00997 LA    @15,12                                              0999
         L     @14,@SA00002                                        0999
         LM    @00,@12,@SA00002+8                                  0999
         BR    @14                                                 0999
*            END;                                                  1000
@RC00997 DS    0H                                                  1001
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP DEFINING THE PATHS THAT WERE EXPORTED WITH         */
*        /*  THE DATA SET.  SHOULD ANY CMS DEFINE FAIL,              */
*        /*  SIMPLY GO ON TO THE NEXT PATH.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1001
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE THE GETREO FLAG TO OFF. THIS FLAG IS         */
*        /*  USED TO INDICATE THAT THE LOOP USED TO DEFINE PATHS     */
*        /*  IS TO TERMINATE EARLY, FOR EXPORTRA WAS NOT ABLE        */
*        /*  TO WRITE OUT ALL OF THE PATH INFORMATION FOR ALL        */
*        /*  OF THE PATHS ASSOCIATED WITH THE VSAM OBJECT.           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1001
*        GETREO = OFF;                                     /*@OZ10871*/
*                                                                  1001
@RF00987 NI    GETREO,B'01111111'                                  1001
*        /************************************************************/
*        /*                                                          */
*        /*  TEST FOR THE PRESENCE OF PATH ASSOCIATIONS ON           */
*        /*  THE PORTABILITY DATA SET.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1002
*        IF IMPASSOC = ON                                          1002
*          THEN                                                    1002
         TM    IMPASSOC,B'00100000'                                1002
         BNO   @RF01002                                            1002
*PATHDEF:    DO;                                                   1003
PATHDEF  DS    0H                                                  1004
*            OLDERID2 = NEWERID2;                                  1004
         L     @04,@PC00001                                        1004
         L     @04,GDTTR2(,@04)                                    1004
         MVC   @TS00001(95),NEWERID2(@04)                          1004
         MVC   OLDERID2(95,@04),@TS00001                           1004
*            NEWID2 = 'RMPT';                                      1005
*                                                                  1005
         MVC   NEWID2(4,@04),@CC01362                              1005
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AND SAVE THE CPL USED TO DEFINE               */
*            /*  ALL OF THE PATHS ON THE PORTABILITY                 */
*            /*  DATA SET.                                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1006
*            CALL CPLPROC('F',PPTRCPL,NULLPARM,NULLPARM,           1006
*               NULLPARM);                                         1006
*                                                                  1006
         MVC   @AL00001(20),@AL01006                               1006
         LA    @04,PPTRCPL                                         1006
         ST    @04,@AL00001+4                                      1006
         LA    @01,@AL00001                                        1006
         BAL   @14,CPLPROC                                         1006
*            RESPECIFY RTNREG RSTD;                                1007
*            TESTRC = RTNREG;                                      1008
         STH   RTNREG,TESTRC                                       1008
*            RESPECIFY RTNREG UNRSTD;                              1009
*                                                                  1009
*            IF TESTRC ^= 0                                        1010
*              THEN                                                1010
         LH    @04,TESTRC                                          1010
         LTR   @04,@04                                             1010
         BZ    @RF01010                                            1010
*                RETURN CODE(LASTCC12);                            1011
*                                                                  1011
         LA    @15,12                                              1011
         L     @14,@SA00002                                        1011
         LM    @00,@12,@SA00002+8                                  1011
         BR    @14                                                 1011
*            CTGPLPTR = PPTRCPL;                                   1012
@RF01010 L     @04,PPTRCPL                                         1012
         ST    @04,CTGPLPTR                                        1012
*            PSAVCPL = CTGPL;                                      1013
*                                                                  1013
         MVC   PSAVCPL(28),CTGPL(@04)                              1013
*            /********************************************************/
*            /*                                                      */
*            /*  SET THE TOTAL LENGTH OF THE WORK AREA TO 0,         */
*            /*  AND TURN OFF THE FLAG INDICATING THAT CORE          */
*            /*  HAS BEEN GOTTEN FOR IT.                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  1014
*            TOTLEN = 0;                                           1014
         SLR   @04,@04                                             1014
         ST    @04,TOTLEN                                          1014
*            PCOREFLG = OFF;                                       1015
*                                                                  1015
         NI    PCOREFLG,B'01111111'                                1015
*            /********************************************************/
*            /*                                                      */
*            /*  DEFINE EACH PATH FROM THE PORTABILITY DATA          */
*            /*  SET.  SHOULD ANY DEFINE FAIL, GO ON TO THE          */
*            /*  NEXT PATH.                                          */
*            /*                                                      */
*            /********************************************************/
*                                                                  1016
*PATHLOOP:   DO I = NUMCOMP+1 TO NUMOBJ WHILE GETREO = OFF;        1016
*                                                                  1016
PATHLOOP LA    @04,1                                               1016
         AH    @04,NUMCOMP                                         1016
         B     @DE01016                                            1016
@DL01016 TM    GETREO,B'10000000'                                  1016
         BNZ   @DC01016                                            1016
*              /******************************************************/
*              /*                                                    */
*              /*  RESET THE FLAG THAT INDICATES THE CATALOG         */
*              /*  DEFINE OPERATION IS TO BE SKIPPED                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  1017
*              IMPF2NOD = OFF;                                     1017
*                                                                  1017
         NI    IMPF2NOD,B'11101111'                                1017
*              /******************************************************/
*              /*                                                    */
*              /*  RESTORE THE CPL AND READ IN THE CONTROL           */
*              /*  RECORD FOR THE PATH TO BE DEFINED.                */
*              /*                                                    */
*              /******************************************************/
*                                                                  1018
*              CTGPL = PSAVCPL;                                    1018
*                                                                  1018
         L     @04,CTGPLPTR                                        1018
         MVC   CTGPL(28,@04),PSAVCPL                               1018
*              CALL IDCIOGT0(GDTTBL,PINIOCS);                      1019
*                                                                  1019
         L     @04,@PC00001                                        1019
         ST    @04,@AL00001                                        1019
         LA    @15,PINIOCS                                         1019
         ST    @15,@AL00001+4                                      1019
         MVI   @AL00001+4,X'80'                                    1019
         L     @15,GDTGET(,@04)                                    1019
         LA    @01,@AL00001                                        1019
         BALR  @14,@15                                             1019
*              RESPECIFY RTNREG RSTD;                              1020
*              TESTRC = RTNREG;                                    1021
         STH   RTNREG,TESTRC                                       1021
*              RESPECIFY RTNREG UNRSTD;                            1022
*                                                                  1022
*              IF TESTRC ^= 0                                      1023
*                THEN                                              1023
         LH    @04,TESTRC                                          1023
         LTR   @04,@04                                             1023
         BZ    @RF01023                                            1023
*                  RETURN CODE(LASTCC12);                          1024
*                                                                  1024
         LA    @15,12                                              1024
         L     @14,@SA00002                                        1024
         LM    @00,@12,@SA00002+8                                  1024
         BR    @14                                                 1024
*              /******************************************************/
*              /*                                                    */
*              /*  MOVE THE CONTROL RECORD                           */
*              /*                                                    */
*              /******************************************************/
*                                                                  1025
*              TFVTLEN = IOCDAD -> HEADLN;                         1025
*                                                                  1025
@RF01023 L     @04,IOCSPTR                                         1025
         L     @01,IOCDAD(,@04)                                    1025
         LH    @15,HEADLN(,@01)                                    1025
         STH   @15,TFVTLEN                                         1025
*              CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);             1026
*                                                                  1026
         LA    @15,TFVTLEN                                         1026
         ST    @15,@AL00001                                        1026
         ST    @04,@AL00001+4                                      1026
         LA    @04,CONRCPTR                                        1026
         ST    @04,@AL00001+8                                      1026
         LA    @01,@AL00001                                        1026
         BAL   @14,MVDAPROC                                        1026
*              /******************************************************/
*              /*                                                    */
*              /*  TEST THE HEADER FLAG TO MAKE SURE THAT            */
*              /*  WE HAVE A CATALOG RECORD.                         */
*              /*                                                    */
*              /******************************************************/
*                                                                  1027
*              IF HEADFLG1 = HDFL1CAT                              1027
*                THEN                                              1027
         L     @04,CONRCPTR                                        1027
         CLI   HEADFLG1(@04),X'FF'                                 1027
         BNE   @RF01027                                            1027
*CATHDFLG:         DO;                                             1028
*                                                                  1028
CATHDFLG DS    0H                                                  1029
*                  /**************************************************/
*                  /*                                                */
*                  /*  GET STORAGE FOR THE CATALOG WORK AREA         */
*                  /*  IF THE CURRENT WORK AREA IS TOO SMALL         */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1029
*                  IF ASSRECLN > TOTLEN                            1029
*                    THEN                                          1029
         L     @04,CONRCPTR                                        1029
         LH    @04,ASSRECLN(,@04)                                  1029
         C     @04,TOTLEN                                          1029
         BNH   @RF01029                                            1029
*                      DO;                                         1030
*                                                                  1030
*                      /**********************************************/
*                      /*                                            */
*                      /*  IF CORE HAS BEEN GOTTEN FOR THE           */
*                      /*  WORK AREA PREVIOUSLY, FREE IT.            */
*                      /*                                            */
*                      /**********************************************/
*                                                                  1031
*                      IF PCOREFLG = ON                            1031
*                        THEN                                      1031
         TM    PCOREFLG,B'10000000'                                1031
         BNO   @RF01031                                            1031
*                          CALL IDCSAFS0(GDTTBL,PWORKAR);          1032
*                                                                  1032
         L     @04,@PC00001                                        1032
         ST    @04,@AL00001                                        1032
         LA    @15,PWORKAR                                         1032
         ST    @15,@AL00001+4                                      1032
         L     @15,GDTFSP(,@04)                                    1032
         LA    @01,@AL00001                                        1032
         BALR  @14,@15                                             1032
*                      PCOREFLG = ON;                              1033
@RF01031 OI    PCOREFLG,B'10000000'                                1033
*                      TOTLEN = ASSRECLN;                          1034
*                                                                  1034
         L     @04,CONRCPTR                                        1034
         LH    @04,ASSRECLN(,@04)                                  1034
         ST    @04,TOTLEN                                          1034
*                      CALL IDCSAGP0(GDTTBL,TOTLEN,PWORKAR,GPID,   1035
*                       SETZERO);                                  1035
*                                                                  1035
         L     @04,@PC00001                                        1035
         ST    @04,@AL00001                                        1035
         LA    @15,TOTLEN                                          1035
         ST    @15,@AL00001+4                                      1035
         LA    @15,PWORKAR                                         1035
         ST    @15,@AL00001+8                                      1035
         LA    @15,GPID                                            1035
         ST    @15,@AL00001+12                                     1035
         LA    @15,SETZERO                                         1035
         ST    @15,@AL00001+16                                     1035
         MVI   @AL00001+16,X'80'                                   1035
         L     @15,GDTGPL(,@04)                                    1035
         LA    @01,@AL00001                                        1035
         BALR  @14,@15                                             1035
*                      RESPECIFY RTNREG RSTD;                      1036
*                      TESTRC = RTNREG;                            1037
         STH   RTNREG,TESTRC                                       1037
*                      RESPECIFY RTNREG UNRSTD;                    1038
*                                                                  1038
*                      IF TESTRC ^= 0                              1039
*                        THEN                                      1039
         LH    @04,TESTRC                                          1039
         LTR   @04,@04                                             1039
         BZ    @RF01039                                            1039
*                          DO;                                     1040
*                          DARGSMOD = UNIVMSG;                     1041
         L     @04,DDSTRU                                          1041
         MVC   DARGSMOD(3,@04),@CC00981                            1041
*                          DEFSTID = NOSTORAG;                     1042
         MVI   DEFSTID,X'04'                                       1042
*                          RETURN CODE(LASTCC12);                  1043
         LA    @15,12                                              1043
         L     @14,@SA00002                                        1043
         LM    @00,@12,@SA00002+8                                  1043
         BR    @14                                                 1043
*                          END;                                    1044
*                                                                  1044
*                      END;                                        1045
*                                                                  1045
@RF01039 DS    0H                                                  1046
*                  /**************************************************/
*                  /*                                                */
*                  /*  READ IN THE CATALOG WORK AREA AND             */
*                  /*  CALL FVTPROC TO BUILD THE FVT AND             */
*                  /*  FPL'S NEEDED TO DO THE DEFINE.                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1046
*                  CALL GETPROC(PWORKAR,ASSRECLN);                 1046
*                                                                  1046
@RF01029 LA    @04,PWORKAR                                         1046
         ST    @04,@AL00001                                        1046
         L     @04,CONRCPTR                                        1046
         LA    @04,ASSRECLN(,@04)                                  1046
         ST    @04,@AL00001+4                                      1046
         LA    @01,@AL00001                                        1046
         BAL   @14,GETPROC                                         1046
*                  RESPECIFY RTNREG RSTD;                          1047
*                  TESTRC = RTNREG;                                1048
         STH   RTNREG,TESTRC                                       1048
*                  RESPECIFY RTNREG UNRSTD;                        1049
*                                                                  1049
*                  IF TESTRC ^= 0                                  1050
*                    THEN                                          1050
         LH    @04,TESTRC                                          1050
         LTR   @04,@04                                             1050
         BZ    @RF01050                                            1050
*                      RETURN CODE(LASTCC12);                      1051
*                                                                  1051
         LA    @15,12                                              1051
         L     @14,@SA00002                                        1051
         LM    @00,@12,@SA00002+8                                  1051
         BR    @14                                                 1051
*                  DICTPTR = ADDR(VARDATA);                        1052
*                                                                  1052
@RF01050 L     @04,CONRCPTR                                        1052
         LA    @04,VARDATA(,@04)                                   1052
         ST    @04,DICTPTR                                         1052
*                  CALL FVTPROC(DICTPTR,PWORKAR,PFVTPTR);          1053
*                                                                  1053
         LA    @04,DICTPTR                                         1053
         ST    @04,@AL00001                                        1053
         LA    @04,PWORKAR                                         1053
         ST    @04,@AL00001+4                                      1053
         LA    @04,PFVTPTR                                         1053
         ST    @04,@AL00001+8                                      1053
         LA    @01,@AL00001                                        1053
         BAL   @14,FVTPROC                                         1053
*                  RESPECIFY RTNREG RSTD;                          1054
*                  TESTRC = RTNREG;                                1055
         STH   RTNREG,TESTRC                                       1055
*                  RESPECIFY RTNREG UNRSTD;                        1056
*                                                                  1056
*                  IF TESTRC ^= 0                                  1057
*                    THEN                                          1057
         LH    @04,TESTRC                                          1057
         LTR   @04,@04                                             1057
         BZ    @RF01057                                            1057
*                      RETURN CODE(LASTCC12);                      1058
*                                                                  1058
         LA    @15,12                                              1058
         L     @14,@SA00002                                        1058
         LM    @00,@12,@SA00002+8                                  1058
         BR    @14                                                 1058
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET THE POINTER TO FVT IN THE CPL             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1059
*                  CTGFVT = PFVTPTR;                               1059
@RF01057 L     @04,PFVTPTR                                         1059
         L     @01,CTGPLPTR                                        1059
         ST    @04,CTGFVT(,@01)                                    1059
*                  CTGFVPTR = PFVTPTR;                             1060
*                                                                  1060
         ST    @04,CTGFVPTR                                        1060
*                  /**************************************************/
*                  /*                                                */
*                  /*  SCAN THE OBJECTS LIST FOR A MATCH TO          */
*                  /*  THE PATH BEING DEFINED.                       */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1061
*POBJLOOP:         DO IX = 1 TO OBJTSCNT;                          1061
*                                                                  1061
POBJLOOP LA    @04,1                                               1061
         B     @DE01061                                            1061
@DL01061 DS    0H                                                  1062
*                    IF OBJNMPTR(IX) -> OBJNMVAL(1:44) =           1062
*                       FENTNAME(1:44)                             1062
*                      THEN                                        1062
*                                                                  1062
         SLA   @04,2                                               1062
         L     @15,@PC00001+4                                      1062
         L     @01,FDTPTR+12(,@15)                                 1062
         AL    @01,@CF01779                                        1062
         L     @01,OBJNMPTR(@04,@01)                               1062
         L     @14,CTGFVPTR                                        1062
         L     @03,CTGFVENT(,@14)                                  1062
         CLC   OBJNMVAL(44,@01),FENTNAME(@03)                      1062
         BNE   @RF01062                                            1062
*                        /********************************************/
*                        /*                                          */
*                        /*  TEST FOR THE PRESENCE OF                */
*                        /*  THE FILE PARAMETER.  IF                 */
*                        /*  SPECIFIED, SET A POINTER                */
*                        /*  TO IT IN THE FVT.                       */
*                        /*                                          */
*                        /********************************************/
*                                                                  1063
*                        IF OBJFLPTR(IX) ^= NULLPTR                1063
*                          THEN                                    1063
         L     @01,FDTPTR+20(,@15)                                 1063
         AL    @01,@CF01779                                        1063
         L     @04,OBJFLPTR(@04,@01)                               1063
         LTR   @04,@04                                             1063
         BZ    @RF01063                                            1063
*                            CTGFVIND = ADDR(OBJFLPTR(IX)->OBJFLVAL);
*                                                                  1064
         LA    @04,OBJFLVAL(,@04)                                  1064
         ST    @04,CTGFVIND(,@14)                                  1064
*                  END POBJLOOP;                                   1065
*                                                                  1065
@RF01063 DS    0H                                                  1065
@RF01062 LA    @04,1                                               1065
         AL    @04,IX                                              1065
@DE01061 ST    @04,IX                                              1065
         L     @15,@PC00001+4                                      1065
         LA    @15,FDTPTR+8(,@15)                                  1065
         C     @04,OBJTSCNT(,@15)                                  1065
         BNH   @DL01061                                            1065
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF THE USER SPECIFIED OUTFILE AND             */
*                  /*  DID NOT EXPLICITLY GIVE A FILE                */
*                  /*  PARAMETER FOR THE PATH, SET                   */
*                  /*  CTGFVIND TO POINT THE OUTFILE DD              */
*                  /*  STATEMENT.                                    */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1066
*                  IF CTGFVIND = NULLPTR &                         1066
*                     ADDR(OUTDD) ^= NULLPTR                       1066
*                    THEN                                          1066
         SLR   @04,@04                                             1066
         L     @15,CTGFVPTR                                        1066
         C     @04,CTGFVIND(,@15)                                  1066
         BNE   @RF01066                                            1066
         L     @14,@PC00001+4                                      1066
         L     @14,FDTPTR+4(,@14)                                  1066
         CR    @14,@04                                             1066
         BE    @RF01066                                            1066
*                      CTGFVIND = ADDR(OUTDDVAL);                  1067
*                                                                  1067
         LA    @04,OUTDDVAL(,@14)                                  1067
         ST    @04,CTGFVIND(,@15)                                  1067
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET THE CTGFVWKA FIELD OF THE FVT             */
*                  /*  TO POINT THE WORK AREA FOR THE                */
*                  /*  RECOVERY VOLUME SERIAL NUMBER.                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1068
*                  PFVTPTR -> CTGFVWKA = ADDR(CATRCVWK);           1068
*                                                                  1068
@RF01066 LA    @04,CATRCVWK                                        1068
         L     @01,PFVTPTR                                         1068
         ST    @04,CTGFVWKA(,@01)                                  1068
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST TO DETERMINE IF IMPF2NOD IS SET          */
*                  /*  IF IT IS, THEN SKIP THE DEFINE OF             */
*                  /*  THE PRESENT PATH, AND PROCEED TO THE          */
*                  /*  NEXT.  OTHERWISE, DO A CMS DEFINE.            */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1069
*                  IF IMPF2NOD ^= ON                               1069
*                    THEN                                          1069
         TM    IMPF2NOD,B'00010000'                                1069
         BO    @RF01069                                            1069
*                      DO;                                         1070
*                                                                  1070
*                      /**********************************************/
*                      /*                                            */
*                      /*  CALL CATALOG MANAGEMENT TO DO             */
*                      /*  A CMS DEFINE                              */
*                      /*                                            */
*                      /**********************************************/
*                                                                  1071
*                      CALL CTLGPROC(PPTRCPL);                     1071
*                                                                  1071
         LA    @04,PPTRCPL                                         1071
         ST    @04,@AL00001                                        1071
         LA    @01,@AL00001                                        1071
         BAL   @14,CTLGPROC                                        1071
*                      RESPECIFY RTNREG RSTD;                      1072
*                      TESTRC = RTNREG;                            1073
         STH   RTNREG,TESTRC                                       1073
*                      RESPECIFY RTNREG UNRSTD;                    1074
*                                                                  1074
*                      IF TESTRC ^= 0                              1075
*                        THEN                                      1075
         LH    @04,TESTRC                                          1075
         LTR   @04,@04                                             1075
         BZ    @RF01075                                            1075
*                          DO;                                     1076
*                                                                  1076
*                          /******************************************/
*                          /*                                        */
*                          /*  THE DEFINE OF THE PATH HAS            */
*                          /*  FAILED.  PRINT AN ERROR               */
*                          /*  MESSAGE, BUT CONTINUE                 */
*                          /*  PROCESSING WITH THE NEXT              */
*                          /*  PATH.                                 */
*                          /*                                        */
*                          /******************************************/
*                                                                  1077
*                          DARGSMOD = IMPMSG;                      1077
         L     @04,DDSTRU                                          1077
         MVC   DARGSMOD(3,@04),@CC00945                            1077
*                          DARGSENT = BADPTMP;                     1078
         MVI   DARGSENT(@04),X'10'                                 1078
*                          DARGILP = LENGTH(FENTNAME);             1079
         MVC   DARGILP(2,@04),@CH00605                             1079
*                          DARGDBP = ADDR(FENTNAME);               1080
*                                                                  1080
         L     @01,CTGFVPTR                                        1080
         L     @15,CTGFVENT(,@01)                                  1080
         ST    @15,DARGDBP(,@04)                                   1080
*                          CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);   1081
*                                                                  1081
         L     @04,@PC00001                                        1081
         ST    @04,@AL00001                                        1081
         LA    @15,@CF00119                                        1081
         ST    @15,@AL00001+4                                      1081
         LA    @15,DDSTRU                                          1081
         ST    @15,@AL00001+8                                      1081
         MVI   @AL00001+8,X'80'                                    1081
         L     @15,GDTPRT(,@04)                                    1081
         LA    @01,@AL00001                                        1081
         BALR  @14,@15                                             1081
*                          SETRC = LASTCC08;                       1082
         MVC   SETRC(2),@CH00039                                   1082
*                          DEFSTID = 0;                            1083
         MVI   DEFSTID,X'00'                                       1083
*                          END;                                    1084
*                                                                  1084
*                  END;                                            1085
*                                                                  1085
@RF01075 DS    0H                                                  1086
*                  /**************************************************/
*                  /*                                                */
*                  /*  FREE CORE GOTTEN BY FVTPROC FOR THE           */
*                  /*  FVT AND FPL'S USED TO DEFINE THE              */
*                  /*  PATH.                                         */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1086
*                  CALL IDCSAFS0(GDTTBL,PFVTPTR);                  1086
*                                                                  1086
@RF01069 L     @04,@PC00001                                        1086
         ST    @04,@AL00001                                        1086
         LA    @15,PFVTPTR                                         1086
         ST    @15,@AL00001+4                                      1086
         L     @15,GDTFSP(,@04)                                    1086
         LA    @01,@AL00001                                        1086
         BALR  @14,@15                                             1086
*                  END CATHDFLG;                                   1087
*                                                                  1087
*              ELSE                                                1088
*                                                                  1088
*                /****************************************************/
*                /*                                                  */
*                /*  TEST FOR THE SPECIAL RECORD THAT FOLLOWS THE    */
*                /*  CATALOG INFORMATION FOR A VSAM DATA SET.        */
*                /*  IF PRESENT, INDICATE THAT PATHLOOP IS TO END    */
*                /*  BY TURNING ON GETREO.                           */
*                /*                                                  */
*                /****************************************************/
*                                                                  1088
*                IF HEADFLG1 = HDFL1REO                            1088
*                  THEN                                            1088
         B     @RC01027                                            1088
@RF01027 L     @04,CONRCPTR                                        1088
         CLI   HEADFLG1(@04),X'01'                                 1088
         BNE   @RF01088                                            1088
*                    GETREO = ON;                                  1089
         OI    GETREO,B'10000000'                                  1089
*                  ELSE                                            1090
*                    DO;                                           1090
         B     @RC01088                                            1090
@RF01088 DS    0H                                                  1091
*                    DEFSTID = PORTERR;                            1091
         MVI   DEFSTID,X'01'                                       1091
*                    RETURN CODE(LASTCC12);                        1092
         LA    @15,12                                              1092
         L     @14,@SA00002                                        1092
         LM    @00,@12,@SA00002+8                                  1092
         BR    @14                                                 1092
*                    END;                                          1093
*                                                                  1093
*            END PATHLOOP;                                         1094
*                                                                  1094
@RC01088 DS    0H                                                  1094
@RC01027 LA    @04,1                                               1094
         AL    @04,I                                               1094
@DE01016 ST    @04,I                                               1094
         CH    @04,NUMOBJ                                          1094
         BNH   @DL01016                                            1094
@DC01016 DS    0H                                                  1095
*            /********************************************************/
*            /*                                                      */
*            /*  FREE UP ANY CORE USED BY THE WORKAREA               */
*            /*  EMPLOYED TO DO THE PATH DEFINES.                    */
*            /*                                                      */
*            /********************************************************/
*                                                                  1095
*            IF PCOREFLG = ON                                      1095
*              THEN                                                1095
         TM    PCOREFLG,B'10000000'                                1095
         BNO   @RF01095                                            1095
*                CALL IDCSAFS0(GDTTBL,PWORKAR);                    1096
*                                                                  1096
         L     @04,@PC00001                                        1096
         ST    @04,@AL00001                                        1096
         LA    @15,PWORKAR                                         1096
         ST    @15,@AL00001+4                                      1096
         L     @15,GDTFSP(,@04)                                    1096
         LA    @01,@AL00001                                        1096
         BALR  @14,@15                                             1096
*            END PATHDEF;                                          1097
@RF01095 DS    0H                                                  1098
*        /************************************************************/
*        /*                                                          */
*        /*  GET THE RECORD FROM THE PORTABLE DATA SET WHICH         */
*        /*  DESCRIBES THE FORMAT OF THE DATA TO BE WRITTEN INTO     */
*        /*  THE CLUSTER PROVIDED THAT THE RECORD HAS NOT BEEN READ  */
*        /*  IF THE GET FAILS, RETURN TO THE CALLING PROCESSOR.      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1098
*        IF GETREO = OFF                                           1098
*          THEN                                                    1098
@RF01002 TM    GETREO,B'10000000'                                  1098
         BNZ   @RF01098                                            1098
*            DO;                                                   1099
*            CALL IDCIOGT0(GDTTBL,PINIOCS);                        1100
*                                                                  1100
         L     @04,@PC00001                                        1100
         ST    @04,@AL00001                                        1100
         LA    @15,PINIOCS                                         1100
         ST    @15,@AL00001+4                                      1100
         MVI   @AL00001+4,X'80'                                    1100
         L     @15,GDTGET(,@04)                                    1100
         LA    @01,@AL00001                                        1100
         BALR  @14,@15                                             1100
*            RESPECIFY RTNREG RSTD;                                1101
*            TESTRC = RTNREG;                                      1102
         STH   RTNREG,TESTRC                                       1102
*            RESPECIFY RTNREG UNRSTD;                              1103
*            IF TESTRC ^= 0                                        1104
*              THEN                                                1104
         LH    @04,TESTRC                                          1104
         LTR   @04,@04                                             1104
         BZ    @RF01104                                            1104
*                RETURN CODE(LASTCC12);                            1105
*                                                                  1105
         LA    @15,12                                              1105
         L     @14,@SA00002                                        1105
         LM    @00,@12,@SA00002+8                                  1105
         BR    @14                                                 1105
*            CONRCPTR = IOCDAD;                                    1106
*                                                                  1106
@RF01104 L     @04,IOCSPTR                                         1106
         L     @04,IOCDAD(,@04)                                    1106
         ST    @04,CONRCPTR                                        1106
*            IF  HEADFLG1 ^= HDFL1REO                              1107
*              THEN                                                1107
         CLI   HEADFLG1(@04),X'01'                                 1107
         BE    @RF01107                                            1107
*                DO;                                               1108
*                                                                  1108
*                /****************************************************/
*                /*                                                  */
*                /*  IF THE CONTROL RECORD IS NOT FOR A DATA RECORD, */
*                /*  THEN THE PORTABILITY VOLUME IS IN ERROR         */
*                /*  RETURN TO THE CALLING PROCESSOR.                */
*                /*                                                  */
*                /****************************************************/
*                                                                  1109
*                DEFSTID = PORTERR;                                1109
         MVI   DEFSTID,X'01'                                       1109
*                RETURN CODE(LASTCC12);                            1110
         LA    @15,12                                              1110
         L     @14,@SA00002                                        1110
         LM    @00,@12,@SA00002+8                                  1110
         BR    @14                                                 1110
*                END;                                              1111
*            END;                                                  1112
*                                                                  1112
@RF01107 DS    0H                                                  1113
*        /************************************************************/
*        /*                                                          */
*        /*  CALL RECPROC TO OPEN THE VSAM CLUSTER JUST DEFINED, AND */
*        /*  COPY THE DATA INTO IT RECORD BY RECORD FROM THE         */
*        /*  PORTABILITY DATA SET.                                   */
*        /*  IF ANY ERRORS ARE ENCOUNTERED, RETURN TO THE CALLING    */
*        /*  PROCESSOR,AFTER SETTING THE DELETE CLUSTER FLAG.        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1113
*        CALL RECPROC;                                             1113
*                                                                  1113
@RF01098 BAL   @14,RECPROC                                         1113
*        RESPECIFY RTNREG RSTD;                                    1114
*        TESTRC = RTNREG;                                          1115
         STH   RTNREG,TESTRC                                       1115
*        RESPECIFY RTNREG UNRSTD;                                  1116
*        IF TESTRC ^= 0                                            1117
*          THEN                                                    1117
         LH    @04,TESTRC                                          1117
         LTR   @04,@04                                             1117
         BZ    @RF01117                                            1117
*            RETURN CODE(TESTRC);                          /*@OZ17068*/
*                                                                  1118
         LR    @15,@04                                             1118
         L     @14,@SA00002                                        1118
         LM    @00,@12,@SA00002+8                                  1118
         BR    @14                                                 1118
*        OLDERID2 = NEWERID2;                                      1119
@RF01117 L     @04,@PC00001                                        1119
         L     @15,GDTTR2(,@04)                                    1119
         MVC   @TS00001(95),NEWERID2(@15)                          1119
         MVC   OLDERID2(95,@15),@TS00001                           1119
*        NEWID2 = 'RMCE';                                          1120
*                                                                  1120
         MVC   NEWID2(4,@15),@CC01370                              1120
*        /************************************************************/
*        /*                                                          */
*        /*  PRINT A MESSAGE TO INDICATE WHAT HAS BEEN IMPORTED      */
*        /*  SUCCESSFULLY.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1121
*        DARGSMOD = IMPMSG;                                        1121
         L     @15,DDSTRU                                          1121
         MVC   DARGSMOD(3,@15),@CC00945                            1121
*        DARGSENT = MPRASUCC;                                      1122
         MVI   DARGSENT(@15),X'1A'                                 1122
*        DARGILP = LENGTH(FENTNAME);                               1123
         MVC   DARGILP(2,@15),@CH00605                             1123
*        DARGDBP = FVTPTR(1) -> CTGFVENT;                          1124
         L     @01,FVTPTR                                          1124
         L     @14,CTGFVENT(,@01)                                  1124
         ST    @14,DARGDBP(,@15)                                   1124
*        CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                     1125
         ST    @04,@AL00001                                        1125
         LA    @15,@CF00119                                        1125
         ST    @15,@AL00001+4                                      1125
         LA    @15,DDSTRU                                          1125
         ST    @15,@AL00001+8                                      1125
         MVI   @AL00001+8,X'80'                                    1125
         L     @15,GDTPRT(,@04)                                    1125
         LA    @01,@AL00001                                        1125
         BALR  @14,@15                                             1125
*        DARGLIST = ''B;                                           1126
         L     @04,DDSTRU                                          1126
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1126
*        DARGSMOD = IMPMSG;                                        1127
*                                                                  1127
         MVC   DARGSMOD(3,@04),@CC00945                            1127
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO MAIN PROCEDURE, INDICATING THAT ENTIRE        */
*        /*  FUNCTION COMPLETED SUCCESSFULLY                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1128
*        RETURN CODE(0);                                           1128
         SLR   @15,@15                                             1128
         L     @14,@SA00002                                        1128
         LM    @00,@12,@SA00002+8                                  1128
         BR    @14                                                 1128
*END CLUSPROC;                                                     1129
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - CPLPROC                                */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT A CATALOG PARAMETER LIST (CPL)     */
*        /*  WHICH IS THE PRIMARY CONTROL BLOCK FOR ORGANIZING A     */
*        /*  REQUEST FOR CATALOG MANAGEMENT SERVICES                 */
*        /*  THE CPL CONSTRUCTED IN THIS PROCEDURE WILL BE USED FOR  */
*        /*  A CATALOG DEFINE, ALTER, DELETE OR LOCATE OPERATION.    */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    CTYPE - TYPE INDICATOR (DELETE,ALTER,LOCATE,DEFINE    */
*        /*    CPTRCPL - RETURN CELL FOR CPL CONSTRUCTED             */
*        /*    CNAME - NAME OF CLUSTER FOR DELETE OR LOCATE          */
*        /*    CINUM - CONTROL INTERVAL NUMBER FOR LOCATE OF         */
*        /*            CLUSTER COMPONENT                             */
*        /*    CCPSWD - OBJECT PASSWORD OR ZERO                      */
*        /*                                                          */
*        /*  OUTPUT - AN INITIALIZED CPL                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1130
*CPLPROC: PROCEDURE(CTYPE,             /*TYPE OF CPL TO BE BUILT     */
*                   CPTRCPL,           /*RETURN CELL FOR CPL POINTER */
*                   CNAME,             /*ADDRESS OF ENTRYNAME OR 0   */
*                   CINUM,             /*CONTROL INTERVAL NUMBER OR 0*/
*                   CCPSWD);           /*ADDRESS OF 8-BYTE PASSWORD  */
*                                                                  1130
CPLPROC  STM   @14,@12,@SA00003                                    1130
         MVC   @PC00003(20),0(@01)                                 1130
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1131
*        DCL                                                       1131
*          CTYPE    CHAR(1),                                       1131
*          CPTRCPL  PTR(31),                                       1131
*          CNAME    PTR(31),                                       1131
*          CINUM    CHAR(3),                                       1131
*          CCPSWD   PTR(31);                                       1131
*                                                                  1131
*        /************************************************************/
*        /*                                                          */
*        /* LOCAL DECLARATIONS                                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1132
*        DCL LENWKA FIXED(15) CONSTANT(49);                        1132
*                                      /*LENGTH WORK AREA NEEDED FOR */
*                                      /*ALTER, LOCATE, DEFINE       */
*        DCL 1 DELTWKA BDY(WORD),                                  1133
*          2 *     FIXED(15),                                      1133
*          2 *     FIXED(15),                                      1133
*          2 *(12) CHAR(45);                                       1133
*                                      /*WORK AREA FOR DELETE        */
*                                                                  1134
*        DCL CPLPROCI FIXED(31);       /*INDEX USED TO CLEAR         */
*                                      /*CATALOG WORK AREA           */
*                                                                  1135
*        OLDERID2 = NEWERID2;                                      1135
         L     @04,@PC00001                                        1135
         L     @15,GDTTR2(,@04)                                    1135
         MVC   @TS00001(95),NEWERID2(@15)                          1135
         MVC   OLDERID2(95,@15),@TS00001                           1135
*        NEWID2 = 'RMPL';                                          1136
*                                                                  1136
         MVC   NEWID2(4,@15),@CC01392                              1136
*        /************************************************************/
*        /*                                                          */
*        /*  GET CORE FOR CATALOG PARAMETER LIST(CPL)                */
*        /*  IF CORE IS NOT OBTAINED SUCCESSFULLY, RETURN TO THE     */
*        /*  CALLING PROCEDURE                                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1137
*        CALL IDCSAGP0 (GDTTBL,(LENGTH(CTGPL)+16+LENWKA),CPTRCPL,GPID,S
*TZERO);                                                           1137
*                                                                  1137
         ST    @04,@AL00001                                        1137
         LA    @15,93                                              1137
         ST    @15,@AFTEMPS                                        1137
         LA    @15,@AFTEMPS                                        1137
         ST    @15,@AL00001+4                                      1137
         L     @15,@PC00003+4                                      1137
         ST    @15,@AL00001+8                                      1137
         LA    @15,GPID                                            1137
         ST    @15,@AL00001+12                                     1137
         LA    @15,SETZERO                                         1137
         ST    @15,@AL00001+16                                     1137
         MVI   @AL00001+16,X'80'                                   1137
         L     @15,GDTGPL(,@04)                                    1137
         LA    @01,@AL00001                                        1137
         BALR  @14,@15                                             1137
*        RESPECIFY RTNREG RSTD;                                    1138
*        TESTRC = RTNREG;                                          1139
         STH   RTNREG,TESTRC                                       1139
*        RESPECIFY RTNREG UNRSTD;                                  1140
*        IF TESTRC ^= 0                                            1141
*          THEN                                                    1141
         LH    @04,TESTRC                                          1141
         LTR   @04,@04                                             1141
         BZ    @RF01141                                            1141
*            DO;                                                   1142
*            DARGSMOD = UNIVMSG;                                   1143
         L     @04,DDSTRU                                          1143
         MVC   DARGSMOD(3,@04),@CC00981                            1143
*            DEFSTID = NOSTORAG;                                   1144
         MVI   DEFSTID,X'04'                                       1144
*            RETURN CODE(LASTCC12);                                1145
         LA    @15,12                                              1145
         L     @14,@SA00003                                        1145
         LM    @00,@12,@SA00003+8                                  1145
         BR    @14                                                 1145
*            END;                                                  1146
*                                                                  1146
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE CPL WITH INFORMATION COMMON TO ALL 4 CATALOG */
*        /*  MANAGEMENT FUNCTIONS                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1147
*        CTGPLPTR = CPTRCPL;           /*SET CPL BASE POINTER        */
@RF01141 L     @04,@PC00003+4                                      1147
         L     @04,CPTRCPL(,@04)                                   1147
         ST    @04,CTGPLPTR                                        1147
*        CTGWKA = CTGPLPTR + (LENGTH(CTGPL)+16);                   1148
         LA    @15,44                                              1148
         ALR   @15,@04                                             1148
         ST    @15,CTGWKA(,@04)                                    1148
*                                      /*SET WORK AREA ADDRESS       */
*        AREALN = LENWKA;              /*SET WORK AREA LENGTH        */
         MVC   AREALN(2,@15),@CH01385                              1149
*        CTGAM0 = ON;                  /*VSAM REQUEST                */
         OI    CTGAM0(@04),B'00000001'                             1150
*        IF CTYPE ^= 'L'                                           1151
*          THEN                                                    1151
         L     @15,@PC00003                                        1151
         CLI   CTYPE(@15),C'L'                                     1151
         BE    @RF01151                                            1151
*            CTGFUNC = CTGCMS;         /*CMS FUNCTION                */
         NI    CTGFUNC(@04),B'10011111'                            1152
         OI    CTGFUNC(@04),B'10000000'                            1152
*        IF PTRCTACB ^= NULLPTR                                    1153
*          THEN                                                    1153
@RF01151 L     @04,PTRCTACB                                        1153
         LTR   @04,@04                                             1153
         BZ    @RF01153                                            1153
*            CTGCAT = ADDR(PTRCTACB);  /*SET CATALOG ACB ADDR        */
         LA    @04,PTRCTACB                                        1154
         L     @01,CTGPLPTR                                        1154
         ST    @04,CTGCAT(,@01)                                    1154
*          ELSE                                                    1155
*            DO;                                           /*@OZ14579*/
         B     @RC01153                                            1155
@RF01153 DS    0H                                                  1156
*            CTGCNAME = ON;            /*NO CATALOG ACB PASSED       */
         L     @04,CTGPLPTR                                        1156
         OI    CTGCNAME(@04),B'00000010'                           1156
*            IF ADDR(CAT) ^= NULLPTR                       /*@OZ14579*/
*              THEN                                        /*@OZ14579*/
         L     @15,@PC00001+4                                      1157
         L     @15,FDTPTR+128(,@15)                                1157
         LTR   @15,@15                                             1157
         BZ    @RF01157                                            1157
*                CTGCAT = ADDR(CATVAL);/* SET PTR TO CATALOG @OZ14579*/
         LA    @15,CATVAL(,@15)                                    1158
         ST    @15,CTGCAT(,@04)                                    1158
*            END;                      /* NAME               @OZ14579*/
*                                                                  1159
@RF01157 DS    0H                                                  1160
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE CATALOG PASSWORD IS SPECIFIED IN THE AMS COMMAND,*/
*        /*  PASS IT TO CATALOG MANAGEMENT.  OTHERWISE SEE IF AN     */
*        /*  OBJECT PASSWORD HAS BEEN SUPPLIED BY THE CALLER OF THE  */
*        /*  PROCEDURE                                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1160
*        IF ADDR(CAT) ^= NULLPTR & CATPLN > 0                      1160
*          THEN                                                    1160
@RC01153 L     @04,@PC00001+4                                      1160
         L     @04,FDTPTR+128(,@04)                                1160
         LTR   @04,@04                                             1160
         BZ    @RF01160                                            1160
         CLI   CATPLN(@04),0                                       1160
         BNH   @RF01160                                            1160
*            CTGPSWD = ADDR(CATPAS);                               1161
         LA    @04,CATPAS(,@04)                                    1161
         L     @01,CTGPLPTR                                        1161
         ST    @04,CTGPSWD(,@01)                                   1161
*          ELSE                                                    1162
*            IF CCPSWD ^= NULLPTR                                  1162
*              THEN                                                1162
         B     @RC01160                                            1162
@RF01160 L     @04,@PC00003+16                                     1162
         L     @04,CCPSWD(,@04)                                    1162
         LTR   @04,@04                                             1162
         BZ    @RF01162                                            1162
*                CTGPSWD = CCPSWD;                                 1163
*                                                                  1163
         L     @01,CTGPLPTR                                        1163
         ST    @04,CTGPSWD(,@01)                                   1163
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE APPROPRIATE FLAGS FOR EACH PARTICULAR FUNCTION  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1164
*        /************************************************************/
*        /*                                                          */
*        /*  CATALOG DEFINE FUNCTION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1164
*        IF CTYPE = 'F'                                            1164
*          THEN                                                    1164
@RF01162 DS    0H                                                  1164
@RC01160 L     @04,@PC00003                                        1164
         CLI   CTYPE(@04),C'F'                                     1164
         BNE   @RF01164                                            1164
*            DO;                                                   1165
*        /* IF SAVRAC DONT RACF-DEFINE PROFILES              @Z40RSSA*/
*          IF ADDR(SRAC) ^= 0 THEN                         /*@Z40RSSA*/
         L     @04,@PC00001+4                                      1166
         L     @04,FDTPTR+132(,@04)                                1166
         LTR   @04,@04                                             1166
         BZ    @RF01166                                            1166
*          CTGNPROF = ON;                                  /*@Z40RSSA*/
         L     @04,CTGPLPTR                                        1167
         OI    CTGNPROF(@04),B'00100000'                           1167
*       /* SET OTHER DEFINE FLAGS                            @Z40RSSA*/
*            CTGNAME = ON;             /*ENTRY NAME SUPPLIED         */
@RF01166 L     @04,CTGPLPTR                                        1168
         OI    CTGNAME(@04),B'00000100'                            1168
*            CTGOPTNS = CTGDEFIN;      /*DEFINE FUNCTION             */
         NI    CTGOPTNS(@04),B'00001111'                           1169
         OI    CTGOPTNS(@04),B'00001000'                           1169
*            CTGMAST = ON;             /*VERIFY MASTER PASSWORD      */
         OI    CTGMAST(@04),B'01000000'                            1170
*            END;                                                  1171
*                                                                  1171
*        /************************************************************/
*        /*                                                          */
*        /*  CATALOG LOCATE FUNCTION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1172
*        IF CTYPE = 'L'                                            1172
*          THEN                                                    1172
@RF01164 L     @04,@PC00003                                        1172
         CLI   CTYPE(@04),C'L'                                     1172
         BNE   @RF01172                                            1172
*            CTGFUNC = CTGLOC;         /*CATALOG LOCATE FUNCTION     */
*                                                                  1173
         L     @04,CTGPLPTR                                        1173
         NI    CTGFUNC(@04),B'00111111'                            1173
         OI    CTGFUNC(@04),B'00100000'                            1173
*        /************************************************************/
*        /*                                                          */
*        /*  CATALOG ALTER  FUNCTION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1174
*        IF CTYPE = 'A'                                            1174
*          THEN                                                    1174
@RF01172 L     @04,@PC00003                                        1174
         CLI   CTYPE(@04),C'A'                                     1174
         BNE   @RF01174                                            1174
*            DO;                                                   1175
*            CTGNAME = ON;             /*ENTRY NAME SUPPLIED         */
         L     @04,CTGPLPTR                                        1176
         OI    CTGNAME(@04),B'00000100'                            1176
*            CTGOPTNS = CTGALTER;      /*ALTER FUNCTION              */
         NI    CTGOPTNS(@04),B'00010111'                           1177
         OI    CTGOPTNS(@04),B'00010000'                           1177
*            CTGNUM = ON;              /*SEARCH ONE CATALOG          */
         OI    CTGNUM(@04),B'00000010'                             1178
*            END;                                                  1179
*                                                                  1179
*        /************************************************************/
*        /*                                                          */
*        /*  CATALOG DELETE FUNCTION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1180
*        IF CTYPE = 'D'                                            1180
*          THEN                                                    1180
@RF01174 L     @04,@PC00003                                        1180
         CLI   CTYPE(@04),C'D'                                     1180
         BNE   @RF01180                                            1180
*            DO;                                                   1181
*        /* IF SAVRAC DONT RACF-DELETE PROFILES              @Z40RSSA*/
*        IF ADDR(SRAC) ^= 0 THEN                           /*@Z40RSSA*/
         L     @04,@PC00001+4                                      1182
         L     @04,FDTPTR+132(,@04)                                1182
         LTR   @04,@04                                             1182
         BZ    @RF01182                                            1182
*          CTGNPROF = ON;                                  /*@Z40RSSA*/
         L     @04,CTGPLPTR                                        1183
         OI    CTGNPROF(@04),B'00100000'                           1183
*       /* SET OTHER DELETE FLAGS                            @Z40RSSA*/
*            CTGOPTNS = CTGDELET;      /*DELETE FUNCTION             */
@RF01182 L     @04,CTGPLPTR                                        1184
         NI    CTGOPTNS(@04),B'00011111'                           1184
         OI    CTGOPTNS(@04),B'00011000'                           1184
*            CTGNAME = ON;             /*ENTRY NAME SUPPLIED         */
         OI    CTGNAME(@04),B'00000100'                            1185
*            IF ADDR(OUTDD) ^= NULLPTR                             1186
*              THEN                                                1186
         L     @15,@PC00001+4                                      1186
         L     @15,FDTPTR+4(,@15)                                  1186
         LTR   @15,@15                                             1186
         BZ    @RF01186                                            1186
*                CTGDDNM = ADDR(OUTDDVAL); /*DDNAME POINTER          */
*                                                                  1187
         LA    @15,OUTDDVAL(,@15)                                  1187
         ST    @15,CTGDDNM(,@04)                                   1187
*            /********************************************************/
*            /*                                                      */
*            /*  SET DELETE OPTIONS FOR IMPORTRA.  THE OBJECT IS     */
*            /*  NOT TO BE ERASED, SO THAT CTGOVRID IS SET ON, AND   */
*            /*  CTGERASE IS SET TO OFF.  ALSO, CTGPURG IS SET TO    */
*            /*  ON TO INDICATE THAT THE OBJECT IS TO BE DELETED     */
*            /*  EVEN THOUGH ITS EXPIRATION DATE HAS NOT BEEN        */
*            /*  REACHED.                                            */
*            /*                                                      */
*            /********************************************************/
*                                                                  1188
*            CTGOVRID = ON;                                        1188
@RF01186 DS    0H                                                  1189
*            CTGERASE = OFF;                                       1189
*            CTGPURG = ON;                                         1190
*                                                                  1190
         L     @04,CTGPLPTR                                        1190
         OI    CTGOVRID(@04),B'00100100'                           1190
         NI    CTGERASE(@04),B'10111111'                           1190
*            CTGWKA = ADDR(DELTWKA);   /*SET WORK AREA ADDRESS       */
         LA    @15,DELTWKA                                         1191
         ST    @15,CTGWKA(,@04)                                    1191
*            AREALN = LENGTH(DELTWKA); /*WORK AREA LENGTH            */
         MVC   AREALN(2,@15),@CH01749                              1192
*            RETURNLN = 0;             /*RETURN LENGTH FROM          */
         SLR   @04,@04                                             1193
         STH   @04,RETURNLN(,@15)                                  1193
*                                      /*CATALOG MANAGEMENT          */
*                                                                  1194
*            /********************************************************/
*            /*                                                      */
*            /*  CLEAR THE REST OF THE WORK AREA FOR VSAM            */
*            /*  CATALOG MANAGEMENT DELETE                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1194
*            DO CPLPROCI = 1 TO 12;                                1194
         LA    @04,1                                               1194
         ST    @04,CPLPROCI                                        1194
@DL01194 DS    0H                                                  1195
*              ENTITEM(CPLPROCI) = ''B;                            1195
         LR    @15,@04                                             1195
         MH    @15,@CH01390                                        1195
         L     @01,CTGPLPTR                                        1195
         L     @01,CTGWKA(,@01)                                    1195
         ALR   @01,@15                                             1195
         AL    @01,@CF01798                                        1195
         XC    ENTITEM-4(45,@01),ENTITEM-4(@01)                    1195
*            END;                                                  1196
*                                                                  1196
         AL    @04,@CF00221                                        1196
         ST    @04,CPLPROCI                                        1196
         C     @04,@CF00035                                        1196
         BNH   @DL01194                                            1196
*           END;                                                   1197
*                                                                  1197
*        /************************************************************/
*        /*                                                          */
*        /*  FOR DELETE OR LOCATE, SUPPLY ENTRYNAME                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1198
*        IF CTYPE = 'L' × CTYPE ='D'                               1198
*          THEN                                                    1198
@RF01180 L     @04,@PC00003                                        1198
         CLI   CTYPE(@04),C'L'                                     1198
         BE    @RT01198                                            1198
         CLI   CTYPE(@04),C'D'                                     1198
         BNE   @RF01198                                            1198
@RT01198 DS    0H                                                  1199
*            DO;                                                   1199
*            IF CNAME ^= NULLPTR                                   1200
*              THEN                                                1200
         L     @04,@PC00003+8                                      1200
         L     @04,CNAME(,@04)                                     1200
         LTR   @04,@04                                             1200
         BZ    @RF01200                                            1200
*                DO;                                               1201
*                CTGENT = CNAME;       /*SET POINTER TO ENTRY NAME   */
         L     @15,CTGPLPTR                                        1202
         ST    @04,CTGENT(,@15)                                    1202
*                CTGNAME = ON;         /*ENTRY NAME SUPPLIED         */
         OI    CTGNAME(@15),B'00000100'                            1203
*                END;                                              1204
*              ELSE                                                1205
*                CTGENT = ADDR(CINUM); /*SET CONTROL INTERVAL NUMBER */
         B     @RC01200                                            1205
@RF01200 L     @04,@PC00003+12                                     1205
         L     @01,CTGPLPTR                                        1205
         ST    @04,CTGENT(,@01)                                    1205
*            END;                                                  1206
*                                                                  1206
@RC01200 DS    0H                                                  1207
*        IF GDTDBG = NULLPTR                                       1207
*          THEN;                                                   1207
@RF01198 L     @04,@PC00001                                        1207
         L     @04,GDTDBG(,@04)                                    1207
         LTR   @04,@04                                             1207
         BZ    @RT01207                                            1207
*          ELSE                                                    1209
*            CALL IDCDB010(GDTTBL,'RMCL');                         1209
*                                                                  1209
         L     @04,@PC00001                                        1209
         ST    @04,@AL00001                                        1209
         LA    @15,@CC01394                                        1209
         ST    @15,@AL00001+4                                      1209
         MVI   @AL00001+4,X'80'                                    1209
         L     @15,GDTDBG(,@04)                                    1209
         LA    @01,@AL00001                                        1209
         BALR  @14,@15                                             1209
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1210
*        RETURN CODE(0);                                           1210
@RT01207 SLR   @15,@15                                             1210
         L     @14,@SA00003                                        1210
         LM    @00,@12,@SA00003+8                                  1210
         BR    @14                                                 1210
*END CPLPROC;                                                      1211
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - IUNIQPRC                               */
*        /*                                                          */
*        /*  FUNCTION - CHECK THE DSATTR FIELDS TO SEE IF THE DATA   */
*        /*  SET BEING DEFINED IS A UNIQUE DATA SET.  IF SO, A NULL  */
*        /*  SPACE(VOLUME) FVT MUST BE SUPPLIED FOR CATALOG DEFINE   */
*        /*                                                          */
*        /*  INPUT - NONE                                            */
*        /*                                                          */
*        /*  OUTPUT - FOR A UNIQUE DATA SET, A NULL VOLUME FVT WILL  */
*        /*  HAVE BEEN CONSTRUCTED AND A POINTER TO IT PLACED IN THE */
*        /*  CLUSTER FVT                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1212
*IUNIQPRC: PROCEDURE;                                              1212
*                                                                  1212
IUNIQPRC STM   @14,@12,12(@13)                                     1212
*        /************************************************************/
*        /*                                                          */
*        /*  GET THE DATA FVT AND CHECK THE DSATTR FIELD FOR UNIQUE  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1213
*        CTGPLPTR = PTRCPL;                                        1213
         L     @04,PTRCPL                                          1213
         ST    @04,CTGPLPTR                                        1213
*        CTGFVPTR = CTGFVT;            /*FVT BASE- CLUSTER           */
         L     @04,CTGFVT(,@04)                                    1214
         ST    @04,CTGFVPTR                                        1214
*        CTGFVPTR = CTGFVDCH;          /*FVT BASE - DATA COMPONENT   */
         L     @04,CTGFVDCH(,@04)                                  1215
         ST    @04,CTGFVPTR                                        1215
*        IF CTGFVATR ^= NULLPTR                                    1216
*          THEN                                                    1216
         L     @04,CTGFVATR(,@04)                                  1216
         LTR   @04,@04                                             1216
         BZ    @RF01216                                            1216
*            DO;                                                   1217
*            CTGFLPTR = CTGFVATR;      /*SET FPL BASE TO DSATTR FPL  */
         ST    @04,CTGFLPTR                                        1218
*            IF FDSUNIQ = ON                                       1219
*              THEN                                                1219
         L     @04,CTGFLPT(,@04)                                   1219
         TM    FDSUNIQ(@04),B'01000000'                            1219
         BNO   @RF01219                                            1219
*                DO;                                               1220
*                UNIQD = ON;                                       1221
         OI    UNIQD,B'10000000'                                   1221
*                IMPUNIQ = ON;         /*SET IMPORT UNIQUE FLAG      */
         OI    IMPUNIQ,B'10000000'                                 1222
*                END;                                              1223
*            END;                                                  1224
*                                                                  1224
@RF01219 DS    0H                                                  1225
*        /************************************************************/
*        /*                                                          */
*        /*  IF AN INDEX FVT IS EXISTANT, CHECK IT ITS DSATTR FIELD  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1225
*        CTGFVPTR = CTGFVT;            /*SET FVT BASE- CLUSTER FVT   */
@RF01216 L     @04,CTGPLPTR                                        1225
         L     @04,CTGFVT(,@04)                                    1225
         ST    @04,CTGFVPTR                                        1225
*        IF CTGFVICH ^= NULLPTR                                    1226
*          THEN                                                    1226
         SLR   @15,@15                                             1226
         L     @04,CTGFVICH(,@04)                                  1226
         CR    @04,@15                                             1226
         BE    @RF01226                                            1226
*            DO;                                                   1227
*            CTGFVPTR = CTGFVICH;      /*SET FVT BASE- INDEX FVT     */
         ST    @04,CTGFVPTR                                        1228
*            IF CTGFVATR ^= NULLPTR                                1229
*              THEN                                                1229
         L     @04,CTGFVATR(,@04)                                  1229
         CR    @04,@15                                             1229
         BE    @RF01229                                            1229
*                DO;                                               1230
*                CTGFLPTR = CTGFVATR;  /*SET FPL BASE- DSATTR FPL    */
         ST    @04,CTGFLPTR                                        1231
*                IF FDSUNIQ = ON                                   1232
*                  THEN                                            1232
         L     @04,CTGFLPT(,@04)                                   1232
         TM    FDSUNIQ(@04),B'01000000'                            1232
         BNO   @RF01232                                            1232
*                    DO;                                           1233
*                    UNIQI = ON;                                   1234
         OI    UNIQI,B'10000000'                                   1234
*                    IMPUNIQ = ON;     /*SET IMPORT UNIQUE FLAG      */
         OI    IMPUNIQ,B'10000000'                                 1235
*                    END;                                          1236
*                END;                                              1237
@RF01232 DS    0H                                                  1238
*            END;                                                  1238
*                                                                  1238
@RF01229 DS    0H                                                  1239
*        /***********************************************************/
*        /*                                                          */
*        /*  IF A DATA SET WAS A UNIQUE DATA SET (HAVING ITS OWN     */
*        /*  DATA SPACE) PRIOR TO EXPORT, IT WILL AGAIN BE DEFINED   */
*        /*  AS A UNIQUE DATA SET.  THIS ENTAILS SUPPLYING A NULL    */
*        /*  SPACE (VOLUME) FVT FOR CATALOG DEFINE                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1239
*        IF IMPUNIQ = ON                                           1239
*          THEN                                                    1239
@RF01226 TM    IMPUNIQ,B'10000000'                                 1239
         BNO   @RF01239                                            1239
*            DO;                                                   1240
*            OLDERID2 = NEWERID2;                                  1241
         L     @04,@PC00001                                        1241
         L     @04,GDTTR2(,@04)                                    1241
         MVC   @TS00001(95),NEWERID2(@04)                          1241
         MVC   OLDERID2(95,@04),@TS00001                           1241
*            NEWID2 = 'RMUQ';                                      1242
         MVC   NEWID2(4,@04),@CC01398                              1242
*            CTGFVPTR = CTGFVT;        /*SET FVT BASE - CLUSTER FVT  */
         L     @04,CTGPLPTR                                        1243
         L     @04,CTGFVT(,@04)                                    1243
         ST    @04,CTGFVPTR                                        1243
*            CTGFVVCH = ADDR(IUNIQFVT);/*SET VOLUME FVT ADDRESS      */
         LA    @15,IUNIQFVT                                        1244
         ST    @15,CTGFVVCH(,@04)                                  1244
*            IUNIQFVT = ''B;           /*ZERO VOLUME FVT             */
*                                                                  1245
         XC    IUNIQFVT(92),IUNIQFVT                               1245
*            /********************************************************/
*            /*                                                      */
*            /*  SET VOLUME INDICATOR IN VOLUME FVT                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  1246
*            CTGFVPTR = CTGFVVCH;      /*SET FVT BASE - VOLUME FVT   */
         ST    @15,CTGFVPTR                                        1246
*            CTGFVTYP = CTGFVVOL;      /*SET TYPE FLAG = VOLUME      */
         MVI   CTGFVTYP(@15),C'V'                                  1247
*            END;                                                  1248
*                                                                  1248
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1249
*        RETURN CODE(0);                                           1249
@RF01239 SLR   @15,@15                                             1249
         L     @14,12(,@13)                                        1249
         LM    @00,@12,20(@13)                                     1249
         BR    @14                                                 1249
*END IUNIQPRC;                                                     1250
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - ALTRPROC                               */
*        /*                                                          */
*        /*  FUNCTION - ALTRPROC WILL CONSTRUCT A CPL AND FVT TO BE  */
*        /*  EMPLOYED BY THE CATALOG ALTER INTERFACE TO ALTER THE    */
*        /*  THE NAME OF THE OBJECT DEFINED TO THE NAME THAT APPEARS */
*        /*  ON THE DD CARD USED TO OPEN THE OBJECT FOR LOADING.     */
*        /*  CATALOG MANAGEMENT IS ACTUALLY INVOKED BY CTLGPROC.     */
*        /*  THIS PROCEDURE IS ALSO CALLED AT CLOSE TIME TO          */
*        /*  TO ALTER THE NAME OF THE OBJECT JUST LOADED BACK TO     */
*        /*  THE NAME THAT IT WAS DEFINED UNDER.                     */
*        /*                                                          */
*        /*  INPUT - A FLAG INDICATING WHETHER THE NAME IS TO        */
*        /*  CHANGED TO THE DUMMY NAME OR BACK TO THE REAL NAME      */
*        /*                                                          */
*        /*  OUTPUT - AN ALTERED CATALOG ENTRY                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1251
*ALTRPROC: PROCEDURE(ALTERTYP);                                    1251
*                                                                  1251
ALTRPROC STM   @14,@12,@SA00005                                    1251
         MVC   @PC00005(4),0(@01)                                  1251
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1252
*        DCL ALTERTYP CHAR(1);         /*ALTERTYP = 'F' ALTER TO     */
*                                      /*DUMMY NAME                  */
*                                      /*ALTERTYP = 'S' ALTER TO     */
*                                      /*REAL NAME                   */
*                                                                  1253
*        OLDERID2 = NEWERID2;                                      1253
         L     @04,@PC00001                                        1253
         L     @04,GDTTR2(,@04)                                    1253
         MVC   @TS00001(95),NEWERID2(@04)                          1253
         MVC   OLDERID2(95,@04),@TS00001                           1253
*        NEWID2 = 'RMAT';                                          1254
*                                                                  1254
         MVC   NEWID2(4,@04),@CC01405                              1254
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1255
*        DCL AFVT CHAR(LENGTH(CTGFV)); /*ALTER FVT                   */
*        DCL APSWD PTR(31);            /*POINTER TO PASSWORD         */
*                                                                  1256
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT CPL AND FVT FOR ALTER INTERFACE IN ORDER TO   */
*        /*  ALTER THE NAME OF THE OBJECT.                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1257
*        CTGPLPTR = PTRCPL;            /*SET CPL BASE -DEFINE CLUSTER*/
         L     @04,PTRCPL                                          1257
         ST    @04,CTGPLPTR                                        1257
*        CTGFVPTR = CTGFVT;            /*SET FVT BASE - CLUSTER FVT  */
*                                                                  1258
         L     @04,CTGFVT(,@04)                                    1258
         ST    @04,CTGFVPTR                                        1258
*        /************************************************************/
*        /*                                                          */
*        /*  SET POINTER TO FVT. SET THE TYPE FIELD IN THE FVT,      */
*        /*  THE ENTNAME FIELD TO THE ENTNAME FPL                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1259
*        AFVTPTR = ADDR(AFVT);                                     1259
         LA    @15,AFVT                                            1259
         ST    @15,AFVTPTR                                         1259
*        AFVT = ''B;                                               1260
*                                                                  1260
         XC    AFVT(92),AFVT                                       1260
*        /************************************************************/
*        /*                                                          */
*        /*  SET TYPE FIELD                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1261
*        AFVTPTR -> CTGFVTYP = CTGFVTYP;  /*SET TYPE FIELD       */
*                                                                  1261
         MVC   CTGFVTYP(1,@15),CTGFVTYP(@04)                       1261
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE FLAG IS 'F', THEN SET THE VALUE OF THE PRESENT   */
*        /*  NAME TO BE THE NAME USED IN THE DEFINE.  OTHERWISE,     */
*        /*  SET IT TO THE DUMMY NAME.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1262
*        IF ALTERTYP = 'F'                                         1262
*          THEN                                                    1262
         L     @14,@PC00005                                        1262
         CLI   ALTERTYP(@14),C'F'                                  1262
         BNE   @RF01262                                            1262
*            AFVTPTR -> CTGFVENT = CTGFVENT;                       1263
         L     @04,CTGFVENT(,@04)                                  1263
         ST    @04,CTGFVENT(,@15)                                  1263
*          ELSE                                                    1264
*            AFVTPTR -> CTGFVENT = ADDR(DSNRETNM);                 1264
*                                                                  1264
         B     @RC01262                                            1264
@RF01262 LA    @04,DSNRETNM                                        1264
         L     @01,AFVTPTR                                         1264
         ST    @04,CTGFVENT(,@01)                                  1264
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE VALUE OF THE DDNAME IN THE FVT FOR THE ALTER    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1265
*        AFVTPTR -> CTGFVIND = ADDR(OUTDDVAL);                     1265
*                                                                  1265
@RC01262 L     @04,@PC00001+4                                      1265
         L     @04,FDTPTR+4(,@04)                                  1265
         LA    @04,OUTDDVAL(,@04)                                  1265
         L     @01,AFVTPTR                                         1265
         ST    @04,CTGFVIND(,@01)                                  1265
*        /************************************************************/
*        /*                                                          */
*        /*  SET SECURITY INFORMATION IN THE FVT FOR THE RENAME      */
*        /*  OPERATION.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1266
*        IF CTGFVSTY ^= NULLPTR                                    1266
*          THEN                                                    1266
         L     @04,CTGFVPTR                                        1266
         L     @04,CTGFVSTY(,@04)                                  1266
         LTR   @04,@04                                             1266
         BZ    @RF01266                                            1266
*            APSWD = CTGFVSTY -> CTGFLPT(1);                       1267
         L     @04,CTGFLPT(,@04)                                   1267
         ST    @04,APSWD                                           1267
*          ELSE                                                    1268
*            APSWD = CPSWD;                                        1268
*                                                                  1268
         B     @RC01266                                            1268
@RF01266 L     @04,CPSWD                                           1268
         ST    @04,APSWD                                           1268
*        /************************************************************/
*        /*                                                          */
*        /*  NOW BUILD CPL FOR THE CATALOG ALTER                     */
*        /*  IF NOT SUCCESSFUL, RETURN TO CALLING PROCESSOR          */
*        /*                                                        */
*        /************************************************************/
*                                                                  1269
*        CALL CPLPROC('A',ACPLPTR,NULLPARM,NULLPARM,NULLPARM,      1269
*           APSWD);                                                1269
*                                                                  1269
@RC01266 MVC   @AL00001(20),@AL01269                               1269
         LA    @04,ACPLPTR                                         1269
         ST    @04,@AL00001+4                                      1269
         LA    @04,APSWD                                           1269
         ST    @04,@AL00001+20                                     1269
         LA    @01,@AL00001                                        1269
         BAL   @14,CPLPROC                                         1269
*        RESPECIFY RTNREG RSTD;                                    1270
*        TESTRC = RTNREG;                                          1271
         STH   RTNREG,TESTRC                                       1271
*        RESPECIFY RTNREG UNRSTD;                                  1272
*        IF TESTRC ^= 0                                            1273
*          THEN                                                    1273
         LH    @04,TESTRC                                          1273
         LTR   @04,@04                                             1273
         BZ    @RF01273                                            1273
*            RETURN CODE(LASTCC12);                                1274
*                                                                  1274
         LA    @15,12                                              1274
         L     @14,@SA00005                                        1274
         LM    @00,@12,@SA00005+8                                  1274
         BR    @14                                                 1274
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE VALUE OF THE FVT FIELD OF THE CPL TO POINT TO   */
*        /*  THE ALTER FVT.                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1275
*        ACPLPTR -> CTGFVT = AFVTPTR;                              1275
*                                                                  1275
@RF01273 L     @04,ACPLPTR                                         1275
         L     @15,AFVTPTR                                         1275
         ST    @15,CTGFVT(,@04)                                    1275
*        /************************************************************/
*        /*                                                          */
*        /*  IF ALTERTYP IS F, THEN THE NEW NAME IS THE DUMMY        */
*        /*  NAME RETURNED BY UIOINFO.  OTHERWISE, THE NEW NAME IS   */
*        /*  THE NAME USED TO DO THE DEFINE.                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1276
*        IF ALTERTYP = 'F'                                         1276
*          THEN                                                    1276
         L     @15,@PC00005                                        1276
         CLI   ALTERTYP(@15),C'F'                                  1276
         BNE   @RF01276                                            1276
*            ACPLPTR -> CTGNEWNM = ADDR(DSNRETNM);                 1277
         LA    @15,DSNRETNM                                        1277
         ST    @15,CTGNEWNM(,@04)                                  1277
*          ELSE                                                    1278
*            ACPLPTR -> CTGNEWNM = CTGFVENT;                       1278
*                                                                  1278
         B     @RC01276                                            1278
@RF01276 L     @04,CTGFVPTR                                        1278
         L     @04,CTGFVENT(,@04)                                  1278
         L     @01,ACPLPTR                                         1278
         ST    @04,CTGNEWNM(,@01)                                  1278
*        /************************************************************/
*        /*                                                          */
*        /*  INVOKE CATALOG MANAGEMENT  TO RENAME THE OBJECT         */
*        /*  IF ALTER FAILS, RETURN TO CALLER WITH FAILURE           */
*        /*  INDICATED.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1279
*        CALL CTLGPROC(ACPLPTR);                                   1279
*                                                                  1279
@RC01276 LA    @04,ACPLPTR                                         1279
         ST    @04,@AL00001                                        1279
         LA    @01,@AL00001                                        1279
         BAL   @14,CTLGPROC                                        1279
*        RESPECIFY RTNREG RSTD;                                    1280
*        TESTRC = RTNREG;                                          1281
         STH   RTNREG,TESTRC                                       1281
*        RESPECIFY RTNREG UNRSTD;                                  1282
*        IF TESTRC ^= 0                                            1283
*          THEN                                                    1283
         LH    @04,TESTRC                                          1283
         LTR   @04,@04                                             1283
         BZ    @RF01283                                            1283
*            DO;                                                   1284
*            IF DEFSTID ^= NORMSTAT                        /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         CLI   DEFSTID,0                                           1285
         BE    @RF01285                                            1285
*                DO;                                       /*@OZ17068*/
*                DARGSENT = DEFSTID;                       /*@OZ17068*/
         IC    @04,DEFSTID                                         1287
         L     @01,DDSTRU                                          1287
         STC   @04,DARGSENT(,@01)                                  1287
*                                                          /*@OZ17068*/
*                CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);     /*@OZ17068*/
         L     @04,@PC00001                                        1288
         ST    @04,@AL00001                                        1288
         LA    @15,@CF00119                                        1288
         ST    @15,@AL00001+4                                      1288
         LA    @15,DDSTRU                                          1288
         ST    @15,@AL00001+8                                      1288
         MVI   @AL00001+8,X'80'                                    1288
         L     @15,GDTPRT(,@04)                                    1288
         LA    @01,@AL00001                                        1288
         BALR  @14,@15                                             1288
*                                                          /*@OZ17068*/
*                DEFSTID = NORMSTAT;                       /*@OZ17068*/
         MVI   DEFSTID,X'00'                                       1289
*                END;                                      /*@OZ17068*/
*              ELSE;                                       /*@OZ17068*/
@RF01285 DS    0H                                                  1292
*            DARGLIST =''B;                                /*@OZ17068*/
         L     @04,DDSTRU                                          1292
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1292
*            DARGSMOD = IMPMSG;                                    1293
         MVC   DARGSMOD(3,@04),@CC00945                            1293
*            DARGSENT = ALTFAIL;                           /*@OZ17068*/
         MVI   DARGSENT(@04),X'13'                                 1294
*                                                          /*@OZ17068*/
*            CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);         /*@OZ17068*/
*                                                                  1295
         L     @04,@PC00001                                        1295
         ST    @04,@AL00001                                        1295
         LA    @15,@CF00119                                        1295
         ST    @15,@AL00001+4                                      1295
         LA    @15,DDSTRU                                          1295
         ST    @15,@AL00001+8                                      1295
         MVI   @AL00001+8,X'80'                                    1295
         L     @15,GDTPRT(,@04)                                    1295
         LA    @01,@AL00001                                        1295
         BALR  @14,@15                                             1295
*            RETURN CODE(LASTCC12);                                1296
         LA    @15,12                                              1296
         L     @14,@SA00005                                        1296
         LM    @00,@12,@SA00005+8                                  1296
         BR    @14                                                 1296
*            END;                                                  1297
*                                                                  1297
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1298
*        RETURN CODE(0);                                           1298
@RF01283 SLR   @15,@15                                             1298
         L     @14,@SA00005                                        1298
         LM    @00,@12,@SA00005+8                                  1298
         BR    @14                                                 1298
*END ALTRPROC;                                                     1299
*          /**********************************************************/
*          /*                                                        */
*          /*  PROCEDURE NAME - UCATPROC                             */
*          /*                                                        */
*          /*  FUNCTION - READ CATALOG AND DATA RECORDS FROM THE     */
*          /*  PORTABILITY VOLUME, AND PERFORM A DEFINE OF           */
*          /*  OF A USERCATALOG POINTER AND ITS ASSOCIATED ALIASES   */
*          /*  INTO THE MASTERCATALOG.                               */
*          /*                                                        */
*          /*  INPUT - FUNCTION DEFINITION TABLE                     */
*          /*                                                        */
*          /*  OUTPUT - A RECREATED USERCATALOG POINTER AND ITS      */
*          /*  ALIASES                                               */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1300
*UCATPROC: PROCEDURE;                                              1300
*                                                                  1300
UCATPROC STM   @14,@12,@SA00006                                    1300
*          OLDERID2 = NEWERID2;                                    1301
         L     @04,@PC00001                                        1301
         L     @04,GDTTR2(,@04)                                    1301
         MVC   @TS00001(95),NEWERID2(@04)                          1301
         MVC   OLDERID2(95,@04),@TS00001                           1301
*          NEWID2 = 'RMUC';                                        1302
*                                                                  1302
         MVC   NEWID2(4,@04),@CC01411                              1302
*          /**********************************************************/
*          /*                                                        */
*          /*  SET THE ADDRESS OF THE CONTROL RECORD BUFFER WHICH    */
*          /*  WILL CONTAIN THE DICTIONARY FOR THE CATALOG RECORD    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1303
*          CONRCPTR = ADDR(CONRCARE);                              1303
*                                                                  1303
         LA    @04,CONRCARE                                        1303
         ST    @04,CONRCPTR                                        1303
*          /**********************************************************/
*          /*                                                        */
*          /*  ZERO OUT THE AREA THAT HOLDS THE CONTROL RECORDS      */
*          /*  BEGIN BY INITIALIZING THE VALUES OF ZSIZE, ZPTR,      */
*          /*  AND ZCNTRL.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1304
*          ZSIZE = LENGTH(CONRCARE);                               1304
         MVC   ZSIZE(2),@CH00920                                   1304
*          ZPTR = CONRCPTR;                                        1305
         ST    @04,ZPTR                                            1305
*          ZCNTRL = ON;                                            1306
*                                                                  1306
         OI    ZCNTRL,B'10000000'                                  1306
*          /***********************************************************
*          /*                                                         *
*          /*  LOOP CLEARING THE  AREA THAT IS TO HOLD THE CONTROL    *
*          /*  RECORD.                                                *
*          /*                                                         *
*          /***********************************************************
*                                                                  1307
*          DO WHILE (ZCNTRL = ON);                                 1307
         B     @DE01307                                            1307
@DL01307 DS    0H                                                  1308
*            IF ZSIZE > 256                                        1308
*              THEN                                                1308
         LH    @04,ZSIZE                                           1308
         LA    @15,256                                             1308
         CR    @04,@15                                             1308
         BNH   @RF01308                                            1308
*                DO;                                               1309
*                ZAREA(1:256) = ZER(1:256);                        1310
         L     @14,ZPTR                                            1310
         MVC   ZAREA(256,@14),ZER                                  1310
*                ZSIZE = ZSIZE - 256;                              1311
         SLR   @04,@15                                             1311
         STH   @04,ZSIZE                                           1311
*                ZPTR = ZPTR + 256;                                1312
         ALR   @14,@15                                             1312
         ST    @14,ZPTR                                            1312
*                END;                                              1313
*              ELSE                                                1314
*                DO;                                               1314
         B     @RC01308                                            1314
@RF01308 DS    0H                                                  1315
*                ZAREA (1:ZSIZE) = ZER(1:ZSIZE);                   1315
         L     @04,ZPTR                                            1315
         LH    @15,ZSIZE                                           1315
         BCTR  @15,0                                               1315
         EX    @15,@SM01777                                        1315
*                ZCNTRL = OFF;                                     1316
         NI    ZCNTRL,B'01111111'                                  1316
*                END;                                              1317
*          END;                                                    1318
*                                                                  1318
@RC01308 DS    0H                                                  1318
@DE01307 TM    ZCNTRL,B'10000000'                                  1318
         BO    @DL01307                                            1318
*          /**********************************************************/
*          /*                                                        */
*          /*  CONSTRUCT THE CPL TO BE USED FOR THE DEFINE FUNCTION  */
*          /*  IF THE CONSTRUCTION FAILS, RETURN TO THE CALLING      */
*          /*  PROCESSOR WITH AN ERROR INDICATOR.                    */
*          /*                                                        */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1319
*          CALL CPLPROC('F',UCPTRCPL,NULLPARM,NULLPARM,NULLPARM);  1319
*                                                                  1319
         MVC   @AL00001(20),@AL01319                               1319
         LA    @04,UCPTRCPL                                        1319
         ST    @04,@AL00001+4                                      1319
         LA    @01,@AL00001                                        1319
         BAL   @14,CPLPROC                                         1319
*          RESPECIFY RTNREG RSTD;                                  1320
*          TESTRC = RTNREG;                                        1321
         STH   RTNREG,TESTRC                                       1321
*          RESPECIFY RTNREG UNRSTD;                                1322
*          IF TESTRC ^= 0                                          1323
*            THEN                                                  1323
         LH    @04,TESTRC                                          1323
         LTR   @04,@04                                             1323
         BZ    @RF01323                                            1323
*              RETURN CODE(LASTCC12);                              1324
*                                                                  1324
         LA    @15,12                                              1324
         L     @14,@SA00006                                        1324
         LM    @00,@12,@SA00006+8                                  1324
         BR    @14                                                 1324
*          /**********************************************************/
*          /*                                                        */
*          /*  SET CTGPLPTR TO BE UCPTRCPL, SO THAT IT POINTS TO THE */
*          /*  CPL BUILT FOR THE USERCATALOG.                        */
*          /*                                                        */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1325
*          CTGPLPTR = UCPTRCPL;                                    1325
*                                                                  1325
@RF01323 L     @04,UCPTRCPL                                        1325
         ST    @04,CTGPLPTR                                        1325
*          /**********************************************************/
*          /*                                                        */
*          /*  NOW GET THE CONTROL RECORD, AND PUT IT INTO THE BUFFER*/
*          /*                                                        */
*          /**********************************************************/
*                                                                  1326
*          CALL IDCIOGT0(GDTTBL,PINIOCS);                          1326
*                                                                  1326
         L     @04,@PC00001                                        1326
         ST    @04,@AL00001                                        1326
         LA    @15,PINIOCS                                         1326
         ST    @15,@AL00001+4                                      1326
         MVI   @AL00001+4,X'80'                                    1326
         L     @15,GDTGET(,@04)                                    1326
         LA    @01,@AL00001                                        1326
         BALR  @14,@15                                             1326
*          RESPECIFY RTNREG RSTD;                                  1327
*          TESTRC = RTNREG;                                        1328
         STH   RTNREG,TESTRC                                       1328
*          RESPECIFY RTNREG UNRSTD;                                1329
*          IF TESTRC ^= 0                                          1330
*            THEN                                                  1330
         LH    @04,TESTRC                                          1330
         LTR   @04,@04                                             1330
         BZ    @RF01330                                            1330
*              RETURN CODE(LASTCC12);                              1331
*                                                                  1331
         LA    @15,12                                              1331
         L     @14,@SA00006                                        1331
         LM    @00,@12,@SA00006+8                                  1331
         BR    @14                                                 1331
*          TFVTLEN = IOCDAD -> HEADLN;                             1332
@RF01330 L     @04,IOCSPTR                                         1332
         L     @01,IOCDAD(,@04)                                    1332
         LH    @15,HEADLN(,@01)                                    1332
         STH   @15,TFVTLEN                                         1332
*          CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);                 1333
*                                                                  1333
         LA    @15,TFVTLEN                                         1333
         ST    @15,@AL00001                                        1333
         ST    @04,@AL00001+4                                      1333
         LA    @04,CONRCPTR                                        1333
         ST    @04,@AL00001+8                                      1333
         LA    @01,@AL00001                                        1333
         BAL   @14,MVDAPROC                                        1333
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST TO DETERMINE THAT WE GOT A CATALOG CONTROL RECORD*/
*          /*  IF WE DID NOT, THEN RETURN TO THE CALLING PROCESSOOR  */
*          /*  FOR THE PORTABLE DATA SET IS IN ERROR.                */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1334
*          IF HEADFLG1 ^= HDFL1CAT × (HEADFLG2 ^= HDFL2UCT)        1334
*            THEN                                                  1334
         L     @04,CONRCPTR                                        1334
         CLI   HEADFLG1(@04),X'FF'                                 1334
         BNE   @RT01334                                            1334
         CLI   HEADFLG2(@04),C'U'                                  1334
         BE    @RF01334                                            1334
@RT01334 DS    0H                                                  1335
*              DO;                                                 1335
*              DEFSTID = PORTERR;                                  1336
         MVI   DEFSTID,X'01'                                       1336
*              RETURN CODE(LASTCC12);                              1337
         LA    @15,12                                              1337
         L     @14,@SA00006                                        1337
         LM    @00,@12,@SA00006+8                                  1337
         BR    @14                                                 1337
*              END;                                                1338
*                                                                  1338
*          /**********************************************************/
*          /*                                                        */
*          /*  THE PORTABLE DATA SET IS ALL RIGHT SO FAR.  COMPUTE   */
*          /*  THE AMOUNT OF SPACE NEEDED TO HOLD THE DATA RECORD    */
*          /*  ASSOCIATED WITH THE PRESENT CONTROL RECORD.           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1339
*          TOTLEN = ASSRECLN;                                      1339
*                                                                  1339
@RF01334 L     @04,CONRCPTR                                        1339
         LH    @04,ASSRECLN(,@04)                                  1339
         ST    @04,TOTLEN                                          1339
*          /**********************************************************/
*          /*                                                        */
*          /*  ISSUE A UGPOOL TO GET THE BUFFER FOR THE DATA RECORD. */
*          /*  SHOULD THIS FAIL RETURN TO THE CALLING PROCESSOR WITH */
*          /*  AN ERROR INDICATION.                                  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1340
*          CALL IDCSAGP0(GDTTBL,TOTLEN,UCWORKAR,GPID,SETZERO);     1340
         L     @04,@PC00001                                        1340
         ST    @04,@AL00001                                        1340
         LA    @15,TOTLEN                                          1340
         ST    @15,@AL00001+4                                      1340
         LA    @15,UCWORKAR                                        1340
         ST    @15,@AL00001+8                                      1340
         LA    @15,GPID                                            1340
         ST    @15,@AL00001+12                                     1340
         LA    @15,SETZERO                                         1340
         ST    @15,@AL00001+16                                     1340
         MVI   @AL00001+16,X'80'                                   1340
         L     @15,GDTGPL(,@04)                                    1340
         LA    @01,@AL00001                                        1340
         BALR  @14,@15                                             1340
*          RESPECIFY RTNREG RSTD;                                  1341
*          TESTRC = RTNREG;                                        1342
         STH   RTNREG,TESTRC                                       1342
*          RESPECIFY RTNREG UNRSTD;                                1343
*          IF TESTRC ^= 0                                          1344
*            THEN                                                  1344
         LH    @04,TESTRC                                          1344
         LTR   @04,@04                                             1344
         BZ    @RF01344                                            1344
*              DO;                                                 1345
*              DEFSTID = NOSTORAG;                                 1346
         MVI   DEFSTID,X'04'                                       1346
*              DARGSMOD = UNIVMSG;                                 1347
         L     @04,DDSTRU                                          1347
         MVC   DARGSMOD(3,@04),@CC00981                            1347
*              RETURN CODE(LASTCC12);                              1348
         LA    @15,12                                              1348
         L     @14,@SA00006                                        1348
         LM    @00,@12,@SA00006+8                                  1348
         BR    @14                                                 1348
*              END;                                                1349
*                                                                  1349
*          /**********************************************************/
*          /*                                                        */
*          /*  GET THE DATA RECORD, USING GETPROC TO ASSEMBLE IT     */
*          /*  IN THE BUFFER.                                        */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1350
*          CALL GETPROC(UCWORKAR,ASSRECLN);                        1350
@RF01344 LA    @04,UCWORKAR                                        1350
         ST    @04,@AL00001                                        1350
         L     @04,CONRCPTR                                        1350
         LA    @04,ASSRECLN(,@04)                                  1350
         ST    @04,@AL00001+4                                      1350
         LA    @01,@AL00001                                        1350
         BAL   @14,GETPROC                                         1350
*          RESPECIFY RTNREG RSTD;                                  1351
*          TESTRC = RTNREG;                                        1352
         STH   RTNREG,TESTRC                                       1352
*          RESPECIFY RTNREG UNRSTD;                                1353
*          IF TESTRC ^= 0                                          1354
*            THEN                                                  1354
         LH    @04,TESTRC                                          1354
         LTR   @04,@04                                             1354
         BZ    @RF01354                                            1354
*              RETURN CODE(LASTCC12);                              1355
*                                                                  1355
         LA    @15,12                                              1355
         L     @14,@SA00006                                        1355
         LM    @00,@12,@SA00006+8                                  1355
         BR    @14                                                 1355
*          DICTPTR = ADDR(VARDATA);                                1356
*                                                                  1356
@RF01354 L     @04,CONRCPTR                                        1356
         LA    @04,VARDATA(,@04)                                   1356
         ST    @04,DICTPTR                                         1356
*          /**********************************************************/
*          /*                                                        */
*          /*  CALL NFVTPROC TO BUILD THE FVT TO BE USED TO DEFINE   */
*          /*  THE USERCATALOG POINTER.                              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1357
*          CALL NFVTPROC(DICTPTR,UCWORKAR,UCFVTPTR,NULLPARM);      1357
*                                                                  1357
         LA    @04,DICTPTR                                         1357
         ST    @04,@AL00001                                        1357
         LA    @04,UCWORKAR                                        1357
         ST    @04,@AL00001+4                                      1357
         LA    @04,UCFVTPTR                                        1357
         ST    @04,@AL00001+8                                      1357
         LA    @04,NULLPARM                                        1357
         ST    @04,@AL00001+12                                     1357
         LA    @01,@AL00001                                        1357
         BAL   @14,NFVTPROC                                        1357
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST THE RETURN CODE, AND RETURN TO THE CALLING       */
*          /*  PROCESSOR IF AN ERROR IS INDICATED.                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1358
*          RESPECIFY RTNREG RSTD;                                  1358
*          TESTRC = RTNREG;                                        1359
         STH   RTNREG,TESTRC                                       1359
*          RESPECIFY RTNREG UNRSTD;                                1360
*          IF TESTRC ^= 0                                          1361
*            THEN                                                  1361
         LH    @04,TESTRC                                          1361
         LTR   @04,@04                                             1361
         BZ    @RF01361                                            1361
*              RETURN CODE(LASTCC12);                              1362
*                                                                  1362
         LA    @15,12                                              1362
         L     @14,@SA00006                                        1362
         LM    @00,@12,@SA00006+8                                  1362
         BR    @14                                                 1362
*          /**********************************************************/
*          /*                                                        */
*          /*  SET CTGFVT TO POINT TO THE FVT CONSTRUCTED FOR THE    */
*          /*  USERCATALOG CONNECT.  ALSO SET CTGFVPTR TO POINT      */
*          /*  TO THE FVT.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1363
*          CTGFVT = UCFVTPTR;                                      1363
@RF01361 L     @04,UCFVTPTR                                        1363
         L     @15,CTGPLPTR                                        1363
         ST    @04,CTGFVT(,@15)                                    1363
*          CTGFVPTR = UCFVTPTR;                                    1364
*                                                                  1364
         ST    @04,CTGFVPTR                                        1364
*          /**********************************************************/
*          /*                                                        */
*          /*  SET CTGTYPE TO 'U' TO INDICATE A USERCATALOG CONNECT  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1365
*          CTGTYPE = CTGTUCAT;                                     1365
*                                                                  1365
         MVI   CTGTYPE(@15),C'U'                                   1365
*          /**********************************************************/
*          /*                                                        */
*          /*  SET CTGFVTYP TO 'A' TO INDICATE A CONNECT, AND        */
*          /*  PLACE A POINTER TO THE CPL TO THE FVT.                */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1366
*          CTGFVTYP = CTGTALIN;                                    1366
*                                                                  1366
         MVI   CTGFVTYP(@04),C'A'                                  1366
*          /**********************************************************/
*          /*                                                        */
*          /*  LOOK FOR DEVICETYPE AND VOLUMES INFORMATION FROM      */
*          /*  THE OBJECTS PARAMETER.  SCAN THE OBJECTS LIST LOOKING */
*          /*  FOR A MATCH.  WHEN FOUND,  CALL FOR THE APPROPRIATE   */
*          /*  PROCESSING.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1367
*          IF ADDR(OBJTS) ^= NULLPTR                               1367
*            THEN                                                  1367
         L     @04,@PC00001+4                                      1367
         L     @04,FDTPTR+8(,@04)                                  1367
         LTR   @04,@04                                             1367
         BZ    @RF01367                                            1367
*UCOBNTLP:     DO IX = 1 TO OBJTSCNT;                              1368
*                                                                  1368
UCOBNTLP LA    @04,1                                               1368
         B     @DE01368                                            1368
@DL01368 DS    0H                                                  1369
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR A MATCH BETWEEN OBJECT NAME, AND THE NAME*/
*              /*  OF THE OBJECT BEING DEFINED.                      */
*              /*                                                    */
*              /******************************************************/
*                                                                  1369
*                IF OBJNMPTR(IX)->OBJNMVAL(1:44) = FENTNAME(1:44)  1369
*                  THEN                                            1369
         SLA   @04,2                                               1369
         L     @15,@PC00001+4                                      1369
         L     @01,FDTPTR+12(,@15)                                 1369
         AL    @01,@CF01779                                        1369
         L     @04,OBJNMPTR(@04,@01)                               1369
         L     @01,CTGFVPTR                                        1369
         L     @01,CTGFVENT(,@01)                                  1369
         CLC   OBJNMVAL(44,@04),FENTNAME(@01)                      1369
         BNE   @RF01369                                            1369
*UCOBJMAT:           DO;                                           1370
UCOBJMAT DS    0H                                                  1371
*                    IMPF2OBJ = ON;                                1371
*                                                                  1371
         OI    IMPF2OBJ,B'00100000'                                1371
*                    /************************************************/
*                    /*                                              */
*                    /*  TEST FOR A VOLUMES LIST SPECIFICATION       */
*                    /*                                              */
*                    /************************************************/
*                                                                  1372
*                    IF LISTVPTR(IX) ^= NULLPTR ×                  1372
*                       DEVTPTR(IX) ^= NULLPTR                     1372
*                      THEN                                        1372
         SLR   @04,@04                                             1372
         L     @15,IX                                              1372
         SLA   @15,2                                               1372
         L     @14,@PC00001+4                                      1372
         L     @01,FDTPTR+24(,@14)                                 1372
         AL    @01,@CF01779                                        1372
         C     @04,LISTVPTR(@15,@01)                               1372
         BNE   @RT01372                                            1372
         L     @01,FDTPTR+32(,@14)                                 1372
         AL    @01,@CF01779                                        1372
         C     @04,DEVTPTR(@15,@01)                                1372
         BE    @RF01372                                            1372
@RT01372 DS    0H                                                  1373
*                        DO;                                       1373
*                                                                  1373
*                        /********************************************/
*                        /*                                          */
*                        /*  CALL LVLRPROC TO CONSTRUCT THE VOLUME   */
*                        /*  SERIAL LIST.                            */
*                        /*                                          */
*                        /********************************************/
*                                                                  1374
*                        CALL LVLRPROC(IX,NULLPARM,NULLPARM,UCFVTPTR,
*                           CTGTUCAT);                             1374
*                                                                  1374
         MVC   @AL00001+4(16),@AL01374                             1374
         LA    @04,IX                                              1374
         ST    @04,@AL00001                                        1374
         LA    @04,UCFVTPTR                                        1374
         ST    @04,@AL00001+12                                     1374
         LA    @01,@AL00001                                        1374
         BAL   @14,LVLRPROC                                        1374
*                        RESPECIFY RTNREG RSTD;                    1375
*                        TESTRC = RTNREG;                          1376
         STH   RTNREG,TESTRC                                       1376
*                        RESPECIFY RTNREG UNRSTD;                  1377
*                        IF TESTRC ^= 0                            1378
*                          THEN                                    1378
         LH    @04,TESTRC                                          1378
         LTR   @04,@04                                             1378
         BZ    @RF01378                                            1378
*                            RETURN CODE(LASTCC12);                1379
         LA    @15,12                                              1379
         L     @14,@SA00006                                        1379
         LM    @00,@12,@SA00006+8                                  1379
         BR    @14                                                 1379
*                        END;                                      1380
*                                                                  1380
@RF01378 DS    0H                                                  1381
*                    END UCOBJMAT;                                 1381
@RF01372 DS    0H                                                  1382
*          END UCOBNTLP;                                           1382
*                                                                  1382
@RF01369 LA    @04,1                                               1382
         AL    @04,IX                                              1382
@DE01368 ST    @04,IX                                              1382
         L     @15,@PC00001+4                                      1382
         LA    @15,FDTPTR+8(,@15)                                  1382
         C     @04,OBJTSCNT(,@15)                                  1382
         BNH   @DL01368                                            1382
*          /**********************************************************/
*          /*                                                        */
*          /*  SAVE THE CPL, FVT, AND THE FPL'S PRIOR TO INVOKING    */
*          /*  CATALOG MANAGEMENT.  IF THE USERCATALOG NAME IS A     */
*          /*  DUPLICATE, IT IS DELETED, AND REDEFINED INTO THE      */
*          /*  CATALOG.                                              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1383
*          TFVTLEN = LENGTH(CTGFV) + (LENGTH(CTGFL)+8)*NVNUMFLD +  1383
*             LENGTH(IDAAMDSB);                                    1383
@RF01367 LA    @04,380                                             1383
         STH   @04,TFVTLEN                                         1383
*          SAVCPL = UCPTRCPL -> FIELDR(1:LENGTH(CTGPL)+16);        1384
*                                                                  1384
         L     @01,UCPTRCPL                                        1384
         MVC   SAVCPL(44),FIELDR(@01)                              1384
*          /**********************************************************/
*          /*                                                        */
*          /*  POINT TO THE SAVE AREA FOR THE FVT, WHICH FOLLOWS     */
*          /*  THE AREA FOR THE FVT ITSELF.  THIS LOCATION IN CORE   */
*          /*  HOLDS THE FVT, THE FPL'S, AND THE AMDSB.              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1385
*          UCSAVFVT = UCFVTPTR + TFVTLEN;                          1385
*                                                                  1385
         AL    @04,UCFVTPTR                                        1385
         ST    @04,UCSAVFVT                                        1385
*          CALL MVDAPROC(TFVTLEN,UCFVTPTR,UCSAVFVT);               1386
*                                                                  1386
         LA    @04,TFVTLEN                                         1386
         ST    @04,@AL00001                                        1386
         LA    @04,UCFVTPTR                                        1386
         ST    @04,@AL00001+4                                      1386
         LA    @04,UCSAVFVT                                        1386
         ST    @04,@AL00001+8                                      1386
         LA    @01,@AL00001                                        1386
         BAL   @14,MVDAPROC                                        1386
*          /**********************************************************/
*          /*                                                        */
*          /*  CALL CTLGPROC TO ACTUALLY INVOKE VSAM CATALOG         */
*          /*  MANAGEMENT TO DO THE DEFINE OF THE USERCATALOG        */
*          /*  SET IMPF2NER TO BE ON TO INDICATE THAT THE PRINTING   */
*          /*  ERROR MESSAGES IS TO BE SUPPRESSED.                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1387
*          IMPF2NER = ON;                                          1387
         OI    IMPF2NER,B'00001000'                                1387
*          CALL CTLGPROC(UCPTRCPL);                                1388
         LA    @04,UCPTRCPL                                        1388
         ST    @04,@AL00001                                        1388
         LA    @01,@AL00001                                        1388
         BAL   @14,CTLGPROC                                        1388
*          RESPECIFY RTNREG RSTD;                                  1389
*          TESTRC = RTNREG;                                        1390
         STH   RTNREG,TESTRC                                       1390
*          RESPECIFY RTNREG UNRSTD;                                1391
*                                                                  1391
*          /**********************************************************/
*          /*                                                        */
*          /*  RESET IMPF2NER TO BE OFF TO INDICATE THAT ERROR       */
*          /*  MESSAGES ARE TO BE PRINTED.                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1392
*          IMPF2NER = OFF;                                         1392
*                                                                  1392
         NI    IMPF2NER,B'11110111'                                1392
*          /**********************************************************/
*          /*                                                        */
*          /*  A NON-ZERO RETURN CODE INDICATES THAT CATALOG WAS NOT */
*          /*  ABLE TO DEFINE THE USER CATALOG POINTER.              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1393
*          IF TESTRC ^= 0                                          1393
*            THEN                                                  1393
*                                                                  1393
         LH    @04,TESTRC                                          1393
         LTR   @04,@04                                             1393
         BZ    @RF01393                                            1393
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR A VSAM CATALOG RETURN CODE OF 8.  THIS   */
*              /*  INDICATES THAT THERE IS A DUPLICATE NAME IN THE   */
*              /*  IN THE CATALOG.                                   */
*              /*                                                    */
*              /******************************************************/
*                                                                  1394
*              IF CATLGRC ^= DUPNAME                               1394
*                THEN                                              1394
         CLC   CATLGRC(2),@CH00039                                 1394
         BE    @RF01394                                            1394
*                  DO;                                             1395
*                  DARGSMOD = IMPMSG;                              1396
         L     @04,DDSTRU                                          1396
         MVC   DARGSMOD(3,@04),@CC00945                            1396
*                  DARGSENT = MPRAFAIL;                            1397
         MVI   DARGSENT(@04),X'15'                                 1397
*                  DARGILP = LENGTH(FENTNAME);                     1398
         MVC   DARGILP(2,@04),@CH00605                             1398
*                  DARGDBP = UCFVTPTR -> CTGFVENT;                 1399
*                                                                  1399
         L     @01,UCFVTPTR                                        1399
         L     @15,CTGFVENT(,@01)                                  1399
         ST    @15,DARGDBP(,@04)                                   1399
*                  CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);           1400
         L     @04,@PC00001                                        1400
         ST    @04,@AL00001                                        1400
         LA    @15,@CF00119                                        1400
         ST    @15,@AL00001+4                                      1400
         LA    @15,DDSTRU                                          1400
         ST    @15,@AL00001+8                                      1400
         MVI   @AL00001+8,X'80'                                    1400
         L     @15,GDTPRT(,@04)                                    1400
         LA    @01,@AL00001                                        1400
         BALR  @14,@15                                             1400
*                  DARGLIST = ''B;                                 1401
         L     @04,DDSTRU                                          1401
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1401
*                  DARGSMOD = IMPMSG;                              1402
*                                                                  1402
         MVC   DARGSMOD(3,@04),@CC00945                            1402
*                  RETURN CODE(LASTCC08);                          1403
         LA    @15,8                                               1403
         L     @14,@SA00006                                        1403
         LM    @00,@12,@SA00006+8                                  1403
         BR    @14                                                 1403
*                  END;                                            1404
*                ELSE                                              1405
*DUPUC:            DO;                                             1405
@RF01394 DS    0H                                                  1405
DUPUC    DS    0H                                                  1406
*                  OLDERID2 = NEWERID2;                            1406
         L     @04,@PC00001                                        1406
         L     @04,GDTTR2(,@04)                                    1406
         MVC   @TS00001(95),NEWERID2(@04)                          1406
         MVC   OLDERID2(95,@04),@TS00001                           1406
*                  NEWID2 = 'RMDU';                                1407
*                                                                  1407
         MVC   NEWID2(4,@04),@CC01419                              1407
*                  /**************************************************/
*                  /*                                                */
*                  /*  AN ENTRY FOR THE OBJECT TO BE DEFINED ALREADY */
*                  /*  EXISTS IN THE CATALOG.  CALL CPLPROC TO BUILD */
*                  /*  A CPL FOR THE DELETE FUNCTION.                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1408
*                  CALL CPLPROC('D',DCPLPTR,CTGFVENT,NULLPARM,CPSWD);
*                                                                  1408
         LA    @04,@CC00751                                        1408
         ST    @04,@AL00001                                        1408
         LA    @04,DCPLPTR                                         1408
         ST    @04,@AL00001+4                                      1408
         L     @04,CTGFVPTR                                        1408
         LA    @04,CTGFVENT(,@04)                                  1408
         ST    @04,@AL00001+8                                      1408
         LA    @04,NULLPARM                                        1408
         ST    @04,@AL00001+12                                     1408
         LA    @04,CPSWD                                           1408
         ST    @04,@AL00001+16                                     1408
         LA    @01,@AL00001                                        1408
         BAL   @14,CPLPROC                                         1408
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM CPLPROC.  IF THE CPL*/
*                  /*  WAS NOT BUILT RETURN TO THE CALLING PROCESSOR.*/
*                  /*                                                */
*                  /**************************************************/
*                                                                  1409
*                  RESPECIFY RTNREG RSTD;                          1409
*                  TESTRC = RTNREG;                                1410
         STH   RTNREG,TESTRC                                       1410
*                  RESPECIFY RTNREG UNRSTD;                        1411
*                  IF TESTRC ^= 0                                  1412
*                    THEN                                          1412
         LH    @04,TESTRC                                          1412
         LTR   @04,@04                                             1412
         BZ    @RF01412                                            1412
*                      RETURN CODE(LASTCC12);                      1413
*                                                                  1413
         LA    @15,12                                              1413
         L     @14,@SA00006                                        1413
         LM    @00,@12,@SA00006+8                                  1413
         BR    @14                                                 1413
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET THE CTGTYPE FIELD OF THE CPL.             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1414
*                  DCPLPTR -> CTGTYPE = UCPTRCPL -> CTGTYPE;       1414
*                                                                  1414
@RF01412 L     @04,DCPLPTR                                         1414
         L     @01,UCPTRCPL                                        1414
         MVC   CTGTYPE(1,@04),CTGTYPE(@01)                         1414
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET CTGDISC TO ON TO INDICATE THAT THE        */
*                  /*  USER CATALOG IS TO BE DISCONNECTED.           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1415
*                  DCPLPTR -> CTGDISC = ON;                        1415
*                                                                  1415
         OI    CTGDISC(@04),B'00001000'                            1415
*                  /**************************************************/
*                  /*                                                */
*                  /*  CALL DELTPROC TO DELETE THE USERCATALOG       */
*                  /*  POINTER AND ITS ALIASES.                      */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1416
*                  CALL DELTPROC(DCPLPTR);                         1416
*                                                                  1416
         LA    @04,DCPLPTR                                         1416
         ST    @04,@AL00001                                        1416
         LA    @01,@AL00001                                        1416
         BAL   @14,DELTPROC                                        1416
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM DELTPROC.  IF IT IS */
*                  /*  NON-ZERO, RETURN TO THE CALLING PROCESSOR WITH*/
*                  /*  AN ERROR INDICATION.  OTHERWISE, RESET THE    */
*                  /*  VALUE OF DEFSTID TO NORMSTAT TO INDICATE THAT */
*                  /*  THE ERROR INCURRED ON THE FIRST CMS DEFINE    */
*                  /*  HAS BEEN CLEARED.                             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1417
*                  RESPECIFY RTNREG RSTD;                          1417
*                  TESTRC = RTNREG;                                1418
         STH   RTNREG,TESTRC                                       1418
*                  RESPECIFY RTNREG UNRSTD;                        1419
*                  IF TESTRC ^= 0                                  1420
*                    THEN                                          1420
         LH    @04,TESTRC                                          1420
         LTR   @04,@04                                             1420
         BZ    @RF01420                                            1420
*                      DO;                                         1421
*                      DARGSMOD = IMPMSG;                          1422
         L     @04,DDSTRU                                          1422
         MVC   DARGSMOD(3,@04),@CC00945                            1422
*                      DARGSENT = MPRAFAIL;                        1423
         MVI   DARGSENT(@04),X'15'                                 1423
*                      DARGILP = LENGTH(FENTNAME);                 1424
         MVC   DARGILP(2,@04),@CH00605                             1424
*                      DARGDBP = UCFVTPTR -> CTGFVENT;             1425
*                                                                  1425
         L     @01,UCFVTPTR                                        1425
         L     @15,CTGFVENT(,@01)                                  1425
         ST    @15,DARGDBP(,@04)                                   1425
*                      CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);       1426
         L     @04,@PC00001                                        1426
         ST    @04,@AL00001                                        1426
         LA    @15,@CF00119                                        1426
         ST    @15,@AL00001+4                                      1426
         LA    @15,DDSTRU                                          1426
         ST    @15,@AL00001+8                                      1426
         MVI   @AL00001+8,X'80'                                    1426
         L     @15,GDTPRT(,@04)                                    1426
         LA    @01,@AL00001                                        1426
         BALR  @14,@15                                             1426
*                      DARGLIST = ''B;                             1427
         L     @04,DDSTRU                                          1427
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1427
*                      DARGSMOD = IMPMSG;                          1428
*                                                                  1428
         MVC   DARGSMOD(3,@04),@CC00945                            1428
*                      RETURN CODE(LASTCC08);                      1429
         LA    @15,8                                               1429
         L     @14,@SA00006                                        1429
         LM    @00,@12,@SA00006+8                                  1429
         BR    @14                                                 1429
*                      END;                                        1430
*                                                                  1430
*                  DEFSTID = NORMSTAT;                             1431
*                                                                  1431
@RF01420 MVI   DEFSTID,X'00'                                       1431
*                  /**************************************************/
*                  /*                                                */
*                  /*  PRINT A MESSAGE FOR THE USER INDICATING THAT  */
*                  /*  A USER CATALOG HAS BEEN DISCONNECTED.         */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1432
*                  DARGSMOD = IMPMSG;                              1432
         L     @04,DDSTRU                                          1432
         MVC   DARGSMOD(3,@04),@CC00945                            1432
*                  DARGSENT = CATDISC;                             1433
         MVI   DARGSENT(@04),X'16'                                 1433
*                  DARGILP = LENGTH(FENTNAME);                     1434
         MVC   DARGILP(2,@04),@CH00605                             1434
*                  DARGDBP = UCFVTPTR -> CTGFVENT;                 1435
*                                                                  1435
         L     @01,UCFVTPTR                                        1435
         L     @15,CTGFVENT(,@01)                                  1435
         ST    @15,DARGDBP(,@04)                                   1435
*                  CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);           1436
*                                                                  1436
         L     @04,@PC00001                                        1436
         ST    @04,@AL00001                                        1436
         LA    @15,@CF00119                                        1436
         ST    @15,@AL00001+4                                      1436
         LA    @15,DDSTRU                                          1436
         ST    @15,@AL00001+8                                      1436
         MVI   @AL00001+8,X'80'                                    1436
         L     @15,GDTPRT(,@04)                                    1436
         LA    @01,@AL00001                                        1436
         BALR  @14,@15                                             1436
*                  DARGLIST = ''B;                                 1437
*                                                                  1437
         L     @04,DDSTRU                                          1437
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1437
*                  /**************************************************/
*                  /*                                                */
*                  /*  RESTORE THE CATALOG PARAMETER LISTS TO THEIR  */
*                  /*  STATE PRIOR TO THE FIRST CMS DEFINE OPERATION.*/
*                  /*                                                */
*                  /**************************************************/
*                                                                  1438
*                  UCPTRCPL->FIELDR(1:LENGTH(CTGPL)+16) = SAVCPL;  1438
         L     @04,UCPTRCPL                                        1438
         MVC   FIELDR(44,@04),SAVCPL                               1438
*                  CALL MVDAPROC(TFVTLEN,UCSAVFVT,UCFVTPTR);       1439
*                                                                  1439
         LA    @04,TFVTLEN                                         1439
         ST    @04,@AL00001                                        1439
         LA    @04,UCSAVFVT                                        1439
         ST    @04,@AL00001+4                                      1439
         LA    @04,UCFVTPTR                                        1439
         ST    @04,@AL00001+8                                      1439
         LA    @01,@AL00001                                        1439
         BAL   @14,MVDAPROC                                        1439
*                  /**************************************************/
*                  /*                                                */
*                  /*  RESTORE THE VOLUME LIST.                      */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1440
*                  DO J =1 TO (FLISTLN/LENGTH(FVOLSERL));          1440
         LA    @04,1                                               1440
         B     @DE01440                                            1440
@DL01440 DS    0H                                                  1441
*                    FVOLRTN(J) = 0;                               1441
         LR    @15,@04                                             1441
         SLA   @15,3                                               1441
         L     @01,CTGFVPTR                                        1441
         L     @01,CTGFVVLT(,@01)                                  1441
         ALR   @01,@15                                             1441
         AL    @01,@CF01786                                        1441
         SLR   @00,@00                                             1441
         STCM  @00,3,FVOLRTN-2(@01)                                1441
*                  END;                                            1442
*                                                                  1442
         AL    @04,@CF00221                                        1442
@DE01440 ST    @04,J                                               1442
         L     @01,CTGFVPTR                                        1442
         L     @01,CTGFVVLT(,@01)                                  1442
         LH    @00,FLISTLN(,@01)                                   1442
         SRDA  @00,32                                              1442
         D     @00,@CF00039                                        1442
         CR    @04,@01                                             1442
         BNH   @DL01440                                            1442
*                  /**************************************************/
*                  /*                                                */
*                  /*  POINT TO THE CPL, AND CALL CTLGPROC TO INVOKE */
*                  /*  CATALOG MANAGEMENT.                           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1443
*                  CALL CTLGPROC(UCPTRCPL);                        1443
*                                                                  1443
         LA    @04,UCPTRCPL                                        1443
         ST    @04,@AL00001                                        1443
         LA    @01,@AL00001                                        1443
         BAL   @14,CTLGPROC                                        1443
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM CTLGPROC.  IF IT IS */
*                  /*  NON-ZERO, THE SECOND ATTEMPT TO DEFINE THE    */
*                  /*  OBJECT HAS ALSO FAILED.  RETURN TO THE CALLING*/
*                  /*  PROCESSOR WITH AN ERROR INDICATION.           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1444
*                  RESPECIFY RTNREG RSTD;                          1444
*                  TESTRC = RTNREG;                                1445
         STH   RTNREG,TESTRC                                       1445
*                  RESPECIFY RTNREG UNRSTD;                        1446
*                  IF TESTRC ^= 0                                  1447
*                    THEN                                          1447
         LH    @04,TESTRC                                          1447
         LTR   @04,@04                                             1447
         BZ    @RF01447                                            1447
*                      DO;                                         1448
*                      DARGSMOD = IMPMSG;                          1449
         L     @04,DDSTRU                                          1449
         MVC   DARGSMOD(3,@04),@CC00945                            1449
*                      DARGSENT = MPRAFAIL;                        1450
         MVI   DARGSENT(@04),X'15'                                 1450
*                      DARGILP = LENGTH(FENTNAME);                 1451
         MVC   DARGILP(2,@04),@CH00605                             1451
*                      DARGDBP = UCFVTPTR -> CTGFVENT;             1452
*                                                                  1452
         L     @01,UCFVTPTR                                        1452
         L     @15,CTGFVENT(,@01)                                  1452
         ST    @15,DARGDBP(,@04)                                   1452
*                      CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);       1453
         L     @04,@PC00001                                        1453
         ST    @04,@AL00001                                        1453
         LA    @15,@CF00119                                        1453
         ST    @15,@AL00001+4                                      1453
         LA    @15,DDSTRU                                          1453
         ST    @15,@AL00001+8                                      1453
         MVI   @AL00001+8,X'80'                                    1453
         L     @15,GDTPRT(,@04)                                    1453
         LA    @01,@AL00001                                        1453
         BALR  @14,@15                                             1453
*                      DARGLIST = ''B;                             1454
         L     @04,DDSTRU                                          1454
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1454
*                      DARGSMOD = IMPMSG;                          1455
*                                                                  1455
         MVC   DARGSMOD(3,@04),@CC00945                            1455
*                      RETURN CODE(LASTCC08);                      1456
         LA    @15,8                                               1456
         L     @14,@SA00006                                        1456
         LM    @00,@12,@SA00006+8                                  1456
         BR    @14                                                 1456
*                      END;                                        1457
*                                                                  1457
*                  END DUPUC;                                      1458
*                                                                  1458
@RF01447 DS    0H                                                  1459
*        /************************************************************/
*        /*                                                          */
*        /*  SAVE THE NAME OF THE OBJECT JUST DEFINED FOR USE        */
*        /*  IN DEFINING ALIASES.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1459
*        SAVRELNM = UCFVTPTR->CTGFVENT->FENTNAME;                  1459
*                                                                  1459
@RF01393 L     @04,UCFVTPTR                                        1459
         L     @04,CTGFVENT(,@04)                                  1459
         MVC   SAVRELNM(44),FENTNAME(@04)                          1459
*        /************************************************************/
*        /*                                                          */
*        /*  PRINT A MESSAGE TO INDICATE WHAT HAS BEEN IMPORTED      */
*        /*  SUCCESSFULLY.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1460
*        DARGSMOD = IMPMSG;                                        1460
         L     @15,DDSTRU                                          1460
         MVC   DARGSMOD(3,@15),@CC00945                            1460
*        DARGSENT = MPRASUCC;                                      1461
         MVI   DARGSENT(@15),X'1A'                                 1461
*        DARGILP = LENGTH(FENTNAME);                               1462
         MVC   DARGILP(2,@15),@CH00605                             1462
*        DARGDBP = UCFVTPTR -> CTGFVENT;                           1463
         ST    @04,DARGDBP(,@15)                                   1463
*        CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                     1464
         L     @04,@PC00001                                        1464
         ST    @04,@AL00001                                        1464
         LA    @15,@CF00119                                        1464
         ST    @15,@AL00001+4                                      1464
         LA    @15,DDSTRU                                          1464
         ST    @15,@AL00001+8                                      1464
         MVI   @AL00001+8,X'80'                                    1464
         L     @15,GDTPRT(,@04)                                    1464
         LA    @01,@AL00001                                        1464
         BALR  @14,@15                                             1464
*        DARGLIST = ''B;                                           1465
         L     @04,DDSTRU                                          1465
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1465
*        DARGSMOD = IMPMSG;                                        1466
*                                                                  1466
         MVC   DARGSMOD(3,@04),@CC00945                            1466
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE DATA RECORD BUFFER      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1467
*        CALL IDCSAFS0(GDTTBL,UCWORKAR);                           1467
*                                                                  1467
         L     @04,@PC00001                                        1467
         ST    @04,@AL00001                                        1467
         LA    @15,UCWORKAR                                        1467
         ST    @15,@AL00001+4                                      1467
         L     @15,GDTFSP(,@04)                                    1467
         LA    @01,@AL00001                                        1467
         BALR  @14,@15                                             1467
*        RESPECIFY RTNREG RSTD;                                    1468
*        TESTRC = RTNREG;                                          1469
         STH   RTNREG,TESTRC                                       1469
*        RESPECIFY RTNREG UNRSTD;                                  1470
*        IF TESTRC ^= 0                                            1471
*          THEN                                                    1471
         LH    @04,TESTRC                                          1471
         LTR   @04,@04                                             1471
         BZ    @RF01471                                            1471
*            RETURN CODE(LASTCC12);                                1472
*                                                                  1472
         LA    @15,12                                              1472
         L     @14,@SA00006                                        1472
         LM    @00,@12,@SA00006+8                                  1472
         BR    @14                                                 1472
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE FVT AND FPL'S FOR       */
*        /*  THE USER CATALOG CONNECT.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1473
*        CALL IDCSAFS0(GDTTBL,UCFVTPTR);                           1473
*                                                                  1473
@RF01471 L     @04,@PC00001                                        1473
         ST    @04,@AL00001                                        1473
         LA    @15,UCFVTPTR                                        1473
         ST    @15,@AL00001+4                                      1473
         L     @15,GDTFSP(,@04)                                    1473
         LA    @01,@AL00001                                        1473
         BALR  @14,@15                                             1473
*        RESPECIFY RTNREG RSTD;                                    1474
*        TESTRC = RTNREG;                                          1475
         STH   RTNREG,TESTRC                                       1475
*        RESPECIFY RTNREG UNRSTD;                                  1476
*        IF TESTRC ^= 0                                            1477
*          THEN                                                    1477
         LH    @04,TESTRC                                          1477
         LTR   @04,@04                                             1477
         BZ    @RF01477                                            1477
*            RETURN CODE(LASTCC12);                                1478
*                                                                  1478
         LA    @15,12                                              1478
         L     @14,@SA00006                                        1478
         LM    @00,@12,@SA00006+8                                  1478
         BR    @14                                                 1478
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE CPL USED TO DEFINE      */
*        /*  THE OBJECT.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1479
*        CALL IDCSAFS0(GDTTBL,UCPTRCPL);                           1479
*                                                                  1479
@RF01477 L     @04,@PC00001                                        1479
         ST    @04,@AL00001                                        1479
         LA    @15,UCPTRCPL                                        1479
         ST    @15,@AL00001+4                                      1479
         L     @15,GDTFSP(,@04)                                    1479
         LA    @01,@AL00001                                        1479
         BALR  @14,@15                                             1479
*        RESPECIFY RTNREG RSTD;                                    1480
*        TESTRC = RTNREG;                                          1481
         STH   RTNREG,TESTRC                                       1481
*        RESPECIFY RTNREG UNRSTD;                                  1482
*        IF TESTRC ^= 0                                            1483
*          THEN                                                    1483
         LH    @04,TESTRC                                          1483
         LTR   @04,@04                                             1483
         BZ    @RF01483                                            1483
*            RETURN CODE(LASTCC12);                                1484
         LA    @15,12                                              1484
         L     @14,@SA00006                                        1484
         LM    @00,@12,@SA00006+8                                  1484
         BR    @14                                                 1484
*          /**********************************************************/
*          /*                                                        */
*          /*  THE ALIASES OF THE USERCATALOG POINTER THAT WERE PUT  */
*          /*  ON THE PORTABLE DATA SET BY EXPORTRA MUST NOW BE      */
*          /*  DEFINED IN THE CATALOG (IN VS2) OR HANDLED AS         */
*          /*  AS UNDEFINABLE (IN DOS OR VS1).  TO DO THIS, WE LOOP  */
*          /*  UNTIL A SOFTWARE END OF FILE IS FOUND, DEFINING       */
*          /*  ALIASES OR PRINTING ERROR MESSAGES.                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1485
*          /**********************************************************/
*          /*                                                        */
*          /*  SET GETEOF TO OFF TO INDICATE THAT THE END OF FILE    */
*          /*  HAS NOT BEEN FOUND.                                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1485
*          GETEOF = OFF;                                           1485
*                                                                  1485
@RF01483 NI    GETEOF,B'01111111'                                  1485
*          /**********************************************************/
*          /*                                                        */
*          /*  LOOP UNTIL AN END OF FILE IS FOUND,                   */
*          /*  CALLING ALISPROC.                                     */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1486
*          DO WHILE GETEOF = OFF;                                  1486
*                                                                  1486
         B     @DE01486                                            1486
@DL01486 DS    0H                                                  1487
*            CALL ALISPROC(ADDR(SAVRELNM));                        1487
         LA    @04,SAVRELNM                                        1487
         ST    @04,@AFTEMPS+4                                      1487
         LA    @04,@AFTEMPS+4                                      1487
         ST    @04,@AL00001                                        1487
         LA    @01,@AL00001                                        1487
         BAL   @14,ALISPROC                                        1487
*            RESPECIFY RTNREG RSTD;                                1488
*            TESTRC = RTNREG;                                      1489
         STH   RTNREG,TESTRC                                       1489
*            RESPECIFY RTNREG UNRSTD;                              1490
*                                                                  1490
*            /****************************************************/
*            /*                                                  */
*            /*  IF THE RETURN CODE INDICATES A SEVERE ERROR     */
*            /*  PASS THAT BACK TO THE CALLING PROCESSOR.        */
*            /*  OTHERWISE, CONTINUE WITH A VALUE OF 8 IN SETRC. */
*            /*                                                  */
*            /****************************************************/
*                                                                  1491
*            IF TESTRC = LASTCC12                                  1491
*              THEN                                                1491
         LH    @04,TESTRC                                          1491
         LA    @15,12                                              1491
         CR    @04,@15                                             1491
         BNE   @RF01491                                            1491
*                RETURN CODE(LASTCC12);                            1492
         L     @14,@SA00006                                        1492
         LM    @00,@12,@SA00006+8                                  1492
         BR    @14                                                 1492
*              ELSE                                                1493
*                IF TESTRC ^= 0                                    1493
*                  THEN                                            1493
@RF01491 LH    @04,TESTRC                                          1493
         LTR   @04,@04                                             1493
         BZ    @RF01493                                            1493
*                    SETRC = LASTCC08;                             1494
         MVC   SETRC(2),@CH00039                                   1494
*          END;                                                    1495
*                                                                  1495
@RF01493 DS    0H                                                  1495
@DE01486 TM    GETEOF,B'10000000'                                  1495
         BZ    @DL01486                                            1495
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLING PROCESSOR WITH SUCCESS INDICATED  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1496
*        RETURN CODE(0);                                           1496
*                                                                  1496
*                                                                  1496
         SLR   @15,@15                                             1496
         L     @14,@SA00006                                        1496
         LM    @00,@12,@SA00006+8                                  1496
         BR    @14                                                 1496
*END UCATPROC;                                                     1497
*          /**********************************************************/
*          /*                                                        */
*          /*  PROCEDURE NAME - NVSMPROC                             */
*          /*                                                        */
*          /*  FUNCTION - READ CATALOG AND DATA RECORDS FROM THE     */
*          /*  PORTABILITY VOLUME, AND PERFORM A DEFINE OF           */
*          /*  OF A NONVSAM ENTRY AND ITS ASSOCIATED ALIASES         */
*          /*                                                        */
*          /*  INPUT - FUNCTION DEFINITION TABLE                     */
*          /*                                                        */
*          /*  OUTPUT - A RECREATED NONVSAM ENTRY AND ITS            */
*          /*  ALIASES                                               */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1498
*NVSMPROC: PROCEDURE;                                              1498
*                                                                  1498
NVSMPROC STM   @14,@12,@SA00007                                    1498
*          OLDERID2 = NEWERID2;                                    1499
         L     @04,@PC00001                                        1499
         L     @04,GDTTR2(,@04)                                    1499
         MVC   @TS00001(95),NEWERID2(@04)                          1499
         MVC   OLDERID2(95,@04),@TS00001                           1499
*          NEWID2 = 'RMNV';                                        1500
*                                                                  1500
         MVC   NEWID2(4,@04),@CC01424                              1500
*          /**********************************************************/
*          /*                                                        */
*          /*  SET THE ADDRESS OF THE CONTROL RECORD BUFFER WHICH    */
*          /*  WILL CONTAIN THE DICTIONARY FOR THE CATALOG RECORD    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1501
*          CONRCPTR = ADDR(CONRCARE);                              1501
*                                                                  1501
         LA    @04,CONRCARE                                        1501
         ST    @04,CONRCPTR                                        1501
*          /**********************************************************/
*          /*                                                        */
*          /*  ZERO OUT THE AREA THAT HOLDS THE CONTROL RECORDS      */
*          /*  BEGIN BY INITIALIZING THE VALUES OF ZSIZE, ZPTR,      */
*          /*  AND ZCNTRL.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1502
*          ZSIZE = LENGTH(CONRCARE);                               1502
         MVC   ZSIZE(2),@CH00920                                   1502
*          ZPTR = CONRCPTR;                                        1503
         ST    @04,ZPTR                                            1503
*          ZCNTRL = ON;                                            1504
*                                                                  1504
         OI    ZCNTRL,B'10000000'                                  1504
*          /***********************************************************
*          /*                                                         *
*          /*  LOOP CLEARING THE  AREA THAT IS TO HOLD THE CONTROL    *
*          /*  RECORD.                                                *
*          /*                                                         *
*          /***********************************************************
*                                                                  1505
*          DO WHILE (ZCNTRL = ON);                                 1505
         B     @DE01505                                            1505
@DL01505 DS    0H                                                  1506
*            IF ZSIZE > 256                                        1506
*              THEN                                                1506
         LH    @04,ZSIZE                                           1506
         LA    @15,256                                             1506
         CR    @04,@15                                             1506
         BNH   @RF01506                                            1506
*                DO;                                               1507
*                ZAREA(1:256) = ZER(1:256);                        1508
         L     @14,ZPTR                                            1508
         MVC   ZAREA(256,@14),ZER                                  1508
*                ZSIZE = ZSIZE - 256;                              1509
         SLR   @04,@15                                             1509
         STH   @04,ZSIZE                                           1509
*                ZPTR = ZPTR + 256;                                1510
         ALR   @14,@15                                             1510
         ST    @14,ZPTR                                            1510
*                END;                                              1511
*              ELSE                                                1512
*                DO;                                               1512
         B     @RC01506                                            1512
@RF01506 DS    0H                                                  1513
*                ZAREA (1:ZSIZE) = ZER(1:ZSIZE);                   1513
         L     @04,ZPTR                                            1513
         LH    @15,ZSIZE                                           1513
         BCTR  @15,0                                               1513
         EX    @15,@SM01777                                        1513
*                ZCNTRL = OFF;                                     1514
         NI    ZCNTRL,B'01111111'                                  1514
*                END;                                              1515
*          END;                                                    1516
*                                                                  1516
@RC01506 DS    0H                                                  1516
@DE01505 TM    ZCNTRL,B'10000000'                                  1516
         BO    @DL01505                                            1516
*          /**********************************************************/
*          /*                                                        */
*          /*  CONSTRUCT THE CPL TO BE USED FOR THE DEFINE FUNCTION  */
*          /*  IF THE CONSTRUCTION FAILS, RETURN TO THE CALLING      */
*          /*  PROCESSOR WITH AN ERROR INDICATOR.                    */
*          /*                                                        */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1517
*          CALL CPLPROC('F',NVPTRCPL,NULLPARM,NULLPARM,NULLPARM);  1517
*                                                                  1517
         MVC   @AL00001(20),@AL01517                               1517
         LA    @04,NVPTRCPL                                        1517
         ST    @04,@AL00001+4                                      1517
         LA    @01,@AL00001                                        1517
         BAL   @14,CPLPROC                                         1517
*          RESPECIFY RTNREG RSTD;                                  1518
*          TESTRC = RTNREG;                                        1519
         STH   RTNREG,TESTRC                                       1519
*          RESPECIFY RTNREG UNRSTD;                                1520
*          IF TESTRC ^= 0                                          1521
*            THEN                                                  1521
         LH    @04,TESTRC                                          1521
         LTR   @04,@04                                             1521
         BZ    @RF01521                                            1521
*              RETURN CODE(LASTCC12);                              1522
*                                                                  1522
         LA    @15,12                                              1522
         L     @14,@SA00007                                        1522
         LM    @00,@12,@SA00007+8                                  1522
         BR    @14                                                 1522
*          /**********************************************************/
*          /*                                                        */
*          /*  SET CTGPLPTR TO BE NVPTRCPL, SO THAT IT POINTS TO THE */
*          /*  CPL BUILT FOR THE NONVSAM.                            */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1523
*          CTGPLPTR = NVPTRCPL;                                    1523
*                                                                  1523
@RF01521 L     @04,NVPTRCPL                                        1523
         ST    @04,CTGPLPTR                                        1523
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST TO DETERMINE IF A CONTROL RECORD IS TO BE READ.  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1524
*          IF NVSMRDSW = OFF                                       1524
*            THEN                                                  1524
         TM    NVSMRDSW,B'10000000'                                1524
         BNZ   @RF01524                                            1524
*CONTREAD:     DO;                                                 1525
*                                                                  1525
CONTREAD DS    0H                                                  1526
*              /******************************************************/
*              /*                                                    */
*              /*  GET THE CONTROL RECORD FROM THE PORTABLE          */
*              /*  DATA SET.                                         */
*              /*                                                    */
*              /******************************************************/
*                                                                  1526
*              CALL IDCIOGT0(GDTTBL,PINIOCS);                      1526
*                                                                  1526
         L     @04,@PC00001                                        1526
         ST    @04,@AL00001                                        1526
         LA    @15,PINIOCS                                         1526
         ST    @15,@AL00001+4                                      1526
         MVI   @AL00001+4,X'80'                                    1526
         L     @15,GDTGET(,@04)                                    1526
         LA    @01,@AL00001                                        1526
         BALR  @14,@15                                             1526
*              RESPECIFY RTNREG RSTD;                              1527
*              TESTRC = RTNREG;                                    1528
         STH   RTNREG,TESTRC                                       1528
*              RESPECIFY RTNREG UNRSTD;                            1529
*                                                                  1529
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR A RETURN CODE THAT INDICATES THAT WE     */
*              /*  HAVE FOUND AN END OF FILE.  IF UGET GIVES US THIS */
*              /*  RETURN CODE, RETURN TO THE CALLING PROCESSOR WITH */
*              /*  SUCCESS INDICATED.  IF ANY OTHER NONZERO CODE IS  */
*              /*  RETURNED, RETURN TO THE CALLER WITH A SEVERE ERROR*/
*              /*  INDICATED.                                        */
*              /*                                                    */
*              /******************************************************/
*                                                                  1530
*              IF TESTRC = 16                                      1530
*                THEN                                              1530
         LH    @04,TESTRC                                          1530
         C     @04,@CF00483                                        1530
         BNE   @RF01530                                            1530
*                  DO;                                             1531
*                                                                  1531
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET GETEOF TO ON TO INDICATE TO THE CALLER    */
*                  /*  THAT AN END OF FILE HAS BEEN FOUND.           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1532
*                  GETEOF = ON;                                    1532
         OI    GETEOF,B'10000000'                                  1532
*                  RETURN CODE(0);                                 1533
         SLR   @15,@15                                             1533
         L     @14,@SA00007                                        1533
         LM    @00,@12,@SA00007+8                                  1533
         BR    @14                                                 1533
*                  END;                                            1534
*                ELSE                                              1535
*                  IF TESTRC ^= 0                                  1535
*                    THEN                                          1535
@RF01530 LH    @04,TESTRC                                          1535
         LTR   @04,@04                                             1535
         BZ    @RF01535                                            1535
*                      RETURN CODE(LASTCC12);                      1536
         LA    @15,12                                              1536
         L     @14,@SA00007                                        1536
         LM    @00,@12,@SA00007+8                                  1536
         BR    @14                                                 1536
*              END CONTREAD;                                       1537
*                                                                  1537
@RF01535 DS    0H                                                  1538
*          /**********************************************************/
*          /*                                                        */
*          /*  RESET NVSMRDSW TO BE OFF.                             */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1538
*          NVSMRDSW = OFF;                                         1538
*                                                                  1538
@RF01524 NI    NVSMRDSW,B'01111111'                                1538
*          /**********************************************************/
*          /*                                                        */
*          /*  MOVE THE CONTROL RECORD FROM THE I/O BUFFER INTO      */
*          /*  THE AREA OF STORAGE THAT IS MAPPED BY THE CONTROL     */
*          /*  RECORD OVERLAY.                                       */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1539
*          TFVTLEN = IOCDAD -> HEADLN;                             1539
         L     @04,IOCSPTR                                         1539
         L     @01,IOCDAD(,@04)                                    1539
         LH    @15,HEADLN(,@01)                                    1539
         STH   @15,TFVTLEN                                         1539
*          CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);                 1540
*                                                                  1540
         LA    @15,TFVTLEN                                         1540
         ST    @15,@AL00001                                        1540
         ST    @04,@AL00001+4                                      1540
         LA    @04,CONRCPTR                                        1540
         ST    @04,@AL00001+8                                      1540
         LA    @01,@AL00001                                        1540
         BAL   @14,MVDAPROC                                        1540
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST TO DETERMINE THAT WE GOT A CATALOG CONTROL RECORD*/
*          /*  IF WE DID NOT, THEN RETURN TO THE CALLING PROCESSOOR  */
*          /*  FOR THE PORTABLE DATA SET IS IN ERROR.                */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1541
*          IF HEADFLG1 ^= HDFL1CAT × HEADFLG2 ^= HDFL2NVS          1541
*            THEN                                                  1541
         L     @04,CONRCPTR                                        1541
         CLI   HEADFLG1(@04),X'FF'                                 1541
         BNE   @RT01541                                            1541
         CLI   HEADFLG2(@04),C'A'                                  1541
         BE    @RF01541                                            1541
@RT01541 DS    0H                                                  1542
*              DO;                                                 1542
*              DEFSTID = PORTERR;                                  1543
         MVI   DEFSTID,X'01'                                       1543
*              RETURN CODE(LASTCC12);                              1544
         LA    @15,12                                              1544
         L     @14,@SA00007                                        1544
         LM    @00,@12,@SA00007+8                                  1544
         BR    @14                                                 1544
*              END;                                                1545
*                                                                  1545
*          /**********************************************************/
*          /*                                                        */
*          /*  THE PORTABLE DATA SET IS ALL RIGHT SO FAR.  COMPUTE   */
*          /*  THE AMOUNT OF SPACE NEEDED TO HOLD THE DATA RECORD    */
*          /*  ASSOCIATED WITH THE PRESENT CONTROL RECORD.           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1546
*          TOTLEN = ASSRECLN;                                      1546
*                                                                  1546
@RF01541 L     @04,CONRCPTR                                        1546
         LH    @04,ASSRECLN(,@04)                                  1546
         ST    @04,TOTLEN                                          1546
*          /**********************************************************/
*          /*                                                        */
*          /*  ISSUE A UGPOOL TO GET THE BUFFER FOR THE DATA RECORD. */
*          /*  SHOULD THIS FAIL RETURN TO THE CALLING PROCESSOR WITH */
*          /*  AN ERROR INDICATION.                                  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1547
*          CALL IDCSAGP0(GDTTBL,TOTLEN,NVWORKAR,GPID,SETZERO);     1547
         L     @04,@PC00001                                        1547
         ST    @04,@AL00001                                        1547
         LA    @15,TOTLEN                                          1547
         ST    @15,@AL00001+4                                      1547
         LA    @15,NVWORKAR                                        1547
         ST    @15,@AL00001+8                                      1547
         LA    @15,GPID                                            1547
         ST    @15,@AL00001+12                                     1547
         LA    @15,SETZERO                                         1547
         ST    @15,@AL00001+16                                     1547
         MVI   @AL00001+16,X'80'                                   1547
         L     @15,GDTGPL(,@04)                                    1547
         LA    @01,@AL00001                                        1547
         BALR  @14,@15                                             1547
*          RESPECIFY RTNREG RSTD;                                  1548
*          TESTRC = RTNREG;                                        1549
         STH   RTNREG,TESTRC                                       1549
*          RESPECIFY RTNREG UNRSTD;                                1550
*          IF TESTRC ^= 0                                          1551
*            THEN                                                  1551
         LH    @04,TESTRC                                          1551
         LTR   @04,@04                                             1551
         BZ    @RF01551                                            1551
*              DO;                                                 1552
*              DEFSTID = NOSTORAG;                                 1553
         MVI   DEFSTID,X'04'                                       1553
*              DARGSMOD = UNIVMSG;                                 1554
         L     @04,DDSTRU                                          1554
         MVC   DARGSMOD(3,@04),@CC00981                            1554
*              RETURN CODE(LASTCC12);                              1555
         LA    @15,12                                              1555
         L     @14,@SA00007                                        1555
         LM    @00,@12,@SA00007+8                                  1555
         BR    @14                                                 1555
*              END;                                                1556
*                                                                  1556
*          /**********************************************************/
*          /*                                                        */
*          /*  GET THE DATA RECORD, USING GETPROC TO ASSEMBLE IT     */
*          /*  IN THE BUFFER.                                        */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1557
*          CALL GETPROC(NVWORKAR,ASSRECLN);                        1557
@RF01551 LA    @04,NVWORKAR                                        1557
         ST    @04,@AL00001                                        1557
         L     @04,CONRCPTR                                        1557
         LA    @04,ASSRECLN(,@04)                                  1557
         ST    @04,@AL00001+4                                      1557
         LA    @01,@AL00001                                        1557
         BAL   @14,GETPROC                                         1557
*          RESPECIFY RTNREG RSTD;                                  1558
*          TESTRC = RTNREG;                                        1559
         STH   RTNREG,TESTRC                                       1559
*          RESPECIFY RTNREG UNRSTD;                                1560
*          IF TESTRC ^= 0                                          1561
*            THEN                                                  1561
         LH    @04,TESTRC                                          1561
         LTR   @04,@04                                             1561
         BZ    @RF01561                                            1561
*              RETURN CODE(LASTCC12);                              1562
*                                                                  1562
         LA    @15,12                                              1562
         L     @14,@SA00007                                        1562
         LM    @00,@12,@SA00007+8                                  1562
         BR    @14                                                 1562
*          DICTPTR = ADDR(VARDATA);                                1563
*                                                                  1563
@RF01561 L     @04,CONRCPTR                                        1563
         LA    @04,VARDATA(,@04)                                   1563
         ST    @04,DICTPTR                                         1563
*          /**********************************************************/
*          /*                                                        */
*          /*  CALL NFVTPROC TO BUILD THE FVT TO BE USED TO DEFINE   */
*          /*  THE NONVSAM ENTRY.                                    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1564
*          CALL NFVTPROC(DICTPTR,NVWORKAR,NVFVTPTR,NULLPARM);      1564
*                                                                  1564
         LA    @04,DICTPTR                                         1564
         ST    @04,@AL00001                                        1564
         LA    @04,NVWORKAR                                        1564
         ST    @04,@AL00001+4                                      1564
         LA    @04,NVFVTPTR                                        1564
         ST    @04,@AL00001+8                                      1564
         LA    @04,NULLPARM                                        1564
         ST    @04,@AL00001+12                                     1564
         LA    @01,@AL00001                                        1564
         BAL   @14,NFVTPROC                                        1564
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST THE RETURN, AND RETURN TO THE CALLING            */
*          /*  PROCESSOR IF AN ERROR IS INDICATED.                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1565
*          RESPECIFY RTNREG RSTD;                                  1565
*          TESTRC = RTNREG;                                        1566
         STH   RTNREG,TESTRC                                       1566
*          RESPECIFY RTNREG UNRSTD;                                1567
*          IF TESTRC ^= 0                                          1568
*            THEN                                                  1568
         LH    @04,TESTRC                                          1568
         LTR   @04,@04                                             1568
         BZ    @RF01568                                            1568
*              RETURN CODE(LASTCC12);                              1569
*                                                                  1569
         LA    @15,12                                              1569
         L     @14,@SA00007                                        1569
         LM    @00,@12,@SA00007+8                                  1569
         BR    @14                                                 1569
*          CTGFVT = NVFVTPTR;                                      1570
*                                                                  1570
@RF01568 L     @04,NVFVTPTR                                        1570
         L     @01,CTGPLPTR                                        1570
         ST    @04,CTGFVT(,@01)                                    1570
*          /**********************************************************/
*          /*                                                        */
*          /*  LOOK FOR DEVICETYPE AND VOLUMES INFORMATION FROM      */
*          /*  THE OBJECTS PARAMETER.  SCAN THE OBJECTS LIST LOOKING */
*          /*  FOR A MATCH.  WHEN FOUND,  CALL FOR THE APPROPRIATE   */
*          /*  PROCESSING.                                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1571
*          IF ADDR(OBJTS) ^= NULLPTR                               1571
*            THEN                                                  1571
         L     @04,@PC00001+4                                      1571
         L     @04,FDTPTR+8(,@04)                                  1571
         LTR   @04,@04                                             1571
         BZ    @RF01571                                            1571
*NVOBNTLP:     DO IX = 1 TO OBJTSCNT;                              1572
*                                                                  1572
NVOBNTLP LA    @04,1                                               1572
         B     @DE01572                                            1572
@DL01572 DS    0H                                                  1573
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR A MATCH BETWEEN OBJECT NAME, AND THE NAME*/
*              /*  OF THE OBJECT BEING DEFINED.                      */
*              /*                                                    */
*              /******************************************************/
*                                                                  1573
*                IF OBJNMPTR(IX)->OBJNMVAL(1:44) = FENTNAME(1:44)  1573
*                  THEN                                            1573
         SLA   @04,2                                               1573
         L     @15,@PC00001+4                                      1573
         L     @01,FDTPTR+12(,@15)                                 1573
         AL    @01,@CF01779                                        1573
         L     @04,OBJNMPTR(@04,@01)                               1573
         L     @01,CTGFVPTR                                        1573
         L     @01,CTGFVENT(,@01)                                  1573
         CLC   OBJNMVAL(44,@04),FENTNAME(@01)                      1573
         BNE   @RF01573                                            1573
*NVOBJMAT:           DO;                                           1574
NVOBJMAT DS    0H                                                  1575
*                    IMPF2OBJ = ON;                                1575
*                                                                  1575
         OI    IMPF2OBJ,B'00100000'                                1575
*                    /************************************************/
*                    /*                                              */
*                    /*  TEST FOR A VOLUMES LIST SPECIFICATION       */
*                    /*                                              */
*                    /************************************************/
*                                                                  1576
*                    IF LISTVPTR(IX) ^= NULLPTR ×                  1576
*                       DEVTPTR(IX) ^= NULLPTR                     1576
*                      THEN                                        1576
         SLR   @04,@04                                             1576
         L     @15,IX                                              1576
         SLA   @15,2                                               1576
         L     @14,@PC00001+4                                      1576
         L     @01,FDTPTR+24(,@14)                                 1576
         AL    @01,@CF01779                                        1576
         C     @04,LISTVPTR(@15,@01)                               1576
         BNE   @RT01576                                            1576
         L     @01,FDTPTR+32(,@14)                                 1576
         AL    @01,@CF01779                                        1576
         C     @04,DEVTPTR(@15,@01)                                1576
         BE    @RF01576                                            1576
@RT01576 DS    0H                                                  1577
*                        DO;                                       1577
*                                                                  1577
*                        /********************************************/
*                        /*                                          */
*                        /*  CALL LVLRPROC TO CONSTRUCT THE VOLUME   */
*                        /*  SERIAL LIST.                            */
*                        /*                                          */
*                        /********************************************/
*                                                                  1578
*                        CALL LVLRPROC(IX,NULLPARM,NULLPARM,NVFVTPTR,
*                           CTGTALIN);                             1578
*                                                                  1578
         MVC   @AL00001+4(16),@AL01578                             1578
         LA    @04,IX                                              1578
         ST    @04,@AL00001                                        1578
         LA    @04,NVFVTPTR                                        1578
         ST    @04,@AL00001+12                                     1578
         LA    @01,@AL00001                                        1578
         BAL   @14,LVLRPROC                                        1578
*                        RESPECIFY RTNREG RSTD;                    1579
*                        TESTRC = RTNREG;                          1580
         STH   RTNREG,TESTRC                                       1580
*                        RESPECIFY RTNREG UNRSTD;                  1581
*                        IF TESTRC ^= 0                            1582
*                          THEN                                    1582
         LH    @04,TESTRC                                          1582
         LTR   @04,@04                                             1582
         BZ    @RF01582                                            1582
*                            RETURN CODE(LASTCC12);                1583
         LA    @15,12                                              1583
         L     @14,@SA00007                                        1583
         LM    @00,@12,@SA00007+8                                  1583
         BR    @14                                                 1583
*                        END;                                      1584
*                                                                  1584
@RF01582 DS    0H                                                  1585
*                    END NVOBJMAT;                                 1585
@RF01576 DS    0H                                                  1586
*          END NVOBNTLP;                                           1586
*                                                                  1586
@RF01573 LA    @04,1                                               1586
         AL    @04,IX                                              1586
@DE01572 ST    @04,IX                                              1586
         L     @15,@PC00001+4                                      1586
         LA    @15,FDTPTR+8(,@15)                                  1586
         C     @04,OBJTSCNT(,@15)                                  1586
         BNH   @DL01572                                            1586
*          /**********************************************************/
*          /*                                                        */
*          /*  SAVE THE CPL, FVT, AND THE FPL'S PRIOR TO INVOKING    */
*          /*  CATALOG MANAGEMENT.  IF THE NONVSAM  OBJECT IS A      */
*          /*  DUPLICATE, IT IS DELETED, AND REDEFINED INTO THE      */
*          /*  CATALOG.                                              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1587
*          TFVTLEN = LENGTH(CTGFV) + (LENGTH(CTGFL)+8)*NVNUMFLD +  1587
*             LENGTH(IDAAMDSB);                                    1587
@RF01571 LA    @04,380                                             1587
         STH   @04,TFVTLEN                                         1587
*          SAVCPL = NVPTRCPL -> FIELDR(1:LENGTH(CTGPL)+16);        1588
*                                                                  1588
         L     @01,NVPTRCPL                                        1588
         MVC   SAVCPL(44),FIELDR(@01)                              1588
*          /**********************************************************/
*          /*                                                        */
*          /*  POINT TO THE SAVE AREA FOR THE FVT, WHICH FOLLOWS     */
*          /*  THE AREA FOR THE FVT ITSELF.  THIS LOCATION IN CORE   */
*          /*  HOLDS THE FVT, THE FPL'S, AND THE AMDSB.              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1589
*          NVSAVFVT = NVFVTPTR + TFVTLEN;                          1589
*                                                                  1589
         AL    @04,NVFVTPTR                                        1589
         ST    @04,NVSAVFVT                                        1589
*          CALL MVDAPROC(TFVTLEN,NVFVTPTR,NVSAVFVT);               1590
*                                                                  1590
         LA    @04,TFVTLEN                                         1590
         ST    @04,@AL00001                                        1590
         LA    @04,NVFVTPTR                                        1590
         ST    @04,@AL00001+4                                      1590
         LA    @04,NVSAVFVT                                        1590
         ST    @04,@AL00001+8                                      1590
         LA    @01,@AL00001                                        1590
         BAL   @14,MVDAPROC                                        1590
*          /**********************************************************/
*          /*                                                        */
*          /*  CALL CTLGPROC TO ACTUALLY INVOKE VSAM CATALOG         */
*          /*  MANAGEMENT TO DO THE DEFINE OF THE NONVSAM            */
*          /*  SET IMPF2NER TO BE ON TO INDICATE THAT THE PRINTING   */
*          /*  OF ERROR MESSAGES IS TO BE SUPPRESSED.                */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1591
*          IMPF2NER = ON;                                          1591
         OI    IMPF2NER,B'00001000'                                1591
*          CALL CTLGPROC(NVPTRCPL);                                1592
         LA    @04,NVPTRCPL                                        1592
         ST    @04,@AL00001                                        1592
         LA    @01,@AL00001                                        1592
         BAL   @14,CTLGPROC                                        1592
*          RESPECIFY RTNREG RSTD;                                  1593
*          TESTRC = RTNREG;                                        1594
         STH   RTNREG,TESTRC                                       1594
*          RESPECIFY RTNREG UNRSTD;                                1595
*                                                                  1595
*          /**********************************************************/
*          /*                                                        */
*          /*  RESET IMPF2NER TO BE OFF TO INDICATE THAT ERROR       */
*          /*  MESSAGES ARE TO BE PRINTED.                           */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1596
*          IMPF2NER = OFF;                                         1596
*                                                                  1596
         NI    IMPF2NER,B'11110111'                                1596
*          /**********************************************************/
*          /*                                                        */
*          /*  A NON-ZERO RETURN CODE INDICATES THAT CATALOG WAS NOT */
*          /*  ABLE TO DEFINE THE USER CATALOG POINTER.              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1597
*          IF TESTRC ^= 0                                          1597
*            THEN                                                  1597
*                                                                  1597
         LH    @04,TESTRC                                          1597
         LTR   @04,@04                                             1597
         BZ    @RF01597                                            1597
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR A VSAM CATALOG RETURN CODE OF 8.  THIS   */
*              /*  INDICATES THAT THERE IS A DUPLICATE NAME IN THE   */
*              /*  IN THE CATALOG.                                   */
*              /*                                                    */
*              /******************************************************/
*                                                                  1598
*              IF CATLGRC ^= DUPNAME                               1598
*                THEN                                              1598
         CLC   CATLGRC(2),@CH00039                                 1598
         BE    @RF01598                                            1598
*                  DO;                                             1599
*                  DARGSMOD = IMPMSG;                              1600
         L     @04,DDSTRU                                          1600
         MVC   DARGSMOD(3,@04),@CC00945                            1600
*                  DARGSENT = MPRAFAIL;                            1601
         MVI   DARGSENT(@04),X'15'                                 1601
*                  DARGILP = LENGTH(FENTNAME);                     1602
         MVC   DARGILP(2,@04),@CH00605                             1602
*                  DARGDBP = NVFVTPTR -> CTGFVENT;                 1603
*                                                                  1603
         L     @01,NVFVTPTR                                        1603
         L     @15,CTGFVENT(,@01)                                  1603
         ST    @15,DARGDBP(,@04)                                   1603
*                  CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);           1604
         L     @04,@PC00001                                        1604
         ST    @04,@AL00001                                        1604
         LA    @15,@CF00119                                        1604
         ST    @15,@AL00001+4                                      1604
         LA    @15,DDSTRU                                          1604
         ST    @15,@AL00001+8                                      1604
         MVI   @AL00001+8,X'80'                                    1604
         L     @15,GDTPRT(,@04)                                    1604
         LA    @01,@AL00001                                        1604
         BALR  @14,@15                                             1604
*                  DARGLIST = ''B;                                 1605
         L     @04,DDSTRU                                          1605
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1605
*                  DARGSMOD = IMPMSG;                              1606
*                                                                  1606
         MVC   DARGSMOD(3,@04),@CC00945                            1606
*                  RETURN CODE(LASTCC08);                          1607
         LA    @15,8                                               1607
         L     @14,@SA00007                                        1607
         LM    @00,@12,@SA00007+8                                  1607
         BR    @14                                                 1607
*                  END;                                            1608
*                ELSE                                              1609
*DUPNV:            DO;                                             1609
@RF01598 DS    0H                                                  1609
DUPNV    DS    0H                                                  1610
*                  OLDERID2 = NEWERID2;                            1610
         L     @04,@PC00001                                        1610
         L     @04,GDTTR2(,@04)                                    1610
         MVC   @TS00001(95),NEWERID2(@04)                          1610
         MVC   OLDERID2(95,@04),@TS00001                           1610
*                  NEWID2 = 'RMDN';                                1611
*                                                                  1611
         MVC   NEWID2(4,@04),@CC01433                              1611
*                  /**************************************************/
*                  /*                                                */
*                  /*  AN ENTRY FOR THE OBJECT TO BE DEFINED ALREADY */
*                  /*  EXISTS IN THE CATALOG.  CALL CPLPROC TO BUILD */
*                  /*  A CPL FOR THE DELETE FUNCTION.                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1612
*                  CALL CPLPROC('D',DCPLPTR,CTGFVENT,NULLPARM,CPSWD);
*                                                                  1612
         LA    @04,@CC00751                                        1612
         ST    @04,@AL00001                                        1612
         LA    @04,DCPLPTR                                         1612
         ST    @04,@AL00001+4                                      1612
         L     @04,CTGFVPTR                                        1612
         LA    @04,CTGFVENT(,@04)                                  1612
         ST    @04,@AL00001+8                                      1612
         LA    @04,NULLPARM                                        1612
         ST    @04,@AL00001+12                                     1612
         LA    @04,CPSWD                                           1612
         ST    @04,@AL00001+16                                     1612
         LA    @01,@AL00001                                        1612
         BAL   @14,CPLPROC                                         1612
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM CPLPROC.  IF THE CPL*/
*                  /*  WAS NOT BUILT RETURN TO THE CALLING PROCESSOR.*/
*                  /*                                                */
*                  /**************************************************/
*                                                                  1613
*                  RESPECIFY RTNREG RSTD;                          1613
*                  TESTRC = RTNREG;                                1614
         STH   RTNREG,TESTRC                                       1614
*                  RESPECIFY RTNREG UNRSTD;                        1615
*                  IF TESTRC ^= 0                                  1616
*                    THEN                                          1616
         LH    @04,TESTRC                                          1616
         LTR   @04,@04                                             1616
         BZ    @RF01616                                            1616
*                      RETURN CODE(LASTCC12);                      1617
*                                                                  1617
         LA    @15,12                                              1617
         L     @14,@SA00007                                        1617
         LM    @00,@12,@SA00007+8                                  1617
         BR    @14                                                 1617
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET THE CTGTYPE FIELD OF THE CPL.             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1618
*                  DCPLPTR -> CTGTYPE = CTGFVTYP;                  1618
*                                                                  1618
@RF01616 L     @04,DCPLPTR                                         1618
         L     @01,CTGFVPTR                                        1618
         MVC   CTGTYPE(1,@04),CTGFVTYP(@01)                        1618
*                  /**************************************************/
*                  /*                                                */
*                  /*  CALL DELTPROC TO DELETE THE NONVSAM           */
*                  /*  POINTER AND ITS ALIASES.                      */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1619
*                  CALL DELTPROC(DCPLPTR);                         1619
*                                                                  1619
         LA    @04,DCPLPTR                                         1619
         ST    @04,@AL00001                                        1619
         LA    @01,@AL00001                                        1619
         BAL   @14,DELTPROC                                        1619
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM DELTPROC.  IF IT IS */
*                  /*  NON-ZERO, RETURN TO THE CALLING PROCESSOR WITH*/
*                  /*  AN ERROR INDICATION.  OTHERWISE, RESET THE    */
*                  /*  VALUE OF DEFSTID TO NORMSTAT TO INDICATE THAT */
*                  /*  THE ERROR INCURRED ON THE FIRST CMS DEFINE    */
*                  /*  HAS BEEN CLEARED.                             */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1620
*                  RESPECIFY RTNREG RSTD;                          1620
*                  TESTRC = RTNREG;                                1621
         STH   RTNREG,TESTRC                                       1621
*                  RESPECIFY RTNREG UNRSTD;                        1622
*                  IF TESTRC ^= 0                                  1623
*                    THEN                                          1623
         LH    @04,TESTRC                                          1623
         LTR   @04,@04                                             1623
         BZ    @RF01623                                            1623
*                      DO;                                         1624
*                      DARGSMOD = IMPMSG;                          1625
         L     @04,DDSTRU                                          1625
         MVC   DARGSMOD(3,@04),@CC00945                            1625
*                      DARGSENT = MPRAFAIL;                        1626
         MVI   DARGSENT(@04),X'15'                                 1626
*                      DARGILP = LENGTH(FENTNAME);                 1627
         MVC   DARGILP(2,@04),@CH00605                             1627
*                      DARGDBP = NVFVTPTR -> CTGFVENT;             1628
*                                                                  1628
         L     @01,NVFVTPTR                                        1628
         L     @15,CTGFVENT(,@01)                                  1628
         ST    @15,DARGDBP(,@04)                                   1628
*                      CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);       1629
         L     @04,@PC00001                                        1629
         ST    @04,@AL00001                                        1629
         LA    @15,@CF00119                                        1629
         ST    @15,@AL00001+4                                      1629
         LA    @15,DDSTRU                                          1629
         ST    @15,@AL00001+8                                      1629
         MVI   @AL00001+8,X'80'                                    1629
         L     @15,GDTPRT(,@04)                                    1629
         LA    @01,@AL00001                                        1629
         BALR  @14,@15                                             1629
*                      DARGLIST = ''B;                             1630
         L     @04,DDSTRU                                          1630
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1630
*                      DARGSMOD = IMPMSG;                          1631
*                                                                  1631
         MVC   DARGSMOD(3,@04),@CC00945                            1631
*                      RETURN CODE(LASTCC08);                      1632
         LA    @15,8                                               1632
         L     @14,@SA00007                                        1632
         LM    @00,@12,@SA00007+8                                  1632
         BR    @14                                                 1632
*                      END;                                        1633
*                                                                  1633
*                  DEFSTID = NORMSTAT;                             1634
*                                                                  1634
@RF01623 MVI   DEFSTID,X'00'                                       1634
*                  /**************************************************/
*                  /*                                                */
*                  /*  RESTORE THE CATALOG PARAMETER LISTS TO THEIR  */
*                  /*  STATE PRIOR TO THE FIRST CMS DEFINE OPERATION.*/
*                  /*                                                */
*                  /**************************************************/
*                                                                  1635
*                  NVPTRCPL->FIELDR(1:LENGTH(CTGPL)+16) = SAVCPL;  1635
         L     @04,NVPTRCPL                                        1635
         MVC   FIELDR(44,@04),SAVCPL                               1635
*                  CALL MVDAPROC(TFVTLEN,NVSAVFVT,NVFVTPTR);       1636
*                                                                  1636
         LA    @04,TFVTLEN                                         1636
         ST    @04,@AL00001                                        1636
         LA    @04,NVSAVFVT                                        1636
         ST    @04,@AL00001+4                                      1636
         LA    @04,NVFVTPTR                                        1636
         ST    @04,@AL00001+8                                      1636
         LA    @01,@AL00001                                        1636
         BAL   @14,MVDAPROC                                        1636
*                  /**************************************************/
*                  /*                                                */
*                  /*  RESTORE THE VOLUME LIST.                      */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1637
*                  DO J =1 TO (FLISTLN/LENGTH(FVOLSERL));          1637
         LA    @04,1                                               1637
         B     @DE01637                                            1637
@DL01637 DS    0H                                                  1638
*                    FVOLRTN(J) = 0;                               1638
         LR    @15,@04                                             1638
         SLA   @15,3                                               1638
         L     @01,CTGFVPTR                                        1638
         L     @01,CTGFVVLT(,@01)                                  1638
         ALR   @01,@15                                             1638
         AL    @01,@CF01786                                        1638
         SLR   @00,@00                                             1638
         STCM  @00,3,FVOLRTN-2(@01)                                1638
*                  END;                                            1639
*                                                                  1639
         AL    @04,@CF00221                                        1639
@DE01637 ST    @04,J                                               1639
         L     @01,CTGFVPTR                                        1639
         L     @01,CTGFVVLT(,@01)                                  1639
         LH    @00,FLISTLN(,@01)                                   1639
         SRDA  @00,32                                              1639
         D     @00,@CF00039                                        1639
         CR    @04,@01                                             1639
         BNH   @DL01637                                            1639
*                  /**************************************************/
*                  /*                                                */
*                  /*  POINT TO THE CPL, AND CALL CTLGPROC TO INVOKE */
*                  /*  CATALOG MANAGEMENT.                           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1640
*                  CALL CTLGPROC(NVPTRCPL);                        1640
*                                                                  1640
         LA    @04,NVPTRCPL                                        1640
         ST    @04,@AL00001                                        1640
         LA    @01,@AL00001                                        1640
         BAL   @14,CTLGPROC                                        1640
*                  /**************************************************/
*                  /*                                                */
*                  /*  TEST THE RETURN CODE FROM CTLGPROC.  IF IT IS */
*                  /*  NON-ZERO, THE SECOND ATTEMPT TO DEFINE THE    */
*                  /*  OBJECT HAS ALSO FAILED.  RETURN TO THE CALLING*/
*                  /*  PROCESSOR WITH AN ERROR INDICATION.           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1641
*                  RESPECIFY RTNREG RSTD;                          1641
*                  TESTRC = RTNREG;                                1642
         STH   RTNREG,TESTRC                                       1642
*                  RESPECIFY RTNREG UNRSTD;                        1643
*                  IF TESTRC ^= 0                                  1644
*                    THEN                                          1644
         LH    @04,TESTRC                                          1644
         LTR   @04,@04                                             1644
         BZ    @RF01644                                            1644
*                      DO;                                         1645
*                      DARGSMOD = IMPMSG;                          1646
         L     @04,DDSTRU                                          1646
         MVC   DARGSMOD(3,@04),@CC00945                            1646
*                      DARGSENT = MPRAFAIL;                        1647
         MVI   DARGSENT(@04),X'15'                                 1647
*                      DARGILP = LENGTH(FENTNAME);                 1648
         MVC   DARGILP(2,@04),@CH00605                             1648
*                      DARGDBP = NVFVTPTR -> CTGFVENT;             1649
*                                                                  1649
         L     @01,NVFVTPTR                                        1649
         L     @15,CTGFVENT(,@01)                                  1649
         ST    @15,DARGDBP(,@04)                                   1649
*                      CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);       1650
         L     @04,@PC00001                                        1650
         ST    @04,@AL00001                                        1650
         LA    @15,@CF00119                                        1650
         ST    @15,@AL00001+4                                      1650
         LA    @15,DDSTRU                                          1650
         ST    @15,@AL00001+8                                      1650
         MVI   @AL00001+8,X'80'                                    1650
         L     @15,GDTPRT(,@04)                                    1650
         LA    @01,@AL00001                                        1650
         BALR  @14,@15                                             1650
*                      DARGLIST = ''B;                             1651
         L     @04,DDSTRU                                          1651
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1651
*                      DARGSMOD = IMPMSG;                          1652
*                                                                  1652
         MVC   DARGSMOD(3,@04),@CC00945                            1652
*                      RETURN CODE(LASTCC08);                      1653
         LA    @15,8                                               1653
         L     @14,@SA00007                                        1653
         LM    @00,@12,@SA00007+8                                  1653
         BR    @14                                                 1653
*                      END;                                        1654
*                                                                  1654
*                  /**************************************************/
*                  /*                                                */
*                  /*  RESET THE VALUE OF DEFSTID TO BE NORMSTAT     */
*                  /*  TO INDICATE THAT THE ORIGINAL CATALOG DEFINE  */
*                  /*  ERROR HAS BEEN CLEARED.                       */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1655
*                  DEFSTID = NORMSTAT;                             1655
*                                                                  1655
@RF01644 MVI   DEFSTID,X'00'                                       1655
*                  END DUPNV;                                      1656
*                                                                  1656
*        /************************************************************/
*        /*                                                          */
*        /*  SAVE THE NAME OF THE OBJECT JUST DEFINED FOR USE        */
*        /*  IN DEFINING ALIASES.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1657
*        SAVRELNM = NVFVTPTR->CTGFVENT->FENTNAME;                  1657
*                                                                  1657
@RF01597 L     @04,NVFVTPTR                                        1657
         L     @04,CTGFVENT(,@04)                                  1657
         MVC   SAVRELNM(44),FENTNAME(@04)                          1657
*        /************************************************************/
*        /*                                                          */
*        /*  PRINT A MESSAGE TO INDICATE WHAT HAS BEEN IMPORTED      */
*        /*  SUCCESSFULLY.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1658
*        DARGSMOD = IMPMSG;                                        1658
         L     @15,DDSTRU                                          1658
         MVC   DARGSMOD(3,@15),@CC00945                            1658
*        DARGSENT = MPRASUCC;                                      1659
         MVI   DARGSENT(@15),X'1A'                                 1659
*        DARGILP = LENGTH(FENTNAME);                               1660
         MVC   DARGILP(2,@15),@CH00605                             1660
*        DARGDBP = NVFVTPTR -> CTGFVENT;                           1661
         ST    @04,DARGDBP(,@15)                                   1661
*        CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                     1662
         L     @04,@PC00001                                        1662
         ST    @04,@AL00001                                        1662
         LA    @15,@CF00119                                        1662
         ST    @15,@AL00001+4                                      1662
         LA    @15,DDSTRU                                          1662
         ST    @15,@AL00001+8                                      1662
         MVI   @AL00001+8,X'80'                                    1662
         L     @15,GDTPRT(,@04)                                    1662
         LA    @01,@AL00001                                        1662
         BALR  @14,@15                                             1662
*        DARGLIST = ''B;                                           1663
         L     @04,DDSTRU                                          1663
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1663
*        DARGSMOD = IMPMSG;                                        1664
*                                                                  1664
         MVC   DARGSMOD(3,@04),@CC00945                            1664
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE FVT AND FPL'S FOR THE   */
*        /*  DEFINE OF THE NONVSAM.                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1665
*        CALL IDCSAFS0(GDTTBL,NVFVTPTR);                           1665
*                                                                  1665
         L     @04,@PC00001                                        1665
         ST    @04,@AL00001                                        1665
         LA    @15,NVFVTPTR                                        1665
         ST    @15,@AL00001+4                                      1665
         L     @15,GDTFSP(,@04)                                    1665
         LA    @01,@AL00001                                        1665
         BALR  @14,@15                                             1665
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE DATA RECORD BUFFER      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1666
*        CALL IDCSAFS0(GDTTBL,NVWORKAR);                           1666
*                                                                  1666
         L     @04,@PC00001                                        1666
         ST    @04,@AL00001                                        1666
         LA    @15,NVWORKAR                                        1666
         ST    @15,@AL00001+4                                      1666
         L     @15,GDTFSP(,@04)                                    1666
         LA    @01,@AL00001                                        1666
         BALR  @14,@15                                             1666
*        /************************************************************/
*        /*                                                          */
*        /*  ISSUE A UFSPACE TO FREE UP THE CPL USED TO DEFINE       */
*        /*  THE NONVSAM OBJECT.                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1667
*        CALL IDCSAFS0(GDTTBL,NVPTRCPL);                           1667
         L     @04,@PC00001                                        1667
         ST    @04,@AL00001                                        1667
         LA    @15,NVPTRCPL                                        1667
         ST    @15,@AL00001+4                                      1667
         L     @15,GDTFSP(,@04)                                    1667
         LA    @01,@AL00001                                        1667
         BALR  @14,@15                                             1667
*          /**********************************************************/
*          /*                                                        */
*          /*  THE ALIASES OF THE NONVSAM OBJECT THAT WERE PUT       */
*          /*  ON THE PORTABLE DATA SET BY EXPORTRA MUST NOW BE      */
*          /*  DEFINED IN THE CATALOG (IN VS2) OR HANDLED AS         */
*          /*  AS UNDEFINABLE (IN DOS OR VS1).  TO DO THIS, WE LOOP  */
*          /*  UNTIL A SOFTWARE END OF FILE IS FOUND, DEFINING       */
*          /*  ALIASES OR PRINTING ERROR MESSAGES.                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1668
*          /**********************************************************/
*          /*                                                        */
*          /*  SET GETEOF TO OFF TO INDICATE THAT THE END OF FILE    */
*          /*  HAS NOT BEEN FOUND.                                   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1668
*          GETEOF = OFF;                                           1668
*                                                                  1668
         NI    GETEOF,B'01111111'                                  1668
*          /**********************************************************/
*          /*                                                        */
*          /*  LOOP UNTIL AN END OF FILE OR A TRAILING NONVSAM IS    */
*          /*  FOUND, CALLING ALISPROC.                              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1669
*          DO WHILE (GETEOF = OFF) & (NVSMRDSW = OFF);             1669
*                                                                  1669
         B     @DE01669                                            1669
@DL01669 DS    0H                                                  1670
*            CALL ALISPROC(ADDR(SAVRELNM));                        1670
         LA    @04,SAVRELNM                                        1670
         ST    @04,@AFTEMPS+8                                      1670
         LA    @04,@AFTEMPS+8                                      1670
         ST    @04,@AL00001                                        1670
         LA    @01,@AL00001                                        1670
         BAL   @14,ALISPROC                                        1670
*            RESPECIFY RTNREG RSTD;                                1671
*            TESTRC = RTNREG;                                      1672
         STH   RTNREG,TESTRC                                       1672
*            RESPECIFY RTNREG UNRSTD;                              1673
*                                                                  1673
*            /****************************************************/
*            /*                                                  */
*            /*  IF THE RETURN CODE INDICATES A SEVERE ERROR     */
*            /*  PASS THAT BACK TO THE CALLING PROCESSOR.        */
*            /*  OTHERWISE, CONTINUE WITH A VALUE OF 8 IN SETRC. */
*            /*                                                  */
*            /****************************************************/
*                                                                  1674
*            IF TESTRC = LASTCC12                                  1674
*              THEN                                                1674
         LH    @04,TESTRC                                          1674
         LA    @15,12                                              1674
         CR    @04,@15                                             1674
         BNE   @RF01674                                            1674
*                RETURN CODE(LASTCC12);                            1675
         L     @14,@SA00007                                        1675
         LM    @00,@12,@SA00007+8                                  1675
         BR    @14                                                 1675
*              ELSE                                                1676
*                IF TESTRC ^= 0                                    1676
*                  THEN                                            1676
@RF01674 LH    @04,TESTRC                                          1676
         LTR   @04,@04                                             1676
         BZ    @RF01676                                            1676
*                    SETRC = MAX(SETRC,LASTCC08);                  1677
         LH    @04,SETRC                                           1677
         LA    @15,8                                               1677
         CR    @04,@15                                             1677
         BNL   *+6
         LR    @04,@15                                             1677
         STH   @04,SETRC                                           1677
*          END;                                                    1678
*                                                                  1678
@RF01676 DS    0H                                                  1678
@DE01669 TM    GETEOF,B'10000000'                                  1678
         BNZ   @DC01669                                            1678
         TM    NVSMRDSW,B'10000000'                                1678
         BZ    @DL01669                                            1678
@DC01669 DS    0H                                                  1679
*        /***********************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLING PROCESSOR WITH SUCCESS INDICATED  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1679
*        RETURN CODE(0);                                           1679
*                                                                  1679
         SLR   @15,@15                                             1679
         L     @14,@SA00007                                        1679
         LM    @00,@12,@SA00007+8                                  1679
         BR    @14                                                 1679
*END NVSMPROC;                                                     1680
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - ALISPROC                               */
*        /*                                                          */
*        /*  FUNCTION - READ A DATA RECORD FROM THE PORTABLE DATA    */
*        /*  SET.  IN VS2 ALISPROC BUILDS CATALOG PARAMETER LISTS    */
*        /*  AND DEFINES AN ALIAS FOR A RELATED OBJECT IN THE        */
*        /*  CATALOG.  IN VS1 AND DOS, ALISPROC CHECKS TO BE SURE    */
*        /*  THAT THE RECORDS READ IN ARE OF THE PROPER TYPE AND     */
*        /*  THAT THE PORTABLE DATA SET IS NOT IN ERROR.             */
*        /*                                                          */
*        /*  INPUT - FUNCTION DEFINITION TABLE AND THE CATALOG       */
*        /*  CONTROL RECORD.                                         */
*        /*                                                          */
*        /*  OUTPUT - IN VS2, A RECREATED ALIAS ENTRY IN THE         */
*        /*  CATALOG.  IN VS1 AND DOS, APPROPRIATE MESSAGES.         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1681
*ALISPROC: PROCEDURE(ALNAMEPT);                                    1681
*                                                                  1681
ALISPROC STM   @14,@12,@SA00008                                    1681
         MVC   @PC00008(4),0(@01)                                  1681
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUEMENTS OF INVOCATION                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1682
*        DCL ALNAMEPT PTR(31);         /*POINTER TO THE RELATED NAME */
*                                                                  1682
*        OLDERID2 = NEWERID2;                                      1683
         L     @04,@PC00001                                        1683
         L     @04,GDTTR2(,@04)                                    1683
         MVC   @TS00001(95),NEWERID2(@04)                          1683
         MVC   OLDERID2(95,@04),@TS00001                           1683
*        NEWID2 = 'RMAL';                                          1684
*                                                                  1684
         MVC   NEWID2(4,@04),@CC01439                              1684
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE CONTROL RECORD POINTER TO THE ADDRESS OF THE    */
*        /*  BUFFER INTO WHICH THE CONTROL RECORD IS TO BE READ.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1685
*        CONRCPTR = ADDR(CONRCARE);                                1685
*                                                                  1685
         LA    @04,CONRCARE                                        1685
         ST    @04,CONRCPTR                                        1685
*        /************************************************************/
*        /*                                                          */
*        /*  ZERO OUT THE AREA THAT HOLDS THE CONTROL RECORDS.       */
*        /*  BEGIN BY INITIALIZING THE VALUES OF ZSIZE, ZPTR,        */
*        /*  AND ZCNTRL.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1686
*        ZSIZE = LENGTH(CONRCARE);                                 1686
         MVC   ZSIZE(2),@CH00920                                   1686
*        ZPTR = CONRCPTR;                                          1687
         ST    @04,ZPTR                                            1687
*        ZCNTRL = ON;                                              1688
*                                                                  1688
         OI    ZCNTRL,B'10000000'                                  1688
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP CLEARING THE AREA THAT IS TO HOLD THE CONTROL      */
*        /*  RECORD.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1689
*        DO WHILE (ZCNTRL = ON);                                   1689
         B     @DE01689                                            1689
@DL01689 DS    0H                                                  1690
*          IF ZSIZE > 256                                          1690
*            THEN                                                  1690
         LH    @04,ZSIZE                                           1690
         LA    @15,256                                             1690
         CR    @04,@15                                             1690
         BNH   @RF01690                                            1690
*              DO;                                                 1691
*              ZAREA(1:256) = ZER(1:256);                          1692
         L     @14,ZPTR                                            1692
         MVC   ZAREA(256,@14),ZER                                  1692
*              ZSIZE = ZSIZE - 256;                                1693
         SLR   @04,@15                                             1693
         STH   @04,ZSIZE                                           1693
*              ZPTR = ZPTR + 256;                                  1694
         ALR   @14,@15                                             1694
         ST    @14,ZPTR                                            1694
*              END;                                                1695
*            ELSE                                                  1696
*              DO;                                                 1696
         B     @RC01690                                            1696
@RF01690 DS    0H                                                  1697
*              ZAREA(1:ZSIZE) = ZER(1:ZSIZE);                      1697
         L     @04,ZPTR                                            1697
         LH    @15,ZSIZE                                           1697
         BCTR  @15,0                                               1697
         EX    @15,@SM01777                                        1697
*              ZCNTRL = OFF;                                       1698
         NI    ZCNTRL,B'01111111'                                  1698
*              END;                                                1699
*        END;                                                      1700
*                                                                  1700
@RC01690 DS    0H                                                  1700
@DE01689 TM    ZCNTRL,B'10000000'                                  1700
         BO    @DL01689                                            1700
*        /************************************************************/
*        /*                                                          */
*        /*  PUT THE CONTROL RECORD IN THE BUFFER                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1701
*        CALL IDCIOGT0(GDTTBL,PINIOCS);                            1701
         L     @04,@PC00001                                        1701
         ST    @04,@AL00001                                        1701
         LA    @15,PINIOCS                                         1701
         ST    @15,@AL00001+4                                      1701
         MVI   @AL00001+4,X'80'                                    1701
         L     @15,GDTGET(,@04)                                    1701
         LA    @01,@AL00001                                        1701
         BALR  @14,@15                                             1701
*        RESPECIFY RTNREG RSTD;                                    1702
*        TESTRC = RTNREG;                                          1703
         STH   RTNREG,TESTRC                                       1703
*        RESPECIFY RTNREG UNRSTD;                                  1704
*                                                                  1704
*        /************************************************************/
*        /*                                                          */
*        /*  TEST FOR A RETURN CODE INDICATING THAT WE HAVE FOUND    */
*        /*  AN END OF FILE.  IF UGET GIVES US THIS RETURN CODE,     */
*        /*  RETURN TO THE CALLING PROCESSOR WITH SUCCESS INDICATED. */
*        /*  IF ANY OTHER NONZERO RETURN CODE IS RETURNED, RETURN    */
*        /*  TO THE CALLER WITH A SEVERE ERROR INDICATED.            */
*        /*                                                          */
*        /************************************************************/
*                                                                  1705
*        IF TESTRC = 16                                            1705
*          THEN                                                    1705
         LH    @04,TESTRC                                          1705
         C     @04,@CF00483                                        1705
         BNE   @RF01705                                            1705
*            DO;                                                   1706
*                                                                  1706
*            /********************************************************/
*            /*                                                      */
*            /*  SET GETEOF TO ON TO INDICATE TO THE CALLER THAT     */
*            /*  AN END OF FILE HAS BEEN FOUND.                      */
*            /*                                                      */
*            /********************************************************/
*                                                                  1707
*            GETEOF = ON;                                          1707
         OI    GETEOF,B'10000000'                                  1707
*            RETURN CODE(0);                                       1708
         SLR   @15,@15                                             1708
         L     @14,@SA00008                                        1708
         LM    @00,@12,@SA00008+8                                  1708
         BR    @14                                                 1708
*            END;                                                  1709
*          ELSE                                                    1710
*            IF TESTRC ^= 0                                        1710
*              THEN                                                1710
@RF01705 LH    @04,TESTRC                                          1710
         LTR   @04,@04                                             1710
         BZ    @RF01710                                            1710
*                RETURN CODE(LASTCC12);                            1711
*                                                                  1711
         LA    @15,12                                              1711
         L     @14,@SA00008                                        1711
         LM    @00,@12,@SA00008+8                                  1711
         BR    @14                                                 1711
*        TFVTLEN = IOCDAD -> HEADLN;                               1712
@RF01710 L     @04,IOCSPTR                                         1712
         L     @01,IOCDAD(,@04)                                    1712
         LH    @15,HEADLN(,@01)                                    1712
         STH   @15,TFVTLEN                                         1712
*        CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);                   1713
*                                                                  1713
         LA    @15,TFVTLEN                                         1713
         ST    @15,@AL00001                                        1713
         ST    @04,@AL00001+4                                      1713
         LA    @04,CONRCPTR                                        1713
         ST    @04,@AL00001+8                                      1713
         LA    @01,@AL00001                                        1713
         BAL   @14,MVDAPROC                                        1713
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO DETERMINE THAT WE HAVE GOTTEN A CATALOG CONTROL */
*        /*  RECORD.  IF NOT, THE PORTABLE DATA                      */
*        /*  SET IS IN ERROR, AND THE IMPORTRA COMMAND MUST BE       */
*        /*  TERMINATED.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1714
*        IF (HEADFLG1 ^= HDFL1CAT)                                 1714
*          THEN                                                    1714
         L     @04,CONRCPTR                                        1714
         CLI   HEADFLG1(@04),X'FF'                                 1714
         BE    @RF01714                                            1714
*            DO;                                                   1715
*            DEFSTID = PORTERR;                                    1716
         MVI   DEFSTID,X'01'                                       1716
*            RETURN CODE(LASTCC12);                                1717
         LA    @15,12                                              1717
         L     @14,@SA00008                                        1717
         LM    @00,@12,@SA00008+8                                  1717
         BR    @14                                                 1717
*            END;                                                  1718
*                                                                  1718
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO DETERMINE IF THE CONTROL RECORD IS FOR          */
*        /*  A NONVSAM DATA SET.  IF SO, RETURN TO THE CALLER        */
*        /*  AFTER SETTING A SWITCH TO INDICATE THAT NVSMPROC        */
*        /*  IS NOT TO READ A CONTROL RECORD THE NEXT TIME THAT      */
*        /*  IT IS CALLED.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1719
*        IF HEADFLG2 = HDFL2NVS                                    1719
*          THEN                                                    1719
@RF01714 L     @04,CONRCPTR                                        1719
         CLI   HEADFLG2(@04),C'A'                                  1719
         BNE   @RF01719                                            1719
*            DO;                                                   1720
*            NVSMRDSW = ON;                                        1721
         OI    NVSMRDSW,B'10000000'                                1721
*            RETURN CODE(0);                                       1722
         SLR   @15,@15                                             1722
         L     @14,@SA00008                                        1722
         LM    @00,@12,@SA00008+8                                  1722
         BR    @14                                                 1722
*            END;                                                  1723
*                                                                  1723
*        /************************************************************/
*        /*                                                          */
*        /*  THE RECORD THAT WAS GOTTEN WAS A CATALOG CONTROL RECORD */
*        /*  FOR AN ALIAS ENTRY.  COMPUTE THE AMOUNT OF SPACE NEEDED */
*        /*  FOR THE CATALOG DATA RECORD ASSOCIATED WITH THE         */
*        /*  PRESENT CONTROL RECORD.  THEN GET ENOUGH CORE TO HOLD   */
*        /*  THE RECORD.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1724
*        TOTLEN = ASSRECLN;                                        1724
@RF01719 L     @04,CONRCPTR                                        1724
         LH    @04,ASSRECLN(,@04)                                  1724
         ST    @04,TOTLEN                                          1724
*        CALL IDCSAGP0(GDTTBL,TOTLEN,ALWORKAR,GPID,SETZERO);       1725
*                                                                  1725
         L     @04,@PC00001                                        1725
         ST    @04,@AL00001                                        1725
         LA    @15,TOTLEN                                          1725
         ST    @15,@AL00001+4                                      1725
         LA    @15,ALWORKAR                                        1725
         ST    @15,@AL00001+8                                      1725
         LA    @15,GPID                                            1725
         ST    @15,@AL00001+12                                     1725
         LA    @15,SETZERO                                         1725
         ST    @15,@AL00001+16                                     1725
         MVI   @AL00001+16,X'80'                                   1725
         L     @15,GDTGPL(,@04)                                    1725
         LA    @01,@AL00001                                        1725
         BALR  @14,@15                                             1725
*        /************************************************************/
*        /*                                                          */
*        /*  TEST THE RETURN CODE FROM UGPOOL.  IF IT IS NONZREO     */
*        /*  NO STORAGE IS LEFT, AND THE COMMAND IS TERMINATED.      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1726
*        RESPECIFY RTNREG RSTD;                                    1726
*        TESTRC = RTNREG;                                          1727
         STH   RTNREG,TESTRC                                       1727
*        RESPECIFY RTNREG UNRSTD;                                  1728
*        IF TESTRC ^= 0                                            1729
*          THEN                                                    1729
         LH    @04,TESTRC                                          1729
         LTR   @04,@04                                             1729
         BZ    @RF01729                                            1729
*            DO;                                                   1730
*            DEFSTID = NOSTORAG;                                   1731
         MVI   DEFSTID,X'04'                                       1731
*            DARGSMOD = UNIVMSG;                                   1732
         L     @04,DDSTRU                                          1732
         MVC   DARGSMOD(3,@04),@CC00981                            1732
*            RETURN CODE(LASTCC12);                                1733
         LA    @15,12                                              1733
         L     @14,@SA00008                                        1733
         LM    @00,@12,@SA00008+8                                  1733
         BR    @14                                                 1733
*            END;                                                  1734
*                                                                  1734
*        /************************************************************/
*        /*                                                          */
*        /*  GET THE DATA RECORD USING GETPROC TO ASSEMBLE IT IN     */
*        /*  THE BUFFER.  TEST THE RETURN CODE FROM                  */
*        /*  GETPROC.  IF IT IS NONZERO, WE HAVE AN I/O ERROR.       */
*        /*  RETURN TO THE CALLING PROCESSOR.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1735
*        CALL GETPROC(ALWORKAR,ASSRECLN);                          1735
@RF01729 LA    @04,ALWORKAR                                        1735
         ST    @04,@AL00001                                        1735
         L     @04,CONRCPTR                                        1735
         LA    @04,ASSRECLN(,@04)                                  1735
         ST    @04,@AL00001+4                                      1735
         LA    @01,@AL00001                                        1735
         BAL   @14,GETPROC                                         1735
*        RESPECIFY RTNREG RSTD;                                    1736
*        TESTRC = RTNREG;                                          1737
         STH   RTNREG,TESTRC                                       1737
*        RESPECIFY RTNREG UNRSTD;                                  1738
*        IF TESTRC ^= 0                                            1739
*          THEN                                                    1739
         LH    @04,TESTRC                                          1739
         LTR   @04,@04                                             1739
         BZ    @RF01739                                            1739
*            RETURN CODE(LASTCC12);                                1740
*                                                                  1740
         LA    @15,12                                              1740
         L     @14,@SA00008                                        1740
         LM    @00,@12,@SA00008+8                                  1740
         BR    @14                                                 1740
*        DICTPTR = ADDR(VARDATA);                                  1741
*                                                                  1741
@RF01739 L     @04,CONRCPTR                                        1741
         LA    @04,VARDATA(,@04)                                   1741
         ST    @04,DICTPTR                                         1741
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT THE CPL TO BE USED FOR THE DEFINE FUNCTION.   */
*        /*  IF THE CONSTRUCTION FAILS, RETURN TO THE CALLING        */
*        /*  PROCESSOR WITH AN ERROR INDICATED.                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1742
*        CALL CPLPROC('F',ALPTRCPL,NULLPARM,NULLPARM,NULLPARM);    1742
*                                                                  1742
         MVC   @AL00001(20),@AL01742                               1742
         LA    @04,ALPTRCPL                                        1742
         ST    @04,@AL00001+4                                      1742
         LA    @01,@AL00001                                        1742
         BAL   @14,CPLPROC                                         1742
*        RESPECIFY RTNREG RSTD;                                    1743
*        TESTRC = RTNREG;                                          1744
         STH   RTNREG,TESTRC                                       1744
*        RESPECIFY RTNREG UNRSTD;                                  1745
*        IF TESTRC ^= 0                                            1746
*          THEN                                                    1746
         LH    @04,TESTRC                                          1746
         LTR   @04,@04                                             1746
         BZ    @RF01746                                            1746
*            RETURN CODE(LASTCC12);                                1747
*                                                                  1747
         LA    @15,12                                              1747
         L     @14,@SA00008                                        1747
         LM    @00,@12,@SA00008+8                                  1747
         BR    @14                                                 1747
*        /************************************************************/
*        /*                                                          */
*        /*  SET CTGPLPTR TO BE ALPTRCPL, SO THAT IT POINTS TO THE   */
*        /*  CPL BUILT FOR THE ALIAS.                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1748
*        CTGPLPTR = ALPTRCPL;                                      1748
*                                                                  1748
@RF01746 L     @04,ALPTRCPL                                        1748
         ST    @04,CTGPLPTR                                        1748
*        /************************************************************/
*        /*                                                          */
*        /*  CALL NFVTPROC TO BUILD THE FVT TO BE USED TO DEFINE     */
*        /*  THE ALIAS ENTRY.                                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1749
*        CALL NFVTPROC(DICTPTR,ALWORKAR,ALFVTPTR,ALNAMEPT);        1749
*                                                                  1749
         LA    @04,DICTPTR                                         1749
         ST    @04,@AL00001                                        1749
         LA    @04,ALWORKAR                                        1749
         ST    @04,@AL00001+4                                      1749
         LA    @04,ALFVTPTR                                        1749
         ST    @04,@AL00001+8                                      1749
         L     @04,@PC00008                                        1749
         ST    @04,@AL00001+12                                     1749
         LA    @01,@AL00001                                        1749
         BAL   @14,NFVTPROC                                        1749
*        /************************************************************/
*        /*                                                          */
*        /*  TEST THE RETURN CODE, AND RETURN TO THE CALLING         */
*        /*  PROCESSOR IF AN ERROR IS INDICATED.                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1750
*        RESPECIFY RTNREG RSTD;                                    1750
*        TESTRC = RTNREG;                                          1751
         STH   RTNREG,TESTRC                                       1751
*        RESPECIFY RTNREG UNRSTD;                                  1752
*        IF TESTRC ^= 0                                            1753
*          THEN                                                    1753
         LH    @04,TESTRC                                          1753
         LTR   @04,@04                                             1753
         BZ    @RF01753                                            1753
*            RETURN CODE(LASTCC12);                                1754
*                                                                  1754
         LA    @15,12                                              1754
         L     @14,@SA00008                                        1754
         LM    @00,@12,@SA00008+8                                  1754
         BR    @14                                                 1754
*        CTGFVT = ALFVTPTR;                                        1755
*                                                                  1755
@RF01753 L     @04,ALFVTPTR                                        1755
         L     @01,CTGPLPTR                                        1755
         ST    @04,CTGFVT(,@01)                                    1755
*        /************************************************************/
*        /*                                                          */
*        /*  NO SCAN OF THE OBJECTS LIST IS NECESSARY FOR NONE       */
*        /*  OF THE OBJECTS SUBPARAMETERS APPLY TO ALIASES.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1756
*        /************************************************************/
*        /*                                                          */
*        /*  CALL CTLGPROC TO ACTUALLY INVOKE VSAM CATALOG           */
*        /*  MANAGEMENT TO DO THE DEFINE OF THE ALIAS.               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1756
*        CALL CTLGPROC(ALPTRCPL);                                  1756
         LA    @04,ALPTRCPL                                        1756
         ST    @04,@AL00001                                        1756
         LA    @01,@AL00001                                        1756
         BAL   @14,CTLGPROC                                        1756
*        RESPECIFY RTNREG RSTD;                                    1757
*        TESTRC = RTNREG;                                          1758
         STH   RTNREG,TESTRC                                       1758
*        RESPECIFY RTNREG UNRSTD;                                  1759
*                                                                  1759
*        /************************************************************/
*        /*                                                          */
*        /*  A NON-ZERO RETURN CODE INDICATES THAT CATALOG WAS NOT   */
*        /*  ABLE TO DEFINE THE ALIAS.                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1760
*        IF TESTRC ^= 0                                            1760
*          THEN                                                    1760
         LH    @04,TESTRC                                          1760
         LTR   @04,@04                                             1760
         BZ    @RF01760                                            1760
*            DO;                                                   1761
*                                                                  1761
*            /********************************************************/
*            /*                                                      */
*            /*  NO DUPLICATE NAME ENTRIES SHOULD BE IN THE          */
*            /*  THE CATALOG FOR THE DELETE OPERATIONS FOR THE       */
*            /*  RELATED OBJECT SHOULD HAVE GOTTEN RID OF ALL OF     */
*            /*  THEM.                                               */
*            /*                                                      */
*            /********************************************************/
*                                                                  1762
*            DARGSENT = MPRAFAIL;                                  1762
         L     @04,DDSTRU                                          1762
         MVI   DARGSENT(@04),X'15'                                 1762
*            DARGSMOD = IMPMSG;                                    1763
         MVC   DARGSMOD(3,@04),@CC00945                            1763
*            DARGILP = LENGTH(FENTNAME);                           1764
         MVC   DARGILP(2,@04),@CH00605                             1764
*            DARGDBP = ALFVTPTR -> CTGFVENT;                       1765
         L     @01,ALFVTPTR                                        1765
         L     @15,CTGFVENT(,@01)                                  1765
         ST    @15,DARGDBP(,@04)                                   1765
*            CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                 1766
         L     @04,@PC00001                                        1766
         ST    @04,@AL00001                                        1766
         LA    @15,@CF00119                                        1766
         ST    @15,@AL00001+4                                      1766
         LA    @15,DDSTRU                                          1766
         ST    @15,@AL00001+8                                      1766
         MVI   @AL00001+8,X'80'                                    1766
         L     @15,GDTPRT(,@04)                                    1766
         LA    @01,@AL00001                                        1766
         BALR  @14,@15                                             1766
*            DARGLIST = ''B;                                       1767
         L     @04,DDSTRU                                          1767
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1767
*            DARGSMOD = IMPMSG;                                    1768
         MVC   DARGSMOD(3,@04),@CC00945                            1768
*            SETRC = MAX(SETRC,LASTCC08);                          1769
         LH    @04,SETRC                                           1769
         LA    @15,8                                               1769
         CR    @04,@15                                             1769
         BNL   *+6
         LR    @04,@15                                             1769
         STH   @04,SETRC                                           1769
*            END;                                                  1770
*                                                                  1770
*        /************************************************************/
*        /*                                                          */
*        /*  FREE THE CORE GOTTEN FOR THIS PROCEDURE.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1771
*        CALL IDCSAFS0(GDTTBL,ALFVTPTR);                           1771
@RF01760 L     @04,@PC00001                                        1771
         ST    @04,@AL00001                                        1771
         LA    @15,ALFVTPTR                                        1771
         ST    @15,@AL00001+4                                      1771
         L     @15,GDTFSP(,@04)                                    1771
         LA    @01,@AL00001                                        1771
         BALR  @14,@15                                             1771
*        CALL IDCSAFS0(GDTTBL,ALWORKAR);                           1772
         L     @04,@PC00001                                        1772
         ST    @04,@AL00001                                        1772
         LA    @15,ALWORKAR                                        1772
         ST    @15,@AL00001+4                                      1772
         L     @15,GDTFSP(,@04)                                    1772
         LA    @01,@AL00001                                        1772
         BALR  @14,@15                                             1772
*        CALL IDCSAFS0(GDTTBL,ALPTRCPL);                           1773
*                                                                  1773
         L     @04,@PC00001                                        1773
         ST    @04,@AL00001                                        1773
         LA    @15,ALPTRCPL                                        1773
         ST    @15,@AL00001+4                                      1773
         L     @15,GDTFSP(,@04)                                    1773
         LA    @01,@AL00001                                        1773
         BALR  @14,@15                                             1773
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLER WITH SUCCESS INDICATED.            */
*        /*                                                          */
*        /************************************************************/
*                                                                  1774
*        RETURN CODE(0);                                           1774
*                                                                  1774
         SLR   @15,@15                                             1774
         L     @14,@SA00008                                        1774
         LM    @00,@12,@SA00008+8                                  1774
         BR    @14                                                 1774
*END ALISPROC;                                                     1775
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - NFVTPROC                               */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT FVT AND FPL'S FROM INFORMATION     */
*        /*  IN THE DICTIONARY PASSED AS AN ARGUMENT TO THIS         */
*        /*  PROCEDURE.  FPL'S POINT TO THE CATALOG FIELD INFORMA-   */
*        /*  TION WITHIN THE WORKAREA.  NFVTPROC IS USED ONLY FOR    */
*        /*  NON-VSAMS, GDG BASES, ALIASES, AND USER CATALOG         */
*        /*  POINTERS.  FVTPROC IS USED TO PERFORM THIS FUNCTION     */
*        /*  FOR CLUSTERS, AIX'S, AND PATHS.                         */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*  .NFDICT - POINTER TO THE DICTIONARY WHICH REFERENCES    */
*        /*            CATALOG FIELD INFORMATION WITH WORK AREA      */
*        /*  .NFWKA  - WORKAREA CONTAINING THE CATALOG FIELD         */
*        /*            INFORMATION                                   */
*        /*  .NFVTPTR- RETURN CELL FOR AN FVT POINTER                */
*        /*  .NFRELATE - POINTER TO THE RELATED NAME.  THIS IS USED  */
*        /*              ONLY FOR ALIASES                            */
*        /*                                                          */
*        /*  OUTPUT - POINTER TO THE FVT CONSTRUCTED.  THIS FVT WILL */
*        /*  REFERENCE ALL FPL'S CONSTRUCTED BY THIS PROCEDURE       */
*        /*  IF ANY.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1776
*NFVTPROC: PROCEDURE(NFDICT,NFWKA,NFPTRFVT,NFRELATE);              1776
*                                                                  1776
NFVTPROC STM   @14,@12,@SA00009                                    1776
         MVC   @PC00009(16),0(@01)                                 1776
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUEMENTS OF INVOCATION                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1777
*        DCL NFDICT    PTR(31);                                    1777
*        DCL NFWKA     PTR(31);                                    1778
*        DCL NFPTRFVT  PTR(31);                                    1779
*        DCL NFRELATE  PTR(31);                                    1780
*                                                                  1780
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1781
*        DCL NFPLADDR PTR(31);         /*POINTER TO THE FPL          */
*        DCL NFPLNUM  FIXED(15) CONSTANT(8);                       1782
*                                      /*NUMBER OF FPL'S CONSTRUCTED */
*                                      /*BY THIS PROCEDURE           */
*        DCL NFIELDPT PTR(31);         /*POINTER TO A FIELD LIST     */
*        OLDERID2 = NEWERID2;                                      1784
         L     @04,@PC00001                                        1784
         L     @15,GDTTR2(,@04)                                    1784
         MVC   @TS00001(95),NEWERID2(@15)                          1784
         MVC   OLDERID2(95,@15),@TS00001                           1784
*        NEWID2 = 'RMNF';                                          1785
*                                                                  1785
         MVC   NEWID2(4,@15),@CC01454                              1785
*        /************************************************************/
*        /*                                                          */
*        /*  GET CORE FOR THE FVT AND THE TOTAL NUMBER OF FPL'S      */
*        /*  THAT CAN BE CONSTRUCTED BY THIS PROCEDURE               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1786
*        RESPECIFY CTGFV BASED(NFPTRFVT);                          1786
*        TOTLEN = 2*(LENGTH(CTGFV) + (LENGTH(CTGFL) + 8) * NFPLNUM + LE
*GTH(IDAAMDSB));                                                   1787
*                                                                  1787
         MVC   TOTLEN(4),@CF01753                                  1787
*        CALL IDCSAGP0(GDTTBL,TOTLEN,NFPTRFVT,GPID,SETZERO);       1788
*                                                                  1788
         ST    @04,@AL00001                                        1788
         LA    @15,TOTLEN                                          1788
         ST    @15,@AL00001+4                                      1788
         L     @15,@PC00009+8                                      1788
         ST    @15,@AL00001+8                                      1788
         LA    @15,GPID                                            1788
         ST    @15,@AL00001+12                                     1788
         LA    @15,SETZERO                                         1788
         ST    @15,@AL00001+16                                     1788
         MVI   @AL00001+16,X'80'                                   1788
         L     @15,GDTGPL(,@04)                                    1788
         LA    @01,@AL00001                                        1788
         BALR  @14,@15                                             1788
*        RESPECIFY RTNREG RSTD;                                    1789
*        TESTRC = RTNREG;                                          1790
         STH   RTNREG,TESTRC                                       1790
*        RESPECIFY RTNREG UNRSTD;                                  1791
*        IF TESTRC ^= 0                                            1792
*          THEN                                                    1792
*                                                                  1792
         LH    @04,TESTRC                                          1792
         LTR   @04,@04                                             1792
         BZ    @RF01792                                            1792
*            /********************************************************/
*            /*                                                      */
*            /*  IF CORE IS NOT OBTAINED SUCCESSFULLY, RETURN TO     */
*            /*  THE CALLING PROCESSOR WITH FAILURE INDICATED.       */
*            /*                                                      */
*            /********************************************************/
*                                                                  1793
*            DO;                                                   1793
*            DEFSTID = NOSTORAG;                                   1794
         MVI   DEFSTID,X'04'                                       1794
*            RETURN CODE(LASTCC12);                                1795
         LA    @15,12                                              1795
         L     @14,@SA00009                                        1795
         LM    @00,@12,@SA00009+8                                  1795
         BR    @14                                                 1795
*            END;                                                  1796
*                                                                  1796
*        /************************************************************/
*        /*                                                          */
*        /*  POINT TO THE DICTIONARY INFORMATION, AND SET THE        */
*        /*  POINTER TO THE LOCATION IN CORE WHERE THE FIRST FPL IS  */
*        /*  TO BE BUILT.                                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  1797
*        DICTPTR = NFDICT;                                         1797
@RF01792 L     @04,@PC00009                                        1797
         L     @04,NFDICT(,@04)                                    1797
         ST    @04,DICTPTR                                         1797
*        NFPLADDR = NFPTRFVT + LENGTH(CTGFV);                      1798
*                                                                  1798
         L     @15,@PC00009+8                                      1798
         L     @15,NFPTRFVT(,@15)                                  1798
         LA    @14,92                                              1798
         ALR   @14,@15                                             1798
         ST    @14,NFPLADDR                                        1798
*        /************************************************************/
*        /*                                                          */
*        /*  SET TYPE FIELD IN THE FVT FROM CATALOG FIELD INFORMATION*/
*        /*                                                          */
*        /************************************************************/
*                                                                  1799
*        NFIELDPT = DICTDL(LENTYPE) + NFWKA;                       1799
         L     @14,@PC00009+4                                      1799
         L     @14,NFWKA(,@14)                                     1799
         L     @03,DICTDL(,@04)                                    1799
         ALR   @03,@14                                             1799
         ST    @03,NFIELDPT                                        1799
*        CTGFVTYP = NFIELDPT -> FENTYPE;                           1800
*                                                                  1800
         MVC   CTGFVTYP(1,@15),FENTYPE(@03)                        1800
*        /************************************************************/
*        /*                                                          */
*        /*  SET ENTNAME FIELD POINTER IN THE FVT                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1801
*        IF DICTLN(LENTNAME) ^= NULLPTR                            1801
*          THEN                                                    1801
         L     @03,DICTLN+8(,@04)                                  1801
         LTR   @03,@03                                             1801
         BZ    @RF01801                                            1801
*            CTGFVENT = DICTDL(LENTNAME) + NFWKA;                  1802
*                                                                  1802
         AL    @14,DICTDL+8(,@04)                                  1802
         ST    @14,CTGFVENT(,@15)                                  1802
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE VALUE OF THE OUTPUT DD NAME IN THE CTGFVIND     */
*        /*  FIELD.                                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1803
*        IF ADDR(OUTDD) ^= NULLPTR                                 1803
*          THEN                                                    1803
@RF01801 L     @04,@PC00001+4                                      1803
         L     @04,FDTPTR+4(,@04)                                  1803
         LTR   @04,@04                                             1803
         BZ    @RF01803                                            1803
*            CTGFVIND = ADDR(OUTDDVAL);                            1804
*                                                                  1804
         L     @15,@PC00009+8                                      1804
         L     @01,NFPTRFVT(,@15)                                  1804
         LA    @04,OUTDDVAL(,@04)                                  1804
         ST    @04,CTGFVIND(,@01)                                  1804
*        /************************************************************/
*        /*                                                          */
*        /*  INVOKE LVLRPROC TO BUILD A VOLUME SERIAL LIST,          */
*        /*  A DEVICETYPES LIST, AND FOR NON-VSAM OBJECTS,           */
*        /*  A LIST OF FILESEQUENCE NUMBERS.                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1805
*        IF (CTGFVTYP ^= CTGTGBS) & (CTGFVTYP ^= CTGTANM)          1805
*          THEN                                                    1805
@RF01803 L     @04,@PC00009+8                                      1805
         L     @15,NFPTRFVT(,@04)                                  1805
         CLI   CTGFVTYP(@15),C'B'                                  1805
         BE    @RF01805                                            1805
         CLI   CTGFVTYP(@15),C'X'                                  1805
         BE    @RF01805                                            1805
*            DO;                                                   1806
*            CALL LVLRPROC(NULLPARM,NFDICT,NFWKA,NFPTRFVT,CTGFVTYP);
*                                                                  1807
         LA    @14,NULLPARM                                        1807
         ST    @14,@AL00001                                        1807
         L     @14,@PC00009                                        1807
         ST    @14,@AL00001+4                                      1807
         L     @14,@PC00009+4                                      1807
         ST    @14,@AL00001+8                                      1807
         ST    @04,@AL00001+12                                     1807
         ST    @15,@AL00001+16                                     1807
         LA    @01,@AL00001                                        1807
         BAL   @14,LVLRPROC                                        1807
*            RESPECIFY RTNREG RSTD;                                1808
*            TESTRC = RTNREG;                                      1809
         STH   RTNREG,TESTRC                                       1809
*            RESPECIFY RTNREG UNRSTD;                              1810
*            IF TESTRC ^= 0                                        1811
*              THEN                                                1811
         LH    @04,TESTRC                                          1811
         LTR   @04,@04                                             1811
         BZ    @RF01811                                            1811
*                RETURN CODE(LASTCC12);                            1812
         LA    @15,12                                              1812
         L     @14,@SA00009                                        1812
         LM    @00,@12,@SA00009+8                                  1812
         BR    @14                                                 1812
*            END;                                                  1813
*                                                                  1813
@RF01811 DS    0H                                                  1814
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO DETERMINE IF WE ARE CONSTRUCTING AN FVT FOR     */
*        /*  THE DEFINITION OF A GDG BASE OBJECT.                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1814
*        IF CTGFVTYP = CTGTGBS                                     1814
*          THEN                                                    1814
@RF01805 L     @04,@PC00009+8                                      1814
         L     @04,NFPTRFVT(,@04)                                  1814
         CLI   CTGFVTYP(@04),C'B'                                  1814
         BNE   @RF01814                                            1814
*            DO;                                                   1815
*                                                                  1815
*            /********************************************************/
*            /*                                                      */
*            /*  CTGFVLMT POINTS DIRECTLY TO ONE BYTE OF GDG LIMIT   */
*            /*  INFORMATION.                                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  1816
*            CTGFVLMT = DICTDL(LGDGLIM) + NFWKA;                   1816
*                                                                  1816
         L     @15,DICTPTR                                         1816
         L     @14,@PC00009+4                                      1816
         L     @14,NFWKA(,@14)                                     1816
         L     @03,DICTDL+16(,@15)                                 1816
         ALR   @03,@14                                             1816
         ST    @03,CTGFVLMT(,@04)                                  1816
*            /********************************************************/
*            /*                                                      */
*            /*  CTGFVGAT POINTS DIRECTLY TO ONE BYTE OF GDG         */
*            /*  ATTRIBUTE INFORMATION.                              */
*            /*                                                      */
*            /********************************************************/
*                                                                  1817
*            CTGFVGAT = DICTDL(LGDGATTR) + NFWKA;                  1817
*                                                                  1817
         AL    @14,DICTDL+24(,@15)                                 1817
         ST    @14,CTGFVGAT(,@04)                                  1817
*            END;                                                  1818
*                                                                  1818
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO DETERMINE IF THE OBJECT TO BE DEFINED IS        */
*        /*  AN ALIAS.                                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1819
*        IF CTGFVTYP = CTGTANM                                     1819
*          THEN                                                    1819
*                                                                  1819
@RF01814 L     @04,@PC00009+8                                      1819
         L     @04,NFPTRFVT(,@04)                                  1819
         CLI   CTGFVTYP(@04),C'X'                                  1819
         BNE   @RF01819                                            1819
*            /********************************************************/
*            /*                                                      */
*            /*  SET THE RELATED NAME IN THE CTGFVNAM FIELD FOR THE  */
*            /*  ALIAS ENTRY.                                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  1820
*            CTGFVNAM = NFRELATE;                                  1820
*                                                                  1820
         L     @15,@PC00009+12                                     1820
         L     @15,NFRELATE(,@15)                                  1820
         ST    @15,CTGFVNAM(,@04)                                  1820
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE OBJECT IS A NONVSAM, THEN BUILD FPLS FOR OWNER   */
*        /*  ID, DATA SET CREATION DATE, AND DATA SET EXPIRATION     */
*        /*  DATE.                                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1821
*        IF CTGFVTYP = CTGTALIN                                    1821
*          THEN                                                    1821
@RF01819 L     @04,@PC00009+8                                      1821
         L     @04,NFPTRFVT(,@04)                                  1821
         CLI   CTGFVTYP(@04),C'A'                                  1821
         BNE   @RF01821                                            1821
*            DO;                                                   1822
*                                                                  1822
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR OWNER ID                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1823
*            CALL BFPLPROC(ADDR(NVFLIST),LOWNERID,NFPLADDR,NFDICT, 1823
*               NFWKA,CTGFVOWN);                                   1823
*                                                                  1823
         LA    @15,NVFLIST                                         1823
         ST    @15,@AFTEMPS+12                                     1823
         LA    @15,@AFTEMPS+12                                     1823
         ST    @15,@AL00001                                        1823
         LA    @15,@CH00041                                        1823
         ST    @15,@AL00001+4                                      1823
         LA    @15,NFPLADDR                                        1823
         ST    @15,@AL00001+8                                      1823
         L     @15,@PC00009                                        1823
         ST    @15,@AL00001+12                                     1823
         L     @15,@PC00009+4                                      1823
         ST    @15,@AL00001+16                                     1823
         LA    @04,CTGFVOWN(,@04)                                  1823
         ST    @04,@AL00001+20                                     1823
         LA    @01,@AL00001                                        1823
         BAL   @14,BFPLPROC                                        1823
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR DATA SET CREATION DATE             */
*            /*                                                      */
*            /********************************************************/
*                                                                  1824
*            CALL BFPLPROC(ADDR(NVFLIST),LDSETCRD,NFPLADDR,NFDICT, 1824
*               NFWKA,CTGFVCRE);                                   1824
*                                                                  1824
         LA    @04,NVFLIST                                         1824
         ST    @04,@AFTEMPS+12                                     1824
         LA    @04,@AFTEMPS+12                                     1824
         ST    @04,@AL00001                                        1824
         LA    @04,@CH00040                                        1824
         ST    @04,@AL00001+4                                      1824
         LA    @04,NFPLADDR                                        1824
         ST    @04,@AL00001+8                                      1824
         L     @04,@PC00009                                        1824
         ST    @04,@AL00001+12                                     1824
         L     @04,@PC00009+4                                      1824
         ST    @04,@AL00001+16                                     1824
         L     @04,@PC00009+8                                      1824
         L     @04,NFPTRFVT(,@04)                                  1824
         LA    @04,CTGFVCRE(,@04)                                  1824
         ST    @04,@AL00001+20                                     1824
         LA    @01,@AL00001                                        1824
         BAL   @14,BFPLPROC                                        1824
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR DATA SET EXPIRATION DATE           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1825
*            CALL BFPLPROC(ADDR(NVFLIST),LDSETEXD,NFPLADDR,NFDICT, 1825
*               NFWKA,CTGFVEXP);                                   1825
*                                                                  1825
         LA    @04,NVFLIST                                         1825
         ST    @04,@AFTEMPS+12                                     1825
         LA    @04,@AFTEMPS+12                                     1825
         ST    @04,@AL00001                                        1825
         LA    @04,@CH00039                                        1825
         ST    @04,@AL00001+4                                      1825
         LA    @04,NFPLADDR                                        1825
         ST    @04,@AL00001+8                                      1825
         L     @04,@PC00009                                        1825
         ST    @04,@AL00001+12                                     1825
         L     @04,@PC00009+4                                      1825
         ST    @04,@AL00001+16                                     1825
         L     @04,@PC00009+8                                      1825
         L     @04,NFPTRFVT(,@04)                                  1825
         LA    @04,CTGFVEXP(,@04)                                  1825
         ST    @04,@AL00001+20                                     1825
         LA    @01,@AL00001                                        1825
         BAL   @14,BFPLPROC                                        1825
*            END;                                                  1826
*                                                                  1826
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE OBJECT IS A GDG BASE, THEN BUILD FPLS FOR OWNER  */
*        /*  ID, DATA SET CREATION DATE, AND DATA SET EXPIRATION     */
*        /*  DATE.                                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1827
*        IF CTGFVTYP = CTGTGBS                                     1827
*          THEN                                                    1827
@RF01821 L     @04,@PC00009+8                                      1827
         L     @04,NFPTRFVT(,@04)                                  1827
         CLI   CTGFVTYP(@04),C'B'                                  1827
         BNE   @RF01827                                            1827
*            DO;                                                   1828
*                                                                  1828
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR OWNER ID                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1829
*            CALL BFPLPROC(ADDR(GDFLIST),LGDOWN,NFPLADDR,NFDICT,   1829
*               NFWKA,CTGFVOWN);                                   1829
*                                                                  1829
         LA    @15,GDFLIST                                         1829
         ST    @15,@AFTEMPS+12                                     1829
         LA    @15,@AFTEMPS+12                                     1829
         ST    @15,@AL00001                                        1829
         LA    @15,@CH00288                                        1829
         ST    @15,@AL00001+4                                      1829
         LA    @15,NFPLADDR                                        1829
         ST    @15,@AL00001+8                                      1829
         L     @15,@PC00009                                        1829
         ST    @15,@AL00001+12                                     1829
         L     @15,@PC00009+4                                      1829
         ST    @15,@AL00001+16                                     1829
         LA    @04,CTGFVOWN(,@04)                                  1829
         ST    @04,@AL00001+20                                     1829
         LA    @01,@AL00001                                        1829
         BAL   @14,BFPLPROC                                        1829
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR DATA SET CREATION DATE             */
*            /*                                                      */
*            /********************************************************/
*                                                                  1830
*            CALL BFPLPROC(ADDR(GDFLIST),LGDDSCRD,NFPLADDR,NFDICT, 1830
*               NFWKA,CTGFVCRE);                                   1830
*                                                                  1830
         LA    @04,GDFLIST                                         1830
         ST    @04,@AFTEMPS+12                                     1830
         LA    @04,@AFTEMPS+12                                     1830
         ST    @04,@AL00001                                        1830
         LA    @04,@CH00041                                        1830
         ST    @04,@AL00001+4                                      1830
         LA    @04,NFPLADDR                                        1830
         ST    @04,@AL00001+8                                      1830
         L     @04,@PC00009                                        1830
         ST    @04,@AL00001+12                                     1830
         L     @04,@PC00009+4                                      1830
         ST    @04,@AL00001+16                                     1830
         L     @04,@PC00009+8                                      1830
         L     @04,NFPTRFVT(,@04)                                  1830
         LA    @04,CTGFVCRE(,@04)                                  1830
         ST    @04,@AL00001+20                                     1830
         LA    @01,@AL00001                                        1830
         BAL   @14,BFPLPROC                                        1830
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR DATA SET EXPIRATION DATE           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1831
*            CALL BFPLPROC(ADDR(GDFLIST),LGDDSEXD,NFPLADDR,NFDICT, 1831
*               NFWKA,CTGFVEXP);                                   1831
*                                                                  1831
         LA    @04,GDFLIST                                         1831
         ST    @04,@AFTEMPS+12                                     1831
         LA    @04,@AFTEMPS+12                                     1831
         ST    @04,@AL00001                                        1831
         LA    @04,@CH00040                                        1831
         ST    @04,@AL00001+4                                      1831
         LA    @04,NFPLADDR                                        1831
         ST    @04,@AL00001+8                                      1831
         L     @04,@PC00009                                        1831
         ST    @04,@AL00001+12                                     1831
         L     @04,@PC00009+4                                      1831
         ST    @04,@AL00001+16                                     1831
         L     @04,@PC00009+8                                      1831
         L     @04,NFPTRFVT(,@04)                                  1831
         LA    @04,CTGFVEXP(,@04)                                  1831
         ST    @04,@AL00001+20                                     1831
         LA    @01,@AL00001                                        1831
         BAL   @14,BFPLPROC                                        1831
*            END;                                                  1832
*                                                                  1832
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLER WITH SUCCESS INDICATED.            */
*        /*                                                          */
*        /************************************************************/
*                                                                  1833
*        RETURN CODE(0);                                           1833
*                                                                  1833
@RF01827 SLR   @15,@15                                             1833
         L     @14,@SA00009                                        1833
         LM    @00,@12,@SA00009+8                                  1833
         BR    @14                                                 1833
*        RESPECIFY CTGFV BASED(CTGFVPTR);                          1834
*                                                                  1834
*END NFVTPROC;                                                     1835
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - GDGPROC                                */
*        /*                                                          */
*        /*  FUNCTION - READ CATALOG AND DATA RECORDS FROM THE       */
*        /*  PORTABLE DATA SET, AND PERFORM A DEFINE OF A GDG BASE   */
*        /*  AND ITS ASSOCIATIONS IN A VS2 VSAM CATALOG OR PRINT     */
*        /*  AN ERROR MESSAGE FOR A DOS OR A VS1 CATALOG.            */
*        /*                                                          */
*        /*  INPUT - FUNCTION DEFINITION TABLE                       */
*        /*                                                          */
*        /*  OUTPUT - A RECREATED GDG BASE AND ITS ASSOCIATIONS OR   */
*        /*  APPROPRIATE ERROR MESSAGES.                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1836
*GDGPROC: PROCEDURE;                                               1836
*                                                                  1836
GDGPROC  STM   @14,@12,@SA00010                                    1836
*        OLDERID2 = NEWERID2;                                      1837
         L     @04,@PC00001                                        1837
         L     @04,GDTTR2(,@04)                                    1837
         MVC   @TS00001(95),NEWERID2(@04)                          1837
         MVC   OLDERID2(95,@04),@TS00001                           1837
*        NEWID2 = 'RMGD';                                          1838
*                                                                  1838
         MVC   NEWID2(4,@04),@CC01461                              1838
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE ADDRESS OF THE CONTROL RECORD BUFFER WHICH      */
*        /*  WILL CONTAIN THE DICTIONARY FOR THE CATALOG RECORD.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1839
*        CONRCPTR = ADDR(CONRCARE);                                1839
*                                                                  1839
         LA    @04,CONRCARE                                        1839
         ST    @04,CONRCPTR                                        1839
*        /************************************************************/
*        /*                                                          */
*        /*  ZERO OUT THE AREA THAT HOLDS THE CONTROL RECORDS.       */
*        /*  BEGIN BY INITIALIZING THE VALUES OF ZSIZE, ZPTR,        */
*        /*  AND ZCNTRL.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1840
*        ZSIZE = LENGTH(CONRCARE);                                 1840
         MVC   ZSIZE(2),@CH00920                                   1840
*        ZPTR = CONRCPTR;                                          1841
         ST    @04,ZPTR                                            1841
*        ZCNTRL = ON;                                              1842
*                                                                  1842
         OI    ZCNTRL,B'10000000'                                  1842
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP CLEARING THE AREA THAT IS TO HOLD THE CONTROL      */
*        /*  RECORD.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1843
*        DO WHILE (ZCNTRL = ON);                                   1843
         B     @DE01843                                            1843
@DL01843 DS    0H                                                  1844
*          IF ZSIZE > 256                                          1844
*            THEN                                                  1844
         LH    @04,ZSIZE                                           1844
         LA    @15,256                                             1844
         CR    @04,@15                                             1844
         BNH   @RF01844                                            1844
*              DO;                                                 1845
*              ZAREA(1:256) = ZER(1:256);                          1846
         L     @14,ZPTR                                            1846
         MVC   ZAREA(256,@14),ZER                                  1846
*              ZSIZE = ZSIZE - 256;                                1847
         SLR   @04,@15                                             1847
         STH   @04,ZSIZE                                           1847
*              ZPTR = ZPTR + 256;                                  1848
         ALR   @14,@15                                             1848
         ST    @14,ZPTR                                            1848
*              END;                                                1849
*            ELSE                                                  1850
*              DO;                                                 1850
         B     @RC01844                                            1850
@RF01844 DS    0H                                                  1851
*              ZAREA(1:ZSIZE) = ZER(1:ZSIZE);                      1851
         L     @04,ZPTR                                            1851
         LH    @15,ZSIZE                                           1851
         BCTR  @15,0                                               1851
         EX    @15,@SM01777                                        1851
*              ZCNTRL = OFF;                                       1852
         NI    ZCNTRL,B'01111111'                                  1852
*              END;                                                1853
*        END;                                                      1854
*                                                                  1854
@RC01844 DS    0H                                                  1854
@DE01843 TM    ZCNTRL,B'10000000'                                  1854
         BO    @DL01843                                            1854
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT THE CPL TO BE USED FOR THE DEFINE FUNCTION.   */
*        /*  IF THE CONSTRUCTION FAILS, RETURN TO THE CALLING        */
*        /*  PROCESSOR WITH AN ERROR INDICATOR.                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1855
*        CALL CPLPROC('F',GDPTRCPL,NULLPARM,NULLPARM,NULLPARM);    1855
*                                                                  1855
         MVC   @AL00001(20),@AL01855                               1855
         LA    @04,GDPTRCPL                                        1855
         ST    @04,@AL00001+4                                      1855
         LA    @01,@AL00001                                        1855
         BAL   @14,CPLPROC                                         1855
*        RESPECIFY RTNREG RSTD;                                    1856
*        TESTRC = RTNREG;                                          1857
         STH   RTNREG,TESTRC                                       1857
*        RESPECIFY RTNREG UNRSTD;                                  1858
*        IF TESTRC ^= 0                                            1859
*          THEN                                                    1859
         LH    @04,TESTRC                                          1859
         LTR   @04,@04                                             1859
         BZ    @RF01859                                            1859
*            RETURN CODE(LASTCC12);                                1860
*                                                                  1860
         LA    @15,12                                              1860
         L     @14,@SA00010                                        1860
         LM    @00,@12,@SA00010+8                                  1860
         BR    @14                                                 1860
*        /************************************************************/
*        /*                                                          */
*        /*  SET CTGPLPTR TO BE GDPTRCPL, SO THAT IT POINTS TO THE   */
*        /*  CPL BUILT FOR THE GDG BASE.                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1861
*        CTGPLPTR = GDPTRCPL;                                      1861
*                                                                  1861
@RF01859 L     @04,GDPTRCPL                                        1861
         ST    @04,CTGPLPTR                                        1861
*        /************************************************************/
*        /*                                                          */
*        /*  NOW GET THE CONTROL RECORD AND PUT IT INTO THE BUFFER.  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1862
*        CALL IDCIOGT0(GDTTBL,PINIOCS);                            1862
*                                                                  1862
         L     @04,@PC00001                                        1862
         ST    @04,@AL00001                                        1862
         LA    @15,PINIOCS                                         1862
         ST    @15,@AL00001+4                                      1862
         MVI   @AL00001+4,X'80'                                    1862
         L     @15,GDTGET(,@04)                                    1862
         LA    @01,@AL00001                                        1862
         BALR  @14,@15                                             1862
*        RESPECIFY RTNREG RSTD;                                    1863
*        TESTRC = RTNREG;                                          1864
         STH   RTNREG,TESTRC                                       1864
*        RESPECIFY RTNREG UNRSTD;                                  1865
*        IF TESTRC ^= 0                                            1866
*          THEN                                                    1866
         LH    @04,TESTRC                                          1866
         LTR   @04,@04                                             1866
         BZ    @RF01866                                            1866
*            RETURN CODE(LASTCC12);                                1867
*                                                                  1867
         LA    @15,12                                              1867
         L     @14,@SA00010                                        1867
         LM    @00,@12,@SA00010+8                                  1867
         BR    @14                                                 1867
*        TFVTLEN = IOCDAD -> HEADLN;                               1868
@RF01866 L     @04,IOCSPTR                                         1868
         L     @01,IOCDAD(,@04)                                    1868
         LH    @15,HEADLN(,@01)                                    1868
         STH   @15,TFVTLEN                                         1868
*        CALL MVDAPROC(TFVTLEN,IOCDAD,CONRCPTR);                   1869
*                                                                  1869
         LA    @15,TFVTLEN                                         1869
         ST    @15,@AL00001                                        1869
         ST    @04,@AL00001+4                                      1869
         LA    @04,CONRCPTR                                        1869
         ST    @04,@AL00001+8                                      1869
         LA    @01,@AL00001                                        1869
         BAL   @14,MVDAPROC                                        1869
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO MAKE SURE THAT WE GOT A CATALOG CONTROL         */
*        /*  RECORD.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1870
*        IF HEADFLG1 ^= HDFL1CAT × HEADFLG2 ^= HDFL2GDG            1870
*          THEN                                                    1870
         L     @04,CONRCPTR                                        1870
         CLI   HEADFLG1(@04),X'FF'                                 1870
         BNE   @RT01870                                            1870
         CLI   HEADFLG2(@04),C'B'                                  1870
         BE    @RF01870                                            1870
@RT01870 DS    0H                                                  1871
*            DO;                                                   1871
*                                                                  1871
*            /********************************************************/
*            /*                                                      */
*            /*  WE DID NOT GET A CATALOG CONTROL RECORD.  THE       */
*            /*  PORTABLE DATA SET IS IN ERROR.  RETURN TO THE       */
*            /*  CALLER WITH AN ERROR INDICATION.                    */
*            /*                                                      */
*            /********************************************************/
*                                                                  1872
*            DEFSTID = PORTERR;                                    1872
         MVI   DEFSTID,X'01'                                       1872
*            RETURN CODE(LASTCC12);                                1873
         LA    @15,12                                              1873
         L     @14,@SA00010                                        1873
         LM    @00,@12,@SA00010+8                                  1873
         BR    @14                                                 1873
*            END;                                                  1874
*                                                                  1874
*        /************************************************************/
*        /*                                                          */
*        /*  SET THE VALUE OF THE AMOUNT OF SPACE REQUIRED FOR       */
*        /*  THE CATALOG DATA RECORD.                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1875
*        TOTLEN = ASSRECLN;                                        1875
*                                                                  1875
@RF01870 L     @04,CONRCPTR                                        1875
         LH    @04,ASSRECLN(,@04)                                  1875
         ST    @04,TOTLEN                                          1875
*        /************************************************************/
*        /*                                                          */
*        /*  ISSUE A UGPOOL TO GET THE BUFFER FOR THE DATA RECORD.   */
*        /*  SHOULD THIS FAIL, RETURN TO THE CALLING PROCESSOR WITH  */
*        /*  AN ERROR INDICATION.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1876
*        CALL IDCSAGP0(GDTTBL,TOTLEN,GDWORKAR,GPID,SETZERO);       1876
*                                                                  1876
         L     @04,@PC00001                                        1876
         ST    @04,@AL00001                                        1876
         LA    @15,TOTLEN                                          1876
         ST    @15,@AL00001+4                                      1876
         LA    @15,GDWORKAR                                        1876
         ST    @15,@AL00001+8                                      1876
         LA    @15,GPID                                            1876
         ST    @15,@AL00001+12                                     1876
         LA    @15,SETZERO                                         1876
         ST    @15,@AL00001+16                                     1876
         MVI   @AL00001+16,X'80'                                   1876
         L     @15,GDTGPL(,@04)                                    1876
         LA    @01,@AL00001                                        1876
         BALR  @14,@15                                             1876
*        RESPECIFY RTNREG RSTD;                                    1877
*        TESTRC = RTNREG;                                          1878
         STH   RTNREG,TESTRC                                       1878
*        RESPECIFY RTNREG UNRSTD;                                  1879
*        IF TESTRC ^= 0                                            1880
*          THEN                                                    1880
         LH    @04,TESTRC                                          1880
         LTR   @04,@04                                             1880
         BZ    @RF01880                                            1880
*            DO;                                                   1881
*            DEFSTID = NOSTORAG;                                   1882
         MVI   DEFSTID,X'04'                                       1882
*            DARGSMOD = UNIVMSG;                                   1883
         L     @04,DDSTRU                                          1883
         MVC   DARGSMOD(3,@04),@CC00981                            1883
*            END;                                                  1884
*                                                                  1884
*        /************************************************************/
*        /*                                                          */
*        /*  GET THE DATA RECORD USING GETPROC TO ASSEMBLE IT IN     */
*        /*  THE BUFFER.                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1885
*        CALL GETPROC(GDWORKAR,ASSRECLN);                          1885
@RF01880 LA    @04,GDWORKAR                                        1885
         ST    @04,@AL00001                                        1885
         L     @04,CONRCPTR                                        1885
         LA    @04,ASSRECLN(,@04)                                  1885
         ST    @04,@AL00001+4                                      1885
         LA    @01,@AL00001                                        1885
         BAL   @14,GETPROC                                         1885
*        RESPECIFY RTNREG RSTD;                                    1886
*        TESTRC = RTNREG;                                          1887
         STH   RTNREG,TESTRC                                       1887
*        RESPECIFY RTNREG UNRSTD;                                  1888
*        IF TESTRC ^= 0                                            1889
*          THEN                                                    1889
         LH    @04,TESTRC                                          1889
         LTR   @04,@04                                             1889
         BZ    @RF01889                                            1889
*            RETURN CODE(LASTCC12);                                1890
*                                                                  1890
         LA    @15,12                                              1890
         L     @14,@SA00010                                        1890
         LM    @00,@12,@SA00010+8                                  1890
         BR    @14                                                 1890
*        DICTPTR = ADDR(VARDATA);                                  1891
@RF01889 L     @04,CONRCPTR                                        1891
         LA    @04,VARDATA(,@04)                                   1891
         ST    @04,DICTPTR                                         1891
*        /************************************************************/
*        /*                                                          */
*        /*  CALL NFVTPROC TO BUILD THE FVT TO BE USED TO DEFINE     */
*        /*  THE GDG BASE ENTRY.                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1892
*        CALL NFVTPROC(DICTPTR,GDWORKAR,GDFVTPTR,NULLPARM);        1892
*                                                                  1892
         LA    @04,DICTPTR                                         1892
         ST    @04,@AL00001                                        1892
         LA    @04,GDWORKAR                                        1892
         ST    @04,@AL00001+4                                      1892
         LA    @04,GDFVTPTR                                        1892
         ST    @04,@AL00001+8                                      1892
         LA    @04,NULLPARM                                        1892
         ST    @04,@AL00001+12                                     1892
         LA    @01,@AL00001                                        1892
         BAL   @14,NFVTPROC                                        1892
*        /************************************************************/
*        /*                                                          */
*        /*  TEST THE RETURN CODE AND RETURN TO THE CALLING          */
*        /*  PROCESSOR IF AN ERROR IS INDICATED.                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1893
*        RESPECIFY RTNREG RSTD;                                    1893
*        TESTRC = RTNREG;                                          1894
         STH   RTNREG,TESTRC                                       1894
*        RESPECIFY RTNREG UNRSTD;                                  1895
*        IF TESTRC ^= 0                                            1896
*          THEN                                                    1896
         LH    @04,TESTRC                                          1896
         LTR   @04,@04                                             1896
         BZ    @RF01896                                            1896
*            RETURN CODE(LASTCC12);                                1897
*                                                                  1897
         LA    @15,12                                              1897
         L     @14,@SA00010                                        1897
         LM    @00,@12,@SA00010+8                                  1897
         BR    @14                                                 1897
*        CTGFVT = GDFVTPTR;                                        1898
*                                                                  1898
@RF01896 L     @04,GDFVTPTR                                        1898
         L     @01,CTGPLPTR                                        1898
         ST    @04,CTGFVT(,@01)                                    1898
*        /************************************************************/
*        /*                                                          */
*        /*  WE OMIT SCANNING THE OBJECTS LIST FOR THERE ARE NO      */
*        /*  OBJECTS SUBPARAMETERS THAT APPLY TO GDG BASES.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1899
*        /************************************************************/
*        /*                                                          */
*        /*  SAVE THE CPL, THE FVT, AND THE FPL'S PRIOR TO INVOKING  */
*        /*  CATALOG MANAGEMENT.  IF THE GDG OBJECT IS A             */
*        /*  DUPLICATE, IT IS DELETED, AND REDEFINED INTO THE        */
*        /*  CATALOG.                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1899
*        TFVTLEN = LENGTH(CTGFV) + (LENGTH(CTGFL)+8)*NVNUMFLD +    1899
*           LENGTH(IDAAMDSB);                               /*OZ09380*/
         LA    @15,380                                             1899
         STH   @15,TFVTLEN                                         1899
*        SAVCPL = GDPTRCPL -> FIELDR(1:LENGTH(CTGPL)+16);          1900
*                                                                  1900
         L     @01,GDPTRCPL                                        1900
         MVC   SAVCPL(44),FIELDR(@01)                              1900
*        /************************************************************/
*        /*                                                          */
*        /*  POINT TO THE SAVE AREA FOR THE FVT, WHICH FOLLOWS       */
*        /*  THE AREA FOR THE FVT ITSELF.  THIS LOCATION IN CORE     */
*        /*  HODLS THE FVT, THE FPL'S, AND THE AMDSB.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1901
*        GDSAVFVT = GDFVTPTR + TFVTLEN;                            1901
*                                                                  1901
         ALR   @04,@15                                             1901
         ST    @04,GDSAVFVT                                        1901
*        CALL MVDAPROC(TFVTLEN,GDFVTPTR,GDSAVFVT);                 1902
*                                                                  1902
         LA    @04,TFVTLEN                                         1902
         ST    @04,@AL00001                                        1902
         LA    @04,GDFVTPTR                                        1902
         ST    @04,@AL00001+4                                      1902
         LA    @04,GDSAVFVT                                        1902
         ST    @04,@AL00001+8                                      1902
         LA    @01,@AL00001                                        1902
         BAL   @14,MVDAPROC                                        1902
*        /************************************************************/
*        /*                                                          */
*        /*  CALL CTLGPROC TO ACTUALLY INVOKE VSAM CATALOG           */
*        /*  MANAGEMENT TO DO THE DEFINE OF THE GDG BASE.            */
*        /*  SET IMPF2NER TO BE ON TO INDICATE THAT ERROR            */
*        /*  MESSAGES ARE TO BE SUPPRESSED.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1903
*        IMPF2NER = ON;                                            1903
         OI    IMPF2NER,B'00001000'                                1903
*        CALL CTLGPROC(GDPTRCPL);                                  1904
         LA    @04,GDPTRCPL                                        1904
         ST    @04,@AL00001                                        1904
         LA    @01,@AL00001                                        1904
         BAL   @14,CTLGPROC                                        1904
*        RESPECIFY RTNREG RSTD;                                    1905
*        TESTRC = RTNREG;                                          1906
         STH   RTNREG,TESTRC                                       1906
*        RESPECIFY RTNREG UNRSTD;                                  1907
*                                                                  1907
*        /************************************************************/
*        /*                                                          */
*        /*  RESET IMPF2NER TO BE OFF TO INDICATE THAT ERROR         */
*        /*  MESSAGES ARE TO BE PRINTED.                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1908
*        IMPF2NER = OFF;                                           1908
*                                                                  1908
         NI    IMPF2NER,B'11110111'                                1908
*        /************************************************************/
*        /*                                                          */
*        /*  A NONZERO RETURN CODE INDICATES THAT CATALOG WAS NOT    */
*        /*  ABLE TO DEFINE THE USER CATALOG POINTER.                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1909
*        IF TESTRC ^= 0                                            1909
*          THEN                                                    1909
*                                                                  1909
         LH    @04,TESTRC                                          1909
         LTR   @04,@04                                             1909
         BZ    @RF01909                                            1909
*            /********************************************************/
*            /*                                                      */
*            /*  TEST FOR A VSAM CATALOG RETURN CODE OF 8.  THIS     */
*            /*  INDICATES THAT THERE IS A DUPLICATE NAME IN THE     */
*            /*  IN THE CATALOG.                                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  1910
*            IF CATLGRC ^= DUPNAME                                 1910
*              THEN                                                1910
         CLC   CATLGRC(2),@CH00039                                 1910
         BE    @RF01910                                            1910
*                DO;                                               1911
*                DARGSMOD = IMPMSG;                                1912
         L     @04,DDSTRU                                          1912
         MVC   DARGSMOD(3,@04),@CC00945                            1912
*                DARGSENT = MPRAFAIL;                              1913
         MVI   DARGSENT(@04),X'15'                                 1913
*                DARGILP = LENGTH(FENTNAME);                       1914
         MVC   DARGILP(2,@04),@CH00605                             1914
*                DARGDBP = GDFVTPTR -> CTGFVENT;                   1915
*                                                                  1915
         L     @01,GDFVTPTR                                        1915
         L     @15,CTGFVENT(,@01)                                  1915
         ST    @15,DARGDBP(,@04)                                   1915
*                CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);             1916
         L     @04,@PC00001                                        1916
         ST    @04,@AL00001                                        1916
         LA    @15,@CF00119                                        1916
         ST    @15,@AL00001+4                                      1916
         LA    @15,DDSTRU                                          1916
         ST    @15,@AL00001+8                                      1916
         MVI   @AL00001+8,X'80'                                    1916
         L     @15,GDTPRT(,@04)                                    1916
         LA    @01,@AL00001                                        1916
         BALR  @14,@15                                             1916
*                DARGLIST = ''B;                                   1917
         L     @04,DDSTRU                                          1917
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1917
*                DARGSMOD = IMPMSG;                                1918
*                                                                  1918
         MVC   DARGSMOD(3,@04),@CC00945                            1918
*                RETURN CODE(LASTCC08);                            1919
         LA    @15,8                                               1919
         L     @14,@SA00010                                        1919
         LM    @00,@12,@SA00010+8                                  1919
         BR    @14                                                 1919
*                END;                                              1920
*              ELSE                                                1921
*DUPGDG:         DO;                                               1921
@RF01910 DS    0H                                                  1921
DUPGDG   DS    0H                                                  1922
*                OLDERID2 = NEWERID2;                              1922
         L     @04,@PC00001                                        1922
         L     @04,GDTTR2(,@04)                                    1922
         MVC   @TS00001(95),NEWERID2(@04)                          1922
         MVC   OLDERID2(95,@04),@TS00001                           1922
*                NEWID2 = 'RMDG';                                  1923
*                                                                  1923
         MVC   NEWID2(4,@04),@CC01464                              1923
*                /****************************************************/
*                /*                                                  */
*                /*  AN ENTRY FOR THE OBJECT TO BE DEFINED ALREADY   */
*                /*  EXISTS IN THE CATALOG.  CALL CPLPROC TO BUILD   */
*                /*  A CPL FOR THE DELETE FUNCTION.                  */
*                /*                                                  */
*                /****************************************************/
*                                                                  1924
*                CALL CPLPROC('D',DCPLPTR,CTGFVENT,NULLPARM,CPSWD);
*                                                                  1924
         LA    @04,@CC00751                                        1924
         ST    @04,@AL00001                                        1924
         LA    @04,DCPLPTR                                         1924
         ST    @04,@AL00001+4                                      1924
         L     @04,CTGFVPTR                                        1924
         LA    @04,CTGFVENT(,@04)                                  1924
         ST    @04,@AL00001+8                                      1924
         LA    @04,NULLPARM                                        1924
         ST    @04,@AL00001+12                                     1924
         LA    @04,CPSWD                                           1924
         ST    @04,@AL00001+16                                     1924
         LA    @01,@AL00001                                        1924
         BAL   @14,CPLPROC                                         1924
*                /****************************************************/
*                /*                                                  */
*                /*  TEST THE RETURN CODE FROM CPLPROC.  IF THE CPL  */
*                /*  WAS NOT BUILT RETURN TO THE CALLING PROCESSOR.  */
*                /*                                                  */
*                /****************************************************/
*                                                                  1925
*                RESPECIFY RTNREG RSTD;                            1925
*                TESTRC = RTNREG;                                  1926
         STH   RTNREG,TESTRC                                       1926
*                RESPECIFY RTNREG UNRSTD;                          1927
*                IF TESTRC ^= 0                                    1928
*                  THEN                                            1928
         LH    @04,TESTRC                                          1928
         LTR   @04,@04                                             1928
         BZ    @RF01928                                            1928
*                    RETURN CODE(LASTCC12);                        1929
*                                                                  1929
         LA    @15,12                                              1929
         L     @14,@SA00010                                        1929
         LM    @00,@12,@SA00010+8                                  1929
         BR    @14                                                 1929
*                /****************************************************/
*                /*                                                  */
*                /*  IN ORDER TO FORCE DELETE A NONEMPTY GDG BASE,   */
*                /*  SET CTGSCR TO ON.                               */
*                /*                                                  */
*                /****************************************************/
*                                                                  1930
*                CTGSCR = ON;                                      1930
*                                                                  1930
@RF01928 L     @04,CTGPLPTR                                        1930
         OI    CTGSCR(@04),B'00000010'                             1930
*                /****************************************************/
*                /*                                                  */
*                /*  CALL DELTPROC TO DELETE THE GDG BASE AND ITS    */
*                /*  ASSOCIATIONS.                                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  1931
*                CALL DELTPROC(DCPLPTR);                           1931
*                                                                  1931
         LA    @04,DCPLPTR                                         1931
         ST    @04,@AL00001                                        1931
         LA    @01,@AL00001                                        1931
         BAL   @14,DELTPROC                                        1931
*                /****************************************************/
*                /*                                                  */
*                /*  TEST THE RETURN CODE FROM DELTPROC.  IF IT IS   */
*                /*  NON-ZERO, RETURN TO THE CALLING PROCESSOR WITH  */
*                /*  AN ERROR INDICATION.  OTHERWISE, RESET THE      */
*                /*  VALUE OF DEFSTID TO NORMSTAT TO INDICATE THAT   */
*                /*  THE ERROR INCURRED ON THE FIRST CMS DEFINE      */
*                /*  HAS BEEN CLEARED.                               */
*                /*                                                  */
*                /****************************************************/
*                                                                  1932
*                RESPECIFY RTNREG RSTD;                            1932
*                TESTRC = RTNREG;                                  1933
         STH   RTNREG,TESTRC                                       1933
*                RESPECIFY RTNREG UNRSTD;                          1934
*                IF TESTRC ^= 0                                    1935
*                  THEN                                            1935
         LH    @04,TESTRC                                          1935
         LTR   @04,@04                                             1935
         BZ    @RF01935                                            1935
*                    DO;                                           1936
*                    DARGSENT = MPRAFAIL;                          1937
         L     @04,DDSTRU                                          1937
         MVI   DARGSENT(@04),X'15'                                 1937
*                    DARGSMOD = IMPMSG;                            1938
         MVC   DARGSMOD(3,@04),@CC00945                            1938
*                    DARGILP = LENGTH(FENTNAME);                   1939
         MVC   DARGILP(2,@04),@CH00605                             1939
*                    DARGDBP = GDFVTPTR -> CTGFVENT;               1940
         L     @01,GDFVTPTR                                        1940
         L     @15,CTGFVENT(,@01)                                  1940
         ST    @15,DARGDBP(,@04)                                   1940
*                    CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);         1941
         L     @04,@PC00001                                        1941
         ST    @04,@AL00001                                        1941
         LA    @15,@CF00119                                        1941
         ST    @15,@AL00001+4                                      1941
         LA    @15,DDSTRU                                          1941
         ST    @15,@AL00001+8                                      1941
         MVI   @AL00001+8,X'80'                                    1941
         L     @15,GDTPRT(,@04)                                    1941
         LA    @01,@AL00001                                        1941
         BALR  @14,@15                                             1941
*                    DARGLIST = ''B;                               1942
         L     @04,DDSTRU                                          1942
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1942
*                    DARGSMOD = IMPMSG;                            1943
         MVC   DARGSMOD(3,@04),@CC00945                            1943
*                    END;                                          1944
*                                                                  1944
*                /****************************************************/
*                /*                                                  */
*                /*  RESTORE THE CATALOG PARAMETER LISTS TO THEIR    */
*                /*  STATE PRIOR TO THE FIRST CMS DEFINE OPERATION.  */
*                /*                                                  */
*                /****************************************************/
*                                                                  1945
*                GDPTRCPL -> FIELDR(1:LENGTH(CTGPL)+16) = SAVCPL;  1945
@RF01935 L     @04,GDPTRCPL                                        1945
         MVC   FIELDR(44,@04),SAVCPL                               1945
*                CALL MVDAPROC(TFVTLEN,GDSAVFVT,GDFVTPTR);         1946
*                                                                  1946
         LA    @04,TFVTLEN                                         1946
         ST    @04,@AL00001                                        1946
         LA    @04,GDSAVFVT                                        1946
         ST    @04,@AL00001+4                                      1946
         LA    @04,GDFVTPTR                                        1946
         ST    @04,@AL00001+8                                      1946
         LA    @01,@AL00001                                        1946
         BAL   @14,MVDAPROC                                        1946
*                /****************************************************/
*                /*                                                  */
*                /*  CALL CTLGPROC TO INVOKE CATALOG MANAGEMENT.     */
*                /*                                                  */
*                /****************************************************/
*                                                                  1947
*                CALL CTLGPROC(GDPTRCPL);                          1947
*                                                                  1947
         LA    @04,GDPTRCPL                                        1947
         ST    @04,@AL00001                                        1947
         LA    @01,@AL00001                                        1947
         BAL   @14,CTLGPROC                                        1947
*                /****************************************************/
*                /*                                                  */
*                /*  TEST THE RETURN CODE FROM CTLGPROC.  IF IT IS   */
*                /*  NON-ZERO, THE SECOND ATTEMPT TO DEFINE THE      */
*                /*  OBJECT HAS ALSO FAILED.  RETURN TO THE CALLING  */
*                /*  PROCESSOR WITH AN ERROR INDICATED.              */
*                /*                                                  */
*                /****************************************************/
*                                                                  1948
*                RESPECIFY RTNREG RSTD;                            1948
*                TESTRC = RTNREG;                                  1949
         STH   RTNREG,TESTRC                                       1949
*                RESPECIFY RTNREG UNRSTD;                          1950
*                IF TESTRC ^= 0                                    1951
*                  THEN                                            1951
         LH    @04,TESTRC                                          1951
         LTR   @04,@04                                             1951
         BZ    @RF01951                                            1951
*                    DO;                                           1952
*                    DARGSENT = MPRAFAIL;                          1953
         L     @04,DDSTRU                                          1953
         MVI   DARGSENT(@04),X'15'                                 1953
*                    DARGSMOD = IMPMSG;                            1954
         MVC   DARGSMOD(3,@04),@CC00945                            1954
*                    DARGILP = LENGTH(FENTNAME);                   1955
         MVC   DARGILP(2,@04),@CH00605                             1955
*                    DARGDBP = GDFVTPTR -> CTGFVENT;               1956
         L     @01,GDFVTPTR                                        1956
         L     @15,CTGFVENT(,@01)                                  1956
         ST    @15,DARGDBP(,@04)                                   1956
*                    CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);         1957
         L     @04,@PC00001                                        1957
         ST    @04,@AL00001                                        1957
         LA    @15,@CF00119                                        1957
         ST    @15,@AL00001+4                                      1957
         LA    @15,DDSTRU                                          1957
         ST    @15,@AL00001+8                                      1957
         MVI   @AL00001+8,X'80'                                    1957
         L     @15,GDTPRT(,@04)                                    1957
         LA    @01,@AL00001                                        1957
         BALR  @14,@15                                             1957
*                    DARGLIST = ''B;                               1958
         L     @04,DDSTRU                                          1958
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1958
*                    DARGSMOD = IMPMSG;                            1959
         MVC   DARGSMOD(3,@04),@CC00945                            1959
*                    END;                                          1960
*                                                                  1960
*                END DUPGDG;                                       1961
*                                                                  1961
@RF01951 DS    0H                                                  1962
*        /************************************************************/
*        /*                                                          */
*        /*  PRINT A MESSAGE TO INDICATE WHAT HAS BEEN IMPORTED      */
*        /*  SUCCESSFULLY.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1962
*        DARGSMOD = IMPMSG;                                        1962
@RF01909 L     @04,DDSTRU                                          1962
         MVC   DARGSMOD(3,@04),@CC00945                            1962
*        DARGSENT = MPRASUCC;                                      1963
         MVI   DARGSENT(@04),X'1A'                                 1963
*        DARGILP = LENGTH(FENTNAME);                               1964
         MVC   DARGILP(2,@04),@CH00605                             1964
*        DARGDBP = GDFVTPTR -> CTGFVENT;                           1965
         L     @01,GDFVTPTR                                        1965
         L     @15,CTGFVENT(,@01)                                  1965
         ST    @15,DARGDBP(,@04)                                   1965
*        CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                     1966
         L     @04,@PC00001                                        1966
         ST    @04,@AL00001                                        1966
         LA    @15,@CF00119                                        1966
         ST    @15,@AL00001+4                                      1966
         LA    @15,DDSTRU                                          1966
         ST    @15,@AL00001+8                                      1966
         MVI   @AL00001+8,X'80'                                    1966
         L     @15,GDTPRT(,@04)                                    1966
         LA    @01,@AL00001                                        1966
         BALR  @14,@15                                             1966
*        DARGLIST = ''B;                                           1967
         L     @04,DDSTRU                                          1967
         XC    DARGLIST(20,@04),DARGLIST(@04)                      1967
*        DARGSMOD = IMPMSG;                                        1968
*                                                                  1968
         MVC   DARGSMOD(3,@04),@CC00945                            1968
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE DATA RECORD BUFFER.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1969
*        CALL IDCSAFS0(GDTTBL,GDWORKAR);                           1969
*                                                                  1969
         L     @04,@PC00001                                        1969
         ST    @04,@AL00001                                        1969
         LA    @15,GDWORKAR                                        1969
         ST    @15,@AL00001+4                                      1969
         L     @15,GDTFSP(,@04)                                    1969
         LA    @01,@AL00001                                        1969
         BALR  @14,@15                                             1969
*        RESPECIFY RTNREG RSTD;                                    1970
*        TESTRC = RTNREG;                                          1971
         STH   RTNREG,TESTRC                                       1971
*        RESPECIFY RTNREG UNRSTD;                                  1972
*        IF TESTRC ^= 0                                            1973
*          THEN                                                    1973
         LH    @04,TESTRC                                          1973
         LTR   @04,@04                                             1973
         BZ    @RF01973                                            1973
*            RETURN CODE(LASTCC12);                                1974
*                                                                  1974
         LA    @15,12                                              1974
         L     @14,@SA00010                                        1974
         LM    @00,@12,@SA00010+8                                  1974
         BR    @14                                                 1974
*        /************************************************************/
*        /*                                                          */
*        /*  FREE UP THE CORE GOTTEN FOR THE FVT AND FPL'S           */
*        /*  CONSTRUCTED FOR THE DEFINE OF THE GDG BASE.             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1975
*        CALL IDCSAFS0(GDTTBL,GDFVTPTR);                           1975
*                                                                  1975
@RF01973 L     @04,@PC00001                                        1975
         ST    @04,@AL00001                                        1975
         LA    @15,GDFVTPTR                                        1975
         ST    @15,@AL00001+4                                      1975
         L     @15,GDTFSP(,@04)                                    1975
         LA    @01,@AL00001                                        1975
         BALR  @14,@15                                             1975
*        RESPECIFY RTNREG RSTD;                                    1976
*        TESTRC = RTNREG;                                          1977
         STH   RTNREG,TESTRC                                       1977
*        RESPECIFY RTNREG UNRSTD;                                  1978
*        IF TESTRC ^= 0                                            1979
*          THEN                                                    1979
         LH    @04,TESTRC                                          1979
         LTR   @04,@04                                             1979
         BZ    @RF01979                                            1979
*            RETURN CODE(LASTCC12);                                1980
*                                                                  1980
         LA    @15,12                                              1980
         L     @14,@SA00010                                        1980
         LM    @00,@12,@SA00010+8                                  1980
         BR    @14                                                 1980
*        /************************************************************/
*        /*                                                          */
*        /*  THE NONVSAMS ASSOCIATED WITH THE GDG BASE OBJECT WERE   */
*        /*  PUT ON THE PORTABLE DATA SET BY EXPORTRA AS ASSOCIATED  */
*        /*  OBJECTS.  WE LOOP UNTIL A SOFTWARE EOF IS FOUND,        */
*        /*  DEFINING NONVSAMS AND THEIR ALIASES.                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1981
*        /************************************************************/
*        /*                                                          */
*        /*  SET GETEOF TO OFF TO INDICATE THAT THE END OF FILE      */
*        /*  HAS NOT BEEN FOUND.                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  1981
*        GETEOF = OFF;                                             1981
*                                                                  1981
@RF01979 NI    GETEOF,B'01111111'                                  1981
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE NVSMRDSW TO BE OFF.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1982
*        NVSMRDSW = OFF;                                           1982
*                                                                  1982
         NI    NVSMRDSW,B'01111111'                                1982
*        /************************************************************/
*        /*                                                          */
*        /*  WHILE THE END OF FILE HAS NOT BEEN FOUND, LOOP CALLING  */
*        /*  NVSMPROC TO DEFINE THE NONVSAM OBJECTS AND THEIR        */
*        /*  ALIASES.                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1983
*        DO WHILE GETEOF = OFF;                                    1983
*                                                                  1983
         B     @DE01983                                            1983
@DL01983 DS    0H                                                  1984
*          /**********************************************************/
*          /*                                                        */
*          /*  ISSUE THE CALL TO NVSMPROC, AND TEST THE RETURN       */
*          /*  CODE.                                                 */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1984
*          CALL NVSMPROC;                                          1984
         BAL   @14,NVSMPROC                                        1984
*          RESPECIFY RTNREG RSTD;                                  1985
*          TESTRC = RTNREG;                                        1986
         STH   RTNREG,TESTRC                                       1986
*          RESPECIFY RTNREG UNRSTD;                                1987
*          IF TESTRC ^= 0                                          1988
*            THEN                                                  1988
*                                                                  1988
         LH    @04,TESTRC                                          1988
         LTR   @04,@04                                             1988
         BZ    @RF01988                                            1988
*              /******************************************************/
*              /*                                                    */
*              /*  IF THE RETURN CODE FROM NVSMPROC INDICATES THAT   */
*              /*  A SEVERE ERROR HAS OCCURRED, RETURN TO THE        */
*              /*  CALLING PROCESSOR INDICATING THAT FACT.           */
*              /*                                                    */
*              /******************************************************/
*                                                                  1989
*              IF TESTRC = LASTCC12                                1989
*                THEN                                              1989
         LA    @15,12                                              1989
         CR    @04,@15                                             1989
         BNE   @RF01989                                            1989
*                  RETURN CODE(LASTCC12);                          1990
         L     @14,@SA00010                                        1990
         LM    @00,@12,@SA00010+8                                  1990
         BR    @14                                                 1990
*        END;                                                      1991
*                                                                  1991
@RF01989 DS    0H                                                  1991
@RF01988 DS    0H                                                  1991
@DE01983 TM    GETEOF,B'10000000'                                  1991
         BZ    @DL01983                                            1991
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLER                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1992
*        RETURN CODE(0);                                           1992
*                                                                  1992
         SLR   @15,@15                                             1992
         L     @14,@SA00010                                        1992
         LM    @00,@12,@SA00010+8                                  1992
         BR    @14                                                 1992
*END GDGPROC;                                                      1993
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - RANGPROC                               */
*        /*                                                          */
*        /*  FUNCTION - RANGPROC WILL PROCESS ALL INFORMATIION       */
*        /*  DEALING WITH KEYRANGES.  IT WILL BUILD THE RANGES LIST  */
*        /*  THE HIKEYV AND LOKEYV CATALOG INFORMATION FROM  VOLUME  */
*        /*  OF PORTABILITY.                                         */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    RX - INDEX TO OBJECT PARAMETER OR ZERO                */
*        /*    RDICT - DICTIONARY POINTER                            */
*        /*    RWKA - WORK AREA POINTER (CONTAINS CATALOG FIELD INFO)*/
*        /*    RRANGPTR - PTR TO FIELD IN WHICH TO PLACE LISTRNGS    */
*        /*    POINTER                                               */
*        /*                                                          */
*        /*  OUTPUT - A LISTRNGS LIST OF KEY RANGES WILL HAVE BEEN   */
*        /*  CONSTRUCTED                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1994
*RANGPROC: PROCEDURE(RX,               /*INDEX TO OBJECTS PARAMETER  */
*                   RDICT,             /*DICTIONARY POINTER          */
*                   RWKA,              /*WORK AREA POINTER           */
*                   RRANGPTR);         /*RETURN CELL FOR LISTRNGS    */
RANGPROC STM   @14,@12,@SA00011                                    1994
         MVC   @PC00011(16),0(@01)                                 1994
*                                      /*LIST                        */
*                                                                  1995
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1995
*        DCL RX        FIXED(31),                                  1995
*            RDICT     PTR(31),                                    1995
*            RWKA      PTR(31),                                    1995
*            RRANGPTR  PTR(31);                                    1995
*                                                                  1995
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARES                                          */
*        /*                                                          */
*        /************************************************************/
*        DCL KEYLENGH FIXED(31);                                   1996
*        DCL 1 FRANGLST BASED(RRANGPTR),                           1997
*              2 FRANGLN   FIXED(15);  /*LENGTH OF LIST EXCLUDING    */
*                                      /*THIS 2-BYTE FIELD           */
*        DCL 1 FRANGES BASED(FRANPTR1),/*DESCRIPTION OF EACH HIGH    */
*                                      /*KEY-LOW KEY PAIR            */
*                2 FKEYLN FIXED(15),   /*LENGTH OF LOW KEY           */
*                2 FKEY   CHAR(*);    /*VARIABLE LENGTH KEY          */
*        DCL FRANPTR1 PTR(31);         /*POINTER TO EACH MEMBER OF   */
*                                      /*LOW KEY-HIGH KEY PAIR       */
*                                                                  2000
*        DCL RPTR1  PTR(31);           /*POINTER TO KEY VALUE        */
*        DCL RPTR2  PTR(31);           /*POINTER TO KEY VALUE        */
*        DCL LENG   FIXED(15);         /*USED TO CONSTRUCT LISTRNGS  */
*                                      /*FROM HIKEYV-LOKEYV FIELDS   */
*        DCL RDOCNTRL BIT(1);          /*LOOP CONTROL                */
*        DCL LKEY  CHAR(64);                                       2004
*        DCL HKEY  CHAR(64);           /*HIGH KEY FOR RANGE VALIDITY */
*                                      /*CHECK                       */
*        DCL   1 FFS    CHAR(64) STATIC LOCAL,                     2006
*              2 *(64)  CHAR(1)  INIT((64)'FF'X);                  2006
*                                      /*MAXIMUM KEY VALUE           */
*        DCL KERROR BIT(1);            /*SET WHEN KEYRANGES INVALID  */
*        DCL HILN  FIXED(31);          /*LENGTH OF HIGH KEY          */
*        DCL LOWLN FIXED(31);          /*LENGTH OF LOW KEY           */
*                                                                  2009
*        OLDERID2 = NEWERID2;                                      2010
         L     @04,@PC00001                                        2010
         L     @15,GDTTR2(,@04)                                    2010
         MVC   @TS00001(95),NEWERID2(@15)                          2010
         MVC   OLDERID2(95,@15),@TS00001                           2010
*        NEWID2 = 'RMRG';                                          2011
*                                                                  2011
         MVC   NEWID2(4,@15),@CC01496                              2011
*        /************************************************************/
*        /*                                                          */
*        /*  THE RANGE LIST IS TO BE CONSTRUCTED FROM CATALOG        */
*        /*  INFORMATION READ IN FROM THE PORTABILITY VOLUME.        */
*        /*  THE HIKEYV AND LOKEYV CATALOG FIELDS CONTAIN THE        */
*        /*  INFORMATION                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  2012
*        DICTPTR = RDICT;                                          2012
         L     @15,@PC00011+4                                      2012
         L     @15,RDICT(,@15)                                     2012
         ST    @15,DICTPTR                                         2012
*        IF DICTLN(IHIKEYV) ^= 0 &                                 2013
*          DICTLN(ILOKEYV) ^= 0                                    2013
*          THEN                                                    2013
         SLR   @14,@14                                             2013
         L     @03,DICTLN+120(,@15)                                2013
         CR    @03,@14                                             2013
         BE    @RF02013                                            2013
         L     @15,DICTLN+112(,@15)                                2013
         CR    @15,@14                                             2013
         BE    @RF02013                                            2013
*            DO;                                                   2014
*                                                                  2014
*            /********************************************************/
*            /*                                                      */
*            /*  COMPUTE SIZE OF RANGES LIST  AND OBTAIN CORE        */
*            /*  IF CORE IS NOT OBTAINED, RETURN TO CALLING          */
*            /*  PROCESSOR                                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  2015
*            TOTLEN = DICTLN(IHIKEYV) + DICTLN(ILOKEYV) + 2;       2015
*                                                                  2015
         ALR   @03,@15                                             2015
         AL    @03,@CF00157                                        2015
         ST    @03,TOTLEN                                          2015
*            CALL IDCSAGP0 (GDTTBL,TOTLEN,RRANGPTR,GPID,SETZERO);  2016
*                                                                  2016
         ST    @04,@AL00001                                        2016
         LA    @15,TOTLEN                                          2016
         ST    @15,@AL00001+4                                      2016
         L     @15,@PC00011+12                                     2016
         ST    @15,@AL00001+8                                      2016
         LA    @15,GPID                                            2016
         ST    @15,@AL00001+12                                     2016
         LA    @15,SETZERO                                         2016
         ST    @15,@AL00001+16                                     2016
         MVI   @AL00001+16,X'80'                                   2016
         L     @15,GDTGPL(,@04)                                    2016
         LA    @01,@AL00001                                        2016
         BALR  @14,@15                                             2016
*            RESPECIFY RTNREG RSTD;                                2017
*            TESTRC = RTNREG;                                      2018
         STH   RTNREG,TESTRC                                       2018
*            RESPECIFY RTNREG UNRSTD;                              2019
*            IF TESTRC ^= 0                                        2020
*              THEN                                                2020
         LH    @04,TESTRC                                          2020
         LTR   @04,@04                                             2020
         BZ    @RF02020                                            2020
*                DO;                                               2021
*                DEFSTID = NOSTORAG;                               2022
         MVI   DEFSTID,X'04'                                       2022
*                DARGSMOD = UNIVMSG;                               2023
         L     @04,DDSTRU                                          2023
         MVC   DARGSMOD(3,@04),@CC00981                            2023
*                RETURN CODE(LASTCC12);                            2024
         LA    @15,12                                              2024
         L     @14,@SA00011                                        2024
         LM    @00,@12,@SA00011+8                                  2024
         BR    @14                                                 2024
*                END;                                              2025
*                                                                  2025
*            /********************************************************/
*            /*                                                      */
*            /*  SET POINTERS TO START OF HIGH KEY AND LOW KEY       */
*            /*  VALUES.  INITIALIZE LOOP CONTROL.                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2026
*            FRANPTR1 = RRANGPTR + 2;                              2026
@RF02020 LA    @04,2                                               2026
         L     @15,@PC00011+12                                     2026
         L     @15,RRANGPTR(,@15)                                  2026
         ALR   @15,@04                                             2026
         ST    @15,FRANPTR1                                        2026
*            LENG = TOTLEN - 2;                                    2027
         LCR   @04,@04                                             2027
         AL    @04,TOTLEN                                          2027
         STH   @04,LENG                                            2027
*            RPTR1 = DICTDL(ILOKEYV) + RWKA;                       2028
         L     @04,DICTPTR                                         2028
         L     @15,@PC00011+8                                      2028
         L     @15,RWKA(,@15)                                      2028
         L     @14,DICTDL+112(,@04)                                2028
         ALR   @14,@15                                             2028
         ST    @14,RPTR1                                           2028
*            RPTR2 = DICTDL(IHIKEYV) + RWKA;                       2029
*                                                                  2029
         AL    @15,DICTDL+120(,@04)                                2029
         ST    @15,RPTR2                                           2029
*            DO WHILE LENG > 0;                                    2030
*                                                                  2030
         B     @DE02030                                            2030
@DL02030 DS    0H                                                  2031
*              /******************************************************/
*              /*                                                    */
*              /*  MOVE LOW KEY & LENGTH INTO RANGE LIST. UPDATE     */
*              /*  POINTERS AND LOOP CONTROL.                        */
*              /*                                                    */
*              /******************************************************/
*                                                                  2031
*              FKEYLN = RPTR1 -> FIELDR(1:2);                      2031
         L     @04,FRANPTR1                                        2031
         L     @15,RPTR1                                           2031
         SLR   @14,@14                                             2031
         ICM   @14,3,FIELDR(@15)                                   2031
         STH   @14,FKEYLN(,@04)                                    2031
*              FKEY(1:FKEYLN) = (RPTR1 + 2) -> FIELDR(1:FKEYLN);   2032
         LR    @03,@14                                             2032
         BCTR  @03,0                                               2032
         LA    @02,2                                               2032
         LR    @01,@15                                             2032
         ALR   @01,@02                                             2032
         EX    @03,@SM01799                                        2032
*              RPTR1 = RPTR1 + FKEYLN + 2;                         2033
         ALR   @15,@14                                             2033
         ALR   @15,@02                                             2033
         ST    @15,RPTR1                                           2033
*              LENG = LENG - FKEYLN - 2;                           2034
         LH    @15,LENG                                            2034
         SLR   @15,@14                                             2034
         SLR   @15,@02                                             2034
         STH   @15,LENG                                            2034
*              FRANPTR1 = FRANPTR1 + FKEYLN + 2;                   2035
*                                                                  2035
         ALR   @04,@14                                             2035
         ALR   @04,@02                                             2035
         ST    @04,FRANPTR1                                        2035
*              /******************************************************/
*              /*                                                    */
*              /*  MOVE HIGH KEY & LENGTH INTO RANGE LIST. UPDATE    */
*              /*  POINTERS AND LOOP CONTROL                         */
*              /*                                                    */
*              /******************************************************/
*                                                                  2036
*              FKEYLN = RPTR2 -> FIELDR(1:2);                      2036
         L     @14,RPTR2                                           2036
         SLR   @03,@03                                             2036
         ICM   @03,3,FIELDR(@14)                                   2036
         STH   @03,FKEYLN(,@04)                                    2036
*              FKEY(1:FKEYLN) = (RPTR2+2) -> FIELDR(1:FKEYLN);     2037
         LR    @01,@03                                             2037
         BCTR  @01,0                                               2037
         LR    @00,@14                                             2037
         ALR   @00,@02                                             2037
         LR    @15,@00                                             2037
         EX    @01,@SM01801                                        2037
*              RPTR2 = RPTR2 + FKEYLN + 2;                         2038
         ALR   @14,@03                                             2038
         ALR   @14,@02                                             2038
         ST    @14,RPTR2                                           2038
*              LENG = LENG - FKEYLN - 2;                           2039
         LH    @15,LENG                                            2039
         SLR   @15,@03                                             2039
         SLR   @15,@02                                             2039
         STH   @15,LENG                                            2039
*              FRANPTR1 = FRANPTR1 + FKEYLN + 2;                   2040
         ALR   @04,@03                                             2040
         ALR   @04,@02                                             2040
         ST    @04,FRANPTR1                                        2040
*            END;                                                  2041
*                                                                  2041
@DE02030 LH    @04,LENG                                            2041
         LTR   @04,@04                                             2041
         BP    @DL02030                                            2041
*            /********************************************************/
*            /*                                                      */
*            /*  SET LENGTH OF ENTIRE LIST AND RETURN                */
*            /*  WITH SUCCESS INDICATED                              */
*            /*                                                      */
*            /********************************************************/
*                                                                  2042
*            FRANGLN = TOTLEN;                                     2042
         L     @04,@PC00011+12                                     2042
         L     @04,RRANGPTR(,@04)                                  2042
         L     @15,TOTLEN                                          2042
         STH   @15,FRANGLN(,@04)                                   2042
*            END;                                                  2043
*                                                                  2043
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2044
*        RETURN CODE(0);                                           2044
@RF02013 SLR   @15,@15                                             2044
         L     @14,@SA00011                                        2044
         LM    @00,@12,@SA00011+8                                  2044
         BR    @14                                                 2044
*END RANGPROC;                                                     2045
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - LVLRPROC                               */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT FIELD PARAMETER LISTS (FPL'S)      */
*        /*  FOR DEVTYPE (FROM DEVICETYPES PARAMETER IN AMS COMMAND  */
*        /*  OR LISTS FOR LISTVOLS OR LISTRNGS FROM THE LIST         */
*        /*  PARAMETER IN THE AMS COMMAND OR THE RANGES PARAMETER    */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .LX - INDEX TO CORRECT OBJECT PARAMETER IN FDTTBL     */
*        /*    .LISTDICT - POINTER THE DICTIONARY BEING USED         */
*        /*    .LISTWKA  - POINTER TO THE WORK AREA CONTAINING       */
*        /*     THE CATALOG INFORMATION INDEXED BY THE DICTIONARY    */
*        /*    .LFVTPTR - POINTER TO FVT WHERE FPL OR LIST POINTERS  */
*        /*     ARE TO BE INSERTED                                   */
*        /*    .LTYPE - THE TYPE OF THE OBJECT FOR WHICH THE VOLUME  */
*        /*     LIST IS BEING BUILT                                  */
*        /*                                                          */
*        /*  OUTPUT - FPL AND LISTS WILL BE CONSTRUCTED              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2046
*LVLRPROC: PROCEDURE (LX,              /*INDEX TO OBJECT PARAMETER   */
*                    LISTDICT,         /*POINTER TO DICTIONARY FROM  */
*                    LISTWKA,          /*FVT POINTER                 */
*                    LFVTPTR,          /*WORK AREA CONTAINED CATALOG */
*                                      /*FIELD INFORMATION           */
*                    LTYPE);           /*THE TYPE OF THE OBJECT FOR  */
LVLRPROC STM   @14,@12,@SA00012                                    2046
         MVC   @PC00012(20),0(@01)                                 2046
*                                      /*WHICH THE VOLUME LIST IS    */
*                                      /*BEING BUILT                 */
*                                                                  2047
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2047
*        DCL LX       FIXED(31),                                   2047
*            LISTDICT PTR(31),                                     2047
*            LISTWKA  PTR(31),                                     2047
*            LFVTPTR  PTR(31),                                     2047
*            LTYPE    CHAR(1);                                     2047
*                                                                  2047
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARES                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  2048
*        DCL INXVOLSR FIXED(31);       /*INDEX FOR RELATIVE          */
*                                      /*POSITION IN VOLUME SERIAL   */
*                                      /*SERIAL LIST                 */
*        DCL FLISTPTR PTR(31);         /*POINTER TO VOL SER LIST     */
*                                                                  2049
*        DCL FDEVTPTR PTR(31);         /*POINTER TO DEVICETYPE FPL   */
*        DCL 1 FDEV BASED(FDEVTPTR) BDY(HWORD),                    2051
*              2 FDEVTYP (*),                                      2051
*                3 FDEVT CHAR(8),      /*DEVICE TYPE                 */
*                3 FDCODE CHAR(4);     /*RESERVED                    */
*        DCL NUMVOL FIXED(15);         /*NUMBER OF VOLUMES           */
*                                                                  2052
*        DCL NUMDTYP FIXED(15);        /*NUMBER OF DEVICETYPES       */
*        DCL FLDEVTYP CHAR(4) BASED;   /*MAPPING OF THE DEVICETYPE   */
*                                      /*INFORMATION AS PRESENTED BY */
*                                      /*EXPORTRA                    */
*                                                                  2055
*        /************************************************************/
*        /*                                                          */
*        /*  DECLARATIONS FOR FILE SEQUENCE NUMBERS                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  2055
*        DCL FSEQPTR PTR(31);          /*POINTER TO FILE SEQUENCE    */
*                                      /*NUMBER OVERLAY              */
*                                                                  2056
*        DCL 1 FSEQARRY BASED(FSEQPTR) BDY(HWORD),                 2056
*          2 FFSEQNUM(255) FIXED(15);                              2056
*                                                                  2056
*        DCL FSEQNUM FIXED(15) BASED;  /*MAPPING OF AN INDIVIDUAL    */
*                                      /*FILE SEQUENCE NUMBER        */
*                                                                  2058
*        DCL NUMFSEQ FIXED(15);        /*NUMBER OF FILE SEQUENCE     */
*                                      /*NUMBERS PASSED BY EXPORTRA  */
*        /************************************************************/
*        /*                                                          */
*        /*  CHECK TO BE SURE THE VOLUME PARAMETER WAS SPECIFIED     */
*        /*  IN THE AMS COMMAND                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2059
*        OLDERID2 = NEWERID2;                                      2059
         L     @04,@PC00001                                        2059
         L     @04,GDTTR2(,@04)                                    2059
         MVC   @TS00001(95),NEWERID2(@04)                          2059
         MVC   OLDERID2(95,@04),@TS00001                           2059
*        NEWID2 = 'RMLV';                                          2060
*                                                                  2060
         MVC   NEWID2(4,@04),@CC01525                              2060
*        RESPECIFY CTGFV BASED(CTGFVPTR);                          2061
*                                                                  2061
*        CTGFVPTR = LFVTPTR;                                       2062
*                                                                  2062
         L     @04,@PC00012+12                                     2062
         L     @04,LFVTPTR(,@04)                                   2062
         ST    @04,CTGFVPTR                                        2062
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT LIST OF VOLUME SERIALS IF BEING CALLED        */
*        /*  BY FVTPROC OR BY NFVTPROC.                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2063
*        IF LISTDICT ^= NULLPTR                                    2063
*          THEN                                                    2063
         L     @04,@PC00012+4                                      2063
         L     @04,LISTDICT(,@04)                                  2063
         LTR   @04,@04                                             2063
         BZ    @RF02063                                            2063
*NOBJECTS:   DO;                                                   2064
*                                                                  2064
NOBJECTS DS    0H                                                  2065
*            /********************************************************/
*            /*                                                      */
*            /*  SET THE VALUE OF THE VOLUME SERIAL INDEX ON THE     */
*            /*  BASIS OF LTYPE.  THIS IS NECESSARY SINCE THE        */
*            /*  THE VOLUME SERIAL DISPLACEMENTS ARE DIFFERENT FOR   */
*            /*  VSAM CLUSTERS (AND AIX'S) AND NONVSAMS (AND         */
*            /*  USERCATALOGS).                                      */
*            /*                                                      */
*            /********************************************************/
*                                                                  2065
*            IF (LTYPE = CTGTALIN) × (LTYPE = CTGTUCAT)            2065
*              THEN                                                2065
         L     @04,@PC00012+16                                     2065
         CLI   LTYPE(@04),C'A'                                     2065
         BE    @RT02065                                            2065
         CLI   LTYPE(@04),C'U'                                     2065
         BNE   @RF02065                                            2065
@RT02065 DS    0H                                                  2066
*                INXVOLSR = LVOLSER;                               2066
         MVC   INXVOLSR(4),@CF00165                                2066
*              ELSE                                                2067
*                INXVOLSR = IVOLSER;                               2067
*                                                                  2067
         B     @RC02065                                            2067
@RF02065 MVC   INXVOLSR(4),@CF00964                                2067
*            /********************************************************/
*            /*                                                      */
*            /*  PICK UP POINTER TO DICTIONARY ENTRY AND SEE IF A    */
*            /*  VOLUME SERIAL LIST WAS PASSED FOR THIS COMPONENT    */
*            /*                                                      */
*            /********************************************************/
*                                                                  2068
*            DICTPTR = LISTDICT;                                   2068
@RC02065 L     @04,@PC00012+4                                      2068
         L     @04,LISTDICT(,@04)                                  2068
         ST    @04,DICTPTR                                         2068
*            IF DICTLN(INXVOLSR) ^= 0                              2069
*              THEN                                                2069
         L     @15,INXVOLSR                                        2069
         SLA   @15,3                                               2069
         AL    @04,@CF01779                                        2069
         L     @04,DICTLN-4(@15,@04)                               2069
         LTR   @04,@04                                             2069
         BZ    @RF02069                                            2069
*VOL1:           DO;                                               2070
*                                                                  2070
VOL1     DS    0H                                                  2071
*                /****************************************************/
*                /*                                                  */
*                /*  A VOLUME SERIAL LIST WAS PASSED. COMPUTE LENGTH */
*                /*  OF LIST TO BE CONSTRUCTED FOR DEFINE            */
*                /*                                                  */
*                /****************************************************/
*                                                                  2071
*                NUMVOL = DICTLN(INXVOLSR) / LENGTH(FVOLSER);      2071
         L     @04,INXVOLSR                                        2071
         SLA   @04,3                                               2071
         L     @01,DICTPTR                                         2071
         AL    @01,@CF01779                                        2071
         L     @00,DICTLN-4(@04,@01)                               2071
         SRDA  @00,32                                              2071
         D     @00,@CF00041                                        2071
         STH   @01,NUMVOL                                          2071
*                TOTLEN = LENGTH(FVOLSERL) * NUMVOL + LENGTH(FLISTLN);
*                                                                  2072
         SLA   @01,3                                               2072
         AL    @01,@CF00157                                        2072
         ST    @01,TOTLEN                                          2072
*                CALL IDCSAGP0 (GDTTBL,TOTLEN,CTGFVVLT,GPID,SETZERO);
*                                                                  2073
         L     @04,@PC00001                                        2073
         ST    @04,@AL00001                                        2073
         LA    @15,TOTLEN                                          2073
         ST    @15,@AL00001+4                                      2073
         L     @01,CTGFVPTR                                        2073
         LA    @15,CTGFVVLT(,@01)                                  2073
         ST    @15,@AL00001+8                                      2073
         LA    @15,GPID                                            2073
         ST    @15,@AL00001+12                                     2073
         LA    @15,SETZERO                                         2073
         ST    @15,@AL00001+16                                     2073
         MVI   @AL00001+16,X'80'                                   2073
         L     @15,GDTGPL(,@04)                                    2073
         LA    @01,@AL00001                                        2073
         BALR  @14,@15                                             2073
*                RESPECIFY RTNREG RSTD;                            2074
*                TESTRC = RTNREG;                                  2075
         STH   RTNREG,TESTRC                                       2075
*                RESPECIFY RTNREG UNRSTD;                          2076
*                                                                  2076
*                /****************************************************/
*                /*                                                  */
*                /*  IF CORE IS NOT OBTAINED SUCCESSFULLY FOR THE    */
*                /*  RETURN TO CALLER WITH AN ERROR INDICATED        */
*                /*                                                  */
*                /****************************************************/
*                                                                  2077
*                IF TESTRC ^= 0                                    2077
*                  THEN                                            2077
         LH    @04,TESTRC                                          2077
         LTR   @04,@04                                             2077
         BZ    @RF02077                                            2077
*                    DO;                                           2078
*                    DEFSTID = NOSTORAG;                           2079
         MVI   DEFSTID,X'04'                                       2079
*                    DARGSMOD = UNIVMSG;                           2080
         L     @04,DDSTRU                                          2080
         MVC   DARGSMOD(3,@04),@CC00981                            2080
*                    RETURN CODE(LASTCC12);                        2081
         LA    @15,12                                              2081
         L     @14,@SA00012                                        2081
         LM    @00,@12,@SA00012+8                                  2081
         BR    @14                                                 2081
*                    END;                                          2082
*                                                                  2082
*                /****************************************************/
*                /*                                                  */
*                /*  CONSTRUCT LISTVOLS VOLUME SERIAL LIST           */
*                /*                                                  */
*                /****************************************************/
*                                                                  2083
*                DO N = 1 TO NUMVOL;                               2083
@RF02077 LA    @04,1                                               2083
         B     @DE02083                                            2083
@DL02083 DS    0H                                                  2084
*                  FVOLSER(N) = (DICTDL(INXVOLSR) +LISTWKA + (N-1) 2084
*                    * LENGTH(FVOLSER)) -> FLVOLSER;               2084
         LR    @15,@04                                             2084
         SLA   @15,3                                               2084
         L     @01,CTGFVPTR                                        2084
         L     @01,CTGFVVLT(,@01)                                  2084
         ALR   @01,@15                                             2084
         AL    @01,@CF01779                                        2084
         L     @15,INXVOLSR                                        2084
         SLA   @15,3                                               2084
         L     @14,@PC00012+8                                      2084
         L     @03,DICTPTR                                         2084
         L     @15,DICTDL-8(@15,@03)                               2084
         AL    @15,LISTWKA(,@14)                                   2084
         LR    @14,@04                                             2084
         BCTR  @14,0                                               2084
         MH    @14,@CH00041                                        2084
         ALR   @15,@14                                             2084
         MVC   FVOLSER-4(6,@01),FLVOLSER(@15)                      2084
*                END;                                              2085
         AL    @04,@CF00221                                        2085
@DE02083 ST    @04,N                                               2085
         CH    @04,NUMVOL                                          2085
         BNH   @DL02083                                            2085
*                FLISTLN = TOTLEN - LENGTH(FLISTLN);               2086
         L     @04,CTGFVPTR                                        2086
         L     @04,CTGFVVLT(,@04)                                  2086
         L     @15,TOTLEN                                          2086
         BCTR  @15,0                                               2086
         BCTR  @15,0                                               2086
         STH   @15,FLISTLN(,@04)                                   2086
*                IMPF2VOL= ON;                                     2087
         OI    IMPF2VOL,B'10000000'                                2087
*                END VOL1;                                         2088
*                                                                  2088
*            /********************************************************/
*            /*                                                      */
*            /*  FOR NON-VSAMS AND USERCATALOGS CONSTRUCT THE        */
*            /*  DEVICETYPES LIST.                                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2089
*            IF (LTYPE = CTGTUCAT × LTYPE = CTGTALIN) &            2089
*               (DICTLN(LDEVTYP) ^= 0)                             2089
*              THEN                                                2089
@RF02069 L     @04,@PC00012+16                                     2089
         CLI   LTYPE(@04),C'U'                                     2089
         BE    @GL00022                                            2089
         CLI   LTYPE(@04),C'A'                                     2089
         BNE   @RF02089                                            2089
@GL00022 L     @04,DICTPTR                                         2089
         L     @04,DICTLN+24(,@04)                                 2089
         LTR   @04,@04                                             2089
         BZ    @RF02089                                            2089
*DEVTYP1:        DO;                                               2090
*                                                                  2090
DEVTYP1  DS    0H                                                  2091
*                /****************************************************/
*                /*                                                  */
*                /*  COMPUTE THE AMOUNT OF CORE REQUIRED FOR THE     */
*                /*  DEVTYP FPL AND ITS ASSOCIATED DEVICE TYPES      */
*                /*  LIST.  ISSUE A UGPOOL FOR THAT AMOUNT OF        */
*                /*  STORAGE.                                        */
*                /*                                                  */
*                /****************************************************/
*                                                                  2091
*                TOTLEN = (LENGTH(CTGFL) + 8) +                    2091
*                   (DICTLN(LDEVTYP)/LENGTH(FLDEVTYP))*LENGTH(FDEVTYP);
         L     @04,DICTPTR                                         2091
         L     @00,DICTLN+24(,@04)                                 2091
         SRDA  @00,32                                              2091
         D     @00,@CF00046                                        2091
         MH    @01,@CH00035                                        2091
         AL    @01,@CF00312                                        2091
         ST    @01,TOTLEN                                          2091
*                CALL IDCSAGP0(GDTTBL,TOTLEN,CTGFVDVT,GPID,SETZERO);
*                                                                  2092
         L     @04,@PC00001                                        2092
         ST    @04,@AL00001                                        2092
         LA    @15,TOTLEN                                          2092
         ST    @15,@AL00001+4                                      2092
         L     @01,CTGFVPTR                                        2092
         LA    @15,CTGFVDVT(,@01)                                  2092
         ST    @15,@AL00001+8                                      2092
         LA    @15,GPID                                            2092
         ST    @15,@AL00001+12                                     2092
         LA    @15,SETZERO                                         2092
         ST    @15,@AL00001+16                                     2092
         MVI   @AL00001+16,X'80'                                   2092
         L     @15,GDTGPL(,@04)                                    2092
         LA    @01,@AL00001                                        2092
         BALR  @14,@15                                             2092
*                /****************************************************/
*                /*                                                  */
*                /*  TEST THE RETURN CODE FROM UGPOOL.  IF IT IS     */
*                /*  NONZERO, THEN RETURN TO THE CALLING PROCESSOR   */
*                /*  WITH A TERMINAL ERROR INDICATED.                */
*                /*                                                  */
*                /****************************************************/
*                                                                  2093
*                RESPECIFY RTNREG RSTD;                            2093
*                TESTRC = RTNREG;                                  2094
         STH   RTNREG,TESTRC                                       2094
*                RESPECIFY RTNREG UNRSTD;                          2095
*                IF TESTRC ^= 0                                    2096
*                  THEN                                            2096
         LH    @04,TESTRC                                          2096
         LTR   @04,@04                                             2096
         BZ    @RF02096                                            2096
*                    DO;                                           2097
*                    DARGSMOD = UNIVMSG;                           2098
         L     @04,DDSTRU                                          2098
         MVC   DARGSMOD(3,@04),@CC00981                            2098
*                    DEFSTID = NOSTORAG;                           2099
         MVI   DEFSTID,X'04'                                       2099
*                    RETURN CODE(LASTCC12);                        2100
         LA    @15,12                                              2100
         L     @14,@SA00012                                        2100
         LM    @00,@12,@SA00012+8                                  2100
         BR    @14                                                 2100
*                    END;                                          2101
*                                                                  2101
*                /****************************************************/
*                /*                                                  */
*                /*  SET THE CTGFLPTR TO POINT TO THE START OF THE   */
*                /*  AREA GOTTEN BY UGPOOL.                          */
*                /*  ALSO SET THE POINTER USED TO BASE THE DEVICE    */
*                /*  TYPES LIST MAPPING TO THE START OF DEVICE TYPES */
*                /*  LIST.                                           */
*                /*                                                  */
*                /****************************************************/
*                                                                  2102
*                CTGFLPTR = CTGFVDVT;                              2102
@RF02096 L     @04,CTGFVPTR                                        2102
         L     @15,CTGFVDVT(,@04)                                  2102
         ST    @15,CTGFLPTR                                        2102
*                FDEVTPTR = CTGFVDVT + LENGTH(CTGFL) + 8;          2103
*                                                                  2103
         AL    @15,@CF00312                                        2103
         ST    @15,FDEVTPTR                                        2103
*                /****************************************************/
*                /*                                                  */
*                /*  INDICATE THAT THE DEVICE TYPE INFORMATION IS IN */
*                /*  CODED FORM AS EXTRACTED FROM THE CATALOG BY     */
*                /*  EXPORTRA.                                       */
*                /*                                                  */
*                /****************************************************/
*                                                                  2104
*                CTGFVNDC = ON;                                    2104
*                                                                  2104
         OI    CTGFVNDC(@04),B'00100000'                           2104
*                /****************************************************/
*                /*                                                  */
*                /*  LOOP PLACING DEVICE TYPE INFORMATION IN THE     */
*                /*  DEVICE TYPES LIST.                              */
*                /*                                                  */
*                /****************************************************/
*                                                                  2105
*                DO N = 1 TO DICTLN(LDEVTYP) / LENGTH(FLDEVTYP);   2105
         LA    @04,1                                               2105
         B     @DE02105                                            2105
@DL02105 DS    0H                                                  2106
*                  FDCODE(N) = (DICTDL(LDEVTYP) + LISTWKA +        2106
*                     (N - 1) * LENGTH(FLDEVTYP)) -> FLDEVTYP;     2106
         LR    @15,@04                                             2106
         MH    @15,@CH00035                                        2106
         L     @01,FDEVTPTR                                        2106
         ALR   @01,@15                                             2106
         AL    @01,@CF01779                                        2106
         L     @15,@PC00012+8                                      2106
         L     @14,DICTPTR                                         2106
         L     @14,DICTDL+24(,@14)                                 2106
         AL    @14,LISTWKA(,@15)                                   2106
         LR    @15,@04                                             2106
         BCTR  @15,0                                               2106
         SLA   @15,2                                               2106
         ALR   @14,@15                                             2106
         MVC   FDCODE-8(4,@01),FLDEVTYP(@14)                       2106
*                END;                                              2107
*                                                                  2107
         AL    @04,@CF00221                                        2107
@DE02105 ST    @04,N                                               2107
         L     @01,DICTPTR                                         2107
         L     @00,DICTLN+24(,@01)                                 2107
         SRDA  @00,32                                              2107
         D     @00,@CF00046                                        2107
         CR    @04,@01                                             2107
         BNH   @DL02105                                            2107
*                /****************************************************/
*                /*                                                  */
*                /*  SET THE FIELDS OF THE FPL.                      */
*                /*                                                  */
*                /****************************************************/
*                                                                  2108
*                CTGFLDNO = '00000001'B;                           2108
         L     @04,CTGFLPTR                                        2108
         MVI   CTGFLDNO(@04),X'01'                                 2108
*                CTGFLDNM = ADDR(NVFLIST(LDEVTYP));                2109
         LA    @15,NVFLIST+24                                      2109
         ST    @15,CTGFLDNM(,@04)                                  2109
*                CTGFLNG(1) = (DICTLN(LDEVTYP)/LENGTH(FLDEVTYP))   2110
*                     * LENGTH(FDEVTYP);                           2110
         L     @01,DICTPTR                                         2110
         L     @00,DICTLN+24(,@01)                                 2110
         SRDA  @00,32                                              2110
         D     @00,@CF00046                                        2110
         MH    @01,@CH00035                                        2110
         ST    @01,CTGFLNG(,@04)                                   2110
*                CTGFLPT(1) = FDEVTPTR;                            2111
*                                                                  2111
         L     @15,FDEVTPTR                                        2111
         ST    @15,CTGFLPT(,@04)                                   2111
*                END DEVTYP1;                                      2112
*                                                                  2112
*            /********************************************************/
*            /*                                                      */
*            /*  IF THE TYPE OF THE OBJECT BEING DEFINED IS NONVSAM  */
*            /*  THEN BUILD AN FPL FOR FILESEQUENCE NUMBERS.         */
*            /*                                                      */
*            /********************************************************/
*                                                                  2113
*            IF (LTYPE = CTGTALIN) & (DICTLN(LFSEQNUM) ^= 0)       2113
*              THEN                                                2113
@RF02089 L     @04,@PC00012+16                                     2113
         CLI   LTYPE(@04),C'A'                                     2113
         BNE   @RF02113                                            2113
         L     @04,DICTPTR                                         2113
         L     @04,DICTLN+32(,@04)                                 2113
         LTR   @04,@04                                             2113
         BZ    @RF02113                                            2113
*FILESN:         DO;                                               2114
*                                                                  2114
FILESN   DS    0H                                                  2115
*                /****************************************************/
*                /*                                                  */
*                /*  COMPUTE THE NUMBER OF FILE SEQUENCE NUMBERS,    */
*                /*  ALSO THE AMOUNT OF CORE REQUIRED FOR THE        */
*                /*  LIST OF FILESEQUENCE NUMBERS AND ITS ASSOCIATED */
*                /*  FPL.  ISSUE A REQUEST FOR THE NEEDED STORAGE.   */
*                /*                                                  */
*                /****************************************************/
*                                                                  2115
*                NUMFSEQ = DICTLN(LFSEQNUM) / LENGTH(FFSEQNUM);    2115
         L     @04,DICTPTR                                         2115
         L     @04,DICTLN+32(,@04)                                 2115
         LR    @00,@04                                             2115
         SRDA  @00,32                                              2115
         D     @00,@CF00157                                        2115
         STH   @01,NUMFSEQ                                         2115
*                TOTLEN = DICTLN(LFSEQNUM) + LENGTH(CTGFL) + 8;    2116
         AL    @04,@CF00312                                        2116
         ST    @04,TOTLEN                                          2116
*                CALL IDCSAGP0(GDTTBL,TOTLEN,CTGFVFSN,GPID,SETZERO);
*                                                                  2117
         L     @04,@PC00001                                        2117
         ST    @04,@AL00001                                        2117
         LA    @15,TOTLEN                                          2117
         ST    @15,@AL00001+4                                      2117
         L     @01,CTGFVPTR                                        2117
         LA    @15,CTGFVFSN(,@01)                                  2117
         ST    @15,@AL00001+8                                      2117
         LA    @15,GPID                                            2117
         ST    @15,@AL00001+12                                     2117
         LA    @15,SETZERO                                         2117
         ST    @15,@AL00001+16                                     2117
         MVI   @AL00001+16,X'80'                                   2117
         L     @15,GDTGPL(,@04)                                    2117
         LA    @01,@AL00001                                        2117
         BALR  @14,@15                                             2117
*                /****************************************************/
*                /*                                                  */
*                /*  TEST THE RETURN CODE FROM THE UGPOOL.  IF IT IS */
*                /*  NONZERO, RETURN TO THE CALLER WITH A TERMINAL   */
*                /*  ERROR INDICATED.                                */
*                /*                                                  */
*                /****************************************************/
*                                                                  2118
*                RESPECIFY RTNREG RSTD;                            2118
*                TESTRC = RTNREG;                                  2119
         STH   RTNREG,TESTRC                                       2119
*                RESPECIFY RTNREG UNRSTD;                          2120
*                IF TESTRC ^= 0                                    2121
*                  THEN                                            2121
         LH    @04,TESTRC                                          2121
         LTR   @04,@04                                             2121
         BZ    @RF02121                                            2121
*                    DO;                                           2122
*                    DEFSTID = NOSTORAG;                           2123
         MVI   DEFSTID,X'04'                                       2123
*                    DARGSMOD = UNIVMSG;                           2124
         L     @04,DDSTRU                                          2124
         MVC   DARGSMOD(3,@04),@CC00981                            2124
*                    RETURN CODE(LASTCC12);                        2125
         LA    @15,12                                              2125
         L     @14,@SA00012                                        2125
         LM    @00,@12,@SA00012+8                                  2125
         BR    @14                                                 2125
*                    END;                                          2126
*                                                                  2126
*                /****************************************************/
*                /*                                                  */
*                /*  BUILD THE FILE SEQUENCE NUMBER FPL.             */
*                /*                                                  */
*                /****************************************************/
*                                                                  2127
*                CTGFLPTR = CTGFVFSN;                              2127
@RF02121 L     @04,CTGFVPTR                                        2127
         L     @04,CTGFVFSN(,@04)                                  2127
         ST    @04,CTGFLPTR                                        2127
*                CTGFLDNO = '00000001'B;                           2128
         MVI   CTGFLDNO(@04),X'01'                                 2128
*                CTGFLDNM = ADDR(NVFLIST(LFSEQNUM));               2129
         LA    @15,NVFLIST+32                                      2129
         ST    @15,CTGFLDNM(,@04)                                  2129
*                CTGFLPT(1) = CTGFVFSN + (LENGTH(CTGFL) + 8);      2130
         LA    @15,24                                              2130
         ALR   @15,@04                                             2130
         ST    @15,CTGFLPT(,@04)                                   2130
*                CTGFLNG(1) = DICTLN(LFSEQNUM);                    2131
         L     @01,DICTPTR                                         2131
         L     @15,DICTLN+32(,@01)                                 2131
         ST    @15,CTGFLNG(,@04)                                   2131
*                FSEQPTR = CTGFLPT(1);                             2132
*                                                                  2132
         L     @04,CTGFLPT(,@04)                                   2132
         ST    @04,FSEQPTR                                         2132
*                /****************************************************/
*                /*                                                  */
*                /*  LOOP, PLACING THE FILE SEQUENCE NUMBERS INTO    */
*                /*  THE LIST.                                       */
*                /*                                                  */
*                /****************************************************/
*                                                                  2133
*                DO N = 1 TO NUMFSEQ;                              2133
         LA    @04,1                                               2133
         B     @DE02133                                            2133
@DL02133 DS    0H                                                  2134
*                  FFSEQNUM (N) = (DICTDL(LFSEQNUM)+LISTWKA+       2134
*                     (N-1)*LENGTH(FFSEQNUM))->FSEQNUM;            2134
         LR    @15,@04                                             2134
         ALR   @15,@15                                             2134
         L     @14,@PC00012+8                                      2134
         L     @01,DICTPTR                                         2134
         L     @03,DICTDL+32(,@01)                                 2134
         AL    @03,LISTWKA(,@14)                                   2134
         LR    @14,@04                                             2134
         BCTR  @14,0                                               2134
         ALR   @14,@14                                             2134
         ALR   @03,@14                                             2134
         LH    @14,FSEQNUM(,@03)                                   2134
         L     @01,FSEQPTR                                         2134
         BCTR  @01,0                                               2134
         BCTR  @01,0                                               2134
         STH   @14,FFSEQNUM(@15,@01)                               2134
*                END;                                              2135
         AL    @04,@CF00221                                        2135
@DE02133 ST    @04,N                                               2135
         CH    @04,NUMFSEQ                                         2135
         BNH   @DL02133                                            2135
*                END FILESN;                                       2136
*                                                                  2136
*            /********************************************************/
*            /*                                                      */
*            /*  RETURN TO CALLER WITH A GOOD RETURN CODE            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2137
*            RETURN CODE(0);                                       2137
@RF02113 SLR   @15,@15                                             2137
         L     @14,@SA00012                                        2137
         LM    @00,@12,@SA00012+8                                  2137
         BR    @14                                                 2137
*            END NOBJECTS;                                         2138
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT LIST OF VOLUME SERIALS IF LIST PARAMETER      */
*        /*  WAS SPECIFIED IN THE AMS COMMAND                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  2139
*        IF LISTVPTR(LX) ^= NULLPTR                                2139
*          THEN                                                    2139
@RF02063 L     @04,@PC00012                                        2139
         L     @04,LX(,@04)                                        2139
         SLA   @04,2                                               2139
         L     @15,@PC00001+4                                      2139
         L     @01,FDTPTR+24(,@15)                                 2139
         AL    @01,@CF01779                                        2139
         L     @04,LISTVPTR(@04,@01)                               2139
         LTR   @04,@04                                             2139
         BZ    @RF02139                                            2139
*VOL2:       DO;                                                   2140
*                                                                  2140
VOL2     DS    0H                                                  2141
*            /********************************************************/
*            /*                                                      */
*            /*  IF CTGFVVLT IS NOT EQUAL TO NULLPTR, THEN A         */
*            /*  VOLUME SERIAL LIST HAS BEEN CONSTRUCTED PREVIOUSLY. */
*            /*  FREE UP THE CORE THAT IT OCCUPIES, AND RESET        */
*            /*  CTGFVVLT TO NULLPTR.  THE OLD VOLUME SERIAL LIST,   */
*            /*  CONSTRUCTED FROM THE PORTABLE DATA SET IS TO BE     */
*            /*  OVERRIDDEN WITH INFORMATION FROM THE OBJECTS        */
*            /*  PARAMETER.                                          */
*            /*                                                      */
*            /********************************************************/
*                                                                  2141
*            IF CTGFVVLT ^= NULLPTR                                2141
*              THEN                                                2141
         L     @04,CTGFVPTR                                        2141
         L     @15,CTGFVVLT(,@04)                                  2141
         LTR   @15,@15                                             2141
         BZ    @RF02141                                            2141
*                DO;                                               2142
*                CALL IDCSAFS0(GDTTBL,CTGFVVLT);                   2143
         L     @15,@PC00001                                        2143
         ST    @15,@AL00001                                        2143
         LA    @04,CTGFVVLT(,@04)                                  2143
         ST    @04,@AL00001+4                                      2143
         L     @15,GDTFSP(,@15)                                    2143
         LA    @01,@AL00001                                        2143
         BALR  @14,@15                                             2143
*                RESPECIFY RTNREG RSTD;                            2144
*                TESTRC = RTNREG;                                  2145
         STH   RTNREG,TESTRC                                       2145
*                RESPECIFY RTNREG UNRSTD;                          2146
*                IF TESTRC ^= 0                                    2147
*                  THEN                                            2147
         LH    @04,TESTRC                                          2147
         LTR   @04,@04                                             2147
         BZ    @RF02147                                            2147
*                    RETURN CODE(LASTCC12);                        2148
         LA    @15,12                                              2148
         L     @14,@SA00012                                        2148
         LM    @00,@12,@SA00012+8                                  2148
         BR    @14                                                 2148
*                CTGFVVLT = NULLPTR;                               2149
@RF02147 L     @04,CTGFVPTR                                        2149
         SLR   @15,@15                                             2149
         ST    @15,CTGFVVLT(,@04)                                  2149
*                END;                                              2150
*                                                                  2150
*            TOTLEN = LENGTH(FVOLSERL) * (LISTVPTR(LX)->LISTVCNT) +2;
*                                                                  2151
@RF02141 L     @04,@PC00012                                        2151
         L     @04,LX(,@04)                                        2151
         SLA   @04,2                                               2151
         L     @15,@PC00001+4                                      2151
         L     @01,FDTPTR+24(,@15)                                 2151
         AL    @01,@CF01779                                        2151
         L     @04,LISTVPTR(@04,@01)                               2151
         LH    @04,LISTVCNT(,@04)                                  2151
         SLA   @04,3                                               2151
         AL    @04,@CF00157                                        2151
         ST    @04,TOTLEN                                          2151
*            /*******************************************************/
*            /*                                                      */
*            /*  GET CORE FOR THE VOLUME SERIAL LIST. IF CORE IS     */
*            /*  NOT OBTAINED SUCCESSFULLY, RETURN TO THE CALLING    */
*            /*  PROCESSOR                                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  2152
*            CALL IDCSAGP0 (GDTTBL,TOTLEN,CTGFVVLT,GPID,SETZERO);  2152
*                                                                  2152
         L     @04,@PC00001                                        2152
         ST    @04,@AL00001                                        2152
         LA    @15,TOTLEN                                          2152
         ST    @15,@AL00001+4                                      2152
         L     @01,CTGFVPTR                                        2152
         LA    @15,CTGFVVLT(,@01)                                  2152
         ST    @15,@AL00001+8                                      2152
         LA    @15,GPID                                            2152
         ST    @15,@AL00001+12                                     2152
         LA    @15,SETZERO                                         2152
         ST    @15,@AL00001+16                                     2152
         MVI   @AL00001+16,X'80'                                   2152
         L     @15,GDTGPL(,@04)                                    2152
         LA    @01,@AL00001                                        2152
         BALR  @14,@15                                             2152
*            RESPECIFY RTNREG RSTD;                                2153
*            TESTRC = RTNREG;                                      2154
         STH   RTNREG,TESTRC                                       2154
*            RESPECIFY RTNREG UNRSTD;                              2155
*            IF TESTRC ^= 0                                        2156
*              THEN                                                2156
         LH    @04,TESTRC                                          2156
         LTR   @04,@04                                             2156
         BZ    @RF02156                                            2156
*                DO;                                               2157
*                DARGSMOD = UNIVMSG;                               2158
         L     @04,DDSTRU                                          2158
         MVC   DARGSMOD(3,@04),@CC00981                            2158
*                DEFSTID = NOSTORAG;                               2159
         MVI   DEFSTID,X'04'                                       2159
*                RETURN CODE(LASTCC12);                            2160
         LA    @15,12                                              2160
         L     @14,@SA00012                                        2160
         LM    @00,@12,@SA00012+8                                  2160
         BR    @14                                                 2160
*                END;                                              2161
*                                                                  2161
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT LIST OF VOLUME SERIAL NUMBERS             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2162
*            DO N = 1 TO (LISTVPTR(LX)->LISTVCNT);                 2162
@RF02156 LA    @04,1                                               2162
         B     @DE02162                                            2162
@DL02162 DS    0H                                                  2163
*              FVOLSER(N) = LISTVPTR(LX) -> LISTVVAL(N);           2163
         LR    @15,@04                                             2163
         SLA   @15,3                                               2163
         L     @01,CTGFVPTR                                        2163
         L     @01,CTGFVVLT(,@01)                                  2163
         ALR   @01,@15                                             2163
         AL    @01,@CF01779                                        2163
         L     @14,@PC00012                                        2163
         L     @14,LX(,@14)                                        2163
         SLA   @14,2                                               2163
         L     @03,@PC00001+4                                      2163
         L     @03,FDTPTR+24(,@03)                                 2163
         AL    @03,@CF01779                                        2163
         L     @14,LISTVPTR(@14,@03)                               2163
         ALR   @14,@15                                             2163
         AL    @14,@CF01803                                        2163
         MVC   FVOLSER-4(6,@01),LISTVVAL-3(@14)                    2163
*            END;                                                  2164
         AL    @04,@CF00221                                        2164
@DE02162 ST    @04,N                                               2164
         L     @15,@PC00012                                        2164
         L     @15,LX(,@15)                                        2164
         SLA   @15,2                                               2164
         L     @14,@PC00001+4                                      2164
         L     @01,FDTPTR+24(,@14)                                 2164
         AL    @01,@CF01779                                        2164
         L     @01,LISTVPTR(@15,@01)                               2164
         CH    @04,LISTVCNT(,@01)                                  2164
         BNH   @DL02162                                            2164
*            FLISTLN = TOTLEN -2;                                  2165
         L     @04,CTGFVPTR                                        2165
         L     @04,CTGFVVLT(,@04)                                  2165
         L     @15,TOTLEN                                          2165
         BCTR  @15,0                                               2165
         BCTR  @15,0                                               2165
         STH   @15,FLISTLN(,@04)                                   2165
*            IMPF2VOL = ON;                                        2166
         OI    IMPF2VOL,B'10000000'                                2166
*            END VOL2;                                             2167
*                                                                  2167
*        /************************************************************/
*        /*                                                          */
*        /*  IF DEVICETYPES WAS SPECIFIED IN THE AMS COMMAND, SET    */
*        /*  UP THE DEVTYP FPL AND FIELD INFORMATION.  THIS          */
*        /*  PARAMETER MAY ONLY BE SPECIFIED FOR  A USER CATALOG     */
*        /*  OR A NONVSAM OBJECT.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  2168
*        IF DEVTPTR(LX) ^= NULLPTR                                 2168
*          THEN                                                    2168
@RF02139 L     @04,@PC00012                                        2168
         L     @04,LX(,@04)                                        2168
         SLA   @04,2                                               2168
         L     @15,@PC00001+4                                      2168
         L     @01,FDTPTR+32(,@15)                                 2168
         AL    @01,@CF01779                                        2168
         L     @04,DEVTPTR(@04,@01)                                2168
         LTR   @04,@04                                             2168
         BZ    @RF02168                                            2168
*DEVTYP2:    DO;                                                   2169
*                                                                  2169
DEVTYP2  DS    0H                                                  2170
*            /********************************************************/
*            /*                                                      */
*            /*  IF CTGFVDVT IS NOT EQUAL TO NULLPTR, THEN A         */
*            /*  DEVICETYPES LIST WAS CONSTRUCTED FROM INFORMATION   */
*            /*  ON THE PORTABLE DATA SET.  THIS INFORMATION IS TO   */
*            /*  BE OVERRIDDEN WITH THAT FROM THE OBJECTS PARAMETER. */
*            /*  FREE UP THE CORE OCCUPIED BY THE DEVICETYPES FPL    */
*            /*  AND BY THE DEVICETYPES LIST.  RESET CTGFVDVT TO     */
*            /*  NULLPTR.                                            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2170
*            IF CTGFVDVT ^= NULLPTR                                2170
*              THEN                                                2170
         L     @04,CTGFVPTR                                        2170
         L     @15,CTGFVDVT(,@04)                                  2170
         LTR   @15,@15                                             2170
         BZ    @RF02170                                            2170
*                DO;                                               2171
*                CALL IDCSAFS0(GDTTBL,CTGFVDVT);                   2172
         L     @15,@PC00001                                        2172
         ST    @15,@AL00001                                        2172
         LA    @04,CTGFVDVT(,@04)                                  2172
         ST    @04,@AL00001+4                                      2172
         L     @15,GDTFSP(,@15)                                    2172
         LA    @01,@AL00001                                        2172
         BALR  @14,@15                                             2172
*                RESPECIFY RTNREG RSTD;                            2173
*                TESTRC = RTNREG;                                  2174
         STH   RTNREG,TESTRC                                       2174
*                RESPECIFY RTNREG UNRSTD;                          2175
*                IF TESTRC ^= 0                                    2176
*                  THEN                                            2176
         LH    @04,TESTRC                                          2176
         LTR   @04,@04                                             2176
         BZ    @RF02176                                            2176
*                    RETURN CODE(LASTCC12);                        2177
         LA    @15,12                                              2177
         L     @14,@SA00012                                        2177
         LM    @00,@12,@SA00012+8                                  2177
         BR    @14                                                 2177
*                CTGFVDVT = NULLPTR;                               2178
@RF02176 L     @04,CTGFVPTR                                        2178
         SLR   @15,@15                                             2178
         ST    @15,CTGFVDVT(,@04)                                  2178
*                END;                                              2179
*                                                                  2179
*            /********************************************************/
*            /*                                                      */
*            /*  GET CORE FOR THE FPL PLUS THE FIELD INFORMATION     */
*            /*  IF CORE IS NOT OBTAINED, RETURN TO CALLING PROCESSOR*/
*            /*                                                      */
*            /********************************************************/
*                                                                  2180
*            TOTLEN = (LENGTH(CTGFL) + 8) + DEVTPTR(LX)->DEVTCNT * 2180
*               LENGTH(FDEVTYP);                                   2180
*                                                                  2180
@RF02170 L     @04,@PC00012                                        2180
         L     @04,LX(,@04)                                        2180
         SLA   @04,2                                               2180
         L     @15,@PC00001+4                                      2180
         L     @01,FDTPTR+32(,@15)                                 2180
         AL    @01,@CF01779                                        2180
         L     @04,DEVTPTR(@04,@01)                                2180
         LH    @04,DEVTCNT(,@04)                                   2180
         MH    @04,@CH00035                                        2180
         AL    @04,@CF00312                                        2180
         ST    @04,TOTLEN                                          2180
*            CALL IDCSAGP0 (GDTTBL,TOTLEN,CTGFVDVT,GPID,SETZERO);  2181
*                                                                  2181
         L     @04,@PC00001                                        2181
         ST    @04,@AL00001                                        2181
         LA    @15,TOTLEN                                          2181
         ST    @15,@AL00001+4                                      2181
         L     @01,CTGFVPTR                                        2181
         LA    @15,CTGFVDVT(,@01)                                  2181
         ST    @15,@AL00001+8                                      2181
         LA    @15,GPID                                            2181
         ST    @15,@AL00001+12                                     2181
         LA    @15,SETZERO                                         2181
         ST    @15,@AL00001+16                                     2181
         MVI   @AL00001+16,X'80'                                   2181
         L     @15,GDTGPL(,@04)                                    2181
         LA    @01,@AL00001                                        2181
         BALR  @14,@15                                             2181
*            RESPECIFY RTNREG RSTD;                                2182
*            TESTRC = RTNREG;                                      2183
         STH   RTNREG,TESTRC                                       2183
*            RESPECIFY RTNREG UNRSTD;                              2184
*            IF TESTRC ^= 0                                        2185
*              THEN                                                2185
         LH    @04,TESTRC                                          2185
         LTR   @04,@04                                             2185
         BZ    @RF02185                                            2185
*                DO;                                               2186
*                DARGSMOD = UNIVMSG;                               2187
         L     @04,DDSTRU                                          2187
         MVC   DARGSMOD(3,@04),@CC00981                            2187
*                DEFSTID = NOSTORAG;                               2188
         MVI   DEFSTID,X'04'                                       2188
*                RETURN CODE(LASTCC12);                            2189
         LA    @15,12                                              2189
         L     @14,@SA00012                                        2189
         LM    @00,@12,@SA00012+8                                  2189
         BR    @14                                                 2189
*                END;                                              2190
*                                                                  2190
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT DEVICETYPES LIST                          */
*            /*                                                      */
*            /********************************************************/
*                                                                  2191
*            CTGFLPTR = CTGFVDVT;                                  2191
@RF02185 L     @04,CTGFVPTR                                        2191
         L     @04,CTGFVDVT(,@04)                                  2191
         ST    @04,CTGFLPTR                                        2191
*            FDEVTPTR = CTGFVDVT + LENGTH(CTGFL) +8;               2192
         AL    @04,@CF00312                                        2192
         ST    @04,FDEVTPTR                                        2192
*            DO N = 1 TO  DEVTPTR(LX)->DEVTCNT;                    2193
         LA    @04,1                                               2193
         B     @DE02193                                            2193
@DL02193 DS    0H                                                  2194
*              FDEVT(N) = DEVTPTR(LX) -> DEVTVAL(N,1:8);           2194
         LR    @15,@04                                             2194
         MH    @15,@CH00035                                        2194
         L     @01,FDEVTPTR                                        2194
         ALR   @01,@15                                             2194
         AL    @01,@CF01804                                        2194
         LR    @15,@04                                             2194
         MH    @15,@CH00037                                        2194
         L     @14,@PC00012                                        2194
         L     @14,LX(,@14)                                        2194
         SLA   @14,2                                               2194
         L     @03,@PC00001+4                                      2194
         L     @03,FDTPTR+32(,@03)                                 2194
         AL    @03,@CF01779                                        2194
         L     @14,DEVTPTR(@14,@03)                                2194
         ALR   @14,@15                                             2194
         AL    @14,@CF01805                                        2194
         MVC   FDEVT(8,@01),DEVTVAL-3(@14)                         2194
*            END;                                                  2195
*                                                                  2195
         AL    @04,@CF00221                                        2195
@DE02193 ST    @04,N                                               2195
         L     @15,@PC00012                                        2195
         L     @15,LX(,@15)                                        2195
         SLA   @15,2                                               2195
         L     @14,@PC00001+4                                      2195
         L     @01,FDTPTR+32(,@14)                                 2195
         AL    @01,@CF01779                                        2195
         L     @01,DEVTPTR(@15,@01)                                2195
         CH    @04,DEVTCNT(,@01)                                   2195
         BNH   @DL02193                                            2195
*            /********************************************************/
*            /*                                                      */
*            /*  SET FIELDS IN DEVTYP FPL                            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2196
*            CTGFLDNO = '00000001'B;                               2196
         L     @04,CTGFLPTR                                        2196
         MVI   CTGFLDNO(@04),X'01'                                 2196
*            CTGFLDNM = ADDR(FNDEVTYP);                            2197
         LA    @15,FNDEVTYP                                        2197
         ST    @15,CTGFLDNM(,@04)                                  2197
*            CTGFLNG(1) = DEVTPTR(LX)->DEVTCNT * LENGTH(FDEVTYP);  2198
         L     @15,@PC00012                                        2198
         L     @15,LX(,@15)                                        2198
         SLA   @15,2                                               2198
         L     @14,@PC00001+4                                      2198
         L     @01,FDTPTR+32(,@14)                                 2198
         AL    @01,@CF01779                                        2198
         L     @01,DEVTPTR(@15,@01)                                2198
         LH    @15,DEVTCNT(,@01)                                   2198
         MH    @15,@CH00035                                        2198
         ST    @15,CTGFLNG(,@04)                                   2198
*            CTGFLPT(1) = FDEVTPTR;                                2199
         L     @15,FDEVTPTR                                        2199
         ST    @15,CTGFLPT(,@04)                                   2199
*            END DEVTYP2;                                          2200
*                                                                  2200
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2201
*        RETURN CODE(0);                                           2201
*                                                                  2201
@RF02168 SLR   @15,@15                                             2201
         L     @14,@SA00012                                        2201
         LM    @00,@12,@SA00012+8                                  2201
         BR    @14                                                 2201
*END LVLRPROC;                                                     2202
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - CTLGPROC                                */
*        /*                                                          */
*        /*  FUNCTION - INVOKE THE VSAM CATALOG MANAGEMENT TO PERFORM*/
*        /*  THE OPERATION INDICATED IN THE CPL (ALTER OR DEFINE)    */
*        /*  EXAMINE THE RETURN CODE FROM CATALOG MANAGEMENT,GET MORE*/
*        /*  CATALOG WORK AREA IF REQUIRED, SET UP APPROPRIATE ERROR */
*        /*  INDICATORS                                              */
*        /*                                                          */
*        /*  INPUT - CATALOG PARAMETER LIST(CPL)                     */
*        /*                                                          */
*        /*  OUTPUT - RETURN CODE IS SET TO INDICATE SUCCESS OR      */
*        /*  FAILURE.  DEFSTID IS SET TO INDICATE MESSAGE ID IF      */
*        /*  AN ERROR MESSAGE IS TO BE LISTED.                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  2203
*CTLGPROC: PROCEDURE(SCPLPTR);         /*CPL POINTER                 */
*                                                                  2203
CTLGPROC STM   @14,@12,@SA00013                                    2203
         MVC   @PC00013(4),0(@01)                                  2203
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2204
*        DCL SCPLPTR PTR(31);                                      2204
*                                                                  2204
*        /************************************************************/
*        /*                                                          */
*        /* LOCAL DECLARATIONS                                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  2205
*        DCL WSIZE   FIXED(31);        /*SIZE OF WORK AREA NEEDED BY */
*                                      /*VSAM CATALOG MANAGEMENT     */
*        DCL VOLLSTOR CHAR(10) BDY(WORD);                          2206
*                                      /*STORAGE FOR THE             */
*                                      /*FAKE VOLUMES LIST           */
*                                      /*TO BE PASSED TO             */
*                                      /*DALCPROC WHEN CMS           */
*                                      /*PLACES THE VOLSER           */
*                                      /*TO BE ALLOCATED IN          */
*                                      /*THE WORKAREA.               */
*        DCL VOLLSTPT PTR(31);         /*POINTER TO VOLLSTOR         */
*        DCL JX       FIXED(31);       /*INDEX USED IN               */
*                                      /*VOLUME LIST                 */
*                                      /*RESTORE                     */
*        DCL JX1      FIXED(31);       /*INDEX USED IN               */
*                                      /*VOLUME LIST                 */
*                                      /*RESTORE                     */
*                                                                  2210
*                                                                  2210
*        /************************************************************/
*        /*                                                          */
*        /*  INVOKE  CATALOG MANAGEMENT                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2210
*        OLDERID2 = NEWERID2;                                      2210
         L     @04,@PC00001                                        2210
         L     @15,GDTTR2(,@04)                                    2210
         MVC   @TS00001(95),NEWERID2(@15)                          2210
         MVC   OLDERID2(95,@15),@TS00001                           2210
*        NEWID2 = 'RMSP';                                          2211
*                                                                  2211
         MVC   NEWID2(4,@15),@CC01550                              2211
*        IF GDTDBG = NULLPTR                                       2212
*          THEN;                                                   2212
         L     @04,GDTDBG(,@04)                                    2212
         LTR   @04,@04                                             2212
         BZ    @RT02212                                            2212
*          ELSE                                                    2214
*            CALL IDCDB010 (GDTTBL,'RMZZ');                        2214
*                                                                  2214
         L     @04,@PC00001                                        2214
         ST    @04,@AL00001                                        2214
         LA    @15,@CC01551                                        2214
         ST    @15,@AL00001+4                                      2214
         MVI   @AL00001+4,X'80'                                    2214
         L     @15,GDTDBG(,@04)                                    2214
         LA    @01,@AL00001                                        2214
         BALR  @14,@15                                             2214
*        CATRTNID = 'CATLGRTN';                                    2215
*                                                                  2215
@RT02212 MVC   CATRTNID(8),@CC01552                                2215
*        CALL IDCSACA0 (GDTTBL,SCPLPTR);                           2216
*                                                                  2216
         L     @04,@PC00001                                        2216
         ST    @04,@AL00001                                        2216
         L     @15,@PC00013                                        2216
         ST    @15,@AL00001+4                                      2216
         L     @15,GDTCAT(,@04)                                    2216
         LA    @01,@AL00001                                        2216
         BALR  @14,@15                                             2216
*        RESPECIFY REG15 RSTD;                                     2217
*        CATLGRC = REG15;                                          2218
         STH   REG15,CATLGRC                                       2218
*        RESPECIFY REG15 UNRSTD;                                   2219
*                                                                  2219
*        IF GDTDBG = NULLPTR                                       2220
*          THEN;                                                   2220
         L     @04,@PC00001                                        2220
         L     @04,GDTDBG(,@04)                                    2220
         LTR   @04,@04                                             2220
         BZ    @RT02220                                            2220
*          ELSE                                                    2222
*            CALL IDCDB010 (GDTTBL,'RMZZ');                        2222
         L     @04,@PC00001                                        2222
         ST    @04,@AL00001                                        2222
         LA    @15,@CC01551                                        2222
         ST    @15,@AL00001+4                                      2222
         MVI   @AL00001+4,X'80'                                    2222
         L     @15,GDTDBG(,@04)                                    2222
         LA    @01,@AL00001                                        2222
         BALR  @14,@15                                             2222
*        CTGPLPTR = SCPLPTR;                                       2223
*                                                                  2223
@RT02220 L     @04,@PC00013                                        2223
         L     @04,SCPLPTR(,@04)                                   2223
         ST    @04,CTGPLPTR                                        2223
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE RETURN CODE INDICATES AN ERROR, TEST FOR WORK    */
*        /*  AREA TOO SMALL.  IF IT IS, GET A NEW WORK AREA AFTER    */
*        /*  FREEING THE OLD ONE.  RE-INVOKE CATALOG MANAGEMENT      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2224
*        IF CATLGRC ^= 0                                           2224
*          THEN                                                    2224
         LH    @15,CATLGRC                                         2224
         SLR   @14,@14                                             2224
         CR    @15,@14                                             2224
         BE    @RF02224                                            2224
*            IF CATLGRC = RCWORKSM                                 2225
*              THEN                                                2225
         C     @15,@CF01127                                        2225
         BNE   @RF02225                                            2225
*                DO;                                               2226
*                                                                  2226
*                /****************************************************/
*                /*                                                  */
*                /*  GET NEEDED SIZE FROM CATALOG WORKAREA           */
*                /*                                                  */
*                /****************************************************/
*                                                                  2227
*                WSIZE = RETURNLN;                                 2227
*                                                                  2227
         L     @01,CTGWKA(,@04)                                    2227
         LH    @15,RETURNLN(,@01)                                  2227
         ST    @15,WSIZE                                           2227
*                /****************************************************/
*                /*                                                  */
*                /*  RESET CTGWKA TO NULLPTR.  THE AREA OCCUPIED     */
*                /*  BY THE CATALOG WORK AREA WAS GOTTEN AS A        */
*                /*  PART OF THE SPACE FOR THE CATALOG PARAMETER     */
*                /*  LIST, AND SO CANNOT BE FREED UP SEPARATELY.     */
*                /*                                                  */
*                /****************************************************/
*                                                                  2228
*                CTGWKA = NULLPTR;                                 2228
*                                                                  2228
         ST    @14,CTGWKA(,@04)                                    2228
*                /****************************************************/
*                /*                                                  */
*                /*  GET CORE FOR THE LARGER WORK AREA.  IF CORE IS  */
*                /*  NOT GOTTEN SUCCESSFULLY, RETURN TO THE CALLING  */
*                /*  PROCESSOR.                                      */
*                /*                                                  */
*                /****************************************************/
*                                                                  2229
*                CALL IDCSAGP0 (GDTTBL,WSIZE,CTGWKA,GPID,SETZERO); 2229
*                                                                  2229
         L     @15,@PC00001                                        2229
         ST    @15,@AL00001                                        2229
         LA    @14,WSIZE                                           2229
         ST    @14,@AL00001+4                                      2229
         LA    @04,CTGWKA(,@04)                                    2229
         ST    @04,@AL00001+8                                      2229
         LA    @04,GPID                                            2229
         ST    @04,@AL00001+12                                     2229
         LA    @04,SETZERO                                         2229
         ST    @04,@AL00001+16                                     2229
         MVI   @AL00001+16,X'80'                                   2229
         L     @15,GDTGPL(,@15)                                    2229
         LA    @01,@AL00001                                        2229
         BALR  @14,@15                                             2229
*                RESPECIFY RTNREG RSTD;                            2230
*                TESTRC = RTNREG;                                  2231
         STH   RTNREG,TESTRC                                       2231
*                RESPECIFY RTNREG UNRSTD;                          2232
*                IF TESTRC ^= 0                                    2233
*                  THEN                                            2233
         LH    @04,TESTRC                                          2233
         LTR   @04,@04                                             2233
         BZ    @RF02233                                            2233
*                    DO;                                           2234
*                    DEFSTID = NOSTORAG;                           2235
         MVI   DEFSTID,X'04'                                       2235
*                    DARGSMOD = UNIVMSG;                           2236
         L     @04,DDSTRU                                          2236
         MVC   DARGSMOD(3,@04),@CC00981                            2236
*                    RETURN CODE(LASTCC12);                        2237
         LA    @15,12                                              2237
         L     @14,@SA00013                                        2237
         LM    @00,@12,@SA00013+8                                  2237
         BR    @14                                                 2237
*                    END;                                          2238
*                                                                  2238
*                AREALN = WSIZE;                                   2239
*                                                                  2239
@RF02233 L     @04,CTGPLPTR                                        2239
         L     @04,CTGWKA(,@04)                                    2239
         L     @15,WSIZE                                           2239
         STH   @15,AREALN(,@04)                                    2239
*                /****************************************************/
*                /*                                                  */
*                /*  RE- INVOKE CATALOG MANAGEMENT                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  2240
*                CALL IDCSACA0 (GDTTBL,SCPLPTR);                   2240
*                                                                  2240
         L     @04,@PC00001                                        2240
         ST    @04,@AL00001                                        2240
         L     @15,@PC00013                                        2240
         ST    @15,@AL00001+4                                      2240
         L     @15,GDTCAT(,@04)                                    2240
         LA    @01,@AL00001                                        2240
         BALR  @14,@15                                             2240
*                RESPECIFY REG15 RSTD;                             2241
*                CATLGRC = REG15;                                  2242
         STH   REG15,CATLGRC                                       2242
*                RESPECIFY REG15 UNRSTD;                           2243
*                END;                                              2244
*                                                                  2244
*              ELSE                                                2245
*                                                                  2245
*                /****************************************************/
*                /*                                                  */
*                /*  TEST FOR A VSAM CATALOG RETURN CODE OF          */
*                /*  140 WITH A REASON CODE OF 40.  THIS             */
*                /*  INDICATES THAT A VOLUME MUST BE                 */
*                /*  DYNAMICALLY ALLOCATED SO THAT ITS CRA           */
*                /*  CAN BE UPDATED.                                 */
*                /*                                                  */
*                /****************************************************/
*                                                                  2245
*                IF (CATLGRC = DEFALLRC) & (CTGFBFLG =             2245
*                   DEFALLFG)                                      2245
*                  THEN                                            2245
         B     @RC02225                                            2245
@RF02225 CLC   CATLGRC(2),@CH01139                                 2245
         BNE   @RF02245                                            2245
         L     @04,CTGPLPTR                                        2245
         CLC   CTGFBFLG(2,@04),@CH01127                            2245
         BNE   @RF02245                                            2245
*DEFALLC:            DO;                                           2246
*                                                                  2246
DEFALLC  DS    0H                                                  2247
*                    /************************************************/
*                    /*                                              */
*                    /*  VSAM CATALOG MANAGEMENT IS TO BE            */
*                    /*  INVOKED AGAIN.  RESTORE THE CATALOG         */
*                    /*  PARAMETER LISTS TO BE PASSED TO             */
*                    /*  VSAM.                                       */
*                    /*                                              */
*                    /************************************************/
*                                                                  2247
*                    IF (CTGFVT->CTGFVTYP = CTGTCL) ×              2247
*                         (CTGFVT->CTGFVTYP = CTGTAIX)             2247
*                      THEN                                        2247
         L     @04,CTGPLPTR                                        2247
         L     @04,CTGFVT(,@04)                                    2247
         CLI   CTGFVTYP(@04),C'C'                                  2247
         BE    @RT02247                                            2247
         CLI   CTGFVTYP(@04),C'G'                                  2247
         BNE   @RF02247                                            2247
@RT02247 DS    0H                                                  2248
*DEFCALLC:               DO;                                       2248
DEFCALLC DS    0H                                                  2249
*                        CTGPL = SAVCPL;                           2249
         L     @04,CTGPLPTR                                        2249
         MVC   CTGPL(28,@04),SAVCPL                                2249
*                        DO JX = 1 TO NUMCOMP;                     2250
         LA    @04,1                                               2250
         B     @DE02250                                            2250
@DL02250 DS    0H                                                  2251
*                          CALL MVDAPROC(TFVTLEN,SAVFVT(JX),       2251
*                             FVTPTR(JX));                         2251
         LA    @15,TFVTLEN                                         2251
         ST    @15,@AL00001                                        2251
         SLA   @04,2                                               2251
         LA    @15,SAVFVT-4(@04)                                   2251
         ST    @15,@AL00001+4                                      2251
         LA    @04,FVTPTR-4(@04)                                   2251
         ST    @04,@AL00001+8                                      2251
         LA    @01,@AL00001                                        2251
         BAL   @14,MVDAPROC                                        2251
*                          IF CTGFVVLT ^= NULLPTR                  2252
*                            THEN                                  2252
         L     @04,CTGFVPTR                                        2252
         L     @04,CTGFVVLT(,@04)                                  2252
         LTR   @04,@04                                             2252
         BZ    @RF02252                                            2252
*                              DO JX1 = 1 TO (FLISTLN/             2253
*                                 LENGTH(FVOLSERL));               2253
         LA    @04,1                                               2253
         B     @DE02253                                            2253
@DL02253 DS    0H                                                  2254
*                                FVOLRTN(JX1) = 0;                 2254
         LR    @15,@04                                             2254
         SLA   @15,3                                               2254
         L     @01,CTGFVPTR                                        2254
         L     @01,CTGFVVLT(,@01)                                  2254
         ALR   @01,@15                                             2254
         AL    @01,@CF01786                                        2254
         SLR   @00,@00                                             2254
         STCM  @00,3,FVOLRTN-2(@01)                                2254
*                              END;                                2255
         AL    @04,@CF00221                                        2255
@DE02253 ST    @04,JX1                                             2255
         L     @01,CTGFVPTR                                        2255
         L     @01,CTGFVVLT(,@01)                                  2255
         LH    @00,FLISTLN(,@01)                                   2255
         SRDA  @00,32                                              2255
         D     @00,@CF00039                                        2255
         CR    @04,@01                                             2255
         BNH   @DL02253                                            2255
*                        END;                                      2256
*                                                                  2256
@RF02252 LA    @04,1                                               2256
         AL    @04,JX                                              2256
@DE02250 ST    @04,JX                                              2256
         CH    @04,NUMCOMP                                         2256
         BNH   @DL02250                                            2256
*                        /********************************************/
*                        /*                                          */
*                        /*  IF THERE IS A NULL VOLUME               */
*                        /*  FVT, RESTORE THAT.                      */
*                        /*                                          */
*                        /********************************************/
*                                                                  2257
*                        IF FVTPTR(1) -> CTGFVVCH ^= NULLPTR       2257
*                          THEN                                    2257
         L     @04,FVTPTR                                          2257
         L     @04,CTGFVVCH(,@04)                                  2257
         LTR   @04,@04                                             2257
         BZ    @RF02257                                            2257
*                            DO;                                   2258
*                            IUNIQFVT = ''B;                       2259
         XC    IUNIQFVT(92),IUNIQFVT                               2259
*                            FVTPTR(1) -> CTGFVVCH -> CTGFVTYP     2260
*                               = CTGFVVOL;                        2260
         MVI   CTGFVTYP(@04),C'V'                                  2260
*                            END;                                  2261
*                                                                  2261
*                        /********************************************/
*                        /*                                          */
*                        /*  IF THE OBJECT BEING DEFINED IS          */
*                        /*  AN ALTERNATE INDEX, THEN                */
*                        /*  THEN CMS HAS PLACED THE VOLUME          */
*                        /*  SERIAL OF THE VOLUME TO BE              */
*                        /*  ALLOCATED IN THE WORK AREA.             */
*                        /*                                          */
*                        /********************************************/
*                                                                  2262
*                        IF (FVTPTR(1) -> CTGFVTYP = CTGTAIX)      2262
*                          THEN                                    2262
@RF02257 L     @04,FVTPTR                                          2262
         CLI   CTGFVTYP(@04),C'G'                                  2262
         BNE   @RF02262                                            2262
*                            DO;                                   2263
*                                                                  2263
*                            /****************************************/
*                            /*                                      */
*                            /*  BUILD A FAKE VOLUMES LIST TO BE     */
*                            /*  PASSED TO DALCPROC.                 */
*                            /*  RESPECIFY THE VOLUME LIST           */
*                            /*  OVERLAY TO BE BASED ON VOLLSTPT     */
*                            /*  AND ESTABLISH ADDRESSABILITY TO     */
*                            /*  THE STORAGE FOR THE VOLUME LIST.    */
*                            /*                                      */
*                            /****************************************/
*                                                                  2264
*                            RESPECIFY FLISTVOL BASED(VOLLSTPT);   2264
*                            VOLLSTPT = ADDR(VOLLSTOR);            2265
*                                                                  2265
         LA    @15,VOLLSTOR                                        2265
         ST    @15,VOLLSTPT                                        2265
*                            /****************************************/
*                            /*                                      */
*                            /*  BUILD THE FAKE VOLUMES LIST AND     */
*                            /*  CALL DALCPROC.                      */
*                            /*                                      */
*                            /****************************************/
*                                                                  2266
*                            FLISTLN = LENGTH(FVOLSERL(1));        2266
         MVC   FLISTLN(2,@15),@CH00039                             2266
*                            FVOLSER(1) = CATRCWKA;                2267
*                                                                  2267
         MVC   FVOLSER(6,@15),CATRCWKA                             2267
*                            CALL DALCPROC('A',VOLLSTPT,           2268
*                               FVTPTR(1) -> CTGFVIND,DALCINDX);   2268
*                                                                  2268
         LA    @15,@CC00755                                        2268
         ST    @15,@AL00001                                        2268
         LA    @15,VOLLSTPT                                        2268
         ST    @15,@AL00001+4                                      2268
         LA    @04,CTGFVIND(,@04)                                  2268
         ST    @04,@AL00001+8                                      2268
         LA    @04,DALCINDX                                        2268
         ST    @04,@AL00001+12                                     2268
         LA    @01,@AL00001                                        2268
         BAL   @14,DALCPROC                                        2268
*                            /****************************************/
*                            /*                                      */
*                            /*  TEST THE RETURN CODE FROM           */
*                            /*  DALCPROC.  IF IT IS NON-ZERO,       */
*                            /*  INDICATE A FAILURE, AND RETURN      */
*                            /*  TO THE CALLING PROCESSOR.           */
*                            /*                                      */
*                            /****************************************/
*                                                                  2269
*                            RESPECIFY RTNREG RSTD;                2269
*                            TESTRC = RTNREG;                      2270
         STH   RTNREG,TESTRC                                       2270
*                            RESPECIFY RTNREG UNRSTD;              2271
*                            IF TESTRC ^= 0                        2272
*                              THEN                                2272
         LH    @04,TESTRC                                          2272
         LTR   @04,@04                                             2272
         BZ    @RF02272                                            2272
*                                RETURN CODE(LASTCC12);            2273
         LA    @15,12                                              2273
         L     @14,@SA00013                                        2273
         LM    @00,@12,@SA00013+8                                  2273
         BR    @14                                                 2273
*                            RESPECIFY FLISTVOL                    2274
*                               BASED(CTGFVVLT);                   2274
@RF02272 DS    0H                                                  2275
*                            END;                                  2275
*                                                                  2275
*                    /************************************************/
*                    /*                                              */
*                    /*  IF THERE IS A DATA COMPONENT PRESENT,       */
*                    /*  DYNAMICALLY ALLOCATE THE VOLUMES FROM       */
*                    /*  THE VOLUMES LIST AT THE DATA LEVEL.         */
*                    /*                                              */
*                    /************************************************/
*                                                                  2276
*                    IF FVTPTR(2) ^= NULLPTR                       2276
*                      THEN                                        2276
@RF02262 SLR   @04,@04                                             2276
         L     @15,FVTPTR+4                                        2276
         CR    @15,@04                                             2276
         BE    @RF02276                                            2276
*                        IF (FVTPTR(2) -> CTGFVIND = NULLPTR)      2277
*                           & (FVTPTR(2) -> CTGFVVLT ^=            2277
*                           NULLPTR)                               2277
*                          THEN                                    2277
         C     @04,CTGFVIND(,@15)                                  2277
         BNE   @RF02277                                            2277
         C     @04,CTGFVVLT(,@15)                                  2277
         BE    @RF02277                                            2277
*                            DO;                                   2278
*                            CALL DALCPROC('A',                    2279
*                               FVTPTR(2) -> CTGFVVLT,             2279
*                               FVTPTR(2) -> CTGFVIND,             2279
*                               DALCINDX);                         2279
         LA    @04,@CC00755                                        2279
         ST    @04,@AL00001                                        2279
         LA    @04,CTGFVVLT(,@15)                                  2279
         ST    @04,@AL00001+4                                      2279
         LA    @04,CTGFVIND(,@15)                                  2279
         ST    @04,@AL00001+8                                      2279
         LA    @04,DALCINDX                                        2279
         ST    @04,@AL00001+12                                     2279
         LA    @01,@AL00001                                        2279
         BAL   @14,DALCPROC                                        2279
*                            RESPECIFY RTNREG RSTD;                2280
*                            TESTRC = RTNREG;                      2281
         STH   RTNREG,TESTRC                                       2281
*                            RESPECIFY RTNREG UNRSTD;              2282
*                            IF TESTRC ^= 0                        2283
*                              THEN                                2283
         LH    @04,TESTRC                                          2283
         LTR   @04,@04                                             2283
         BZ    @RF02283                                            2283
*                                RETURN CODE(LASTCC12);            2284
         LA    @15,12                                              2284
         L     @14,@SA00013                                        2284
         LM    @00,@12,@SA00013+8                                  2284
         BR    @14                                                 2284
*                            END;                                  2285
*                                                                  2285
@RF02283 DS    0H                                                  2286
*                    /************************************************/
*                    /*                                              */
*                    /*  IF THERE IS AN INDEX COMPONENT PRESENT,     */
*                    /*  DYNAMICALLY ALLOCATE THE VOLUMES FROM       */
*                    /*  THE VOLUMES LIST AT THE INDEX LEVEL.        */
*                    /*                                              */
*                    /************************************************/
*                                                                  2286
*                    IF FVTPTR(3) ^= NULLPTR                       2286
*                      THEN                                        2286
@RF02277 DS    0H                                                  2286
@RF02276 SLR   @04,@04                                             2286
         L     @15,FVTPTR+8                                        2286
         CR    @15,@04                                             2286
         BE    @RF02286                                            2286
*                        IF (FVTPTR(3) -> CTGFVIND = NULLPTR)      2287
*                           & (FVTPTR(3) -> CTGFVVLT ^=            2287
*                           NULLPTR)                               2287
*                          THEN                                    2287
         C     @04,CTGFVIND(,@15)                                  2287
         BNE   @RF02287                                            2287
         C     @04,CTGFVVLT(,@15)                                  2287
         BE    @RF02287                                            2287
*                            DO;                                   2288
*                            CALL DALCPROC('A',                    2289
*                               FVTPTR(3) -> CTGFVVLT,             2289
*                               FVTPTR(3) -> CTGFVIND,             2289
*                               DALCINDX);                         2289
         LA    @04,@CC00755                                        2289
         ST    @04,@AL00001                                        2289
         LA    @04,CTGFVVLT(,@15)                                  2289
         ST    @04,@AL00001+4                                      2289
         LA    @04,CTGFVIND(,@15)                                  2289
         ST    @04,@AL00001+8                                      2289
         LA    @04,DALCINDX                                        2289
         ST    @04,@AL00001+12                                     2289
         LA    @01,@AL00001                                        2289
         BAL   @14,DALCPROC                                        2289
*                            RESPECIFY RTNREG RSTD;                2290
*                            TESTRC = RTNREG;                      2291
         STH   RTNREG,TESTRC                                       2291
*                            RESPECIFY RTNREG UNRSTD;              2292
*                            IF TESTRC ^= 0                        2293
*                              THEN                                2293
         LH    @04,TESTRC                                          2293
         LTR   @04,@04                                             2293
         BZ    @RF02293                                            2293
*                                RETURN CODE(LASTCC12);            2294
         LA    @15,12                                              2294
         L     @14,@SA00013                                        2294
         LM    @00,@12,@SA00013+8                                  2294
         BR    @14                                                 2294
*                            END;                                  2295
*                        END DEFCALLC;                             2296
*                      ELSE                                        2297
*DEFPALLC:               DO;                                       2297
*                                                                  2297
         B     @RC02247                                            2297
@RF02247 DS    0H                                                  2297
DEFPALLC DS    0H                                                  2298
*                        /********************************************/
*                        /*                                          */
*                        /*  HANDLE 140-40 FOR PATHS.                */
*                        /*                                          */
*                        /********************************************/
*                                                                  2298
*                        CTGPL = PSAVCPL;                          2298
*                                                                  2298
         L     @04,CTGPLPTR                                        2298
         MVC   CTGPL(28,@04),PSAVCPL                               2298
*                        /********************************************/
*                        /*                                          */
*                        /*  SET CTGFVT TO POINT TO THE FVT          */
*                        /*  FOR THE PATH DEFINE OPERATION.          */
*                        /*                                          */
*                        /********************************************/
*                                                                  2299
*                        CTGFVT = PFVTPTR;                         2299
*                                                                  2299
         L     @15,PFVTPTR                                         2299
         ST    @15,CTGFVT(,@04)                                    2299
*                        /********************************************/
*                        /*                                          */
*                        /*  IF THE OBJECT BEING DEFINED IS          */
*                        /*  A PATH, THEN                            */
*                        /*  THEN CMS HAS PLACED THE VOLUME          */
*                        /*  SERIAL OF THE VOLUME TO BE              */
*                        /*  ALLOCATED IN THE WORK AREA.             */
*                        /*                                          */
*                        /********************************************/
*                                                                  2300
*                        IF (PFVTPTR -> CTGFVTYP = CTGTPTH)        2300
*                          THEN                                    2300
         CLI   CTGFVTYP(@15),C'R'                                  2300
         BNE   @RF02300                                            2300
*                            DO;                                   2301
*                                                                  2301
*                            /****************************************/
*                            /*                                      */
*                            /*  BUILD A FAKE VOLUMES LIST TO BE     */
*                            /*  PASSED TO DALCPROC.                 */
*                            /*  RESPECIFY THE VOLUME LIST           */
*                            /*  OVERLAY TO BE BASED ON VOLLSTPT     */
*                            /*  AND ESTABLISH ADDRESSABILITY TO     */
*                            /*  THE STORAGE FOR THE VOLUME LIST.    */
*                            /*                                      */
*                            /****************************************/
*                                                                  2302
*                            RESPECIFY FLISTVOL BASED(VOLLSTPT);   2302
*                            VOLLSTPT = ADDR(VOLLSTOR);            2303
*                                                                  2303
         LA    @04,VOLLSTOR                                        2303
         ST    @04,VOLLSTPT                                        2303
*                            /****************************************/
*                            /*                                      */
*                            /*  BUILD THE FAKE VOLUMES LIST AND     */
*                            /*  CALL DALCPROC.                      */
*                            /*                                      */
*                            /****************************************/
*                                                                  2304
*                            FLISTLN = LENGTH(FVOLSERL(1));        2304
         MVC   FLISTLN(2,@04),@CH00039                             2304
*                            FVOLSER(1) = CATRCWKA;                2305
*                                                                  2305
         MVC   FVOLSER(6,@04),CATRCWKA                             2305
*                            CALL DALCPROC('A',VOLLSTPT,           2306
*                               PFVTPTR -> CTGFVIND,DALCINDX);     2306
*                                                                  2306
         LA    @04,@CC00755                                        2306
         ST    @04,@AL00001                                        2306
         LA    @04,VOLLSTPT                                        2306
         ST    @04,@AL00001+4                                      2306
         LA    @04,CTGFVIND(,@15)                                  2306
         ST    @04,@AL00001+8                                      2306
         LA    @04,DALCINDX                                        2306
         ST    @04,@AL00001+12                                     2306
         LA    @01,@AL00001                                        2306
         BAL   @14,DALCPROC                                        2306
*                            /****************************************/
*                            /*                                      */
*                            /*  TEST THE RETURN CODE FROM           */
*                            /*  DALCPROC.  IF IT IS NON-ZERO,       */
*                            /*  INDICATE A FAILURE, AND RETURN      */
*                            /*  TO THE CALLING PROCESSOR.           */
*                            /*                                      */
*                            /****************************************/
*                                                                  2307
*                            RESPECIFY RTNREG RSTD;                2307
*                            TESTRC = RTNREG;                      2308
         STH   RTNREG,TESTRC                                       2308
*                            RESPECIFY RTNREG UNRSTD;              2309
*                            IF TESTRC ^= 0                        2310
*                              THEN                                2310
         LH    @04,TESTRC                                          2310
         LTR   @04,@04                                             2310
         BZ    @RF02310                                            2310
*                                RETURN CODE(LASTCC12);            2311
         LA    @15,12                                              2311
         L     @14,@SA00013                                        2311
         LM    @00,@12,@SA00013+8                                  2311
         BR    @14                                                 2311
*                            RESPECIFY FLISTVOL                    2312
*                               BASED(CTGFVVLT);                   2312
@RF02310 DS    0H                                                  2313
*                            END;                                  2313
*                        END DEFPALLC;                             2314
*                                                                  2314
@RF02300 DS    0H                                                  2315
*                /****************************************************/
*                /*                                                  */
*                /*  NOW CALL VSAM CATALOG MANAGEMENT AGAIN.         */
*                /*                                                  */
*                /****************************************************/
*                                                                  2315
*                CALL IDCSACA0(GDTTBL,SCPLPTR);                    2315
*                                                                  2315
@RC02247 L     @04,@PC00001                                        2315
         ST    @04,@AL00001                                        2315
         L     @15,@PC00013                                        2315
         ST    @15,@AL00001+4                                      2315
         L     @15,GDTCAT(,@04)                                    2315
         LA    @01,@AL00001                                        2315
         BALR  @14,@15                                             2315
*                RESPECIFY REG15 RSTD;                             2316
*                CATLGRC = REG15;                                  2317
         STH   REG15,CATLGRC                                       2317
*                RESPECIFY REG15 UNRSTD;                           2318
*                                                                  2318
*                /****************************************************/
*                /*                                                  */
*                /*  CALL DALCPROC TO DYNAMICALLY UNALLOCATE         */
*                /*  THE VOLUMES ALLOCATED.                          */
*                /*                                                  */
*                /****************************************************/
*                                                                  2319
*                CALL DALCPROC('D',NULLPARM,NULLPARM,              2319
*                   DALCINDX);                                     2319
         MVC   @AL00001(12),@AL02319                               2319
         LA    @04,DALCINDX                                        2319
         ST    @04,@AL00001+12                                     2319
         LA    @01,@AL00001                                        2319
         BAL   @14,DALCPROC                                        2319
*                RESPECIFY RTNREG RSTD;                            2320
*                TESTRC = RTNREG;                                  2321
         STH   RTNREG,TESTRC                                       2321
*                RESPECIFY RTNREG UNRSTD;                          2322
*                IF TESTRC ^= 0                                    2323
*                  THEN                                            2323
         LH    @04,TESTRC                                          2323
         LTR   @04,@04                                             2323
         BZ    @RF02323                                            2323
*                    RETURN CODE(LASTCC12);                        2324
         LA    @15,12                                              2324
         L     @14,@SA00013                                        2324
         LM    @00,@12,@SA00013+8                                  2324
         BR    @14                                                 2324
*                END DEFALLC;                                      2325
*                                                                  2325
@RF02323 DS    0H                                                  2326
*        IF CATLGRC ^= 0 &                                         2326
*           (IMPF2NER = OFF × CATLGRC ^= DUPNAME)                  2326
*          THEN                                                    2326
@RF02245 DS    0H                                                  2326
@RC02225 DS    0H                                                  2326
@RF02224 LH    @04,CATLGRC                                         2326
         LTR   @04,@04                                             2326
         BZ    @RF02326                                            2326
         TM    IMPF2NER,B'00001000'                                2326
         BZ    @RT02326                                            2326
         C     @04,@CF00039                                        2326
         BE    @RF02326                                            2326
@RT02326 DS    0H                                                  2327
*ERCALL1:    DO;                                                   2327
*                                                                  2327
ERCALL1  DS    0H                                                  2328
*            /********************************************************/
*            /*                                                      */
*            /*  CLEAR THE STOARGE TO BE OCCUPIED BY THE             */
*            /*  ERROR CONVERSION TABLE.                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2328
*            ERRORTAB = ''B;                                       2328
*                                                                  2328
         XC    ERRORTAB(32),ERRORTAB                               2328
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCNVADR TO POINT TO THE STORAGE FOR THE        */
*            /*  ERROR CONVERSION TABLE.                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2329
*            ERCNVADR = ADDR(ERRORTAB);                            2329
*                                                                  2329
         LA    @04,ERRORTAB                                        2329
         ST    @04,ERCNVADR                                        2329
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCATLG TO BE ON TO INDICATE THAT THIS IS       */
*            /*  A CATALOG ERROR.  DETERMINE THE CMS FUNCTION BEING  */
*            /*  PERFORMED, AND SET THE APPROPRIATE EROPER BIT.      */
*            /*                                                      */
*            /********************************************************/
*                                                                  2330
*            ERCATLG = ON;                                         2330
         OI    ERCATLG(@04),B'10000000'                            2330
*            IF CTGOPTNS = CTGALTER                                2331
*              THEN                                                2331
*                                                                  2331
         L     @01,CTGPLPTR                                        2331
         TM    CTGOPTNS(@01),B'00010000'                           2331
         BNO   @RF02331                                            2331
         TM    CTGOPTNS(@01),B'11101000'                           2331
         BNZ   @RF02331                                            2331
*                /****************************************************/
*                /*                                                  */
*                /*  THE CATALOG OPERATION IS AN ALTER.  SET         */
*                /*  ERCATAL TO BE ON.                               */
*                /*                                                  */
*                /****************************************************/
*                                                                  2332
*                ERCATAL = ON;                                     2332
         OI    ERCATAL(@04),B'00010000'                            2332
*              ELSE                                                2333
*                IF CTGOPTNS = CTGDEFIN                            2333
*                  THEN                                            2333
*                                                                  2333
         B     @RC02331                                            2333
@RF02331 L     @04,CTGPLPTR                                        2333
         TM    CTGOPTNS(@04),B'00001000'                           2333
         BNO   @RF02333                                            2333
         TM    CTGOPTNS(@04),B'11110000'                           2333
         BNZ   @RF02333                                            2333
*                    /************************************************/
*                    /*                                              */
*                    /*  THE CATALOG OPERATION IS A DEFINE.  SET     */
*                    /*  ERCATDE TO BE ON.                           */
*                    /*                                              */
*                    /************************************************/
*                                                                  2334
*                    ERCATDE = ON;                                 2334
*                                                                  2334
         L     @04,ERCNVADR                                        2334
         OI    ERCATDE(@04),B'01000000'                            2334
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCATRC TO CATLGRC, AND SET ERCPLPT TO POINT    */
*            /*  TO THE CPL FOR THE CATALOG OPERATION.               */
*            /*                                                      */
*            /********************************************************/
*                                                                  2335
*            ERCATRC = CATLGRC;                                    2335
@RF02333 DS    0H                                                  2335
@RC02331 L     @04,ERCNVADR                                        2335
         LH    @15,CATLGRC                                         2335
         ST    @15,ERCATRC(,@04)                                   2335
*            ERCPLPT = CTGPLPTR;                                   2336
*                                                                  2336
         L     @15,CTGPLPTR                                        2336
         ST    @15,ERCPLPT(,@04)                                   2336
*            /********************************************************/
*            /*                                                      */
*            /*  SET A POINTER IN THE ERROR CONVERSION               */
*            /*  TABLE TO THE ENTRY NAME.                            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2337
*            ERDSNM = CTGFVT -> CTGFVENT;                          2337
*                                                                  2337
         L     @01,CTGFVT(,@15)                                    2337
         L     @15,CTGFVENT(,@01)                                  2337
         ST    @15,ERDSNM(,@04)                                    2337
*            /********************************************************/
*            /*                                                      */
*            /*  INVOKE THE UERROR ROUTINE BY ISSUING THE UERROR     */
*            /*  MACRO OF THE AMS TEXT PROCESSOR.                    */
*            /*                                                      */
*            /********************************************************/
*                                                                  2338
*            CALL IDCTPER0(GDTTBL,ERCNVADR);                       2338
         L     @04,@PC00001                                        2338
         ST    @04,@AL00001                                        2338
         LA    @15,ERCNVADR                                        2338
         ST    @15,@AL00001+4                                      2338
         MVI   @AL00001+4,X'80'                                    2338
         L     @15,GDTERR(,@04)                                    2338
         LA    @01,@AL00001                                        2338
         BALR  @14,@15                                             2338
*            RETURN CODE(LASTCC12);                                2339
         LA    @15,12                                              2339
         L     @14,@SA00013                                        2339
         LM    @00,@12,@SA00013+8                                  2339
         BR    @14                                                 2339
*            END ERCALL1;                                          2340
*                                                                  2340
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLER, INDICATING THE RESULT.            */
*        /*                                                          */
*        /************************************************************/
*                                                                  2341
*        IF CATLGRC ^= 0                                           2341
*          THEN                                                    2341
@RF02326 LH    @04,CATLGRC                                         2341
         LTR   @04,@04                                             2341
         BZ    @RF02341                                            2341
*            RETURN CODE(LASTCC12);                                2342
         LA    @15,12                                              2342
         L     @14,@SA00013                                        2342
         LM    @00,@12,@SA00013+8                                  2342
         BR    @14                                                 2342
*          ELSE                                                    2343
*            RETURN CODE(0);                                       2343
*                                                                  2343
@RF02341 SLR   @15,@15                                             2343
         L     @14,@SA00013                                        2343
         LM    @00,@12,@SA00013+8                                  2343
         BR    @14                                                 2343
*END CTLGPROC;                                                     2344
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - DELTPROC                               */
*        /*                                                          */
*        /*  FUNCTION - PERFORMS ALL CALLS TO CATALOG                */
*        /*  DELETE.  WILL ITERATIVELY CALL CATALOG                  */
*        /*  DELETE IF NECESSARY TO DELETE ALL OF THE                */
*        /*  OBJECT.                                                 */
*        /*                                                          */
*        /*  INPUT - A POINTER TO A CPL                              */
*        /*                                                          */
*        /*  OUTPUT - A PRINTED LIST OF ITEMS DELETED AND            */
*        /*  ANY APPROPRIATE ERROR MESSAGES.                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  2345
*DELTPROC: PROCEDURE(DLCPLPTR);                                    2345
*                                                                  2345
DELTPROC STM   @14,@12,@SA00014                                    2345
         MVC   @PC00014(4),0(@01)                                  2345
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2346
*        DCL DLCPLPTR PTR(31);         /*POINTER TO THE CPL          */
*                                                                  2346
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2347
*        DCL DSAVCPL CHAR(LENGTH(CTGPL));                          2347
*                                      /*SAVE AREA FOR               */
*                                      /*DELETE CPL                  */
*        DCL IX1 FIXED(31);            /*IX1 AND K ARE               */
*                                      /*USED FOR LOOP               */
*        DCL K FIXED(31);              /*CONTROL                     */
*        DCL LIMIT FIXED(15);          /*MAXIMUM NUMBER OF           */
*                                      /*CATALOG ENTRIES             */
*                                      /*THAT WILL FIT INTO          */
*                                      /*THE CURRENT WORK            */
*                                      /*AREA                        */
*        DCL COREFLAG BIT(1);          /*FLAG INDICATING             */
*                                      /*WHETHER CORE HAS            */
*                                      /*BEEN GOTTEN                 */
*        DCL SIZENEED FIXED(31);       /*SIZE OF WORK AREA           */
*                                      /*NEEDED                      */
*        DCL CURSIZE  FIXED(15);       /*CURRENT SIZE OF THE         */
*                                      /*WORK AREA                   */
*        DCL PLIMIT   FIXED(15);       /*NUMBER OF ENTRIES           */
*                                      /*TO BE PRINTED FROM          */
*                                      /*THE CMS WORKAREA            */
*                                                                  2355
*        OLDERID2 = NEWERID2;                                      2355
         L     @04,@PC00001                                        2355
         L     @15,GDTTR2(,@04)                                    2355
         MVC   @TS00001(95),NEWERID2(@15)                          2355
         MVC   OLDERID2(95,@15),@TS00001                           2355
*        NEWID2 = 'RMDL';                                          2356
*                                                                  2356
         MVC   NEWID2(4,@15),@CC01578                              2356
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE AND CALL CATALOG                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  2357
*        CTGPLPTR = DLCPLPTR;                                      2357
         L     @15,@PC00014                                        2357
         L     @14,DLCPLPTR(,@15)                                  2357
         ST    @14,CTGPLPTR                                        2357
*        DSAVCPL = CTGPL;                                          2358
         MVC   DSAVCPL(28),CTGPL(@14)                              2358
*        LIMIT = (AREALN - 4) / LENGTH(ENTITEM);                   2359
         L     @01,CTGWKA(,@14)                                    2359
         LH    @14,AREALN(,@01)                                    2359
         LR    @00,@14                                             2359
         SL    @00,@CF00046                                        2359
         SRDA  @00,32                                              2359
         D     @00,@CF01390                                        2359
         STH   @01,LIMIT                                           2359
*        CURSIZE = AREALN;                                         2360
         STH   @14,CURSIZE                                         2360
*        COREFLAG = OFF;                                           2361
         NI    COREFLAG,B'01111111'                                2361
*        DARGSMOD = DELMSG;                                        2362
         L     @14,DDSTRU                                          2362
         MVC   DARGSMOD(3,@14),@CC00989                            2362
*        DARGSENT = ENTRYMSG;                                      2363
         MVI   DARGSENT(@14),X'01'                                 2363
*        CATRTNID = 'CATLGRTN';                                    2364
*                                                                  2364
         MVC   CATRTNID(8),@CC01552                                2364
*        CALL IDCSACA0(GDTTBL,DLCPLPTR);                           2365
*                                                                  2365
         ST    @04,@AL00001                                        2365
         ST    @15,@AL00001+4                                      2365
         L     @15,GDTCAT(,@04)                                    2365
         LA    @01,@AL00001                                        2365
         BALR  @14,@15                                             2365
*        RESPECIFY REG15 RSTD;                                     2366
*        CATLGRC = REG15;                                          2367
         STH   REG15,CATLGRC                                       2367
*        RESPECIFY REG15 UNRSTD;                                   2368
*                                                                  2368
*        IF GDTDBG = NULLPTR                                       2369
*          THEN;                                                   2369
         L     @04,@PC00001                                        2369
         L     @04,GDTDBG(,@04)                                    2369
         LTR   @04,@04                                             2369
         BZ    @RT02369                                            2369
*          ELSE                                                    2371
*            CALL IDCDB010(GDTTBL,'RMDC');                         2371
*                                                                  2371
         L     @04,@PC00001                                        2371
         ST    @04,@AL00001                                        2371
         LA    @15,@CC01579                                        2371
         ST    @15,@AL00001+4                                      2371
         MVI   @AL00001+4,X'80'                                    2371
         L     @15,GDTDBG(,@04)                                    2371
         LA    @01,@AL00001                                        2371
         BALR  @14,@15                                             2371
*        /************************************************************/
*        /*                                                          */
*        /*  RESTORE THE CPL.  TO PREVENT CATALOG FROM               */
*        /*  RE-ERASING THE OBJECT ON SUBSEQUENT CALLS,              */
*        /*  SET CTGOVRID TO ON AND CTGERASE TO OFF. THEN            */
*        /*  SAVE THE CPL AGAIN.                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2372
*        IF (CATLGRC = RCWORKSM) × (CATLGRC = ALLORC1)             2372
*           × (CATLGRC = ALLORC2) × (CATLGRC = ALLORC3)            2372
*          THEN                                                    2372
@RT02369 LH    @04,CATLGRC                                         2372
         C     @04,@CF01127                                        2372
         BE    @RT02372                                            2372
         C     @04,@CF01129                                        2372
         BE    @RT02372                                            2372
         C     @04,@CF01137                                        2372
         BE    @RT02372                                            2372
         C     @04,@CF01131                                        2372
         BNE   @RF02372                                            2372
@RT02372 DS    0H                                                  2373
*            DO;                                                   2373
*            CTGPL = DSAVCPL;                                      2374
         L     @04,CTGPLPTR                                        2374
         MVC   CTGPL(28,@04),DSAVCPL                               2374
*            CTGERASE = OFF;                                       2375
*            CTGOVRID = ON;                                        2376
         OI    CTGOVRID(@04),B'00000100'                           2376
         NI    CTGERASE(@04),B'10111111'                           2376
*            DSAVCPL = CTGPL;                                      2377
         MVC   DSAVCPL(28),CTGPL(@04)                              2377
*            END;                                                  2378
*                                                                  2378
*        /************************************************************/
*        /*                                                          */
*        /*  IF VSAM CATALOG RETURNS A CODE OF 40, LOOP              */
*        /*  DELETING OBJECTS AND PRINTING THEM.  GET A              */
*        /*  LARGER WORK AREA AS NEEDED.                             */
*        /*  IF VSAM CATALOG RETURNS A CODE OF 72 OR ONE OF 76 OR ONE*/
*        /*  OF 240, SOMETHING MUST BE DYNAMICALLY                   */
*        /*  ALLOCATED.  LOOP PRINTING NAMES FROM THE                */
*        /*  WORKAREA, AND CALLING CATALOG, ALLOCATING               */
*        /*  OBJECTS NEEDED.                                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  2379
*DELLP:  DO WHILE (CATLGRC = RCWORKSM) × (CATLGRC = ALLORC1) ×     2379
*             (CATLGRC = ALLORC2) × (CATLGRC = ALLORC3);           2379
*                                                                  2379
@RF02372 DS    0H                                                  2379
DELLP    B     @DE02379                                            2379
@DL02379 DS    0H                                                  2380
*          IX1 = 1;                                                2380
*                                                                  2380
         MVC   IX1(4),@CF00221                                     2380
*          /**********************************************************/
*          /*                                                        */
*          /*  IF THE VSAM CATALOG RETURN CODE WAS 72 OR 76,         */
*          /*  ADJUST THE VALUE OF PLIMIT,  THE NUMBER OF            */
*          /*  ENTRIES TO BE PRINTED FROM THE CMS WORKAREA           */
*          /*  SO THAT THE OBJECT TO BE ALLOCATED AND ITS            */
*          /*  ASSOCIATIONS DO NOT GET PRINTED.                      */
*          /*  IN ALL OTHER CASES, THE VALUE OF PLIMIT IS            */
*          /*  THE SIZE OF THE WORK AREA.                            */
*          /*                                                        */
*          /**********************************************************/
*                                                                  2381
*          IF (CATLGRC = ALLORC1) × (CATLGRC = ALLORC3)            2381
*            THEN                                                  2381
         LH    @04,CATLGRC                                         2381
         C     @04,@CF01129                                        2381
         BE    @RT02381                                            2381
         C     @04,@CF01131                                        2381
         BNE   @RF02381                                            2381
@RT02381 DS    0H                                                  2382
*              PLIMIT = (RETURNLN - 4) / LENGTH(ENTITEM) - 1;      2382
         L     @04,CTGPLPTR                                        2382
         L     @04,CTGWKA(,@04)                                    2382
         LH    @00,RETURNLN(,@04)                                  2382
         SL    @00,@CF00046                                        2382
         SRDA  @00,32                                              2382
         D     @00,@CF01390                                        2382
         BCTR  @01,0                                               2382
         STH   @01,PLIMIT                                          2382
*            ELSE                                                  2383
*              PLIMIT = LIMIT;                                     2383
*                                                                  2383
         B     @RC02381                                            2383
@RF02381 LH    @04,LIMIT                                           2383
         STH   @04,PLIMIT                                          2383
*          /**********************************************************/
*          /*                                                        */
*          /*  LOOP THROUGH THE CATALOG WORK AREA, PRINTING          */
*          /*  THE NAMES OF THE OBJECTS DELETED.                     */
*          /*                                                        */
*          /**********************************************************/
*                                                                  2384
*          DO WHILE IX1 <= PLIMIT & ENTRYTYP(IX1) ^= 0;            2384
@RC02381 B     @DE02384                                            2384
@DL02384 DS    0H                                                  2385
*            DARGDBP = ADDR(ENTLIST(IX1));                         2385
         L     @04,DDSTRU                                          2385
         LA    @15,45                                              2385
         L     @01,IX1                                             2385
         MR    @00,@15                                             2385
         L     @14,CTGPLPTR                                        2385
         L     @14,CTGWKA(,@14)                                    2385
         AL    @14,@CF01798                                        2385
         LA    @14,ENTLIST-4(@01,@14)                              2385
         ST    @14,DARGDBP(,@04)                                   2385
*            DARGILP = LENGTH(ENTLIST(1));                         2386
         STH   @15,DARGILP(,@04)                                   2386
*            CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);                 2387
         L     @04,@PC00001                                        2387
         ST    @04,@AL00001                                        2387
         LA    @15,@CF00119                                        2387
         ST    @15,@AL00001+4                                      2387
         LA    @15,DDSTRU                                          2387
         ST    @15,@AL00001+8                                      2387
         MVI   @AL00001+8,X'80'                                    2387
         L     @15,GDTPRT(,@04)                                    2387
         LA    @01,@AL00001                                        2387
         BALR  @14,@15                                             2387
*            IX1 = IX1 + 1;                                        2388
         LA    @04,1                                               2388
         AL    @04,IX1                                             2388
         ST    @04,IX1                                             2388
*          END;                                                    2389
*                                                                  2389
@DE02384 L     @04,IX1                                             2389
         CH    @04,PLIMIT                                          2389
         BH    @DC02384                                            2389
         MH    @04,@CH01390                                        2389
         L     @01,CTGPLPTR                                        2389
         L     @01,CTGWKA(,@01)                                    2389
         AL    @01,@CF01798                                        2389
         SLR   @00,@00                                             2389
         IC    @00,ENTRYTYP-4(@04,@01)                             2389
         C     @00,@CF00119                                        2389
         BNE   @DL02384                                            2389
@DC02384 DS    0H                                                  2390
*          /**********************************************************/
*          /*                                                        */
*          /*  RESTORE THE CPL FOR THE NEXT CALL TO CATALOG.         */
*          /*                                                        */
*          /**********************************************************/
*                                                                  2390
*          CTGPL = DSAVCPL;                                        2390
*                                                                  2390
         L     @04,CTGPLPTR                                        2390
         MVC   CTGPL(28,@04),DSAVCPL                               2390
*          /**********************************************************/
*          /*                                                        */
*          /*  TEST FOR A VSAM CATALOG RETURN CODE OF 40.            */
*          /*                                                        */
*          /**********************************************************/
*                                                                  2391
*          IF CATLGRC = RCWORKSM                                   2391
*            THEN                                                  2391
         CLC   CATLGRC(2),@CH01127                                 2391
         BNE   @RF02391                                            2391
*MORESP:       DO;                                                 2392
*                                                                  2392
*                                                                  2392
MORESP   DS    0H                                                  2393
*              /******************************************************/
*              /*                                                    */
*              /*  COMPUTE THE AMOUNT OF SPACE NEEDED BY CMS         */
*              /*  TO CONTINUE WITH THE DELETE                       */
*              /*                                                    */
*              /******************************************************/
*                                                                  2393
*              SIZENEED = RETURNLN - (LENGTH(ENTITEM) *            2393
*                (IX1 - 1));                                       2393
*                                                                  2393
         L     @04,CTGPLPTR                                        2393
         L     @01,CTGWKA(,@04)                                    2393
         L     @00,IX1                                             2393
         BCTR  @00,0                                               2393
         MH    @00,@CH01390                                        2393
         LCR   @00,@00                                             2393
         AH    @00,RETURNLN(,@01)                                  2393
         ST    @00,SIZENEED                                        2393
*              /******************************************************/
*              /*                                                    */
*              /*  COMPARE THE AMOUNT OF CORE NEEDED WITH            */
*              /*  THAT AVAILABLE, AND GET A LARGER WORK             */
*              /*  AREA IF NEEDED.                                   */
*              /*                                                    */
*              /******************************************************/
*                                                                  2394
*              IF SIZENEED > CURSIZE                               2394
*                THEN                                              2394
         CH    @00,CURSIZE                                         2394
         BNH   @RF02394                                            2394
*                  DO;                                             2395
*                                                                  2395
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF WE HAVE GOTTEN CORE PREVIOUSLY,            */
*                  /*  FREE IT PRIOR TO GETTING ANOTHER              */
*                  /*  WORK AREA.                                    */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2396
*                  IF COREFLAG = ON                                2396
*                    THEN                                          2396
         TM    COREFLAG,B'10000000'                                2396
         BNO   @RF02396                                            2396
*                      CALL IDCSAFS0(GDTTBL,CTGWKA);               2397
         L     @15,@PC00001                                        2397
         ST    @15,@AL00001                                        2397
         LA    @04,CTGWKA(,@04)                                    2397
         ST    @04,@AL00001+4                                      2397
         L     @15,GDTFSP(,@15)                                    2397
         LA    @01,@AL00001                                        2397
         BALR  @14,@15                                             2397
*                    ELSE ;                                        2398
*                                                                  2398
@RF02396 DS    0H                                                  2399
*                  /**************************************************/
*                  /*                                                */
*                  /*  TURN THE COREFLAG ON AND ISSUE A              */
*                  /*  UGPOOL TO OBTAIN CORE.                        */
*                  /*                                                */
*                  /*************************************************/
*                                                                  2399
*                  COREFLAG = ON;                                  2399
*                                                                  2399
         OI    COREFLAG,B'10000000'                                2399
*                  CALL IDCSAGP0(GDTTBL,SIZENEED,                  2400
*                    CTGWKA,GPID,SETZERO);                         2400
*                                                                  2400
         L     @04,@PC00001                                        2400
         ST    @04,@AL00001                                        2400
         LA    @15,SIZENEED                                        2400
         ST    @15,@AL00001+4                                      2400
         L     @01,CTGPLPTR                                        2400
         LA    @15,CTGWKA(,@01)                                    2400
         ST    @15,@AL00001+8                                      2400
         LA    @15,GPID                                            2400
         ST    @15,@AL00001+12                                     2400
         LA    @15,SETZERO                                         2400
         ST    @15,@AL00001+16                                     2400
         MVI   @AL00001+16,X'80'                                   2400
         L     @15,GDTGPL(,@04)                                    2400
         LA    @01,@AL00001                                        2400
         BALR  @14,@15                                             2400
*                  RESPECIFY RTNREG RSTD;                          2401
*                  TESTRC = RTNREG;                                2402
         STH   RTNREG,TESTRC                                       2402
*                  RESPECIFY RTNREG UNRSTD;                        2403
*                  IF TESTRC ^= 0                                  2404
*                    THEN                                          2404
         LH    @04,TESTRC                                          2404
         LTR   @04,@04                                             2404
         BZ    @RF02404                                            2404
*                      DO;                                         2405
*                      DARGSMOD = UNIVMSG;                         2406
         L     @04,DDSTRU                                          2406
         MVC   DARGSMOD(3,@04),@CC00981                            2406
*                      DEFSTID = NOSTORAG;                         2407
         MVI   DEFSTID,X'04'                                       2407
*                      RETURN CODE(LASTCC12);                      2408
         LA    @15,12                                              2408
         L     @14,@SA00014                                        2408
         LM    @00,@12,@SA00014+8                                  2408
         BR    @14                                                 2408
*                      END;                                        2409
*                                                                  2409
*                  /**************************************************/
*                  /*                                                */
*                  /*  COMPUTE A NEW VALUE FOR LIMIT, AND            */
*                  /*  SET CURSIZE AND AREALN TO THE                 */
*                  /*  PROPER VALUES.                                */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2410
*                  LIMIT = (SIZENEED - 4) /                        2410
*                     LENGTH(ENTITEM);                             2410
@RF02404 L     @04,SIZENEED                                        2410
         LR    @00,@04                                             2410
         SL    @00,@CF00046                                        2410
         SRDA  @00,32                                              2410
         D     @00,@CF01390                                        2410
         STH   @01,LIMIT                                           2410
*                  CURSIZE = SIZENEED;                             2411
         STH   @04,CURSIZE                                         2411
*                  AREALN = SIZENEED;                              2412
         L     @01,CTGPLPTR                                        2412
         L     @01,CTGWKA(,@01)                                    2412
         STH   @04,AREALN(,@01)                                    2412
*                  END;                                            2413
*                                                                  2413
*                ELSE                                              2414
*                                                                  2414
*                  /**************************************************/
*                  /*                                                */
*                  /*  ZERO AND REUSE THE PRESENT CATALOG            */
*                  /*  WORK AREA.  IT IS ALREADY LARGE               */
*                  /*  ENOUGH.                                       */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2414
*                  DO;                                             2414
         B     @RC02394                                            2414
@RF02394 DS    0H                                                  2415
*                  RETURNLN = 0;                                   2415
         L     @04,CTGPLPTR                                        2415
         L     @04,CTGWKA(,@04)                                    2415
         SLR   @15,@15                                             2415
         STH   @15,RETURNLN(,@04)                                  2415
*                  DO J = 1 TO LIMIT;                              2416
         LA    @04,1                                               2416
         B     @DE02416                                            2416
@DL02416 DS    0H                                                  2417
*                    ENTLIST(J) = ''B;                             2417
         LR    @15,@04                                             2417
         MH    @15,@CH01390                                        2417
         L     @01,CTGPLPTR                                        2417
         L     @01,CTGWKA(,@01)                                    2417
         ALR   @01,@15                                             2417
         AL    @01,@CF01798                                        2417
         XC    ENTLIST-4(45,@01),ENTLIST-4(@01)                    2417
*                  END;                                            2418
         AL    @04,@CF00221                                        2418
@DE02416 ST    @04,J                                               2418
         CH    @04,LIMIT                                           2418
         BNH   @DL02416                                            2418
*                  END;                                            2419
*                                                                  2419
*              END MORESP;                                         2420
*                                                                  2420
*            ELSE                                                  2421
*                                                                  2421
*              /******************************************************/
*              /*                                                    */
*              /*  TEST FOR VSAM CATALOG RETURN CODES OF 72          */
*              /*  AND 240.  THESE INDICATE THAT SOMETHING           */
*              /*  MUST BE DYNAMICALLY ALLOCATED.                    */
*              /*                                                    */
*              /******************************************************/
*                                                                  2421
*              IF (CATLGRC = ALLORC1) × (CATLGRC = ALLORC2)        2421
*                 × (CATLGRC = ALLORC3)                            2421
*                THEN                                              2421
*                                                                  2421
         B     @RC02391                                            2421
@RF02391 LH    @04,CATLGRC                                         2421
         C     @04,@CF01129                                        2421
         BE    @RT02421                                            2421
         C     @04,@CF01137                                        2421
         BE    @RT02421                                            2421
         C     @04,@CF01131                                        2421
         BNE   @RF02421                                            2421
@RT02421 DS    0H                                                  2422
*ALLOCRC:          DO;                                             2422
*                                                                  2422
ALLOCRC  DS    0H                                                  2423
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF DEALLOC IS ON, SOMETHING HAS BEEN          */
*                  /*  DYNAMICALLY ALLOCATED.  DYNAMICALLY           */
*                  /*  UNALLOCATE THE OBJECT SO THAT THE             */
*                  /*  SAME STORAGE CAN BE USED FOR THE              */
*                  /*  ALLAGL OF THE NEXT THING TO BE                */
*                  /*  ALLOCATED.                                    */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2423
*                  IF DEALLOC = ON                                 2423
*                    THEN                                          2423
*                                                                  2423
         TM    DEALLOC,B'10000000'                                 2423
         BNO   @RF02423                                            2423
*                      DO;                                         2424
*                      DEALLOC = OFF;                              2425
*                                                                  2425
         NI    DEALLOC,B'01111111'                                 2425
*                      CALL IDCSADL0(GDTTBL,ALLAGL);               2426
         L     @04,@PC00001                                        2426
         ST    @04,@AL00001                                        2426
         L     @01,ALLPTR                                          2426
         ST    @01,@AL00001+4                                      2426
         MVI   @AL00001+4,X'80'                                    2426
         L     @15,GDTDLC(,@04)                                    2426
         LA    @01,@AL00001                                        2426
         BALR  @14,@15                                             2426
*                      RESPECIFY RTNREG RSTD;                      2427
*                      TESTRC = RTNREG;                            2428
         STH   RTNREG,TESTRC                                       2428
*                      RESPECIFY RTNREG UNRSTD;                    2429
*                      IF TESTRC ^= 0                              2430
*                        THEN                                      2430
         LH    @04,TESTRC                                          2430
         LTR   @04,@04                                             2430
         BZ    @RF02430                                            2430
*                          SETRC = LASTCC08;                       2431
         MVC   SETRC(2),@CH00039                                   2431
*                      END;                                        2432
*                                                                  2432
@RF02430 DS    0H                                                  2433
*                  /**************************************************/
*                  /*                                                */
*                  /*  SET DEALLOC TO INDICATE THAT AN               */
*                  /*  ATTEMPT HAS BEEN MADE TO DYNAMICALLY          */
*                  /*  ALLOCATE SOMETHING.                           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2433
*                  DEALLOC = ON;                                   2433
*                                                                  2433
@RF02423 OI    DEALLOC,B'10000000'                                 2433
*                  /**************************************************/
*                  /*                                                */
*                  /*  POINT TO THE STORAGE FOR THE ALLAGL,          */
*                  /*  AND CLEAR IT TO ZEROS.                        */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2434
*                  ALLPTR = ADDR(ALLLIST);                         2434
         LA    @04,ALLLIST                                         2434
         ST    @04,ALLPTR                                          2434
*                  ALLAGL = ''B;                                   2435
*                                                                  2435
         XC    ALLAGL(31,@04),ALLAGL(@04)                          2435
*                  /**************************************************/
*                  /*                                                */
*                  /*  IF THE VSAM CATALOG RETURN CODE IS 72 OR 76,  */
*                  /*  THEN THE THING TO BE DYNAMICALLY              */
*                  /*  ALLOCATED IS THE LAST ITEM IN THE             */
*                  /*  CMS WORK AREA.  IF IT IS 240, THEN            */
*                  /*  THE ADDRESS OF THE THING TO ALLOCATE          */
*                  /*  IS IN CTGENT.                                 */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2436
*                  IF (CATLGRC = ALLORC1) × (CATLGRC = ALLORC3)    2436
*                    THEN                                          2436
         LH    @04,CATLGRC                                         2436
         C     @04,@CF01129                                        2436
         BE    @RT02436                                            2436
         C     @04,@CF01131                                        2436
         BNE   @RF02436                                            2436
@RT02436 DS    0H                                                  2437
*                      ALLDSN = ADDR(ENTRYNM(PLIMIT + 1));         2437
         LH    @04,PLIMIT                                          2437
         MH    @04,@CH01390                                        2437
         L     @01,CTGPLPTR                                        2437
         L     @01,CTGWKA(,@01)                                    2437
         LA    @04,ENTRYNM(@04,@01)                                2437
         L     @01,ALLPTR                                          2437
         ST    @04,ALLDSN(,@01)                                    2437
*                    ELSE                                          2438
*                      ALLDSN = CTGENT;                            2438
*                                                                  2438
         B     @RC02436                                            2438
@RF02436 L     @04,CTGPLPTR                                        2438
         L     @04,CTGENT(,@04)                                    2438
         L     @01,ALLPTR                                          2438
         ST    @04,ALLDSN(,@01)                                    2438
*                  /**************************************************/
*                  /*                                                */
*                  /*  SELECT DYNAMIC ALLOCATION OPTIONS             */
*                  /*  (1) DYNAMIC ALLOCATION BY DATA SET            */
*                  /*      NAME                                      */
*                  /*  (2) STATUS = OLD                              */
*                  /*  (3) DISP = KEEP                               */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2439
*                  ALLOPTVL = OFF;                                 2439
@RC02436 DS    0H                                                  2440
*                  ALLOPTDS = ON;                                  2440
         L     @04,ALLPTR                                          2440
         OI    ALLOPTDS(@04),B'01000000'                           2440
         NI    ALLOPTVL(@04),B'01111111'                           2440
*                  ALLSTSOD = ON;                                  2441
         OI    ALLSTSOD(@04),B'00000001'                           2441
*                  ALLDSPKP = ON;                                  2442
*                                                                  2442
         OI    ALLDSPKP(@04),B'00001000'                           2442
*                  /**************************************************/
*                  /*                                                */
*                  /*  ISSUE THE UALLOC MACRO OF THE SYSTEM          */
*                  /*  ADAPTER, AND TEST THE RETURN CODE.            */
*                  /*                                                */
*                  /**************************************************/
*                                                                  2443
*                  CALL IDCSAAL0(GDTTBL,ALLAGL);                   2443
         L     @15,@PC00001                                        2443
         ST    @15,@AL00001                                        2443
         ST    @04,@AL00001+4                                      2443
         MVI   @AL00001+4,X'80'                                    2443
         L     @15,GDTALC(,@15)                                    2443
         LA    @01,@AL00001                                        2443
         BALR  @14,@15                                             2443
*                  RESPECIFY RTNREG RSTD;                          2444
*                  TESTRC = RTNREG;                                2445
         STH   RTNREG,TESTRC                                       2445
*                  RESPECIFY RTNREG UNRSTD;                        2446
*                                                                  2446
*                  IF TESTRC = 0                                   2447
*                    THEN                                          2447
*                                                                  2447
         LH    @04,TESTRC                                          2447
         LTR   @04,@04                                             2447
         BNZ   @RF02447                                            2447
*                      /**********************************************/
*                      /*                                            */
*                      /*  THE OBJECT HAS BEEN ALLOCATED             */
*                      /*  SUCCESSFULLY.  RESTORE THE CPL,           */
*                      /*  AND PLACE A POINTER TO THE                */
*                      /*  DDNAME RETURNED BY ALLOCATION IN          */
*                      /*  THE CPL.                                  */
*                      /*                                            */
*                      /**********************************************/
*                                                                  2448
*                      DO;                                         2448
*                      CTGPL = DSAVCPL;                            2449
         L     @04,CTGPLPTR                                        2449
         MVC   CTGPL(28,@04),DSAVCPL                               2449
*                      CTGDDNM = ADDR(ALLDDN);                     2450
*                                                                  2450
         L     @01,ALLPTR                                          2450
         LA    @15,ALLDDN(,@01)                                    2450
         ST    @15,CTGDDNM(,@04)                                   2450
*                      /**********************************************/
*                      /*                                            */
*                      /*  CLEAR THE CMS WORKAREA.                   */
*                      /*                                            */
*                      /**********************************************/
*                                                                  2451
*                      DO J = 1 TO LIMIT;                          2451
         LA    @04,1                                               2451
         B     @DE02451                                            2451
@DL02451 DS    0H                                                  2452
*                        ENTITEM(J) = ''B;                         2452
         LR    @15,@04                                             2452
         MH    @15,@CH01390                                        2452
         L     @01,CTGPLPTR                                        2452
         L     @01,CTGWKA(,@01)                                    2452
         ALR   @01,@15                                             2452
         AL    @01,@CF01798                                        2452
         XC    ENTITEM-4(45,@01),ENTITEM-4(@01)                    2452
*                      END;                                        2453
         AL    @04,@CF00221                                        2453
@DE02451 ST    @04,J                                               2453
         CH    @04,LIMIT                                           2453
         BNH   @DL02451                                            2453
*                      RETURNLN = 0;                               2454
         L     @04,CTGPLPTR                                        2454
         L     @04,CTGWKA(,@04)                                    2454
         SLR   @15,@15                                             2454
         STH   @15,RETURNLN(,@04)                                  2454
*                      END;                                        2455
*                                                                  2455
*                    ELSE                                          2456
*                                                                  2456
*                      /**********************************************/
*                      /*                                            */
*                      /*  DYNAMIC ALLOCATION HAS FAILED.            */
*                      /*  PRINT AN ERROR MESSAGE, AND               */
*                      /*  RETURN TO THE CALLING PROCESSOR.          */
*                      /*                                            */
*                      /**********************************************/
*                                                                  2456
*                      DO;                                         2456
         B     @RC02447                                            2456
@RF02447 DS    0H                                                  2457
*                      DEFSTID = 0;                                2457
         MVI   DEFSTID,X'00'                                       2457
*                      DARGSMOD = DELMSG;                          2458
         L     @04,DDSTRU                                          2458
         MVC   DARGSMOD(3,@04),@CC00989                            2458
*                      DARGILP = LENGTH(FENTNAME);                 2459
         MVC   DARGILP(2,@04),@CH00605                             2459
*                      DARGSENT = NODELMSG;                        2460
         MVI   DARGSENT(@04),X'08'                                 2460
*                      DARGDBP = CTGENT;                           2461
*                                                                  2461
         L     @01,CTGPLPTR                                        2461
         L     @15,CTGENT(,@01)                                    2461
         ST    @15,DARGDBP(,@04)                                   2461
*                      CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);       2462
*                                                                  2462
         L     @04,@PC00001                                        2462
         ST    @04,@AL00001                                        2462
         LA    @15,@CF00119                                        2462
         ST    @15,@AL00001+4                                      2462
         LA    @15,DDSTRU                                          2462
         ST    @15,@AL00001+8                                      2462
         MVI   @AL00001+8,X'80'                                    2462
         L     @15,GDTPRT(,@04)                                    2462
         LA    @01,@AL00001                                        2462
         BALR  @14,@15                                             2462
*                      DARGSMOD = UNIVMSG;                         2463
         L     @04,DDSTRU                                          2463
         MVC   DARGSMOD(3,@04),@CC00981                            2463
*                      RETURN CODE(LASTCC12);                      2464
         LA    @15,12                                              2464
         L     @14,@SA00014                                        2464
         LM    @00,@12,@SA00014+8                                  2464
         BR    @14                                                 2464
*                      END;                                        2465
*                                                                  2465
*                  END ALLOCRC;                                    2466
*                                                                  2466
@RC02447 DS    0H                                                  2467
*            /********************************************************/
*            /*                                                      */
*            /*  CALL CATALOG AND SAVE THE RETURN CODE.              */
*            /*                                                      */
*            /********************************************************/
*                                                                  2467
*            CALL IDCSACA0(GDTTBL,DLCPLPTR);                       2467
*                                                                  2467
@RF02421 DS    0H                                                  2467
@RC02391 L     @04,@PC00001                                        2467
         ST    @04,@AL00001                                        2467
         L     @15,@PC00014                                        2467
         ST    @15,@AL00001+4                                      2467
         L     @15,GDTCAT(,@04)                                    2467
         LA    @01,@AL00001                                        2467
         BALR  @14,@15                                             2467
*            RESPECIFY REG15 RSTD;                                 2468
*            CATLGRC = REG15;                                      2469
         STH   REG15,CATLGRC                                       2469
*            RESPECIFY REG15 UNRSTD;                               2470
*                                                                  2470
*            IF GDTDBG = NULLPTR                                   2471
*              THEN;                                               2471
         L     @04,@PC00001                                        2471
         L     @04,GDTDBG(,@04)                                    2471
         LTR   @04,@04                                             2471
         BZ    @RT02471                                            2471
*              ELSE                                                2473
*                CALL IDCDB010(GDTTBL,'RMDD');                     2473
*                                                                  2473
         L     @04,@PC00001                                        2473
         ST    @04,@AL00001                                        2473
         LA    @15,@CC01586                                        2473
         ST    @15,@AL00001+4                                      2473
         MVI   @AL00001+4,X'80'                                    2473
         L     @15,GDTDBG(,@04)                                    2473
         LA    @01,@AL00001                                        2473
         BALR  @14,@15                                             2473
*        END DELLP;                                                2474
*                                                                  2474
@RT02471 DS    0H                                                  2474
@DE02379 LH    @04,CATLGRC                                         2474
         C     @04,@CF01127                                        2474
         BE    @DL02379                                            2474
         C     @04,@CF01129                                        2474
         BE    @DL02379                                            2474
         C     @04,@CF01137                                        2474
         BE    @DL02379                                            2474
         C     @04,@CF01131                                        2474
         BE    @DL02379                                            2474
*        /************************************************************/
*        /*                                                          */
*        /*  IF VSAM CATALOG MANAGEMENT HAS PLACED ANYTHING          */
*        /*  IN THE WORKAREA PASSED TO IT FOR THE CATALOG            */
*        /*  DELETE, PRINT IT OUT.                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  2475
*        IF RETURNLN > 4                                           2475
*          THEN                                                    2475
         LA    @04,4                                               2475
         L     @01,CTGPLPTR                                        2475
         L     @01,CTGWKA(,@01)                                    2475
         LH    @15,RETURNLN(,@01)                                  2475
         CR    @15,@04                                             2475
         BNH   @RF02475                                            2475
*            DO;                                                   2476
*            ENTRYNO = (RETURNLN - 4) / LENGTH(ENTITEM);           2477
         LR    @00,@15                                             2477
         SLR   @00,@04                                             2477
         SRDA  @00,32                                              2477
         D     @00,@CF01390                                        2477
         ST    @01,ENTRYNO                                         2477
*            DO K = 1 TO ENTRYNO;                                  2478
         LA    @04,1                                               2478
         B     @DE02478                                            2478
@DL02478 DS    0H                                                  2479
*              DARGDBP = ADDR(ENTLIST(K));                         2479
         L     @15,DDSTRU                                          2479
         LA    @14,45                                              2479
         LR    @01,@04                                             2479
         MR    @00,@14                                             2479
         L     @04,CTGPLPTR                                        2479
         L     @04,CTGWKA(,@04)                                    2479
         AL    @04,@CF01798                                        2479
         LA    @04,ENTLIST-4(@01,@04)                              2479
         ST    @04,DARGDBP(,@15)                                   2479
*              DARGILP = LENGTH(ENTLIST(1));                       2480
*                                                                  2480
         STH   @14,DARGILP(,@15)                                   2480
*              CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);               2481
         L     @04,@PC00001                                        2481
         ST    @04,@AL00001                                        2481
         LA    @15,@CF00119                                        2481
         ST    @15,@AL00001+4                                      2481
         LA    @15,DDSTRU                                          2481
         ST    @15,@AL00001+8                                      2481
         MVI   @AL00001+8,X'80'                                    2481
         L     @15,GDTPRT(,@04)                                    2481
         LA    @01,@AL00001                                        2481
         BALR  @14,@15                                             2481
*            END;                                                  2482
*                                                                  2482
         LA    @04,1                                               2482
         AL    @04,K                                               2482
@DE02478 ST    @04,K                                               2482
         C     @04,ENTRYNO                                         2482
         BNH   @DL02478                                            2482
*            END;                                                  2483
*          ELSE ;                                                  2484
*                                                                  2484
@RF02475 DS    0H                                                  2485
*        /************************************************************/
*        /*                                                  @Z40RSSA*/
*        /*  IF THE VSAM CATALOG RETURN CODE IS 110          @Z40RSSA*/
*        /*  PRINT THE REASON THE PROFILE COULD NOT BE       @Z40RSSA*/
*        /*  DELETED.                                        @Z40RSSA*/
*        /*         REASON CODE 4 - NO PROFILE               @Z40RSSA*/
*        /*         REASON CODE 8 - NOT ELIGIBLE             @Z40RSSA*/
*        /*                                                  @Z40RSSA*/
*        /*  IF NOT 110, SIMPLY PRINT THE VSAM RETURN CODE   @Z40RSSA*/
*        /*                                                  @Z40RSSA*/
*        /************************************************************/
*               IF CATLGRC = PRNTDEL & (CTGFBFLG = NFRET ×         2485
*                CTGFBFLG = NDRET) THEN                            2485
         CLC   CATLGRC(2),@CH01133                                 2485
         BNE   @RF02485                                            2485
         L     @04,CTGPLPTR                                        2485
         CLC   CTGFBFLG(2,@04),@CH00046                            2485
         BE    @RT02485                                            2485
         CLC   CTGFBFLG(2,@04),@CH00039                            2485
         BNE   @RF02485                                            2485
@RT02485 DS    0H                                                  2486
*                 DO;                                      /*@Z40RSSA*/
*                   DARGLIST = ''B;                        /*@Z40RSSA*/
         L     @04,DDSTRU                                          2487
         XC    DARGLIST(20,@04),DARGLIST(@04)                      2487
*                   DARGSMOD = DELMSG;                     /*@Z40RSSA*/
         MVC   DARGSMOD(3,@04),@CC00989                            2488
*                   IF CTGFBFLG = 4 THEN                   /*@Z40RSSA*/
         L     @01,CTGPLPTR                                        2489
         CLC   CTGFBFLG(2,@01),@CH00046                            2489
         BNE   @RF02489                                            2489
*                     DARGSENT = PFNTFND;                  /*@Z40RSSA*/
         MVI   DARGSENT(@04),X'0D'                                 2490
*                   ELSE                                   /*@Z40RSSA*/
*                     DARGSENT = PFINUSE;                  /*@Z40RSSA*/
         B     @RC02489                                            2491
@RF02489 L     @04,DDSTRU                                          2491
         MVI   DARGSENT(@04),X'0C'                                 2491
*                   CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);  /*@Z40RSSA*/
@RC02489 L     @04,@PC00001                                        2492
         ST    @04,@AL00001                                        2492
         LA    @15,@CF00119                                        2492
         ST    @15,@AL00001+4                                      2492
         LA    @15,DDSTRU                                          2492
         ST    @15,@AL00001+8                                      2492
         MVI   @AL00001+8,X'80'                                    2492
         L     @15,GDTPRT(,@04)                                    2492
         LA    @01,@AL00001                                        2492
         BALR  @14,@15                                             2492
*                   SETRC = LASTCC04;                      /*@Z40RSSA*/
         MVC   SETRC(2),@CH00046                                   2493
*                 END;                                     /*@Z40RSSA*/
*               ELSE                                       /*@Z40RSSA*/
*        /************************************************************/
*        /*                                                  @Z40RSSA*/
*        /*  TEST FOR A VSAM CATALOG RETURN CODE OTHER THAN          */
*        /*  ZERO.  IF CATALOG MANAGEMENT HAS SET A NON-ZERO         */
*        /*  RETURN CODE, PRINT AN APPROPRIATE MESSAGE.              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2495
*        IF CATLGRC ^= 0                                           2495
*          THEN                                                    2495
         B     @RC02485                                            2495
@RF02485 LH    @04,CATLGRC                                         2495
         LTR   @04,@04                                             2495
         BZ    @RF02495                                            2495
*ERCALL2:    DO;                                                   2496
*                                                                  2496
ERCALL2  DS    0H                                                  2497
*            /********************************************************/
*            /*                                                      */
*            /*  CLEAR THE STORAGE TO BE OCCUPIED BY THE ERROR       */
*            /*  CONVERSION TABLE.                                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2497
*            ERRORTAB = ''B;                                       2497
*                                                                  2497
         XC    ERRORTAB(32),ERRORTAB                               2497
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCNVADR TO POINT TO THE STORAGE FOR THE ERROR  */
*            /*  CONVERSION TABLE.                                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2498
*            ERCNVADR = ADDR(ERRORTAB);                            2498
*                                                                  2498
         LA    @04,ERRORTAB                                        2498
         ST    @04,ERCNVADR                                        2498
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCATLG TO BE ON TO INDICATE THAT THIS IS A     */
*            /*  CATALOG ERROR.  THE CMS FUNCTION BEING PERFORMED    */
*            /*  IS A DELETE.  SET THE ERCATDL BIT TO ON.            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2499
*            ERCATLG = ON;                                         2499
         OI    ERCATLG(@04),B'10000000'                            2499
*            ERCATDL = ON;                                         2500
*                                                                  2500
         OI    ERCATDL(@04),B'00100000'                            2500
*            /********************************************************/
*            /*                                                      */
*            /*  SET ERCATRC TO CATLGRC, AND SET ERPLPT TO POINT TO  */
*            /*  THE CPL FOR THE CATALOG OPERATION.                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  2501
*            ERCATRC = CATLGRC;                                    2501
         LH    @15,CATLGRC                                         2501
         ST    @15,ERCATRC(,@04)                                   2501
*            ERCPLPT = CTGPLPTR;                                   2502
*                                                                  2502
         L     @15,CTGPLPTR                                        2502
         ST    @15,ERCPLPT(,@04)                                   2502
*            /********************************************************/
*            /*                                                      */
*            /*  SET A POINTER IN THE ERROR CONVERSION TABLE         */
*            /*  TO THE ENTRY NAME.                                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  2503
*            ERDSNM = CTGENT;                                      2503
*                                                                  2503
         L     @15,CTGENT(,@15)                                    2503
         ST    @15,ERDSNM(,@04)                                    2503
*            /********************************************************/
*            /*                                                      */
*            /*  INVOKE THE UERROR ROUTINE BY ISSUING THE UERROR     */
*            /*  MACRO OF THE TEXT PROCESSOR.                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  2504
*            CALL IDCTPER0(GDTTBL,ERCNVADR);                       2504
         L     @04,@PC00001                                        2504
         ST    @04,@AL00001                                        2504
         LA    @15,ERCNVADR                                        2504
         ST    @15,@AL00001+4                                      2504
         MVI   @AL00001+4,X'80'                                    2504
         L     @15,GDTERR(,@04)                                    2504
         LA    @01,@AL00001                                        2504
         BALR  @14,@15                                             2504
*            RETURN CODE(LASTCC12);                                2505
         LA    @15,12                                              2505
         L     @14,@SA00014                                        2505
         LM    @00,@12,@SA00014+8                                  2505
         BR    @14                                                 2505
*            END ERCALL2;                                          2506
*                                                                  2506
*        /************************************************************/
*        /*                                                          */
*        /*  IF CORE WAS OBTAINED BY THIS PROCEDURE, FREE            */
*        /*  IT.                                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2507
*        IF COREFLAG = ON                                          2507
*          THEN                                                    2507
*                                                                  2507
@RF02495 DS    0H                                                  2507
@RC02485 TM    COREFLAG,B'10000000'                                2507
         BNO   @RF02507                                            2507
*            DO;                                                   2508
*            COREFLAG = OFF;                                       2509
         NI    COREFLAG,B'01111111'                                2509
*            CALL IDCSAFS0(GDTTBL,CTGWKA);                         2510
         L     @04,@PC00001                                        2510
         ST    @04,@AL00001                                        2510
         L     @01,CTGPLPTR                                        2510
         LA    @15,CTGWKA(,@01)                                    2510
         ST    @15,@AL00001+4                                      2510
         L     @15,GDTFSP(,@04)                                    2510
         LA    @01,@AL00001                                        2510
         BALR  @14,@15                                             2510
*            END;                                                  2511
*                                                                  2511
*        /************************************************************/
*        /*                                                          */
*        /*  IF DYNAMIC ALLOCATION HAS BEEN PERFORMED BY             */
*        /*  THIS PROCEDURE, DYNAMICALLY UNALLOCATE.                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2512
*        IF DEALLOC = ON                                           2512
*          THEN                                                    2512
@RF02507 TM    DEALLOC,B'10000000'                                 2512
         BNO   @RF02512                                            2512
*            DO;                                                   2513
*            DEALLOC = OFF;                                        2514
         NI    DEALLOC,B'01111111'                                 2514
*            CALL IDCSADL0(GDTTBL,ALLAGL);                         2515
         L     @04,@PC00001                                        2515
         ST    @04,@AL00001                                        2515
         L     @01,ALLPTR                                          2515
         ST    @01,@AL00001+4                                      2515
         MVI   @AL00001+4,X'80'                                    2515
         L     @15,GDTDLC(,@04)                                    2515
         LA    @01,@AL00001                                        2515
         BALR  @14,@15                                             2515
*            RESPECIFY RTNREG RSTD;                                2516
*            TESTRC = RTNREG;                                      2517
         STH   RTNREG,TESTRC                                       2517
*            RESPECIFY RTNREG UNRSTD;                              2518
*            IF TESTRC ^= 0                                        2519
*              THEN                                                2519
         LH    @04,TESTRC                                          2519
         LTR   @04,@04                                             2519
         BZ    @RF02519                                            2519
*                SETRC = LASTCC08;                                 2520
         MVC   SETRC(2),@CH00039                                   2520
*            END;                                                  2521
*                                                                  2521
@RF02519 DS    0H                                                  2522
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLER WITH SUCCESS INDICATED.            */
*        /*                                                          */
*        /************************************************************/
*                                                                  2522
*        RETURN CODE(0);                                           2522
*                                                                  2522
@RF02512 SLR   @15,@15                                             2522
         L     @14,@SA00014                                        2522
         LM    @00,@12,@SA00014+8                                  2522
         BR    @14                                                 2522
*END DELTPROC;                                                     2523
*/********************************************************************/
*/*                                                                  */
*/* PROCEDURE NAME - DALCPROC (SERVICE ROUTINE)                      */
*/*                                                                  */
*/* FUNCTION - DALCPROC PERFORMS THE NECESSARY PROCESSING TO         */
*/*            INVOKE THE AMS UALLOC ROUTINE WHICH PERFORMS          */
*/*            DYNAMIC ALLOCATION.                                   */
*/********************************************************************/
*                                                                  2524
*DALCPROC:                                                         2524
*        PROCEDURE (REQTYPE,DALVLPTR,DALDNMPT,DALINDEX);           2524
*                                                                  2524
DALCPROC STM   @14,@12,@SA00015                                    2524
         MVC   @PC00015(16),0(@01)                                 2524
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*        DCL                                                       2525
*          REQTYPE CHAR(1),            /* TYPE OF REQUEST            */
*          DALVLPTR,                   /* ADDR OF VOLUMES LIST       */
*          DALDNMPT,                   /* ADDR OF DNAME              */
*          DALINDEX;                   /* INDEX OF ALLAGLS           */
*                                                                  2525
*        /************************************************************/
*        /*                                                          */
*        /* UNIT DESCRIPTOR LIST REFERENCED BY ALLAGL                */
*        /*                                                          */
*        /************************************************************/
*        DCL                                                       2526
*          1 DALCUNIT STATIC LOCAL,                                2526
*            2 DL#UNIT   FIXED(15) INIT(1),                        2526
*            2 DLUNITLN  FIXED(15) INIT(8),                        2526
*            2 DLUNIT    CHAR(8)   INIT('SYSALLDA');               2526
*                                                                  2526
*        /************************************************************/
*        /*                                                          */
*        /* SAVE AREAS FOR POINTERS TO ALLAGLS                       */
*        /*                                                          */
*        /************************************************************/
*        DCL                                                       2527
*          1 ALGLSAVE  CHAR(20) BDY(WORD),                         2527
*            2 ALSAVPTR(*) PTR(31);                                2527
*                                                                  2527
*        /************************************************************/
*        /*                                                          */
*        /* MAPPING STRUCTURE FOR VOLUME LIST TO BE DYNAMICALLY      */
*        /* ALLOCATED, THIS LIST IS RECONSTRUCTED IN A FORM          */
*        /* COMPATIBLE TO DYNAMIC ALLOCATION IN A NEW AREA           */
*        /*                                                          */
*        /************************************************************/
*                                                                  2528
*        DCL                                                       2528
*          1 FVTVLIST BASED(DALVLPTR),                             2528
*            2 FVTVLEN FIXED(15),                                  2528
*            2 * (*),                                              2528
*              3 *       FIXED(15),                                2528
*              3 FVTVSER CHAR(6);                                  2528
*                                                                  2528
*        /************************************************************/
*        /*                                                          */
*        /* MAPPING STRUCTURE FOR VOLUME LIST CONSTRUCTED IN DALCPROC*/
*        /* AND PASSED TO DYNAMIC ALLOCATION VIA THE ALLAGL PARAMETER*/
*        /* LIST                                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2529
*        DCL                                                       2529
*          1 ALCVLIST BASED(ALLVLP),                               2529
*            2 ALC#ENT FIXED(15),                                  2529
*            2 * (*),                                              2529
*              3 ALCVLEN FIXED(15),                                2529
*              3 ALCVSER CHAR(6);                                  2529
*                                                                  2529
*        /************************************************************/
*        /*                                                          */
*        /* POINTER TO ALLAGL PARAMETERLIST                          */
*        /*                                                          */
*        /************************************************************/
*        DCL                                                       2530
*          DALGLPTR  PTR(31);                                      2530
*                                                                  2530
*        /************************************************************/
*        /*                                                          */
*        /* ENTRY POINT TO DALCPROC                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  2531
*        OLDERID2 = NEWERID2;                                      2531
         L     @04,@PC00001                                        2531
         L     @04,GDTTR2(,@04)                                    2531
         MVC   @TS00001(95),NEWERID2(@04)                          2531
         MVC   OLDERID2(95,@04),@TS00001                           2531
*        NEWID2 = 'RMDA';                                          2532
*                                                                  2532
         MVC   NEWID2(4,@04),@CC01618                              2532
*        /************************************************************/
*        /*                                                          */
*        /* CHECK REQUEST TYPE FOR ALLOCATION OR DEALLOCATION        */
*        /*                                                          */
*        /************************************************************/
*                                                                  2533
*        IF REQTYPE = 'A'                                          2533
*          THEN                                                    2533
         L     @04,@PC00015                                        2533
         CLI   REQTYPE(@04),C'A'                                   2533
         BNE   @RF02533                                            2533
*DALOOP0:    DO;                                                   2534
*                                                                  2534
DALOOP0  DS    0H                                                  2535
*            /********************************************************/
*            /*                                                      */
*            /* THIS IS AN ALLOCATION REQUEST - GET SPACE FOR THE    */
*            /* VOLUME LIST TO BE BUILT AND PASSED TO THE AMS        */
*            /* SYSTEM ADAPTER VIA THE ALLAGL PARAMETERLIST          */
*            /*                                                      */
*            /********************************************************/
*                                                                  2535
*            CALL IDCSAGP0 (GDTTBL,                                2535
*              ((FVTVLEN + 8) + (LENGTH(ALLAGL) +4 )),             2535
*              DALGLPTR,                                           2535
*              GPID,                                               2535
*              SETZERO);                                           2535
*                                                                  2535
         L     @04,@PC00001                                        2535
         ST    @04,@AL00001                                        2535
         L     @15,@PC00015+4                                      2535
         L     @01,DALVLPTR(,@15)                                  2535
         LA    @00,43                                              2535
         AH    @00,FVTVLEN(,@01)                                   2535
         ST    @00,@AFTEMPS+16                                     2535
         LA    @15,@AFTEMPS+16                                     2535
         ST    @15,@AL00001+4                                      2535
         LA    @15,DALGLPTR                                        2535
         ST    @15,@AL00001+8                                      2535
         LA    @15,GPID                                            2535
         ST    @15,@AL00001+12                                     2535
         LA    @15,SETZERO                                         2535
         ST    @15,@AL00001+16                                     2535
         MVI   @AL00001+16,X'80'                                   2535
         L     @15,GDTGPL(,@04)                                    2535
         LA    @01,@AL00001                                        2535
         BALR  @14,@15                                             2535
*            RESPECIFY RTNREG RSTD;                                2536
*            TESTRC = RTNREG;                                      2537
         STH   RTNREG,TESTRC                                       2537
*            RESPECIFY RTNREG UNRSTD;                              2538
*            IF TESTRC ^= 0                                        2539
*              THEN                                                2539
         LH    @04,TESTRC                                          2539
         LTR   @04,@04                                             2539
         BZ    @RF02539                                            2539
*                DO;                                               2540
*                                                                  2540
*                DEFSTID = NOSTORAG;                               2541
         MVI   DEFSTID,X'04'                                       2541
*                RETURN;                                           2542
*                                                                  2542
@EL00015 DS    0H                                                  2542
@EF00015 DS    0H                                                  2542
@ER00015 LM    @14,@12,@SA00015                                    2542
         BR    @14                                                 2542
*                END;                                              2543
*                                                                  2543
*            /********************************************************/
*            /*                                                      */
*            /* SET ADDRESSABILITY TO ALLAGL AND INITIALIZE ALLVLP   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2544
*            RFY ALLAGL BASED(DALGLPTR);                           2544
@RF02539 DS    0H                                                  2545
*            ALLVLP = DALGLPTR + (LENGTH(ALLAGL) +4);              2545
*                                                                  2545
         L     @04,DALGLPTR                                        2545
         LA    @15,35                                              2545
         ALR   @15,@04                                             2545
         ST    @15,ALLVLP(,@04)                                    2545
*            /********************************************************/
*            /*                                                      */
*            /* COMPUTE THE NUMBER OF ENTRIES IN THE UALLOC VOLUME   */
*            /* LIST                                                 */
*            /********************************************************/
*                                                                  2546
*            ALC#ENT = FVTVLEN / 8;                                2546
*                                                                  2546
         L     @04,@PC00015+4                                      2546
         L     @04,DALVLPTR(,@04)                                  2546
         LH    @00,FVTVLEN(,@04)                                   2546
         SRDA  @00,32                                              2546
         D     @00,@CF00039                                        2546
         STH   @01,ALC#ENT(,@15)                                   2546
*            /********************************************************/
*            /*                                                      */
*            /* CHECK FOR UNREASONABLE VALUE IN ALC#ENT TO PREVENT   */
*            /* ALLOPING PROBLEM IN DALOOP1                          */
*            /*                                                      */
*            /********************************************************/
*            IF ALC#ENT  < 1  ×                                    2547
*               ALC#ENT  > 255                                     2547
*              THEN                                                2547
         LTR   @01,@01                                             2547
         BNP   @RT02547                                            2547
         C     @01,@CF00615                                        2547
         BNH   @RF02547                                            2547
@RT02547 DS    0H                                                  2548
*                DO;                                               2548
*                                                                  2548
*                DEFSTID = UALLCERR;                               2549
         MVI   DEFSTID,X'10'                                       2549
*                RETURN;                                           2550
*                                                                  2550
         B     @EL00015                                            2550
*                END;                                              2551
*                                                                  2551
*            /********************************************************/
*            /*                                                      */
*            /* LOOP THRU THE LIST OF VOLUMES REFERENCED BY DALVLPTR */
*            /* MOVING EACH VOLSER INTO THE LIST PASSED VIA THE      */
*            /* ALLAGL AND COMPUTE THE LENGTH OF THE NON-BLANK       */
*            /* PORTION OF THE VOLSER, THIS LENGTH PRECEEDES EACH    */
*            /* VOLSER IN THE ALLAGL VOLUME LIST                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  2552
*DALOOP1:    DO N = 1 TO ALC#ENT;                                  2552
*                                                                  2552
@RF02547 DS    0H                                                  2552
DALOOP1  LA    @04,1                                               2552
         B     @DE02552                                            2552
@DL02552 DS    0H                                                  2553
*              DO J = 1 TO 6                                       2553
*                WHILE FVTVSER (N,J) ^= ' ';                       2553
         LA    @04,1                                               2553
         ST    @04,J                                               2553
@DL02553 L     @15,N                                               2553
         SLA   @15,3                                               2553
         ALR   @15,@04                                             2553
         L     @14,@PC00015+4                                      2553
         L     @01,DALVLPTR(,@14)                                  2553
         ALR   @01,@15                                             2553
         AL    @01,@CF01803                                        2553
         CLI   FVTVSER-4(@01),C' '                                 2553
         BE    @DC02553                                            2553
*              END;                                                2554
*                                                                  2554
         AL    @04,@CF00221                                        2554
         ST    @04,J                                               2554
         C     @04,@CF00041                                        2554
         BNH   @DL02553                                            2554
@DC02553 DS    0H                                                  2555
*              /******************************************************/
*              /*                                                    */
*              /* ON EXIT FROM ABOVE LOOP J HAS THE LENGTH OF THE    */
*              /* NONBLANK PORTION OF THE VOLSER + 1                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  2555
*              ALCVLEN(N) = (J - 1);                               2555
         L     @04,N                                               2555
         LR    @15,@04                                             2555
         SLA   @15,3                                               2555
         L     @01,DALGLPTR                                        2555
         L     @14,ALLVLP(,@01)                                    2555
         L     @03,J                                               2555
         BCTR  @03,0                                               2555
         LA    @02,0(@15,@14)                                      2555
         AL    @02,@CF01786                                        2555
         STH   @03,ALCVLEN-2(,@02)                                 2555
*              ALCVSER(N) = FVTVSER(N);                            2556
*                                                                  2556
         ALR   @14,@15                                             2556
         AL    @14,@CF01779                                        2556
         L     @03,@PC00015+4                                      2556
         L     @01,DALVLPTR(,@03)                                  2556
         ALR   @01,@15                                             2556
         AL    @01,@CF01779                                        2556
         MVC   ALCVSER-4(6,@14),FVTVSER-4(@01)                     2556
*            END DALOOP1;                                          2557
*                                                                  2557
         AL    @04,@CF00221                                        2557
@DE02552 ST    @04,N                                               2557
         L     @01,DALGLPTR                                        2557
         L     @01,ALLVLP(,@01)                                    2557
         CH    @04,ALC#ENT(,@01)                                   2557
         BNH   @DL02552                                            2557
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE REMAINING ALLAGL FIELDS                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2558
*            ALLULP = ADDR(DALCUNIT);                              2558
         L     @04,DALGLPTR                                        2558
         LA    @15,DALCUNIT                                        2558
         ST    @15,ALLULP(,@04)                                    2558
*            ALLOPTVL = ON;                                        2559
*                                                                  2559
         OI    ALLOPTVL(@04),B'10000000'                           2559
*            /********************************************************/
*            /*                                                      */
*            /*  INVOKE DYNAMIC ALLOCATION VIA AMS UALLOC MACRO      */
*            /*                                                      */
*            /********************************************************/
*                                                                  2560
*            CALL IDCSAAL0 (GDTTBL,ALLAGL);                        2560
*                                                                  2560
         L     @15,@PC00001                                        2560
         ST    @15,@AL00001                                        2560
         ST    @04,@AL00001+4                                      2560
         MVI   @AL00001+4,X'80'                                    2560
         L     @15,GDTALC(,@15)                                    2560
         LA    @01,@AL00001                                        2560
         BALR  @14,@15                                             2560
*            RESPECIFY RTNREG RSTD;                                2561
*            TESTRC = RTNREG;                                      2562
         STH   RTNREG,TESTRC                                       2562
*            RESPECIFY RTNREG UNRSTD;                              2563
*            IF TESTRC = 4                                         2564
*              THEN                                                2564
         LH    @04,TESTRC                                          2564
         C     @04,@CF00046                                        2564
         BNE   @RF02564                                            2564
*                DO;                                               2565
*                                                                  2565
*                DEFSTID = UALLCERR;                               2566
         MVI   DEFSTID,X'10'                                       2566
*                RETURN CODE(LASTCC12);                            2567
*                                                                  2567
         LA    @15,12                                              2567
         L     @14,@SA00015                                        2567
         LM    @00,@12,@SA00015+8                                  2567
         BR    @14                                                 2567
*                END;                                              2568
*            /********************************************************/
*            /*                                                      */
*            /* MAINTAIN A LIST OF POINTERS TO ALLAGLS - THERE IS A  */
*            /* POSSIBILITY OF TWO ALLAGLS                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  2569
*            DALINDEX = DALINDEX + 1;                              2569
@RF02564 L     @04,@PC00015+12                                     2569
         LA    @15,1                                               2569
         AL    @15,DALINDEX(,@04)                                  2569
         ST    @15,DALINDEX(,@04)                                  2569
*            ALSAVPTR(DALINDEX) = DALGLPTR;                        2570
*                                                                  2570
         L     @04,DALGLPTR                                        2570
         SLA   @15,2                                               2570
         ST    @04,ALSAVPTR-4(@15)                                 2570
*            /********************************************************/
*            /*                                                      */
*            /* SET POINTER TO DDNAME BUILT BY UALLOC                */
*            /*                                                      */
*            /********************************************************/
*                                                                  2571
*            DALDNMPT = ADDR(ALLDDN);                              2571
*                                                                  2571
         L     @15,@PC00015+8                                      2571
         LA    @04,ALLDDN(,@04)                                    2571
         ST    @04,DALDNMPT(,@15)                                  2571
*            END DALOOP0;                                          2572
*                                                                  2572
*          /**********************************************************/
*          /* THIS IS A DEALLOCATE REQUEST                           */
*          /**********************************************************/
*          ELSE                                                    2573
*            DO;                                                   2573
         B     @RC02533                                            2573
@RF02533 DS    0H                                                  2574
*            DO N = 1 TO DALINDEX;                                 2574
*                                                                  2574
         LA    @04,1                                               2574
         B     @DE02574                                            2574
@DL02574 DS    0H                                                  2575
*              RFY ALLAGL BASED(ALSAVPTR(N));                      2575
*                                                                  2575
*              CALL IDCSADL0 (GDTTBL,ALLAGL);                      2576
*                                                                  2576
         L     @15,@PC00001                                        2576
         ST    @15,@AL00001                                        2576
         SLA   @04,2                                               2576
         L     @04,ALSAVPTR-4(@04)                                 2576
         ST    @04,@AL00001+4                                      2576
         MVI   @AL00001+4,X'80'                                    2576
         L     @15,GDTDLC(,@15)                                    2576
         LA    @01,@AL00001                                        2576
         BALR  @14,@15                                             2576
*            END;                                                  2577
*                                                                  2577
         LA    @04,1                                               2577
         AL    @04,N                                               2577
@DE02574 ST    @04,N                                               2577
         L     @15,@PC00015+12                                     2577
         C     @04,DALINDEX(,@15)                                  2577
         BNH   @DL02574                                            2577
*            /********************************************************/
*            /*                                                      */
*            /*  RESET THE VALUE OF DALINDEX TO ZERO.                */
*            /*                                                      */
*            /********************************************************/
*                                                                  2578
*            DALINDEX = 0;                                         2578
         L     @04,@PC00015+12                                     2578
         SLR   @15,@15                                             2578
         ST    @15,DALINDEX(,@04)                                  2578
*            END;                                                  2579
*                                                                  2579
*        RETURN CODE(0);                                           2580
@RC02533 SLR   @15,@15                                             2580
         L     @14,@SA00015                                        2580
         LM    @00,@12,@SA00015+8                                  2580
         BR    @14                                                 2580
*        RFY ALLAGL BASED(ALLPTR);                                 2581
*END DALCPROC;                                                     2582
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - OPENPROC                               */
*        /*                                                          */
*        /*  FUNCTION - PERFORMS ALL OPENS REQUIRED FOR OPENING A    */
*        /*  VSAM OBJECT FOR OUTPUT, OR OPENING THE PORTABILITY      */
*        /*  VOLUME FOR INPUT.                                       */
*        /*  WHEN OPENING A VSAM OBJECT FOR INPUT OPENPROC           */
*        /*  SETS THE EXPORT/IMPORT FLAG IN THE OPNAGL.              */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .OTYPE - I INDICATES INPUT, O INDICATES OUTPUT        */
*        /*    .ODD - 8-BYTE JCL STATEMENT NAME FOR DATA SET TO BE   */
*        /*           OPENED                                         */
*        /*    .ODSN - NAME OF VSAM CLUSTER COMPONENT                */
*        /*    .OREC - LRECL SIZE FOR DATA SET                       */
*        /*    .OBLK - BLKSIZE FOR DATA SET                          */
*        /*                                                          */
*        /*  OUTPUT - POINTER TO IOCS FOR OPEN DATA SET              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2583
*OPENPROC:  PROCEDURE(OTYPE,           /*OPEN FOR INPUT OR OUTPUT    */
*                     ODD,             /*8-BYTE JCL STATEMENT NAME   */
*                     ODSN,            /*ENTRYNAME OF OBJECT RELATED */
*                                      /*TO CLUSTER                  */
*                     OREC,            /*LRECL FOR OUTPUT DATA SET   */
*                     OBLK,            /*BLKSIZE FOR OUTPUT DATA SET */
*                     OIOCS);          /*RETURN CELL FOR IOCS        */
*                                                                  2583
OPENPROC STM   @14,@12,@SA00016                                    2583
         MVC   @PC00016(24),0(@01)                                 2583
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2584
*        DCL                                                       2584
*          OTYPE CHAR(1),                                          2584
*          ODD   PTR(31),                                          2584
*          ODSN  PTR(31),                                          2584
*          OREC,                                                   2584
*          OBLK,                                                   2584
*          OIOCS PTR(31);                                          2584
*                                                                  2584
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2585
*        DCL OPENLIST BIT(LENGTH(OPNAGL)) BDY(WORD);               2585
*                                      /* STORAGE FOR OPEN ARGUMENT  */
*                                      /* LIST                       */
*        DCL OPENSAVE BIT(LENGTH(OPNAGL)) BDY(WORD);               2586
*                                      /*SAVE AREA FOR THE OPNAGL    */
*        DCL RECSZ    FIXED(31);       /*RECORD SIZE OF PORTABLE DATA*/
*                                      /*SET                         */
*        DCL OIOCSPTR PTR(31) BASED(OIOCS);                        2588
*                                                                  2588
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT OPNAGL SETTING DIFFERENT OPTIONS FOR INPUT    */
*        /*  VERSUS AN OUTPUT DATA SET                               */
*        /*  BEGIN BY POINTING TO THE STORAGE FOR THE OPNAGL, AND    */
*        /*  BY CLEARING THAT STORAGE AS WELL AS THE STORAGE FOR THE */
*        /*  OPNAGL SAVE AREA.                                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  2589
*        OLDERID2 = NEWERID2;                                      2589
         L     @04,@PC00001                                        2589
         L     @04,GDTTR2(,@04)                                    2589
         MVC   @TS00001(95),NEWERID2(@04)                          2589
         MVC   OLDERID2(95,@04),@TS00001                           2589
*        NEWID2 = 'RMOP';                                          2590
         MVC   NEWID2(4,@04),@CC01647                              2590
*        OPENLIST = ''B;                                           2591
         XC    OPENLIST(48),OPENLIST                               2591
*        OPENSAVE = ''B;                                           2592
         XC    OPENSAVE(48),OPENSAVE                               2592
*        OPNPTR = ADDR(OPENLIST);                                  2593
         LA    @04,OPENLIST                                        2593
         ST    @04,OPNPTR                                          2593
*        IF OTYPE = 'I'                                            2594
*          THEN                                                    2594
*                                                                  2594
         L     @15,@PC00016                                        2594
         CLI   OTYPE(@15),C'I'                                     2594
         BNE   @RF02594                                            2594
*            /********************************************************/
*            /*                                                      */
*            /*  OPEN FOR  INPUT SPECIFIED - SET VBS FORMAT          */
*            /*                                                      */
*            /********************************************************/
*                                                                  2595
*            DO;                                                   2595
*            OPNOPTIN = ON;                                        2596
         OI    OPNOPTIN(@04),B'10000000'                           2596
*            OPNRFMSF = ON;                                        2597
*            OPNRFMBK = ON;                                        2598
         OI    OPNRFMSF(@04),B'00011000'                           2598
*            OPNBLK = OBLK;                                        2599
*                                                                  2599
         L     @15,@PC00016+16                                     2599
         L     @15,OBLK(,@15)                                      2599
         ST    @15,OPNBLK(,@04)                                    2599
*            /********************************************************/
*            /*                                                      */
*            /*  SET THE RECOVERY BIT TO ON TO INDICATE THAT THIS    */
*            /*  PORTABLE DATA SET IS SUPPOSED TO HAVE THE SPECIAL   */
*            /*  RECOVERY HEADERS PREPENDED TO ITS RECORDS.          */
*            /*                                                      */
*            /********************************************************/
*                                                                  2600
*            OPNTYPRV = ON;                                        2600
*                                                                  2600
         OI    OPNTYPRV(@04),B'00000010'                           2600
*            /********************************************************/
*            /*                                                      */
*            /*  PROCESS ENVIRONMENT PARAMETER FOR DOS               */
*            /*  SET DEVICE TYPE ADDRESS                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2601
*            IF ADDR(ENV) ^= NULLPTR                               2601
*              THEN                                                2601
         L     @04,@PC00001+4                                      2601
         L     @04,FDTPTR+60(,@04)                                 2601
         LTR   @04,@04                                             2601
         BZ    @RF02601                                            2601
*ENVPARM:        DO;                                               2602
ENVPARM  DS    0H                                                  2603
*                IF ADDR(PDEV) ^= NULLPTR                          2603
*                  THEN                                            2603
         L     @04,@PC00001+4                                      2603
         L     @04,FDTPTR+84(,@04)                                 2603
         LTR   @04,@04                                             2603
         BZ    @RF02603                                            2603
*                    OPNDEVDT = ADDR(PDEVVAL);                     2604
*                                                                  2604
         LA    @04,PDEVVAL(,@04)                                   2604
         L     @01,OPNPTR                                          2604
         ST    @04,OPNDEVDT(,@01)                                  2604
*                /****************************************************/
*                /*                                                  */
*                /*  IF THE USER SPECIFIED THE BLOCKSIZE             */
*                /*  SUBPARAMETER, OVERRIDE THE VALUE OF             */
*                /*  OPNBLK WITH THE VALUE SPECIFIED BY THE          */
*                /*  USER.                                           */
*                /*                                                  */
*                /****************************************************/
*                                                                  2605
*                IF ADDR(BLKSZ) ^= NULLPTR                         2605
*                  THEN                                            2605
@RF02603 L     @04,@PC00001+4                                      2605
         L     @04,FDTPTR+80(,@04)                                 2605
         LTR   @04,@04                                             2605
         BZ    @RF02605                                            2605
*                    OPNBLK = BLKSZVAL;                            2606
         L     @04,BLKSZVAL(,@04)                                  2606
         L     @01,OPNPTR                                          2606
         ST    @04,OPNBLK(,@01)                                    2606
*                END ENVPARM;                                      2607
*                                                                  2607
@RF02605 DS    0H                                                  2608
*            /********************************************************/
*            /*                                                      */
*            /*  SET AN INITIAL VALUE FOR THE RECORD SIZE            */
*            /*  OF THE PORTABLE DATA SET.  THE VALUE THAT IS        */
*            /*  ACTUALLY USED IS OBTAINED BY READING THE            */
*            /*  FIRST RECORD OF THE DATA SET.                       */
*            /*                                                      */
*            /********************************************************/
*                                                                  2608
*            OPNREC = RECSIZ;                                      2608
*                                                                  2608
@RF02601 L     @04,OPNPTR                                          2608
         MVC   OPNREC(4,@04),@CF00917                              2608
*            /********************************************************/
*            /*                                                      */
*            /*  IF THE THE INPUT DD VALUE WAS NOT GIVEN, SET        */
*            /*  THE DATA SET NAME IN THE OPNAGL.  THIS CAN OCCUR    */
*            /*  ONLY IN VS2.                                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  2609
*            IF ADDR(INDD) = NULLPTR                               2609
*              THEN                                                2609
         L     @15,@PC00001+4                                      2609
         L     @15,FDTPTR+56(,@15)                                 2609
         LTR   @15,@15                                             2609
         BNZ   @RF02609                                            2609
*                OPNDSN = ODSN;                                    2610
         L     @15,@PC00016+8                                      2610
         L     @15,ODSN(,@15)                                      2610
         ST    @15,OPNDSN(,@04)                                    2610
*              ELSE                                                2611
*                OPNDDN = ODD;                                     2611
         B     @RC02609                                            2611
@RF02609 L     @04,@PC00016+4                                      2611
         L     @04,ODD(,@04)                                       2611
         L     @01,OPNPTR                                          2611
         ST    @04,OPNDDN(,@01)                                    2611
*            END;                                                  2612
*                                                                  2612
@RC02609 DS    0H                                                  2613
*        IF OTYPE = 'O'                                            2613
*          THEN                                                    2613
*                                                                  2613
@RF02594 L     @04,@PC00016                                        2613
         CLI   OTYPE(@04),C'O'                                     2613
         BNE   @RF02613                                            2613
*            /********************************************************/
*            /*                                                      */
*            /*  OPEN FOR OUTPUT FOR VSAM DATA SET.  SET OPEN FOR    */
*            /*  OUTPUT.                                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2614
*            DO;                                                   2614
*            OPNOPTOT = ON;                                        2615
         L     @04,OPNPTR                                          2615
         OI    OPNOPTOT(@04),B'01000000'                           2615
*            OPNTYPXM = ON;                                        2616
*            /*                                              @Z40RSSA*/
*            /*  SET OPNTYPSY SO OPEN WILL BYPASS SECURITY   @Z40RSSA*/
*            /*  CHECKING                                    @Z40RSSA*/
*            /*                                              @Z40RSSA*/
*                                                                  2617
*            OPNTYPSY = ON;                                /*@Z40RSSA*/
*                                                                  2617
         OI    OPNTYPXM(@04),B'00010001'                           2617
*            /********************************************************/
*            /*                                                      */
*            /*  IF IMPORTING AN AIX, SET THE OPNMODAX BIT,          */
*            /*  SO THAT WHEN OPENING BY PATH NAME, THE AIX          */
*            /*  IS OPENED RATHER THAN THE BASE CLUSTER.             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2618
*            IF FVTPTR(1) -> CTGFVTYP = CTGTAIX                    2618
*              THEN                                                2618
         L     @01,FVTPTR                                          2618
         CLI   CTGFVTYP(@01),C'G'                                  2618
         BNE   @RF02618                                            2618
*                OPNMODAX = ON;                                    2619
*                                                                  2619
         OI    OPNMODAX(@04),B'00001000'                           2619
*            /********************************************************/
*            /*                                                      */
*            /*  GET OBJECT PASSWORD, WHICH WILL BE OVERRIDEN        */
*            /*  IF A PASSWORD WAS SPECIFIED VIA OUTFILE.            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2620
*            IF ADDR(OUTDD) ^= NULLPTR                             2620
*              THEN                                                2620
@RF02618 L     @04,@PC00001+4                                      2620
         L     @04,FDTPTR+4(,@04)                                  2620
         LTR   @04,@04                                             2620
         BZ    @RF02620                                            2620
*OFPWA:          DO;                                               2621
OFPWA    DS    0H                                                  2622
*                IF OUTDDPLN ^= 0                                  2622
*                  THEN                                            2622
         L     @04,@PC00001+4                                      2622
         L     @04,FDTPTR+4(,@04)                                  2622
         CLI   OUTDDPLN(@04),0                                     2622
         BE    @RF02622                                            2622
*                    OPNPWA = ADDR(OUTDDPAS);                      2623
         LA    @04,OUTDDPAS(,@04)                                  2623
         L     @01,OPNPTR                                          2623
         ST    @04,OPNPWA(,@01)                                    2623
*                END OFPWA;                                        2624
@RF02622 DS    0H                                                  2625
*            IF OPNPWA = NULLPTR                                   2625
*              THEN                                                2625
@RF02620 L     @04,OPNPTR                                          2625
         L     @04,OPNPWA(,@04)                                    2625
         LTR   @04,@04                                             2625
         BNZ   @RF02625                                            2625
*PORTPWA:        DO;                                               2626
PORTPWA  DS    0H                                                  2627
*                CTGFVPTR = FVTPTR(1);                             2627
         L     @04,FVTPTR                                          2627
         ST    @04,CTGFVPTR                                        2627
*                IF CTGFVSTY ^= NULLPTR                            2628
*                  THEN                                            2628
         L     @04,CTGFVSTY(,@04)                                  2628
         LTR   @04,@04                                             2628
         BZ    @RF02628                                            2628
*                    DO;                                           2629
*                    CTGFLPTR = CTGFVSTY;                          2630
         ST    @04,CTGFLPTR                                        2630
*                    OPNPWA = CTGFLPT(1);                          2631
         L     @04,CTGFLPT(,@04)                                   2631
         L     @01,OPNPTR                                          2631
         ST    @04,OPNPWA(,@01)                                    2631
*                    END;                                          2632
*                END PORTPWA;                                      2633
@RF02628 DS    0H                                                  2634
*            END;                                                  2634
*                                                                  2634
@RF02625 DS    0H                                                  2635
*        /************************************************************/
*        /*                                                          */
*        /*  SET FIELDS IN OPNAGL THAT ARE COMMON FOR OUTPUT AND     */
*        /*  INPUT                                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  2635
*        OPNIOC = OIOCS;                                           2635
@RF02613 L     @04,OPNPTR                                          2635
         L     @15,@PC00016+20                                     2635
         L     @15,OIOCS(,@15)                                     2635
         ST    @15,OPNIOC(,@04)                                    2635
*        OPNDDN = ODD;                                             2636
         L     @15,@PC00016+4                                      2636
         L     @15,ODD(,@15)                                       2636
         ST    @15,OPNDDN(,@04)                                    2636
*        IF ODSN ^= NULLPTR                                        2637
*          THEN                                                    2637
         L     @15,@PC00016+8                                      2637
         L     @15,ODSN(,@15)                                      2637
         LTR   @15,@15                                             2637
         BZ    @RF02637                                            2637
*            OPNDSN = ODSN;                                        2638
*                                                                  2638
*                                                                  2638
         ST    @15,OPNDSN(,@04)                                    2638
*        /************************************************************/
*        /*                                                          */
*        /*  SAVE THE OPNAGL INCASE A SECOND OPEN OF THE DATA SET    */
*        /*  IS REQUIRED (AS MAY BE THE CASE IN DOS).                */
*        /*  ISSUE THE UOPEN MACRO TO OPEN INPUT OR OUTPUT DATA SET  */
*        /*                                                          */
*        /************************************************************/
*                                                                  2639
*        OPENSAVE = OPNAGL;                                        2639
*                                                                  2639
@RF02637 L     @04,OPNPTR                                          2639
         MVC   OPENSAVE(48),OPNAGL(@04)                            2639
*        CALL IDCIOOP0 (GDTTBL,OPNAGL);                            2640
*                                                                  2640
         L     @15,@PC00001                                        2640
         ST    @15,@AL00001                                        2640
         ST    @04,@AL00001+4                                      2640
         MVI   @AL00001+4,X'80'                                    2640
         L     @15,GDTOPN(,@15)                                    2640
         LA    @01,@AL00001                                        2640
         BALR  @14,@15                                             2640
*        RESPECIFY RTNREG RSTD;                                    2641
*        TESTRC = RTNREG;                                          2642
         STH   RTNREG,TESTRC                                       2642
*        RESPECIFY RTNREG UNRSTD;                                  2643
*        /************************************************************/
*        /*                                                          */
*        /*  TEST RETURN CODE FROM OPEN.  IF NOT SUCCESSFUL, CLOSE   */
*        /*  DATA SET TO FREE CORE, AND SET RETURN CODE TO FAILURE   */
*        /*                                                          */
*        /************************************************************/
*                                                                  2644
*        IF TESTRC ^= 0                                            2644
*          THEN                                                    2644
         LH    @04,TESTRC                                          2644
         LTR   @04,@04                                             2644
         BZ    @RF02644                                            2644
*            DO;                                                   2645
*                                                                  2645
*            CALL IDCIOCL0 (GDTTBL,OIOCSPTR);                      2646
*                                                                  2646
         L     @04,@PC00001                                        2646
         ST    @04,@AL00001                                        2646
         L     @15,@PC00016+20                                     2646
         L     @01,OIOCS(,@15)                                     2646
         ST    @01,@AL00001+4                                      2646
         MVI   @AL00001+4,X'80'                                    2646
         L     @15,GDTCLS(,@04)                                    2646
         LA    @01,@AL00001                                        2646
         BALR  @14,@15                                             2646
*            OIOCSPTR = NULLPTR;                                   2647
         L     @04,@PC00016+20                                     2647
         L     @04,OIOCS(,@04)                                     2647
         SLR   @15,@15                                             2647
         ST    @15,OIOCSPTR(,@04)                                  2647
*            RETURN CODE(LASTCC12);                                2648
         LA    @15,12                                              2648
         L     @14,@SA00016                                        2648
         LM    @00,@12,@SA00016+8                                  2648
         BR    @14                                                 2648
*            END;                                                  2649
*          ELSE                                                    2650
*GOODOPEN:   DO;                                                   2650
*                                                                  2650
@RF02644 DS    0H                                                  2650
GOODOPEN DS    0H                                                  2651
*            /********************************************************/
*            /*                                                      */
*            /*  IF THE OPEN WAS FOR INPUT, GET THE SPECIAL FIRST    */
*            /*  RECORD OF THE PORTABLE DATA SET.  THIS CONTAINS     */
*            /*  THE RECORDSIZE OF THE PORTABLE DATA SET FOR USE     */
*            /*  IN DOS.                                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2651
*            IF OTYPE ='I'                                         2651
*              THEN                                                2651
*                                                                  2651
         L     @04,@PC00016                                        2651
         CLI   OTYPE(@04),C'I'                                     2651
         BNE   @RF02651                                            2651
*                /****************************************************/
*                /*                                                  */
*                /*  ISSUE A UGET TO GET THE RECORD, AND TEST FOR    */
*                /*  A NONZERO RETURN CODE.  IF SUCH A RETURN CODE   */
*                /*  IS DETECTED, RETURN TO THE CALLER WITH A        */
*                /*  TERMINAL ERROR INDICATED.                       */
*                /*                                                  */
*                /****************************************************/
*                                                                  2652
*OPENIN:         DO;                                               2652
OPENIN   DS    0H                                                  2653
*                CALL IDCIOGT0(GDTTBL,OIOCSPTR);                   2653
         L     @04,@PC00001                                        2653
         ST    @04,@AL00001                                        2653
         L     @15,@PC00016+20                                     2653
         L     @01,OIOCS(,@15)                                     2653
         ST    @01,@AL00001+4                                      2653
         MVI   @AL00001+4,X'80'                                    2653
         L     @15,GDTGET(,@04)                                    2653
         LA    @01,@AL00001                                        2653
         BALR  @14,@15                                             2653
*                RESPECIFY RTNREG RSTD;                            2654
*                TESTRC = RTNREG;                                  2655
         STH   RTNREG,TESTRC                                       2655
*                RESPECIFY RTNREG UNRSTD;                          2656
*                IF TESTRC ^= 0                                    2657
*                  THEN                                            2657
         LH    @04,TESTRC                                          2657
         LTR   @04,@04                                             2657
         BZ    @RF02657                                            2657
*                    DO;                                           2658
*                    CALL IDCIOCL0(GDTTBL,OIOCSPTR);               2659
         L     @04,@PC00001                                        2659
         ST    @04,@AL00001                                        2659
         L     @15,@PC00016+20                                     2659
         L     @01,OIOCS(,@15)                                     2659
         ST    @01,@AL00001+4                                      2659
         MVI   @AL00001+4,X'80'                                    2659
         L     @15,GDTCLS(,@04)                                    2659
         LA    @01,@AL00001                                        2659
         BALR  @14,@15                                             2659
*                    OIOCSPTR = NULLPTR;                           2660
         L     @04,@PC00016+20                                     2660
         L     @04,OIOCS(,@04)                                     2660
         SLR   @15,@15                                             2660
         ST    @15,OIOCSPTR(,@04)                                  2660
*                    RETURN CODE(LASTCC12);                        2661
         LA    @15,12                                              2661
         L     @14,@SA00016                                        2661
         LM    @00,@12,@SA00016+8                                  2661
         BR    @14                                                 2661
*                    END;                                          2662
*                                                                  2662
*                /****************************************************/
*                /*                                                  */
*                /*  POINT TO THE RECORD IN THE INPUT BUFFER.        */
*                /*                                                  */
*                /****************************************************/
*                                                                  2663
*                IOCSPTR = OIOCSPTR;                               2663
@RF02657 L     @04,@PC00016+20                                     2663
         L     @04,OIOCS(,@04)                                     2663
         L     @04,OIOCSPTR(,@04)                                  2663
         ST    @04,IOCSPTR                                         2663
*                CONRCPTR = IOCDAD;                                2664
*                                                                  2664
         L     @04,IOCDAD(,@04)                                    2664
         ST    @04,CONRCPTR                                        2664
*                /****************************************************/
*                /*                                                  */
*                /*  RESTORE THE OPNAGL FROM OPENSAVE, AND COMPARE   */
*                /*  THE RECORDSIZE OF THE DATA SET AS FOUND ON      */
*                /*  THE FIRST RECORD TO THAT WITH WHICH IT WAS      */
*                /*  ORIGINALLY OPENED.                              */
*                /*                                                  */
*                /****************************************************/
*                                                                  2665
*                OPNAGL = OPENSAVE;                                2665
         L     @15,OPNPTR                                          2665
         MVC   OPNAGL(48,@15),OPENSAVE                             2665
*                IF RECORDSZ > OPNREC                              2666
*                  THEN                                            2666
         L     @04,RECORDSZ(,@04)                                  2666
         C     @04,OPNREC(,@15)                                    2666
         BNH   @RF02666                                            2666
*REOPEN:             DO;                                           2667
*                                                                  2667
REOPEN   DS    0H                                                  2668
*                    /************************************************/
*                    /*                                              */
*                    /*  SET THE VALUE OF OPNREC USING THE           */
*                    /*  RECORDSIZE FOUND ON THE FIRST RECORD        */
*                    /*  OF THE DATA SET.                            */
*                    /*                                              */
*                    /************************************************/
*                                                                  2668
*                    OPNREC = RECORDSZ;                            2668
*                                                                  2668
         L     @04,CONRCPTR                                        2668
         L     @04,RECORDSZ(,@04)                                  2668
         L     @01,OPNPTR                                          2668
         ST    @04,OPNREC(,@01)                                    2668
*                    /************************************************/
*                    /*                                              */
*                    /*  ISSUE A CLOSE AGAINST THE PORTABLE DATA     */
*                    /*  SET AND ZERO OUT THE IOCS POINTER FOR THAT  */
*                    /*  DATA SET.  THEN TEST THE RETURN CODE TO     */
*                    /*  INSURE THAT THE CLOSE WAS SUCCESSFUL.       */
*                    /*                                              */
*                    /************************************************/
*                                                                  2669
*                    CALL IDCIOCL0(GDTTBL,OIOCSPTR);               2669
         L     @04,@PC00001                                        2669
         ST    @04,@AL00001                                        2669
         L     @15,@PC00016+20                                     2669
         L     @01,OIOCS(,@15)                                     2669
         ST    @01,@AL00001+4                                      2669
         MVI   @AL00001+4,X'80'                                    2669
         L     @15,GDTCLS(,@04)                                    2669
         LA    @01,@AL00001                                        2669
         BALR  @14,@15                                             2669
*                    RESPECIFY RTNREG RSTD;                        2670
*                    TESTRC = RTNREG;                              2671
         STH   RTNREG,TESTRC                                       2671
*                    RESPECIFY RTNREG UNRSTD;              /*@OZ06132*/
*                    OIOCSPTR = NULLPTR;                           2673
*                                                                  2673
         SLR   @04,@04                                             2673
         L     @15,@PC00016+20                                     2673
         L     @01,OIOCS(,@15)                                     2673
         ST    @04,OIOCSPTR(,@01)                                  2673
*                    IF TESTRC ^= 0                                2674
*                      THEN                                        2674
         LH    @15,TESTRC                                          2674
         CR    @15,@04                                             2674
         BE    @RF02674                                            2674
*                        RETURN CODE(LASTCC12);                    2675
*                                                                  2675
         LA    @15,12                                              2675
         L     @14,@SA00016                                        2675
         LM    @00,@12,@SA00016+8                                  2675
         BR    @14                                                 2675
*                    /************************************************/
*                    /*                                              */
*                    /*  REOPEN THE PORTABLE DATA SET WITH THE       */
*                    /*  RIGHT RECORD SIZE.                          */
*                    /*                                              */
*                    /************************************************/
*                                                                  2676
*                    CALL IDCIOOP0(GDTTBL,OPNAGL);                 2676
*                                                                  2676
@RF02674 L     @04,@PC00001                                        2676
         ST    @04,@AL00001                                        2676
         L     @01,OPNPTR                                          2676
         ST    @01,@AL00001+4                                      2676
         MVI   @AL00001+4,X'80'                                    2676
         L     @15,GDTOPN(,@04)                                    2676
         LA    @01,@AL00001                                        2676
         BALR  @14,@15                                             2676
*                    /************************************************/
*                    /*                                              */
*                    /*  TEST THE RETURN CODE FROM OPEN.  IF THE     */
*                    /*  SECOND OPEN FAILS, ATTEMPT TO CLOSE THE     */
*                    /*  PORTABLE DATA SET AND ZERO OUT THE          */
*                    /*  IOCS POINTER.                               */
*                    /*                                              */
*                    /************************************************/
*                                                                  2677
*                    RESPECIFY RTNREG RSTD;                        2677
*                    TESTRC = RTNREG;                              2678
         STH   RTNREG,TESTRC                                       2678
*                    RESPECIFY RTNREG UNRSTD;                      2679
*                    IF TESTRC ^= 0                                2680
*                      THEN                                        2680
         LH    @04,TESTRC                                          2680
         LTR   @04,@04                                             2680
         BZ    @RF02680                                            2680
*                        DO;                                       2681
*                        CALL IDCIOCL0(GDTTBL,OIOCSPTR);           2682
         L     @04,@PC00001                                        2682
         ST    @04,@AL00001                                        2682
         L     @15,@PC00016+20                                     2682
         L     @01,OIOCS(,@15)                                     2682
         ST    @01,@AL00001+4                                      2682
         MVI   @AL00001+4,X'80'                                    2682
         L     @15,GDTCLS(,@04)                                    2682
         LA    @01,@AL00001                                        2682
         BALR  @14,@15                                             2682
*                        OIOCSPTR = NULLPTR;                       2683
         L     @04,@PC00016+20                                     2683
         L     @04,OIOCS(,@04)                                     2683
         SLR   @15,@15                                             2683
         ST    @15,OIOCSPTR(,@04)                                  2683
*                        RETURN CODE(LASTCC12);                    2684
         LA    @15,12                                              2684
         L     @14,@SA00016                                        2684
         LM    @00,@12,@SA00016+8                                  2684
         BR    @14                                                 2684
*                        END;                                      2685
*                                                                  2685
*                    /************************************************/
*                    /*                                              */
*                    /*  THE SECOND OPEN WAS SUCCESSFUL.  READ THE   */
*                    /*  FIRST RECORD AGAIN.                         */
*                    /*                                              */
*                    /************************************************/
*                                                                  2686
*                    CALL IDCIOGT0(GDTTBL,OIOCSPTR);               2686
@RF02680 L     @04,@PC00001                                        2686
         ST    @04,@AL00001                                        2686
         L     @15,@PC00016+20                                     2686
         L     @01,OIOCS(,@15)                                     2686
         ST    @01,@AL00001+4                                      2686
         MVI   @AL00001+4,X'80'                                    2686
         L     @15,GDTGET(,@04)                                    2686
         LA    @01,@AL00001                                        2686
         BALR  @14,@15                                             2686
*                    RESPECIFY RTNREG RSTD;                        2687
*                    TESTRC = RTNREG;                              2688
         STH   RTNREG,TESTRC                                       2688
*                    RESPECIFY RTNREG UNRSTD;                      2689
*                    IF TESTRC ^= 0                                2690
*                      THEN                                        2690
         LH    @04,TESTRC                                          2690
         LTR   @04,@04                                             2690
         BZ    @RF02690                                            2690
*                        DO;                                       2691
*                                                                  2691
*                        /********************************************/
*                        /*                                          */
*                        /*  THE GET FAILED.  CLOSE THE PORTABLE     */
*                        /*  DATA SET, AND ZERO OUT THE IOCS POINTER.*/
*                        /*                                          */
*                        /********************************************/
*                                                                  2692
*                        CALL IDCIOCL0(GDTTBL,OIOCSPTR);           2692
         L     @04,@PC00001                                        2692
         ST    @04,@AL00001                                        2692
         L     @15,@PC00016+20                                     2692
         L     @01,OIOCS(,@15)                                     2692
         ST    @01,@AL00001+4                                      2692
         MVI   @AL00001+4,X'80'                                    2692
         L     @15,GDTCLS(,@04)                                    2692
         LA    @01,@AL00001                                        2692
         BALR  @14,@15                                             2692
*                        OIOCSPTR = NULLPTR;                       2693
         L     @04,@PC00016+20                                     2693
         L     @04,OIOCS(,@04)                                     2693
         SLR   @15,@15                                             2693
         ST    @15,OIOCSPTR(,@04)                                  2693
*                        RETURN CODE(LASTCC12);                    2694
         LA    @15,12                                              2694
         L     @14,@SA00016                                        2694
         LM    @00,@12,@SA00016+8                                  2694
         BR    @14                                                 2694
*                        END;                                      2695
*                    END REOPEN;                                   2696
@RF02690 DS    0H                                                  2697
*                END OPENIN;                                       2697
@RF02666 DS    0H                                                  2698
*            END GOODOPEN;                                         2698
*                                                                  2698
@RF02651 DS    0H                                                  2699
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER WITH SUCCESS INDICATED                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2699
*        RETURN CODE(0);                                           2699
*                                                                  2699
         SLR   @15,@15                                             2699
         L     @14,@SA00016                                        2699
         LM    @00,@12,@SA00016+8                                  2699
         BR    @14                                                 2699
*END OPENPROC;                                                     2700
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME- BFPLPROC                                */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT A FIELD PARAMETER LIST FROM        */
*        /*  DICTIONARY AND WORK AREA INFORMATION PASSED BY EXPORT   */
*        /*  ON PORTABILITY VOLUME OR CONSTRUCT A SKELETON FPL       */
*        /*  CONTAINING NO FIELD INFORMATION                         */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .BFLISTPT - POINTER TO THE FIELD LIST USED            */
*        /*      TO PROVIDE CATALOG FIELD NAMES                      */
*        /*    .BINDX - INDEX OF FIELDNAME INTO FIELDLST             */
*        /*    .BFPLADDR - RETURN CELL FOR FPL ADDRESS               */
*        /*    .BDICTPTR - POINTER TO DICTIONARY WHICH REFERENCES    */
*        /*     CATALOG FIELD INFORMATION IN THE WORK AREA           */
*        /*    .BWKAPTR - WORK AREA REFERENCED BY DICTIONARY         */
*        /*                                                          */
*        /*  OUTPUT - A FPL IS CONSTRUCTED                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  2701
*BFPLPROC: PROCEDURE(BFLISTPT,         /*ADDRESS OF FIELD            */
*                                      /*NAMES LIST                  */
*                    BINDX,            /*INDEX OF FIELDNAME          */
*                    BFPLADDR,         /*RETURN CELL FOR FPL POINTER */
*                    BDICTPTR,         /*POINTER TO DICTIONARY       */
*                    BWKAPTR,          /*POINTER TO WORK AREA        */
*                                      /*REFERENCED BY DICTIONARY    */
*                    BFPLRTN);         /*ADDR IN WHICH TO STORE FPL  */
BFPLPROC STM   @14,@12,@SA00017                                    2701
         MVC   @PC00017(24),0(@01)                                 2701
*                                      /*POINTER(WITHIN A FVT)       */
*                                                                  2702
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2702
*        DCL BFLISTPT PTR(31),                                     2702
*            BINDX    FIXED(15),                                   2702
*            BFPLADDR PTR(31),                                     2702
*            BDICTPTR PTR(31),                                     2702
*            BWKAPTR  PTR(31),                                     2702
*            BFPLRTN  PTR(31);                                     2702
*                                                                  2702
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS FOR BFPLPROC                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  2703
*        DCL BFLIST(*) CHAR(8) BASED(BFLISTPT);                    2703
*                                      /*TEMPLATE FOR FIELD          */
*                                      /*NAME LIST                   */
*                                                                  2704
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE DICTIONARY POINTER IS ZERO, THEN A SKELETON      */
*        /*  FIELD PARAMETER LIST(FPL) IS CONSTRUCTED                */
*        /*                                                          */
*        /************************************************************/
*                                                                  2704
*        OLDERID2 = NEWERID2;                                      2704
         L     @04,@PC00001                                        2704
         L     @15,GDTTR2(,@04)                                    2704
         MVC   @TS00001(95),NEWERID2(@15)                          2704
         MVC   OLDERID2(95,@15),@TS00001                           2704
*        NEWID2 = 'RMBF';                                          2705
*                                                                  2705
         MVC   NEWID2(4,@15),@CC01677                              2705
*        IF BDICTPTR = NULLPTR                                     2706
*          THEN                                                    2706
*                                                                  2706
         L     @15,@PC00017+12                                     2706
         L     @15,BDICTPTR(,@15)                                  2706
         LTR   @15,@15                                             2706
         BNZ   @RF02706                                            2706
*            /********************************************************/
*            /*                                                      */
*            /*  TEST TO DETERMINE IF WE ARE BUILDING AN FPL         */
*            /*  FOR THE NAMEDS FIELD.                               */
*            /*                                                      */
*            /********************************************************/
*                                                                  2707
*            IF BINDX = INAMEDS                                    2707
*              THEN                                                2707
*                                                                  2707
         L     @15,@PC00017+4                                      2707
         CLC   BINDX(2,@15),@CH01063                               2707
         BNE   @RF02707                                            2707
*                /****************************************************/
*                /*                                                  */
*                /*  BUILD AN FPL FOR NAMEDS AND ALSO A TEST         */
*                /*  FPL SO THAT CATALOG MANAGEMENT WILL             */
*                /*  RETURN AT MOST THE FIRST TWO ASSOCIA-           */
*                /*  TIONS FOUND IN THE CATALOG.                     */
*                /*                                                  */
*                /****************************************************/
*                                                                  2708
*                DO;                                               2708
*                                                                  2708
*                /****************************************************/
*                /*                                                  */
*                /*  GET CORE FOR TWO FPL'S.                         */
*                /*                                                  */
*                /****************************************************/
*                                                                  2709
*                CALL IDCSAGP0(GDTTBL,(2*(LENGTH(CTGFL)+8)),       2709
*                  BFPLADDR,GPID,SETZERO);                         2709
*                                                                  2709
         ST    @04,@AL00001                                        2709
         LA    @15,48                                              2709
         ST    @15,@AFTEMPS+20                                     2709
         LA    @15,@AFTEMPS+20                                     2709
         ST    @15,@AL00001+4                                      2709
         L     @15,@PC00017+8                                      2709
         ST    @15,@AL00001+8                                      2709
         LA    @15,GPID                                            2709
         ST    @15,@AL00001+12                                     2709
         LA    @15,SETZERO                                         2709
         ST    @15,@AL00001+16                                     2709
         MVI   @AL00001+16,X'80'                                   2709
         L     @15,GDTGPL(,@04)                                    2709
         LA    @01,@AL00001                                        2709
         BALR  @14,@15                                             2709
*                RESPECIFY RTNREG RSTD;                            2710
*                TESTRC = RTNREG;                                  2711
         STH   RTNREG,TESTRC                                       2711
*                RESPECIFY RTNREG UNRSTD;                          2712
*                                                                  2712
*                IF TESTRC ^= 0                                    2713
*                  THEN                                            2713
         LH    @04,TESTRC                                          2713
         LTR   @04,@04                                             2713
         BZ    @RF02713                                            2713
*                    DO;                                           2714
*                    DARGSMOD = UNIVMSG;                           2715
         L     @04,DDSTRU                                          2715
         MVC   DARGSMOD(3,@04),@CC00981                            2715
*                    DEFSTID = NOSTORAG;                           2716
         MVI   DEFSTID,X'04'                                       2716
*                    RETURN CODE(LASTCC12);                        2717
         LA    @15,12                                              2717
         L     @14,@SA00017                                        2717
         LM    @00,@12,@SA00017+8                                  2717
         BR    @14                                                 2717
*                    END;                                          2718
*                                                                  2718
*                /****************************************************/
*                /*                                                  */
*                /*  CONSTRUCT THE FPL FOR THE NAMEDS FIELD          */
*                /*  ITSELF.                                         */
*                /*                                                  */
*                /****************************************************/
*                                                                  2719
*                CTGFLPTR = BFPLADDR;                              2719
@RF02713 L     @04,@PC00017+8                                      2719
         L     @04,BFPLADDR(,@04)                                  2719
         ST    @04,CTGFLPTR                                        2719
*                CTGFLDNO = '00000001'B;                           2720
         MVI   CTGFLDNO(@04),X'01'                                 2720
*                CTGFLDNM = ADDR(BFLIST(BINDX));                   2721
*                                                                  2721
         L     @15,@PC00017+4                                      2721
         LH    @15,BINDX(,@15)                                     2721
         SLA   @15,3                                               2721
         L     @14,@PC00017                                        2721
         L     @01,BFLISTPT(,@14)                                  2721
         AL    @01,@CF01806                                        2721
         LA    @15,BFLIST(@15,@01)                                 2721
         ST    @15,CTGFLDNM(,@04)                                  2721
*                /****************************************************/
*                /*                                                  */
*                /*  SET THE CHAIN FIELD FROM THE NAMEDS             */
*                /*  FPL.                                            */
*                /*                                                  */
*                /****************************************************/
*                                                                  2722
*                CTGFLCHN = BFPLADDR + LENGTH(CTGFL) + 8;          2722
*                                                                  2722
         LA    @15,24                                              2722
         ALR   @15,@04                                             2722
         ST    @15,CTGFLCHN(,@04)                                  2722
*                /****************************************************/
*                /*                                                  */
*                /*  SET THE CTGFLPTR TO POINT TO THE TEST           */
*                /*  FPL.                                            */
*                /*                                                  */
*                /****************************************************/
*                                                                  2723
*                CTGFLPTR = CTGFLCHN;                              2723
*                                                                  2723
         ST    @15,CTGFLPTR                                        2723
*                /****************************************************/
*                /*                                                  */
*                /*  CONSTRUCT THE TEST FPL ITSELF.                  */
*                /*                                                  */
*                /****************************************************/
*                                                                  2724
*                CTGFLDNO = '00000001'B;                           2724
         MVI   CTGFLDNO(@15),X'01'                                 2724
*                CTGFLDNM = ADDR(CNTREPNO);                        2725
         LA    @04,CNTREPNO                                        2725
         ST    @04,CTGFLDNM(,@15)                                  2725
*                CTGFLDCD = CTGFLDLE;                              2726
         MVI   CTGFLDCD(@15),X'C0'                                 2726
*                CTGFLNG(1) = LENGTH(NUMASSOB);                    2727
         MVC   CTGFLNG(4,@15),@CF00157                             2727
*                CTGFLPT(1) = ADDR(NUMASSOB);                      2728
*                                                                  2728
         LA    @04,@CH00157                                        2728
         ST    @04,CTGFLPT(,@15)                                   2728
*                RETURN CODE(0);                                   2729
*                                                                  2729
         SLR   @15,@15                                             2729
         L     @14,@SA00017                                        2729
         LM    @00,@12,@SA00017+8                                  2729
         BR    @14                                                 2729
*                END;                                              2730
*                                                                  2730
*              ELSE                                                2731
*                                                                  2731
*                DO;                                               2731
*                                                                  2731
@RF02707 DS    0H                                                  2732
*                /****************************************************/
*                /*                                                  */
*                /*  GET CORE FOR A FPL                              */
*                /*  IF CORE IS NOT OBTAINED SUCCESSFULLY, RETURN TO */
*                /*  CALLING PROCESSOR.                              */
*                /*                                                  */
*                /****************************************************/
*                                                                  2732
*                CALL IDCSAGP0 (GDTTBL,(LENGTH(CTGFL)+8),BFPLADDR,GPID,
*ETZERO);                                                          2732
         L     @04,@PC00001                                        2732
         ST    @04,@AL00001                                        2732
         LA    @15,24                                              2732
         ST    @15,@AFTEMPS+20                                     2732
         LA    @15,@AFTEMPS+20                                     2732
         ST    @15,@AL00001+4                                      2732
         L     @15,@PC00017+8                                      2732
         ST    @15,@AL00001+8                                      2732
         LA    @15,GPID                                            2732
         ST    @15,@AL00001+12                                     2732
         LA    @15,SETZERO                                         2732
         ST    @15,@AL00001+16                                     2732
         MVI   @AL00001+16,X'80'                                   2732
         L     @15,GDTGPL(,@04)                                    2732
         LA    @01,@AL00001                                        2732
         BALR  @14,@15                                             2732
*                RESPECIFY RTNREG RSTD;                            2733
*                TESTRC = RTNREG;                                  2734
         STH   RTNREG,TESTRC                                       2734
*                RESPECIFY RTNREG UNRSTD;                          2735
*                IF TESTRC ^= 0                                    2736
*                  THEN                                            2736
         LH    @04,TESTRC                                          2736
         LTR   @04,@04                                             2736
         BZ    @RF02736                                            2736
*                    DO;                                           2737
*                    DARGSMOD = UNIVMSG;                           2738
         L     @04,DDSTRU                                          2738
         MVC   DARGSMOD(3,@04),@CC00981                            2738
*                    DEFSTID = NOSTORAG;                           2739
         MVI   DEFSTID,X'04'                                       2739
*                    RETURN CODE(LASTCC12);                        2740
         LA    @15,12                                              2740
         L     @14,@SA00017                                        2740
         LM    @00,@12,@SA00017+8                                  2740
         BR    @14                                                 2740
*                    END;                                          2741
*                                                                  2741
*                /****************************************************/
*                /*                                                  */
*                /*  SET FIELDS IN SKELETON FPL .  RETURN TO CALLING */
*                /*  PROCESSOR INDICATING SUCCESS.                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  2742
*                CTGFLPTR = BFPLADDR;  /*SET FPL BASE                */
@RF02736 L     @04,@PC00017+8                                      2742
         L     @04,BFPLADDR(,@04)                                  2742
         ST    @04,CTGFLPTR                                        2742
*                CTGFLDNO = '00000001'B;                           2743
         MVI   CTGFLDNO(@04),X'01'                                 2743
*                                      /*NUMBER OF LNG/ADDR PAIRS    */
*                CTGFLDNM = ADDR(BFLIST(BINDX));                   2744
         L     @15,@PC00017+4                                      2744
         LH    @15,BINDX(,@15)                                     2744
         SLA   @15,3                                               2744
         L     @14,@PC00017                                        2744
         L     @01,BFLISTPT(,@14)                                  2744
         AL    @01,@CF01806                                        2744
         LA    @15,BFLIST(@15,@01)                                 2744
         ST    @15,CTGFLDNM(,@04)                                  2744
*                                      /*CATALOG FIELD NAME          */
*                RETURN CODE(0);                                   2745
         SLR   @15,@15                                             2745
         L     @14,@SA00017                                        2745
         LM    @00,@12,@SA00017+8                                  2745
         BR    @14                                                 2745
*                END;                                              2746
*                                                                  2746
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT A FIELD PARAMETER LIST POINTING TO FIELD      */
*        /*  INFORMATION WITHIN THE WORK AREA REFERENCED BY THE      */
*        /*  DICTIONARY                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2747
*          ELSE                                                    2747
*            DO;                                                   2747
@RF02706 DS    0H                                                  2748
*            DICTPTR = BDICTPTR;                                   2748
         L     @04,@PC00017+12                                     2748
         L     @04,BDICTPTR(,@04)                                  2748
         ST    @04,DICTPTR                                         2748
*            IF DICTLN(BINDX) = 0                                  2749
*              THEN                                                2749
         SLR   @15,@15                                             2749
         L     @14,@PC00017+4                                      2749
         LH    @14,BINDX(,@14)                                     2749
         SLA   @14,3                                               2749
         AL    @04,@CF01779                                        2749
         C     @15,DICTLN-4(@14,@04)                               2749
         BNE   @RF02749                                            2749
*                DO;                                               2750
*                                                                  2750
*                /****************************************************/
*                /*                                                  */
*                /*  IF THE DICTIONARY ENTRY INDICATES NOT CATALOG   */
*                /*  INFORMATION FOR THIS FIELD, SET FVT POINTER     */
*                /*  TO FIELD TO ZERO AND RETURN INDICATING          */
*                /*  SUCCESSFUL COMPLETION.                          */
*                /*                                                  */
*                /****************************************************/
*                                                                  2751
*                BFPLRTN = NULLPTR;                                2751
         L     @04,@PC00017+20                                     2751
         ST    @15,BFPLRTN(,@04)                                   2751
*                RETURN CODE(0);                                   2752
         L     @14,@SA00017                                        2752
         LM    @00,@12,@SA00017+8                                  2752
         BR    @14                                                 2752
*                END;                                              2753
*                                                                  2753
*            /********************************************************/
*            /*                                                      */
*            /*  CORE FOR FPL HAS ALREADY BEEN OBTAINED.  FILL IN    */
*            /*  CATALOG FIELD INFORMATION FROM WORK AREA            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2754
*            CTGFLPTR = BFPLADDR;      /*SET FPL BASE                */
@RF02749 L     @04,@PC00017+8                                      2754
         L     @15,BFPLADDR(,@04)                                  2754
         ST    @15,CTGFLPTR                                        2754
*            BFPLRTN = BFPLADDR;                                   2755
         L     @14,@PC00017+20                                     2755
         ST    @15,BFPLRTN(,@14)                                   2755
*            CTGFLDNO = '00000001'B;   /*SET NUMBER LNG/ADDR PAIRS   */
         MVI   CTGFLDNO(@15),X'01'                                 2756
*            CTGFLDNM = ADDR(BFLIST(BINDX));                       2757
         L     @14,@PC00017+4                                      2757
         LH    @14,BINDX(,@14)                                     2757
         LR    @03,@14                                             2757
         SLA   @03,3                                               2757
         L     @02,@PC00017                                        2757
         L     @01,BFLISTPT(,@02)                                  2757
         AL    @01,@CF01806                                        2757
         LA    @03,BFLIST(@03,@01)                                 2757
         ST    @03,CTGFLDNM(,@15)                                  2757
*                                      /*SET CATALOG FIELD NAME      */
*                                                                  2758
*            /********************************************************/
*            /*                                                      */
*            /*  IF CONSTRUCTING AMDSBCAT FPL, THE CATALOG FIELD     */
*            /*  INFORMATION AREA IS JUST BEYOND THE FPL AREA.       */
*            /*                                                      */
*            /********************************************************/
*                                                                  2758
*            IF BINDX = IAMDSB                                     2758
*              THEN                                                2758
         C     @14,@CF00966                                        2758
         BNE   @RF02758                                            2758
*                DO;                                               2759
*                CTGFLNG(1) = LENGTH(IDAAMDSB);                    2760
         LA    @14,96                                              2760
         ST    @14,CTGFLNG(,@15)                                   2760
*                                      /*CATALOG DATA LENGTH         */
*                BFPLADDR = BFPLADDR + LENGTH(CTGFL) + 8;          2761
         LA    @03,24                                              2761
         ALR   @03,@15                                             2761
         ST    @03,BFPLADDR(,@04)                                  2761
*                CTGFLPT(1) = BFPLADDR;/*CATALOG DATA ADDRESS        */
         ST    @03,CTGFLPT(,@15)                                   2762
*                BFPLADDR = BFPLADDR + LENGTH(IDAAMDSB);           2763
         ALR   @03,@14                                             2763
         ST    @03,BFPLADDR(,@04)                                  2763
*                END;                                              2764
*              ELSE                                                2765
*                /****************************************************/
*                /*                                                  */
*                /*  FOR A FPL OTHER THAN AMDSBCAT, THE CATALOG FIELD*/
*                /*  INFORMATION IS IN THE WORK AREA READ IN FROM THE*/
*                /*  PORTABLE DATA SET.                              */
*                /*                                                  */
*                /****************************************************/
*                                                                  2765
*                DO;                                               2765
         B     @RC02758                                            2765
@RF02758 DS    0H                                                  2766
*                CTGFLNG(1) = DICTLN(BINDX);                       2766
         L     @04,CTGFLPTR                                        2766
         L     @15,DICTPTR                                         2766
         L     @14,@PC00017+4                                      2766
         LH    @14,BINDX(,@14)                                     2766
         SLA   @14,3                                               2766
         LA    @01,0(@14,@15)                                      2766
         AL    @01,@CF01779                                        2766
         L     @03,DICTLN-4(,@01)                                  2766
         ST    @03,CTGFLNG(,@04)                                   2766
*                                      /*CATALOG DATA LENGTH         */
*                CTGFLPT(1) = BWKAPTR + DICTDL(BINDX);             2767
         L     @03,@PC00017+16                                     2767
         L     @03,BWKAPTR(,@03)                                   2767
         AL    @03,DICTDL-8(@14,@15)                               2767
         ST    @03,CTGFLPT(,@04)                                   2767
*                                      /*CATALOG DATA ADDRESS        */
*                                                                  2768
*                /****************************************************/
*                /*                                                  */
*                /*  INCREMENT FPL ADDRESS TO NEXT FPL POSITION      */
*                /*                                                  */
*                /****************************************************/
*                                                                  2768
*                BFPLADDR = BFPLADDR + LENGTH(CTGFL) +8;           2768
         L     @04,@PC00017+8                                      2768
         LA    @15,24                                              2768
         AL    @15,BFPLADDR(,@04)                                  2768
         ST    @15,BFPLADDR(,@04)                                  2768
*                END;                                              2769
*            END;                                                  2770
*                                                                  2770
@RC02758 DS    0H                                                  2771
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2771
*        RETURN CODE(0);                                           2771
*                                                                  2771
         SLR   @15,@15                                             2771
         L     @14,@SA00017                                        2771
         LM    @00,@12,@SA00017+8                                  2771
         BR    @14                                                 2771
*END BFPLPROC;                                                     2772
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - RECPROC                                */
*        /*                                                          */
*        /*  FUNCTION - COPY THE DATA FROM THE PORTABILITY DATA SET  */
*        /*  TO THE VSAM CLUSTER BEING IMPORTED.                     */
*        /*  THE VSAM CLUSTER IS OPENED BY OPENPROC,                 */
*        /*  THE UCOPY MACRO IS EMPLOYED TO PERFORM THE COPY, THEN   */
*        /*  THE CLUSTER DATA SET IS CLOSED THROUGH ISSUANCE OF THE  */
*        /*  UCLOSE MACRO.                                           */
*        /*                                                          */
*        /*  INPUT - NONE                                            */
*        /*                                                          */
*        /*  OUTPUT - THE VSAM CLUSTER WILL CONTAIN ALL DATA THAT IT */
*        /*  CONTAINED PRIOR TO EXPORT.                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2773
*RECPROC:  PROCEDURE;                                              2773
*                                                                  2773
*                                                                  2773
RECPROC  STM   @14,@12,@SA00018                                    2773
*        /************************************************************/
*        /*                                                          */
*        /*  CALL ALTRPROC TO ALTER THE NAME OF THE DATA SET TO BE   */
*        /*  LOADED BY RECPROC TO THE NAME RETURNED BY UIOINFO AS    */
*        /*  BEING THE DATA SET NAME GIVEN ON THE DD CARD.           */
*        /*                                                          */
*        /************************************************************/
*                                                                  2774
*        IF ADDR(OUTDD) ^= NULLPTR                                 2774
*          THEN                                                    2774
         L     @04,@PC00001+4                                      2774
         L     @04,FDTPTR+4(,@04)                                  2774
         LTR   @04,@04                                             2774
         BZ    @RF02774                                            2774
*            DO;                                           /*@OZ17068*/
*            CALL ALTRPROC('F');                                   2776
*                                                                  2776
         LA    @01,@AL02776                                        2776
         BAL   @14,ALTRPROC                                        2776
*        /************************************************************/
*        /*                                                          */
*        /*  TEST THE RETURN CODE FROM ALTRPROC.  IF IT IS NONZERO,  */
*        /*  INDICATE A TERMINAL ERROR, AND RETURN TO THE CALLER.    */
*        /*  SET IMPORTRA FAILED MESSAGE FLAG.               @OZ17068*/
*        /*                                                          */
*        /************************************************************/
*                                                                  2777
*            RESPECIFY RTNREG RSTD;                                2777
*            TESTRC = RTNREG;                                      2778
         STH   RTNREG,TESTRC                                       2778
*            RESPECIFY RTNREG UNRSTD;                      /*@OZ17068*/
*            IF TESTRC ^= 0                                /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         LH    @04,TESTRC                                          2780
         LTR   @04,@04                                             2780
         BZ    @RF02780                                            2780
*                DO;                                       /*@OZ17068*/
*                IMPMFIMF = ON;                            /*@OZ17068*/
         OI    IMPMFIMF,B'10000000'                                2782
*                RETURN CODE(LASTCC12);                    /*@OZ17068*/
         LA    @15,12                                              2783
         L     @14,@SA00018                                        2783
         LM    @00,@12,@SA00018+8                                  2783
         BR    @14                                                 2783
*                END;                                      /*@OZ17068*/
*                                                          /*@OZ17068*/
*            END;                                          /*@OZ17068*/
*                                                                  2785
@RF02780 DS    0H                                                  2786
*        /************************************************************/
*        /*                                                          */
*        /*  CALL OPENPROC TO OPEN THE VSAM CLUSTER FOR INPUT.       */
*        /*  IF THE OPEN FAILS, SET THE IMPORTRA FAILED      @OZ17068*/
*        /*  MESSAGE FLAG AND TRY TO RENAME THE OBJECT BACK  @OZ17068*/
*        /*  TO THE REAL NAME BEFORE RETURNING TO THE CALLER.@OZ17068*/
*        /*  IF THE RENAME FAILS THE REMAINING OBJECTS THAT  @OZ17068*/
*        /*  REQUIRE THE DUMMY NAME WILL ALSO FAIL. SET THE  @OZ17068*/
*        /*  DUMMY NAME MESSAGE FLAG AND RETURN TO CALLER    @OZ17068*/
*        /*  WITH TERMINATE RETURN CODE. SET RETURN CODE TO  @OZ17068*/
*        /*  CONTINUE TO NEXT OBJECT IF RENAME SUCCESSFUL.   @OZ17068*/
*        /*                                                          */
*        /************************************************************/
*                                                                  2786
*        IF ADDR(OUTDD) ^= NULLPTR                                 2786
*          THEN                                                    2786
@RF02774 L     @04,@PC00001+4                                      2786
         L     @04,FDTPTR+4(,@04)                                  2786
         LTR   @04,@04                                             2786
         BZ    @RF02786                                            2786
*            CALL OPENPROC('O',ADDR(OUTDDVAL),NULLPARM,0,0,        2787
*              ADDR(POUTIOCS));                                    2787
         MVC   @AL00001(20),@AL02787                               2787
         LA    @04,OUTDDVAL(,@04)                                  2787
         ST    @04,@AFTEMPS+24                                     2787
         LA    @04,@AFTEMPS+24                                     2787
         ST    @04,@AL00001+4                                      2787
         LA    @04,POUTIOCS                                        2787
         ST    @04,@AFTEMPS+28                                     2787
         LA    @04,@AFTEMPS+28                                     2787
         ST    @04,@AL00001+20                                     2787
         LA    @01,@AL00001                                        2787
         BAL   @14,OPENPROC                                        2787
*          ELSE                                                    2788
*            CALL OPENPROC('O',ADDR(ALLDDN),NULLPARM,0,0,          2788
*               ADDR(POUTIOCS));                                   2788
         B     @RC02786                                            2788
@RF02786 MVC   @AL00001(20),@AL02788                               2788
         L     @04,ALLPTR                                          2788
         LA    @04,ALLDDN(,@04)                                    2788
         ST    @04,@AFTEMPS+24                                     2788
         LA    @04,@AFTEMPS+24                                     2788
         ST    @04,@AL00001+4                                      2788
         LA    @04,POUTIOCS                                        2788
         ST    @04,@AFTEMPS+28                                     2788
         LA    @04,@AFTEMPS+28                                     2788
         ST    @04,@AL00001+20                                     2788
         LA    @01,@AL00001                                        2788
         BAL   @14,OPENPROC                                        2788
*        RESPECIFY RTNREG RSTD;                                    2789
@RC02786 DS    0H                                                  2790
*        TESTRC = RTNREG;                                          2790
         STH   RTNREG,TESTRC                                       2790
*        RESPECIFY RTNREG UNRSTD;                                  2791
*        IF TESTRC ^= 0                                            2792
*          THEN                                                    2792
         LH    @04,TESTRC                                          2792
         SLR   @15,@15                                             2792
         CR    @04,@15                                             2792
         BE    @RF02792                                            2792
*            DO;                                                   2793
*            IMPMFIMF = ON;                                /*@OZ17068*/
         OI    IMPMFIMF,B'10000000'                                2794
*                                                          /*@OZ17068*/
*            IF ADDR(OUTDD) ^= NULLPTR                     /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         L     @04,@PC00001+4                                      2795
         C     @15,FDTPTR+4(,@04)                                  2795
         BE    @RF02795                                            2795
*                DO;                                       /*@OZ17068*/
*                                                          /*@OZ17068*/
*                CALL ALTRPROC('S');                       /*@OZ17068*/
         LA    @01,@AL02797                                        2797
         BAL   @14,ALTRPROC                                        2797
*                                                          /*@OZ17068*/
*                RESPECIFY RTNREG RSTD;                            2798
*                TESTRC = RTNREG;                                  2799
         STH   RTNREG,TESTRC                                       2799
*                RESPECIFY RTNREG UNRSTD;                  /*@OZ17068*/
*                IF TESTRC ^= 0                            /*@OZ17068*/
*                  THEN                                    /*@OZ17068*/
         LH    @04,TESTRC                                          2801
         LTR   @04,@04                                             2801
         BZ    @RF02801                                            2801
*                    DO;                                   /*@OZ17068*/
*                    IMPMFDNM = ON;                        /*@OZ17068*/
         OI    IMPMFDNM,B'01000000'                                2803
*                                                          /*@OZ17068*/
*                    RETURN CODE(LASTCC12);                /*@OZ17068*/
         LA    @15,12                                              2804
         L     @14,@SA00018                                        2804
         LM    @00,@12,@SA00018+8                                  2804
         BR    @14                                                 2804
*                    END;                                  /*@OZ17068*/
*                END;                                      /*@OZ17068*/
@RF02801 DS    0H                                                  2807
*            RETURN CODE(LASTCC08);                        /*@OZ17068*/
@RF02795 LA    @15,8                                               2807
         L     @14,@SA00018                                        2807
         LM    @00,@12,@SA00018+8                                  2807
         BR    @14                                                 2807
*            END;                                                  2808
*                                                                  2808
*        /************************************************************/
*        /*                                                          */
*        /*  COPY DATA BY RECORD FROM THE PORTABILITY DATA SET TO    */
*        /*  THE CLUSTER. IF ANY ERRORS ARE ENCOUNTERED,     @OZ17068*/
*        /*  SET THE IMPORTRA FAILED MESSAGE FLAG, CLOSE     @OZ17068*/
*        /*  THE CLUSTER AND TRY TO RENAME THE CLUSTER BACK  @OZ17068*/
*        /*  TO THE REAL NAME. IF THE RENAME FAILS SET THE   @OZ17068*/
*        /*  DUMMY NAME MESSAGE FLAG AND RETURN WITH A       @OZ17068*/
*        /*  TERMINATE RETURN CODE. IF THE RENAME IS SUCCESS-@OZ17068*/
*        /*  FUL SET THE DELETE FLAG AND DETERMINE IF THE    @OZ17068*/
*        /*  UCOPY ERROR WAS AN ERROR ON THE PORTABILITY DATA@OZ17068*/
*        /*  SET. IF IT WAS, RETURN TO THE CALLER WITH A     @OZ17068*/
*        /*  TERMINATE RETURN CODE. IF NOT,RETURN WITH A     @OZ17068*/
*        /*  RETURN CODE TO CONTINUE TO THE NEXT OBJECT.     @OZ17068*/
*        /*                                                          */
*        /************************************************************/
*                                                                  2809
*        CALL IDCIOCO0 (GDTTBL,PINIOCS,POUTIOCS);                  2809
*                                                                  2809
@RF02792 L     @04,@PC00001                                        2809
         ST    @04,@AL00001                                        2809
         LA    @15,PINIOCS                                         2809
         ST    @15,@AL00001+4                                      2809
         LA    @15,POUTIOCS                                        2809
         ST    @15,@AL00001+8                                      2809
         MVI   @AL00001+8,X'80'                                    2809
         L     @15,GDTCPY(,@04)                                    2809
         LA    @01,@AL00001                                        2809
         BALR  @14,@15                                             2809
*        RESPECIFY RTNREG RSTD;                                    2810
*        TESTRC = RTNREG;                                          2811
         STH   RTNREG,TESTRC                                       2811
*        RESPECIFY RTNREG UNRSTD;                                  2812
*        IF TESTRC ^= 0                                            2813
*          THEN                                                    2813
         LH    @04,TESTRC                                          2813
         LTR   @04,@04                                             2813
         BZ    @RF02813                                            2813
*            DO;                                                   2814
*            IMPMFIMF = ON;                                /*@OZ17068*/
         OI    IMPMFIMF,B'10000000'                                2815
*            CALL IDCIOCL0(GDTTBL,POUTIOCS);                       2816
         L     @04,@PC00001                                        2816
         ST    @04,@AL00001                                        2816
         LA    @15,POUTIOCS                                        2816
         ST    @15,@AL00001+4                                      2816
         MVI   @AL00001+4,X'80'                                    2816
         L     @15,GDTCLS(,@04)                                    2816
         LA    @01,@AL00001                                        2816
         BALR  @14,@15                                             2816
*            POUTIOCS = NULLPTR;                                   2817
         SLR   @04,@04                                             2817
         ST    @04,POUTIOCS                                        2817
*                                                          /*@OZ17068*/
*            IF ADDR(OUTDD) ^= NULLPTR                     /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         L     @15,@PC00001+4                                      2818
         C     @04,FDTPTR+4(,@15)                                  2818
         BE    @RF02818                                            2818
*                DO;                                       /*@OZ17068*/
*                CALL ALTRPROC('S');                       /*@OZ17068*/
         LA    @01,@AL02820                                        2820
         BAL   @14,ALTRPROC                                        2820
*                RESPECIFY RTNREG RSTD;                            2821
*                TESTRC = RTNREG;                                  2822
         STH   RTNREG,TESTRC                                       2822
*                RESPECIFY RTNREG UNRSTD;                  /*@OZ17068*/
*                IF TESTRC ^= 0                            /*@OZ17068*/
*                  THEN                                    /*@OZ17068*/
         LH    @04,TESTRC                                          2824
         LTR   @04,@04                                             2824
         BZ    @RF02824                                            2824
*                    DO;                                   /*@OZ17068*/
*                    IMPMFDNM = ON;                        /*@OZ17068*/
         OI    IMPMFDNM,B'01000000'                                2826
*                    RETURN CODE(LASTCC12);                /*@OZ17068*/
         LA    @15,12                                              2827
         L     @14,@SA00018                                        2827
         LM    @00,@12,@SA00018+8                                  2827
         BR    @14                                                 2827
*                    END;                                  /*@OZ17068*/
*                END;                                      /*@OZ17068*/
@RF02824 DS    0H                                                  2830
*              IMPF2DEL = ON;                              /*@OZ17068*/
@RF02818 OI    IMPF2DEL,B'01000000'                                2830
*              IF PINIOCS -> IOCMSGOP = OFF                /*@OZ17068*/
*                THEN                                      /*@OZ17068*/
         L     @04,PINIOCS                                         2831
         TM    IOCMSGOP(@04),B'00100000'                           2831
         BNZ   @RF02831                                            2831
*                  RETURN CODE(LASTCC12);                  /*@OZ17068*/
         LA    @15,12                                              2832
         L     @14,@SA00018                                        2832
         LM    @00,@12,@SA00018+8                                  2832
         BR    @14                                                 2832
*                ELSE                                      /*@OZ17068*/
*                  RETURN CODE(LASTCC08);                  /*@OZ17068*/
@RF02831 LA    @15,8                                               2833
         L     @14,@SA00018                                        2833
         LM    @00,@12,@SA00018+8                                  2833
         BR    @14                                                 2833
*            END;                                                  2834
*                                                                  2834
*        /************************************************************/
*        /*                                                          */
*        /*  CLOSE THE OUTPUT DATA SET (THE VSAM CLUSTER).  IF THE   */
*        /*  CLOSE FAILS, SET THE IMPORTRA FAILED MESSAGE    @OZ17068*/
*        /*  FLAG AND TRY TO RENAME THE CLUSTER BACK TO THE  @OZ17068*/
*        /*  REAL NAME. IF THE RENAME FAILS, SET THE DUMMY   @OZ17068*/
*        /*  NAME MESSAGE FLAG AND RETURN TO THE CALLER WITH @OZ17068*/
*        /*  A TERMINATE RETURN CODE. IF SUCCESSFUL, SET THE @OZ17068*/
*        /*  DELETE FLAG, THE GETEOF BIT AND RETURN TO THE   @OZ17068*/
*        /*  CALLER WITH A CONTINUE RETURN CODE.             @OZ17068*/
*        /*                                                          */
*        /************************************************************/
*                                                                  2835
*        CALL IDCIOCL0 (GDTTBL,POUTIOCS);                          2835
*                                                                  2835
@RF02813 L     @04,@PC00001                                        2835
         ST    @04,@AL00001                                        2835
         LA    @15,POUTIOCS                                        2835
         ST    @15,@AL00001+4                                      2835
         MVI   @AL00001+4,X'80'                                    2835
         L     @15,GDTCLS(,@04)                                    2835
         LA    @01,@AL00001                                        2835
         BALR  @14,@15                                             2835
*        RESPECIFY RTNREG RSTD;                                    2836
*        TESTRC = RTNREG;                                          2837
         STH   RTNREG,TESTRC                                       2837
*        RESPECIFY RTNREG UNRSTD;                                  2838
*        POUTIOCS = NULLPTR;                                       2839
         SLR   @04,@04                                             2839
         ST    @04,POUTIOCS                                        2839
*        IF TESTRC ^= 0                                            2840
*          THEN                                                    2840
         LH    @15,TESTRC                                          2840
         CR    @15,@04                                             2840
         BE    @RF02840                                            2840
*            DO;                                                   2841
*            IMPMFIMF = ON;                                /*@OZ17068*/
         OI    IMPMFIMF,B'10000000'                                2842
*            IF ADDR(OUTDD) ^= NULLPTR                     /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         L     @15,@PC00001+4                                      2843
         C     @04,FDTPTR+4(,@15)                                  2843
         BE    @RF02843                                            2843
*                DO;                                       /*@OZ17068*/
*                CALL ALTRPROC('S');                       /*@OZ17068*/
         LA    @01,@AL02845                                        2845
         BAL   @14,ALTRPROC                                        2845
*                RESPECIFY RTNREG RSTD;                            2846
*                TESTRC = RTNREG;                                  2847
         STH   RTNREG,TESTRC                                       2847
*                RESPECIFY RTNREG UNRSTD;                  /*@OZ17068*/
*                IF TESTRC ^= 0                            /*@OZ17068*/
*                  THEN                                    /*@OZ17068*/
         LH    @04,TESTRC                                          2849
         LTR   @04,@04                                             2849
         BZ    @RF02849                                            2849
*                    DO;                                   /*@OZ17068*/
*                    IMPMFDNM = ON;                        /*@OZ17068*/
         OI    IMPMFDNM,B'01000000'                                2851
*                    RETURN CODE(LASTCC12);                /*@OZ17068*/
         LA    @15,12                                              2852
         L     @14,@SA00018                                        2852
         LM    @00,@12,@SA00018+8                                  2852
         BR    @14                                                 2852
*                    END;                                  /*@OZ17068*/
*                END;                                      /*@OZ17068*/
@RF02849 DS    0H                                                  2855
*            IMPF2DEL = ON;                                /*@OZ17068*/
@RF02843 OI    IMPF2DEL,B'01000000'                                2855
*            GETEOF = ON;                                  /*@OZ17068*/
         OI    GETEOF,B'10000000'                                  2856
*            RETURN CODE(LASTCC08);                        /*@OZ17068*/
         LA    @15,8                                               2857
         L     @14,@SA00018                                        2857
         LM    @00,@12,@SA00018+8                                  2857
         BR    @14                                                 2857
*            END;                                                  2858
*                                                                  2858
*        /************************************************************/
*        /*                                                          */
*        /*  CALL ALTRPROC TO ALTER THE NAME OF THE DATA SET JUST    */
*        /*  CLOSED BACK TO THE NAME UNDER WHICH IT WAS ORIGINALLY   */
*        /*  DEFINED. IF THE ALTER FAILS SET THE IMPORTRA    @OZ17068*/
*        /*  FAILED AND DUMMY NAME MESSAGE FLAGS AND RETURN  @OZ17068*/
*        /*  TO THE CALLER WITH A TERMINATE RETURN CODE.     @OZ17068*/
*        /*                                                          */
*        /************************************************************/
*                                                                  2859
*        IF ADDR(OUTDD) ^= NULLPTR                                 2859
*          THEN                                                    2859
@RF02840 L     @04,@PC00001+4                                      2859
         L     @04,FDTPTR+4(,@04)                                  2859
         LTR   @04,@04                                             2859
         BZ    @RF02859                                            2859
*            DO;                                           /*@OZ17068*/
*            CALL ALTRPROC('S');                                   2861
*                                                                  2861
         LA    @01,@AL02861                                        2861
         BAL   @14,ALTRPROC                                        2861
*        /************************************************************/
*        /*                                                          */
*        /*  TEST THE RETURN CODE FROM ALTRPROC.  IF IT IS NONZERO,  */
*        /*  RETURN TO THE CALLING PROCESSOR WITH A TERMINAL ERROR   */
*        /*  INDICATED.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2862
*            RESPECIFY RTNREG RSTD;                                2862
*            TESTRC = RTNREG;                                      2863
         STH   RTNREG,TESTRC                                       2863
*            RESPECIFY RTNREG UNRSTD;                      /*@OZ17068*/
*            IF TESTRC ^= 0                                /*@OZ17068*/
*              THEN                                        /*@OZ17068*/
         LH    @04,TESTRC                                          2865
         LTR   @04,@04                                             2865
         BZ    @RF02865                                            2865
*                DO;                                       /*@OZ17068*/
*                IMPMFIMF = ON;                            /*@OZ17068*/
*                IMPMFDNM = ON;                            /*@OZ17068*/
         OI    IMPMFIMF,B'11000000'                                2868
*                RETURN CODE(LASTCC12);                    /*@OZ17068*/
         LA    @15,12                                              2869
         L     @14,@SA00018                                        2869
         LM    @00,@12,@SA00018+8                                  2869
         BR    @14                                                 2869
*                END;                                      /*@OZ17068*/
*            END;                                          /*@OZ17068*/
*                                                                  2871
@RF02865 DS    0H                                                  2872
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO THE CALLING PROCESSOR WITH SUCCESSFUL         */
*        /*  COMPLETION INDICATED                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  2872
*        RETURN CODE(LASTCC00);                                    2872
@RF02859 SLR   @15,@15                                             2872
         L     @14,@SA00018                                        2872
         LM    @00,@12,@SA00018+8                                  2872
         BR    @14                                                 2872
*END RECPROC;                                                      2873
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - MVDAPROC                               */
*        /*                                                          */
*        /*  FUNCTION - MOVES DATA FROM ONE LOCATION IN CORE TO      */
*        /*  ANOTHER AS SPECIFIED BY INPUT ARGUMENTS.                */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .MSIZE - LENGTH OF DATA TO BE MOVED                   */
*        /*    .MF1PTR- FROM LOCATION                                */
*        /*    .MT1PTR- TO LOCATION                                  */
*        /*                                                          */
*        /*  OUTPUT - DATA WILL BE MOVED TO LOCATION INDICATED BY    */
*        /*  THE "TO" AGRUMENT (MPTR).                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  2874
*MVDAPROC: PROCEDURE(MSIZE,                                        2874
*                    MF1PTR,           /*LOCATION TO MOVE FROM       */
*                    MT1PTR);          /*LOCATION TO MOVE DATA INTO  */
*                                                                  2874
MVDAPROC STM   @14,@12,12(@13)                                     2874
         MVC   @PC00019(12),0(@01)                                 2874
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2875
*        DCL MSIZE    FIXED(15),                                   2875
*            MF1PTR   PTR(31),                                     2875
*            MT1PTR   PTR(31);                                     2875
*                                                                  2875
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2876
*        DCL MFPTR PTR(31);            /*WORKING SOURCE PTR          */
*        DCL MTPTR PTR(31);            /*WORKING TARGET PTR          */
*        DCL FROMAREA CHAR(*) BASED(MFPTR);                        2878
*        DCL TOAREA   CHAR(*) BASED(MTPTR);                        2879
*        DCL M1SIZE FIXED(15);                                     2880
*        DCL DOCNTRL  BIT(1);                                      2881
*                                                                  2881
*        /************************************************************/
*        /*                                                          */
*        /*  LOOP MOVING 256 BYTES AT A TIME                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  2882
*        MFPTR = MF1PTR;                                           2882
         L     @04,@PC00019+4                                      2882
         L     @04,MF1PTR(,@04)                                    2882
         ST    @04,MFPTR                                           2882
*        MTPTR = MT1PTR;                                           2883
         L     @04,@PC00019+8                                      2883
         L     @04,MT1PTR(,@04)                                    2883
         ST    @04,MTPTR                                           2883
*        M1SIZE = MSIZE;                                           2884
         L     @04,@PC00019                                        2884
         LH    @04,MSIZE(,@04)                                     2884
         STH   @04,M1SIZE                                          2884
*        DOCNTRL = ON;                                             2885
         OI    DOCNTRL,B'10000000'                                 2885
*        DO WHILE (DOCNTRL = ON);                                  2886
*                                                                  2886
         B     @DE02886                                            2886
@DL02886 DS    0H                                                  2887
*          /**********************************************************/
*          /*                                                        */
*          /*  CHECK FOR MORE THAN 256 BYTES TO MOVE                 */
*          /*                                                        */
*          /**********************************************************/
*                                                                  2887
*          IF M1SIZE > 256                                         2887
*            THEN                                                  2887
         LH    @04,M1SIZE                                          2887
         LA    @15,256                                             2887
         CR    @04,@15                                             2887
         BNH   @RF02887                                            2887
*              DO;                                                 2888
*              /******************************************************/
*              /*                                                    */
*              /*  MOVE 256 BYTES AT A TIME AND UPDATE SIZE AND      */
*              /*  POINTER VARIABLES FOR NEXT ITERATION              */
*              /*                                                    */
*              /******************************************************/
*                                                                  2889
*              TOAREA(1:256) = FROMAREA(1:256);                    2889
         L     @14,MTPTR                                           2889
         L     @03,MFPTR                                           2889
         MVC   TOAREA(256,@14),FROMAREA(@03)                       2889
*              M1SIZE = M1SIZE - 256;                              2890
         SLR   @04,@15                                             2890
         STH   @04,M1SIZE                                          2890
*              MTPTR = MTPTR +256;                                 2891
         ALR   @14,@15                                             2891
         ST    @14,MTPTR                                           2891
*              MFPTR = MFPTR + 256;                                2892
         ALR   @03,@15                                             2892
         ST    @03,MFPTR                                           2892
*              END;                                                2893
*                                                                  2893
*            ELSE                                                  2894
*              DO;                                                 2894
         B     @RC02887                                            2894
@RF02887 DS    0H                                                  2895
*              /******************************************************/
*              /*                                                    */
*              /*  MOVE NUMBER OF BYTES INDICATED BY MSIZE AND RETURN*/
*              /*                                                    */
*              /******************************************************/
*                                                                  2895
*              TOAREA(1:M1SIZE) = FROMAREA(1:M1SIZE);              2895
         L     @04,MTPTR                                           2895
         LH    @15,M1SIZE                                          2895
         BCTR  @15,0                                               2895
         L     @01,MFPTR                                           2895
         EX    @15,@SM01807                                        2895
*              DOCNTRL = OFF;                                      2896
         NI    DOCNTRL,B'01111111'                                 2896
*              END;                                                2897
*          END;                                                    2898
*                                                                  2898
@RC02887 DS    0H                                                  2898
@DE02886 TM    DOCNTRL,B'10000000'                                 2898
         BO    @DL02886                                            2898
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2899
*        RETURN CODE(0);                                           2899
         SLR   @15,@15                                             2899
         L     @14,12(,@13)                                        2899
         LM    @00,@12,20(@13)                                     2899
         BR    @14                                                 2899
*END MVDAPROC;                                                     2900
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - FVTPROC                                */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT FVT AND FPL'S FROM INFORMATION     */
*        /*  IN THE DICTIONARY PASSED AS AN ARGUMENT TO THIS         */
*        /*  PROCEDURE.  FPL'S WILL POINT TO THE CATALOG FIELD       */
*        /*  INFORMATION WITHIN THE WORK AREA.                       */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .FDICT - POINTER TO DICTIONARY WHICH REFERENCES       */
*        /*      CATALOG FIELD INFORMATION WITH WORK AREA            */
*        /*    .FWKA - WORK AREA CONTAINING CATALOG FIELD INFORMATION*/
*        /*    .FPTRFVT - RETURN CELL FOR FVT POINTER                */
*        /*                                                          */
*        /*  OUTPUT - POINTER TO FVT CONSTRUCTED.  THIS FVT WILL     */
*        /*  REFERENCE ALL FPL'S CONSTRUCTED BY THIS PROCEDURE       */
*        /*                                                          */
*        /************************************************************/
*                                                                  2901
*FVTPROC: PROCEDURE(FDICT,             /*DICTIONARY POINTER          */
*                  FWKA,     /*WORK AREA POINTER                     */
*                  FPTRFVT); /*RETURN CELL FOR FVT POINTER           */
*                                                                  2901
FVTPROC  STM   @14,@12,@SA00020                                    2901
         MVC   @PC00020(12),0(@01)                                 2901
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2902
*        DCL FDICT    PTR(31),                                     2902
*            FWKA     PTR(31),                                     2902
*            FPTRFVT  PTR(31);                                     2902
*                                                                  2902
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2903
*        DCL FPLADDR  PTR(31);                                     2903
*        DCL FPLNUM  FIXED(15) CONSTANT(12); /*NUMBER OF FPL'S BUILT */
*                                       /*BY THIS PROCEDURE          */
*        /* FIELDPTR USED TO POINT TO ENTRY TYPE OR SECFLAGS @Z40RSSA*/
*        /* IN THE DICTIONARY WORK AREA                      @Z40RSSA*/
*        DCL   FIELDPTR PTR(31);                                   2905
*        /************************************************************/
*        /*                                                          */
*        /*  GET CORE FOR THE FVT AND THE TOTAL NUMBER OF FPL'S      */
*        /*  THAT CAN BE CONSTRUCTED BY THIS PROCEDURE               */
*        /*                                                          */
*        /************************************************************/
*                                                                  2906
*        OLDERID2 = NEWERID2;                                      2906
         L     @04,@PC00001                                        2906
         L     @15,GDTTR2(,@04)                                    2906
         MVC   @TS00001(95),NEWERID2(@15)                          2906
         MVC   OLDERID2(95,@15),@TS00001                           2906
*        NEWID2 = 'RMFV';                                          2907
         MVC   NEWID2(4,@15),@CC01709                              2907
*        RESPECIFY CTGFV BASED(FPTRFVT);                           2908
*        TOTLEN =2*(LENGTH(CTGFV) + (LENGTH(CTGFL)+8) * FPLNUM     2909
*          + LENGTH(IDAAMDSB));                                    2909
*                                                                  2909
         MVC   TOTLEN(4),@CF01762                                  2909
*        CALL IDCSAGP0 (GDTTBL,TOTLEN,FPTRFVT,GPID,SETZERO);       2910
*                                                                  2910
         ST    @04,@AL00001                                        2910
         LA    @15,TOTLEN                                          2910
         ST    @15,@AL00001+4                                      2910
         L     @15,@PC00020+8                                      2910
         ST    @15,@AL00001+8                                      2910
         LA    @15,GPID                                            2910
         ST    @15,@AL00001+12                                     2910
         LA    @15,SETZERO                                         2910
         ST    @15,@AL00001+16                                     2910
         MVI   @AL00001+16,X'80'                                   2910
         L     @15,GDTGPL(,@04)                                    2910
         LA    @01,@AL00001                                        2910
         BALR  @14,@15                                             2910
*        RESPECIFY RTNREG RSTD;                                    2911
*        TESTRC = RTNREG;                                          2912
         STH   RTNREG,TESTRC                                       2912
*        RESPECIFY RTNREG UNRSTD;                                  2913
*        IF TESTRC ^= 0                                            2914
*          THEN                                                    2914
*                                                                  2914
         LH    @04,TESTRC                                          2914
         LTR   @04,@04                                             2914
         BZ    @RF02914                                            2914
*            /********************************************************/
*            /*                                                      */
*            /*  IF CORE IS NOT OBTAINED SUCCESSFULLY, RETURN TO     */
*            /*  CALLING PROCESSOR WITH FAILURE INDICATED            */
*            /*                                                      */
*            /********************************************************/
*                                                                  2915
*            DO;                                                   2915
*            DEFSTID = NOSTORAG;                                   2916
         MVI   DEFSTID,X'04'                                       2916
*            RETURN CODE(LASTCC12);                                2917
         LA    @15,12                                              2917
         L     @14,@SA00020                                        2917
         LM    @00,@12,@SA00020+8                                  2917
         BR    @14                                                 2917
*            END;                                                  2918
*                                                                  2918
*        DICTPTR = FDICT;                                          2919
@RF02914 L     @04,@PC00020                                        2919
         L     @04,FDICT(,@04)                                     2919
         ST    @04,DICTPTR                                         2919
*        FPLADDR = FPTRFVT + LENGTH(CTGFV);                        2920
*                                                                  2920
         L     @15,@PC00020+8                                      2920
         L     @15,FPTRFVT(,@15)                                   2920
         LA    @14,92                                              2920
         ALR   @14,@15                                             2920
         ST    @14,FPLADDR                                         2920
*        /************************************************************/
*        /*                                                          */
*        /*  SET TYPE FIELD IN FVT FROM CATALOG FIELD INFORMATION    */
*        /*                                                          */
*        /************************************************************/
*                                                                  2921
*        FIELDPTR = DICTDL(IENTYPE) + FWKA;                        2921
         L     @14,@PC00020+4                                      2921
         L     @14,FWKA(,@14)                                      2921
         L     @03,DICTDL(,@04)                                    2921
         ALR   @03,@14                                             2921
         ST    @03,FIELDPTR                                        2921
*        CTGFVTYP = FIELDPTR -> FENTYPE;                           2922
         MVC   CTGFVTYP(1,@15),FENTYPE(@03)                        2922
*        /*                                                  @Z40RSSA*/
*        /* SET CTGFVRON TO VALUE OF IMPORTED RAC INDICATOR  @Z40RSSA*/
*        /*                                                  @Z40RSSA*/
*                                                                  2923
*        IF DICTLN(ISECFLG) ^= NULLPTR THEN                        2923
         L     @03,DICTLN+248(,@04)                                2923
         LTR   @03,@03                                             2923
         BZ    @RF02923                                            2923
*          DO;                                             /*@Z40RSSA*/
*            FIELDPTR = DICTDL(ISECFLG) + FWKA;            /*@Z40RSSA*/
         AL    @14,DICTDL+248(,@04)                                2925
         ST    @14,FIELDPTR                                        2925
*            IF FIELDPTR -> RCDEXSEC = ON THEN                     2926
         TM    RCDEXSEC(@14),B'10000000'                           2926
         BNO   @RF02926                                            2926
*              CTGFVRON = ON;                              /*@Z40RSSA*/
         OI    CTGFVRON(@15),B'00001000'                           2927
*          END;                                            /*@Z40RSSA*/
*                                                                  2928
@RF02926 DS    0H                                                  2929
*        /************************************************************/
*        /*                                                          */
*        /*  SET ENTNAME FIELD POINTER IN FPL                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  2929
*        IF DICTLN(IENTNAME) ^= NULLPTR                            2929
*          THEN                                                    2929
@RF02923 L     @04,DICTPTR                                         2929
         L     @15,DICTLN+8(,@04)                                  2929
         LTR   @15,@15                                             2929
         BZ    @RF02929                                            2929
*            CTGFVENT = DICTDL(IENTNAME) + FWKA;                   2930
*                                                                  2930
         L     @15,@PC00020+8                                      2930
         L     @01,FPTRFVT(,@15)                                   2930
         L     @15,@PC00020+4                                      2930
         L     @04,DICTDL+8(,@04)                                  2930
         AL    @04,FWKA(,@15)                                      2930
         ST    @04,CTGFVENT(,@01)                                  2930
*        /************************************************************/
*        /*                                                          */
*        /*  TEST TO DETERMINE IF WE ARE BUILDING AN FVT             */
*        /*  FOR AN AIX OR A PATH                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  2931
*        IF CTGFVTYP = CTGTAIX × CTGFVTYP = CTGTPTH                2931
*          THEN                                                    2931
*                                                                  2931
@RF02929 L     @04,@PC00020+8                                      2931
         L     @04,FPTRFVT(,@04)                                   2931
         CLI   CTGFVTYP(@04),C'G'                                  2931
         BE    @RT02931                                            2931
         CLI   CTGFVTYP(@04),C'R'                                  2931
         BNE   @RF02931                                            2931
@RT02931 DS    0H                                                  2932
*            /********************************************************/
*            /*                                                      */
*            /*  BUILD AN FPL FOR RGATTR                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  2932
*            DO;                                                   2932
*            CALL BFPLPROC(ADDR(FIELDLST),IRGATTR,FPLADDR,         2933
*               FDICT,FWKA,CTGFVUPG);                              2933
*                                                                  2933
         LA    @04,FIELDLST                                        2933
         ST    @04,@AFTEMPS+32                                     2933
         LA    @04,@AFTEMPS+32                                     2933
         ST    @04,@AL00001                                        2933
         LA    @04,@CH01060                                        2933
         ST    @04,@AL00001+4                                      2933
         LA    @04,FPLADDR                                         2933
         ST    @04,@AL00001+8                                      2933
         L     @04,@PC00020                                        2933
         ST    @04,@AL00001+12                                     2933
         L     @04,@PC00020+4                                      2933
         ST    @04,@AL00001+16                                     2933
         L     @04,@PC00020+8                                      2933
         L     @04,FPTRFVT(,@04)                                   2933
         LA    @04,CTGFVUPG(,@04)                                  2933
         ST    @04,@AL00001+20                                     2933
         LA    @01,@AL00001                                        2933
         BAL   @14,BFPLPROC                                        2933
*            /********************************************************/
*            /*                                                      */
*            /*  DETERMINE IF AN FVT FOR AN AIX IS BEING             */
*            /*  BUILT.  IF SO, SET RELATED NAME VALUE.              */
*            /*                                                      */
*            /********************************************************/
*                                                                  2934
*            IF CTGFVTYP = CTGTAIX                                 2934
*              THEN                                                2934
         L     @04,@PC00020+8                                      2934
         L     @04,FPTRFVT(,@04)                                   2934
         CLI   CTGFVTYP(@04),C'G'                                  2934
         BNE   @RF02934                                            2934
*                CTGFVNAM = DICTDL(IRELNAM) + FWKA;                2935
         L     @15,@PC00020+4                                      2935
         L     @01,DICTPTR                                         2935
         L     @14,DICTDL+232(,@01)                                2935
         AL    @14,FWKA(,@15)                                      2935
         ST    @14,CTGFVNAM(,@04)                                  2935
*              ELSE                                                2936
*                                                                  2936
*                /****************************************************/
*                /*                                                  */
*                /*  OTHERWISE WE ARE CONSTRUCTING A PATH            */
*                /*  FVT.  PLACE THE APPROPRIATE PATHENTRY           */
*                /*  NAME AND PASSWORD IN THE FVT.                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  2936
*                DO;                                               2936
         B     @RC02934                                            2936
@RF02934 DS    0H                                                  2937
*                CTGFVNAM = FVTPTR(1) -> CTGFVENT;                 2937
         L     @04,@PC00020+8                                      2937
         L     @04,FPTRFVT(,@04)                                   2937
         L     @01,FVTPTR                                          2937
         L     @15,CTGFVENT(,@01)                                  2937
         ST    @15,CTGFVNAM(,@04)                                  2937
*                IF DICTDL(IPTHPASS) ^= 0                          2938
*                  THEN                                            2938
         L     @01,DICTPTR                                         2938
         L     @15,DICTDL+240(,@01)                                2938
         LTR   @15,@15                                             2938
         BZ    @RF02938                                            2938
*                    CTGFVPWD = DICTDL(IPTHPASS) + FWKA;           2939
         L     @14,@PC00020+4                                      2939
         AL    @15,FWKA(,@14)                                      2939
         ST    @15,CTGFVPWD(,@04)                                  2939
*                END;                                              2940
*                                                                  2940
@RF02938 DS    0H                                                  2941
*            END;                                                  2941
*                                                                  2941
@RC02934 DS    0H                                                  2942
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT PASSWALL FPL WHICH REFERENCES THE PASSWORD    */
*        /*  CATALOG FIELD, PLACE POINTER TO FPL IN FVT              */
*        /*  IF THE PASSWALL FIELD IS NOT CONSTRUCTED                */
*        /*  SUCCESSFULLY, RETURN TO THE CALLING                     */
*        /*  PROCESSOR WITH FAILURE INDICATED.                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  2942
*        CTGFVSTY = FPLADDR;                                       2942
@RF02931 L     @04,@PC00020+8                                      2942
         L     @04,FPTRFVT(,@04)                                   2942
         L     @15,FPLADDR                                         2942
         ST    @15,CTGFVSTY(,@04)                                  2942
*        CALL BPASPROC(FPLADDR,FDICT,FWKA);                        2943
         LA    @04,FPLADDR                                         2943
         ST    @04,@AL00001                                        2943
         L     @04,@PC00020                                        2943
         ST    @04,@AL00001+4                                      2943
         L     @04,@PC00020+4                                      2943
         ST    @04,@AL00001+8                                      2943
         LA    @01,@AL00001                                        2943
         BAL   @14,BPASPROC                                        2943
*        RESPECIFY RTNREG RSTD;                                    2944
*        TESTRC = RTNREG;                                          2945
         STH   RTNREG,TESTRC                                       2945
*        RESPECIFY RTNREG UNRSTD;                                  2946
*        IF TESTRC ^= 0                                            2947
*          THEN                                                    2947
         LH    @04,TESTRC                                          2947
         SLR   @15,@15                                             2947
         CR    @04,@15                                             2947
         BE    @RF02947                                            2947
*            DO;                                                   2948
*            IF TESTRC = 4                                         2949
*              THEN                                                2949
         C     @04,@CF00046                                        2949
         BNE   @RF02949                                            2949
*                CTGFVSTY = NULLPTR;                               2950
         L     @04,@PC00020+8                                      2950
         L     @04,FPTRFVT(,@04)                                   2950
         ST    @15,CTGFVSTY(,@04)                                  2950
*              ELSE                                                2951
*                RETURN CODE(LASTCC12);                            2951
         B     @RC02949                                            2951
@RF02949 LA    @15,12                                              2951
         L     @14,@SA00020                                        2951
         LM    @00,@12,@SA00020+8                                  2951
         BR    @14                                                 2951
*            END;                                                  2952
*                                                                  2952
@RC02949 DS    0H                                                  2953
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT OWNERID FPL WHICH REFERENCES THE OWNER OF     */
*        /*  DATA SET CATALOG FIELD, PLACE POINTER TO FPL IN FVT     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2953
*        CALL BFPLPROC(ADDR(FIELDLST),IOWNERID,                    2953
*            FPLADDR,FDICT,FWKA,CTGFVOWN);                         2953
*                                                                  2953
@RF02947 LA    @04,FIELDLST                                        2953
         ST    @04,@AFTEMPS+32                                     2953
         LA    @04,@AFTEMPS+32                                     2953
         ST    @04,@AL00001                                        2953
         LA    @04,@CH00046                                        2953
         ST    @04,@AL00001+4                                      2953
         LA    @04,FPLADDR                                         2953
         ST    @04,@AL00001+8                                      2953
         L     @04,@PC00020                                        2953
         ST    @04,@AL00001+12                                     2953
         L     @04,@PC00020+4                                      2953
         ST    @04,@AL00001+16                                     2953
         L     @04,@PC00020+8                                      2953
         L     @04,FPTRFVT(,@04)                                   2953
         LA    @04,CTGFVOWN(,@04)                                  2953
         ST    @04,@AL00001+20                                     2953
         LA    @01,@AL00001                                        2953
         BAL   @14,BFPLPROC                                        2953
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT DSETEXDT FPL WHICH REFERENCES                 */
*        /*  THE EXPIRATION DATE CATALOG FIELD, PLACE                */
*        /*  POINTER IN FVT                                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  2954
*        CALL BFPLPROC(ADDR(FIELDLST),IDSETEXD,                    2954
*           FPLADDR,FDICT,FWKA,CTGFVEXP);                          2954
*                                                                  2954
         LA    @04,FIELDLST                                        2954
         ST    @04,@AFTEMPS+32                                     2954
         LA    @04,@AFTEMPS+32                                     2954
         ST    @04,@AL00001                                        2954
         LA    @04,@CH00041                                        2954
         ST    @04,@AL00001+4                                      2954
         LA    @04,FPLADDR                                         2954
         ST    @04,@AL00001+8                                      2954
         L     @04,@PC00020                                        2954
         ST    @04,@AL00001+12                                     2954
         L     @04,@PC00020+4                                      2954
         ST    @04,@AL00001+16                                     2954
         L     @04,@PC00020+8                                      2954
         L     @04,FPTRFVT(,@04)                                   2954
         LA    @04,CTGFVEXP(,@04)                                  2954
         ST    @04,@AL00001+20                                     2954
         LA    @01,@AL00001                                        2954
         BAL   @14,BFPLPROC                                        2954
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT DSETCRDT FPL WHICH REFERENCES THE             */
*        /*  CREATION DATE CATALOG FIELD, PLACE                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2955
*        CALL BFPLPROC(ADDR(FIELDLST),IDSETCRD,                    2955
*           FPLADDR,FDICT,FWKA,CTGFVCRE);                          2955
*                                                                  2955
         LA    @04,FIELDLST                                        2955
         ST    @04,@AFTEMPS+32                                     2955
         LA    @04,@AFTEMPS+32                                     2955
         ST    @04,@AL00001                                        2955
         LA    @04,@CH00288                                        2955
         ST    @04,@AL00001+4                                      2955
         LA    @04,FPLADDR                                         2955
         ST    @04,@AL00001+8                                      2955
         L     @04,@PC00020                                        2955
         ST    @04,@AL00001+12                                     2955
         L     @04,@PC00020+4                                      2955
         ST    @04,@AL00001+16                                     2955
         L     @04,@PC00020+8                                      2955
         L     @04,FPTRFVT(,@04)                                   2955
         LA    @04,CTGFVCRE(,@04)                                  2955
         ST    @04,@AL00001+20                                     2955
         LA    @01,@AL00001                                        2955
         BAL   @14,BFPLPROC                                        2955
*        /************************************************************/
*        /*                                                          */
*        /*  IF THE TYPE IS PATH, OMIT BUILDING THE REST OF          */
*        /*  THE FPL'S.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  2956
*        IF CTGFVTYP ^= CTGTPTH                                    2956
*          THEN                                                    2956
         L     @04,@PC00020+8                                      2956
         L     @04,FPTRFVT(,@04)                                   2956
         CLI   CTGFVTYP(@04),C'R'                                  2956
         BE    @RF02956                                            2956
*NOPTH:      DO;                                                   2957
*                                                                  2957
NOPTH    DS    0H                                                  2958
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT SPACPARM FPL WHICH REFERENCES THE SPACE       */
*        /*  ALLOCATION CATALOG FIELD, PLACE FVT POINTER IN FPL      */
*        /*                                                          */
*        /************************************************************/
*                                                                  2958
*            CALL BFPLPROC(ADDR(FIELDLST),ISPACPAR,                2958
*                FPLADDR,FDICT,FWKA,CTGFVSPC);                     2958
*                                                                  2958
         LA    @04,FIELDLST                                        2958
         ST    @04,@AFTEMPS+32                                     2958
         LA    @04,@AFTEMPS+32                                     2958
         ST    @04,@AL00001                                        2958
         LA    @04,@CH00038                                        2958
         ST    @04,@AL00001+4                                      2958
         LA    @04,FPLADDR                                         2958
         ST    @04,@AL00001+8                                      2958
         L     @04,@PC00020                                        2958
         ST    @04,@AL00001+12                                     2958
         L     @04,@PC00020+4                                      2958
         ST    @04,@AL00001+16                                     2958
         L     @04,@PC00020+8                                      2958
         L     @04,FPTRFVT(,@04)                                   2958
         LA    @04,CTGFVSPC(,@04)                                  2958
         ST    @04,@AL00001+20                                     2958
         LA    @01,@AL00001                                        2958
         BAL   @14,BFPLPROC                                        2958
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT AMDSB FPL, PLACE POINTER IN FVT           */
*            /*                                                      */
*            /********************************************************/
*                                                                  2959
*            CALL BFPLPROC(ADDR(FIELDLST),IAMDSB,                  2959
*                FPLADDR,FDICT,FWKA,CTGFVAMD);                     2959
         LA    @04,FIELDLST                                        2959
         ST    @04,@AFTEMPS+32                                     2959
         LA    @04,@AFTEMPS+32                                     2959
         ST    @04,@AL00001                                        2959
         LA    @04,@CH00966                                        2959
         ST    @04,@AL00001+4                                      2959
         LA    @04,FPLADDR                                         2959
         ST    @04,@AL00001+8                                      2959
         L     @04,@PC00020                                        2959
         ST    @04,@AL00001+12                                     2959
         L     @04,@PC00020+4                                      2959
         ST    @04,@AL00001+16                                     2959
         L     @04,@PC00020+8                                      2959
         L     @04,FPTRFVT(,@04)                                   2959
         LA    @04,CTGFVAMD(,@04)                                  2959
         ST    @04,@AL00001+20                                     2959
         LA    @01,@AL00001                                        2959
         BAL   @14,BFPLPROC                                        2959
*            RESPECIFY IDAAMDSB BASED(DSCCATPT);                   2960
*            IF CTGFVAMD ^= NULLPTR                                2961
*              THEN                                                2961
*                                                                  2961
         L     @04,@PC00020+8                                      2961
         L     @04,FPTRFVT(,@04)                                   2961
         L     @15,CTGFVAMD(,@04)                                  2961
         LTR   @15,@15                                             2961
         BZ    @RF02961                                            2961
*                /****************************************************/
*                /*                                                  */
*                /*  IF AMDSBCAT INFORMATION EXISTS FOR THIS         */
*                /*  COMPONENT INITIALIZE THE AMDSBCAT               */
*                /*  INFORMATION FROM INFORMATION                    */
*                /*  IN THE DICTIONARY AND WORK AREA.                */
*                /*                                                  */
*                /****************************************************/
*                                                                  2962
*                DO;                                               2962
*                DSCCATPT = CTGFVAMD -> CTGFLPT(1);                2963
         L     @15,CTGFLPT(,@15)                                   2963
         ST    @15,DSCCATPT                                        2963
*                AMDLEN = LENGTH(IDAAMDSB);                        2964
         MVC   AMDLEN(2,@15),@CH01744                              2964
*                AMDATTR = (FWKA + DICTDL(IAMDSB)) -> AMDATTR;     2965
         L     @14,@PC00020+4                                      2965
         L     @14,FWKA(,@14)                                      2965
         L     @01,DICTPTR                                         2965
         AL    @14,DICTDL+136(,@01)                                2965
         MVC   AMDATTR(1,@15),AMDATTR(@14)                         2965
*                AMDRKP = (FWKA + DICTDL(IAMDSB)) -> AMDRKP;       2966
         LH    @03,AMDRKP(,@14)                                    2966
         STH   @03,AMDRKP(,@15)                                    2966
*                AMDKEYLN = (FWKA + DICTDL(IAMDSB)) -> AMDKEYLN;   2967
         LH    @03,AMDKEYLN(,@14)                                  2967
         STH   @03,AMDKEYLN(,@15)                                  2967
*                AMDCINV = (FWKA + DICTDL(IAMDSB))-> AMDCINV;      2968
         L     @03,AMDCINV(,@14)                                   2968
         ST    @03,AMDCINV(,@15)                                   2968
*                AMDLRECL = (FWKA + DICTDL(IAMDSB)) -> AMDLRECL;   2969
         L     @03,AMDLRECL(,@14)                                  2969
         ST    @03,AMDLRECL(,@15)                                  2969
*                AMDPCTCA = (FWKA + DICTDL(IAMDSB)) -> AMDPCTCA;   2970
         IC    @03,AMDPCTCA(,@14)                                  2970
         STC   @03,AMDPCTCA(,@15)                                  2970
*                AMDPCTCI = (FWKA + DICTDL(IAMDSB)) -> AMDPCTCI;   2971
         IC    @03,AMDPCTCI(,@14)                                  2971
         STC   @03,AMDPCTCI(,@15)                                  2971
*                AMDATTR3 = (FWKA + DICTDL(IAMDSB))->              2972
*                   AMDATTR3;                                      2972
*                                                                  2972
         MVC   AMDATTR3(1,@15),AMDATTR3(@14)                       2972
*                IF CTGFVTYP = CTGTDATA                            2973
*                  THEN                                            2973
         CLI   CTGFVTYP(@04),C'D'                                  2973
         BNE   @RF02973                                            2973
*                    AMDAXRKP = (FWKA + DICTDL(IAMDSB))->          2974
*                       AMDAXRKP;                                  2974
         LH    @04,AMDAXRKP(,@14)                                  2974
         STH   @04,AMDAXRKP(,@15)                                  2974
*                END;                                              2975
*                                                                  2975
@RF02973 DS    0H                                                  2976
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT DSATTR FPL WHICH REFERENCES DATA          */
*            /*  SET ATTRIBUTES CATALOG FIELD, PLACE POINTER         */
*            /*  IN FVT                                              */
*            /*                                                      */
*            /********************************************************/
*                                                                  2976
*            IF CTGFVTYP = CTGTINDX × CTGFVTYP = CTGTDATA          2976
*              THEN                                                2976
@RF02961 L     @04,@PC00020+8                                      2976
         L     @04,FPTRFVT(,@04)                                   2976
         CLI   CTGFVTYP(@04),C'I'                                  2976
         BE    @RT02976                                            2976
         CLI   CTGFVTYP(@04),C'D'                                  2976
         BNE   @RF02976                                            2976
@RT02976 DS    0H                                                  2977
*                CALL BFPLPROC(ADDR(FIELDLST),IDSATTR,             2977
*                   FPLADDR,FDICT,FWKA,CTGFVATR);                  2977
*                                                                  2977
         LA    @04,FIELDLST                                        2977
         ST    @04,@AFTEMPS+32                                     2977
         LA    @04,@AFTEMPS+32                                     2977
         ST    @04,@AL00001                                        2977
         LA    @04,@CH00165                                        2977
         ST    @04,@AL00001+4                                      2977
         LA    @04,FPLADDR                                         2977
         ST    @04,@AL00001+8                                      2977
         L     @04,@PC00020                                        2977
         ST    @04,@AL00001+12                                     2977
         L     @04,@PC00020+4                                      2977
         ST    @04,@AL00001+16                                     2977
         L     @04,@PC00020+8                                      2977
         L     @04,FPTRFVT(,@04)                                   2977
         LA    @04,CTGFVATR(,@04)                                  2977
         ST    @04,@AL00001+20                                     2977
         LA    @01,@AL00001                                        2977
         BAL   @14,BFPLPROC                                        2977
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT EXCEPTION EXIT FPL, PLACE POINTER         */
*            /*  IN THE FVT.                                         */
*            /*                                                      */
*            /********************************************************/
*                                                                  2978
*            CALL BFPLPROC(ADDR(FIELDLST),IEXCPXIT,                2978
*               FPLADDR,FDICT,FWKA,CTGFVEXT);                      2978
*                                                                  2978
@RF02976 LA    @04,FIELDLST                                        2978
         ST    @04,@AFTEMPS+32                                     2978
         LA    @04,@AFTEMPS+32                                     2978
         ST    @04,@AL00001                                        2978
         LA    @04,@CH00977                                        2978
         ST    @04,@AL00001+4                                      2978
         LA    @04,FPLADDR                                         2978
         ST    @04,@AL00001+8                                      2978
         L     @04,@PC00020                                        2978
         ST    @04,@AL00001+12                                     2978
         L     @04,@PC00020+4                                      2978
         ST    @04,@AL00001+16                                     2978
         L     @04,@PC00020+8                                      2978
         L     @04,FPTRFVT(,@04)                                   2978
         LA    @04,CTGFVEXT(,@04)                                  2978
         ST    @04,@AL00001+20                                     2978
         LA    @01,@AL00001                                        2978
         BAL   @14,BFPLPROC                                        2978
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT BUFSIZE FPL, PLACE POINTER IN FVT         */
*            /*                                                      */
*            /********************************************************/
*                                                                  2979
*            IF CTGFVTYP ^= CTGFVIDX                               2979
*              THEN                                                2979
         L     @04,@PC00020+8                                      2979
         L     @04,FPTRFVT(,@04)                                   2979
         CLI   CTGFVTYP(@04),C'I'                                  2979
         BE    @RF02979                                            2979
*                CALL BFPLPROC(ADDR(FIELDLST),IBUFSIZE,            2980
*                   FPLADDR,FDICT,FWKA,CTGFVBUF);                  2980
*                                                                  2980
         LA    @15,FIELDLST                                        2980
         ST    @15,@AFTEMPS+32                                     2980
         LA    @15,@AFTEMPS+32                                     2980
         ST    @15,@AL00001                                        2980
         LA    @15,@CH00040                                        2980
         ST    @15,@AL00001+4                                      2980
         LA    @15,FPLADDR                                         2980
         ST    @15,@AL00001+8                                      2980
         L     @15,@PC00020                                        2980
         ST    @15,@AL00001+12                                     2980
         L     @15,@PC00020+4                                      2980
         ST    @15,@AL00001+16                                     2980
         LA    @04,CTGFVBUF(,@04)                                  2980
         ST    @04,@AL00001+20                                     2980
         LA    @01,@AL00001                                        2980
         BAL   @14,BFPLPROC                                        2980
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT LRECL FPL AND PLACE POINTER IN FVT        */
*            /*                                                      */
*            /********************************************************/
*                                                                  2981
*            IF CTGFVTYP ^= CTGFVIDX                               2981
*              THEN                                                2981
@RF02979 L     @04,@PC00020+8                                      2981
         L     @04,FPTRFVT(,@04)                                   2981
         CLI   CTGFVTYP(@04),C'I'                                  2981
         BE    @RF02981                                            2981
*                CALL BFPLPROC(ADDR(FIELDLST),ILRECL,              2982
*                   FPLADDR,FDICT,FWKA,CTGFVLRS);                  2982
*                                                                  2982
         LA    @15,FIELDLST                                        2982
         ST    @15,@AFTEMPS+32                                     2982
         LA    @15,@AFTEMPS+32                                     2982
         ST    @15,@AL00001                                        2982
         LA    @15,@CH00039                                        2982
         ST    @15,@AL00001+4                                      2982
         LA    @15,FPLADDR                                         2982
         ST    @15,@AL00001+8                                      2982
         L     @15,@PC00020                                        2982
         ST    @15,@AL00001+12                                     2982
         L     @15,@PC00020+4                                      2982
         ST    @15,@AL00001+16                                     2982
         LA    @04,CTGFVLRS(,@04)                                  2982
         ST    @04,@AL00001+20                                     2982
         LA    @01,@AL00001                                        2982
         BAL   @14,BFPLPROC                                        2982
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT KEY RANGES LIST IF HIKEYV, LOKEYV         */
*            /*  FIELDS WERE LOCATED AT EXPORT TIME                  */
*            /*  IF RANGPROC DOES NOT CONSTRUCT THE LIST             */
*            /*  SUCCESSFULLY, INDICATE AN ERROR AND RETURN          */
*            /*  TO CALLING PROCESSOR.                               */
*            /*                                                      */
*            /********************************************************/
*                                                                  2983
*            CALL RANGPROC(0,FDICT,FWKA,CTGFVRNG);                 2983
@RF02981 LA    @04,@CF00119                                        2983
         ST    @04,@AL00001                                        2983
         L     @04,@PC00020                                        2983
         ST    @04,@AL00001+4                                      2983
         L     @04,@PC00020+4                                      2983
         ST    @04,@AL00001+8                                      2983
         L     @04,@PC00020+8                                      2983
         L     @04,FPTRFVT(,@04)                                   2983
         LA    @04,CTGFVRNG(,@04)                                  2983
         ST    @04,@AL00001+12                                     2983
         LA    @01,@AL00001                                        2983
         BAL   @14,RANGPROC                                        2983
*            RESPECIFY RTNREG RSTD;                                2984
*            TESTRC = RTNREG;                                      2985
         STH   RTNREG,TESTRC                                       2985
*            RESPECIFY RTNREG UNRSTD;                              2986
*            IF TESTRC ^= 0                                        2987
*              THEN                                                2987
         LH    @04,TESTRC                                          2987
         LTR   @04,@04                                             2987
         BZ    @RF02987                                            2987
*                RETURN CODE(LASTCC12);                            2988
*                                                                  2988
         LA    @15,12                                              2988
         L     @14,@SA00020                                        2988
         LM    @00,@12,@SA00020+8                                  2988
         BR    @14                                                 2988
*        /************************************************************/
*        /*                                                          */
*        /*  CONSTRUCT LIST OF VOLUME SERIALS IF THE VOLUME SERIAL   */
*        /*  NUMBER WERE EXPORTED (ON A TEMPORARY EXPORT) AND IF     */
*        /*  THE VOLUMES PARAMETER WAS NOT SPECIFIED ON THE IMPORT   */
*        /*  COMMAND. LVLRPROC WILL CHECK TO SEE IF THE VOLUMES LIST */
*        /*  WAS PASSED ON THE PORTABLE DATA SET.  IF SO, THE VOLUME */
*        /*  SERIAL LIST WILL BE CONSTRUCTED FOR DEFINE.             */
*        /*                                                          */
*        /************************************************************/
*                                                                  2989
*            CALL LVLRPROC(0,FDICT,FWKA,FPTRFVT,CTGFVTYP);         2989
*                                                                  2989
@RF02987 LA    @04,@CF00119                                        2989
         ST    @04,@AL00001                                        2989
         L     @04,@PC00020                                        2989
         ST    @04,@AL00001+4                                      2989
         L     @04,@PC00020+4                                      2989
         ST    @04,@AL00001+8                                      2989
         L     @04,@PC00020+8                                      2989
         ST    @04,@AL00001+12                                     2989
         L     @04,FPTRFVT(,@04)                                   2989
         ST    @04,@AL00001+16                                     2989
         LA    @01,@AL00001                                        2989
         BAL   @14,LVLRPROC                                        2989
*            RESPECIFY RTNREG RSTD;                                2990
*            TESTRC = RTNREG;                                      2991
         STH   RTNREG,TESTRC                                       2991
*            RESPECIFY RTNREG UNRSTD;                              2992
*                                                                  2992
*            /********************************************************/
*            /*                                                      */
*            /*  IF UNSUCCESSFUL, RETURN TO CALLER                   */
*            /*                                                      */
*            /********************************************************/
*                                                                  2993
*            IF TESTRC ^= 0                                        2993
*              THEN                                                2993
         LH    @04,TESTRC                                          2993
         LTR   @04,@04                                             2993
         BZ    @RF02993                                            2993
*                RETURN CODE(LASTCC12);                            2994
*                                                                  2994
         LA    @15,12                                              2994
         L     @14,@SA00020                                        2994
         LM    @00,@12,@SA00020+8                                  2994
         BR    @14                                                 2994
*            END NOPTH;                                            2995
*                                                                  2995
@RF02993 DS    0H                                                  2996
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  2996
*        RETURN CODE(0);                                           2996
@RF02956 SLR   @15,@15                                             2996
         L     @14,@SA00020                                        2996
         LM    @00,@12,@SA00020+8                                  2996
         BR    @14                                                 2996
*END FVTPROC;                                                      2997
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - BPASPROC                               */
*        /*                                                          */
*        /*  FUNCTION - CONSTRUCT PASSWALL FPL, MOVE FIELD           */
*        /*  INFORMATION FROM PASSWORD, PASSPRMT, PASSATM, USERAREA  */
*        /*  AND USVRMDUL FIELDS INTO PASSWALL COMBINATION FIELD     */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .BFPL - FPL POINTER                                   */
*        /*    .BDICT - POINTER TO DICTIONARY REFERENCING CATALOG    */
*        /*      FIELD INFORMATION WITHIN THE WORK AREA              */
*        /*    .BWKA - WORK AREA CONTAINING CATALOG FIELD INFORMATION*/
*        /*                                                          */
*        /*  OUTPUT - PASSWALL FPL, AND PASSWALL COMBINATION FIELD   */
*        /*                                                          */
*        /************************************************************/
*                                                                  2998
*BPASPROC: PROCEDURE(BFPL,             /*POINTER TO FPL              */
*                    BDICT,            /*DICTIONARY POINTER          */
*                    BWKA);            /*WORK AREA POINTER           */
*                                                                  2998
BPASPROC STM   @14,@12,@SA00021                                    2998
         MVC   @PC00021(12),0(@01)                                 2998
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  2999
*        DCL BFPL   PTR(31),                                       2999
*            BDICT  PTR(31),                                       2999
*            BWKA   PTR(31);                                       2999
*                                                                  2999
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  3000
*        DCL DICENPTR PTR(31);                                     3000
*        DCL FIELDPS  CHAR(*) BASED(DICENPTR);                     3001
*        DCL NOFIND   CONSTANT(4);                                 3002
*                                                                  3002
*        /************************************************************/
*        /*                                                          */
*        /*  CHECK TO BE SURE PASSWORD INFORMATION WAS SPECIFIED.    */
*        /*  IF IT WAS FILL IN FPL FIELDS FOR PASSSWALL FIELD        */
*        /*                                                          */
*        /************************************************************/
*                                                                  3003
*        OLDERID2 = NEWERID2;                                      3003
         L     @04,@PC00001                                        3003
         L     @15,GDTTR2(,@04)                                    3003
         MVC   @TS00001(95),NEWERID2(@15)                          3003
         MVC   OLDERID2(95,@15),@TS00001                           3003
*        NEWID2 = 'RMPS';                                          3004
         MVC   NEWID2(4,@15),@CC01727                              3004
*        DICTPTR = BDICT;                                          3005
         L     @15,@PC00021+4                                      3005
         L     @15,BDICT(,@15)                                     3005
         ST    @15,DICTPTR                                         3005
*        IF DICTLN(IPASSWOR) ^= 0                                  3006
*          THEN                                                    3006
         L     @14,DICTLN+72(,@15)                                 3006
         LTR   @14,@14                                             3006
         BZ    @RF03006                                            3006
*            DO;                                                   3007
*            CTGFLPTR = BFPL;                                      3008
         L     @14,@PC00021                                        3008
         L     @14,BFPL(,@14)                                      3008
         ST    @14,CTGFLPTR                                        3008
*            CTGFLDNO = '00000001'B;                               3009
         MVI   CTGFLDNO(@14),X'01'                                 3009
*            CTGFLDNM = ADDR(FPASNAME);                            3010
         LA    @03,FPASNAME                                        3010
         ST    @03,CTGFLDNM(,@14)                                  3010
*            CTGFLNG(1) = LENGTH(FPASSWAL) + DICTLN(IUSRAREC);     3011
*                                                                  3011
         LA    @03,52                                              3011
         AL    @03,DICTLN+104(,@15)                                3011
         ST    @03,CTGFLNG(,@14)                                   3011
*            /********************************************************/
*            /*                                                      */
*            /*  GET CORE TO CONTAIN FIELD INFORMATION               */
*            /*  IF CORE IS NOT OBTAINED, RETURN TO CALLING PROCESSOR*/
*            /*                                                      */
*            /********************************************************/
*                                                                  3012
*            CALL IDCSAGP0(GDTTBL,CTGFLNG(1),CTGFLPT(1),GPID,SETZERO);
*                                                                  3012
         ST    @04,@AL00001                                        3012
         LA    @15,CTGFLNG(,@14)                                   3012
         ST    @15,@AL00001+4                                      3012
         LA    @15,CTGFLPT(,@14)                                   3012
         ST    @15,@AL00001+8                                      3012
         LA    @15,GPID                                            3012
         ST    @15,@AL00001+12                                     3012
         LA    @15,SETZERO                                         3012
         ST    @15,@AL00001+16                                     3012
         MVI   @AL00001+16,X'80'                                   3012
         L     @15,GDTGPL(,@04)                                    3012
         LA    @01,@AL00001                                        3012
         BALR  @14,@15                                             3012
*            RESPECIFY RTNREG RSTD;                                3013
*            TESTRC = RTNREG;                                      3014
         STH   RTNREG,TESTRC                                       3014
*            RESPECIFY RTNREG UNRSTD;                              3015
*            IF TESTRC ^= 0                                        3016
*              THEN                                                3016
         LH    @04,TESTRC                                          3016
         LTR   @04,@04                                             3016
         BZ    @RF03016                                            3016
*                DO;                                               3017
*                DEFSTID = NOSTORAG;                               3018
         MVI   DEFSTID,X'04'                                       3018
*                DARGSMOD = UNIVMSG;                               3019
         L     @04,DDSTRU                                          3019
         MVC   DARGSMOD(3,@04),@CC00981                            3019
*                RETURN CODE(LASTCC12);                            3020
         LA    @15,12                                              3020
         L     @14,@SA00021                                        3020
         LM    @00,@12,@SA00021+8                                  3020
         BR    @14                                                 3020
*                END;                                              3021
*                                                                  3021
*            /********************************************************/
*            /*                                                      */
*            /*  INITIALIZE PASSWORD PORTION OF PASSWALL COMBINATION */
*            /*  FIELD TO FF'S                                       */
*            /*                                                      */
*            /********************************************************/
*                                                                  3022
*            DO J = 1 TO LENGTH(FPASSWAL);                         3022
@RF03016 LA    @04,1                                               3022
         ST    @04,J                                               3022
@DL03022 DS    0H                                                  3023
*              FPASSWAL(J) = 'FF'X;                                3023
         L     @01,CTGFLPTR                                        3023
         L     @01,CTGFLPT(,@01)                                   3023
         ALR   @01,@04                                             3023
         BCTR  @01,0                                               3023
         MVI   FPASSWAL(@01),X'FF'                                 3023
*            END;                                                  3024
*                                                                  3024
         AL    @04,@CF00221                                        3024
         ST    @04,J                                               3024
         C     @04,@CF01741                                        3024
         BNH   @DL03022                                            3024
*            FUSERLN = 0;                                          3025
*                                                                  3025
         SLR   @04,@04                                             3025
         L     @01,CTGFLPTR                                        3025
         L     @15,CTGFLPT(,@01)                                   3025
         STH   @04,FUSERLN(,@15)                                   3025
*            DICENPTR = DICTDL(IPASSWOR) + BWKA;                   3026
*                                                                  3026
         L     @14,DICTPTR                                         3026
         L     @03,@PC00021+8                                      3026
         L     @02,DICTDL+72(,@14)                                 3026
         AL    @02,BWKA(,@03)                                      3026
         ST    @02,DICENPTR                                        3026
*            /********************************************************/
*            /*                                                      */
*            /*  CONSTRUCT PASSWALL COMBINATION CATALOG FIELD FROM   */
*            /*  ALL SUPPLIED INFORMATION IN WORK AREA.  FIELDS WILL */
*            /*  BE LEFT ZERO WHEN NO INFORMATION HAS BEEN SUPPLIED  */
*            /*  FOR THAT ENTRY                                      */
*            /*                                                      */
*            /********************************************************/
*                                                                  3027
*            IF DICTLN(IPASSWOR) ^= 0                              3027
*              THEN                                                3027
         L     @14,DICTLN+72(,@14)                                 3027
         CR    @14,@04                                             3027
         BE    @RF03027                                            3027
*                FPASWD(1:DICTLN(IPASSWOR)) =                      3028
*                  FIELDPS(1:DICTLN(IPASSWOR));                    3028
*                                                                  3028
         BCTR  @14,0                                               3028
         EX    @14,@SM01809                                        3028
*            DICENPTR = DICTDL(IPASSPRM) + BWKA;                   3029
@RF03027 L     @04,DICTPTR                                         3029
         L     @15,@PC00021+8                                      3029
         L     @14,DICTDL+80(,@04)                                 3029
         AL    @14,BWKA(,@15)                                      3029
         ST    @14,DICENPTR                                        3029
*            IF DICTLN(IPASSPRM) ^= 0                              3030
*              THEN                                                3030
         L     @04,DICTLN+80(,@04)                                 3030
         LTR   @04,@04                                             3030
         BZ    @RF03030                                            3030
*                FPASSPRM(1:DICTLN(IPASSPRM)) =                    3031
*                  FIELDPS(1:DICTLN(IPASSPRM));                    3031
*                                                                  3031
         L     @01,CTGFLPTR                                        3031
         L     @01,CTGFLPT(,@01)                                   3031
         BCTR  @04,0                                               3031
         EX    @04,@SM01811                                        3031
*            DICENPTR = DICTDL(IPASSATM) + BWKA;                   3032
@RF03030 L     @04,DICTPTR                                         3032
         L     @15,DICTDL+88(,@04)                                 3032
         L     @14,@PC00021+8                                      3032
         LR    @03,@15                                             3032
         AL    @03,BWKA(,@14)                                      3032
         ST    @03,DICENPTR                                        3032
*            IF DICTDL(IPASSATM) ^= 0                              3033
*              THEN                                                3033
         LTR   @15,@15                                             3033
         BZ    @RF03033                                            3033
*                FPASSATM(1:DICTLN(IPASSATM)) =                    3034
*                  FIELDPS(1:DICTLN(IPASSATM));                    3034
*                                                                  3034
         L     @01,CTGFLPTR                                        3034
         L     @01,CTGFLPT(,@01)                                   3034
         L     @04,DICTLN+88(,@04)                                 3034
         BCTR  @04,0                                               3034
         EX    @04,@SM01813                                        3034
*            DICENPTR = DICTDL(IUSVRMDU) + BWKA;                   3035
@RF03033 L     @04,DICTPTR                                         3035
         L     @15,@PC00021+8                                      3035
         L     @14,DICTDL+96(,@04)                                 3035
         AL    @14,BWKA(,@15)                                      3035
         ST    @14,DICENPTR                                        3035
*            IF DICTLN(IUSVRMDU) ^= 0                              3036
*              THEN                                                3036
         L     @04,DICTLN+96(,@04)                                 3036
         LTR   @04,@04                                             3036
         BZ    @RF03036                                            3036
*                FUSVRMDU(1:DICTLN(IUSVRMDU)) =                    3037
*                  FIELDPS(1:DICTDL(IUSVRMDU));                    3037
*                                                                  3037
         L     @01,CTGFLPTR                                        3037
         L     @01,CTGFLPT(,@01)                                   3037
         BCTR  @04,0                                               3037
         EX    @04,@SM01815                                        3037
*            DICENPTR = DICTDL(IUSRAREC) + BWKA;                   3038
@RF03036 L     @04,DICTPTR                                         3038
         L     @15,@PC00021+8                                      3038
         L     @14,DICTDL+104(,@04)                                3038
         AL    @14,BWKA(,@15)                                      3038
         ST    @14,DICENPTR                                        3038
*            IF DICTLN(IUSRAREC) ^= 0                              3039
*              THEN                                                3039
         L     @04,DICTLN+104(,@04)                                3039
         LTR   @04,@04                                             3039
         BZ    @RF03039                                            3039
*                FUSERARE(1:DICTLN(IUSRAREC)) =                    3040
*                  FIELDPS(1:DICTLN(IUSRAREC));                    3040
         L     @01,CTGFLPTR                                        3040
         L     @01,CTGFLPT(,@01)                                   3040
         BCTR  @04,0                                               3040
         EX    @04,@SM01817                                        3040
*            END;                                                  3041
*                                                                  3041
*          /**********************************************************/
*          /*                                                        */
*          /*  PASSWORD FIELD IS ZERO, THEREFORE DON'T BUILD FPL     */
*          /*  OR FIELD                                              */
*          /*                                                        */
*          /**********************************************************/
*                                                                  3042
*          ELSE                                                    3042
*            RETURN CODE(NOFIND);                                  3042
*                                                                  3042
*                                                                  3042
         B     @RC03006                                            3042
@RF03006 LA    @15,4                                               3042
         L     @14,@SA00021                                        3042
         LM    @00,@12,@SA00021+8                                  3042
         BR    @14                                                 3042
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  3043
*        BFPL = BFPL + LENGTH(CTGFL) + 8;                          3043
*                                                                  3043
@RC03006 L     @04,@PC00021                                        3043
         LA    @15,24                                              3043
         AL    @15,BFPL(,@04)                                      3043
         ST    @15,BFPL(,@04)                                      3043
*        RETURN CODE(0);                                           3044
         SLR   @15,@15                                             3044
         L     @14,@SA00021                                        3044
         LM    @00,@12,@SA00021+8                                  3044
         BR    @14                                                 3044
*END BPASPROC;                                                     3045
*        /************************************************************/
*        /*                                                          */
*        /*  PROCEDURE NAME - GETPROC                                */
*        /*                                                          */
*        /*  FUNCTION - GET A DATA RECORD AND PLACE IT INTO A        */
*        /*  SUPPLIED BUFFER, RECONSTRUCTING THE ORIGINAL RECORD     */
*        /*  IF IT HAS BEEN SEGMENTED INTO SEVERAL RECORDS           */
*        /*                                                          */
*        /*  INPUT -                                                 */
*        /*    .GINVBUF - ADDR OF SUPPLIED BUFFER TO CONTAIN RECORD  */
*        /*    .GLENGTH - LENGTH OF ENTIRE RECORD                    */
*        /*                                                          */
*        /*  OUTPUT - A BUFFER CONTAINING THE ENTIRE RECORD          */
*        /*                                                          */
*        /************************************************************/
*                                                                  3046
*GETPROC: PROCEDURE (GINVBUF,          /*BUFFER TO CONTAIN RECORD    */
*                    GLENGTH);         /*LENGTH OF RECORD            */
*                                                                  3046
GETPROC  STM   @14,@12,@SA00022                                    3046
         MVC   @PC00022(8),0(@01)                                  3046
*        /************************************************************/
*        /*                                                          */
*        /*  ARGUMENTS OF INVOCATION                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  3047
*        DCL GINVBUF  PTR(31),                                     3047
*            GLENGTH  FIXED(15);                                   3047
*                                                                  3047
*        /************************************************************/
*        /*                                                          */
*        /*  LOCAL DECLARATIONS                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  3048
*        DCL GDOCNTRL BIT(1);                                      3048
*        DCL GMLEN  FIXED(15);                                     3049
*        DCL RDBUF PTR(31);            /*POINTER TO BUFFER POSITION  */
*                                      /*INTO WHICH DATA TO BE MOVED */
*        DCL RDLEN FIXED(15);          /*LENGTH OF DATA YET TO BE    */
*                                      /*READ                        */
*                                                                  3052
*        /************************************************************/
*        /*                                                          */
*        /*  ISSUE UGETS UNTIL ENTIRE RECORD HAS BEEN READ INTO CORE */
*        /*                                                          */
*        /************************************************************/
*                                                                  3052
*        RDBUF = GINVBUF;                                          3052
         L     @04,@PC00022                                        3052
         L     @04,GINVBUF(,@04)                                   3052
         ST    @04,RDBUF                                           3052
*        RDLEN= GLENGTH;                                           3053
         L     @04,@PC00022+4                                      3053
         LH    @04,GLENGTH(,@04)                                   3053
         STH   @04,RDLEN                                           3053
*        GDOCNTRL = ON;                                            3054
*                                                                  3054
         OI    GDOCNTRL,B'10000000'                                3054
*READLOOP: DO WHILE (GDOCNTRL = ON);                               3055
READLOOP B     @DE03055                                            3055
@DL03055 DS    0H                                                  3056
*            IOCSPTR = PINIOCS;                                    3056
*                                                                  3056
         L     @04,PINIOCS                                         3056
         ST    @04,IOCSPTR                                         3056
*            CALL IDCIOGT0(GDTTBL,PINIOCS);                        3057
*                                                                  3057
         L     @04,@PC00001                                        3057
         ST    @04,@AL00001                                        3057
         LA    @15,PINIOCS                                         3057
         ST    @15,@AL00001+4                                      3057
         MVI   @AL00001+4,X'80'                                    3057
         L     @15,GDTGET(,@04)                                    3057
         LA    @01,@AL00001                                        3057
         BALR  @14,@15                                             3057
*            RESPECIFY RTNREG RSTD;                                3058
*            TESTRC = RTNREG;                                      3059
         STH   RTNREG,TESTRC                                       3059
*            RESPECIFY RTNREG UNRSTD;                              3060
*            IF TESTRC ^= 0                                        3061
*              THEN                                                3061
*                                                                  3061
         LH    @04,TESTRC                                          3061
         LTR   @04,@04                                             3061
         BZ    @RF03061                                            3061
*              /******************************************************/
*              /*                                                    */
*              /*  IF AN ERROR OR END OF DATA CONDITION IS           */
*              /*  RETURN TO THE CALLING PROCESSOR                   */
*              /*                                                    */
*              /******************************************************/
*                                                                  3062
*                IF TESTRC = 16                                    3062
*                  THEN                                            3062
         LA    @15,16                                              3062
         CR    @04,@15                                             3062
         BNE   @RF03062                                            3062
*                    RETURN CODE(16);                              3063
         L     @14,@SA00022                                        3063
         LM    @00,@12,@SA00022+8                                  3063
         BR    @14                                                 3063
*                  ELSE                                            3064
*                    RETURN CODE(LASTCC12);                        3064
@RF03062 LA    @15,12                                              3064
         L     @14,@SA00022                                        3064
         LM    @00,@12,@SA00022+8                                  3064
         BR    @14                                                 3064
*              ELSE;                                               3065
*                                                                  3065
@RF03061 DS    0H                                                  3066
*          /**********************************************************/
*          /*                                                        */
*          /*  MOVE DATA JUST READ IN INTO BUFFER                    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  3066
*          GMLEN = IOCDLN;                                         3066
*                                                                  3066
         L     @04,IOCSPTR                                         3066
         L     @15,IOCDLN(,@04)                                    3066
         STH   @15,GMLEN                                           3066
*          CALL MVDAPROC(GMLEN,IOCDAD,RDBUF);                      3067
*                                                                  3067
         LA    @15,GMLEN                                           3067
         ST    @15,@AL00001                                        3067
         ST    @04,@AL00001+4                                      3067
         LA    @04,RDBUF                                           3067
         ST    @04,@AL00001+8                                      3067
         LA    @01,@AL00001                                        3067
         BAL   @14,MVDAPROC                                        3067
*        /************************************************************/
*        /*                                                          */
*        /*  DETERMINE IF ALL RECORD SEGMENTS HAVE BEEN READ IN.     */
*        /*  IF SO, EXIT FROM LOOP.  IF NOT ADJUST LENGTH AND        */
*        /*  AND CONTINUE GETTING RECORDS.                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  3068
*          IF IOCDLN < RDLEN                                       3068
*            THEN                                                  3068
         LH    @04,RDLEN                                           3068
         L     @01,IOCSPTR                                         3068
         L     @15,IOCDLN(,@01)                                    3068
         CR    @15,@04                                             3068
         BNL   @RF03068                                            3068
*              DO;                                                 3069
*              RDLEN = RDLEN - IOCDLN;                             3070
         SLR   @04,@15                                             3070
         STH   @04,RDLEN                                           3070
*              RDBUF = RDBUF + IOCDLN;                             3071
         AL    @15,RDBUF                                           3071
         ST    @15,RDBUF                                           3071
*              END;                                                3072
*            ELSE                                                  3073
*              GDOCNTRL = OFF;                                     3073
         B     @RC03068                                            3073
@RF03068 NI    GDOCNTRL,B'01111111'                                3073
*        END READLOOP;                                             3074
*                                                                  3074
@RC03068 DS    0H                                                  3074
@DE03055 TM    GDOCNTRL,B'10000000'                                3074
         BO    @DL03055                                            3074
*        /************************************************************/
*        /*                                                          */
*        /*  RETURN TO CALLER, INDICATING SUCCESSFUL COMPLETION.     */
*        /*                                                          */
*        /************************************************************/
*                                                                  3075
*        RETURN CODE(0);                                           3075
         SLR   @15,@15                                             3075
         L     @14,@SA00022                                        3075
         LM    @00,@12,@SA00022+8                                  3075
         BR    @14                                                 3075
*END GETPROC;                                                      3076
*END IDCRM01                                                       3077
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (AMSDF01 )                                        *
*/*%INCLUDE SYSLIB  (AMSDF00 )                                        *
*/*@INCLUDE SYSLIB  (AMSDF02 )                                        *
*/*%INCLUDE SYSLIB  (IDCCSRM )                                        *
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                        *
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                        *
*/*%INCLUDE SYSLIB  (IEZCTGFV)                                        *
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                        *
*;                                                                 3077
@DATA    DS    0H
@CH00288 DC    H'5'
@CH00040 DC    H'7'
@CH00038 DC    H'9'
@CH00037 DC    H'10'
@CH01063 DC    H'23'
@CH00977 DC    H'28'
@CH01060 DC    H'29'
@CH00605 DC    H'44'
@CH01385 DC    H'49'
@CH01744 DC    H'96'
@CH01133 DC    H'110'
@CH01139 DC    H'140'
@CH00920 DC    H'268'
@CH01749 DC    H'544'
@SM01777 MVC   ZAREA(0,@04),ZER
@SM01780 MVC   FLISTVOL(0,@01),FLISTVOL(@14)
@SM01784 MVC   FIELDR(0,@01),SAVCPL
@SM01799 MVC   FKEY(0,@04),FIELDR(@01)
@SM01801 MVC   FKEY(0,@04),FIELDR(@15)
@SM01807 MVC   TOAREA(0,@04),FROMAREA(@01)
@SM01809 MVC   FPASWD(0,@15),FIELDPS(@02)
@SM01811 MVC   FPASSPRM(0,@01),FIELDPS(@14)
@SM01813 MVC   FPASSATM(0,@01),FIELDPS(@03)
@SM01815 MVC   FUSVRMDU(0,@01),FIELDPS(@14)
@SM01817 MVC   FUSERARE(0,@01),FIELDPS(@14)
         DS    0F
@AL00691 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL01006 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL01319 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL01517 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL01742 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL01855 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL02776 DC    A(@CC00767)             LIST WITH   1 ARGUMENT(S)
@AL00986 EQU   *                       LIST WITH   3 ARGUMENT(S)
@AL02319 DC    A(@CC00751)             LIST WITH   3 ARGUMENT(S)
@AL01578 DC    A(NULLPARM)             LIST WITH   4 ARGUMENT(S)
@AL01374 DC    A(NULLPARM)             LIST WITH   4 ARGUMENT(S)
         DC    A(NULLPARM)
@AL01269 DC    A(@CC00755)             LIST WITH   5 ARGUMENT(S)
         DC    A(@CC00757)
         DC    A(NULLPARM)
         DC    A(NULLPARM)
         DC    A(NULLPARM)
@AL02787 EQU   *                       LIST WITH   5 ARGUMENT(S)
@AL02788 DC    A(@CC01650)             LIST WITH   5 ARGUMENT(S)
@AL02797 EQU   *                       LIST WITH   1 ARGUMENT(S)
@AL02820 EQU   *                       LIST WITH   1 ARGUMENT(S)
@AL02845 EQU   *                       LIST WITH   1 ARGUMENT(S)
@AL02861 DC    A(@CC01681)             LIST WITH   1 ARGUMENT(S)
         DC    A(NULLPARM)
         DC    A(@CF00119)
         DC    A(@CF00119)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    3F
@SA00016 DS    15F
@PC00016 DS    6F
@SA00007 DS    15F
@SA00010 DS    15F
@SA00006 DS    15F
@SA00002 DS    15F
@SA00003 DS    15F
@PC00003 DS    5F
@SA00014 DS    15F
@PC00014 DS    1F
@PC00019 DS    3F
@SA00022 DS    15F
@PC00022 DS    2F
@SA00020 DS    15F
@PC00020 DS    3F
@SA00012 DS    15F
@PC00012 DS    5F
@SA00015 DS    15F
@PC00015 DS    4F
@SA00013 DS    15F
@PC00013 DS    1F
@SA00018 DS    15F
@SA00005 DS    15F
@PC00005 DS    1F
@SA00009 DS    15F
@PC00009 DS    4F
@SA00008 DS    15F
@PC00008 DS    1F
@SA00017 DS    15F
@PC00017 DS    6F
@SA00011 DS    15F
@PC00011 DS    4F
@SA00021 DS    15F
@PC00021 DS    3F
@AL00001 DS    6A
@AFTEMPS DS    11F
IDCRM01  CSECT
         DS    0F
@CF00119 DC    F'0'
@CF00221 DC    F'1'
@CH00221 EQU   @CF00221+2
@CF00157 DC    F'2'
@CH00157 EQU   @CF00157+2
@CF00165 DC    F'3'
@CH00165 EQU   @CF00165+2
@CF00046 DC    F'4'
@CH00046 EQU   @CF00046+2
@CF00041 DC    F'6'
@CH00041 EQU   @CF00041+2
@CF00039 DC    F'8'
@CH00039 EQU   @CF00039+2
@CF00035 DC    F'12'
@CH00035 EQU   @CF00035+2
@CF00483 DC    F'16'
@CF00964 DC    F'17'
@CF00966 DC    F'18'
@CH00966 EQU   @CF00966+2
@CF00312 DC    F'24'
@CH00312 EQU   @CF00312+2
@CF01127 DC    F'40'
@CH01127 EQU   @CF01127+2
@CF01390 DC    F'45'
@CH01390 EQU   @CF01390+2
@CF01741 DC    F'52'
@CH01741 EQU   @CF01741+2
@CF01129 DC    F'72'
@CF01131 DC    F'76'
@CF01137 DC    F'240'
@CF00615 DC    F'255'
@CF01753 DC    F'760'
@CF01762 DC    F'952'
@CF00917 DC    F'2044'
@CF01302 DC    F'2048'
@CF01798 DC    F'-41'
@CF01804 DC    F'-12'
@CF01806 DC    F'-8'
@CF01805 DC    F'-7'
@CF01786 DC    F'-6'
@CF01803 DC    F'-5'
@CF01779 DC    F'-4'
@DATD    DSECT
         DS    0D
LISTSCAN DS    A
IOCSPTR  DS    A
OPNPTR   DS    A
DDSTRU   DS    A
FSADDR   DS    A
ERCNVADR DS    A
DMPINDEX DS    A
CTGPLPTR DS    A
CTGFLPTR DS    A
CTGFVPTR DS    A
DSCCATPT DS    A
BLKSIZ   DS    F
TOTLEN   DS    F
FNMPTR   DS    A
PWORKAR  DS    A
UCWORKAR DS    A
NVWORKAR DS    A
GDWORKAR DS    A
ALWORKAR DS    A
PFVTPTR  DS    A
UCFVTPTR DS    A
NVFVTPTR DS    A
GDFVTPTR DS    A
ALFVTPTR DS    A
PTRCPL   DS    A
PPTRCPL  DS    A
UCPTRCPL DS    A
NVPTRCPL DS    A
ALPTRCPL DS    A
GDPTRCPL DS    A
DCPLPTR  DS    A
CPSWD    DS    A
SAVCPLLN DS    F
NVSAVFVT DS    A
UCSAVFVT DS    A
GDSAVFVT DS    A
PINIOCS  DS    A
POUTIOCS DS    A
PTRCTACB DS    A
CONRCPTR DS    A
DICTPTR  DS    A
ALLPTR   DS    A
DALCINDX DS    F
ENTRYNO  DS    F
FX       DS    F
I        DS    F
IX       DS    F
N        DS    F
J        DS    F
ACPLPTR  DS    A
AFVTPTR  DS    A
ZPTR     DS    A
IOINFPTR DS    A
DSNRETPT DS    A
CPLPROCI DS    F
APSWD    DS    A
NFPLADDR DS    A
NFIELDPT DS    A
FRANPTR1 DS    A
RPTR1    DS    A
RPTR2    DS    A
INXVOLSR DS    F
FDEVTPTR DS    A
FSEQPTR  DS    A
WSIZE    DS    F
VOLLSTPT DS    A
JX       DS    F
JX1      DS    F
IX1      DS    F
K        DS    F
SIZENEED DS    F
DALGLPTR DS    A
MFPTR    DS    A
MTPTR    DS    A
FPLADDR  DS    A
FIELDPTR DS    A
DICENPTR DS    A
RDBUF    DS    A
ALSAVFVT DS    A
FLISTPTR DS    A
HILN     DS    F
INDX     DS    F
KEYLENGH DS    F
LISTPTR  DS    A
LOWLN    DS    F
RECSZ    DS    F
SAVFVTV  DS    A
SETRC    DS    H
TESTRC   DS    H
QUALLEN  DS    H
TFVTLEN  DS    H
NUMCOMP  DS    H
NUMOBJ   DS    H
ZSIZE    DS    H
LENG     DS    H
NUMVOL   DS    H
NUMFSEQ  DS    H
LIMIT    DS    H
CURSIZE  DS    H
PLIMIT   DS    H
M1SIZE   DS    H
GMLEN    DS    H
RDLEN    DS    H
NUMDTYP  DS    H
TOTLENH  DS    H
DEFSTID  DS    FL1
LISTLN   DS    FL1
@TS00001 DS    CL95
ERRORTAB DS    CL32
         DS    CL3
@NM00052 DS    CL10
         ORG   @NM00052
CATRTNID DS    CL8
CATLGRC  DS    FL2
         ORG   @NM00052+10
         DS    CL2
CATRCVWK DS    CL10
         ORG   CATRCVWK
RCVLN    DS    FL2
RCVRLN   DS    FL2
CATRCWKA DS    CL6
         ORG   CATRCVWK+10
PCOREFLG DS    BL1
SAVCPL   DS    CL44
PSAVCPL  DS    CL28
IMPFLG   DS    BL1
         ORG   IMPFLG
IMPUNIQ  DS    BL1
IMPINHTG EQU   IMPFLG+0
IMPASSOC EQU   IMPFLG+0
IMPBASE  EQU   IMPFLG+0
IMPNTUSD EQU   IMPFLG+0
         ORG   IMPFLG+1
KSDSFLAG DS    BL1
IMPFLG2  DS    BL1
         ORG   IMPFLG2
IMPF2VOL DS    BL1
IMPF2DEL EQU   IMPFLG2+0
IMPF2OBJ EQU   IMPFLG2+0
IMPF2NOD EQU   IMPFLG2+0
IMPF2NER EQU   IMPFLG2+0
IMPF2RES EQU   IMPFLG2+0
         ORG   IMPFLG2+1
IMPMFLAG DS    BL1
         ORG   IMPMFLAG
IMPMFIMF DS    BL1
IMPMFDNM EQU   IMPMFLAG+0
IMPMFRES EQU   IMPMFLAG+0
         ORG   IMPMFLAG+1
         DS    CL1
CONRCARE DS    CL268
ALLLIST  DS    CL31
         DS    CL1
QUALLIST DS    CL12
         ORG   QUALLIST
QUALADDR DS    AL4
QUALCAT  DS    AL4
QUALPAS  DS    AL4
         ORG   QUALLIST+12
DEALLOC  DS    BL1
UNIQD    DS    BL1
UNIQI    DS    BL1
IUNIQFVT DS    CL92
ZCNTRL   DS    BL1
IOINFBYT DS    CL1
         DS    CL3
DSNRET   DS    CL52
         ORG   DSNRET
DSNRETAL DS    FL2
DSNRETFL DS    FL2
DSNRETIN DS    CL48
         ORG   DSNRETIN
DSNRETTP DS    CL2
DSNRETLN DS    FL2
DSNRETNM DS    CL44
         ORG   DSNRET+52
ENDFLAG  DS    BL1
GETEOF   DS    BL1
GETREO   DS    BL1
SAVRELNM DS    CL44
NVSMRDSW DS    BL1
DELTWKA  DS    CL544
         ORG   DELTWKA
@NM00053 DS    FL2
@NM00054 DS    FL2
@NM00055 DS    12CL45
         ORG   DELTWKA+544
AFVT     DS    CL92
VOLLSTOR DS    CL10
DSAVCPL  DS    CL28
COREFLAG DS    BL1
         DS    CL1
ALGLSAVE DS    CL20
         ORG   ALGLSAVE
ALSAVPTR DS    0A
         ORG   ALGLSAVE+20
OPENLIST DS    BL48
OPENSAVE DS    BL48
DOCNTRL  DS    BL1
GDOCNTRL DS    BL1
ALISFIR  DS    BL1
DEFSTMOD DS    CL3
HKEY     DS    CL64
KERROR   DS    BL1
LKEY     DS    CL64
RDOCNTRL DS    BL1
RENEWCPL DS    CL28
PRINTTAB DS    9F
WORKAR   DS    3A
FVTPTR   DS    3A
SAVFVT   DS    3A
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IDCRM01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
NULLPARM DC    A(0)
CFPLNUM  DC    H'12'
LNAMEDS  DC    H'4'
@CC01552 DC    C'CATLGRTN'
@CC01300 DC    C'RMBG'
@CC01330 DC    C'RMEL'
@CC01331 DC    C'RMFN'
@CC01335 DC    C'RMCP'
@CC01336 DC    C'RMCT'
@CC01359 DC    C'RMDV'
@CC01362 DC    C'RMPT'
@CC01370 DC    C'RMCE'
@CC01392 DC    C'RMPL'
@CC01394 DC    C'RMCL'
@CC01398 DC    C'RMUQ'
@CC01405 DC    C'RMAT'
@CC01411 DC    C'RMUC'
@CC01419 DC    C'RMDU'
@CC01424 DC    C'RMNV'
@CC01433 DC    C'RMDN'
@CC01439 DC    C'RMAL'
@CC01454 DC    C'RMNF'
@CC01461 DC    C'RMGD'
@CC01464 DC    C'RMDG'
@CC01496 DC    C'RMRG'
@CC01525 DC    C'RMLV'
@CC01550 DC    C'RMSP'
@CC01551 DC    C'RMZZ'
@CC01578 DC    C'RMDL'
@CC01579 DC    C'RMDC'
@CC01586 DC    C'RMDD'
@CC01618 DC    C'RMDA'
@CC01647 DC    C'RMOP'
@CC01677 DC    C'RMBF'
@CC01709 DC    C'RMFV'
@CC01727 DC    C'RMPS'
@CC00945 DC    C'MP0'
@CC00981 DC    C'UV0'
@CC00989 DC    C'DL0'
@CC00996 DC    C'DE0'
@CC00751 EQU   @CC00989
@CC00753 DC    C'I'
@CC00755 DC    C'A'
@CC00757 EQU   @CC00981
@CC00767 DC    C'F'
@CC01650 DC    C'O'
@CC01681 DC    C'S'
ALL      DC    CL3'ALL'
FORMAT   DC    CL4'FORM'
HSECOND  DC    CL4'HSEC'
CLOCK    DC    CL4'KLOK'
SETZERO  DC    CL4'ZERO'
SETBLANK DC    CL4'BLNK'
NOSET    DC    CL4'NSET'
OVERRIDE DC    CL4'OVRD'
ACQUIRE  DC    CL8'ACQUIRE '
RELINQ   DC    CL8'RELINQ  '
MOUNT    DC    CL8'MOUNT   '
DEMOUNT  DC    CL8'DEMOUNT '
DEFINE   DC    CL8'DEFINE  '
MOVE     DC    CL8'MOVE    '
TRACEQ   DC    CL8'TRACEQ  '
COPYTABL DC    CL8'COPYTABL'
COPYCRTG DC    CL8'COPYCRTG'
COPYVOL  DC    CL8'COPYVOL '
VVIC     DC    CL8'VVIC    '
TUNE     DC    CL8'TUNE    '
NAMES    DC    CL4'NAME'
UNIT     DC    CL4'UNIT'
SHR      DC    CL4'SHR '
EXCL     DC    CL4'EXCL'
NOWAIT   DC    CL4'NWAI'
WAIT     DC    CL4'WAIT'
MODID    DC    CL4'RM01'
GPID     DC    CL4'RM01'
FIXAREA  DS    CL768
         ORG   FIXAREA
@NM00044 DS    CL256
         ORG   @NM00044
@NM00045 DC    256X'00'
         ORG   FIXAREA+256
@NM00046 DS    CL256
         ORG   @NM00046
@NM00047 DC    256X'00'
         ORG   FIXAREA+512
@NM00048 DS    CL256
         ORG   @NM00048
@NM00049 DC    256X'00'
         ORG   FIXAREA+768
FPASNAME DC    CL8'PASSWALL'
FNDEVTYP DC    CL8'DEVTYP  '
CNTREPNO DC    CL8'CNTREPNO'
ZEROS    DC    X'00'
         DC    XL5'0'
ZER      DC    X'00'
         DC    XL255'0'
FFS      DS    CL64
         ORG   FFS
@NM00056 DC    64X'FF'
         ORG   FFS+64
DALCUNIT DS    CL12
         ORG   DALCUNIT
DL#UNIT  DC    H'1'
DLUNITLN DC    H'8'
DLUNIT   DC    CL8'SYSALLDA'
         ORG   DALCUNIT+12
FIELDLST DC    CL8'ENTYPE  '
         DC    CL8'ENTNAME '
         DC    CL8'DSATTR  '
         DC    CL8'OWNERID '
         DC    CL8'DSETCRDT'
         DC    CL8'DSETEXDT'
         DC    CL8'BUFSIZE '
         DC    CL8'LRECL   '
         DC    CL8'SPACPARM'
         DC    CL8'PASSWORD'
         DC    CL8'PASSPRMT'
         DC    CL8'PASSATMP'
         DC    CL8'USVRMDUL'
         DC    CL8'USERAREC'
         DC    CL8'LOKEYV  '
         DC    CL8'HIKEYV  '
         DC    CL8'VOLSER  '
         DC    CL8'AMDSBCAT'
         DC    CL8'EXCPEXIT'
         DC    CL8'RGATTR  '
         DC    CL8'SECFLAGS'
         DC    CL8'CATACB  '
         DC    CL8'NAMEDS  '
         DC    CL8'HURBADS '
NVFLIST  DC    CL8'ENTYPE  '
         DC    CL8'ENTNAME '
         DC    CL8'VOLSER  '
         DC    CL8'DEVTYP  '
         DC    CL8'FILESEQ '
         DC    CL8'OWNERID '
         DC    CL8'DSETCRDT'
         DC    CL8'DSETEXDT'
GDFLIST  DC    CL8'ENTYPE  '
         DC    CL8'ENTNAME '
         DC    CL8'GDGLIMIT'
         DC    CL8'GDGATTR '
         DC    CL8'OWNERID '
         DC    CL8'DSETCRDT'
         DC    CL8'DSETEXDT'
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
RTNREG   EQU   @15
REG15    EQU   @15
REG0     EQU   @00
REG1     EQU   @01
REG10    EQU   @10
REG11    EQU   @11
REG12    EQU   @12
REG13    EQU   @13
REG14    EQU   @14
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG8     EQU   @08
REG9     EQU   @09
IDCSAEP0 EQU   0
IDCSAFS0 EQU   0
IDCSAGP0 EQU   0
IDCSAFP0 EQU   0
IDCSACA0 EQU   0
IDCSAAL0 EQU   0
IDCSADL0 EQU   0
IDCSAQL0 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
CIRAGL   EQU   0
CIRTYPE  EQU   CIRAGL
ALLAGL   EQU   0
ALLDSN   EQU   ALLAGL
ALLDDN   EQU   ALLAGL+4
ALLULP   EQU   ALLAGL+12
ALLVLP   EQU   ALLAGL+16
ALLSTS   EQU   ALLAGL+24
ALLSTSOD EQU   ALLSTS
ALLDSP   EQU   ALLAGL+25
ALLDSPKP EQU   ALLDSP
ALLORG   EQU   ALLAGL+26
ALLOPT   EQU   ALLAGL+28
ALLOPTVL EQU   ALLOPT
ALLOPTDS EQU   ALLOPT
UNITABL  EQU   0
UNITADR  EQU   UNITABL+4
@NM00010 EQU   UNITADR
UNITSTAT EQU   UNITABL+6
IDCIOOP0 EQU   0
IDCIOCL0 EQU   0
IDCIOGT0 EQU   0
IDCIOCO0 EQU   0
IDCIOSI0 EQU   0
IOCSTR   EQU   0
IOCDAD   EQU   IOCSTR
IOCDLN   EQU   IOCSTR+4
IOCDSO   EQU   IOCSTR+16
IOCRFM   EQU   IOCSTR+17
IOCMAC   EQU   IOCSTR+18
IOCMAC2  EQU   IOCSTR+19
IOCCHP   EQU   IOCSTR+20
IOCMSG   EQU   IOCSTR+21
IOCMSGOP EQU   IOCMSG
IOCRBA   EQU   IOCSTR+40
IOCTTR   EQU   IOCRBA
IOCMEM   EQU   IOCSTR+44
IOCNWM   EQU   IOCSTR+48
IOCREL   EQU   IOCSTR+60
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNOPTIN EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNRFM   EQU   OPNAGL+1
OPNRFMSF EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNTYP   EQU   OPNAGL+2
OPNTYPXM EQU   OPNTYP
OPNTYPRV EQU   OPNTYP
OPNTYPSY EQU   OPNTYP
OPNMOD   EQU   OPNAGL+3
OPNMODAX EQU   OPNMOD
OPNIOC   EQU   OPNAGL+4
OPNDDN   EQU   OPNAGL+8
OPNPWA   EQU   OPNAGL+12
OPNDSN   EQU   OPNAGL+16
OPNDEV   EQU   OPNAGL+24
OPNDEVDT EQU   OPNDEV
OPNREC   EQU   OPNAGL+32
OPNBLK   EQU   OPNAGL+36
OPNDSO   EQU   OPNAGL+41
OPNOPT2  EQU   OPNAGL+42
IOINFOPT EQU   0
IOINFDSN EQU   IOINFOPT
UVOLLIST EQU   0
UVOLENT  EQU   UVOLLIST+2
AMSTP011 EQU   0
IDCTPER0 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGSTID EQU   DARGLIST+8
DARGSMOD EQU   DARGSTID
DARGSENT EQU   DARGSTID+3
DARGILP  EQU   DARGLIST+12
DARGCNT  EQU   DARGLIST+14
DARGFLGS EQU   DARGLIST+19
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
DARGPCT  EQU   DARGINL
DARGDTM  EQU   DARGARY+4
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ERCNVTAB EQU   0
ERTYPE   EQU   ERCNVTAB
ERCATLG  EQU   ERTYPE
EROPER   EQU   ERCNVTAB+1
ERCATDE  EQU   EROPER
ERCATDL  EQU   EROPER
ERCATAL  EQU   EROPER
EROSOPER EQU   ERCNVTAB+2
ERDSNM   EQU   ERCNVTAB+12
ERCATRC  EQU   ERCNVTAB+16
ERCPLPT  EQU   ERCNVTAB+20
IDCDB010 EQU   0
DMPITM   EQU   0
DMPARY   EQU   0
IN       EQU   0
INDS     EQU   0
INDSPLN  EQU   INDS
INDSPAS  EQU   INDS+1
INDSFLG  EQU   INDS+10
INDSFUQ  EQU   INDSFLG
INDSLEN  EQU   INDS+20
INDSVAL  EQU   INDS+21
OUTDD    EQU   0
OUTDDPLN EQU   OUTDD
OUTDDPAS EQU   OUTDD+1
OUTDDVAL EQU   OUTDD+10
OBJTS    EQU   0
OBJTSCNT EQU   0
OBJNMPTR EQU   0
OBJNM    EQU   0
OBJNMFLG EQU   OBJNM+10
OBJNMVAL EQU   OBJNM+21
OBJFLPTR EQU   0
OBJFL    EQU   0
OBJFLVAL EQU   OBJFL+1
LISTVPTR EQU   0
LISTV    EQU   0
LISTVCNT EQU   LISTV
@NM00032 EQU   LISTV+2
LISTVVAL EQU   @NM00032+1
DEVTPTR  EQU   0
DEVT     EQU   0
DEVTCNT  EQU   DEVT
@NM00033 EQU   DEVT+2
DEVTVAL  EQU   @NM00033+1
INDD     EQU   0
INDDVAL  EQU   INDD+1
ENV      EQU   0
BLKSZ    EQU   0
BLKSZVAL EQU   BLKSZ
PDEV     EQU   0
PDEVVAL  EQU   PDEV+1
CAT      EQU   0
CATPLN   EQU   CAT
CATPAS   EQU   CAT+1
CATFLG   EQU   CAT+10
CATVAL   EQU   CAT+21
SRAC     EQU   0
CTGPL    EQU   0
CTGOPTN1 EQU   CTGPL
CTGMAST  EQU   CTGOPTN1
CTGNAME  EQU   CTGOPTN1
CTGCNAME EQU   CTGOPTN1
CTGOPTN2 EQU   CTGPL+1
CTGEXT   EQU   CTGOPTN2
CTGERASE EQU   CTGOPTN2
CTGSMF   EQU   CTGERASE
CTGREL   EQU   CTGSMF
CTGPURG  EQU   CTGOPTN2
CTGVMNT  EQU   CTGPURG
CTGRCATN EQU   CTGVMNT
CTGDISC  EQU   CTGOPTN2
CTGOVRID EQU   CTGOPTN2
CTGSCR   EQU   CTGOPTN2
CTGOPTN3 EQU   CTGPL+2
CTGFUNC  EQU   CTGOPTN3
CTGNUM   EQU   CTGOPTN3
CTGAM0   EQU   CTGOPTN3
CTGOPTN4 EQU   CTGPL+3
CTGNPROF EQU   CTGOPTN4
CTGENT   EQU   CTGPL+4
CTGFVT   EQU   CTGENT
CTGCAT   EQU   CTGPL+8
CTGWKA   EQU   CTGPL+12
CTGDSORG EQU   CTGPL+16
CTGOPTNS EQU   CTGDSORG
CTGTYPE  EQU   CTGPL+18
CTGDDNM  EQU   CTGPL+20
CTGNEWNM EQU   CTGDDNM
CTGFBFLG EQU   CTGNEWNM+2
CTGJSCB  EQU   CTGPL+24
CTGPSWD  EQU   CTGJSCB
CTGFL    EQU   0
CTGFLDNO EQU   CTGFL
CTGFLDCD EQU   CTGFL+1
CTGFLDRE EQU   CTGFL+3
CTGFLDNM EQU   CTGFL+8
CTGFLCHN EQU   CTGFL+12
CTGFLDAT EQU   CTGFL+16
CTGFLNG  EQU   CTGFLDAT
CTGFLPT  EQU   CTGFLDAT+4
CTGFV    EQU   0
CTGFVTYP EQU   CTGFV
CTGFVPRO EQU   CTGFV+1
CTGFVNDC EQU   CTGFVPRO
CTGFVRON EQU   CTGFVPRO
CTGFVDCH EQU   CTGFV+4
CTGFVICH EQU   CTGFV+8
CTGFVVCH EQU   CTGFV+12
CTGFVIND EQU   CTGFV+16
CTGFVENT EQU   CTGFV+20
CTGFVSTY EQU   CTGFV+24
CTGFVOWN EQU   CTGFV+28
CTGFVEXP EQU   CTGFV+32
CTGFVCRE EQU   CTGFV+36
CTGFVVLT EQU   CTGFV+40
CTGFVRNG EQU   CTGFV+44
CTGFVDVT EQU   CTGFV+48
CTGFVSPC EQU   CTGFV+52
CTGFVAMD EQU   CTGFV+56
CTGFVFSN EQU   CTGFVAMD
CTGFVATR EQU   CTGFV+60
CTGFVBUF EQU   CTGFV+64
CTGFVLRS EQU   CTGFV+68
CTGFVLMT EQU   CTGFV+72
CTGFVEXT EQU   CTGFVLMT
CTGFVGAT EQU   CTGFV+76
CTGFVUPG EQU   CTGFVGAT
CTGFVNAM EQU   CTGFV+80
CTGFVPWD EQU   CTGFV+84
CTGFVWKA EQU   CTGFV+88
IDAAMDSB EQU   0
AMDATTR  EQU   IDAAMDSB+1
AMDLEN   EQU   IDAAMDSB+2
AMDNEST  EQU   IDAAMDSB+4
AMDAXRKP EQU   AMDNEST
AMDRKP   EQU   IDAAMDSB+6
AMDKEYLN EQU   IDAAMDSB+8
AMDPCTCA EQU   IDAAMDSB+10
AMDPCTCI EQU   IDAAMDSB+11
AMDCINV  EQU   IDAAMDSB+20
AMDLRECL EQU   IDAAMDSB+24
AMDHLRBA EQU   IDAAMDSB+28
AMDSSRBA EQU   IDAAMDSB+32
AMDATTR3 EQU   IDAAMDSB+40
AMDSTAT  EQU   IDAAMDSB+48
FIELDR   EQU   0
FENTYPE  EQU   0
FENTNAME EQU   0
FDSATTR  EQU   0
FDSUNIQ  EQU   FDSATTR
FLVOLSER EQU   0
FIELDVR  EQU   0
FPASSWAL EQU   0
FPASWD   EQU   FPASSWAL
FPASSPRM EQU   FPASSWAL+32
FPASSATM EQU   FPASSWAL+40
FUSVRMDU EQU   FPASSWAL+42
FUSERARE EQU   FPASSWAL+50
FUSERLN  EQU   FUSERARE
FLISTVOL EQU   0
FLISTLN  EQU   FLISTVOL
FVOLSERL EQU   FLISTVOL+2
FVOLRTN  EQU   FVOLSERL
FVOLSER  EQU   FVOLSERL+2
FNAMEDS  EQU   0
RCDSECF  EQU   0
RCDEXSEC EQU   RCDSECF
WORKAREA EQU   0
AREALN   EQU   WORKAREA
RETURNLN EQU   WORKAREA+2
ENTLIST  EQU   WORKAREA+4
ENTITEM  EQU   ENTLIST
ENTRYTYP EQU   ENTITEM
ENTRYNM  EQU   ENTITEM+1
CONREC   EQU   0
HEADER   EQU   CONREC
HEADLN   EQU   HEADER
HEADFLG1 EQU   HEADER+2
HEADFLG2 EQU   HEADER+3
RECORDSZ EQU   HEADER+4
ASSRECLN EQU   RECORDSZ
VARDATA  EQU   CONREC+8
DICT     EQU   0
DICTEN   EQU   DICT+4
DICTLN   EQU   DICTEN
DICTDL   EQU   DICTEN+4
TIMESTMP EQU   0
TEXOJCT  EQU   TIMESTMP
TEXFLG   EQU   TIMESTMP+1
TEXNVS   EQU   TEXFLG
TEXGDG   EQU   TEXFLG
TEXUCT   EQU   TEXFLG
TIMEODAY EQU   TIMESTMP+4
TIMEDATE EQU   TIMESTMP+12
ZAREA    EQU   0
FRANGLST EQU   0
FRANGLN  EQU   FRANGLST
FRANGES  EQU   0
FKEYLN   EQU   FRANGES
FKEY     EQU   FRANGES+2
FDEV     EQU   0
FDEVTYP  EQU   FDEV
FDEVT    EQU   FDEVTYP
FDCODE   EQU   FDEVTYP+8
FLDEVTYP EQU   0
FSEQARRY EQU   0
FFSEQNUM EQU   FSEQARRY
FSEQNUM  EQU   0
FVTVLIST EQU   0
FVTVLEN  EQU   FVTVLIST
@NM00057 EQU   FVTVLIST+2
FVTVSER  EQU   @NM00057+2
ALCVLIST EQU   0
ALC#ENT  EQU   ALCVLIST
@NM00059 EQU   ALCVLIST+2
ALCVLEN  EQU   @NM00059
ALCVSER  EQU   @NM00059+2
OIOCSPTR EQU   0
BFLIST   EQU   0
FROMAREA EQU   0
TOAREA   EQU   0
FIELDPS  EQU   0
AMSTP041 EQU   0
AMSTP042 EQU   0
AMSTP043 EQU   0
AMSTP044 EQU   0
DMPTRM   EQU   0
FCATACB  EQU   0
IDCIOIT0 EQU   0
IDCIOPO0 EQU   0
IDCIOPT0 EQU   0
IDCIOST0 EQU   0
IDCIOTM0 EQU   0
IDCIOVY0 EQU   0
IDCIO050 EQU   0
IDCSACL0 EQU   0
IDCSACR0 EQU   0
IDCSADE0 EQU   0
IDCSADQ0 EQU   0
IDCSAGS0 EQU   0
IDCSAID0 EQU   0
IDCSALC0 EQU   0
IDCSALD0 EQU   0
IDCSALK0 EQU   0
IDCSANQ0 EQU   0
IDCSAPR0 EQU   0
IDCSAPT0 EQU   0
IDCSARC0 EQU   0
IDCSARV0 EQU   0
IDCSASC0 EQU   0
IDCSASI0 EQU   0
IDCSASN0 EQU   0
IDCSASS0 EQU   0
IDCSAST0 EQU   0
IDCSATI0 EQU   0
IDCSAUC0 EQU   0
IDCSAWO0 EQU   0
IDCSA060 EQU   0
IDCST010 EQU   0
LISTTEST EQU   0
NEWERID1 EQU   5
NSRAC    EQU   0
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTDBG   EQU   GDTTBL+40
GDTSTC   EQU   GDTTBL+44
GDTPRT   EQU   GDTTBL+48
GDTESS   EQU   GDTTBL+52
GDTESA   EQU   GDTTBL+56
GDTRST   EQU   GDTTBL+60
GDTRES   EQU   GDTTBL+64
GDTCAL   EQU   GDTTBL+68
GDTGSP   EQU   GDTTBL+72
GDTFSP   EQU   GDTTBL+76
GDTGPL   EQU   GDTTBL+80
GDTFPL   EQU   GDTTBL+84
GDTLOD   EQU   GDTTBL+88
GDTDEL   EQU   GDTTBL+92
GDTPRL   EQU   GDTTBL+96
GDTEPL   EQU   GDTTBL+100
GDTTIM   EQU   GDTTBL+104
GDTIIO   EQU   GDTTBL+108
GDTTIO   EQU   GDTTBL+112
GDTOPN   EQU   GDTTBL+124
GDTCLS   EQU   GDTTBL+128
GDTGET   EQU   GDTTBL+132
GDTPUT   EQU   GDTTBL+136
GDTPOS   EQU   GDTTBL+140
GDTCPY   EQU   GDTTBL+144
GDTCAT   EQU   GDTTBL+148
GDTSNP   EQU   GDTTBL+164
GDTVFY   EQU   GDTTBL+172
GDTECT   EQU   GDTTBL+188
GDTUID   EQU   GDTTBL+192
GDTPMT   EQU   GDTTBL+196
GDTCIR   EQU   GDTTBL+200
GDTLNK   EQU   GDTTBL+204
GDTALC   EQU   GDTTBL+208
GDTDLC   EQU   GDTTBL+212
GDTQAL   EQU   GDTTBL+216
GDTSTW   EQU   GDTTBL+220
GDTSSC   EQU   GDTTBL+224
GDTENQ   EQU   GDTTBL+228
GDTRSV   EQU   GDTTBL+232
GDTDEQ   EQU   GDTTBL+236
GDTSFO   EQU   GDTTBL+240
GDTWTO   EQU   GDTTBL+244
GDTSCR   EQU   GDTTBL+248
GDTUNT   EQU   GDTTBL+252
GDTRCT   EQU   GDTTBL+256
GDTIFO   EQU   GDTTBL+260
GDTEXP   EQU   GDTTBL+264
GDTSTA   EQU   GDTTBL+268
GDTERR   EQU   GDTTBL+272
GDTUNC   EQU   GDTTBL+276
GDTLOC   EQU   GDTTBL+280
FDTTBL   EQU   0
FDTPTR   EQU   FDTTBL+8
LASTCC   EQU   0
CTYPE    EQU   0
CPTRCPL  EQU   0
CNAME    EQU   0
CINUM    EQU   0
CCPSWD   EQU   0
ALTERTYP EQU   0
ALNAMEPT EQU   0
NFDICT   EQU   0
NFWKA    EQU   0
NFPTRFVT EQU   0
NFRELATE EQU   0
RX       EQU   0
RDICT    EQU   0
RWKA     EQU   0
RRANGPTR EQU   0
LX       EQU   0
LISTDICT EQU   0
LISTWKA  EQU   0
LFVTPTR  EQU   0
LTYPE    EQU   0
SCPLPTR  EQU   0
DLCPLPTR EQU   0
REQTYPE  EQU   0
DALVLPTR EQU   0
DALDNMPT EQU   0
DALINDEX EQU   0
OTYPE    EQU   0
ODD      EQU   0
ODSN     EQU   0
OREC     EQU   0
OBLK     EQU   0
OIOCS    EQU   0
BFLISTPT EQU   0
BINDX    EQU   0
BFPLADDR EQU   0
BDICTPTR EQU   0
BWKAPTR  EQU   0
BFPLRTN  EQU   0
MSIZE    EQU   0
MF1PTR   EQU   0
MT1PTR   EQU   0
FDICT    EQU   0
FWKA     EQU   0
FPTRFVT  EQU   0
BFPL     EQU   0
BDICT    EQU   0
BWKA     EQU   0
GINVBUF  EQU   0
GLENGTH  EQU   0
@NM00038 EQU   CTGDDNM
CTGPROB  EQU   @NM00038
CTGREASN EQU   CTGPROB+2
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
CTGREAS2 EQU   CTGREASN+1
CTGREAS1 EQU   CTGREASN
CTGMODID EQU   CTGPROB
FDTVERB  EQU   FDTTBL
GDTPSB   EQU   GDTTBL+184
GDTUPT   EQU   GDTTBL+180
GDTCMB   EQU   GDTTBL+176
GDTSPR   EQU   GDTTBL+168
@NM00001 EQU   GDTTBL+160
GDTABH   EQU   GDTTBL+156
GDTABT   EQU   GDTTBL+152
GDTTOH   EQU   GDTTBL+120
GDTRIP   EQU   GDTTBL+116
GDTIOH   EQU   GDTTBL+36
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
@NM00058 EQU   @NM00057
TEXRESV  EQU   TIMESTMP+2
TEXRCVY  EQU   TEXFLG
TEXBASE  EQU   TEXFLG
TEXASSOC EQU   TEXFLG
TEXINHTG EQU   TEXFLG
TEXUNIQ  EQU   TEXFLG
DICTNM   EQU   DICT
ASSRECNM EQU   RECORDSZ+2
@NM00051 EQU   RCDSECF
FNAME    EQU   FNAMEDS+1
FTYPE    EQU   FNAMEDS
FUSERVAL EQU   FUSERARE+2
FIELDCT  EQU   FIELDVR+2
FIELDLN  EQU   FIELDVR
FDSNTUSE EQU   FDSATTR+1
@NM00050 EQU   FDSATTR+1
FDSTROVF EQU   FDSATTR
FDSTMPEX EQU   FDSATTR
FDSINHUP EQU   FDSATTR
FDSSHARE EQU   FDSATTR
FDSERASE EQU   FDSATTR
FDSRELSE EQU   FDSATTR
FDSSPEED EQU   FDSATTR
AMDEXCP  EQU   AMDSTAT+44
AMDNCAS  EQU   AMDSTAT+40
AMDNCIS  EQU   AMDSTAT+36
AMDASPA  EQU   AMDSTAT+32
AMDRETR  EQU   AMDSTAT+28
AMDUPR   EQU   AMDSTAT+24
AMDIREC  EQU   AMDSTAT+20
AMDDELR  EQU   AMDSTAT+16
AMDNLR   EQU   AMDSTAT+12
AMDNEXT  EQU   AMDSTAT+10
AMDNIL   EQU   AMDSTAT+8
AMDSTSP  EQU   AMDSTAT
@NM00043 EQU   IDAAMDSB+41
@NM00042 EQU   AMDATTR3
AMDLM    EQU   AMDATTR3
AMDWAIT  EQU   AMDATTR3
AMDBIND  EQU   AMDATTR3
AMDFAULT EQU   AMDATTR3
AMDUNQ   EQU   AMDATTR3
AMDPARDB EQU   IDAAMDSB+36
AMDMAXRR EQU   AMDSSRBA
AMDNSLOT EQU   AMDHLRBA
AMDFSCI  EQU   IDAAMDSB+16
AMDFSCA  EQU   IDAAMDSB+14
AMDCIPCA EQU   IDAAMDSB+12
AMDSPAN  EQU   AMDATTR
AMDRRDS  EQU   AMDATTR
AMDRANGE EQU   AMDATTR
AMDORDER EQU   AMDATTR
AMDREPL  EQU   AMDATTR
AMDSDT   EQU   AMDATTR
AMDWCK   EQU   AMDATTR
AMDDST   EQU   AMDATTR
AMDSBID  EQU   IDAAMDSB
CTGFVCPP EQU   CTGFVPWD
CTGFVTTR EQU   CTGFVSPC
@NM00041 EQU   CTGFV+3
CTGFVELM EQU   CTGFV+2
@NM00040 EQU   CTGFVPRO
CTGFVROF EQU   CTGFVPRO
CTGFVDRC EQU   CTGFVPRO
CTGFVRVL EQU   CTGFVPRO
CTGFVAVL EQU   CTGFVPRO
CTGFLDWA EQU   CTGFL+4
CTGFLDTS EQU   CTGFLDRE
@NM00039 EQU   CTGFLDRE
CTGFLDGC EQU   CTGFL+2
CTGFIELD EQU   CTGPL+28
@NM00037 EQU   CTGFBFLG
CTGNGDSN EQU   CTGFBFLG
CTGGDGB  EQU   CTGFBFLG
CTGKEEP  EQU   CTGFBFLG
CTGPAR   EQU   CTGFBFLG
CTGFDBK  EQU   CTGNEWNM
CTGNOFLD EQU   CTGPL+19
@NM00036 EQU   CTGDSORG
CTGCVOL  EQU   CTGCAT
@NM00035 EQU   CTGOPTN4
CTGTIOT  EQU   CTGOPTN4
CTGBYPMT EQU   CTGOPTN4
CTGCOIN  EQU   CTGOPTN4
CTGDOCAT EQU   CTGOPTN4
CTGLBASE EQU   CTGOPTN4
CTGSRH   EQU   CTGOPTN3
CTGGDGL  EQU   CTGOPTN3
CTGSUPLT EQU   CTGOPTN3
@NM00034 EQU   CTGOPTN2
CTGGTNXT EQU   CTGOPTN2
CTGSWAP  EQU   CTGRCATN
CTGGTALL EQU   CTGREL
CTGNSVS  EQU   CTGEXT
CTGGENLD EQU   CTGOPTN1
CTGREAD  EQU   CTGOPTN1
CTGUPD   EQU   CTGOPTN1
CTGCI    EQU   CTGOPTN1
CTGBYPSS EQU   CTGOPTN1
CATLEN   EQU   CAT+20
CATMEM   EQU   CAT+12
CATMLN   EQU   CAT+11
CATFUQ   EQU   CATFLG
CATPOS   EQU   CAT+9
PDEVLEN  EQU   PDEV
INDDLEN  EQU   INDD
DEVTLEN  EQU   @NM00033
LISTVLEN EQU   @NM00032
OBJFLLEN EQU   OBJFL
OBJNMLEN EQU   OBJNM+20
OBJNMMEM EQU   OBJNM+12
OBJNMMLN EQU   OBJNM+11
OBJNMFUQ EQU   OBJNMFLG
OBJNMPOS EQU   OBJNM+9
OBJNMPAS EQU   OBJNM+1
OBJNMPLN EQU   OBJNM
OUTDDLEN EQU   OUTDD+9
INDSMEM  EQU   INDS+12
INDSMLN  EQU   INDS+11
INDSPOS  EQU   INDS+9
@NM00031 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00030 EQU   DMPITM+15
DMPITMTP EQU   DMPITM+14
DMPITMLN EQU   DMPITM+12
DMPITMPT EQU   DMPITM+8
DMPITMNM EQU   DMPITM
@NM00029 EQU   ERCNVTAB+24
ERDARBPT EQU   ERCPLPT
ERDYNRC  EQU   ERCATRC
@NM00028 EQU   ERCNVTAB+4
@NM00027 EQU   ERCNVTAB+3
@NM00026 EQU   EROSOPER
EROSUCDX EQU   EROSOPER
EROSCATL EQU   EROSOPER
@NM00025 EQU   EROPER
ERCATLC  EQU   EROPER
@NM00024 EQU   ERTYPE
ERDYNAL  EQU   ERTYPE
EROSCAT  EQU   ERTYPE
@NM00023 EQU   FMTCNVF+1
FMTAR    EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00022 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00021 EQU   FMTFLGS+1
FMTSMSG  EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGREP  EQU   DARGINS
@NM00020 EQU   DARGFLGS
DARGFULL EQU   DARGFLGS
DARGIND  EQU   DARGLIST+18
DARGRETL EQU   DARGLIST+16
DARGRETP EQU   DARGLIST+4
UVOLVOL  EQU   UVOLENT+4
UVOLDEV  EQU   UVOLENT
UVOLCNT  EQU   UVOLLIST
@NM00019 EQU   IOINFOPT
IOINFLUB EQU   IOINFOPT
IOINFTMS EQU   IOINFOPT
IOINFSUP EQU   IOINFOPT
IOINFVOL EQU   IOINFOPT
IOINFDVT EQU   IOINFOPT
OPNVOL   EQU   OPNAGL+44
OPNSTRNO EQU   OPNAGL+43
@NM00018 EQU   OPNOPT2
OPNOPTJM EQU   OPNOPT2
OPNOPTNM EQU   OPNOPT2
OPNOPTAS EQU   OPNOPT2
@NM00017 EQU   OPNDSO
OPNDSOPO EQU   OPNDSO
OPNDSOIS EQU   OPNDSO
OPNDSOPS EQU   OPNDSO
OPNDSOAM EQU   OPNDSO
OPNKYL   EQU   OPNAGL+40
OPNDEVIX EQU   OPNDEV+4
OPNCBP   EQU   OPNAGL+20
OPNMODRP EQU   OPNMOD
OPNMODUB EQU   OPNMOD
OPNMODRS EQU   OPNMOD
OPNMODRR EQU   OPNMOD
OPNMODRC EQU   OPNMOD
OPNMODAC EQU   OPNMOD
OPNMODPD EQU   OPNMOD
OPNTYPEX EQU   OPNTYP
OPNTYPRA EQU   OPNTYP
OPNTYPCI EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00016 EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNRFMFX EQU   OPNRFM
OPNOPTSK EQU   OPNOPT
OPNOPTDR EQU   OPNOPT
OPNOPTCR EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNOPTUP EQU   OPNOPT
IOCEXT   EQU   IOCSTR+64
IOCTSML  EQU   IOCREL+2
IOCTPML  EQU   IOCREL
IOCWORK  EQU   IOCSTR+56
IOCRRN   EQU   IOCSTR+52
IOCPNM   EQU   IOCNWM+2
IOCPTL   EQU   IOCNWM
IOCKYA   EQU   IOCMEM
IOCVRC   EQU   IOCTTR
IOCCBP   EQU   IOCSTR+36
IOCDSN   EQU   IOCSTR+32
IOCHURBA EQU   IOCSTR+28
IOCVOLSR EQU   IOCSTR+22
@NM00015 EQU   IOCMSG
IOCMSGSM EQU   IOCMSG
IOCMSGAE EQU   IOCMSG
IOCMSGCE EQU   IOCMSG
IOCMSGOE EQU   IOCMSG
IOCCHPKG EQU   IOCMSG
IOCCHPKE EQU   IOCMSG
IOCCHPNU EQU   IOCCHP
IOCCHPUP EQU   IOCCHP
IOCCHPBK EQU   IOCCHP
IOCCHPCR EQU   IOCCHP
IOCCHPKS EQU   IOCCHP
IOCCHPSK EQU   IOCCHP
IOCCHPDR EQU   IOCCHP
IOCCHPSQ EQU   IOCCHP
IOCMACNT EQU   IOCMAC2
IOCMACER EQU   IOCMAC2
IOCMACPA EQU   IOCMAC2
IOCMACEN EQU   IOCMAC2
IOCMACCP EQU   IOCMAC2
IOCMACRR EQU   IOCMAC2
IOCMACAS EQU   IOCMAC2
IOCMACSK EQU   IOCMAC2
@NM00014 EQU   IOCMAC
IOCMACCC EQU   IOCMAC
IOCMACDR EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACCR EQU   IOCMAC
IOCMACUP EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00013 EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMFX EQU   IOCRFM
@NM00012 EQU   IOCDSO
IOCDSOPO EQU   IOCDSO
IOCDSOIS EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
IOCDSOAM EQU   IOCDSO
IOCRKP   EQU   IOCSTR+13
IOCKYL   EQU   IOCSTR+12
IOCTRN   EQU   IOCSTR+8
UNITVTOC EQU   UNITABL+7
@NM00011 EQU   UNITSTAT
UNITUSHR EQU   UNITSTAT
UNITXSHR EQU   UNITSTAT
UNITISHR EQU   UNITSTAT
UNITUA   EQU   @NM00010+1
UNITCHA  EQU   @NM00010
UNITUCB  EQU   UNITABL
ALLUNCNT EQU   ALLAGL+30
ALLVLCNT EQU   ALLAGL+29
@NM00009 EQU   ALLOPT
ALLOPTUN EQU   ALLOPT
ALLOPTPV EQU   ALLOPT
@NM00008 EQU   ALLORG+1
ALLORGVS EQU   ALLORG+1
@NM00007 EQU   ALLORG+1
ALLORGGS EQU   ALLORG+1
ALLORGUN EQU   ALLORG
ALLORGPO EQU   ALLORG
ALLORGMQ EQU   ALLORG
ALLORGCQ EQU   ALLORG
ALLORGCX EQU   ALLORG
ALLORGDA EQU   ALLORG
ALLORGPS EQU   ALLORG
ALLORGIS EQU   ALLORG
ALLDSPUN EQU   ALLDSP
ALLDSPCG EQU   ALLDSP
ALLDSPDE EQU   ALLDSP
@NM00006 EQU   ALLDSP
ALLSTSMD EQU   ALLSTS
ALLSTSNW EQU   ALLSTS
ALLSTSSR EQU   ALLSTS
@NM00005 EQU   ALLSTS
ALLPWD   EQU   ALLAGL+20
CIRPID   EQU   CIRAGL+28
CIRPWD   EQU   CIRAGL+24
CIRCAT   EQU   CIRAGL+20
CIRWKP   EQU   CIRAGL+16
CIRTLR   EQU   CIRAGL+12
CIRHDR   EQU   CIRAGL+8
CIRTLN   EQU   CIRAGL+6
CIRHLN   EQU   CIRAGL+4
@NM00004 EQU   CIRAGL+1
@NM00003 EQU   CIRTYPE
CIRTYPAQ EQU   CIRTYPE
CIRTYP1Q EQU   CIRTYPE
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00002 EQU   OLDERID1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RC00490 EQU   @RC00482
@RF00489 EQU   @RC00482
@RC00517 EQU   @RC00507
@RF00516 EQU   @RC00507
@RC00541 EQU   @RC00534
@RF00540 EQU   @RC00534
@RF00738 EQU   @RC00735
@RF00818 EQU   @RC00803
@RF00821 EQU   @RC00803
@RF00855 EQU   @RC00840
@RF00858 EQU   @RC00840
@RF02287 EQU   @RC02247
@RF02286 EQU   @RC02247
@RF02293 EQU   @RC02247
@RC02394 EQU   @RC02391
@RF03039 EQU   @RC03006
@PB00022 EQU   @EL00001
@PB00021 EQU   @PB00022
@PB00020 EQU   @PB00021
@PB00019 EQU   @PB00020
@PB00018 EQU   @PB00019
@PB00017 EQU   @PB00018
@PB00016 EQU   @PB00017
@PB00015 EQU   @PB00016
@PB00014 EQU   @PB00015
@PB00013 EQU   @PB00014
@PB00012 EQU   @PB00013
@PB00011 EQU   @PB00012
@PB00010 EQU   @PB00011
@PB00009 EQU   @PB00010
@PB00008 EQU   @PB00009
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IDCRM01,(C'PLS1604',0701,78177)

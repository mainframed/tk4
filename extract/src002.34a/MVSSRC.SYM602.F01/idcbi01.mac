         TITLE '************** IDCBI01: IDCAMS BLDINDEX ROUTINE ********
               ******** '
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
IDCBI01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL1(16)                                             0002
         DC    C'IDCBI01   76.288'                                 0002
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @12,0                                               0002
@PSTART  LA    @11,4095(,@12)                                      0002
         LA    @10,4095(,@11)                                      0002
         LA    @09,4095(,@10)                                      0002
         USING @PSTART,@12                                         0002
         USING @PSTART+4095,@11                                    0002
         USING @PSTART+8190,@10                                    0002
         USING @PSTART+12285,@09                                   0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @08,@01                                             0002
         USING @DATD,@08                                           0002
         ST    @13,@SA00001+4                                      0002
         LM    @00,@01,20(@13)                                     0002
         ST    @08,8(,@13)                                         0002
         LR    @13,@08                                             0002
         MVC   @PC00001(12),0(@01)                                 0002
*                                                                  0201
*        OLDERID2 = NEWERID2;                                      0202
         L     @04,@PC00001                                        0202
         L     @04,GDTTR2(,@04)                                    0202
         MVC   @TS00001(95),NEWERID2(@04)                          0202
         MVC   OLDERID2(95,@04),@TS00001                           0202
*        NEWID2   = 'BI01';                                        0203
         MVC   NEWID2(4,@04),@CC00922                              0203
*        SETRC    = 0;                  /* MAXIMUM CONDITION CODE    */
         SLR   SETRC,SETRC                                         0204
*        STATCOMM = ''B;                /* STATUS COMMUNICATION AREA */
         XC    STATCOMM(6),STATCOMM                                0205
*        IOCSADDR = ''B;                /* IOCSTR ADDRESSES          */
         XC    IOCSADDR(16),IOCSADDR                               0206
*        DDSTRU   = ADDR(DARGAREA);     /* POINTER TO DARGLIST       */
         LA    @04,DARGAREA                                        0207
         ST    @04,DDSTRU                                          0207
*        DARGAREA = ''B;                /* DARGLIST AREA             */
         XC    DARGAREA(44),DARGAREA                               0208
*        SRTCTLTB = ''B;                /* SORT CONTROL TABLE        */
*                                                                  0209
         XC    SRTCTLTB(76),SRTCTLTB                               0209
*        /************************************************************/
*        /*                                                          */
*        /* CALL OPENPROC TO OPEN THE BASE CLUSTER - TERMINATE       */
*        /* PROCESSING IF ERROR IN OPENING                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0210
*        CALL OPENPROC ('B',IOCSBASE,NULLPTR,NULLPTR);             0210
*                                                                  0210
         MVC   @AL00001(16),@AL00210                               0210
         LA    @04,IOCSBASE                                        0210
         ST    @04,@AL00001+4                                      0210
         LA    @01,@AL00001                                        0210
         BAL   @14,OPENPROC                                        0210
*        RESPECIFY RTNREG RSTD;                                    0211
*        TESTRC = RTNREG;                                          0212
         LR    TESTRC,RTNREG                                       0212
*        RESPECIFY RTNREG UNRSTD;                                  0213
*                                                                  0213
*        IF TESTRC ^= 0                                            0214
*          THEN                                                    0214
         LTR   TESTRC,TESTRC                                       0214
         BZ    @RF00214                                            0214
*            SETRC = LASTCC12;                                     0215
*                                                                  0215
         LA    SETRC,12                                            0215
*        /************************************************************/
*        /*                                                          */
*        /* CALL JCPROC TO DETERMINE IF EXTERNAL SORT JOB CONTROL    */
*        /* HAS BEEN PROVIDED.  A TERMINATING CONDITION EXISTS IF    */
*        /* JCPROC COULD NOT OBTAIN THE REQUIRED DATA YET THE CALLER */
*        /* SPECIFIED THE EXTERNALSORT PARAMETER.                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0216
*        IF SETRC ^= LASTCC12                                      0216
*          THEN                                                    0216
@RF00214 C     SETRC,@CF00035                                      0216
         BE    @RF00216                                            0216
*            DO;                                                   0217
*                                                                  0217
*            CALL JCPROC (IOINADDR);                               0218
*                                                                  0218
         LA    @04,IOINADDR                                        0218
         ST    @04,@AL00001                                        0218
         LA    @01,@AL00001                                        0218
         BAL   @14,JCPROC                                          0218
*            RESPECIFY RTNREG RSTD;                                0219
*            TESTRC = RTNREG;                                      0220
         LR    TESTRC,RTNREG                                       0220
*            RESPECIFY RTNREG UNRSTD;                              0221
*                                                                  0221
*            IF TESTRC ^=0                                         0222
*              THEN                                                0222
         LTR   TESTRC,TESTRC                                       0222
         BZ    @RF00222                                            0222
*                SETRC = LASTCC12;                                 0223
*                                                                  0223
         LA    SETRC,12                                            0223
*            END;                                                  0224
*                                                                  0224
@RF00222 DS    0H                                                  0225
*        /************************************************************/
*        /*                                                          */
*        /* THIS IS THE MAIN LOOP TO BUILD AN ALTERNATE INDEX. THE   */
*        /* LOOP IS EXECUTED ONCE FOR EACH ALTERNATE INDEX           */
*        /* IDENTIFIED THROUGH THE OUTFILE OR OUTDATASET PARAMETER.  */
*        /* TWO SECOND LEVEL PROCEDURES ARE CALLED IN THIS LOOP -    */
*        /*                                                          */
*        /*      MAINPROC - THE SECOND LEVEL PROCEDURE WHICH         */
*        /*                 CONTROLS THE BUILDING OF THE AIX         */
*        /*                                                          */
*        /*      FINPROC  - THE SECOND LEVEL PROCEDURE WHICH CLOSES  */
*        /*                 THE AIX AND(OPTIONALLY) THE SORT WORK    */
*        /*                 FILES, PRINTS OUTSTANDING ERROR          */
*        /*                 MESSAGES AND THE AIX FINAL STATUS MESSAGE*/
*        /*                                                          */
*        /************************************************************/
*                                                                  0225
*        IF ADDR(OFILE) ^= NULLPTR                                 0225
*          THEN                                                    0225
@RF00216 L     @04,@PC00001+4                                      0225
         L     @04,FDTPTR+8(,@04)                                  0225
         LTR   @04,@04                                             0225
         BZ    @RF00225                                            0225
*            OUTCOUNT = OFILECNT;                                  0226
*                                                                  0226
         LH    OUTCOUNT,OFILECNT(,@04)                             0226
*          ELSE                                                    0227
*            OUTCOUNT = ODSCNT;                                    0227
*                                                                  0227
         B     @RC00225                                            0227
@RF00225 L     @04,@PC00001+4                                      0227
         L     @04,FDTPTR+12(,@04)                                 0227
         LH    OUTCOUNT,ODSCNT(,@04)                               0227
*        DO I = 1 TO OUTCOUNT WHILE SETRC ^= LASTCC12;             0228
*                                                                  0228
@RC00225 LA    @07,1                                               0228
         B     @DE00228                                            0228
@DL00228 C     SETRC,@CF00035                                      0228
         BE    @DC00228                                            0228
*          CALL MAINPROC (I,DSBADDR,IOCSADDR,IOINADDR,STATCOMM);   0229
*                                                                  0229
         LA    @07,I                                               0229
         ST    @07,@AL00001                                        0229
         LA    @07,DSBADDR                                         0229
         ST    @07,@AL00001+4                                      0229
         LA    @07,IOCSADDR                                        0229
         ST    @07,@AL00001+8                                      0229
         LA    @07,IOINADDR                                        0229
         ST    @07,@AL00001+12                                     0229
         LA    @07,STATCOMM                                        0229
         ST    @07,@AL00001+16                                     0229
         LA    @01,@AL00001                                        0229
         BAL   @14,MAINPROC                                        0229
*          CALL FINPROC (IOCSADDR,STATCOMM);                       0230
*                                                                  0230
         LA    @07,IOCSADDR                                        0230
         ST    @07,@AL00001                                        0230
         LA    @07,STATCOMM                                        0230
         ST    @07,@AL00001+4                                      0230
         LA    @01,@AL00001                                        0230
         BAL   @14,FINPROC                                         0230
*          IF SAVERC > SETRC                                       0231
*            THEN                                                  0231
         LH    @07,SAVERC                                          0231
         CR    @07,SETRC                                           0231
         BNH   @RF00231                                            0231
*              SETRC = SAVERC;                                     0232
*                                                                  0232
         LR    SETRC,@07                                           0232
*          STATCOMM = ''B;                                         0233
*                                                                  0233
@RF00231 XC    STATCOMM(6),STATCOMM                                0233
*          /**********************************************************/
*          /*                                                        */
*          /* IF THERE ARE MORE ALTERNATE INDEXES TO PROCESS,        */
*          /* RE-POSITION THE BASE CLUSTER TO THE FIRST RECORD.      */
*          /* IF THE BASE CLUSTER IS A KSDS, THE KEY OF THE FIRST    */
*          /* RECORD WAS SAVED BY SORTPROC WHEN IT WAS READ.         */
*          /* SET THE RE-PROCESS FLAG IN THE IOCSTR SO THAT FIRST    */
*          /* GET WILL CAUSE THE I/O ADAPTER TO RESET THE            */
*          /* END-OF-FILE INDICATOR ON THE BASE CLUSTER.             */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0234
*          IF I < OUTCOUNT &                                       0234
*             SETRC ^= LASTCC12                                    0234
*            THEN                                                  0234
         C     OUTCOUNT,I                                          0234
         BNH   @RF00234                                            0234
         C     SETRC,@CF00035                                      0234
         BE    @RF00234                                            0234
*              DO;                                                 0235
*                                                                  0235
*              IOCSPTR  = IOCSBASE;                                0236
         L     IOCSPTR,IOCSBASE                                    0236
*              AMDSBPTR = DSBBASE;                                 0237
         L     AMDSBPTR,DSBBASE                                    0237
*              IOCMACPA = ON;                                      0238
*                                                                  0238
         OI    IOCMACPA(IOCSPTR),B'00000100'                       0238
*              IF AMDDST = ON                                      0239
*                THEN                                              0239
         TM    AMDDST(AMDSBPTR),B'10000000'                        0239
         BNO   @RF00239                                            0239
*                  DO;                                             0240
*                                                                  0240
*                  IOCKYA = ADDR(SAVEKEY);                         0241
         LA    @07,SAVEKEY                                         0241
         ST    @07,IOCKYA(,IOCSPTR)                                0241
*                  IOCPTL = AMDKEYLN;                              0242
*                                                                  0242
         LH    @07,AMDKEYLN(,AMDSBPTR)                             0242
         STH   @07,IOCPTL(,IOCSPTR)                                0242
*                  END;                                            0243
*                                                                  0243
*                ELSE                                              0244
*                  IOCRBA = NULLPTR;                               0244
*                                                                  0244
         B     @RC00239                                            0244
@RF00239 SLR   @07,@07                                             0244
         ST    @07,IOCRBA(,IOCSPTR)                                0244
*              CALL IDCIOPO0 (GDTTBL,IOCSBASE);                    0245
*                                                                  0245
@RC00239 L     @07,@PC00001                                        0245
         ST    @07,@AL00001                                        0245
         LA    @04,IOCSBASE                                        0245
         ST    @04,@AL00001+4                                      0245
         MVI   @AL00001+4,X'80'                                    0245
         L     @15,GDTPOS(,@07)                                    0245
         LA    @01,@AL00001                                        0245
         BALR  @14,@15                                             0245
*              RESPECIFY RTNREG RSTD;                              0246
*              TESTRC = RTNREG;                                    0247
         LR    TESTRC,RTNREG                                       0247
*              RESPECIFY RTNREG UNRSTD;                            0248
*                                                                  0248
*              IF TESTRC ^= 0                                      0249
*                THEN                                              0249
         LTR   TESTRC,TESTRC                                       0249
         BZ    @RF00249                                            0249
*                  SETRC = LASTCC12;                               0250
*                                                                  0250
         LA    SETRC,12                                            0250
*              END;                                                0251
*                                                                  0251
@RF00249 DS    0H                                                  0252
*        END;                                                      0252
*                                                                  0252
@RF00234 LA    @07,1                                               0252
         AL    @07,I                                               0252
@DE00228 ST    @07,I                                               0252
         CR    @07,OUTCOUNT                                        0252
         BNH   @DL00228                                            0252
@DC00228 DS    0H                                                  0253
*        /************************************************************/
*        /*                                                          */
*        /* CALL TERMPROC TO PERFORM FINAL CLEANUP - CLOSE BASE      */
*        /* CLUSTER, DELETE SORT FILES IF THEY EXIST, FREE ANY       */
*        /* REMAINING MAIN STORAGE, PRINT TERMINATION MESSAGE        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0253
*        CALL TERMPROC (IOCSADDR,IOINADDR,SRTCTLTB);               0253
*                                                                  0253
         LA    @04,IOCSADDR                                        0253
         ST    @04,@AL00001                                        0253
         LA    @04,IOINADDR                                        0253
         ST    @04,@AL00001+4                                      0253
         LA    @04,SRTCTLTB                                        0253
         ST    @04,@AL00001+8                                      0253
         LA    @01,@AL00001                                        0253
         BAL   @14,TERMPROC                                        0253
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO IDCAMS EXECUTIVE                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0254
*        CALL IDCSAEP0(GDTTBL,MODID);                              0254
         L     @15,@PC00001                                        0254
         ST    @15,@AL00001                                        0254
         LA    @14,MODID                                           0254
         ST    @14,@AL00001+4                                      0254
         MVI   @AL00001+4,X'80'                                    0254
         L     @15,GDTEPL(,@15)                                    0254
         LA    @01,@AL00001                                        0254
         BALR  @14,@15                                             0254
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - OPENPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF OPENING THE          */
*        /*            DATA SETS REQUIRED BY THE BLDINDEX FSR -      */
*        /*            BASE CLUSTER, ALTERNATE INDEX AND(OPTIONALLY) */
*        /*            SORT WORK FILES.  OPENPROC INITIALIZES THE    */
*        /*            OPEN ARGUMENT LIST(OPNAGL) OPTIONS BASED ON   */
*        /*            THE TYPE OF DATA SET BEING OPENED.            */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*         OTYPE - DATA SET TYPE                            */
*        /*                 . B = BASE CLUSTER                       */
*        /*                 . A = AIX                                */
*        /*                 . S = FIRST PASS SORT WORK FILE          */
*        /*                 . M = MERGE PASS SORT WORK FILE          */
*        /*                                                          */
*        /*         OINDX - INDEX VALUE OF AIX OR SORT FILE          */
*        /*                                                          */
*        /*         OIOINPT - POINTER TO DATA OBTAINED FROM THE      */
*        /*                   SORT WORK JOB CONTROL FOR THE SORT     */
*        /*                   WORK FILE BEING OPENED                 */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*         OIOCS - POINTER TO IOCS OF OPEN DATA SET         */
*        /*                                                          */
*        /* EXIT,NORMAL - RETURN CODE 0, OPEN WAS SUCCESSFUL         */
*        /*                                                          */
*        /* EXIT,ERROR -                                             */
*        /*               RETURN CODE 8, OPEN OF AIX OR SORT WORK    */
*        /*                              FILE WAS NOT SUCCESSFUL     */
*        /*               RETURN CODE 12, OPEN OF BASE CLUSTER WAS   */
*        /*                               NOT SUCCESSFUL             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0255
*OPENPROC:                                                         0255
*        PROCEDURE (OTYPE,         /* DATA SET TYPE TO BE OPENED     */
*                   OIOCS,         /* RETURN AREA FOR IOCSTR ADDRESS */
*                   OINDX,         /* AIX OR SORT WORK FILE INDEX    */
*                   OIOINPT);      /* POINTER TO SORT WORK JOB       */
@EL00001 L     @13,4(,@13)                                         0255
@EF00001 L     @00,@SIZDATD                                        0255
         LR    @01,@08                                             0255
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0255
         BR    @14                                                 0255
OPENPROC STM   @14,@12,@SA00002                                    0255
         MVC   @PC00002(16),0(@01)                                 0255
*                                  /* CONTROL DATA                   */
*                                                                  0256
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0256
*        DCL                                                       0256
*          OTYPE   CHAR(1),        /* DATA SET TYPE                  */
*          OIOCS   PTR(31),        /* RETURN  AREA FOR IOCS ADDRESS  */
*          OINDX   FIXED(31),      /* AIX OR SORT WORK FILE INDEX    */
*          OIOINPT PTR(31);        /* POINTER TO RETURN AREA         */
*                                  /* CONTAINING SORT WORK JOB       */
*                                  /* CONTROL DATA                   */
*                                                                  0257
*        /************************************************************/
*        /*                                                          */
*        /* OPEN ARGUMENT LIST                                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0257
*        DCL 1 OPENAREA BDY(WORD),                                 0257
*              2 OPENID   CHAR(8),              /* OPNAGL DUMP ID    */
*              2 OPENLIST CHAR(LENGTH(OPNAGL)); /* OPNAGL            */
*                                                                  0257
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLES USED AS PARAMETERS OF THE UQUAL MACRO TO       */
*        /* QUALIFY DATA SET NAMES IN A TSO ENVIRONMENT              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0258
*        DCL                                                       0258
*          QDSNPTR  PTR(31),       /* POINTER TO DATA SET NAME       */
*          QDSNLEN  FIXED(15),     /* LENGTH OF DATA SET NAME        */
*          QCATPTR  PTR(31),       /* POINTER TO CATALOG NAME        */
*          QDSNPSWD PTR(31);       /* POINTER TO DATA SET PASSWORD   */
*                                                                  0258
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZATION - SET UP COMMON AREAS OF OPNAGL           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0259
*        OLDERID2 = NEWERID2;                                      0259
         L     @03,@PC00001                                        0259
         L     @03,GDTTR2(,@03)                                    0259
         MVC   @TS00001(95),NEWERID2(@03)                          0259
         MVC   OLDERID2(95,@03),@TS00001                           0259
*        NEWID2 = 'BIP1';                                          0260
         MVC   NEWID2(4,@03),@CC01125                              0260
*        OPENID = 'OPNAGL';                                        0261
         MVI   OPENID+6,C' '                                       0261
         MVI   OPENID+7,C' '                                       0261
         MVC   OPENID(6),@CC01126                                  0261
*        OPNPTR = ADDR(OPENLIST);                                  0262
         LA    OPNPTR,OPENLIST                                     0262
*        OPNAGL = ''B;                                             0263
         XC    OPNAGL(48,OPNPTR),OPNAGL(OPNPTR)                    0263
*        OPNIOC = ADDR(OIOCS);                                     0264
*                                                                  0264
         L     @03,@PC00002+4                                      0264
         ST    @03,OPNIOC(,OPNPTR)                                 0264
*        /************************************************************/
*        /*                                                          */
*        /* OPEN THE BASE CLUSTER.  SET UP THE INPUT PROCESSING      */
*        /* OPTION.  THE BASE CLUSTER CAN BE SPECIFIED VIA A JCL     */
*        /* STATEMENT OR, IN A SYSTEM WITH DYNAMIC ALLOCATION, ITS   */
*        /* DATA SET NAME.  WHEN DESCRIBED BY ITS DATA SET NAME,     */
*        /* THE I/0 ADAPTER PERFORMS DYNAMIC ALLOCATION AS PART OF   */
*        /* UOPEN PROCESSING.  THE I/0 ADAPTER DISTINGUISHES THE     */
*        /* TYPE OF OPEN BY THE SETTING OF OPNDDDN OR OPNDSN.        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0265
*        IF OTYPE = 'B'                                            0265
*          THEN                                                    0265
         L     @03,@PC00002                                        0265
         CLI   OTYPE(@03),C'B'                                     0265
         BNE   @RF00265                                            0265
*OPENBASE:   DO;                                                   0266
*                                                                  0266
OPENBASE DS    0H                                                  0267
*            OPNOPTIN = ON;                                        0267
*                                                                  0267
         OI    OPNOPTIN(OPNPTR),B'10000000'                        0267
*            IF ADDR(IFILE) ^= NULLPTR                             0268
*              THEN                                                0268
         L     @03,@PC00001+4                                      0268
         L     @03,FDTPTR(,@03)                                    0268
         LTR   @03,@03                                             0268
         BZ    @RF00268                                            0268
*                DO;                                               0269
*                                                                  0269
*                OPNDDN = ADDR(IFILEVAL);                          0270
*                                                                  0270
         LA    @15,IFILEVAL(,@03)                                  0270
         ST    @15,OPNDDN(,OPNPTR)                                 0270
*                IF IFILEPLN ^= 0                                  0271
*                  THEN                                            0271
         CLI   IFILEPLN(@03),0                                     0271
         BE    @RF00271                                            0271
*                    OPNPWA = ADDR(IFILEPAS);                      0272
*                                                                  0272
         LA    @03,IFILEPAS(,@03)                                  0272
         ST    @03,OPNPWA(,OPNPTR)                                 0272
*                END;                                              0273
*                                                                  0273
*              /******************************************************/
*              /*                                                    */
*              /* THE BASE CLUSTER DATA SET NAME HAS BEEN SPECIFIED. */
*              /* IN A TSO ENVIRONMENT THE DATA SET NAME MAY BE      */
*              /* UNQUALIFIED.  IF SO, ISSUE THE UQUAL MACRO TO      */
*              /* ACCOMPLISH NAME QUALIFICATION.  IF ERROR, RETURN   */
*              /* WITH A CONDITION CODE 12                           */
*              /*                                                    */
*              /******************************************************/
*                                                                  0274
*              ELSE                                                0274
*                DO;                                               0274
*                                                                  0274
         B     @RC00268                                            0274
@RF00268 DS    0H                                                  0275
*                IF IDSFUQ = ON                                    0275
*                  THEN                                            0275
         L     @03,@PC00001+4                                      0275
         L     @03,FDTPTR+4(,@03)                                  0275
         TM    IDSFUQ(@03),B'10000000'                             0275
         BNO   @RF00275                                            0275
*                    DO;                                           0276
*                                                                  0276
*                    QDSNPTR = ADDR(IDSVAL);                       0277
         LA    @15,IDSVAL(,@03)                                    0277
         ST    @15,QDSNPTR                                         0277
*                    QDSNLEN = IDSLEN;                             0278
         SLR   @15,@15                                             0278
         IC    @15,IDSLEN(,@03)                                    0278
         STH   @15,QDSNLEN                                         0278
*                    QCATPTR = NULLPTR;                            0279
*                                                                  0279
         SLR   @15,@15                                             0279
         ST    @15,QCATPTR                                         0279
*                    IF IDSPLN ^= 0                                0280
*                      THEN                                        0280
         CLI   IDSPLN(@03),0                                       0280
         BE    @RF00280                                            0280
*                        QDSNPSWD = ADDR(IDSPAS);                  0281
*                                                                  0281
         LA    @03,IDSPAS(,@03)                                    0281
         ST    @03,QDSNPSWD                                        0281
*                      ELSE                                        0282
*                        QDSNPSWD = NULLPTR;                       0282
*                                                                  0282
         B     @RC00280                                            0282
@RF00280 SLR   @03,@03                                             0282
         ST    @03,QDSNPSWD                                        0282
*                    CALL IDCSAQL0 (GDTTBL,QDSNPTR,QDSNLEN,        0283
*                            QCATPTR,QDSNPSWD);                    0283
*                                                                  0283
@RC00280 L     @15,@PC00001                                        0283
         ST    @15,@AL00001                                        0283
         LA    @14,QDSNPTR                                         0283
         ST    @14,@AL00001+4                                      0283
         LA    @14,QDSNLEN                                         0283
         ST    @14,@AL00001+8                                      0283
         LA    @14,QCATPTR                                         0283
         ST    @14,@AL00001+12                                     0283
         LA    @14,QDSNPSWD                                        0283
         ST    @14,@AL00001+16                                     0283
         MVI   @AL00001+16,X'80'                                   0283
         L     @15,GDTQAL(,@15)                                    0283
         LA    @01,@AL00001                                        0283
         BALR  @14,@15                                             0283
*                    RESPECIFY RTNREG RSTD;                        0284
*                    TESTRC = RTNREG;                              0285
         LR    TESTRC,RTNREG                                       0285
*                    RESPECIFY RTNREG UNRSTD;                      0286
*                                                                  0286
*                    IF TESTRC ^= 0                                0287
*                      THEN                                        0287
         LTR   TESTRC,TESTRC                                       0287
         BZ    @RF00287                                            0287
*                        RETURN CODE(LASTCC12);                    0288
*                                                                  0288
         LA    @15,12                                              0288
         L     @14,@SA00002                                        0288
         LM    @00,@12,@SA00002+8                                  0288
         BR    @14                                                 0288
*                    END;                                          0289
*                                                                  0289
@RF00287 DS    0H                                                  0290
*                /****************************************************/
*                /*                                                  */
*                /* REFERENCE THE BASE CLUSTER DATA SET NAME AND     */
*                /* ITS PASSWORD IN THE OPNAGL.                      */
*                /*                                                  */
*                /****************************************************/
*                                                                  0290
*                OPNDSN = ADDR(IDSVAL);                            0290
*                                                                  0290
@RF00275 L     @03,@PC00001+4                                      0290
         L     @03,FDTPTR+4(,@03)                                  0290
         LA    @15,IDSVAL(,@03)                                    0290
         ST    @15,OPNDSN(,OPNPTR)                                 0290
*                IF IDSPLN ^= 0                                    0291
*                  THEN                                            0291
         CLI   IDSPLN(@03),0                                       0291
         BE    @RF00291                                            0291
*                    OPNPWA = ADDR(IDSPAS);                        0292
*                                                                  0292
         LA    @03,IDSPAS(,@03)                                    0292
         ST    @03,OPNPWA(,OPNPTR)                                 0292
*                END;                                              0293
*                                                                  0293
*            END OPENBASE;                                         0294
*                                                                  0294
*          /**********************************************************/
*          /*                                                        */
*          /* OPEN THE ALTERNATE INDEX.  SET UP THE PROCESSING       */
*          /* OPTIONS - OUTPUT, KEYED, RESET, OPEN ALTERNATE INDEX   */
*          /* ONLY.  THE ALTERNATE INDEX CAN BE SPECIFIED IN THE     */
*          /* SAME MANNER AS DESCRIBED ABOVE FOR THE BASE CLUSTER.   */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0295
*          ELSE                                                    0295
*            IF OTYPE = 'A'                                        0295
*              THEN                                                0295
         B     @RC00265                                            0295
@RF00265 L     @03,@PC00002                                        0295
         CLI   OTYPE(@03),C'A'                                     0295
         BNE   @RF00295                                            0295
*OPENAIX:        DO;                                               0296
*                                                                  0296
OPENAIX  DS    0H                                                  0297
*                OPNOPTOT = ON;                                    0297
*                OPNOPTKS = ON;                                    0298
         OI    OPNOPTOT(OPNPTR),B'01001000'                        0298
*                OPNMODAX = ON;                                    0299
*                OPNMODRS = ON;                                    0300
*                                                                  0300
         OI    OPNMODAX(OPNPTR),B'00001100'                        0300
*                IF ADDR(OFILE) ^= NULLPTR                         0301
*                  THEN                                            0301
         SLR   @03,@03                                             0301
         L     @15,@PC00001+4                                      0301
         L     @15,FDTPTR+8(,@15)                                  0301
         CR    @15,@03                                             0301
         BE    @RF00301                                            0301
*                    DO;                                           0302
*                                                                  0302
*                    OPNDDN = ADDR(OFILEVAL(OINDX));               0303
*                                                                  0303
         L     @14,@PC00002+8                                      0303
         L     @14,OINDX(,@14)                                     0303
         MH    @14,@CH01639                                        0303
         LA    @01,0(@14,@15)                                      0303
         AL    @01,@CF01668                                        0303
         ST    @01,OPNDDN(,OPNPTR)                                 0303
*                    IF OFILEPLN(OINDX) ^= 0                       0304
*                      THEN                                        0304
         LA    @01,0(@14,@15)                                      0304
         AL    @01,@CF01669                                        0304
         SLR   @00,@00                                             0304
         IC    @00,OFILEPLN-2(,@01)                                0304
         CR    @03,@00                                             0304
         BE    @RF00304                                            0304
*                        OPNPWA = ADDR(OFILEPAS(OINDX));           0305
*                                                                  0305
         AL    @15,@CF01670                                        0305
         LA    @03,OFILEPAS-3(@14,@15)                             0305
         ST    @03,OPNPWA(,OPNPTR)                                 0305
*                    END;                                          0306
*                                                                  0306
*                  /**************************************************/
*                  /*                                                */
*                  /* THE ALTERNATE INDEX DATA SET NAME HAS BEEN     */
*                  /* SPECIFIED.  IF THE NAME IS UNQUALIFIED, ISSUE  */
*                  /* THE UQUAL MACRO AS DESCRIBED FOR THE BASE      */
*                  /* CLUSTER.  IF ERROR, RETURN WITH A CONDITION    */
*                  /* CODE 8.                                        */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0307
*                  ELSE                                            0307
*                    DO;                                           0307
*                                                                  0307
         B     @RC00301                                            0307
@RF00301 DS    0H                                                  0308
*                    IF ODSFUQ(OINDX) = ON                         0308
*                      THEN                                        0308
         L     @03,@PC00002+8                                      0308
         L     @03,OINDX(,@03)                                     0308
         MH    @03,@CH01640                                        0308
         L     @15,@PC00001+4                                      0308
         L     @15,FDTPTR+12(,@15)                                 0308
         ST    @03,@TF00001                                        0308
         ALR   @03,@15                                             0308
         AL    @03,@CF01671                                        0308
         TM    ODSFUQ-12(@03),B'10000000'                          0308
         BNO   @RF00308                                            0308
*                        DO;                                       0309
*                                                                  0309
*                        QDSNPTR = ADDR(ODSVAL(OINDX));            0310
         L     @03,@TF00001                                        0310
         AL    @03,@CF01672                                        0310
         LA    @03,ODSVAL-23(@03,@15)                              0310
         ST    @03,QDSNPTR                                         0310
*                        QDSNLEN = ODSLEN(OINDX);                  0311
         L     @03,@TF00001                                        0311
         AL    @03,@CF01673                                        0311
         SLR   @14,@14                                             0311
         IC    @14,ODSLEN-22(@03,@15)                              0311
         STH   @14,QDSNLEN                                         0311
*                        QCATPTR = NULLPTR;                        0312
*                                                                  0312
         SLR   @03,@03                                             0312
         ST    @03,QCATPTR                                         0312
*                        IF ODSPLN(OINDX) ^= 0                     0313
*                          THEN                                    0313
         L     @14,@TF00001                                        0313
         AL    @14,@CF01674                                        0313
         SLR   @07,@07                                             0313
         IC    @07,ODSPLN-2(@14,@15)                               0313
         CR    @03,@07                                             0313
         BE    @RF00313                                            0313
*                            QDSNPSWD = ADDR(ODSPAS(OINDX));       0314
*                                                                  0314
         L     @03,@TF00001                                        0314
         AL    @15,@CF01675                                        0314
         LA    @03,ODSPAS-3(@03,@15)                               0314
         ST    @03,QDSNPSWD                                        0314
*                          ELSE                                    0315
*                            QDSNPSWD = NULLPTR;                   0315
*                                                                  0315
         B     @RC00313                                            0315
@RF00313 SLR   @03,@03                                             0315
         ST    @03,QDSNPSWD                                        0315
*                        CALL IDCSAQL0 (GDTTBL,QDSNPTR,QDSNLEN,    0316
*                                QCATPTR,QDSNPSWD);                0316
*                                                                  0316
@RC00313 L     @15,@PC00001                                        0316
         ST    @15,@AL00001                                        0316
         LA    @14,QDSNPTR                                         0316
         ST    @14,@AL00001+4                                      0316
         LA    @14,QDSNLEN                                         0316
         ST    @14,@AL00001+8                                      0316
         LA    @14,QCATPTR                                         0316
         ST    @14,@AL00001+12                                     0316
         LA    @14,QDSNPSWD                                        0316
         ST    @14,@AL00001+16                                     0316
         MVI   @AL00001+16,X'80'                                   0316
         L     @15,GDTQAL(,@15)                                    0316
         LA    @01,@AL00001                                        0316
         BALR  @14,@15                                             0316
*                        RESPECIFY RTNREG RSTD;                    0317
*                        TESTRC = RTNREG;                          0318
         LR    TESTRC,RTNREG                                       0318
*                        RESPECIFY RTNREG UNRSTD;                  0319
*                                                                  0319
*                        IF TESTRC ^= 0                            0320
*                          THEN                                    0320
         LTR   TESTRC,TESTRC                                       0320
         BZ    @RF00320                                            0320
*                            RETURN CODE(LASTCC08);                0321
*                                                                  0321
         LA    @15,8                                               0321
         L     @14,@SA00002                                        0321
         LM    @00,@12,@SA00002+8                                  0321
         BR    @14                                                 0321
*                        END;                                      0322
*                                                                  0322
@RF00320 DS    0H                                                  0323
*                    /************************************************/
*                    /*                                              */
*                    /* REFERENCE THE ALTERNATE INDEX DATA SET NAME  */
*                    /* AND ITS PASSWORD IN THE OPNAGL.              */
*                    /*                                              */
*                    /************************************************/
*                                                                  0323
*                    OPNDSN = ADDR(ODSVAL(OINDX));                 0323
*                                                                  0323
@RF00308 L     @03,@PC00002+8                                      0323
         L     @03,OINDX(,@03)                                     0323
         MH    @03,@CH01640                                        0323
         L     @15,@PC00001+4                                      0323
         L     @15,FDTPTR+12(,@15)                                 0323
         LA    @01,0(@03,@15)                                      0323
         AL    @01,@CF01672                                        0323
         ST    @01,OPNDSN(,OPNPTR)                                 0323
*                    IF ODSPLN(OINDX) ^= 0                         0324
*                      THEN                                        0324
         LA    @01,0(@03,@15)                                      0324
         AL    @01,@CF01674                                        0324
         SLR   @00,@00                                             0324
         IC    @00,ODSPLN-2(,@01)                                  0324
         C     @00,@CF00116                                        0324
         BE    @RF00324                                            0324
*                        OPNPWA = ADDR(ODSPAS(OINDX));             0325
*                                                                  0325
         AL    @15,@CF01675                                        0325
         LA    @03,ODSPAS-3(@03,@15)                               0325
         ST    @03,OPNPWA(,OPNPTR)                                 0325
*                    END;                                          0326
*                                                                  0326
*                END OPENAIX;                                      0327
*                                                                  0327
*              /******************************************************/
*              /*                                                    */
*              /* OPEN A FIRST PASS SORT WORK FILE.  SET UP THE      */
*              /* PROCESSING OPTIONS - OUTPUT, CONTROL INTERVAL,     */
*              /* USER BUFFERS, RESET.                               */
*              /*                                                    */
*              /******************************************************/
*                                                                  0328
*              ELSE                                                0328
*                IF OTYPE = 'S'                                    0328
*                  THEN                                            0328
         B     @RC00295                                            0328
@RF00295 L     @03,@PC00002                                        0328
         CLI   OTYPE(@03),C'S'                                     0328
         BNE   @RF00328                                            0328
*                    DO;                                           0329
*                                                                  0329
*                    OPNOPTOT = ON;                                0330
*                    OPNOPTBK = ON;                                0331
         OI    OPNOPTOT(OPNPTR),B'01010000'                        0331
*                    OPNMODUB = ON;                                0332
*                    OPNMODRS = ON;                                0333
*                                                                  0333
         OI    OPNMODUB(OPNPTR),B'00000110'                        0333
*                    END;                                          0334
*                                                                  0334
*                  /**************************************************/
*                  /*                                                */
*                  /* OPEN A MERGE PASS SORT WORK FILE.  SET UP THE  */
*                  /* PROCESSING OPTIONS - UPDATE, DIRECT, CONTROL   */
*                  /* INTERVAL, USER BUFFERS.                        */
*                  /*                                                */
*                  /**************************************************/
*                                                                  0335
*                  ELSE                                            0335
*                    DO;                                           0335
*                                                                  0335
         B     @RC00328                                            0335
@RF00328 DS    0H                                                  0336
*                    OPNOPTUP = ON;                                0336
*                    OPNOPTDR = ON;                                0337
*                    OPNOPTBK = ON;                                0338
         OI    OPNOPTUP(OPNPTR),B'00110010'                        0338
*                    OPNMODUB = ON;                                0339
*                                                                  0339
         OI    OPNMODUB(OPNPTR),B'00000010'                        0339
*                    END;                                          0340
*                                                                  0340
*        /************************************************************/
*        /*                                                          */
*        /* REFERENCE THE DATA SET NAME FOR A SORT WORK FILE.        */
*        /* USING THE DATA SET NAME CAUSES THE I/O ADAPTER TO        */
*        /* PERFORM DYNAMIC ALLOCATION AS A PART OF UOPEN            */
*        /* PROCESSING.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0341
*        IF OTYPE = 'S'                                           0341
*           OTYPE = 'M'                                            0341
*          THEN                                                    0341
@RC00328 DS    0H                                                  0341
@RC00295 DS    0H                                                  0341
@RC00265 L     @03,@PC00002                                        0341
         CLI   OTYPE(@03),C'S'                                     0341
         BE    @RT00341                                            0341
         CLI   OTYPE(@03),C'M'                                     0341
         BNE   @RF00341                                            0341
@RT00341 DS    0H                                                  0342
*            DO;                                                   0342
*                                                                  0342
*            SWDATPTR = OIOINPT + 4;                               0343
*                                                                  0343
         LA    @03,4                                               0343
         L     @15,@PC00002+12                                     0343
         L     SWDATPTR,OIOINPT(,@15)                              0343
         ALR   SWDATPTR,@03                                        0343
*            IF IODSNID ^= DSNIDMSK                                0344
*              THEN                                                0344
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0344
         BE    @RF00344                                            0344
*                SWDATPTR = SWDATPTR + IODSNLN + 4;                0345
*                                                                  0345
         LR    @05,SWDATPTR                                        0345
         AH    @05,IODSNLN(,SWDATPTR)                              0345
         ALR   @05,@03                                             0345
         LR    SWDATPTR,@05                                        0345
*            OPNDSN = ADDR(IODSN);                                 0346
*                                                                  0346
@RF00344 LA    @05,IODSN(,SWDATPTR)                                0346
         ST    @05,OPNDSN(,OPNPTR)                                 0346
*            END;                                                  0347
*                                                                  0347
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE UOPEN - IF ERROR, RETURN WITH A CONDITION CODE 12  */
*        /* FOR THE BASE CLUSTER AND A CODE 8 FOR ALL OTHERS         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0348
*        CALL IDCIOOP0(GDTTBL,OPNAGL);                             0348
*                                                                  0348
@RF00341 L     @15,@PC00001                                        0348
         ST    @15,@AL00001                                        0348
         ST    OPNPTR,@AL00001+4                                   0348
         MVI   @AL00001+4,X'80'                                    0348
         L     @15,GDTOPN(,@15)                                    0348
         LA    @01,@AL00001                                        0348
         BALR  @14,@15                                             0348
*        RESPECIFY RTNREG RSTD;                                    0349
*        TESTRC = RTNREG;                                          0350
         LR    TESTRC,RTNREG                                       0350
*        RESPECIFY RTNREG UNRSTD;                                  0351
*                                                                  0351
*        IF GDTDBG = NULLPTR                                       0352
*          THEN;                                                   0352
         L     @02,@PC00001                                        0352
         L     @02,GDTDBG(,@02)                                    0352
         LTR   @02,@02                                             0352
         BZ    @RT00352                                            0352
*          ELSE                                                    0354
*            CALL IDCDB010 (GDTTBL,'BIP2');                        0354
*                                                                  0354
         L     @02,@PC00001                                        0354
         ST    @02,@AL00001                                        0354
         LA    @15,@CC01132                                        0354
         ST    @15,@AL00001+4                                      0354
         MVI   @AL00001+4,X'80'                                    0354
         L     @15,GDTDBG(,@02)                                    0354
         LA    @01,@AL00001                                        0354
         BALR  @14,@15                                             0354
*        IF TESTRC ^= 0                                            0355
*          THEN                                                    0355
@RT00352 LTR   TESTRC,TESTRC                                       0355
         BZ    @RF00355                                            0355
*            IF OTYPE = 'B'                                        0356
*              THEN                                                0356
         L     @15,@PC00002                                        0356
         CLI   OTYPE(@15),C'B'                                     0356
         BNE   @RF00356                                            0356
*                RETURN CODE(LASTCC12);                            0357
*                                                                  0357
         LA    @15,12                                              0357
         L     @14,@SA00002                                        0357
         LM    @00,@12,@SA00002+8                                  0357
         BR    @14                                                 0357
*              ELSE                                                0358
*                RETURN CODE(LASTCC08);                            0358
*                                                                  0358
@RF00356 LA    @15,8                                               0358
         L     @14,@SA00002                                        0358
         LM    @00,@12,@SA00002+8                                  0358
         BR    @14                                                 0358
*          /**********************************************************/
*          /*                                                        */
*          /* FOLLOWING A SUCCESSFUL OPEN, VERIFY THAT THE BASE      */
*          /* CLUSTER IS NOT EMPTY.  IF EMPTY, ISSUE MESSAGE AND     */
*          /* RETURN WITH CONDITION CODE 12.  FOR ALL OTHER          */
*          /* SUCCESSFUL OPENS, RETURN WITH A CONDITION CODE 0       */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0359
*          ELSE                                                    0359
*            IF OTYPE = 'B'                                        0359
*              THEN                                                0359
@RF00355 L     @15,@PC00002                                        0359
         CLI   OTYPE(@15),C'B'                                     0359
         BNE   @RF00359                                            0359
*                IF OIOCS -> IOCHURBA = 0                          0360
*                  THEN                                            0360
         L     @15,@PC00002+4                                      0360
         L     @15,OIOCS(,@15)                                     0360
         L     @14,IOCHURBA(,@15)                                  0360
         LTR   @14,@14                                             0360
         BNZ   @RF00360                                            0360
*                    DO;                                           0361
*                                                                  0361
*                    DARGDBP = OIOCS -> IOCDSN;                    0362
         L     @14,DDSTRU                                          0362
         L     @15,IOCDSN(,@15)                                    0362
         ST    @15,DARGDBP(,@14)                                   0362
*                    DARGSTID = BASEMPTY;                          0363
         MVC   DARGSTID(4,@14),@CF00890                            0363
*                    DARGILP = LENGTH(DSNAME);                     0364
*                                                                  0364
         MVC   DARGILP(2,@14),@CH00596                             0364
*                    CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);        0365
*                                                                  0365
         L     @15,@PC00001                                        0365
         ST    @15,@AL00001                                        0365
         LA    @14,@CF00116                                        0365
         ST    @14,@AL00001+4                                      0365
         LA    @14,DDSTRU                                          0365
         ST    @14,@AL00001+8                                      0365
         MVI   @AL00001+8,X'80'                                    0365
         L     @15,GDTPRT(,@15)                                    0365
         LA    @01,@AL00001                                        0365
         BALR  @14,@15                                             0365
*                    RETURN CODE(LASTCC12);                        0366
*                                                                  0366
         LA    @15,12                                              0366
         L     @14,@SA00002                                        0366
         LM    @00,@12,@SA00002+8                                  0366
         BR    @14                                                 0366
*                    END;                                          0367
*                                                                  0367
*                                                                  0367
*        RETURN CODE(LASTCC00);                                    0368
*                                                                  0368
@RF00360 DS    0H                                                  0368
@RF00359 SLR   @15,@15                                             0368
         L     @14,@SA00002                                        0368
         LM    @00,@12,@SA00002+8                                  0368
         BR    @14                                                 0368
*END OPENPROC;                                                     0369
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - JCPROC                                  */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF DETERMINING IF       */
*        /*            THE CALLER OF BLDINDEX HAS PROVIDED SORT WORK */
*        /*            FILE JOB CONTROL AND, IF SO, OF OBTAINING     */
*        /*            THE DATA SET NAMES AND VOLUME SERIAL LISTS.   */
*        /*            THE CALLER CAN SPECIFY DNAMES VIA THE         */
*        /*            WORKFILES PARAMETER OR PROVIDE JOB CONTROL    */
*        /*            USING THE DEFAULT DNAMES OF IDCUT1 AND        */
*        /*            IDCUT2.  IF THE CALLER PROVIDES SORT WORK     */
*        /*            JOB CONTROL, IT WILL BE USED ONLY IF AN       */
*        /*            INTERNAL SORT CANNOT BE PERFORMED. JCPROC     */
*        /*            USES THE UIOINFO MACRO TO DETERMINE IF JOB    */
*        /*            CONTROL EXISTS AND, IF SO, TO OBTAIN THE      */
*        /*            DATA.                                         */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*          JCIOIN - POINTERS TO THE AREA RETURNED BY       */
*        /*                   UIOINFO.  THESE POINTERS WILL BE       */
*        /*                   ZERO IF NO DATA WAS OBTAINED.          */
*        /*                                                          */
*        /* EXIT,NORMAL - RETURN CODE 0, JOB CONTROL DATA SUCCESS-   */
*        /*                              FULLY OBTAINED OR, IF NOT,  */
*        /*                              THE EXTERNALSORT PARAMETER  */
*        /*                              WAS NOT SPECIFIED           */
*        /*                                                          */
*        /* EXIT,ERROR  - RETURN CODE 12, JOB CONTROL DATA WAS NOT   */
*        /*                               OBTAINED AND THE EXTERNAL- */
*        /*                               SORT PARAMETER WAS         */
*        /*                               SPECIFIED                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0370
*JCPROC:                                                           0370
*        PROCEDURE (JCIOIN);           /* PTRS TO DATA OBTAINED      */
*                                                                  0370
JCPROC   STM   @14,@12,@SA00003                                    0370
         MVC   @PC00003(4),0(@01)                                  0370
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0371
*        DCL 1 JCIOIN BDY(WORD),       /* POINTERS TO UIOINFO        */
*              2 JCIOINPT(2) PTR(31);  /* RETURN AREAS               */
*                                                                  0371
*                                                                  0371
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0372
*        DCL                                                       0372
*          JC    FIXED(31),                                        0372
*          STOPJ BIT(1);                                           0372
*                                                                  0372
*        /************************************************************/
*        /*                                                          */
*        /* DNAME TO BE PASSED TO UIOINFO                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0373
*        DCL SWFDNAME CHAR(8);                                     0373
*                                                                  0373
*        /************************************************************/
*        /*                                                          */
*        /* UIOINFO OPTION BYTE                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0374
*        DCL UIOINOPT CHAR(1);                                     0374
*                                                                  0374
*        RFY IOINFOPT BASED(ADDR(UIOINOPT));                       0375
*                                                                  0375
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZATION - SET UP UIOINFO OPTION BYTE              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0376
*        OLDERID2 = NEWERID2;                                      0376
         L     @15,@PC00001                                        0376
         L     @15,GDTTR2(,@15)                                    0376
         MVC   @TS00001(95),NEWERID2(@15)                          0376
         MVC   OLDERID2(95,@15),@TS00001                           0376
*        NEWID2 = 'BIJ1';                                          0377
*                                                                  0377
         MVC   NEWID2(4,@15),@CC01145                              0377
*        IOINFOPT = ''B;                                           0378
         LA    @15,UIOINOPT                                        0378
         MVI   IOINFOPT(@15),X'00'                                 0378
*        IOINFVOL = ON;                                            0379
*        IOINFDSN = ON;                                            0380
*        IOINFSUP = ON;                                            0381
         OI    IOINFVOL(@15),B'01110000'                           0381
*        STOPJ = OFF;                                              0382
*                                                                  0382
         NI    STOPJ,B'01111111'                                   0382
*        /************************************************************/
*        /*                                                          */
*        /* UIOINFO LOOP - SET UP DNAME TO BE REFERENCED.  USE       */
*        /* WORKFILES PARAMETER IF SPECIFIED - OTHERWISE USE         */
*        /* DEFAULT DNAMES                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0383
*        DO JC =1 TO 2 WHILE STOPJ = OFF;                          0383
*                                                                  0383
         LA    JC,1                                                0383
@DL00383 TM    STOPJ,B'10000000'                                   0383
         BNZ   @DC00383                                            0383
*          IF ADDR(WFILE) ^= NULLPTR                               0384
*            THEN                                                  0384
         L     @03,@PC00001+4                                      0384
         L     @15,FDTPTR+20(,@03)                                 0384
         LTR   @15,@15                                             0384
         BZ    @RF00384                                            0384
*              IF JC = 1                                           0385
*                THEN                                              0385
         C     JC,@CF00220                                         0385
         BNE   @RF00385                                            0385
*                  SWFDNAME = WFLE1VAL;                            0386
*                                                                  0386
         L     @03,FDTPTR+24(,@03)                                 0386
         MVC   SWFDNAME(8),WFLE1VAL(@03)                           0386
*                ELSE                                              0387
*                  SWFDNAME = WFLE2VAL;                            0387
*                                                                  0387
         B     @RC00385                                            0387
@RF00385 L     @03,@PC00001+4                                      0387
         L     @03,FDTPTR+28(,@03)                                 0387
         MVC   SWFDNAME(8),WFLE2VAL(@03)                           0387
*            ELSE                                                  0388
*              SWFDNAME = DEFDDN(JC);                              0388
*                                                                  0388
         B     @RC00384                                            0388
@RF00384 LR    @03,JC                                              0388
         SLA   @03,3                                               0388
         LA    @01,DEFDDN-8(@03)                                   0388
         MVC   SWFDNAME(8),0(@01)                                  0388
*          /**********************************************************/
*          /*                                                        */
*          /* ISSUE UIOINFO                                          */
*          /*                                                        */
*          /**********************************************************/
*                                                                  0389
*          CALL IDCIOSI0 (GDTTBL,IOINFOPT,JCIOINPT(JC),SWFDNAME,   0389
*                   UGPID01);                                      0389
*                                                                  0389
@RC00384 L     @15,@PC00001                                        0389
         ST    @15,@AL00001                                        0389
         LA    @14,UIOINOPT                                        0389
         ST    @14,@AL00001+4                                      0389
         LR    @14,JC                                              0389
         SLA   @14,2                                               0389
         L     @07,@PC00003                                        0389
         AL    @07,@CF01678                                        0389
         LA    @14,JCIOINPT(@14,@07)                               0389
         ST    @14,@AL00001+8                                      0389
         LA    @14,SWFDNAME                                        0389
         ST    @14,@AL00001+12                                     0389
         LA    @14,UGPID01                                         0389
         ST    @14,@AL00001+16                                     0389
         MVI   @AL00001+16,X'80'                                   0389
         L     @15,GDTIFO(,@15)                                    0389
         LA    @01,@AL00001                                        0389
         BALR  @14,@15                                             0389
*          RESPECIFY RTNREG RSTD;                                  0390
*          TESTRC = RTNREG;                                        0391
         LR    TESTRC,RTNREG                                       0391
*          RESPECIFY RTNREG UNRSTD;                                0392
*                                                                  0392
*          IF TESTRC ^= 0                                          0393
*            THEN                                                  0393
         LTR   TESTRC,TESTRC                                       0393
         BZ    @RF00393                                            0393
*              STOPJ = ON;                                         0394
*                                                                  0394
         OI    STOPJ,B'10000000'                                   0394
*        END;                                                      0395
*                                                                  0395
@RF00393 AL    JC,@CF00220                                         0395
         C     JC,@CF00154                                         0395
         BNH   @DL00383                                            0395
@DC00383 DS    0H                                                  0396
*        IF GDTDBG = NULLPTR                                       0396
*          THEN;                                                   0396
         L     @15,@PC00001                                        0396
         L     @15,GDTDBG(,@15)                                    0396
         LTR   @15,@15                                             0396
         BZ    @RT00396                                            0396
*          ELSE                                                    0398
*            CALL IDCDB010 (GDTTBL,'BIJ2');                        0398
*                                                                  0398
         L     @15,@PC00001                                        0398
         ST    @15,@AL00001                                        0398
         LA    @14,@CC01146                                        0398
         ST    @14,@AL00001+4                                      0398
         MVI   @AL00001+4,X'80'                                    0398
         L     @15,GDTDBG(,@15)                                    0398
         LA    @01,@AL00001                                        0398
         BALR  @14,@15                                             0398
*        /************************************************************/
*        /*                                                          */
*        /* IF UIOINFO WAS NOT SUCCESSFUL FOR BOTH SORT WORK FILES,  */
*        /* ZERO POINTERS TO RETURN AREAS - ISSUE ERROR MESSAGE IF   */
*        /* EXTERNALSORT PARAMETER WAS SPECIFIED                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0399
*        IF STOPJ = ON                                             0399
*          THEN                                                    0399
@RT00396 TM    STOPJ,B'10000000'                                   0399
         BNO   @RF00399                                            0399
*            DO;                                                   0400
*                                                                  0400
*            JCIOIN = ''B;                                         0401
*                                                                  0401
         L     @15,@PC00003                                        0401
         XC    JCIOIN(8,@15),JCIOIN(@15)                           0401
*            IF ADDR(ESORT) ^= NULLPTR                             0402
*              THEN                                                0402
         L     @15,@PC00001+4                                      0402
         L     @15,FDTPTR+32(,@15)                                 0402
         LTR   @15,@15                                             0402
         BZ    @RF00402                                            0402
*                DO;                                               0403
*                                                                  0403
*                DARGSTID = JCLERROR;                              0404
         L     @01,DDSTRU                                          0404
         MVC   DARGSTID(4,@01),@CF00900                            0404
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0405
*                                                                  0405
         L     @15,@PC00001                                        0405
         ST    @15,@AL00001                                        0405
         LA    @14,@CF00116                                        0405
         ST    @14,@AL00001+4                                      0405
         LA    @14,DDSTRU                                          0405
         ST    @14,@AL00001+8                                      0405
         MVI   @AL00001+8,X'80'                                    0405
         L     @15,GDTPRT(,@15)                                    0405
         LA    @01,@AL00001                                        0405
         BALR  @14,@15                                             0405
*                RETURN CODE(LASTCC12);                            0406
*                                                                  0406
         LA    @15,12                                              0406
         L     @14,@SA00003                                        0406
         LM    @00,@12,@SA00003+8                                  0406
         BR    @14                                                 0406
*                END;                                              0407
*                                                                  0407
*            END;                                                  0408
*                                                                  0408
@RF00402 DS    0H                                                  0409
*        RETURN CODE(LASTCC00);                                    0409
@RF00399 SLR   @15,@15                                             0409
         L     @14,@SA00003                                        0409
         LM    @00,@12,@SA00003+8                                  0409
         BR    @14                                                 0409
*END JCPROC;                                                       0410
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - MAINPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF CONTROLLING THE      */
*        /*            BUILD PROCESS FOR AN ALTERNATE INDEX.         */
*        /*            THIS PROCESS IS ACCOMPLISHED BY CALLING       */
*        /*            THIRD LEVEL PROCEDURES AS FOLLOWS -           */
*        /*                                                          */
*        /*                OPENPROC - OPEN THE AIX                   */
*        /*                                                          */
*        /*                LOCPROC  - PERFORM VSAM CATALOG LOCATE    */
*        /*                           FUNCTIONS TO OBTAIN INFORMA-   */
*        /*                           TION REGARDING THE BASE        */
*        /*                           CLUSTER AND AIX.               */
*        /*                                                          */
*        /*                INITPROC - DETERMINE THE RESOURCES        */
*        /*                           REQUIRED FOR SORTING,          */
*        /*                           INITIALIZE FOR SORTING AND     */
*        /*                           OBTAIN RESOURCES               */
*        /*                                                          */
*        /*                CNTLPROC - READ THE BASE CLUSTER AND      */
*        /*                           CONTROL THE SORT-MERGE AND     */
*        /*                           BUILDING OF AIX RECORDS        */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*         MAINI - CURRENT VALUE OF THE VARIABLE CONTROL-   */
*        /*                 LING THE MAIN BUILD AIX LOOP IN THE      */
*        /*                 HIGHEST LEVEL PROCEDURE                  */
*        /*                                                          */
*        /*      MAINAMDS - POINTERS TO AMDSB AREAS                  */
*        /*                                                          */
*        /*      MAINIOCS - AREA CONTAINING THE ADDRESSES OF THE     */
*        /*                 IOCSTR FOR EACH OPEN DATA SET            */
*        /*                                                          */
*        /*      MAINIOIN - AREA CONTAINING THE ADDRESSES OF THE     */
*        /*                 DATA OBTAINED FROM THE SORT WORK JOB     */
*        /*                 CONTROL                                  */
*        /*                                                          */
*        /*      MAINSTAT - STATUS COMMUNICATION AREA                */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*                                                          */
*        /*      MAINSTAT - STATUS COMMUNICATION AREA CONTAINING     */
*        /*                 THE FINAL STATUS OF THE AIX              */
*        /*                                                          */
*        /* EXIT,NORMAL -   RETURN CODE 0, AIX HAS BEEN SUCCESS-     */
*        /*                                FULLY BUILT               */
*        /*                                                          */
*        /* EXIT,ERROR -                                             */
*        /*                 RETURN CODE 4, AIX HAS BEEN BUILT WITH   */
*        /*                                NON-TERMINATING ERRORS    */
*        /*                                                          */
*        /*                 RETURN CODE 8, AIX WAS NOT BUILT         */
*        /*                                                          */
*        /*                 RETURN CODE 12, TERMINATING BASE         */
*        /*                                 CLUSTER ERROR            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0411
*MAINPROC:                                                         0411
*        PROCEDURE (MAINI,             /* LOOP CONTROL VARIABLE      */
*                   MAINAMDS,          /* POINTERS TO AMDSB AREAS    */
*                   MAINIOCS,          /* POINTERS TO IOCSTRS        */
*                   MAINIOIN,          /* POINTERS TO JOB CNTRL DATA */
*                   MAINSTAT);         /* STATUS COMMUNICATION AREA  */
*                                                                  0411
MAINPROC STM   @14,@12,@SA00004                                    0411
         MVC   @PC00004(20),0(@01)                                 0411
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0412
*        DCL MAINI FIXED(31);           /* INDEX VALUE TO CURRENT AIX*/
*                                                                  0412
*        DCL 1 MAINAMDS BDY(WORD),      /* POINTERS TO AMDSBS        */
*              2 MAIAMBAS PTR(31),      /* POINTER TO BASE AMDSB     */
*              2 MAIAMAIX PTR(31);      /* POINTER TO AIX AMDSB      */
*                                                                  0413
*        DCL 1 MAINIOCS BDY(WORD),      /* POINTERS TO IOCSTR FOR    */
*              2 MAIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */
*                                                                  0414
*        DCL 1 MAINIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */
*              2 MAIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */
*                                       /* JOB CONTROL DATA          */
*        DCL 1 MAINSTAT,                                           0416
*              2 MASAVERC FIXED(15),    /* CURRENT CONDITION CODE    */
*              2 MASTID   CHAR(4);      /* ERROR IDENTIFIERS         */
*        /************************************************************/
*        /*                                                          */
*        /* CALL OPENPROC TO OPEN THE ALTERNATE INDEX.  IF AN        */
*        /* ERROR HAS OCCURRED, RETURN WITH A CONDITION CODE 8       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0417
*        OLDERID2 = NEWERID2;                                      0417
         L     @15,@PC00001                                        0417
         L     @15,GDTTR2(,@15)                                    0417
         MVC   @TS00001(95),NEWERID2(@15)                          0417
         MVC   OLDERID2(95,@15),@TS00001                           0417
*        NEWID2 = 'BI02';                                          0418
*                                                                  0418
         MVC   NEWID2(4,@15),@CC01166                              0418
*        CALL OPENPROC ('A',MAIOCSPT(2),MAINI,NULLPTR);            0419
*                                                                  0419
         LA    @15,@CC00721                                        0419
         ST    @15,@AL00001                                        0419
         L     @15,@PC00004+8                                      0419
         LA    @15,MAIOCSPT+4(,@15)                                0419
         ST    @15,@AL00001+4                                      0419
         L     @15,@PC00004                                        0419
         ST    @15,@AL00001+8                                      0419
         LA    @15,@CF00116                                        0419
         ST    @15,@AL00001+12                                     0419
         LA    @01,@AL00001                                        0419
         BAL   @14,OPENPROC                                        0419
*        RESPECIFY RTNREG RSTD;                                    0420
*        TESTRC = RTNREG;                                          0421
         LR    TESTRC,RTNREG                                       0421
*        RESPECIFY RTNREG UNRSTD;                                  0422
*                                                                  0422
*        IF TESTRC ^= 0                                            0423
*          THEN                                                    0423
         LTR   TESTRC,TESTRC                                       0423
         BZ    @RF00423                                            0423
*            DO;                                                   0424
*                                                                  0424
*            MASAVERC = LASTCC08;                                  0425
         L     @15,@PC00004+16                                     0425
         MVC   MASAVERC(2,@15),@CH00180                            0425
*            RETURN;                                               0426
*                                                                  0426
@EL00004 DS    0H                                                  0426
@EF00004 DS    0H                                                  0426
@ER00004 LM    @14,@12,@SA00004                                    0426
         BR    @14                                                 0426
*            END;                                                  0427
*                                                                  0427
*        /************************************************************/
*        /*                                                          */
*        /* CALL LOCPROC TO OBTAIN INFORMATION RE THE BASE CLUSTER   */
*        /* AND AIX AND VERIFY THEIR RELATIONSHIP.  IF AN ERROR      */
*        /* HAS OCCURRED, PASS THE CONDITION CODE BACK TO THE        */
*        /* CALLING PROCEDURE (HIGHEST LEVEL)                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0428
*        MAIAMBAS = ADDR(DSBBAREA);                                0428
@RF00423 L     @15,@PC00004+4                                      0428
         LA    @14,DSBBAREA                                        0428
         ST    @14,MAIAMBAS(,@15)                                  0428
*        MAIAMAIX = ADDR(DSBAAREA);                                0429
*                                                                  0429
         LA    @14,DSBAAREA                                        0429
         ST    @14,MAIAMAIX(,@15)                                  0429
*        CALL LOCPROC (MAINAMDS,MAINIOCS,MAINI,MAINSTAT);          0430
*                                                                  0430
         ST    @15,@AL00001                                        0430
         L     @15,@PC00004+8                                      0430
         ST    @15,@AL00001+4                                      0430
         L     @15,@PC00004                                        0430
         ST    @15,@AL00001+8                                      0430
         L     @15,@PC00004+16                                     0430
         ST    @15,@AL00001+12                                     0430
         LA    @01,@AL00001                                        0430
         BAL   @14,LOCPROC                                         0430
*        RESPECIFY RTNREG RSTD;                                    0431
*        TESTRC = RTNREG;                                          0432
         LR    TESTRC,RTNREG                                       0432
*        RESPECIFY RTNREG UNRSTD;                                  0433
*                                                                  0433
*        IF GDTDBG = NULLPTR                                       0434
*          THEN;                                                   0434
         L     @02,@PC00001                                        0434
         L     @02,GDTDBG(,@02)                                    0434
         LTR   @02,@02                                             0434
         BZ    @RT00434                                            0434
*          ELSE                                                    0436
*            CALL IDCDB010 (GDTTBL,'BI03');                        0436
*                                                                  0436
         L     @02,@PC00001                                        0436
         ST    @02,@AL00001                                        0436
         LA    @15,@CC01168                                        0436
         ST    @15,@AL00001+4                                      0436
         MVI   @AL00001+4,X'80'                                    0436
         L     @15,GDTDBG(,@02)                                    0436
         LA    @01,@AL00001                                        0436
         BALR  @14,@15                                             0436
*        IF TESTRC ^= 0                                            0437
*          THEN                                                    0437
@RT00434 LTR   TESTRC,TESTRC                                       0437
         BZ    @RF00437                                            0437
*            DO;                                                   0438
*                                                                  0438
*            MASAVERC = TESTRC;                                    0439
         L     @02,@PC00004+16                                     0439
         STH   TESTRC,MASAVERC(,@02)                               0439
*            RETURN;                                               0440
*                                                                  0440
         B     @EL00004                                            0440
*            END;                                                  0441
*                                                                  0441
*        /************************************************************/
*        /*                                                          */
*        /* CALL INITPROC TO OBTAIN RESOURCES FOR BUILDING THIS      */
*        /* ALTERNATE INDEX.  RESOURCES CONSIST OF CORE FOR          */
*        /* BUFFERS AND WORK AREAS, CORE FOR THE ACTUAL SORT AND     */
*        /* DEFINED AND OPENED SORT WORK FILES IF IT IS DETERMINED   */
*        /* THAT SUCH ARE REQUIRED.  IF AN ERROR OCCURS, RETURN      */
*        /* WITH A CONDITION CODE 8.                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0442
*        CALL INITPROC (MAINAMDS,MAINIOCS,MAINIOIN,                0442
*                       SRTCTLTB,MAINSTAT);                        0442
*                                                                  0442
@RF00437 L     @15,@PC00004+4                                      0442
         ST    @15,@AL00001                                        0442
         L     @15,@PC00004+8                                      0442
         ST    @15,@AL00001+4                                      0442
         L     @15,@PC00004+12                                     0442
         ST    @15,@AL00001+8                                      0442
         LA    @15,SRTCTLTB                                        0442
         ST    @15,@AL00001+12                                     0442
         L     @15,@PC00004+16                                     0442
         ST    @15,@AL00001+16                                     0442
         LA    @01,@AL00001                                        0442
         BAL   @14,INITPROC                                        0442
*        RESPECIFY RTNREG RSTD;                                    0443
*        TESTRC = RTNREG;                                          0444
         LR    TESTRC,RTNREG                                       0444
*        RESPECIFY RTNREG UNRSTD;                                  0445
*                                                                  0445
*        IF TESTRC ^= 0                                            0446
*          THEN                                                    0446
         LTR   TESTRC,TESTRC                                       0446
         BZ    @RF00446                                            0446
*            DO;                                                   0447
*                                                                  0447
*            MASAVERC = LASTCC08;                                  0448
         L     @15,@PC00004+16                                     0448
         MVC   MASAVERC(2,@15),@CH00180                            0448
*            RETURN;                                               0449
*                                                                  0449
         B     @EL00004                                            0449
*            END;                                                  0450
*                                                                  0450
*        /************************************************************/
*        /*                                                          */
*        /* CALL CNTLPROC TO PERFORM THE ACTUAL BUILDING OF THE      */
*        /* ALTERNATE INDEX.  CNTLPROC READS THE BASE CLUSTER        */
*        /* RECORDS AND CALLS LOWER LEVEL PROCEDURES TO CREATE THE   */
*        /* SORT RECORDS, PERFORM THE SORT AND BUILD THE ALTERNATE   */
*        /* INDEX.  ON RETURN TO MAINPROC, THE FINAL CONDITION       */
*        /* CODE FOR THIS ALTERNATE INDEX HAS BEEN PLACED IN THE     */
*        /* STATUS COMMUNICATION AREA WHERE IT WILL BE USED IN       */
*        /* FINPROC.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0451
*        CALL CNTLPROC (MAINAMDS,MAINIOCS,MAINIOIN,                0451
*                       SRTCTLTB,MAINSTAT);                        0451
*                                                                  0451
@RF00446 L     @15,@PC00004+4                                      0451
         ST    @15,@AL00001                                        0451
         L     @15,@PC00004+8                                      0451
         ST    @15,@AL00001+4                                      0451
         L     @15,@PC00004+12                                     0451
         ST    @15,@AL00001+8                                      0451
         LA    @15,SRTCTLTB                                        0451
         ST    @15,@AL00001+12                                     0451
         L     @15,@PC00004+16                                     0451
         ST    @15,@AL00001+16                                     0451
         LA    @01,@AL00001                                        0451
         BAL   @14,CNTLPROC                                        0451
*        IF GDTDBG = NULLPTR                                       0452
*          THEN;                                                   0452
         L     @15,@PC00001                                        0452
         L     @15,GDTDBG(,@15)                                    0452
         LTR   @15,@15                                             0452
         BZ    @RT00452                                            0452
*          ELSE                                                    0454
*            CALL IDCDB010 (GDTTBL,'BI04');                        0454
*                                                                  0454
         L     @15,@PC00001                                        0454
         ST    @15,@AL00001                                        0454
         LA    @14,@CC01171                                        0454
         ST    @14,@AL00001+4                                      0454
         MVI   @AL00001+4,X'80'                                    0454
         L     @15,GDTDBG(,@15)                                    0454
         LA    @01,@AL00001                                        0454
         BALR  @14,@15                                             0454
*        /************************************************************/
*        /*                                                          */
*        /* MAINPROC HAS COMPLETED FOR THIS ALTERNATE INDEX.         */
*        /* RETURN TO THE CALLING PROCEDURE (HIGHEST LEVEL).         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0455
*        RETURN;                                                   0455
         B     @EL00004                                            0455
*END MAINPROC;                                                     0456
         B     @EL00004                                            0456
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - FINPROC                                 */
*        /*                                                          */
*        /* FUNCTION - PERFORMS CLEANUP FOLLOWING THE BUILD OF       */
*        /*            ONE ALTERNATE INDEX, CONSISTING OF            */
*        /*                                                          */
*        /*              . PRINT OUTSTANDING ERROR MESSAGE           */
*        /*                                                          */
*        /*              . PRINT AIX FINAL STATUS MESSAGE            */
*        /*                                                          */
*        /*              . CLOSE AIX AND, OPTIONALLY, SORT WORK      */
*        /*                FILES                                     */
*        /*                                                          */
*        /*              . FREE CORE USED FOR BUILDING THE AIX       */
*        /*                JUST COMPLETED                            */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        FINIOCS - AREA CONTAINING THE ADDRESSES OF THE    */
*        /*                  IOCSTR FOR EACH OPEN DATA SET           */
*        /*                                                          */
*        /*        FINSTAT - STATUS COMMUNICATION AREA CONTAINING    */
*        /*                  OUTSTANDING ERROR MESSAGE ID AND CURRENT*/
*        /*                  CONDITION CODE                          */
*        /* OUTPUT                                                   */
*        /*       - ERROR AND AIX STATUS MESSAGES ARE PRINTED        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0457
*FINPROC:                                                          0457
*        PROCEDURE (FINIOCS,            /* POINTERS TO IOCSTR FOR    */
*                                       /* EACH OPEN DATA SET        */
*                   FINSTAT);           /* STATUS COMMUNICATION AREA */
*                                                                  0457
FINPROC  STM   @14,@12,@SA00005                                    0457
         MVC   @PC00005(8),0(@01)                                  0457
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0458
*        DCL 1 FINIOCS BDY(WORD),       /* IOCSTR ADDRESSES          */
*              2 FIIOCSBS PTR(31),      /* BASE CLUSTER IOCSTR       */
*              2 FIIOCSAX PTR(31),      /* AIX IOCSTR                */
*              2 FIIOCSSR(2) PTR(31);   /* SORT WORK FILE IOCSTR(2)  */
*                                                                  0458
*        DCL 1 FINSTAT,                 /* STATUS COMMUNICATION AREA */
*              2 FISAVERC FIXED(15),    /* CURRENT CONDITION CODE    */
*              2 FISTID   CHAR(4);      /* ERROR IDENTIFIERS         */
*                                                                  0459
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL VARIABLE                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0460
*        DCL FN    FIXED(31);                                      0460
*                                                                  0460
*        /************************************************************/
*        /*                                                          */
*        /* AREA TO SAVE NAME OF ALTERNATE INDEX FOR MESSAGE         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0461
*        DCL FINAIXNM CHAR(44);                                    0461
*                                                                  0461
*        /************************************************************/
*        /*                                                          */
*        /* AREA CONTAINING THE ERROR CONVERSION TABLE USED BY       */
*        /* UERROR TO PRINT PROSE MESSAGES FOR CATALOG ERROR RETURN  */
*        /* CODES.                                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0462
*        DCL ERRTAB CHAR(LENGTH(ERCNVTAB));                        0462
*                                                                  0462
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLES AND CONSTANTS USED IN PRINTING OF ERROR        */
*        /* MESSAGES.                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0463
*        DCL NOERROR BIT(32) CONSTANT('00000000'X);                0463
*        /************************************************************/
*        /*                                                          */
*        /* IF THE ALTERNATE INDEX IS OPEN, CLOSE IT                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0464
*        OLDERID2 = NEWERID2;                                      0464
         L     @15,@PC00001                                        0464
         L     @14,GDTTR2(,@15)                                    0464
         MVC   @TS00001(95),NEWERID2(@14)                          0464
         MVC   OLDERID2(95,@14),@TS00001                           0464
*        NEWID2 = 'BIFI';                                          0465
*                                                                  0465
         MVC   NEWID2(4,@14),@CC01189                              0465
*        IF FIIOCSAX ^= NULLPTR                                    0466
*          THEN                                                    0466
         L     @14,@PC00005                                        0466
         L     @07,FIIOCSAX(,@14)                                  0466
         LTR   @07,@07                                             0466
         BZ    @RF00466                                            0466
*            DO;                                                   0467
*                                                                  0467
*            FINAIXNM = FIIOCSAX -> IOCDSN -> DSNAME;              0468
*                                                                  0468
         L     @02,IOCDSN(,@07)                                    0468
         MVC   FINAIXNM(44),DSNAME(@02)                            0468
*            CALL IDCIOCL0 (GDTTBL,FIIOCSAX);                      0469
*                                                                  0469
         ST    @15,@AL00001                                        0469
         LA    @02,FIIOCSAX(,@14)                                  0469
         ST    @02,@AL00001+4                                      0469
         MVI   @AL00001+4,X'80'                                    0469
         L     @15,GDTCLS(,@15)                                    0469
         LA    @01,@AL00001                                        0469
         BALR  @14,@15                                             0469
*            RESPECIFY RTNREG RSTD;                                0470
*            TESTRC = RTNREG;                                      0471
         LR    TESTRC,RTNREG                                       0471
*            RESPECIFY RTNREG UNRSTD;                              0472
*                                                                  0472
*            IF TESTRC ^= 0 &                                      0473
*               FISAVERC < LASTCC08                                0473
*              THEN                                                0473
         LTR   TESTRC,TESTRC                                       0473
         BZ    @RF00473                                            0473
         L     @02,@PC00005+4                                      0473
         LH    @15,FISAVERC(,@02)                                  0473
         C     @15,@CF00180                                        0473
         BNL   @RF00473                                            0473
*                FISAVERC = LASTCC04;                              0474
*                                                                  0474
         MVC   FISAVERC(2,@02),@CH00043                            0474
*            FIIOCSAX = NULLPTR;                                   0475
*                                                                  0475
@RF00473 L     @15,@PC00005                                        0475
         SLR   @14,@14                                             0475
         ST    @14,FIIOCSAX(,@15)                                  0475
*            END;                                                  0476
*                                                                  0476
*        /************************************************************/
*        /*                                                          */
*        /* IF SORT WORK FILES ARE OPEN, CLOSE THEM                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0477
*        DO FN = 1 TO 2;                                           0477
*                                                                  0477
@RF00466 LA    FN,1                                                0477
@DL00477 DS    0H                                                  0478
*          IF FIIOCSSR(FN) ^= NULLPTR                              0478
*            THEN                                                  0478
         LR    @03,FN                                              0478
         SLA   @03,2                                               0478
         L     @15,@PC00005                                        0478
         L     @14,FIIOCSSR-4(@03,@15)                             0478
         LTR   @14,@14                                             0478
         BZ    @RF00478                                            0478
*              DO;                                                 0479
*                                                                  0479
         ST    @03,@TF00001                                        0479
*              CALL IDCIOCL0 (GDTTBL,FIIOCSSR(FN));                0480
*                                                                  0480
         L     @14,@PC00001                                        0480
         ST    @14,@AL00001                                        0480
         L     @01,@TF00001                                        0480
         LA    @15,FIIOCSSR-4(@01,@15)                             0480
         ST    @15,@AL00001+4                                      0480
         MVI   @AL00001+4,X'80'                                    0480
         L     @15,GDTCLS(,@14)                                    0480
         LA    @01,@AL00001                                        0480
         BALR  @14,@15                                             0480
*              RESPECIFY RTNREG RSTD;                              0481
*              TESTRC = RTNREG;                                    0482
         LR    TESTRC,RTNREG                                       0482
*              RESPECIFY RTNREG UNRSTD;                            0483
*                                                                  0483
*              IF TESTRC ^= 0 &                                    0484
*                 FISAVERC < LASTCC08                              0484
*                THEN                                              0484
         LTR   TESTRC,TESTRC                                       0484
         BZ    @RF00484                                            0484
         L     @15,@PC00005+4                                      0484
         LH    @14,FISAVERC(,@15)                                  0484
         C     @14,@CF00180                                        0484
         BNL   @RF00484                                            0484
*                  FISAVERC = LASTCC04;                            0485
*                                                                  0485
         MVC   FISAVERC(2,@15),@CH00043                            0485
*              FIIOCSSR(FN) = NULLPTR;                             0486
*                                                                  0486
@RF00484 LR    @03,FN                                              0486
         SLA   @03,2                                               0486
         L     @15,@PC00005                                        0486
         SLR   @14,@14                                             0486
         ST    @14,FIIOCSSR-4(@03,@15)                             0486
*              END;                                                0487
*                                                                  0487
*        END;                                                      0488
*                                                                  0488
@RF00478 AL    FN,@CF00220                                         0488
         C     FN,@CF00154                                         0488
         BNH   @DL00477                                            0488
*        /************************************************************/
*        /*                                                          */
*        /* THE STATUS COMMUNICATION AREA CONTAINS A MESSAGE ID  IF  */
*        /* AN ERROR MESSAGE IS TO BE PRINTED.                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0489
*        IF FISTID ^= NOERROR                                      0489
*          THEN                                                    0489
         L     @15,@PC00005+4                                      0489
         CLC   FISTID(4,@15),@CB01188                              0489
         BE    @RF00489                                            0489
*            DO;                                                   0490
*                                                                  0490
*            DARGAREA = ''B;                                       0491
*                                                                  0491
         XC    DARGAREA(44),DARGAREA                               0491
*            /********************************************************/
*            /*                                                      */
*            /* SET UP THE DATA SET NAME IF REQUIRED FOR THE         */
*            /* MESSAGE.                                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0492
*            IF FISTID = INVALAIX                                 0492
*               FISTID = NOTRELAT                                 0492
*               FISTID = INVALBAS                                 0492
*               FISTID = LOCRTNER                                  0492
*              THEN                                                0492
         CLC   FISTID(4,@15),@CB00884                              0492
         BE    @RT00492                                            0492
         CLC   FISTID(4,@15),@CB00888                              0492
         BE    @RT00492                                            0492
         CLC   FISTID(4,@15),@CB00886                              0492
         BE    @RT00492                                            0492
         CLC   FISTID(4,@15),@CB00914                              0492
         BNE   @RF00492                                            0492
@RT00492 DS    0H                                                  0493
*                DO;                                               0493
*                                                                  0493
*                DARGILP = LENGTH(DSNAME);                         0494
*                                                                  0494
         L     @15,DDSTRU                                          0494
         MVC   DARGILP(2,@15),@CH00596                             0494
*                IF FISAVERC = LASTCC12                            0495
*                  THEN                                            0495
         L     @14,@PC00005+4                                      0495
         CLC   FISAVERC(2,@14),@CH00035                            0495
         BNE   @RF00495                                            0495
*                    DARGDBP = FIIOCSBS -> IOCDSN;                 0496
*                                                                  0496
         L     @14,@PC00005                                        0496
         L     @01,FIIOCSBS(,@14)                                  0496
         L     @14,IOCDSN(,@01)                                    0496
         ST    @14,DARGDBP(,@15)                                   0496
*                  ELSE                                            0497
*                    DARGDBP = ADDR(FINAIXNM);                     0497
*                                                                  0497
         B     @RC00495                                            0497
@RF00495 LA    @15,FINAIXNM                                        0497
         L     @14,DDSTRU                                          0497
         ST    @15,DARGDBP(,@14)                                   0497
*                END;                                              0498
*                                                                  0498
@RC00495 DS    0H                                                  0499
*            /********************************************************/
*            /*                                                      */
*            /* FOR CATALOG ERRORS FROM LOCATE OR DEFINE SET UP      */
*            /* THE ERROR CONVERSION TABLE AND CALL UERROR TO PRINT  */
*            /* THE PROSE ERROR MESSAGE.                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0499
*            IF FISTID = LOCATERR                                 0499
*               FISTID = DEFERROR                                  0499
*              THEN                                                0499
@RF00492 L     @15,@PC00005+4                                      0499
         CLC   FISTID(4,@15),@CB00920                              0499
         BE    @RT00499                                            0499
         CLC   FISTID(4,@15),@CB00906                              0499
         BNE   @RF00499                                            0499
@RT00499 DS    0H                                                  0500
*                DO;                                               0500
*                                                                  0500
*                ERCNVADR = ADDR(ERRTAB);                          0501
         LA    @15,ERRTAB                                          0501
         ST    @15,ERCNVADR                                        0501
*                ERCNVTAB = ''B;                                   0502
         XC    ERCNVTAB(32,@15),ERCNVTAB(@15)                      0502
*                ERCATLG  = ON;                                    0503
         OI    ERCATLG(@15),B'10000000'                            0503
*                ERCATRC  = CATRETCC;                              0504
         LH    @14,CATRETCC                                        0504
         ST    @14,ERCATRC(,@15)                                   0504
*                ERCPLPT  = CTGPLPTR;                              0505
*                                                                  0505
         L     @14,CTGPLPTR                                        0505
         ST    @14,ERCPLPT(,@15)                                   0505
*                IF FISTID = LOCATERR                              0506
*                  THEN                                            0506
         L     @14,@PC00005+4                                      0506
         CLC   FISTID(4,@14),@CB00920                              0506
         BNE   @RF00506                                            0506
*                    ERCATLC = ON;                                 0507
*                                                                  0507
         OI    ERCATLC(@15),B'10000000'                            0507
*                  ELSE                                            0508
*                    ERCATDE = ON;                                 0508
*                                                                  0508
         B     @RC00506                                            0508
@RF00506 L     @01,ERCNVADR                                        0508
         OI    ERCATDE(@01),B'01000000'                            0508
*                CALL IDCTPER0 (GDTTBL,ERCNVADR);                  0509
*                                                                  0509
@RC00506 L     @15,@PC00001                                        0509
         ST    @15,@AL00001                                        0509
         LA    @14,ERCNVADR                                        0509
         ST    @14,@AL00001+4                                      0509
         MVI   @AL00001+4,X'80'                                    0509
         L     @15,GDTERR(,@15)                                    0509
         LA    @01,@AL00001                                        0509
         BALR  @14,@15                                             0509
*                END;                                              0510
*                                                                  0510
*              /******************************************************/
*              /*                                                    */
*              /* FOR ALL OTHER MESSAGES ISSUE UPRINT                */
*              /*                                                    */
*              /******************************************************/
*                                                                  0511
*              ELSE                                                0511
*                DO;                                               0511
*                                                                  0511
         B     @RC00499                                            0511
@RF00499 DS    0H                                                  0512
*                DARGSTID = FISTID;                                0512
*                                                                  0512
         L     @15,@PC00005+4                                      0512
         L     @01,DDSTRU                                          0512
         MVC   DARGSTID(4,@01),FISTID(@15)                         0512
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0513
*                                                                  0513
         L     @15,@PC00001                                        0513
         ST    @15,@AL00001                                        0513
         LA    @14,@CF00116                                        0513
         ST    @14,@AL00001+4                                      0513
         LA    @14,DDSTRU                                          0513
         ST    @14,@AL00001+8                                      0513
         MVI   @AL00001+8,X'80'                                    0513
         L     @15,GDTPRT(,@15)                                    0513
         LA    @01,@AL00001                                        0513
         BALR  @14,@15                                             0513
*                END;                                              0514
*                                                                  0514
*            /********************************************************/
*            /*                                                      */
*            /* PRINT SECONDARY MESSAGES                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0515
*            DARGAREA = ''B;                                       0515
*                                                                  0515
@RC00499 XC    DARGAREA(44),DARGAREA                               0515
*            IF FISTID = SORTSTRT                                 0516
*               FISTID = SORTCONT                                  0516
*              THEN                                                0516
         L     @15,@PC00005+4                                      0516
         CLC   FISTID(4,@15),@CB00902                              0516
         BE    @RT00516                                            0516
         CLC   FISTID(4,@15),@CB00904                              0516
         BNE   @RF00516                                            0516
@RT00516 DS    0H                                                  0517
*                DARGSTID = JCLERROR;                              0517
*                                                                  0517
         L     @01,DDSTRU                                          0517
         MVC   DARGSTID(4,@01),@CF00900                            0517
*              ELSE                                                0518
*                IF FISTID = DEFERROR                              0518
*                  THEN                                            0518
         B     @RC00516                                            0518
@RF00516 L     @15,@PC00005+4                                      0518
         CLC   FISTID(4,@15),@CB00906                              0518
         BNE   @RF00518                                            0518
*                    DARGSTID = DEFERROR;                          0519
*                                                                  0519
         L     @01,DDSTRU                                          0519
         MVC   DARGSTID(4,@01),@CF00906                            0519
*                  ELSE                                            0520
*                    IF FISTID = LOCATERR                          0520
*                      THEN                                        0520
         B     @RC00518                                            0520
@RF00518 L     @15,@PC00005+4                                      0520
         CLC   FISTID(4,@15),@CB00920                              0520
         BNE   @RF00520                                            0520
*                        DO;                                       0521
*                                                                  0521
*                        DARGSTID = LOCATERR;                      0522
         L     @14,DDSTRU                                          0522
         MVC   DARGSTID(4,@14),@CF00920                            0522
*                        DARGILP  = LENGTH(DSNAME);                0523
*                                                                  0523
         MVC   DARGILP(2,@14),@CH00596                             0523
*                        IF FISAVERC = LASTCC12                    0524
*                          THEN                                    0524
         CLC   FISAVERC(2,@15),@CH00035                            0524
         BNE   @RF00524                                            0524
*                            DARGDBP = FIIOCSBS -> IOCDSN;         0525
*                                                                  0525
         L     @15,@PC00005                                        0525
         L     @01,FIIOCSBS(,@15)                                  0525
         L     @15,IOCDSN(,@01)                                    0525
         ST    @15,DARGDBP(,@14)                                   0525
*                          ELSE                                    0526
*                            DARGDBP = ADDR(FINAIXNM);             0526
*                                                                  0526
         B     @RC00524                                            0526
@RF00524 LA    @15,FINAIXNM                                        0526
         L     @14,DDSTRU                                          0526
         ST    @15,DARGDBP(,@14)                                   0526
*                        END;                                      0527
*                                                                  0527
*                      ELSE;                                       0528
*                                                                  0528
@RF00520 DS    0H                                                  0529
*            IF DARGSTID ^= NOERROR                                0529
*              THEN                                                0529
@RC00520 DS    0H                                                  0529
@RC00518 DS    0H                                                  0529
@RC00516 L     @01,DDSTRU                                          0529
         L     @15,DARGSTID(,@01)                                  0529
         LTR   @15,@15                                             0529
         BZ    @RF00529                                            0529
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0530
*                                                                  0530
         L     @15,@PC00001                                        0530
         ST    @15,@AL00001                                        0530
         LA    @14,@CF00116                                        0530
         ST    @14,@AL00001+4                                      0530
         LA    @14,DDSTRU                                          0530
         ST    @14,@AL00001+8                                      0530
         MVI   @AL00001+8,X'80'                                    0530
         L     @15,GDTPRT(,@15)                                    0530
         LA    @01,@AL00001                                        0530
         BALR  @14,@15                                             0530
*            END;                                                  0531
*                                                                  0531
@RF00529 DS    0H                                                  0532
*        /************************************************************/
*        /*                                                          */
*        /* IF THE CURRENT CONDITION CODE IS LESS THAN 12, AN        */
*        /* ALTERNATE INDEX FINAL STATUS MESSAGE IS TO BE PRINTED.   */
*        /* THE MESSAGE VARIES ACCORDING TO THE VALUE OF THE         */
*        /* CURRENT CONDITION CODE AS FOLLOWS:                       */
*        /*                                                          */
*        /*    0 - ALTERNATE INDEX SUCCESSFULLY BUILT                */
*        /*                                                          */
*        /*    4 - ALTERNATE INDEX BUILT BUT SOME NON-TERMINATING    */
*        /*        ERROR OR ERRORS WERE ENCOUNTERED                  */
*        /*                                                          */
*        /*    8 - ALTERNATE INDEX WAS NOT BUILT DUE TO A TERMINA-   */
*        /*        TING ERROR                                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0532
*        IF FISAVERC < LASTCC12                                    0532
*          THEN                                                    0532
@RF00489 L     @15,@PC00005+4                                      0532
         LH    @15,FISAVERC(,@15)                                  0532
         C     @15,@CF00035                                        0532
         BNL   @RF00532                                            0532
*            DO;                                                   0533
*                                                                  0533
*            DARGAREA = ''B;                                       0534
         XC    DARGAREA(44),DARGAREA                               0534
*            DARGDBP = ADDR(FINAIXNM);                             0535
         L     @14,DDSTRU                                          0535
         LA    @07,FINAIXNM                                        0535
         ST    @07,DARGDBP(,@14)                                   0535
*            DARGILP = LENGTH(DSNAME);                             0536
*                                                                  0536
         MVC   DARGILP(2,@14),@CH00596                             0536
*            IF FISAVERC = LASTCC00                                0537
*              THEN                                                0537
         LTR   @15,@15                                             0537
         BNZ   @RF00537                                            0537
*                DARGSTID = BUILDOK;                               0538
*                                                                  0538
         MVC   DARGSTID(4,@14),@CF00908                            0538
*              ELSE                                                0539
*                IF FISAVERC = LASTCC04                            0539
*                  THEN                                            0539
         B     @RC00537                                            0539
@RF00537 L     @15,@PC00005+4                                      0539
         CLC   FISAVERC(2,@15),@CH00043                            0539
         BNE   @RF00539                                            0539
*                    DARGSTID = BUILDERR;                          0540
*                                                                  0540
         L     @01,DDSTRU                                          0540
         MVC   DARGSTID(4,@01),@CF00910                            0540
*                  ELSE                                            0541
*                    DARGSTID = BUILDNOK;                          0541
*                                                                  0541
         B     @RC00539                                            0541
@RF00539 L     @01,DDSTRU                                          0541
         MVC   DARGSTID(4,@01),@CF00912                            0541
*            CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);                0542
*                                                                  0542
@RC00539 DS    0H                                                  0542
@RC00537 L     @15,@PC00001                                        0542
         ST    @15,@AL00001                                        0542
         LA    @14,@CF00116                                        0542
         ST    @14,@AL00001+4                                      0542
         LA    @14,DDSTRU                                          0542
         ST    @14,@AL00001+8                                      0542
         MVI   @AL00001+8,X'80'                                    0542
         L     @15,GDTPRT(,@15)                                    0542
         LA    @01,@AL00001                                        0542
         BALR  @14,@15                                             0542
*            END;                                                  0543
*                                                                  0543
*        /************************************************************/
*        /*                                                          */
*        /* FREE MAIN STORAGE OBTAINED FOR THIS ALTERNATE INDEX      */
*        /* BUILD.                                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0544
*        CALL IDCSAFP0 (GDTTBL,UGPIDPG);                           0544
*                                                                  0544
@RF00532 L     @15,@PC00001                                        0544
         ST    @15,@AL00001                                        0544
         LA    @14,UGPIDPG                                         0544
         ST    @14,@AL00001+4                                      0544
         MVI   @AL00001+4,X'80'                                    0544
         L     @15,GDTFPL(,@15)                                    0544
         LA    @01,@AL00001                                        0544
         BALR  @14,@15                                             0544
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLING PROCEDURE - HIGHEST LEVEL              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0545
*        RETURN;                                                   0545
*                                                                  0545
@EL00005 DS    0H                                                  0545
@EF00005 DS    0H                                                  0545
@ER00005 LM    @14,@12,@SA00005                                    0545
         BR    @14                                                 0545
*END FINPROC;                                                      0546
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - TERMPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS FINAL BLDINDEX CLEANUP, CONSISTING   */
*        /*            OF                                            */
*        /*              . CLOSE BASE CLUSTER                        */
*        /*                                                          */
*        /*              . IF SORT WORK FILES ARE DEFINED, CALL      */
*        /*                DELTPROC TO DELETE THEM                   */
*        /*                                                          */
*        /*              . FREE ALL REMAINING MAIN STORAGE           */
*        /*                                                          */
*        /*              . PRINT FINAL TERMINATION MESSAGE           */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*         TERMIOCS - AREA CONTAINING THE ADDRESS OF EACH   */
*        /*                    OPEN DATA SET                         */
*        /*                                                          */
*        /*         TERMIOIN - AREA CONTAINING THE ADDRESS OF THE    */
*        /*                    DATA OBTAINED FROM THE SORT WORK      */
*        /*                    JOB CONTROL                           */
*        /*                                                          */
*        /*         TERSRTTB - SORT CONTROL TABLE                    */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*         LASTCC - SET TO FINAL CONDITION CODE             */
*        /*         FINAL TERMINATION MESSAGE IS PRINTED             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0547
*TERMPROC:                                                         0547
*        PROCEDURE (TERMIOCS,           /* IOCSTR POINTERS           */
*                   TERMIOIN,           /* SORT JOB CONTROL POINTERS */
*                   TERSRTTB);          /* SORT CONTROL TABLE        */
*                                                                  0547
TERMPROC STM   @14,@12,@SA00006                                    0547
         MVC   @PC00006(12),0(@01)                                 0547
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0548
*        DCL 1 TERMIOCS BDY(WORD),      /* POINTERS TO IOCSTR FOR    */
*              2 TEIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */
*                                                                  0548
*        DCL 1 TERMIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */
*              2 TEIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */
*                                       /* JOB CONTROL DATA          */
*                                                                  0550
*        DCL TERSRTTB;                  /* SORT CONTROL TABLE        */
*        /************************************************************/
*        /*                                                          */
*        /* IF THE BASE CLUSTER IS OPEN, CLOSE IT                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0551
*        IF TEIOCSPT(1) ^= NULLPTR                                 0551
*          THEN                                                    0551
         L     @04,@PC00006                                        0551
         L     @15,TEIOCSPT(,@04)                                  0551
         LTR   @15,@15                                             0551
         BZ    @RF00551                                            0551
*            DO;                                                   0552
*                                                                  0552
*            CALL IDCIOCL0 (GDTTBL, TEIOCSPT(1));                  0553
*                                                                  0553
         L     @02,@PC00001                                        0553
         ST    @02,@AL00001                                        0553
         ST    @04,@AL00001+4                                      0553
         MVI   @AL00001+4,X'80'                                    0553
         L     @15,GDTCLS(,@02)                                    0553
         LA    @01,@AL00001                                        0553
         BALR  @14,@15                                             0553
*            RESPECIFY RTNREG RSTD;                                0554
*            TESTRC = RTNREG;                                      0555
         LR    TESTRC,RTNREG                                       0555
*            RESPECIFY RTNREG UNRSTD;                              0556
*                                                                  0556
*            IF TESTRC ^= 0 &                                      0557
*               SETRC < LASTCC08                                   0557
*              THEN                                                0557
         LTR   TESTRC,TESTRC                                       0557
         BZ    @RF00557                                            0557
         C     SETRC,@CF00180                                      0557
         BNL   @RF00557                                            0557
*                SETRC = LASTCC04;                                 0558
*                                                                  0558
         LA    SETRC,4                                             0558
*            END;                                                  0559
*                                                                  0559
@RF00557 DS    0H                                                  0560
*        /************************************************************/
*        /*                                                          */
*        /* IF SORT WORK FILES EXIST, CALL DELTPROC TO DELETE THEM   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0560
*        IF SRTFLDEF = ON                                          0560
*          THEN                                                    0560
@RF00551 TM    SRTFLDEF,B'10000000'                                0560
         BNO   @RF00560                                            0560
*            CALL DELTPROC (TERMIOIN);                             0561
*                                                                  0561
         L     @04,@PC00006+4                                      0561
         ST    @04,@AL00001                                        0561
         LA    @01,@AL00001                                        0561
         BAL   @14,DELTPROC                                        0561
*        /************************************************************/
*        /*                                                          */
*        /* CALL UFPOOL TO FREE ALL REMAINING MAIN STORAGE           */
*        /* OBTAINED VIA UGPOOL                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0562
*        CALL IDCSAFP0 (GDTTBL,UGPID01,ALL);                       0562
*                                                                  0562
@RF00560 MVC   @AL00001+4(8),@AL00562                              0562
         L     @04,@PC00001                                        0562
         ST    @04,@AL00001                                        0562
         L     @15,GDTFPL(,@04)                                    0562
         LA    @01,@AL00001                                        0562
         BALR  @14,@15                                             0562
*        /************************************************************/
*        /*                                                          */
*        /* PRINT FINAL TERMINATION MESSAGE BASED ON FINAL SETTING   */
*        /* OF LASTCC.  THE MESSAGE PRINTED DIFFERS BETWEEN A BATCH  */
*        /* ENVIRONMENT AND A TSO ENVIRONMENT.                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0563
*        LASTCC = SETRC;                                           0563
*                                                                  0563
         L     @04,@PC00001+8                                      0563
         STH   SETRC,LASTCC(,@04)                                  0563
*        DARGAREA = ''B;                                           0564
         XC    DARGAREA(44),DARGAREA                               0564
*        DARGDBP  = ADDR(LASTCC);                                  0565
         L     @05,DDSTRU                                          0565
         ST    @04,DARGDBP(,@05)                                   0565
*        DARGILP  = LENGTH(LASTCC);                                0566
*                                                                  0566
         MVC   DARGILP(2,@05),@CH00154                             0566
*        IF GDTECT = NULLPTR                                       0567
*          THEN                                                    0567
         L     @04,@PC00001                                        0567
         L     @04,GDTECT(,@04)                                    0567
         LTR   @04,@04                                             0567
         BNZ   @RF00567                                            0567
*            IF LASTCC < LASTCC12                                  0568
*              THEN                                                0568
         L     @04,@PC00001+8                                      0568
         LH    @04,LASTCC(,@04)                                    0568
         C     @04,@CF00035                                        0568
         BNL   @RF00568                                            0568
*                DARGSTID = FUNCCOMP;                              0569
         MVC   DARGSTID(4,@05),@CF00878                            0569
*              ELSE                                                0570
*                DARGSTID = FUNCTERM;                              0570
*                                                                  0570
         B     @RC00568                                            0570
@RF00568 L     @01,DDSTRU                                          0570
         MVC   DARGSTID(4,@01),@CF00880                            0570
*          ELSE                                                    0571
*            IF LASTCC = LASTCC00                                  0571
*              THEN                                                0571
         B     @RC00567                                            0571
@RF00567 L     @15,@PC00001+8                                      0571
         LH    @15,LASTCC(,@15)                                    0571
         LTR   @15,@15                                             0571
         BNZ   @RF00571                                            0571
*                DARGSTID = FUNCCOMP;                              0572
         L     @01,DDSTRU                                          0572
         MVC   DARGSTID(4,@01),@CF00878                            0572
*              ELSE                                                0573
*                DARGSTID = FUNCTSO;                               0573
*                                                                  0573
         B     @RC00571                                            0573
@RF00571 L     @01,DDSTRU                                          0573
         MVC   DARGSTID(4,@01),@CF00882                            0573
*        CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);                    0574
*                                                                  0574
@RC00571 DS    0H                                                  0574
@RC00567 L     @15,@PC00001                                        0574
         ST    @15,@AL00001                                        0574
         LA    @14,@CF00116                                        0574
         ST    @14,@AL00001+4                                      0574
         LA    @14,DDSTRU                                          0574
         ST    @14,@AL00001+8                                      0574
         MVI   @AL00001+8,X'80'                                    0574
         L     @15,GDTPRT(,@15)                                    0574
         LA    @01,@AL00001                                        0574
         BALR  @14,@15                                             0574
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLING PROCEDURE - HIGHEST LEVEL              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0575
*        RETURN;                                                   0575
*                                                                  0575
@EL00006 DS    0H                                                  0575
@EF00006 DS    0H                                                  0575
@ER00006 LM    @14,@12,@SA00006                                    0575
         BR    @14                                                 0575
*END TERMPROC;                                                     0576
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - LOCPROC                                 */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF OBTAINING REQUIRED   */
*        /*            INFORMATION FROM THE VSAM CATALOG REGARDING   */
*        /*            THE BASE CLUSTER AND ALTERNATE INDEX,         */
*        /*            SPECIFICALLY THE AMDSB CONTROL BLOCK.  THIS   */
*        /*            PROCEDURE ALSO VERIFIES THAT THE ALTERNATE    */
*        /*            INDEX IS PROPERLY RELATED TO THE BASE         */
*        /*            CLUSTER.  THE FOLLOWING LOCATES ARE REQUIRED- */
*        /*                                                          */
*        /*              1 - LOCATE THE BASE CLUSTER USING THE       */
*        /*                  NAME PROVIDED VIA THE INFILE OR         */
*        /*                  INDATASET PARAMETER.  THIS MAY BE       */
*        /*                  EITHER THE BASE CLUSTER NAME OR A       */
*        /*                  PATH OVER THE BASE.                     */
*        /*                                                          */
*        /*              2 - LOCATE THE BASE CLUSTER DATA AMDSB      */
*        /*                                                          */
*        /*              3 - LOCATE THE AIX USING THE NAME PROVIDED  */
*        /*                  VIA THE OUTFILE OR OUTDATASET           */
*        /*                  PARAMETER.  THIS MAY BE EITHER THE      */
*        /*                  AIX OR A PATH OVER THE AIX.             */
*        /*                                                          */
*        /*              4 - IF LOCATE 3 RETURNED A PATH OVER THE    */
*        /*                  AIX, LOCATE THE AIX USING THE CI NUMBER */
*        /*                  RETURNED IN LOCATE 3                    */
*        /*                                                          */
*        /*              5 - LOCATE THE AIX DATA AMDSB               */
*        /*                                                          */
*        /*            LOCPROC CALLS CATPROC TO SET UP THE REQUIRED  */
*        /*            PARAMETER LIST AND INVOKE CATALOG MANAGEMENT. */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        LOCAMDSB - POINTERS TO AMDSB AREAS                */
*        /*                                                          */
*        /*        LOCIOCS  - POINTERS TO IOCSTR FOR EACH OPEN DATA  */
*        /*                   SET                                    */
*        /*                                                          */
*        /*        LOCI     - CURRENT VALUE OF THE VARIABLE CONTROL- */
*        /*                   LING THE MAIN BUILD AIX LOOP IN THE    */
*        /*                   HIGHEST LEVEL PROCEDURE                */
*        /*                                                          */
*        /*        LOCSTAT  - STATUS COMMUNICATION AREA              */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*                                                          */
*        /*        THE RETRIEVED AMDSBS ARE MOVED TO THEIR           */
*        /*        RESPECTIVE AREAS                                  */
*        /*                                                          */
*        /* EXIT, NORMAL - ALL LOCATES EXECUTED SUCCESSFULLY         */
*        /*                VERIFICATION OF AIX TO BASE SUCCESSFUL    */
*        /*                                                          */
*        /* EXIT,ERROR -                                             */
*        /*              RETURN CODE 8, LOCATE OR VERIFICATION       */
*        /*                              OF AIX FAILED               */
*        /*                                                          */
*        /*              RETURN CODE 12, LOCATE OR VERIFICATION      */
*        /*                              OF BASE CLUSTER FAILED      */
*        /*                                                          */
*        /************************************************************/
*LOCPROC:                                                          0577
*        PROCEDURE (LOCAMDSB,          /* PTRS TO AMDSB AREAS        */
*                   LOCIOCS,           /* PTRS TO IOCSTRS            */
*                   LOCI,              /* INDEX VALUE OF AIX         */
*                   LOCSTAT);          /* STATUS COMMUNICATION AREA  */
*                                                                  0577
LOCPROC  STM   @14,@12,@SA00007                                    0577
         MVC   @PC00007(16),0(@01)                                 0577
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0578
*        DCL LOCI FIXED(31);            /* INDEX TO CURRENT AIX      */
*                                                                  0578
*        DCL 1 LOCAMDSB BDY(WORD),                                 0579
*              2 LOAMDSPT(2) PTR(31);   /* POINTERS TO AMDSB AREAS   */
*                                                                  0579
*        DCL 1 LOCIOCS BDY(WORD),       /* POINTERS TO IOCSTR FOR    */
*              2 LOIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */
*                                                                  0580
*        DCL 1 LOCSTAT,                                            0581
*              2 LOSAVERC FIXED(15),    /* CURRENT CONDITION CODE    */
*              2 LOSTID   CHAR(4);      /* ERROR IDENTIFIERS         */
*                                                                  0581
*        /************************************************************/
*        /*                                                          */
*        /* STRUCTURES USED TO REFERENCE DATA RETURNED FROM THE      */
*        /* CATALOG                                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0582
*        DCL ENTYPE CHAR(1) BASED(WKAENTYP);                       0582
*                                                                  0582
*        DCL 1 NAMEDS(3) CHAR(4) BASED(WKANAME),                   0583
*              2 NAMEID CHAR(1),                                   0583
*              2 NAMECI CHAR(3);                                   0583
*                                                                  0583
*        DCL 1 WKAPTRS BDY(WORD),       /* CATALOG WORK AREA POINTERS*/
*              2 WKAENTYP PTR(31),      /* POINTER TO ENTYPE IN WKA  */
*              2 WKANAME  PTR(31),      /* POINTER TO NAMEDS IN WKA  */
*              2 WKAAMDSB PTR(31);      /* POINTER TO AMDSB IN WKA   */
*                                                                  0584
*        DCL 1 BASENAME CHAR(4),        /* BASE CLUSTER NAMEDS ENTRY */
*              2 BASEID CHAR(1),        /* BASE CLUSTER ID           */
*              2 BASECI CHAR(3);        /* BASE CLUSTER CI           */
*                                                                  0585
*        DCL 1 NEXTNAME CHAR(4),        /* DATA FOR NEXT LOCATE      */
*              2 NEXTID CHAR(1),        /* ID OF NEXT LOCATE         */
*              2 NEXTCI CHAR(3);        /* CI FOR NEXT LOCATE        */
*        /************************************************************/
*        /*                                                          */
*        /* THE FORMAT OF NAMEDS RETURNED FROM EACH LOCATE IS -      */
*        /*                                                          */
*        /*    1 - IF THE LOCATE IS AGAINST A PATH OVER THE          */
*        /*        BASE CLUSTER - C(BASE),D(BASE),I(BASE)            */
*        /*                                                          */
*        /*        IF THE LOCATE IS AGAINST THE BASE CLUSTER         */
*        /*        ITSELF - D(BASE),I(BASE)                          */
*        /*                                                          */
*        /*    2 - C(BASE)                                           */
*        /*                                                          */
*        /*    3 - IF THE LOCATE IS AGAINST A PATH OVER THE          */
*        /*        AIX - G(AIX),D(AIX),I(AIX)                        */
*        /*                                                          */
*        /*        IF THE LOCATE IS AGAINST THE AIX ITSELF -         */
*        /*        D(AIX),I(AIX),C(BASE)                             */
*        /*                                                          */
*        /*    4 - IF LOCATE 3 WAS AGAINST A PATH - D(AIX),I(AIX),   */
*        /*        C(BASE)                                           */
*        /*                                                          */
*        /* THE FIRST TWO LOCATES AGAINST THE BASE CLUSTER           */
*        /* ARE PERFORMED ONLY WHEN THE FIRST AIX IS BEING BUILT.    */
*        /* ISSUE LOCATE 1 AGAINST THE BASE CLUSTER OR PATH          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0587
*        OLDERID2 = NEWERID2;                                      0587
         L     @15,@PC00001                                        0587
         L     @15,GDTTR2(,@15)                                    0587
         MVC   @TS00001(95),NEWERID2(@15)                          0587
         MVC   OLDERID2(95,@15),@TS00001                           0587
*        NEWID2 = 'BIL1';                                          0588
*                                                                  0588
         MVC   NEWID2(4,@15),@CC01231                              0588
*        IF LOCI = 1                                               0589
*          THEN                                                    0589
         L     @15,@PC00007+8                                      0589
         CLC   LOCI(4,@15),@CF00220                                0589
         BNE   @RF00589                                            0589
*            DO;                                                   0590
*                                                                  0590
*            CALL CATPROC ('1',LOIOCSPT(1),NULLPTR,WKAPTRS,LOCI,   0591
*                          LOCSTAT);                               0591
*                                                                  0591
         LA    @14,@CC01233                                        0591
         ST    @14,@AL00001                                        0591
         L     @14,@PC00007+4                                      0591
         ST    @14,@AL00001+4                                      0591
         LA    @14,@CF00116                                        0591
         ST    @14,@AL00001+8                                      0591
         LA    @14,WKAPTRS                                         0591
         ST    @14,@AL00001+12                                     0591
         ST    @15,@AL00001+16                                     0591
         L     @15,@PC00007+12                                     0591
         ST    @15,@AL00001+20                                     0591
         LA    @01,@AL00001                                        0591
         BAL   @14,CATPROC                                         0591
*            RESPECIFY RTNREG RSTD;                                0592
*            TESTRC = RTNREG;                                      0593
         LR    TESTRC,RTNREG                                       0593
*            RESPECIFY RTNREG UNRSTD;                              0594
*                                                                  0594
*            IF TESTRC ^= 0                                        0595
*              THEN                                                0595
         LTR   TESTRC,TESTRC                                       0595
         BZ    @RF00595                                            0595
*                RETURN CODE(LASTCC12);                            0596
*                                                                  0596
         LA    @15,12                                              0596
         L     @14,@SA00007                                        0596
         LM    @00,@12,@SA00007+8                                  0596
         BR    @14                                                 0596
*            /********************************************************/
*            /*                                                      */
*            /* VERIFY THE OBJECT RETURNED IS EITHER A BASE CLUSTER  */
*            /* OR A PATH OVER A BASE CLUSTER.                       */
*            /*                                                      */
*            /********************************************************/
*                                                                  0597
*            IF ENTYPE = 'R'                                       0597
*              THEN                                                0597
@RF00595 L     @01,WKAENTYP                                        0597
         CLI   ENTYPE(@01),C'R'                                    0597
         BNE   @RF00597                                            0597
*                DO;                                               0598
*                                                                  0598
*                IF NAMEID(1) ^= 'C'                               0599
*                  THEN                                            0599
         L     @01,WKANAME                                         0599
         CLI   NAMEID(@01),C'C'                                    0599
         BE    @RF00599                                            0599
*                    DO;                                           0600
*                                                                  0600
*                    LOSTID = INVALBAS;                            0601
         L     @15,@PC00007+12                                     0601
         MVC   LOSTID(4,@15),@CB00886                              0601
*                    RETURN CODE(LASTCC12);                        0602
*                                                                  0602
         LA    @15,12                                              0602
         L     @14,@SA00007                                        0602
         LM    @00,@12,@SA00007+8                                  0602
         BR    @14                                                 0602
*                    END;                                          0603
*                                                                  0603
*                NEXTNAME = NAMEDS(2);                             0604
*                                                                  0604
@RF00599 L     @01,WKANAME                                         0604
         MVC   NEXTNAME(4),NAMEDS+4(@01)                           0604
*                END;                                              0605
*                                                                  0605
*              ELSE                                                0606
*                IF ENTYPE ^= 'C'                                  0606
*                  THEN                                            0606
         B     @RC00597                                            0606
@RF00597 L     @01,WKAENTYP                                        0606
         CLI   ENTYPE(@01),C'C'                                    0606
         BE    @RF00606                                            0606
*                    DO;                                           0607
*                                                                  0607
*                    LOSTID = INVALBAS;                            0608
         L     @15,@PC00007+12                                     0608
         MVC   LOSTID(4,@15),@CB00886                              0608
*                    RETURN CODE(LASTCC12);                        0609
*                                                                  0609
         LA    @15,12                                              0609
         L     @14,@SA00007                                        0609
         LM    @00,@12,@SA00007+8                                  0609
         BR    @14                                                 0609
*                    END;                                          0610
*                                                                  0610
*                  ELSE                                            0611
*                    NEXTNAME = NAMEDS(1);                         0611
*                                                                  0611
@RF00606 L     @01,WKANAME                                         0611
         MVC   NEXTNAME(4),NAMEDS(@01)                             0611
*            /********************************************************/
*            /*                                                      */
*            /* ISSUE LOCATE 2 AGAINST THE DATA COMPONENT OF THE     */
*            /* BASE CLUSTER.  SAVE THE BASE CLUSTER CI NUMBER       */
*            /* FOR VERIFICATION OF THE AIX RELATIONSHIP.  MOVE      */
*            /* THE AMDSB CONTROL BLOCK TO ITS HOLD AREA             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0612
*            CALL CATPROC ('2',NULLPTR,NEXTCI,WKAPTRS,LOCI,        0612
*                           LOCSTAT);                              0612
*                                                                  0612
@RC00597 LA    @15,@CC01234                                        0612
         ST    @15,@AL00001                                        0612
         LA    @15,@CF00116                                        0612
         ST    @15,@AL00001+4                                      0612
         LA    @15,NEXTCI                                          0612
         ST    @15,@AL00001+8                                      0612
         LA    @15,WKAPTRS                                         0612
         ST    @15,@AL00001+12                                     0612
         L     @15,@PC00007+8                                      0612
         ST    @15,@AL00001+16                                     0612
         L     @15,@PC00007+12                                     0612
         ST    @15,@AL00001+20                                     0612
         LA    @01,@AL00001                                        0612
         BAL   @14,CATPROC                                         0612
*            RESPECIFY RTNREG RSTD;                                0613
*            TESTRC = RTNREG;                                      0614
         LR    TESTRC,RTNREG                                       0614
*            RESPECIFY RTNREG UNRSTD;                              0615
*                                                                  0615
*            IF TESTRC ^= 0                                        0616
*              THEN                                                0616
         LTR   TESTRC,TESTRC                                       0616
         BZ    @RF00616                                            0616
*                RETURN CODE(LASTCC12);                            0617
*                                                                  0617
         LA    @15,12                                              0617
         L     @14,@SA00007                                        0617
         LM    @00,@12,@SA00007+8                                  0617
         BR    @14                                                 0617
*            BASENAME = NAMEDS(1);                                 0618
*                                                                  0618
@RF00616 L     @01,WKANAME                                         0618
         MVC   BASENAME(4),NAMEDS(@01)                             0618
*            LOAMDSPT(1) -> IDAAMDSB(1:LENGTH(IDAAMDSB)) =         0619
*                           WKAAMDSB -> IDAAMDSB;                  0619
*                                                                  0619
         L     @15,@PC00007                                        0619
         L     @01,LOAMDSPT(,@15)                                  0619
         L     @15,WKAAMDSB                                        0619
         MVC   IDAAMDSB(96,@01),IDAAMDSB(@15)                      0619
*            END;                                                  0620
*                                                                  0620
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE LOCATE 3 AGAINST THE ALTERNATE INDEX OR PATH       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0621
*        CALL CATPROC ('3', LOIOCSPT(2),NULLPTR,WKAPTRS,LOCI,      0621
*                      LOCSTAT);                                   0621
*                                                                  0621
@RF00589 LA    @15,@CC01235                                        0621
         ST    @15,@AL00001                                        0621
         L     @15,@PC00007+4                                      0621
         LA    @15,LOIOCSPT+4(,@15)                                0621
         ST    @15,@AL00001+4                                      0621
         LA    @15,@CF00116                                        0621
         ST    @15,@AL00001+8                                      0621
         LA    @15,WKAPTRS                                         0621
         ST    @15,@AL00001+12                                     0621
         L     @15,@PC00007+8                                      0621
         ST    @15,@AL00001+16                                     0621
         L     @15,@PC00007+12                                     0621
         ST    @15,@AL00001+20                                     0621
         LA    @01,@AL00001                                        0621
         BAL   @14,CATPROC                                         0621
*        RESPECIFY RTNREG RSTD;                                    0622
*        TESTRC = RTNREG;                                          0623
         LR    TESTRC,RTNREG                                       0623
*        RESPECIFY RTNREG UNRSTD;                                  0624
*                                                                  0624
*        IF TESTRC ^= 0                                            0625
*          THEN                                                    0625
         LTR   TESTRC,TESTRC                                       0625
         BZ    @RF00625                                            0625
*            RETURN CODE(LASTCC08);                                0626
*                                                                  0626
         LA    @15,8                                               0626
         L     @14,@SA00007                                        0626
         LM    @00,@12,@SA00007+8                                  0626
         BR    @14                                                 0626
*        NEXTNAME = NAMEDS(1);                                     0627
*                                                                  0627
@RF00625 L     @01,WKANAME                                         0627
         MVC   NEXTNAME(4),NAMEDS(@01)                             0627
*        /************************************************************/
*        /*                                                          */
*        /* VERIFY THAT THE OBJECT RETURNED IS EITHER AN ALTERNATE   */
*        /* INDEX OR A PATH OVER AN ALTERNATE INDEX.  IF A PATH,     */
*        /* ISSUE LOCATE 4 AGAINST THE AIX.                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0628
*        IF ENTYPE = 'R'                                           0628
*          THEN                                                    0628
         L     @01,WKAENTYP                                        0628
         CLI   ENTYPE(@01),C'R'                                    0628
         BNE   @RF00628                                            0628
*            DO;                                                   0629
*                                                                  0629
*            IF NEXTID ^= 'G'                                      0630
*              THEN                                                0630
         CLI   NEXTID,C'G'                                         0630
         BE    @RF00630                                            0630
*                DO;                                               0631
*                                                                  0631
*                LOSTID = INVALAIX;                                0632
         L     @15,@PC00007+12                                     0632
         MVC   LOSTID(4,@15),@CB00884                              0632
*                RETURN CODE(LASTCC08);                            0633
*                                                                  0633
         LA    @15,8                                               0633
         L     @14,@SA00007                                        0633
         LM    @00,@12,@SA00007+8                                  0633
         BR    @14                                                 0633
*                END;                                              0634
*                                                                  0634
*              ELSE                                                0635
*                DO;                                               0635
*                                                                  0635
@RF00630 DS    0H                                                  0636
*                CALL CATPROC ('4',NULLPTR,NEXTCI,WKAPTRS,LOCI,    0636
*                              LOCSTAT);                           0636
*                                                                  0636
         LA    @15,@CC01236                                        0636
         ST    @15,@AL00001                                        0636
         LA    @15,@CF00116                                        0636
         ST    @15,@AL00001+4                                      0636
         LA    @15,NEXTCI                                          0636
         ST    @15,@AL00001+8                                      0636
         LA    @15,WKAPTRS                                         0636
         ST    @15,@AL00001+12                                     0636
         L     @15,@PC00007+8                                      0636
         ST    @15,@AL00001+16                                     0636
         L     @15,@PC00007+12                                     0636
         ST    @15,@AL00001+20                                     0636
         LA    @01,@AL00001                                        0636
         BAL   @14,CATPROC                                         0636
*                RESPECIFY RTNREG RSTD;                            0637
*                TESTRC = RTNREG;                                  0638
         LR    TESTRC,RTNREG                                       0638
*                RESPECIFY RTNREG UNRSTD;                          0639
*                                                                  0639
*                IF TESTRC ^= 0                                    0640
*                  THEN                                            0640
         LTR   TESTRC,TESTRC                                       0640
         BZ    @RF00640                                            0640
*                    RETURN CODE(LASTCC08);                        0641
*                                                                  0641
         LA    @15,8                                               0641
         L     @14,@SA00007                                        0641
         LM    @00,@12,@SA00007+8                                  0641
         BR    @14                                                 0641
*                NEXTNAME = NAMEDS(1);                             0642
*                                                                  0642
@RF00640 L     @01,WKANAME                                         0642
         MVC   NEXTNAME(4),NAMEDS(@01)                             0642
*                END;                                              0643
*                                                                  0643
*            END;                                                  0644
*                                                                  0644
*          ELSE                                                    0645
*            IF ENTYPE ^= 'G'                                      0645
*              THEN                                                0645
         B     @RC00628                                            0645
@RF00628 L     @01,WKAENTYP                                        0645
         CLI   ENTYPE(@01),C'G'                                    0645
         BE    @RF00645                                            0645
*                DO;                                               0646
*                                                                  0646
*                LOSTID = INVALAIX;                                0647
         L     @15,@PC00007+12                                     0647
         MVC   LOSTID(4,@15),@CB00884                              0647
*                RETURN CODE(LASTCC08);                            0648
*                                                                  0648
         LA    @15,8                                               0648
         L     @14,@SA00007                                        0648
         LM    @00,@12,@SA00007+8                                  0648
         BR    @14                                                 0648
*                END;                                              0649
*                                                                  0649
*        /************************************************************/
*        /*                                                          */
*        /* VERIFY THAT THE ALTERNATE INDEX IS PROPERLY RELATED TO   */
*        /* THE BASE CLUSTER BY COMPARING THE CI NUMBER OF THE BASE  */
*        /* RETURNED IN LOCATE 2 TO THE CI NUMBER OF THE BASE        */
*        /* RETURNED IN LOCATE 3 OR 4                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0650
*        IF NAMECI(3) ^= BASECI                                    0650
*          THEN                                                    0650
@RF00645 DS    0H                                                  0650
@RC00628 L     @01,WKANAME                                         0650
         CLC   NAMECI+8(3,@01),BASECI                              0650
         BE    @RF00650                                            0650
*            DO;                                                   0651
*                                                                  0651
*            LOSTID = NOTRELAT;                                    0652
         L     @15,@PC00007+12                                     0652
         MVC   LOSTID(4,@15),@CB00888                              0652
*            RETURN CODE(LASTCC08);                                0653
*                                                                  0653
         LA    @15,8                                               0653
         L     @14,@SA00007                                        0653
         LM    @00,@12,@SA00007+8                                  0653
         BR    @14                                                 0653
*            END;                                                  0654
*                                                                  0654
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE LOCATE 5 AGAINST THE DATA COMPONENT OF THE         */
*        /* ALTERNATE INDEX.  MOVE THE AMDSB TO ITS HOLD AREA.       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0655
*        CALL CATPROC ('5',NULLPTR,NEXTCI,WKAPTRS,LOCI,            0655
*                       LOCSTAT);                                  0655
*                                                                  0655
@RF00650 LA    @15,@CC01237                                        0655
         ST    @15,@AL00001                                        0655
         LA    @15,@CF00116                                        0655
         ST    @15,@AL00001+4                                      0655
         LA    @15,NEXTCI                                          0655
         ST    @15,@AL00001+8                                      0655
         LA    @15,WKAPTRS                                         0655
         ST    @15,@AL00001+12                                     0655
         L     @15,@PC00007+8                                      0655
         ST    @15,@AL00001+16                                     0655
         L     @15,@PC00007+12                                     0655
         ST    @15,@AL00001+20                                     0655
         LA    @01,@AL00001                                        0655
         BAL   @14,CATPROC                                         0655
*        RESPECIFY RTNREG RSTD;                                    0656
*        TESTRC = RTNREG;                                          0657
         LR    TESTRC,RTNREG                                       0657
*        RESPECIFY RTNREG UNRSTD;                                  0658
*                                                                  0658
*        IF TESTRC ^= 0                                            0659
*          THEN                                                    0659
         LTR   TESTRC,TESTRC                                       0659
         BZ    @RF00659                                            0659
*            RETURN CODE(LASTCC08);                                0660
*                                                                  0660
         LA    @15,8                                               0660
         L     @14,@SA00007                                        0660
         LM    @00,@12,@SA00007+8                                  0660
         BR    @14                                                 0660
*        LOAMDSPT(2) -> IDAAMDSB(1:LENGTH(IDAAMDSB)) =             0661
*                          WKAAMDSB -> IDAAMDSB;                   0661
*                                                                  0661
@RF00659 L     @15,@PC00007                                        0661
         L     @01,LOAMDSPT+4(,@15)                                0661
         L     @15,WKAAMDSB                                        0661
         MVC   IDAAMDSB(96,@01),IDAAMDSB(@15)                      0661
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLING PROCEDURE - MAINPROC                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0662
*        RETURN CODE(LASTCC00);                                    0662
*                                                                  0662
         SLR   @15,@15                                             0662
         L     @14,@SA00007                                        0662
         LM    @00,@12,@SA00007+8                                  0662
         BR    @14                                                 0662
*END LOCPROC;                                                      0663
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - CATPROC                                 */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE         */
*        /*            CATALOG PARAMETER LIST (CPL) AND REQUIRED     */
*        /*            FIELD PARAMETER LISTS (FPL) AND ISSUING       */
*        /*            THE VSAM CATALOG MANAGEMENT LOCATE FUNCTION.  */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*         CATLOCNO - THE LOCATE IDENTIFIER, 1 - 5          */
*        /*                                                          */
*        /*         CATLOCNM - A POINTER TO THE IOCSTR FOR THE OPEN  */
*        /*                    BASE CLUSTER OR AIX                   */
*        /*                                                          */
*        /*         CATLOCCI - A CATALOG CI NUMBER TO BE USED IN     */
*        /*                    THE LOCATE                            */
*        /*                                                          */
*        /*         CATLOCI  - INDEX VALUE OF MAIN AIX LOOP          */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*         CATLOCDT - AN AREA INTO WHICH CATPROC PLACES     */
*        /*                    ADDRESSES OF DATA RETURNED BY THE     */
*        /*                    CATALOG                               */
*        /*                                                          */
*        /*         CATSTAT  - STATUS COMMUNICATION AREA             */
*        /*                                                          */
*        /* EXIT,NORMAL - CATALOG LOCATE WAS SUCCESSFUL              */
*        /*                                                          */
*        /* EXIT, ERROR-  RETURN CODE 12, CATALOG LOCATE WAS NOT     */
*        /*                               SUCCESSFUL                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0664
*CATPROC:                                                          0664
*        PROCEDURE (CATLOCNO,          /* LOCATE NUMBER ID           */
*                   CATLOCNM,          /* PTR TO IOCSTR OF OBJECT    */
*                   CATLOCCI,          /* CATALOG CI NUMBER OF OBJECT*/
*                   CATLOCDT,          /* PTRS TO DATA RETURNED      */
*                   CATLOCI,           /* INDEX VALUE OF AIX         */
*                   CATSTAT);          /* STATUS COMMUNICATION AREA  */
*                                                                  0664
CATPROC  STM   @14,@12,@SA00008                                    0664
         MVC   @PC00008(24),0(@01)                                 0664
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0665
*        DCL                                                       0665
*          CATLOCNO CHAR(1),            /* LOCATE IDENTIFIER         */
*          CATLOCNM PTR(31),            /* POINTER TO IOCSTR         */
*                                       /* OF OBJECT LOCATED         */
*          CATLOCCI CHAR(3),            /* CATALOG CI NUMBER         */
*                                       /* OF OBJECT LOCATED         */
*          CATLOCI  FIXED(31);          /* AIX LOOP INDEX VALUE      */
*                                                                  0665
*        DCL 1 CATLOCDT BDY(WORD),      /* PTRS TO DATA RETURNED     */
*              2 CATLOPTR(3) PTR(31);                              0666
*                                                                  0666
*        DCL 1 CATSTAT,                /* STATUS COMMUNICATION AREA  */
*              2 CASAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 CASTID   CHAR(4);     /* ERROR IDENTIFIER           */
*                                                                  0667
*        /************************************************************/
*        /*                                                          */
*        /* AREA CONTAINING THE CPL AND FPLS REQUIRED FOR THE        */
*        /* LOCATES PLUS THE WORKAREA IN WHICH CATALOG MANAGEMENT    */
*        /* RETURNS THE REQUESTED INFORMATION                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0668
*        DCL 1 LOCCPLAR BDY(WORD),                                 0668
*              2 LOCCPLID CHAR(8),                /* CPL DUMP ID     */
*              2 LOCCPL   CHAR(LENGTH(CTGPL)),    /* CPL             */
*              2 LOCFPPTR(3) PTR(31),             /* FPL POINTERS    */
*              2 LOCFPENT CHAR(LENGTH(CTGFL)),    /* ENTYPE FPL      */
*              2 *        CHAR(8),                                 0668
*              2 LOCFPNAM CHAR(LENGTH(CTGFL)),    /* NAMEDS  FPL     */
*              2 *        CHAR(8),                                 0668
*              2 LOCFPMSC CHAR(LENGTH(CTGFL)),    /* CATACB OR       */
*              2 *        CHAR(8),                /* AMDSBCAT FPL    */
*              2 LOCFPTST CHAR(LENGTH(CTGFL)),    /* NAMEDS TEST FPL */
*              2 *        CHAR(8);                                 0668
*                                                                  0668
*        DCL 1 LOCWKA BDY(WORD),                  /* LOCATE WORKAREA */
*              2 LOCWKALN FIXED(15),              /* WORKAREA LENGTH */
*              2 LOCWKDLN FIXED(15),              /* LENGTH OF DATA  */
*              2 LOCWKDAT CHAR((LENGTH(IDAAMDSB)) +/*              0669
*                                                    DATA RETURNED   */
*                         (LENGTH(ENTYPE)) +                       0669
*                         (LENGTH(NAMEDS) * 3));                   0669
*                                                                  0669
*        /************************************************************/
*        /*                                                          */
*        /* SAVE AREA FOR CATALOG ACB ADDRESS (USED IN ALL LOCATES   */
*        /* EXCEPT THE FIRST)                                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0670
*        DCL CATACBPT PTR(31);                                     0670
*                                                                  0670
*        DCL ACBADDR PTR(31) BASED;                                0671
*                                                                  0671
*        /************************************************************/
*        /*                                                          */
*        /* FIELD NAMES OF DATA TO BE LOCATED.  THE SEQUENCE OF      */
*        /* NAMES IN THIS TABLE IS FIXED.                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0672
*        DCL NAMTABL(5) CHAR(8) INIT('ENTYPE','NAMEDS','CATACB',   0672
*                                    'CNTREPNO','AMDSBCAT');       0672
*                                                                  0672
*        /************************************************************/
*        /* LOOP CONTROL VARIABLE                                    */
*        /************************************************************/
*                                                                  0673
*        DCL                                                       0673
*          LC    FIXED(31),                                        0673
*          STOPL BIT(1);                                           0673
*                                                                  0673
*        /************************************************************/
*        /*                                                          */
*        /* MASK USED IN SETTING TEST FOR NAMEDS                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0674
*        DCL NAMEMASK FIXED(15) INIT(3);                           0674
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZATION - SET UP COMMON INDICATORS AND POINTERS   */
*        /*                  IN CPL                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0675
*        LOCCPLAR = ''B;                                           0675
         XC    LOCCPLAR(144),LOCCPLAR                              0675
*        LOCWKA   = ''B;                                           0676
         XC    LOCWKA(113),LOCWKA                                  0676
*        LOCCPLID = 'LOCATCPL';                                    0677
*                                                                  0677
         MVC   LOCCPLID(8),@CC01283                                0677
*        CTGPLPTR = ADDR(LOCCPL);                                  0678
*                                                                  0678
         LA    @15,LOCCPL                                          0678
         ST    @15,CTGPLPTR                                        0678
*        CTGFUNC = CTGLOC;                                         0679
         NI    CTGFUNC(@15),B'00111111'                            0679
         OI    CTGFUNC(@15),B'00100000'                            0679
*        CTGAM0  = ON;                                             0680
*        CTGNUM  = ON;                                             0681
         OI    CTGAM0(@15),B'00000011'                             0681
*        CTGWKA  = ADDR(LOCWKA);                                   0682
         LA    @14,LOCWKA                                          0682
         ST    @14,CTGWKA(,@15)                                    0682
*        LOCWKALN = LENGTH(LOCWKA);                                0683
*                                                                  0683
         MVC   LOCWKALN(2),@CH01644                                0683
*        /************************************************************/
*        /*                                                          */
*        /* ON LOCATE 1, THE CATALOG ACB ADDRESS IS REQUESTED.       */
*        /* SUBSEQUENTLY, THE CATALOG ACB ADDRESS IS USED IN THE     */
*        /* LOCATE REQUEST                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0684
*        IF CATLOCNO = '1'                                         0684
*          THEN                                                    0684
         L     @14,@PC00008                                        0684
         CLI   CATLOCNO(@14),C'1'                                  0684
         BNE   @RF00684                                            0684
*            DO;                                                   0685
*                                                                  0685
*            CTGCNAME = ON;                                        0686
         OI    CTGCNAME(@15),B'00000010'                           0686
*            CATACBPT = NULLPTR;                                   0687
*                                                                  0687
         SLR   @15,@15                                             0687
         ST    @15,CATACBPT                                        0687
*            END;                                                  0688
*                                                                  0688
*          ELSE                                                    0689
*            CTGCAT = ADDR(CATACBPT);                              0689
*                                                                  0689
         B     @RC00684                                            0689
@RF00684 LA    @15,CATACBPT                                        0689
         L     @14,CTGPLPTR                                        0689
         ST    @15,CTGCAT(,@14)                                    0689
*        /************************************************************/
*        /*                                                          */
*        /* IF AN IOCSTR POINTER HAS BEEN PASSED TO THIS PROCEDURE,  */
*        /* PLACE THE ADDRESS OF THE DATA SET NAME AND ITS PASSWORD  */
*        /* IN THE CPL.  IF A CATALOG CI NUMBER WAS PASSED, POINT    */
*        /* TO IT FROM THE CPL AND SET THE BYPASS SECURITY CHECK     */
*        /* FLAG.  THIS LATTER IS REQUIRED BY DOS FOR ALL LOCATES    */
*        /* WHEN A PREVIOUS LOCATE (E.G., AGAINST A PATH) HAS        */
*        /* VERIFIED SECURITY.  THIS FLAG IS IGNORED IN OS.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0690
*        IF CATLOCNM ^= NULLPTR                                    0690
*          THEN                                                    0690
@RC00684 SLR   @15,@15                                             0690
         L     @14,@PC00008+4                                      0690
         L     @14,CATLOCNM(,@14)                                  0690
         CR    @14,@15                                             0690
         BE    @RF00690                                            0690
*            DO;                                                   0691
*                                                                  0691
*            CTGNAME = ON;                                         0692
         L     @07,CTGPLPTR                                        0692
         OI    CTGNAME(@07),B'00000100'                            0692
*            CTGENT  = CATLOCNM -> IOCDSN;                         0693
*                                                                  0693
         L     @06,IOCDSN(,@14)                                    0693
         ST    @06,CTGENT(,@07)                                    0693
*            IF CATLOCNO = '1'                                     0694
*              THEN                                                0694
         L     @14,@PC00008                                        0694
         CLI   CATLOCNO(@14),C'1'                                  0694
         BNE   @RF00694                                            0694
*                IF ADDR(IFILE) ^= NULLPTR                         0695
*                  THEN                                            0695
         L     @14,@PC00001+4                                      0695
         L     @14,FDTPTR(,@14)                                    0695
         CR    @14,@15                                             0695
         BE    @RF00695                                            0695
*                    IF IFILEPLN ^= 0                              0696
*                      THEN                                        0696
         CLI   IFILEPLN(@14),0                                     0696
         BE    @RF00696                                            0696
*                        CTGPSWD = ADDR(IFILEPAS);                 0697
*                                                                  0697
         LA    @06,IFILEPAS(,@14)                                  0697
         ST    @06,CTGPSWD(,@07)                                   0697
*                      ELSE;                                       0698
*                                                                  0698
@RF00696 DS    0H                                                  0699
*                  ELSE                                            0699
*                    IF IDSPLN ^= 0                                0699
*                      THEN                                        0699
         B     @RC00695                                            0699
@RF00695 L     @15,@PC00001+4                                      0699
         L     @15,FDTPTR+4(,@15)                                  0699
         CLI   IDSPLN(@15),0                                       0699
         BE    @RF00699                                            0699
*                        CTGPSWD = ADDR(IDSPAS);                   0700
*                                                                  0700
         LA    @15,IDSPAS(,@15)                                    0700
         L     @14,CTGPLPTR                                        0700
         ST    @15,CTGPSWD(,@14)                                   0700
*                      ELSE;                                       0701
*                                                                  0701
@RF00699 DS    0H                                                  0702
*              ELSE                                                0702
*                IF ADDR(OFILE(CATLOCI)) ^= NULLPTR                0702
*                  THEN                                            0702
         B     @RC00694                                            0702
@RF00694 SLR   @15,@15                                             0702
         L     @14,@PC00008+16                                     0702
         L     @14,CATLOCI(,@14)                                   0702
         L     @07,@PC00001+4                                      0702
         L     @07,FDTPTR+8(,@07)                                  0702
         LA    @01,0(@14,@07)                                      0702
         BCTR  @01,0                                               0702
         CR    @01,@15                                             0702
         BE    @RF00702                                            0702
*                    IF OFILEPLN(CATLOCI) ^= 0                     0703
*                      THEN                                        0703
         MH    @14,@CH01639                                        0703
         LA    @01,0(@14,@07)                                      0703
         AL    @01,@CF01669                                        0703
         SLR   @00,@00                                             0703
         IC    @00,OFILEPLN-2(,@01)                                0703
         CR    @15,@00                                             0703
         BE    @RF00703                                            0703
*                        CTGPSWD = ADDR(OFILEPAS(CATLOCI));        0704
*                                                                  0704
         AL    @07,@CF01670                                        0704
         LA    @15,OFILEPAS-3(@14,@07)                             0704
         L     @14,CTGPLPTR                                        0704
         ST    @15,CTGPSWD(,@14)                                   0704
*                      ELSE;                                       0705
*                                                                  0705
@RF00703 DS    0H                                                  0706
*                  ELSE                                            0706
*                    IF ODSPLN(CATLOCI) ^= 0                       0706
*                      THEN                                        0706
         B     @RC00702                                            0706
@RF00702 L     @15,@PC00008+16                                     0706
         L     @15,CATLOCI(,@15)                                   0706
         MH    @15,@CH01640                                        0706
         L     @14,@PC00001+4                                      0706
         L     @14,FDTPTR+12(,@14)                                 0706
         LA    @01,0(@15,@14)                                      0706
         AL    @01,@CF01674                                        0706
         SLR   @00,@00                                             0706
         IC    @00,ODSPLN-2(,@01)                                  0706
         C     @00,@CF00116                                        0706
         BE    @RF00706                                            0706
*                        CTGPSWD = ADDR(ODSPAS(CATLOCI));          0707
*                                                                  0707
         AL    @14,@CF01675                                        0707
         LA    @15,ODSPAS-3(@15,@14)                               0707
         L     @14,CTGPLPTR                                        0707
         ST    @15,CTGPSWD(,@14)                                   0707
*                      ELSE;                                       0708
*                                                                  0708
@RF00706 DS    0H                                                  0709
*            END;                                                  0709
*                                                                  0709
*          ELSE                                                    0710
*            DO;                                                   0710
*                                                                  0710
         B     @RC00690                                            0710
@RF00690 DS    0H                                                  0711
*            CTGBYPSS = ON;                                        0711
         L     @15,CTGPLPTR                                        0711
         OI    CTGBYPSS(@15),B'10000000'                           0711
*            CTGENT = ADDR(CATLOCCI);                              0712
*                                                                  0712
         L     @14,@PC00008+8                                      0712
         ST    @14,CTGENT(,@15)                                    0712
*            END;                                                  0713
*                                                                  0713
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE THE FPLS.  THE ENTYPE AND NAMEDS FPLS ARE     */
*        /* ALWAYS INITIALIZED.  THE THIRD FPL IS SET TO CATACB      */
*        /* FOR LOCATE 1 AND OVERLAYED WITH AMDSBCAT FOR LOCATES     */
*        /* 2 AND 5.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0714
*        CTGFLPTR = ADDR(LOCFPENT);                                0714
*                                                                  0714
@RC00690 LA    CTGFLPTR,LOCFPENT                                   0714
*        DO LC = 1 TO 3;                                           0715
*                                                                  0715
         LA    LC,1                                                0715
@DL00715 DS    0H                                                  0716
*          CTGFLDNO = 1;                                           0716
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0716
*          CTGFLDNM = ADDR(NAMTABL(LC));                           0717
         LR    @15,LC                                              0717
         SLA   @15,3                                               0717
         LA    @15,NAMTABL-8(@15)                                  0717
         ST    @15,CTGFLDNM(,CTGFLPTR)                             0717
*          CTGFIELD(LC) = CTGFLPTR;                                0718
*                                                                  0718
         LR    @15,LC                                              0718
         SLA   @15,2                                               0718
         L     @01,CTGPLPTR                                        0718
         ST    CTGFLPTR,CTGFIELD-4(@15,@01)                        0718
*          CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT); 0719
*                                                                  0719
         AL    CTGFLPTR,@CF00311                                   0719
*        END;                                                      0720
*                                                                  0720
         AL    LC,@CF00220                                         0720
         C     LC,@CF00163                                         0720
         BNH   @DL00715                                            0720
*        IF CATLOCNO = '1'                                         0721
*          THEN                                                    0721
         L     @15,@PC00008                                        0721
         CLI   CATLOCNO(@15),C'1'                                  0721
         BNE   @RF00721                                            0721
*            CTGNOFLD = 3;                                         0722
*                                                                  0722
         L     @01,CTGPLPTR                                        0722
         MVI   CTGNOFLD(@01),X'03'                                 0722
*          ELSE                                                    0723
*            IF CATLOCNO = '2'                                    0723
*               CATLOCNO = '5'                                     0723
*              THEN                                                0723
         B     @RC00721                                            0723
@RF00721 L     @15,@PC00008                                        0723
         CLI   CATLOCNO(@15),C'2'                                  0723
         BE    @RT00723                                            0723
         CLI   CATLOCNO(@15),C'5'                                  0723
         BNE   @RF00723                                            0723
@RT00723 DS    0H                                                  0724
*                DO;                                               0724
*                                                                  0724
*                CTGNOFLD = 3;                                     0725
         L     @03,CTGPLPTR                                        0725
         MVI   CTGNOFLD(@03),X'03'                                 0725
*                CTGFLPTR = ADDR(LOCFPMSC);                        0726
         LA    CTGFLPTR,LOCFPMSC                                   0726
*                CTGFLDNM = ADDR(NAMTABL(5));                      0727
*                                                                  0727
         LA    @03,NAMTABL+32                                      0727
         ST    @03,CTGFLDNM(,CTGFLPTR)                             0727
*                END;                                              0728
*                                                                  0728
*              ELSE                                                0729
*                CTGNOFLD = 2;                                     0729
*                                                                  0729
         B     @RC00723                                            0729
@RF00723 L     @01,CTGPLPTR                                        0729
         MVI   CTGNOFLD(@01),X'02'                                 0729
*        /************************************************************/
*        /*                                                          */
*        /* BUILD AND CHAIN THE TEST FPL FOR NAMEDS WHICH GUARANTEES */
*        /* THAT NO MORE THAN THREE ASSOCIATIONS ARE RETURNED        */
*        /*                                                          */
*        /************************************************************/
*                                                                  0730
*        CTGFLPTR = ADDR(LOCFPTST);                                0730
*                                                                  0730
@RC00723 DS    0H                                                  0730
@RC00721 LA    @15,LOCFPTST                                        0730
         LR    CTGFLPTR,@15                                        0730
*        CTGFLDNO = 1;                                             0731
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0731
*        CTGFLDCD = CTGFLDLE;                                      0732
         MVI   CTGFLDCD(CTGFLPTR),X'C0'                            0732
*        CTGFLDNM = ADDR(NAMTABL(4));                              0733
         LA    @03,NAMTABL+24                                      0733
         ST    @03,CTGFLDNM(,CTGFLPTR)                             0733
*        CTGFLNG(1) = 2;                                           0734
         MVC   CTGFLNG(4,CTGFLPTR),@CF00154                        0734
*        CTGFLPT(1) = ADDR(NAMEMASK);                              0735
*                                                                  0735
         LA    @03,NAMEMASK                                        0735
         ST    @03,CTGFLPT(,CTGFLPTR)                              0735
*        CTGFLPTR = ADDR(LOCFPNAM);                                0736
         LA    CTGFLPTR,LOCFPNAM                                   0736
*        CTGFLCHN = ADDR(LOCFPTST);                                0737
*                                                                  0737
         ST    @15,CTGFLCHN(,CTGFLPTR)                             0737
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE THE CATALOG LOCATE REQUEST                         */
*        /*                                                          */
*        /************************************************************/
*                                                                  0738
*        CALL IDCSACA0 (GDTTBL, CTGPLPTR);                         0738
*                                                                  0738
         L     @15,@PC00001                                        0738
         ST    @15,@AL00001                                        0738
         LA    @14,CTGPLPTR                                        0738
         ST    @14,@AL00001+4                                      0738
         L     @15,GDTCAT(,@15)                                    0738
         LA    @01,@AL00001                                        0738
         BALR  @14,@15                                             0738
*        RFY RTNREG RSTD;                                          0739
*        CATRETCC = RTNREG;                                        0740
         STH   RTNREG,CATRETCC                                     0740
*        RFY RTNREG UNRSTD;                                        0741
*                                                                  0741
*        IF GDTDBG = NULLPTR                                       0742
*          THEN;                                                   0742
         L     @15,@PC00001                                        0742
         L     @15,GDTDBG(,@15)                                    0742
         LTR   @15,@15                                             0742
         BZ    @RT00742                                            0742
*          ELSE                                                    0744
*            CALL IDCDB010 (GDTTBL,'BIL2');                        0744
*                                                                  0744
         L     @15,@PC00001                                        0744
         ST    @15,@AL00001                                        0744
         LA    @14,@CC01284                                        0744
         ST    @14,@AL00001+4                                      0744
         MVI   @AL00001+4,X'80'                                    0744
         L     @15,GDTDBG(,@15)                                    0744
         LA    @01,@AL00001                                        0744
         BALR  @14,@15                                             0744
*        IF CATRETCC ^= 0                                          0745
*          THEN                                                    0745
@RT00742 LH    @15,CATRETCC                                        0745
         LTR   @15,@15                                             0745
         BZ    @RF00745                                            0745
*            DO;                                                   0746
*                                                                  0746
*            CASTID = LOCATERR;                                    0747
         L     @15,@PC00008+20                                     0747
         MVC   CASTID(4,@15),@CB00920                              0747
*            RETURN CODE(LASTCC12);                                0748
*                                                                  0748
         LA    @15,12                                              0748
         L     @14,@SA00008                                        0748
         LM    @00,@12,@SA00008+8                                  0748
         BR    @14                                                 0748
*            END;                                                  0749
*                                                                  0749
*        /************************************************************/
*        /*                                                          */
*        /* MOVE POINTERS TO DATA RETURNED FROM FPLS TO SAVE AREA    */
*        /* WHERE THEY WILL BE REFERENCED BY LOCPROC                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  0750
*        CTGFLPTR = ADDR(LOCFPENT);                                0750
@RF00745 LA    CTGFLPTR,LOCFPENT                                   0750
*        STOPL = OFF;                                              0751
*                                                                  0751
         NI    STOPL,B'01111111'                                   0751
*        DO LC = 1 TO 2 WHILE STOPL = OFF;                         0752
*                                                                  0752
         LA    LC,1                                                0752
@DL00752 TM    STOPL,B'10000000'                                   0752
         BNZ   @DC00752                                            0752
*          IF CTGFLNG(1) ^= 0                                      0753
*            THEN                                                  0753
         L     @15,CTGFLNG(,CTGFLPTR)                              0753
         LTR   @15,@15                                             0753
         BZ    @RF00753                                            0753
*              CATLOPTR(LC) = CTGFLPT(1);                          0754
*                                                                  0754
         LR    @15,LC                                              0754
         SLA   @15,2                                               0754
         L     @14,@PC00008+12                                     0754
         L     @07,CTGFLPT(,CTGFLPTR)                              0754
         AL    @14,@CF01678                                        0754
         ST    @07,CATLOPTR(@15,@14)                               0754
*            ELSE                                                  0755
*              STOPL = ON;                                         0755
*                                                                  0755
         B     @RC00753                                            0755
@RF00753 OI    STOPL,B'10000000'                                   0755
*          CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT); 0756
*                                                                  0756
@RC00753 AL    CTGFLPTR,@CF00311                                   0756
*        END;                                                      0757
*                                                                  0757
         AL    LC,@CF00220                                         0757
         C     LC,@CF00154                                         0757
         BNH   @DL00752                                            0757
@DC00752 DS    0H                                                  0758
*        IF CATLOCNO = '1'                                         0758
*          THEN                                                    0758
         L     @03,@PC00008                                        0758
         CLI   CATLOCNO(@03),C'1'                                  0758
         BNE   @RF00758                                            0758
*            IF CTGFLNG(1) ^= 0                                    0759
*              THEN                                                0759
         L     @03,CTGFLNG(,CTGFLPTR)                              0759
         LTR   @03,@03                                             0759
         BZ    @RF00759                                            0759
*                CATACBPT = CTGFLPT(1) -> ACBADDR;                 0760
*                                                                  0760
         L     @03,CTGFLPT(,CTGFLPTR)                              0760
         L     @03,ACBADDR(,@03)                                   0760
         ST    @03,CATACBPT                                        0760
*              ELSE                                                0761
*                STOPL = ON;                                       0761
*                                                                  0761
         B     @RC00759                                            0761
@RF00759 OI    STOPL,B'10000000'                                   0761
*          ELSE                                                    0762
*            IF CATLOCNO = '2'                                    0762
*               CATLOCNO = '5'                                     0762
*              THEN                                                0762
         B     @RC00758                                            0762
@RF00758 L     @03,@PC00008                                        0762
         CLI   CATLOCNO(@03),C'2'                                  0762
         BE    @RT00762                                            0762
         CLI   CATLOCNO(@03),C'5'                                  0762
         BNE   @RF00762                                            0762
@RT00762 DS    0H                                                  0763
*                IF CTGFLNG(1) ^= 0                                0763
*                  THEN                                            0763
         L     @03,CTGFLNG(,CTGFLPTR)                              0763
         LTR   @03,@03                                             0763
         BZ    @RF00763                                            0763
*                    CATLOPTR(3) = CTGFLPT(1);                     0764
*                                                                  0764
         L     @03,@PC00008+12                                     0764
         L     @15,CTGFLPT(,CTGFLPTR)                              0764
         ST    @15,CATLOPTR+8(,@03)                                0764
*                  ELSE                                            0765
*                    STOPL = ON;                                   0765
*                                                                  0765
         B     @RC00763                                            0765
@RF00763 OI    STOPL,B'10000000'                                   0765
*        /************************************************************/
*        /*                                                          */
*        /* ALL DATA MUST BE RETURNED FOR THE LOCATE TO BE           */
*        /* SUCCESSFUL.  OTHERWISE, RETURN WITH CONDITION CODE 12    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0766
*        IF STOPL = ON                                             0766
*          THEN                                                    0766
@RC00763 DS    0H                                                  0766
@RF00762 DS    0H                                                  0766
@RC00758 TM    STOPL,B'10000000'                                   0766
         BNO   @RF00766                                            0766
*            DO;                                                   0767
*                                                                  0767
*            CASTID = LOCRTNER;                                    0768
         L     @15,@PC00008+20                                     0768
         MVC   CASTID(4,@15),@CB00914                              0768
*            RETURN CODE(LASTCC12);                                0769
*                                                                  0769
         LA    @15,12                                              0769
         L     @14,@SA00008                                        0769
         LM    @00,@12,@SA00008+8                                  0769
         BR    @14                                                 0769
*            END;                                                  0770
*                                                                  0770
*        RETURN CODE(LASTCC00);                                    0771
*                                                                  0771
@RF00766 SLR   @15,@15                                             0771
         L     @14,@SA00008                                        0771
         LM    @00,@12,@SA00008+8                                  0771
         BR    @14                                                 0771
*END CATPROC;                                                      0772
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - DEFPROC                                 */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF DEFINING THE         */
*        /*            EXTERNAL SORT WORK FILES IF THE CALLER        */
*        /*            SPECIFIES THE EXTERNALSORT PARAMETER OR IF    */
*        /*            THERE IS INSUFFICIENT MAIN STORAGE TO         */
*        /*            PERFORM AN INTERNAL SORT.  DEFPROC            */
*        /*            OBTAINS STORAGE FOR THE CPL/FVT/FPL COMPLEX,  */
*        /*            INITIALIZES THE CPL AND BUILDS FVTS AS        */
*        /*            FOLLOWS -                                     */
*        /*                                                          */
*        /*              . CLUSTER FVT REFERENCES                    */
*        /*                   SORT WORK FILE DATA SET NAME           */
*        /*                   CREATION DATE FPL - DATE OBTAINED      */
*        /*                     USING UTIME MACRO                    */
*        /*                   EXPIRATION DATE FPL - SET TO HIGHEST   */
*        /*                     POSSIBLE DATE(DATA SETS ARE DELETED  */
*        /*                     WITH PURGE)                          */
*        /*                                                          */
*        /*              . DATA FVT REFERENCES                       */
*        /*                   CREATION DATE FPL - SAME AS CLUSTER    */
*        /*                   SPACE FPL - ALLOCATION IN RECORDS,     */
*        /*                     PRIMARY IS TOTAL NUMBER OF 2K        */
*        /*                     BLOCKS, SECONDARY IS 10 PERCENT OF   */
*        /*                     PRIMARY                              */
*        /*                   AMDSB FPL - ATTRIBUTES ARE ESDS, NO    */
*        /*                     WRITECHECK, NONSPANNED, LRECL OF     */
*        /*                     2041, CISIZE OF 2048                 */
*        /*                   DSATTR FPL - ATTRIBUTES ARE SPEED,     */
*        /*                     NOERASE, REUSE                       */
*        /*                   LRECL FPL - AVERAGE RECORD SIZE OF     */
*        /*                     2041                                 */
*        /*                   VOLUME SERIAL LIST                     */
*        /*                                                          */
*        /*                 FOLLOWING A SUCCESSFUL DEFINE OF BOTH    */
*        /*                 WORK FILES, DEFPROC CALLS OPENPROC TO    */
*        /*                 OPEN THEM.  IF EXTERNAL SORT WORK FILES  */
*        /*                 ALREADY EXIST ON ENTRANCE TO THIS        */
*        /*                 PROCEDURE, THEY WILL BE USED IF THEY     */
*        /*                 ARE LARGE ENOUGH.  OTHERWISE, THEY ARE   */
*        /*                 DELETED AND REDEFINED                    */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        DEFCALID - IDENTIFICATION OF CALLER               */
*        /*                                                          */
*        /*        DEFIOIN  - AREA CONTAINING THE ADDRESSES OF THE   */
*        /*                   DATA OBTAINED FROM THE SORT WORK JOB   */
*        /*                   CONTROL                                */
*        /*                                                          */
*        /*        DEFSRTTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*         DEFIOCS - AREA CONTAINING THE ADDRESSES OF THE   */
*        /*                   IOCSTR FOR EACH OPEN SORT WORK FILE    */
*        /*                                                          */
*        /*         DEFSTAT - STATUS COMMUNICATION AREA              */
*        /*                                                          */
*        /* EXIT,NORMAL - SORT WORK FILES HAVE BEEN SUCCESSFULLY     */
*        /*               DEFINED AND OPENED                         */
*        /*                                                          */
*        /* EXIT,ERROR  - RETURN CODE 8                              */
*        /*                 . EXTERNAL SORT JOB CONTROL NOT PROVIDED */
*        /*                 . DEFINE FAILED                          */
*        /*                 . OPEN FAILED                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  0773
*DEFPROC:                                                          0773
*        PROCEDURE (DEFCALID,           /* CALLER IDENTIFICATION     */
*                   DEFIOIN,            /* POINTERS TO SORT WORK     */
*                                       /* JOB CONTROL DATA          */
*                   DEFIOCS,            /* POINTERS TO IOCSTR FOR    */
*                                       /* EACH OPEN DATA SET        */
*                   DEFSRTTB,           /* SORT CONTROL TABLE        */
*                   DEFSTAT);           /* STATUS COMMUNICATION AREA */
*                                                                  0773
DEFPROC  STM   @14,@12,@SA00009                                    0773
         MVC   @PC00009(20),0(@01)                                 0773
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0774
*        DCL DEFCALID CHAR(1);          /* CALLER IDENTIFICATION -   */
*                                       /* 'S' - INITPROC AT START   */
*                                       /*       OF SORT             */
*                                       /* 'C' - SPILPROC WHEN       */
*                                       /*       INTERNAL SORT AREA  */
*                                       /*       FILLED              */
*                                                                  0775
*        DCL 1 DEFIOIN BDY(WORD),       /* POINTERS TO RETURN AREA   */
*              2 DFIOINPT(2) PTR(31);   /* CONTAINING JOB CONTROL    */
*                                       /* DATA                      */
*                                                                  0776
*        DCL 1 DEFIOCS BDY(WORD),       /* POINTERS TO IOCSTR FOR    */
*              2 DFIOCSBS PTR(31),      /* OPEN DATA SETS            */
*              2 DFIOCSAX PTR(31),                                 0776
*              2 DFIOCSSR(2) PTR(31);                              0776
*                                                                  0776
*        DCL DEFSRTTB;                  /* SORT CONTROL TABLE        */
*                                                                  0777
*        DCL 1 DEFSTAT,                 /* STATUS COMMUNICATION AREA */
*              2 DFSAVERC FIXED(15),    /* CURRENT CONDITION CODE    */
*              2 DFSTID   CHAR(4);      /* ERROR IDENTIFIER          */
*                                                                  0778
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL VARIABLES                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  0779
*        DCL                                                       0779
*          DF FIXED(31),                                           0779
*          VS FIXED(31);                                           0779
*                                                                  0779
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLE USED BY UTIME MACRO ISSUED TO OBTAIN CURRENT    */
*        /* DATE                                                     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0780
*        DCL TIMEODAY CHAR(8);                                     0780
*                                                                  0780
*        /************************************************************/
*        /*                                                          */
*        /* FIELD NAMES OF DATA DEFINED                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0781
*        DCL DEFNMTAB(6) CHAR(8) INIT('DSETCRDT','DSETEXDT',       0781
*              'SPACPARM','AMDSBCAT','DSATTR','LRECL');            0781
*                                                                  0781
*        /************************************************************/
*        /*                                                          */
*        /* SPACE ALLOCATION CODE - RECORDS                          */
*        /*                                                          */
*        /************************************************************/
*                                                                  0782
*        DCL SPRECDS BIT(8) CONSTANT('40'X);                       0782
*        /************************************************************/
*        /*                                                          */
*        /* DETERMINE IF EXTERNAL SORT JOB CONTROL WAS PROVIDED.     */
*        /* IF NOT RETURN WITH AN ERROR.  ERROR MESSAGE VARIES       */
*        /* WITH THE CALLER OF DEFPROC AND INDICATES WHETHER THE     */
*        /* SORT COULD NOT START OR COULD NOT CONTINUE               */
*        /*                                                          */
*        /************************************************************/
*                                                                  0783
*        OLDERID2 = NEWERID2;                                      0783
         L     @15,@PC00001                                        0783
         L     @15,GDTTR2(,@15)                                    0783
         MVC   @TS00001(95),NEWERID2(@15)                          0783
         MVC   OLDERID2(95,@15),@TS00001                           0783
*        NEWID2 = 'BID1';                                          0784
*                                                                  0784
         MVC   NEWID2(4,@15),@CC01315                              0784
*        IF DFIOINPT(1) = NULLPTR                                  0785
*          THEN                                                    0785
         L     @15,@PC00009+4                                      0785
         L     @15,DFIOINPT(,@15)                                  0785
         LTR   @15,@15                                             0785
         BNZ   @RF00785                                            0785
*            DO;                                                   0786
*                                                                  0786
*            IF DEFCALID = 'S'                                     0787
*              THEN                                                0787
         L     @15,@PC00009                                        0787
         CLI   DEFCALID(@15),C'S'                                  0787
         BNE   @RF00787                                            0787
*                DFSTID = SORTSTRT;                                0788
*                                                                  0788
         L     @15,@PC00009+16                                     0788
         MVC   DFSTID(4,@15),@CB00902                              0788
*              ELSE                                                0789
*                DFSTID = SORTCONT;                                0789
*                                                                  0789
         B     @RC00787                                            0789
@RF00787 L     @15,@PC00009+16                                     0789
         MVC   DFSTID(4,@15),@CB00904                              0789
*            RETURN CODE(LASTCC08);                                0790
*                                                                  0790
@RC00787 LA    @15,8                                               0790
         L     @14,@SA00009                                        0790
         LM    @00,@12,@SA00009+8                                  0790
         BR    @14                                                 0790
*            END;                                                  0791
*                                                                  0791
*        /************************************************************/
*        /*                                                          */
*        /* IF THE REQUIREMENTS FOR THE CURRENT SORT CAN BE          */
*        /* BE ANSWERED BY SORT WORK FILES WHICH HAVE ALREADY BEEN   */
*        /* DEFINED, BYPASS THE DEFINE PROCESS                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  0792
*        IF SRTFLDEF = ON &                                        0792
*           SRTFLSIZ >= SRTBKTOT                                   0792
*          THEN;                                                   0792
*                                                                  0792
@RF00785 TM    SRTFLDEF,B'10000000'                                0792
         BNO   @RF00792                                            0792
         L     @15,SRTFLSIZ                                        0792
         C     @15,SRTBKTOT                                        0792
         BNL   @RT00792                                            0792
*          ELSE                                                    0794
*DEFSWFLS:   DO;                                                   0794
*                                                                  0794
@RF00792 DS    0H                                                  0794
DEFSWFLS DS    0H                                                  0795
*            /********************************************************/
*            /*                                                      */
*            /* IF SORT WORK FILES EXIST WHICH ARE NOT LARGE ENOUGH, */
*            /* CALL DELTPROC TO DELETE THEM                         */
*            /*                                                      */
*            /********************************************************/
*                                                                  0795
*            IF SRTFLDEF = ON                                      0795
*              THEN                                                0795
         TM    SRTFLDEF,B'10000000'                                0795
         BNO   @RF00795                                            0795
*                DO;                                               0796
*                                                                  0796
*                CALL DELTPROC (DEFIOIN);                          0797
*                                                                  0797
         L     @15,@PC00009+4                                      0797
         ST    @15,@AL00001                                        0797
         LA    @01,@AL00001                                        0797
         BAL   @14,DELTPROC                                        0797
*                SRTFLDEF = OFF;                                   0798
         NI    SRTFLDEF,B'01111111'                                0798
*                SRTFLSIZ = NULLPTR;                               0799
*                                                                  0799
         SLR   @15,@15                                             0799
         ST    @15,SRTFLSIZ                                        0799
*                END;                                              0800
*                                                                  0800
*            /********************************************************/
*            /*                                                      */
*            /* CORE FOR THE CPL/FVT/FPL COMPLEX WAS OBTAINED BY     */
*            /* INITPROC.  ONE 2K BUFFER PRECEDES THE AREA TO BE     */
*            /* USED BY DEFPROC.  CALCULATE THE STARTING ADDRESS.    */
*            /*                                                      */
*            /********************************************************/
*                                                                  0801
*            DFCPPTR = SRTBUFPT + BLKSIZE;                         0801
*                                                                  0801
@RF00795 LA    DFCPPTR,2048                                        0801
         AL    DFCPPTR,SRTBUFPT                                    0801
*            DEFPTR = DFCPPTR + LENGTH(DFCPAREA);                  0802
*                                                                  0802
         LA    DEFPTR,488                                          0802
         ALR   DEFPTR,DFCPPTR                                      0802
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE STATIC PORTIONS OF THE CPL            */
*            /*                                                      */
*            /********************************************************/
*                                                                  0803
*            CTGPLPTR = ADDR(DEFCPL);                              0803
*                                                                  0803
         LA    @04,DEFCPL(,DFCPPTR)                                0803
         ST    @04,CTGPLPTR                                        0803
*            CPLID    = 'DEFINCPL';                                0804
         MVC   CPLID(8,DFCPPTR),@CC01318                           0804
*            CTGNAME  = ON;                                        0805
*            CTGCNAME = ON;                                        0806
         OI    CTGNAME(@04),B'00000110'                            0806
*            CTGFUNC  = CTGCMS;                                    0807
         NI    CTGFUNC(@04),B'10011111'                            0807
         OI    CTGFUNC(@04),B'10000000'                            0807
*            CTGAM0   = ON;                                        0808
         OI    CTGAM0(@04),B'00000001'                             0808
*            CTGOPTNS = CTGDEFIN;                                  0809
         NI    CTGOPTNS(@04),B'00001111'                           0809
         OI    CTGOPTNS(@04),B'00001000'                           0809
*            CTGWKA   = ADDR(NAMESWKA);                            0810
         LA    @02,NAMESWKA(,DFCPPTR)                              0810
         ST    @02,CTGWKA(,@04)                                    0810
*            CTGFVT   = ADDR(CLSTRFVT);                            0811
*                                                                  0811
         LA    @02,CLSTRFVT(,DFCPPTR)                              0811
         ST    @02,CTGFVT(,@04)                                    0811
*            IF ADDR(CAT) ^= NULLPTR                               0812
*              THEN                                                0812
         L     @02,@PC00001+4                                      0812
         L     @02,FDTPTR+16(,@02)                                 0812
         LTR   @02,@02                                             0812
         BZ    @RF00812                                            0812
*                DO;                                               0813
*                                                                  0813
*                CTGCAT = ADDR(CATVAL);                            0814
*                                                                  0814
         LA    @15,CATVAL(,@02)                                    0814
         ST    @15,CTGCAT(,@04)                                    0814
*                IF CATPLN ^= 0                                    0815
*                  THEN                                            0815
         CLI   CATPLN(@02),0                                       0815
         BE    @RF00815                                            0815
*                    CTGPSWD = ADDR(CATPAS);                       0816
*                                                                  0816
         LA    @02,CATPAS(,@02)                                    0816
         ST    @02,CTGPSWD(,@04)                                   0816
*                END;                                              0817
*                                                                  0817
@RF00815 DS    0H                                                  0818
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE STATIC PORTION OF THE CLUSTER FVT     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0818
*            CTGFVPTR = ADDR(CLSTRFVT);                            0818
@RF00812 LA    CTGFVPTR,CLSTRFVT(,DFCPPTR)                         0818
*            CLSTRID  = 'CLSTRFVT';                                0819
         MVC   CLSTRID(8,DFCPPTR),@CC01319                         0819
*            CTGFVTYP = 'C';                                       0820
         MVI   CTGFVTYP(CTGFVPTR),C'C'                             0820
*            CTGFVDCH = ADDR(DATAFVT);                             0821
         LA    @04,DATAFVT(,DFCPPTR)                               0821
         ST    @04,CTGFVDCH(,CTGFVPTR)                             0821
*            CTGFVEXP = ADDR(EXDTFPL);                             0822
         LA    @15,EXDTFPL(,DFCPPTR)                               0822
         ST    @15,CTGFVEXP(,CTGFVPTR)                             0822
*            CTGFVCRE = ADDR(CRDTFPL);                             0823
         LA    @15,CRDTFPL(,DFCPPTR)                               0823
         ST    @15,CTGFVCRE(,CTGFVPTR)                             0823
*            CTGFVWKA = ADDR(RECVSWKA);                            0824
*                                                                  0824
         LA    @14,RECVSWKA(,DFCPPTR)                              0824
         ST    @14,CTGFVWKA(,CTGFVPTR)                             0824
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE DATA FVT                                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0825
*            CTGFVPTR = ADDR(DATAFVT);                             0825
         LR    CTGFVPTR,@04                                        0825
*            DATAID   = 'DATAFVT';                                 0826
         MVI   DATAID+7(DFCPPTR),C' '                              0826
         MVC   DATAID(7,DFCPPTR),@CC01320                          0826
*            CTGFVTYP = 'D';                                       0827
         MVI   CTGFVTYP(CTGFVPTR),C'D'                             0827
*            CTGFVCRE = ADDR(CRDTFPL);                             0828
         ST    @15,CTGFVCRE(,CTGFVPTR)                             0828
*            CTGFVVLT = DEFPTR + LENGTH(DEFAREAS);                 0829
         LA    @04,624                                             0829
         ALR   @04,DEFPTR                                          0829
         ST    @04,CTGFVVLT(,CTGFVPTR)                             0829
*            CTGFVSPC = ADDR(SPACEFPL);                            0830
         LA    @04,SPACEFPL(,DFCPPTR)                              0830
         ST    @04,CTGFVSPC(,CTGFVPTR)                             0830
*            CTGFVAMD = ADDR(AMDSBFPL);                            0831
         LA    @04,AMDSBFPL(,DFCPPTR)                              0831
         ST    @04,CTGFVAMD(,CTGFVPTR)                             0831
*            CTGFVATR = ADDR(DSATTFPL);                            0832
         LA    @04,DSATTFPL(,DFCPPTR)                              0832
         ST    @04,CTGFVATR(,CTGFVPTR)                             0832
*            CTGFVLRS = ADDR(LRECLFPL);                            0833
*                                                                  0833
         LA    @04,LRECLFPL(,DFCPPTR)                              0833
         ST    @04,CTGFVLRS(,CTGFVPTR)                             0833
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE STATIC PORTION OF THE FPLS            */
*            /*                                                      */
*            /********************************************************/
*                                                                  0834
*            CTGFLPTR = ADDR(CRDTFPL);                             0834
*                                                                  0834
         LR    CTGFLPTR,@15                                        0834
*            DO DF = 1 TO 6;                                       0835
*                                                                  0835
         LA    DF,1                                                0835
@DL00835 DS    0H                                                  0836
*              CTGFLDNO = 1;                                       0836
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0836
*              CTGFLDNM = ADDR(DEFNMTAB(DF));                      0837
*                                                                  0837
         LR    @07,DF                                              0837
         SLA   @07,3                                               0837
         LA    @07,DEFNMTAB-8(@07)                                 0837
         ST    @07,CTGFLDNM(,CTGFLPTR)                             0837
*              CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT);
*                                                                  0838
         AL    CTGFLPTR,@CF00311                                   0838
*            END;                                                  0839
*                                                                  0839
         AL    DF,@CF00220                                         0839
         C     DF,@CF00157                                         0839
         BNH   @DL00835                                            0839
*            /********************************************************/
*            /*                                                      */
*            /* SET UP CREATION DATE FPL - ISSUE UTIME TO            */
*            /* OBTAIN CURRENT DATE                                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0840
*            CTGFLPTR = ADDR(CRDTFPL);                             0840
         LA    CTGFLPTR,CRDTFPL(,DFCPPTR)                          0840
*            CTGFLNG(1) = 3;                                       0841
         MVC   CTGFLNG(4,CTGFLPTR),@CF00163                        0841
*            CTGFLPT(1) = ADDR(DEFCRYR);                           0842
*                                                                  0842
         LA    @15,DEFCRYR(,DEFPTR)                                0842
         ST    @15,CTGFLPT(,CTGFLPTR)                              0842
*            CALL IDCSATI0 (GDTTBL,TIMEODAY,DEFCRDT);              0843
*                                                                  0843
         L     @15,@PC00001                                        0843
         ST    @15,@AL00001                                        0843
         LA    @14,TIMEODAY                                        0843
         ST    @14,@AL00001+4                                      0843
         LA    @14,DEFCRDT(,DEFPTR)                                0843
         ST    @14,@AL00001+8                                      0843
         MVI   @AL00001+8,X'80'                                    0843
         L     @15,GDTTIM(,@15)                                    0843
         LA    @01,@AL00001                                        0843
         BALR  @14,@15                                             0843
*            /********************************************************/
*            /*                                                      */
*            /* SET UP EXPIRATION DATE FPL USING MAXIMUM EXPIRA-     */
*            /* TION DATE.  DATA SETS WILL BE DELETED WITH PURGE     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0844
*            CTGFLPTR = ADDR(EXDTFPL);                             0844
         LA    CTGFLPTR,EXDTFPL(,DFCPPTR)                          0844
*            CTGFLNG(1) = 3;                                       0845
         MVC   CTGFLNG(4,CTGFLPTR),@CF00163                        0845
*            CTGFLPT(1) = ADDR(DEFEXPIR);                          0846
*                                                                  0846
         LA    @15,DEFEXPIR(,DEFPTR)                               0846
         ST    @15,CTGFLPT(,CTGFLPTR)                              0846
*            DEFEXPIR = '99999F'X;                                 0847
*                                                                  0847
         MVC   DEFEXPIR(3,DEFPTR),@CB01321                         0847
*            /********************************************************/
*            /*                                                      */
*            /* SET UP AMDSBCAT FPL                                  */
*            /*                                                      */
*            /********************************************************/
*                                                                  0848
*            CTGFLPTR = ADDR(AMDSBFPL);                            0848
         LA    CTGFLPTR,AMDSBFPL(,DFCPPTR)                         0848
*            CTGFLNG(1) = LENGTH(IDAAMDSB);                        0849
         LA    @15,96                                              0849
         ST    @15,CTGFLNG(,CTGFLPTR)                              0849
*            CTGFLPT(1) = ADDR(DEFAMDSB);                          0850
*                                                                  0850
         ST    DEFPTR,CTGFLPT(,CTGFLPTR)                           0850
*            AMDSBPTR = ADDR(DEFAMDSB);                            0851
         LR    AMDSBPTR,DEFPTR                                     0851
*            AMDLEN   = LENGTH(IDAAMDSB);                          0852
         STH   @15,AMDLEN(,AMDSBPTR)                               0852
*            AMDCINV  = BLKSIZE;                                   0853
         MVC   AMDCINV(4,AMDSBPTR),@CF00976                        0853
*            AMDLRECL = CILRECL;                                   0854
*                                                                  0854
         MVC   AMDLRECL(4,AMDSBPTR),@CF00978                       0854
*            /********************************************************/
*            /*                                                      */
*            /* SET UP DSATTR FPL - SPEED, REUSABLE, DEFAULT SHARE   */
*            /* OPTIONS                                              */
*            /*                                                      */
*            /********************************************************/
*                                                                  0855
*            CTGFLPTR = ADDR(DSATTFPL);                            0855
         LA    CTGFLPTR,DSATTFPL(,DFCPPTR)                         0855
*            CTGFLNG(1) = 2;                                       0856
         MVC   CTGFLNG(4,CTGFLPTR),@CF00154                        0856
*            CTGFLPT(1) = ADDR(DEFDSATT);                          0857
*                                                                  0857
         LA    @04,DEFDSATT(,DEFPTR)                               0857
         ST    @04,CTGFLPT(,CTGFLPTR)                              0857
*            DEFSPEED = ON;                                        0858
*            DEFREUS  = ON;                                        0859
         OI    DEFSPEED(DEFPTR),B'10100000'                        0859
*            DEFSHAR  = ON;                                        0860
*                                                                  0860
         OI    DEFSHAR(DEFPTR),B'00100000'                         0860
*            /********************************************************/
*            /*                                                      */
*            /* SET UP LRECL FPL                                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  0861
*            CTGFLPTR = ADDR(LRECLFPL);                            0861
         LA    CTGFLPTR,LRECLFPL(,DFCPPTR)                         0861
*            CTGFLNG(1) = LENGTH(CILRECL);                         0862
         MVC   CTGFLNG(4,CTGFLPTR),@CF00043                        0862
*            CTGFLPT(1) = ADDR(CILRECL);                           0863
*                                                                  0863
         LA    @04,@CF00978                                        0863
         ST    @04,CTGFLPT(,CTGFLPTR)                              0863
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE SPACPARM FPL.  THE SPACE REQUIREMENTS */
*            /* HAVE BEEN CALCULATED IN INITPROC AS THE NUMBER OF    */
*            /* 2K BLOCKS REQUIRED TO CONTAIN ALL SORT RECORDS       */
*            /* (PRIMARY ALLOCATION) PLUS 10 PERCENT OF THAT FIGURE  */
*            /* (SECONDARY ALLOCATION).  SPACE IS ALLOCATED IN       */
*            /* RECORDS.                                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  0864
*            CTGFLPTR = ADDR(SPACEFPL);                            0864
         LA    CTGFLPTR,SPACEFPL(,DFCPPTR)                         0864
*            CTGFLNG(1) = LENGTH(DEFSPACE);                        0865
         MVC   CTGFLNG(4,CTGFLPTR),@CF00629                        0865
*            CTGFLPT(1) = ADDR(DEFSPACE);                          0866
*                                                                  0866
         LA    @04,DEFSPACE(,DEFPTR)                               0866
         ST    @04,CTGFLPT(,CTGFLPTR)                              0866
*            DEFPRIME = SRTBKTOT;                                  0867
         MVC   DEFPRIME(3,DEFPTR),SRTBKTOT+1                       0867
*            DEFSECND = SRTBK10;                                   0868
         MVC   DEFSECND(3,DEFPTR),SRTBK10+1                        0868
*            DEFSPTYP = SPRECDS;                                   0869
*                                                                  0869
         MVI   DEFSPTYP(DEFPTR),X'40'                              0869
*            /********************************************************/
*            /*                                                      */
*            /* SAVE CPL/FVT/FPL COMPLEX JUST INITIALIZED SINCE      */
*            /* VSAM CATALOG MANAGEMENT DESTROYS CERTAIN AREAS       */
*            /*                                                      */
*            /********************************************************/
*                                                                  0870
*            DEFSVCPL = CPFVAREA;                                  0870
         MVC   DEFSVCPL(240,DEFPTR),CPFVAREA(DFCPPTR)              0870
*            DEFSVFPL = FPLAREA;                                   0871
         MVC   DEFSVFPL(144,DEFPTR),FPLAREA(DFCPPTR)               0871
*            DEFSVDAT  = DEFDATA;                                  0872
         MVC   DEFSVDAT(120,DEFPTR),DEFDATA(DEFPTR)                0872
*            /********************************************************/
*            /*                                                      */
*            /* FOR EACH SORT WORK FILE COMPLETE THE INITIALIZATION  */
*            /* AND ISSUE THE DEFINE REQUEST.  INITIALIZE THE        */
*            /* CATALOG WORKAREAS                                    */
*            /*                                                      */
*            /********************************************************/
*                                                                  0873
*DEFCATLG:   DO DF = 1 TO 2;                                       0873
*                                                                  0873
DEFCATLG LA    DF,1                                                0873
@DL00873 DS    0H                                                  0874
*              DEFWKA = ''B;                                       0874
         XC    DEFWKA(104,DFCPPTR),DEFWKA(DFCPPTR)                 0874
*              NAMWKTLN = LENGTH(NAMESWKA);                        0875
         MVC   NAMWKTLN(2,DFCPPTR),@CH01647                        0875
*              RECVSTLN = LENGTH(RECVSWKA);                        0876
*                                                                  0876
         MVC   RECVSTLN(2,DFCPPTR),@CH00037                        0876
*              /******************************************************/
*              /*                                                    */
*              /* REFERENCE THE DATA SET NAME FROM THE CLUSTER FVT   */
*              /*                                                    */
*              /******************************************************/
*                                                                  0877
*              CTGFVPTR = ADDR(CLSTRFVT);                          0877
         LA    CTGFVPTR,CLSTRFVT(,DFCPPTR)                         0877
*              SWDATPTR = DFIOINPT(DF) + 4;                        0878
*                                                                  0878
         LA    @07,4                                               0878
         LR    @15,DF                                              0878
         SLA   @15,2                                               0878
         L     @14,@PC00009+4                                      0878
         AL    @14,@CF01678                                        0878
         L     SWDATPTR,DFIOINPT(@15,@14)                          0878
         ALR   SWDATPTR,@07                                        0878
*              IF IODSNID ^= DSNIDMSK                              0879
*                THEN                                              0879
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0879
         BE    @RF00879                                            0879
*                  SWDATPTR = SWDATPTR + IODSNLN + 4;              0880
*                                                                  0880
         LR    @15,SWDATPTR                                        0880
         AH    @15,IODSNLN(,SWDATPTR)                              0880
         ALR   @15,@07                                             0880
         LR    SWDATPTR,@15                                        0880
*              CTGFVENT = ADDR(IODSN);                             0881
*                                                                  0881
@RF00879 LA    @07,IODSN(,SWDATPTR)                                0881
         ST    @07,CTGFVENT(,CTGFVPTR)                             0881
*              /******************************************************/
*              /*                                                    */
*              /* INITIALIZE THE VOLUME SERIAL LIST AND DNAME        */
*              /* POINTER                                            */
*              /*                                                    */
*              /******************************************************/
*                                                                  0882
*              CTGFVPTR = ADDR(DATAFVT);                           0882
         LA    CTGFVPTR,DATAFVT(,DFCPPTR)                          0882
*              SWDATPTR = DFIOINPT(DF) + 4;                        0883
*                                                                  0883
         LA    @07,4                                               0883
         LR    @15,DF                                              0883
         SLA   @15,2                                               0883
         L     @14,@PC00009+4                                      0883
         AL    @14,@CF01678                                        0883
         L     SWDATPTR,DFIOINPT(@15,@14)                          0883
         ALR   SWDATPTR,@07                                        0883
*              IF IOVLSID ^= VLSIDMSK                              0884
*                THEN                                              0884
         CLC   IOVLSID(2,SWDATPTR),@CB00962                        0884
         BE    @RF00884                                            0884
*                  SWDATPTR = SWDATPTR + IOVLSLN + 4;              0885
*                                                                  0885
         LR    @15,SWDATPTR                                        0885
         AH    @15,IOVLSLN(,SWDATPTR)                              0885
         ALR   @15,@07                                             0885
         LR    SWDATPTR,@15                                        0885
*              VOLLSTLN = IOVLSLN / 6;                             0886
*                                                                  0886
@RF00884 L     @07,CTGFVVLT(,CTGFVPTR)                             0886
         LH    @00,IOVLSLN(,SWDATPTR)                              0886
         SRDA  @00,32                                              0886
         D     @00,@CF00157                                        0886
         STH   @01,VOLLSTLN(,@07)                                  0886
*              DO VS = 1 TO VOLLSTLN;                              0887
*                                                                  0887
         LA    @07,1                                               0887
         B     @DE00887                                            0887
@DL00887 DS    0H                                                  0888
*                VOLCODE(VS) = ''B;                                0888
         LR    @15,@07                                             0888
         SLA   @15,3                                               0888
         L     @14,CTGFVVLT(,CTGFVPTR)                             0888
         ST    @15,@TF00001                                        0888
         ALR   @15,@14                                             0888
         AL    @15,@CF01668                                        0888
         XC    VOLCODE-2(2,@15),VOLCODE-2(@15)                     0888
*                VOLSER(VS) = IOVLSER(VS);                         0889
*                                                                  0889
         AL    @14,@TF00001                                        0889
         AL    @14,@CF01678                                        0889
         LR    @15,@07                                             0889
         MH    @15,@CH00157                                        0889
         ALR   @15,SWDATPTR                                        0889
         BCTR  @15,0                                               0889
         BCTR  @15,0                                               0889
         MVC   VOLSER-4(6,@14),IOVLSER-4(@15)                      0889
*              END;                                                0890
*                                                                  0890
         AL    @07,@CF00220                                        0890
@DE00887 ST    @07,VS                                              0890
         L     @01,CTGFVVLT(,CTGFVPTR)                             0890
         CH    @07,VOLLSTLN(,@01)                                  0890
         BNH   @DL00887                                            0890
*              VOLLSTLN = VOLLSTLN * 8;                            0891
*                                                                  0891
         L     @07,CTGFVVLT(,CTGFVPTR)                             0891
         LH    @04,VOLLSTLN(,@07)                                  0891
         SLA   @04,3                                               0891
         STH   @04,VOLLSTLN(,@07)                                  0891
*              IF ADDR(WFILE) ^= NULLPTR                           0892
*                THEN                                              0892
         L     @07,@PC00001+4                                      0892
         L     @04,FDTPTR+20(,@07)                                 0892
         LTR   @04,@04                                             0892
         BZ    @RF00892                                            0892
*                  IF DF = 1                                       0893
*                    THEN                                          0893
         C     DF,@CF00220                                         0893
         BNE   @RF00893                                            0893
*                      CTGFVIND = ADDR(WFLE1VAL);                  0894
*                                                                  0894
         L     @07,FDTPTR+24(,@07)                                 0894
         LA    @07,WFLE1VAL(,@07)                                  0894
         ST    @07,CTGFVIND(,CTGFVPTR)                             0894
*                    ELSE                                          0895
*                      CTGFVIND = ADDR(WFLE2VAL);                  0895
*                                                                  0895
         B     @RC00893                                            0895
@RF00893 L     @07,@PC00001+4                                      0895
         L     @07,FDTPTR+28(,@07)                                 0895
         LA    @07,WFLE2VAL(,@07)                                  0895
         ST    @07,CTGFVIND(,CTGFVPTR)                             0895
*                ELSE                                              0896
*                  CTGFVIND = ADDR(DEFDDN(DF));                    0896
*                                                                  0896
         B     @RC00892                                            0896
@RF00892 LR    @07,DF                                              0896
         SLA   @07,3                                               0896
         LA    @07,DEFDDN-8(@07)                                   0896
         ST    @07,CTGFVIND(,CTGFVPTR)                             0896
*              /******************************************************/
*              /*                                                    */
*              /* ISSUE THE UCATLG TO DEFINE THE SORT WORK FILE      */
*              /*                                                    */
*              /******************************************************/
*                                                                  0897
*              CALL IDCSACA0 (GDTTBL,CTGPLPTR);                    0897
*                                                                  0897
@RC00892 L     @07,@PC00001                                        0897
         ST    @07,@AL00001                                        0897
         LA    @04,CTGPLPTR                                        0897
         ST    @04,@AL00001+4                                      0897
         L     @15,GDTCAT(,@07)                                    0897
         LA    @01,@AL00001                                        0897
         BALR  @14,@15                                             0897
*              RFY RTNREG RSTD;                                    0898
*              CATRETCC = RTNREG;                                  0899
         STH   RTNREG,CATRETCC                                     0899
*              RFY RTNREG UNRSTD;                                  0900
*                                                                  0900
*              IF GDTDBG = NULLPTR                                 0901
*                THEN;                                             0901
         L     @07,@PC00001                                        0901
         L     @07,GDTDBG(,@07)                                    0901
         LTR   @07,@07                                             0901
         BZ    @RT00901                                            0901
*                ELSE                                              0903
*                  CALL IDCDB010 (GDTTBL,'BID2');                  0903
*                                                                  0903
         L     @07,@PC00001                                        0903
         ST    @07,@AL00001                                        0903
         LA    @04,@CC01324                                        0903
         ST    @04,@AL00001+4                                      0903
         MVI   @AL00001+4,X'80'                                    0903
         L     @15,GDTDBG(,@07)                                    0903
         LA    @01,@AL00001                                        0903
         BALR  @14,@15                                             0903
*              IF CATRETCC ^= 0                                    0904
*                THEN                                              0904
@RT00901 LH    @07,CATRETCC                                        0904
         LTR   @07,@07                                             0904
         BZ    @RF00904                                            0904
*                  DO;                                             0905
*                                                                  0905
*                  DFSTID = DEFERROR;                              0906
         L     @15,@PC00009+16                                     0906
         MVC   DFSTID(4,@15),@CB00906                              0906
*                  RETURN CODE(LASTCC08);                          0907
*                                                                  0907
         LA    @15,8                                               0907
         L     @14,@SA00009                                        0907
         LM    @00,@12,@SA00009+8                                  0907
         BR    @14                                                 0907
*                  END;                                            0908
*                                                                  0908
*                /****************************************************/
*                /*                                                  */
*                /* IF THE FIRST DEFINE WAS SUCCESSFUL RESTORE THE   */
*                /* CPL/FVT/FPL COMPLEX FOR THE SECOND DEFINE        */
*                /*                                                  */
*                /****************************************************/
*                                                                  0909
*                ELSE                                              0909
*                  DO;                                             0909
*                                                                  0909
@RF00904 DS    0H                                                  0910
*                  CPFVAREA = DEFSVCPL;                            0910
         MVC   CPFVAREA(240,DFCPPTR),DEFSVCPL(DEFPTR)              0910
*                  FPLAREA  = DEFSVFPL;                            0911
         MVC   FPLAREA(144,DFCPPTR),DEFSVFPL(DEFPTR)               0911
*                  DEFDATA  = DEFSVDAT;                            0912
         MVC   DEFDATA(120,DEFPTR),DEFSVDAT(DEFPTR)                0912
*                  SRTFLDEF = ON;                                  0913
*                                                                  0913
         OI    SRTFLDEF,B'10000000'                                0913
*                  END;                                            0914
*                                                                  0914
*            END DEFCATLG;                                         0915
*                                                                  0915
         AL    DF,@CF00220                                         0915
         C     DF,@CF00154                                         0915
         BNH   @DL00873                                            0915
*            /********************************************************/
*            /*                                                      */
*            /* THIS COMPLETES THE DEFINITION OF THE SORT WORK       */
*            /* FILES.  SAVE THE FILE SIZE                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  0916
*            SRTFLSIZ = SRTBKTOT;                                  0916
*                                                                  0916
         L     @15,SRTBKTOT                                        0916
         ST    @15,SRTFLSIZ                                        0916
*            END DEFSWFLS;                                         0917
*                                                                  0917
*        /************************************************************/
*        /*                                                          */
*        /* OPEN EACH SORT WORK DATA SET                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0918
*        DO DF = 1 TO 2;                                           0918
*                                                                  0918
@RT00792 LA    DF,1                                                0918
@DL00918 DS    0H                                                  0919
*          CALL OPENPROC ('S',DFIOCSSR(DF),NULLPTR,DFIOINPT(DF));  0919
*                                                                  0919
         LA    @07,@CC01131                                        0919
         ST    @07,@AL00001                                        0919
         LR    @07,DF                                              0919
         SLA   @07,2                                               0919
         L     @15,@PC00009+8                                      0919
         LA    @15,DFIOCSSR-4(@07,@15)                             0919
         ST    @15,@AL00001+4                                      0919
         LA    @15,@CF00116                                        0919
         ST    @15,@AL00001+8                                      0919
         L     @15,@PC00009+4                                      0919
         AL    @15,@CF01678                                        0919
         LA    @07,DFIOINPT(@07,@15)                               0919
         ST    @07,@AL00001+12                                     0919
         LA    @01,@AL00001                                        0919
         BAL   @14,OPENPROC                                        0919
*          RESPECIFY RTNREG RSTD;                                  0920
*          TESTRC = RTNREG;                                        0921
         LR    TESTRC,RTNREG                                       0921
*          RESPECIFY RTNREG UNRSTD;                                0922
*                                                                  0922
*          IF TESTRC ^= 0                                          0923
*            THEN                                                  0923
         LTR   TESTRC,TESTRC                                       0923
         BZ    @RF00923                                            0923
*              RETURN CODE(LASTCC08);                              0924
*                                                                  0924
         LA    @15,8                                               0924
         L     @14,@SA00009                                        0924
         LM    @00,@12,@SA00009+8                                  0924
         BR    @14                                                 0924
*        END;                                                      0925
*                                                                  0925
@RF00923 AL    DF,@CF00220                                         0925
         C     DF,@CF00154                                         0925
         BNH   @DL00918                                            0925
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLER OF DEFPROC                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0926
*        RETURN CODE(LASTCC00);                                    0926
*                                                                  0926
         SLR   @15,@15                                             0926
         L     @14,@SA00009                                        0926
         LM    @00,@12,@SA00009+8                                  0926
         BR    @14                                                 0926
*END DEFPROC;                                                      0927
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - DELTPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF DELETING THE SORT    */
*        /*            WORK FILES.  THIS PROCEDURE IS CALLED BY      */
*        /*            DEFPROC IF DEFINED SORT WORK FILES EXIST      */
*        /*            BUT ARE NOT LARGE ENOUGH FOR THE ALTERNATE    */
*        /*            INDEX CURRENTLY BEING BUILT AND BY TERMPROC   */
*        /*            DURING FINAL CLEANUP                          */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*         DELTIOIN - AREA CONTAINING THE ADDRESSES OF      */
*        /*                    THE DATA OBTAINED FROM THE SORT       */
*        /*                    WORK JOB CONTROL                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  0928
*DELTPROC:                                                         0928
*        PROCEDURE (DELTIOIN);          /* PTS TO JOB CONTROL DATA   */
*                                                                  0928
DELTPROC STM   @14,@12,@SA00010                                    0928
         MVC   @PC00010(4),0(@01)                                  0928
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0929
*        DCL 1 DELTIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */
*              2 DLIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */
*                                       /* JOB CONTROL DATA          */
*                                                                  0930
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL VARIABLE                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0930
*        DCL DL FIXED(31);                                         0930
*                                                                  0930
*        /************************************************************/
*        /*                                                          */
*        /* AREA CONTAINING THE DELETE CPL                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  0931
*        DCL 1 DELCPLAR BDY(WORD),                                 0931
*              2 DELCPLID CHAR(8),              /* CPL DUMP ID       */
*              2 DELCPL   CHAR(LENGTH(CTGPL)),  /* CPL               */
*              2 *        CHAR(4),                                 0931
*              2 DELWKA,                        /* DELETED NAMES     */
*                                               /* WORKAREA          */
*                3 DELWKTLN FIXED(15),                             0931
*                3 DELWKRLN FIXED(15),                             0931
*                3 DELWK(2),                                       0931
*                  4 DELWKTYP CHAR(1),                             0931
*                  4 DELWKNAM CHAR(44);                            0931
*                                                                  0931
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE THE DELETE CPL                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0932
*        OLDERID2 = NEWERID2;                                      0932
         L     @15,@PC00001                                        0932
         L     @15,GDTTR2(,@15)                                    0932
         MVC   @TS00001(95),NEWERID2(@15)                          0932
         MVC   OLDERID2(95,@15),@TS00001                           0932
*        NEWID2 = 'BIDL';                                          0933
*                                                                  0933
         MVC   NEWID2(4,@15),@CC01342                              0933
*        DELCPLAR = ''B;                                           0934
         XC    DELCPLAR(134),DELCPLAR                              0934
*        DELCPLID = 'DELETCPL';                                    0935
*                                                                  0935
         MVC   DELCPLID(8),@CC01343                                0935
*        CTGPLPTR = ADDR(DELCPL);                                  0936
         LA    @15,DELCPL                                          0936
         ST    @15,CTGPLPTR                                        0936
*        CTGNAME  = ON;                                            0937
*        CTGCNAME = ON;                                            0938
         OI    CTGNAME(@15),B'00000110'                            0938
*        CTGAM0   = ON;                                            0939
         OI    CTGAM0(@15),B'00000001'                             0939
*        CTGFUNC  = CTGCMS;                                        0940
         NI    CTGFUNC(@15),B'10011111'                            0940
         OI    CTGFUNC(@15),B'10000000'                            0940
*        CTGOPTNS = CTGDELET;                                      0941
         NI    CTGOPTNS(@15),B'00011111'                           0941
         OI    CTGOPTNS(@15),B'00011000'                           0941
*        CTGTYPE  = 'C';                                           0942
         MVI   CTGTYPE(@15),C'C'                                   0942
*        CTGPURG  = ON;                                            0943
*                                                                  0943
         OI    CTGPURG(@15),B'00100000'                            0943
*        DELWKTLN = LENGTH(DELWKA);                                0944
         MVC   DELWKTLN(2),@CH01647                                0944
*        CTGWKA   = ADDR(DELWKA);                                  0945
*                                                                  0945
         LA    @14,DELWKA                                          0945
         ST    @14,CTGWKA(,@15)                                    0945
*        /************************************************************/
*        /*                                                          */
*        /* IF THE CATALOG PARAMETER HAS BEEN SPECIFIED, REFERENCE IT*/
*        /* FROM THE CPL TOGETHER WITH ITS PASSWORD IF SPECIFIED     */
*        /*                                                          */
*        /************************************************************/
*                                                                  0946
*        IF ADDR(CAT) ^= NULLPTR                                   0946
*          THEN                                                    0946
         L     @14,@PC00001+4                                      0946
         L     @14,FDTPTR+16(,@14)                                 0946
         LTR   @14,@14                                             0946
         BZ    @RF00946                                            0946
*            DO;                                                   0947
*                                                                  0947
*            CTGCAT = ADDR(CATVAL);                                0948
*                                                                  0948
         LA    @07,CATVAL(,@14)                                    0948
         ST    @07,CTGCAT(,@15)                                    0948
*            IF CATPLN ^= 0                                        0949
*              THEN                                                0949
         CLI   CATPLN(@14),0                                       0949
         BE    @RF00949                                            0949
*                CTGPSWD = ADDR(CATPAS);                           0950
*                                                                  0950
         LA    @14,CATPAS(,@14)                                    0950
         ST    @14,CTGPSWD(,@15)                                   0950
*            END;                                                  0951
*                                                                  0951
@RF00949 DS    0H                                                  0952
*        /************************************************************/
*        /*                                                          */
*        /* COMPLETE THE CPL AND ISSUE THE CATALOG DELETE REQUEST    */
*        /* FOR EACH SORT WORK FILE                                  */
*        /*                                                          */
*        /* REFERENCE THE SORT WORK FILE DATA SET NAME AND DNAME     */
*        /* FROM THE CPL                                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0952
*        DO DL = 1 TO 2;                                           0952
*                                                                  0952
@RF00946 LA    DL,1                                                0952
@DL00952 DS    0H                                                  0953
*          SWDATPTR = DLIOINPT(DL) + 4;                            0953
*                                                                  0953
         LA    @03,4                                               0953
         LR    @15,DL                                              0953
         SLA   @15,2                                               0953
         L     @14,@PC00010                                        0953
         AL    @14,@CF01678                                        0953
         L     SWDATPTR,DLIOINPT(@15,@14)                          0953
         ALR   SWDATPTR,@03                                        0953
*          IF IODSNID ^= DSNIDMSK                                  0954
*            THEN                                                  0954
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0954
         BE    @RF00954                                            0954
*              SWDATPTR = SWDATPTR + IODSNLN + 4;                  0955
*                                                                  0955
         LR    @05,SWDATPTR                                        0955
         AH    @05,IODSNLN(,SWDATPTR)                              0955
         ALR   @05,@03                                             0955
         LR    SWDATPTR,@05                                        0955
*          CTGENT = ADDR(IODSN);                                   0956
*                                                                  0956
@RF00954 L     @05,CTGPLPTR                                        0956
         LA    @03,IODSN(,SWDATPTR)                                0956
         ST    @03,CTGENT(,@05)                                    0956
*          IF ADDR(WFILE) ^= NULLPTR                               0957
*            THEN                                                  0957
         L     @03,@PC00001+4                                      0957
         L     @04,FDTPTR+20(,@03)                                 0957
         LTR   @04,@04                                             0957
         BZ    @RF00957                                            0957
*              IF DL = 1                                           0958
*                THEN                                              0958
         C     DL,@CF00220                                         0958
         BNE   @RF00958                                            0958
*                  CTGDDNM = ADDR(WFLE1VAL);                       0959
*                                                                  0959
         L     @03,FDTPTR+24(,@03)                                 0959
         LA    @03,WFLE1VAL(,@03)                                  0959
         ST    @03,CTGDDNM(,@05)                                   0959
*                ELSE                                              0960
*                  CTGDDNM = ADDR(WFLE2VAL);                       0960
*                                                                  0960
         B     @RC00958                                            0960
@RF00958 L     @03,@PC00001+4                                      0960
         L     @03,FDTPTR+28(,@03)                                 0960
         LA    @03,WFLE2VAL(,@03)                                  0960
         L     @01,CTGPLPTR                                        0960
         ST    @03,CTGDDNM(,@01)                                   0960
*            ELSE                                                  0961
*              CTGDDNM = ADDR(DEFDDN(DL));                         0961
*                                                                  0961
         B     @RC00957                                            0961
@RF00957 LR    @03,DL                                              0961
         SLA   @03,3                                               0961
         LA    @03,DEFDDN-8(@03)                                   0961
         L     @01,CTGPLPTR                                        0961
         ST    @03,CTGDDNM(,@01)                                   0961
*          CALL IDCSACA0 (GDTTBL,CTGPLPTR);                        0962
*                                                                  0962
@RC00957 L     @03,@PC00001                                        0962
         ST    @03,@AL00001                                        0962
         LA    @15,CTGPLPTR                                        0962
         ST    @15,@AL00001+4                                      0962
         L     @15,GDTCAT(,@03)                                    0962
         LA    @01,@AL00001                                        0962
         BALR  @14,@15                                             0962
*          RFY RTNREG RSTD;                                        0963
*          CATRETCC = RTNREG;                                      0964
         STH   RTNREG,CATRETCC                                     0964
*          RFY RTNREG UNRSTD;                                      0965
*                                                                  0965
*          IF GDTDBG = NULLPTR                                     0966
*            THEN;                                                 0966
         L     @03,@PC00001                                        0966
         L     @03,GDTDBG(,@03)                                    0966
         LTR   @03,@03                                             0966
         BZ    @RT00966                                            0966
*            ELSE                                                  0968
*              CALL IDCDB010 (GDTTBL,'BIDL');                      0968
*                                                                  0968
         L     @03,@PC00001                                        0968
         ST    @03,@AL00001                                        0968
         LA    @15,@CC01342                                        0968
         ST    @15,@AL00001+4                                      0968
         MVI   @AL00001+4,X'80'                                    0968
         L     @15,GDTDBG(,@03)                                    0968
         LA    @01,@AL00001                                        0968
         BALR  @14,@15                                             0968
*        END;                                                      0969
*                                                                  0969
@RT00966 AL    DL,@CF00220                                         0969
         C     DL,@CF00154                                         0969
         BNH   @DL00952                                            0969
*        /************************************************************/
*        /*                                                          */
*        /* RETURN TO CALLING PROCEDURE                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  0970
*        RETURN;                                                   0970
*                                                                  0970
@EL00010 DS    0H                                                  0970
@EF00010 DS    0H                                                  0970
@ER00010 LM    @14,@12,@SA00010                                    0970
         BR    @14                                                 0970
*END DELTPROC;                                                     0971
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - INITPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF OBTAINING RESOURCES  */
*        /*            FOR BUILDING THE ALTERNATE INDEX, CONSISTING  */
*        /*            OF                                            */
*        /*              . OBTAINING CORE FOR BUFFERS AND WORK AREAS */
*        /*                                                          */
*        /*              . CALCULATING THE SORT RECORD SIZE          */
*        /*                                                          */
*        /*              . CALCULATING CORE REQUIREMENTS FOR THE     */
*        /*                SORT                                      */
*        /*                                                          */
*        /*              . CALCULATING SPACE REQUIREMENTS FOR AN     */
*        /*                EXTERNAL SORT                             */
*        /*                                                          */
*        /*              . OBTAINING CORE THE FOR SORT               */
*        /*                                                          */
*        /*              . CALLING A SEPARATE INTERNAL PROCEDURE     */
*        /*                (DEFPROC) IF IT IS NECESSARY TO DEFINE    */
*        /*                AND OPEN SORT WORK FILES                  */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        INITAMDS - POINTERS TO BASE CLUSTER AND AIX       */
*        /*                   AMDSB CONTROL BLOCKS                   */
*        /*                                                          */
*        /*        INITIOIN - POINTERS TO THE DATA OBTAINED FROM     */
*        /*                   THE SORT WORK JOB CONTROL              */
*        /*                                                          */
*        /*        INITSRTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*        INITIOCS - POINTERS TO THE IOCSTR OF EACH SORT    */
*        /*                   WORK FILE IF THEY WERE DEFINED AND     */
*        /*                   OPENED                                 */
*        /*                                                          */
*        /*        INITSRTB - SORT CONTROL TABLE WITH FACTORS        */
*        /*                   CALCULATED (SEE FUNCTION) AND          */
*        /*                   POINTERS TO CORE OBTAINED              */
*        /*                                                          */
*        /*        INITSTAT - STATUS COMMUNICATION AREA              */
*        /*                                                          */
*        /* EXIT, NORMAL - ALL RESOURCES SUCCESSFULLY OBTAINED       */
*        /*                                                          */
*        /* EXIT, ERROR  - RETURN CODE 8, VIRTUAL CORE COULD NOT     */
*        /*                  BE OBTAINED OR SORT WORK FILES COULD    */
*        /*                  NOT BE DEFINED OR OPENED                */
*        /*                                                          */
*        /************************************************************/
*                                                                  0972
*INITPROC:                                                         0972
*        PROCEDURE (INITAMDS,          /* PTRS TO AMDSBS             */
*                   INITIOCS,          /* PTRS TO IOCSTRS            */
*                   INITIOIN,          /* PTRS TO SORT WORK DATA     */
*                   INITSRTB,          /* SORT CONTROL TABLE         */
*                   INITSTAT);         /* STATUS COMMUNICATION AREA  */
*                                                                  0972
INITPROC STM   @14,@12,@SA00011                                    0972
         MVC   @PC00011(20),0(@01)                                 0972
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0973
*        DCL 1 INITAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */
*              2 INIAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */
*              2 INIAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */
*                                                                  0973
*        DCL 1 INITIOCS BDY(WORD),     /* POINTERS TO IOCSTR FOR     */
*              2 INIOCSPT(4) PTR(31);  /* OPEN DATA SETS             */
*                                                                  0974
*        DCL 1 INITIOIN BDY(WORD),     /* POINTERS TO SORT WORK      */
*              2 INIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */
*                                                                  0975
*        DCL INITSRTB;                 /* SORT CONTROL TABLE         */
*                                                                  0976
*        DCL 1 INITSTAT,               /* STATUS COMMUNICATION AREA  */
*              2 INSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 INSTID   CHAR(4);     /* ERROR IDENTIFIER           */
*                                                                  0977
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLES AND CONSTANTS USED IN CALCULATIONS             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0978
*        DCL                                                       0978
*          WKASIZE  FIXED(31),         /* CORE FOR BUFFERS AND       */
*                                      /* WORK AREAS                 */
*          RSAREM   FIXED(15),         /* FACTOR TO ROUND RSA TO     */
*                                      /* 2K BLOCK INCREMENT         */
*          RSAINIT  FIXED(31),         /* INITIALLY CALCULATED RSA   */
*                                      /* SIZE                       */
*          SORTCORE FIXED(31),         /* SIZE OF RSA AND HEAP       */
*          STOPI    BIT(1);            /* LOOP CONTROL               */
*                                                                  0978
*        DCL                                                       0979
*          SECALLOC FIXED(8)  CONSTANT(10), /* SECONDARY ALLOCATION  */
*          MAXEXRSA FIXED(31) CONSTANT(102400), /* MAXIMUM EXTERNAL  */
*                                               /* SORT RSA SIZE     */
*          MEDEXRSA FIXED(31) CONSTANT(61440),  /* MEDIUM EXTERNAL   */
*                                               /* SORT RSA SIZE     */
*          MINEXRSA FIXED(31) CONSTANT(32768),  /* MINIMUM EXTERNAL  */
*                                               /* SORT RSA SIZE     */
*          MINRSA   FIXED(31) CONSTANT(4096),   /* MINIMUM RSA SIZE  */
*          VIRLIMIT FIXED(31)                   /* LIMIT OF VIRTUAL  */
*                   CONSTANT(16777215);         /* CORE              */
*        /************************************************************/
*        /*                                                          */
*        /* CALCULATE TOTAL CORE SIZE REQUIRED FOR BUFFERS AND       */
*        /* WORK AREAS, CONSISTING OF                                */
*        /*                                                          */
*        /*    . 1 2K BUFFER AS THE AMOUNT REQUIRED FOR OUTPUT       */
*        /*      IF AN EXTERNAL SORT IS REQUIRED                     */
*        /*    . CPL/FVT/FPL AREA NEEDED IF SORT WORK FILES MUST     */
*        /*      BE DEFINED                                          */
*        /*    . ALTERNATE INDEX RECORD OUTPUT AREA                  */
*        /*                                                          */
*        /* CORE FOR SUPPORT OF AN EXTERNAL SORT MUST BE OBTAINED    */
*        /* AT THIS TIME SINCE THE STATISTIC USED TO DETERMINE       */
*        /* SORT REQUIREMENTS (NUMBER OF RECORDS IN THE BASE         */
*        /* CLUSTER) MAY BE IN ERROR.  IF THIS STATISTIC IS LOW,     */
*        /* IT WILL BE NECESSARY TO GO TO AN EXTERNAL SORT DURING    */
*        /* THE FIRST SORT PHASE.                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  0980
*        OLDERID2 = NEWERID2;                                      0980
         L     @05,@PC00001                                        0980
         L     @02,GDTTR2(,@05)                                    0980
         MVC   @TS00001(95),NEWERID2(@02)                          0980
         MVC   OLDERID2(95,@02),@TS00001                           0980
*        NEWID2 = 'BII1';                                          0981
*                                                                  0981
         MVC   NEWID2(4,@02),@CC01379                              0981
*        AMDSBPTR = INIAMAIX;                                      0982
*                                                                  0982
         L     @02,@PC00011                                        0982
         L     AMDSBPTR,INIAMAIX(,@02)                             0982
*        WKASIZE = BLKSIZE +                                       0983
*                  (LENGTH(DFCPAREA) + LENGTH(DEFAREAS) +          0983
*                   LENGTH(VOLLIST)) +                             0983
*                  AMDLRECL;                                       0983
*                                                                  0983
         LA    @02,3292                                            0983
         AL    @02,AMDLRECL(,AMDSBPTR)                             0983
         ST    @02,WKASIZE                                         0983
*        /************************************************************/
*        /*                                                          */
*        /* ISSUE UGPOOL TO OBTAIN STORAGE FOR BUFFERS AND WORK      */
*        /* AREAS.  IF UNSUCCESSFUL, RETURN WITH CODE 8.             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0984
*        CALL IDCSAGP0 (GDTTBL,WKASIZE,SRTBUFPT,UGPIDPG,SETZERO);  0984
*                                                                  0984
         ST    @05,@AL00001                                        0984
         LA    @02,WKASIZE                                         0984
         ST    @02,@AL00001+4                                      0984
         LA    @02,SRTBUFPT                                        0984
         ST    @02,@AL00001+8                                      0984
         LA    @02,UGPIDPG                                         0984
         ST    @02,@AL00001+12                                     0984
         LA    @02,SETZERO                                         0984
         ST    @02,@AL00001+16                                     0984
         MVI   @AL00001+16,X'80'                                   0984
         L     @15,GDTGPL(,@05)                                    0984
         LA    @01,@AL00001                                        0984
         BALR  @14,@15                                             0984
*        RESPECIFY RTNREG RSTD;                                    0985
*        TESTRC = RTNREG;                                          0986
         LR    TESTRC,RTNREG                                       0986
*        RESPECIFY RTNREG UNRSTD;                                  0987
*                                                                  0987
*        IF TESTRC ^= 0                                            0988
*          THEN                                                    0988
         LTR   TESTRC,TESTRC                                       0988
         BZ    @RF00988                                            0988
*            DO;                                                   0989
*                                                                  0989
*            INSTID = WKACORE;                                     0990
         L     @15,@PC00011+16                                     0990
         MVC   INSTID(4,@15),@CB00898                              0990
*            RETURN CODE(LASTCC08);                                0991
*                                                                  0991
         LA    @15,8                                               0991
         L     @14,@SA00011                                        0991
         LM    @00,@12,@SA00011+8                                  0991
         BR    @14                                                 0991
*            END;                                                  0992
*                                                                  0992
*        /************************************************************/
*        /*                                                          */
*        /* CALCULATE THE SORT RECORD SIZE - ALTERNATE INDEX KEY     */
*        /* LENGTH PLUS PRIME KEY LENGTH(KSDS) OR RBA LENGTH(ESDS).  */
*        /* ASCERTAIN IF THE BASE CLUSTER IS A KSDS OR ESDS.  THIS   */
*        /* WILL DETERMINE IF PRIME KEYS OR RBAS ARE TO BE           */
*        /* CONCATENATED TO THE ALTERNATE KEY IN FORMING THE SORT    */
*        /* RECORD AND THUS WILL AFFECT THE SIZE OF THE SORT RECORD. */
*        /*                                                          */
*        /************************************************************/
*                                                                  0993
*        SRTRECSZ = AMDKEYLN;                                      0993
*                                                                  0993
@RF00988 LH    @05,AMDKEYLN(,AMDSBPTR)                             0993
         STH   @05,SRTRECSZ                                        0993
*        AMDSBPTR = INIAMBAS;                                      0994
*                                                                  0994
         L     @15,@PC00011                                        0994
         L     AMDSBPTR,INIAMBAS(,@15)                             0994
*        IF AMDDST = ON                                            0995
*          THEN                                                    0995
         TM    AMDDST(AMDSBPTR),B'10000000'                        0995
         BNO   @RF00995                                            0995
*            SRTRECSZ = SRTRECSZ + AMDKEYLN;                       0996
*                                                                  0996
         AH    @05,AMDKEYLN(,AMDSBPTR)                             0996
         STH   @05,SRTRECSZ                                        0996
*          ELSE                                                    0997
*            SRTRECSZ = SRTRECSZ + 4;                              0997
*                                                                  0997
         B     @RC00995                                            0997
@RF00995 LH    @05,SRTRECSZ                                        0997
         LA    @05,4(,@05)                                         0997
         STH   @05,SRTRECSZ                                        0997
*        /************************************************************/
*        /*                                                          */
*        /* CALCULATE EXTERNAL SORT REQUIREMENTS IN ANTICIPATION OF  */
*        /* AN EXTERNAL SORT (THESE FACTORS WILL NOT BE USED IF      */
*        /* AN INTERNAL SORT IS PERFORMED).                          */
*        /*                                                          */
*        /* CALCULATE THE NUMBER OF RECORDS PER 2 K BLOCK - 2041     */
*        /* DIVIDED BY SORT RECORD SIZE.                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  0998
*        SRTRECBK = CILRECL / SRTRECSZ;                            0998
*                                                                  0998
@RC00995 LH    @05,SRTRECSZ                                        0998
         LA    @00,2041                                            0998
         SRDA  @00,32                                              0998
         DR    @00,@05                                             0998
         STH   @01,SRTRECBK                                        0998
*        /************************************************************/
*        /*                                                          */
*        /* CALCULATE THE TOTAL NUMBER OF 2K BLOCKS - NUMBER OF      */
*        /* RECORDS IN BASE CLUSTER DIVIDED BY NUMBER OF RECORDS     */
*        /* PER 2K BLOCK.  THE NUMBER OF RECORDS IN THE BASE CLUSTER */
*        /* IS OBTAINED FROM THE STATISTIC MAINTAINED IN THE BASE    */
*        /* CLUSTER AMDSB.  SINCE THIS STATISTIC CAN BE ERRONEOUS    */
*        /* (DUE TO FAILURE DURING CLOSE), A SECONDARY               */
*        /* ALLOCATION OF 10 PERCENT WILL BE USED IN DEFINING        */
*        /* EXTERNAL SORT WORK FILES.  ADD A FUDGE FACTOR TO EACH    */
*        /* OF THESE CALCULATIONS IN ORDER TO ENSURE A NON-ZERO      */
*        /* RESULT.                                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  0999
*        SRTBKTOT = (AMDNLR / SRTRECBK) + 10;                      0999
         LA    @15,10                                              0999
         L     @14,AMDNLR(,AMDSBPTR)                               0999
         LR    @06,@14                                             0999
         SRDA  @06,32                                              0999
         DR    @06,@01                                             0999
         ALR   @07,@15                                             0999
         ST    @07,SRTBKTOT                                        0999
*        SRTBK10  = (SRTBKTOT / SECALLOC) + 10;                    1000
*                                                                  1000
         LR    @00,@07                                             1000
         SRDA  @00,32                                              1000
         DR    @00,@15                                             1000
         ALR   @01,@15                                             1000
         ST    @01,SRTBK10                                         1000
*        /************************************************************/
*        /*                                                          */
*        /* DETERMINE THE STARTING VALUE OF THE SIZE OF THE RECORD   */
*        /* SORT AREA(RSA).  THIS IS THE AREA INTO WHICH THE SORT    */
*        /* RECORDS ARE PLACED DURING THE FIRST PHASE OF THE SORT.   */
*        /* THE RSA SIZE IS ALWAYS IN INCREMENTS OF 2K SO THAT IT    */
*        /* CAN BE LATER USED AS AN INPUT AREA DURING THE MERGE      */
*        /* PHASE OF AN EXTERNAL SORT.  THE SIZE OF THE RSA INCLUDES */
*        /* A FUDGE FACTOR TO ACCOUNT FOR AN ERRONEOUS NUMBER OF     */
*        /* RECORDS STATISTIC.  THE FUDGE FACTOR IS EITHER THAT      */
*        /* AMOUNT NEEDED TO ROUND UP TO THE NEXT HIGHEST 2K         */
*        /* MULTIPLE OR 2K EXACTLY.                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1001
*        RSAINIT = AMDNLR * SRTRECSZ;                              1001
         LR    @01,@14                                             1001
         MR    @00,@05                                             1001
         LR    RSAINIT,@01                                         1001
*        RSAREM = RSAINIT // BLKSIZE;                              1002
*                                                                  1002
         LR    @00,RSAINIT                                         1002
         SRDA  @00,32                                              1002
         D     @00,@CF00976                                        1002
         LR    RSAREM,@00                                          1002
*        IF RSAREM ^= 0                                            1003
*          THEN                                                    1003
         LTR   RSAREM,RSAREM                                       1003
         BZ    @RF01003                                            1003
*            RSAINIT = RSAINIT + (BLKSIZE - RSAREM);               1004
*                                                                  1004
         LA    @15,2048                                            1004
         SLR   @15,RSAREM                                          1004
         ALR   RSAINIT,@15                                         1004
*          ELSE                                                    1005
*            RSAINIT = RSAINIT + BLKSIZE;                          1005
*                                                                  1005
         B     @RC01003                                            1005
@RF01003 AL    RSAINIT,@CF00976                                    1005
*        /************************************************************/
*        /*                                                          */
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS LESS THAN 4K,    */
*        /* IT IS INCREMENTED TO 4K.  THIS IS NECESSARY IN THE       */
*        /* EVENT THAT THE NUMBER OF RECORDS STATISTIC IN THE AMDSB  */
*        /* IS SO ERRONEOUSLY LOW THAT IT WILL BE NECESSARY TO GO    */
*        /* INTO AN EXTERNAL SORT.  IN THAT SITUATION, THE 4K WILL   */
*        /* BE USED FOR TWO 2K INPUT BUFFERS AND A TWO-WAY MERGE     */
*        /* WILL OCCUR.                                              */
*        /*                                                          */
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS GREATER THAN     */
*        /* 4K BUT LESS THAN 32K OR IF THE CALLER HAS SPECIFIED      */
*        /* THE EXTERNAL SORT PARAMETER, AN RSA SIZE OF 32K IS       */
*        /* SET.  UNDER ALL CIRCUMSTANCES EXCEPT THAT MENTIONED      */
*        /* ABOVE (A 4K RSA), 32K IS THE MINIMUM RSA SIZE THAT       */
*        /* WILL BE USED.  THIS ALLOWS FOR A 16-WAY MERGE IF         */
*        /* AN EXTERNAL SORT IS NECESSARY SINCE THE RSA AREA IS      */
*        /* USED FOR INPUT BUFFERS DURING THE MERGE PHASE.           */
*        /*                                                          */
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS GREATER THAN     */
*        /* 16 MEGABYTES (THE LIMIT OF VIRTUAL CORE), AN EXTERNAL    */
*        /* SORT WILL BE PERFORMED.  IN THIS SITUATION, AN RSA       */
*        /* SIZE OF 100K IS SET.  THIS IS THE MAXIMUM RSA FOR AN     */
*        /* EXTERNAL SORT.                                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1006
*        IF RSAINIT < MINEXRSA                                     1006
*          THEN                                                    1006
@RC01003 C     RSAINIT,@CF01374                                    1006
         BNL   @RF01006                                            1006
*            IF RSAINIT < MINRSA                                   1007
*              THEN                                                1007
         L     @03,@CF01376                                        1007
         CR    RSAINIT,@03                                         1007
         BNL   @RF01007                                            1007
*                RSAINIT = MINRSA;                                 1008
*                                                                  1008
         LR    RSAINIT,@03                                         1008
*              ELSE                                                1009
*                RSAINIT = MINEXRSA;                               1009
*                                                                  1009
         B     @RC01007                                            1009
@RF01007 L     RSAINIT,@CF01374                                    1009
*          ELSE;                                                   1010
*                                                                  1010
@RF01006 DS    0H                                                  1011
*        SRTRSASZ = RSAINIT;                                       1011
*                                                                  1011
@RC01006 ST    RSAINIT,SRTRSASZ                                    1011
*        IF ADDR(ESORT) ^= NULLPTR &                               1012
*           SRTRSASZ ^= MINRSA                                     1012
*              THEN                                                1012
         L     @03,@PC00001+4                                      1012
         L     @03,FDTPTR+32(,@03)                                 1012
         LTR   @03,@03                                             1012
         BZ    @RF01012                                            1012
         L     @03,SRTRSASZ                                        1012
         C     @03,@CF01376                                        1012
         BE    @RF01012                                            1012
*                SRTRSASZ = MINEXRSA;                              1013
*                                                                  1013
         MVC   SRTRSASZ(4),@CF01374                                1013
*        IF SRTRSASZ > VIRLIMIT                                    1014
*          THEN                                                    1014
@RF01012 L     @03,SRTRSASZ                                        1014
         C     @03,@CF01378                                        1014
         BNH   @RF01014                                            1014
*            SRTRSASZ = MAXEXRSA;                                  1015
*                                                                  1015
         MVC   SRTRSASZ(4),@CF01370                                1015
*        /************************************************************/
*        /*                                                          */
*        /* IN A LOOP, CALCULATE THE WORKING RSA CAPACITY AND ITS    */
*        /* MATCHING HEAP SIZE.  THE HEAP IS AN ARRAY OF POINTERS    */
*        /* TO THE RECORDS IN THE RSA WHICH IS IN SORTED SEQUENCE.   */
*        /* SEE PROLOG IN SORTPROC FOR DESCRIPTION OF THE FUNCTION   */
*        /* OF THE HEAP AND HOW IT IS SORTED.  ISSUE A UGPOOL TO     */
*        /* OBTAIN CORE FOR THE RSA AND HEAP.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1016
*        SRTRSAPT = NULLPTR;                                       1016
@RF01014 SLR   @03,@03                                             1016
         ST    @03,SRTRSAPT                                        1016
*        STOPI    = OFF;                                           1017
*                                                                  1017
         NI    STOPI,B'01111111'                                   1017
*        DO WHILE STOPI = OFF;                                     1018
*                                                                  1018
         B     @DE01018                                            1018
@DL01018 DS    0H                                                  1019
*          SRTRSACP = SRTRSASZ / SRTRECSZ;                         1019
         L     @15,SRTRSASZ                                        1019
         LR    @00,@15                                             1019
         SRDA  @00,32                                              1019
         LH    @14,SRTRECSZ                                        1019
         DR    @00,@14                                             1019
         ST    @01,SRTRSACP                                        1019
*          SORTCORE = SRTRSASZ + (SRTRSACP * 4);                   1020
*                                                                  1020
         SLA   @01,2                                               1020
         ALR   @15,@01                                             1020
         ST    @15,SORTCORE                                        1020
*          CALL IDCSAGP0 (GDTTBL,SORTCORE,SRTRSAPT,UGPIDPG,SETZERO);
*                                                                  1021
         L     @15,@PC00001                                        1021
         ST    @15,@AL00001                                        1021
         LA    @14,SORTCORE                                        1021
         ST    @14,@AL00001+4                                      1021
         LA    @14,SRTRSAPT                                        1021
         ST    @14,@AL00001+8                                      1021
         LA    @14,UGPIDPG                                         1021
         ST    @14,@AL00001+12                                     1021
         LA    @14,SETZERO                                         1021
         ST    @14,@AL00001+16                                     1021
         MVI   @AL00001+16,X'80'                                   1021
         L     @15,GDTGPL(,@15)                                    1021
         LA    @01,@AL00001                                        1021
         BALR  @14,@15                                             1021
*          RESPECIFY RTNREG RSTD;                                  1022
*          TESTRC = RTNREG;                                        1023
         LR    TESTRC,RTNREG                                       1023
*          RESPECIFY RTNREG UNRSTD;                                1024
*                                                                  1024
*          /**********************************************************/
*          /*                                                        */
*          /* IF THE CORE WAS SUCCESSFULLY OBTAINED, GET OUT OF      */
*          /* LOOP.                                                  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1025
*          IF TESTRC = 0                                           1025
*            THEN                                                  1025
         LTR   TESTRC,TESTRC                                       1025
         BNZ   @RF01025                                            1025
*              STOPI = ON;                                         1026
*                                                                  1026
         OI    STOPI,B'10000000'                                   1026
*            ELSE                                                  1027
*                                                                  1027
*              /******************************************************/
*              /*                                                    */
*              /* THE AMOUNT OF CORE BEING REQUESTED IS SET AT FOUR  */
*              /* PLATEAUS - MAXIMUM (WHICH HAS FAILED IN WE REACH   */
*              /* THIS POINT), 100K, 60K, 32K.  SET UP NEXT REQUEST  */
*              /* AND TRY AGAIN.                                     */
*              /*                                                    */
*              /******************************************************/
*                                                                  1027
*              IF SRTRSASZ > MAXEXRSA                              1027
*                THEN                                              1027
         B     @RC01025                                            1027
@RF01025 L     @03,@CF01370                                        1027
         C     @03,SRTRSASZ                                        1027
         BNL   @RF01027                                            1027
*                  SRTRSASZ = MAXEXRSA;                            1028
*                                                                  1028
         ST    @03,SRTRSASZ                                        1028
*                ELSE                                              1029
*                  IF SRTRSASZ > MEDEXRSA                          1029
*                    THEN                                          1029
         B     @RC01027                                            1029
@RF01027 L     @03,@CF01372                                        1029
         C     @03,SRTRSASZ                                        1029
         BNL   @RF01029                                            1029
*                      SRTRSASZ = MEDEXRSA;                        1030
*                                                                  1030
         ST    @03,SRTRSASZ                                        1030
*                    ELSE                                          1031
*                      IF SRTRSASZ > MINEXRSA                      1031
*                        THEN                                      1031
         B     @RC01029                                            1031
@RF01029 L     @03,@CF01374                                        1031
         C     @03,SRTRSASZ                                        1031
         BNL   @RF01031                                            1031
*                          SRTRSASZ = MINEXRSA;                    1032
*                                                                  1032
         ST    @03,SRTRSASZ                                        1032
*                        ELSE                                      1033
*                          STOPI = ON;                             1033
*                                                                  1033
         B     @RC01031                                            1033
@RF01031 OI    STOPI,B'10000000'                                   1033
*        END;                                                      1034
*                                                                  1034
@RC01031 DS    0H                                                  1034
@RC01029 DS    0H                                                  1034
@RC01027 DS    0H                                                  1034
@RC01025 DS    0H                                                  1034
@DE01018 TM    STOPI,B'10000000'                                   1034
         BZ    @DL01018                                            1034
*        /************************************************************/
*        /*                                                          */
*        /* IF NO SORT CORE WAS OBTAINED, SET THE ERROR CONDITION    */
*        /* AND RETURN WITH A CODE 8.                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1035
*        IF GDTDBG = NULLPTR                                       1035
*          THEN;                                                   1035
         L     @03,@PC00001                                        1035
         L     @03,GDTDBG(,@03)                                    1035
         LTR   @03,@03                                             1035
         BZ    @RT01035                                            1035
*          ELSE                                                    1037
*            CALL IDCDB010 (GDTTBL,'BII2');                        1037
*                                                                  1037
         L     @03,@PC00001                                        1037
         ST    @03,@AL00001                                        1037
         LA    @15,@CC01380                                        1037
         ST    @15,@AL00001+4                                      1037
         MVI   @AL00001+4,X'80'                                    1037
         L     @15,GDTDBG(,@03)                                    1037
         LA    @01,@AL00001                                        1037
         BALR  @14,@15                                             1037
*        IF SRTRSAPT = NULLPTR                                     1038
*          THEN                                                    1038
@RT01035 L     @03,SRTRSAPT                                        1038
         LTR   @03,@03                                             1038
         BNZ   @RF01038                                            1038
*            DO;                                                   1039
*                                                                  1039
*            INSTID = WKACORE;                                     1040
         L     @15,@PC00011+16                                     1040
         MVC   INSTID(4,@15),@CB00898                              1040
*            RETURN CODE(LASTCC08);                                1041
*                                                                  1041
         LA    @15,8                                               1041
         L     @14,@SA00011                                        1041
         LM    @00,@12,@SA00011+8                                  1041
         BR    @14                                                 1041
*            END;                                                  1042
*                                                                  1042
*        /************************************************************/
*        /*                                                          */
*        /* SORT CORE WAS SUCCESSFULLY OBTAINED.  DETERMINE IF IT    */
*        /* IS LESS THAN THE INITIALLY CALCULATED REQUIREMENT AND,   */
*        /* IF SO, CALL DEFPROC TO DEFINE AND OPEN THE SORT WORK     */
*        /* FILES.  IF THE DEFINE FAILS, RETURN WITH A CODE 8.       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1043
*        IF SRTRSASZ < RSAINIT                                     1043
*          THEN                                                    1043
@RF01038 C     RSAINIT,SRTRSASZ                                    1043
         BNH   @RF01043                                            1043
*            DO;                                                   1044
*                                                                  1044
*            CALL DEFPROC('S',INITIOIN,INITIOCS,INITSRTB,INITSTAT);
*                                                                  1045
         LA    @15,@CC01131                                        1045
         ST    @15,@AL00001                                        1045
         L     @15,@PC00011+8                                      1045
         ST    @15,@AL00001+4                                      1045
         L     @15,@PC00011+4                                      1045
         ST    @15,@AL00001+8                                      1045
         L     @15,@PC00011+12                                     1045
         ST    @15,@AL00001+12                                     1045
         L     @15,@PC00011+16                                     1045
         ST    @15,@AL00001+16                                     1045
         LA    @01,@AL00001                                        1045
         BAL   @14,DEFPROC                                         1045
*            RESPECIFY RTNREG RSTD;                                1046
*            TESTRC = RTNREG;                                      1047
         LR    TESTRC,RTNREG                                       1047
*            RESPECIFY RTNREG UNRSTD;                              1048
*                                                                  1048
*            IF TESTRC ^= 0                                        1049
*              THEN                                                1049
         LTR   TESTRC,TESTRC                                       1049
         BZ    @RF01049                                            1049
*                RETURN CODE(LASTCC08);                            1050
*                                                                  1050
         LA    @15,8                                               1050
         L     @14,@SA00011                                        1050
         LM    @00,@12,@SA00011+8                                  1050
         BR    @14                                                 1050
*            END;                                                  1051
*                                                                  1051
@RF01049 DS    0H                                                  1052
*        /************************************************************/
*        /*                                                          */
*        /* CALCULATE THE NUMBER OF 2K BLOCKS IN THE RSA WHICH WILL  */
*        /* BE USED AS INPUT BUFFERS DURING THE MERGE PHASE IF AN    */
*        /* EXTERNAL SORT IS PERFORMED.                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1052
*        SRTRSABK = SRTRSASZ / BLKSIZE;                            1052
@RF01043 L     @00,SRTRSASZ                                        1052
         SRDA  @00,32                                              1052
         D     @00,@CF00976                                        1052
         ST    @01,SRTRSABK                                        1052
*            IF SRTRSABK > 16             /*LIMIT TO 16      @OZ14784*/
*              THEN                       /*   MERGE         @OZ14784*/
         LA    @15,16                                              1053
         CR    @01,@15                                             1053
         BNH   @RF01053                                            1053
*                SRTRSABK = 16;                            /*@OZ14784*/
*                                                                  1054
         ST    @15,SRTRSABK                                        1054
*        /************************************************************/
*        /*                                                          */
*        /* SORT INITIALIZATION HAS COMPLETED SUCCESSFULLY.  RETURN  */
*        /* TO THE CALLING PROCEDURE(MAINPROC).                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1055
*        RETURN CODE(LASTCC00);                                    1055
@RF01053 SLR   @15,@15                                             1055
         L     @14,@SA00011                                        1055
         LM    @00,@12,@SA00011+8                                  1055
         BR    @14                                                 1055
*END INITPROC;                                                     1056
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - CNTLPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF CONTROLLING THE      */
*        /*            ACTUAL BUILD OF THE ALTERNATE INDEX           */
*        /*            THROUGH THE FOLLOWING STEPS -                 */
*        /*                                                          */
*        /*            . INITIALIZE SORT FACTORS                     */
*        /*                                                          */
*        /*            . READ BASE CLUSTER RECORD AND PASS IT        */
*        /*              TO A LOWER LEVEL PROCEDURE (SORTPROC)       */
*        /*              WHICH WILL CREATE THE SORT RECORD, PLACE    */
*        /*              IT IN THE RSA AND UPDATE THE HEAP ARRAY     */
*        /*              WITH A POINTER TO THE RECORD.  IF THE RSA   */
*        /*              REACHES CAPACITY BEFORE END OF FILE ON THE  */
*        /*              BASE CLUSTER, SORTPROC WILL SORT THE RSA    */
*        /*              AND CALL SPILPROC TO WRITE OUT THE RECORDS  */
*        /*              TO THE EXTERNAL SORT WORK FILE              */
*        /*                                                          */
*        /*            . AT END OF FILE ON THE BASE CLUSTER, CALL    */
*        /*              SORTPROC TO SORT THE RSA                    */
*        /*                                                          */
*        /*            . IF AN EXTERNAL SORT HAS BEEN INITIATED      */
*        /*                                                          */
*        /*              . ISSUE  A UCLOSE MACRO TO CLOSE THE        */
*        /*                SORT WORK FILE                            */
*        /*                                                          */
*        /*              . CALL  OPENPROC TO RE-OPEN THE SORT WORK   */
*        /*                FILE FOR THE FIRST MERGE PASS             */
*        /*                                                          */
*        /*              . CALL  MERGPROC TO PERFORM THE MERGE       */
*        /*                PASSES OF THE EXTERNAL SORT.  AT THE      */
*        /*                CONCLUSION OF THE MERGE, MERGPROC PASSES  */
*        /*                EACH RECORD TO BLDPROC WHICH BUILDS AND   */
*        /*                WRITES OUT THE ALTERNATE INDEX RECORDS.   */
*        /*                                                          */
*        /*            . AT END OF FILE ON THE BASE CLUSTER, IF      */
*        /*              THE RSA DOES CONTAIN ALL THE SORT RECORDS,  */
*        /*              CNTLPROC PASSES EACH RECORD TO BLDPROC      */
*        /*              WHICH BUILDS AND WRITES OUT THE ALTERNATE   */
*        /*              INDEX RECORDS.                              */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        CNTLAMDS - POINTERS TO BASE CLUSTER AND AIX       */
*        /*                   AMDSB CONTROL BLOCKS                   */
*        /*                                                          */
*        /*        CNTLIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */
*        /*                   SET                                    */
*        /*                                                          */
*        /*        CNTLIOIN - POINTERS TO THE DATA OBTAINED FROM     */
*        /*                   THE SORT WORK JOB CONTROL              */
*        /*                                                          */
*        /*        CNTLSRTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*        CNTLSTAT - STATUS COMMUNICATION AREA CONTAINING   */
*        /*                   FINAL AIX CONDITION CODE               */
*        /*                                                          */
*        /* EXIT, NORMAL - ALTERNATE INDEX SUCCESSFULLY BUILT        */
*        /*                                                          */
*        /* EXIT, ERROR  - FINAL AIX CONDITION CODE HAS BEEN PLACED  */
*        /*                IN THE STATUS COMMUNICATION AREA.         */
*        /*                                                          */
*        /*                . CODE 8 - I/O ERROR READING BASE         */
*        /*                           CLUSTER OR A TERMINATING       */
*        /*                           CONDITION FOUND BY A LOWER     */
*        /*                           LEVEL PROCEDURE                */
*        /*                                                          */
*        /*                . CODE 4 - A NON-TERMINATING CONDITION    */
*        /*                           PASSED BACK FROM BLDPROC       */
*        /*                                                          */
*        /************************************************************/
*CNTLPROC:                                                         1057
*        PROCEDURE (CNTLAMDS,          /* PTRS TO AMDSBS             */
*                   CNTLIOCS,          /* PTRS TO IOCSTRS            */
*                   CNTLIOIN,          /* PTRS TO SORT WORK DATA     */
*                   CNTLSRTB,          /* SORT CONTROL TABLE         */
*                   CNTLSTAT);         /* STATUS COMMUNICATION AREA  */
*                                                                  1057
CNTLPROC STM   @14,@12,@SA00012                                    1057
         MVC   @PC00012(20),0(@01)                                 1057
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1058
*        DCL 1 CNTLAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */
*              2 CNTAMBAS PTR(31),     /* POINTER  TO BASE AMDSB     */
*              2 CNTAMAIX PTR(31);     /* POINTER  TO AIX AMDSB      */
*                                                                  1058
*        DCL 1 CNTLIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */
*              2 CNIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */
*              2 CNIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */
*              2 CNIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */
*                                                                  1059
*        DCL 1 CNTLIOIN BDY(WORD),     /* POINTERS TO SORT WORK      */
*              2 CNIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */
*                                                                  1060
*        DCL CNTLSRTB;                 /* SORT CONTROL TABLE         */
*                                                                  1061
*        DCL 1 CNTLSTAT,               /* STATUS COMMUNICATION AREA  */
*              2 CNSAVERC FIXED(15),   /* FINAL AIX CONDITION CODE   */
*              2 CNSTID   CHAR(4);     /* ERROR INDENTIFIER          */
*                                                                  1062
*        /************************************************************/
*        /*                                                          */
*        /* RETURN CODE FROM UGET OF BASE CLUSTER                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1063
*        DCL GETRC FIXED(15);                                      1063
*                                                                  1063
*        /************************************************************/
*        /*                                                          */
*        /* INDEX VALUE TO PASS TO OPEN TO INDICATE THAT THE FIRST   */
*        /* SORT WORK FILE IS TO BE OPENED                           */
*        /*                                                          */
*        /************************************************************/
*                                                                  1064
*        DCL SWFONE FIXED(31) INIT(1);                             1064
*                                                                  1064
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL VARIABLE                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1065
*        DCL NM FIXED(31);                                         1065
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE SORT FACTORS                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1066
*        OLDERID2 = NEWERID2;                                      1066
         L     @03,@PC00001                                        1066
         L     @03,GDTTR2(,@03)                                    1066
         MVC   @TS00001(95),NEWERID2(@03)                          1066
         MVC   OLDERID2(95,@03),@TS00001                           1066
*        NEWID2 = 'BIC1';                                          1067
*                                                                  1067
         MVC   NEWID2(4,@03),@CC01405                              1067
*        SRTBSCNT = 0;                    /* BASE CLUSTER RECORD     */
         SLR   @03,@03                                             1068
         ST    @03,SRTBSCNT                                        1068
*                                         /* COUNT                   */
*        SRTHEAPT = SRTRSAPT + SRTRSASZ;  /* POINTER TO HEAP         */
         L     @15,SRTRSAPT                                        1069
         LR    @14,@15                                             1069
         AL    @14,SRTRSASZ                                        1069
         ST    @14,SRTHEAPT                                        1069
*        SRTCURSA = SRTRSAPT;             /* POINTER TO CURRENT      */
         ST    @15,SRTCURSA                                        1070
*                                         /* RSA RECORD SLOT         */
*        SRTRSACT = 0;                    /* COUNT OF RECORDS IN RSA */
         ST    @03,SRTRSACT                                        1071
*        SRTFLBLD = ON;                   /* BLDPROC FIRST ENTRY FLAG*/
         OI    SRTFLBLD,B'00010000'                                1072
*        SRTOSTRG = 0;                    /* NUMBER OF OUTPUT STRINGS*/
         ST    @03,SRTOSTRG                                        1073
*        SRTFLEXT = OFF;                  /* EXTERNAL SORT FLAG      */
         NI    SRTFLEXT,B'10111111'                                1074
*        GETRC    = 0;                    /* UGET RETURN CODE        */
*                                                                  1075
         SLR   GETRC,GETRC                                         1075
*        /************************************************************/
*        /*                                                          */
*        /*  INITIALIZE THE RDF AND CIDF FIELDS IN THE OUTPUT        */
*        /*  BUFFER SO THAT THE BUFFER WILL BE SET UP IF AN EXTERNAL */
*        /*  SORT MUST BE PERFORMED                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1076
*        OUTBUFPT = SRTBUFPT;                                      1076
*                                                                  1076
         L     @15,SRTBUFPT                                        1076
         ST    @15,OUTBUFPT                                        1076
*        OUTRDFFL = ''B;                                           1077
         MVI   OUTRDFFL(@15),X'00'                                 1077
*        OUTRDFLN = CILRECL;                                       1078
         LA    @14,2041                                            1078
         STH   @14,OUTRDFLN(,@15)                                  1078
*        OUTCIDFS = CILRECL;                                       1079
         STH   @14,OUTCIDFS(,@15)                                  1079
*        OUTCIDLN = 0;                                             1080
*                                                                  1080
         STH   @03,OUTCIDLN(,@15)                                  1080
*        /************************************************************/
*        /*                                                          */
*        /* IN A LOOP, READ BASE CLUSTER RECORDS AND PASS THEM       */
*        /* TO SORTPROC.  AT END OF FILE MAKE ONE MORE CALL TO       */
*        /* CAUSE THE RECORDS IN THE RSA TO BE SORTED. RETURN        */
*        /* TO THE CALLING PROCEDURE (MAINPROC) IF AN ERROR.         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1081
*        DO WHILE GETRC ^= 16;                                     1081
*                                                                  1081
         B     @DE01081                                            1081
@DL01081 DS    0H                                                  1082
*          CALL IDCIOGT0 (GDTTBL,CNIOCSBS);                        1082
*                                                                  1082
         L     @03,@PC00001                                        1082
         ST    @03,@AL00001                                        1082
         L     @15,@PC00012+4                                      1082
         ST    @15,@AL00001+4                                      1082
         MVI   @AL00001+4,X'80'                                    1082
         L     @15,GDTGET(,@03)                                    1082
         LA    @01,@AL00001                                        1082
         BALR  @14,@15                                             1082
*          RFY RTNREG RSTD;                                        1083
*          GETRC = RTNREG;                                         1084
         LR    GETRC,RTNREG                                        1084
*          RFY RTNREG UNRSTD;                                      1085
*                                                                  1085
*          IF GETRC ^= 0                                           1086
*            THEN                                                  1086
         LTR   GETRC,GETRC                                         1086
         BZ    @RF01086                                            1086
*              IF GETRC ^= 16                                      1087
*                THEN                                              1087
         C     GETRC,@CF00474                                      1087
         BE    @RF01087                                            1087
*                  DO;                                             1088
*                                                                  1088
*                  CNSAVERC = LASTCC08;                            1089
         L     @15,@PC00012+16                                     1089
         MVC   CNSAVERC(2,@15),@CH00180                            1089
*                  RETURN;                                         1090
*                                                                  1090
@EL00012 DS    0H                                                  1090
@EF00012 DS    0H                                                  1090
@ER00012 LM    @14,@12,@SA00012                                    1090
         BR    @14                                                 1090
*                  END;                                            1091
*                                                                  1091
*          /**********************************************************/
*          /*                                                        */
*          /* AT THIS POINT, GETRC IS EITHER 0 (NOT END-OF-FILE)     */
*          /* OR 16 (END-OF-FILE)                                    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1092
*          IF GETRC = 0                                            1092
*            THEN                                                  1092
@RF01087 DS    0H                                                  1092
@RF01086 LTR   GETRC,GETRC                                         1092
         BNZ   @RF01092                                            1092
*               CALL SORTPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,         1093
*                              CNTLSRTB,CNTLSTAT,'N');             1093
         L     @03,@PC00012                                        1093
         ST    @03,@AL00001                                        1093
         L     @03,@PC00012+4                                      1093
         ST    @03,@AL00001+4                                      1093
         L     @03,@PC00012+8                                      1093
         ST    @03,@AL00001+8                                      1093
         L     @03,@PC00012+12                                     1093
         ST    @03,@AL00001+12                                     1093
         L     @03,@PC00012+16                                     1093
         ST    @03,@AL00001+16                                     1093
         LA    @03,@CC01407                                        1093
         ST    @03,@AL00001+20                                     1093
         LA    @01,@AL00001                                        1093
         BAL   @14,SORTPROC                                        1093
*            ELSE                                                  1094
*               CALL SORTPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,         1094
*                              CNTLSRTB,CNTLSTAT,'L');             1094
*                                                                  1094
         B     @RC01092                                            1094
@RF01092 L     @03,@PC00012                                        1094
         ST    @03,@AL00001                                        1094
         L     @03,@PC00012+4                                      1094
         ST    @03,@AL00001+4                                      1094
         L     @03,@PC00012+8                                      1094
         ST    @03,@AL00001+8                                      1094
         L     @03,@PC00012+12                                     1094
         ST    @03,@AL00001+12                                     1094
         L     @03,@PC00012+16                                     1094
         ST    @03,@AL00001+16                                     1094
         LA    @03,@CC01408                                        1094
         ST    @03,@AL00001+20                                     1094
         LA    @01,@AL00001                                        1094
         BAL   @14,SORTPROC                                        1094
*          RESPECIFY RTNREG RSTD;                                  1095
@RC01092 DS    0H                                                  1096
*          TESTRC = RTNREG;                                        1096
         LR    TESTRC,RTNREG                                       1096
*          RESPECIFY RTNREG UNRSTD;                                1097
*                                                                  1097
*          IF TESTRC ^= 0                                          1098
*            THEN                                                  1098
         LTR   TESTRC,TESTRC                                       1098
         BZ    @RF01098                                            1098
*              DO;                                                 1099
*                                                                  1099
*              CNSAVERC = LASTCC08;                                1100
         L     @15,@PC00012+16                                     1100
         MVC   CNSAVERC(2,@15),@CH00180                            1100
*              RETURN;                                             1101
*                                                                  1101
         B     @EL00012                                            1101
*              END;                                                1102
*                                                                  1102
*                                                                  1102
*                                                                  1102
*        END;                                                      1103
*                                                                  1103
@RF01098 DS    0H                                                  1103
@DE01081 C     GETRC,@CF00474                                      1103
         BNE   @DL01081                                            1103
*        IF GDTDBG = NULLPTR                                       1104
*          THEN;                                                   1104
         L     @15,@PC00001                                        1104
         L     @15,GDTDBG(,@15)                                    1104
         LTR   @15,@15                                             1104
         BZ    @RT01104                                            1104
*          ELSE                                                    1106
*            CALL IDCDB010 (GDTTBL, 'BIC2');                       1106
*                                                                  1106
         L     @15,@PC00001                                        1106
         ST    @15,@AL00001                                        1106
         LA    @14,@CC01409                                        1106
         ST    @14,@AL00001+4                                      1106
         MVI   @AL00001+4,X'80'                                    1106
         L     @15,GDTDBG(,@15)                                    1106
         LA    @01,@AL00001                                        1106
         BALR  @14,@15                                             1106
*        /************************************************************/
*        /*                                                          */
*        /* IF ALL THE RECORDS COULD NOT BE CONTAINED IN THE RSA,    */
*        /* SORTPROC HAS CALLED SPILPROC TO GO INTO AN EXTERNAL      */
*        /* SORT.  IF THE EXTERNAL SORT FLAG IS SET, A MERGE WILL    */
*        /* BE PERFORMED.                                            */
*        /*                                                          */
*        /************************************************************/
*                                                                  1107
*        IF SRTFLEXT = ON                                          1107
*          THEN                                                    1107
@RT01104 TM    SRTFLEXT,B'01000000'                                1107
         BNO   @RF01107                                            1107
*CNTLEXT:    DO;                                                   1108
*                                                                  1108
*                                                                  1108
CNTLEXT  DS    0H                                                  1109
*            /********************************************************/
*            /*                                                      */
*            /* DURING THE SORT PHASE, THE OUTPUT SORT WORK FILE     */
*            /* IS IN CREATE MODE.  DURING SUBSEQUENT MERGE PASSES,  */
*            /* IT IS USED AND REUSED WITHOUT BEING CLOSED AND       */
*            /* REOPENED BY DIRECT, UPDATE PROCESSING.  HOWEVER,     */
*            /* DIRECT, UPDATE PROCESSING CANNOT BE USED IF THE FILE */
*            /* IS IN CREATE MODE.  THEREFORE, IT MUST BE CLOSED     */
*            /* AND REOPENED AT THIS TIME.                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1109
*            CALL IDCIOCL0 (GDTTBL,CNIOCSSR(1));                   1109
*                                                                  1109
         L     @15,@PC00001                                        1109
         ST    @15,@AL00001                                        1109
         L     @14,@PC00012+4                                      1109
         LA    @14,CNIOCSSR(,@14)                                  1109
         ST    @14,@AL00001+4                                      1109
         MVI   @AL00001+4,X'80'                                    1109
         L     @15,GDTCLS(,@15)                                    1109
         LA    @01,@AL00001                                        1109
         BALR  @14,@15                                             1109
*            CNIOCSSR(1) = NULLPTR;                                1110
*                                                                  1110
         L     @15,@PC00012+4                                      1110
         SLR   @14,@14                                             1110
         ST    @14,CNIOCSSR(,@15)                                  1110
*            CALL OPENPROC ('M',CNIOCSSR(1),NULLPTR,CNIOINPT(1));  1111
*                                                                  1111
         LA    @14,@CC00744                                        1111
         ST    @14,@AL00001                                        1111
         LA    @15,CNIOCSSR(,@15)                                  1111
         ST    @15,@AL00001+4                                      1111
         LA    @15,@CF00116                                        1111
         ST    @15,@AL00001+8                                      1111
         L     @15,@PC00012+8                                      1111
         ST    @15,@AL00001+12                                     1111
         LA    @01,@AL00001                                        1111
         BAL   @14,OPENPROC                                        1111
*            RESPECIFY RTNREG RSTD;                                1112
*            TESTRC = RTNREG;                                      1113
         LR    TESTRC,RTNREG                                       1113
*            RESPECIFY RTNREG UNRSTD;                              1114
*                                                                  1114
*            IF TESTRC ^= 0                                        1115
*              THEN                                                1115
         LTR   TESTRC,TESTRC                                       1115
         BZ    @RF01115                                            1115
*                DO;                                               1116
*                                                                  1116
*                CNSAVERC = LASTCC08;                              1117
         L     @15,@PC00012+16                                     1117
         MVC   CNSAVERC(2,@15),@CH00180                            1117
*                RETURN;                                           1118
*                                                                  1118
         B     @EL00012                                            1118
*                END;                                              1119
*                                                                  1119
*            /********************************************************/
*            /*                                                      */
*            /* CALL MERGPROC TO PERFORM THE MERGE PASSES OF THE     */
*            /* SORT WORK FILES.  AT THE COMPLETION OF THE MERGE,    */
*            /* MERGPROC WILL PASS EACH RECORD TO BLDPROC TO         */
*            /* ACCOMPLISH THE BUILDING AND WRITING OF THE           */
*            /* ALTERNATE INDEX RECORDS.                             */
*            /*                                                      */
*            /********************************************************/
*                                                                  1120
*            CALL MERGPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,            1120
*                           CNTLSRTB,CNTLSTAT);                    1120
*                                                                  1120
@RF01115 L     @15,@PC00012                                        1120
         ST    @15,@AL00001                                        1120
         L     @15,@PC00012+4                                      1120
         ST    @15,@AL00001+4                                      1120
         L     @15,@PC00012+8                                      1120
         ST    @15,@AL00001+8                                      1120
         L     @15,@PC00012+12                                     1120
         ST    @15,@AL00001+12                                     1120
         L     @15,@PC00012+16                                     1120
         ST    @15,@AL00001+16                                     1120
         LA    @01,@AL00001                                        1120
         BAL   @14,MERGPROC                                        1120
*            RESPECIFY RTNREG RSTD;                                1121
*            TESTRC = RTNREG;                                      1122
         LR    TESTRC,RTNREG                                       1122
*            RESPECIFY RTNREG UNRSTD;                              1123
*                                                                  1123
*            IF TESTRC ^= 0                                        1124
*              THEN                                                1124
         LTR   TESTRC,TESTRC                                       1124
         BZ    @RF01124                                            1124
*                DO;                                               1125
*                                                                  1125
*                CNSAVERC = LASTCC08;                              1126
         L     @15,@PC00012+16                                     1126
         MVC   CNSAVERC(2,@15),@CH00180                            1126
*                RETURN;                                           1127
*                                                                  1127
         B     @EL00012                                            1127
*                END;                                              1128
*                                                                  1128
*            END CNTLEXT;                                          1129
*                                                                  1129
*          /**********************************************************/
*          /*                                                        */
*          /* IF THE EXTERNAL SORT WORK FLAG IS NOT SET, ALL THE     */
*          /* SORTED RECORDS ARE CONTAINED WITHIN THE RSA.           */
*          /* OBTAIN EACH RECORD IN SEQUENCE FROM THE RSA AND        */
*          /* PASS IT TO BLDPROC FOR BUILDING AND WRITING THE        */
*          /* ALTERNATE INDEX RECORDS.                               */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1130
*          ELSE                                                    1130
*CNTLINT:    DO;                                                   1130
*                                                                  1130
         B     @RC01107                                            1130
@RF01107 DS    0H                                                  1130
CNTLINT  DS    0H                                                  1131
*            DO NM = 1 TO SRTRSACT;                                1131
*                                                                  1131
         LA    NM,1                                                1131
         B     @DE01131                                            1131
@DL01131 DS    0H                                                  1132
*              CALL BLDPROC (SHEAPTR(NM),CNTLAMDS,CNTLIOCS,        1132
*                            CNTLSRTB,CNTLSTAT);                   1132
*                                                                  1132
         LR    @03,NM                                              1132
         SLA   @03,2                                               1132
         L     @01,SRTHEAPT                                        1132
         AL    @01,@CF01678                                        1132
         LA    @03,SHEAPTR(@03,@01)                                1132
         ST    @03,@AL00001                                        1132
         L     @03,@PC00012                                        1132
         ST    @03,@AL00001+4                                      1132
         L     @03,@PC00012+4                                      1132
         ST    @03,@AL00001+8                                      1132
         L     @03,@PC00012+12                                     1132
         ST    @03,@AL00001+12                                     1132
         L     @03,@PC00012+16                                     1132
         ST    @03,@AL00001+16                                     1132
         LA    @01,@AL00001                                        1132
         BAL   @14,BLDPROC                                         1132
*              RESPECIFY RTNREG RSTD;                              1133
*              TESTRC = RTNREG;                                    1134
         LR    TESTRC,RTNREG                                       1134
*              RESPECIFY RTNREG UNRSTD;                            1135
*                                                                  1135
*              IF TESTRC ^= 0                                      1136
*                THEN                                              1136
         LTR   TESTRC,TESTRC                                       1136
         BZ    @RF01136                                            1136
*                  DO;                                             1137
*                                                                  1137
*                  CNSAVERC = LASTCC08;                            1138
         L     @15,@PC00012+16                                     1138
         MVC   CNSAVERC(2,@15),@CH00180                            1138
*                  RETURN;                                         1139
*                                                                  1139
         B     @EL00012                                            1139
*                  END;                                            1140
*                                                                  1140
*            END;                                                  1141
*                                                                  1141
@RF01136 AL    NM,@CF00220                                         1141
@DE01131 C     NM,SRTRSACT                                         1141
         BNH   @DL01131                                            1141
*            END CNTLINT;                                          1142
*                                                                  1142
*        /************************************************************/
*        /*                                                          */
*        /* CALL BLDPROC ONE MORE TIME TO WRITE OUT THE LAST         */
*        /* ALTERNATE INDEX RECORD                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1143
*        CALL BLDPROC (NULLPTR,CNTLAMDS,CNTLIOCS,                  1143
*                      CNTLSRTB,CNTLSTAT);                         1143
*                                                                  1143
@RC01107 LA    @15,@CF00116                                        1143
         ST    @15,@AL00001                                        1143
         L     @15,@PC00012                                        1143
         ST    @15,@AL00001+4                                      1143
         L     @15,@PC00012+4                                      1143
         ST    @15,@AL00001+8                                      1143
         L     @15,@PC00012+12                                     1143
         ST    @15,@AL00001+12                                     1143
         L     @15,@PC00012+16                                     1143
         ST    @15,@AL00001+16                                     1143
         LA    @01,@AL00001                                        1143
         BAL   @14,BLDPROC                                         1143
*        RESPECIFY RTNREG RSTD;                                    1144
*        TESTRC = RTNREG;                                          1145
         LR    TESTRC,RTNREG                                       1145
*        RESPECIFY RTNREG UNRSTD;                                  1146
*                                                                  1146
*        IF TESTRC ^= 0                                            1147
*          THEN                                                    1147
         LTR   TESTRC,TESTRC                                       1147
         BZ    @RF01147                                            1147
*            DO;                                                   1148
*                                                                  1148
*            CNSAVERC = LASTCC08;                                  1149
         L     @15,@PC00012+16                                     1149
         MVC   CNSAVERC(2,@15),@CH00180                            1149
*            RETURN;                                               1150
*                                                                  1150
         B     @EL00012                                            1150
*            END;                                                  1151
*                                                                  1151
*        /************************************************************/
*        /*                                                          */
*        /* BUILDING OF THE ALTERNATE INDEX IS COMPLETE.  RETURN TO  */
*        /* THE CALLING PROCEDURE (MAINPROC).                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1152
*        RETURN;                                                   1152
*                                                                  1152
         B     @EL00012                                            1152
*END CNTLPROC;                                                     1153
         B     @EL00012                                            1153
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - SORTPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE SORT    */
*        /*            RECORDS FROM THE BASE CLUSTER RECORD,         */
*        /*            PLACING EACH RECORD IN THE RECORD SORT AREA   */
*        /*            (RSA) AND UPDATING THE TABLE OF POINTERS      */
*        /*            (CALLED THE 'HEAP') TO THE RECORDS IN THE     */
*        /*            RSA.  THE HEAP IS SORTED WHEN THE RSA         */
*        /*            HAS REACHED CAPACITY AND/OR WHEN THE LAST     */
*        /*            BASE CLUSTER RECORD HAS BEEN PROCESSED.       */
*        /*                                                          */
*        /*            THE HEAP SORT CONSISTS OF TWO PHASES. THE     */
*        /*            FIRST PHASE BUILDS THE HEAP INTO A TREE OF    */
*        /*            NODES HAVING A PARENT-CHILD RELATIONSHIP.     */
*        /*            EACH PARENT NODE HAS TWO CHILD NODES AND THE  */
*        /*            PARENT REPRESENTS A KEY HIGHER THAN EITHER    */
*        /*            OF THE TWO CHILDREN. AT THE END OF THE FIRST  */
*        /*            PHASE THE NODE AT THE TOP OF THE TREE REPRE-  */
*        /*            SENTS THE HIGHEST KEY.  THE SECOND PHASE      */
*        /*            REMOVES THE TOP NODE, PLACES IT AT THE        */
*        /*            BOTTOM, REDUCES THE HEAP BY 1 AND ADJUSTS     */
*        /*            THE PARENT-CHILD RELATIONSHIPS OF THE         */
*        /*            REMAINING NODES.  THIS LOOP CONTINUES UNTIL   */
*        /*            THE TOP OF THE HEAP REPRESENTS THE LOWEST     */
*        /*            KEY.                                          */
*        /*                                                          */
*        /*            AFTER THE HEAP IS SORTED, IF THE SORT WAS     */
*        /*            CAUSED BY THE RSA REACHING CAPACITY,          */
*        /*            SORTPROC CALLS SPILPROC TO WRITE OUT THE      */
*        /*            RECORDS IN THE RSA IN A STRING OF 2K BLOCKS   */
*        /*            TO THE EXTERNAL SORT WORK FILE.               */
*        /*                                                          */
*        /*            CNTLPROC CALLS SORTPROC UNDER THE FOLLOWING   */
*        /*            CONDITIONS                                    */
*        /*                                                          */
*        /*              . AFTER EACH BASE CLUSTER RECORD HAS BEEN   */
*        /*                READ. THE ADDRESS OF THE RECORD IS        */
*        /*                CONTAINED IN THE IOCSTR                   */
*        /*                                                          */
*        /*              . AT END OF FILE ON THE BASE CLUSTER        */
*        /*                                                          */
*        /*            EACH SORT RECORD IS FORMED BY CONCATENATING   */
*        /*            THE PRIME KEY OF THE BASE CLUSTER (KSDS) OR   */
*        /*            ITS RBA (ESDS) TO THE ALTERNATE KEY.  IF      */
*        /*            THE BASE CLUSTER RECORD IS NOT LONG ENOUGH    */
*        /*            TO CONTAIN THE ALTERNATE KEY, SORTPROC        */
*        /*            ISSUES A WARNING MESSAGE AND SETS THE         */
*        /*            CURRENT CONDITION CODE TO 4.                  */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        SORTAMDS - POINTERS TO BASE CLUSTER AND AMDSB     */
*        /*                   CONTROL BLOCKS                         */
*        /*                                                          */
*        /*        SORTIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */
*        /*                   SET                                    */
*        /*                                                          */
*        /*        SORTIOIN - POINTERS TO THE DATA OBTAINED FROM THE */
*        /*                   SORT WORK JOB CONTROL                  */
*        /*                                                          */
*        /*        SORTSRTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /*        SORTCLID - CALL ID-'N'=NOT LAST, 'L'=LAST         */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*        SORTSTAT - STATUS COMMUNICATION AREA              */
*        /*        SORT RECORD PLACED IN RSA AND HEAP UPDATED        */
*        /*                                                          */
*        /* EXIT,NORMAL - RETURN CODE O, SOSAVERC = 0 - ALL FUNCTIONS*/
*        /*                              COMPLETED SUCCESSFULLY      */
*        /*                                                          */
*        /*                              SOSAVERC = 4 - AIX KEY WAS  */
*        /*                              NOT CONTAINED IN BASE       */
*        /*                              CLUSTER RECORD              */
*        /*                                                          */
*        /* EXIT,ERROR  - RETURN CODE 8, SPILPROC WAS CALLED AN      */
*        /*                              ENCOUNTERED A TERMINATING   */
*        /*                              ERROR                       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1154
*SORTPROC:                                                         1154
*        PROCEDURE (SORTAMDS,          /* POINTERS TO AMDSBS         */
*                   SORTIOCS,          /* POINTERS TO IOCSTRS        */
*                   SORTIOIN,          /* POINTERS TO SORT WORK DATA */
*                   SORTSRTB,          /* SORT CONTROL TABLE         */
*                   SORTSTAT,          /* STATUS COMMUNICATION AREA  */
*                   SORTCLID);         /* CALL IDENTIFIER            */
*                                                                  1154
SORTPROC STM   @14,@12,@SA00013                                    1154
         MVC   @PC00013(24),0(@01)                                 1154
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1155
*        DCL 1 SORTAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */
*              2 SORAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */
*              2 SORAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */
*                                                                  1155
*        DCL 1 SORTIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */
*              2 SOIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */
*              2 SOIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */
*              2 SOIOCSSR(2) PTR(31);  /* POINTER TO SORT IOCSTRS    */
*                                                                  1156
*        DCL 1 SORTIOIN BDY(WORD),     /* POINTERS TO SORTWORK       */
*              2 SOIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */
*                                                                  1157
*        DCL SORTSRTB;                 /* SORT CONTROL TABLE         */
*                                                                  1158
*        DCL 1 SORTSTAT,               /* STATUS COMMUNICATION AREA  */
*              2 SOSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 SOSTID   CHAR(4);     /* ERROR IDENTIFIER           */
*                                                                  1159
*        DCL SORTCLID CHAR(1);         /* IF 'L', THIS IS THE LAST   */
*                                      /* CALL TO SORTPROC           */
*                                                                  1161
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLES USED BY THE SORTING PROCESS                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1161
*        DCL                                                       1161
*          SORTL FIXED(31),            /* CONTROLS FIRST PHASE       */
*          SORTR FIXED(31),            /* CONTROLS SECOND PHASE      */
*          SORTI FIXED(31),            /* PARENT                     */
*          SORTJ FIXED(31),            /* CHILD                      */
*          SORTK PTR(31);              /* WORKING KEY                */
*                                                                  1161
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLE USED TO MOVE THE RBA TO THE SORT RECORD         */
*        /*                                                          */
*        /************************************************************/
*                                                                  1162
*        DCL CHARRBA CHAR(4) DEFINED(IOCRBA);                      1162
*        /************************************************************/
*        /*                                                          */
*        /* ON ENTRY, DETERMINE IF THE RSA HAS REACHED CAPACITY OR   */
*        /* IF THIS IS THE LAST CALL.  IF SO, SEQUENCE  THE HEAP.    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1163
*        IF SRTRSACT = SRTRSACP                                   1163
*           SORTCLID = 'L'                                         1163
*          THEN                                                    1163
         CLC   SRTRSACT(4),SRTRSACP                                1163
         BE    @RT01163                                            1163
         L     @15,@PC00013+20                                     1163
         CLI   SORTCLID(@15),C'L'                                  1163
         BNE   @RF01163                                            1163
@RT01163 DS    0H                                                  1164
*SORTLOOP:   DO;                                                   1164
*                                                                  1164
SORTLOOP DS    0H                                                  1165
*            IF GDTDBG = NULLPTR                                   1165
*              THEN;                                               1165
         L     @15,@PC00001                                        1165
         L     @15,GDTDBG(,@15)                                    1165
         LTR   @15,@15                                             1165
         BZ    @RT01165                                            1165
*              ELSE                                                1167
*                CALL IDCDB010 (GDTTBL,'BISR');                    1167
*                                                                  1167
         L     @15,@PC00001                                        1167
         ST    @15,@AL00001                                        1167
         LA    @14,@CC01447                                        1167
         ST    @14,@AL00001+4                                      1167
         MVI   @AL00001+4,X'80'                                    1167
         L     @15,GDTDBG(,@15)                                    1167
         LA    @01,@AL00001                                        1167
         BALR  @14,@15                                             1167
*            /********************************************************/
*            /*                                                      */
*            /* INITIALIZE THE VALUES OF L AND R.  WHILE L IS        */
*            /* GREATER THAN 1, WE ARE BUILDING THE HEAP.  REMOVE    */
*            /* A WORKING KEY LEAVING A SLOT IN THE HEAP.            */
*            /*                                                      */
*            /********************************************************/
*                                                                  1168
*            SORTL = SRTRSACT / 2 + 1;                             1168
@RT01165 L     @02,SRTRSACT                                        1168
         LR    @00,@02                                             1168
         SRDA  @00,32                                              1168
         D     @00,@CF00154                                        1168
         AL    @01,@CF00220                                        1168
         LR    SORTL,@01                                           1168
*            SORTR = SRTRSACT;                                     1169
*                                                                  1169
         LR    SORTR,@02                                           1169
*SORTOUTR:   DO WHILE SORTR > 1;                                   1170
*                                                                  1170
SORTOUTR B     @DE01170                                            1170
@DL01170 DS    0H                                                  1171
*              IF SORTL > 1                                        1171
*                THEN                                              1171
         C     SORTL,@CF00220                                      1171
         BNH   @RF01171                                            1171
*                  DO;                                             1172
*                                                                  1172
*                  SORTL = SORTL - 1;                              1173
         BCTR  SORTL,0                                             1173
*                  SORTK = SHEAPTR(SORTL);                         1174
*                                                                  1174
         LR    @04,SORTL                                           1174
         SLA   @04,2                                               1174
         L     @02,SRTHEAPT                                        1174
         AL    @02,@CF01678                                        1174
         L     @04,SHEAPTR(@04,@02)                                1174
         ST    @04,SORTK                                           1174
*                  END;                                            1175
*                                                                  1175
*                /****************************************************/
*                /*                                                  */
*                /* WHEN THE VALUE OF L REACHES 1, THE HEAP IS       */
*                /* BUILT.  NOW SORT IT.  THE KEY AT THE BOTTOM OF   */
*                /* THE HEAP BECOMES THE WORKING KEY, THE KEY AT     */
*                /* THE TOP (THE HIGHEST IN VALUE) GOES TO THE       */
*                /* BOTTOM AND THE SIZE OF THE HEAP IS REDUCED BY    */
*                /* ONE.  THE EMPTY SLOT IS AT THE TOP OF THE HEAP.  */
*                /* WHEN R REACHES 1, WE ARE DONE                    */
*                /*                                                  */
*                /****************************************************/
*                                                                  1176
*                ELSE                                              1176
*                  DO;                                             1176
*                                                                  1176
         B     @RC01171                                            1176
@RF01171 DS    0H                                                  1177
*                  SORTK = SHEAPTR(SORTR);                         1177
         L     @04,SRTHEAPT                                        1177
         LR    @02,SORTR                                           1177
         SLA   @02,2                                               1177
         LA    @01,0(@02,@04)                                      1177
         AL    @01,@CF01678                                        1177
         L     @15,SHEAPTR(,@01)                                   1177
         ST    @15,SORTK                                           1177
*                  SHEAPTR(SORTR) = SHEAPTR(1);                    1178
*                                                                  1178
         L     @15,SHEAPTR(,@04)                                   1178
         AL    @04,@CF01678                                        1178
         ST    @15,SHEAPTR(@02,@04)                                1178
*                  SORTR = SORTR - 1;                              1179
*                                                                  1179
         BCTR  SORTR,0                                             1179
*                  END;                                            1180
*                                                                  1180
*              IF SORTR > 1                                        1181
*                THEN                                              1181
@RC01171 C     SORTR,@CF00220                                      1181
         BNH   @RF01181                                            1181
*RNOTONE:          DO;                                             1182
*                                                                  1182
RNOTONE  DS    0H                                                  1183
*                  /**************************************************/
*                  /*                                                */
*                  /* ESTABLISH A PARENT-CHILD RELATIONSHIP AT THE   */
*                  /* POINT OF THE EMPTY SLOT.  DETERMINE WHICH OF   */
*                  /* THE TWO CHILDREN IS GREATER.  IF THE WORKING   */
*                  /* KEY IS SMALLER THAN THE CHOSEN CHILD, MOVE     */
*                  /* THE CHILD UP TO THE EMPTY SLOT, THUS MOVING    */
*                  /* THE EMPTY SLOT DOWN TO THE CHILD'S FORMER      */
*                  /* SLOT.  ESTABLISH A NEW PARENT-CHILD AT THE     */
*                  /* NEW EMPTY SLOT.  IF THE WORKING KEY IS EQUAL   */
*                  /* TO OR LARGER THAN THE CHOSEN CHILD, THE INNER  */
*                  /* LOOP IS COMPLETE.  SET J GREATER THAN R TO     */
*                  /* FORCE EXIT.  THE INNER LOOP IS CODED           */
*                  /* SEPARATELY FOR THE SITUATION IN WHICH THE      */
*                  /* SORT RECORD IS GREATER THAN 256 BYTES IN       */
*                  /* ORDER TO REDUCE COMPARES FOR THE NORMAL CASE.  */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1183
*                  SORTI = SORTL;                                  1183
         LR    SORTI,SORTL                                         1183
*                  SORTJ = SORTI * 2;                              1184
*                                                                  1184
         LR    SORTJ,SORTI                                         1184
         ALR   SORTJ,SORTJ                                         1184
*                  IF SRTRECSZ <= MVCMLIM                          1185
*                    THEN                                          1185
         LH    @15,SRTRECSZ                                        1185
         C     @15,@CF00925                                        1185
         BH    @RF01185                                            1185
*SORTINNM:             DO WHILE SORTJ <= SORTR;                    1186
*                                                                  1186
SORTINNM B     @DE01186                                            1186
@DL01186 DS    0H                                                  1187
*                      IF SORTJ < SORTR                            1187
*                        THEN                                      1187
*                                                                  1187
*                                                                  1187
         CR    SORTJ,SORTR                                         1187
         BNL   @RF01187                                            1187
*                          IF SHEAPTR(SORTJ) -> RSAREC(1:SRTRECSZ) <
*                             SHEAPTR(SORTJ + 1) -> RSAREC(1:SRTRECSZ)
*                            THEN                                  1188
         L     @15,SRTHEAPT                                        1188
         LR    @14,SORTJ                                           1188
         SLA   @14,2                                               1188
         LA    @01,0(@14,@15)                                      1188
         AL    @01,@CF01678                                        1188
         L     @01,SHEAPTR(,@01)                                   1188
         L     @15,SHEAPTR(@14,@15)                                1188
         LH    @14,SRTRECSZ                                        1188
         BCTR  @14,0                                               1188
         EX    @14,@SC01690                                        1188
         BNL   @RF01188                                            1188
*                              SORTJ = SORTJ + 1;                  1189
*                                                                  1189
         AL    SORTJ,@CF00220                                      1189
*                            ELSE;                                 1190
*                                                                  1190
@RF01188 DS    0H                                                  1191
*                        ELSE;                                     1191
*                                                                  1191
@RF01187 DS    0H                                                  1192
*                      IF SORTK -> RSAREC(1:SRTRECSZ) <            1192
*                         SHEAPTR(SORTJ) -> RSAREC(1:SRTRECSZ)     1192
*                        THEN                                      1192
         L     @15,SRTHEAPT                                        1192
         LR    @14,SORTJ                                           1192
         SLA   @14,2                                               1192
         AL    @14,@CF01678                                        1192
         L     @14,SHEAPTR(@14,@15)                                1192
         LH    @07,SRTRECSZ                                        1192
         BCTR  @07,0                                               1192
         L     @01,SORTK                                           1192
         EX    @07,@SC01692                                        1192
         BNL   @RF01192                                            1192
*                          DO;                                     1193
*                                                                  1193
*                          SHEAPTR(SORTI) = SHEAPTR(SORTJ);        1194
*                                                                  1194
*                                                                  1194
         LR    @07,SORTI                                           1194
         SLA   @07,2                                               1194
         AL    @15,@CF01678                                        1194
         ST    @14,SHEAPTR(@07,@15)                                1194
*                          SORTI = SORTJ;                          1195
         LR    SORTI,SORTJ                                         1195
*                          SORTJ = SORTJ * 2;                      1196
*                                                                  1196
         ALR   SORTJ,SORTJ                                         1196
*                          END;                                    1197
*                                                                  1197
*                        ELSE                                      1198
*                          SORTJ = SORTR + 1;                      1198
*                                                                  1198
         B     @RC01192                                            1198
@RF01192 LA    SORTJ,1                                             1198
         ALR   SORTJ,SORTR                                         1198
*                      END SORTINNM;                               1199
*                                                                  1199
@RC01192 DS    0H                                                  1199
@DE01186 CR    SORTJ,SORTR                                         1199
         BNH   @DL01186                                            1199
*                    ELSE                                          1200
*SORTINLG:             DO WHILE SORTJ <= SORTR;                    1200
*                                                                  1200
         B     @RC01185                                            1200
@RF01185 DS    0H                                                  1200
SORTINLG B     @DE01200                                            1200
@DL01200 DS    0H                                                  1201
*                      IF SORTJ < SORTR                            1201
*                        THEN                                      1201
         CR    SORTJ,SORTR                                         1201
         BNL   @RF01201                                            1201
*                          IF SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) <
*                             SHEAPTR(SORTJ + 1) -> RSAREC(1:MVCMLIM)
*                            THEN                                  1202
         L     @15,SRTHEAPT                                        1202
         LR    @14,SORTJ                                           1202
         SLA   @14,2                                               1202
         LA    @01,0(@14,@15)                                      1202
         AL    @01,@CF01678                                        1202
         L     @01,SHEAPTR(,@01)                                   1202
         L     @15,SHEAPTR(@14,@15)                                1202
         CLC   RSAREC(256,@01),RSAREC(@15)                         1202
         BNL   @RF01202                                            1202
*                              SORTJ = SORTJ + 1;                  1203
*                                                                  1203
         AL    SORTJ,@CF00220                                      1203
*                            ELSE                                  1204
*                              IF SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) =
*                                 SHEAPTR(SORTJ + 1) ->            1204
*                                                   RSAREC(1:MVCMLIM)
*                                THEN                              1204
         B     @RC01202                                            1204
@RF01202 L     @15,SRTHEAPT                                        1204
         LR    @14,SORTJ                                           1204
         SLA   @14,2                                               1204
         LA    @01,0(@14,@15)                                      1204
         AL    @01,@CF01678                                        1204
         L     @07,SHEAPTR(,@01)                                   1204
         L     @06,SHEAPTR(@14,@15)                                1204
         CLC   RSAREC(256,@07),RSAREC(@06)                         1204
         BNE   @RF01204                                            1204
*                                  IF SHEAPTR(SORTJ) ->            1205
*                                       RSAREC(MVCMLIM + 1:SRTRECSZ) <
*                                     SHEAPTR(SORTJ + 1) ->        1205
*                                       RSAREC(MVCMLIM + 1:SRTRECSZ)
*                                    THEN                          1205
         LH    @15,SRTRECSZ                                        1205
         SL    @15,@CF01651                                        1205
         EX    @15,@SC01694                                        1205
         BNL   @RF01205                                            1205
*                                      SORTJ = SORTJ + 1;          1206
*                                                                  1206
         AL    SORTJ,@CF00220                                      1206
*                                    ELSE;                         1207
@RF01205 DS    0H                                                  1208
*                                ELSE;                             1208
@RF01204 DS    0H                                                  1209
*                        ELSE;                                     1209
*                                                                  1209
@RF01201 DS    0H                                                  1210
*                      IF (SORTK -> RSAREC(1:MVCMLIM) <            1210
*                          SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM))   1210
*                                                                  1210
*                         (SORTK -> RSAREC(1:MVCMLIM) =            1210
*                          SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) &   1210
*                          SORTK -> RSAREC(MVCMLIM + 1:SRTRECSZ) < 1210
*                          SHEAPTR(SORTJ) ->                       1210
*                                   RSAREC(MVCMLIM + 1:SRTRECSZ))  1210
*                                                                  1210
*                        THEN                                      1210
@RC01201 L     @15,SORTK                                           1210
         LR    @14,SORTJ                                           1210
         SLA   @14,2                                               1210
         L     @01,SRTHEAPT                                        1210
         AL    @01,@CF01678                                        1210
         L     @14,SHEAPTR(@14,@01)                                1210
         CLC   RSAREC(256,@15),RSAREC(@14)                         1210
         BL    @RT01210                                            1210
         CLC   RSAREC(256,@15),RSAREC(@14)                         1210
         BNE   @RF01210                                            1210
         LH    @07,SRTRECSZ                                        1210
         SL    @07,@CF01651                                        1210
         EX    @07,@SC01696                                        1210
         BNL   @RF01210                                            1210
@RT01210 DS    0H                                                  1211
*                          DO;                                     1211
*                                                                  1211
*                          SHEAPTR(SORTI) = SHEAPTR(SORTJ);        1212
*                                                                  1212
         L     @15,SRTHEAPT                                        1212
         LR    @14,SORTI                                           1212
         SLA   @14,2                                               1212
         LR    @07,SORTJ                                           1212
         SLA   @07,2                                               1212
         AL    @07,@CF01678                                        1212
         L     @07,SHEAPTR(@07,@15)                                1212
         AL    @15,@CF01678                                        1212
         ST    @07,SHEAPTR(@14,@15)                                1212
*                          SORTI = SORTJ;                          1213
         LR    SORTI,SORTJ                                         1213
*                          SORTJ = SORTJ * 2;                      1214
*                                                                  1214
         ALR   SORTJ,SORTJ                                         1214
*                          END;                                    1215
*                                                                  1215
*                        ELSE                                      1216
*                          SORTJ = SORTR + 1;                      1216
*                                                                  1216
         B     @RC01210                                            1216
@RF01210 LA    SORTJ,1                                             1216
         ALR   SORTJ,SORTR                                         1216
*                      END SORTINLG;                               1217
*                                                                  1217
@RC01210 DS    0H                                                  1217
@DE01200 CR    SORTJ,SORTR                                         1217
         BNH   @DL01200                                            1217
*                  /**************************************************/
*                  /*                                                */
*                  /* MOVE THE WORKING KEY TO THE FINAL SLOT         */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1218
*                  SHEAPTR(SORTI) = SORTK;                         1218
*                                                                  1218
@RC01185 LR    @02,SORTI                                           1218
         SLA   @02,2                                               1218
         L     @15,SORTK                                           1218
         L     @14,SRTHEAPT                                        1218
         AL    @14,@CF01678                                        1218
         ST    @15,SHEAPTR(@02,@14)                                1218
*                  END RNOTONE;                                    1219
*                                                                  1219
*            END SORTOUTR;                                         1220
*                                                                  1220
@RF01181 DS    0H                                                  1220
@DE01170 LA    @04,1                                               1220
         CR    SORTR,@04                                           1220
         BH    @DL01170                                            1220
*            /********************************************************/
*            /*                                                      */
*            /* MOVE THE FINAL WORKING KEY TO THE TOP OF THE HEAP.   */
*            /*                                                      */
*            /********************************************************/
*                                                                  1221
*            IF SRTRSACT > 1                                       1221
*              THEN                                                1221
         C     @04,SRTRSACT                                        1221
         BNL   @RF01221                                            1221
*               SHEAPTR(1) = SORTK;                                1222
*                                                                  1222
         L     @15,SORTK                                           1222
         L     @14,SRTHEAPT                                        1222
         ST    @15,SHEAPTR(,@14)                                   1222
*            END SORTLOOP;                                         1223
*                                                                  1223
@RF01221 DS    0H                                                  1224
*        /************************************************************/
*        /*                                                          */
*        /* AFTER THE HEAP HAS BEEN SORTED, DETERMINE IF EITHER      */
*        /* OF THE FOLLOWING CONDITIONS EXIST -                      */
*        /*                                                          */
*        /*   . THE RSA HAS REACHED CAPACITY BEFORE THE END OF FILE  */
*        /*     ON THE BASE CLUSTER                                  */
*        /*                                                          */
*        /*   . THE RSA HAS NOT REACHED CAPACITY BUT AN EXTERNAL     */
*        /*     SORT HAS BEEN INITIATED BY ITS REACHING CAPACITY     */
*        /*     PREVIOUSLY AND END OF FILE HAS BEEN REACHED          */
*        /*                                                          */
*        /* IF EITHER OF THESE CONDITIONS EXIST, CALL SPILPROC       */
*        /* TO WRITE OUT THE RSA RECORDS IN A STRING TO THE SORT     */
*        /* WORK FILE.  IF SPILPROC ENCOUNTERS AN ERROR, RETURN TO   */
*        /* THE CALLING PROCEDURE (CNTLPROC) WITH A CODE 8.          */
*        /*                                                          */
*        /************************************************************/
*                                                                  1224
*        IF (SRTRSACT = SRTRSACP & SORTCLID ^= 'L')               1224
*           (SORTCLID = 'L' & SRTFLEXT = ON)                       1224
*          THEN                                                    1224
@RF01163 CLC   SRTRSACT(4),SRTRSACP                                1224
         BNE   @GL00018                                            1224
         L     @15,@PC00013+20                                     1224
         CLI   SORTCLID(@15),C'L'                                  1224
         BNE   @RT01224                                            1224
@GL00018 L     @15,@PC00013+20                                     1224
         CLI   SORTCLID(@15),C'L'                                  1224
         BNE   @RF01224                                            1224
         TM    SRTFLEXT,B'01000000'                                1224
         BNO   @RF01224                                            1224
@RT01224 DS    0H                                                  1225
*            DO;                                                   1225
*                                                                  1225
*            CALL SPILPROC (SORTIOCS,SORTIOIN,SORTSRTB,SORTSTAT);  1226
*                                                                  1226
         L     @15,@PC00013+4                                      1226
         ST    @15,@AL00001                                        1226
         L     @15,@PC00013+8                                      1226
         ST    @15,@AL00001+4                                      1226
         L     @15,@PC00013+12                                     1226
         ST    @15,@AL00001+8                                      1226
         L     @15,@PC00013+16                                     1226
         ST    @15,@AL00001+12                                     1226
         LA    @01,@AL00001                                        1226
         BAL   @14,SPILPROC                                        1226
*            RESPECIFY RTNREG RSTD;                                1227
*            TESTRC = RTNREG;                                      1228
         LR    TESTRC,RTNREG                                       1228
*            RESPECIFY RTNREG UNRSTD;                              1229
*                                                                  1229
*            IF TESTRC ^= 0                                        1230
*              THEN                                                1230
         LTR   TESTRC,TESTRC                                       1230
         BZ    @RF01230                                            1230
*                RETURN CODE(LASTCC08);                            1231
*                                                                  1231
         LA    @15,8                                               1231
         L     @14,@SA00013                                        1231
         LM    @00,@12,@SA00013+8                                  1231
         BR    @14                                                 1231
*            END;                                                  1232
*                                                                  1232
@RF01230 DS    0H                                                  1233
*        /************************************************************/
*        /*                                                          */
*        /* IF A BASE CLUSTER RECORD HAS BEEN PASSED AS A PARA-      */
*        /* METER TO SORTPROC (I.E., THIS IS NOT THE LAST CALL),     */
*        /* PREPARE TO FORM THE SORT RECORD.  KEEP A COUNT OF THE    */
*        /* NUMBER OF RECORDS IN THE BASE CLUSTER.  IF THIS IS THE   */
*        /* FIRST BASE CLUSTER RECORD AND THE BASE CLUSTER IS A      */
*        /* KSDS, SAVE ITS KEY.  THIS KEY WILL BE USED TO            */
*        /* RE-POSITION AT THE START OF THE BASE CLUSTER IF          */
*        /* MULTIPLE ALTERNATE INDEXES ARE BEING BUILT.              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1233
*        IF SORTCLID ^= 'L'                                        1233
*          THEN                                                    1233
@RF01224 L     @15,@PC00013+20                                     1233
         CLI   SORTCLID(@15),C'L'                                  1233
         BE    @RF01233                                            1233
*NEWREC:     DO;                                                   1234
*                                                                  1234
NEWREC   DS    0H                                                  1235
*            AMDSBPTR = SORAMBAS;                                  1235
         L     @03,@PC00013                                        1235
         L     AMDSBPTR,SORAMBAS(,@03)                             1235
*            IOCSPTR  = SOIOCSBS;                                  1236
         L     @05,@PC00013+4                                      1236
         L     IOCSPTR,SOIOCSBS(,@05)                              1236
*            SRTBSCNT = SRTBSCNT + 1;                              1237
*                                                                  1237
         LA    @05,1                                               1237
         L     @03,SRTBSCNT                                        1237
         ALR   @03,@05                                             1237
         ST    @03,SRTBSCNT                                        1237
*            IF SRTBSCNT = 1                                       1238
*              THEN                                                1238
         CR    @03,@05                                             1238
         BNE   @RF01238                                            1238
*                IF AMDDST = ON                                    1239
*                  THEN                                            1239
         TM    AMDDST(AMDSBPTR),B'10000000'                        1239
         BNO   @RF01239                                            1239
*                    DO;                                           1240
*                                                                  1240
*                    SAVEKEY = ''B;                                1241
         XC    SAVEKEY(256),SAVEKEY                                1241
*                    SAVEKEY(1:AMDKEYLN) =                         1242
*                      BASEREC(AMDRKP + 1:AMDRKP + AMDKEYLN);      1242
*                                                                  1242
         LH    @05,AMDKEYLN(,AMDSBPTR)                             1242
         BCTR  @05,0                                               1242
         LH    @03,AMDRKP(,AMDSBPTR)                               1242
         L     @01,IOCDAD(,IOCSPTR)                                1242
         ALR   @01,@03                                             1242
         EX    @05,@SM01698                                        1242
*                    END;                                          1243
*                                                                  1243
*            /********************************************************/
*            /*                                                      */
*            /* IF THE BASE CLUSTER RECORD IS NOT LONG ENOUGH TO     */
*            /* CONTAIN THE FULL ALTERNATE KEY, ISSUE A WARNING      */
*            /* MESSAGE CONTAINING THE FIRST 10 BYTES OF THE PRIME   */
*            /* KEY OR THE RBA.                                      */
*            /*                                                      */
*            /********************************************************/
*                                                                  1244
*            AMDSBPTR = SORAMAIX;                                  1244
*                                                                  1244
@RF01239 DS    0H                                                  1244
@RF01238 L     @03,@PC00013                                        1244
         L     AMDSBPTR,SORAMAIX(,@03)                             1244
*            IF AMDAXRKP + AMDKEYLN > IOCDLN                       1245
*              THEN                                                1245
         LH    @05,AMDAXRKP(,AMDSBPTR)                             1245
         AH    @05,AMDKEYLN(,AMDSBPTR)                             1245
         C     @05,IOCDLN(,IOCSPTR)                                1245
         BNH   @RF01245                                            1245
*                DO;                                               1246
*                                                                  1246
*                SOSAVERC = LASTCC04;                              1247
*                                                                  1247
         L     @15,@PC00013+16                                     1247
         MVC   SOSAVERC(2,@15),@CH00043                            1247
*                DARGLIST = ''B;                                   1248
*                                                                  1248
         L     @15,DDSTRU                                          1248
         XC    DARGLIST(20,@15),DARGLIST(@15)                      1248
*                IF SORAMBAS -> AMDDST = ON                        1249
*                  THEN                                            1249
         L     @03,SORAMBAS(,@03)                                  1249
         TM    AMDDST(@03),B'10000000'                             1249
         BNO   @RF01249                                            1249
*                    DO;                                           1250
*                                                                  1250
*                    DARGSTID = NOAXKYKS;                          1251
         MVC   DARGSTID(4,@15),@CF00892                            1251
*                    DARGDBP  = IOCKYA;                            1252
*                                                                  1252
         L     @03,IOCKYA(,IOCSPTR)                                1252
         ST    @03,DARGDBP(,@15)                                   1252
*                    IF IOCKYL > 10                                1253
*                      THEN                                        1253
         CLI   IOCKYL(IOCSPTR),10                                  1253
         BNH   @RF01253                                            1253
*                        DARGILP = 10;                             1254
         MVC   DARGILP(2,@15),@CH00037                             1254
*                      ELSE                                        1255
*                        DARGILP = IOCKYL;                         1255
*                                                                  1255
         B     @RC01253                                            1255
@RF01253 SLR   @03,@03                                             1255
         IC    @03,IOCKYL(,IOCSPTR)                                1255
         L     @01,DDSTRU                                          1255
         STH   @03,DARGILP(,@01)                                   1255
*                    END;                                          1256
*                                                                  1256
*                  ELSE                                            1257
*                    DO;                                           1257
*                                                                  1257
         B     @RC01249                                            1257
@RF01249 DS    0H                                                  1258
*                    DARGSTID = NOAXKYES;                          1258
         L     @03,DDSTRU                                          1258
         MVC   DARGSTID(4,@03),@CF00916                            1258
*                    DARGDBP = ADDR(IOCRBA);                       1259
         LA    @15,IOCRBA(,IOCSPTR)                                1259
         ST    @15,DARGDBP(,@03)                                   1259
*                    DARGILP = LENGTH(IOCRBA);                     1260
*                                                                  1260
         MVC   DARGILP(2,@03),@CH00043                             1260
*                    END;                                          1261
*                                                                  1261
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            1262
*                                                                  1262
@RC01249 L     @15,@PC00001                                        1262
         ST    @15,@AL00001                                        1262
         LA    @14,@CF00116                                        1262
         ST    @14,@AL00001+4                                      1262
         LA    @14,DDSTRU                                          1262
         ST    @14,@AL00001+8                                      1262
         MVI   @AL00001+8,X'80'                                    1262
         L     @15,GDTPRT(,@15)                                    1262
         LA    @01,@AL00001                                        1262
         BALR  @14,@15                                             1262
*                END;                                              1263
*                                                                  1263
*              ELSE                                                1264
*                DO;                                               1264
*                                                                  1264
         B     @RC01245                                            1264
@RF01245 DS    0H                                                  1265
*                /****************************************************/
*                /*                                                  */
*                /* THE BASE CLUSTER RECORD CONTAINS THE ALTERNATE   */
*                /* KEY.  MOVE IT TO THE NEXT RECORD AREA IN THE     */
*                /* RSA AND FOLLOW IT WITH THE PRIME KEY OR RBA.     */
*                /* UPDATE THE COUNT OF RECORDS IN THE RSA.          */
*                /*                                                  */
*                /****************************************************/
*                                                                  1265
*                RSAREC(1:AMDKEYLN) =                              1265
*                  BASEREC(AMDAXRKP + 1:AMDAXRKP + AMDKEYLN);      1265
*                                                                  1265
         L     @05,SRTCURSA                                        1265
         LH    @03,AMDKEYLN(,AMDSBPTR)                             1265
         LR    @15,@03                                             1265
         BCTR  @15,0                                               1265
         LH    @01,AMDAXRKP(,AMDSBPTR)                             1265
         L     @14,IOCDAD(,IOCSPTR)                                1265
         ALR   @01,@14                                             1265
         EX    @15,@SM01700                                        1265
*                IF SORAMBAS -> AMDDST = ON                        1266
*                  THEN                                            1266
         L     @15,@PC00013                                        1266
         L     @15,SORAMBAS(,@15)                                  1266
         TM    AMDDST(@15),B'10000000'                             1266
         BNO   @RF01266                                            1266
*                    RSAREC(AMDKEYLN + 1:SRTRECSZ) =               1267
*                      BASEREC(SORAMBAS -> AMDRKP + 1:             1267
*                              SORAMBAS -> AMDRKP +                1267
*                              SORAMBAS -> AMDKEYLN);              1267
*                                                                  1267
         ALR   @05,@03                                             1267
         LCR   @03,@03                                             1267
         AH    @03,SRTRECSZ                                        1267
         BCTR  @03,0                                               1267
         LH    @01,AMDRKP(,@15)                                    1267
         ALR   @14,@01                                             1267
         EX    @03,@SM01702                                        1267
*                  ELSE                                            1268
*                    RSAREC(AMDKEYLN + 1:SRTRECSZ) =               1268
*                      CHARRBA;                                    1268
*                                                                  1268
         B     @RC01266                                            1268
@RF01266 LH    @05,AMDKEYLN(,AMDSBPTR)                             1268
         L     @03,SRTCURSA                                        1268
         ALR   @03,@05                                             1268
         LCR   @05,@05                                             1268
         AH    @05,SRTRECSZ                                        1268
         BCTR  @05,0                                               1268
         EX    @05,@SM01704                                        1268
*                SRTRSACT = SRTRSACT + 1;                          1269
*                                                                  1269
@RC01266 LA    @15,1                                               1269
         AL    @15,SRTRSACT                                        1269
         ST    @15,SRTRSACT                                        1269
*                /****************************************************/
*                /*                                                  */
*                /* PLACE THE ADDRESS OF THE NEW RECORD INTO THE     */
*                /* HEAP.  UPDATE THE CURRENT RSA AND HEAP ADDRESSES */
*                /* TO THE NEXT AVAILABLE SLOT.                      */
*                /*                                                  */
*                /****************************************************/
*                                                                  1270
*                SHEAPTR(SRTRSACT) = SRTCURSA;                     1270
*                                                                  1270
         L     @14,SRTCURSA                                        1270
         SLA   @15,2                                               1270
         L     @01,SRTHEAPT                                        1270
         AL    @01,@CF01678                                        1270
         ST    @14,SHEAPTR(@15,@01)                                1270
*                SRTCURSA = SRTCURSA + SRTRECSZ;                   1271
*                                                                  1271
         AH    @14,SRTRECSZ                                        1271
         ST    @14,SRTCURSA                                        1271
*                END;                                              1272
*                                                                  1272
*            END NEWREC;                                           1273
*                                                                  1273
*          ELSE                                                    1274
*                                                                  1274
*            /********************************************************/
*            /*                                                      */
*            /* THIS IS THE LAST CALL TO SORTPROC.  STORE THE BASE   */
*            /* CLUSTER RECORD COUNT IN THE BASE AMDSB.  THIS COUNT  */
*            /* IS MADE BY SORTPROC IN THE EVENT THAT MULTIPLE       */
*            /* ALTERNATE INDEXES ARE BEING BUILT.  THE STATISTIC    */
*            /* WILL THEN BE CORRECT FOR THE SECOND AND SUBSEQUENT   */
*            /* BUILDS.                                              */
*            /*                                                      */
*            /*******************************************************/
*                                                                  1274
*            SORAMBAS -> AMDNLR = SRTBSCNT;                        1274
*                                                                  1274
         B     @RC01233                                            1274
@RF01233 L     @15,@PC00013                                        1274
         L     @01,SORAMBAS(,@15)                                  1274
         L     @00,SRTBSCNT                                        1274
         ST    @00,AMDNLR(,@01)                                    1274
*        /************************************************************/
*        /*                                                          */
*        /* THIS COMPLETES SORTPROC PROCESSING.  RETURN TO CALLING   */
*        /* PROCEDURE (CNTLPROC).                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1275
*        RETURN CODE(LASTCC00);                                    1275
*                                                                  1275
@RC01233 SLR   @15,@15                                             1275
         L     @14,@SA00013                                        1275
         LM    @00,@12,@SA00013+8                                  1275
         BR    @14                                                 1275
*END SORTPROC;                                                     1276
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - SPILPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF WRITING OUT THE      */
*        /*            RECORDS IN THE RECORD SORT AREA TO THE        */
*        /*            FIRST EXTERNAL SORT WORK FILE.  RECORDS       */
*        /*            ARE MOVED IN SEQUENCE, USING THE POINTERS     */
*        /*            IN THE SORTED HEAP, TO THE OUTPUT 2K BUFFER.  */
*        /*            WHEN THE BUFFER IS FILLED, A UPUT MACRO IS    */
*        /*            ISSUED TO WRITE IT TO THE OUTPUT SORT WORK    */
*        /*            FILE.  THIS PROCESS CONTINUES UNTIL ALL       */
*        /*            RECORDS HAVE BEEN WRITTEN OUT.                */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        SPILIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */
*        /*                   SET                                    */
*        /*                                                          */
*        /*        SPILIOIN - POINTERS TO THE DATA OBTAINED FROM     */
*        /*                   THE SORT WORK JOB CONTROL              */
*        /*                                                          */
*        /*        SPILSRTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*        SPILSTAT - STATUS COMMUNICATION AREA              */
*        /*                                                          */
*        /*        SORT RECORDS HAVE BEEN WRITTEN TO THE SORT        */
*        /*        WORK FILE                                         */
*        /*                                                          */
*        /* EXIT, NORMAL - ALL FUNCTIONS SUCCESSFULLY COMPLETED      */
*        /*                                                          */
*        /* EXIT, ERROR  - RETURN CODE 8,                            */
*        /*                                                          */
*        /*                  . THE SORT WORK FILE WAS NOT OPEN       */
*        /*                    ON ENTRY TO SPILPROC AND DEFPROC      */
*        /*                    WAS CALLED WHERE A TERMINATING        */
*        /*                    ERROR WAS ENCOUNTERED                 */
*        /*                                                          */
*        /*                  . AN ERROR OCCURRED IN WRITING A        */
*        /*                    RECORD TO THE OUTPUT FILE             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1277
*SPILPROC:                                                         1277
*        PROCEDURE (SPILIOCS,          /* POINTERS TO IOCSTRS        */
*                   SPILIOIN,          /* POINTERS TO SORT WORK DATA */
*                   SPILSRTB,          /* SORT CONTROL TABLE         */
*                   SPILSTAT);         /* STATUS COMMUNICATION AREA  */
*                                                                  1277
SPILPROC STM   @14,@12,@SA00014                                    1277
         MVC   @PC00014(16),0(@01)                                 1277
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1278
*        DCL 1 SPILIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */
*              2 SPIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */
*              2 SPIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */
*              2 SPIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */
*                                                                  1278
*        DCL 1 SPILIOIN BDY(WORD),     /* POINTER TO SORT WORK JOB   */
*              2 SPIOINPT(2) PTR(31);  /* CONTROL DATA               */
*                                                                  1279
*        DCL SPILSRTB;                 /* SORT CONTROL TABLE         */
*                                                                  1280
*        DCL 1 SPILSTAT,               /* STATUS COMMUNICATION AREA  */
*              2 SPSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 SPSTID   CHAR(4);     /* ERROR IDENTIFIER           */
*                                                                  1281
*        /************************************************************/
*        /*                                                          */
*        /* LOOP CONTROL VARIABLES                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1282
*        DCL                                                       1282
*          PUTCTR FIXED(31),           /* NUMBER OF RECORDS TO WRITE */
*          SP1    FIXED(31),           /* HEAP INDEX                 */
*          SP2    FIXED(31),           /* INNER LOOP CONTROL         */
*          SP2LIM FIXED(15);           /* INNER LOOP TO VALUE        */
*                                                                  1282
*        /************************************************************/
*        /*                                                          */
*        /* OVERLAY OF SORT RECORD IN THE 2K BUFFER                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1283
*        DCL SPRECPTR PTR(31);                                     1283
*                                                                  1283
*        DCL SPSRTREC CHAR(*) BASED(SPRECPTR);                     1284
*        /************************************************************/
*        /*                                                          */
*        /* IF THE SORT WORK FILES HAVE NOT PREVIOUSLY BEEN OPENED,  */
*        /* CALL DEFPROC TO DEFINE (IF NECESSARY) AND OPEN THEM      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1285
*        OLDERID2 = NEWERID2;                                      1285
         L     @15,@PC00001                                        1285
         L     @15,GDTTR2(,@15)                                    1285
         MVC   @TS00001(95),NEWERID2(@15)                          1285
         MVC   OLDERID2(95,@15),@TS00001                           1285
*        NEWID2 = 'BISP';                                          1286
*                                                                  1286
         MVC   NEWID2(4,@15),@CC01482                              1286
*        IF SPIOCSSR(1) = NULLPTR                                  1287
*          THEN                                                    1287
         L     @15,@PC00014                                        1287
         L     @14,SPIOCSSR(,@15)                                  1287
         LTR   @14,@14                                             1287
         BNZ   @RF01287                                            1287
*            DO;                                                   1288
*                                                                  1288
*            CALL DEFPROC ('C',SPILIOIN,SPILIOCS,SPILSRTB,SPILSTAT);
*                                                                  1289
         LA    @14,@CC00727                                        1289
         ST    @14,@AL00001                                        1289
         L     @14,@PC00014+4                                      1289
         ST    @14,@AL00001+4                                      1289
         ST    @15,@AL00001+8                                      1289
         L     @15,@PC00014+8                                      1289
         ST    @15,@AL00001+12                                     1289
         L     @15,@PC00014+12                                     1289
         ST    @15,@AL00001+16                                     1289
         LA    @01,@AL00001                                        1289
         BAL   @14,DEFPROC                                         1289
*            RESPECIFY RTNREG RSTD;                                1290
*            TESTRC = RTNREG;                                      1291
         LR    TESTRC,RTNREG                                       1291
*            RESPECIFY RTNREG UNRSTD;                              1292
*                                                                  1292
*            IF TESTRC ^= 0                                        1293
*              THEN                                                1293
         LTR   TESTRC,TESTRC                                       1293
         BZ    @RF01293                                            1293
*                RETURN CODE(LASTCC08);                            1294
*                                                                  1294
         LA    @15,8                                               1294
         L     @14,@SA00014                                        1294
         LM    @00,@12,@SA00014+8                                  1294
         BR    @14                                                 1294
*            END;                                                  1295
*                                                                  1295
@RF01293 DS    0H                                                  1296
*        /************************************************************/
*        /*                                                          */
*        /* INITIALIZE LOOP CONTROL FACTORS AND IOCSTR               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1296
*        SP1    = 1;                                               1296
@RF01287 LA    SP1,1                                               1296
*        PUTCTR = SRTRSACT;                                        1297
*                                                                  1297
         L     PUTCTR,SRTRSACT                                     1297
*        IF PUTCTR < SRTRECBK                                      1298
*          THEN                                                    1298
         CH    PUTCTR,SRTRECBK                                     1298
         BNL   @RF01298                                            1298
*            SP2LIM = PUTCTR;                                      1299
*                                                                  1299
         LR    SP2LIM,PUTCTR                                       1299
*          ELSE                                                    1300
*            SP2LIM = SRTRECBK;                                    1300
*                                                                  1300
         B     @RC01298                                            1300
@RF01298 LH    SP2LIM,SRTRECBK                                     1300
*        IOCSPTR = SPIOCSSR(1);                                    1301
@RC01298 L     @07,@PC00014                                        1301
         L     IOCSPTR,SPIOCSSR(,@07)                              1301
*        IOCWORK  = SRTBUFPT;                                      1302
         L     @07,SRTBUFPT                                        1302
         ST    @07,IOCWORK(,IOCSPTR)                               1302
*        IOCDLN   = BLKSIZE;                                       1303
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1303
*        IOCDAD   = 0;                                             1304
*                                                                  1304
         SLR   @07,@07                                             1304
         ST    @07,IOCDAD(,IOCSPTR)                                1304
*        /************************************************************/
*        /*                                                          */
*        /* THE OUTER LOOP IS CONTROLLED BY THE NUMBER OF RECORDS    */
*        /* IN THE RSA (CONTAINED IN PUTCTR).                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1305
*SP1LP:  DO WHILE PUTCTR > 0;                                      1305
*                                                                  1305
SP1LP    B     @DE01305                                            1305
@DL01305 DS    0H                                                  1306
*          SPRECPTR = SRTBUFPT;                                    1306
*                                                                  1306
         L     SPRECPTR,SRTBUFPT                                   1306
*          /**********************************************************/
*          /*                                                        */
*          /* THE INNER LOOP IS CONTROLLED BY THE NUMBER OF RECORDS  */
*          /* TO BE MOVED TO THE OUTPUT BUFFER, EITHER ITS FULL      */
*          /* CAPACITY OR THE NUMBER OF RECORDS REMAINING IN THE     */
*          /* RSA - I.E., THE LAST BLOCK.  USING THE POINTERS IN     */
*          /* THE HEAP IN SEQUENCE, MOVE THE RECORDS IN THE RSA      */
*          /* TO THE OUTPUT BUFFER.                                  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1307
*SP2LP:    DO SP2 = 1 TO SP2LIM;                                   1307
*                                                                  1307
SP2LP    LA    @07,1                                               1307
         B     @DE01307                                            1307
@DL01307 DS    0H                                                  1308
*            SRTCURSA = SHEAPTR(SP1);                              1308
*                                                                  1308
         LR    @07,SP1                                             1308
         SLA   @07,2                                               1308
         L     @01,SRTHEAPT                                        1308
         AL    @01,@CF01678                                        1308
         L     @07,SHEAPTR(@07,@01)                                1308
         ST    @07,SRTCURSA                                        1308
*            IF SRTRECSZ <= MVCMLIM                                1309
*              THEN                                                1309
         LH    @15,SRTRECSZ                                        1309
         C     @15,@CF00925                                        1309
         BH    @RF01309                                            1309
*                SPSRTREC(1:SRTRECSZ) = RSAREC(1:SRTRECSZ);        1310
*                                                                  1310
         BCTR  @15,0                                               1310
         EX    @15,@SM01706                                        1310
*              ELSE                                                1311
*                DO;                                               1311
*                                                                  1311
         B     @RC01309                                            1311
@RF01309 DS    0H                                                  1312
*                SPSRTREC(1:MVCMLIM) = RSAREC(1:MVCMLIM);          1312
         L     @07,SRTCURSA                                        1312
         MVC   SPSRTREC(256,SPRECPTR),RSAREC(@07)                  1312
*                SPSRTREC(MVCMLIM + 1:SRTRECSZ) =                  1313
*                  RSAREC(MVCMLIM + 1:SRTRECSZ);                   1313
*                                                                  1313
         LH    @15,SRTRECSZ                                        1313
         SL    @15,@CF01651                                        1313
         EX    @15,@SM01708                                        1313
*                END;                                              1314
*                                                                  1314
*            SPRECPTR = SPRECPTR + SRTRECSZ;                       1315
@RC01309 AH    SPRECPTR,SRTRECSZ                                   1315
*            SP1      = SP1 + 1;                                   1316
*                                                                  1316
         AL    SP1,@CF00220                                        1316
*          END SP2LP;                                              1317
*                                                                  1317
         LA    @07,1                                               1317
         AL    @07,SP2                                             1317
@DE01307 ST    @07,SP2                                             1317
         CR    @07,SP2LIM                                          1317
         BNH   @DL01307                                            1317
*          /**********************************************************/
*          /*                                                        */
*          /* WRITE THE 2K BLOCK TO THE SORT WORK FILE               */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1318
*          CALL IDCIOPT0 (GDTTBL,SPIOCSSR(1));                     1318
*                                                                  1318
         L     @07,@PC00001                                        1318
         ST    @07,@AL00001                                        1318
         L     @15,@PC00014                                        1318
         LA    @15,SPIOCSSR(,@15)                                  1318
         ST    @15,@AL00001+4                                      1318
         MVI   @AL00001+4,X'80'                                    1318
         L     @15,GDTPUT(,@07)                                    1318
         LA    @01,@AL00001                                        1318
         BALR  @14,@15                                             1318
*          RESPECIFY RTNREG RSTD;                                  1319
*          TESTRC = RTNREG;                                        1320
         LR    TESTRC,RTNREG                                       1320
*          RESPECIFY RTNREG UNRSTD;                                1321
*                                                                  1321
*          IF TESTRC ^= 0                                          1322
*            THEN                                                  1322
         LTR   TESTRC,TESTRC                                       1322
         BZ    @RF01322                                            1322
*              RETURN CODE(LASTCC08);                              1323
*                                                                  1323
         LA    @15,8                                               1323
         L     @14,@SA00014                                        1323
         LM    @00,@12,@SA00014+8                                  1323
         BR    @14                                                 1323
*          IOCDAD = 0;                                             1324
*                                                                  1324
@RF01322 SLR   @07,@07                                             1324
         ST    @07,IOCDAD(,IOCSPTR)                                1324
*          /**********************************************************/
*          /*                                                        */
*          /* CALCULATE THE NUMBER OF RECORDS TO BE MOVED ON NEXT    */
*          /* PASS THROUGH SP2 LOOP                                  */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1325
*          PUTCTR = PUTCTR - SP2LIM;                               1325
*                                                                  1325
         SLR   PUTCTR,SP2LIM                                       1325
*          IF PUTCTR < SRTRECBK                                    1326
*            THEN                                                  1326
         CH    PUTCTR,SRTRECBK                                     1326
         BNL   @RF01326                                            1326
*              SP2LIM = PUTCTR;                                    1327
*                                                                  1327
         LR    SP2LIM,PUTCTR                                       1327
*        END SP1LP;                                                1328
*                                                                  1328
@RF01326 DS    0H                                                  1328
@DE01305 SLR   @07,@07                                             1328
         CR    PUTCTR,@07                                          1328
         BH    @DL01305                                            1328
*        /************************************************************/
*        /*                                                          */
*        /* INCREMENT NUMBER OF STRINGS AND RESET FACTORS.           */
*        /* IF THE NUMBER OF RECORDS IN THE RSA IS LESS THAN         */
*        /* THE RSA CAPACITY,SAVE THAT NUMBER AS THE NUMBER OF RECORD*/
*        /* IN THE LAST STRING.                                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1329
*        SRTOSTRG = SRTOSTRG + 1;                                  1329
         LA    @06,1                                               1329
         AL    @06,SRTOSTRG                                        1329
         ST    @06,SRTOSTRG                                        1329
*        SRTCURSA = SRTRSAPT;                                      1330
*                                                                  1330
         L     @06,SRTRSAPT                                        1330
         ST    @06,SRTCURSA                                        1330
*        IF SRTRSACT = SRTRSACP                                    1331
*          THEN                                                    1331
         CLC   SRTRSACT(4),SRTRSACP                                1331
         BNE   @RF01331                                            1331
*            SRTRSACT = 0;                                         1332
*                                                                  1332
         ST    @07,SRTRSACT                                        1332
*        /************************************************************/
*        /*                                                          */
*        /* SET THE EXTERNAL SORT FLAG                               */
*        /*                                                          */
*        /************************************************************/
*                                                                  1333
*        SRTFLEXT = ON;                                            1333
*                                                                  1333
@RF01331 OI    SRTFLEXT,B'01000000'                                1333
*        /************************************************************/
*        /*                                                          */
*        /* THIS COMPLETES SPILPROC PROCESSING.  RETURN TO CALLING   */
*        /* PROCEDURE                                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1334
*        RETURN CODE(LASTCC00);                                    1334
*                                                                  1334
         SLR   @15,@15                                             1334
         L     @14,@SA00014                                        1334
         LM    @00,@12,@SA00014+8                                  1334
         BR    @14                                                 1334
*END SPILPROC;                                                     1335
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - BLDPROC                                 */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE         */
*        /*            ALTERNATE INDEX RECORD AND WRITING IT TO      */
*        /*            THE ALTERNATE INDEX DATA SET.  THE ALTERNATE  */
*        /*            INDEX RECORD CONTAINS STATIC INFORMATION      */
*        /*            IN THE FIRST FIVE BYTES FOLLOWED BY THE       */
*        /*            ALTERNATE KEY FOLLOWED BY ONE OR MORE         */
*        /*            POINTERS TO THE BASE CLUSTER.  THESE POINTERS */
*        /*            ARE PRIME KEYS IF THE BASE CLUSTER IS A KSDS  */
*        /*            OR RBAS IF THE BASE CLUSTER IS AN ESDS.       */
*        /*            BLDPROC OBTAINS THE ALTERNATE KEY FROM THE    */
*        /*            SORT RECORD PASSED TO IT  AND MOVES IT TO     */
*        /*            THE ALTERNATE INDEX RECORD.  ALL BASE         */
*        /*            CLUSTER POINTERS (OBTAINED FROM THE SORT      */
*        /*            RECORDS) FOR THE SAME ALTERNATE KEY ARE       */
*        /*            MOVED TO THE SAME ALTERNATE INDEX RECORD.     */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        BLRECPTR - POINTER TO SORT RECORD                 */
*        /*                                                          */
*        /*        BLDAMDS  - POINTERS TO BASE CLUSTER AND AIX       */
*        /*                   AMDSB CONTROL BLOCKS                   */
*        /*                                                          */
*        /*        BLDIOCS  - POINTERS TO IOCSTR FOR EACH OPEN       */
*        /*                   DATA SET                               */
*        /*                                                          */
*        /*        BLDSRTB  - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*        BLDSTAT  - STATUS COMMUNICATION AREA              */
*        /*                                                          */
*        /*        ALTERNATE INDEX RECORDS                           */
*        /*                                                          */
*        /* EXIT,NORMAL - RETURN CODE 0, BLSAVERC = 0 - ALL FUNCTIONS*/
*        /*                              COMPLETED SUCCESSFULLY      */
*        /*                                                          */
*        /*                              BLSAVERC = 4 - NONUNIQUEKEYS*/
*        /*                              FOR AN AIX DEFINED AS       */
*        /*                              UNIQUEKEY OR AIX RECORD     */
*        /*                              COULD NOT CONTAIN ALL BASE  */
*        /*                              POINTERS                    */
*        /*                                                          */
*        /* EXIT,ERROR  - RETURN CODE 8, I/O ERROR WRITING AIX       */
*        /*                              RECORD                      */
*        /*                                                          */
*        /************************************************************/
*                                                                  1336
*BLDPROC:                                                          1336
*        PROCEDURE (BLRECPTR,          /* PTR TO INPUT SORT RECORD   */
*                   BLDAMDS,           /* PTRS TO AMDSBS             */
*                   BLDIOCS,           /* PTRS TO IOCSTRS            */
*                   BLDSRTB,           /* SORT CONTROL TABLE         */
*                   BLDSTAT);          /* STATUS COMMUNICATION AREA  */
*                                                                  1336
BLDPROC  STM   @14,@12,@SA00015                                    1336
         MVC   @PC00015(20),0(@01)                                 1336
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1337
*        DCL BLRECPTR PTR(31);         /* POINTER TO INPUT SORT      */
*                                      /* RECORD                     */
*                                                                  1338
*        DCL 1 BLDAMDS BDY(WORD),      /* POINTERS TO AMDSBS         */
*              2 BLDAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */
*              2 BLDAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */
*                                                                  1338
*        DCL 1 BLDIOCS BDY(WORD),      /* POINTERS TO IOCSTRS        */
*              2 BLIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */
*              2 BLIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */
*              2 BLIOCSSR(2) PTR(31);  /* POINTER TO SORT IOCSTRS    */
*                                                                  1339
*        DCL BLDSRTB;                  /* SORT CONTROL TABLE         */
*                                                                  1340
*        DCL 1 BLDSTAT,                /* STATUS COMMUNICATION AREA  */
*              2 BLSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 BLSTID   CHAR(4);     /* ERROR IDENTIFIER           */
*                                                                  1341
*                                                                  1341
*        /************************************************************/
*        /*                                                          */
*        /* OVERLAY OF INPUT SORT RECORD                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1342
*        DCL BLSRTREC CHAR(*) BASED(BLRECPTR);                     1342
*                                                                  1342
*        /************************************************************/
*        /*                                                          */
*        /* SAVE AREA FOR LENGTH OF STATIC INFORMATION PLUS THE      */
*        /* LENGTH OF THE ALTERNATE KEY                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1343
*        DCL STATLEN FIXED(15);                                    1343
*                                                                  1343
*        /************************************************************/
*        /*                                                          */
*        /* OVERLAY OF STATIC PORTION OF AIX RECORD                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1344
*/********************************************************************/
*/*                                                                  */
*/*   MACRO NAME = IDAAIR                                            */
*/*                                                                  */
*/*   DESCRIPTIVE NAME =ALTERNATE INDEX RECORD                       */
*/*                                                                  */
*/*   FUNCTION = DESCRIBES THE ALTERNATE INDEX RECORD HEADER         */
*/*                                                                  */
*/*   INCLUDED MACROS = NONE                                         */
*/*                                                                  */
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */
*/*                                                                  */
*/*   CREATED BY = RECORD MANAGEMENT MODULE IDA019RU                 */
*/*                                                                  */
*/*   STATUS = VS/1 RELEASE 4  (CHANGE FLAG @X04SVXX)                */
*/*                                                                  */
*/*   DATE OF LAST CHANGE = 9 AUG 74                                 */
*/*                                                                  */
*/********************************************************************/
*   DCL                                                            1344
*     1 IDAAIX BASED,               /* ALTERNATE INDEX RECORD        */
*      2 AIXFG BIT(8),              /* FLAG FIELD                    */
*       3 * BIT(7),                 /* RESERVED                      */
*       3 AIXPKP BIT(1),            /* 0= RBA POINTERS 1=PRIME KEY 1344
*                                      POINTERS                      */
*      2 AIXPL FIXED(8),            /* LENGTH OF THE POINTER         */
*      2 AIXPC FIXED(15),           /* NUMBER OF POINTERS            */
*      2 AIXKL FIXED(8),            /* LENGTH OF AIX KEY             */
*      2 AIXKY CHAR(*);             /* AIX KEY                       */
*   DCL AIXPCMAX CONSTANT(32767)FIXED(15);/* MAXIMUM AIXPC VALUE     */
*                                                                  1345
*        /************************************************************/
*        /*                                                          */
*        /* VARIABLES USED BY BLDPROC                                */
*        /*                                                          */
*        /************************************************************/
*                                                                  1346
*        DCL FIRSTKEY BIT(1);          /* FIRST PRIME KEY OR RBA FLAG*/
*                                                                  1346
*        DCL MSGTXT(2) CHAR(3) INIT('KEY','RBA'); /* MESSAGE TEXT    */
*                                                                  1347
*        DCL BL FIXED(31);             /* LOOP CONTROL               */
*                                                                  1348
*        DCL CLRSTART FIXED(15);       /* START OF AREA TO CLEAR     */
*                                                                  1349
*        DCL UNQLIMIT FIXED(8);        /* LIMIT OF LOOP TO PRINT     */
*                                      /* NONUNIQUEKEYS              */
*                                                                  1351
*        DCL IOCDADSV PTR(31);         /* SAVE AREA FOR IOCDAD       */
*                                                                  1351
*        DCL MAXAIXPC FIXED(15) CONSTANT(32767); /* MAXIMUM NUMBER   */
*                                                /* OF AIX POINTERS  */
*        /************************************************************/
*        /*                                                          */
*        /* IF THIS IS THE FIRST ENTRY TO BLDPROC, PERFORM INITIAL-  */
*        /* IZATION.                                                 */
*        /*                                                          */
*        /************************************************************/
*                                                                  1353
*        AMDSBPTR = BLDAMAIX;                                      1353
         L     @03,@PC00015+4                                      1353
         L     AMDSBPTR,BLDAMAIX(,@03)                             1353
*        IOCSPTR  = BLIOCSAX;                                      1354
*                                                                  1354
         L     @05,@PC00015+8                                      1354
         L     IOCSPTR,BLIOCSAX(,@05)                              1354
*        IF SRTFLBLD = ON                                          1355
*          THEN                                                    1355
         TM    SRTFLBLD,B'00010000'                                1355
         BNO   @RF01355                                            1355
*FIRSTIME:   DO;                                                   1356
*                                                                  1356
FIRSTIME DS    0H                                                  1357
*            OLDERID2 = NEWERID2;                                  1357
         L     @05,@PC00001                                        1357
         L     @05,GDTTR2(,@05)                                    1357
         MVC   @TS00001(95),NEWERID2(@05)                          1357
         MVC   OLDERID2(95,@05),@TS00001                           1357
*            NEWID2 = 'BIB1';                                      1358
*                                                                  1358
         MVC   NEWID2(4,@05),@CC01530                              1358
*            SRTEXCES = 0;                                         1359
         SLR   @05,@05                                             1359
         ST    @05,SRTEXCES                                        1359
*            FIRSTKEY = ON;                                        1360
         OI    FIRSTKEY,B'10000000'                                1360
*            SRTFLBLD = OFF;                                       1361
*                                                                  1361
         NI    SRTFLBLD,B'11101111'                                1361
*            /********************************************************/
*            /*                                                      */
*            /* THE AIX OUTPUT AREA IS IN CORE GOTTEN BY INITPROC.   */
*            /* IT IS PRECEDED BY ONE 2K BUFFER AND THE DEFINE       */
*            /* CPL/PUT/FPL COMPLEX.                                 */
*            /*                                                      */
*            /********************************************************/
*                                                                  1362
*            IOCDAD = SRTBUFPT + BLKSIZE +                         1362
*                     LENGTH(DFCPAREA) + LENGTH(DEFAREAS) +        1362
*                     LENGTH(VOLLIST);                             1362
*                                                                  1362
         LA    @05,3292                                            1362
         AL    @05,SRTBUFPT                                        1362
         ST    @05,IOCDAD(,IOCSPTR)                                1362
*            IOCDADSV = IOCDAD;                                    1363
*                                                                  1363
         ST    @05,IOCDADSV                                        1363
*            RFY IDAAIX BASED (IOCDAD);                            1364
*                                                                  1364
*            /********************************************************/
*            /*                                                      */
*            /* CALCULATE LENGTH OF STATIC PORTION OF AIX RECORD.    */
*            /* SET UP STATIC PORTION AND ALTERNATE KEY              */
*            /*                                                      */
*            /********************************************************/
*                                                                  1365
*            STATLEN = LENGTH(IDAAIX) + AMDKEYLN;                  1365
*                                                                  1365
         LA    @03,5                                               1365
         AH    @03,AMDKEYLN(,AMDSBPTR)                             1365
         STH   @03,STATLEN                                         1365
*            IOCDLN = STATLEN;                                     1366
*                                                                  1366
         ST    @03,IOCDLN(,IOCSPTR)                                1366
*            IF BLDAMBAS -> AMDDST = ON                            1367
*              THEN                                                1367
         L     @03,@PC00015+4                                      1367
         L     @03,BLDAMBAS(,@03)                                  1367
         TM    AMDDST(@03),B'10000000'                             1367
         BNO   @RF01367                                            1367
*                DO;                                               1368
*                                                                  1368
*                AIXPKP = ON;                                      1369
         OI    AIXPKP(@05),B'00000001'                             1369
*                AIXPL  = BLDAMBAS -> AMDKEYLN;                    1370
*                                                                  1370
         LH    @03,AMDKEYLN(,@03)                                  1370
         STC   @03,AIXPL(,@05)                                     1370
*                END;                                              1371
*                                                                  1371
*              ELSE                                                1372
*                AIXPL = 4;                                        1372
*                                                                  1372
         B     @RC01367                                            1372
@RF01367 L     @05,IOCDAD(,IOCSPTR)                                1372
         MVI   AIXPL(@05),X'04'                                    1372
*            AIXKL = AMDKEYLN;                                     1373
*                                                                  1373
@RC01367 L     @05,IOCDAD(,IOCSPTR)                                1373
         LH    @03,AMDKEYLN(,AMDSBPTR)                             1373
         STC   @03,AIXKL(,@05)                                     1373
*            AIXKY(1:AMDKEYLN) = BLSRTREC(1:AMDKEYLN);             1374
*                                                                  1374
         BCTR  @03,0                                               1374
         L     @15,@PC00015                                        1374
         L     @01,BLRECPTR(,@15)                                  1374
         EX    @03,@SM01711                                        1374
*            END FIRSTIME;                                         1375
*                                                                  1375
*          ELSE                                                    1376
*                                                                  1376
*            /********************************************************/
*            /*                                                      */
*            /* IF THIS IS NOT THE FIRST ENTRY TO BLDPROC, DETERMINE */
*            /* IF AN AIX RECORD IS TO BE WRITTEN OUT.  IF BLDPROC   */
*            /* IS CALLED WITH A NULL SORT RECORD POINTER, THE LAST  */
*            /* RECORD IS TO BE WRITTEN OUT.  IF THE AIX RECORD      */
*            /* COULD NOT CONTAIN ALL THE BASE POINTERS, ISSUE A     */
*            /* MESSAGE FIRST                                        */
*            /*                                                      */
*            /********************************************************/
*                                                                  1376
*            IF BLRECPTR = NULLPTR                                1376
*               BLSRTREC(1:AMDKEYLN) ^= AIXKY(1:AMDKEYLN)          1376
*              THEN                                                1376
         B     @RC01355                                            1376
@RF01355 L     @05,@PC00015                                        1376
         L     @05,BLRECPTR(,@05)                                  1376
         LTR   @05,@05                                             1376
         BZ    @RT01376                                            1376
         L     @03,IOCDAD(,IOCSPTR)                                1376
         LH    @15,AMDKEYLN(,AMDSBPTR)                             1376
         BCTR  @15,0                                               1376
         EX    @15,@SC01713                                        1376
         BE    @RF01376                                            1376
@RT01376 DS    0H                                                  1377
*PUTAIX:         DO;                                               1377
*                                                                  1377
PUTAIX   DS    0H                                                  1378
*                IF SRTEXCES ^= 0                                  1378
*                  THEN                                            1378
         L     @05,SRTEXCES                                        1378
         LTR   @05,@05                                             1378
         BZ    @RF01378                                            1378
*                    DO;                                           1379
*                                                                  1379
*                    BLSAVERC = LASTCC04;                          1380
*                                                                  1380
         LA    @05,4                                               1380
         L     @03,@PC00015+16                                     1380
         STH   @05,BLSAVERC(,@03)                                  1380
*                    DARGLIST = ''B;                               1381
         L     @03,DDSTRU                                          1381
         XC    DARGLIST(20,@03),DARGLIST(@03)                      1381
*                    DARGSTID = EXCESPTR;                          1382
         MVC   DARGSTID(4,@03),@CF00896                            1382
*                    DARGCNT  = 3;                                 1383
         LA    @15,3                                               1383
         STH   @15,DARGCNT(,@03)                                   1383
*                    DARGINS(1) = 1;                               1384
         MVC   DARGINS(2,@03),@CH00220                             1384
*                    DARGINL(1) = LENGTH(SRTEXCES);                1385
         STH   @05,DARGINL(,@03)                                   1385
*                    DARGDTM(1) = ADDR(SRTEXCES);                  1386
         LA    @05,SRTEXCES                                        1386
         ST    @05,DARGDTM(,@03)                                   1386
*                    DARGINS(2) = 2;                               1387
         MVC   DARGINS+8(2,@03),@CH00154                           1387
*                    DARGINL(2) = 3;                               1388
*                                                                  1388
         STH   @15,DARGINL+8(,@03)                                 1388
*                    IF AIXPKP = ON                                1389
*                      THEN                                        1389
         L     @05,IOCDAD(,IOCSPTR)                                1389
         TM    AIXPKP(@05),B'00000001'                             1389
         BNO   @RF01389                                            1389
*                        DARGDTM(2) = ADDR(MSGTXT(1));             1390
*                                                                  1390
         LA    @05,MSGTXT                                          1390
         ST    @05,DARGDTM+8(,@03)                                 1390
*                      ELSE                                        1391
*                        DARGDTM(2) = ADDR(MSGTXT(2));             1391
*                                                                  1391
         B     @RC01389                                            1391
@RF01389 LA    @05,MSGTXT+3                                        1391
         L     @03,DDSTRU                                          1391
         ST    @05,DARGDTM+8(,@03)                                 1391
*                    DARGINS(3) = 3;                               1392
@RC01389 L     @05,DDSTRU                                          1392
         MVC   DARGINS+16(2,@05),@CH00163                          1392
*                    DARGDTM(3) = ADDR(AIXKY);                     1393
*                                                                  1393
         L     @03,IOCDAD(,IOCSPTR)                                1393
         LA    @03,AIXKY(,@03)                                     1393
         ST    @03,DARGDTM+16(,@05)                                1393
*                    IF AMDKEYLN > 10                              1394
*                      THEN                                        1394
         LA    @03,10                                              1394
         CH    @03,AMDKEYLN(,AMDSBPTR)                             1394
         BNL   @RF01394                                            1394
*                        DARGINL(3) = 10;                          1395
*                                                                  1395
         STH   @03,DARGINL+16(,@05)                                1395
*                      ELSE                                        1396
*                        DARGINL(3) = AMDKEYLN;                    1396
*                                                                  1396
         B     @RC01394                                            1396
@RF01394 LH    @05,AMDKEYLN(,AMDSBPTR)                             1396
         L     @03,DDSTRU                                          1396
         STH   @05,DARGINL+16(,@03)                                1396
*                    CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);        1397
*                                                                  1397
@RC01394 L     @05,@PC00001                                        1397
         ST    @05,@AL00001                                        1397
         LA    @03,@CF00116                                        1397
         ST    @03,@AL00001+4                                      1397
         LA    @03,DDSTRU                                          1397
         ST    @03,@AL00001+8                                      1397
         MVI   @AL00001+8,X'80'                                    1397
         L     @15,GDTPRT(,@05)                                    1397
         LA    @01,@AL00001                                        1397
         BALR  @14,@15                                             1397
*                    SRTEXCES = 0;                                 1398
*                                                                  1398
         SLR   @05,@05                                             1398
         ST    @05,SRTEXCES                                        1398
*                    END;                                          1399
*                                                                  1399
*                /****************************************************/
*                /*                                                  */
*                /* WRITE OUT THE AIX RECORD AND CLEAR THE RECORD    */
*                /* AREA                                             */
*                /*                                                  */
*                /****************************************************/
*                                                                  1400
*                CALL IDCIOPT0 (GDTTBL,BLIOCSAX);                  1400
*                                                                  1400
@RF01378 L     @05,@PC00001                                        1400
         ST    @05,@AL00001                                        1400
         L     @15,@PC00015+8                                      1400
         LA    @15,BLIOCSAX(,@15)                                  1400
         ST    @15,@AL00001+4                                      1400
         MVI   @AL00001+4,X'80'                                    1400
         L     @15,GDTPUT(,@05)                                    1400
         LA    @01,@AL00001                                        1400
         BALR  @14,@15                                             1400
*                RESPECIFY RTNREG RSTD;                            1401
*                TESTRC = RTNREG;                                  1402
         LR    TESTRC,RTNREG                                       1402
*                RESPECIFY RTNREG UNRSTD;                          1403
*                                                                  1403
*                IF TESTRC ^= 0                                    1404
*                  THEN                                            1404
         LTR   TESTRC,TESTRC                                       1404
         BZ    @RF01404                                            1404
*                    RETURN CODE(LASTCC08);                        1405
*                                                                  1405
         LA    @15,8                                               1405
         L     @14,@SA00015                                        1405
         LM    @00,@12,@SA00015+8                                  1405
         BR    @14                                                 1405
*                IOCDAD   = IOCDADSV;                              1406
@RF01404 L     @05,IOCDADSV                                        1406
         ST    @05,IOCDAD(,IOCSPTR)                                1406
*                CLRSTART = STATLEN + 1;                           1407
*                                                                  1407
         LA    @05,1                                               1407
         LH    CLRSTART,STATLEN                                    1407
         ALR   CLRSTART,@05                                        1407
*                DO BL = 1 TO AIXPC;                               1408
*                                                                  1408
         LA    @15,1                                               1408
         LR    BL,@15                                              1408
         B     @DE01408                                            1408
@DL01408 DS    0H                                                  1409
*                  AIXREC(CLRSTART:CLRSTART + AIXPL - 1) =         1409
*                    AIXREC(CLRSTART:CLRSTART + AIXPL - 1) &&      1409
*                    AIXREC(CLRSTART:CLRSTART + AIXPL - 1);        1409
*                                                                  1409
         L     @15,IOCDAD(,IOCSPTR)                                1409
         LR    @14,@15                                             1409
         ALR   @14,CLRSTART                                        1409
         BCTR  @14,0                                               1409
         SLR   @07,@07                                             1409
         IC    @07,AIXPL(,@15)                                     1409
         BCTR  @07,0                                               1409
         EX    @07,@SX01715                                        1409
*                  CLRSTART = CLRSTART + AIXPL;                    1410
*                                                                  1410
         SLR   @14,@14                                             1410
         IC    @14,AIXPL(,@15)                                     1410
         ALR   CLRSTART,@14                                        1410
*                END;                                              1411
*                                                                  1411
         AL    BL,@CF00220                                         1411
@DE01408 L     @01,IOCDAD(,IOCSPTR)                                1411
         CH    BL,AIXPC(,@01)                                      1411
         BNH   @DL01408                                            1411
*                /****************************************************/
*                /*                                                  */
*                /* IF THIS IS NOT THE LAST ENTRY TO BLDPROC,        */
*                /* RESET REMAINING FACTORS AND MOVE IN NEW          */
*                /* ALTERNATE KEY                                    */
*                /*                                                  */
*                /****************************************************/
*                                                                  1412
*                IF BLRECPTR ^= NULLPTR                            1412
*                  THEN                                            1412
         SLR   @05,@05                                             1412
         L     @03,@PC00015                                        1412
         L     @03,BLRECPTR(,@03)                                  1412
         CR    @03,@05                                             1412
         BE    @RF01412                                            1412
*                    DO;                                           1413
*                                                                  1413
*                    AIXPC    = 0;                                 1414
         L     @15,IOCDAD(,IOCSPTR)                                1414
         STH   @05,AIXPC(,@15)                                     1414
*                    IOCDLN   = STATLEN;                           1415
         LH    @05,STATLEN                                         1415
         ST    @05,IOCDLN(,IOCSPTR)                                1415
*                    FIRSTKEY = ON;                                1416
*                                                                  1416
         OI    FIRSTKEY,B'10000000'                                1416
*                    AIXKY(1:AMDKEYLN) = BLSRTREC(1:AMDKEYLN);     1417
*                                                                  1417
         LH    @05,AMDKEYLN(,AMDSBPTR)                             1417
         BCTR  @05,0                                               1417
         EX    @05,@SM01717                                        1417
*                    END;                                          1418
*                                                                  1418
*                END PUTAIX;                                       1419
*                                                                  1419
@RF01412 DS    0H                                                  1420
*        /************************************************************/
*        /*                                                          */
*        /* IF THIS IS NOT THE LAST ENTRY TO BLDPROC,                */
*        /* PREPARE TO MOVE THE PRIME KEY OR RBA TO THE AIX RECORD.  */
*        /* IF THIS IS THE SECOND OR SUBSEQUENT POINTER AND THE      */
*        /* ALTERNATE INDEX WAS DEFINED AS HAVING UNIQUEKEYS, ISSUE  */
*        /* A MESSAGE.  IF THIS IS THE SECOND POINTER, A MESSAGE     */
*        /* CONTAINING THE FIRST POINTER MUST ALSO BE ISSUED.        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1420
*        IF BLRECPTR ^= NULLPTR                                    1420
*          THEN                                                    1420
@RF01376 DS    0H                                                  1420
@RC01355 L     @05,@PC00015                                        1420
         L     @05,BLRECPTR(,@05)                                  1420
         LTR   @05,@05                                             1420
         BZ    @RF01420                                            1420
*ADDPRIME:   DO;                                                   1421
*                                                                  1421
ADDPRIME DS    0H                                                  1422
*            IF AIXPC ^= 0 &                                       1422
*               AMDUNQ = OFF                                       1422
*              THEN                                                1422
         L     @05,IOCDAD(,IOCSPTR)                                1422
         LH    @05,AIXPC(,@05)                                     1422
         LTR   @05,@05                                             1422
         BZ    @RF01422                                            1422
         TM    AMDUNQ(AMDSBPTR),B'10000000'                        1422
         BNZ   @RF01422                                            1422
*PRTNUNQ:        DO;                                               1423
*                                                                  1423
PRTNUNQ  DS    0H                                                  1424
*                BLSAVERC = LASTCC04;                              1424
*                                                                  1424
         L     @05,@PC00015+16                                     1424
         MVC   BLSAVERC(2,@05),@CH00043                            1424
*                IF FIRSTKEY = ON                                  1425
*                  THEN                                            1425
         TM    FIRSTKEY,B'10000000'                                1425
         BNO   @RF01425                                            1425
*                    UNQLIMIT = 2;                                 1426
*                                                                  1426
         LA    UNQLIMIT,2                                          1426
*                  ELSE                                            1427
*                    UNQLIMIT = 1;                                 1427
*                                                                  1427
         B     @RC01425                                            1427
@RF01425 LA    UNQLIMIT,1                                          1427
*                DO BL = 1 TO UNQLIMIT;                            1428
*                                                                  1428
@RC01425 LA    BL,1                                                1428
         B     @DE01428                                            1428
@DL01428 DS    0H                                                  1429
*                  DARGLIST = ''B;                                 1429
*                                                                  1429
         L     @15,DDSTRU                                          1429
         XC    DARGLIST(20,@15),DARGLIST(@15)                      1429
*                  IF AIXPKP = ON                                  1430
*                    THEN                                          1430
         L     @01,IOCDAD(,IOCSPTR)                                1430
         TM    AIXPKP(@01),B'00000001'                             1430
         BNO   @RF01430                                            1430
*                      DARGSTID = NONUNQKS;                        1431
*                                                                  1431
         MVC   DARGSTID(4,@15),@CF00894                            1431
*                    ELSE                                          1432
*                      DARGSTID = NONUNQES;                        1432
*                                                                  1432
         B     @RC01430                                            1432
@RF01430 L     @01,DDSTRU                                          1432
         MVC   DARGSTID(4,@01),@CF00918                            1432
*                  DARGCNT  = 2;                                   1433
@RC01430 L     @15,DDSTRU                                          1433
         MVC   DARGCNT(2,@15),@CH00154                             1433
*                  DARGINS(1) = 1;                                 1434
         MVC   DARGINS(2,@15),@CH00220                             1434
*                  DARGDTM(1) = ADDR(AIXKY);                       1435
*                                                                  1435
         L     @01,IOCDAD(,IOCSPTR)                                1435
         LA    @14,AIXKY(,@01)                                     1435
         ST    @14,DARGDTM(,@15)                                   1435
*                  IF AMDKEYLN > 10                                1436
*                    THEN                                          1436
         LA    @14,10                                              1436
         CH    @14,AMDKEYLN(,AMDSBPTR)                             1436
         BNL   @RF01436                                            1436
*                      DARGINL(1) = 10;                            1437
*                                                                  1437
         STH   @14,DARGINL(,@15)                                   1437
*                    ELSE                                          1438
*                      DARGINL(1) = AMDKEYLN;                      1438
*                                                                  1438
         B     @RC01436                                            1438
@RF01436 LH    @15,AMDKEYLN(,AMDSBPTR)                             1438
         L     @14,DDSTRU                                          1438
         STH   @15,DARGINL(,@14)                                   1438
*                  DARGINS(2) = 2;                                 1439
*                                                                  1439
@RC01436 L     @15,DDSTRU                                          1439
         MVC   DARGINS+8(2,@15),@CH00154                           1439
*                  IF AIXPL > 10                                   1440
*                    THEN                                          1440
         L     @01,IOCDAD(,IOCSPTR)                                1440
         CLI   AIXPL(@01),10                                       1440
         BNH   @RF01440                                            1440
*                      DARGINL(2) = 10;                            1441
*                                                                  1441
         MVC   DARGINL+8(2,@15),@CH00037                           1441
*                    ELSE                                          1442
*                      DARGINL(2) = AIXPL;                         1442
*                                                                  1442
         B     @RC01440                                            1442
@RF01440 L     @01,IOCDAD(,IOCSPTR)                                1442
         SLR   @00,@00                                             1442
         IC    @00,AIXPL(,@01)                                     1442
         L     @01,DDSTRU                                          1442
         STH   @00,DARGINL+8(,@01)                                 1442
*                  IF UNQLIMIT = 2 & BL = 1                        1443
*                    THEN                                          1443
@RC01440 C     UNQLIMIT,@CF00154                                   1443
         BNE   @RF01443                                            1443
         C     BL,@CF00220                                         1443
         BNE   @RF01443                                            1443
*                      DARGDTM(2) = ADDR(AIXREC) + STATLEN;        1444
*                                                                  1444
         LH    @15,STATLEN                                         1444
         AL    @15,IOCDAD(,IOCSPTR)                                1444
         L     @14,DDSTRU                                          1444
         ST    @15,DARGDTM+8(,@14)                                 1444
*                    ELSE                                          1445
*                      DARGDTM(2) = ADDR(BLSRTREC) + AMDKEYLN;     1445
*                                                                  1445
         B     @RC01443                                            1445
@RF01443 L     @15,@PC00015                                        1445
         LH    @14,AMDKEYLN(,AMDSBPTR)                             1445
         AL    @14,BLRECPTR(,@15)                                  1445
         L     @15,DDSTRU                                          1445
         ST    @14,DARGDTM+8(,@15)                                 1445
*                  CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);          1446
*                                                                  1446
@RC01443 L     @15,@PC00001                                        1446
         ST    @15,@AL00001                                        1446
         LA    @14,@CF00116                                        1446
         ST    @14,@AL00001+4                                      1446
         LA    @14,DDSTRU                                          1446
         ST    @14,@AL00001+8                                      1446
         MVI   @AL00001+8,X'80'                                    1446
         L     @15,GDTPRT(,@15)                                    1446
         LA    @01,@AL00001                                        1446
         BALR  @14,@15                                             1446
*                END;                                              1447
*                                                                  1447
         AL    BL,@CF00220                                         1447
@DE01428 CR    BL,UNQLIMIT                                         1447
         BNH   @DL01428                                            1447
*                FIRSTKEY = OFF;                                   1448
*                                                                  1448
         NI    FIRSTKEY,B'01111111'                                1448
*                END PRTNUNQ;                                      1449
*                                                                  1449
*              ELSE                                                1450
*                                                                  1450
*                /****************************************************/
*                /*                                                  */
*                /* IF THE NEW PRIME KEY OR RBA WILL NOT FIT INTO    */
*                /* THE AIX RECORD OR IF THE RECORD ALREADY CONTAINS */
*                /* THE MAXIMUM NUMBER OF POINTERS, INCREMENT THE    */
*                /* EXCESS COUNTER.                                  */
*                /*                                                  */
*                /****************************************************/
*                                                                  1450
*                IF IOCDLN + AIXPL > AMDLRECL                     1450
*                   AIXPC = MAXAIXPC                               1450
*                  THEN                                            1450
         B     @RC01422                                            1450
@RF01422 L     @05,IOCDAD(,IOCSPTR)                                1450
         SLR   @03,@03                                             1450
         IC    @03,AIXPL(,@05)                                     1450
         AL    @03,IOCDLN(,IOCSPTR)                                1450
         C     @03,AMDLRECL(,AMDSBPTR)                             1450
         BH    @RT01450                                            1450
         CLC   AIXPC(2,@05),@CH01518                               1450
         BNE   @RF01450                                            1450
@RT01450 DS    0H                                                  1451
*                    SRTEXCES = SRTEXCES + 1;                      1451
*                                                                  1451
         LA    @15,1                                               1451
         AL    @15,SRTEXCES                                        1451
         ST    @15,SRTEXCES                                        1451
*                  ELSE                                            1452
*                                                                  1452
*                    /************************************************/
*                    /*                                              */
*                    /* NO ERRORS HAVE BEEN FOUND SO MOVE THE NEW    */
*                    /* PRIME KEY OR RBA TO THE AIX RECORD.          */
*                    /*                                              */
*                    /************************************************/
*                                                                  1452
*                    DO;                                           1452
*                                                                  1452
         B     @RC01450                                            1452
@RF01450 DS    0H                                                  1453
*                    AIXREC(IOCDLN + 1:IOCDLN + AIXPL) =           1453
*                      BLSRTREC(AMDKEYLN + 1:AIXPL);               1453
*                                                                  1453
         L     @05,IOCDLN(,IOCSPTR)                                1453
         L     @03,IOCDAD(,IOCSPTR)                                1453
         ALR   @05,@03                                             1453
         SLR   @15,@15                                             1453
         IC    @15,AIXPL(,@03)                                     1453
         BCTR  @15,0                                               1453
         LH    @01,AMDKEYLN(,AMDSBPTR)                             1453
         L     @14,@PC00015                                        1453
         L     @14,BLRECPTR(,@14)                                  1453
         ALR   @14,@01                                             1453
         MVC   @TS00001(256),BLSRTREC(@14)                         1453
         EX    @15,@SM01719                                        1453
*                    IOCDLN = IOCDLN + AIXPL;                      1454
*                                                                  1454
         L     @15,IOCDLN(,IOCSPTR)                                1454
         SLR   @14,@14                                             1454
         IC    @14,AIXPL(,@03)                                     1454
         ALR   @15,@14                                             1454
         ST    @15,IOCDLN(,IOCSPTR)                                1454
*                    AIXPC = AIXPC + 1;                            1455
*                                                                  1455
         LA    @15,1                                               1455
         AH    @15,AIXPC(,@03)                                     1455
         STH   @15,AIXPC(,@03)                                     1455
*                    END;                                          1456
*                                                                  1456
*            END ADDPRIME;                                         1457
*                                                                  1457
@RC01450 DS    0H                                                  1457
@RC01422 DS    0H                                                  1458
*        /************************************************************/
*        /*                                                          */
*        /* THIS COMPLETES BLDPROC PROCESSING.  RETURN TO THE        */
*        /* CALLING PROCEDURE                                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1458
*        RETURN CODE(LASTCC00);                                    1458
*                                                                  1458
@RF01420 SLR   @15,@15                                             1458
         L     @14,@SA00015                                        1458
         LM    @00,@12,@SA00015+8                                  1458
         BR    @14                                                 1458
*END BLDPROC;                                                      1459
*        /************************************************************/
*        /* PROCEDURE NAME - MERGPROC                                */
*        /*                                                          */
*        /* FUNCTION - PERFORMS THE FUNCTION OF MERGING STRINGS OF   */
*        /*            SORT RECORDS ORIGINALLY BUILT BY SPILPROC     */
*        /*            USING TWO EXTERNAL SORT WORK FILES.  THE      */
*        /*            ORDER OF MERGE IS NORMALLY 16 OR LESS USING   */
*        /*            AN AREA OF 32K (THE ORIGINAL RSA) FOR INPUT   */
*        /*            BUFFERS.  IN ONE CASE, THE ORDER OF MERGE     */
*        /*            WILL BE 2.  THAT IS, WHEN THE STATISTIC OF    */
*        /*            THE NUMBER OF RECORDS IN THE BASE CLUSTER     */
*        /*            AMDSB WAS SO ERRONEOUSLY LOW THAT AN RSA OF   */
*        /*            4K WAS OBTAINED.                              */
*        /*                                                          */
*        /*            IN GENERAL, THE MERGE IS ACCOMPLISHED IN THE  */
*        /*            FOLLOWING MANNER (ASSUMING A 16-WAY MERGE) -  */
*        /*                                                          */
*        /*            . READING THE FIRST 2K BLOCK OF THE FIRST     */
*        /*              N STRINGS TO BE MERGED, WHERE N IS 16 IF    */
*        /*              THERE ARE 16 OR MORE INPUT STRINGS OR       */
*        /*              WHERE N IS THE TOTAL NUMBER OF INPUT        */
*        /*              STRINGS IF LESS THAN 16.                    */
*        /*                                                          */
*        /*              USING THE FIRST RECORD OF EACH STRING,      */
*        /*              BUILD AN ARRAY IN THE FORM OF A TREE        */
*        /*              IN WHICH EACH PARENT NODE IS LOWER THAN     */
*        /*              EACH OF ITS TWO CHILD NODES (SEE COMMENTS   */
*        /*              LATER IN THIS MODULE FOR DETAILS)           */
*        /*                                                          */
*        /*            . OUTPUT THE LOWEST RECORD ON THE TREE.       */
*        /*              THIS OUTPUT WILL BE TO BLDPROC IF THIS IS   */
*        /*              THE LAST OR ONLY MERGE PASS OR TO THE       */
*        /*              OUTPUT STRING IF THIS IS NOT THE LAST MERGE */
*        /*              PASS.                                       */
*        /*                                                          */
*        /*            . UPDATE THE TREE FILLING THE SLOT LEFT       */
*        /*              EMPTY FROM THE STEP ABOVE.                  */
*        /*                                                          */
*        /*            . GET THE NEXT RECORD FROM THE SAME STRING    */
*        /*              AS THE PREVIOUS LOWEST RECORD.  OUTPUT IT   */
*        /*              IF IT IS LOWER THAN THE CURRENT LOWEST,     */
*        /*              OTHERWISE ADD IT TO THE TREE                */
*        /*                                                          */
*        /*            . CONTINUE THIS PROCESS UNTIL ALL RECORDS     */
*        /*              IN ALL INPUT STRINGS CURRENTLY BEING        */
*        /*              PROCESSED HAVE BEEN OUTPUT.                 */
*        /*                                                          */
*        /*            . LOOP UNTIL ALL INPUT STRINGS FOR THIS       */
*        /*              MERGE PASS HAVE BEEN OUTPUT                 */
*        /*                                                          */
*        /*            . IF MORE MERGE PASSES ARE REQUIRED,          */
*        /*              MAKE THE PREVIOUS OUTPUT FILE THE NEXT      */
*        /*              INPUT FILE AND VICE VERSA AND REPEAT THE    */
*        /*              MERGE PASSES UNTIL THE NUMBER OF INPUT      */
*        /*              STRINGS IS EQUAL TO OR LESS THAN THE        */
*        /*              ORDER OF MERGE                              */
*        /*                                                          */
*        /* INPUT -                                                  */
*        /*        MERGAMDS - POINTER TO BASE CLUSTER AND AIX        */
*        /*                   AMDSB CONTROL BLOCKS                   */
*        /*                                                          */
*        /*        MERGIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */
*        /*                   SET                                    */
*        /*                                                          */
*        /*        MERGIOIN - POINTERS TO THE DATA OBTAINED FROM     */
*        /*                   THE SORT WORK JOB CONTROL              */
*        /*                                                          */
*        /*        MERGSRTB - SORT CONTROL TABLE                     */
*        /*                                                          */
*        /* OUTPUT -                                                 */
*        /*                                                          */
*        /*        MERGSTAT - STATUS COMMUNICATION AREA              */
*        /*                   SORT RECORDS PASSED TO BLDPROC         */
*        /*                                                          */
*        /* EXIT,NORMAL -  ALL FUNCTIONS COMPLETED SUCCESSFULLY      */
*        /*                                                          */
*        /* EXIT,ERROR  - RETURN CODE 8, I/O ERROR ON SORT WORK      */
*        /*                              FILES OR TERMINATING        */
*        /*                              ERROR ENCOUNTERED BY        */
*        /*                              BLD PROC                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1460
*MERGPROC:                                                         1460
*        PROCEDURE(MERGAMDS,           /* POINTERS TO AMDSBS         */
*                  MERGIOCS,           /* POINTERS TO IOCSTRS        */
*                  MERGIOIN,           /* POINTERS TO SORT WORK JOB  */
*                                      /* CONTROL DATA               */
*                  MERGSRTB,           /* SORT CONTROL TABLE         */
*                  MERGSTAT);          /* STATUS COMMUNICATION AREA  */
*                                                                  1460
MERGPROC STM   @14,@12,@SA00016                                    1460
         MVC   @PC00016(20),0(@01)                                 1460
*        /************************************************************/
*        /*                                                          */
*        /* ARGUMENTS OF INVOCATION                                  */
*        /*                                                          */
*        /************************************************************/
*                                                                  1461
*        DCL 1 MERGAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */
*              2 MERAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */
*              2 MERAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */
*                                                                  1461
*        DCL 1 MERGIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */
*              2 MRIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */
*              2 MRIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */
*              2 MRIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */
*                                                                  1462
*        DCL 1 MERGIOIN BDY(WORD),     /* POINTERS TO SORT WORK JOB  */
*              2 MRIOINPT(2) PTR(31);  /* CONTROL DATA               */
*                                                                  1463
*        DCL MERGSRTB;                 /* SORT CONTROL TABLE         */
*                                                                  1464
*        DCL 1 MERGSTAT,               /* STATUS COMMUNICATION AREA  */
*              2 MRSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */
*              2 MRSTID   CHAR(4);     /*  ERROR IDENTIFIER          */
*                                                                  1465
*        /************************************************************/
*        /*                                                          */
*        /* FLAGS AND CONTROL VARIABLES                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1466
*        DCL 1 MERGFLAG BIT(8),                                    1466
*              2 MERGEND  BIT(1),      /* END OF MERGE FLAG          */
*              2 MERGSTRT BIT(1),      /* START OF MERGE FLAG        */
*              2 MERGOUT  BIT(1),      /* OUTPUT NEXT RECORD FLAG    */
*              2 MERGUPD  BIT(1);      /* TREE UPDATE FLAG           */
*                                                                  1466
*        DCL                                                       1467
*          M        FIXED(31),         /* TREE ADD LOOP CONTROL      */
*          STRGCTR  FIXED(15),         /* INPUT STRING COUNTER       */
*          STRGLIM  FIXED(15),         /* STRING LOOP CONTROL        */
*          OUTBUFCT FIXED(15),         /* OUTPUT BUFFER RECORD COUNT */
*          OUTBUFST FIXED(15),         /* START AND END STRING VALUE */
*          OUTBUFEN FIXED(15),         /* OF OUTPUT BUFFER           */
*          IOCSHOLD PTR(31),           /* IOCSTR POINTER HOLD AREA   */
*          RBAHOLD  FIXED(31);         /* STARTING INPUT RBA         */
*                                                                  1467
*                                                                  1467
*        DCL SWFTWO FIXED(31) INIT(2); /* SORT WORK FILE INDEX       */
*                                                                  1468
*        DCL MAXKEY(256) CHAR(1) INIT((256) 'FF'X); /* MAX KEY VALUE */
*                                                                  1469
*        /************************************************************/
*        /*                                                          */
*        /* AREAS CONTAINING STRING END CONTROL FACTORS              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1470
*        DCL 1 MRNLAST FIXED(31),      /* MERGE PASS - ALL BUT LAST  */
*              2 MRNLBLK  FIXED(15),   /* LAST BLOCK NUMBER          */
*              2 MRNLREC  FIXED(15);   /* LAST RECORD NUMBER         */
*                                                                  1470
*        DCL 1 MRLAST  FIXED(31),      /* MERGE PASS - LAST STRING   */
*              2 MRLBLK   FIXED(15),   /* LAST BLOCK NUMBER          */
*              2 MRLREC   FIXED(15);   /* LAST RECORD NUMBER         */
*                                                                  1471
*        DCL 1 STRNLAST FIXED(31),     /* STRING LOOP - ALL BUT LAST */
*              2 STRNLBLK FIXED(15),   /* LAST BLOCK NUMBER          */
*              2 STRNLREC FIXED(15);   /* LAST RECORD NUMBER         */
*                                                                  1472
*        DCL 1 STRLAST  FIXED(31),     /* STRING LOOP - LAST STRING  */
*              2 STRLBLK  FIXED(15),   /* LAST BLOCK NUMBER          */
*              2 STRLREC  FIXED(15);   /* LAST RECORD NUMBER         */
*                                                                  1473
*        /************************************************************/
*        /*                                                          */
*        /* FACTORS CONTROLLING TREE ADD AND TREE DELETE ROUTINES    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1474
*        DCL                                                       1474
*          TSIZE    FIXED(15),         /* SIZE OF TREE               */
*          TCURR    FIXED(15),         /* PARENT INDEX               */
*          TPREV    FIXED(15),         /* CHILD INDEX                */
*          TREC1    FIXED(15),         /* RECORD INDEXES FOR TREE    */
*          TREC2    FIXED(15),         /* DELETE ROUTINE             */
*          TRECORD  PTR(31);           /* POINTER TO NEW OR REPLACE- */
*                                      /* MENT RECORD                */
*                                                                  1475
*                                                                  1475
*        /************************************************************/
*        /*                                                          */
*        /* OVERLAY OF TREE AND ITS AREA                             */
*        /*                                                          */
*        /************************************************************/
*                                                                  1475
*        DCL TREEPTR PTR(31);                                      1475
*                                                                  1475
*        DCL 1 MERGTREE(16) BASED(TREEPTR) BDY(WORD),              1476
*              2 MTSTGNO  FIXED(15),   /* STRING NUMBER              */
*              2 *        CHAR(2),     /* RESERVED                   */
*              2 MTBLKREC FIXED(31),                               1476
*                3 MTBLKNO  FIXED(15), /* BLOCK NUMBER               */
*                3 MTRECNO  FIXED(15), /* RECORD NUMBER              */
*              2 MTPTR    PTR(31),     /* POINTER TO RECORD          */
*              2 MTRBA    FIXED(31);   /* RBA OF RECORD              */
*                                                                  1476
*        DCL 1 NEXTREC BDY(WORD),      /* NEXT RECORD HOLD AREA      */
*              2 NXSTGNO  FIXED(15),                               1477
*              2 *        CHAR(2),                                 1477
*              2 NXBLKREC FIXED(31),                               1477
*                3 NXBLKNO  FIXED(15),                             1477
*                3 NXRECNO  FIXED(15),                             1477
*              2 NXPTR    PTR(31),                                 1477
*              2 NXRBA    FIXED(31);                               1477
*                                                                  1477
*        DCL MTAREA CHAR((LENGTH(MERGTREE) * 16));                 1478
*                                                                  1478
*        /************************************************************/
*        /*                                                          */
*        /* OVERLAY OF SORT RECORD                                   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1479
*        DCL MRSRTREC CHAR(*) BASED;                               1479
*        /************************************************************/
*        /*                                                          */
*        /* SET PROCESSING FLAGS.  INITIALIZE POINTER TO TREE.       */
*        /*                                                          */
*        /************************************************************/
*                                                                  1480
*        OLDERID2 = NEWERID2;                                      1480
         L     @05,@PC00001                                        1480
         L     @05,GDTTR2(,@05)                                    1480
         MVC   @TS00001(95),NEWERID2(@05)                          1480
         MVC   OLDERID2(95,@05),@TS00001                           1480
*        NEWID2 = 'BIM1';                                          1481
*                                                                  1481
         MVC   NEWID2(4,@05),@CC01611                              1481
*        MERGEND  = OFF;                                           1482
*        MERGSTRT = ON;                                            1483
*                                                                  1483
         OI    MERGSTRT,B'01000000'                                1483
         NI    MERGEND,B'01111111'                                 1483
*        TREEPTR  = ADDR(MTAREA);                                  1484
*                                                                  1484
         LA    TREEPTR,MTAREA                                      1484
*        /************************************************************/
*        /*                                                          */
*        /* THIS IS THE MAIN MERGE PASS LOOP.  INITIALIZE FACTORS.   */
*        /* GET THE NUMBER OF INPUT STRINGS.  IF EQUAL TO OR LESS    */
*        /* THAN THE NUMBER OF INPUT BUFFERS, THIS IS THE LAST       */
*        /* MERGE PASS.                                              */
*        /*                                                          */
*        /************************************************************/
*                                                                  1485
*MERGLP: DO WHILE MERGEND = OFF;                                   1485
*                                                                  1485
MERGLP   B     @DE01485                                            1485
@DL01485 DS    0H                                                  1486
*          OLDERID2 = NEWERID2;                                    1486
         L     @05,@PC00001                                        1486
         L     @05,GDTTR2(,@05)                                    1486
         MVC   @TS00001(95),NEWERID2(@05)                          1486
         MVC   OLDERID2(95,@05),@TS00001                           1486
*          NEWID2 = 'BIM2';                                        1487
*                                                                  1487
         MVC   NEWID2(4,@05),@CC01614                              1487
*          SRTISTRG = SRTOSTRG;                                    1488
         L     @05,SRTOSTRG                                        1488
         ST    @05,SRTISTRG                                        1488
*          SRTOSTRG = 0;                                           1489
         SLR   @15,@15                                             1489
         ST    @15,SRTOSTRG                                        1489
*          STRGCTR  = SRTISTRG;                                    1490
*                                                                  1490
         STH   @05,STRGCTR                                         1490
*          IF STRGCTR <= SRTRSABK                                  1491
*            THEN                                                  1491
         C     @05,SRTRSABK                                        1491
         BH    @RF01491                                            1491
*              MERGEND = ON;                                       1492
*                                                                  1492
         OI    MERGEND,B'10000000'                                 1492
*          /**********************************************************/
*          /*                                                        */
*          /* THE FIRST IOCSTR IS ALWAYS FOR INPUT AND THE SECOND    */
*          /* ALWAYS FOR OUTPUT. ON ALL BUT THE FIRST PASS, EXCHANGE */
*          /* THEM.  ON THE FIRST PASS THEY ARE ALREADY SET          */
*          /* CORRECTLY.  SET UP IOCSTR FOR OUTPUT AND STARTING      */
*          /* INPUT RBA.                                             */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1493
*          IF MERGSTRT = OFF                                       1493
*            THEN                                                  1493
@RF01491 TM    MERGSTRT,B'01000000'                                1493
         BNZ   @RF01493                                            1493
*              DO;                                                 1494
*                                                                  1494
*              IOCSHOLD = MRIOCSSR(1);                             1495
         L     @05,@PC00016+4                                      1495
         L     IOCSHOLD,MRIOCSSR(,@05)                             1495
*              MRIOCSSR(1) = MRIOCSSR(2);                          1496
         L     @03,MRIOCSSR+4(,@05)                                1496
         ST    @03,MRIOCSSR(,@05)                                  1496
*              MRIOCSSR(2) = IOCSHOLD;                             1497
*                                                                  1497
         ST    IOCSHOLD,MRIOCSSR+4(,@05)                           1497
*              END;                                                1498
*                                                                  1498
*          RBAHOLD = 0;                                            1499
*                                                                  1499
@RF01493 SLR   @05,@05                                             1499
         ST    @05,RBAHOLD                                         1499
*          IOCSPTR = MRIOCSSR(2);                                  1500
         L     @15,@PC00016+4                                      1500
         L     IOCSPTR,MRIOCSSR+4(,@15)                            1500
*          IOCRBA  = 0;                                            1501
         ST    @05,IOCRBA(,IOCSPTR)                                1501
*          IOCDLN  = BLKSIZE;                                      1502
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1502
*          IOCWORK = SRTBUFPT;                                     1503
         L     @03,SRTBUFPT                                        1503
         ST    @03,IOCWORK(,IOCSPTR)                               1503
*          IOCDAD  = 0;                                            1504
         ST    @05,IOCDAD(,IOCSPTR)                                1504
*          OUTBUFPT = SRTBUFPT;                                    1505
         ST    @03,OUTBUFPT                                        1505
*          OUTBUFCT = 0;                                           1506
         STH   @05,OUTBUFCT                                        1506
*          OUTBUFST = 1;                                           1507
         MVC   OUTBUFST(2),@CH00220                                1507
*          OUTBUFEN = SRTRECSZ;                                    1508
*                                                                  1508
         LH    @15,SRTRECSZ                                        1508
         STH   @15,OUTBUFEN                                        1508
*          /**********************************************************/
*          /*                                                        */
*          /* CALCULATE THE FACTORS WHICH WILL DETERMINE WHEN THE    */
*          /* END OF A STRING HAS BEEN REACHED.  THESE FACTORS FOR   */
*          /* THE LAST INPUT STRING WILL BE DIFFERENT THAN FOR ALL   */
*          /* OTHER STRINGS                                          */
*          /*                                                        */
*          /*   . ALL BUT LAST STRING                                */
*          /*       RSA BLOCK CAPACITY ON FIRST PASS OR NUMBER OF    */
*          /*       RECORDS IN ALL BUT LAST STRING (SAVED IN         */
*          /*       SRTRCNLO ON PREVIOUS PASS) DIVIDED BY NUMBER OF  */
*          /*       RECORDS PER BLOCK                                */
*          /*                                                        */
*          /*   . LAST STRING                                        */
*          /*       NUMBER OF RECORDS IN RSA ON FIRST PASS OR NUMBER */
*          /*       OF RECORDS IN LAST STRING (SAVED IN SRTRCLSO ON  */
*          /*       PREVIOUS PASS) DIVIDED BY NUMBER OF RECORDS PER  */
*          /*       BLOCK                                            */
*          /*                                                        */
*          /*   DIVIDEND + 1 = LAST BLOCK NUMBER                     */
*          /*   REMAINDER = LAST RECORD NUMBER                       */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1509
*          IF MERGSTRT = ON                                        1509
*            THEN                                                  1509
         TM    MERGSTRT,B'01000000'                                1509
         BNO   @RF01509                                            1509
*              DO;                                                 1510
*                                                                  1510
*              SRTRCNLO = SRTRSACP;                                1511
*                                                                  1511
         L     @15,SRTRSACP                                        1511
         ST    @15,SRTRCNLO                                        1511
*              IF SRTRSACT ^= 0                                    1512
*                THEN                                              1512
         L     @15,SRTRSACT                                        1512
         CR    @15,@05                                             1512
         BE    @RF01512                                            1512
*                  SRTRCLSO = SRTRSACT;                            1513
*                                                                  1513
         ST    @15,SRTRCLSO                                        1513
*                ELSE                                              1514
*                  SRTRCLSO = SRTRSACP;                            1514
*                                                                  1514
         B     @RC01512                                            1514
@RF01512 L     @05,SRTRSACP                                        1514
         ST    @05,SRTRCLSO                                        1514
*              END;                                                1515
*                                                                  1515
@RC01512 DS    0H                                                  1516
*          MRNLBLK = SRTRCNLO / SRTRECBK;                          1516
*                                                                  1516
@RF01509 L     @05,SRTRCNLO                                        1516
         LH    @15,SRTRECBK                                        1516
         LR    @00,@05                                             1516
         SRDA  @00,32                                              1516
         DR    @00,@15                                             1516
         STH   @01,MRNLBLK                                         1516
*          MRNLREC = SRTRCNLO // SRTRECBK;                         1517
*                                                                  1517
         LR    @02,@05                                             1517
         SRDA  @02,32                                              1517
         DR    @02,@15                                             1517
         STH   @02,MRNLREC                                         1517
*          IF MRNLREC ^= 0                                         1518
*            THEN                                                  1518
         LTR   @02,@02                                             1518
         BZ    @RF01518                                            1518
*              MRNLBLK = MRNLBLK + 1;                              1519
*                                                                  1519
         LA    @01,1(,@01)                                         1519
         STH   @01,MRNLBLK                                         1519
*            ELSE                                                  1520
*              MRNLREC = SRTRECBK;                                 1520
*                                                                  1520
         B     @RC01518                                            1520
@RF01518 LH    @05,SRTRECBK                                        1520
         STH   @05,MRNLREC                                         1520
*          MRLBLK = SRTRCLSO / SRTRECBK;                           1521
*                                                                  1521
@RC01518 L     @05,SRTRCLSO                                        1521
         LH    @15,SRTRECBK                                        1521
         LR    @00,@05                                             1521
         SRDA  @00,32                                              1521
         DR    @00,@15                                             1521
         STH   @01,MRLBLK                                          1521
*          MRLREC = SRTRCLSO // SRTRECBK;                          1522
*                                                                  1522
         LR    @02,@05                                             1522
         SRDA  @02,32                                              1522
         DR    @02,@15                                             1522
         STH   @02,MRLREC                                          1522
*          IF MRLREC ^= 0                                          1523
*            THEN                                                  1523
         LTR   @02,@02                                             1523
         BZ    @RF01523                                            1523
*              MRLBLK = MRLBLK + 1;                                1524
*                                                                  1524
         LA    @01,1(,@01)                                         1524
         STH   @01,MRLBLK                                          1524
*            ELSE                                                  1525
*              MRLREC = SRTRECBK;                                  1525
         B     @RC01523                                            1525
@RF01523 LH    @05,SRTRECBK                                        1525
         STH   @05,MRLREC                                          1525
*          /**********************************************************/
*          /*                                                        */
*          /* THIS IS THE MAIN LOOP FOR ONE MERGE PASS.  THIS LOOP   */
*          /* IS PERFORMED UNTIL ALL INPUT STRINGS HAVE BEEN READ    */
*          /* AND PROCESSED.  PERFORM INITIALIZATION.  RESET         */
*          /* COUNTERS AND SET UP INPUT IOCSTR.                      */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1526
*STRGLP:   DO WHILE STRGCTR > 0;                                   1526
*                                                                  1526
@RC01523 DS    0H                                                  1526
STRGLP   B     @DE01526                                            1526
@DL01526 DS    0H                                                  1527
*            SRTRCLSO = 0;                                         1527
         SLR   @07,@07                                             1527
         ST    @07,SRTRCLSO                                        1527
*            TSIZE    = 0;                                         1528
*                                                                  1528
         SLR   TSIZE,TSIZE                                         1528
*            IOCSPTR = MRIOCSSR(1);                                1529
*                                                                  1529
         L     @07,@PC00016+4                                      1529
         L     IOCSPTR,MRIOCSSR(,@07)                              1529
*            IOCRBA  = RBAHOLD;                                    1530
         L     @07,RBAHOLD                                         1530
         ST    @07,IOCRBA(,IOCSPTR)                                1530
*            IOCDLN  = BLKSIZE;                                    1531
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1531
*            IOCWORK = SRTRSAPT;                                   1532
         L     @07,SRTRSAPT                                        1532
         ST    @07,IOCWORK(,IOCSPTR)                               1532
*            INBUFPT = SRTRSAPT;                                   1533
*                                                                  1533
         LR    INBUFPT,@07                                         1533
*            /********************************************************/
*            /*                                                      */
*            /* SET UP THE FIRST AND LAST STRING END CONTROL         */
*            /* FACTORS FOR THIS SET OF STRINGS                      */
*            /*                                                      */
*            /********************************************************/
*                                                                  1534
*            IF STRGCTR > SRTRSABK                                 1534
*              THEN                                                1534
         L     @07,SRTRSABK                                        1534
         CH    @07,STRGCTR                                         1534
         BNL   @RF01534                                            1534
*                DO;                                               1535
*                                                                  1535
*                STRGLIM = SRTRSABK;                               1536
         STH   @07,STRGLIM                                         1536
*                STRNLAST = MRNLAST;                               1537
         L     @07,MRNLAST                                         1537
         ST    @07,STRNLAST                                        1537
*                STRLAST  = MRNLAST;                               1538
*                                                                  1538
         ST    @07,STRLAST                                         1538
*                END;                                              1539
*                                                                  1539
*              ELSE                                                1540
*                DO;                                               1540
*                                                                  1540
         B     @RC01534                                            1540
@RF01534 DS    0H                                                  1541
*                STRGLIM = STRGCTR;                                1541
         LH    @07,STRGCTR                                         1541
         STH   @07,STRGLIM                                         1541
*                STRLAST = MRLAST;                                 1542
*                                                                  1542
         L     @03,MRLAST                                          1542
         ST    @03,STRLAST                                         1542
*                IF STRGLIM = 1                                    1543
*                  THEN                                            1543
         C     @07,@CF00220                                        1543
         BNE   @RF01543                                            1543
*                    STRNLAST = MRLAST;                            1544
*                                                                  1544
         ST    @03,STRNLAST                                        1544
*                  ELSE                                            1545
*                    STRNLAST = MRNLAST;                           1545
*                                                                  1545
         B     @RC01543                                            1545
@RF01543 L     @07,MRNLAST                                         1545
         ST    @07,STRNLAST                                        1545
*                END;                                              1546
*                                                                  1546
@RC01543 DS    0H                                                  1547
*            /********************************************************/
*            /*                                                      */
*            /* IN A LOOP, READ THE FIRST BLOCK OF EACH INPUT        */
*            /* STRING AND PLACE THE FIRST RECORD OF EACH STRING     */
*            /* IN THE SORT TREE                                     */
*            /*                                                      */
*            /********************************************************/
*                                                                  1547
*INITTREE:   DO M = 1 TO STRGLIM;                                  1547
*                                                                  1547
@RC01534 DS    0H                                                  1547
INITTREE LA    @07,1                                               1547
         B     @DE01547                                            1547
@DL01547 DS    0H                                                  1548
*              CALL IDCIOGT0 (GDTTBL,MRIOCSSR(1));                 1548
*                                                                  1548
         L     @07,@PC00001                                        1548
         ST    @07,@AL00001                                        1548
         L     @15,@PC00016+4                                      1548
         LA    @15,MRIOCSSR(,@15)                                  1548
         ST    @15,@AL00001+4                                      1548
         MVI   @AL00001+4,X'80'                                    1548
         L     @15,GDTGET(,@07)                                    1548
         LA    @01,@AL00001                                        1548
         BALR  @14,@15                                             1548
*              RESPECIFY RTNREG RSTD;                              1549
*              TESTRC = RTNREG;                                    1550
         LR    TESTRC,RTNREG                                       1550
*              RESPECIFY RTNREG UNRSTD;                            1551
*                                                                  1551
*              IF TESTRC ^= 0                                      1552
*                THEN                                              1552
         LTR   TESTRC,TESTRC                                       1552
         BZ    @RF01552                                            1552
*                  RETURN CODE(LASTCC08);                          1553
*                                                                  1553
         LA    @15,8                                               1553
         L     @14,@SA00016                                        1553
         LM    @00,@12,@SA00016+8                                  1553
         BR    @14                                                 1553
*              /******************************************************/
*              /*                                                    */
*              /* ADD THE FIRST RECORD FROM THE BLOCK JUST READ TO   */
*              /* THE TREE.  SEE COMMENTS ON TREEADD PROCEDURE       */
*              /* FOR DESCRIPTION OF THE TREE AND THE TREE ADD       */
*              /* PROCESS.  WHEN THE PROPER POINT IN THE TREE IS     */
*              /* FOUND, SET UP THE FACTORS IN THE TREE ARRAY        */
*              /* ELEMENT.                                           */
*              /*                                                    */
*              /******************************************************/
*                                                                  1554
*              TRECORD = INBUFPT;                                  1554
*                                                                  1554
@RF01552 ST    INBUFPT,TRECORD                                     1554
*              CALL TREEADD;                                       1555
*                                                                  1555
         BAL   @14,TREEADD                                         1555
*              MTPTR(TPREV)   = INBUFPT;                           1556
         LR    @07,TPREV                                           1556
         SLA   @07,4                                               1556
         LR    @01,TREEPTR                                         1556
         AL    @01,@CF01721                                        1556
         ST    INBUFPT,MTPTR-8(@07,@01)                            1556
*              MTSTGNO(TPREV) = M;                                 1557
         L     @15,M                                               1557
         LR    @14,TREEPTR                                         1557
         AL    @14,@CF01669                                        1557
         STH   @15,MTSTGNO(@07,@14)                                1557
*              MTBLKNO(TPREV) = 1;                                 1558
         LA    @14,1                                               1558
         LR    @01,TREEPTR                                         1558
         AL    @01,@CF01722                                        1558
         STH   @14,MTBLKNO-4(@07,@01)                              1558
*              MTRECNO(TPREV) = 1;                                 1559
         LR    @01,TREEPTR                                         1559
         AL    @01,@CF01723                                        1559
         STH   @14,MTRECNO-6(@07,@01)                              1559
*              MTRBA(TPREV)   = IOCRBA;                            1560
*                                                                  1560
         L     @14,IOCRBA(,IOCSPTR)                                1560
         AL    @07,@CF01678                                        1560
         ST    @14,MTRBA-12(@07,TREEPTR)                           1560
*              /******************************************************/
*              /*                                                    */
*              /* INCREMENT RBA TO FIRST RECORD OF NEXT STRING.      */
*              /* POINT TO NEXT INPUT BUFFER.                        */
*              /*                                                    */
*              /******************************************************/
*                                                                  1561
*              IOCRBA = IOCRBA + (BLKSIZE * STRNLBLK);             1561
         LH    @07,STRNLBLK                                        1561
         SLA   @07,11                                              1561
         ALR   @14,@07                                             1561
         ST    @14,IOCRBA(,IOCSPTR)                                1561
*              IOCWORK = IOCWORK + BLKSIZE;                        1562
         LA    @07,2048                                            1562
         AL    @07,IOCWORK(,IOCSPTR)                               1562
         ST    @07,IOCWORK(,IOCSPTR)                               1562
*              INBUFPT = IOCWORK;                                  1563
*                                                                  1563
         LR    INBUFPT,@07                                         1563
*            END INITTREE;                                         1564
*                                                                  1564
         AL    @15,@CF00220                                        1564
         LR    @07,@15                                             1564
@DE01547 ST    @07,M                                               1564
         CH    @07,STRGLIM                                         1564
         BNH   @DL01547                                            1564
*            IF GDTDBG = NULLPTR                                   1565
*              THEN;                                               1565
         L     @15,@PC00001                                        1565
         L     @15,GDTDBG(,@15)                                    1565
         LTR   @15,@15                                             1565
         BZ    @RT01565                                            1565
*              ELSE                                                1567
*                CALL IDCDB010 (GDTTBL,'BIM3');                    1567
         L     @15,@PC00001                                        1567
         ST    @15,@AL00001                                        1567
         LA    @14,@CC01620                                        1567
         ST    @14,@AL00001+4                                      1567
         MVI   @AL00001+4,X'80'                                    1567
         L     @15,GDTDBG(,@15)                                    1567
         LA    @01,@AL00001                                        1567
         BALR  @14,@15                                             1567
*            /********************************************************/
*            /*                                                      */
*            /* THIS IS THE MAIN PROCESSING LOOP.  THE RECORD AT     */
*            /* THE TOP OF THE TREE (LOWEST IN VALUE) IS OUTPUT,     */
*            /* THE TREE UPDATED AND THE NEXT RECORD EITHER ADDED    */
*            /* TO THE TREE OR OUTPUT IF IT IS LOWER THAN THE        */
*            /* CURRENT TOP.                                         */
*            /*                                                      */
*            /* CALCULATE THE LOCATION OF THE RECORD AT THE TOP      */
*            /* OF THE TREE                                          */
*            /*                                                      */
*            /********************************************************/
*                                                                  1568
*TREELP:     DO WHILE TSIZE ^= 0;                                  1568
*                                                                  1568
@RT01565 DS    0H                                                  1568
TREELP   B     @DE01568                                            1568
@DL01568 DS    0H                                                  1569
*              TRECORD = SRTRSAPT + ((MTSTGNO(1) - 1) * BLKSIZE) + 1569
*                                   ((MTRECNO(1) - 1) * SRTRECSZ); 1569
*                                                                  1569
         LH    @15,MTSTGNO(,TREEPTR)                               1569
         BCTR  @15,0                                               1569
         SLA   @15,11                                              1569
         AL    @15,SRTRSAPT                                        1569
         LH    @01,MTRECNO(,TREEPTR)                               1569
         BCTR  @01,0                                               1569
         MH    @01,SRTRECSZ                                        1569
         ALR   @15,@01                                             1569
         ST    @15,TRECORD                                         1569
*              /******************************************************/
*              /*                                                    */
*              /* MOVE THE LOCATION OF THE RECORD JUST OUTPUT TO     */
*              /* THE NEXT RECORD HOLD AREA.  THE NEXT RECORD TO     */
*              /* BE ADDED TO THE TREE IS ALWAYS THE RECORD FOLLOW-  */
*              /* ING THE ONE WHICH WAS LAST OUTPUT.                 */
*              /*                                                    */
*              /******************************************************/
*                                                                  1570
*              NEXTREC = MERGTREE(1);                              1570
*                                                                  1570
         MVC   NEXTREC(16),MERGTREE(TREEPTR)                       1570
*              /******************************************************/
*              /*                                                    */
*              /* OUTPUT THE RECORD EITHER TO BLDPROC OR TO THE      */
*              /* OUTPUT BUFFER                                      */
*              /*                                                    */
*              /******************************************************/
*                                                                  1571
*              CALL RECOUT;                                        1571
*                                                                  1571
         BAL   @14,RECOUT                                          1571
*              RESPECIFY RTNREG RSTD;                              1572
*              TESTRC = RTNREG;                                    1573
         LR    TESTRC,RTNREG                                       1573
*              RESPECIFY RTNREG UNRSTD;                            1574
*                                                                  1574
*              IF TESTRC ^= 0                                      1575
*                THEN                                              1575
         LTR   TESTRC,TESTRC                                       1575
         BZ    @RF01575                                            1575
*                  RETURN CODE(LASTCC08);                          1576
*                                                                  1576
         LA    @15,8                                               1576
         L     @14,@SA00016                                        1576
         LM    @00,@12,@SA00016+8                                  1576
         BR    @14                                                 1576
*              /******************************************************/
*              /*                                                    */
*              /* REDUCE THE SIZE OF THE TREE BY 1 FOR THE RECORD    */
*              /* JUST OUTPUT.  IF THIS CAUSES THE TREE SIZE TO      */
*              /* REACH ZERO, THERE IS ONLY ONE INPUT STRING LEFT.   */
*              /* POINT THE TOP OF THE TREE TO A RECORD OF ALL FF'S. */
*              /* THIS WILL FORCE ALL REMAINING RECORDS IN THE       */
*              /* INPUT STRING TO BE OUTPUT IN THE 'NEXTLP' PROCESS  */
*              /* SINCE THEY WILL BE LOWER THAN THE TOP.             */
*              /*                                                    */
*              /******************************************************/
*                                                                  1577
*              TSIZE = TSIZE - 1;                                  1577
*                                                                  1577
@RF01575 BCTR  TSIZE,0                                             1577
*              IF TSIZE = 0                                        1578
*                THEN                                              1578
         LTR   TSIZE,TSIZE                                         1578
         BNZ   @RF01578                                            1578
*                  MTPTR(1) = ADDR(MAXKEY);                        1579
*                                                                  1579
         LA    @15,MAXKEY                                          1579
         ST    @15,MTPTR(,TREEPTR)                                 1579
*                /****************************************************/
*                /*                                                  */
*                /* THE SIZE OF THE TREE HAS NOT REACHED ZERO.       */
*                /* UPDATE THE TREE BY CAUSING THE LOWEST KEY TO     */
*                /* BE MOVED TO THE TOP.  THIS IS ACCOMPLISHED BY    */
*                /* ESTABLISHING A PARENT-CHILD RELATIONSHIP AT THE  */
*                /* EMPTY SLOT AT THE TOP, MOVING UP THE LOWEST      */
*                /* CHILD, ESTABLISHING A NEW PARENT-CHILD AT THE    */
*                /* SLOT JUST VACATED AND REPEATING THE PROCESS      */
*                /* UNTIL THE TREE SIZE IS EXCEEDED.                 */
*                /*                                                  */
*                /****************************************************/
*                                                                  1580
*                ELSE                                              1580
*TREEUPLP:         DO;                                             1580
*                                                                  1580
         B     @RC01578                                            1580
@RF01578 DS    0H                                                  1580
TREEUPLP DS    0H                                                  1581
*                  TPREV = 1;                                      1581
         LA    TPREV,1                                             1581
*                  TCURR = 2;                                      1582
         LA    TCURR,2                                             1582
*                  TREC1 = TCURR;                                  1583
*                                                                  1583
         STH   TCURR,TREC1                                         1583
*                  IF SRTRECSZ <= MVCMLIM                          1584
*                    THEN                                          1584
         LH    @15,SRTRECSZ                                        1584
         C     @15,@CF00925                                        1584
         BH    @RF01584                                            1584
*                      DO WHILE TCURR <= TSIZE;                    1585
*                                                                  1585
         B     @DE01585                                            1585
@DL01585 DS    0H                                                  1586
*                      IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >   1586
*                         MTPTR(TCURR + 1) -> MRSRTREC(1:SRTRECSZ) 1586
*                        THEN                                      1586
         LR    @15,TCURR                                           1586
         SLA   @15,4                                               1586
         LR    @14,TREEPTR                                         1586
         AL    @14,@CF01721                                        1586
         L     @01,MTPTR-8(@15,@14)                                1586
         L     @15,MTPTR(@15,TREEPTR)                              1586
         LH    @14,SRTRECSZ                                        1586
         BCTR  @14,0                                               1586
         EX    @14,@SC01724                                        1586
         BNH   @RF01586                                            1586
*                          TCURR = TCURR + 1;                      1587
*                                                                  1587
         AL    TCURR,@CF00220                                      1587
*                      TREC1 = TCURR;                              1588
*                                                                  1588
@RF01586 STH   TCURR,TREC1                                         1588
*                      MERGTREE(TPREV) = MERGTREE(TCURR);          1589
*                                                                  1589
         LR    @15,TPREV                                           1589
         SLA   @15,4                                               1589
         ALR   @15,TREEPTR                                         1589
         AL    @15,@CF01669                                        1589
         LR    @14,TCURR                                           1589
         SLA   @14,4                                               1589
         ALR   @14,TREEPTR                                         1589
         AL    @14,@CF01669                                        1589
         MVC   @TS00001(16),MERGTREE(@14)                          1589
         MVC   MERGTREE(16,@15),@TS00001                           1589
*                      TPREV = TCURR;                              1590
         LR    TPREV,TCURR                                         1590
*                      TCURR = TPREV * 2;                          1591
*                                                                  1591
         LR    TCURR,TPREV                                         1591
         ALR   TCURR,TCURR                                         1591
*                      END;                                        1592
*                                                                  1592
@DE01585 CR    TCURR,TSIZE                                         1592
         BNH   @DL01585                                            1592
*                    ELSE                                          1593
*                      DO WHILE TCURR <= TSIZE;                    1593
*                                                                  1593
         B     @RC01584                                            1593
@RF01584 B     @DE01593                                            1593
@DL01593 DS    0H                                                  1594
*                      IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >   1594
*                          MTPTR(TCURR + 1) -> MRSRTREC(1:MVCMLIM)) 
*                                                                  1594
*                         (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =   1594
*                          MTPTR(TCURR + 1) -> MRSRTREC(1:MVCMLIM) &
*                          MTPTR(TCURR) ->                         1594
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1594
*                          MTPTR(TCURR + 1) ->                     1594
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ))   1594
*                        THEN                                      1594
         LR    @15,TCURR                                           1594
         SLA   @15,4                                               1594
         LR    @14,TREEPTR                                         1594
         AL    @14,@CF01721                                        1594
         L     @14,MTPTR-8(@15,@14)                                1594
         L     @15,MTPTR(@15,TREEPTR)                              1594
         CLC   MRSRTREC(256,@14),MRSRTREC(@15)                     1594
         BH    @RT01594                                            1594
         CLC   MRSRTREC(256,@14),MRSRTREC(@15)                     1594
         BNE   @RF01594                                            1594
         LH    @07,SRTRECSZ                                        1594
         SL    @07,@CF01651                                        1594
         EX    @07,@SC01726                                        1594
         BNH   @RF01594                                            1594
@RT01594 DS    0H                                                  1595
*                          TCURR = TCURR + 1;                      1595
*                                                                  1595
         AL    TCURR,@CF00220                                      1595
*                      TREC1 = TCURR;                              1596
*                                                                  1596
@RF01594 STH   TCURR,TREC1                                         1596
*                      MERGTREE(TPREV) = MERGTREE(TCURR);          1597
*                                                                  1597
         LR    @15,TPREV                                           1597
         SLA   @15,4                                               1597
         ALR   @15,TREEPTR                                         1597
         AL    @15,@CF01669                                        1597
         LR    @14,TCURR                                           1597
         SLA   @14,4                                               1597
         ALR   @14,TREEPTR                                         1597
         AL    @14,@CF01669                                        1597
         MVC   @TS00001(16),MERGTREE(@14)                          1597
         MVC   MERGTREE(16,@15),@TS00001                           1597
*                      TPREV = TCURR;                              1598
         LR    TPREV,TCURR                                         1598
*                      TCURR = TPREV * 2;                          1599
*                                                                  1599
         LR    TCURR,TPREV                                         1599
         ALR   TCURR,TCURR                                         1599
*                      END;                                        1600
*                                                                  1600
@DE01593 CR    TCURR,TSIZE                                         1600
         BNH   @DL01593                                            1600
*                  /**************************************************/
*                  /*                                                */
*                  /* THE RECORD WHICH WAS PREVIOUSLY AT THE BOTTOM  */
*                  /* OF THE TREE BEFORE THE TREE WAS REDUCED IN     */
*                  /* SIZE IS MOVED INTO THE UPDATED TREE.  IF THIS  */
*                  /* RECORD IS LOWER THAN THE LAST CHILD MOVED UP   */
*                  /* IN THE LOOP JUST COMPLETED, WE MUST GO BACK    */
*                  /* UP THE TREE TO FIND THE PROPER SLOT.           */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1601
*                  TREC2   = TSIZE + 1;                            1601
@RC01584 LA    TREC2,1                                             1601
         ALR   TREC2,TSIZE                                         1601
*                  MERGUPD = OFF;                                  1602
*                                                                  1602
         NI    MERGUPD,B'11101111'                                 1602
*                  IF SRTRECSZ <= MVCMLIM                          1603
*                    THEN                                          1603
*                                                                  1603
         LH    @07,SRTRECSZ                                        1603
         C     @07,@CF00925                                        1603
         BH    @RF01603                                            1603
*                      IF MTPTR(TREC1) -> MRSRTREC(1:SRTRECSZ) >   1604
*                         MTPTR(TREC2) -> MRSRTREC(1:SRTRECSZ)     1604
*                        THEN                                      1604
         LH    @02,TREC1                                           1604
         SLA   @02,4                                               1604
         AL    @02,@CF01721                                        1604
         L     @02,MTPTR-8(@02,TREEPTR)                            1604
         LR    @15,TREC2                                           1604
         SLA   @15,4                                               1604
         AL    @15,@CF01721                                        1604
         L     @01,MTPTR-8(@15,TREEPTR)                            1604
         BCTR  @07,0                                               1604
         EX    @07,@SC01728                                        1604
         BNH   @RF01604                                            1604
*                          MERGUPD = ON;                           1605
*                                                                  1605
         OI    MERGUPD,B'00010000'                                 1605
*                        ELSE;                                     1606
*                                                                  1606
@RF01604 DS    0H                                                  1607
*                    ELSE                                          1607
*                      IF (MTPTR(TREC1) -> MRSRTREC(1:MVCMLIM) >   1607
*                          MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM))   
*                                                                  1607
*                         (MTPTR(TREC1) -> MRSRTREC(1:MVCMLIM) =   1607
*                          MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM) &   1607
*                          MTPTR(TREC1) ->                         1607
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1607
*                          MTPTR(TREC2) ->                         1607
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ))   1607
*                        THEN                                      1607
         B     @RC01603                                            1607
@RF01603 LH    @07,TREC1                                           1607
         SLA   @07,4                                               1607
         AL    @07,@CF01721                                        1607
         L     @07,MTPTR-8(@07,TREEPTR)                            1607
         LR    @02,TREC2                                           1607
         SLA   @02,4                                               1607
         AL    @02,@CF01721                                        1607
         L     @02,MTPTR-8(@02,TREEPTR)                            1607
         CLC   MRSRTREC(256,@07),MRSRTREC(@02)                     1607
         BH    @RT01607                                            1607
         CLC   MRSRTREC(256,@07),MRSRTREC(@02)                     1607
         BNE   @RF01607                                            1607
         LH    @15,SRTRECSZ                                        1607
         SL    @15,@CF01651                                        1607
         EX    @15,@SC01730                                        1607
         BNH   @RF01607                                            1607
@RT01607 DS    0H                                                  1608
*                          MERGUPD = ON;                           1608
*                                                                  1608
         OI    MERGUPD,B'00010000'                                 1608
*                        ELSE;                                     1609
*                                                                  1609
@RF01607 DS    0H                                                  1610
*                  IF MERGUPD = ON                                 1610
*                    THEN                                          1610
@RC01603 TM    MERGUPD,B'00010000'                                 1610
         BNO   @RF01610                                            1610
*                      DO;                                         1611
*                                                                  1611
*                      /**********************************************/
*                      /*                                            */
*                      /* CALCULATE THE LOCATION OF THE LAST CHILD   */
*                      /* MOVED UP IN THE LOOP JUST COMPLETED AND    */
*                      /* MOVE IT BACK TO ITS PREVIOUS SLOT          */
*                      /*                                            */
*                      /**********************************************/
*                                                                  1612
*                      TCURR = TPREV;                              1612
         LR    TCURR,TPREV                                         1612
*                      TPREV = TCURR / 2;                          1613
*                                                                  1613
         LA    @07,2                                               1613
         LR    @00,TCURR                                           1613
         SRDA  @00,32                                              1613
         DR    @00,@07                                             1613
         LR    TPREV,@01                                           1613
*                      MERGTREE(TCURR) = MERGTREE(TPREV);          1614
*                                                                  1614
         LR    @15,TCURR                                           1614
         SLA   @15,4                                               1614
         ALR   @15,TREEPTR                                         1614
         AL    @15,@CF01669                                        1614
         LR    @14,TPREV                                           1614
         SLA   @14,4                                               1614
         ALR   @14,TREEPTR                                         1614
         AL    @14,@CF01669                                        1614
         MVC   @TS00001(16),MERGTREE(@14)                          1614
         MVC   MERGTREE(16,@15),@TS00001                           1614
*                      TCURR = TPREV / 2;                          1615
*                                                                  1615
         LR    @00,TPREV                                           1615
         SRDA  @00,32                                              1615
         DR    @00,@07                                             1615
         LR    TCURR,@01                                           1615
*                      /**********************************************/
*                      /*                                            */
*                      /* GO BACK UP THE TREE LOOKING FOR A PARENT   */
*                      /* WHICH IS LOWER THAN THE RECORD AT THE      */
*                      /* BOTTOM OF THE TREE.  WHEN WE FIND IT, SET  */
*                      /* TCURR TO ZERO TO FORCE EXIT FROM LOOP.     */
*                      /* IF TCURR REACHES ZERO IN THE NORMAL        */
*                      /* PROCESS, THE RECORD AT THE BOTTOM GOES     */
*                      /* IN THE TOP SLOT.                           */
*                      /*                                            */
*                      /**********************************************/
*                                                                  1616
*                      IF SRTRECSZ <= MVCMLIM                      1616
*                        THEN                                      1616
         LH    @07,SRTRECSZ                                        1616
         C     @07,@CF00925                                        1616
         BH    @RF01616                                            1616
*                          DO WHILE TCURR > 0;                     1617
*                                                                  1617
         B     @DE01617                                            1617
@DL01617 DS    0H                                                  1618
*                          IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >
*                             MTPTR(TREC2) -> MRSRTREC(1:SRTRECSZ) 1618
*                            THEN                                  1618
         LR    @07,TCURR                                           1618
         SLA   @07,4                                               1618
         LR    @01,TREEPTR                                         1618
         AL    @01,@CF01721                                        1618
         L     @01,MTPTR-8(@07,@01)                                1618
         LR    @15,TREC2                                           1618
         SLA   @15,4                                               1618
         AL    @15,@CF01721                                        1618
         L     @15,MTPTR-8(@15,TREEPTR)                            1618
         LH    @14,SRTRECSZ                                        1618
         BCTR  @14,0                                               1618
         EX    @14,@SC01724                                        1618
         BNH   @RF01618                                            1618
*                              DO;                                 1619
*                                                                  1619
*                              MERGTREE(TPREV) = MERGTREE(TCURR);  1620
*                                                                  1620
         LR    @15,TPREV                                           1620
         SLA   @15,4                                               1620
         ALR   @15,TREEPTR                                         1620
         AL    @15,@CF01669                                        1620
         ALR   @07,TREEPTR                                         1620
         AL    @07,@CF01669                                        1620
         MVC   @TS00001(16),MERGTREE(@07)                          1620
         MVC   MERGTREE(16,@15),@TS00001                           1620
*                              TPREV = TCURR;                      1621
         LR    TPREV,TCURR                                         1621
*                              TCURR = TPREV / 2;                  1622
*                                                                  1622
         LR    @00,TPREV                                           1622
         SRDA  @00,32                                              1622
         D     @00,@CF00154                                        1622
         LR    TCURR,@01                                           1622
*                              END;                                1623
*                                                                  1623
*                            ELSE                                  1624
*                              TCURR = 0;                          1624
*                                                                  1624
         B     @RC01618                                            1624
@RF01618 SLR   TCURR,TCURR                                         1624
*                          END;                                    1625
*                                                                  1625
@RC01618 DS    0H                                                  1625
@DE01617 LTR   TCURR,TCURR                                         1625
         BP    @DL01617                                            1625
*                        ELSE                                      1626
*                          DO WHILE TCURR > 0;                     1626
*                                                                  1626
         B     @RC01616                                            1626
@RF01616 B     @DE01626                                            1626
@DL01626 DS    0H                                                  1627
*                          IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >
*                              MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM))  
*                                                                  1627
*                             (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =
*                              MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM) &
*                              MTPTR(TCURR) ->                     1627
*                                    MRSRTREC(MVCMLIM + 1:SRTRECSZ) >
*                              MTPTR(TREC2) ->                     1627
*                                    MRSRTREC(MVCMLIM + 1:SRTRECSZ))
*                            THEN                                  1627
         LR    @07,TCURR                                           1627
         SLA   @07,4                                               1627
         AL    @07,@CF01721                                        1627
         L     @07,MTPTR-8(@07,TREEPTR)                            1627
         LR    @15,TREC2                                           1627
         SLA   @15,4                                               1627
         AL    @15,@CF01721                                        1627
         L     @15,MTPTR-8(@15,TREEPTR)                            1627
         CLC   MRSRTREC(256,@07),MRSRTREC(@15)                     1627
         BH    @RT01627                                            1627
         CLC   MRSRTREC(256,@07),MRSRTREC(@15)                     1627
         BNE   @RF01627                                            1627
         LH    @14,SRTRECSZ                                        1627
         SL    @14,@CF01651                                        1627
         EX    @14,@SC01732                                        1627
         BNH   @RF01627                                            1627
@RT01627 DS    0H                                                  1628
*                              DO;                                 1628
*                                                                  1628
*                              MERGTREE(TPREV) = MERGTREE(TCURR);  1629
*                                                                  1629
         LR    @07,TPREV                                           1629
         SLA   @07,4                                               1629
         ALR   @07,TREEPTR                                         1629
         AL    @07,@CF01669                                        1629
         LR    @15,TCURR                                           1629
         SLA   @15,4                                               1629
         ALR   @15,TREEPTR                                         1629
         AL    @15,@CF01669                                        1629
         MVC   @TS00001(16),MERGTREE(@15)                          1629
         MVC   MERGTREE(16,@07),@TS00001                           1629
*                              TPREV = TCURR;                      1630
         LR    TPREV,TCURR                                         1630
*                              TCURR = TPREV / 2;                  1631
*                                                                  1631
         LR    @00,TPREV                                           1631
         SRDA  @00,32                                              1631
         D     @00,@CF00154                                        1631
         LR    TCURR,@01                                           1631
*                              END;                                1632
*                                                                  1632
*                            ELSE                                  1633
*                              TCURR = 0;                          1633
*                                                                  1633
         B     @RC01627                                            1633
@RF01627 SLR   TCURR,TCURR                                         1633
*                          END;                                    1634
*                                                                  1634
@RC01627 DS    0H                                                  1634
@DE01626 LTR   TCURR,TCURR                                         1634
         BP    @DL01626                                            1634
*                      END;                                        1635
*                                                                  1635
@RC01616 DS    0H                                                  1636
*                  /**************************************************/
*                  /*                                                */
*                  /* TPREV IS NOW POINTING TO THE EMPTY SLOT WHERE  */
*                  /* THE RECORD THAT WAS PREVIOUSLY AT THE BOTTOM   */
*                  /* GOES.  MOVE IT IN.  THIS COMPLETES THE TREE    */
*                  /* UPDATE LOOP.                                   */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1636
*                  MERGTREE(TPREV) = MERGTREE(TREC2);              1636
*                                                                  1636
@RF01610 LR    @07,TPREV                                           1636
         SLA   @07,4                                               1636
         ALR   @07,TREEPTR                                         1636
         AL    @07,@CF01669                                        1636
         LR    @02,TREC2                                           1636
         SLA   @02,4                                               1636
         ALR   @02,TREEPTR                                         1636
         AL    @02,@CF01669                                        1636
         MVC   @TS00001(16),MERGTREE(@02)                          1636
         MVC   MERGTREE(16,@07),@TS00001                           1636
*                  END TREEUPLP;                                   1637
*              /******************************************************/
*              /*                                                    */
*              /* GET THE NEXT RECORD                                */
*              /*                                                    */
*              /******************************************************/
*                                                                  1638
*NEXTLP:       DO WHILE NXSTGNO ^= 0;                              1638
*                                                                  1638
@RC01578 DS    0H                                                  1638
NEXTLP   B     @DE01638                                            1638
@DL01638 DS    0H                                                  1639
*                IF NXRECNO = SRTRECBK                             1639
*                  THEN                                            1639
         CLC   NXRECNO(2),SRTRECBK                                 1639
         BNE   @RF01639                                            1639
*                    DO;                                           1640
*                                                                  1640
*                    IOCSPTR = MRIOCSSR(1);                        1641
         L     @15,@PC00016+4                                      1641
         L     IOCSPTR,MRIOCSSR(,@15)                              1641
*                    IOCRBA  = NXRBA + BLKSIZE;                    1642
         LA    @14,2048                                            1642
         AL    @14,NXRBA                                           1642
         ST    @14,IOCRBA(,IOCSPTR)                                1642
*                    IOCWORK = SRTRSAPT + ((NXSTGNO - 1) * BLKSIZE);
*                                                                  1643
         LH    @14,NXSTGNO                                         1643
         BCTR  @14,0                                               1643
         SLA   @14,11                                              1643
         AL    @14,SRTRSAPT                                        1643
         ST    @14,IOCWORK(,IOCSPTR)                               1643
*                    CALL IDCIOGT0 (GDTTBL,MRIOCSSR(1));           1644
*                                                                  1644
         L     @14,@PC00001                                        1644
         ST    @14,@AL00001                                        1644
         LA    @15,MRIOCSSR(,@15)                                  1644
         ST    @15,@AL00001+4                                      1644
         MVI   @AL00001+4,X'80'                                    1644
         L     @15,GDTGET(,@14)                                    1644
         LA    @01,@AL00001                                        1644
         BALR  @14,@15                                             1644
*                    RESPECIFY RTNREG RSTD;                        1645
*                    TESTRC = RTNREG;                              1646
         LR    TESTRC,RTNREG                                       1646
*                    RESPECIFY RTNREG UNRSTD;                      1647
*                                                                  1647
*                    IF TESTRC ^= 0                                1648
*                      THEN                                        1648
         LTR   TESTRC,TESTRC                                       1648
         BZ    @RF01648                                            1648
*                        RETURN CODE(LASTCC08);                    1649
*                                                                  1649
         LA    @15,8                                               1649
         L     @14,@SA00016                                        1649
         LM    @00,@12,@SA00016+8                                  1649
         BR    @14                                                 1649
*                    NXBLKNO = NXBLKNO + 1;                        1650
@RF01648 LA    @03,1                                               1650
         LH    @15,NXBLKNO                                         1650
         ALR   @15,@03                                             1650
         STH   @15,NXBLKNO                                         1650
*                    NXRECNO = 1;                                  1651
         STH   @03,NXRECNO                                         1651
*                    NXPTR   = IOCWORK;                            1652
         L     @03,IOCWORK(,IOCSPTR)                               1652
         ST    @03,NXPTR                                           1652
*                    NXRBA   = IOCRBA;                             1653
*                                                                  1653
         L     @03,IOCRBA(,IOCSPTR)                                1653
         ST    @03,NXRBA                                           1653
*                    END;                                          1654
*                                                                  1654
*                  ELSE                                            1655
*                    DO;                                           1655
*                                                                  1655
         B     @RC01639                                            1655
@RF01639 DS    0H                                                  1656
*                    NXRECNO = NXRECNO + 1;                        1656
         LH    @01,NXRECNO                                         1656
         LA    @01,1(,@01)                                         1656
         STH   @01,NXRECNO                                         1656
*                    NXPTR   = NXPTR + SRTRECSZ;                   1657
*                                                                  1657
         LH    @15,SRTRECSZ                                        1657
         AL    @15,NXPTR                                           1657
         ST    @15,NXPTR                                           1657
*                    END;                                          1658
*                                                                  1658
*                /****************************************************/
*                /*                                                  */
*                /* DETERMINE IF THE NEXT RECORD IS LOWER THAN THE   */
*                /* RECORD AT THE TOP OF THE TREE.                   */
*                /*                                                  */
*                /****************************************************/
*                                                                  1659
*                MERGOUT = OFF;                                    1659
*                                                                  1659
@RC01639 NI    MERGOUT,B'11011111'                                 1659
*                IF SRTRECSZ <= MVCMLIM                            1660
*                  THEN                                            1660
         LH    @15,SRTRECSZ                                        1660
         C     @15,@CF00925                                        1660
         BH    @RF01660                                            1660
*                    IF NXPTR -> MRSRTREC(1:SRTRECSZ) <=           1661
*                       MTPTR(1) -> MRSRTREC(1:SRTRECSZ)           1661
*                      THEN                                        1661
         L     @01,MTPTR(,TREEPTR)                                 1661
         BCTR  @15,0                                               1661
         L     @14,NXPTR                                           1661
         EX    @15,@SC01735                                        1661
         BH    @RF01661                                            1661
*                        MERGOUT = ON;                             1662
*                                                                  1662
         OI    MERGOUT,B'00100000'                                 1662
*                      ELSE;                                       1663
*                                                                  1663
@RF01661 DS    0H                                                  1664
*                  ELSE                                            1664
*                    IF (NXPTR -> MRSRTREC(1:MVCMLIM) <=           1664
*                        MTPTR(1) -> MRSRTREC(1:MVCMLIM))         1664
*                                                                  1664
*                       (NXPTR -> MRSRTREC(1:MVCMLIM) =            1664
*                        MTPTR(1) -> MRSRTREC(1:MVCMLIM) &         1664
*                        NXPTR -> MRSRTREC(MVCMLIM + 1:SRTRECSZ) <=
*                        MTPTR(1) -> MRSRTREC(MVCMLIM +1:SRTRECSZ))
*                      THEN                                        1664
         B     @RC01660                                            1664
@RF01660 L     @15,NXPTR                                           1664
         L     @14,MTPTR(,TREEPTR)                                 1664
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1664
         BNH   @RT01664                                            1664
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1664
         BNE   @RF01664                                            1664
         LH    @07,SRTRECSZ                                        1664
         SL    @07,@CF01651                                        1664
         EX    @07,@SC01737                                        1664
         BH    @RF01664                                            1664
@RT01664 DS    0H                                                  1665
*                        MERGOUT = ON;                             1665
*                                                                  1665
         OI    MERGOUT,B'00100000'                                 1665
*                      ELSE;                                       1666
*                                                                  1666
@RF01664 DS    0H                                                  1667
*                /****************************************************/
*                /*                                                  */
*                /* IF THE NEXT RECORD IS LOWER, OUTPUT IT           */
*                /*                                                  */
*                /****************************************************/
*                                                                  1667
*                IF MERGOUT = ON                                   1667
*                  THEN                                            1667
@RC01660 TM    MERGOUT,B'00100000'                                 1667
         BNO   @RF01667                                            1667
*                    DO;                                           1668
*                                                                  1668
*                    TRECORD = NXPTR;                              1669
*                                                                  1669
         L     @15,NXPTR                                           1669
         ST    @15,TRECORD                                         1669
*                    CALL RECOUT;                                  1670
*                                                                  1670
         BAL   @14,RECOUT                                          1670
*                    RESPECIFY RTNREG RSTD;                        1671
*                    TESTRC = RTNREG;                              1672
         LR    TESTRC,RTNREG                                       1672
*                    RESPECIFY RTNREG UNRSTD;                      1673
*                                                                  1673
*                    IF TESTRC ^= 0                                1674
*                      THEN                                        1674
         LTR   TESTRC,TESTRC                                       1674
         BZ    @RF01674                                            1674
*                        RETURN CODE(LASTCC08);                    1675
*                                                                  1675
         LA    @15,8                                               1675
         L     @14,@SA00016                                        1675
         LM    @00,@12,@SA00016+8                                  1675
         BR    @14                                                 1675
*                    END;                                          1676
*                                                                  1676
*                  /**************************************************/
*                  /*                                                */
*                  /* THE NEXT RECORD IS NOT LOWER THAN THE RECORD   */
*                  /* AT THE TOP OF THE TREE.  ADD IT TO THE TREE.   */
*                  /*                                                */
*                  /**************************************************/
*                                                                  1677
*                  ELSE                                            1677
*                    DO;                                           1677
*                                                                  1677
         B     @RC01667                                            1677
@RF01667 DS    0H                                                  1678
*                    TRECORD = NXPTR;                              1678
*                                                                  1678
         L     @02,NXPTR                                           1678
         ST    @02,TRECORD                                         1678
*                    CALL TREEADD;                                 1679
*                                                                  1679
         BAL   @14,TREEADD                                         1679
*                    MERGTREE(TPREV) = NEXTREC;                    1680
*                                                                  1680
         LR    @02,TPREV                                           1680
         SLA   @02,4                                               1680
         ALR   @02,TREEPTR                                         1680
         AL    @02,@CF01669                                        1680
         MVC   MERGTREE(16,@02),NEXTREC                            1680
*                    /************************************************/
*                    /*                                              */
*                    /* ZERO THE NEXT RECORD AREA TO FORCE EXIT      */
*                    /* FROM THE NEXT RECORD LOOP.                   */
*                    /*                                              */
*                    /************************************************/
*                                                                  1681
*                    NEXTREC = ''B;                                1681
*                                                                  1681
         XC    NEXTREC(16),NEXTREC                                 1681
*                    END;                                          1682
*                                                                  1682
*              END NEXTLP;                                         1683
*                                                                  1683
@RC01667 DS    0H                                                  1683
@DE01638 LH    @15,NXSTGNO                                         1683
         LTR   @15,@15                                             1683
         BNZ   @DL01638                                            1683
*            END TREELP;                                           1684
@DE01568 SLR   @15,@15                                             1684
         CR    TSIZE,@15                                           1684
         BNE   @DL01568                                            1684
*            /********************************************************/
*            /*                                                      */
*            /* FINAL PROCESSING FOR ONE SET OF INPUT STRINGS.  SET  */
*            /* UP FOR NEXT SET.  IF THERE IS A RECORD IN THE OUTPUT */
*            /* BUFFER, WRITE IT.                                    */
*            /*                                                      */
*            /********************************************************/
*                                                                  1685
*            IF OUTBUFCT ^= 0                                      1685
*              THEN                                                1685
         CH    @15,OUTBUFCT                                        1685
         BE    @RF01685                                            1685
*                DO;                                               1686
*                                                                  1686
*                CALL IDCIOPT0(GDTTBL,MRIOCSSR(2));                1687
*                                                                  1687
         L     @05,@PC00001                                        1687
         ST    @05,@AL00001                                        1687
         L     @02,@PC00016+4                                      1687
         LA    @02,MRIOCSSR+4(,@02)                                1687
         ST    @02,@AL00001+4                                      1687
         MVI   @AL00001+4,X'80'                                    1687
         L     @15,GDTPUT(,@05)                                    1687
         LA    @01,@AL00001                                        1687
         BALR  @14,@15                                             1687
*                RESPECIFY RTNREG RSTD;                            1688
*                TESTRC = RTNREG;                                  1689
         LR    TESTRC,RTNREG                                       1689
*                RESPECIFY RTNREG UNRSTD;                          1690
*                                                                  1690
*                IF TESTRC ^= 0                                    1691
*                  THEN                                            1691
         LTR   TESTRC,TESTRC                                       1691
         BZ    @RF01691                                            1691
*                    RETURN CODE(LASTCC08);                        1692
*                                                                  1692
         LA    @15,8                                               1692
         L     @14,@SA00016                                        1692
         LM    @00,@12,@SA00016+8                                  1692
         BR    @14                                                 1692
*                IOCSPTR  = MRIOCSSR(2);                           1693
@RF01691 L     @05,@PC00016+4                                      1693
         L     IOCSPTR,MRIOCSSR+4(,@05)                            1693
*                IOCDAD   = 0;                                     1694
         SLR   @05,@05                                             1694
         ST    @05,IOCDAD(,IOCSPTR)                                1694
*                OUTBUFCT = 0;                                     1695
         STH   @05,OUTBUFCT                                        1695
*                OUTBUFST = 1;                                     1696
         MVC   OUTBUFST(2),@CH00220                                1696
*                OUTBUFEN = SRTRECSZ;                              1697
*                                                                  1697
         LH    @05,SRTRECSZ                                        1697
         STH   @05,OUTBUFEN                                        1697
*                IF MERGSTRT = OFF                                 1698
*                  THEN                                            1698
         TM    MERGSTRT,B'01000000'                                1698
         BNZ   @RF01698                                            1698
*                    IOCRBA  = IOCRBA + BLKSIZE;                   1699
*                                                                  1699
         LA    @05,2048                                            1699
         AL    @05,IOCRBA(,IOCSPTR)                                1699
         ST    @05,IOCRBA(,IOCSPTR)                                1699
*                END;                                              1700
*                                                                  1700
@RF01698 DS    0H                                                  1701
*            /********************************************************/
*            /*                                                      */
*            /* REDUCE THE TOTAL NUMBER OF INPUT STRINGS BY THE      */
*            /* NUMBER OF STRINGS JUST PROCESSED.  SET THE STARTING  */
*            /* RBA FOR THE FIRST RECORD OF THE FIRST STRING OF      */
*            /* THE NEXT SET (THE RBA OF THE LAST RECORD OF THE LAST */
*            /* STRING OF THE PREVIOUS SET WAS SAVED).  INCREMENT    */
*            /* THE NUMBER OF OUTPUT STRINGS.  SAVE THE NUMBER       */
*            /* OF RECORDS IN THIS STRING.                           */
*            /*                                                      */
*            /********************************************************/
*                                                                  1701
*            STRGCTR = STRGCTR - STRGLIM;                          1701
@RF01685 LH    @05,STRGCTR                                         1701
         SH    @05,STRGLIM                                         1701
         STH   @05,STRGCTR                                         1701
*            RBAHOLD = RBAHOLD + BLKSIZE;                          1702
         LA    @15,2048                                            1702
         AL    @15,RBAHOLD                                         1702
         ST    @15,RBAHOLD                                         1702
*            SRTOSTRG = SRTOSTRG + 1;                              1703
*                                                                  1703
         LA    @15,1                                               1703
         AL    @15,SRTOSTRG                                        1703
         ST    @15,SRTOSTRG                                        1703
*            IF STRGCTR > 0                                        1704
*              THEN                                                1704
         LTR   @05,@05                                             1704
         BNP   @RF01704                                            1704
*                SRTRCNLO = SRTRCLSO;                              1705
*                                                                  1705
         L     @05,SRTRCLSO                                        1705
         ST    @05,SRTRCNLO                                        1705
*            IF GDTDBG = NULLPTR                                   1706
*              THEN;                                               1706
@RF01704 L     @05,@PC00001                                        1706
         L     @05,GDTDBG(,@05)                                    1706
         LTR   @05,@05                                             1706
         BZ    @RT01706                                            1706
*              ELSE                                                1708
*                CALL IDCDB010 (GDTTBL,'BIM4');                    1708
*                                                                  1708
         L     @05,@PC00001                                        1708
         ST    @05,@AL00001                                        1708
         LA    @15,@CC01628                                        1708
         ST    @15,@AL00001+4                                      1708
         MVI   @AL00001+4,X'80'                                    1708
         L     @15,GDTDBG(,@05)                                    1708
         LA    @01,@AL00001                                        1708
         BALR  @14,@15                                             1708
*            END STRGLP;                                           1709
*                                                                  1709
@RT01706 DS    0H                                                  1709
@DE01526 LH    @05,STRGCTR                                         1709
         LTR   @05,@05                                             1709
         BP    @DL01526                                            1709
*          /**********************************************************/
*          /*                                                        */
*          /* THIS IS THE END OF THE MERGE LOOP.  IF THIS WAS THE    */
*          /* FIRST MERGE PASS AND IT WAS NOT THE ONLY MERGE PASS,   */
*          /* CLOSE AND REOPEN THE SECOND SORT WORK FILE TO GET IT   */
*          /* OUT OF CREATE MODE.                                    */
*          /*                                                        */
*          /**********************************************************/
*                                                                  1710
*          IF MERGSTRT = ON & MERGEND = OFF                        1710
*            THEN                                                  1710
         TM    MERGSTRT,B'01000000'                                1710
         BNO   @RF01710                                            1710
         TM    MERGEND,B'10000000'                                 1710
         BNZ   @RF01710                                            1710
*              DO;                                                 1711
*                                                                  1711
*              MERGSTRT = OFF;                                     1712
*                                                                  1712
         NI    MERGSTRT,B'10111111'                                1712
*              CALL IDCIOCL0(GDTTBL,MRIOCSSR(2));                  1713
*                                                                  1713
         L     @05,@PC00001                                        1713
         ST    @05,@AL00001                                        1713
         L     @15,@PC00016+4                                      1713
         LA    @15,MRIOCSSR+4(,@15)                                1713
         ST    @15,@AL00001+4                                      1713
         MVI   @AL00001+4,X'80'                                    1713
         L     @15,GDTCLS(,@05)                                    1713
         LA    @01,@AL00001                                        1713
         BALR  @14,@15                                             1713
*              MRIOCSSR(2) = NULLPTR;                              1714
*                                                                  1714
         L     @05,@PC00016+4                                      1714
         SLR   @15,@15                                             1714
         ST    @15,MRIOCSSR+4(,@05)                                1714
*              CALL OPENPROC ('M',MRIOCSSR(2),NULLPTR,MRIOINPT(2));
*                                                                  1715
         LA    @15,@CC00744                                        1715
         ST    @15,@AL00001                                        1715
         LA    @05,MRIOCSSR+4(,@05)                                1715
         ST    @05,@AL00001+4                                      1715
         LA    @05,@CF00116                                        1715
         ST    @05,@AL00001+8                                      1715
         L     @05,@PC00016+8                                      1715
         LA    @05,MRIOINPT+4(,@05)                                1715
         ST    @05,@AL00001+12                                     1715
         LA    @01,@AL00001                                        1715
         BAL   @14,OPENPROC                                        1715
*              RESPECIFY RTNREG RSTD;                              1716
*              TESTRC = RTNREG;                                    1717
         LR    TESTRC,RTNREG                                       1717
*              RESPECIFY RTNREG UNRSTD;                            1718
*                                                                  1718
*              IF TESTRC ^= 0                                      1719
*                THEN                                              1719
         LTR   TESTRC,TESTRC                                       1719
         BZ    @RF01719                                            1719
*                  RETURN CODE(LASTCC08);                          1720
*                                                                  1720
         LA    @15,8                                               1720
         L     @14,@SA00016                                        1720
         LM    @00,@12,@SA00016+8                                  1720
         BR    @14                                                 1720
*              END;                                                1721
*                                                                  1721
@RF01719 DS    0H                                                  1722
*        /************************************************************/
*        /*                                                          */
*        /* THIS IS THE END OF THE MERGE LOOP.  WHEN ALL MERGE       */
*        /* PASSES HAVE BEEN COMPLETED, RETURN TO THE CALLING        */
*        /* PROCEDURE (CNTLPROC).                                    */
*        /*                                                          */
*        /************************************************************/
*                                                                  1722
*        END MERGLP;                                               1722
*                                                                  1722
@RF01710 DS    0H                                                  1722
@DE01485 TM    MERGEND,B'10000000'                                 1722
         BZ    @DL01485                                            1722
*        RETURN CODE(LASTCC00);                                    1723
         SLR   @15,@15                                             1723
         L     @14,@SA00016                                        1723
         LM    @00,@12,@SA00016+8                                  1723
         BR    @14                                                 1723
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - TREEADD                                 */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE, WHICH IS INTERNAL TO          */
*        /*            MERGPROC, ADDS A RECORD TO THE TREE.  THE     */
*        /*            TREE IS MADE UP OF NODES WITH A SINGLE NODE   */
*        /*            AT THE TOP.  EACH PARENT NODE HAS TWO CHILD   */
*        /*            NODES AND THE TREE IS BUILT SO THAT THE       */
*        /*            RECORD REPRESENTED BY THE PARENT NODE IS      */
*        /*            LOWER IN VALUE THAN EITHER CHILD.  AS THE     */
*        /*            TREE ADD LOOP STARTS THE SIZE OF THE TREE     */
*        /*            IS INCREASED BY 1 THUS LEAVING AN EMPTY SLOT  */
*        /*            AT THE BOTTOM.  THE PARENT OF THE EMPTY SLOT  */
*        /*            IS ESTABLISHED AND IF THE NEW RECORD IS       */
*        /*            HIGHER THAN THE PARENT, IT GOES INTO THE      */
*        /*            EMPTY SLOT AT THE BOTTOM.  HOWEVER, IF THE    */
*        /*            NEW RECORD IS LOWER, THE PARENT IS MOVED DOWN */
*        /*            LEAVING AN EMPTY SLOT.  THE PARENT OF THE     */
*        /*            NEW EMPTY SLOT IS ESTABLISHED AND THE PROCESS */
*        /*            CONTINUES UNTIL THE NEW RECORD IS FOUND TO    */
*        /*            BE HIGHER THAN THE PARENT AT WHICH TIME IT    */
*        /*            GOES INTO THE EMPTY CHILD SLOT.  IF THE       */
*        /*            PARENT IS MOVED FROM THE TOP OF THE TREE,     */
*        /*            THE NEW RECORD GOES THERE AND THE PROCESS     */
*        /*            STOPS.                                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1724
*TREEADD:                                                          1724
*        PROCEDURE;                                                1724
*                                                                  1724
TREEADD  STM   @14,@02,12(@13)                                     1724
         ST    @04,36(,@13)                                        1724
         STM   @06,@12,44(@13)                                     1724
*        TSIZE = TSIZE + 1;                                        1725
         AL    TSIZE,@CF00220                                      1725
*        TPREV = TSIZE;                                            1726
         LR    TPREV,TSIZE                                         1726
*        TCURR = TSIZE / 2;                                        1727
*                                                                  1727
         LR    @00,TSIZE                                           1727
         SRDA  @00,32                                              1727
         D     @00,@CF00154                                        1727
         LR    TCURR,@01                                           1727
*        IF SRTRECSZ <= MVCMLIM                                    1728
*          THEN                                                    1728
         LH    @15,SRTRECSZ                                        1728
         C     @15,@CF00925                                        1728
         BH    @RF01728                                            1728
*            DO WHILE TCURR > 0;                                   1729
*                                                                  1729
         B     @DE01729                                            1729
@DL01729 DS    0H                                                  1730
*            IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >             1730
*               TRECORD -> MRSRTREC(1:SRTRECSZ)                    1730
*              THEN                                                1730
         LR    @15,TCURR                                           1730
         SLA   @15,4                                               1730
         LR    @14,TREEPTR                                         1730
         AL    @14,@CF01721                                        1730
         L     @01,MTPTR-8(@15,@14)                                1730
         LH    @14,SRTRECSZ                                        1730
         BCTR  @14,0                                               1730
         L     @07,TRECORD                                         1730
         EX    @14,@SC01739                                        1730
         BNH   @RF01730                                            1730
*                DO;                                               1731
*                                                                  1731
*                MERGTREE(TPREV) = MERGTREE(TCURR);                1732
         LR    @14,TPREV                                           1732
         SLA   @14,4                                               1732
         ALR   @14,TREEPTR                                         1732
         AL    @14,@CF01669                                        1732
         ALR   @15,TREEPTR                                         1732
         AL    @15,@CF01669                                        1732
         MVC   @TS00001(16),MERGTREE(@15)                          1732
         MVC   MERGTREE(16,@14),@TS00001                           1732
*                TPREV = TCURR;                                    1733
         LR    TPREV,TCURR                                         1733
*                TCURR = TPREV / 2;                                1734
*                                                                  1734
         LR    @00,TPREV                                           1734
         SRDA  @00,32                                              1734
         D     @00,@CF00154                                        1734
         LR    TCURR,@01                                           1734
*                END;                                              1735
*                                                                  1735
*              ELSE                                                1736
*                TCURR = 0;                                        1736
         B     @RC01730                                            1736
@RF01730 SLR   TCURR,TCURR                                         1736
*            END;                                                  1737
*                                                                  1737
@RC01730 DS    0H                                                  1737
@DE01729 LTR   TCURR,TCURR                                         1737
         BP    @DL01729                                            1737
*          ELSE                                                    1738
*            DO WHILE TCURR > 0;                                   1738
*                                                                  1738
         B     @RC01728                                            1738
@RF01728 B     @DE01738                                            1738
@DL01738 DS    0H                                                  1739
*            IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >             1739
*                TRECORD -> MRSRTREC(1:MVCMLIM))                  1739
*                                                                  1739
*               (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =             1739
*                TRECORD -> MRSRTREC(1:MVCMLIM) &                  1739
*                MTPTR(TCURR) -> MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1739
*                TRECORD -> MRSRTREC(MVCMLIM + 1:SRTRECSZ))        1739
*              THEN                                                1739
         LR    @15,TCURR                                           1739
         SLA   @15,4                                               1739
         AL    @15,@CF01721                                        1739
         L     @15,MTPTR-8(@15,TREEPTR)                            1739
         L     @14,TRECORD                                         1739
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1739
         BH    @RT01739                                            1739
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1739
         BNE   @RF01739                                            1739
         LH    @07,SRTRECSZ                                        1739
         SL    @07,@CF01651                                        1739
         EX    @07,@SC01737                                        1739
         BNH   @RF01739                                            1739
@RT01739 DS    0H                                                  1740
*                DO;                                               1740
*                                                                  1740
*                MERGTREE(TPREV) = MERGTREE(TCURR);                1741
         LR    @15,TPREV                                           1741
         SLA   @15,4                                               1741
         ALR   @15,TREEPTR                                         1741
         AL    @15,@CF01669                                        1741
         LR    @14,TCURR                                           1741
         SLA   @14,4                                               1741
         ALR   @14,TREEPTR                                         1741
         AL    @14,@CF01669                                        1741
         MVC   @TS00001(16),MERGTREE(@14)                          1741
         MVC   MERGTREE(16,@15),@TS00001                           1741
*                TPREV = TCURR;                                    1742
         LR    TPREV,TCURR                                         1742
*                TCURR = TPREV / 2;                                1743
*                                                                  1743
         LR    @00,TPREV                                           1743
         SRDA  @00,32                                              1743
         D     @00,@CF00154                                        1743
         LR    TCURR,@01                                           1743
*                END;                                              1744
*                                                                  1744
*              ELSE                                                1745
*                TCURR = 0;                                        1745
         B     @RC01739                                            1745
@RF01739 SLR   TCURR,TCURR                                         1745
*            END;                                                  1746
*                                                                  1746
@RC01739 DS    0H                                                  1746
@DE01738 LTR   TCURR,TCURR                                         1746
         BP    @DL01738                                            1746
*END TREEADD;                                                      1747
@EL00017 DS    0H                                                  1747
@EF00017 DS    0H                                                  1747
@ER00017 LM    @14,@02,12(@13)                                     1747
         L     @04,36(,@13)                                        1747
         LM    @06,@12,44(@13)                                     1747
         BR    @14                                                 1747
*        /************************************************************/
*        /*                                                          */
*        /* PROCEDURE NAME - RECOUT                                  */
*        /*                                                          */
*        /* FUNCTION - THIS PROCEDURE, WHICH IS INTERNAL TO          */
*        /*            MERGPROC, OUTPUTS A SORT RECORD.  IF THIS     */
*        /*            IS THE LAST MERGE PASS, THE RECORD IS         */
*        /*            PASSED TO BLDPROC.  OTHERWISE, THE RECORD     */
*        /*            IS MOVED TO THE OUTPUT BUFFER.  IF THE        */
*        /*            OUTPUT BUFFER IS FILLED, IT IS WRITTEN OUT.   */
*        /*                                                          */
*        /************************************************************/
*                                                                  1748
*RECOUT:                                                           1748
*        PROCEDURE;                                                1748
*                                                                  1748
RECOUT   STM   @14,@12,@SA00018                                    1748
*        IF MERGEND = ON                                           1749
*          THEN                                                    1749
         TM    MERGEND,B'10000000'                                 1749
         BNO   @RF01749                                            1749
*            DO;                                                   1750
*                                                                  1750
*            CALL BLDPROC (TRECORD,MERGAMDS,MERGIOCS,              1751
*                          MERGSRTB,MERGSTAT);                     1751
*                                                                  1751
         LA    @15,TRECORD                                         1751
         ST    @15,@AL00001                                        1751
         L     @15,@PC00016                                        1751
         ST    @15,@AL00001+4                                      1751
         L     @15,@PC00016+4                                      1751
         ST    @15,@AL00001+8                                      1751
         L     @15,@PC00016+12                                     1751
         ST    @15,@AL00001+12                                     1751
         L     @15,@PC00016+16                                     1751
         ST    @15,@AL00001+16                                     1751
         LA    @01,@AL00001                                        1751
         BAL   @14,BLDPROC                                         1751
*            RESPECIFY RTNREG RSTD;                                1752
*            TESTRC = RTNREG;                                      1753
         LR    TESTRC,RTNREG                                       1753
*            RESPECIFY RTNREG UNRSTD;                              1754
*                                                                  1754
*            IF TESTRC ^= 0                                        1755
*              THEN                                                1755
         LTR   TESTRC,TESTRC                                       1755
         BZ    @RF01755                                            1755
*                RETURN CODE(LASTCC08);                            1756
*                                                                  1756
         LA    @15,8                                               1756
         L     @14,@SA00018                                        1756
         LM    @00,@12,@SA00018+8                                  1756
         BR    @14                                                 1756
*            END;                                                  1757
*                                                                  1757
*          ELSE                                                    1758
*NOTLAST:    DO;                                                   1758
*                                                                  1758
         B     @RC01749                                            1758
@RF01749 DS    0H                                                  1758
NOTLAST  DS    0H                                                  1759
*            IF SRTRECSZ <= MVCMLIM                                1759
*              THEN                                                1759
         LH    @15,SRTRECSZ                                        1759
         C     @15,@CF00925                                        1759
         BH    @RF01759                                            1759
*                OUTRECAR(OUTBUFST:OUTBUFEN) =                     1760
*                  TRECORD -> MRSRTREC(1:SRTRECSZ);                1760
*                                                                  1760
         LH    @15,OUTBUFST                                        1760
         L     @01,OUTBUFPT                                        1760
         ALR   @01,@15                                             1760
         BCTR  @01,0                                               1760
         LCR   @15,@15                                             1760
         AH    @15,OUTBUFEN                                        1760
         L     @14,TRECORD                                         1760
         EX    @15,@SM01741                                        1760
*              ELSE                                                1761
*                DO;                                               1761
*                                                                  1761
         B     @RC01759                                            1761
@RF01759 DS    0H                                                  1762
*                OUTRECAR(OUTBUFST:MVCMLIM) =                      1762
*                  TRECORD -> MRSRTREC(1:MVCMLIM);                 1762
         L     @15,OUTBUFPT                                        1762
         LH    @14,OUTBUFST                                        1762
         ALR   @14,@15                                             1762
         BCTR  @14,0                                               1762
         LA    @07,256                                             1762
         LH    @06,OUTBUFST                                        1762
         LR    @05,@07                                             1762
         SLR   @05,@06                                             1762
         L     @04,TRECORD                                         1762
         EX    @05,@SM01743                                        1762
*                OUTRECAR(OUTBUFST + MVCMLIM:OUTBUFEN) =           1763
*                  TRECORD -> MRSRTREC(MVCMLIM + 1:SRTRECSZ);      1763
*                                                                  1763
         ALR   @15,@06                                             1763
         LCR   @06,@06                                             1763
         AH    @06,OUTBUFEN                                        1763
         SLR   @06,@07                                             1763
         EX    @06,@SM01745                                        1763
*                END;                                              1764
*                                                                  1764
*            OUTBUFCT = OUTBUFCT + 1;                              1765
@RC01759 LA    @15,1                                               1765
         LH    @14,OUTBUFCT                                        1765
         ALR   @14,@15                                             1765
         STH   @14,OUTBUFCT                                        1765
*            OUTBUFST = OUTBUFEN + 1;                              1766
         LH    @07,OUTBUFEN                                        1766
         ALR   @07,@15                                             1766
         STH   @07,OUTBUFST                                        1766
*            OUTBUFEN = OUTBUFST - 1 + SRTRECSZ;                   1767
         BCTR  @07,0                                               1767
         AH    @07,SRTRECSZ                                        1767
         STH   @07,OUTBUFEN                                        1767
*            SRTRCLSO = SRTRCLSO + 1;                              1768
*                                                                  1768
         AL    @15,SRTRCLSO                                        1768
         ST    @15,SRTRCLSO                                        1768
*            IF OUTBUFCT = SRTRECBK                                1769
*              THEN                                                1769
         CH    @14,SRTRECBK                                        1769
         BNE   @RF01769                                            1769
*PUTMERG:        DO;                                               1770
*                                                                  1770
PUTMERG  DS    0H                                                  1771
*                CALL IDCIOPT0 (GDTTBL,MRIOCSSR(2));               1771
*                                                                  1771
         L     @02,@PC00001                                        1771
         ST    @02,@AL00001                                        1771
         L     @15,@PC00016+4                                      1771
         LA    @15,MRIOCSSR+4(,@15)                                1771
         ST    @15,@AL00001+4                                      1771
         MVI   @AL00001+4,X'80'                                    1771
         L     @15,GDTPUT(,@02)                                    1771
         LA    @01,@AL00001                                        1771
         BALR  @14,@15                                             1771
*                RESPECIFY RTNREG RSTD;                            1772
*                TESTRC = RTNREG;                                  1773
         LR    TESTRC,RTNREG                                       1773
*                RESPECIFY RTNREG UNRSTD;                          1774
*                                                                  1774
*                IF TESTRC ^= 0                                    1775
*                  THEN                                            1775
         LTR   TESTRC,TESTRC                                       1775
         BZ    @RF01775                                            1775
*                    RETURN CODE (LASTCC08);                       1776
*                                                                  1776
         LA    @15,8                                               1776
         L     @14,@SA00018                                        1776
         LM    @00,@12,@SA00018+8                                  1776
         BR    @14                                                 1776
*                IOCSPTR  = MRIOCSSR(2);                           1777
@RF01775 L     @15,@PC00016+4                                      1777
         L     IOCSPTR,MRIOCSSR+4(,@15)                            1777
*                IOCDAD   = 0;                                     1778
         SLR   @03,@03                                             1778
         ST    @03,IOCDAD(,IOCSPTR)                                1778
*                OUTBUFCT = 0;                                     1779
         STH   @03,OUTBUFCT                                        1779
*                OUTBUFST = 1;                                     1780
         MVC   OUTBUFST(2),@CH00220                                1780
*                OUTBUFEN = SRTRECSZ;                              1781
*                                                                  1781
         LH    @14,SRTRECSZ                                        1781
         STH   @14,OUTBUFEN                                        1781
*                /****************************************************/
*                /*                                                  */
*                /* THE FIRST PUT UPDATE AGAINST A WORK FILE WHICH   */
*                /* HAS PREVIOUSLY BEEN PROCESSED WITH GET UPDATE    */
*                /* WILL GO IN THE RECORD POSITION OF THE LAST GET.  */
*                /* THEREFORE, A SECOND PUT IS ISSUED FOR THE FIRST  */
*                /* RECORD TO WRITE IT AT THE ZERO RBA LOCATION.     */
*                /*                                                  */
*                /****************************************************/
*                                                                  1782
*                IF MERGSTRT = OFF                                 1782
*                  THEN                                            1782
         TM    MERGSTRT,B'01000000'                                1782
         BNZ   @RF01782                                            1782
*                    DO;                                           1783
*                                                                  1783
*                    IF IOCRBA = 0                                 1784
*                     THEN                                         1784
         C     @03,IOCRBA(,IOCSPTR)                                1784
         BNE   @RF01784                                            1784
*                        DO;                                       1785
*                                                                  1785
*                        CALL IDCIOPT0 (GDTTBL,MRIOCSSR(2));       1786
*                                                                  1786
         L     @14,@PC00001                                        1786
         ST    @14,@AL00001                                        1786
         LA    @15,MRIOCSSR+4(,@15)                                1786
         ST    @15,@AL00001+4                                      1786
         MVI   @AL00001+4,X'80'                                    1786
         L     @15,GDTPUT(,@14)                                    1786
         LA    @01,@AL00001                                        1786
         BALR  @14,@15                                             1786
*                        RESPECIFY RTNREG RSTD;                    1787
*                        TESTRC = RTNREG;                          1788
         LR    TESTRC,RTNREG                                       1788
*                        RESPECIFY RTNREG UNRSTD;                  1789
*                                                                  1789
*                        IF TESTRC ^= 0                            1790
*                          THEN                                    1790
         LTR   TESTRC,TESTRC                                       1790
         BZ    @RF01790                                            1790
*                            RETURN CODE(LASTCC08);                1791
*                                                                  1791
         LA    @15,8                                               1791
         L     @14,@SA00018                                        1791
         LM    @00,@12,@SA00018+8                                  1791
         BR    @14                                                 1791
*                        IOCDAD = 0;                               1792
*                                                                  1792
@RF01790 SLR   @03,@03                                             1792
         ST    @03,IOCDAD(,IOCSPTR)                                1792
*                        END;                                      1793
*                                                                  1793
*                    IOCRBA  = IOCRBA + BLKSIZE;                   1794
*                                                                  1794
@RF01784 LA    @03,2048                                            1794
         AL    @03,IOCRBA(,IOCSPTR)                                1794
         ST    @03,IOCRBA(,IOCSPTR)                                1794
*                    END;                                          1795
*                                                                  1795
*                END PUTMERG;                                      1796
*                                                                  1796
@RF01782 DS    0H                                                  1797
*            END NOTLAST;                                          1797
*                                                                  1797
@RF01769 DS    0H                                                  1798
*        /************************************************************/
*        /*                                                          */
*        /* DETERMINE IF WE HAVE REACHED THE END OF A STRING AND,    */
*        /* IF SO, ZERO THE NEXT RECORD AREA.                        */
*        /*                                                          */
*        /************************************************************/
*                                                                  1798
*        IF NXSTGNO = STRGLIM                                      1798
*          THEN                                                    1798
@RC01749 CLC   NXSTGNO(2),STRGLIM                                  1798
         BNE   @RF01798                                            1798
*            IF NXBLKREC = STRLAST                                 1799
*              THEN                                                1799
         CLC   NXBLKREC(4),STRLAST                                 1799
         BNE   @RF01799                                            1799
*                DO;                                               1800
*                                                                  1800
*                RBAHOLD = NXRBA;                                  1801
         L     @15,NXRBA                                           1801
         ST    @15,RBAHOLD                                         1801
*                NEXTREC = ''B;                                    1802
*                                                                  1802
         XC    NEXTREC(16),NEXTREC                                 1802
*                END;                                              1803
*                                                                  1803
*              ELSE;                                               1804
*                                                                  1804
@RF01799 DS    0H                                                  1805
*          ELSE                                                    1805
*            IF NXBLKREC = STRNLAST                                1805
*              THEN                                                1805
         B     @RC01798                                            1805
@RF01798 CLC   NXBLKREC(4),STRNLAST                                1805
         BNE   @RF01805                                            1805
*                NEXTREC = ''B;                                    1806
*                                                                  1806
         XC    NEXTREC(16),NEXTREC                                 1806
*              ELSE;                                               1807
*                                                                  1807
@RF01805 DS    0H                                                  1808
*        RETURN CODE(LASTCC00);                                    1808
*                                                                  1808
@RC01798 SLR   @15,@15                                             1808
         L     @14,@SA00018                                        1808
         LM    @00,@12,@SA00018+8                                  1808
         BR    @14                                                 1808
*END RECOUT;                                                       1809
*END MERGPROC;                                                     1810
*END IDCBI01                                                       1811
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (AMSDF01 )                                        *
*/*%INCLUDE SYSLIB  (AMSDF00 )                                        *
*/*@INCLUDE SYSLIB  (AMSDF02 )                                        *
*/*%INCLUDE SYSLIB  (IDCCSBI )                                        *
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                        *
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                        *
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                        *
*/*%INCLUDE SYSLIB  (IEZCTGFV)                                        *
*/*%INCLUDE SYSLIB  (IDAAIR  )                                        *
*;                                                                 1811
@DATA    DS    0H
@CH00037 DC    H'10'
@CH01639 DC    H'18'
@CH00596 DC    H'44'
@CH01640 DC    H'66'
@CH01647 DC    H'94'
@CH01644 DC    H'113'
@CH01518 DC    H'32767'
@SC01690 CLC   RSAREC(0,@01),RSAREC(@15)
@SC01692 CLC   RSAREC(0,@01),RSAREC(@14)
@SC01694 CLC   RSAREC+256(0,@07),RSAREC+256(@06)
@SC01696 CLC   RSAREC+256(0,@15),RSAREC+256(@14)
@SM01698 MVC   SAVEKEY(0),BASEREC(@01)
@SM01700 MVC   RSAREC(0,@05),BASEREC(@01)
@SM01702 MVC   RSAREC(0,@05),BASEREC(@14)
@SM01704 MVC   RSAREC(0,@03),CHARRBA(IOCSPTR)
@SM01706 MVC   SPSRTREC(0,SPRECPTR),RSAREC(@07)
@SM01708 MVC   SPSRTREC+256(0,SPRECPTR),RSAREC+256(@07)
@SM01711 MVC   AIXKY(0,@05),BLSRTREC(@01)
@SC01713 CLC   BLSRTREC(0,@05),AIXKY(@03)
@SX01715 XC    AIXREC(0,@14),AIXREC(@14)
@SM01717 MVC   AIXKY(0,@15),BLSRTREC(@03)
@SM01719 MVC   AIXREC(0,@05),@TS00001
@SC01724 CLC   MRSRTREC(0,@01),MRSRTREC(@15)
@SC01726 CLC   MRSRTREC+256(0,@14),MRSRTREC+256(@15)
@SC01728 CLC   MRSRTREC(0,@02),MRSRTREC(@01)
@SC01730 CLC   MRSRTREC+256(0,@07),MRSRTREC+256(@02)
@SC01732 CLC   MRSRTREC+256(0,@07),MRSRTREC+256(@15)
@SC01735 CLC   MRSRTREC(0,@14),MRSRTREC(@01)
@SC01737 CLC   MRSRTREC+256(0,@15),MRSRTREC+256(@14)
@SC01739 CLC   MRSRTREC(0,@01),MRSRTREC(@07)
@SM01741 MVC   OUTRECAR(0,@01),MRSRTREC(@14)
@SM01743 MVC   OUTRECAR(0,@14),MRSRTREC(@04)
@SM01745 MVC   OUTRECAR+255(0,@15),MRSRTREC+256(@04)
         DS    0F
@AL00210 DC    A(@CC00738)             LIST WITH   4 ARGUMENT(S)
         DS    F
         DC    A(@CF00116)
         DC    A(@CF00116)
@AL00562 DC    A(UGPID01)              LIST WITH   2 ARGUMENT(S)
         DC    AL1(X'80')
         DC    AL3(ALL)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    3F
@SA00002 DS    15F
@PC00002 DS    4F
@SA00003 DS    15F
@PC00003 DS    1F
@SA00004 DS    15F
@PC00004 DS    5F
@SA00005 DS    15F
@PC00005 DS    2F
@SA00006 DS    15F
@PC00006 DS    3F
@SA00007 DS    15F
@PC00007 DS    4F
@SA00011 DS    15F
@PC00011 DS    5F
@SA00012 DS    15F
@PC00012 DS    5F
@SA00010 DS    15F
@PC00010 DS    1F
@SA00008 DS    15F
@PC00008 DS    6F
@SA00009 DS    15F
@PC00009 DS    5F
@SA00013 DS    15F
@PC00013 DS    6F
@SA00016 DS    15F
@PC00016 DS    5F
@SA00015 DS    15F
@PC00015 DS    5F
@SA00014 DS    15F
@PC00014 DS    4F
@SA00018 DS    15F
@AL00001 DS    6A
@TF00001 DS    F
IDCBI01  CSECT
         DS    0F
@CF00116 DC    F'0'
@CF00220 DC    F'1'
@CH00220 EQU   @CF00220+2
@CF00154 DC    F'2'
@CH00154 EQU   @CF00154+2
@CF00163 DC    F'3'
@CH00163 EQU   @CF00163+2
@CF00043 DC    F'4'
@CH00043 EQU   @CF00043+2
@CF00157 DC    F'6'
@CH00157 EQU   @CF00157+2
@CF00629 DC    F'7'
@CF00180 DC    F'8'
@CH00180 EQU   @CF00180+2
@CF00035 DC    F'12'
@CH00035 EQU   @CF00035+2
@CF00474 DC    F'16'
@CF00311 DC    F'24'
@CF00925 DC    F'256'
@CF01651 DC    F'257'
@CF00978 DC    F'2041'
@CF00976 DC    F'2048'
@CF01376 DC    F'4096'
@CF01374 DC    F'32768'
@CF01372 DC    F'61440'
@CF01370 DC    F'102400'
@CF01378 DC    F'16777215'
@CF01674 DC    F'-64'
@CF01675 DC    F'-63'
@CF01671 DC    F'-54'
@CF01673 DC    F'-44'
@CF01672 DC    F'-43'
@CF01669 DC    F'-16'
@CF01670 DC    F'-15'
@CF01722 DC    F'-12'
@CF01723 DC    F'-10'
@CF01721 DC    F'-8'
@CF01668 DC    F'-6'
@CF01678 DC    F'-4'
@CF00878 DC    XL4'E4E5F001'
@CF00880 DC    XL4'E4E5F003'
@CF00882 DC    XL4'E4E5F00F'
@CF00890 DC    XL4'C2C9F004'
@CF00892 DC    XL4'C2C9F005'
@CF00894 DC    XL4'C2C9F006'
@CF00896 DC    XL4'C2C9F007'
@CF00900 DC    XL4'C2C9F009'
@CF00906 DC    XL4'C2C9F00C'
@CF00908 DC    XL4'C2C9F00D'
@CF00910 DC    XL4'C2C9F00E'
@CF00912 DC    XL4'C2C9F00F'
@CF00916 DC    XL4'C2C9F011'
@CF00918 DC    XL4'C2C9F012'
@CF00920 DC    XL4'C2C9F013'
@DATD    DSECT
         DS    0D
LISTSCAN DS    A
DDSTRU   DS    A
FSADDR   DS    A
ERCNVADR DS    A
DMPINDEX DS    A
CTGPLPTR DS    A
I        DS    F
OUTBUFPT DS    A
QDSNPTR  DS    A
QCATPTR  DS    A
QDSNPSWD DS    A
CATACBPT DS    A
VS       DS    F
WKASIZE  DS    F
SORTCORE DS    F
SORTK    DS    A
SP2      DS    F
IOCDADSV DS    A
M        DS    F
RBAHOLD  DS    F
MRNLAST  DS    FL4
         ORG   MRNLAST
MRNLBLK  DS    FL2
MRNLREC  DS    FL2
         ORG   MRNLAST+4
MRLAST   DS    FL4
         ORG   MRLAST
MRLBLK   DS    FL2
MRLREC   DS    FL2
         ORG   MRLAST+4
STRNLAST DS    FL4
         ORG   STRNLAST
STRNLBLK DS    FL2
STRNLREC DS    FL2
         ORG   STRNLAST+4
STRLAST  DS    FL4
         ORG   STRLAST
STRLBLK  DS    FL2
STRLREC  DS    FL2
         ORG   STRLAST+4
TRECORD  DS    A
LISTPTR  DS    A
CATRETCC DS    H
QDSNLEN  DS    H
STATLEN  DS    H
STRGCTR  DS    H
STRGLIM  DS    H
OUTBUFCT DS    H
OUTBUFST DS    H
OUTBUFEN DS    H
TREC1    DS    H
LISTLN   DS    FL1
@TS00001 DS    CL256
         DS    CL1
STATCOMM DS    CL6
         ORG   STATCOMM
SAVERC   DS    FL2
STATSTID DS    CL4
         ORG   STATSTID
STATMOD  DS    CL3
STATENT  DS    AL1
         ORG   STATCOMM+6
         DS    CL2
IOCSADDR DS    CL16
         ORG   IOCSADDR
IOCSBASE DS    AL4
IOCSAIX  DS    AL4
IOCSSORT DS    2A
         ORG   IOCSADDR+16
DSBAREA  DS    CL192
         ORG   DSBAREA
DSBBAREA DS    CL96
DSBAAREA DS    CL96
         ORG   DSBAREA+192
DSBADDR  DS    CL8
         ORG   DSBADDR
DSBBASE  DS    AL4
DSBAIX   DS    AL4
         ORG   DSBADDR+8
DARGAREA DS    CL44
IOINADDR DS    CL8
         ORG   IOINADDR
IOINSWPT DS    2A
         ORG   IOINADDR+8
SAVEKEY  DS    CL256
SRTCTLTB DS    CL76
         ORG   SRTCTLTB
SRTRECSZ DS    FL2
SRTRECBK DS    FL2
SRTBKTOT DS    FL4
SRTBK10  DS    FL4
SRTEXCES DS    FL4
SRTBSCNT DS    FL4
SRTFLSIZ DS    FL4
SRTBUFPT DS    AL4
SRTRSASZ DS    FL4
SRTRSACP DS    FL4
SRTRSAPT DS    AL4
SRTRSABK DS    FL4
SRTRSACT DS    FL4
SRTHEAPT DS    AL4
SRTCURSA DS    AL4
SRTOSTRG DS    FL4
SRTISTRG DS    FL4
SRTRCLSO DS    FL4
SRTRCNLO DS    FL4
SRTFLAGS DS    BL2
         ORG   SRTFLAGS
SRTFLDEF DS    BL1
SRTFLEXT EQU   SRTFLAGS+0
SRTFLSTD EQU   SRTFLAGS+0
SRTFLBLD EQU   SRTFLAGS+0
         ORG   SRTCTLTB+74
@NM00073 DS    FL2
         ORG   SRTCTLTB+76
OPENAREA DS    CL392
         ORG   OPENAREA
OPENID   DS    CL8
OPENLIST DS    CL384
         ORG   OPENAREA+392
STOPJ    DS    BL1
SWFDNAME DS    CL8
UIOINOPT DS    CL1
FINAIXNM DS    CL44
ERRTAB   DS    CL32
         DS    CL2
WKAPTRS  DS    CL12
         ORG   WKAPTRS
WKAENTYP DS    AL4
WKANAME  DS    AL4
WKAAMDSB DS    AL4
         ORG   WKAPTRS+12
BASENAME DS    CL4
         ORG   BASENAME
BASEID   DS    CL1
BASECI   DS    CL3
         ORG   BASENAME+4
NEXTNAME DS    CL4
         ORG   NEXTNAME
NEXTID   DS    CL1
NEXTCI   DS    CL3
         ORG   NEXTNAME+4
LOCCPLAR DS    CL144
         ORG   LOCCPLAR
LOCCPLID DS    CL8
LOCCPL   DS    CL28
LOCFPPTR DS    3A
LOCFPENT DS    CL16
@NM00074 DS    CL8
LOCFPNAM DS    CL16
@NM00075 DS    CL8
LOCFPMSC DS    CL16
@NM00076 DS    CL8
LOCFPTST DS    CL16
@NM00077 DS    CL8
         ORG   LOCCPLAR+144
LOCWKA   DS    CL113
         ORG   LOCWKA
LOCWKALN DS    FL2
LOCWKDLN DS    FL2
LOCWKDAT DS    CL109
         ORG   LOCWKA+113
STOPL    DS    BL1
TIMEODAY DS    CL8
         DS    CL2
DELCPLAR DS    CL134
         ORG   DELCPLAR
DELCPLID DS    CL8
DELCPL   DS    CL28
@NM00078 DS    CL4
DELWKA   DS    CL94
         ORG   DELWKA
DELWKTLN DS    FL2
DELWKRLN DS    FL2
DELWK    DS    CL45
         ORG   DELWK+0
DELWKTYP DS    CL1
DELWKNAM DS    CL44
         ORG   DELCPLAR+134
STOPI    DS    BL1
FIRSTKEY DS    BL1
MERGFLAG DS    BL1
         ORG   MERGFLAG
MERGEND  DS    BL1
MERGSTRT EQU   MERGFLAG+0
MERGOUT  EQU   MERGFLAG+0
MERGUPD  EQU   MERGFLAG+0
         ORG   MERGFLAG+1
         DS    CL3
NEXTREC  DS    CL16
         ORG   NEXTREC
NXSTGNO  DS    FL2
@NM00081 DS    CL2
NXBLKREC DS    FL4
         ORG   NXBLKREC
NXBLKNO  DS    FL2
NXRECNO  DS    FL2
         ORG   NEXTREC+8
NXPTR    DS    AL4
NXRBA    DS    FL4
         ORG   NEXTREC+16
MTAREA   DS    CL256
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IDCBI01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
SWFONE   DC    F'1'
SWFTWO   DC    F'2'
NAMEMASK DC    H'3'
@CC01283 DC    C'LOCATCPL'
@CC01318 DC    C'DEFINCPL'
@CC01319 DC    C'CLSTRFVT'
@CC01343 DC    C'DELETCPL'
@CC01320 DC    C'DATAFVT'
@CC01126 DC    C'OPNAGL'
@CC00922 DC    C'BI01'
@CC01125 DC    C'BIP1'
@CC01132 DC    C'BIP2'
@CC01145 DC    C'BIJ1'
@CC01146 DC    C'BIJ2'
@CC01166 DC    C'BI02'
@CC01168 DC    C'BI03'
@CC01171 DC    C'BI04'
@CC01189 DC    C'BIFI'
@CC01231 DC    C'BIL1'
@CC01284 DC    C'BIL2'
@CC01315 DC    C'BID1'
@CC01324 DC    C'BID2'
@CC01342 DC    C'BIDL'
@CC01379 DC    C'BII1'
@CC01380 DC    C'BII2'
@CC01405 DC    C'BIC1'
@CC01409 DC    C'BIC2'
@CC01447 DC    C'BISR'
@CC01482 DC    C'BISP'
@CC01530 DC    C'BIB1'
@CC01611 DC    C'BIM1'
@CC01614 DC    C'BIM2'
@CC01620 DC    C'BIM3'
@CC01628 DC    C'BIM4'
@CC00721 DC    C'A'
@CC00727 EQU   @CC01319
@CC00738 EQU   @CC00922
@CC00744 DC    C'M'
@CC01131 DC    C'S'
@CC01233 DC    C'1'
@CC01234 DC    C'2'
@CC01235 DC    C'3'
@CC01236 DC    C'4'
@CC01237 DC    C'5'
@CC01407 DC    C'N'
@CC01408 EQU   @CC01283
@CB00884 DC    X'C2C9F001'
@CB00886 DC    X'C2C9F002'
@CB00888 DC    X'C2C9F003'
@CB00898 DC    X'C2C9F008'
@CB00902 DC    X'C2C9F00A'
@CB00904 DC    X'C2C9F00B'
@CB00906 DC    X'C2C9F00C'
@CB00914 DC    X'C2C9F010'
@CB00920 DC    X'C2C9F013'
@CB01188 DC    X'00000000'
@CB01321 DC    X'99999F'
@CB00960 DC    X'0001'
@CB00962 DC    X'0002'
ALL      DC    CL3'ALL'
FORMAT   DC    CL4'FORM'
HSECOND  DC    CL4'HSEC'
CLOCK    DC    CL4'KLOK'
SETZERO  DC    CL4'ZERO'
SETBLANK DC    CL4'BLNK'
NOSET    DC    CL4'NSET'
OVERRIDE DC    CL4'OVRD'
ACQUIRE  DC    CL8'ACQUIRE '
RELINQ   DC    CL8'RELINQ  '
MOUNT    DC    CL8'MOUNT   '
DEMOUNT  DC    CL8'DEMOUNT '
DEFINE   DC    CL8'DEFINE  '
MOVE     DC    CL8'MOVE    '
TRACEQ   DC    CL8'TRACEQ  '
COPYTABL DC    CL8'COPYTABL'
COPYCRTG DC    CL8'COPYCRTG'
COPYVOL  DC    CL8'COPYVOL '
VVIC     DC    CL8'VVIC    '
TUNE     DC    CL8'TUNE    '
NAMES    DC    CL4'NAME'
UNIT     DC    CL4'UNIT'
SHR      DC    CL4'SHR '
EXCL     DC    CL4'EXCL'
NOWAIT   DC    CL4'NWAI'
WAIT     DC    CL4'WAIT'
MODID    DC    CL4'BI01'
FIXAREA  DS    CL768
         ORG   FIXAREA
@NM00051 DS    CL256
         ORG   @NM00051
@NM00052 DC    256X'00'
         ORG   FIXAREA+256
@NM00053 DS    CL256
         ORG   @NM00053
@NM00054 DC    256X'00'
         ORG   FIXAREA+512
@NM00055 DS    CL256
         ORG   @NM00055
@NM00056 DC    256X'00'
         ORG   FIXAREA+768
UGPID01  DC    CL4'BI01'
UGPIDPG  DC    CL4'BIPG'
DEFDDN   DC    CL8'IDCUT1'
         DC    CL8'IDCUT2'
NAMTABL  DC    CL8'ENTYPE'
         DC    CL8'NAMEDS'
         DC    CL8'CATACB'
         DC    CL8'CNTREPNO'
         DC    CL8'AMDSBCAT'
DEFNMTAB DC    CL8'DSETCRDT'
         DC    CL8'DSETEXDT'
         DC    CL8'SPACPARM'
         DC    CL8'AMDSBCAT'
         DC    CL8'DSATTR'
         DC    CL8'LRECL'
MSGTXT   DC    CL3'KEY'
         DC    CL3'RBA'
MAXKEY   DC    256X'FF'
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
TREEPTR  EQU   @04
TREC2    EQU   @06
TPREV    EQU   @03
TCURR    EQU   @02
TSIZE    EQU   @05
IOCSHOLD EQU   @02
UNQLIMIT EQU   @03
CLRSTART EQU   @03
BL       EQU   @05
SPRECPTR EQU   @03
SP2LIM   EQU   @05
SP1      EQU   @06
PUTCTR   EQU   @04
SORTJ    EQU   @02
SORTI    EQU   @04
SORTR    EQU   @03
SORTL    EQU   @05
NM       EQU   @02
GETRC    EQU   @02
RSAINIT  EQU   @02
RSAREM   EQU   @03
DL       EQU   @02
DF       EQU   @06
LC       EQU   @03
FN       EQU   @02
JC       EQU   @02
INBUFPT  EQU   @06
DEFPTR   EQU   @05
DFCPPTR  EQU   @03
OUTCOUNT EQU   @06
SWDATPTR EQU   @04
CTGFVPTR EQU   @02
AMDSBPTR EQU   @04
CTGFLPTR EQU   @02
OPNPTR   EQU   @02
IOCSPTR  EQU   @02
TESTRC   EQU   @03
SETRC    EQU   @05
RTNREG   EQU   @15
REG0     EQU   @00
REG1     EQU   @01
REG10    EQU   @10
REG11    EQU   @11
REG12    EQU   @12
REG13    EQU   @13
REG14    EQU   @14
REG15    EQU   @15
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG8     EQU   @08
REG9     EQU   @09
IDCSAEP0 EQU   0
IDCSAGP0 EQU   0
IDCSAFP0 EQU   0
IDCSATI0 EQU   0
IDCSACA0 EQU   0
IDCSAQL0 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
CIRAGL   EQU   0
CIRTYPE  EQU   CIRAGL
ALLAGL   EQU   0
ALLSTS   EQU   ALLAGL+24
ALLDSP   EQU   ALLAGL+25
ALLORG   EQU   ALLAGL+26
ALLOPT   EQU   ALLAGL+28
UNITABL  EQU   0
UNITADR  EQU   UNITABL+4
@NM00010 EQU   UNITADR
UNITSTAT EQU   UNITABL+6
IDCIOOP0 EQU   0
IDCIOCL0 EQU   0
IDCIOPO0 EQU   0
IDCIOGT0 EQU   0
IDCIOPT0 EQU   0
IDCIOSI0 EQU   0
IOCSTR   EQU   0
IOCDAD   EQU   IOCSTR
IOCDLN   EQU   IOCSTR+4
IOCKYL   EQU   IOCSTR+12
IOCDSO   EQU   IOCSTR+16
IOCRFM   EQU   IOCSTR+17
IOCMAC   EQU   IOCSTR+18
IOCMAC2  EQU   IOCSTR+19
IOCMACPA EQU   IOCMAC2
IOCCHP   EQU   IOCSTR+20
IOCMSG   EQU   IOCSTR+21
IOCHURBA EQU   IOCSTR+28
IOCDSN   EQU   IOCSTR+32
IOCRBA   EQU   IOCSTR+40
IOCTTR   EQU   IOCRBA
IOCMEM   EQU   IOCSTR+44
IOCKYA   EQU   IOCMEM
IOCNWM   EQU   IOCSTR+48
IOCPTL   EQU   IOCNWM
IOCWORK  EQU   IOCSTR+56
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNOPTIN EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNOPTUP EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTDR EQU   OPNOPT
OPNRFM   EQU   OPNAGL+1
OPNTYP   EQU   OPNAGL+2
OPNMOD   EQU   OPNAGL+3
OPNMODAX EQU   OPNMOD
OPNMODRS EQU   OPNMOD
OPNMODUB EQU   OPNMOD
OPNIOC   EQU   OPNAGL+4
OPNDDN   EQU   OPNAGL+8
OPNPWA   EQU   OPNAGL+12
OPNDSN   EQU   OPNAGL+16
OPNDEV   EQU   OPNAGL+24
OPNDSO   EQU   OPNAGL+41
OPNOPT2  EQU   OPNAGL+42
IOINFOPT EQU   0
IOINFVOL EQU   IOINFOPT
IOINFDSN EQU   IOINFOPT
IOINFSUP EQU   IOINFOPT
UVOLLIST EQU   0
UVOLENT  EQU   UVOLLIST+2
AMSTP011 EQU   0
IDCTPER0 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGSTID EQU   DARGLIST+8
DARGILP  EQU   DARGLIST+12
DARGCNT  EQU   DARGLIST+14
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
DARGDTM  EQU   DARGARY+4
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ERCNVTAB EQU   0
ERTYPE   EQU   ERCNVTAB
ERCATLG  EQU   ERTYPE
EROPER   EQU   ERCNVTAB+1
ERCATLC  EQU   EROPER
ERCATDE  EQU   EROPER
EROSOPER EQU   ERCNVTAB+2
ERCATRC  EQU   ERCNVTAB+16
ERCPLPT  EQU   ERCNVTAB+20
IDCDB010 EQU   0
DMPITM   EQU   0
DMPARY   EQU   0
IFILE    EQU   0
IFILEPLN EQU   IFILE
IFILEPAS EQU   IFILE+1
IFILEVAL EQU   IFILE+10
IDS      EQU   0
IDSPLN   EQU   IDS
IDSPAS   EQU   IDS+1
IDSFLG   EQU   IDS+10
IDSFUQ   EQU   IDSFLG
IDSLEN   EQU   IDS+20
IDSVAL   EQU   IDS+21
OFILE    EQU   0
OFILECNT EQU   OFILE
@NM00038 EQU   OFILE+2
OFILEPLN EQU   @NM00038
OFILEPAS EQU   @NM00038+1
OFILEVAL EQU   @NM00038+10
ODS      EQU   0
ODSCNT   EQU   ODS
@NM00039 EQU   ODS+2
ODSPLN   EQU   @NM00039
ODSPAS   EQU   @NM00039+1
ODSFLG   EQU   @NM00039+10
ODSFUQ   EQU   ODSFLG
ODSLEN   EQU   @NM00039+20
ODSVAL   EQU   @NM00039+21
CAT      EQU   0
CATPLN   EQU   CAT
CATPAS   EQU   CAT+1
CATFLG   EQU   CAT+10
CATVAL   EQU   CAT+21
WFILE    EQU   0
WFLE1    EQU   0
WFLE1VAL EQU   WFLE1+1
WFLE2    EQU   0
WFLE2VAL EQU   WFLE2+1
ESORT    EQU   0
CTGPL    EQU   0
CTGOPTN1 EQU   CTGPL
CTGBYPSS EQU   CTGOPTN1
CTGNAME  EQU   CTGOPTN1
CTGCNAME EQU   CTGOPTN1
CTGOPTN2 EQU   CTGPL+1
CTGEXT   EQU   CTGOPTN2
CTGERASE EQU   CTGOPTN2
CTGSMF   EQU   CTGERASE
CTGREL   EQU   CTGSMF
CTGPURG  EQU   CTGOPTN2
CTGVMNT  EQU   CTGPURG
CTGOPTN3 EQU   CTGPL+2
CTGFUNC  EQU   CTGOPTN3
CTGNUM   EQU   CTGOPTN3
CTGAM0   EQU   CTGOPTN3
CTGOPTN4 EQU   CTGPL+3
CTGENT   EQU   CTGPL+4
CTGFVT   EQU   CTGENT
CTGCAT   EQU   CTGPL+8
CTGWKA   EQU   CTGPL+12
CTGDSORG EQU   CTGPL+16
CTGOPTNS EQU   CTGDSORG
CTGTYPE  EQU   CTGPL+18
CTGNOFLD EQU   CTGPL+19
CTGDDNM  EQU   CTGPL+20
CTGNEWNM EQU   CTGDDNM
CTGFBFLG EQU   CTGNEWNM+2
CTGJSCB  EQU   CTGPL+24
CTGPSWD  EQU   CTGJSCB
CTGFIELD EQU   CTGPL+28
CTGFL    EQU   0
CTGFLDNO EQU   CTGFL
CTGFLDCD EQU   CTGFL+1
CTGFLDRE EQU   CTGFL+3
CTGFLDNM EQU   CTGFL+8
CTGFLCHN EQU   CTGFL+12
CTGFLDAT EQU   CTGFL+16
CTGFLNG  EQU   CTGFLDAT
CTGFLPT  EQU   CTGFLDAT+4
IDAAMDSB EQU   0
AMDATTR  EQU   IDAAMDSB+1
AMDDST   EQU   AMDATTR
AMDLEN   EQU   IDAAMDSB+2
AMDNEST  EQU   IDAAMDSB+4
AMDAXRKP EQU   AMDNEST
AMDRKP   EQU   IDAAMDSB+6
AMDKEYLN EQU   IDAAMDSB+8
AMDCINV  EQU   IDAAMDSB+20
AMDLRECL EQU   IDAAMDSB+24
AMDHLRBA EQU   IDAAMDSB+28
AMDSSRBA EQU   IDAAMDSB+32
AMDATTR3 EQU   IDAAMDSB+40
AMDUNQ   EQU   AMDATTR3
AMDSTAT  EQU   IDAAMDSB+48
AMDNLR   EQU   AMDSTAT+12
CTGFV    EQU   0
CTGFVTYP EQU   CTGFV
CTGFVPRO EQU   CTGFV+1
CTGFVDCH EQU   CTGFV+4
CTGFVIND EQU   CTGFV+16
CTGFVENT EQU   CTGFV+20
CTGFVEXP EQU   CTGFV+32
CTGFVCRE EQU   CTGFV+36
CTGFVVLT EQU   CTGFV+40
CTGFVSPC EQU   CTGFV+52
CTGFVAMD EQU   CTGFV+56
CTGFVATR EQU   CTGFV+60
CTGFVLRS EQU   CTGFV+68
CTGFVLMT EQU   CTGFV+72
CTGFVGAT EQU   CTGFV+76
CTGFVWKA EQU   CTGFV+88
DSNAME   EQU   0
IODSNAME EQU   0
IODSNID  EQU   IODSNAME
IODSNLN  EQU   IODSNAME+2
IODSN    EQU   IODSNAME+4
IOVOLSER EQU   0
IOVLSID  EQU   IOVOLSER
IOVLSLN  EQU   IOVOLSER+2
IOVLSER  EQU   IOVOLSER+4
DFCPAREA EQU   0
CPFVAREA EQU   DFCPAREA
CPLID    EQU   CPFVAREA
DEFCPL   EQU   CPFVAREA+8
CLSTRID  EQU   CPFVAREA+40
CLSTRFVT EQU   CPFVAREA+48
DATAID   EQU   CPFVAREA+140
DATAFVT  EQU   CPFVAREA+148
FPLAREA  EQU   DFCPAREA+240
CRDTFPL  EQU   FPLAREA
EXDTFPL  EQU   FPLAREA+24
SPACEFPL EQU   FPLAREA+48
AMDSBFPL EQU   FPLAREA+72
DSATTFPL EQU   FPLAREA+96
LRECLFPL EQU   FPLAREA+120
DEFWKA   EQU   DFCPAREA+384
NAMESWKA EQU   DEFWKA
NAMWKTLN EQU   NAMESWKA
NAMWK    EQU   NAMESWKA+4
RECVSWKA EQU   DEFWKA+94
RECVSTLN EQU   RECVSWKA
DEFAREAS EQU   0
DEFDATA  EQU   DEFAREAS
DEFAMDSB EQU   DEFDATA
DEFSPACE EQU   DEFDATA+96
DEFPRIME EQU   DEFSPACE
DEFSECND EQU   DEFSPACE+3
DEFSPTYP EQU   DEFSPACE+6
DEFCRDT  EQU   DEFDATA+104
DEFCRYR  EQU   DEFCRDT+1
DEFEXPDT EQU   DEFDATA+112
DEFEXPIR EQU   DEFEXPDT+1
DEFDSATT EQU   DEFDATA+116
DEFSPEED EQU   DEFDSATT
DEFREUS  EQU   DEFDSATT
DEFSHAR  EQU   DEFDSATT+1
DEFSAVE  EQU   DEFAREAS+120
DEFSVCPL EQU   DEFSAVE
DEFSVFPL EQU   DEFSAVE+240
DEFSVDAT EQU   DEFSAVE+384
VOLLIST  EQU   0
VOLLSTLN EQU   VOLLIST
VOLLSTAR EQU   VOLLIST+2
VOLCODE  EQU   VOLLSTAR
VOLSER   EQU   VOLLSTAR+2
OUTBUFFR EQU   0
OUTRECAR EQU   OUTBUFFR
OUTRDF   EQU   OUTBUFFR+2041
OUTRDFFL EQU   OUTRDF
OUTRDFLN EQU   OUTRDF+1
OUTCIDF  EQU   OUTBUFFR+2044
OUTCIDFS EQU   OUTCIDF
OUTCIDLN EQU   OUTCIDF+2
INBUFFR  EQU   0
INRDF    EQU   INBUFFR+2041
INCIDF   EQU   INBUFFR+2044
RSAREC   EQU   0
BASEREC  EQU   0
AIXREC   EQU   0
SHEAPTR  EQU   0
ENTYPE   EQU   0
NAMEDS   EQU   0
NAMEID   EQU   NAMEDS
NAMECI   EQU   NAMEDS+1
ACBADDR  EQU   0
SPSRTREC EQU   0
BLSRTREC EQU   0
IDAAIX   EQU   0
AIXFG    EQU   IDAAIX
AIXPKP   EQU   AIXFG
AIXPL    EQU   IDAAIX+1
AIXPC    EQU   IDAAIX+2
AIXKL    EQU   IDAAIX+4
AIXKY    EQU   IDAAIX+5
MERGTREE EQU   0
MTSTGNO  EQU   MERGTREE
MTBLKREC EQU   MERGTREE+4
MTBLKNO  EQU   MTBLKREC
MTRECNO  EQU   MTBLKREC+2
MTPTR    EQU   MERGTREE+8
MTRBA    EQU   MERGTREE+12
MRSRTREC EQU   0
AMSTP041 EQU   0
AMSTP042 EQU   0
AMSTP043 EQU   0
AMSTP044 EQU   0
DMPTRM   EQU   0
IDCIOCO0 EQU   0
IDCIOIT0 EQU   0
IDCIOST0 EQU   0
IDCIOTM0 EQU   0
IDCIOVY0 EQU   0
IDCIO050 EQU   0
IDCSAAL0 EQU   0
IDCSACL0 EQU   0
IDCSACR0 EQU   0
IDCSADE0 EQU   0
IDCSADL0 EQU   0
IDCSADQ0 EQU   0
IDCSAFS0 EQU   0
IDCSAGS0 EQU   0
IDCSAID0 EQU   0
IDCSALC0 EQU   0
IDCSALD0 EQU   0
IDCSALK0 EQU   0
IDCSANQ0 EQU   0
IDCSAPR0 EQU   0
IDCSAPT0 EQU   0
IDCSARC0 EQU   0
IDCSARV0 EQU   0
IDCSASC0 EQU   0
IDCSASI0 EQU   0
IDCSASN0 EQU   0
IDCSASS0 EQU   0
IDCSAST0 EQU   0
IDCSAUC0 EQU   0
IDCSAWO0 EQU   0
IDCSA060 EQU   0
IDCST010 EQU   0
ISORT    EQU   0
LISTTEST EQU   0
NEWERID1 EQU   5
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTDBG   EQU   GDTTBL+40
GDTSTC   EQU   GDTTBL+44
GDTPRT   EQU   GDTTBL+48
GDTESS   EQU   GDTTBL+52
GDTESA   EQU   GDTTBL+56
GDTRST   EQU   GDTTBL+60
GDTRES   EQU   GDTTBL+64
GDTCAL   EQU   GDTTBL+68
GDTGSP   EQU   GDTTBL+72
GDTFSP   EQU   GDTTBL+76
GDTGPL   EQU   GDTTBL+80
GDTFPL   EQU   GDTTBL+84
GDTLOD   EQU   GDTTBL+88
GDTDEL   EQU   GDTTBL+92
GDTPRL   EQU   GDTTBL+96
GDTEPL   EQU   GDTTBL+100
GDTTIM   EQU   GDTTBL+104
GDTIIO   EQU   GDTTBL+108
GDTTIO   EQU   GDTTBL+112
GDTOPN   EQU   GDTTBL+124
GDTCLS   EQU   GDTTBL+128
GDTGET   EQU   GDTTBL+132
GDTPUT   EQU   GDTTBL+136
GDTPOS   EQU   GDTTBL+140
GDTCPY   EQU   GDTTBL+144
GDTCAT   EQU   GDTTBL+148
GDTSNP   EQU   GDTTBL+164
GDTVFY   EQU   GDTTBL+172
GDTECT   EQU   GDTTBL+188
GDTUID   EQU   GDTTBL+192
GDTPMT   EQU   GDTTBL+196
GDTCIR   EQU   GDTTBL+200
GDTLNK   EQU   GDTTBL+204
GDTALC   EQU   GDTTBL+208
GDTDLC   EQU   GDTTBL+212
GDTQAL   EQU   GDTTBL+216
GDTSTW   EQU   GDTTBL+220
GDTSSC   EQU   GDTTBL+224
GDTENQ   EQU   GDTTBL+228
GDTRSV   EQU   GDTTBL+232
GDTDEQ   EQU   GDTTBL+236
GDTSFO   EQU   GDTTBL+240
GDTWTO   EQU   GDTTBL+244
GDTSCR   EQU   GDTTBL+248
GDTUNT   EQU   GDTTBL+252
GDTRCT   EQU   GDTTBL+256
GDTIFO   EQU   GDTTBL+260
GDTEXP   EQU   GDTTBL+264
GDTSTA   EQU   GDTTBL+268
GDTERR   EQU   GDTTBL+272
GDTUNC   EQU   GDTTBL+276
GDTLOC   EQU   GDTTBL+280
FDTTBL   EQU   0
FDTPTR   EQU   FDTTBL+8
LASTCC   EQU   0
OTYPE    EQU   0
OIOCS    EQU   0
OINDX    EQU   0
OIOINPT  EQU   0
JCIOIN   EQU   0
JCIOINPT EQU   JCIOIN
MAINI    EQU   0
MAINAMDS EQU   0
MAIAMBAS EQU   MAINAMDS
MAIAMAIX EQU   MAINAMDS+4
MAINIOCS EQU   0
MAIOCSPT EQU   MAINIOCS
MAINIOIN EQU   0
MAINSTAT EQU   0
MASAVERC EQU   MAINSTAT
FINIOCS  EQU   0
FIIOCSBS EQU   FINIOCS
FIIOCSAX EQU   FINIOCS+4
FIIOCSSR EQU   FINIOCS+8
FINSTAT  EQU   0
FISAVERC EQU   FINSTAT
FISTID   EQU   FINSTAT+2
TERMIOCS EQU   0
TEIOCSPT EQU   TERMIOCS
TERMIOIN EQU   0
TERSRTTB EQU   0
LOCAMDSB EQU   0
LOAMDSPT EQU   LOCAMDSB
LOCIOCS  EQU   0
LOIOCSPT EQU   LOCIOCS
LOCI     EQU   0
LOCSTAT  EQU   0
LOSTID   EQU   LOCSTAT+2
CATLOCNO EQU   0
CATLOCNM EQU   0
CATLOCCI EQU   0
CATLOCDT EQU   0
CATLOPTR EQU   CATLOCDT
CATLOCI  EQU   0
CATSTAT  EQU   0
CASTID   EQU   CATSTAT+2
DEFCALID EQU   0
DEFIOIN  EQU   0
DFIOINPT EQU   DEFIOIN
DEFIOCS  EQU   0
DFIOCSSR EQU   DEFIOCS+8
DEFSRTTB EQU   0
DEFSTAT  EQU   0
DFSTID   EQU   DEFSTAT+2
DELTIOIN EQU   0
DLIOINPT EQU   DELTIOIN
INITAMDS EQU   0
INIAMBAS EQU   INITAMDS
INIAMAIX EQU   INITAMDS+4
INITIOCS EQU   0
INITIOIN EQU   0
INITSRTB EQU   0
INITSTAT EQU   0
INSTID   EQU   INITSTAT+2
CNTLAMDS EQU   0
CNTLIOCS EQU   0
CNIOCSBS EQU   CNTLIOCS
CNIOCSSR EQU   CNTLIOCS+8
CNTLIOIN EQU   0
CNIOINPT EQU   CNTLIOIN
CNTLSRTB EQU   0
CNTLSTAT EQU   0
CNSAVERC EQU   CNTLSTAT
SORTAMDS EQU   0
SORAMBAS EQU   SORTAMDS
SORAMAIX EQU   SORTAMDS+4
SORTIOCS EQU   0
SOIOCSBS EQU   SORTIOCS
SORTIOIN EQU   0
SORTSRTB EQU   0
SORTSTAT EQU   0
SOSAVERC EQU   SORTSTAT
SORTCLID EQU   0
SPILIOCS EQU   0
SPIOCSSR EQU   SPILIOCS+8
SPILIOIN EQU   0
SPILSRTB EQU   0
SPILSTAT EQU   0
BLRECPTR EQU   0
BLDAMDS  EQU   0
BLDAMBAS EQU   BLDAMDS
BLDAMAIX EQU   BLDAMDS+4
BLDIOCS  EQU   0
BLIOCSAX EQU   BLDIOCS+4
BLDSRTB  EQU   0
BLDSTAT  EQU   0
BLSAVERC EQU   BLDSTAT
MERGAMDS EQU   0
MERGIOCS EQU   0
MRIOCSSR EQU   MERGIOCS+8
MERGIOIN EQU   0
MRIOINPT EQU   MERGIOIN
MERGSRTB EQU   0
MERGSTAT EQU   0
@NM00045 EQU   CTGDDNM
CTGPROB  EQU   @NM00045
CTGREASN EQU   CTGPROB+2
CHARRBA  EQU   IOCRBA
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
CTGREAS2 EQU   CTGREASN+1
CTGREAS1 EQU   CTGREASN
CTGMODID EQU   CTGPROB
MRSTID   EQU   MERGSTAT+2
MRSAVERC EQU   MERGSTAT
MRIOCSAX EQU   MERGIOCS+4
MRIOCSBS EQU   MERGIOCS
MERAMAIX EQU   MERGAMDS+4
MERAMBAS EQU   MERGAMDS
BLSTID   EQU   BLDSTAT+2
BLIOCSSR EQU   BLDIOCS+8
BLIOCSBS EQU   BLDIOCS
SPSTID   EQU   SPILSTAT+2
SPSAVERC EQU   SPILSTAT
SPIOINPT EQU   SPILIOIN
SPIOCSAX EQU   SPILIOCS+4
SPIOCSBS EQU   SPILIOCS
SOSTID   EQU   SORTSTAT+2
SOIOINPT EQU   SORTIOIN
SOIOCSSR EQU   SORTIOCS+8
SOIOCSAX EQU   SORTIOCS+4
CNSTID   EQU   CNTLSTAT+2
CNIOCSAX EQU   CNTLIOCS+4
CNTAMAIX EQU   CNTLAMDS+4
CNTAMBAS EQU   CNTLAMDS
INSAVERC EQU   INITSTAT
INIOINPT EQU   INITIOIN
INIOCSPT EQU   INITIOCS
DFSAVERC EQU   DEFSTAT
DFIOCSAX EQU   DEFIOCS+4
DFIOCSBS EQU   DEFIOCS
CASAVERC EQU   CATSTAT
LOSAVERC EQU   LOCSTAT
TEIOINPT EQU   TERMIOIN
MASTID   EQU   MAINSTAT+2
MAIOINPT EQU   MAINIOIN
FDTVERB  EQU   FDTTBL
GDTPSB   EQU   GDTTBL+184
GDTUPT   EQU   GDTTBL+180
GDTCMB   EQU   GDTTBL+176
GDTSPR   EQU   GDTTBL+168
@NM00001 EQU   GDTTBL+160
GDTABH   EQU   GDTTBL+156
GDTABT   EQU   GDTTBL+152
GDTTOH   EQU   GDTTBL+120
GDTRIP   EQU   GDTTBL+116
GDTIOH   EQU   GDTTBL+36
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
@NM00080 EQU   MERGTREE+2
@NM00079 EQU   AIXFG
INCIDLN  EQU   INCIDF+2
INCIDFS  EQU   INCIDF
INRDFLN  EQU   INRDF+1
INRDFFL  EQU   INRDF
INRECAR  EQU   INBUFFR
@NM00072 EQU   DEFDATA+118
@NM00071 EQU   DEFDSATT+1
@NM00070 EQU   DEFDSATT+1
@NM00069 EQU   DEFDSATT
@NM00068 EQU   DEFDSATT
@NM00067 EQU   DEFEXPDT
@NM00066 EQU   DEFCRDT+4
DEFCRDAY EQU   DEFCRDT+2
@NM00065 EQU   DEFCRDT
@NM00064 EQU   DEFDATA+103
RECVSVOL EQU   RECVSWKA+4
RECVSRLN EQU   RECVSWKA+2
NAMRET   EQU   NAMWK+1
NAMTYPE  EQU   NAMWK
NAMWKRLN EQU   NAMESWKA+2
@NM00063 EQU   FPLAREA+136
@NM00062 EQU   FPLAREA+112
@NM00061 EQU   FPLAREA+88
@NM00060 EQU   FPLAREA+64
@NM00059 EQU   FPLAREA+40
@NM00058 EQU   FPLAREA+16
@NM00057 EQU   CPFVAREA+36
CTGFVPWD EQU   CTGFV+84
CTGFVNAM EQU   CTGFV+80
CTGFVUPG EQU   CTGFVGAT
CTGFVEXT EQU   CTGFVLMT
CTGFVBUF EQU   CTGFV+64
CTGFVFSN EQU   CTGFVAMD
CTGFVTTR EQU   CTGFVSPC
CTGFVDVT EQU   CTGFV+48
CTGFVRNG EQU   CTGFV+44
CTGFVOWN EQU   CTGFV+28
CTGFVSTY EQU   CTGFV+24
CTGFVVCH EQU   CTGFV+12
CTGFVICH EQU   CTGFV+8
@NM00050 EQU   CTGFV+3
CTGFVELM EQU   CTGFV+2
@NM00049 EQU   CTGFVPRO
CTGFVDRC EQU   CTGFVPRO
CTGFVNDC EQU   CTGFVPRO
CTGFVRVL EQU   CTGFVPRO
CTGFVAVL EQU   CTGFVPRO
AMDEXCP  EQU   AMDSTAT+44
AMDNCAS  EQU   AMDSTAT+40
AMDNCIS  EQU   AMDSTAT+36
AMDASPA  EQU   AMDSTAT+32
AMDRETR  EQU   AMDSTAT+28
AMDUPR   EQU   AMDSTAT+24
AMDIREC  EQU   AMDSTAT+20
AMDDELR  EQU   AMDSTAT+16
AMDNEXT  EQU   AMDSTAT+10
AMDNIL   EQU   AMDSTAT+8
AMDSTSP  EQU   AMDSTAT
@NM00048 EQU   IDAAMDSB+41
@NM00047 EQU   AMDATTR3
AMDLM    EQU   AMDATTR3
AMDWAIT  EQU   AMDATTR3
AMDBIND  EQU   AMDATTR3
AMDFAULT EQU   AMDATTR3
AMDPARDB EQU   IDAAMDSB+36
AMDMAXRR EQU   AMDSSRBA
AMDNSLOT EQU   AMDHLRBA
AMDFSCI  EQU   IDAAMDSB+16
AMDFSCA  EQU   IDAAMDSB+14
AMDCIPCA EQU   IDAAMDSB+12
AMDPCTCI EQU   IDAAMDSB+11
AMDPCTCA EQU   IDAAMDSB+10
AMDSPAN  EQU   AMDATTR
AMDRRDS  EQU   AMDATTR
AMDRANGE EQU   AMDATTR
AMDORDER EQU   AMDATTR
AMDREPL  EQU   AMDATTR
AMDSDT   EQU   AMDATTR
AMDWCK   EQU   AMDATTR
AMDSBID  EQU   IDAAMDSB
CTGFLDWA EQU   CTGFL+4
CTGFLDTS EQU   CTGFLDRE
@NM00046 EQU   CTGFLDRE
CTGFLDGC EQU   CTGFL+2
@NM00044 EQU   CTGFBFLG
CTGNGDSN EQU   CTGFBFLG
CTGGDGB  EQU   CTGFBFLG
CTGKEEP  EQU   CTGFBFLG
CTGPAR   EQU   CTGFBFLG
CTGFDBK  EQU   CTGNEWNM
@NM00043 EQU   CTGDSORG
CTGCVOL  EQU   CTGCAT
@NM00042 EQU   CTGOPTN4
CTGBYPMT EQU   CTGOPTN4
@NM00041 EQU   CTGOPTN4
CTGDOCAT EQU   CTGOPTN4
CTGLBASE EQU   CTGOPTN4
CTGSRH   EQU   CTGOPTN3
CTGGDGL  EQU   CTGOPTN3
CTGSUPLT EQU   CTGOPTN3
@NM00040 EQU   CTGOPTN2
CTGSCR   EQU   CTGOPTN2
CTGOVRID EQU   CTGOPTN2
CTGDISC  EQU   CTGOPTN2
CTGGTNXT EQU   CTGOPTN2
CTGRCATN EQU   CTGVMNT
CTGGTALL EQU   CTGREL
CTGNSVS  EQU   CTGEXT
CTGGENLD EQU   CTGOPTN1
CTGREAD  EQU   CTGOPTN1
CTGUPD   EQU   CTGOPTN1
CTGCI    EQU   CTGOPTN1
CTGMAST  EQU   CTGOPTN1
WFLE2LEN EQU   WFLE2
WFLE1LEN EQU   WFLE1
CATLEN   EQU   CAT+20
CATMEM   EQU   CAT+12
CATMLN   EQU   CAT+11
CATFUQ   EQU   CATFLG
CATPOS   EQU   CAT+9
ODSMEM   EQU   @NM00039+12
ODSMLN   EQU   @NM00039+11
ODSPOS   EQU   @NM00039+9
OFILELEN EQU   @NM00038+9
IDSMEM   EQU   IDS+12
IDSMLN   EQU   IDS+11
IDSPOS   EQU   IDS+9
IFILELEN EQU   IFILE+9
@NM00037 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00036 EQU   DMPITM+15
DMPITMTP EQU   DMPITM+14
DMPITMLN EQU   DMPITM+12
DMPITMPT EQU   DMPITM+8
DMPITMNM EQU   DMPITM
@NM00035 EQU   ERCNVTAB+24
ERDSNM   EQU   ERCNVTAB+12
@NM00034 EQU   ERCNVTAB+4
@NM00033 EQU   ERCNVTAB+3
@NM00032 EQU   EROSOPER
EROSUCDX EQU   EROSOPER
EROSCATL EQU   EROSOPER
@NM00031 EQU   EROPER
ERCATAL  EQU   EROPER
ERCATDL  EQU   EROPER
@NM00030 EQU   ERTYPE
EROSCAT  EQU   ERTYPE
@NM00029 EQU   FMTCNVF+1
FMTAR    EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00028 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00027 EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGPCT  EQU   DARGINL
DARGREP  EQU   DARGINS
@NM00026 EQU   DARGLIST+19
DARGIND  EQU   DARGLIST+18
DARGRETL EQU   DARGLIST+16
DARGSENT EQU   DARGSTID+3
DARGSMOD EQU   DARGSTID
DARGRETP EQU   DARGLIST+4
UVOLVOL  EQU   UVOLENT+4
UVOLDEV  EQU   UVOLENT
UVOLCNT  EQU   UVOLLIST
@NM00025 EQU   IOINFOPT
IOINFTMS EQU   IOINFOPT
IOINFDVT EQU   IOINFOPT
OPNVOL   EQU   OPNAGL+44
@NM00024 EQU   OPNAGL+43
@NM00023 EQU   OPNOPT2
OPNOPTJM EQU   OPNOPT2
@NM00022 EQU   OPNOPT2
OPNOPTAS EQU   OPNOPT2
@NM00021 EQU   OPNDSO
OPNDSOPO EQU   OPNDSO
OPNDSOIS EQU   OPNDSO
OPNDSOPS EQU   OPNDSO
OPNDSOAM EQU   OPNDSO
OPNKYL   EQU   OPNAGL+40
OPNBLK   EQU   OPNAGL+36
OPNREC   EQU   OPNAGL+32
OPNDEVIX EQU   OPNDEV+4
OPNDEVDT EQU   OPNDEV
OPNCBP   EQU   OPNAGL+20
OPNMODRP EQU   OPNMOD
OPNMODRR EQU   OPNMOD
OPNMODRC EQU   OPNMOD
OPNMODAC EQU   OPNMOD
OPNMODPD EQU   OPNMOD
@NM00020 EQU   OPNTYP
OPNTYPRV EQU   OPNTYP
OPNTYPEX EQU   OPNTYP
OPNTYPRA EQU   OPNTYP
OPNTYPXM EQU   OPNTYP
OPNTYPCI EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00019 EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNRFMSF EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNRFMFX EQU   OPNRFM
OPNOPTSK EQU   OPNOPT
OPNOPTCR EQU   OPNOPT
IOCEXT   EQU   IOCSTR+64
IOCREL   EQU   IOCSTR+60
IOCRRN   EQU   IOCSTR+52
IOCPNM   EQU   IOCNWM+2
IOCVRC   EQU   IOCTTR
IOCCBP   EQU   IOCSTR+36
IOCVOLSR EQU   IOCSTR+22
@NM00018 EQU   IOCMSG
IOCMSGAE EQU   IOCMSG
IOCMSGCE EQU   IOCMSG
IOCMSGOE EQU   IOCMSG
IOCMSGOP EQU   IOCMSG
@NM00017 EQU   IOCMSG
IOCCHPSY EQU   IOCCHP
IOCCHPAS EQU   IOCCHP
IOCCHPBK EQU   IOCCHP
IOCCHPCR EQU   IOCCHP
IOCCHPKS EQU   IOCCHP
IOCCHPSK EQU   IOCCHP
IOCCHPDR EQU   IOCCHP
IOCCHPSQ EQU   IOCCHP
@NM00016 EQU   IOCMAC2
@NM00015 EQU   IOCMAC2
IOCMACCP EQU   IOCMAC2
IOCMACRR EQU   IOCMAC2
IOCMACAS EQU   IOCMAC2
IOCMACSK EQU   IOCMAC2
@NM00014 EQU   IOCMAC
IOCMACCC EQU   IOCMAC
IOCMACDR EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACCR EQU   IOCMAC
IOCMACUP EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00013 EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMFX EQU   IOCRFM
@NM00012 EQU   IOCDSO
IOCDSOPO EQU   IOCDSO
IOCDSOIS EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
IOCDSOAM EQU   IOCDSO
IOCRKP   EQU   IOCSTR+13
IOCTRN   EQU   IOCSTR+8
UNITVTOC EQU   UNITABL+7
@NM00011 EQU   UNITSTAT
UNITUSHR EQU   UNITSTAT
UNITXSHR EQU   UNITSTAT
UNITISHR EQU   UNITSTAT
UNITUA   EQU   @NM00010+1
UNITCHA  EQU   @NM00010
UNITUCB  EQU   UNITABL
ALLUNCNT EQU   ALLAGL+30
ALLVLCNT EQU   ALLAGL+29
@NM00009 EQU   ALLOPT
ALLOPTUN EQU   ALLOPT
ALLOPTPV EQU   ALLOPT
ALLOPTDS EQU   ALLOPT
ALLOPTVL EQU   ALLOPT
@NM00008 EQU   ALLORG+1
ALLORGVS EQU   ALLORG+1
@NM00007 EQU   ALLORG+1
ALLORGGS EQU   ALLORG+1
ALLORGUN EQU   ALLORG
ALLORGPO EQU   ALLORG
ALLORGMQ EQU   ALLORG
ALLORGCQ EQU   ALLORG
ALLORGCX EQU   ALLORG
ALLORGDA EQU   ALLORG
ALLORGPS EQU   ALLORG
ALLORGIS EQU   ALLORG
ALLDSPUN EQU   ALLDSP
ALLDSPCG EQU   ALLDSP
ALLDSPDE EQU   ALLDSP
ALLDSPKP EQU   ALLDSP
@NM00006 EQU   ALLDSP
ALLSTSOD EQU   ALLSTS
ALLSTSMD EQU   ALLSTS
ALLSTSNW EQU   ALLSTS
ALLSTSSR EQU   ALLSTS
@NM00005 EQU   ALLSTS
ALLPWD   EQU   ALLAGL+20
ALLVLP   EQU   ALLAGL+16
ALLULP   EQU   ALLAGL+12
ALLDDN   EQU   ALLAGL+4
ALLDSN   EQU   ALLAGL
CIRPID   EQU   CIRAGL+28
CIRPWD   EQU   CIRAGL+24
CIRCAT   EQU   CIRAGL+20
CIRWKP   EQU   CIRAGL+16
CIRTLR   EQU   CIRAGL+12
CIRHDR   EQU   CIRAGL+8
CIRTLN   EQU   CIRAGL+6
CIRHLN   EQU   CIRAGL+4
@NM00004 EQU   CIRAGL+1
@NM00003 EQU   CIRTYPE
CIRTYPAQ EQU   CIRTYPE
CIRTYP1Q EQU   CIRTYPE
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00002 EQU   OLDERID1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RC00268 EQU   @RC00265
@RF00291 EQU   @RC00265
@RC00301 EQU   @RC00295
@RF00324 EQU   @RC00295
@RC00385 EQU   @RC00384
@RT00452 EQU   @EL00004
@RC00524 EQU   @RC00520
@RC00568 EQU   @RC00567
@RC00702 EQU   @RC00690
@RC00694 EQU   @RC00690
@RC00759 EQU   @RC00758
@RC00893 EQU   @RC00892
@RC00958 EQU   @RC00957
@RC01007 EQU   @RC01006
@RF01124 EQU   @RC01107
@RF01147 EQU   @EL00012
@RC01202 EQU   @RC01201
@RC01253 EQU   @RC01249
@RC01245 EQU   @RC01233
@RF01674 EQU   @RC01667
@RC01728 EQU   @EL00017
@RF01755 EQU   @RC01749
@PB00016 EQU   @EL00001
@RF00271 EQU   @RC00268
@RF00304 EQU   @RC00301
@RC00695 EQU   @RC00694
@PB00015 EQU   @PB00016
@PB00014 EQU   @PB00015
@PB00013 EQU   @PB00014
@PB00012 EQU   @PB00013
@PB00011 EQU   @PB00012
@PB00010 EQU   @PB00011
@PB00009 EQU   @PB00010
@PB00008 EQU   @PB00009
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IDCBI01,(C'PLS1851',0701,76288)

         MACRO ,
&LAB IPCSLMSG &REG,&DUMPREG,&MSG,&MSGOFF,&L2,&OUTDCB,&PRDCB,&WORK=LINE
.*
.*   THIS MACRO GENERATES AN IPCS CALL TO GET THE STORAGE
.*   SPECIFIED IN PARM FROM FROM THE DUMP AN LOAD ITS ADDRESS
.*   INTO REGISTER REG.
.*
.*         #########################################################
.*   NOTE: #  THE RENTR AND REXIT MACROS WITH ENV=IPCS MUST BE
.*         #  USED IN PROGRAMS USING THIS MACRO
.*         #########################################################
.*
.*   REGISTER  &REG IS MODIFIED BY THIS MACRO.
.*
.* FORMAT:
.*LABEL IPCSLOAD REG,FROMADDR,LEN=20,PERM=TCBAREA
.*
.*   PARMS:
.*
.*   REG  - A REGISTER NUMBER.  THE ADDRESS ACCESSABLE BY
.*          THE PROGRAM IS LISTED HERE.
.*
.*   FROM - THE ADDRESS TO BE LOADED.
.*          IF (REG) IS SPECIFIED, THE REGISTER IS ASSUMED TO HAVE
.*          THE DUMP ADDRESS TO BE ACCESSED.  OTHERWISE, THE PASSED
.*          SYMBOL IS LOADED, AND THE ADDRESS IS ASSUMED TO BE AN
.*          ADDRESS IN THE DUMP.
.*
.*   LEN  - THIS IS THE LENGTH OF THE STORAGE TO REQUEST FROM THE
.*          DUMP.  THIS CAN BE A SYMBOL < WITH A VALUE UP TO 4096
.*          OR A REGISTER (REG).
.*
.*   PERM - THIS IS AN ADDRESS (OR REGISTHER (REG) WHICH IS AT LEAST
.*          LEN= BYTES LONG.  THE DATA FROM THE CALL IS COPIED TO THIS
.*          AREA.  THIS AREA IS THEN RETURNED IN REG.
.*
.*   SA   - THIS IS A WORK AREA OF AT LEAST 16 BYTES USED TO PROTECT
.*          REGISTERS.  A DEFAULT IS GIVEN FOR BEAUTIFICATION REASONS.
.*
.* SAMPLE:
.*       IPCSLOAD R5,TCBTCB,LEN=TCBLEN
.*
.*
         LCLC  &IDX
&IDX     SETC  '&SYSNDX'
&LAB     LTR   &REG,&REG
         BNZ   ISOK&IDX
         AIF   ('&MSG' EQ '&WORK').NOMOVE
         SPACE
         MVC   &WORK,&MSG
.NOMOVE  ANOP
         AIF   ('&DUMPREG' EQ '').NODUMP
         SPACE
         ST    &DUMPREG,AREA24
         UNPK  &WORK+&MSGOFF.(9),AREA24(5)
         TR    &WORK+&MSGOFF.(8),HEXCHAR
         MVI   &WORK+&MSGOFF+8,C' '
.NODUMP  ANOP
         AIF   ('&OUTDCB' EQ '').NOOUT
         PUT31 AREA24,&OUTDCB,&WORK
         AIF   ('&L2' EQ '').NOL2
         PUT31 AREA24,&OUTDCB,&L2
.NOL2    ANOP
.NOOUT   AIF   ('&PRDCB' EQ '').NOPR
         VSMPRNT AREA24,&PRDCB,&WORK
.NOPR    ANOP
ISOK&IDX DS    0H
         MEND

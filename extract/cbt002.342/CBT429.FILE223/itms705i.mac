ITMS507I CLIST
&CONTROL ERR
*
*  PARSE MESSAGE IEC705I
*
*  MESSAGE   = IEC705I TAPE ON XXX,070023,SL,COMP,JOBN,PROCSTEP,TAPEDSN
*  VARIABLES = MSGID   TAPE ON U   VOLSER LT C    JN   PN       DSN
*
*
GETMLINE LINE 1
PARSEL2R LINE MSGID TAPE ON P4 P5
*
*  PARSE OUT 4TH PARAMETER FROM ABOVE BUT NOW USING "," AS THE
*  DELIMITER
*
PARSEL2R P4 U /,/ VOLSER /,/ LT /,/ C /,/ JN /,/ PN /,/ DSN
*
*  SET EXPIRATION DATE AND RETENTION PERIOD TO 0
*
&EXPDATE = 0000000
&RETPERD = 0000
*
*  GET THE CURRENT DATE FROM THE SYSTEM
*
&WAIT CONTWAIT SUPPRESS
&WAIT 'MVS D T' *30=-ERROR *ERROR=-ERROR IEE136I=-GOTIT
-GOTIT
GETMLINE IEELINE 1
PARSEL2R IEELINE MSGID2 LOCAL TIME DATE REST
&YEAR = &SUBSTR &DATE 6 4
&DAY  = &SUBSTR &DATE 11 3
&CURDATE = &CONCAT &YEAR &DAY
*
&IF .&DSN = . &THEN &GOTO -NODSN
*
*  LOOKUP THE RETENTION PERIOD FOR THE TAPE DATASET
*
&IF &SUBSTR &DSN 1 4   = IAT.                   &THEN &RETPERD = 210
&IF &SUBSTR &DSN 1 12  = TDB2.ARCHLOG           &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 20  = TDB2.WEEKLY.IMAGCOPY   &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 12  = DDB2.ARCHLOG           &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 20  = DDB2.WEEKLY.IMAGCOPY   &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 22  = DDB2.MAINTMGT.IMAGCOPY &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 21  = DDB2.SURFACE.IMAGCOPY  &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 12  = QDB2.ARCHLOG           &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 20  = QDB2.WEEKLY.IMAGCOPY   &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 22  = QDB2.MAINTMGT.IMAGCOPY &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 21  = QDB2.SURFACE.IMAGCOPY  &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 12  = PDB2.ARCHLOG           &THEN &RETPERD = 49
&IF &SUBSTR &DSN 1 20  = PDB2.WEEKLY.IMAGCOPY   &THEN &RETPERD = 49
&IF &SUBSTR &DSN 1 22  = PDB2.MAINTMGT.IMAGCOPY &THEN &RETPERD = 49
&IF &SUBSTR &DSN 1 21  = PDB2.SURFACE.IMAGCOPY  &THEN &RETPERD = 49
&IF &SUBSTR &DSN 1 22  = PDB2.BLACKLST.IMAGCOPY &THEN &RETPERD = 49
&IF &SUBSTR &DSN 1 12  = CDB2.ARCHLOG           &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 20  = CDB2.WEEKLY.IMAGCOPY   &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 22  = CDB2.MAINTMGT.IMAGCOPY &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 21  = CDB2.SURFACE.IMAGCOPY  &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 22  = CDB2.BLACKLST.IMAGCOPY &THEN &RETPERD = 14
&IF &SUBSTR &DSN 1 13  = AFCPROD.OLMAC          &THEN &RETPERD = 30
&IF &SUBSTR &DSN 1 16  = AFCPROD.DB2TABLE       &THEN &RETPERD = 761
&IF &SUBSTR &DSN 1 16  = AFCPROD.TKTSTOCK       &THEN &RETPERD = 761
&IF &SUBSTR &DSN 1 13  = AFCQUAL.OLMAC          &THEN &RETPERD = 30
&IF &SUBSTR &DSN 1 13  = AFCDEVL.OLMAC          &THEN &RETPERD = 1
&IF &SUBSTR &DSN 1 13  = AFCUNIT.OLMAC          &THEN &RETPERD = 1
&IF &SUBSTR &DSN 1 13  = AFCBCRG.OLMAC          &THEN &RETPERD = 60
&IF &SUBSTR &DSN 1 16  = AFCBCRG.BLACKLST       &THEN &RETPERD = 60
&IF &SUBSTR &DSN 1 13  = AFCACRG.OLMAC          &THEN &RETPERD = 1
&IF &SUBSTR &DSN 1 10  = DUMP.DAILY             &THEN &RETPERD = 13
&IF &SUBSTR &DSN 1 11  = DUMP.WEEKLY            &THEN &RETPERD = 20
&IF &SUBSTR &DSN 1 12  = DUMP.LOGICAL           &THEN &RETPERD = 30
&IF &SUBSTR &DSN 1 13  = SYSP.DMS.ARCH          &THEN &RETPERD = 30
&IF &SUBSTR &DSN 1 13  = SYSP.DMS.COPY          &THEN &RETPERD = 30
&IF &SUBSTR &DSN 1 16  = SMF.AFC1.MONTHLY       &THEN &RETPERD = 365
&IF &SUBSTR &DSN 1 16  = SMF.AFC2.MONTHLY       &THEN &RETPERD = 365
&IF &SUBSTR &DSN 1 20  = AFCBCRG.RAD.EU65ARCH   &THEN &RETPERD = 2560
&IF &SUBSTR &DSN 1 19  = AFCBCRG.RAD.INVARCH    &THEN &RETPERD = 1550
&IF &SUBSTR &DSN 1 28 = AFCBCRG.RAD.PEU65LGM.ARCHIVE &THEN &RETPERD = 60
&IF &SUBSTR &DSN 1 28 = AFCBCRG.RAD.PEU65LGD.ARCHIVE &THEN &RETPERD = 60
&IF &SUBSTR &DSN 1 27 = AFCBCRG.RAD.TUSAGEM.ARCHIVE &THEN &RETPERD = 60
&IF &SUBSTR &DSN 1 27 = AFCBCRG.RAD.TSALESM.ARCHIVE &THEN &RETPERD = 60
*
* IF DSN IS NOT IN THE TABLE DO NOT SET AN EXPIRATION DATE
*
&IF &RETPERD = 0000 &THEN &GOTO -NODSN
*
* SET EXPIRATION DAY AND EXPIRATION YEAR
*
&EXPYEAR = &YEAR
&EXPDAY = &DAY + &RETPERD
*
* HANDLE EXPIRATION DAY BEING GREATER THAN 365
*
-YEARCHK
&IF &EXPDAY LE 365 &THEN &GOTO -SETEXPDT
&EXPYEAR = &EXPYEAR + 1
&EXPDAY = &EXPDAY - 365
&GOTO -YEARCHK
*
* SET THE EXPIRATION DATE
*
-SETEXPDT
&IF &LENGTH &EXPDAY = 1 &THEN &EXPDAY = &CONCAT 00 &EXPDAY
&IF &LENGTH &EXPDAY = 2 &THEN &EXPDAY = &CONCAT 0 &EXPDAY
&EXPDATE = &CONCAT &EXPYEAR &EXPDAY
*
* IF DATA SET NAME DOES NOT MATCH ANY TABLE ENTRY, THEN LEAVE
* EXPIRATION DATE AS 0000000, ITMS PROGRAM WILL HANDLE AS AN
* EXCEPTION
*
-NODSN
&WRITE S ITMS,P1=C,P2=,&VOLSER,P3=,&CURDATE,P4=,&EXPDATE,P5=,&DSN
MVS S ITMS,P1='C,',P2='&VOLSER,',P3='&CURDATE,',P4='&EXPDATE,',P5=&DSN
&EXIT 0
-ERROR
*
* TIMEOUT ERROR WHEN NETVIEW ATTEMPTS TO FIND OUT THE CURRENT DATE
*
WTOR ITMS FAILED TO RECORD TAPE VOLSER, NOTIFY SYSTEM SUPPORT
&EXIT 8

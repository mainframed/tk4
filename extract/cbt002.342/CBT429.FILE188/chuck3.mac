00010000PROC 1 MOD OUTF() LIST SYMLIST CONLIST MSG TEST SHOW
00020000
00030000/***************************************************************
00040000/*
00050000/*   CLIST SRCIDX SEARCHES THE DATASET
00060000/*        'WUI.SRCIDX.DATA' WHICH WAS CREATED TO
00070000/*        HAVE LOCATIONS OF ALL AVAILABLE SOURCE
00080000/*        MODULES. THIS CLIST WILL CHECK THAT LIST
00090000/*        FOR THE LOCATION OF A PARTICULAR MODULE
00100000/*        AND THEN GENERATE THE JCL REQUIRED TO LIST
00110000/*        IT FOR YOU.
00120000/*                                   CHARLES D. GLASS
00130000/*                                   1 OCTOBER 1985
00140000/*                                   MODIFIED BY JEFFREY R. BROI
00150000/*
00160000/***************************************************************
00170000
00180000CKO
00190000IF &LASTCC ^= 8 THEN DO
00200000  TIME
00210000  EXIT
00220000END
00230000IF &SYMLIST ^= THEN CONTROL SYM
00240000IF &CONLIST ^= THEN CONTROL CON
00250000IF &LIST    ^= THEN CONTROL LIST
00260000SET &T = &SYSTIME
00270000SET &T = T&SUBSTR(1:2,&T)&SUBSTR(4:5,&T)&SUBSTR(7:8,&T)
00280000IF &MSG = THEN CONTROL NOMSG
00290001FREE F(SYSUT1 SYSPRINT)
00300000CONTROL MSG
00310000ALLOC F(SYSPRINT) DA(*)
00320000IF &LENGTH(&STR(&MOD)) > 8 THEN DO
00330000  WRITE MODULE NAME &STR(&MOD) INVALID
00340000  SET &MOD =
00350000END
00360000DO WHILE (&STR(&MOD) = &STR(*)) OR (&STR(&MOD) =)
00370000  WRITENR PLEASE ENTER NAME OF MODULE TO LOCATE...
00380000  READ &MOD
00390000END
00400000IF &STR(&OUTF) = &STR(*) THEN SET &OUTF = &MOD..ASM
00410000WRITE SEARCHING FOR MODULE NAMED '&MOD' ...
00420000CONTROL NOMS NOPROMPT
00450000WRITENR .
00460000E 'WUI.SRCIDX.DATA' DA
00470000WRITENR .
00480000BOTTOM
00490000SET &MOD1 = &STR(&SUBSTR(1:8,&STR(&MOD       )))
00510000INSERT &STR(&MOD1) NOT IN DATABASE.
00520000WRITENR .
00530000TOP
00540000F /&MOD/1
00550000WRITENR .
00560000MOVE * 1 0
00570000WRITENR .
00580000DOWN
00590000DEL * 999999
00600000WRITENR .
00610000SAVE '&SYSUID..&T..SHMUTZ'
00620000WRITE .
00630000END N
00640000CONTROL PROMPT MS
00650000ALLOC F(SYSUT1) DA(&T..SHMUTZ) SH
00660000OPENFILE SYSUT1 INPUT
00670000GETFILE SYSUT1
00680000IF &SUBSTR(10:12,&STR(&SYSUT1)) = NOT THEN DO
00690000  WRITE &MOD NOT FOUND IN DATABASE.
00700000  GOTO WRAPPER
00710000END
00720000SET &START = &SUBSTR(52:57,&STR(&SYSUT1))
00730000SET &NRECS = &SUBSTR(66:71,&STR(&SYSUT1))
00740000SET &TAPEL = &SUBSTR(21:26,&STR(&SYSUT1))
00750000SET &FILEN = &SUBSTR(36:39,&STR(&SYSUT1))
00760000WRITE '&MOD' IS IN FILE &FILEN OF TAPE +
00770000  &TAPEL AT RECORD &START FOR &NRECS RECORDS
00780000CONTROL NOMSG
00790000FREE F(X)
00800000CONTROL MSG
00810000ATTR &T LRE(80) BLK(11440) REC(F B)
00820000ALLOC F(X) DA(&T..CNTL) US(&T) SP(1) TR NE
00830000FREE F(&T)
00840000OPENFILE X OUTPUT
00850000SET &X = &STR(// EXEC PGM=IDCAMS)
00860000PUTFILE X
00870000SET &X = &STR(//SYSPRINT DD  SYSOUT=*
00880000PUTFILE X
00890000SET &X = &STR(//IN       DD  DSN=WASTE,VOL=SER=&TAPEL,UNIT=TAPE,
00900000PUTFILE X
00910000SET &X = &STR(//             LABEL=(&FILEN,NL,EXPDT=98000),
00920000PUTFILE X
00930000SET &X = &STR(//             DCB=(BLKSIZE=32720,RECFM=FB,LRECL=8
00940000PUTFILE X
00950000IF &OUTF = THEN +
00960000  SET &X = &STR(//OT       DD  SYSOUT=*
00970000ELSE DO
00980000  CONTROL NOMSG NOPROMPT NOFLUSH
00990000  ALLOC DA(&OUTF) SH
01000000  SET &CC = &LASTCC
01010000  CONTROL MSG
01020000  IF &CC ^= 0 THEN DO
01030000    SET &NTR = ( &NRECS / 586 ) + 1
01040000    ATTR &T BLK(23440) LRE(80) RECF(F B)
01050000    ALLOC DA(&OUTF) US(&T) NE SP(&NTR) TR
01060000    FREE F(&T)
01070000  END
01080000  FREE DA(&OUTF)
01090000  SET &OUTF = &STR(&SYSUID..&OUTF)
01100000  SET &X = &STR(//OT       DD  DSN=&OUTF,DCB=(RECFM=FB,LRECL=80)
01110000  PUTFILE X
01120000  SET &X = &STR(//             UNIT=SYSDA,DISP=OLD)
01130000END
01140000PUTFILE X
01150000SET &X = &STR(//SYSIN    DD  *)
01160000PUTFILE X
01170000SET &SKIP = &STR()
01180000IF &START ^= 1 THEN DO
01190000  SET &START = &START - 1
01200000  SET &SKIP = &STR( SKIP(&START))
01210000END
01220000SET &X = &STR( REPRO INFILE(IN) OUTFILE(OT)&SKIP COUNT(&NRECS)
01230000PUTFILE X
01240000SET &X = &STR(/*)
01250000PUTFILE X
01260000CLOSFILE X
01270000IF &SHOW ^= THEN LIST &T..CNTL
01280000CONTROL PROMPT
01290000SUB &T
01300000DEL &T..CNTL
01310000WRAPPER: CLOSFILE SYSUT1
01320000DEL &T..SHMUTZ

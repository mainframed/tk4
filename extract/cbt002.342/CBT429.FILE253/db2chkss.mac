/*  REXX EXEC : ( DB2CHKSS ).
    FUNCTION  : CALLED BY CCF QA AND PROD TURNOVER PROCESSING SKELETONS
                ( CCFBDB2Q, CCFCDB2Q, AND CCFDYLDB ).
                VERIFIES THE EXISTENCE OF THE PACKAGE/BIND PARMLIB
                WORKORDER MEMBER TO SET CONDITION CODE RETURN FOR
                DB2 SUBSYSTEM NAME FOR V2 OR V3 DB2.
    INPUT     : SYSS.QA.CCF.DB2.TURNOVER.PARMLIB(&WORKORDR).
                                                                     */
TRACE O
/*     */
HOUSE_KEEPING:
ADDRESS TSO
ARG MASTER MEMBER WORKORDR
PARMS = 'MASTER MEMBER WORKORDR'
SRC = 0
DO I = 1 TO 3
   IPARM = WORD(PARMS,I)
   XPARM = VALUE(IPARM)
   IF XPARM ^= '' THEN ITERATE
   SAY '*** PARM ERROR: MISSING PARM VALUE FOR ('IPARM'). ***'
   SAY '*** DB2CHKSS EXEC TASK CANCELLED - RC = (024). ***'
   EXIT 024
END
EXIT 3
/* ***        N O O P        *** */
X = MSG("OFF")
"FREE FILE(TESTDD)"
"FREE FILE(QADD)"
LIBNODE = POS('QASRCE',MASTER)
IF LIBNODE = 0 THEN EXIT 0
ERC = 2
DB2_VERSION3 = 'SYSS.DB2.V3R1M0.'
QACCF = 'SYSS.QA.CCF.DB2.TURNOVER.PARMLIB'
/*     */
MAIN_ROUTINE:
CALL CHECK_QACCF_PARMS
EXIT ERC
/*
       S U B R O U T I N E S   S E C T I O N     */
/*     */
CHECK_QACCF_PARMS:
ADDRESS TSO
DB2PARM = SYSDSN("'"QACCF"("WORKORDR")'")
IF DB2PARM = 'MEMBER NOT FOUND' THEN RETURN
"ALLOC DA('"QACCF"("WORKORDR")') FILE(QADD) SHR"
SRC = RC
IF SRC ^= 0 THEN DO
   SAY '*** DATASET ALLOCATE ERROR: ('QACCF'('WORKORDR'). ***'
   SAY '*** DB2CHKSS EXEC SUBTASK CANCELLED - RETURN CODE: ('SRC'). ***'
   EXIT SRC
END
"EXECIO * DISKR QADD (FINIS STEM QPARM."
SRC = RC
"FREE FILE(QADD)"
IF SRC ^= 0 THEN DO
   SAY '*** EXECIO READ ERROR: ('QACCF'('WORKORDR'). ***'
   SAY '*** DB2CHKSS EXEC TASK CANCELLED - RETURN CODE: ('SRC'). ***'
   EXIT SRC
END
DO I = 1 TO QPARM.0
   PMEMBER = WORD(QPARM.I,1)
   VERSION = WORD(QPARM.I,7)
   IF PMEMBER = MEMBER THEN DO
      DB2VERS = VERSION
      LEAVE
   END
END
IF DB2VERS = DB2_VERSION3 THEN ERC = 3
RETURN

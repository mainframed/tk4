/* REXX EXEC : ( CCFCOBCK )   TURNOVER COMPILE JCL CHECKER
   LIB/CCF COBOL2 QA TURNOVER COMPILE FACILITY TO DETERMINE NATIVE OR
   COMPATIBILITY MODE COMPILE OPTION, AND CHECK FOR CA-OPTIMIZER.   */

TRACE O
/*     */
HOUSE_KEEPING:
ADDRESS TSO
ARG TSOUSER MEMBER
IF TSOUSER = '' × MEMBER = '' THEN DO
   SAY '*** MISSING ARGMENTS FOR CCFCOBCK INVOCATION. ***'
   SAY '+++ TSO USERID AND LIBRARIAN MEMBER NAME MUST BE PASSED ARGMENTS
   SAY '*** CCFCOBCK EXEC MAINTASK CANCELLED. ***'
   EXIT 12
END
C2P = 'APOST,LIB,CMPR2,RES,RENT,DYNAM'
"ALLOC DA('"TSOUSER"."MEMBER".SEQFILE') F(ISPFILE) SHR"
IF RC ^= 0 THEN DO
   SAY '*** DATASET ALLOCATE ERROR:' TSOUSER××'.'××MEMBER××'.'××SEQFILE
   SAY '*** CCFCOBCK EXEC MAINTASK CANCELLED. ***'
   EXIT 12
END
"EXECIO * DISKR ISPFILE (FINIS STEM DATA."
SRC = RC
"FREE F(ISPFILE)"
IF SRC ^= 0 THEN DO
   SAY '*** DATASET EXECIO ERROR:' TSOUSER××'.'××MEMBER××'.'××SEQFILE '*
   SAY '*** CCFCOBCK EXEC MAINTASK CANCELLED. ***'
   EXIT 12
END
/*     */
CHECK_COBOL2_NATIVE_FLAG:
NATIVE_SW = 'NO'
DO I = 1 TO DATA.0
   NOCMPR2 = POS('NOCMPR2-FLAG',DATA.I)
   IF NOCMPR2 ^= 0 THEN DO
      NATIVE_SW = 'YES'
      C2P = 'APOST,LIB,NOCMPR2,RES,RENT,DYNAM'
      LEAVE
   END
END
/*     */
CHECK_OPTIMIZE_FLAG:
OPTIMIZE_SW = 'NO'
DO I = 1 TO DATA.0
   OPTFLAG = POS('OPT2-FLAG',DATA.I)
   IF OPTFLAG ^= 0 THEN DO
      OPTIMIZE_SW = 'YES'
      C2P = 'COPT,APOST,LIB,RES,RENT,DYNAM'
      LEAVE
   END
END
/*     */
CHECK_TURNOVER_COMPILE_TYPE:
IF NATIVE_SW = 'YES' & OPTIMIZE_SW = 'NO'  THEN EXITRC = 1
IF NATIVE_SW = 'NO'  & OPTIMIZE_SW = 'NO'  THEN EXITRC = 2
IF NATIVE_SW = 'YES' & OPTIMIZE_SW = 'YES' THEN EXITRC = 3
IF NATIVE_SW = 'NO'  & OPTIMIZE_SW = 'YES' THEN EXITRC = 4
EXIT EXITRC

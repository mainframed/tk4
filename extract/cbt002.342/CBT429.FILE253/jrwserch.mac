/*  REXX EXEC : ( WOSEARCH )
    FUNCTION  : GENERATE CCF TURNOVER DISPLAY OF MEMBERS TURNED OVER.
    INPUT     : ( SYSS.CCF.TURNOVER.JOURNAL(&&MEMBER)).
    OUTPUT    : DISPLAY ON TSOE.
                                                                      */
/*     */
HOUSE_KEEPING:
ADDRESS TSO
/* PARMS = 'WONUMBR' */
MEMFOUND = 0
MEMDISP = 0
THEDATE = 31
SAY "THIS EXEC WILL SHOW THE LAST TWO TIMES A MEMBER HAS"
SAY "BEEN TURNED OVER WITHIN THE LAST 31 DAYS AND ALL"
SAY "MEMBERS ASSOCIATED WITH THE WORKORDERS USED FOR THE TURNOVERS."
SAY
SAY
SAY "ENTER THE MEMBER NAME YOU WOULD LIKE TO SEARCH FOR"
PULL MODNAME
JOURNAL_PDS = 'TECH209.CCF.TEST.EXECL'
CALL GET_JOURNAL_MEMBER_LIST
CALL READ_JOURNAL_MEMBER
CALL DISPLAY_NO_MEMBERS_FOUND
EXIT
/*   S U B R O U T I N E   S E C T I O N   */
/*     */
GET_JOURNAL_MEMBER_LIST:
X = OUTTRAP("MEMBER.","*","CONCAT")
"LISTDS ('"JOURNAL_PDS"') MEMBERS"
M = MEMBER.0
X = MEMBER.0 - 7
SRC = RC
IF SRC = 0 THEN RETURN
SAY
SAY '*** LISTDS ERROR: ERROR READING ('JOURNAL_PDS') MEMBER LIST. ***'
SAY '*** WOSEARCH EXEC SUBTASK CANCELLED RC = ('SRC'). ***'
EXIT SRC

/*     */
READ_JOURNAL_MEMBER:
DO X                /* SKIP LISTDS HEADER INFO - START AT RCD 7 */
   IF MEMFOUND = 2 THEN LEAVE
   IF THEDATE = 0 THEN LEAVE
   MEMBER = STRIP(MEMBER.M)
/* SAY '+++ PROCESSING JOURNAL MEMBER: ('MEMBER') +++' */
   "ALLOC DA('"JOURNAL_PDS"("MEMBER")') F(JOURDD) SHR"
   "EXECIO * DISKR JOURDD (FINIS STEM DATA."
   "FREE FILE(JOURDD)"
   M = M - 1
   THEDATE = THEDATE - 1
   DO I = 3 TO DATA.0    /* SKIP JOURNAL MEMBER HEADER INFO - START AT R
      PARSE VAR DATA.I PDATE PTIME WORKORDR PROGRAMMER MASTER MODULE MOD
         IF MODULE \= MODNAME THEN ITERATE
           WONUMBR = WORKORDR
           CALL READ_MEMBER_AGAIN
           MEMFOUND = MEMFOUND + 1
           LEAVE
   END
END
RETURN
/*     */
READ_MEMBER_AGAIN:
   DO I = 3 TO DATA.0    /* SKIP JOURNAL MEMBER HEADER INFO - START AT R
      PARSE VAR DATA.I PDATE PTIME WORKORDR PROGRAMMER MASTER MODULE MOD
         IF WORKORDR \= WONUMBR THEN ITERATE
SAY ''WORKORDR' - 'MODULE' - 'PDATE' - 'MASTER''
MEMDISP = MEMDISP + 1
END
RETURN
/*     */
DISPLAY_NO_MEMBERS_FOUND:
   IF MEMDISP ^= 0 THEN RETURN
SAY ''MODNAME' HAS NOT BEEN TURNED OVER IN THE LAST 31 DAYS'
RETURN

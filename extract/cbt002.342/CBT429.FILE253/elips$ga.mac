/*    REXX EXEC :
   CA-LIBRARIAN 3.9 LIB/ELIPS GA ( GENERAL ALLOCATION )          */

TRACE O
/*     */
HOUSE_KEEPING:
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ADDRESS ISPEXEC "VGET (ELI$DMF ELI$DMF2 ELI$XNOD ELI$XFUN)"
IF ELI$XNOD ^= 'GA' THEN EXIT 0
SYSMAST = POS('SYSTEM.CONTROL',ELI$DMF)
IF SYSMAST = 0 THEN EXIT 0
TSOID = SYSVAR(SYSUID)
JULDATE = DATE(J)
PARMLIB = 'SYSS.TECH.COMMON.PARMLIB'
CALL GET_PARMS
/*     M A I N   R O U T I N E   S E C T I O N     */
/*     */
CHECK_SYSMAST_DATASET:
CALL CHECK_ADMIN_AUTHORIZATION
IF AUTHSW = 'YES' THEN EXIT 0
ERC = 4
ELIXMYN = 'Y'
ELILMSG = '$ELIE002'
ADDRESS ISPEXEC "SETMSG MSG($ELIE002)"
ADDRESS ISPEXEC "VPUT ("ELIXMYN") SHARED"
EXIT ERC
/*     S U B R O U T I N E S   S E C T I O N     */
/*     */
CHECK_ADMIN_AUTHORIZATION:
AUTHSW = 'NO'
DO A = 1 TO ADMIN.0
   IF ADMIN.A = TSOID THEN AUTHSW = 'YES'
END
RETURN
/*     */
GET_PARMS:
ADDRESS TSO
X = MSG("OFF")
"FREE FILE(PARMDD)"
"ALLOC DA('"PARMLIB"(ELIPSADM)') F(PARMDD) SHR"
"EXECIO * DISKR PARMDD (FINIS STEM ADMIN."
"FREE FILE(PARMDD)"
RETURN

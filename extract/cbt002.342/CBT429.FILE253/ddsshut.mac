/* REXX EXEC : ( DDSSHUT )
   FUNCTION  : SHUTDOWN THE APCDDS AND DATACOM STARTED TASKS PRIOR
               TO EXECUTING THE DATABASE DATASETS BACKUP.             */
TRACE O
/*     */
MAIN_SHUTDOWN:
ERC = 0
"CONSOLE ACTIVATE"
SRC = RC
"CONSPROF SOLDISPLAY(NO)"
ADDRESS CONSOLE
"D R,L"
X = GETMSG('MSGTXT.','SOL',,,15)
IF SRC ^= 0 THEN DO
   ERC = 12
   EXIT ERC
END
DO I = 1 TO MSGTXT.0
   DDSMSG = POS('CATK0246',MSGTXT.I)
   IF DDSMSG ^= 0 THEN DO
      REPLY_ID = WORD(MSGTXT.I,1)
      LEAVE
   END
END
"R "REPLY_ID",DDSSHUT"
ADDRESS TSO
"SLEEP 000100"
ADDRESS CONSOLE
"P DATACOM"
ADDRESS TSO
"SLEEP 000045"
/*     */
CHECK_DATACOM_SHUTDOWN:
DATSW = 'NO'
ADDRESS CONSOLE
"D A,L"
X = GETMSG('MSGTXT.','SOL',,,15)
DO I = 1 TO MSGTXT.0
   DAOSTC = POS('DATACOM',MSGTXT.I)
   IF DAOSTC ^= 0 THEN DATSW = 'YES'
END
IF DATSW = 'NO' THEN SIGNAL EXIT_TASK
"C DATACOM"
ADDRESS TSO
"SLEEP 000015"
ADDRESS CONSOLE
"S DATACOM"
ADDRESS TSO
"SLEEP 000015"
ADDRESS CONSOLE
"P DATACOM"
ADDRESS TSO
"SLEEP 000030"
/*     */
EXIT_TASK:
ADDRESS TSO
"CONSOLE DEACTIVATE"
EXIT 0

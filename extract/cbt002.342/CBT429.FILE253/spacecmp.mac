/* REXX DASD SPACE COMPUTE EXEC */
TRACE O
RETRY:
SAY 'ENTER BLOCK SIZE, REC SIZE, NUMBER OF RECORDS, FREE SPACE'
PULL BLOCK_SIZE RECORD_SIZE NUM_RECORDS FREE_SPACE
BLK_DATATYP = DATATYPE(BLOCK_SIZE)
REC_DATATYP = DATATYPE(NUM_RECORDS)
NUMREC_DATATYP = DATATYPE(NUM_RECORDS)
FREESP_DATATYP = DATATYPE(FREE_SPACE)
TYPES = BLK_DATATYP ×× REC_DATATYP ×× NUMREC_DATATYP ×× FREESP_DATATYP
IF TYPES \= 'NUMNUMNUMNUM' THEN
  DO
    SAY 'ERROR IN INPUT FIELD(S) - RETRY'
    SIGNAL RETRY
  END
FREE_SPACE_BYTES = BLOCK_SIZE * (FREE_SPACE / 100)
EFFECT_BLOCK_SIZE = BLOCK_SIZE - FREE_SPACE_BYTES
RECS_PER_BLOCK = EFFECT_BLOCK_SIZE / RECORD_SIZE
RECS_PER_BLOCK = RECS_PER_BLOCK % 1
C = 10
K = 0
DN =  ( BLOCK_SIZE + 6 ) / 232
DN = DN +.99; DN = DN % 1  /* ROUNDING UP  */
D =  BLOCK_SIZE + (6 * DN) + 6;
D = D / 34 + 9
D = D + .99; D = D % 1   /*   ROUNDING UP  */
SPACE = C + D + K
BLOCKS_PER_TRACK = 1729 / SPACE
BLOCKS_PER_TRACK = BLOCKS_PER_TRACK % 1
BLK = NUM_RECORDS / RECS_PER_BLOCK; BLK = BLK % 1
RECORDS_PER_TRACK = RECS_PER_BLOCK * BLOCKS_PER_TRACK
TRACKS_NEEDED = NUM_RECORDS / RECORDS_PER_TRACK
TRACKS_NEEDED = (TRACKS_NEEDED + .99) % 1
CYLS_NEEDED = TRACKS_NEEDED / 15
CYLS_NEEDED = (CYLS_NEEDED +.99) % 1
PCNT_USED = (BLOCKS_PER_TRACK * EFFECT_BLOCK_SIZE) / 56664
SAY 'FOR 3390: CYLS=' CYLS_NEEDED', TRKS=' TRACKS_NEEDED', BLKS=' BLK,
' TRACK UTIL.=' PCNT_USED
EXIT 0;

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      SUBROUTINE KILLER
C
C  SEE IF A DISRUPTOR TORPEDO HIT SOMETHING, KILL THE OBJECT AS NEEDED
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      INTEGER CSEC
C
      COMMON /SHIPS/ IUSFED(15,13)
C
      COMMON /TRACOM/ TARX,TARY,PRESX,PRESY,NSECE(10,10),IHIT,ISBC,IFSC,
     *     IKCC,ITORCT,ISB,IFS,IKC,IPR,ISCPX1,ISCPY1,ICHC,IPLC,ISTC,ET,
     *     CSEC(10,10),TVX,TVY,ICMC
C
      COMMON /NUMBER/ NSTARS,NPLNTS,NSBASE,NFED,NCOMM,NFX(9),NFY(9),
     *     NCX(9),NCY(9)
C
      COMMON /PADDED/ IPAD1(9),ICHART(8,8),IPAD2(9),IPLNET(8,8),
     *     IKY(8,8),INPUT(50),IPAD3
C
      COMMON /CHARS/ KZA,KZB,KZC,KZD,KZE,KZF,KZG,KZH,KZI,KZJ,KZK,KZL,
     *  KZM,KZN,KZO,KZP,KZQ,KZR,KZS,KZT,KZU,KZV,KZW,KZX,KZY,KZZ,ICRDOT,
     *  ICRPLS,ICRCRH,ICRSTR,ICRMIN,ICRZER,KZ1,KZ2,KZ3,KZ4,KZ5,KZ6,
     *  KZ7,KZ8,KZ9,ICRBLK
C
      COMMON /STRING/ IZSUPN, IZBLKH, IZMISS, IZNOVA, IZCDAM, IZCDES,
     * IZFDAM, IZFDES, IZBDAM, IZBDES, IZPDES,
     * IZP100, IZP200, IZP300, IZP400, IZERR
C
      DIMENSION ISAVX(10),ISAVY(10),IDMSG(11)
C
      DATA IDMSG / '** S','TARS','HIP ','U.S.','S. ',0,0,0,
     *              'AT S','ECTO','R: '/
C
      CALL DBUGIN ('KILLER ENTERED',IW(14),0)
      ITX = IFIX(TVX+0.5001)
      ITY = IFIX(TVY+0.5001)
      IF (ITX.GT.10.OR.ITX.LT.1.OR.ITY.GT.10.OR.ITY.LT.1) GO TO 280
      IF (CSEC(ITX,ITY).EQ.ICRDOT) GO TO 270
      CALL PRTEND
      IF (CSEC(ITX,ITY).NE.ICRCRH) GO TO 10
      CALL PRMSG (
     *  '*** SENSOR CONTROL REPORTS DISRUPTOR TORPEDO SUCKED',
     *  IW(51))
      CALL PRMSM ('INTO BLACK HOLE AT: ',20,IW(20),ITY,ITX,' ',0,1)
      IHIT = IZBLKH
      GO TO 270
C
10    IF (CSEC(ITX,ITY).NE.ICRSTR) GO TO 100
      XXX = RAND(1.0)
      IF (XXX.LE.0.05) GO TO 20
      IF (XXX.LE.0.90) GO TO 40
      GO TO 30
20    CONTINUE
      CALL PRMSM (
     *  '*** LORD COMMANDER, THE STAR AT: ',33,IW(33),ITY,ITX,' ',0,1)
      CALL PRMSG ('WAS NOT AFFECTED BY OUR DISRUPTOR TORPEDO',IW(41))
      IHIT = IZMISS
      GO TO 270
C
30    CALL BEEP
      CALL ADDQUE ('REDA')
      CALL PRMSG ('RED ALERT---RED ALERT',IW(21))
      CALL PRMSM ('SUPERNOVA OF STAR AT: ',22,IW(22),ITY,ITX,' ',0,1)
      CALL PRMSG (
     *  'AUTOMATIC SUPERNOVA NAVIGATIONAL CONTROL ACTIVATING',IW(51))
      CALL PRMSG ('STARSHIP ON FULL AUTOMATIC',IW(26))
      CALL LINEF
      IHIT = IZSUPN
      GO TO 270
C
40    CONTINUE
      IHIT = IZNOVA
      CSEC(ITX,ITY) = ICRDOT
      ICHART(ISCPX1,ISCPY1) = ICHART(ISCPX1,ISCPY1)-1
      CALL AROUND (ITX,ITY)
      ICNTR = 1
      ISAVX(1) = ITX
      ISAVY(1) = ITY
      N3 = 1
50    ILOX = ISAVX(N3)-ISGN(ISAVX(N3)-1)
      IHIX = ISGN(10-ISAVX(N3))+ISAVX(N3)
      ILOY = ISAVY(N3)-ISGN(ISAVY(N3)-1)
      IHIY = ISGN(10-ISAVY(N3))+ISAVY(N3)
      DO 90 I = ILOY, IHIY
           DO 80 J = ILOX, IHIX
                IF (CSEC(J,I).NE.ICRSTR) GO TO 70
                ICNTR = ICNTR+1
                ISAVX(ICNTR) = J
                ISAVY(ICNTR) = I
                IF (RAND(100.0).LT.10) GO TO 60
                CSEC(J,I) = ICRDOT
                CALL AROUND (J,I)
                ICHART(ISCPX1,ISCPY1) = ICHART(ISCPX1,ISCPY1)-1
                NSECE(J,I) = 0
                GO TO 70
60              ITX = J
                ITY = I
                GO TO 30
70              CONTINUE
80         CONTINUE
90    CONTINUE
      N3 = N3+1
      IF (N3.LE.ICNTR) GO TO 50
      GO TO 270
100   IF (CSEC(ITX,ITY).NE.KZC) GO TO 130
      XXX = RAND(1.0)
      CALL PRMSG (
     *  '*** LORD COMMANDER, SENSOR CONTROL REPORTS WE''VE HIT AND...',
     *  IW(45))
      IF (XXX.GT..2) GO TO 120
      CALL PRMSM (
     * 'DAMAGED OUR COMMANDER AT SECTOR: ',33,IW(33),ITY,ITX,' ',0,1)
      NSECE(ITX,ITY) = NSECE(ITX,ITY)+2500
      IHIT = IZCDAM
      IF (NSECE(ITX,ITY).LT.0) GO TO 270
      CALL PRMSG (
     *  'NEW UPDATE LORD COMMANDER, COMMANDER DESTROYED',IW(46))
110   NSECE(ITX,ITY) = 0
      CSEC(ITX,ITY) = ICRDOT
      IHIT = IZCDES
      IKCC = IKCC+1
      ICHART(ISCPX1,ISCPY1) = ICHART(ISCPX1,ISCPY1)-1000
      IKC = IKC-1
      GO TO 270
120   CALL PRMSM (
     *  'DESTROYED OUR COMMANDER AT SECTOR: ',35,IW(35),ITY,ITX,' '
     *     ,0,1)
      GO TO 110
130   IF (CSEC(ITX,ITY).NE.KZF) GO TO 150
      NSECE(ITX,ITY) = NSECE(ITX,ITY)-2500
      IF (NSECE(ITX,ITY).LE.0) GO TO 140
      IHIT = IZFDAM
      CALL PRMSM (
     *  '*** HIT ON FEDERATION STARSHIP AT: ',35,IW(35),ITY,ITX,' '
     *     ,0,1)
      GO TO 270
140   CONTINUE
      NSECE(ITX,ITY) = 0
      CSEC(ITX,ITY) = ICRDOT
      IHIT = IZFDES
      ET = ET+0.3
      IFS = IFS-1
      IFSC = IFSC+1
      ICHART(ISCPX1,ISCPY1) = ICHART(ISCPX1,ISCPY1)-100
      CALL SSDEST (IUSFED,ISCPX1,ISCPY1,ITX,ITY,IDMSG(6))
      CALL PRMSM (IDMSG,44,IWV(44),ITY,ITX,'DESTROYED',9,IW(9))
      GO TO 270
C
150   IF (CSEC(ITX,ITY).NE.KZB) GO TO 170
      NSECE(ITX,ITY) = NSECE(ITX,ITY)-2500
      IF (NSECE(ITX,ITY).LE.0) GO TO 160
      IHIT = IZBDAM
      CALL PRMSM (
     *  '*** HIT ON FEDERATION STARBASE AT: ',35,IW(35),ITY,ITX,' '
     *     ,0,1)
      GO TO 270
C
160   NSECE(ITX,ITY) = 0
      CSEC(ITX,ITY) = ICRDOT
      IHIT = IZBDES
      ET = ET+.5
      ISB = ISB-1
      ISBC = ISBC+1
      ICHART(ISCPX1,ISCPY1) = ICHART(ISCPX1,ISCPY1)-10
      CALL PRMSM (
     *  '*** STARBASE AT: ',17,IW(17),ITY,ITX,'DESTROYED',9,IW(9))
      GO TO 270
C
170   IF (CSEC(ITX,ITY).NE.KZP) GO TO 290
      NSECE(ITX,ITY) = NSECE(ITX,ITY)+100000000
      IF (NSECE(ITX,ITY).GE.0) GO TO 180
      IF (NSECE(ITX,ITY).EQ.-100000000) GO TO 210
      IF (NSECE(ITX,ITY).EQ.-200000000) GO TO 240
      IF (NSECE(ITX,ITY).EQ.-300000000) GO TO 250
      GO TO 260
180   CALL PRMSM (
     *  '*** PLANET AT: ',15,IW(15),ITY,ITX,'DESTROYED',9,IW(9))
      CSEC(ITX,ITY) = ICRDOT
      IPR = IPR-1
      NSECE(ITX,ITY) = 0
      IHIT = IZPDES
      IPLNET(ISCPX1,ISCPY1) = IPLNET(ISCPX1,ISCPY1)/10
      IF (IPLNET(ISCPX1,ISCPY1).GT.9999) GO TO 190
      IPLC = IPLC+100
      GO TO 200
190   IPLC = IPLC+600
      ET = ET+.25
200   IPLNET(ISCPX1,ISCPY1) = 0
      GO TO 270
C
210   CONTINUE
      CALL PRMSM (
     *  '*** THE ATMOSPHERE OF THE PLANET AT ',36,IW(36),ITY,ITX,
     *     'HAS',3,IW(3))
      CALL PRMSG (
     *  'BEEN RIPPED AWAY, ALL LIFE FORMS ON THE PLANET HAVE',
     *     IW(51))
      CALL PRMSG ('BEEN WIPED OUT',IW(14))
      IHIT = IZP100
      IF (IPLNET(ISCPX1,ISCPY1).GT.99999) GO TO 220
      IPOP = IPLNET(ISCPX1,ISCPY1)/10
      IPLNET(ISCPX1,ISCPY1) = 1
      GO TO 230
220   IPOP = (IPLNET(ISCPX1,ISCPY1)-100000)/10
      IPLNET(ISCPX1,ISCPY1) = 100001
230   ET = ET+.000025*IPOP
      GO TO 270
240   CALL PRMSG (
     *  '*** SENSOR CONTROL REPORTS THE DEFENSE SYSTEM OF',IW(48))
      CALL PRMSM (
     *  'THE PLANET AT: ',15,IW(15),ITY,ITX,'HAS BEEN KNOCKED OUT',
     *     20,IW(20))
      IHIT = IZP200
      GO TO 270
250   CALL PRMSG (
     *  '*** SENSOR CONTROL REPORTS THE DEFENSES OF THE PLANET',
     *  IW(53))
      CALL PRMSM (
     *  'AT: ',4,IW(4),ITY,ITX,'HAVE BEEN WEAKENED',18,IW(18))
      IHIT = IZP300
      GO TO 270
260   CALL PRMSG (
     *  '*** SENSOR CONTROL REPORTS PLANETARY DEFENSES OF',IW(48))
      CALL PRMSM (
     *  'PLANET AT: ',11,IW(11),ITY,ITX,
     *  'ARE HOLDING STRONG',18,IW(18))
      IHIT = IZP400
270   CONTINUE
      GO TO 300
280   CONTINUE
      CALL PRTEND
      CALL PRMSG ('TORPEDO MISSED, LORD COMMANDER',IW(30))
      IHIT = IZMISS
      RETURN
290   CALL PRMSG ('INTERNAL ERROR, ROUTINE=KILLER (ERROR 04)',IW(40))
      CALL PRMSG ('NOW CALLING FREEZE ROUTINE TO SAVE DATA',IW(38))
      CALL FREEZE
      IHIT = IZERR
300   CONTINUE
      CALL DBUGCH ('KILLER IHIT',IW(11),IHIT,IW(4))
      CALL DBUGIN ('KILLER EXITED',IW(13),0)
      RETURN
      END

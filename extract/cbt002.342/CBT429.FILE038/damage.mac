CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      SUBROUTINE DAMAGE (UHIT)
C
C  DAMAGE A PART OF THE SHIP IF GREATER THAN 400 UNIT HIT ABSORBED
C  PAST SHIELDS
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      COMMON /DEVICE/ XCDC,XSRDC,XIEDC,XLRDC,XWEDC,XDSDC,XSSDC,XPTDC
C
      COMMON /INFO/ ICOND(2),ENERGY,ISHUPD,ISHENG,IAPDEV,IPOF,IOVER
C
      DATA IZDAMG / 'DAMG'/ ,IZUP / 'UP'/
C
      CALL DBUGIN ('DAMAGE ENTERED',IW(14),0)
      UNHIT = UHIT
      IBY = 0
10    CONTINUE
      UNIHIT = UNHIT-(RAND(30.0)+170.0)
      IF (UNIHIT.LE.0.0) GO TO 200
      IF (UNIHIT.GT.400.0) UNIHIT = 400.0
      IF (IBY.EQ.1) GO TO 20
      CALL LINEF
      CALL PRMSG ('*** DAMAGE CONTROL REPORTS',IW(26))
20    CONTINUE
      HIT = RAND(0.25)+(UNIHIT*.005)
      IIX = (IFIX(UNIHIT*RAND(3.5))/100)
      IIX = IIX+1
      IF (IIX.LT.4.OR.IIX.GT.14) GO TO 120
      IF (IIX.LT.5) GO TO 30
      IF (IIX.LT.7) GO TO 40
      IF (IIX.LT.9) GO TO 50
      IF (IIX.LT.11) GO TO 60
      IF (IIX.LT.12) GO TO 70
      IF (IIX.LT.13) GO TO 80
      IF (IIX.LT.14) GO TO 90
      IF (IIX.LT.15) GO TO 100
30    CALL PRMSG ('*** IMPULSE ENGINES DAMAGED, LORD COMMANDER.',
     *    IW(44))
      XIEDC = XIEDC+HIT
      GO TO 190
40    CALL PRMSG ('*** SUBSPACE RADIO DAMAGED, LORD COMMANDER.',
     *    IW(43))
      XSRDC = XSRDC+HIT
      GO TO 190
50    CALL PRMSG ('*** LONG RANGE SCANNERS DAMAGED, LORD COMMANDER.',
     *    IW(48))
      XLRDC = XLRDC+HIT
      GO TO 190
60    CALL PRMSG ('*** BATTLE COMPUTER DAMAGED, LORD COMMANDER.',
     *    IW(44))
      XCDC = XCDC+HIT
      GO TO 190
70    CALL PRMSG ('*** WARP ENGINES DAMAGED, LORD COMMANDER.',IW(41))
      XWEDC = XWEDC+HIT
      GO TO 190
80    CALL PRMSG ('*** SHORT RANGE SCANNERS DAMAGED, LORD COMMANDER.',
     *   IW(49))
      XSSDC = XSSDC+HIT
      GO TO 190
90    CALL PRMSG (
     *  '*** DISRUPTOR TORPEDO TUBES DAMAGED, LORD COMMANDER.',
     *   IW(52))
      XPTDC = XPTDC+HIT
      GO TO 190
100   CALL PRMSG ('*** DEFLECTOR SHIELDS DAMAGED',IW(29))
      IF (ISHUPD.NE.IZUP) GO TO 110
      CALL PRMSG (
     *  '*** DEFLECTOR SHIELDS ARE NOW DOWN, LORD COMMANDER.',
     *     IW(51))
110   XDSDC = XDSDC+HIT
      ISHUPD = IZDAMG
      GO TO 190
120   ID20 = IFIX(RAND(19.0)+2.0)
      ID15 = IFIX(RAND(6.0)+15.0)
      J = RAND(6.0)+1.0
      IF (J.EQ.1) GO TO 130
      IF (J.EQ.2) GO TO 140
      IF (J.EQ.3) GO TO 150
      IF (J.EQ.4) GO TO 160
      IF (J.EQ.5) GO TO 170
      IF (J.EQ.6) GO TO 180
      GO TO 130
130   CALL PRMIM ('--- MINOR DAMAGE TO BULKHEADS ON DECK ',
     *      38,IW(38),ID20,' ',0,1)
      GO TO 190
140   CALL PRMIM ('--- MINOR DAMAGE TO FOOD INTEGRATERS ON DECK ',
     *     45,IW(45),ID20,' ',0,1)
      GO TO 190
150   CONTINUE
      CALL PRMIM ('--- MINOR DAMAGE TO RE-PROCESSING CENTER ON DECK ',
     *     49,IW(49),ID15,' ',0,1)
      GO TO 190
160   CONTINUE
      CALL PRMIM ('--- MINOR DAMAGE TO STORAGE HOLDS ON DECK ',
     *     42,IW(42),ID15,' ',0,1)
      GO TO 190
170   CALL PRMIM (
     * '--- ENGINEERING REPORTS NON-CRITICAL POWER LOSS ON DECK ',
     * 56,IW(56),ID20,' ',0,1)
      GO TO 190
180   CONTINUE
      ID = RAND(10.0)+1.0
      CALL PRMIM ('--- ',4,IW(4),ID,
     *            'CASUALTIES FROM THIS HIT',24,IW(24))
      CALL PRMIM ('     ON DECK ',13,IW(13),ID20,' ',0,1)
      GO TO 190
190   IF (UNHIT.LT.600.0) GO TO 200
      UNHIT = UNHIT-400.0
      CALL PRMSG ('AND',IW(3))
      IBY = 1
      GO TO 10
200   CONTINUE
      CALL DBUGIN ('DAMAGE EXITED',IW(13),0)
      RETURN
      END

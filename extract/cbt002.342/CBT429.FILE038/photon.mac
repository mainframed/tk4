CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      SUBROUTINE PHOTON (IRETRN,ITQX,ITSX,ITQY,ITSY,N2)
C
C  TRACK AND REPORT TARGETS HIT BY OUR DISRUPTOR TORPEDOS
C  (THE TERM PHOTON AND DISTRUPTOR ARE USED INTERCHAGABLY)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      COMMON /CHARS/ KZA,KZB,KZC,KZD,KZE,KZF,KZG,KZH,KZI,KZJ,KZK,KZL,KZM
     *     ,KZN,KZO,KZP,KZQ,KZR,KZS,KZT,KZU,KZV,KZW,KZX,KZY,KZZ,ICRDOT,
     *     ICRPLS,ICRCRH,ICRSTR,ICRMIN,ICRZER,KZ1,KZ2,KZ3,KZ4,KZ5,KZ6,
     *     KZ7,KZ8,KZ9,ICRBLK
C
      COMMON /SHIPS/ IUSFED(15,13)
C
      COMMON /TRACOM/ TARX,TARY,ISCPX2,ISCPY2,NSECE(10,10),IHIT,ISBC,
     *     IFSC,IKCC,ITORCT,ISB,IFS,IKC,IPR,ISCPX1,ISCPY1,ICHC,IPLC,ISTC
     *     ,ET,ISECT(10,10),TVX,TVY,ICMC
C
      COMMON /PADDED/ IPAD1(9),ICHART(8,8),IPAD2(9),IPLNET(8,8),
     *     IKY(8,8),INPUT(50),IPAD3
C
      COMMON /DEVICE/ XCDC,XSRDC,XIEDC,XLRDC,XWEDC,XDSDC,XSSDC,XPTDC
C
      COMMON /NUMBER/ NSTARS,NPLNTS,NSBASE,NFED,NCOMM,NFX(9),NFY(9),NCX(
     *     9),NCY(9)
C
      COMMON /INFO/ ICOND(2),ENERGY,ISHUPD,ISHENG,IAPDEV,IPOF,IOVER
C
      COMMON /HURT/ NOCALL,IPLENG,IPBASE,IFED2,ICOMM2
C
      COMMON /MISC/ BATTER,ISSAVE,IDUM,WFACT,IDATF,ILEV,CSDATE,TGIVEN
C
      DIMENSION IRG(8,8), FIRE(8), DISVEC(8,8), VECD2(8,8), NUMS(10),
     * MSGX(11), IDMSG(11)
      EQUIVALENCE (NUMS(1),ICRZER)
      DATA MSGX / 'ENTE','R TA','RGET',' SEC','TOR ',
     *            'FOR ','TORP','EDO ','NUMB','ER ',0/
      DATA IDMSG / '** S','TARS','HIP ','U.S.','S. ',0,0,0,
     *              'AT S','ECTO','R: '/
      DATA IZRED  / 'RED'/, IZSUPN /'SNOV'/
      DATA IZGRE  / 'GREE'/
      DATA IZNOVD / 'NOVA'/
      DATA IZCLER / 'CLEA'/
      DATA IZDAMG / 'DAMG'/
      DATA IZDOWN / 'DOWN'/
      DATA IZBLOW / 'BLOW'/
      CALL DBUGIN ('PHOTON ENTERED',IW(14),0)
      IRETRN = 0
      CALL LINEF
      IMAXT = 4
      IF (XPTDC.GT.0.001) GO TO 1450
810   IF (ITORCT.EQ.0) GO TO 1430
      IFRCNT = 0
      CALL BRIDGE (N2)
      IF (N2.GT.50) GO TO 850
      IF (INPUT(N2).EQ.ICRMIN.OR.INPUT(N2).EQ.ICRZER) GO TO 150
      IF (INPUT(N2+1).NE.ICRBLK) GO TO 1720
      CALL IDENT (INPUT(N2),IERR,IFIRE)
      IF (IERR.NE.0) GO TO 850
      IF (IFIRE.GT.IMAXT) GO TO 860
      CALL BRIDGE (N2)
      IF (N2.GT.50) GO TO 870
820   IF (N2.GT.50) GO TO 830
      CALL NUMREC (INPUT,N2,IERR,RTN)
      IF (IERR.NE.0) GO TO 1720
      IF (ABS(RTN).LT.0.000001) GO TO 150
      IFRCNT = IFRCNT+1
      IF (RTN.LT.0.5.OR.RTN.GT.10.5) GO TO 1720
      FIRE(IFRCNT) = RTN
      CALL BRIDGE (N2)
      GO TO 820
830   IF (IFRCNT.NE.2.AND.IFRCNT/2.NE.IFIRE) GO TO 1720
      IF (IFRCNT.NE.2) GO TO 890
      RX = FIRE(2)
      RY = FIRE(1)
      DO 840 J = 3, 8, 2
           FIRE(J) = RY
           FIRE(J+1) = RX
840   CONTINUE
      GO TO 890
850   CALL PRMSG ('TO ABORT THIS COMMAND ENTER 0 0 (ZERO,ZERO)',IW(43))
      CALL READIN ('NUMBER OF TORPEDOES TO FIRE - ',IW(30),30,1,EOFF)
      IF (EOFF.GT..1) GO TO 150
      CALL GAP (N2)
      CALL IDENT (INPUT(N2),IERR,IFIRE)
      IF (IERR.NE.0) GO TO 1720
      IF (IFIRE.LE.0) GO TO 150
      IF (IFIRE.GT.ITORCT) GO TO 1440
      IF (IFIRE.LE.IMAXT) GO TO 870
860   CALL PRMIM ('MAXIMUM OF ',11,IW(11),IMAXT,
     *           'TORPEDOES PER BURST',20,IW(20))
      IF (IMAXT.NE.4) CALL PRMSG ('(DUE TO TUBE DAMAGE)',IW(20))
      GO TO 850
870   DO 880 J = 1, IFIRE
           NX = J*2
           MSGX(11) = NUMS(J+1)
           CALL LINEF
           CALL READIN (MSGX,IWV(44),44,1,EOFF)
           IF (EOFF.GT..1) GO TO 150
           CALL GAP (N2)
           IF (N2.GT.50) GO TO 150
           CALL NUMREC (INPUT,N2,IERR,FIRE(NX-1))
           IF (IERR.NE.0) GO TO 1720
           CALL BRIDGE (N2)
           IF (N2.GT.50) GO TO 150
           CALL NUMREC (INPUT,N2,IERR,FIRE(NX))
           IF (IERR.NE.0) GO TO 1720
           IF (FIRE(NX).LT..01.OR.FIRE(NX-1).LT..01) GO TO 150
           IF (FIRE(NX).LT..5.OR.FIRE(NX).GT.10.5.OR.FIRE(NX-1).LT..
     *          5.OR.FIRE(NX-1).GT.10.5) GO TO 1720
880   CONTINUE
890   IFIRE2 = IFIRE*2
      IF (IFIRE.GT.ITORCT) GO TO 1440
      DO 900 J = 1, IFIRE2, 2
           I3Y = FIRE(J)+0.500001
           I3X = FIRE(J+1)+0.500001
           IF (ISECT(I3X,I3Y).EQ.KZS) GO TO 1420
900   CONTINUE
      IEMXC = 0
      DO 910 J = 1, IFIRE2, 2
           TARY = FIRE(J)
           TARX = FIRE(J+1)
           CALL TRACK
           ITORCT = ITORCT-1
           IEMXC = IEMXC+1
           IF (J+2.GT.IFIRE2) GO TO 910
           IF (IHIT.EQ.IZNOVD.OR.IHIT.EQ.IZBLOW.OR.IHIT.EQ.IZSUPN) GO TO
     *           920
910   CONTINUE
      IF (IHIT.EQ.IZNOVD.OR.IHIT.EQ.IZBLOW.OR.IHIT.EQ.IZSUPN) GO TO 920
      GO TO 1410
920   CALL PRMSG ('REMAINDER OF BURST ABORTED',IW(26))
      IEMXC2 = IFIRE-IEMXC
      IF (IEMXC2.LT.1) GO TO 925
      CALL PRMIM ('(THE REMAINING ',15,IW(15),IEMXC2,
     *     'TORPEDOS WERE DUMPED INTO SPACE)',32,IW(32))
      ITORCT = ITORCT-IEMXC2
925   CONTINUE
      IF (IHIT.NE.IZSUPN) GO TO 1300
      CALL LINEF
      ITX = IFIX(TVX+.5001)
      ITY = IFIX(TVY+.5001)
      BLOWD = DIST(5,ITX,5,ITY,5,ISCPX2,5,ISCPY2)
      IF (BLOWD.GT..2001) GO TO 930
      CALL PRMSG ('EMERGENCY DROP IN...',IW(20))
      CALL LINEF
      CALL PRMSG (
     *  'YOU WERE CLOSER THAN 2 SECTORS AWAY FROM THE SUPERNOVA,',
     *   IW(55))
      CALL PRMSG (
     *  'YOUR SHIP''S COMPUTER DIDN''T HAVE TIME TO GET YOU AWAY.',
     *   IW(53))
      CALL PRMSG ('(PROVIDED IT WAS WORKING)',IW(25))
      GO TO 2560
930   IF (BLOWD.GT..5.OR.XWEDC.LE.0.001) GO TO 950
940   CALL PRMSG ('EMERGENCY DROP INTO HYP...',IW(26))
      CALL LINEF
      CALL PRMSG (
     *  'YOUR SHIP IS CREMATED BY A SUPERNOVA (YOUR WARP ENGINES',
     *    IW(55))
      CALL PRMSG (
     *  'WERE DAMAGED AND YOU COULD NOT MAKE THE JUMP INTO HYPER-',
     *    IW(56))
      IF (XWEDC.GT.5.0) CALL PRMSG ('SPACE).',IW(7))
      IF (XWEDC.LE.5.0) CALL PRMSG ('SPACE FAST ENOUGH).',IW(19))
      GO TO 2560
950   IF (XWEDC.GT.5.0) GO TO 940
      CALL PRMSG ('EMERGENCY DROP INTO HYPERSPACE COMPLETE',IW(39))
      CALL LINEF
      IF (ENERGY.GT.50.0) GO TO 960
      CALL PRMSG (
     *  'YOUR SHIP DID NOT HAVE THE ENERGY NEEDED TO HOLD YOU'
     *     ,IW(52))
      CALL PRMSG (
     *  'IN HYPERSPACE, YOUR SHIP DROPS BACK INTO NORMAL SPACE',IW(53))
      CALL PRMSG ('AND GETS BURNED TO ASHES',IW(24))
      GO TO 2560
960   ENERGY = ENERGY-50.0
      IF (XCDC.LE.0.001) GO TO 980
      CALL PRMSG ('COMPUTER DAMAGED -- SETTING RANDOM COURSE',IW(41))
      CALL LINEF
970   RFX = RAND(0.9)+1.0
      RFY = RAND(0.9)+1.0
      IF (RAND(10.0).GT.5.0) RFX = -RFX
      IF (RAND(10.0).GT.5.0) RFY = -RFY
      IDISPX = IFIX(RFX*100.0)
      IDISPY = IFIX(RFY*100.0)
      IDISPX = (IDISPX+ISGN(IDISPX))/10
      IDISPY = (IDISPY+ISGN(IDISPY))/10
      ISCX = (ISCPX1*10+ISCPX2-1)+IDISPX
      ISCY = (ISCPY1*10+ISCPY2-1)+IDISPY
      MTX = ISCX/10
      MTY = ISCY/10
      IF (MTX.GT.8.OR.MTX.LT.1.OR.MTY.GT.8.OR.MTY.LT.1) GO TO 970
      ITQX = MTX
      ITQY = MTY
      ITSX = MOD(ISCX,10)+1
      ITSY = MOD(ISCY,10)+1
      GO TO 1170
980   CALL PRMSG ('COMPUTER CONTROL ACTIVATED',IW(26))
      CALL LINEF
      ILOX = ISCPX1-ISGN(ISCPX1-1)
      IHIX = ISGN(8-ISCPX1)+ISCPX1
      ILOY = ISCPY1-ISGN(ISCPY1-1)
      IHIY = ISGN(8-ISCPY1)+ISCPY1
      IAQ = 0
      IAQFLG = 0
      DO 1000 I = ILOX, IHIX
           DO 990 J = ILOY, IHIY
                IAQ = IAQ+1
                D = DIST(I,5,J,5,ISCPX1,ISCPX2,ISCPY1,ISCPY2)
                DISVEC(I,J) = D
990        CONTINUE
1000  CONTINUE
      DISVEC(ISCPX1,ISCPY1) = 999.5
      IRG(ISCPX1,ISCPY1) = IZRED
C
C SUBTRACT ONE FROM IAQ, TO ACCOUNT FOR PRESENT QUADRANT
C
      IAQ = IAQ-1
      CALL COPVEC (VECD2,DISVEC,ILOX,IHIX,ILOY,IHIY)
      IAQ2 = IAQ
      IF (XLRDC.LE.0.001) CALL PRMSG (
     *  'LONG RANGE SCANNER DATA PLOTTED INTO COMPUTER',IW(45))
      IF (XLRDC.GT.0.001) CALL PRMSG (
     *  'LONG RANGE SCANNER DATA NOT AVAILABLE',IW(37))
      DO 1020 I = ILOX, IHIX
           DO 1010 J = ILOY, IHIY
                IRG(I,J) = IZGRE
                IF (XLRDC.LE.0.001) IRG(I,J) = ICROG(ICHART(I,J))
1010       CONTINUE
1020  CONTINUE
      CALL LINEF
      IF (XSSDC.LE.0.001) CALL PRMSG (
     *  'SHORT RANGE SCANNER DATA PLOTTED INTO COMPUTER',IW(46))
      IF (XSSDC.GT.0.001) CALL PRMSG (
     *  'SHORT RANGE SCANNER DATA NOT AVAILABLE',IW(38))
1030  CONTINUE
      IF (IAQFLG.NE.-1.OR.IAQ2.GT.0) GO TO 1050
1040  CONTINUE
      CALL PRMSG (
     *  'COMPUTER UNABLE TO FIND PATH OUT OF QUADRANT, YOU ARE',
     *     IW(53))
      CALL PRMSG ('BURNED TO A FINE INTERSTELLAR DUST BY THE SUPERNOVA',
     *     IW(51))
      GO TO 2560
1050  IF (XLRDC.GT.0.001) IAQFLG = -1
1060  DO 1080 I = ILOX, IHIX
           DO 1070 J = ILOY, IHIY
                IF (IRG(I,J).EQ.IZGRE) GO TO 1070
                VECD2(I,J) = 999.0
                IAQ2 = IAQ2-1
1070       CONTINUE
1080  CONTINUE
      IF (IAQ2.EQ.0) GO TO 1110
      RMIN = 1000.0
      DO 1100 I = ILOX, IHIX
           DO 1090 J = ILOY, IHIY
                IF (RMIN.LT.VECD2(I,J)) GO TO 1090
                RMIN = VECD2(I,J)
                NQX = I
                NQY = J
1090       CONTINUE
1100  CONTINUE
1110  IF (IAQ2.GT.0) GO TO 1140
      DO 1130 I = ILOX, IHIX
           DO 1120 J = ILOY, IHIY
                IRG(I,J) = IZGRE
                IF (ICHART(I,J).EQ.9999) IRG(I,J) = IZRED
1120       CONTINUE
1130  CONTINUE
      CALL COPVEC (VECD2,DISVEC,ILOX,IHIX,ILOY,IHIY)
      IAQ2 = IAQ
      IAQFLG = -1
      GO TO 1060
1140  IF (XSSDC.GT.0.001) GO TO 1150
      CALL LONINT (NQX,NQY,5,5,IRTN,IIX,IIY)
      IF (IRTN.EQ.IZCLER) GO TO 1150
      IRG(NQX,NQY) = IZRED
      IAQ2 = IAQ
      GO TO 1030
1150  CONTINUE
      IF (WFACT.GT.10.0) WFACT = 10.0
      IF (WFACT.GT.7.0) GO TO 1160
      WFACT = 7.0
1160  CALL LINEF
      IF (XWEDC.GT.0.001) WFACT = 5.0
      CALL PRMRM ('WARP FACTOR NOW - ',18,IW(18),WFACT,' ',0,1)
      CALL LINEF
      CALL PRMSG ('HELM CONTROL NOW LOCKED INTO BATTLE COMPUTER',
     *     IW(44))
      CALL LINEF
      CALL PRMSG ('STAND BY TO LEAVE QUADRANT ',IW(26))
      CALL LINEF
      IF (ICHART(NQX,NQY).EQ.9999) GO TO 1040
      ITQY = NQY
      ITQX = NQX
      ITSX = 5
      ITSY = 5
1170  CALL ITERPT
      IF (NFED.EQ.0) GO TO 1210
      CALL LOCATE (KZF,IDUM,IDUM2)
      DO 1200 M = 1, NFED
           XXX = RAND(100.0)
           IF (XXX.GT.55.0) GO TO 1190
           I = 0
1180       CALL ESCAPE (ISCPX1,ISCPY1,IX,IY)
           I = I+1
           IF (I.GT.7) GO TO 1190
           IF (ICHART(IX,IY).GT.999) GO TO 1180
           CALL LINEF
           CALL SSMOVO (IUSFED,ISCPX1,ISCPY1,NFX(M),NFY(M),IX,IY,IDMSG(6
     *          ))
           CALL PRMSM (IDMSG,44,IWV(44),NFY(M),NFX(M),' ',0,1)
           CALL PRMSM ('ESCAPES TO QUADRANT ',20,IW(20),IY,IX,' ',0,1)
           ICHART(IX,IY) = ICHART(IX,IY)+100
           GO TO 1200
1190       CONTINUE
           CALL LINEF
           CALL SSDEST (IUSFED,ISCPX1,ISCPY1,NFX(M),NFY(M),IDMSG(6))
           CALL PRMSM(IDMSG,44,IWV(44),NFY(M),NFX(M),
     *          'DESTROYED BY SUPERNOVA'
     *          ,22,IW(22))
           ET = ET+.3
           IFS = IFS-1
           IFSC = IFSC+1
1200  CONTINUE
1210  IF (NCOMM.EQ.0) GO TO 1250
      CALL LOCATE (KZC,IDUM,IDUM2)
      DO 1240 M = 1, NCOMM
           XXX = RAND(100.0)
           IF (XXX.GT.65.0) GO TO 1230
           I = 0
1220       CALL ESCAPE (ISCPX1,ISCPY1,IX,IY)
           I = I+1
           IF (I.GT.7) GO TO 1230
           IF (ICHART(IX,IY).GT.9) GO TO 1220
           CALL LINEF
           CALL PRMSM ('*** COMMANDER AT ',17,IW(17),
     *               NCY(M),NCX(M),' ',0,1)
           CALL PRMSM ('ESCAPES TO QUADRANT ',20,IW(20),IY,IX,' ',0,1)
           ICHART(IX,IY) = ICHART(IX,IY)+1000
           GO TO 1240
1230       CALL LINEF
           CALL PRMSM ('*** COMMANDER AT ',17,IW(17),NCY(M),NCX(M),
     *          'DESTROYED BY SUPERNOVA',22,IW(22))
           IKC = IKC-1
           IKCC = IKCC+1
1240  CONTINUE
1250  IF (NPLNTS.EQ.0) GO TO 1280
      CALL LOCATE (KZP,IXP,IYP)
      IPR = IPR-1
      IPLNET(ISCPX1,ISCPY1) = IPLNET(ISCPX1,ISCPY1)/10
      IF (IPLNET(ISCPX1,ISCPY1).GT.9999) GO TO 1260
      IPLC = IPLC+100+(IPLNET(ISCPX1,ISCPY1)/100.0+.5)
      ET = ET+.000025*IPLNET(ISCPX1,ISCPY1)
      GO TO 1270
1260  IPLC = IPLC+600+((IPLNET(ISCPX1,ISCPY1)-10000)/100.0+.5)
      ET = ET+.25+.000025*((IPLNET(ISCPX1,ISCPY1)-10000)/100.0+.5)
1270  IPLNET(ISCPX1,ISCPY1) = 0
      CALL LINEF
      CALL PRMSM ('*** PLANET AT ',14,IW(14),IYP,IXP,
     *     'DESTROYED BY SUPERNOVA',
     *     22,IW(22))
1280  IF (NSBASE.EQ.0) GO TO 1290
      CALL LOCATE (KZB,IXB,IYB)
      ET = ET+.5
      ISB = ISB-1
      ISBC = ISBC+1
      CALL LINEF
      CALL PRMSM ('*** STARBASE AT ',16,IW(16),IYB,IXB,
     *     'DESTROYED BY SUPERNOVA',22,IW(22))
1290  IKY(ISCPX1,ISCPY1) = 1
      ICHART(ISCPX1,ISCPY1) = 9999
      CALL LINEF
      GO TO 1950
1300  IF (IHIT.NE.IZBLOW) GO TO 1350
      CALL LINEF
      CALL PRMSG ('EMERGENCY -- EMERGENCY',IW(22))
      CALL LINEF
      CALL PRMSG (
     *  'AUTOMATIC EMERGENCY FIELD DAMPENING SYSTEM ACTIVATED',
     *   IW(52))
      CALL LINEF
      UNHIT = RAND(400.0)+2200.0
      IF (ISHUPD.NE.IZDAMG) GO TO 1310
      CALL PRMSG ('SHIELDS NOT USABLE, STAND BY FOR SHOCK WAVE',IW(43))
      GO TO 1330
1310  J = ISHENG-IFIX(UNHIT)
      IF (J.GT.0) GO TO 1320
      CALL PRMSG ('SHIELD ENERGY LOW, STAND BY FOR SHOCK WAVE',IW(42))
      UNHIT = UNHIT-FLOAT(ISHENG)
      ISHENG = 0
      GO TO 1330
1320  CONTINUE
      CALL PRMSG (
     *  'AUTOMATIC FIELD DAMPENING SYSTEM TAKES FULL IMPACT OF',
     *  IW(53))
      CALL PRMSG ('BLAST, NO DAMAGE TO SHIP',IW(24))
      ISHENG = ISHENG-IFIX(UNHIT)
      GO TO 1340
1330  CALL DAMAGE (UNHIT)
1340  CALL LINEF
      CALL PRMIM ('SHIELDS NOW AT: ',16,IW(16),ISHENG,'UNITS.',6,IW(6))
      GO TO 1410
1350  CALL LINEF
      CALL PRMSG ('EMERGENCY -- EMERGENCY',IW(22))
      CALL LINEF
      CALL PRMSG (
     *  'THE LIGHTS OF YOUR BRIDGE GO OUT AS YOU AND YOUR BRIDGE',
     *     IW(55))
      CALL PRMSG (
     *  'PERSONNEL ARE THROWN TO THE FLOOR BY THE FORCE OF THE NOVA',
     *     IW(58))
      CALL PRMSG (
     *  'YOU STAGGER TO YOUR FEET AS THE LIGHTS COME BACK UP SLOWLY',
     *     IW(58))
      CALL LINEF
      CALL PRMSG (
     *  'YOUR FIRST OFFICER CALLS FOR DAMAGE REPORTS FROM ALL DECKS',
     *     IW(58))
      CALL LINEF
      HIT = RAND(300.0)+1700.0
      IF (ISHUPD.NE.IZDOWN.AND.ISHUPD.NE.IZDAMG) GO TO 1360
      ENERGY = ENERGY-HIT
      IF (ENERGY.LE.0.0) GO TO 1390
      CALL DAMAGE (HIT)
      GO TO 1400
1360  IF (HIT.GT.FLOAT(ISHENG)) GO TO 1380
      CALL PRMSG (
     *  'SHIELDS TAKE FULL FORCE OF BLAST, NO DAMAGE TO SHIP',
     *     IW(51))
      CALL LINEF
      ISHENG = ISHENG-IFIX(HIT)
1370  CONTINUE
      CALL PRMIM ('SHIELDS NOW AT: ',16,IW(16),ISHENG,'UNITS.',6,IW(6))
      GO TO 1400
1380  CONTINUE
      CALL PRMSG (
     *  'SHIELD ENERGY LOW, FORCE OF NOVA PARTIALLY ABSORBED BY',
     *    IW(54))
      CALL PRMSG ('SHIELDS, DAMAGE REPORTS COMING IN',IW(33))
      ENERGY = ENERGY-(HIT-ISHENG)
      IF (ENERGY.LE.0.0) GO TO 1390
      ISHENG = 0
      IF (HIT-ISHENG.GT.300.0) CALL DAMAGE (HIT-ISHENG)
      IF (HIT-ISHENG.LE.300.0) CALL PRMSG ('*** NO DAMAGE',IW(13))
      GO TO 1370
1390  CALL PRMSG ('YOUR MAIN ENERGY HAS GONE TO 0',IW(30))
      GO TO 2560
1400  CALL LINEF
1410  CONTINUE
      CALL DRAGIN
      CALL BATTLE
      GO TO 150
1420  CALL LINEF
      CALL PRMSG (
     * 'I WOULDN''T DO THAT TOO OFTEN OR YOUR FIRST OFFICER MIGHT ',
     *   IW(56))
      CALL PRMSG ('GET SOME IDEAS ABOUT BEING "LORD COMMANDER".',
     *     IW(43))
      GO TO 150
1430  CONTINUE
      CALL PRMSG ('LORD COMMANDER, TORPEDO FIRE CONTROL REPORTS WE',
     *     IW(47))
      CALL PRMSG ('DON''T HAVE ANY DISRUPTOR TORPEDOES LEFT',
     *     IW(39))
      GO TO 150
1440  CONTINUE
      CALL PRMSG ('LORD COMMANDER, TORPEDO FIRE CONTROL REPORTS WE',
     *     IW(47))
      CALL PRMSG (
     * 'DON''T HAVE ENOUGH TORPEDOES FOR THE ORDERED SPREAD     ',
     *     IW(50))
      GO TO 150
1450  IF (XPTDC.GT.1.5) GO TO 1460
      IF (XPTDC.LE.1.5) IMAXT = 1
      IF (XPTDC.LE.1.0) IMAXT = 2
      IF (XPTDC.LE.0.5) IMAXT = 3
      GO TO 810
1460  IMAXT = 0
      CALL PRMSG (
     *  'DISRUPTOR TORPEDO TUBES DAMAGED,  ',IW(32))
      CALL PRMSG ('TRY FIRING LESS TORPEDOES',IW(25))
      GO TO 150
1720  CONTINUE
      IRETRN = 1
      GO TO 150
2560  CONTINUE
      IRETRN = 2
      GO TO 150
1950  CONTINUE
      IRETRN = 3
150   CONTINUE
      CALL DBUGIN ('PHOTON EXITED',IW(13),0)
      RETURN
      END

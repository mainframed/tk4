CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      SUBROUTINE DRAGIN
C
C  HANDLE CONDITION OF STARBASE CALLING FOR HELP, PULL IN HELPERS
C  IF AVAIL
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      COMMON /CHARS/ KZA,KZB,KZC,KZD,KZE,KZF,KZG,KZH,KZI,KZJ,KZK,KZL,KZM
     *     ,KZN,KZO,KZP,KZQ,KZR,KZS,KZT,KZU,KZV,KZW,KZX,KZY,KZZ,ICRDOT,
     *     ICRPLS,ICRCRH,ICRSTR,ICRMIN,ICRZER,KZ1,KZ2,KZ3,KZ4,KZ5,KZ6,
     *     KZ7,KZ8,KZ9,ICRBLK
C
      COMMON /HURT/ NOCALL,IPLENG,IPBASE,IFED2,ICOMM2
C
      COMMON /TRACOM/ TARX,TARY,ISCPX2,ISCPY2,NSECE(10,10),IHIT,ISBC,
     *     IFSC,IKCC,ITORCT,ISB,IFS,IKC,IPR,ISCPX1,ISCPY1,ICHC,IPLC,ISTC
     *     ,ET,ISECT(10,10),TVX,TVY,ICMC
C
      COMMON /SHIPS/ IUSFED(15,13)
C
      COMMON /PADDED/ IPAD1(9),ICHART(8,8),IPAD2(9),IPLNET(8,8),
     *     IKY(8,8),INPUT(50),IPAD3
C
      COMMON /DEVICE/ XCDC,XSRDC,XIEDC,XLRDC,XWEDC,XDSDC,XSSDC,XPTDC
C
      COMMON /NUMBER/ NSTARS,NPLNTS,NSBASE,NFED,NCOMM,NFX(9),NFY(9),NCX(
     *     9),NCY(9)
C
      COMMON /INFO/ ICOND(2),ENERGY,ISHUPD,ISHENG,IAPDEV,IPOF,IOVER
C
      COMMON /SSINFO/ IOXQ(9),IOYQ(9),INXS(9),INYS(9)
C
      CALL DBUGIN ('DRAGIN ENTERED',IW(14),0)
      ICTFLG = 0
      GO TO 10
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
      ENTRY DRAGCC
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      ICTFLG = 1
10    CONTINUE
      CALL DBUGIN ('DRAGCC ENTERED',IW(14),0)
      CALL ITERPT
      IF (NFED.GT.0.OR.(NSBASE.EQ.0.AND.NPLNTS.EQ.0)) GO TO 200
      IF (NOCALL.EQ.1) GO TO 200
      IDAMG = 0
      IF (NPLNTS.EQ.0) GO TO 20
      CALL LOCATE (KZP,IIXP,IIYP)
      M1 = NSECE(IIXP,IIYP)
      IF (M1.NE.IPLENG.AND.M1.LE.-200000000) IDAMG = 2
20    IF (NSBASE.EQ.0) GO TO 30
      CALL LOCATE (KZB,IIXB,IIYB)
      IF (NSECE(IIXB,IIYB).NE.IPBASE) IDAMG = 1
30    IF (IDAMG.EQ.0) GO TO 200
      ILOX = ISCPX1-ISGN(ISCPX1-1)
      IHIX = ISGN(8-ISCPX1)+ISCPX1
      ILOY = ISCPY1-ISGN(ISCPY1-1)
      IHIY = ISGN(8-ISCPY1)+ISCPY1
      IF (XSRDC.GT.0.001) GO TO 80
      CALL LINEF
      CALL PRMSG (
     *  'LORD COMMANDER, WE HAVE INTERCEPTED A SUBSPACE RADIO',
     *  IW(52))
      CALL PRMSG (
     *  'TRANSMISSION ON A FEDERATION FREQUENCY:',IW(39))
      CALL LINEF
      CALL PRMSG (
     *  '# PRIORITY ONE # CALL TO ANY FEDERATION STARSHIP:',IW(49))
      CALL LINEF
      NOCALL = 1
      IF (IDAMG.EQ.2) GO TO 40
      CALL PRMSM (
     *  'FROM STARBASE IN QUADRANT: ',27,IW(27),
     *  ISCPY1,ISCPX1,' ',0,1)
      GO TO 50
40    CONTINUE
      CALL PRMSM (
     *  'FROM FEDERATION PLANET IN QUADRANT: ',36,IW(36),ISCPY1,
     *     ISCPX1,' ',0,1)
50    CONTINUE
      IF (ICTFLG.EQ.0) GO TO 60
      CALL PRMSG (
     *  'WE ARE CURRENTLY UNDER ATTACK FROM A KLINGON COMMANDER',
     *  IW(54))
      GO TO 70
60    CONTINUE
      CALL PRMSG (
     *  'WE ARE UNDER ATTACK FROM THE KLINGON SUPER-COMMANDER',
     *  IW(52))
70    CALL PRMSG ('       ... PLEASE RESPOND.',IW(26))
80    CALL LINEF
C
C      FIND IF THERE ARE ANY STARSHIPS HANDY
C
      IRESP = 0
      ISSCNT = 1
      DO 120 I = ILOY, IHIY
           DO 110 J = ILOX, IHIX
                IF (ISCPX1.EQ.J.AND.ISCPY1.EQ.I) GO TO 110
                CALL SCAN (ICHART(J,I))
                IF (IFED2.EQ.0) GO TO 110
                CALL ITERPT
                IF (NFED.EQ.9) GO TO 130
                IF (XLRDC.LE.0.001) CALL PRMSM (
     *               'INCOMING FEDERATION STARSHIP(S) FROM: ',
     *               38,IW(38),I,J,' ',0,1)
                IRESP = IRESP+1
                ICHART(J,I) = ICHART(J,I)-(100*IFED2)
                ICHART(ISCPX1,ISCPY1)=ICHART(ISCPX1,ISCPY1)+(100*IFED2)
                DO 100 M = 1, IFED2
90                   M1 = RAND(10.0)+1.0
                     M2 = RAND(10.0)+1.0
                     IF (ISECT(M1,M2).NE.ICRDOT) GO TO 90
                     ISECT(M1,M2) = KZF
                     NSECE(M1,M2) = IFEDST(DUMMY)
                     IOXQ(ISSCNT) = J
                     IOYQ(ISSCNT) = I
                     INXS(ISSCNT) = M1
                     INYS(ISSCNT) = M2
                     ISSCNT = ISSCNT+1
100             CONTINUE
110        CONTINUE
120   CONTINUE
130   IF (IRESP.GT.0) GO TO 140
      CALL LINEF
      CALL PRMSG ('NO FEDERATION STARSHIPS RESPOND',IW(31))
      CALL LINEF
      GO TO 200
140   CALL SSPRNT (1)
      IF (XSRDC.GT.0.001) GO TO 200
      CALL LINEF
      CALL PRMSG (
     *  'TOP ALERT CALL FROM SUPER-COMMANDER KAZH:',IW(41))
      CALL LINEF
      CALL PRMSG (
     *  'ALL COMMANDERS IN RANGE ARE ORDERED TO CONVERGE ',IW(48))
      CALL PRMSM ('ON QUADRANT: ',13,IW(13),ISCPY1,ISCPX1,' ',0,1)
      CALL LINEF
      IRESP = 0
      DO 190 I = ILOY, IHIY
           DO 180 J = ILOX, IHIX
                IF (J.EQ.ISCPX1.AND.I.EQ.ISCPY1) GO TO 180
                CALL SCAN (ICHART(J,I))
                IF (ICOMM2.EQ.0) GO TO 180
                CALL ITERPT
                IF (NCOMM.EQ.9) GO TO 200
                CALL PRMSM ('COMMANDER(S) IN QUADRANT: ',26,IW(26),
     *               I,J,'RESPOND',7,IW(7))
                IRESP = IRESP+1
                ICHART(J,I) = ICHART(J,I)-(1000*ICOMM2)
                ICHART(ISCPX1,ISCPY1)=ICHART(ISCPX1,ISCPY1)+
     *                                            (1000*ICOMM2)
                DO 170 M = 1, ICOMM2
160                  M1 = RAND(10.0)+1.0
                     M2 = RAND(10.0)+1.0
                     IF (ISECT(M1,M2).NE.ICRDOT) GO TO 160
                     ISECT(M1,M2) = KZC
                     NSECE(M1,M2) = -4500
170             CONTINUE
180        CONTINUE
190   CONTINUE
      IF (IRESP.GT.0) GO TO 200
      CALL LINEF
      CALL PRMSG ('NO COMMANDERS RESPONDED, LORD COMMANDER',IW(39))
      CALL LINEF
200   CONTINUE
      CALL DBUGIN ('DRAGIN/DRAGCC EXITED',IW(21),0)
      RETURN
      END

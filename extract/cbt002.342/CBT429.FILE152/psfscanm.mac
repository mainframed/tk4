//HPZ$M   JOB ,ZBIEGIEN,MSGCLASS=W,CLASS=D
/*JOBPARM ROOM=3426
//* ROTATE A CHARACTER SET
//* THE DD NAME OF THE SAS FILE IS CHAR
//A EXEC SAS@
//OUT DD SYSOUT=W
//CHAR  DD DSN=HPZ.SAS.CHARSET,DISP=OLD
OPTIONS GEN=0;
  /* TAKE A DOWN CHARACTER SET C2......  AND ROTATE IT AND BUILD
     THE CORRESPONDING UP FONT C4......  */;
PROC FORMAT;
 VALUE $BIN (MAX=4)
  '0' ='....'
  '1' ='...*'
  '2' ='..*.'
  '3' ='..**'
  '4' ='.*..'
  '5' ='.*.*'
  '6' ='.**.'
  '7' ='.***'
  '8' ='*...'
  '9' ='*..*'
  'A' ='*.*.'
  'B' ='*.**'
  'C' ='**..'
  'D' ='**.*'
  'E' ='***.'
  'F' ='****';
VALUE $UNBIN (MAX=1)
 '....' = '0'
 '...*' = '1'
 '..*.' = '2'
 '..**' = '3'
 '.*..' = '4'
 '.*.*' = '5'
 '.**.' = '6'
 '.***' = '7'
 '*...' = '8'
 '*..*' = '9'
 '*.*.' = 'A'
 '*.**' = 'B'
 '**..' = 'C'
 '**.*' = 'D'
 '***.' = 'E'
 '****' = 'F'
 OTHER  = '*';

DATA
 CHAR.NEWRAS(KEEP= CHARID XPATTRN)
 CHAR.NEWCHAR(KEEP=CHARID CINCR CWIDTH CHEIGTH MASCEND UBASEOFF
               ASPACE BSPACE CSPACE);
 LENGTH XPATTRN $ 16;
 LENGTH CHARID $ 8;
 ARRAY VBITL(X) $ 8 ABIT1-ABIT64;  /* BIT ARRAY */;
 RETAIN ABIT1-ABIT64 ;
SET CHAR.CHARDAT1;
DO OVER VBITL;
 VBITL= '0000000000000000'X;  /* INITIALIZE */;
END;
X=1;
DO Y=1 TO (CHEIGTH+1); /* LOAD PATTERN INTO ARRAY */;
 SET CHAR.RASTER;
 IF Y> ASPACE THEN DO;
  X=CHEIGTH+2-Y;
  IF CWIDTH=15 THEN SUBSTR(XPATTRN,3,6)='000000000000'X;
  IF CWIDTH=31 THEN SUBSTR(XPATTRN,5,4)='00000000'X;
  VBITL=XPATTRN;
 END;
END;
DO X=1 TO BSPACE; /* NOW FLIP LEFT TO RIGHT */;
 TP=1;
 LENGTH XTO $ 64;
 XTO=REPEAT('.',64);
 DO;  /* EXPAND */;
  LENGTH XHEX $ 16;
  LENGTH XFROM $ 64;
  LENGTH TEMP $ 8;
  TEMP=VBITL;
  XHEX=PUT(TEMP,$HEX16.);
  XFROM=REPEAT('.',64);
  DO J=1 TO 16;
   XC=SUBSTR(XHEX,J,1);
   SUBSTR(XFROM,((J-1)*4+1),4)=PUT(XC,$BIN.);
  END;
 END;
 LEN=MASCEND+UBASEOFF;
 SUBSTR(XTO,1,LEN)=REVERSE(SUBSTR(XFROM,1,LEN));
 XHEX='0000000000000000';
 DO I=0 TO 15; /* SHRINK */;
  SUBSTR(XHEX,(I+1),1)=PUT(SUBSTR(XTO,((I*4)+1),4),$UNBIN.);
 END;
 TEMP=(INPUT(XHEX,$HEX16.));
 VBITL=TEMP;
END;
MAX=0;
DO J=1 TO CHEIGTH+1; /* CHECK MAX AND OUTPUT */;
 X=J;
 TEMP=VBITL;
 DO I =8 TO 1 BY -1;
  IF SUBSTR(TEMP,I,1) NE '00'X THEN DO;
   IF MAX<I THEN MAX=I;
  END;
 END;
 XPATTRN=TEMP;
 OUTPUT CHAR.NEWRAS;
END;
IF MAX=1 THEN MAX=2; /* 15 */
IF MAX=0 THEN MAX=2; /* 15 */
IF MAX=3 THEN MAX=4; /* 31 */
IF MAX=5 OR MAX=6 OR MAX=7 THEN MAX=8; /* 63 */
CWIDTH=(MAX*8)-1;
UBASEOFF=MASCEND;
OUTPUT CHAR.NEWCHAR;

    PROC PRINT DATA=CHAR.NEWCHAR  ;
  /*PROC PRINT DATA=CHAR.NEWRAS*/;
  /*FORMAT XPATTRN $HEX16. */;

//HPZ$K   JOB ,ZBIEGIEN,MSGCLASS=W,CLASS=D
/*JOBPARM ROOM=3426
//* ADD CHARACTERS TO  A CODE PAGE
//A EXEC SAS@
//CHAR DD DSN=HPZ.SAS.CHARSET,DISP=OLD
//* CHARID CVALID CPRINT CINCR CODEPOINT
//* 'DEFAULT ' CHARID DVALID DPRINT DINCR VARBSPAC
//* START IN COL 1, 1 SPACE BETWEEN FIELDS, DEFAULT MUST BE 8 CHARS
//ABC  DD  * PUT CHARACTER DATA HERE
LA010000 Y Y Y E1
DEFAULT  SP010000 N Y Y N
//SYSIN DD *
OPTIONS GEN=0;
DATA TEMPHDR(KEEP=XEFAULTG XVALID XPRINT XINCR XARBSPAC)
     TEMPCHR(KEEP=CHARID CVALID CPRINT CINCR CDPOINT);
INFILE ABC END=EODAT;
RETAIN SWITCH 0;
INPUT CHARID $CHAR8. @;
IF CHARID = 'DEFAULT' THEN DO;
 INPUT @1 DEFAULT $8. +1 XEFAULTG $8. +1 XVALID $1.
         +1 XPRINT $1. +1 XINCR $1. +1 XARBSPAC $1.;
 IF NOT (XVALID = 'Y' OR XVALID='N')
 OR NOT (XPRINT='Y' OR XPRINT='N')
 OR NOT (XINCR='Y' OR XINCR='N')
 OR NOT (XARBSPAC='Y' OR XARBSPAC='N') THEN DO;
  PUT 'ONE OF THE FLAGS FOR THE DEFAULT ARE NOT VALID';
  ABORT;
 END;
 OUTPUT TEMPHDR;
 SWITCH=1;
END;
ELSE DO;
 INPUT @1 CHARID $8. +1 CVALID $1. +1 CPRINT $1.
    +1 CINCR $1. +1 CDPOINT $HEX2.;
 IF NOT (CVALID = 'Y' OR CVALID='N')
 OR NOT (CPRINT='Y' OR CPRINT='N')
 OR NOT (CINCR='Y' OR CINCR='N') THEN DO;
  PUT 'ONE OF THE FLAGS FOR THE CHARACTER ARE NOT VALID';
  ABORT;
 END;
 OUTPUT TEMPCHR;
END;
IF EODAT AND SWITCH = 0 THEN DO;
 XEFAULTG='NODEFAUL';
 OUTPUT TEMPHDR;
END;

PROC SORT DATA=TEMPCHR;
 BY CHARID;

DATA CHAR.TRANSCHR(KEEP=CHARID CVALID CPRINT CINCR CDPOINT);
MERGE TEMPCHR(IN= INTMP)
      CHAR.TRANSCHR(IN= INTRANS);
 BY CHARID;
IF INTMP AND NOT INTRANS THEN DO;
 OUTPUT CHAR.TRANSCHR;
 PUT 'ADDING THIS CHARACTER=' CHARID;
 RETURN;
END;
IF INTMP AND INTRANS THEN DO;
 PUT 'THIS CHARACTER IS BEING ALREADY IN THE FILE=' CHARID;
 ABORT;
END;
IF NOT INTMP AND INTRANS THEN
 OUTPUT CHAR.TRANSCHR;

DATA CHAR.TRANSHDR(KEEP=CDPOINTS DEFAULTG
                        DVALID DPRINT DINCR VARBSPAC);
SET CHAR.TRANSHDR;
SET TEMPHDR;
IF XEFAULTG NE 'NODEFAUL' THEN DO;
 DEFAULT=XEFAULTG;
 DVALID=XVALID;
 DPRINT=XPRINT;
 DINCR=XINCR;
 VARBSPAC=XARBSPAC;
END;
OUTPUT CHAR.TRANSHDR;

DATA CHAR.TRANSHDR(KEEP=CDPOINTS DEFAULTG
                        DVALID DPRINT DINCR VARBSPAC);
SET CHAR.TRANSCHR END=EODAT;
X+1;
IF EODAT THEN DO;
 SET CHAR.TRANSHDR;
 CDPOINTS=X;
 OUTPUT CHAR.TRANSHDR;
END;

PROC PRINT DATA=CHAR.TRANSHDR;
PROC PRINT DATA=CHAR.TRANSCHR;

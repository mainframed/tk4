//HPZ$IN    JOB  ,ZBIEGIEN,MSGCLASS=W,CLASS=3
/*JOBPARM ROOM=3426
//   EXEC AGCBUCL,OUT=W,LIBRARY='HPZ.TESTLIB(INLINE)'
//COB.SYSIN DD *
       IDENTIFICATION DIVISION.
       PROGRAM-ID. INLINE.
      *
      *    THIS PROGRAM IS USED TO TAKE A PAGEDEF AND FORMDEF AND
      *    WRITE THEM INLINE WITH REPORT PRINTLINES SO THAT THE
      *    PAGEDEF AND FORMDEF CAN BE TESTED BEFORE BEING PUT INTO
      *    PRODUCTION.  THE REPORT CAN BE RECFM=(F,V)(B)(A,M).
      *    THAT IS ANY COMBINATION, BUT THERE MUST BE PRINT CONTROL
      *    CHARACTERS OF SOME TYPE.
      *
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT UPDI-PDEFLIB ASSIGN TO UT-S-PDEFLIB.
           SELECT UFDI-FDEFLIB ASSIGN TO UT-S-FDEFLIB.
           SELECT UFLI-FILEIN ASSIGN TO UT-S-FILEIN.
           SELECT UFLO-FILEOT ASSIGN TO UT-S-FILEOT.
       DATA DIVISION.
       FILE SECTION.
       FD   UPDI-PDEFLIB
            LABEL RECORD ARE STANDARD
            BLOCK CONTAINS 0 RECORDS.
       01   UPDI-REC.
       05   UPDI-CH OCCURS 1 TO 800 TIMES DEPENDING ON WS-PD-RECL
                PIC X.
       FD   UFDI-FDEFLIB
            LABEL RECORD ARE STANDARD
            BLOCK CONTAINS 0 RECORDS.
       01   UFDI-REC.
       05   UFDI-CH OCCURS 1 TO 800 TIMES DEPENDING ON WS-FD-RECL
                PIC X.
       FD   UFLI-FILEIN
            LABEL RECORD ARE STANDARD
            BLOCK CONTAINS 0 RECORDS.
       01   UFLI-REC.
       05   UFLI-CH PIC X(133).
       01     FILLER.
       05   UFLI-VLI  PIC S9999 COMP.
       05     FILLER  PIC XX.
       05   UFLI-VREC PIC X(129).
       FD   UFLO-FILEOT
            LABEL RECORD ARE STANDARD
            BLOCK CONTAINS 0 RECORDS.
       01   UFLO-REC.
       05   UFLO-CH OCCURS 1 TO 800 TIMES DEPENDING ON WS-FLO-RECL
                PIC X.
       01   UFLO-REC-BR  PIC X(27).
       01   UFLO-REC-ER  PIC X(17).
       01   UFLO-REC-BRG PIC X(17).
       01   UFLO-REC-ERG PIC X(17).
       WORKING-STORAGE SECTION.
     5 77  PAN-VALET PICTURE X(24) VALUE '001CBT1919   03/26/90'.
       01  FILLER.
       05  FILLER PIC X(36) VALUE
           'INLINE-- WORKING STORAGE STARTS HERE'.
       05  WS-PD-RECL        PIC S9(4) COMP SYNC.
       05  WS-FD-RECL        PIC S9(4) COMP SYNC.
       05  WS-FLI-RECL       PIC S9(4) COMP SYNC.
       05  WS-FLO-RECL       PIC S9(4) COMP SYNC.
      *  BEGIN RESOURCE GROUP HEX  5A0010D3A8C6000000D9C7E3D6D2C5D540
       05  WS-BRG PIC X(17) VALUE
           '!
      *  END   RESOURCE GROUP HEX 5A0010D3A9C6000000D9C7E3D6D2C5D540
       05  WS-ERG PIC X(17) VALUE
           '!
      *  BEGIN RESOURCE FDEF HEX 5A001AD3A8C3000000-NAME-00000821FE>0
       05  WS-BR-FDEF.
       10  FILLER   PIC X(09) VALUE '!
       10  WS-BR-FDEFNAME PIC X(8).
       10  FILLER   PIC X(10) VALUE   '
      *  END   RESOURCE FDEF HEX 5A0010D3A9C3000000-NAME
       05  WS-ER-FDEF.
       10  FILLER   PIC X(09) VALUE '!
       10  WS-ER-FDEFNAME PIC X(8).
      *  BEGIN RESOURCE PDEF HEX 5A001AD3A8CE000000-NAME-00000821FD>0
       05  WS-BR-PDEF.
       10  FILLER   PIC X(09) VALUE '!
       10  WS-BR-PDEFNAME PIC X(8).
       10  FILLER   PIC X(10) VALUE   '
      *  END   RESOURCE PDEF HEX 5A0010D3A9CE0000-NAME
       05  WS-ER-PDEF.
       10  FILLER   PIC X(09) VALUE '!
       10  WS-ER-PDEFNAME PIC X(8).
      *
       05  WS-WORK-BIN.
       10  WS-RESULT-BIN  PIC S9999 COMP.
       10  WS-X           PIC X.
       05     FILLER      REDEFINES WS-WORK-BIN.
       10     FILLER      PIC X.
       10  WS-SOURCE-BIN  PIC S9999 COMP.
      *
       01  WS-IN-DCB.
       05  WS-IDCB-DEVTYPE   PIC X.
       05  WS-IDCB-DSORG     PIC X.
       05  WS-IDCB-RECFM     PIC X.
       05     FILLER         PIC X.
       05  WS-IDCB-BLKSIZE   PIC S9999 COMP SYNC.
       05  WS-IDCB-LRECL     PIC S9999 COMP SYNC.
     *
       01     FILLER.
       05  WS-RECFM    PIC X VALUE SPACE.
       88  WS-RECFM-FIXED    VALUE 'F'.
       88  WS-RECFM-VAR      VALUE 'V'.
       88  WS-RECFM-UNDEF    VALUE 'U'.
      *
       05  FILLER PIC X(36) VALUE
           'INLINE-- WORKING STORAGE ENDS HERE'.
       LINKAGE SECTION.
       01  LS-PARM.
       05  LS-PARMLEN    PIC S9(4) COMP SYNC.
       05  LS-FDEFNAME   PIC X(8).
       05  LS-PDEFNAME   PIC X(8).
       PROCEDURE DIVISION USING LS-PARM.
       100-MAINLINE.
           IF LS-PARMLEN IS NOT EQUAL TO 16 THEN
              DISPLAY 'LENGHT OF PARMS IS NOT 16' UPON SYSOUT
              DISPLAY 'VALUE IS=' LS-PARMLEN UPON SYSOUT
              CALL 'AGTERM'.
           MOVE LS-FDEFNAME TO WS-BR-FDEFNAME, WS-ER-FDEFNAME.
           MOVE LS-PDEFNAME TO WS-BR-PDEFNAME, WS-ER-PDEFNAME.
      *  ZERO OUT THE LRECL IN THE FILES, TO LET JCL CONTROL
           CALL 'RPRINT07' USING UPDI-PDEFLIB.
           CALL 'RPRINT07' USING UFDI-FDEFLIB.
           CALL 'RPRINT07' USING UFLI-FILEIN.
           CALL 'RPRINT07' USING UFLO-FILEOT.
           OPEN INPUT UPDI-PDEFLIB, UFDI-FDEFLIB OUTPUT UFLO-FILEOT.
      *  ALLOW ANY RECFM TO BE ENTERED
           CALL 'RPRINT09'.
           OPEN INPUT UFLI-FILEIN.
           CALL 'RPRINT09'.
           CALL 'RPRINT02' USING UFLI-FILEIN, WS-IN-DCB.
           MOVE WS-IDCB-RECFM TO WS-X.
           MOVE ZERO TO WS-RESULT-BIN.
           MULTIPLY 4 BY WS-SOURCE-BIN.
           IF WS-RESULT-BIN IS EQUAL TO 2
              MOVE 'F' TO WS-RECFM
           ELSE
              IF WS-RESULT-BIN IS EQUAL TO 1
                 MOVE 'V' TO WS-RECFM
              ELSE
                 IF WS-RESULT-BIN IS EQUAL TO 3
                    MOVE 'U' TO WS-RECFM
                 ELSE
                    DISPLAY 'RECFM CAN ONL BE F OR V ON INPUT' UPON
                             SYSOUT
                    CALL 'AGTERM'.

           WRITE UFLO-REC-BRG FROM WS-BRG.

           WRITE UFLO-REC-BR  FROM WS-BR-FDEF.
           PERFORM 200-COPY-FDEF THRU 200-CF-END.
           WRITE UFLO-REC-ER  FROM WS-ER-FDEF.

           WRITE UFLO-REC-BR  FROM WS-BR-PDEF.
           PERFORM 300-COPY-PDEF THRU 300-CP-END.
           WRITE UFLO-REC-ER  FROM WS-ER-PDEF.

           WRITE UFLO-REC-ERG FROM WS-ERG.

           PERFORM 400-COPY-FILE THRU 400-CF-END.

           CLOSE UFLO-FILEOT, UFLI-FILEIN, UFDI-FDEFLIB, UPDI-PDEFLIB.
           STOP RUN.

       200-COPY-FDEF.
           READ UFDI-FDEFLIB AT END GO TO 200-CF-END.
           CALL 'AGGETVLI' USING UFDI-REC, WS-FD-RECL.
           SUBTRACT 4 FROM WS-FD-RECL.
           MOVE WS-FD-RECL TO WS-FLO-RECL.
           WRITE UFLO-REC FROM UFDI-REC.
           GO TO 200-COPY-FDEF.


       200-CF-END.
           EXIT.


       300-COPY-PDEF.
           READ UPDI-PDEFLIB AT END GO TO 300-CP-END.
           CALL 'AGGETVLI' USING UPDI-REC, WS-PD-RECL.
           SUBTRACT 4 FROM WS-PD-RECL.
           MOVE WS-PD-RECL TO WS-FLO-RECL.
           WRITE UFLO-REC FROM UPDI-REC.
           GO TO 300-COPY-PDEF.


       300-CP-END.
           EXIT.


       400-COPY-FILE.
           READ UFLI-FILEIN AT END GO TO 400-CF-END.
           IF WS-RECFM-VAR THEN
              SUBTRACT 4 FROM UFLI-VLI GIVING WS-FLI-RECL
              MOVE WS-FLI-RECL TO WS-FLO-RECL
              CALL 'RFIXMOVE' USING UFLI-VREC, UFLO-REC, WS-FLO-RECL
           ELSE
              MOVE WS-IDCB-LRECL TO WS-FLO-RECL
              CALL 'RFIXMOVE' USING UFLI-REC, UFLO-REC, WS-FLO-RECL.
           WRITE UFLO-REC.
           GO TO 400-COPY-FILE.


       400-CF-END.
           EXIT.



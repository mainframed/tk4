000100 IDENTIFICATION DIVISION.
000200
000300 PROGRAM-ID.             SSR01AR.
000400 AUTHOR.                 ROBB CHAPMAN.
000500 INSTALLATION.           GEORGIA DEPARTMENT OF LABOR.
000600 DATE-COMPILED.
000700 ENVIRONMENT DIVISION.
000800
000900 CONFIGURATION SECTION.
001000 SOURCE-COMPUTER.        IBM-370.
001100 OBJECT-COMPUTER.        IBM-370.
001200
001300 INPUT-OUTPUT SECTION.
001400
001500 FILE-CONTROL.
001600     SELECT SSRHSTRY ASSIGN TO SSRHSTRY
001700       ORGANIZATION INDEXED
001800       ACCESS DYNAMIC
001900       RECORD KEY IS SSRHSTRY-KEY
002000       ALTERNATE RECORD KEY IS SSRHSTRY-PTFKEY DUPLICATES
002100       ALTERNATE RECORD KEY IS SSRHSTRY-FMIDKEY DUPLICATES
002200       FILE STATUS IS SSRHSTRY-ST.
002300     SELECT SSRPRTBL ASSIGN TO SSRPRTBL
002400       ORGANIZATION RELATIVE
002500       ACCESS RANDOM
002600       RELATIVE KEY IS PRRNUM
002700       FILE STATUS IS SSRPRTBL-ST.
002800     SELECT SSRINTBL ASSIGN TO SSRINTBL
002900       ORGANIZATION RELATIVE
003000       ACCESS RANDOM
003100       RELATIVE KEY IS IRRNUM
003200       FILE STATUS IS SSRINTBL-ST.
003300 DATA DIVISION.
003400
003500 FILE SECTION.
003600 FD  SSRHSTRY
003700     LABEL RECORDS ARE STANDARD
003800     BLOCK CONTAINS 0 RECORDS.
003900 01  SSRHSTRY-REC.
004000     05  SSRHSTRY-KEY.
004100         10  SSRHSTRY-PINX        PIC 9(4) COMP.
004200         10  SSRHSTRY-DATE-INST   PIC X(6).
004300     05  SSRHSTRY-PTFKEY.
004400         10  SSRHSTRY-PTFMD       PIC X(10).
004500         10  SSRHSTRY-PTFINX      PIC 9(4) COMP.
004600     05  SSRHSTRY-FMIDKEY.
004700         10  SSRHSTRY-FMID        PIC X(7).
004800         10  SSRHSTRY-FMIDINX     PIC 9(4) COMP.
004900     05  SSRHSTRY-ORDR            PIC X(12).
005000     05  SSRHSTRY-RELS            PIC X(12).
005100 01  FILLER REDEFINES SSRHSTRY-REC.
005200     05  FILLER                   PIC X(44).
005300     05  SSRHSTRY-TABLE-PARMS     PIC X(8).
005400     05  FILLER                   PIC X(1).
005500 FD  SSRPRTBL
005600     LABEL RECORDS ARE STANDARD
005700     BLOCK CONTAINS 0 RECORDS.
005800 01  PRTBL-REC.
005900     05  PRTBL-NEXT-REC           PIC 9(4) COMP.
006000     05  PRTBL-PREV-REC           PIC 9(4) COMP.
006100     05  PRTBL-HI-SLOT            PIC 9(4) COMP.
006200     05  FILLER                   PIC X(4).
006300     05  PRTBL-ENTRIES.
006400         10 PRTBL-1-48            PIC X(4128).
006500         10 PRTBL-49-95           PIC X(4042).
006600     05  FILLER REDEFINES PRTBL-ENTRIES.
006700         10 PRTBL-ENTRY OCCURS 95 TIMES
006800                 INDEXED BY PRTBLINX.
006900             15  PRTBL-PRD.
007000                 20 PRTBL-ACRNM   PIC X(16).
007100                 20 PRTBL-PRDNM   PIC X(64).
007200             15  PRTBL-PINX       PIC 9(4) COMP.
007300             15  PRTBL-VINX       PIC 9(4) COMP.
007400             15  PRTBL-CINX       PIC 9(4) COMP.
007500 FD  SSRINTBL
007600     LABEL RECORDS ARE STANDARD
007700     BLOCK CONTAINS 0 RECORDS.
007800 01  INTBL-REC.
007900     05  INTBL-NEXT-REC           PIC 9(4) COMP.
008000     05  INTBL-PREV-REC           PIC 9(4) COMP.
008100     05  INTBL-HI-SLOT            PIC 9(4) COMP.
008200     05  FILLER                   PIC X(4).
008300     05  INTBL-ENTRIES.
008400         10  INTBL-1-29           PIC X(1015).
008500         10  INTBL-30-58          PIC X(1015).
008600     05  FILLER REDEFINES INTBL-ENTRIES.
008700         10 INTBL-ENTRY OCCURS 58 TIMES
008800                 INDEXED BY INTBLINX.
008900             15  INTBL-INDXKEY.
009000                 20  INTBL-TYPE   PIC X(1).
009100                 20  INTBL-INXITM   PIC X(32).
009200             15  INTBL-IINX       PIC 9(4) COMP.
009300 WORKING-STORAGE SECTION.
009305 77  PAN-VALET PICTURE X(24) VALUE '002CBT1765   12/06/89'.
009400 01  ARRAY-2.
009500     05 PARM                                 VALUE SPACES.
009600         10 PARM-FUNCTION         PIC X.
009700         10 PARM-SRCHTYPE         PIC X.
009800     05 STATE                                VALUE SPACES.
009900         10  STATE-1              PIC X.
010000         10  STATE-2              PIC X.
010100     05 ENDL                      PIC 9(2)   VALUE ZERO.
010200     05 ERRL                      PIC 9(2)   VALUE ZERO.
010300     05 ERRT                      PIC X(2)   VALUE SPACES.
010400     05 FILESTAT                  PIC X(2)   VALUE SPACES.
010500 01  PTFMD                        PIC X(10)  VALUE SPACES.
010600 01  DATE-INST                               VALUE ZEROES.
010700     05  YY                       PIC 9(2).
010800     05  MM                       PIC 9(2).
010900     05  DD                       PIC 9(2).
011000 01  ARRAY-7                                 VALUE SPACES.
011100     05  FMIDE OCCURS 8 TIMES INDEXED BY FMIDX
011200                                  PIC X(7).
011300 01  ARRAY-16                                VALUE SPACES.
011400     05  ACRNM                    PIC X(16).
011500     05  P30ACR-TBL.
011600         10  ACRNME OCCURS 5 TIMES INDEXED BY P30ACRX
011700                                  PIC X(16).
011800     05  P32ACR-TBL.
011900         10  ACRNML OCCURS 8 TIMES INDEXED BY P32ACRX
012000                                  PIC X(16).
012100     05  FILLER REDEFINES P32ACR-TBL.
012200         10  P34PTF-TBL.
012300             15 PTFMDU OCCURS 8 TIMES INDEXED BY P34PTFX
012400                                  PIC X(10).
012500         10  P34DTINST-TBL.
012600             15 DTINSTU OCCURS 8 TIMES INDEXED BY P34DTX.
012700                 20  YYU          PIC X(2).
012800                 20  MMU          PIC X(2).
012900                 20  DDU          PIC X(2).
013000 01  ARRAY-32                                VALUE SPACES.
013100     05  PRDNM.
013200         10 PRDN1                 PIC X(32).
013300         10 PRDN2                 PIC X(32).
013400     05  VENDR                    PIC X(32).
013500     05  CTGRY                    PIC X(32).
013600     05  PRDNME OCCURS 5 TIMES INDEXED BY P30PRDX.
013700         10  PRDN1E               PIC X(32).
013800         10  PRDN2E               PIC X(32).
013900     05  P32PRD-TBL.
014000         10 PRDNML OCCURS 8 TIMES INDEXED BY P32PRDX.
014100             15 PRDN1L            PIC X(32).
014200             15 PRDN2L            PIC X(32).
014300     05  P33INX-TBL REDEFINES P32PRD-TBL.
014400         10 INXITML OCCURS 16 TIMES INDEXED BY P33IIX
014500                                  PIC X(32).
014600 01  ARRAY-12                                 VALUE SPACES.
014700     05  FILLER OCCURS 8 TIMES INDEXED BY ORDRELX.
014800         15  ORDRE                PIC X(12).
014900         15  RELSE                PIC X(12).
015000 01  ERRFILE                      PIC X(12)  VALUE SPACES.
015100 01  ARRAY-1                                  VALUE SPACES.
015200         05  KODE OCCURS 9 TIMES INDEXED BY CODX
015300                                  PIC X(1).
015400 01  DEFINE-VARIABLES.
015500     05  PARMLST                  PIC X(36) VALUE
015600     '(PARM STATE ENDL ERRL ERRT FILESTAT)'.
015700     05  SRCHARGLST               PIC X(19) VALUE
015800     '(SRCHARG1 SRCHARG2)'.
015900     05  PTFLST                   PIC X(7)  VALUE '(PTFMD)'.
016000     05  DATELST                  PIC X(10) VALUE '(YY MM DD)'.
016100     05  ACRNMLST                 PIC X(42) VALUE
016200     '(ACRNM ACRNM1 ACRNM2 ACRNM3 ACRNM4 ACRNM5)'.
016300     05  P32ACRLST.
016400         10  FILLER               PIC X(57) VALUE
016500     '(ACRNML1 ACRNML2 ACRNML3 ACRNML4 ACRNML5 ACRNML6 ACRNML7 '.
016600         10  FILLER               PIC X(8) VALUE
016700     'ACRNML8)'.
016800     05  PRDNMLST.
016900         10  FILLER               PIC X(25) VALUE
017000     '(PRDN1 PRDN2 VENDR CTGRY '.
017100         10  FILLER               PIC X(42) VALUE
017200     'PRDN11 PRDN21 PRDN12 PRDN22 PRDN13 PRDN23 '.
017300         10  FILLER               PIC X(28) VALUE
017400     'PRDN14 PRDN24 PRDN15 PRDN25)'.
017500     05  P32PRDLST.
017600         10  FILLER               PIC X(58) VALUE
017700      '(PRDL11 PRDL21 PRDL12 PRDL22 PRDL13 PRDL23 PRDL14 PRDL24 '.
017800         10  FILLER               PIC X(56) VALUE
017900     'PRDL15 PRDL25 PRDL16 PRDL26 PRDL17 PRDL27 PRDL18 PRDL28)'.
018000         10  FILLER               PIC X(28) VALUE
018100     'PRDL17 PRDL27 PRDL18 PRDL28)'.
018200     05  P33INXLST.
018300         10  FILLER               PIC X(49) VALUE
018400     '(INXITM1 INXITM2 INXITM3 INXITM4 INXITM5 INXITM6 '.
018500         10  FILLER               PIC X(51) VALUE
018600     'INXITM7 INXITM8 INXITM9 INXITM10 INXITM11 INXITM12 '.
018700         10  FILLER               PIC X(36) VALUE
018800     'INXITM13 INXITM14 INXITM15 INXITM16)'.
018900     05  ORDRELLST.
019000         10  FILLER               PIC X(49) VALUE
019100     '(ORDR1 RELS1 ORDR2 RELS2 ORDR3 RELS3 ORDR4 RELS4 '.
019200         10  FILLER               PIC X(57) VALUE
019300     ' ORDR5 RELS5 ORDR6 RELS6 ORDR7 RELS7 ORDR8 RELS8 ERRFILE)'.
019400     05  CODELST                  PIC X(28) VALUE
019500         '(C1 C2 C3 C4 C5 C6 C7 C8 C9)'.
019600     05  FMIDLST                  PIC X(49) VALUE
019700     '(FMID1 FMID2 FMID3 FMID4 FMID5 FMID6 FMID7 FMID8)'.
019800     05  P34DTLST.
019900         10  FILLER               PIC X(49) VALUE
020000     '(Y1 M1 D1 Y2 M2 D2 Y3 M3 D3 Y4 M4 D4 Y5 M5 D5 Y6 '.
020100         10  FILLER               PIC X(24) VALUE
020200     'M6 D6 Y7 M7 D7 Y8 M8 D8)'.
020300     05  P34PTFLST.
020400         10  FILLER               PIC X(57) VALUE
020500     '(PTFMDU1 PTFMDU2 PTFMDU3 PTFMDU4 PTFMDU5 PTFMDU6 PTFMDU7 '.
020600         10  FILLER               PIC X(8) VALUE
020700     'PTFMDU8)'.
020800     05  BUFLENGTH            PIC 9(8) COMP VALUE 13.
020900     05  SSRPRINT             PIC X(13) VALUE
021000         'CMD(SSRPRINT)'.
021100 01  VARIABLE-LENGTHS.
021200     05  L1                       PIC 9(6) COMP VALUE 1.
021300     05  L2                       PIC 9(6) COMP VALUE 2.
021400     05  L4                       PIC 9(6) COMP VALUE 4.
021500     05  L6                       PIC 9(6) COMP VALUE 6.
021600     05  L7                       PIC 9(6) COMP VALUE 7.
021700     05  L10                      PIC 9(6) COMP VALUE 10.
021800     05  L12                      PIC 9(6) COMP VALUE 12.
021900     05  L16                      PIC 9(6) COMP VALUE 16.
022000     05  L32                      PIC 9(6) COMP VALUE 32.
022100     05  L64                      PIC 9(6) COMP VALUE 64.
022200 01  SAVE-TBL.
022300     05 P30SAVE.
022400         10  FILLER OCCURS 5 TIMES INDEXED BY P30SINX.
022500             15 ACRNMS            PIC X(16).
022600             15 PRDNMS            PIC X(64).
022700             15 PINXS             PIC 9(4) COMP.
022800             15 VINXS             PIC 9(4) COMP.
022900             15 CINXS             PIC 9(4) COMP.
023000             15 NEWVS             PIC X.
023100             15 NEWCS             PIC X.
023200             15 VENDRS            PIC X(32).
023300             15 CTGRYS            PIC X(32).
023400     05  P34SAVE REDEFINES P30SAVE.
023500         10  ACRNMUS              PIC X(16).
023600         10  PRDNMUS              PIC X(64).
023700         10  VENDRUS              PIC X(32).
023800         10  CTGRYUS              PIC X(32).
023900         10  PINXUS               PIC 9(4) COMP.
024000         10  VINXUS               PIC 9(4) COMP.
024100         10  CINXUS               PIC 9(4) COMP.
024200         10  P34SAVE-LINES.
024300             15 FILLER OCCURS 8 TIMES INDEXED BY P34SINX.
024400                 20 ORDRUS        PIC X(12).
024500                 20 RELSUS        PIC X(12).
024600                 20 PTFMDUS       PIC X(10).
024700                 20 DTINSTUS      PIC X(6).
024800                 20 FMIDUS        PIC X(7).
024900         10  FILLER               PIC X(218).
025000 01  LISTX-TBL.
025100     05  FILLER OCCURS 16 TIMES INDEXED BY SELX.
025200         10  SELINX               PIC 9(4) COMP.
025300         10  SELRRN               PIC 9(4) COMP.
025400         10  SELSLOT              PIC 9(4) COMP.
025500 01  MISC-VARIABLES.
025600     05  SEQ                      PIC 9(3) COMP-3.
025700     05  EDIT-STATUS              PIC 9.
025800     05  PRRNUM                   PIC 9(4) COMP VALUE ZERO.
025900     05  PRTBL-UPD                PIC X(1) VALUE SPACE.
026000     05  REQ-PRRNUM               PIC 9(4) COMP.
026100     05  REQ-PRTBLINX             PIC 9(4) COMP.
026200     05  PRTBL-PARM-CHANGE        PIC X(1) VALUE SPACE.
026300     05  IRRNUM                   PIC 9(4) COMP.
026400     05  INTBL-UPD                PIC X(1) VALUE SPACE.
026500     05  REQ-IRRNUM               PIC 9(4) COMP.
026600     05  REQ-INTBLINX             PIC 9(4) COMP.
026700     05  INTBL-PARM-CHANGE        PIC X(1) VALUE SPACE.
026800     05  TABLE-PARMS.
026900         10 PRTBL-HI-PINX         PIC 9(4) COMP.
027000         10 PRTBL-HI-RRNUM        PIC 9(4) COMP.
027100         10 INTBL-HI-IINX         PIC 9(4) COMP.
027200         10 INTBL-HI-RRNUM        PIC 9(4) COMP.
027300     05  INSRT-SLOT               PIC 9(4) COMP.
027400     05  PTF-ADD-FLAG             PIC X.
027500         88  NO-PTF-ADDS                  VALUE '0'.
027600         88  PTF-ADDS                     VALUE '1'.
027700     05  TBL-ADD-FLAG             PIC X.
027800         88  NO-TBL-ADDS                  VALUE '0'.
027900         88  TBL-ADDS                     VALUE '1'.
028000     05  NO-RELEASE-FLAG          PIC X.
028100         88  ALL-RELEASES-SPECIFIED       VALUE '0'.
028200     05  LOCATE-FLAG              PIC 9.
028300         88  ENTRY-NOT-FOUND              VALUE 0.
028400         88  ENTRY-FOUND                  VALUE 1.
028500         88  BEFORE-ENTRY                 VALUE 2.
028600         88  AFTER-ENTRY                  VALUE 3.
028700         88  EMPTY-SET                    VALUE 4.
028800         88  END-OF-SET                   VALUE 4.
028900     05  STATUS-FLAG              PIC X.
029000     05  UPDATE-FLAG              PIC X.
029100     05  HSTRY-MODE               PIC X(2).
029200     05  CURR-DTINST              PIC X(6).
029300     05  NEXT-DTINST              PIC X(6).
029400 01  ISPF-PARMS.
029500     05  SSRPNL00                 PIC X(9) VALUE 'SSRPNL00 '.
029600     05  SSRPNL30                 PIC X(9) VALUE 'SSRPNL30 '.
029700     05  SSRPNL31                 PIC X(9) VALUE 'SSRPNL31 '.
029800     05  SSRPNL32                 PIC X(9) VALUE 'SSRPNL32 '.
029900     05  SSRPNL33                 PIC X(9) VALUE 'SSRPNL33 '.
030000     05  SSRPNL34                 PIC X(9) VALUE 'SSRPNL34 '.
030100     05  SSRMSGNUM                PIC X(9) VALUE SPACES.
030200     05  ISPDISPLAY               PIC X(8) VALUE 'DISPLAY '.
030300     05  ISPSETMSG                PIC X(7) VALUE 'SETMSG '.
030400     05  ISPSELECT                PIC X(7) VALUE 'SELECT '.
030500     05  ISPVDEFINE               PIC X(8) VALUE 'VDEFINE '.
030600     05  ISPVDELETE               PIC X(8) VALUE 'VDELETE '.
030700     05  CHAR                     PIC X(5) VALUE 'CHAR '.
030800 01  FILE-STATUS             VALUE ZERO.
030900     05  SSRHSTRY-ST              PIC X(2).
031000     05  SSRPRTBL-ST              PIC X(2).
031100     05  SSRINTBL-ST              PIC X(2).
031200 01  SAVE-SEARCH-ARGS.
031300     05  SAVE-SRCHTYPE            PIC X      VALUE SPACES.
031400     05  SAVE-SRCHARG1            PIC X(32)  VALUE SPACES.
031500     05  SAVE-SRCHARG2            PIC X(32)  VALUE SPACES.
031600     05  SAVE-SRCHINX             PIC 9(4) COMP.
031700 01  SEARCH-ARGS.
031800     05  SRCHTYPE                 PIC X.
031900     05  SRCHARG.
032000         10  SRCHARG1             PIC X(32).
032100         10  SRCHARG2             PIC X(32).
032200     05  SRCHACRNM                PIC X(16).
032300     05  SRCHPRDNM.
032400         10  SRCHPRDN1            PIC X(32).
032500         10  SRCHPRDN2            PIC X(32).
032600     05  SRCHPTFKEY.
032700         10 SRCHPTFMD             PIC X(10).
032800         10 SRCHPTFINX            PIC 9(4) COMP.
032900     05  SRCHFMIDKEY.
033000         10 SRCHFMID              PIC X(7).
033100         10 SRCHFMIDINX           PIC 9(4) COMP.
033200     05  SRCHINXKEY.
033300         10  SRCHINXTYPE          PIC X.
033400         10  SRCHINXITM           PIC X(32).
033500     05  SRCHPINX                 PIC 9(4) COMP.
033600     05  SRCHVINX                 PIC 9(4) COMP.
033700     05  SRCHCINX                 PIC 9(4) COMP.
033800 PROCEDURE DIVISION.
033900 OPEN-FILES.
034000     CALL 'ISPLINK' USING ISPVDEFINE SRCHARGLST SRCHARG CHAR L32.
034100     CALL 'ISPLINK' USING ISPVDEFINE PARMLST ARRAY-2 CHAR L2.
034200     CALL 'ISPLINK' USING ISPVDEFINE ORDRELLST ARRAY-12 CHAR
034300             L12.
034400     CALL 'ISPLINK' USING ISPVDEFINE CODELST ARRAY-1 CHAR L1.
034500     CALL 'ISPLINK' USING ISPVDEFINE FMIDLST ARRAY-7 CHAR L7.
034600     OPEN INPUT SSRHSTRY.
034700     IF SSRHSTRY-ST NOT = ZEROS
034800          MOVE 'SSRMS900' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
034900          GO TO FILE-ERROR.
035000     MOVE 'IN' TO  HSTRY-MODE.
035100 MENU-PANEL.
035200     MOVE SPACES TO SRCHTYPE SRCHARG SRCHACRNM SRCHPRDNM
035300                    SRCHPTFMD SRCHFMID SRCHINXKEY.
035400     MOVE ZERO TO SRCHPINX SRCHVINX SRCHCINX.
035500     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL00.
035600     IF RETURN-CODE = 8 GO TO END-PROGRAM
035700         ELSE GO TO CHECK-PARMS.
035800 FILE-ERROR.
035900     IF ERRFILE = 'SSRINTBL'
036000         MOVE SSRINTBL-ST TO FILESTAT.
036100     IF ERRFILE = 'SSRPRTBL'
036200         MOVE SSRPRTBL-ST TO FILESTAT.
036300     IF ERRFILE = 'SSRHSTRY'
036400         MOVE SSRHSTRY-ST TO FILESTAT.
036500     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL00 SSRMSGNUM.
036600 END-PROGRAM.
036700     MOVE 'SSRPRTBL' TO ERRFILE.
036800     IF PRTBL-UPD = 'Y' AND PRRNUM > ZERO
036900         REWRITE PRTBL-REC
037000         IF SSRPRTBL-ST NOT = ZEROS
037100             MOVE 'SSRMS902' TO SSRMSGNUM PERFORM FILE-ERROR.
037200     IF PRRNUM > ZERO
037300         CLOSE SSRPRTBL
037400         IF SSRPRTBL-ST NOT = ZERO
037500              MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR.
037600     MOVE 'SSRINTBL' TO ERRFILE.
037700     IF INTBL-UPD = 'Y' AND IRRNUM > ZERO
037800         REWRITE INTBL-REC
037900         IF SSRINTBL-ST NOT = ZEROS
038000             MOVE 'SSRMS902' TO SSRMSGNUM PERFORM FILE-ERROR.
038100     IF IRRNUM > ZERO
038200         CLOSE SSRINTBL
038300         IF SSRINTBL-ST NOT = ZERO
038400              MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR.
038500     CLOSE SSRHSTRY.
038600     IF SSRHSTRY-ST NOT = ZEROS
038700         MOVE 'SSRMS903' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
038800         PERFORM FILE-ERROR.
038900     CALL 'ISPLINK' USING ISPVDELETE SRCHARGLST.
039000     CALL 'ISPLINK' USING ISPVDELETE PARMLST.
039100     CALL 'ISPLINK' USING ISPVDELETE PTFLST.
039200     CALL 'ISPLINK' USING ISPVDELETE DATELST.
039300     CALL 'ISPLINK' USING ISPVDELETE FMIDLST.
039400     CALL 'ISPLINK' USING ISPVDELETE ACRNMLST.
039500     CALL 'ISPLINK' USING ISPVDELETE PRDNMLST.
039600     CALL 'ISPLINK' USING ISPVDELETE ORDRELLST.
039700     CALL 'ISPLINK' USING ISPVDELETE CODELST.
039800     GOBACK.
039900 CHECK-PARMS.
040000     IF PARM-SRCHTYPE = 'A'
040100         MOVE SRCHARG1 TO SRCHACRNM.
040200     IF PARM-SRCHTYPE = 'T'
040300         MOVE SRCHARG1 TO SRCHPTFMD
040400         MOVE ZERO TO SRCHPTFINX.
040500     IF PARM-SRCHTYPE = 'F'
040600         MOVE SRCHARG1 TO SRCHFMID
040700         MOVE ZERO TO SRCHFMIDINX.
040800     IF PARM-SRCHTYPE = 'V'
040900         MOVE 'V' TO SRCHINXTYPE
041000         MOVE SRCHARG1 TO SRCHINXITM.
041100     IF PARM-SRCHTYPE = 'C'
041200         MOVE 'C' TO SRCHINXTYPE
041300         MOVE SRCHARG1 TO SRCHINXITM.
041400     IF PARM-SRCHTYPE = 'P'
041500         MOVE SRCHARG TO SRCHPRDNM.
041600     MOVE PARM-SRCHTYPE TO SRCHTYPE.
041700     IF PARM-FUNCTION = 'H'
041800         GO TO PRODUCT-HISTORY-FUNCTION.
041900     IF PARM-FUNCTION = 'P'
042000         GO TO PRODUCT-LIST-FUNCTION.
042100     IF PARM-FUNCTION = 'V' OR 'C'
042200         GO TO INXITM-LIST-FUNCTION.
042300     IF PARM-FUNCTION = 'L'
042400         CALL 'ISPLINK' USING ISPSELECT BUFLENGTH SSRPRINT
042500         GO TO MENU-PANEL.
042600 ADD-FUNCTION.
042700     MOVE 'A' TO STATE-1.
042800     CALL 'ISPLINK' USING ISPVDEFINE PTFLST PTFMD CHAR L10.
042900     CALL 'ISPLINK' USING ISPVDEFINE DATELST DATE-INST CHAR L2.
043000     CALL 'ISPLINK' USING ISPVDEFINE ACRNMLST ARRAY-16 CHAR
043100             L16.
043200     CALL 'ISPLINK' USING ISPVDEFINE PRDNMLST ARRAY-32 CHAR
043300             L32.
043400     MOVE ZEROS TO DATE-INST.
043500     MOVE SPACES TO ARRAY-16 ARRAY-32 ARRAY-12 ARRAY-7
043600         ARRAY-1 PTFMD.
043700 ENTRY-SCREEN.
043800     MOVE SPACE TO STATE-2.
043900     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL30
044000         IF RETURN-CODE = 8 GO TO MENU-PANEL.
044100     MOVE 1 TO REQ-PRRNUM REQ-IRRNUM.
044200     PERFORM LOCATE-PRTBL.
044300     PERFORM LOCATE-INTBL.
044400 START-EDIT.
044500     SET P30ACRX TO 1. SET P30PRDX TO 1. SET ORDRELX TO 1.
044600     SET CODX TO 1. SET P30SINX TO 1. SET FMIDX TO 1.
044700     MOVE 0 TO EDIT-STATUS.
044800     MOVE '0' TO NO-RELEASE-FLAG.
044900     MOVE '0' TO PTF-ADD-FLAG.
045000 EDIT-SCREEN.
045100     IF PRDNME(P30PRDX) = SPACES
045200       AND ACRNME(P30ACRX) = SPACES
045300         NEXT SENTENCE
045400     ELSE
045500         MOVE '1' TO PTF-ADD-FLAG
045600         IF PRDNME(P30PRDX) = PRDNMS(P30SINX)
045700           AND ACRNME(P30ACRX) = ACRNMS(P30SINX)
045800             NEXT SENTENCE
045900         ELSE
046000             PERFORM EDIT-LINE THRU EDIT-EXIT
046100                 IF EDIT-STATUS = 1 GO TO START-EDIT
046200                 ELSE IF EDIT-STATUS = 2 GO TO ENTRY-SCREEN
046300                 ELSE IF EDIT-STATUS = 9 GO TO MENU-PANEL.
046400     MOVE PRDNME(P30PRDX) TO PRDNMS(P30SINX).
046500     MOVE ACRNME(P30ACRX) TO ACRNMS(P30SINX).
046600     IF P30PRDX < 5
046700         SET P30PRDX UP BY 1
046800         SET P30ACRX UP BY 1
046900         SET ORDRELX UP BY 1
047000         SET FMIDX UP BY 1
047100         SET CODX UP BY 1
047200         SET P30SINX UP BY 1
047300         GO TO EDIT-SCREEN.
047400     IF ALL-RELEASES-SPECIFIED
047500         GO TO PROCESS-ADDS.
047600     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
047700     PERFORM LOCATE-PRTBL.
047800     PERFORM LOCATE-INTBL.
047900     IF STATE-1 = 'A'
048000         IF NO-PTF-ADDS
048100             GO TO ENTRY-SCREEN.
048200     MOVE 'C' TO STATE-1.
048300     GO TO ENTRY-SCREEN.
048400 SAVE-SEARCHARGS.
048500     IF SRCHTYPE = 'A'
048600         MOVE SRCHACRNM TO SAVE-SRCHARG1.
048700     IF SRCHTYPE = 'P'
048800         MOVE SRCHPRDN1 TO SAVE-SRCHARG1
048900         MOVE SRCHPRDN2 TO SAVE-SRCHARG2.
049000     IF SRCHTYPE = 'V'
049100         MOVE SRCHVINX TO SAVE-SRCHINX.
049200     IF SRCHTYPE = 'C'
049300         MOVE SRCHCINX TO SAVE-SRCHINX.
049400     IF SRCHTYPE = 'T'
049500         MOVE SRCHPTFKEY TO SAVE-SRCHARG1.
049600     IF SRCHTYPE = 'F'
049700         MOVE SRCHFMIDKEY TO SAVE-SRCHARG1.
049800     MOVE SRCHTYPE TO SAVE-SRCHTYPE.
049900 RESTORE-SEARCHARGS.
050000     MOVE SAVE-SRCHTYPE TO SRCHTYPE.
050100     IF SRCHTYPE = 'A'
050200         MOVE SAVE-SRCHARG1 TO SRCHACRNM.
050300     IF SRCHTYPE = 'P'
050400         MOVE SAVE-SRCHARG1 TO SRCHPRDN1
050500         MOVE SAVE-SRCHARG2 TO SRCHPRDN2.
050600     IF SRCHTYPE = 'V'
050700         MOVE SAVE-SRCHINX TO SRCHVINX.
050800     IF SRCHTYPE = 'C'
050900         MOVE SAVE-SRCHINX TO SRCHCINX.
051000     IF SRCHTYPE = 'T'
051100         MOVE SAVE-SRCHARG1 TO SRCHPTFKEY.
051200     IF SRCHTYPE = 'F'
051300         MOVE SAVE-SRCHARG1 TO SRCHFMIDKEY.
051400 PRODUCT-HISTORY-FUNCTION.
051500     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
051600     IF NOT ENTRY-FOUND MOVE 'N ' TO ERRT GO TO MENU-PANEL.
051700     PERFORM LIST-PROD-HISTORY THRU PROD-HIST-EXIT.
051800     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
051900     PERFORM LOCATE-PRTBL.
052000     PERFORM LOCATE-INTBL.
052100     GO TO MENU-PANEL.
052200 LIST-PROD-HISTORY.
052300     MOVE SPACE TO STATUS-FLAG.
052400     CALL 'ISPLINK' USING ISPVDEFINE ACRNMLST ARRAY-16 CHAR
052500             L16.
052600     CALL 'ISPLINK' USING ISPVDEFINE PRDNMLST ARRAY-32 CHAR
052700             L32.
052800     CALL 'ISPLINK' USING ISPVDEFINE P34PTFLST P34PTF-TBL CHAR
052900             L10.
053000     CALL 'ISPLINK' USING ISPVDEFINE P34DTLST P34DTINST-TBL CHAR
053100             L2.
053200     MOVE ZEROES TO SSRHSTRY-DATE-INST.
053300 PROD-HISTORY.
053400     PERFORM SAVE-SEARCHARGS.
053500     MOVE PRTBL-PRDNM(PRTBLINX) TO PRDNM PRDNMUS.
053600     MOVE PRTBL-ACRNM(PRTBLINX) TO ACRNM ACRNMUS.
053700     MOVE PRTBL-PINX(PRTBLINX) TO PINXUS.
053800     MOVE PRTBL-CINX(PRTBLINX) TO SRCHCINX CINXUS.
053900     MOVE 'Z' TO SRCHTYPE.
054000     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
054100     IF ENTRY-FOUND MOVE INTBL-INXITM(INTBLINX) TO CTGRY, CTGRYUS
054200         ELSE MOVE SPACE TO CTGRY, CTGRYUS.
054300     MOVE PRTBL-VINX(PRTBLINX) TO SRCHVINX VINXUS.
054400     MOVE 'Y' TO SRCHTYPE.
054500     PERFORM SEARCH-INTBL THRU SEARCH-INTBL-EXIT.
054600     IF ENTRY-FOUND MOVE INTBL-INXITM(INTBLINX) TO VENDR, VENDRUS
054700         ELSE MOVE SPACE TO VENDR, VENDRUS.
054800     MOVE SPACE TO ERRT.
054900 START-SSRHSTRY.
055000     SET ORDRELX TO 1. SET FMIDX TO 1. SET P34PTFX TO 1.
055100     SET P34DTX TO 1. SET P34SINX TO 1.
055200     MOVE SPACES TO P34PTF-TBL P34DTINST-TBL ARRAY-12 ARRAY-7
055300         ARRAY-1 P34SAVE-LINES.
055400     MOVE ZERO TO ERRL ENDL.
055500     MOVE PINXUS TO SSRHSTRY-PINX.
055600     MOVE SSRHSTRY-DATE-INST TO CURR-DTINST.
055700     START SSRHSTRY KEY > SSRHSTRY-KEY
055800         INVALID KEY GO TO END-HIST-RECS.
055900     IF SSRHSTRY-ST NOT = ZEROS
056000         MOVE 'SSRMS904' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
056100         GO TO FILE-ERROR.
056200 NEXT-SSRHSTRY.
056300     READ SSRHSTRY NEXT AT END GO TO END-HIST-RECS.
056400     IF SSRHSTRY-ST NOT = ZEROS
056500         MOVE 'SSRMS901' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
056600         GO TO FILE-ERROR.
056700     IF SSRHSTRY-PINX = PRTBL-PINX(PRTBLINX)
056800         GO TO NEXT-HIST-LINE.
056900 END-HIST-RECS.
057000     IF ORDRELX = 1 AND ERRT = 'F '
057100         GO TO NEXT-PRODUCT.
057200     MOVE ZEROS TO NEXT-DTINST.
057300     GO TO PROD-HIST-PANEL.
057400 NEXT-HIST-LINE.
057500     MOVE SSRHSTRY-ORDR TO ORDRE(ORDRELX) ORDRUS(P34SINX).
057600     MOVE SSRHSTRY-RELS TO RELSE(ORDRELX) RELSUS(P34SINX).
057700     MOVE SSRHSTRY-FMID TO FMIDE(FMIDX) FMIDUS(P34SINX).
057800     MOVE SSRHSTRY-PTFMD TO PTFMDU(P34PTFX) PTFMDUS(P34SINX).
057900     MOVE SSRHSTRY-DATE-INST TO DTINSTU(P34DTX) DTINSTUS(P34SINX).
058000     ADD 1 TO ENDL.
058100     IF ORDRELX < 8
058200         SET ORDRELX UP BY 1  SET FMIDX UP BY 1
058300         SET P34PTFX UP BY 1  SET P34DTX UP BY 1
058400         SET P34SINX UP BY 1
058500         GO TO NEXT-SSRHSTRY.
058600     MOVE SSRHSTRY-DATE-INST TO NEXT-DTINST.
058700 PROD-HIST-PANEL.
058800     MOVE 0 TO REQ-PRRNUM REQ-IRRNUM.
058900     PERFORM LOCATE-PRTBL.
059000     PERFORM LOCATE-INTBL.
059100     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL34.
059200     IF RETURN-CODE = 8 MOVE 'E' TO STATUS-FLAG.
059300     MOVE ' ' TO UPDATE-FLAG.
059400     PERFORM LOCATE-PRTBL.
059500     PERFORM LOCATE-INTBL.
059600     PERFORM GET-TABLE-PARMS.
059700     IF KODE(9) = 'D'
059800         PERFORM DELETE-PROD THRU DELETE-PROD-EXIT
059900         GO TO CLOSE-HISTORY-IO.
060000     MOVE ZERO TO SRCHVINX.
060100     IF CTGRY NOT = CTGRYUS
060200         MOVE 'Y' TO UPDATE-FLAG
060300         MOVE CTGRY TO SRCHINXITM
060400         MOVE 'C' TO SRCHTYPE SRCHINXTYPE
060500         PERFORM ADD-INXITM THRU ADD-INXITM-EXIT
060600         MOVE CTGRY TO CTGRYUS
060700         MOVE INTBL-IINX(INTBLINX) TO CINXUS.
060800     IF VENDR NOT = VENDRUS
060900         MOVE 'Y' TO UPDATE-FLAG
061000         MOVE VENDR TO SRCHINXITM
061100         MOVE 'V' TO SRCHTYPE SRCHINXTYPE
061200         PERFORM ADD-INXITM THRU ADD-INXITM-EXIT
061300         MOVE VENDR TO VENDRUS
061400         MOVE INTBL-IINX(INTBLINX) TO VINXUS.
061500     IF ACRNMUS NOT = ACRNM MOVE 'Y' TO UPDATE-FLAG.
061600     IF PRDNM = PRDNMUS
061700         GO TO UPDATE-PROD.
061800     MOVE PRDNM TO SRCHPRDNM MOVE 'P' TO SRCHTYPE.
061900     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
062000     IF ENTRY-FOUND MOVE 'DP' TO ERRT GO TO PROD-HIST-PANEL.
062100     MOVE ACRNM TO SRCHACRNM.
062200     MOVE PINXUS TO SRCHPINX.
062300     MOVE VINXUS TO SRCHVINX.
062400     MOVE CINXUS TO SRCHCINX.
062500     PERFORM ADD-PRODUCT THRU ADD-PRODUCT-EXIT.
062600     MOVE PRDNMUS TO SRCHPRDNM.
062700     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
062800     PERFORM DELETE-PROD THRU DELETE-PROD-EXIT.
062900     GO TO HIST-UPDATE.
063000 UPDATE-PROD.
063100     IF UPDATE-FLAG NOT = 'Y'
063200         GO TO HIST-UPDATE.
063300     MOVE ACRNM TO PRTBL-ACRNM(PRTBLINX).
063400     MOVE CINXUS TO PRTBL-CINX(PRTBLINX).
063500     MOVE VINXUS TO PRTBL-VINX(PRTBLINX).
063600     MOVE 'Y' TO PRTBL-UPD.
063700     GO TO HIST-UPDATE.
063800 DELETE-PROD.
063900     IF PRTBLINX < PRTBL-HI-SLOT
064000         MOVE PRTBL-ENTRY(PRTBLINX + 1) TO PRTBL-ENTRY(PRTBLINX)
064100         SET PRTBLINX UP BY 1
064200         GO TO DELETE-PROD.
064300     SUBTRACT 1 FROM PRTBL-HI-SLOT.
064400     MOVE 'Y' TO PRTBL-UPD.
064500     IF KODE(9) NOT = 'D'
064600         GO TO DELETE-PROD-EXIT.
064700     PERFORM OPEN-HISTORY-IO.
064800     MOVE PINXUS TO SSRHSTRY-PINX.
064900     MOVE ZEROES TO SSRHSTRY-DATE-INST.
065000     START SSRHSTRY KEY NOT < SSRHSTRY-KEY
065100         INVALID KEY GO TO DELETE-PROD-EXIT.
065200     IF SSRHSTRY-ST NOT = ZEROS
065300         MOVE 'SSRMS904' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
065400         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
065500 DELETE-SSRHSTRY-LOOP.
065600     READ SSRHSTRY NEXT AT END GO TO DELETE-PROD-EXIT.
065700     IF SSRHSTRY-ST NOT = ZEROS
065800         MOVE 'SSRMS901' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
065900         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
066000     IF SSRHSTRY-PINX NOT = PINXUS
066100         GO TO DELETE-PROD-EXIT.
066200     DELETE SSRHSTRY RECORD.
066300     IF SSRHSTRY-ST NOT = ZEROS
066400         MOVE 'SSRMS905' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
066500         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
066600     GO TO DELETE-SSRHSTRY-LOOP.
066700 DELETE-PROD-EXIT.
066800     EXIT.
066900 OPEN-HISTORY-IO.
067000     IF HSTRY-MODE = 'IN'
067100       MOVE 'SSRHSTRY' TO ERRFILE
067200       CLOSE SSRHSTRY
067300       IF SSRHSTRY-ST NOT = ZEROS
067400         MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR
067500       ELSE
067600         OPEN I-O SSRHSTRY
067700           IF SSRHSTRY-ST NOT = ZEROS
067800             MOVE 'SSRMS900' TO SSRMSGNUM GO TO FILE-ERROR.
067900     MOVE 'IO' TO HSTRY-MODE.
068000 HIST-UPDATE.
068100     PERFORM UPDATE-TABLE-PARMS.
068200     MOVE ACRNM TO ACRNMUS.
068300     MOVE PRDNM TO PRDNMUS.
068400     SET ORDRELX TO 1. SET P34PTFX TO 1. SET P34DTX TO 1.
068500     SET FMIDX TO 1. SET P34SINX TO 1. SET CODX TO 1.
068600 HIST-UPDATE-LOOP.
068700     IF ORDRELX > ENDL GO TO CLOSE-HISTORY-IO.
068800     IF DTINSTUS(P34SINX) = SPACES OR ZEROS
068900         GO TO NEXT-HIST-UPDATE.
069000     MOVE ' ' TO UPDATE-FLAG.
069100     IF KODE(CODX) = 'D'
069200         GO TO DELETE-SSRHSTRY.
069300     IF ORDRE(ORDRELX) NOT = ORDRUS(P34SINX)
069400         MOVE 'Y' TO UPDATE-FLAG.
069500     IF RELSE(ORDRELX) NOT = RELSUS(P34SINX)
069600         MOVE 'Y' TO UPDATE-FLAG.
069700     IF FMIDE(FMIDX) NOT = FMIDUS(P34SINX)
069800         MOVE 'Y' TO UPDATE-FLAG.
069900     IF PTFMDU(P34PTFX) NOT = PTFMDUS(P34SINX)
070000         MOVE 'Y' TO UPDATE-FLAG.
070100     IF DTINSTU(P34DTX) = DTINSTUS(P34SINX)
070200         IF UPDATE-FLAG = 'Y' GO TO UPDATE-SSRHSTRY
070300         ELSE GO TO NEXT-HIST-UPDATE.
070400     IF YYU(P34DTX) < '00' MOVE 'DE' TO ERRT.
070500     IF MMU(P34DTX) < '00' OR > '12' MOVE 'DE' TO ERRT.
070600     IF MMU(P34DTX) = '04' OR '06' OR '09' OR '11'
070700         IF DDU(P34DTX) > '30' MOVE 'DE' TO ERRT.
070800     IF MMU(P34DTX) = '02'
070900         IF DDU(P34DTX) > '29' MOVE 'DE' TO ERRT.
071000     IF DDU(P34DTX) < '00' OR > '31' MOVE 'DE' TO ERRT.
071100     IF ERRT = 'DE' SET ERRL TO P34DTX GO TO PROD-HIST-PANEL.
071200     PERFORM OPEN-HISTORY-IO.
071300     MOVE PINXUS TO SSRHSTRY-PINX
071400                    SSRHSTRY-PTFINX SSRHSTRY-FMIDINX.
071500     MOVE DTINSTU(P34DTX) TO SSRHSTRY-DATE-INST.
071600     MOVE ORDRE(ORDRELX) TO SSRHSTRY-ORDR.
071700     MOVE RELSE(ORDRELX) TO SSRHSTRY-RELS.
071800     MOVE FMIDE(FMIDX) TO SSRHSTRY-FMID.
071900     MOVE PTFMDU(P34PTFX) TO SSRHSTRY-PTFMD.
072000     WRITE SSRHSTRY-REC
072100         INVALID KEY
072200             SET ERRL TO ORDRELX   MOVE 'DT' TO ERRT
072300             PERFORM CLOSE-HISTORY-IO GO TO PROD-HIST-PANEL.
072400     IF SSRHSTRY-ST = '00' OR '02' NEXT SENTENCE ELSE
072500         MOVE 'SSRMS902' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
072600         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
072700 DELETE-SSRHSTRY.
072800     PERFORM OPEN-HISTORY-IO.
072900     MOVE PINXUS TO SSRHSTRY-PINX.
073000     MOVE DTINSTUS(P34SINX) TO SSRHSTRY-DATE-INST.
073100     DELETE SSRHSTRY INVALID KEY GO TO NEXT-HIST-UPDATE.
073200     IF SSRHSTRY-ST NOT = ZEROS
073300         MOVE 'SSRMS905' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
073400         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
073500     GO TO NEXT-HIST-UPDATE.
073600 UPDATE-SSRHSTRY.
073700     IF UPDATE-FLAG NOT = 'Y' GO TO NEXT-HIST-UPDATE.
073800     PERFORM OPEN-HISTORY-IO.
073900     MOVE ORDRE(ORDRELX) TO SSRHSTRY-ORDR.
074000     MOVE RELSE(ORDRELX) TO SSRHSTRY-RELS.
074100     MOVE FMIDE(FMIDX) TO SSRHSTRY-FMID.
074200     MOVE PTFMDU(P34PTFX) TO SSRHSTRY-PTFMD.
074300     MOVE PINXUS TO SSRHSTRY-PINX
074400                    SSRHSTRY-PTFINX SSRHSTRY-FMIDINX.
074500     MOVE DTINSTUS(P34SINX) TO SSRHSTRY-DATE-INST.
074600     REWRITE SSRHSTRY-REC INVALID KEY GO TO NEXT-HIST-UPDATE.
074700     IF SSRHSTRY-ST = '00' OR '02' NEXT SENTENCE ELSE
074800         MOVE 'SSRMS902' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
074900         PERFORM CLOSE-HISTORY-IO GO TO FILE-ERROR.
075000 NEXT-HIST-UPDATE.
075100     IF KODE(CODX) = 'D'
075200         MOVE SPACES TO DTINSTU(P34DTX)
075300                        ORDRE(ORDRELX)
075400                        RELSE(ORDRELX)
075500                        FMIDE(FMIDX)
075600                        PTFMDU(P34PTFX).
075700     MOVE DTINSTU(P34DTX) TO DTINSTUS(P34SINX).
075800     MOVE ORDRE(ORDRELX) TO ORDRUS(P34SINX).
075900     MOVE RELSE(ORDRELX) TO RELSUS(P34SINX).
076000     MOVE FMIDE(FMIDX) TO FMIDUS(P34SINX).
076100     MOVE PTFMDU(P34PTFX) TO PTFMDUS(P34SINX).
076200     SET ORDRELX UP BY 1  SET FMIDX UP BY 1
076300     SET P34DTX UP BY 1  SET P34PTFX UP BY 1
076400     SET P34SINX UP BY 1  SET CODX UP BY 1
076500     GO TO HIST-UPDATE-LOOP.
076600 CLOSE-HISTORY-IO.
076700     IF HSTRY-MODE = 'IO'
076800         MOVE 'SSRHSTRY' TO ERRFILE
076900         CLOSE SSRHSTRY
077000         IF SSRHSTRY-ST NOT = ZEROS
077100             MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR
077200         ELSE OPEN INPUT SSRHSTRY
077300             IF SSRHSTRY-ST NOT = ZEROS
077400                 MOVE 'SSRMS900' TO SSRMSGNUM GO TO FILE-ERROR.
077500     MOVE 'IN' TO HSTRY-MODE.
077600 NEXT-PROD-HIST.
077700     MOVE PRDNM TO SRCHPRDNM MOVE 'P' TO SRCHTYPE.
077800     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
077900     PERFORM RESTORE-SEARCHARGS.
078000     IF STATUS-FLAG = 'E' GO TO PROD-HIST-EXIT.
078100 PAGE-FORWARD-HIST.
078200     IF ERRT NOT = 'F ' GO TO PAGE-BACK-HIST.
078300     IF KODE(9) = 'D'
078400         SET PRTBLINX DOWN BY 1
078500         GO TO NEXT-PRODUCT.
078600     IF NEXT-DTINST = ZEROES
078700         GO TO NEXT-PRODUCT.
078800     MOVE NEXT-DTINST TO SSRHSTRY-DATE-INST.
078900     GO TO START-SSRHSTRY.
079000 PAGE-BACK-HIST.
079100     IF ERRT NOT = 'B ' GO TO NO-ACTION-HIST.
079200     IF CURR-DTINST NOT = ZEROS
079300         MOVE ZEROS TO SSRHSTRY-DATE-INST
079400         GO TO START-SSRHSTRY.
079500     IF SRCHTYPE = 'T' OR 'F'
079600         MOVE ZERO TO SRCHPTFINX SRCHFMIDINX
079700         GO TO NEXT-PRODUCT.
079800     PERFORM BACK-PRTBL THRU SEARCH-PRTBL-EXIT.
079900     IF NOT ENTRY-FOUND
080000         IF KODE(9) = 'D' GO TO PROD-HIST-VDEL
080100         ELSE MOVE 'E ' TO ERRT GO TO PROD-HIST-PANEL.
080200     MOVE ZEROS TO SSRHSTRY-DATE-INST.
080300     GO TO PROD-HISTORY.
080400 NO-ACTION-HIST.
080500     IF KODE(9) = 'D'
080600         SET PRTBLINX DOWN BY 1
080700         GO TO NEXT-PRODUCT.
080800     MOVE CURR-DTINST TO SSRHSTRY-DATE-INST.
080900     GO TO START-SSRHSTRY.
081000 NEXT-PRODUCT.
081100     PERFORM SEARCH-PRTBL THRU SEARCH-PRTBL-EXIT.
081200     IF NOT ENTRY-FOUND
081300         IF KODE(9) = 'D' GO TO PROD-HIST-VDEL
081400         ELSE MOVE 'E ' TO ERRT GO TO PROD-HIST-PANEL.
081500     MOVE ZEROS TO SSRHSTRY-DATE-INST.
081600     GO TO PROD-HISTORY.
081700 PROD-HIST-VDEL.
081800     CALL 'ISPLINK' USING ISPVDELETE P34PTFLST.
081900     CALL 'ISPLINK' USING ISPVDELETE P34DTLST.
082000 PROD-HIST-EXIT.
082100     EXIT.
082200 GET-TABLE-PARMS.
082300     MOVE LOW-VALUES TO SSRHSTRY-KEY.
082400     READ SSRHSTRY.
082500     IF SSRHSTRY-ST NOT = ZEROS
082600         MOVE 'SSRMS901' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
082700         GO TO FILE-ERROR.
082800     MOVE SSRHSTRY-TABLE-PARMS TO TABLE-PARMS.
082900 UPDATE-TABLE-PARMS.
083000     IF 'Y' = PRTBL-PARM-CHANGE OR INTBL-PARM-CHANGE
083100         PERFORM OPEN-HISTORY-IO
083200         MOVE LOW-VALUES TO SSRHSTRY-REC
083300         MOVE TABLE-PARMS TO SSRHSTRY-TABLE-PARMS
083400         REWRITE SSRHSTRY-REC
083500         IF SSRHSTRY-ST NOT = ZERO
083600              MOVE 'SSRHSTRY' TO ERRFILE
083700              MOVE 'SSRMS902' TO SSRMSGNUM GO TO FILE-ERROR.
083800 PRODUCT-LIST-FUNCTION.
083900     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
084000     IF ENTRY-NOT-FOUND
084100         MOVE 'N ' TO ERRT
084200     ELSE
084300         PERFORM CALL-LIST-PROD.
084400     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
084500     PERFORM LOCATE-PRTBL.
084600     PERFORM LOCATE-INTBL.
084700     GO TO MENU-PANEL.
084800 CALL-LIST-PROD.
084900     MOVE SPACE TO STATUS-FLAG.
085000     PERFORM LIST-PROD THRU LIST-PROD-EXIT.
085100     IF STATUS-FLAG = 'S'
085200         PERFORM LIST-PROD-HISTORY THRU PROD-HIST-EXIT
085300         GO TO CALL-LIST-PROD.
085400 INXITM-LIST-FUNCTION.
085500     MOVE SRCHTYPE TO SRCHINXTYPE STATE-2.
085600     PERFORM START-LIST-INXITM.
085700     IF STATUS-FLAG = 'N'
085800         MOVE 'N ' TO ERRT
085900     ELSE
086000         MOVE SPACE TO STATUS-FLAG
086100         PERFORM LIST-INXITM THRU LIST-INXITM-EXIT
086200         IF STATUS-FLAG = 'S'
086300             MOVE INTBL-INDXKEY(INTBLINX) TO SRCHINXKEY
086400             MOVE SRCHINXITM TO SRCHARG1
086500             MOVE SRCHINXTYPE TO SRCHTYPE
086600             PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT
086700             IF ENTRY-NOT-FOUND
086800                 GO TO INXITM-LIST-FUNCTION
086900             ELSE
087000                 PERFORM CALL-LIST-PROD
087100                 MOVE SPACES TO SRCHINXITM
087200                 GO TO INXITM-LIST-FUNCTION.
087300     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
087400     PERFORM LOCATE-PRTBL.
087500     PERFORM LOCATE-INTBL.
087600     GO TO MENU-PANEL.
087700 LOCATE-PRTBL.
087800     MOVE 'SSRPRTBL' TO ERRFILE.
087900     IF PRRNUM NOT = REQ-PRRNUM
088000       IF PRRNUM = ZERO
088100         OPEN I-O SSRPRTBL
088200         IF SSRPRTBL-ST NOT = ZERO
088300           MOVE 'SSRMS900' TO SSRMSGNUM GO TO FILE-ERROR
088400         ELSE NEXT SENTENCE
088500       ELSE
088600         IF PRTBL-UPD = 'Y'
088700           REWRITE PRTBL-REC
088800           IF SSRPRTBL-ST NOT = ZEROS
088900             MOVE 'SSRMS902' TO SSRMSGNUM GO TO FILE-ERROR.
089000     IF PRRNUM NOT = REQ-PRRNUM
089100       IF REQ-PRRNUM = ZERO
089200         CLOSE SSRPRTBL
089300         IF SSRPRTBL-ST NOT = ZERO
089400           MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR
089500         ELSE
089600           MOVE PRRNUM TO REQ-PRRNUM
089700           MOVE ZERO TO PRRNUM
089800           SET REQ-PRTBLINX TO PRTBLINX
089900       ELSE
090000         MOVE REQ-PRRNUM TO PRRNUM
090100         MOVE SPACE TO PRTBL-UPD
090200         READ SSRPRTBL
090300         IF SSRPRTBL-ST NOT = ZERO
090400           MOVE 'SSRMS901' TO SSRMSGNUM GO TO FILE-ERROR.
090500     SET PRTBLINX TO REQ-PRTBLINX.
090600 START-PRTBL.
090700     IF SRCHTYPE = 'C' OR 'V'
090800         PERFORM START-INTBL THRU SEARCH-INTBL-EXIT
090900         IF NOT ENTRY-FOUND
091000             MOVE 0 TO LOCATE-FLAG GO TO SEARCH-PRTBL-EXIT
091100         ELSE IF SRCHTYPE = 'V'
091200                 MOVE INTBL-IINX(INTBLINX) TO SRCHVINX
091300             ELSE
091400                 MOVE INTBL-IINX(INTBLINX) TO SRCHCINX.
091500 FIRST-PRTBL-SLOT.
091600     MOVE 0 TO REQ-PRTBLINX.
091700     MOVE 1 TO REQ-PRRNUM.
091800     PERFORM LOCATE-PRTBL.
091900 SEARCH-PRTBL.
092000     MOVE 0 TO LOCATE-FLAG.
092100     IF SRCHTYPE = 'F' OR 'T' NEXT SENTENCE
092200         ELSE GO TO NEXT-PRTBL-SLOT.
092300     IF SRCHTYPE = 'T'
092400         ADD 1 TO SRCHPTFINX
092500         MOVE SRCHPTFKEY TO SSRHSTRY-PTFKEY
092600         START SSRHSTRY KEY NOT < SSRHSTRY-PTFKEY
092700             INVALID KEY GO TO SEARCH-PRTBL-EXIT.
092800     IF SRCHTYPE = 'F'
092900         ADD 1 TO SRCHFMIDINX
093000         MOVE SRCHFMIDKEY TO SSRHSTRY-FMIDKEY
093100         START SSRHSTRY KEY NOT < SSRHSTRY-FMIDKEY
093200             INVALID KEY GO TO SEARCH-PRTBL-EXIT.
093300     IF SSRHSTRY-ST NOT = ZEROS
093400         MOVE 'SSRMS904' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
093500         GO TO FILE-ERROR.
093600     READ SSRHSTRY NEXT AT END GO TO SEARCH-PRTBL-EXIT.
093700     IF SSRHSTRY-ST = '00' OR '02' NEXT SENTENCE ELSE
093800         MOVE 'SSRMS901' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
093900         GO TO FILE-ERROR.
094000     IF SRCHTYPE = 'T'
094100         IF SSRHSTRY-PTFMD = SRCHPTFMD
094200             MOVE SSRHSTRY-PINX TO SRCHPINX SRCHPTFINX
094300         ELSE GO TO SEARCH-PRTBL-EXIT.
094400     IF SRCHTYPE = 'F'
094500         IF SSRHSTRY-FMID = SRCHFMID
094600             MOVE SSRHSTRY-PINX TO SRCHPINX SRCHFMIDINX
094700         ELSE GO TO SEARCH-PRTBL-EXIT.
094800     PERFORM FIRST-PRTBL-SLOT.
094900 NEXT-PRTBL-SLOT.
095000     SET PRTBLINX UP BY 1.
095100     IF PRTBLINX NOT > PRTBL-HI-SLOT
095200         GO TO TEST-FORWARD.
095300     IF PRTBL-NEXT-REC = ZERO
095400         IF SRCHTYPE = 'C' OR 'V'
095500             MOVE 4 TO LOCATE-FLAG
095600             GO TO SEARCH-PRTBL-EXIT
095700         ELSE
095800             MOVE 0 TO LOCATE-FLAG
095900             GO TO SEARCH-PRTBL-EXIT.
096000     MOVE PRTBL-NEXT-REC TO REQ-PRRNUM.
096100     MOVE 1 TO REQ-PRTBLINX.
096200     PERFORM LOCATE-PRTBL.
096300 TEST-FORWARD.
096400     PERFORM TEST-PRTBL-ENTRY.
096500     IF ENTRY-FOUND OR AFTER-ENTRY GO TO SEARCH-PRTBL-EXIT.
096600     GO TO NEXT-PRTBL-SLOT.
096700 BACK-PRTBL.
096800     MOVE 0 TO LOCATE-FLAG.
096900     SET PRTBLINX DOWN BY 1.
097000     IF PRTBLINX NOT < 1 GO TO TEST-BACKWARD.
097100     IF PRRNUM = 1
097200         GO TO SEARCH-PRTBL-EXIT.
097300     MOVE PRTBL-PREV-REC TO REQ-PRRNUM.
097400     PERFORM LOCATE-PRTBL.
097500     SET PRTBLINX TO PRTBL-HI-SLOT.
097600 TEST-BACKWARD.
097700     PERFORM TEST-PRTBL-ENTRY.
097800     IF ENTRY-FOUND OR BEFORE-ENTRY GO TO SEARCH-PRTBL-EXIT.
097900     GO TO BACK-PRTBL.
098000 TEST-PRTBL-ENTRY.
098100     IF SRCHTYPE = 'P'
098200         IF SRCHPRDNM = SPACES
098300             MOVE 1 TO LOCATE-FLAG
098400         ELSE
098500             IF PRTBL-PRDNM(PRTBLINX) > SRCHPRDNM
098600                 MOVE 3 TO LOCATE-FLAG
098700             ELSE
098800                 IF PRTBL-PRDNM(PRTBLINX) = SRCHPRDNM
098900                     MOVE 1 TO LOCATE-FLAG
099000                 ELSE
099100                     MOVE 2 TO LOCATE-FLAG.
099200     IF SRCHTYPE = 'A'
099300         IF PRTBL-ACRNM(PRTBLINX) = SRCHACRNM
099400              MOVE 1 TO LOCATE-FLAG.
099500     IF SRCHTYPE = 'F' OR 'T'
099600         IF PRTBL-PINX(PRTBLINX) = SRCHPINX
099700             MOVE 1 TO LOCATE-FLAG.
099800     IF SRCHTYPE = 'V'
099900         IF PRTBL-VINX(PRTBLINX) = SRCHVINX
100000              MOVE 1 TO LOCATE-FLAG.
100100     IF SRCHTYPE = 'C'
100200         IF PRTBL-CINX(PRTBLINX) = SRCHCINX
100300             MOVE 1 TO LOCATE-FLAG.
100400 SEARCH-PRTBL-EXIT.
100500     EXIT.
100600 LIST-PROD.
100700     CALL 'ISPLINK' USING ISPVDEFINE P32PRDLST P32PRD-TBL CHAR
100800             L32.
100900     CALL 'ISPLINK' USING ISPVDEFINE P32ACRLST P32ACR-TBL CHAR
101000             L16.
101100     PERFORM GET-TABLE-PARMS.
101200 LIST-PROD-INIT.
101300     MOVE SRCHARG1 TO SAVE-SRCHARG1.
101400     IF SRCHTYPE = 'P'
101500         MOVE SPACES TO SRCHARG1 SRCHPRDNM.
101600     SET P32PRDX TO 1. SET P32ACRX TO 1. SET SELX TO 1.
101700     MOVE SPACES TO P32PRD-TBL P32ACR-TBL ERRT.
101800     IF EMPTY-SET
101900         MOVE 0 TO ENDL GO TO LIST-PROD-PANEL.
102000 LIST-PROD-LINE.
102100     MOVE PRTBL-ACRNM(PRTBLINX) TO ACRNML(P32ACRX).
102200     MOVE PRTBL-PRDNM(PRTBLINX) TO PRDNML(P32PRDX).
102300     MOVE PRTBL-PINX(PRTBLINX) TO SELINX(SELX).
102400     MOVE PRRNUM TO SELRRN(SELX).
102500     SET SELSLOT(SELX) TO PRTBLINX.
102600     IF P32ACRX = 8
102700         MOVE 8 TO ENDL GO TO LIST-PROD-PANEL.
102800     PERFORM SEARCH-PRTBL THRU SEARCH-PRTBL-EXIT.
102900     IF ENTRY-NOT-FOUND OR END-OF-SET
103000         MOVE 'E ' TO ERRT
103100         SET ENDL TO P32PRDX
103200         GO TO LIST-PROD-PANEL.
103300     SET SELX UP BY 1. SET P32ACRX UP BY 1. SET P32PRDX UP BY 1.
103400     GO TO LIST-PROD-LINE.
103500 LIST-PROD-PANEL.
103600     MOVE 0 TO REQ-PRRNUM REQ-IRRNUM.
103700     PERFORM LOCATE-PRTBL.
103800     PERFORM LOCATE-INTBL.
103900     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL32.
104000     IF RETURN-CODE = 8
104100         MOVE 'E' TO STATUS-FLAG GO TO LIST-PROD-VDEL.
104200     PERFORM LOCATE-PRTBL.
104300     PERFORM LOCATE-INTBL.
104400     PERFORM GET-TABLE-PARMS.
104500     IF ERRT = 'DD'
104600         PERFORM DELETE-INXITM THRU DELETE-INXITM-EXIT
104700         MOVE SPACE TO SRCHARG1 SAVE-SRCHARG1 SRCHINXITM
104800         GO TO LIST-PROD-VDEL.
104900     IF SRCHARG1 NOT = SAVE-SRCHARG1
105000         IF SRCHTYPE = 'C' OR 'V'
105100             MOVE SRCHARG1 TO SRCHINXITM
105200             MOVE INTBL-IINX(INTBLINX) TO SRCHVINX
105300             PERFORM ADD-INXITM THRU ADD-INXITM-EXIT
105400             IF ENTRY-FOUND
105500                 MOVE 'DI' TO ERRT
105600                 GO TO LIST-PROD-PANEL
105700             ELSE
105800                 PERFORM DELETE-INXITM THRU DELETE-INXITM-EXIT
105900                 MOVE SRCHARG1 TO SAVE-SRCHARG1 SRCHINXITM
106000         ELSE
106100             IF SRCHARG1 NOT = SPACES
106200                 MOVE SRCHARG1 TO SRCHPRDNM
106300                 PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT
106400                 IF ENTRY-NOT-FOUND
106500                     MOVE 'N ' TO ERRT
106600                     GO TO LIST-PROD-PANEL
106700                 ELSE
106800                     GO TO LIST-PROD-INIT.
106900     PERFORM UPDATE-TABLE-PARMS.
107000     IF ERRT NOT = 'F ' GO TO LIST-PROD-BACKPAGE.
107100 LIST-PROD-NEXTPAGE.
107200     PERFORM SEARCH-PRTBL THRU SEARCH-PRTBL-EXIT.
107300     IF ENTRY-NOT-FOUND
107400         MOVE 'E ' TO ERRT
107500         GO TO LIST-PROD-PANEL
107600     ELSE
107700         GO TO LIST-PROD-INIT.
107800 LIST-PROD-BACKPAGE.
107900     IF ERRT NOT = 'B '
108000         GO TO PROD-SELECT.
108100     IF SRCHTYPE = 'T' OR 'F'
108200         MOVE ZERO TO SRCHPTFINX SRCHFMIDINX
108300         GO TO LIST-PROD-NEXTPAGE.
108400     MOVE SELRRN(1) TO REQ-PRRNUM.
108500     MOVE SELSLOT(1) TO REQ-PRTBLINX.
108600     PERFORM LOCATE-PRTBL.
108700     MOVE 8 TO SEQ.
108800 BACK-PROD-LOOP.
108900     PERFORM BACK-PRTBL THRU SEARCH-PRTBL-EXIT.
109000     IF SEQ = 0 OR ENTRY-NOT-FOUND
109100         GO TO LIST-PROD-NEXTPAGE.
109200     SUBTRACT 1 FROM SEQ GO TO BACK-PROD-LOOP.
109300 PROD-SELECT.
109400     IF ERRT NOT = 'S '
109500         GO TO LIST-PROD-PANEL.
109600     MOVE 'S' TO STATUS-FLAG.
109700     SET SELX TO ERRL.
109800     MOVE SELRRN(SELX) TO REQ-PRRNUM.
109900     MOVE SELSLOT(SELX) TO REQ-PRTBLINX.
110000     PERFORM LOCATE-PRTBL.
110100     IF SRCHTYPE = 'T' OR 'F'
110200         MOVE PRTBL-PINX(PRTBLINX) TO SRCHPTFINX SRCHFMIDINX.
110300 LIST-PROD-VDEL.
110400     CALL 'ISPLINK' USING ISPVDELETE P32ACRLST.
110500     CALL 'ISPLINK' USING ISPVDELETE P32PRDLST.
110600 LIST-PROD-EXIT.
110700     EXIT.
110800 DELETE-INXITM.
110900     MOVE SAVE-SRCHARG1 TO SRCHINXITM.
111000     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
111100     IF NOT ENTRY-FOUND
111200         GO TO DELETE-INXITM-EXIT.
111300 DELETE-INXITM-LOOP.
111400     IF INTBLINX < INTBL-HI-SLOT
111500         MOVE INTBL-ENTRY(INTBLINX + 1) TO INTBL-ENTRY(INTBLINX)
111600         SET INTBLINX UP BY 1
111700         GO TO DELETE-INXITM-LOOP.
111800     SUBTRACT 1 FROM INTBL-HI-SLOT.
111900     MOVE 'Y' TO INTBL-UPD.
112000 DELETE-INXITM-EXIT.
112100     EXIT.
112200 START-LIST-INXITM.
112300     MOVE ' ' TO STATUS-FLAG.
112400     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
112500     IF NOT ENTRY-FOUND
112600         MOVE 'N' TO STATUS-FLAG.
112700 LIST-INXITM.
112800     CALL 'ISPLINK' USING ISPVDEFINE P33INXLST P33INX-TBL CHAR
112900             L32.
113000     SET P33IIX TO 1. SET SELX TO 1.
113100     MOVE SPACES TO P33INX-TBL.
113200 LIST-INXITM-LINE.
113300     MOVE INTBL-INXITM(INTBLINX) TO INXITML(P33IIX).
113400     MOVE INTBL-IINX(INTBLINX) TO SELINX(SELX).
113500     MOVE IRRNUM TO SELRRN(SELX).
113600     SET SELSLOT(SELX) TO INTBLINX.
113700     IF P33IIX = 16 GO TO LIST-INXITM-PANEL.
113800     PERFORM SEARCH-INTBL THRU SEARCH-INTBL-EXIT.
113900     IF NOT ENTRY-FOUND GO TO LIST-INXITM-PANEL.
114000     SET SELX UP BY 1. SET P33IIX UP BY 1.
114100     GO TO LIST-INXITM-LINE.
114200 LIST-INXITM-PANEL.
114300     SET ENDL TO P33IIX.
114400     MOVE 0 TO REQ-PRRNUM REQ-IRRNUM.
114500     PERFORM LOCATE-PRTBL.
114600     PERFORM LOCATE-INTBL.
114700     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL33.
114800     IF RETURN-CODE = 8
114900         MOVE 'E' TO STATUS-FLAG GO TO LIST-INXITM-VDEL.
115000     PERFORM LOCATE-PRTBL.
115100     PERFORM LOCATE-INTBL.
115200     IF ERRT NOT = 'F ' GO TO LIST-INXITM-BACKPAGE.
115300 LIST-INXITM-NEXTPAGE.
115400     PERFORM SEARCH-INTBL THRU SEARCH-INTBL-EXIT
115500     IF ENTRY-FOUND
115600         SET P33IIX TO 1   SET SELX TO 1
115700         MOVE SPACES TO P33INX-TBL
115800         GO TO LIST-INXITM-LINE
115900     ELSE
116000         MOVE 'E ' TO ERRT
116100         GO TO LIST-INXITM-PANEL.
116200 LIST-INXITM-BACKPAGE.
116300     IF ERRT NOT = 'B '
116400         GO TO INXITM-SELECT.
116500     MOVE SELRRN(1) TO REQ-IRRNUM.
116600     MOVE SELSLOT(1) TO REQ-INTBLINX.
116700     PERFORM LOCATE-INTBL.
116800     MOVE 16 TO SEQ.
116900 BACK-INXITM-LOOP.
117000     PERFORM BACK-INTBL THRU SEARCH-INTBL-EXIT.
117100     IF ENTRY-FOUND AND SEQ > 1
117200         SUBTRACT 1 FROM SEQ GO TO BACK-INXITM-LOOP.
117300     GO TO LIST-INXITM-NEXTPAGE.
117400 INXITM-SELECT.
117500     IF ERRT NOT = 'S '
117600             GO TO LIST-INXITM-PANEL.
117700     MOVE 'S' TO STATUS-FLAG.
117800     SET SELX TO ERRL. SET P33IIX TO ERRL.
117900     MOVE SELRRN(SELX) TO REQ-IRRNUM.
118000     MOVE SELSLOT(SELX) TO REQ-INTBLINX.
118100     PERFORM LOCATE-INTBL.
118200 LIST-INXITM-VDEL.
118300     CALL 'ISPLINK' USING ISPVDELETE P33INXLST.
118400 LIST-INXITM-EXIT.
118500     EXIT.
118600 EDIT-LINE.
118700     IF ACRNME(P30ACRX) = '*' OR PRDN1E(P30PRDX) = '*'
118800          GO TO LOOK-UP-PROD.
118900     IF KODE(CODX) = 'Y' GO TO NEW-PRODUCT.
119000     IF PRDNME(P30PRDX) = SPACE
119100         MOVE 'A' TO SRCHTYPE
119200         MOVE ACRNME(P30ACRX) TO SRCHACRNM
119300     ELSE
119400         MOVE 'P' TO SRCHTYPE
119500         MOVE PRDNME(P30PRDX) TO SRCHPRDNM.
119600     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
119700     IF ENTRY-FOUND
119800         MOVE PRTBL-PINX(PRTBLINX) TO PINXS(P30SINX)
119900         MOVE PRTBL-ACRNM(PRTBLINX) TO ACRNME(P30ACRX)
120000         MOVE PRTBL-PRDNM(PRTBLINX) TO PRDNME(P30PRDX)
120100         GO TO CHECK-DATE.
120200 PROD-NOT-FOUND.
120300     MOVE 'PN' TO ERRT. SET ERRL TO P30ACRX.
120400     MOVE 0 TO REQ-PRRNUM REQ-IRRNUM.
120500     PERFORM LOCATE-PRTBL.
120600     PERFORM LOCATE-INTBL.
120700     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL30.
120800     IF RETURN-CODE = 8 MOVE 9 TO EDIT-STATUS GO TO EDIT-EXIT.
120900     MOVE 1 TO EDIT-STATUS.
121000     PERFORM LOCATE-PRTBL.
121100     PERFORM LOCATE-INTBL.
121200     GO TO EDIT-EXIT.
121300 LOOK-UP-PROD.
121400     MOVE SPACES TO SRCHPRDNM SRCHARG1.
121500     MOVE 'P' TO SRCHTYPE PARM-SRCHTYPE.
121600     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
121700     IF ENTRY-NOT-FOUND
121800         MOVE 2 TO EDIT-STATUS GO TO EDIT-EXIT.
121900     PERFORM LIST-PROD THRU LIST-PROD-EXIT.
122000     IF STATUS-FLAG = 'E' MOVE 2 TO EDIT-STATUS GO TO EDIT-EXIT.
122100     MOVE PRTBL-ACRNM(PRTBLINX) TO ACRNME(P30ACRX).
122200     MOVE PRTBL-PRDNM(PRTBLINX) TO PRDNME (P30PRDX).
122300     MOVE PRTBL-PINX(PRTBLINX) TO PINXS(P30SINX).
122400     MOVE ' ' TO KODE(CODX).
122500 CHECK-DATE.
122600     MOVE SPACE TO RELSE(7) ORDRE(7) FMIDE(7).
122700     MOVE PINXS(P30SINX) TO SSRHSTRY-PINX.
122800     MOVE ZEROS TO SSRHSTRY-DATE-INST  EDIT-STATUS.
122900     START SSRHSTRY KEY NOT < SSRHSTRY-KEY.
123000     IF SSRHSTRY-ST NOT = ZEROS
123100         MOVE 'SSRMS904' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
123200         GO TO FILE-ERROR.
123300 CHECK-DATE-LOOP.
123400     READ SSRHSTRY NEXT AT END GO TO END-CHECK-DATE.
123500     IF SSRHSTRY-ST NOT = ZEROS
123600         MOVE 'SSRMS901' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
123700         GO TO FILE-ERROR.
123800     IF SSRHSTRY-DATE-INST > DATE-INST
123900       OR SSRHSTRY-PINX NOT = PINXS(P30SINX)
124000         GO TO END-CHECK-DATE.
124100     IF SSRHSTRY-DATE-INST = DATE-INST
124200         MOVE 'DT' TO ERRT SET ERRL TO P30ACRX
124300         MOVE 0 TO REQ-PRRNUM REQ-IRRNUM
124400         PERFORM LOCATE-PRTBL
124500         PERFORM LOCATE-INTBL
124600         CALL 'ISPLINK' USING ISPDISPLAY SSRPNL30
124700         IF RETURN-CODE = 8
124800             MOVE 9 TO EDIT-STATUS GO TO EDIT-EXIT
124900         ELSE
125000             PERFORM LOCATE-PRTBL
125100             PERFORM LOCATE-INTBL
125200             MOVE 1 TO EDIT-STATUS GO TO EDIT-EXIT.
125300     MOVE SSRHSTRY-ORDR TO ORDRE(7).
125400     MOVE SSRHSTRY-RELS TO RELSE(7).
125500     MOVE SSRHSTRY-FMID TO FMIDE(7).
125600     GO TO CHECK-DATE-LOOP.
125700 END-CHECK-DATE.
125800     IF RELSE(ORDRELX) = SPACE
125900         MOVE '1' TO NO-RELEASE-FLAG
126000         MOVE RELSE(7) TO RELSE(ORDRELX).
126100     IF ORDRE(ORDRELX) = SPACE
126200         MOVE ORDRE(7) TO ORDRE(ORDRELX).
126300     IF FMIDE(FMIDX) = SPACE
126400         MOVE FMIDE(7) TO FMIDE(FMIDX).
126500     GO TO EDIT-EXIT.
126600 NEW-PRODUCT.
126700     MOVE ACRNME(P30ACRX) TO ACRNM.
126800     MOVE PRDN1E(P30PRDX) TO PRDN1.
126900     MOVE PRDN2E(P30PRDX) TO PRDN2.
127000     MOVE ORDRE(ORDRELX) TO ORDRE(6).
127100     MOVE RELSE(ORDRELX) TO RELSE(6).
127200     MOVE FMIDE(FMIDX) TO FMIDE(6).
127300     MOVE SPACE TO VENDR KODE(6) CTGRY KODE(7).
127400 NEW-PROD-PANEL.
127500     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
127600     PERFORM LOCATE-PRTBL.
127700     PERFORM LOCATE-INTBL.
127800 NEW-PROD-PANEL-2.
127900     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL31.
128000     IF RETURN-CODE = 8 MOVE 2 TO EDIT-STATUS GO TO EDIT-EXIT.
128100     PERFORM LOCATE-PRTBL.
128200     PERFORM LOCATE-INTBL.
128300 EDIT-NEW-PROD.
128400     MOVE SPACES TO SEARCH-ARGS.
128500     MOVE PRDNM TO PRDNME(P30PRDX) SRCHPRDNM.
128600     MOVE 'P' TO SRCHTYPE.
128700     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
128800     IF ENTRY-FOUND MOVE 'DP' TO ERRT GO TO NEW-PROD-PANEL.
128900 CHECK-VENDR.
129000     IF VENDR = '*' GO TO LOOK-UP-VENDR.
129100     IF KODE(6) = 'Y'
129200         MOVE VENDR TO VENDRS(P30SINX)
129300         MOVE 'Y' TO NEWVS(P30SINX)
129400         GO TO CHECK-CTGRY.
129500     IF VENDR = VENDRS(P30SINX) GO TO CHECK-CTGRY.
129600     MOVE VENDR TO SRCHINXITM.
129700     MOVE 'V' TO SRCHINXTYPE, SRCHTYPE.
129800     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
129900     IF ENTRY-FOUND
130000         MOVE INTBL-IINX(INTBLINX) TO VINXS(P30SINX)
130100         MOVE VENDR TO VENDRS(P30SINX)
130200         MOVE ' ' TO NEWVS(P30SINX)
130300         GO TO CHECK-CTGRY.
130400 VENDR-NOT-FOUND.
130500     MOVE 'VN' TO ERRT.
130600     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
130700     PERFORM LOCATE-PRTBL.
130800     PERFORM LOCATE-INTBL.
130900     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL31.
131000     IF RETURN-CODE = 8 MOVE 2 TO EDIT-STATUS GO TO EDIT-EXIT.
131100     PERFORM LOCATE-PRTBL.
131200     PERFORM LOCATE-INTBL.
131300     GO TO EDIT-NEW-PROD.
131400 LOOK-UP-VENDR.
131500     MOVE SPACES TO SRCHINXITM.
131600     MOVE 'V' TO SRCHINXTYPE, SRCHTYPE, STATE-2.
131700     PERFORM START-LIST-INXITM.
131800     IF STATUS-FLAG = 'N' GO TO NEW-PROD-PANEL.
131900     PERFORM LIST-INXITM THRU LIST-INXITM-EXIT.
132000     IF STATUS-FLAG = 'E' GO TO NEW-PROD-PANEL-2.
132100     MOVE SELINX(SELX) TO VINXS(P30SINX).
132200     MOVE INTBL-INXITM(INTBLINX) TO VENDRS(P30SINX) VENDR.
132300     MOVE ' ' TO NEWVS(P30SINX).
132400 CHECK-CTGRY.
132500     IF CTGRY = '*' GO TO LOOK-UP-CTGRY.
132600     IF KODE(7) = 'Y'
132700         MOVE CTGRY TO CTGRYS(P30SINX)
132800         MOVE 'Y' TO NEWCS(P30SINX)
132900         GO TO GOT-NEW-PROD.
133000     MOVE SPACES TO SEARCH-ARGS.
133100     MOVE CTGRY TO SRCHINXITM.
133200     MOVE 'C' TO SRCHINXTYPE, SRCHTYPE.
133300     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
133400     IF ENTRY-FOUND
133500         MOVE INTBL-IINX(INTBLINX) TO CINXS(P30SINX)
133600         MOVE CTGRY TO CTGRYS(P30SINX)
133700         MOVE ' ' TO NEWCS(P30SINX)
133800         GO TO GOT-NEW-PROD.
133900 CTGRY-NOT-FOUND.
134000     MOVE 'CN' TO ERRT.
134100     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
134200     PERFORM LOCATE-PRTBL.
134300     PERFORM LOCATE-INTBL.
134400     CALL 'ISPLINK' USING ISPDISPLAY SSRPNL31.
134500     IF RETURN-CODE = 8 MOVE 2 TO EDIT-STATUS GO TO EDIT-EXIT.
134600     PERFORM LOCATE-PRTBL.
134700     PERFORM LOCATE-INTBL.
134800     GO TO EDIT-NEW-PROD.
134900 LOOK-UP-CTGRY.
135000     MOVE SPACES TO SEARCH-ARGS.
135100     MOVE 'C' TO SRCHINXTYPE, SRCHTYPE, STATE-2.
135200     PERFORM START-LIST-INXITM.
135300     IF STATUS-FLAG = 'N' GO TO NEW-PROD-PANEL.
135400     PERFORM LIST-INXITM THRU LIST-INXITM-EXIT.
135500     IF STATUS-FLAG = 'E' GO TO NEW-PROD-PANEL-2.
135600     MOVE SELINX(SELX) TO CINXS(P30SINX).
135700     MOVE INTBL-INXITM(INTBLINX) TO CTGRYS(P30SINX) CTGRY.
135800     MOVE ' ' TO NEWCS(P30SINX).
135900 GOT-NEW-PROD.
136000     MOVE 0 TO EDIT-STATUS.
136100     MOVE ACRNM TO ACRNME(P30ACRX).
136200     MOVE PRDN1 TO PRDN1E(P30PRDX).
136300     MOVE PRDN2 TO PRDN2E(P30PRDX).
136400     MOVE ORDRE(6) TO ORDRE(ORDRELX).
136500     MOVE RELSE(6) TO RELSE(ORDRELX).
136600     MOVE FMIDE(6) TO FMIDE(FMIDX).
136700     MOVE SPACE TO STATE-2.
136800 EDIT-EXIT.
136900     EXIT.
137000 LOCATE-INTBL.
137100     MOVE 'SSRINTBL' TO ERRFILE.
137200     IF IRRNUM NOT = REQ-IRRNUM
137300       IF IRRNUM = ZERO
137400         OPEN I-O SSRINTBL
137500         IF SSRINTBL-ST NOT = ZERO
137600           MOVE 'SSRMS900' TO SSRMSGNUM GO TO FILE-ERROR
137700         ELSE NEXT SENTENCE
137800       ELSE
137900         IF INTBL-UPD = 'Y'
138000           REWRITE INTBL-REC
138100           IF SSRINTBL-ST NOT = ZEROS
138200             MOVE 'SSRMS902' TO SSRMSGNUM GO TO FILE-ERROR.
138300     IF IRRNUM NOT = REQ-IRRNUM
138400       IF REQ-IRRNUM = ZERO
138500         CLOSE SSRINTBL
138600         IF SSRINTBL-ST NOT = ZERO
138700           MOVE 'SSRMS903' TO SSRMSGNUM GO TO FILE-ERROR
138800         ELSE
138900           MOVE IRRNUM TO REQ-IRRNUM
139000           MOVE ZERO TO IRRNUM
139100           SET REQ-INTBLINX TO INTBLINX
139200       ELSE
139300         MOVE REQ-IRRNUM TO IRRNUM
139400         MOVE SPACE TO INTBL-UPD
139500         READ SSRINTBL
139600         IF SSRINTBL-ST NOT = ZERO
139700           MOVE 'SSRMS901' TO SSRMSGNUM GO TO FILE-ERROR.
139800     SET INTBLINX TO REQ-INTBLINX.
139900 START-INTBL.
140000     MOVE 1 TO REQ-IRRNUM.
140100     MOVE 0 TO REQ-INTBLINX.
140200     PERFORM LOCATE-INTBL.
140300 SEARCH-INTBL.
140400     MOVE 0 TO LOCATE-FLAG.
140500     SET INTBLINX UP BY 1.
140600     IF INTBLINX NOT > INTBL-HI-SLOT
140700         GO TO TEST-INTBL-FORWARD.
140800     IF INTBL-NEXT-REC = ZERO
140900         GO TO SEARCH-INTBL-EXIT.
141000     MOVE INTBL-NEXT-REC TO REQ-IRRNUM.
141100     MOVE 1 TO REQ-INTBLINX.
141200     PERFORM LOCATE-INTBL.
141300 TEST-INTBL-FORWARD.
141400     PERFORM TEST-INTBL-SLOT.
141500     IF ENTRY-FOUND OR AFTER-ENTRY
141600         GO TO SEARCH-INTBL-EXIT.
141700     GO TO SEARCH-INTBL.
141800 BACK-INTBL.
141900     SET INTBLINX DOWN BY 1.
142000     IF INTBLINX NOT < 1
142100         GO TO TEST-INTBL-BACKWARD.
142200     IF IRRNUM = 1
142300         GO TO SEARCH-INTBL-EXIT.
142400     MOVE INTBL-PREV-REC TO REQ-IRRNUM.
142500     PERFORM LOCATE-INTBL.
142600     SET INTBLINX TO INTBL-HI-SLOT.
142700 TEST-INTBL-BACKWARD.
142800     PERFORM TEST-INTBL-SLOT.
142900     IF ENTRY-FOUND OR BEFORE-ENTRY
143000         GO TO SEARCH-INTBL-EXIT.
143100     GO TO BACK-INTBL.
143200 TEST-INTBL-SLOT.
143300     IF (SRCHTYPE = 'V' OR 'C') AND (SRCHINXITM = SPACES)
143400         IF INTBL-TYPE (INTBLINX) < SRCHINXTYPE
143500             MOVE 2 TO LOCATE-FLAG
143600         ELSE IF INTBL-TYPE (INTBLINX) = SRCHINXTYPE
143700             MOVE 1 TO LOCATE-FLAG
143800         ELSE
143900             MOVE 3 TO LOCATE-FLAG.
144000     IF (SRCHTYPE = 'V' OR 'C') AND (SRCHINXITM > SPACES)
144100         IF INTBL-INDXKEY(INTBLINX) < SRCHINXKEY
144200             MOVE 2 TO LOCATE-FLAG
144300         ELSE IF INTBL-INDXKEY(INTBLINX) = SRCHINXKEY
144400             MOVE 1 TO LOCATE-FLAG
144500         ELSE
144600             MOVE 3 TO LOCATE-FLAG.
144700     IF SRCHTYPE = 'Z' AND INTBL-IINX(INTBLINX) = SRCHCINX
144800         MOVE 1 TO LOCATE-FLAG.
144900     IF SRCHTYPE = 'Y' AND INTBL-IINX(INTBLINX) = SRCHVINX
145000         MOVE 1 TO LOCATE-FLAG.
145100 SEARCH-INTBL-EXIT.
145200     EXIT.
145300 PROCESS-ADDS.
145400     PERFORM GET-TABLE-PARMS.
145500     SET P30PRDX TO 1. SET P30ACRX TO 1. SET ORDRELX TO 1.
145600     SET P30SINX TO 1. SET CODX TO 1. SET FMIDX TO 1.
145700     MOVE ZERO TO SRCHVINX.
145800 ADD-LINE.
145900     IF PRDNME(P30PRDX) = SPACES
146000         GO TO NEXT-ADD.
146100     IF KODE(CODX) = SPACE
146200         GO TO ADD-HISTORY.
146300 ADD-VENDR.
146400     IF NEWVS(P30SINX) = SPACE
146500         GO TO ADD-CTGRY.
146600     MOVE VENDRS(P30SINX) TO SRCHINXITM.
146700     MOVE 'V' TO SRCHINXTYPE, SRCHTYPE.
146800**%%    10/23/87 FIX PROD=>VEND/CAT POINTER PROBLEMS:
146900     MOVE ZERO TO SRCHVINX.
147000**%%    END FIX
147100     PERFORM ADD-INXITM THRU ADD-INXITM-EXIT.
147200     MOVE INTBL-IINX(INTBLINX) TO VINXS(P30SINX).
147300 ADD-CTGRY.
147400     IF NEWCS(P30SINX) = SPACE
147500         GO TO ADD-PROD.
147600     MOVE 'C' TO SRCHINXTYPE, SRCHTYPE.
147700     MOVE CTGRYS(P30SINX) TO SRCHINXITM.
147800**%%    10/23/87 FIX PROD=>VEND/CAT POINTER PROBLEMS:
147900     MOVE ZERO TO SRCHVINX.
148000**%%    END FIX
148100     PERFORM ADD-INXITM THRU ADD-INXITM-EXIT.
148200     MOVE INTBL-IINX(INTBLINX) TO CINXS(P30SINX).
148300 ADD-PROD.
148400     MOVE PRDNME(P30PRDX) TO SRCHPRDNM.
148500     MOVE ACRNME(P30ACRX) TO SRCHACRNM.
148600     MOVE VINXS(P30SINX) TO SRCHVINX.
148700     MOVE CINXS(P30SINX) TO SRCHCINX.
148800     MOVE 0 TO SRCHPINX.
148900     MOVE 'P' TO SRCHTYPE.
149000     PERFORM START-PRTBL THRU SEARCH-PRTBL-EXIT.
149100     IF ENTRY-FOUND
149200         MOVE PRTBL-PINX(PRTBLINX) TO PINXS(P30SINX)
149300     ELSE PERFORM ADD-PRODUCT THRU ADD-PRODUCT-EXIT
149400          MOVE SRCHPINX TO PINXS(P30SINX).
149500 ADD-HISTORY.
149600     PERFORM OPEN-HISTORY-IO.
149700     MOVE PINXS(P30SINX) TO SSRHSTRY-PINX SSRHSTRY-PTFINX
149800                            SSRHSTRY-FMIDINX.
149900     MOVE DATE-INST TO SSRHSTRY-DATE-INST.
150000     MOVE PTFMD TO SSRHSTRY-PTFMD.
150100     MOVE ORDRE(ORDRELX) TO SSRHSTRY-ORDR.
150200     MOVE RELSE(ORDRELX) TO SSRHSTRY-RELS.
150300     MOVE FMIDE(FMIDX) TO SSRHSTRY-FMID.
150400     WRITE SSRHSTRY-REC INVALID KEY GO TO NEXT-ADD.
150500     IF SSRHSTRY-ST = '00' OR '02' NEXT SENTENCE ELSE
150600         MOVE 'SSRMS902' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
150700         GO TO FILE-ERROR.
150800 NEXT-ADD.
150900     IF P30PRDX < 5
151000         SET P30PRDX UP BY 1  SET P30ACRX UP BY 1
151100         SET ORDRELX UP BY 1  SET CODX UP BY 1
151200         SET P30SINX UP BY 1  SET FMIDX UP BY 1
151300         GO TO ADD-LINE.
151400     PERFORM UPDATE-TABLE-PARMS.
151500     MOVE 'A ' TO STATE.
151600     MOVE SPACES TO ARRAY-16 ARRAY-32 ARRAY-12 ARRAY-7 ARRAY-1.
151700     MOVE ZERO TO REQ-PRRNUM REQ-IRRNUM.
151800     PERFORM CLOSE-HISTORY-IO.
151900     PERFORM LOCATE-PRTBL.
152000     PERFORM LOCATE-INTBL.
152100     GO TO ENTRY-SCREEN.
152200 ADD-PRODUCT.
152300     MOVE 'Y' TO PRTBL-PARM-CHANGE.
152400     SET INSRT-SLOT TO PRTBLINX.
152500     IF PRTBL-HI-SLOT = 95
152600         GO TO PRTBL-SPLIT.
152700     SET PRTBLINX TO PRTBL-HI-SLOT.
152800     PERFORM SLIDE-PROD-ENTRY THRU SLIDE-PROD-EXIT.
152900     MOVE 'Y' TO PRTBL-UPD.
153000     ADD 1 TO PRTBL-HI-SLOT.
153100     GO TO ADD-PRODUCT-EXIT.
153200 SLIDE-PROD-ENTRY.
153300     IF PRTBLINX NOT < INSRT-SLOT
153400         MOVE PRTBL-ENTRY(PRTBLINX) TO PRTBL-ENTRY(PRTBLINX + 1)
153500         SET PRTBLINX DOWN BY 1
153600         GO TO SLIDE-PROD-ENTRY.
153700     SET PRTBLINX TO INSRT-SLOT.
153800     MOVE SRCHPRDNM TO PRTBL-PRDNM(PRTBLINX).
153900     MOVE SRCHACRNM TO PRTBL-ACRNM(PRTBLINX).
154000     MOVE SRCHVINX TO PRTBL-VINX(PRTBLINX).
154100     MOVE SRCHCINX TO PRTBL-CINX(PRTBLINX).
154200     IF SRCHPINX > 0
154300         MOVE SRCHPINX TO PRTBL-PINX(PRTBLINX)
154400     ELSE
154500         ADD 1 TO PRTBL-HI-PINX
154600         MOVE PRTBL-HI-PINX TO PRTBL-PINX(PRTBLINX) SRCHPINX.
154700 SLIDE-PROD-EXIT.
154800     EXIT.
154900 PRTBL-SPLIT.
155000     IF PRTBL-UPD = 'Y'
155100         REWRITE PRTBL-REC
155200         IF SSRPRTBL-ST NOT = ZEROS
155300             MOVE 'SSRMS902' TO SSRMSGNUM
155400             MOVE 'SSRPRTBL' TO ERRFILE GO TO FILE-ERROR.
155500     MOVE PRTBL-49-95 TO PRTBL-1-48.
155600     MOVE LOW-VALUES TO PRTBL-49-95  PRTBL-ENTRY(48).
155700     IF INSRT-SLOT NOT > 48
155800         MOVE 47 TO PRTBL-HI-SLOT
155900         GO TO PRTBL-2ND-HALF.
156000     SUBTRACT 48 FROM INSRT-SLOT.
156100     SET PRTBLINX TO 47.
156200     PERFORM SLIDE-PROD-ENTRY THRU SLIDE-PROD-EXIT.
156300     MOVE 48 TO PRTBL-HI-SLOT.
156400     ADD 48 TO INSRT-SLOT.
156500 PRTBL-2ND-HALF.
156600     MOVE ZERO TO PRTBL-NEXT-REC.
156700     MOVE PRRNUM TO PRTBL-PREV-REC.
156800     ADD 1 TO PRTBL-HI-RRNUM.
156900     MOVE PRRNUM TO REQ-PRRNUM. MOVE 48 TO REQ-PRTBLINX.
157000     MOVE PRTBL-HI-RRNUM TO PRRNUM.
157100     WRITE PRTBL-REC.
157200     IF SSRHSTRY-ST NOT = ZEROS
157300         MOVE 'SSRMS903' TO SSRMSGNUM MOVE 'SSRHSTRY' TO ERRFILE
157400         GO TO FILE-ERROR.
157500     MOVE ' ' TO PRTBL-UPD.
157600     PERFORM LOCATE-PRTBL.
157700     MOVE LOW-VALUES TO PRTBL-49-95.
157800     IF INSRT-SLOT > 48
157900         MOVE 48 TO PRTBL-HI-SLOT
158000         GO TO PRTBL-1ST-HALF.
158100     PERFORM SLIDE-PROD-ENTRY THRU SLIDE-PROD-EXIT.
158200     MOVE 49 TO PRTBL-HI-SLOT.
158300 PRTBL-1ST-HALF.
158400     MOVE PRTBL-HI-RRNUM TO PRTBL-NEXT-REC.
158500     MOVE 'Y' TO PRTBL-UPD.
158600 ADD-PRODUCT-EXIT.
158700     EXIT.
158800 ADD-INXITM.
158900     PERFORM START-INTBL THRU SEARCH-INTBL-EXIT.
159000     IF ENTRY-FOUND
159100         GO TO ADD-INXITM-EXIT.
159200     MOVE 'Y' TO INTBL-PARM-CHANGE.
159300     SET INSRT-SLOT TO INTBLINX.
159400     IF INTBL-HI-SLOT = 58
159500         GO TO INTBL-SPLIT.
159600     SET INTBLINX TO INTBL-HI-SLOT.
159700     PERFORM SLIDE-INX-ENTRY THRU SLIDE-INX-EXIT.
159800     MOVE 'Y' TO INTBL-UPD.
159900     ADD 1 TO INTBL-HI-SLOT.
160000     GO TO ADD-INXITM-EXIT.
160100 SLIDE-INX-ENTRY.
160200     IF INTBLINX NOT < INSRT-SLOT
160300         MOVE INTBL-ENTRY(INTBLINX) TO INTBL-ENTRY(INTBLINX + 1)
160400         SET INTBLINX DOWN BY 1
160500         GO TO SLIDE-INX-ENTRY.
160600     SET INTBLINX TO INSRT-SLOT.
160700     MOVE SRCHINXKEY TO INTBL-INDXKEY(INTBLINX).
160800     IF SRCHVINX = ZERO
160900         ADD 1 TO INTBL-HI-IINX
161000         MOVE INTBL-HI-IINX TO INTBL-IINX(INTBLINX)
161100     ELSE MOVE SRCHVINX TO INTBL-IINX(INTBLINX).
161600 SLIDE-INX-EXIT.
161700     EXIT.
161800 INTBL-SPLIT.
161900     IF INTBL-UPD = 'Y'
162000         REWRITE INTBL-REC
162100         IF SSRINTBL-ST NOT = ZEROS
162200             MOVE 'SSRMS902' TO SSRMSGNUM
162300             MOVE 'SSRINTBL' TO ERRFILE
162400             GO TO FILE-ERROR.
162500     MOVE INTBL-30-58 TO INTBL-1-29.
162600     MOVE LOW-VALUES TO INTBL-30-58.
162700     IF INSRT-SLOT NOT > 29
162800         MOVE 29 TO INTBL-HI-SLOT
162900         GO TO INTBL-2ND-HALF.
163000     SUBTRACT 29 FROM INSRT-SLOT.
163100     SET INTBLINX TO 29.
163200     PERFORM SLIDE-INX-ENTRY THRU SLIDE-INX-EXIT.
163300     MOVE 30 TO INTBL-HI-SLOT.
163400     ADD 29 TO INSRT-SLOT.
163500 INTBL-2ND-HALF.
163600     MOVE ZERO TO INTBL-NEXT-REC.
163700     MOVE IRRNUM TO INTBL-PREV-REC.
163800     ADD 1 TO INTBL-HI-RRNUM. MOVE IRRNUM TO REQ-IRRNUM.
163900     MOVE IRRNUM TO REQ-IRRNUM. MOVE 29 TO REQ-INTBLINX.
164000     MOVE INTBL-HI-RRNUM TO IRRNUM.
164100     WRITE INTBL-REC.
164200     IF SSRINTBL-ST NOT = ZEROS
164300         MOVE 'SSRMS903' TO SSRMSGNUM MOVE 'SSRINTBL' TO ERRFILE
164400         GO TO FILE-ERROR.
164500     MOVE ' ' TO INTBL-UPD.
164600     PERFORM LOCATE-INTBL.
164700     MOVE LOW-VALUES TO INTBL-30-58.
164800     IF INSRT-SLOT > 29
164900         MOVE 29 TO INTBL-HI-SLOT
165000         GO TO INTBL-1ST-HALF.
165100     PERFORM SLIDE-INX-ENTRY THRU SLIDE-INX-EXIT.
165200     MOVE 30 TO INTBL-HI-SLOT.
165300 INTBL-1ST-HALF.
165400     MOVE INTBL-HI-RRNUM TO INTBL-NEXT-REC.
165500     MOVE 'Y' TO INTBL-UPD.
165600 ADD-INXITM-EXIT.
165700     EXIT.

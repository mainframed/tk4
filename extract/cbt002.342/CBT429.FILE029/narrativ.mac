      INSTRUCTIONS FOR ENLARGING THE VTOC OF AN ACTIVE DISK PACK

03/18/87 - SAM GOLOB, NEWSWEEK.
03/21/95 - SAM GOLOB, DOITT

INTRODUCTION.  THIS PROCEDURE WAS SUGGESTED TO ME BY JEFF BROIDO, WHO
        USED IT ONCE SOME YEARS AGO.  I HAD THE NEED TO DO IT RECENTLY,
        AND I MENTIONED TO ARNOLD CASINGHINO THAT I WAS SUCCESSFUL IN
        THE ENDEAVOR OF ENLARGING A VTOC "NON-DESTRUCTIVELY".  ARNIE
        INSISTED THAT THERE WAS A NEED, AND THAT I PUT THE PROCEDURE ON
        THE TAPE.

INGREDIENTS.  I THINK IT'LL BE BEST TO WRITE THIS LIKE A RECIPE.  THE
        MOST HELPFUL TOOL IS THE UCLA FULL SCREEN ZAP PROGRAM THAT CAN
        BE FOUND ON THE CBT TAPE, FILE 300.  YOU CAN USE OTHER ZAPPING
        TOOLS, BUT THIS ONE ENABLES YOU TO REALLY SEE WHAT IS GOING
        ON, AND IT'S FAST.  (TO USE FULL SCREEN ZAP TO UPDATE A VTOC,
        IT'LL HAVE TO RUN AUTHORIZED.  ZAP YOUR IKJEFTE2 WITH THE NAME
        "ZAP" AND PUT THE PROGRAM IN AN AUTHORIZED LIBRARY, AND MAKE
        SURE IT'S LINKEDITED WITH SETCODE AC(1).  AUTHORIZE IT ANOTHER
        WAY IF YOU'RE SOPHISTICATED.)  YOU'LL NEED AN MVS SPL DEBUGGING
        GUIDE TO SHOW YOU THE FORMAT OF THE DIFFERENT DSCB'S (VTOC
        ENTRIES).  I SHALL ASSUME THAT YOU HAVE A DEBUGGING GUIDE.  IF
        YOU ARE REALLY STUCK WITHOUT A DEBUGGING GUIDE, YOU CAN EXPAND
        THE MACRO IECSDSL1, WHICH MAPS ALL THE VTOC ENTRY FORMATS.
        THE MACRO IS IN SYS1.AMODGEN.  YOU CAN ASSEMBLE MEMBER
        VTOCDESC IN THIS PDS, AND YOU'LL GET A DESCRIPTION OF ALL THE
        FORMAT TYPES.  I'LL ALSO ASSUME YOU HAVE ISPF.  I CERTAINLY
        HOPE THAT YOU DO!  I'M ALSO INCLUDING 2 JOBS.  THE ONE CALLED
        OSVTOC CONVERTS A PACK WITH AN INDEXED VTOC INTO AN OLD-STYLE
        OS VTOC, WHICH WE'LL NEED TO DO, IF THE VTOC IS INDEXED.  THE
        JOB IXVTOC CONVERTS THE OSVTOC BACK TO INDEXED FORMAT.  YOU'LL
        DO THIS AFTER YOU'VE ENLARGED THE VTOC, IF IT WAS ORIGINALLY
        INDEXED.  ONE MORE TOOL IS NECESSARY.  YOU'LL HAVE TO OBTAIN A
        TRACK MAP OF THE PACK.  THAT IS, YOU'LL NEED TO FIND OUT WHERE
        YOUR VTOC IS ON THE PACK, AND WHAT DATASETS ARE JUST BELOW IT.
        (THIS MAKES SENSE, BECAUSE YOU HAVE TO EXPAND THE VTOC TO THE
        SPACE JUST BEYOND IT.)  I USE THE UCLA VTOCLIST PROGRAM ON
        FILE 149 OF THE CBT TAPE.  EXECUTE IT WITH PARM=MAP (WHICH
        GIVES THE TRACK MAP).  IEHMAP WILL DO IT TOO.  IF YOU INSIST
        ON USING IBM UTILITIES, USE IEHLIST.

PROCEDURE.   ASSUMING YOU NOW HAVE ALL THE INGREDIENTS AVAILABLE, HERE
        IS WHAT YOU DO.

        1.  MAKE SURE YOU HAVE AT LEAST 5 OR 6 FREE DSCBS (VTOC ENTRIES)
              ON THE PACK.  THIS IS ESPECIALLY CRITICAL IF THE VTOC IS
              CURRENTLY IN INDEXED FORMAT.  IF THE VTOC IS NOT INDEXED,
              THEN ONE OR TWO FREE ENTRIES WILL SUFFICE.  MOVE DATASETS
              OFF THE PACK, OR DELETE SOME, TO GET THE NECESSARY FREE
              DSCBS.  (IF YOU DON'T KNOW IF A PACK IS CURRENTLY INDEXED,
              THERE MUST BE 2 CONDITIONS FOR IT.  THE DS4VTOCI BIT IN
              THE FORMAT4 DSCB (VOLUME HEADER DSCB) MUST BE ON, AND
              ALSO, THAT THERE IS AN INDEX DATASET, WITH NAME OF THE
              TYPE SYS1.VTOCIX.VOLSER ON THE PACK.)

        2.  IF THE PACK IS INDEXED, RUN THE JOB OSVTOC (IN THIS PDS)
              TO CONVERT THE VTOC TO NON-INDEXED FORMAT.  THIS WILL
              REQUIRE A FEW FREE DSCBS TO BE AVAILABLE (FOR NEW FORMAT5
              DSCBS TO DESCRIBE FREE SPACE ON THE PACK).  THE JOB WILL
              REQUIRE AN OPERATOR REPLY OF "U".  THE JOB DOES NOT
              DELETE THE DATASET SYS1.VTOCIX.VOLSER ON THE PACK.  IN
              FACT, YOU WILL NEED TO HAVE THIS DATASET LATER, WHEN YOU
              CONVERT BACK TO INDEXED FORMAT, SO JUST LEAVE IT ALONE.

        3.  GET A TRACK MAP OF THE PACK.  DETERMINE HOW MANY NEW VTOC
              ENTRIES YOU WANT.  ON A 3380 THERE ARE 53 ENTRIES PER
              TRACK.  THIS NUMBER, IN BINARY, IS IN FIELD DS4DEVDT
              OF THE FORMAT4 DSCB.  ONCE YOU'VE DECIDED HOW MANY NEW
              ENTRIES YOU WANT, CLEAR THE APPROPRIATE NUMBER OF TRACKS
              JUST AFTER THE EXTENT WHERE THE VTOC CURRENTLY IS.  DO
              THIS BY MOVING ANY DATASETS THAT ARE THERE OFF THE PACK
              (OR ANY OTHER WAY THAT WORKS).

        4.  USING THE JOB VTEXALLC IN THIS PDS (MODIFY IT FOR YOUR
              NEEDS AND USE THE MVS JCL MANUAL FOR REFERENCE), ALLOCATE
              A NEW DATASET, WITH DCB ATTRIBUTES LRECL=96,KEYLEN=44,
              DSORG=PS,RECFM=F.  AT THIS POINT, RUN ANOTHER TRACK MAP
              TO MAKE SURE YOUR NEW DATASET IS RIGHT AFTER THE VTOC.
              DELETE AND REALLOCATE IF NECESSARY, TILL YOU'VE GOT IT
              RIGHT.  MAKE SURE THE DATASET HAS ENOUGH TRACKS.  BE
              CAREFUL WITH THIS.

        5.  NOW EDIT THE DATASET WITH ISPF.  THERE SHOULD BE NO LINES
              IN THE DATASET.  INSERT A LINE AND SAVE IT.  MAKE SURE
              YOU ARE NOT IN NUMBER MODE.  TO DO THIS, ISSUE THE ISPF
              EDIT COMMAND "NUMBER OFF".  THE TWO COMMANDS IN
              SUCCESSION "RENUM" THEN "UNNUM" WILL ALSO DO IT.  GET
              INTO HEX MODE (ISPF COMMAND "HEX").  CONVERT EVERY BLANK
              TO X'00'.  MAKE SURE YOU'VE DONE IT FOR ALL 140
              CHARACTERS.  BE VERY CAREFUL.  THEN SAVE THE LINE AGAIN.
              REPEAT THE LINE OF HEX ZEROS MANY TIMES (DO IT MORE THAN
              THE 795 ENTRIES PER 3380- CYLINDER.)  NOW ATTEMPT TO
              SAVE THE EDIT.  IF YOU DON'T GO DOWN WITH A D37 ABEND,
              YOU PROBABLY DIDN'T REPEAT THE LINE ENOUGH TIMES TO FILL
              ALL THE TRACKS OF THE DATASET.  MAKE SURE YOU GET ABEND
              D37 ON THE SAVE.  IF NOT, REPEAT THE LINE (EACH LINE
              BECOMES A NEW FORMAT0 VTOC ENTRY) MORE TIMES, AND SAVE
              AGAIN, TILL YOU GET AN ABEND D37.  THE ATTEMPTED "SAVE"
              HAS NOW FORMATTED THE DATASET TO LOOK SOMETHING LIKE A
              BLANK VTOC.

        6.  NOW YOU HAVE TO USE FULL SCREEN ZAP.  IF YOU'RE USING
              ANOTHER ZAPPING TOOL, YOU CAN ACCOMPLISH THE SAME THINGS
              WITH IT, BUT PROBABLY NOT AS EASILY.  TO GET THE FORMAT4
              VTOC ENTRY ON THE TSO SCREEN, YOU HAVE TO HAVE A CATALOGED
              DATASET ON THE PACK.  IF THERE ARE NONE, CATALOG A NONVSAM
              DATASET ON THE PACK (WITH ISPF 3.2) USING SOME GARBAGE
              NAME.  (THIS IS WHAT YOU NEED ANOTHER FREE DSCB FOR.)
              SEE MEMBER ZAPINSTR IN THIS PDS FOR INSTRUCTIONS HOW TO
              LOOK AT AND MODIFY VTOC ENTRIES WITH THE UCLA FULL SCREEN
              ZAP PROGRAM.  (I'LL ASSUME HENCEFORTH THAT YOU KNOW HOW
              TO DO THIS.)  YOU SHOULD KEEP A TRACK MAP OF THE PACK
              IN FRONT OF YOU.  YOU MUST NOW CHANGE TWO THINGS ON THE
              FORMAT4.  NUMBER ONE, YOU MUST MODIFY THE SECOND EXTENT
              DESCRIPTOR (GIVING THE HIGH TRACK ADDRESS - THE UPPER
              LIMIT OF THE VTOC) SO IT POINTS TO THE END OF YOUR NEW
              EXTENSION DATASET THAT YOU PUT AFTER THE VTOC.  THE
              LAYOUT OF THE EXTENT DESCRIPTORS IS DESCRIBED IN DETAIL
              UNDER FORMAT3 (DETAILED IN THE SPL DEBUGGING GUIDE UNDER
              CONTROL BLOCK DSCB3) THEY ARE 10 BYTES IN LENGTH AND
              GIVE THE CYLINDER AND TRACK NUMBERS IN BINARY.  IF YOU
              USED VTOCLIST TO GET THE TRACK MAP, AND FULL SCREEN ZAP
              TO SEE THE FORMAT4 DSCB, IT SHOULD BE QUITE CLEAR WHERE
              THE DESCRIPTORS ARE.  USE THE DEBUGGING GUIDE (DSCB4) OR
              THE ASSEMBLY OF THE MAPPING MACRO (DESCRIBED ABOVE) AND
              BE CAREFUL.  WHEN YOU ARE SATISFIED YOU'VE DONE
              EVERYTHING RIGHT (YOU CAN RUIN ACCESS TO THE PACK IF YOU
              DIDN'T), MAKE THE CHANGE PERMANENT.  NOW YOU MUST TURN
              THE DIRF BIT ON, THIS IS DS4DIRF ON THE FORMAT4.  MAKE
              THE CHANGE PERMANENT.  FINALLY, YOU MUST DELETE THE VTOC
              ENTRY FOR THE NEW DATASET WHICH IS RIGHT AFTER THE VTOC.
              THIS IS SO THAT THE VTOC "THINKS" THAT THERE IS FREE
              SPACE THERE.  YOU DO THIS BY SETTING THE ENTIRE ENTRY TO
              HEX ZEROS.  IN FULL SCREEN ZAP, THE "F" COMMAND
              F/DSNAME/ CAN BE USED TO FIND THE CORRECT FORMAT1 DSCB,
              THE COMMAND "SET00" SETS THE ENTIRE RECORD TO HEX ZEROS,
              AND THE COMMAND "ZAP" MAKES THE CHANGE PERMANENT.

              THESE 3 ITEMS:  (CHANGING THE SECOND EXTENT DESCRIPTOR
              AND TURNING ON THE DIRF BIT IN THE FORMAT4.  ZEROING OUT
              THE FORMAT1 VTOC ENTRY OF YOUR NEW FORMATTED VTOC
              EXTENSION DATASET) COMPLETE THE VTOC ZAPS THAT MUST BE
              DONE.

        7.  NOW GET OUT OF ZAP, GET A ZAP LOG, AND GET INTO ISPF 3.2.
              TRY TO ALLOCATE ANOTHER DATASET ON THE PACK.  IF YOU
              HAVE ACCESS TO AN OPERATOR CONSOLE, YOU SHOULD SEE A
              MESSAGE TO THE EFFECT: "VTOC CONVERT ROUTINE ENTERED -
              REASON DIRF".  THIS SHOULD PROBABLY BE THE ONLY CONSOLE
              MESSAGE YOU GET.  YOU MAY GET A MESSAGE THAT THE ROUTINE
              WAS SUCCESSFUL, BUT YOU MAY NOT.  IN ANY CASE, IF YOU
              GET ANY MESSAGE THAT THE ROUTINE WAS UNSUCCESSFUL, YOU
              SHOULD IMMEDIATELY SET THE FORMAT4 DSCB BACK TO WHAT IT
              WAS (SO YOU DON'T KILL ACCESS TO THE PACK), SCRATCH YOUR
              HEAD, AND TRY AGAIN.  I'LL ASSUME YOU WERE SUCCESSFUL SO
              WE'LL LOOK AT THE NEXT STEP.

        8.  YOU NOW SHOULD HAVE AN EXTENDED VTOC.  RUN VTOCLIST AGAIN
              TO VERIFY THE NUMBER OF FREE DSCBS ON THE PACK, OR USE
              ISPF 3.7, OR ANY OTHER METHOD OF CHECKING THE NUMBER OF
              FREE DSCBS.  IF YOUR VTOC WAS ORIGINALLY NOT INDEXED,
              YOU'RE HOME FREE.  OTHERWISE,

        9.  RUN THE JOB IXVTOC TO RECONVERT THE VTOC BACK TO INDEXED
              FORMAT.  REMEMBER THAT THE OPERATOR WILL HAVE TO REPLY
              "U".

       10.  NOW YOUR BOSS SHOULD APPLAUD YOU, AND PUT YOU
              IN FOR A RAISE.


  IF YOU HAVE ANY QUESTIONS OR PROBLEMS IN DOING THIS, I HOPE I'LL BE
AVAILABLE (DURING THE DAY, PLEASE:  UNLESS YOUR SHOP IS ABOUT TO DIE).

     SAM GOLOB
     P.O. BOX 906
     TALLMAN, NY 10982-0906

     PHONE:             (845) 362-1996

            EMAIL : SBGOLOB@ATTGLOBAL.NET  AND/OR SBGOLOB@AOL.COM


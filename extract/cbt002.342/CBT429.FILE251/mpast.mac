 /********************* MPAST    ISPF EDIT MACRO *********************/
 /* MPAST IS AN EDIT MACRO TO INSERT LINES OF DATA WRITTEN TO THE    */
 /* SHARED POOL BY THE INSERTM MACRO. A RANGE MUST BE IDENTIFIED     */
 /* USING THE Z RANGE COMMAND. (ZZ - ZZ, ZNNNN, OR Z ON THE LINE     */
 /* NUMBERS OF THE DATASET)                                          */
 /* IT MAY BE EXECUTED MULTIPLE TIMES UNTIL ANOTHER EXECUTION OF THE */
 /* INSERTM MACRO OR THE ISPF SESSION IS TERMINATED.                 */
 /*                                                                  */
 /* SYNTAX: MPAST                                                    */
 /*                                                                  */
 /********************************************************************/

 ISREDIT MACRO (PARM) NOPROCESS
 ISPEXEC CONTROL ERRORS RETURN
 ISPEXEC VGET (AFTER) SHARED
 SET LEVEL = 1
 ISREDIT LINE_AFTER .ZLAST = ' '
 ISREDIT PROCESS RANGE Z
 ISREDIT RESET SPECIAL
 SET &DCC = &LASTCC
 IF &DCC > 8 THEN  +
    DO
           SET ZEDSMSG = &STR(START LINE MISSING)
         SET ZEDLMSG = &STR(A RANGE OR STARTING LINE WAS NOT +
                            PROVIDED - SPECIFY AND RE-EXECUTE)
           ISPEXEC SETMSG MSG(ISRZ001)
           EXIT CODE(12)
   END
   ISREDIT (FIRST) = LINENUM .ZFRANGE
   ISREDIT (LAST) = LINENUM .ZLRANGE
   ISREDIT (ILINE) = LINENUM &FIRST
LOOP: +
ISPEXEC VGET (RCUTLM&LEVEL,RCUTLB&LEVEL,RCUTRB&LEVEL) SHARED
IF &LASTCC > 0 THEN +
  DO
           SET ZEDSMSG = &STR(NO DATA TO INSERT)
             SET ZEDLMSG = &STR(NO DATA LINES WERE PROVIDED REDO +
             INSERTM)
           ISPEXEC SETMSG MSG(ISRZ001)
           EXIT CODE(12)
        END
SET LINES = &&RCUTLM&LEVEL
SET LINESTOPASTE = &LINES
SET LBND = &&RCUTLB&LEVEL
SET LBND = &LBND
SET RBND = &&RCUTRB&LEVEL
SET RBND = &RBND
ISREDIT (LHBND,RHBND) = BOUNDS
 CONTROL ASIS
   IF &EMPTY = YES THEN +
    SET ILINE = 0
  SET INDEX = 0
 DO WHILE &INDEX < &LINESTOPASTE
 ISPEXEC VGET RCUT&LEVEL&EVAL(&INDEX+1) SHARED
 ISREDIT LINE_BEFORE &EVAL(&ILINE + 1) = MSGLINE +
 < (LBND) (RCUT&LEVEL&EVAL(&INDEX+1)) >
   SET INDEX  = &INDEX + 1
 END
 SET &ILINE = &ILINE + &AFTER
 IF &ILINE > &LAST THEN GOTO RESET
 GOTO LOOP
RESET: +
  ISPEXEC VGET (ZPF10 ISMPF10) PROFILE
  SET &ZPF10 = &ISMPF10
  ISPEXEC VPUT (ZPF10) PROFILE
ISREDIT DEL .ZLAST
EXIT

DLXPUNCH CSECT
         STM   R14,R12,12(R13)
         LR    R11,R15
         USING DLXPUNCH,R11
         ST    R13,SAVEAREA+4
         LR    R6,R13
         LA    R13,SAVEAREA
         ST    R13,8(R6)
         OPEN  (SYSUT1)
         OPEN  (SYSPUNCH,OUTPUT)
LOOP1    EQU   *
         GET   SYSUT1,INAREA
         MVI   OUTECB,X'00'   INITIALIZE ECB
         EXCP  OUTIOB         WRITE IT
         WAIT  ECB=OUTECB     WAIT FOR IT
         CLI   OUTECB,X'7F'   WRITE COMPLETE NORMALLY?
         BNE   OUTERR         NO - ERROR
         B     LOOP1
OUTERR   ABEND 2048,DUMP
*
*  CLOSE ALL FILES
*
EOFUT1   CLOSE (SYSUT1)
         CLOSE (SYSPUNCH)
*
*  THE END
*
         L     R13,SAVEAREA+4
         LM    R14,R12,12(R13)
         RETURN RC=0
SAVEAREA DC    18F'0'
         CNOP  0,8
OUTCCW   DC    X'81',AL3(INAREA),X'2000',H'80'
OUTECB   DC    F'0'
OUTIOB   DC    X'02000000'
         DC    A(OUTECB)
OUTCSW   DC    2F'0'
         DC    A(OUTCCW)
OUTDCBPT DC    A(SYSPUNCH)
         DC    F'0'
         DC    X'00000000'
         SPACE 3
SYSUT1   DCB   DDNAME=SYSUT1,DSORG=PS,EODAD=EOFUT1,LRECL=80,           X
               MACRF=(GM),RECFM=FB
SYSPUNCH DCB   MACRF=(E),DDNAME=SYSPUNCH,DEVD=PC,DSORG=PS,RECFM=F
INAREA   DS    CL80
         EQUATE
         END

./ ADD NAME=$INDEX   0192-93103-94028-0852-00149-00051-00000-KETCSC
  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

               REFERENCE INDEX FOR XDBS.TSOISPF.EXEC
             ------------------------------------------

   XDBS.TSOISPF.EXEC: Library for REXX command lists.


  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

   MEMBER   Description or purpose
  ========  ============================================================
  $INDEX    This member.
  --------  ------------------------------------------------------------
  ADDMSGMT  Adds a message to the appropiate file.
  --------  ------------------------------------------------------------
  AGAIN     Used to get back on ISPF with correct menu
  --------  ------------------------------------------------------------
  ADDMSG    Add a message to the log
  --------  ------------------------------------------------------------
  BRDSN     Edit macro to browse data set under cursor
  --------  ------------------------------------------------------------
  BOOLEAN   Tests different IF clauses to see how to stack conditions
  --------  ------------------------------------------------------------
  BSDSBKUP  This exec reads the BSDS report dataset and creates a
  BSDSBKUP+ job that will delete archive datasets older than 30 days.
  --------  ------------------------------------------------------------
  BSDS      Checks BSDS for old entries and deletes them
  --------  ------------------------------------------------------------
  CHCKSSID  Checks subsystem id
  --------  ------------------------------------------------------------
  CUT       IBM's copy to temp area for later pasting
  --------  ------------------------------------------------------------
  CSCINDEX  kick off ISPF in batch and invoke edit
  --------  ------------------------------------------------------------
  CSCINDXW  Like CSCINDEX but only sends to abuser, not the manager
  --------  ------------------------------------------------------------
  CSCYREND  Send reminder at end of year
  --------  ------------------------------------------------------------
  CNTL      quick edit of DB2 CNTL dataset
  --------  ------------------------------------------------------------
  DB2JOB    run db2 batch program
  --------  ------------------------------------------------------------
  DOFTEMP   Extracted from logon process - for DOF only
  --------  ------------------------------------------------------------
  EDDSN     Edit macro to edit data set under cursor
  --------  ------------------------------------------------------------
  EN        Help user document in $INDEX
  --------  ------------------------------------------------------------
  FOOLSMS   alloc all data sets for userid
  --------  ------------------------------------------------------------
  FRANK     rexx exec to test RUNSTATS statistics.
  --------  ------------------------------------------------------------
  GDDMNEW   allocate data sets for new gddm user
  --------  ------------------------------------------------------------
  GETIDS    Gets system SMF id, user/job name, step, proc names
  --------  ------------------------------------------------------------
  GETINFO2  Used to get information used by some main menus
  --------  ------------------------------------------------------------
  INVKCSP   Invokes CSP V3R3
  --------  ------------------------------------------------------------
  INDEX     Check $INDEX and send messages to abusers
  --------  ------------------------------------------------------------
  INDXW     Warns user about not having updated $INDEX
  --------  ------------------------------------------------------------
  INDEXMAC  macro to help add descriptions
  --------  ------------------------------------------------------------
  INDEX$    Check $INDEX and send notes or prompt for description
  --------  ------------------------------------------------------------
  INVKXPD2  Invoke Expediter under DB2 logon proc
  --------  ------------------------------------------------------------
  INVKXPED  Invoke Expediter under DB2 logon proc
  --------  ------------------------------------------------------------
  INVKPSQL  Invokes PC-SQL/Link
  --------  ------------------------------------------------------------
  INVKODB2  Invoke Omegamon II for DB2
  INVKO2DB  Newer way to invoke Omegamon II for DB2
  --------  ------------------------------------------------------------
  INVKDB2I  Invoke DB2's Interactive environment
  --------  ------------------------------------------------------------
  INVKCSPE  Invoke CSP/AE environment V3R3
  --------  ------------------------------------------------------------
  INVKCSPD  Invoke CSP/AD environment V3R3
  --------  ------------------------------------------------------------
  IMGMSG    Send tablespace list as profs note
  --------  ------------------------------------------------------------
  ISDB2UP   Checks if DB2 is active
  --------  ------------------------------------------------------------
  ISPFMVSZ  Gets SMF system id and starts ISPF
  --------  ------------------------------------------------------------
  ISPFON1   allocates datasets fro MVSZ and starts ISPF
  --------  ------------------------------------------------------------
  ISVTAMUP  Issues tso status until NET is executing then pauses two min
  --------  ------------------------------------------------------------
  LAWCSP    Invoke CSP/370 environment V4R1
  --------  ------------------------------------------------------------
  LASTIPL   Follow MVS control blocks to find last ipl information
  --------  ------------------------------------------------------------
  MODELLDS  Models a Linear data set for copying
  --------  ------------------------------------------------------------
  MYINDEX   Helps find your entries and update $INDEX
  --------  ------------------------------------------------------------
  OMGINST   Invokes Omegamon II for DB2 using V250 or V260 clist pds
  --------  ------------------------------------------------------------
  PASTE     IBM's copy from temp area previously CUT
  --------  ------------------------------------------------------------
  PEEK      REXX exec to display SMF system id
  --------  ------------------------------------------------------------
  REXXDW    Sample REXX to write to disk
  --------  ------------------------------------------------------------
  SAV       SAVE replacement, checks $INDEX
  --------  ------------------------------------------------------------
  SAVMAC    check $index and prompt if description needed
  -------- -------------------------------------------------------------
  SF        Prompt for dest and issue transmit
  --------  ------------------------------------------------------------
  SMCASID   Retrieve MVS SYSID of system on which EXEC is run
  --------  ------------------------------------------------------------
  STATS     rexx exec to test RUNSTATS statistics.
  --------  ------------------------------------------------------------
  SDSFEXTR  copy jobs beginning with prefix from jes using sdsf
  --------  ------------------------------------------------------------
  SETOMGOP  Set Omegamon II for DB2 options using NEWAPPL(O2AP)
  --------  ------------------------------------------------------------
  TRCKADD   REXX adder for time tracking
  -------- -------------------------------------------------------------
  TRCKTOT   REXX totals for time tracking
  -------- -------------------------------------------------------------
  TRCKPGMR  REXX strip off first two words of programmer name
  --------  ------------------------------------------------------------
  TSO2ISPF  Initial TSO logon clist
  --------  ------------------------------------------------------------
  TOREXX    help convert clist to rexx
  --------  ------------------------------------------------------------
  VMMSG     Send message to vm
  --------  ------------------------------------------------------------
  VMMSGMG   Send message to vm
  --------  ------------------------------------------------------------
  VMMSGIT   Send file as message to VM
  --------  ------------------------------------------------------------
  WHO       Obtain time & userid
  --------  ------------------------------------------------------------
  WHATPROC  Show jobname/proc/step date and time
  --------  ------------------------------------------------------------
  WHOAMI    Gets userid or batch name and stores in ISPF variables
  --------  ------------------------------------------------------------

  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

./ ADD NAME=ADDMSG   0133-92114-94006-0959-00150-00081-00089-KETCSC
/*=============== ADDMSG - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(ADDMSG)                                                */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC MODS A MESSAGE TO THE APPROPRIATE FILE.           */
/*                                                                  */
/*=============== ADDMSG - REXX EXEC ===============================*/
    SAY ' '
    SAY ' LIB: XDBS.TSOISPF.EXEC(ADDMSG)'
    SAY ' GDE: KENNETH E. TOMIAK'
    SAY ' DOC: THIS EXEC MODS A MESSAGE TO THE APPROPRIATE FILE'
    SAY ' '
    SAY ' EXECUTING ON' DATE() 'AT' TIME()'.'
    SAY ' '

    ARG JOBNAME TOID STATUS
    PSATOLD = STORAGE(21C,4)                      /* POINTER TO TCB */
    PTRTIOT = STORAGE(D2X(C2D(PSATOLD)+12),4)     /* POINTER TO TIOT */
    TIOTJOB = STORAGE(D2X(C2D(PTRTIOT)),8)
    IF (JOBNAME = '') THEN JOBNAME = 'NOT SUPPLIED JOB'
    IF (JOBNAME ^= TIOTJOB) THEN
      DO
        JOBNAME = TIOTJOB
      END
    IF (TOID = '') THEN TOID = DB2GRP
    IF (STATUS = '') THEN STATUS = 'INCOMPLETE PARAMETER LIST'
/*========================================================*/
/* ALLOW USER TO CONTINUE                                 */
/*========================================================*/
    MSGSTAT = MSG(ON)

/*========================================================*/
/* FIND DETAILS                                           */
/*========================================================*/
    X=OUTTRAP(JOBLIST.,25)
    "STATUS" JOBNAME
    RX=OUTTRAP(OFF)
    SSID = SUBSTR(JOBNAME,1,4)
    IF (SSID = "MVSP") THEN SSID = "P1DB"
    IF (SSID = "IRLM") THEN SSID = RIGHT("    "JOBNAME,4)
    IF (SSID = "DOFE") THEN SSID = "DDB2"
    IF (SSID = "DOFF") THEN SSID = "PDB2"
    IF (SSID = "PROC") THEN SSID = "DSN"
    IF (SSID = "MVSX") THEN SSID = "XDBS.DB2MGR"
    IF (SSID = "MVSZ") THEN SSID = "XDBS.DB2MGR"
    IF (SSID = "DOFX") THEN SSID = "XDBS.DB2MGR"
    TRISSID = SUBSTR(SSID   ,1,3)
    IF (TRISSID = "DSN") THEN,
      DO
        SSID = "DSN"
        VOL = "DDBS01"
        SIGNAL GOTVOL
      END
    IF (TRISSID = "CSC") THEN,
      DO
        SSID = "XDBS.DB2MGR"
        VOL = "DB2S01"
        SIGNAL GOTVOL
      END
    IF (TRISSID = "MVS") THEN,
      DO
        SSID = "XDBS.DB2MGR"
        VOL = "DB2S01"
        SIGNAL GOTVOL
      END
    IF (TRISSID = "DOF") THEN,
      DO
        SSID = "XDBS.DB2MGR"
        VOL = "DB2S01"
        SIGNAL GOTVOL
      END
    VOL = SSID"01"
    IF (SSID = "DDB2") THEN VOL = "DDBS01"
    IF (SSID = "PDB2") THEN VOL = "PDBS01"
    IF (SSID = "DB2M") THEN VOL = "XDB001"
    IF (SSID = "DB2X") THEN VOL = "XDB001"
    IF (SSID = "DOFX") THEN VOL = "XDB001"
    IF (SSID = "XDBS.DB2MGR") THEN VOL = "DB2S01"
    IF (SSID = "XDBS.DB2MGR") THEN VOL = "DB2S01"
    IF (SSID = "P1DB") THEN VOL = "HRA000"
    SAY "ATTEMPTING TO ALLOCATE" SSID".MSGFILE ON" VOL
GOTVOL:
    MSGSTAT = MSG(OFF)
    ADDRESS TSO "FREE  FILE(ADDMSG)"
    ADDRESS TSO "ALLOC FILE(ADDMSG) NEW CATALOG",
        "DATASET('"SSID".MSGFILE')",
        "RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)",
        "VOLUME("VOL")"
    RCSAVE = RC
    IF (RCSAVE = 0) THEN
      DO
        PUSH "MSGFILE INITIALIZED" DATE() TIME()
        SAY "MSGFILE INITIALIZED" DATE() TIME()
        "EXECIO 1 DISKW ADDMSG (FINIS"
        ADDRESS TSO "FREE  FILE(ADDMSG)"
      END
    IF (TOID = "NULL") THEN
      DO
        EXIT 0
      END
    TRIES = 0
FILEBUSY:
    ADDRESS TSO "ALLOC FILE(ADDMSG) MOD KEEP",
        "DATASET('"SSID".MSGFILE')",
        "RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)",
        "VOLUME("VOL")"
    RCSAVE = RC
    IF (RCSAVE > 8) THEN
        DO
          TRIES = TRIES + 1
          IF (TRIES > 2500) THEN
            DO
              SAY "GAVE UP AFTER" TRIES "ATTEMPTS."
              EXIT RCSAVE
            END
          SIGNAL FILEBUSY
        END
    IF (JOBLIST = 0) THEN
        DO
          PUSH TOID JOBNAME STATUS "NOT FOUND BY STATUS COMMAND",
            DATE() TIME()
          SAY TOID JOBNAME STATUS "NOT FOUND BY STATUS COMMAND",
            DATE() TIME()
          "EXECIO 1 DISKW ADDMSG"
        END
      ELSE
       DO
         DO I = JOBLIST.0 TO 1 BY -1
           IF (WORD(JOBLIST.I,4) = "EXECUTING") THEN
             DO
               PUSH TOID JOBNAME STATUS,
                 DATE() TIME() JOBLIST.I
               SAY TOID JOBNAME STATUS JOBLIST.I
               "EXECIO" 1 "DISKW ADDMSG"
             END
           ELSE
             DO
               SAY TOID JOBNAME STATUS JOBLIST.I
             END
         END
       "EXECIO" 0 "DISKW ADDMSG (FINIS"
       END

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/

    EXIT
./ ADD NAME=ADDMSGMT 0120-92309-93099-1009-00100-00074-00063-MANN
/*=============== ADDMSGMT - REXX EXEC =============================*/
/*                                                                  */
/* LIB: EXEC(ADDMSGMT)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC MODS A MESSAGE TO THE APPROPRIATE FILE.           */
/*                                                                  */
/*=============== ADDMSGMT - REXX EXEC =============================*/
    SAY ' '
    SAY ' LIB: XDBS.TSOISPF.EXEC(ADDMSGMT)'
    SAY ' GDE: MANNY PRISCIANDARO'
    SAY ' DOC: THIS EXEC MODS A MESSAGE TO THE APPROPRIATE FILE'
    SAY ' '

    ARG STATUS SSID
    STATUS = STATUS ×× '-' ×× SSID
    PSATOLD = STORAGE(21C,4)                      /* POINTER TO TCB */
    PTRTIOT = STORAGE(D2X(C2D(PSATOLD)+12),4)     /* POINTER TO TIOT */
    TIOTJOB = STORAGE(D2X(C2D(PTRTIOT)),8)
    JOBNAME = TIOTJOB
    IF (STATUS = '') THEN STATUS = 'INCOMPLETE PARAMETER LIST'
    IF (SSID = '') THEN SSID = 'NOT SUPPLIED SSID'
/*========================================================*/
/* FIND CORRECT SSID FOR MSG FILE ALLOCATION              */
/*========================================================*/
    IF LENGTH(SSID) = 4 & SUBSTR(SSID,2,3) = 'DSN' THEN
       SSID = SUBSTR(SSID,2,3)
    IF LENGTH(SSID) = 5 THEN
       SSID = SUBSTR(SSID,2,4)
/*========================================================*/
/* ALLOW USER TO CONTINUE                                 */
/*========================================================*/
    MSGSTAT = MSG(ON)

/*========================================================*/
/* FIND DETAILS                                           */
/*========================================================*/
    X=OUTTRAP(JOBLIST.,25)
    "STATUS" JOBNAME
    RX=OUTTRAP(OFF)
    MSGSTAT = MSG(OFF)
    ADDRESS TSO "FREE  FILE(ADDMSG)"
    ADDRESS TSO "ALLOC FILE(ADDMSG) NEW CATALOG",
        "DATASET('"SSID".MSGFILE')",
        "RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)",
        "VOLUME("DB2S01")"
    RCSAVE = RC
    IF (RCSAVE = 0) THEN
      DO
        PUSH "MSGFILE INITIALIZED" DATE() TIME()
        SAY "MSGFILE INITIALIZED" DATE() TIME()
        "EXECIO 1 DISKW ADDMSG (FINIS"
        ADDRESS TSO "FREE  FILE(ADDMSG)"
      END
    TRIES = 0
FILEBUSY:
    ADDRESS TSO "ALLOC FILE(ADDMSG) MOD KEEP",
        "DATASET('"SSID".MSGFILE')"
    RCSAVE = RC
    IF (RCSAVE > 8) THEN
        DO
          TRIES = TRIES + 1
          IF (TRIES > 2500) THEN
            DO
              SAY "GAVE UP AFTER" TRIES "ATTEMPTS."
              EXIT RCSAVE
            END
          SIGNAL FILEBUSY
        END
    IF (JOBLIST = 0) THEN
        DO
          PUSH "X" JOBNAME STATUS "NOT FOUND BY STATUS COMMAND",
            DATE() TIME()
          SAY "X" JOBNAME STATUS "NOT FOUND BY STATUS COMMAND",
            DATE() TIME()
          "EXECIO 1 DISKW ADDMSG"
        END
      ELSE
       DO
         DO I = JOBLIST.0 TO 1 BY -1
           IF (WORD(JOBLIST.I,4) = "EXECUTING") THEN
             DO
               PUSH "X"  JOBNAME STATUS,
                 DATE() TIME() JOBLIST.I
               SAY "X" JOBNAME STATUS JOBLIST.I
               "EXECIO" 1 "DISKW ADDMSG"
             END
           ELSE
             DO
               SAY "X" JOBNAME STATUS JOBLIST.I
             END
         END
       "EXECIO" 0 "DISKW ADDMSG (FINIS"
       END

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/

    EXIT
./ ADD NAME=AGAIN    0110-93327-93339-0941-00237-00250-00021-PETE
/*-- REXX --- AGAIN -------------------------------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(AGAIN)                                             */
/* GDE: KENNETH E. TOMIAK                                            */
/* DOC: GETS YOU FROM TSO TO ISPF after determining panel name.      */
/* NTE: Vertical represented by ×. Check after upload.               */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG PANEL
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO CVT FROM PSA                                    */
/*-------------------------------------------------------------------*/
PTR2PSA = 0
CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO SMCA, THEN GET SMF SYSTEM ID                    */
/*-------------------------------------------------------------------*/
CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
SMFID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
/*-------------------------------------------------------------------*/
/* GET JOBNAME, STEP, AND PROCEDURE                                  */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
TSOPROC  = SYSVAR(SYSPROC)
/*-------------------------------------------------------------------*/
/* GET FMID, PRODUCT LEVEL, AND RELEASE                              */
/*-------------------------------------------------------------------*/
CVTPRODI = STORAGE(D2X(C2D(CVTPTR)+X2D(0E0)-256),8)
CVTPRODN = STORAGE(D2X(C2D(CVTPTR)+X2D(0D8)-256),8)
CVTRELNO = STORAGE(D2X(C2D(CVTPTR)+X2D(0FC)-256),4)
/*--------------------------------------------------------------------*/
/*      USE RACF LISTUSER command to determine which groups a user    */
/*      is connected to.                                              */
/*--------------------------------------------------------------------*/
SYSUID = SYSVAR(SYSUID)
rgroup = ""
    x = Outtrap('name.')
    "LISTUSER" SYSUID
    x = Outtrap('OFF')
    OWNR = "NO ONE"
    PGMR = "NO ONE"
/*--------------------------------------------------------------------*/
/* Loop through trapped output and find the group= lines.             */
/* Display each group.                                                */
/*--------------------------------------------------------------------*/
    Do i = 1 to name.0 by 1
      loc = index(name.i,'GROUP=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+6,8)
          there = find(rgroup,thisgrp)
          if there = 0 then rgroup = rgroup thisgrp
        end
      loc = INDEX(name.i,' OWNER=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+7,8)
          OWNR = thisgrp
          loc = INDEX(name.i,'NAME=')
          PGMR = substr(name.i,loc+5,20)
        end
    End
/*--------------------------------------------------------------------*/
/*  check user authority                                              */
/*--------------------------------------------------------------------*/
    If (OWNR = "CSCDB2") Then SIGNAL NOTHRA
CHKAUTH:
/*--------------------------------------------------------------------*/
/*  If HRA: exit to act like NYCHA process (poorly done way)          */
/*--------------------------------------------------------------------*/
    HRAs = INDEX(SYSUID,"069")
    HRAo = INDEX(OWNR,"069")
    HRAg = INDEX(rgroup,"069")
    If (HRAs > 0) ×,
       (HRAo > 0) ×,
       (HRAg > 0) then,
      do
        Say "Enter your regular commands."
        Exit 0
      end
NOTHRA:
/*--------------------------------------------------------------------*/
/*  Wasn't HRA: set default ISPF panel to ISPSTART                    */
/*--------------------------------------------------------------------*/
    If (PANEL = "") then,
      PNL = "PANEL(CSC@MSTR)"
    ELSE ,
      PNL = "PANEL("PANEL")"
/*--------------------------------------------------------------------*/
/*  If RACF group: allow to get AGAIN                                 */
/*--------------------------------------------------------------------*/
    RACFo = INDEX(OWNR,"CSCRAC")
    RACFg = INDEX(rgroup,"CSCRAC")
    If (RACFo > 0) ×,
       (RACFg > 0) then,
      Do
        PNL = "PANEL(ISP@MSTR)"
        SIGNAL BEGIN
      End
/*--------------------------------------------------------------------*/
/*  If Auditor group: allow to get AGAIN                              */
/*--------------------------------------------------------------------*/
    AUDo = INDEX(OWNR,"CSCAUD")
    AUDg = INDEX(rgroup,"CSCAUD")
    If (AUDo > 0) ×,
       (AUDg > 0) then,
      Do
        PNL = "PANEL(ISP@MSTR)"
        SIGNAL BEGIN
      End
/*--------------------------------------------------------------------*/
/*  If IBM Consulting team: allow to get AGAIN like DEP               */
/*--------------------------------------------------------------------*/
    IF (SYSUID = "SXSCSC")  ×,
       (SYSUID = "DMV0016") ×,
       (SYSUID = "JXCCSC")  Then,
      do
        PNL = "PANEL(PRIMPNL)"
        Signal BEGIN
      end
/*--------------------------------------------------------------------*/
/*  If MVS group: allow to get AGAIN                                  */
/*--------------------------------------------------------------------*/
    MVSo = INDEX(OWNR,"CSCMVS")
    MVSg = INDEX(rgroup,"CSCMVS")
    If (MVSo > 0) ×,
       (MVSg > 0) then,
      do
        PNL = "PANEL(PRIMPNL)"
        Signal BEGIN
      end
/*--------------------------------------------------------------------*/
/*  If CICS group: allow to get AGAIN                                 */
/*--------------------------------------------------------------------*/
    CICSo = INDEX(OWNR,"CSCCICS")
    CICSg = INDEX(rgroup,"CSCCICS")
    If (CICSo > 0) ×,
       (CICSg > 0) then,
      SIGNAL BEGIN
/*--------------------------------------------------------------------*/
/*  If DB2 group: allow to get AGAIN                                  */
/*--------------------------------------------------------------------*/
    DB2o = INDEX(OWNR,"CSCDB2")
    DB2g = INDEX(rgroup,"CSCDB2") + INDEX(rgroup,"DD200")
    If (DB2o > 0) ×,
       (DB2g > 0) then,
        Signal BEGIN
/*--------------------------------------------------------------------*/
/*  If DEP users: allow to get AGAIN                                  */
/*--------------------------------------------------------------------*/
    BWECg = INDEX(rgroup,"828")
    If (BWECg > 0) then,
      do
        PNL = "PANEL(PRIMPNL)"
        Signal BEGIN
      end
/*--------------------------------------------------------------------*/
/*  Not a known user of this process:                                 */
/*--------------------------------------------------------------------*/
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) Then,
      Address TSO "SE '"SYSUID" logged AGAIN using "TSOPROC,
        OWNR DATE() TIME(),
        "' U(KETCSC) LOGON"
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) Then,
      Address TSO "SE '"SYSUID" logged AGAIN using "TSOPROC,
        OWNR DATE() TIME(),
        "' U(KETCSC) LOGON"
    Say "Your use of this logon procedure is not supported."
    Say "Contact your Client Services Representative."
    EXIT 0
/*--------------------------------------------------------------------*/
/*  User authorized to receive allocations from this exec             */
/*--------------------------------------------------------------------*/
BEGIN:
/*--------------------------------------------------------------------*/
/* On DOF use other primary panel                                     */
/*--------------------------------------------------------------------*/
    If (SMFID = "DOFD") × (SMFID = "DOFP") Then,
      Do
        PNL =  "PANEL(ISP@MSTR)"
      End
/*--------------------------------------------------------------------*/
/*  If MVS group or Ken: retrieve IPL information                     */
/*--------------------------------------------------------------------*/
    If (MVSo > 0) ×,
       (MVSg > 0) ×,
       (SYSUID = "KETCSC") Then,
      Do
/*--------------------------------------------------------------------*/
/* GET CPU MODEL                                                      */
/*--------------------------------------------------------------------*/
        CVTMDL   = C2X(STORAGE(D2X(C2D(CVTPTR)+X2D(0FA)-256),2))
/*--------------------------------------------------------------------*/
/* GET IPL ADDRESS                                                    */
/*--------------------------------------------------------------------*/
        CVTSYSAD = STORAGE(D2X(C2D(CVTPTR)+X2D(030)),4)
        UCBVOLI  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(01C)),6)
        UCBNAME  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(0D)),3)
      End
    SAY " "
    SAY "Press ENTER when *** appears."
    SAY " "
    ISPSTART PNL
    SAY " "
    SAY "SYSTEM:"SMFID
    SAY " "
    SAY "You are now out of ISPF."
    SAY "      OPTIONS are:"
    SAY "         %l (to logon as "SYSUID")"
    SAY "         %x or logoff (to logoff)"
    SAY "         %again (to get back to ISPF menu)"
    SAY " "
/*--------------------------------------------------------------------*/
/* AGAIN MVS 4.1 we tried to trick our way to IPCS                    */
/*--------------------------------------------------------------------*/
    IF (CVTPRODN = "SP4.2.0") then,
      Do
        x = Outtrap('name.')
        Address TSO "ATTR IPCSINVK"
        x = Outtrap('OFF')
        Address TSO "FREE F(IPCSINVK)"
        LINES = name.0
        IF LINES > 0 THEN exit 0
        SAY "*-------------------------------------------------------*"
        SAY "*                                                       *"
        SAY "*  IPCS IS IN THE PROCESS OF COMING UP.  THIS WILL      *"
        SAY "*  TAKE SEVERAL SECONDS TO ACCOMPLISH.  PLEASE WAIT.    *"
        SAY "*                                                       *"
        SAY "*-------------------------------------------------------*"
        IPCS
        ISPSTART PNL
      end
    EXIT 0
./ ADD NAME=BOOLEAN  0100-93321-93321-1648-00117-00117-00000-KETCSC
/*-- REXX --- BOOLEAN ----------------------------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(BOOLEAN)                                           */
/* GDE: KENNETH E. TOMIAK                                            */
/* DOC: Tests different BOOLEAN coding conventions.                  */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG junk
/*-------------------------------------------------------------------*/
/* Get pointer to Prefixed Save Area (PSA) and Communications        */
/* Vector Table (CVT)                                                */
/*-------------------------------------------------------------------*/
PTR2PSA = 0
CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO SMCA, THEN GET SMF SYSTEM ID                    */
/*-------------------------------------------------------------------*/
CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
SMFID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
/*-------------------------------------------------------------------*/
/* GET JOBNAME, STEP, AND PROCEDURE                                  */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
TSOPROC  = SYSVAR(SYSPROC)
/*-------------------------------------------------------------------*/
/* GET FMID, PRODUCT LEVEL, AND RELEASE                              */
/*-------------------------------------------------------------------*/
CVTPRODI = STORAGE(D2X(C2D(CVTPTR)+X2D(0E0)-256),8)
CVTPRODN = STORAGE(D2X(C2D(CVTPTR)+X2D(0D8)-256),8)
CVTRELNO = STORAGE(D2X(C2D(CVTPTR)+X2D(0FC)-256),4)
/*-------------------------------------------------------------------*/
/* GET CPU MODEL                                                     */
/*-------------------------------------------------------------------*/
CVTMDL   = C2X(STORAGE(D2X(C2D(CVTPTR)+X2D(0FA)-256),2))
/*-------------------------------------------------------------------*/
/* GET IPL ADDRESS                                                   */
/*-------------------------------------------------------------------*/
CVTSYSAD = STORAGE(D2X(C2D(CVTPTR)+X2D(030)),4)
UCBVOLI  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(01C)),6)
UCBNAME  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(0D)),3)
/* ****************************************************************** */
/*                                                                    */
/* DOC: USE RACF LISTUSER command to determine which groups a user    */
/*      is connected to.                                              */
/*                                                                    */
/* ****************************************************************** */
SYSUID = SYSVAR(SYSUID)
rgroup = ''
/* ****************************************************************** */
/* Get RACF information.                                              */
/* ****************************************************************** */
    x = Outtrap('name.')
    "LISTUSER" SYSUID
    x = Outtrap('OFF')

/******************************************************************/
/* Loop through trapped output and find the group= lines.         */
/* Display each group.                                            */
/******************************************************************/
    Do i = 1 to name.0 by 1
      loc = index(name.i,'GROUP=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+6,8)
          there = find(rgroup,thisgrp)
          if there = 0 then rgroup = rgroup thisgrp
        end
      LOC = INDEX(NAME.I,' OWNER=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+6,8)
          OWNR = thisgrp
          LOC = INDEX(name.i,'NAME=')
          PGMR = substr(name.i,loc+5,20)
        end
    End
 /*                                                                  */
 /*  check user authority                                            */
 /*                                                                  */
CHKAUTH:
 /*                                                                  */
 /*  Check for RACF/MVS                                              */
 /*                                                                  */
    IF (SYSUID = " KETCSC") then,
      Do
        Say "1" SYSUID "is matches KET."
      End
    IF (SYSUID = " KETCSC") × (SYSUID = "KETCSC") then,
      Do
        Say "2a" SYSUID "is matching KET or DMV."
      End
    IF (SYSUID = " KETCSC") × (SYSUID = " KETCSC") then,
      Do
        Say "2b" SYSUID "is matching KET or DMV."
      End
    IF (SYSUID = "KETCSC") && (SYSUID = "DMV0016") &&,
      (TSOPROC = "DB2DEVL") then,
      Do
        Say "3" SYSUID "is matching KET or DMV."
      End
    IF (SYSUID = "KETCSC") × (SYSUID = "DMV0016") then,
      Do
        Say "4" SYSUID "is matching KET or DMV."
      End
    IF (SYSUID = "KETCSC") & (SYSUID = "DMV0016") then,
      Do
        Say "5" SYSUID "is matching KET and DMV."
      End
    Else,
      Do
        Say "6" SYSUID "can not match KET and DMV."
      End
    Exit 0
./ ADD NAME=BRDSN    0114-92227-93113-1440-00017-00017-00000-KETCSC
/*  CURSOR BROWSE REXX  */
/* LIB: XDBS.TSOISPF.EXEC(BRDSN)     */
ADDRESS ISPEXEC 'CONTROL ERRORS RETURN'
ADDRESS ISREDIT 'MACRO NOPROCESS'
ADDRESS ISREDIT '(CL,CC) = CURSOR'
IF CC = 0 THEN EXIT
ADDRESS ISREDIT '(DATA) = LINE' CL
IF RC > 0 THEN EXIT
DELIM = "~`!%^&-_=+{}<>,/?" '"'
END = LENGTH(DATA)
START = END - VERIFY(REVERSE(DATA)" ",DELIM,"M",END-CC+1)+2
END = VERIFY(DATA" ",DELIM,"M",CC)-1
IF START > END THEN EXIT
WORD = SUBSTR(DATA,START,END-START+1)
ADDRESS ISPEXEC 'BROWSE DATASET('''WORD''')'
IF RC > 0 THEN ADDRESS ISPEXEC 'SETMSG MSG(ZERRMSG)'
EXIT
./ ADD NAME=BSDS     0148-92242-93181-2125-00141-00089-00085-DMV0016
/*============== BSDS - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(BSDS)                                                  */
/* GDE: FRANKLIN MUNDO                                              */
/* DOC: THIS EXEC READS THE BSDS REPORT DATASET AND CREATES A       */
/*      JOB THAT WILL DELETE ARCHIVE DATASETS OLDER THAN 30 DAYS.   */
/*                                                                  */
/*============== BSDS - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    SAY 'RUN ON ' DATE() ' AT ' TIME() '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    PARSE ARG SYSAFF SSID DAYS
    IF (SYSAFF = '') THEN,
      DO
        SAY 'MVS/JES SYSTEM AFFINITY NAME REQUIRED'
        SAY 'DB2 SUBSYSTEM NAME REQUIRED'
      END
    IF (SSID = '') THEN,
      DO
        SAY 'DB2 SUBSYSTEM NAME REQUIRED'
      END
    IF (DAYS = '') THEN,
      DO
        DAYS = 31
      END
    CDATE = DATE('J')
    YY   = SUBSTR(CDATE,1,2)
    DDD  = SUBSTR(CDATE,3,3)
    DDD  = DDD - DAYS
    IF DDD < 0 THEN
      DO
        DDD  = DDD + 365
        YY  = YY - 1
        DAY  = YY××DDD
      END
    ELSE
      DO
        DAY = YY××DDD
      END
    TSOEXEC CALL "'" ×× SSID ×× ".DSNLOAD(DSNJU004)'"
    IF RC ^= 0 THEN
      DO
        SAY 'DSNJU004 RC='RC
        EXIT RC
      END
    SAY 'DSNJU004 RC='RC

/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
      SUBFLAG = 'NO'
      COMPDSN = ' '
      "EXECIO * DISKR SYSPRINT(STEM RECORD."
        DO R = 1 TO RECORD.0 BY 1
          IF INDEX(RECORD.R,'ARCHLOG') ^= 0 THEN
            DO
              DATEX = INDEX(RECORD.R,'.')
              DATEX = DATEX - 2
              DATE = SUBSTR(RECORD.R,DATEX,6)
              L = LENGTH(RECORD.R)
              DSNX = INDEX(RECORD.R,'DSN=')
              DSNX = DSNX + 4
              DSNZ = (L-DSNX) + 1
              DSN  = SUBSTR(RECORD.R,DSNX,DSNZ)
              YY   = SUBSTR(DATE,1,2)
              DDD  = SUBSTR(DATE,4,3)
              IDATE  = YY××DDD
/*===========================================================*/
/* COMPARE FOR IDENTICAL DSN RECORDS. QUEUE ONLY ONE RECORD. */
/*===========================================================*/
              COMPVAL = COMPARE(DSN,COMPDSN)
              IF COMPVAL > 0 & IDATE < DAY THEN
                DO
                 SUBFLAG = 'YES'
                 QUEUE 'DELETE DSNAME='DSN
                 SAY 'ADDED DELETE DSNAME='DSN
                END
              X = OUTTRAP('NAME.')
              "ALLOC FILE(TEMP) DATASET('"SSID".DEL.BSDS') OLD REUSE"
              COMPDSN = DSN
            END
          ELSE NOP
        END
    "EXECIO 0 DISKR SYSPRINT(FINIS"

/*========================================================*/
/* CHECK WHICH IF JOB GETS SUBMITTED                      */
/*========================================================*/
    IF SUBFLAG = 'NO' THEN
      DO
        ADDMSG SSID'MSTR ' SSID'SYS NO-CLEANUP'
        EXIT 0
      END
    ADDMSG SSID'MSTR ' SSID'SYS CLEANUP'

/*========================================================*/
/* BUILD AND SUBMIT JOB                                   */
/*========================================================*/
    IF (SYSAFF = 'MVSP') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'MVSW') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'MVSX') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'DOFX') THEN
      DO
        MC = 'Q'
      END
    IF (SYSAFF = 'DOFD') THEN
      DO
        MC = 'Q'
      END
    IF (SYSAFF = 'DOFP') THEN
      DO
        MC = 'Q'
      END
/*========================================================*/
/* WRITE OUT STACK.                                       */
/*========================================================*/
    "EXECIO * DISKW TEMP (FINIS"
    "FREE FILE(TEMP)"
    "FREE FILE(SYSPRINT)"
/*========================================================*/
/* RUN LOG INVENTORY UPDATE                               */
/*========================================================*/
    "ALLOC FILE(SYSPRINT) SYSOUT("MC")"
    TSOEXEC CALL "'" ×× SSID ×× ".DSNLOAD(DSNJU003)'"
    MYRC = RC
    SAY 'DSNJU003 RC='MYRC
    EXIT MYRC
./ ADD NAME=BSDSBKUP 0102-93021-93022-1023-00133-00133-00133-FMMCSC
/*============== BSDS - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(BSDS)                                                  */
/* GDE: FRANKLIN MUNDO                                              */
/* DOC: THIS EXEC READS A THE BSDS REPORT DATASET AND CREATES A     */
/*      JOB THAT WILL DELETE ARCHIVE DATASETS OLDER THAN 30 DAYS.   */
/*                                                                  */
/*============== BSDS - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    SAY 'RUN ON ' DATE() ' AT ' TIME() '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    PARSE ARG SYSAFF SSID DAYS
    IF (SYSAFF = '') THEN,
      DO
        SAY 'MVS/JES SYSTEM AFFINITY NAME REQUIRED'
        SAY 'DB2 SUBSYSTEM NAME REQUIRED'
      END
    IF (SSID = '') THEN,
      DO
        SAY 'DB2 SUBSYSTEM NAME REQUIRED'
      END
    IF (DAYS = '') THEN,
      DO
        DAYS = 31
      END
    CDATE = DATE('J')
    YY   = SUBSTR(CDATE,1,2)
    DDD  = SUBSTR(CDATE,3,3)
    DDD  = DDD - DAYS
    IF DDD < 0 THEN
      DO
        DDD  = DDD + 365
        YY  = YY - 1
        DAY  = YY××DDD
      END
    ELSE
      DO
        DAY = YY××DDD
      END
    TSOEXEC CALL "'" ×× SSID ×× ".DSNLOAD(DSNJU004)'"
    IF RC ^= 0 THEN
      DO
        SAY 'DSNJU004 RC='RC
        EXIT RC
      END
    SAY 'DSNJU004 RC='RC
    ISPEXEC 'TBCREATE BSDSTBL NAMES(DSN) NOWRITE'

/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
    DONE = 'NO'
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR SYSPRINT"
      IF RC = 0 THEN
        DO
          PULL RECORD
          IF INDEX(RECORD,'ARCHLOG') ^= 0 THEN
            DO
              DATEX = INDEX(RECORD,'.')
              DATEX = DATEX - 2
              DATE = SUBSTR(RECORD,DATEX,6)
              L = LENGTH(RECORD)
              DSNX = INDEX(RECORD,'DSN=')
              DSNX = DSNX + 4
              DSNZ = (L-DSNX) + 1
              DSN  = SUBSTR(RECORD,DSNX,DSNZ)
              YY   = SUBSTR(DATE,1,2)
              DDD  = SUBSTR(DATE,4,3)
              IDATE  = YY××DDD
              IF IDATE < DAY THEN
              ISPEXEC 'TBADD BSDSTBL'
              SAY 'ADDED DSN='DSN
            END
          ELSE NOP
        END
      ELSE DONE = 'YES'
    END
    "EXECIO 0 DISKR SYSPRINT(FINIS"

/*========================================================*/
/* CHECK WHICH IF JOB GETS SUBMITTED                      */
/*========================================================*/
    ISPEXEC 'TBSTATS BSDSTBL ROWCURR(NUMROWS)'
    IF NUMROWS = 00000000 THEN
      DO
        ADDMSG SSID'MSTR ' SSID'SYS NO-CLEANUP'
        EXIT 0
      END
    ADDMSG SSID'MSTR ' SSID'SYS CLEANUP'

/*========================================================*/
/* BUILD AND SUBMIT JOB                                   */
/*========================================================*/
    IF (SYSAFF = 'MVSP') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'MVSW') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'MVSX') THEN
      DO
        MC = 'V'
      END
    IF (SYSAFF = 'DOFX') THEN
      DO
        MC = 'X'
      END
    IF (SYSAFF = 'DOFD') THEN
      DO
        MC = 'X'
      END
    IF (SYSAFF = 'DOFP') THEN
      DO
        MC = 'X'
      END
    ISPEXEC 'FTOPEN'
    ISPEXEC 'FTINCL BSDSJCL'
    ISPEXEC 'FTCLOSE'
    ISPEXEC 'TBEND BSDSTBL'
    "FREE FILE(SYSPRINT)"
    "ALLOC FILE(SYSPRINT) SYSOUT("MC")"
    TSOEXEC CALL "'" ×× SSID ×× ".DSNLOAD(DSNJU003)'"
    MYRC = RC
    SAY 'DSNJU003 RC='MYRC
    EXIT MYRC
./ ADD NAME=CHCKSSID 0104-92257-93342-0818-00071-00059-00013-LAWCSC
/*===== CHCKSSID: REXX EXEC =======================================*/
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(CHCKSSID)                                */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS REXX EXEC matches db2 subsystems against the mvs      */
/*      system id.                                                 */
/*                                                                 */
/*===== CHCKSSID: REXX EXEC =======================================*/

/*============================================*/
/* Initialization                             */
/*============================================*/
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    PTR2PSA = 0
    CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
    CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
    SYSID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
    ARG DB2ID OTHRJUNK

/*============================================*/
/* If no DB2ID passed set default             */
/*============================================*/
    IF (DB2ID ^= '') THEN signal HAVEID
    DB2ID = XXXX
    IF (SYSID = 'DOFX') THEN DB2ID = DB2X
    IF (SYSID = 'MVSX') THEN DB2ID = DB2M
    IF (SYSID = 'DOFD') THEN DB2ID = DDB2
    IF (SYSID = 'DOFP') THEN DB2ID = PDB2
    IF (SYSID = 'MVSP') THEN DB2ID = D1DB
    IF (SYSID = 'MVSW') THEN DB2ID = D2DB
    IF (SYSID = 'MVSZ') THEN DB2ID = DB2M

/*============================================*/
/* Now check subsystem against system         */
/*============================================*/
HAVEID:
    IF (DB2ID = 'DB2X') then,
       if (SYSID = 'DOFX') THEN SIGNAL ITSGOOD
    IF (DB2ID = 'DB2M') then,
       if (SYSID = 'MVSX') THEN signal ITSGOOD
    IF (DB2ID = 'DSN') then,
       if (SYSID = 'DOFD') THEN signal ITSGOOD
    IF (DB2ID = 'DDB2') then,
       if (SYSID = 'DOFD') THEN signal ITSGOOD
    IF (DB2ID = 'PDB2') then,
       if (SYSID = 'DOFP') THEN signal ITSGOOD
    IF (DB2ID = 'D1DB') then,
       if (SYSID = 'MVSP') THEN signal ITSGOOD
    IF (DB2ID = 'P1DB') then,
       if (SYSID = 'MVSP') THEN signal ITSGOOD
    IF (DB2ID = 'D2DB') then,
       if (SYSID = 'MVSW') THEN signal ITSGOOD
    IF (DB2ID = 'P2DB') then,
       if (SYSID = 'MVSW') THEN signal ITSGOOD
/*  Temporary code for when D2DB runs on MVSP   */
    IF (DB2ID = 'D2DB') then,
       if (SYSID = 'MVSP') THEN signal ITSGOOD
/****  for mvs 4.3 testing  ****/
    IF (DB2ID = 'DB2M') then,
       if (SYSID = 'MVSZ') THEN signal ITSGOOD

/*============================================*/
/* Bummer, no match                           */
/*============================================*/
    EXIT 16

/*============================================*/
/* Got here it is a good match                */
/*============================================*/
ITSGOOD:
    EXIT 0
./ ADD NAME=CNTL     0103-93134-93134-2307-00016-00017-00000-KETCSC
/*  EDIT CNTL FOR CLIENT DSN USING REXX */
/* LIB: XDBS.TSOISPF.EXEC(EDDSN)     */
ADDRESS ISPEXEC 'CONTROL ERRORS RETURN'
ARG SSID CODE
IF SSID = '' THEN,
  DO
    SAY 'Syntax is CNTL ssid agency-code'
    exit 4
  end
IF CODE = '' THEN,
  DO
    SAY 'Syntax is CNTL' ssid 'agency-code'
    exit 4
  end
ADDRESS ISPEXEC 'EDIT DATASET(''XDBS.'SSID'.'CODE'.CNTL'')'
EXIT
./ ADD NAME=CSCINDEX 0101-93194-93194-2238-00012-00012-00001-KETCSC
/*---------REXX CSCINDEX -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(CSCINDEX)          */
/* GDE: KETCSC                                */
/* DOC: THIS REXX EXEC INVOKES EDIT AND USES THE INDEX  */
/*      MACRO TO SEND PROFS NOTES.                      */
/*                                                      */
/*---------REXX CSCINDEX -------------------------------*/
    PARSE ARG DATASET
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISPEXEC "EDIT DATASET('"DATASET"') MACRO(INDEX)"
    EXIT RC
./ ADD NAME=CSCINDXW 0101-93323-93323-0743-00012-00012-00005-KETCSC
/*---------REXX CSCINDXW -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(CSCINDXW)                     */
/* GDE: KETCSC                                          */
/* DOC: THIS REXX EXEC INVOKES EDIT AND USES THE INDXW  */
/*      MACRO TO SEND PROFS NOTES.                      */
/*                                                      */
/*---------REXX CSCINDXW -------------------------------*/
    PARSE ARG DATASET
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISPEXEC "EDIT DATASET('"DATASET"') MACRO(INDXW)"
    EXIT RC
./ ADD NAME=CSCYREND 0100-94005-94005-1558-00023-00023-00000-KETCSC
/*============== VMMSGIT - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(VMMSGIT)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC READS A MSG FILE AND SENDS MESSAGES TO THE        */
/*      DESIGNATED IDS.                                             */
/*                                                                  */
/*============== VMMSGIT - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    ARG SSID
    SAY 'RUN ON ' DATE() ' AT ' TIME() 'FOR SSID' SSID '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    MSGSTAT = MSG(OFF)
    ADDRESS TSO "ALLOC FILE(VMMSG) SHR",
        "DATASET('XDBS.PARMLIB(CSCYREND)'"
    "TRANSMIT DB2GRP MSGDDNAME(VMMSG) NONOTIFY NOLOG"
    XMITRC = RC
    EXIT XMITRC
./ ADD NAME=CUT
/* REXX ***************************************************************/
/***                                                                  */
/*** ISPF/PDF edit macro to write lines from a file to the user       */
/*** PROFILE pool for later inclusion by the PASTE macro.             */
/***                                                                  */
/*** To run:                                                          */
/***  Enter CUT on the COMMAND line and use the C or M line commands  */
/***  (in any form) to select the lines to be cut.                    */
/***                                                                  */
/***  If the M line command is used, the lines will be deleted.       */
/***                                                                  */
/***  A parameter of R or REPLACE can be specified to replace any     */
/***  previously CUT lines (that have not yet been PASTEd) with the   */
/***  newly selected lines.  Otherwise, the selected lines will be    */
/***  added to any previously CUT lines.                              */
/***                                                                  */
/***  An arbitrary limit of 1000 lines is set in the macro but this   */
/***  can be changed by providing a new limit on the macro call.      */
/***  For example, to process up to 2000 lines enter CUT 2000 on the  */
/***  COMMAND line.  Be aware that each line gets stored in your      */
/***  PROFILE.                                                        */
/***                                                                  */
/**********************************************************************/
Trace
Address ISPEXEC
'ISREDIT MACRO (PARM1) NOPROCESS'
parm1 = translate(parm1)
If parm1 = '?' Then
  Do
    Call help
    Exit
  End

If parm1 ^= ' ' & parm1 ^= 'R' & parm1 ^= 'REPLACE' Then
  Do
    If datatype(parm1,w) = 1 & parm1 > 0 Then
      Do
        /* set new limit for maximum number of lines cut to profile */
        cutlimit = parm1
        'VPUT (CUTLIMIT) PROFILE'
      End
    Else
      Do
        zedsmsg = 'Invalid parameter'
        msg = 'Use a whole number > 0, ? for help,'
        zedlmsg = msg 'R or REPLACE to replace previous lines'
        'SETMSG MSG(ISRZ001)'
        Exit 12
      End
  End

/* Process line commands, check if C or M was specified              */
'ISREDIT PROCESS RANGE C M'
Select
  When rc = 0 Then
    Do
      'ISREDIT (CMD) = RANGE_CMD'          /* Get the command        */
      'ISREDIT (LINE1) = LINENUM .ZFRANGE' /* Get first line in range*/
      'ISREDIT (LINE2) = LINENUM .ZLRANGE' /* Get last line in range */
      linestocut = line2 - line1 + 1
    End
  When rc <= 4 Then /* No C or M entered */
    Do
      zedsmsg = 'Enter "C"/"M" line cmd'
      zedlmsg = 'CUT requires a "C" or "M" line command'
      'SETMSG MSG(ISRZ001)'
      Exit 12
    End
  Otherwise  /* Line command conflict - Edit will create message*/
    Exit 12
End

/* Get the number of lines that have been cut but not pasted,        */
/* initialize to zero if first time.                                 */
'VGET (CUTCNTMX) PROFILE'
If rc ^= 0 Then
  cutcntmx = 0

/* Get the maximum number of lines to be stored in the profile,      */
/* initialize to 1000 if first time.                                 */
'VGET (CUTLIMIT) PROFILE'
If rc ^= 0 Then
  Do
    cutlimit = 1000
    'VPUT (CUTLIMIT) PROFILE'
  End

If parm1 = 'R' × parm1 = 'REPLACE' Then
  Do
    If linestocut < cutcntmx Then
      Do
        /* delete variables that will not be overwritten */
        'VGET (ZENVIR) SHARED'
        Do i = 1 to cutcntmx by 1
          'VERASE (CL'i') PROFILE'
        End
      End
    cutcntmx = 0
  End
cutcntmxsave = cutcntmx
/* Check to see if the limit will be exceeded by storing the lines   */
/* into the profile.                                                 */
count = cutcntmx + linestocut
If count > cutlimit Then
  Do
    zedsmsg = '> 'cutlimit 'lines to cut'
    zedlmsg = 'Reduce the range or change limit with CUT 'count
    'SETMSG MSG(ISRZ001)'
    Exit 12
  End


/* cut the lines to the profile */
cutcnt = cutcntmx
Do i = line1 to line2
  cutcnt = cutcnt + 1
  'ISREDIT (CL'cutcnt') = LINE' i

  Interpret "CL"cutcnt"= Strip(CL"cutcnt",'T')"

  'VPUT (CL'cutcnt') PROFILE'
End


/* Put the number of lines cut into the profile for use by PASTE     */
'VPUT (CUTCNT) PROFILE'

/* If the number of lines cut this time is greater than the maximum  */
/* cut, then save the new maximum.  PASTE will set this variable to  */
/* zero if it deletes the variables.                                 */
If cutcnt > cutcntmx Then
  Do
    cutcntmx = cutcnt
    'VPUT (CUTCNTMX) PROFILE'
  End

If cmd = 'M' Then
  Do
    'ISREDIT DELETE 'line1 line2
    If cutcntmxsave = 0 Then
      Do
        zedsmsg = linestocut 'lines cut and deleted'
        msg = 'lines were cut and deleted from the current file'
        zedlmsg = linestocut msg
      End
    Else
      Do
        zedsmsg = linestocut 'lines cut and deleted'
        msg ='A total of 'cutcntmx' lines have been cut'
        zedlmsg = msg '- last 'linestocut' were deleted'
      End
    'SETMSG MSG(ISRZ000)'
  End
Else
  Do
    If cutcntmxsave = 0 Then
      Do
        zedsmsg = linestocut 'lines cut'
        zedlmsg = linestocut 'lines were cut from the current file'
      End
    Else
      Do
        zedsmsg = linestocut' lines plus 'cutcntmxsave 'lines cut'
        zedlmsg ='A total of 'cutcntmx' lines have been cut'
      End
    'SETMSG MSG(ISRZ000)'
  End

Exit

help:
Say '                                                                '
Say ' ISPF/PDF edit macro to write lines from a file to the user     '
Say ' PROFILE pool for later inclusion by the PASTE macro.           '
Say '                                                                '
Say ' To run:                                                        '
Say '  Enter CUT on the COMMAND line and use the C or M line commands'
Say '  (in any form) to select the lines to be cut.                  '
Say '                                                                '
Say '  If the M line command is used, the lines will be deleted.     '
Say '                                                                '
Say '  A parameter of R or REPLACE can be specified to replace any   '
Say '  previously CUT lines (that have not yet been PASTEd) with the '
Say '  newly selected lines.  Otherwise, the selected lines will be  '
Say '  added to any previously CUT lines.                            '
Say '                                                                '
Say '  An arbitrary limit of 1000 lines is set in the macro but this '
Say '  can be changed by providing a new limit on the macro call.    '
Say '  For example, to process up to 2000 lines enter CUT 2000 on the'
Say '  COMMAND line.  Be aware that each line gets stored in your    '
Say '  PROFILE.                                                      '
Say '                                                                '
Return
./ ADD NAME=DB2JOB   0100-92108-92108-0827-00009-00009-00000-DMV0016
/*      REXX                                                       */
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(DB2JOB)                                  */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS REXX EXEC INVOKES THE ISPF EDITOR                     */
/*                                                                 */
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISPEXEC "EDIT DATASET('XDBS.JCLLIB')"
    EXIT RC
./ ADD NAME=DOFTEMP  0100-93318-93318-1402-00040-00040-00000-DD20008
/*-------------------------------------------------------------------*/
/*  DOF Enhancement - add XDBS.TSOISPF                               */
/*-------------------------------------------------------------------*/
DOFBEGIN:
    IF PANEL = "" THEN ,
      PNL = PANEL(ISP@MSTR)
    ALLOC FI(XDBSPRC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/ ",
                             'XDBS.TSOISPF.CLIST')    /* DB2 GROUP*/ ",
          REUSE
    CONCAT (SYSPROC,XDBSPRC)
    CONTROL MSG
    ERROR EXIT
    ALLOC FI(XDBSMLB) SHR DA('XDBS.TSOISPF.MSGS')     /* DB2 GROUP*/ ",
          REUSE
    CONCAT (ISPMLIB,XDBSMLB)
    ALLOC FI(XDBSPLB) SHR DA('XDBS.TSOISPF.PANELS')   /* DB2 GROUP*/ ",
          REUSE
    CONCAT (ISPPLIB,XDBSPLB)
    ALLOC FI(XDBSSLB) SHR DA('XDBS.TSOISPF.SKELS')    /* DB2 GROUP*/ ",
          REUSE
    CONCAT (ISPSLIB,XDBSSLB)
    ALLOC FI(XDBSTLB) SHR DA('XDBS.TSOISPF.TABLES')   /* DB2 GROUP*/ ",
          REUSE
    CONCAT (ISPTLIB,XDBSTLB)
    ERROR RETURN
    SAY "
    SAY "     XDBS Enhanced Version
    SAY "Press ENTER when --*) appears.
    SAY "
    ISPSTART PNL
    SAY "
    SAY "SYSTEMSTR(:)smfid
    SAY "
    SAY "You are now out of ISPF.
    SAY "      OPTIONS are:
    SAY "         %l (to logon as SYSVAR(SYSUID))
    SAY "         %x or logoff (to logoff)
    SAY "         %on (to get back to ispf menu)
    SAY "
    EXIT 0
./ ADD NAME=EDDSN    0102-92227-93113-1440-00017-00017-00000-KETCSC
/*  CURSOR EDIT REXX    */
/* LIB: XDBS.TSOISPF.EXEC(EDDSN)     */
ADDRESS ISPEXEC 'CONTROL ERRORS RETURN'
ADDRESS ISREDIT 'MACRO NOPROCESS'
ADDRESS ISREDIT '(CL,CC) = CURSOR'
IF CC = 0 THEN EXIT
ADDRESS ISREDIT '(DATA) = LINE' CL
IF RC > 0 THEN EXIT
DELIM = "~`!%^&-_=+{}<>,/?" '"'
END = LENGTH(DATA)
START = END - VERIFY(REVERSE(DATA)" ",DELIM,"M",END-CC+1)+2
END = VERIFY(DATA" ",DELIM,"M",CC)-1
IF START > END THEN EXIT
WORD = SUBSTR(DATA,START,END-START+1)
ADDRESS ISPEXEC 'EDIT DATASET('''WORD''')'
IF RC > 0 THEN ADDRESS ISPEXEC 'SETMSG MSG(ZERRMSG)'
EXIT
./ ADD NAME=EN       0102-93194-93204-1126-00055-00055-00002-KETCSC
/*---------REXX EN -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(EN)          */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EDIT MACRO ENFORCES THE $INDEX UPDATE.                 */
/*                                                      */
/*---------REXX EN -------------------------------*/
    ISREDIT MACRO
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISREDIT "(DATASET) = DATASET"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    IF (MEMBER = "$INDEX") THEN SIGNAL ENDIT
    ADDRESS ISREDIT "(CHANGED) = DATA_CHANGED"
    IF (CHANGED = "YES") THEN ,
      DO
        CHKIDX = SYSDSN("'"DATASET"($INDEX)'")
        IF (CHKIDX = "OK") THEN ,
          DO
            CHGMEM = MEMBER
            ADDRESS ISPEXEC "VPUT (CHGMEM)"
            ADDRESS ISPEXEC "EDIT DATASET('"DATASET"($INDEX)')",
              "MACRO(SAVMAC)"
            ADDRESS ISPEXEC "VGET (EXITCC)"
            MYCC = EXITCC
            IF (MYCC = 0) THEN ,
              DO
                ZERRHM = "*"
                ZERRALRM = "NO"
                ZERRSM = "$INDEX HAS IT"
                ZERRLM = "IT IS NICE TO HAVE THE $INDEX"
                ZERRLM = ZERRLM "MEMBER UPDATED ISN'T IT?"
                ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
                  "ZERRHM ZERRALRM) SHARED"
                ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
              END
            IF (MYCC = 4) THEN ,
              DO
                ZERRHM = "*"
                ZERRALRM = "NO"
                ZERRSM = "THANKS"
                ZERRLM = "IT IS NICE TO HAVE YOU"
                ZERRLM = ZERRLM "UPDATE THE $INDEX MEMBER"
                ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
                  "ZERRHM ZERRALRM) SHARED"
                ADDRESS ISPEXEC "SETMSG MSG(ISRZ002"
              END
          END
/*===================================================================*/
/*  SAVE MEMBER                                                      */
/*===================================================================*/
        ADDRESS ISREDIT "SAVE"
      END
ENDIT:
    ADDRESS ISREDIT "END"
    EXIT RC
./ ADD NAME=FOOLSMS  0108-92335-92335-1644-00152-00151-00017-KETCSC
/* REXX                                                               */
/* ****************************************************************** */
/*                                                                    */
/* LIB: REXX(FOOLSMS)                                                 */
/* GDE: KENNETH E. TOMIAK                                             */
/* DOC: USE ISPF SERVICES TO GET A LIST OF DATASETS AND READ EACH.    */
/*                                                                    */
/* ****************************************************************** */
/*  TRACE Result                                                      */
arg uid
if (uid = '') then,
  do
    say 'Must have a userid or can not do a list'
    exit 8
  end
say 'Allocating data sets for' uid
/* ****************************************************************** */
/* Setup ISPF services.                                               */
/* ****************************************************************** */
"ISPEXEC CONTROL ERRORS RETURN";
/* ****************************************************************** */
/* Initialize  a data set list.                                       */
/* ****************************************************************** */
"ISPEXEC LMDINIT LISTID(DSNLIST)",
               "LEVEL("uid")"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    SAY 'LMDINIT DSNLIST RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Obtain the dslist list one entry at a time.                        */
/* ****************************************************************** */
DSNID = ' '
rclist = 0
say 'Dataset volume dsorg last-ref-date'
DO while RCLIST = 0
  "ISPEXEC LMDLIST LISTID("DSNLIST"),
                   OPTION(LIST),
                   DATASET(DSNID),
                   STATS(YES)"
  RCLIST = RC
  IF (RCLIST \= 0) THEN
    do
      "ISPEXEC LMDLIST LISTID(&DSNLIST) OPTION(FREE)"
    end
  else
    do
      say DSNID zdlvol zdldsorg zdlrdate
      SELECT
        WHEN ZDLDSORG = 'PO' THEN
          DO
            ADDRESS ISPEXEC,
             "LMINIT DATAID(DATIDVR)",
             "DATASET('"DSNID"') ENQ(SHR)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                say 'LMINIT failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMOPEN DATAID("DATIDVR") OPTION(INPUT)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                if (zdlrecfm \= 'U') then,
                say 'LMOPEN failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMCLOSE DATAID("DATIDVR")"
            ADDRESS ISPEXEC,
             "LMFREE DATAID(DATIDVR)"
          END
        WHEN ZDLDSORG = 'PS' THEN
          DO
            ADDRESS ISPEXEC,
             "LMINIT DATAID(DATIDVR)",
             "DATASET('"DSNID"') ENQ(SHR)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                say 'LMINIT failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMOPEN DATAID("DATIDVR") OPTION(INPUT)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                if (zdllrecl < 255) then,
                say 'LMOPEN failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMCLOSE DATAID("DATIDVR")"
            ADDRESS ISPEXEC,
             "LMFREE DATAID(DATIDVR)"
          END
        WHEN ZDLDSORG = 'VS' THEN
          DO
            if (zdlrdate \= 'UNKNOWN?') then,
              do
                "VERIFY dataset('"DSNID"')"
                RCTEMP = RC
                IF (RCTEMP \= 0) THEN
                  do
                    say 'Verify failed rc='RCTEMP
                  end
              end
          END
        OTHERWISE
          DO
            ADDRESS ISPEXEC,
             "LMINIT DATAID(DATIDVR)",
             "DATASET('"DSNID"') ENQ(SHR)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                say 'LMINIT failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMOPEN DATAID("DATIDVR") OPTION(INPUT)"
            RCTEMP = RC
            IF (RCTEMP \= 0) THEN
              do
                if (zdllrecl < 255) then,
                say 'LMOPEN failed rc='RCTEMP
              end
            ADDRESS ISPEXEC,
             "LMCLOSE DATAID("DATIDVR")"
            ADDRESS ISPEXEC,
             "LMFREE DATAID(DATIDVR)"
          END
      END
      /* zdlvol    - volume */
      /* zdldev    - device type */
      /* zdldsorg  - dsorg  */
      /* zdlrecfm  - recfm  */
      /* zdllrecl  - lrecl  */
      /* zdlblksz  - blksize */
      /* zdlsize   - size in tracks */
      /* zdlused   - used tracks */
      /* zdlnext   - number of extents */
      /* zdlcdate  - create date */
      /* zdledate  - expiration date */
      /* zdlrdate  - referenced last date */
      /* zdlpages  - pdse pages allocated or blank */
      /* zdldtype  - dsname type pds, library, or blank */
      /* zdlpused  - percent used if pdse or blank */
    end
end
"ISPEXEC LMDFREE DATAID(&DSNLIST)"
EXIT
./ ADD NAME=FRANK    0109-93239-93252-1631-00153-00139-00043-FMMCSC
/*============== BSDS - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(BSDS)                                                  */
/* GDE: FRANKLIN MUNDO                                              */
/* DOC: THIS EXEC READS THE BSDS REPORT DATASET AND CREATES A       */
/*      JOB THAT WILL DELETE ARCHIVE DATASETS OLDER THAN 30 DAYS.   */
/*                                                                  */
/*============== BSDS - REXX EXEC ===============================*/
/* -------------------------------------------------------------- */
/*       ALLOCATE TSO DATASET                                     */
/* -------------------------------------------------------------- */
    "ALLOC FILE(INDD) DATASET('FMMCSC.DATA.PDS') SHR REUSE"
    "ALLOC FILE(FILEOUT) DATASET('XDBS.TEMP.DATASET') MOD CATALOG",
        "SPACE(10,5) DSORG(PS) RECFM(F B) LRECL(133) BLKSIZE(27930)",
        "TRACKS UNIT(SYSALLDA)"
/* -------------------------------------------------------------- */
/*       QUEUE COLUMN NAMES                                       */
/* -------------------------------------------------------------- */
 QUEUE DBNAME TYPE OBJECT_NAME DATE CARD NACTIVE NPAGES NLEAF NLEVELS,
 PART
/* -------------------------------------------------------------- */
/*       WRITE QUEUE TO DISK                                      */
/* -------------------------------------------------------------- */
    "EXECIO * DISKW FILEOUT "
/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
      "EXECIO * DISKR INDD(STEM RECORD."
        DO R = 1 TO RECORD.0 BY 1
          MSGID = WORD(RECORD.R,1)
             IF MSGID = 'DSNU612I' THEN
              DO
                OBJNAME = WORD(RECORD.R,9)
                IX = INDEX(OBJNAME,'.')
                DBNAME = LEFT(OBJNAME,IX-1)
                TNAME = SUBSTR(OBJNAME,IX+1,18)
                PARTITION = WORD(RECORD.R,11)
                R = R + 1
                NACTIVE = WORD(RECORD.R,3)
                TYPE = S
                CARD = 0
                NPAGES  = 0
                NLEAF   = 0
                NLEVELS = 0
                DATE = SUBSTR(DATE('S'),1,4) ×× '-' ×× ,
                       SUBSTR(DATE('S'),5,2) ×× '-' ×× ,
                       SUBSTR(DATE('S'),7,2)
                CALL WRITEIT
                END
             IF MSGID = 'DSNU613I' THEN
              DO
                OBJNAME = WORD(RECORD.R,9)
                IX = INDEX(OBJNAME,'.')
                DBNAME = LEFT(OBJNAME,IX-1)
                TNAME = SUBSTR(OBJNAME,IX+1,18)
                PARTITION = WORD(RECORD.R,11)
                R = R + 1
                CARD = WORD(RECORD.R,3)
                TYPE = T
                NACTIVE = 0
                NPAGES  = 0
                NLEAF   = 0
                NLEVELS = 0
                DATE = SUBSTR(DATE('S'),1,4) ×× '-' ×× ,
                       SUBSTR(DATE('S'),5,2) ×× '-' ×× ,
                       SUBSTR(DATE('S'),7,2)
                CALL WRITEIT
                END
             IF MSGID = 'DSNU614I' THEN
              DO
                OBJNAME = WORD(RECORD.R,9)
                IX = INDEX(OBJNAME,'.')
                DBNAME = LEFT(OBJNAME,IX-1)
                TNAME = SUBSTR(OBJNAME,IX+1,18)
                R = R + 1
                CARD = WORD(RECORD.R,3)
                R = R + 1
                NPAGES = WORD(RECORD.R,3)
                TYPE = T
                PARTITION = 0
                NACTIVE = 0
                NLEAF   = 0
                NLEVELS = 0
                DATE = SUBSTR(DATE('S'),1,4) ×× '-' ×× ,
                       SUBSTR(DATE('S'),5,2) ×× '-' ×× ,
                       SUBSTR(DATE('S'),7,2)
                CALL WRITEIT
                END
             IF MSGID = 'DSNU617I' THEN
              DO
                OBJNAME = WORD(RECORD.R,9)
                IX = INDEX(OBJNAME,'.')
                DBNAME = LEFT(OBJNAME,IX-1)
                TNAME = SUBSTR(OBJNAME,IX+1,18)
                R = R + 5
                NLEAF = WORD(RECORD.R,3)
                R = R + 1
                NLEVELS = WORD(RECORD.R,3)
                TYPE = I
                NACTIVE = 0
                PARTITION = 0
                CARD = 0
                DATE = SUBSTR(DATE('S'),1,4) ×× '-' ×× ,
                       SUBSTR(DATE('S'),5,2) ×× '-' ×× ,
                       SUBSTR(DATE('S'),7,2)
                CALL WRITEIT
                END
             IF MSGID = 'DSNU618I' THEN
              DO
                OBJNAME = WORD(RECORD.R,9)
                IX = INDEX(OBJNAME,'.')
                DBNAME = LEFT(OBJNAME,IX-1)
                TNAME = SUBSTR(OBJNAME,IX+1,18)
                PARTITION = WORD(RECORD.R,11)
                R = R + 1
                CARD = WORD(RECORD.R,3)
                TYPE = I
                NLEVELS = 0
                NPAGES = 0
                NLEAF = 0
                NACTIVE = 0
                DATE = SUBSTR(DATE('S'),1,4) ×× '-' ×× ,
                       SUBSTR(DATE('S'),5,2) ×× '-' ×× ,
                       SUBSTR(DATE('S'),7,2)
                CALL WRITEIT
                END
             END
                EXIT
/*===========================================================*/
/* ROUTINE TO WRITE OUT THE RECORDS.                         */
/*===========================================================*/
 WRITEIT:PROCEDURE EXPOSE DBNAME TYPE TNAME DATE CARD NACTIVE NPAGES,
 NLEAF NLEVELS PARTITION
/* -------------------------------------------------------------- */
/*       QUEUE RECORDS                                            */
/* -------------------------------------------------------------- */
RECORD = COPIES(" ",133)
RECORD = OVERLAY(DBNAME,RECORD,1,8," ")
RECORD = OVERLAY(TYPE,RECORD,9,1," ")
RECORD = OVERLAY(TNAME,RECORD,10,18," ")
RECORD = OVERLAY(DATE,RECORD,30,10," ")
RECORD = OVERLAY(CARD,RECORD,40,4," ")
RECORD = OVERLAY(NACTIVE,RECORD,45,4," ")
RECORD = OVERLAY(NPAGES,RECORD,50,4," ")
RECORD = OVERLAY(NLEAF,RECORD,55,4," ")
RECORD = OVERLAY(NLEVELS,RECORD,60,4," ")
RECORD = OVERLAY(PARTITION,RECORD,65,4," ")
 QUEUE RECORD
/* -------------------------------------------------------------- */
/*       WRITE QUEUE TO DISK                                      */
/* -------------------------------------------------------------- */
    "EXECIO 1 DISKW FILEOUT "
    RETURN
./ ADD NAME=GDDMNEW  0102-92192-93237-1559-00026-00026-00000-FMMCSC
PROC 0
/*                                                                 */
/* LIB: TECHSERV.SYSPROC(GDDMNEW)                                  */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM               */
/* DOC: THIS CLIST ALLOCATES GDDM DATASETS                         */
/*                                                                 */
    CONTROL NOMSG NOLIST NOFLUSH NOCONLIST
/*  CONTROL MSG LIST NOFLUSH CONLIST
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC SUBTASK PROTECT
    ALLOC DA(ADMDECK)  NEW SP(5,1) TRACKS
    ALLOC DA(ADMCDATA) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMCDEF)  NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMCFORM) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMGDF)   NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMGGMAP) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMIMG)   NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMPROJ)  NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMSAVE)  NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMSYMBL) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMIMAGE) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMPRINT) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMDEFS)  NEW DIR(10) SP(5,1) TRACKS
/*  REQUIRED FOR GDDM-IMD
    ALLOC DA(ADMGNADS) NEW DIR(10) SP(5,1) TRACKS
    ALLOC DA(ADMIFMT)  NEW DIR(10) SP(5,1) TRACKS
./ ADD NAME=GETIDS   0102-93274-93274-1025-00018-00019-00002-DD20008
/*-- REXX --- GETIDS - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(GETIDS)                                            */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: FIGURES OUT YOUR TSO ID OR BATCH JOBNAME AND THE SYSTEM      */
/*      YOU ARE RUNNING ON.                                          */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG PANEL
PTR2CVT = STORAGE(10,4)
PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
ADDRESS  ISPEXEC "VPUT (SYSID JOBNAME STEPNAME PROCNAME)"
./ ADD NAME=GETINFO2 0100-93323-93323-1611-00146-00146-00000-KETCSC
/*---------REXX GETINFO -------------------------------*/
/*                                                     */
/* LIB: KETCSC.EXEC(GETINFO)                           */
/* GDE: KETCSC                                         */
/* DOC: THIS REXX EXEC GETS INFORMATION ABOUT THE USER */
/*      FROM THE "LISTUSER" COMMAND AND IPL            */
/*      INFORMATION FROM VARIOUS MVS CONTROL BLOCKS.   */
/*                                                     */
/*---------REXX GETINFO -------------------------------*/
JUNK = "SHOW"
/*----------------------------------------------------------------*/
/* GET SMF SYSTEM ID                                              */
/*----------------------------------------------------------------*/
    PTR2CVT = STORAGE(10,4)
    PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
    SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
    ADDRESS ISPEXEC "VPUT (SYSID) SHARED"
/*----------------------------------------------------------------*/
/* GET WHICH LOGON PROC TSO THINKS IS USED AND USERID IN USE      */
/*----------------------------------------------------------------*/
    SYSUID = SYSVAR(SYSUID)
    TSOPROC = SYSVAR(SYSPROC)
/*----------------------------------------------------------------*/
/* INITIALIZE VARIABLES                                           */
/*----------------------------------------------------------------*/
    RGROUP = ""
    OWNR = "NO ONE"
    PGMR = "NO ONE"
/*------------------------------------------------------------------*/
/* GET RACF INFORMATION.                                            */
/*------------------------------------------------------------------*/
    X = OUTTRAP('NAME.')
    "LISTUSER" SYSUID
    X = OUTTRAP('OFF')

/*----------------------------------------------------------------*/
/* LOOP THROUGH TRAPPED OUTPUT AND FIND THE GROUP= LINES.         */
/* DISPLAY EACH GROUP.                                            */
/*----------------------------------------------------------------*/
    DO I = 1 TO NAME.0 BY 1
      LOC = INDEX(NAME.I,'GROUP=')
      IF LOC > 0 THEN,
        DO
          THISGRP = SUBSTR(NAME.I,LOC+6,8)
          THERE = FIND(RGROUP,THISGRP)
          IF THERE = 0 THEN RGROUP = RGROUP THISGRP
        END
      LOC = INDEX(NAME.I,' OWNER=')
      IF LOC > 0 THEN,
        DO
          THISGRP = SUBSTR(NAME.I,LOC+7,8)
          OWNR = THISGRP
          LOC = INDEX(NAME.I,'NAME=')
          PGMR = SUBSTR(NAME.I,LOC+5,20)
        END
    END
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO CVT FROM PSA                                    */
/*-------------------------------------------------------------------*/
    PTR2PSA = 0
    CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO SMCA, THEN GET SMF SYSTEM ID                    */
/*-------------------------------------------------------------------*/
    CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
    SMFID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
    IF (JUNK = "SHOW") THEN SAY "SMFID="SMFID
/*-------------------------------------------------------------------*/
/* GET JOBNAME, STEP, AND PROCEDURE                                  */
/*-------------------------------------------------------------------*/
    PSATOLD  = STORAGE(21C,4)                      /* POINTER TO TCB */
    PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)    /* POINTER TO TIOT */
    JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
    STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
    PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
    IF (JUNK = "SHOW") THEN,
      SAY "JOB="JOBNAME", STEP="STEPNAME", PROC="PROCNAME
/*-------------------------------------------------------------------*/
/* GET FMID, PRODUCT LEVEL, AND RELEASE                              */
/*-------------------------------------------------------------------*/
    CVTPRODI = STORAGE(D2X(C2D(CVTPTR)+X2D(0E0)-256),8)
    CVTPRODN = STORAGE(D2X(C2D(CVTPTR)+X2D(0D8)-256),8)
    CVTRELNO = STORAGE(D2X(C2D(CVTPTR)+X2D(0FC)-256),4)
    IF (JUNK = "SHOW") THEN,
      SAY "FMID="CVTPRODI", LEVEL="CVTPRODN", RELEASE="CVTRELNO
/*-------------------------------------------------------------------*/
/* GET CPU MODEL                                                     */
/*-------------------------------------------------------------------*/
    CVTMDL   = C2X(STORAGE(D2X(C2D(CVTPTR)+X2D(0FA)-256),2))
    IF (JUNK = "SHOW") THEN,
      SAY "CPU="CVTMDL
/*-------------------------------------------------------------------*/
/* GET IPL ADDRESS                                                   */
/*-------------------------------------------------------------------*/
    CVTSYSAD = STORAGE(D2X(C2D(CVTPTR)+X2D(030)),4)
    UCBVOLI  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(01C)),6)
    UCBNAME  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(0D)),3)
    IF (JUNK = "SHOW") THEN,
      SAY "SYSRES="UCBVOLI", UCB="UCBNAME
/*-------------------------------------------------------------------*/
/* GET IPL PARAMETERS                                                */
/*-------------------------------------------------------------------*/
    CVTEXT2  = STORAGE(D2X(C2D(CVTPTR)+X2D(148)),4)
    CVTIOCID = STORAGE(D2X(C2D(CVTEXT2)+X2D(06)),2)
    CVTNUCLS = STORAGE(D2X(C2D(CVTEXT2)+X2D(04)),2)
    IF (JUNK = "SHOW") THEN,
      SAY "IO CONFIG="CVTIOCID", NUCLEUS="CVTNUCLS
/*-------------------------------------------------------------------*/
/* GET IPL DATE AND TIME                                             */
/*-------------------------------------------------------------------*/
    CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
    SMCADATE = C2X(STORAGE(D2X(C2D(CVTSMCA)+340),4))
    IPLYY    = SUBSTR(SMCADATE,3,2)
    IPLDDD   = SUBSTR(SMCADATE,5,3)
    SMCATIME = C2D(STORAGE(D2X(C2D(CVTSMCA)+336),4))
    TEMPHR   = SMCATIME / 360000
    IPLHR    = TRUNC(TEMPHR,0)
    TEMPTIME = SMCATIME - (IPLHR * 360000)
    IF (IPLHR < 10) THEN IPLHR = "0"IPLHR
    TEMPMN   = TEMPTIME / 6000
    IPLMN    = TRUNC(TEMPMN,0)
    TEMPTIME = TEMPTIME - (IPLMN * 6000)
    IF (IPLMN < 10) THEN IPLMN = "0"IPLMN
    TEMPSC   = TEMPTIME / 100
    IPLSC    = TRUNC(TEMPSC,0)
    TEMPTIME = TEMPTIME - (IPLSC * 100)
    IF (IPLSC < 10) THEN IPLSC = "0"IPLSC
    IF (JUNK = SHOW) THEN,
      SAY "IPL DATE="IPLYY"."IPLDDD", TIME="IPLHR":"IPLMN":"IPLSC
    IPLTIME = IPLHR":"IPLMN":"IPLSC
/*------------------------------------------------------------------*/
/* BUILD TABLE OF DESCRIPTIVE DAY                                   */
/*------------------------------------------------------------------*/
    DAY.1 = MONDAY
    DAY.2 = TUESDAY
    DAY.3 = WEDNESDAY
    DAY.4 = THURSDAY
    DAY.5 = FRIDAY
    DAY.6 = SATURDAY
    DAY.7 = SUNDAY
    MENUGRP = "TECH"
    ADDRESS ISPEXEC "VPUT (TSOPROC) PROFILE"
    ADDRESS ISPEXEC "VPUT (PGMR OWNR RGROUP)"
    ADDRESS ISPEXEC "VPUT (SYSID IPLTIME IPLVOL TSOPROC)"
    ADDRESS ISPEXEC "VPUT (MENUGRP) PROFILE"
    EXIT 0
./ ADD NAME=IMGMSG   0104-93082-93088-0940-00117-00100-00022-KETCSC
/*============== IMGMSG - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(IMGMSG)                                                */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC READS THE DYNAMIC IMAGE COPY TABLESPACES FILES    */
/*      AND SENDS A NOTE TO WARN PEOPLE.                            */
/*                                                                  */
/*============== IMGMSG - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    ARG SSID
    SAY 'RUN ON ' DATE() ' AT ' TIME() 'FOR SSID' SSID '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'
    XMITRC = 0
    ICTR = 1
    MSG.DB2SYS.ICTR = "TO: "SSID"SYS"
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "TABLESPACES NOT BACKED UP"
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "OWNER    DATABASE TABLESPACE"
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "-------- -------- ----------"
    SCTR = 0

/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR SYSIN"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
        DO
          DONE = 'YES'
          "EXECIO 0 DISKR SYSIN (FINIS"
          IF (MC > 0) THEN
            DO
              SIGNAL WRAPUP
            END
        END
      ELSE
       DO
         PARSE PULL TEXT
         JOBNAME = SUBSTR(TEXT,1,8)
         JOBDATE = SUBSTR(TEXT,9,8)
         JOBBASE = SUBSTR(TEXT,17,8)
         JOBOWNR = SUBSTR(TEXT,25,8)
         JOBSPCE = SUBSTR(TEXT,33,8)
         IF JOBSPCE ^= 'SYSCOPY' THEN
           DO
             SCTR = SCTR + 1
             JOBKEEP = SUBSTR(TEXT,41,3)
             ICTR = ICTR + 1
             MSG.DB2SYS.ICTR = JOBOWNR JOBBASE JOBSPCE
           END
       END
    END
WRAPUP:
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "TOTAL TABLESPACES = " SCTR
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "CC: DB2MGR"
    DO J = ICTR TO 1 BY -1
      TEXTLINE = MSG.DB2SYS.J
      PUSH TEXTLINE
    END
    DO J = 1 TO ICTR BY 1
      TEXTLINE = MSG.DB2SYS.J
      SAY TEXTLINE
    END
    SUBSYS = SSID
    ADDRESS TSO "FREE  FILE(IMSG)"
    ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".IMSG'"
    MSGSTAT = MSG(ON)
    ADDRESS TSO "ALLOC FILE(IMSG) NEW CATALOG",
        "DATASET('XDBS."DB2SYS"."SUBSYS".IMSG')",
        "DIR(0) RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)"
    RCSAVE = RC
    IF (RCSAVE = 0) THEN
      DO
        "EXECIO" ICTR "DISKW IMSG (FINIS"
        "TRANSMIT " SSID"SYS MSGDDNAME(IMSG) NONOTIFY NOLOG"
        XMITRC = RC
        ADDRESS TSO "FREE  FILE(IMSG)"
        ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".IMSG'"
      END
    ELSE
      DO
        SAY "ALLOC FAILED SO NO TXMIT"
        DO K = 1 TO CTR.DB2SYS
          PULL JUNK
          SAY JUNK
        END
        XMITRC = 16
      END
    MSGSTAT = MSG(OFF)

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/
    XMITRC = XMITRC + 0

    EXIT XMITRC
./ ADD NAME=INDEX    0124-93112-94008-2340-00394-00125-00394-KETCSC
/*---------REXX INDEX  --------------------------------------------*/
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(INDEX)                                   */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS exec  USES ISPF LIBRARY SERVICES TO check that        */
/*      All members are in $index.                                 */
/*                                                                 */
/*---------REXX INDEX  --------------------------------------------*/
ISREDIT MACRO
/*                                                                */
/* -------------------------------------------------------------- */
/*       Process parameters and setup error handling              */
/* -------------------------------------------------------------- */
    PARSE ARG DEBUG
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
/* -------------------------------------------------------------- */
/*       Initialize variables                                     */
/* -------------------------------------------------------------- */
    ZERRLM = " "
    TOWHOM = ""
    ARRAYIDX = 0
    ALPHABIT = "@$#ABCDEFGHIJKLMNOPQRSTUVWXYZ"
/* -------------------------------------------------------------- */
/*       Get System SMFID from control blocks                     */
/* -------------------------------------------------------------- */
    PTR2CVT = STORAGE(10,4)
    PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
    sysid = STORAGE(D2X(C2D(PTR2SMF)+16),4)
/* -------------------------------------------------------------- */
/*       Get DSN and member name and shift                        */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "(DATASET) = DATASET"
    If (DATASET = "") then,
      do
        Say "setting DSN"
        DATASET = "KETCSC.TEMP.PDS"
      END
    Say "Checking" DATASET "on" DATE()
    ADDRESS ISREDIT "C '"DATASET"' ' "DATASET"' 3 FIRST"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    If (MEMBER = "") then,
      do
        Say "setting $INDEX"
        MEMBER = "$INDEX"
      END
    ADDRESS ISREDIT "C 'MEMBER' ' MEMBER' 3 FIRST"
/* -------------------------------------------------------------- */
/*       Exclude lines that still not corrected                   */
/* -------------------------------------------------------------- */
AGAIN:
    ADDRESS ISREDIT "X 'OR CHANGED' ALL"
    ADDRESS ISREDIT "X 'FROM 8' ALL"
    ADDRESS ISREDIT "X 'FROM 9' ALL"
    ADDRESS ISREDIT "DEL X ALL"
/* -------------------------------------------------------------- */
/*       Check that this is a PDS                                 */
/* -------------------------------------------------------------- */
    PDSDSN = "'"DATASET"'"
    MYCC = LISTDSI(PDSDSN)
    IF (SYSDSORG ^= "PO") THEN ,
      DO
        Say PDSDSN "is not a PDS, get real, DSORG="SYSDSORG
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Use ISPF to dynamically allocate                         */
/* -------------------------------------------------------------- */
    ADDRESS ISPEXEC "LMINIT DATAID(PDSID)",
      "DATASET("PDSDSN") ENQ(SHR)"
    mycc = RC
    IF (mycc ^= 0) THEN ,
      DO
        Say PDSDSN "is probably in use RC="mycc
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Then open                                                */
/* -------------------------------------------------------------- */
    ADDRESS ISPEXEC "LMOPEN DATAID("PDSID")",
      "OPTION(INPUT)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        Say PDSDSN "failed to open, RC="mycc
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Use ISPF to read member list                             */
/* -------------------------------------------------------------- */
PDSREAD:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID")",
      "OPTION(LIST) MEMBER(PDSMBR) STATS(YES)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        SIGNAL NORMEXIT
      END
    MEMBR = Strip(PDSMBR,T," ")
/* -------------------------------------------------------------- */
/*       Copy ISPF directory statistics into my variables         */
/* -------------------------------------------------------------- */
    MECREAT = ZLCDATE
    MEVM      = ZLVERS"."ZLMOD
    MECHGDT = ZLMDATE
    MECHGTM = ZLMTIME
/* -------------------------------------------------------------- */
/*       Search to see if it is there                             */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "F '"MEMBR"' 3 FIRST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        SIGNAL PDSREAD
      END
/* -------------------------------------------------------------- */
/*       Not there                                                */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "CURSOR = .ZLAST 1"
    ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
    MBREND = LENGTH(MEMBR) + 1
    CHGMEM = MEMBR
/* -------------------------------------------------------------- */
/*       Find closest match                                       */
/* -------------------------------------------------------------- */
PARTNAME:
    MBREND = MBREND - 1
    If (MBREND < 1) THEN SIGNAL NEXTLETR
    CHGMEM = SUBSTR(CHGMEM"       ",1,MBREND)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 LAST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL PARTNAME
/* -------------------------------------------------------------- */
/*       Not there, find next closest letter before               */
/* -------------------------------------------------------------- */
NEXTLETR:
    PLTR = POS(CHGMEM,ALPHABIT)
    If (PLTR < 1) Then,
      DO
        ADDRESS ISREDIT "CURSOR = .ZLAST 1"
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    PLTR = PLTR - 1
    CHGMEM = SUBSTR(ALPHABIT,PLTR,1)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 LAST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL NEXTLETR
/* -------------------------------------------------------------- */
/*       One way or the other add it, maybe at bottom             */
/* -------------------------------------------------------------- */
ADDIT:
    SPACES = Copies(" ",72)
    DASHES = "  "PDSMBR"  "ZLUSER "CREATED" MECREAT
    DASHES = DASHES "OR CHANGED" MECHGDT MECHGTM
    DASHES = SUBSTR(DASHES SPACES,1,72)
    IF (MEPGMR = "DD20002") THEN,
      DASHES = "  "PDSMBR"  Dan Borges chose not to tell us"
    IF (MEPGMR = "BORGY") THEN,
      DASHES = "  "PDSMBR"  Dan Borges chose not to tell us"
    ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
        "'"DASHES"'"
    MYCC = RC
    IF (MYCC > 0) THEN ,
      DO
        SAY DASHES "FAILED INSERT RC="MYCC
      END
/* -------------------------------------------------------------- */
/*       VM userid mapping from MVS tso userids                   */
/* -------------------------------------------------------------- */
    MEPGMR = Strip(ZLUSER,T," ")
    IF (MEPGMR = "PETE") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "CSCSEC") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "IBM4") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "MANN") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "JUNI") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCJFG") THEN    MEPGMR = "JFGCSC"
    IF (MEPGMR = "ACSCPAB") THEN    MEPGMR = "PABCSC"
    IF (MEPGMR = " ") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "") THEN    MEPGMR = "KETCSC"
/* -------------------------------------------------------------- */
/*       Add it to an array by userid                             */
/* -------------------------------------------------------------- */
    THISIDX = WORDPOS(MEPGMR,TOWHOM)
    If (THISIDX < 1) Then,
      DO
        ARRAYIDX = ARRAYIDX + 1
        ARRAY.mepgmr = 0
        TOWHOM = TOWHOM MEPGMR
      END
    idx = ARRAY.mepgmr
    i = idx + 1
    THISPGMR = SUBSTR(ZLUSER"        ",1,8)
    ARRAY.mepgmr.NXTENTRY.i = THISPGMR ":" DATASET"("PDSMBR")" MECHGDT
    ARRAY.mepgmr = i
    SIGNAL PDSREAD
/* -------------------------------------------------------------- */
/*       ABNORMAL EXIT, NO NOTES TO SEND                          */
/* -------------------------------------------------------------- */
ABNEXIT:
    Say "Abnormally exiting and doing a cancel"
    "DELETE 'XDBS."sysid".SENDNOTE'"
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
    ADDRESS ISREDIT "CANCEL"
    EXIT 4
/* -------------------------------------------------------------- */
/*       NORMAL EXIT, SEND NOTES                                  */
/* -------------------------------------------------------------- */
NORMEXIT:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
/* -------------------------------------------------------------- */
/*       Move array to queue, then write it out and send          */
/* -------------------------------------------------------------- */
    THISUSER = 0
NEXTUSER:
    THISUSER = THISUSER + 1
    If (THISUSER > ARRAYIDX) Then SIGNAL EXITZERO
    MEPGMR = WORD(TOWHOM,THISUSER)
/* -------------------------------------------------------------- */
/*       Prolog                                                   */
/* -------------------------------------------------------------- */
    QUEUE " "
    QUEUE "To:  " MEPGMR
    QUEUE "From: Your BOSS"
    QUEUE "Re:   Updating $INDEX in" DATASET
    QUEUE "Date:" DATE()
    QUEUE " "
    QUEUE "Please update " DATASET"($INDEX) today."
    QUEUE "You need to concentrate on:"
    QUEUE " "
/* -------------------------------------------------------------- */
/*       Move array to queue                                      */
/* -------------------------------------------------------------- */
    idx = ARRAY.mepgmr
    Say MEPGMR "has" idx "entries to do."
    Do i = 1 to idx
      QUEUE "    " ARRAY.mepgmr.NXTENTRY.i
      Say ARRAY.mepgmr.NXTENTRY.i
    END
/* -------------------------------------------------------------- */
/*       Epilogue                                                 */
/* -------------------------------------------------------------- */
    QUEUE " "
    QUEUE "     Your Tasks & Standards dictate adhering to the "
    QUEUE "Rules and Regulations of CDCSA and for the DB2 group."
    QUEUE "This includes adding an entry to the $INDEX member of"
    QUEUE DATASET "when new members are created."
    QUEUE " "
    QUEUE "The EN and SAV edit macros were created to help you"
    QUEUE "keep the $INDEX member up to date by checking for"
    QUEUE "the entry and prompting for a description if the entry"
    QUEUE "is not there."
    QUEUE " "
    QUEUE "Thank you."
    QUEUE "cc: KETCSC"
    QUEUE ""
/* -------------------------------------------------------------- */
/*       Allocate TSO dataset                                     */
/* -------------------------------------------------------------- */
    trapping = OUTTRAP(nomsgs.)
    "DELETE 'XDBS."sysid".SENDNOTE'"
    "FREE FILE(SENDNOTE)"
    "ALLOC FILE(SENDNOTE) DATASET('XDBS."sysid".SENDNOTE') NEW CATALOG",
        "SPACE(10,5) DSORG(PS) RECFM(F B) LRECL(80) BLKSIZE(3120)",
        "TRACKS UNIT(SYSALLDA)"
    trapping = OUTTRAP(OFF)
/* -------------------------------------------------------------- */
/*       Write queue to disk                                      */
/* -------------------------------------------------------------- */
    "EXECIO * DISKW SENDNOTE (FINIS"
/* -------------------------------------------------------------- */
/*       VM userid mapping from MVS tso userids                   */
/* -------------------------------------------------------------- */
    IF (MEPGMR = "PETE") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "CSCSEC") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "IBM4") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "MANN") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "JUNI") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCJFG") THEN    MEPGMR = "JFGCSC"
    IF (MEPGMR = "ACSCPAB") THEN    MEPGMR = "PABCSC"
    IF (MEPGMR = " ") THEN ,
        MEPGMR = "KETCSC"
    IF (MEPGMR = "") THEN ,
        MEPGMR = "KETCSC"
/* -------------------------------------------------------------- */
/*       Transmit message dataset to vm id                        */
/* -------------------------------------------------------------- */
    IF (MEPGMR ^= "DD20010") THEN ,
      do
        IF (MEPGMR ^= "DB2CSC") THEN ,
          do
          "TRANSMIT CSCVM."MEPGMR" MSGDATASET('XDBS."sysid".SENDNOTE')",
              "NOLOG NOPROLOG",
              "NOEPILOG NONOTIFY SEQUENTIAL"
          end
      end
    IF (MEPGMR = "DD20010") THEN ,
      do
        "TRANSMIT CSCVM.FSGCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.MJLCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.FMMCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.PXSCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.LAWCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
      end
    IF (MEPGMR = "DB2CSC") THEN ,
      do
        "TRANSMIT CSCVM.FSGCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.MJLCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.FMMCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.PXSCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.LAWCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
      end
    If (MEPGMR ^= "KETCSC") Then,
    "TRANSMIT CSCVM.KETCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
      "NOLOG NOPROLOG",
      "NOEPILOG NONOTIFY SEQUENTIAL"
    SIGNAL NEXTUSER
/* -------------------------------------------------------------- */
/*       Exit exec                                                */
/* -------------------------------------------------------------- */
/*                                                                 */
EXITZERO:
    "DELETE 'XDBS."sysid".SENDNOTE'"
    If (ARRAYIDX > 0) then,
      ADDRESS ISREDIT "SAVE"
    ADDRESS ISREDIT "END"
    EXIT 0
./ ADD NAME=INDEX$   0108-93190-94008-2341-00278-00263-00259-KETCSC
/*---------REXX INDEX$ -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(INDEX$)  */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST USES ISPF LIBRARY SERVICES TO BUILD A TABLE     */
/*      AND ALLOWS COMMAND PROCESSING FROM THERE.                  */
/*                                                      */
/*---------REXX INDEX$ -------------------------------*/
ISREDIT MACRO
/*                                                                 */
PARSE ARG DEBUG
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ZERRLM = " "
AGAIN:
    ADDRESS ISREDIT "X 'OR CHANGED' ALL"
    ADDRESS ISREDIT "X 'FROM 8' ALL"
    ADDRESS ISREDIT "X 'FROM 9' ALL"
    ADDRESS ISREDIT "DEL X ALL"
    ADDRESS ISREDIT "(DATASET) = DATASET"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    PDSDSN = "'"DATASET"'"
    MYCC = LISTDSI(PDSDSN)
    IF (SYSDSORG ^= "PO") THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE NOT A PDS"
          ZERRLM = "THE FILE" PDSDSN "IS NOT A PDS"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
    TITLE     = CENTER(CTRAREA,80," ")
    IF (DEBUG = "DEBUG") THEN ,
      DO
          PROGMSG1 =  "CHECKING"
          PROGMSG2 =  " "
          PROGMSG3 =  "MEMBER LIST :" PDSDSN
          PROGMSG4 =  " "
          PROGMSG5 =  " "
        ADDRESS ISPEXEC "CONTROL DISPLAY LOCK"
        ADDRESS ISPEXEC "DISPLAY PANEL(PROGRESS)"
      END
      PDSDSN = PDSDSN
    ADDRESS ISPEXEC "LMINIT DATAID(PDSID)",
      "DATASET("PDSDSN") ENQ(SHR)"
    IF (RC ^= 0) THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE IN USE"
          ZERRLM = "THE FILE" PDSDSN "IS IN USE"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
    ADDRESS ISPEXEC "LMOPEN DATAID("PDSID")",
      "OPTION(INPUT)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE FAILED TO OPEN"
          ZERRLM = "THE FILE" PDSDSN "FAILED TO"
          ZERRLM = ZERRLM "OPEN RC="MYCC
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
        MYCTR = 0
PDSREAD:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID")",
      "OPTION(LIST) MEMBER(PDSMBR) STATS(YES)"
      MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
        ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
        ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
        SIGNAL DISPLAY
      END
      MECMD =  " "
      MEMBR     = PDSMBR
      MEPGMR = ZLUSER
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PETE"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCPAB") THEN    MEPGMR = "PABCSC"
    IF (MEPGMR = "DD20010") THEN ,
        MEPGMR = "PETE ACSCFSG MJLCSC LAWCSC FMMCSC"
    IF (MEPGMR = "DB2CSC") THEN ,
        MEPGMR = "PETE ACSCFSG MJLCSC LAWCSC FMMCSC"
    IF (MEPGMR = " ") THEN ,
        MEPGMR = "KETCSC"
      MECREAT = ZLCDATE
      MEVM      = ZLVERS"."ZLMOD
      MECHGDT = ZLMDATE
      MECHGTM = ZLMTIME
    ADDRESS ISREDIT "F '"PDSMBR"' 3 FIRST"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        SIGNAL PDSREAD
      END
      CHGMEM = SUBSTR(PDSMBR"        ",1,8)
    ADDRESS ISREDIT "CURSOR = .ZLAST 1"
    ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
    ADDRESS ISREDIT "CURSOR = .ZFIRST 1"
      CHGMEM = SUBSTR(CHGMEM"       ",1,7)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,6)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,5)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,4)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,3)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,2)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      CHGMEM = SUBSTR(CHGMEM"       ",1,1)
    ADDRESS ISREDIT "F '"CHGMEM"' 3"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
      ALPHABIT = "@$#ABCDEFGHIJKLMNOPQRSTUVWXYZ"
ADDIT:
    IF (MEPGMR = "KETCSC") THEN ,
      DO
          MEMBER = PDSMBR
        ADDRESS ISREDIT EDIT MEMBER
        ADDRESS ISPEXEC "DISPLAY PANEL(SAVPNL)"
          MYCC = RC
        IF (MYCC ^= 0) THEN ,
          DO
              ZERRHM = "*"
              ZERRALRM = "YES"
              ZERRSM = "$INDEX REQUIRED"
              ZERRLM = "YOU MUST ENTER A DESCRIPTION"
              ZERRLM = ZERRLM "FOR" CHGMEM
            ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
              "ZERRHM ZERRALRM) SHARED"
            ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
            SIGNAL ADDIT
          END
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
          "'  "PDSMBR"  "DESC"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
      DO
       SAY DASHES "FAILED INSERT RC="MYCC
      END
          DASHES = "  -------- "
          DASHES = DASHES "------------------------"
          DASHES = DASHES"------------------------"
          DASHES = DASHES"------------------------"
          DASHES = SUBSTR(DASHES"------------------------",1,72)
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
            "'"DASHES"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
          DO
       SAY DASHES "FAILED INSERT RC="MYCC
          END
      END
    ELSE,
      DO
        ADDRESS TSO,
 "SEND 'ADDING" PDSMBR", PLEASE UPDATE" DATASET"($INDEX)' U("MEPGMR"),",
         " LOGON"
        ADDRESS TSO,
 "SEND 'ADDING" PDSMBR", PLEASE UPDATE" DATASET"($INDEX)' U("MEPGMR"),",
          "U(KETCSC)"
          SPACES = "                                          "
          SPACES = SPACES"                                          "
          DASHES = "  "PDSMBR "  "  MEPGMR "CREATED" MECREAT
          DASHES = DASHES "OR CHANGED" MECHGDT MECHGTM
          DASHES = SUBSTR(DASHES SPACES,1,72)
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
            "'"DASHES"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
      DO
       SAY DASHES "FAILED INSERT RC="MYCC
      END
          DASHES = "  -------- "
          DASHES = DASHES "------------------------"
          DASHES = DASHES"------------------------"
          DASHES = DASHES"------------------------"
          DASHES = SUBSTR(DASHES"------------------------",1,72)
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
            "'"DASHES"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
          DO
       SAY DASHES "FAILED INSERT RC="MYCC
          END
      END
      MYCTR = MYCTR + 1
    SIGNAL PDSREAD
ABNEXIT:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
    IF (ZERRLM ^= " ") THEN EXIT 4
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
      ZERRSM = "ADDED" MYCTR
      ZERRLM = "I HAD TO ADD" MYCTR "ENTRIES"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
    EXIT 4
/* -------------------------------------------------------------- */
/*       DISPLAY TABLE                                            */
/* -------------------------------------------------------------- */
DISPLAY:
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
      ZERRSM = "ADDED" MYCTR
      ZERRLM = "I HAD TO ADD" MYCTR "ENTRIES"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"     /* SIGNAL MSGID      */
/*                                                                 */
    EXIT 0
./ ADD NAME=INDEXMAC 0103-93205-93205-1224-00073-00051-00026-KETCSC
/*---------REXX INDEXMAC -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(INDEXMAC)        */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EDIT MACRO PROMPTS FOR THE DESCRIPTION AND DOES THE    */
/*      INSERT AS BEST IT CAN.                                      */
/*                                                      */
/*---------REXX INDEXMAC -------------------------------*/
    ISREDIT MACRO
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISREDIT "(DATASET) = DATASET"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    EXITCC = 0
    IF (MEMBER = "$INDEX") THEN,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "THIS IS $INDEX"
        ZERRLM = "$INDEX SHOULD ALWAYS HAVE ITS OWN ENTRY"
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
          "ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ENDIT
      END
    CHKIDX = SYSDSN("'"DATASET"($INDEX)'")
    IF (CHKIDX ^= "OK") THEN ,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "NO $INDEX TO UPDATE"
        ZERRLM = "THIS PDS OR DATASET DOES NOT HAVE A"
        ZERRLM = ZERRLM "$INDEX MEMBER TO UPDATE."
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
          "ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ENDIT
      END
    IF (CHKIDX = "OK") THEN ,
      DO
        CHGMEM = MEMBER
        ADDRESS ISPEXEC "VPUT (CHGMEM)"
        ADDRESS ISPEXEC "EDIT DATASET('"DATASET"($INDEX)')",
          "MACRO(SAVMAC)"
        ADDRESS ISPEXEC "VGET (EXITCC)"
        MYCC = EXITCC
        IF (MYCC = 0) THEN ,
          DO
            ZERRHM = "*"
            ZERRALRM = "NO"
            ZERRSM = "$INDEX HAS IT"
            ZERRLM = "IT IS NICE TO HAVE THE $INDEX"
            ZERRLM = ZERRLM "MEMBER UPDATED ISN'T IT?"
            ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
              "ZERRHM ZERRALRM) SHARED"
            ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
          END
        IF (MYCC = 4) THEN ,
          DO
            ZERRHM = "*"
            ZERRALRM = "NO"
            ZERRSM = "THANKS"
            ZERRLM = "IT IS NICE TO HAVE YOU"
            ZERRLM = ZERRLM "UPDATE THE $INDEX MEMBER"
            ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
              "ZERRHM ZERRALRM) SHARED"
            ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
          END
      END
/*===================================================================*/
/*  EXIT EDIT MACRO                                                  */
/*===================================================================*/
ENDIT:
    EXIT EXITCC
./ ADD NAME=INDXW    0102-93323-94008-2342-00387-00393-00006-KETCSC
/*---------REXX INDXW  --------------------------------------------*/
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(INDXW)                                   */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS exec  USES ISPF LIBRARY SERVICES TO check that        */
/*      All members are in $index.                                 */
/*                                                                 */
/*---------REXX INDXW  --------------------------------------------*/
ISREDIT MACRO
/*                                                                */
/* -------------------------------------------------------------- */
/*       Process parameters and setup error handling              */
/* -------------------------------------------------------------- */
    PARSE ARG DEBUG
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
/* -------------------------------------------------------------- */
/*       Initialize variables                                     */
/* -------------------------------------------------------------- */
    ZERRLM = " "
    TOWHOM = ""
    ARRAYIDX = 0
    ALPHABIT = "@$#ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
/* -------------------------------------------------------------- */
/*       Get System SMFID from control blocks                     */
/* -------------------------------------------------------------- */
    PTR2CVT = STORAGE(10,4)
    PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
    sysid = STORAGE(D2X(C2D(PTR2SMF)+16),4)
/* -------------------------------------------------------------- */
/*       Get DSN and member name and shift                        */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "(DATASET) = DATASET"
    If (DATASET = "") then,
      do
        Say "setting DSN"
        DATASET = "KETCSC.TEMP.PDS"
      END
    Say "Checking" DATASET "on" DATE()
    ADDRESS ISREDIT "C '"DATASET"' ' "DATASET"' 3 FIRST"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    If (MEMBER = "") then,
      do
        Say "setting $INDEX"
        MEMBER = "$INDEX"
      END
    ADDRESS ISREDIT "C 'MEMBER' ' MEMBER' 3 FIRST"
/* -------------------------------------------------------------- */
/*       Exclude lines that still not corrected                   */
/* -------------------------------------------------------------- */
AGAIN:
    ADDRESS ISREDIT "X 'OR CHANGED' ALL"
    ADDRESS ISREDIT "X 'FROM 8' ALL"
    ADDRESS ISREDIT "X 'FROM 9' ALL"
    ADDRESS ISREDIT "DEL X ALL"
/* -------------------------------------------------------------- */
/*       Check that this is a PDS                                 */
/* -------------------------------------------------------------- */
    PDSDSN = "'"DATASET"'"
    MYCC = LISTDSI(PDSDSN)
    IF (SYSDSORG ^= "PO") THEN ,
      DO
        Say PDSDSN "is not a PDS, get real, DSORG="SYSDSORG
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Use ISPF to dynamically allocate                         */
/* -------------------------------------------------------------- */
    ADDRESS ISPEXEC "LMINIT DATAID(PDSID)",
      "DATASET("PDSDSN") ENQ(SHR)"
    mycc = RC
    IF (mycc ^= 0) THEN ,
      DO
        Say PDSDSN "is probably in use RC="mycc
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Then open                                                */
/* -------------------------------------------------------------- */
    ADDRESS ISPEXEC "LMOPEN DATAID("PDSID")",
      "OPTION(INPUT)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        Say PDSDSN "failed to open, RC="mycc
        SIGNAL ABNEXIT
      END
/* -------------------------------------------------------------- */
/*       Use ISPF to read member list                             */
/* -------------------------------------------------------------- */
PDSREAD:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID")",
      "OPTION(LIST) MEMBER(PDSMBR) STATS(YES)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        SIGNAL NORMEXIT
      END
    MEMBR = Strip(PDSMBR,T," ")
/* -------------------------------------------------------------- */
/*       Copy ISPF directory statistics into my variables         */
/* -------------------------------------------------------------- */
    MECREAT = ZLCDATE
    MEVM      = ZLVERS"."ZLMOD
    MECHGDT = ZLMDATE
    MECHGTM = ZLMTIME
/* -------------------------------------------------------------- */
/*       Search to see if it is there                             */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "F '"MEMBR"' 3 FIRST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        SIGNAL PDSREAD
      END
/* -------------------------------------------------------------- */
/*       Not there                                                */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "CURSOR = .ZLAST 1"
    ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
    MBREND = LENGTH(MEMBR) + 1
    CHGMEM = MEMBR
/* -------------------------------------------------------------- */
/*       Find closest match                                       */
/* -------------------------------------------------------------- */
PARTNAME:
    MBREND = MBREND - 1
    If (MBREND < 1) THEN SIGNAL NEXTLETR
    CHGMEM = SUBSTR(CHGMEM"       ",1,MBREND)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 LAST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL PARTNAME
/* -------------------------------------------------------------- */
/*       Not there, find next closest letter before               */
/* -------------------------------------------------------------- */
NEXTLETR:
    PLTR = POS(CHGMEM,ALPHABIT)
    If (PLTR < 1) Then,
      DO
        ADDRESS ISREDIT "CURSOR = .ZLAST 1"
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    PLTR = PLTR - 1
    CHGMEM = SUBSTR(ALPHABIT,PLTR,1)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 LAST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL NEXTLETR
/* -------------------------------------------------------------- */
/*       One way or the other add it, maybe at bottom             */
/* -------------------------------------------------------------- */
ADDIT:
    SPACES = Copies(" ",72)
    DASHES = "  "PDSMBR"  "ZLUSER "CREATED" MECREAT
    DASHES = DASHES "OR CHANGED" MECHGDT MECHGTM
    DASHES = SUBSTR(DASHES SPACES,1,72)
    IF (MEPGMR = "DD20002") THEN,
      DASHES = "  "PDSMBR"  Dan Borges chose not to tell us"
    IF (MEPGMR = "BORGY") THEN,
      DASHES = "  "PDSMBR"  Dan Borges chose not to tell us"
    ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
        "'"DASHES"'"
    MYCC = RC
    IF (MYCC > 0) THEN ,
      DO
        SAY DASHES "FAILED INSERT RC="MYCC
      END
/* -------------------------------------------------------------- */
/*       VM userid mapping from MVS tso userids                   */
/* -------------------------------------------------------------- */
    MEPGMR = Strip(ZLUSER,T," ")
    IF (MEPGMR = "PETE") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "CSCSEC") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "IBM4") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "MANN") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "JUNI") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCJFG") THEN    MEPGMR = "JFGCSC"
    IF (MEPGMR = "ACSCPAB") THEN    MEPGMR = "PABCSC"
    IF (MEPGMR = " ") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "") THEN    MEPGMR = "KETCSC"
/* -------------------------------------------------------------- */
/*       Add it to an array by userid                             */
/* -------------------------------------------------------------- */
    THISIDX = WORDPOS(MEPGMR,TOWHOM)
    If (THISIDX < 1) Then,
      DO
        ARRAYIDX = ARRAYIDX + 1
        ARRAY.mepgmr = 0
        TOWHOM = TOWHOM MEPGMR
      END
    idx = ARRAY.mepgmr
    i = idx + 1
    THISPGMR = SUBSTR(ZLUSER"        ",1,8)
    ARRAY.mepgmr.NXTENTRY.i = THISPGMR ":" DATASET"("PDSMBR")" MECHGDT
    ARRAY.mepgmr = i
    SIGNAL PDSREAD
/* -------------------------------------------------------------- */
/*       ABNORMAL EXIT, NO NOTES TO SEND                          */
/* -------------------------------------------------------------- */
ABNEXIT:
    Say "Abnormally exiting and doing a cancel"
    "DELETE 'XDBS."sysid".SENDNOTE'"
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
    ADDRESS ISREDIT "CANCEL"
    EXIT 4
/* -------------------------------------------------------------- */
/*       NORMAL EXIT, SEND NOTES                                  */
/* -------------------------------------------------------------- */
NORMEXIT:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
/* -------------------------------------------------------------- */
/*       Move array to queue, then write it out and send          */
/* -------------------------------------------------------------- */
    THISUSER = 0
NEXTUSER:
    THISUSER = THISUSER + 1
    If (THISUSER > ARRAYIDX) Then SIGNAL EXITZERO
    MEPGMR = WORD(TOWHOM,THISUSER)
/* -------------------------------------------------------------- */
/*       Prolog                                                   */
/* -------------------------------------------------------------- */
    QUEUE " "
    QUEUE "To:  " MEPGMR
    QUEUE "From: Your BOSS"
    QUEUE "Re:   Updating $INDEX in" DATASET
    QUEUE "Date:" DATE()
    QUEUE " "
    QUEUE "Please update " DATASET"($INDEX) today."
    QUEUE "You need to concentrate on:"
    QUEUE " "
/* -------------------------------------------------------------- */
/*       Move array to queue                                      */
/* -------------------------------------------------------------- */
    idx = ARRAY.mepgmr
    Say MEPGMR "has" idx "entries to do."
    Do i = 1 to idx
      QUEUE "    " ARRAY.mepgmr.NXTENTRY.i
      Say ARRAY.mepgmr.NXTENTRY.i
    END
/* -------------------------------------------------------------- */
/*       Epilogue                                                 */
/* -------------------------------------------------------------- */
    QUEUE " "
    QUEUE "     We seem to have some trouble using EN or SAV to"
    QUEUE "ensure we update $INDEX so this daily reminder is being"
    QUEUE "sent to give you a chance to update $INDEX before the"
    QUEUE "note is sent to Ken. Ken is getting tired of seeing"
    QUEUE "them."
    QUEUE " "
    QUEUE "Check" DATASET"($INDEX)"
    QUEUE " "
    QUEUE "Thank you."
    QUEUE ""
/* -------------------------------------------------------------- */
/*       Allocate TSO dataset                                     */
/* -------------------------------------------------------------- */
    trapping = OUTTRAP(nomsgs.)
    "DELETE 'XDBS."sysid".SENDNOTE'"
    "FREE FILE(SENDNOTE)"
    "ALLOC FILE(SENDNOTE) DATASET('XDBS."sysid".SENDNOTE') NEW CATALOG",
        "SPACE(10,5) DSORG(PS) RECFM(F B) LRECL(80) BLKSIZE(3120)",
        "TRACKS UNIT(SYSALLDA)"
    trapping = OUTTRAP(OFF)
/* -------------------------------------------------------------- */
/*       Write queue to disk                                      */
/* -------------------------------------------------------------- */
    "EXECIO * DISKW SENDNOTE (FINIS"
/* -------------------------------------------------------------- */
/*       VM userid mapping from MVS tso userids                   */
/* -------------------------------------------------------------- */
    IF (MEPGMR = "PETE") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PXSCSC"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "CSCSEC") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "IBM4") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "MANN") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "JUNI") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "FSGCSC"
    IF (MEPGMR = "ACSCJFG") THEN    MEPGMR = "JFGCSC"
    IF (MEPGMR = "ACSCPAB") THEN    MEPGMR = "PABCSC"
    IF (MEPGMR = " ") THEN ,
        MEPGMR = "KETCSC"
    IF (MEPGMR = "") THEN ,
        MEPGMR = "KETCSC"
/* -------------------------------------------------------------- */
/*       Transmit message dataset to vm id                        */
/* -------------------------------------------------------------- */
    IF (MEPGMR ^= "DD20010") THEN ,
      do
        IF (MEPGMR ^= "DB2CSC") THEN ,
          do
          "TRANSMIT CSCVM."MEPGMR" MSGDATASET('XDBS."sysid".SENDNOTE')",
              "NOLOG NOPROLOG",
              "NOEPILOG NONOTIFY SEQUENTIAL"
          end
      end
    IF (MEPGMR = "DD20010") THEN ,
      do
        "TRANSMIT CSCVM.FSGCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.MJLCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.FMMCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.PXSCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.LAWCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
      end
    IF (MEPGMR = "DB2CSC") THEN ,
      do
        "TRANSMIT CSCVM.FSGCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.MJLCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.FMMCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.PXSCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
        "TRANSMIT CSCVM.LAWCSC  MSGDATASET('XDBS."sysid".SENDNOTE')",
          "NOLOG NOPROLOG",
          "NOEPILOG NONOTIFY SEQUENTIAL"
      end
    SIGNAL NEXTUSER
/* -------------------------------------------------------------- */
/*       Exit exec                                                */
/* -------------------------------------------------------------- */
/*                                                                 */
EXITZERO:
    "DELETE 'XDBS."sysid".SENDNOTE'"
    If (ARRAYIDX > 0) then,
      ADDRESS ISREDIT "SAVE"
    ADDRESS ISREDIT "END"
    EXIT 0
./ ADD NAME=INVKCSP  0176-93118-93164-0844-00075-00238-00000-KETCSC
/*=============== INVKCSP - REXX EXEC =============================*/
/*                                                                 */
/* LIB: EXEC(INVKCSP)                                              */
/* GDE: LEIGHTON A. WESTON                                         */
/* DOC: THIS EXEC ALLOCATES LIBRARIES AND INVOKES CSP/370AD        */
/*                                                                 */
/*=============== INVKCSP - REXX EXEC =============================*/

/* TRACE ?R */
MYRC = 0

SYSPROC = SYSVAR(SYSPROC);
SYSUID  = SYSVAR(SYSUID);

IF (SYSPROC = 'D2DBEVL') THEN,
  DO
    CSPNAME = XDBS.CSPX
    SSID = 'DB2M'
  END

IF (SYSPROC = 'DB2PROD') THEN,
  DO
    CSPNAME = CSP.PROD
    SSID = 'P1DB'
  END

MSG_WAS = MSG(OFF)

/*                    INITALIZATION AREA                             */

MSLRW ="USR1MSL"
DSNRW =SYSUID××.USR1MSL
MSLRO1="SAMPMSL"
DSNRO1=CSPNAME××.SAMPMSL
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"

/*    EXECUTION OF CLIST XSPD TO ACCESS CSP ENVIRONMENT            */

"CONTROL ERRORS RETURN"
ADDRESS ISPEXEC
ADDRESS TSO

/*    EXECUTION OF CLIST XSPD TO ACCESS CSP ENVIRONMENT            */
   "USERCSP"
    SAY RC
    IF RC^=12
       THEN SIGNAL ON ERROR
    "CSP370"
/*  "CSPEZE" */
SIGNAL ON ERROR

SIGNAL OFF ERROR

ENDIT:
MSG_WAS = MSG(MSG_WAS)

EXIT MYRC

ERROR:
MY_LINE = SIGL
MY_RC = RC
SIGNAL OFF ERROR
/*                                                                 */
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ZERRHM = '*'                         /*  ISPF HELP PANEL  */
ZERRALRM = 'NO'                      /*  ALARM STATUS     */
ZERRSM = 'SEVERE ERROR'          /*  SHORT MESSAGE    */
ZERRLM = 'LINE' MY_SIGL 'FAILED WITH RC=' MY_RC
"VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
"SETMSG MSG(ISRZ002)"              /* SIGNAL MSGID      */
MYRC = 4
SIGNAL ENDIT
/*                                                                 */
./ ADD NAME=INVKCSPD 0199-92191-93164-0844-00240-00134-00000-KETCSC
/*=============== INVKCSPD - REXX EXEC =============================*/
/*                                                                  */
/* LIB: EXEC(INVKCSPD)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC ALLOCATES LIBRARIES AND INVOKES CSP/AD.           */
/*                                                                  */
/*=============== INVKCSPD - REXX EXEC =============================*/

/*  TRACE ?R */
MYRC = 0

SYSPROC = SYSVAR(SYSPROC);
SYSUID  = SYSVAR(SYSUID);

IF (SYSPROC = 'D2DBEVL') THEN,
  DO
    CSPNAME = CSPT
    SSID = 'DB2M'
/*  CSPNAME = CSP.DEVL */
/*  SSID = 'D1DB' */
  END

IF (SYSPROC = 'DB2PROD') THEN,
  DO
    CSPNAME = CSP.PROD
    SSID = 'P1DB'
  END

MSG_WAS = MSG(OFF)

/*                    INITALIZATION AREA                             */

MSLRW ="USR1MSL"
DSNRW =SYSUID××.USR1MSL
MSLRO1="SAMPMSL"
DSNRO1=CSPNAME××.SAMPMSL
MSLRO2="DCAEMPL"
DSNRO2=CSPNAME××.DCAEMPL
MSLRO3=" "
DSNRO3=" "
MSLRO4=" "
DSNRO4=" "
MSLRO5=" "
DSNRO5=" "
MSLRO6=" "
DSNRO6=" "
NOTYET ="NO"

/*          CALLS PANEL CSP@AD AND PF-KEY ROUTINE                    */

ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ADDRESS ISPEXEC
"VPUT (MSLRW DSNRW MSLRO1 DSNRO1 MSLRO2 DSNRO2)"

ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ADDRESS ISPEXEC

 DO WHILE NOTYET = 'NO'

   "DISPLAY PANEL(CSP@AD)"
    IF RC ^= 8                  /* RC = 8 RETURN FROM A PANEL */
      THEN SIGNAL ON ERROR

     ADDRESS ISPEXEC
     "CONTROL ERRORS RETURN"
     ADDRESS ISPEXEC
     "VGET (MYCMD)"             /* GET THE ZCMD INFORMATION  */

     ADDRESS ISPEXEC
     "CONTROL ERRORS RETURN"
     ADDRESS ISPEXEC
     "VGET (MYKEY)"            /* GET THE .PFKEY INFORMATION */

     THEKEY = Z××MYKEY
     ADDRESS ISPEXEC
     "CONTROL ERRORS RETURN"
     ADDRESS ISPEXEC
     "VGET ("THEKEY") ASIS"    /* GET THE PFKEY ENTER       */

     THEKEY = Z××MYKEY
     IF THEKEY ^= " "          /* CONVERT KEY TO COMMAND   */
        THEN DO
              THECMD  = VALUE(THEKEY)
              UPPER THECMD;
             END
     ELSE NOTYET = 'YES'       /* ENTER WAS HIT            */

     IF (MYKEY = 'PF03' × MYKEY ='PF04')
       THEN EXIT               /*  LEAVE LOOP AND RETURN   */
     IF (MYCMD = 'END' × MYCMD = 'RETURN' × MYCMD = 'CANCEL')
       THEN EXIT               /*  LEAVE LOOP AND RETURN   */
     IF (THECMD = 'END' × THECMD = 'RETURN' × THECMD = 'CANCEL')
       THEN EXIT               /*  LEAVE LOOP AND RETURN   */
 END

/*    GET THE READ/WRITE READ/ONLY MSL FROM THE PANEL          */

ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ADDRESS ISPEXEC
"VGET (MSLRW MSLRO1 MSLRO2 MSLRO3 MSLRO4 MSLRO5 MSLRO6",
      "DSNRW DSNRO1 DSNRO2 DSNRO3 DSNRO4 DSNRO5 DSNRO6)"

ADDRESS TSO

SIGNAL ON ERROR

/*          ALLOCATION OF ALL SYSTEMS CSP/AD FILE                  */

"ATTRIB EZPRINT BLKSIZE(658) LRECL(654) RECFM(V,B,A) DSORG(PS)"

"ALLOC FI(DCAPRMG) SHR DA('"CSPNAME".DCAPRMG') REUSE"
"ALLOC FI(DCADZGD) SHR DA('"CSPNAME".DZGMSG') REUSE"
"ALLOC FI(UTILALF) SHR DA('"CSPNAME".UTILALF.ALF') REUSE"
"ALLOC FI(PRMALF)  SHR DA('"CSPNAME".PRMALF.ALF') REUSE"
"ALLOC FI(DCAHECD) SHR DA('"CSPNAME".FZEMSG') REUSE"
"ALLOC FI(DCASAMD) SHR DA('"CSPNAME".DCASAMD') REUSE"
"ALLOC FI(UTILMSL) SHR DA('"CSPNAME".UTILMSL')  REUSE"
"ALLOC FI(URUALF)  SHR DA('"CSPNAME".URUALF.ALF') REUSE"
"ALLOC FI(DCAEZED) SHR DA('"CSPNAME".EZEMSG') REUSE"
"ALLOC FI(DCAMAPD) SHR DA('"CSPNAME".FZEMAPDS')  REUSE"
"ALLOC FI(DCATESD) SHR DA('"CSPNAME".FZETUTOR')  REUSE"

/*              ALLOCATE CSP/AD MSL FILES                           */

IF MSLRW ^= " "
 THEN "ALLOC FI("MSLRW") SHR DA('"DSNRW"') REUSE"
IF MSLRO1 ^= " "
 THEN "ALLOC FI("MSLRO1") SHR DA('"DSNRO1"') REUSE"
IF MSLRO2 ^= " "
 THEN "ALLOC FI("MSLRO2") SHR DA('"DSNRO2"') REUSE"
IF MSLRO3 ^= " "
 THEN "ALLOC FI("MSLRO3") SHR DA('"DSNRO3"') REUSE"
IF MSLRO4 ^= " "
 THEN "ALLOC FI("MSLRO4") SHR DA('"DSNRO4"') REUSE"
IF MSLRO5 ^= " "
 THEN "ALLOC FI("MSLRO5") SHR DA('"DSNRO5"') REUSE"
IF MSLRO6 ^= " "
 THEN "ALLOC FI("MSLRO6") SHR DA('"DSNRO6"') REUSE"

/*         ALLOCATE EZEPRINT FILE FOR CSP/AD                        */

"ALLOC FI(EZEPRINT) DA('"SYSUID".CSP.EZEPRINT') MOD",
         "USING(EZPRINT) SPACE(10,5) TRACKS"

/*         ALLOCATE EZEP     FILE FOR CSP/AD                        */

"ALLOC FI(EZEP) DA('"SYSUID".CSP.ALFPRINT') MOD",
         "USING(EZPRINT) SPACE(10,5) TRACKS"

/*         ALLOCATE DCAWORK  FILE FOR TSO USE ONLY                  */

"ALLOC FI(DCAWORK) DA('"SYSUID".DCAWORK') SHR REUSE"

/*         ALLOCATE FZERSAM                                         */

"ALLOC FI(FZERSAM) DA('"SYSUID".FZERSAM') SHR REUSE"

/*         ALLOCATE DCALOAD  CSP LOAD LIBRARIES                    */

"ALLOC FI(DCALOAD) DA('"CSPNAME".AELOAD'",
                       "'"CSPNAME".ADLOAD') SHR REUSE"

/*    EXECUTION OF CLIST XSPD TO ACCESS CSP ENVIRONMENT            */

"%XSPD DSYS("SSID") MSL("MSLRW")",
 "ROMSL('"MSLRO1", "MSLRO2", "MSLRO3" , "MSLRO4", "MSLRO5", "MSLRO6"')"

SIGNAL OFF ERROR

ENDIT:
MSG_WAS = MSG(MSG_WAS)

ADDRESS TSO

"FREE FI(DCAPRMG)"
"FREE FI(DCADZGD)"
"FREE FI(UTILALF)"
"FREE FI(PRMALF)"
"FREE FI(DCAHECD)"
"FREE FI(DCASAMD)"
"FREE FI(UTILMSL)"
"FREE FI(URUALF)"
"FREE FI(DCAEZED)"
"FREE FI(DCAMAPD)"
"FREE FI(DCATESD)"

/*  FREE CSP/AD MSL FILES  */
IF MSLRW ^= " "
 THEN "FREE FI("MSLRW")"
IF MSLRO1 ^= " "
 THEN "FREE FI("MSLRO1")"
IF MSLRO2 ^= " "
 THEN "FREE FI("MSLRO2")"
IF MSLRO3 ^= " "
 THEN "FREE FI("MSLRO3")"
IF MSLRO4 ^= " "
 THEN "FREE FI("MSLRO4")"
IF MSLRO5 ^= " "
 THEN "FREE FI("MSLRO5")"
IF MSLRO6 ^= " "
 THEN "FREE FI("MSLRO6")"

/*         EZEPRINT */
"FREE ATTRLIST(EZPRINT)"
"FREE FI(EZEPRINT)"

/*         EZEP */
"FREE FI(EZEP)"

/*         DCAWORK */
"FREE FI(DCAWORK)"


/*         FZERSAM */
"FREE FI(FZERSAM)"

/*         DCALOAD */
"FREE FI(DCALOAD)"

EXIT MYRC

ERROR:
MY_LINE = SIGL
MY_RC = RC
SIGNAL OFF ERROR
/*                                                                 */
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ZERRHM = '*'                         /*  ISPF HELP PANEL  */
ZERRALRM = 'NO'                      /*  ALARM STATUS     */
ZERRSM = 'SEVERE ERROR'          /*  SHORT MESSAGE    */
ZERRLM = 'LINE' MY_SIGL 'FAILED WITH RC=' MY_RC
"VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
"SETMSG MSG(ISRZ002)"              /* SIGNAL MSGID      */
MYRC = 4
SIGNAL ENDIT
/*                                                                 */
./ ADD NAME=INVKCSPE 0142-92191-93164-0845-00136-00134-00000-KETCSC
/*=============== INVKCSPE - REXX EXEC =============================*/
/*                                                                  */
/* LIB: EXEC(INVKCSPE)                                              */
/* GDE: LEIGHTON A. WESTON                                          */
/* DOC: THIS EXEC ALLOCATES LIBRARIES AND INVOKES CSP/AE.           */
/*                                                                  */
/*=============== INVKCSPE - REXX EXEC =============================*/

/*  TRACE ?R */

ADDRESS ISPEXEC
  "CONTROL ERRORS RETURN"
ADDRESS ISPEXEC
  "ISPEXEC VGET (ALF APPL)"

MYRC = 0

SYSPROC = SYSVAR(SYSPROC);
SYSUID  = SYSVAR(SYSUID);

IF (SYSPROC = 'D2DBEVL') THEN,
  DO
    CSPNAME = CSP.DEVL
    SSID = 'D1DB'
  END

IF (SYSPROC = 'DB2PROD') THEN,
  DO
    CSPNAME = CSP.PROD
    SSID = 'P1DB'
  END

MSG_WAS = MSG(OFF)

SIGNAL ON ERROR

ADDRESS TSO

"ATTRIB EZPRINT BLKSIZE(658) LRECL(654) RECFM(V,B,A) DSORG(PS)"

"ALLOC FI(DCAPRMG) SHR DA('"CSPNAME".DCAPRMG') REUSE"
"ALLOC FI(DCADZGD) SHR DA('"CSPNAME".DZGMSG') REUSE"
"ALLOC FI(UTILALF) SHR DA('"CSPNAME".UTILALF.ALF') REUSE"
"ALLOC FI(PRMALF)  SHR DA('"CSPNAME".PRMALF.ALF') REUSE"
"ALLOC FI(DCAHECD) SHR DA('"CSPNAME".FZEMSG') REUSE"

/* ALLOCATE CSP/AD FILES */
/* "ALLOC FI(SAMPMSL) SHR DA('"CSPNAME".SAMPMSL')  REUSE"  */
/* "ALLOC FI(DCAEMPL) SHR DA('"CSPNAME".DCAEMPL') REUSE" */
/* "ALLOC FI(UTILMSL) SHR DA('"CSPNAME".UTILMSL')  REUSE" */
"ALLOC FI(DCASAMD) SHR DA('"CSPNAME".DCASAMD') REUSE"
"ALLOC FI(URUALF)  SHR DA('"CSPNAME".URUALF.ALF') REUSE"
"ALLOC FI(DCAEZED) SHR DA('"CSPNAME".EZEMSG') REUSE"
"ALLOC FI(DCAMAPD) SHR DA('"CSPNAME".FZEMAPDS')  REUSE"
"ALLOC FI(DCATESD) SHR DA('"CSPNAME".FZETUTOR')  REUSE"

/* ALLOCATE EZEPRINT */
"ALLOC FI(EZEPRINT) DA('"SYSUID".CSP.EZEPRINT') MOD",
         "USING(EZPRINT) SPACE(10,5) TRACKS"

/* ALLOCATE EZEP */
"ALLOC FI(EZEP) DA('"SYSUID".CSP.ALFPRINT') MOD",
         "USING(EZPRINT) SPACE(10,5) TRACKS"

/* ALLOCATE DCAWORK */
"ALLOC FI(DCAWORK) DA('"SYSUID".DCAWORK') SHR REUSE"

/* ALLOCATE FZERSAM */
"ALLOC FI(FZERSAM) DA('"SYSUID".FZERSAM') SHR REUSE"

/* ALLOCATE DCALOAD */
"ALLOC FI(DCALOAD) DA('"CSPNAME".AELOAD'",
                       "'"CSPNAME".ADLOAD') SHR REUSE"

"%XSPE DSYS("SSID") APPL("ALF"."APPL") DMODE(D)"

SIGNAL OFF ERROR

ENDIT:
MSG_WAS = MSG(MSG_WAS)

ADDRESS TSO

"FREE FI(DCAPRMG)"
"FREE FI(DCADZGD)"
"FREE FI(UTILALF)"
"FREE FI(PRMALF)"
"FREE FI(DCAHECD)"

/*         CSP/AE FILES */
"FREE FI(DCASAMD)"
"FREE FI(URUALF)"
"FREE FI(DCAEZED)"
"FREE FI(DCAMAPD)"
"FREE FI(DCATESD)"

/* EZEPRINT */
"FREE ATTRLIST(EZPRINT)"
"FREE FI(EZEPRINT)"

/* EZEP */
"FREE FI(EZEP)"

/* DCAWORK */
"FREE FI(DCAWORK)"

/* FZERSAM */
"FREE FI(FZERSAM)"

/* DCALOAD */
"FREE FI(DCALOAD)"

EXIT MYRC

ERROR:

MY_LINE = SIGL
MY_RC = RC
SIGNAL OFF ERROR

ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"

ZERRHM = '*'                         /*  ISPF HELP PANEL  */
ZERRALRM = 'NO'                      /*  ALARM STATUS     */
ZERRSM = 'SEVERE ERROR'              /*  SHORT MESSAGE    */
ZERRLM = 'LINE' MY_SIGL 'FAILED WITH RC=' MY_RC

"VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
"SETMSG MSG(ISRZ002)"                /* SIGNAL MSGID      */

MYRC = 4

SIGNAL ENDIT

/*                                                                 */
./ ADD NAME=INVKDB2I 0105-92238-94032-0832-00116-00112-00000-KETCSC
/*===== REXX ======================================================*/
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(INVKDB2I)                                */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS REXX EXEC ALLOCATES DATASETS FOR ALTLIB AND LIBDEFS   */
/*      BEFORE INVOKING THE DB2 INTERACTIVE FACILITY (SPUFI).      */
/*                                                                 */
/*===== REXX ======================================================*/

/*  TRACE I  */
    GETSYSID

/*========================================================*/
/* RETURN ISPF ERRORS TO CLIST                            */
/*========================================================*/
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPEXEC CONTROL FAILED RC=MYCC
        EXIT MYCC
      END

/*========================================================*/
/* CHECK PASSED ARGUMENTS                                 */
/*========================================================*/
    ARG DSNEOV01
    IF (DSNEOV01 = '') THEN,
      DO
        ADDRESS ISPEXEC "LIBDEF ISPPLIB DATASET",
           "ID('XDBS.TSOISPF.PANELS')"
        MYCC = RC
        IF MYCC ^= 0 THEN,
          DO
            SAY ISPPLIB FAILED RC=MYCC
            EXIT MYCC
          END
        ADDRESS ISPEXEC "DISPLAY PANEL(GETSSID)"
        IF (RC ^= 0) THEN EXIT 0
      END
    IF (DSNEOV01 = '') THEN,
      DO
        EXIT 4
      END

/*========================================================*/
/* ISSUE ALTLIBS AND LIBDEFS                              */
/*========================================================*/
    "ALTLIB ACTIVATE APPLICATION(CLIST)",
      "DATASET('XDBS.TSOISPF.EXEC'",
              "'XDBS.TSOISPF.CLIST'",
              "'"DSNEOV01".DSNCLIST')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ALTLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPLLIB DATASET",
       "ID('"DSNEOV01".DSNEXIT'",
          "'"DSNEOV01".DSNLOAD')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPLLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPMLIB DATASET",
       "ID('XDBS.TSOISPF.MSGS'",
          "'"DSNEOV01".DSNSPFM')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPMLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPPLIB DATASET",
       "ID('XDBS.TSOISPF.PANELS'",
          "'"DSNEOV01".DSNSPFP')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPPLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPSLIB DATASET",
       "ID('XDBS.TSOISPF.SKELS')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPSLIB FAILED RC=MYCC
        EXIT MYCC
      END

/*========================================================*/
/* SPIN OFF TO APPLICATION                                */
/*========================================================*/
    ADDRESS ISPEXEC "SELECT CMD(SETDB2OP" DSNEOV01") NEWAPPL(DB2I)"
    ADDRESS ISPEXEC "SELECT PANEL(DSNEPRI) PASSLIB NEWAPPL(DB2I)"
    RCSAVE = RC

/*========================================================*/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/*========================================================*/
    ADDRESS ISPEXEC "LIBDEF ISPMLIB"
    ADDRESS ISPEXEC "LIBDEF ISPPLIB"
    ADDRESS ISPEXEC "LIBDEF ISPSLIB"

    "ALTLIB DEACTIVATE APPLICATION(CLIST)"

    EXIT RCSAVE
./ ADD NAME=INVKO2DB 0104-94021-94023-1012-00114-00102-00020-DMV0016
/*---------REXX OMGINST -------------------------------*/
/*                                                     */
/* LIB: XDBS.TSOISPF.EXEC(OMGINST)                     */
/* GDE: KETCSC                                         */
/* DOC: THIS REXX EXEC ALLOCATES OMEGAMON II FOR DB2   */
/*      AND RUNS THE CUSTOMIZATION CLIST.              */
/*                                                     */
/*---------REXX OMGINST -------------------------------*/
PARSE UPPER ARG DB2ID CUST JUNK
    IF (CUST = "YES") × (CUST = "Y") THEN
        CUST = "YES"
    ELSE,
        CUST = "NO"
    IF (DB2ID = "") THEN,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "DB2ID REQUIRED"
        ZERRLM = "YOU MUST SUPPLY A DB2 SUBSYSTEM ID"
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        EXIT 4
      END
BEGIN:
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    PTR2PSA = 0
    CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
    CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
    SYSID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
    ALTLIB "DEACTIVATE APPLICATION(CLIST)"
    MYCC = RC
    ALTLIB "ACTIVATE APPLICATION(CLIST) DSNAME('XDBS.TSOISPF.EXEC')"
    MYCC = RC
    CHCKSSID DB2ID
    MYCC = RC
    ALTLIB "DEACTIVATE APPLICATION(CLIST)"
    MYCC = RC
    IF (MYCC = 0) THEN SIGNAL ITSGOOD
    SAY "DB2 SUBSYSTEM "DB2ID" IS NOT INSTALLED ON",
      SYSID", TRY ANOTHER."
    EXIT 16
 /*----------------------------------------------------*/
 /*           TSO AND ISPF DATASETS                    */
 /*----------------------------------------------------*/
ITSGOOD:
    V250OK = SYSDSN("'"DB2ID".OMEGDB2.CLIST'")
    MYCC = 24
    IF (V250OK = "OK") THEN,
      DO
        ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".OMEGDB2.CLIST')"
        MYCC = RC
      END
    IF (MYCC = 0) THEN SIGNAL ITSOKAY
    IF (CUST = "YES") × (CUST = "Y") THEN
        CUST = "Y"
    ELSE,
        CUST = "N"
    V260OK = SYSDSN("'"DB2ID".OMEGDB2.TO2CLIST'")
    IF (V260OK = "OK") THEN,
      DO
        ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".OMEGDB2.TO2CLIST')"
        MYCC = RC
      END
    IF (MYCC = 0) THEN SIGNAL ITSOKAY
    V260OK = SYSDSN("'"DB2ID".TOMGDB2.TARGET.TO2CLIST'")
    IF (V260OK = "OK") THEN,
      DO
        ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".TOMGDB2.TARGET.TO2CLIST')"
        MYCC = RC
      END
    IF (MYCC ^= 0) THEN ,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "REQUEST FAILED"
        ZERRLM = "CLIST ALTLIB FAILED "MYCC
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        EXIT 4
      END
/* */
 /*----------------------------------------------------*/
 /*       INVOKE THE PRODUCT                           */
 /*----------------------------------------------------*/
ITSOKAY:
    ADDRESS ISPEXEC "VPUT (DB2ID) SHARED"
    IF (V250OK = "OK") THEN,
      DO
        ADDRESS ISPEXEC "SELECT CMD(SETOMGOP" DB2ID") NEWAPPL(O2AP)"
        O2SPF "O2CUST("CUST")"
      END
    IF (V260OK = "OK") THEN,
      DO
        ADDRESS ISPEXEC "SELECT CMD(SETOMGOP" DB2ID") NEWAPPL(O2AP)"
        KO2SPF "CUST("CUST")"
      END
    MYCC = RC
 /*----------------------------------------------------*/
 /*       FREE THE MESS ALLOCATED                      */
 /*----------------------------------------------------*/
    ADDRESS TSO,
      ALTLIB "DEACTIVATE APPLICATION(CLIST)"
    MYCC = RC
QMFXIT:
    EXIT 0
./ ADD NAME=INVKPSQL 0199-92255-93342-1208-00107-00090-00000-LAWCSC
/*===== REXX ======================================================*/
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(INVKPSQL)                                */
/* GDE: LEIGHTON A. WESTON                                         */
/* DOC: THIS REXX EXEC ALLOCATES DATASETS FOR ALTLIB AND LIBDEFS   */
/*      BEFORE INVOKING PC/SQL LINK CLIST.                         */
/*                                                                 */
/*===== REXX ======================================================*/

/* TRACE ?R */

 NOTYET="NO"
 MYCMD=""
 MYCLIST=""
/*========================================================*/
/* RETURN ISPF ERRORS TO CLIST                            */
/*========================================================*/

    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPEXEC CONTROL FAILED RC=MYCC
        EXIT MYCC
      END

/*========================================================*/
/* CHECK PASSED ARGUMENTS                                 */
/*========================================================*/

    ARG SSID

/*-------------------------------------------------*/
/* SET PROCESSING CONTROL VARIABLES  FOR SUBSYSTEM */
/*-------------------------------------------------*/

HAVEID:
    IF (SSID = DB2X) THEN SIGNAL PCSQLOK
    IF (SSID = D1DB) THEN SIGNAL PCSQLOK
    IF (SSID = P1DB) THEN SIGNAL PCSQLOK
    IF (SSID =  DSN) THEN SIGNAL PCSQLOK
    IF (SSID = DB2M) THEN SIGNAL PCSQLOK
    IF (SSID = DDB2) THEN SIGNAL PCSQLOK
    IF (SSID = PDB2) THEN SIGNAL PCSQLOK
    IF (SSID = D2DB) THEN SIGNAL PCSQLOK
    IF (SSID = P2DB) THEN SIGNAL PCSQLOK
    SAY  "PCSQL IS NOT INSTALLED IN SUBSYSTEM" SSID "TRY ANOTHER."
    EXIT MYCC
PCSQLOK:

/*========================================================*/
/* ISSUE ALTLIBS AND LIBDEFS                              */
/*========================================================*/
    "ALTLIB ACTIVATE APPLICATION(CLIST)",
      "DATASET('"SSID".PCSQL.CLIST')"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ALTLIB FAILED RC=MYCC
        SAY "PCSQL IS NOT INSTALLED IN SUBSYSTEM" SSID "TRY ANOTHER."
        EXIT MYCC
      END
/*                                                           */
    IF MYCC = 0 THEN,
     DO
       ADDRESS ISPEXEC
       "CONTROL ERRORS RETURN"
       ADDRESS ISPEXEC
       "VPUT (SSID)"
       ADDRESS ISPEXEC
       "LIBDEF ISPPLIB DATASET ID('"XDBS.TSOISPF.PANELS"')"
       DO WHILE NOTYET = 'NO'
           "DISPLAY PANEL(PCSQLINK)"
           IF RC > 8 THEN,        /* RC = 12 PANEL NOT FILE     */
            DO
             MYCC = RC
             SAY "PCSQL PANEL NOT FOUND."
             EXIT MYCC
            END
           IF RC = 8 THEN,         /* RC = 8 RETURN FROM A PANEL */
             DO
               MYCC = RC
               NOTYET = "YES"
               EXIT
              END
           "VGET (MYCMD)"
           IF (RC = 0 & SUBSTR(MYCMD,1,8) ^= 'IND$FILE') THEN,
             DO
              MYCLIST='%'××MYCMD
              ADDRESS ISPEXEC "SELECT CMD("MYCLIST")"
             END
           IF (RC = 0 & SUBSTR(MYCMD,1,8) = 'IND$FILE') THEN,
             DO
              ADDRESS ISPEXEC "SELECT CMD("MYCMD")"
             END
         END
      END

/*========================================================*/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/*========================================================*/

    ADDRESS TSO
    "ALTLIB DEACTIVATE APPLICATION(CLIST)"

    EXIT MYCC
./ ADD NAME=INVKXPD2 0103-92245-92245-0747-00165-00159-00006-DMV0016
/*============== INVKXPD2 - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(INVKXPD2)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC ALLOCATES TSO AND ISPF DATASETS AND THEN          */
/*      INVOKES XPEDITER WITH DB2 SUPPORT.                          */
/*                                                                  */
/*============== INVKXPD2 - REXX EXEC ===============================*/

/*  TRACE I  */
    GETSYSID

/*========================================================*/
/* RETURN ISPF ERRORS TO CLIST                            */
/*========================================================*/
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPEXEC CONTROL FAILED RC=MYCC
        EXIT MYCC
      END

/*========================================================*/
/* CHECK PASSED ARGUMENTS                                 */
/*========================================================*/
    ARG DSNEOV01
    IF (DSNEOV01 = '') THEN,
      DO
        ADDRESS ISPEXEC "LIBDEF ISPPLIB DATASET",
           "ID('XDBS.TSOISPF.PANELS')"
        MYCC = RC
        IF MYCC ^= 0 THEN,
          DO
            SAY ISPPLIB FAILED RC=MYCC
            EXIT MYCC
          END
        ADDRESS ISPEXEC "DISPLAY PANEL(GETSSID)"
        IF (RC ^= 0) THEN EXIT 0
      END
    IF (DSNEOV01 = '') THEN,
      DO
        EXIT 4
      END

/*========================================================*/
/* ISSUE ALTLIB                                           */
/*========================================================*/
    OK = SYSDSN("'DEP.XPEDITER.V5R2M0.CLIST'")
    IF OK ^= "OK" THEN,
      DO
        SAY "I DO NOT KNOW WHERE XPEDITER IS LOCATED ON" SYSID"."
        EXIT MYCC
      END
    "ALTLIB ACTIVATE APPLICATION(CLIST)",
      "DATASET('XDBS.TSOISPF.EXEC'",
              "'XDBS.TSOISPF.CLIST'",
              "'DEP.XPEDITER.V5R2M0.CLIST'",
              ")"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ALTLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF SYSHELP DATASET",
       "ID(",
          "'DEP.XPEDITER.V5R2M0.HELP'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY SYSHELP FAILED LIBDEF RC=MYRC
        SAY
      END

/*========================================================*/
/* ISSUE LIBDEFS                                          */
/*========================================================*/

    ADDRESS ISPEXEC "LIBDEF ISPLLIB DATASET",
       "ID('"DSNEOV01".DSNEXIT'",
          "'"DSNEOV01".DSNLOAD'",
              "'DEP.XPEDITER.V5R2M0.LOADLIB'",
              ")"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPLLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPMLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.MSGS'",
          "'DEP.XPEDITER.V5R2M0.MSGS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPMLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPPLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.PANELS'",
          "'DEP.XPEDITER.V5R2M0.PANELS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPPLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPSLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.SKELS'",
          "'DEP.XPEDITER.V5R2M0.SKELS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPSLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPTLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.TABLES'",
          "'DEP.XPEDITER.V5R2M0.TABLES'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPTLIB FAILED LIBDEF RC=MYRC
        SAY
      END

/*========================================================*/
/* SPIN OFF TO APPLICATION                                */
/*========================================================*/
    ADDRESS ISPEXEC "SELECT PGM(ADSIS000)"
    RCSAVE = RC

/*========================================================*/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/*========================================================*/
    ADDRESS ISPEXEC "LIBDEF ISPLLIB"
    ADDRESS ISPEXEC "LIBDEF ISPMLIB"
    ADDRESS ISPEXEC "LIBDEF ISPPLIB"
    ADDRESS ISPEXEC "LIBDEF ISPSLIB"
    ADDRESS ISPEXEC "LIBDEF ISPTLIB"

    "ALTLIB DEACTIVATE APPLICATION(CLIST)"

    EXIT RCSAVE
./ ADD NAME=INVKXPED 0105-92244-92245-0746-00147-00159-00009-DMV0016
/*============== INVKXPED - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(INVKXPED)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC ALLOCATES TSO AND ISPF DATASETS AND THEN          */
/*      INVOKES XPEDITER.                                           */
/*                                                                  */
/*============== INVKXPED - REXX EXEC ===============================*/

/*  TRACE I  */
    GETSYSID

/*========================================================*/
/* RETURN ISPF ERRORS TO CLIST                            */
/*========================================================*/
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPEXEC CONTROL FAILED RC=MYCC
        EXIT MYCC
      END

/*========================================================*/
/* CHECK PASSED ARGUMENTS                                 */
/*========================================================*/
    ARG JUNK

/*========================================================*/
/* ISSUE ALTLIB                                           */
/*========================================================*/
    OK = SYSDSN("'DEP.XPEDITER.V5R2M0.CLIST'")
    IF OK ^= "OK" THEN,
      DO
        SAY "I DO NOT KNOW WHERE XPEDITER IS LOCATED ON" SYSID"."
        EXIT MYCC
      END
    "ALTLIB ACTIVATE APPLICATION(CLIST)",
      "DATASET('XDBS.TSOISPF.EXEC'",
              "'XDBS.TSOISPF.CLIST'",
              "'DEP.XPEDITER.V5R2M0.CLIST'",
              ")"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ALTLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF SYSHELP DATASET",
       "ID(",
          "'DEP.XPEDITER.V5R2M0.HELP'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY SYSHELP FAILED LIBDEF RC=MYRC
        SAY
      END

/*========================================================*/
/* ISSUE LIBDEFS                                          */
/*========================================================*/

    ADDRESS ISPEXEC "LIBDEF ISPLLIB DATASET",
       "ID(",
              "'DEP.XPEDITER.V5R2M0.LOADLIB'",
              ")"
    MYCC = RC
    IF MYCC ^= 0 THEN,
      DO
        SAY ISPLLIB FAILED RC=MYCC
        EXIT MYCC
      END

    ADDRESS ISPEXEC "LIBDEF ISPMLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.MSGS'",
          "'DEP.XPEDITER.V5R2M0.MSGS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPMLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPPLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.PANELS'",
          "'DEP.XPEDITER.V5R2M0.PANELS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPPLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPSLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.SKELS'",
          "'DEP.XPEDITER.V5R2M0.SKELS'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPSLIB FAILED LIBDEF RC=MYRC
        SAY
      END

    ADDRESS ISPEXEC "LIBDEF ISPTLIB DATASET",
       "ID(",
          "'XDBS.TSOISPF.TABLES'",
          "'DEP.XPEDITER.V5R2M0.TABLES'",
         ")"
    MYRC = RC
    IF (MYRC ^= 0) THEN,
      DO
        SAY
        SAY ISPTLIB FAILED LIBDEF RC=MYRC
        SAY
      END

/*========================================================*/
/* SPIN OFF TO APPLICATION                                */
/*========================================================*/
    ADDRESS ISPEXEC "SELECT PGM(ADSIS000)"
    RCSAVE = RC

/*========================================================*/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/*========================================================*/
    ADDRESS ISPEXEC "LIBDEF ISPLLIB"
    ADDRESS ISPEXEC "LIBDEF ISPMLIB"
    ADDRESS ISPEXEC "LIBDEF ISPPLIB"
    ADDRESS ISPEXEC "LIBDEF ISPSLIB"
    ADDRESS ISPEXEC "LIBDEF ISPTLIB"

    "ALTLIB DEACTIVATE APPLICATION(CLIST)"

    EXIT RCSAVE
./ ADD NAME=ISDB2UP  0102-93356-94038-1211-00038-00031-00015-PETE
/*---------REXX D1DBISUP -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(D1DBISUP)          */
/* GDE: KETCSC                                */
/* DOC: THIS REXX EXEC ......                           */
/*                                                      */
/*---------REXX D1DBISUP -------------------------------*/
PARSE ARG SSID MSG
    ADDRESS TSO "DSN SYSTEM("SSID")"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        SAY SSID "IS NOT OPERATIONAL, PLEASE INVESTIGATE"
        IF (MSG = MSG) THEN ,
          DO
            ADDRESS TSO
       "SE '"SSID "SUBSYSTEM IS NOT OPERATIONAL, PLEASE INVESTIGATE"''
            ADDRESS TSO
       "SE '"SSID "SUBSYSTEM IS NOT OPERATIONAL, PLEASE INVESTIGATE"''
            ADDRESS TSO
       "SE '"SSID "SUBSYSTEM IS NOT OPERATIONAL, PLEASE INVESTIGATE"''
            ADDRESS TSO
       "SE '"SSID "SUBSYSTEM IS NOT OPERATIONAL, PLEASE INVESTIGATE"''
            ADDRESS TSO
       "SE '"SSID "SUBSYSTEM IS NOT OPERATIONAL, PLEASE INVESTIGATE"''
            ADDRESS TSO
       "CALL '"SSID".DB2GRP.LOADLIB(WTOWTOR)'",
       "PARM('
          END
        SIGNAL EXITIT
      END
    IF (MSG = MSG) THEN ,
      DO
        SAY SSID "SUBSYSTEM IS UP"
      END
    END
EXITIT:
    EXIT CODE(RC)
./ ADD NAME=ISPFMVSZ 0100-93246-93246-1347-00018-00018-00000-KETCSC
/*-- REXX --- ISPFMVSZ - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(ISPFMVSZ)                                          */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: FIGURES OUT YOUR TSO ID OR BATCH JOBNAME AND THE SYSTEM      */
/*      YOU ARE RUNNING ON.                                          */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG PANEL
PTR2CVT = STORAGE(10,4)
PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
ISPFON1 SYSID
./ ADD NAME=ISPFON1  0120-93246-93318-0850-00808-00768-00055-LAWCSC
PROC 1 SYSID
 /*                                                                  */
 /* LIB: CLIST(ISPFON)                                               */
 /* GDE: KEN TOMIAK                                                  */
 /* DOC: THIS CLIST ALLOCATES THE TSO AND ISPF DDNAMES.              */
 /*                                                                  */
    CONTROL END(ENDO) NOFLUSH MAIN NOMSG ASIS NOLIST
 /*                                                                  */
 /*  NEVER TURN ON MSG CONLIST OR SYMLIST BEFORE THE LISTUSER CMD.   */
 /*                                                                  */
    SET &SYSOUTTRAP = 25
    LISTUSER &SYSUID
    SET &SYSOUTTRAP = 0
/*  CONTROL LIST CONLIST SYMLIST MSG
 /*                                                                  */
 /*  NEVER TURN ON MSG CONLIST OR SYMLIST BEFORE THE LISTUSER CMD.   */
 /*                                                                  */
    SET &B = &SYSINDEX(NAME=,&STR(&SYSOUTLINE1))
    SET &B = &B + 5
    SET &E = &B + 20
    SET &PGMR = &SUBSTR(&B:&E,&NRSTR(&SYSOUTLINE1))
    ERROR +
      DO
        ERROR OFF
        GOTO GETOWNR
      ENDO
    SET &PGMR = &PGMR
GETOWNR: +
    SET &B = &SYSINDEX(OWNER=,&STR(&SYSOUTLINE1))
    SET &B = &B + 6
    SET &E = &B + 8
    SET &OWNR = &SUBSTR(&B:&E,&NRSTR(&SYSOUTLINE1))
    ERROR +
      DO
        ERROR OFF
        GOTO CHKAUTH
      ENDO
    SET &OWNR = &OWNR
 /*                                                                  */
 /*  check user authority                                            */
 /*                                                                  */
CHKAUTH: +
    ERROR OFF
 /*                                                                  */
 /*  Check for HRA                                                   */
 /*                                                                  */
    IF (&OWNR = CWA069D) THEN EXIT CODE(0)
 /*                                                                  */
 /*  Check for RACF/MVS                                              */
 /*                                                                  */
    IF (&SYSUID = TONY)    OR +
       (&SYSUID = CSCSEC)  OR +
       (&SYSUID = ACTCSC)  OR +
       (&SYSUID = HJLCSC)  OR +
       (&SYSUID = LXGCSC)  THEN +
      GOTO BEGIN
 /*                                                                  */
 /*  CDCSA CICS GROUP                                                */
 /*                                                                  */
    IF (&SYSUID = AXGCSC)  OR +
       (&SYSUID = JOJO)    THEN +
      GOTO BEGIN
 /*                                                                  */
 /*  CDCSA MVS IBM Consultants                                       */
 /*                                                                  */
    IF (&SYSUID = SXSCSC)  OR   +
       (&SYSUID = JXCCSC)  THEN +
      GOTO NEWC828
 /*                                                                  */
 /*  CDCSA DB2 GROUP                                                 */
 /*                                                                  */
    SET &UID = &SUBSTR(1:3,&SYSUID   )
    IF (&UID = DD2) THEN GOTO DOFBEGIN
    IF (&UID = DMV) AND +
       ((&SYSID = DOFX) OR +
       ((&SYSID = DOFD) OR +
       ((&SYSID = DOFP)) THEN +
      GOTO DOFBEGIN
    IF (&OWNR = CSCDB2) THEN GOTO BEGIN
    IF (&SYSUID = SUE)     OR +
       (&SYSUID = MJLCSC)  OR +
       (&SYSUID = DB2CSC)  OR +
       (&SYSUID = MANN)    OR +
       (&SYSUID = PETE)    OR +
       (&SYSUID = KETCSC)  OR +
       (&SYSUID = LAWCSC)  OR +
       (&SYSUID = ACSCFSG)  OR +
       (&SYSUID = ACSCPAB)  OR +
       (&SYSUID = FMMCSC)  OR   +
       (&SYSUID = DMV0016) THEN +
      GOTO BEGIN
 /*                                                                  */
 /*  Check for waterboard                                            */
 /*                                                                  */
    SET &AUTHID = &SUBSTR(1:4,&SYSUID    )
    IF (&AUTHID = C828) THEN +
      GOTO NEWC828
 /*                                                                  */
 /*  UNKNOWN USERS                                                   */
 /*                                                                  */
    EXIT CODE(0)
BEGIN: +
    WRITE
    WRITE Hi &PGMR.. Welcome to the &SYSID system.
    WRITE
    IF (&SYSID = MVSP) THEN +
      DO
        IF (&SYSPROC = DB2PROD) THEN +
          DO
            SET &DB2PRE = &STR(P1DB.)
            SET &CSPPRE = &STR(CSP.PROD.)
          ENDO
        ELSE +
          DO
            SET &DB2PRE = &STR(D1DB.)
            SET &CSPPRE = &STR(CSP.DEVL.)
          ENDO
      ENDO
    ELSE +
      IF (&SYSID = MVSW) THEN +
        DO
          IF (&SYSPROC = DB2PROD) THEN +
            DO
              SET &DB2PRE = &STR(P1DB.)
              SET &CSPPRE = &STR(CSP.PROD.)
            ENDO
          ELSE +
            DO
              IF (&SYSPROC = D2DBEVL) THEN +
                DO
                  SET &DB2PRE = &STR(D1DB.)
                  SET &CSPPRE = &STR(CSP.DEVL.)
                ENDO
              ELSE +
                DO
                  SET &DB2PRE = &STR(D2DB.)
                  SET &CSPPRE = &STR(         )
                ENDO
            ENDO
        ENDO
    ELSE +
    IF (&SYSID = MVSX) THEN +
      DO
        SET &DB2PRE = &STR(DB2M.)
        SET &CSPPRE = &STR(CSPT.)
      ENDO
    ELSE +
    IF (&SYSID = MVSZ) THEN +
      DO
        SET &DB2PRE = &STR(     )
        SET &CSPPRE = &STR(     )
      ENDO
    PROFILE MODE WTPMSG MSGID PREFIX(&SYSUID)
    IF (&SYSID = MVSW) THEN +
      GOTO ALCMVSW
    IF (&SYSID = MVSX) THEN +
      GOTO ALCMVSX
    IF (&SYSID = MVSZ) THEN +
      GOTO ALCMVSZ
 /*                                                                  */
 /*  SET UP TSO ENVIRONMENT                                          */
 /*                                                                  */
ALCMVSP: +
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             'SYS1.CSC.CLIST'         /* MVS GROUP*/  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
                             '&DB2PRE.DSQCLSTE'       /* QMF      */  +
                             '&CSPPRE.ADCLIST'        /* CSP/AD   */  +
                             '&CSPPRE.AECLIST'   )    /* CSP/AE   */
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(CSC@MSTR)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD'            /* ISPF     */  +
                             '&CSPPRE.AELOAD'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             'SYS1.CSC.USRMLIB'       /* MVS GROUP*/  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
                             '&DB2PRE.DSQMLIBE'       /* QMF      */  +
                             '&CSPPRE.ADPLIB'         /* CSP/AD   */  +
                             '&CSPPRE.AEPLIB'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             'SYS1.CSC.USRPLIB'       /* MVS GROUP*/  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
                             '&DB2PRE.DSQPLIBE'       /* QMF      */  +
                             '&CSPPRE.ADPLIB'         /* CSP/AD   */  +
                             '&CSPPRE.AEPLIB'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
                             '&DB2PRE.DSQSLIBE'  )    /* QMF      */  +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
                             '&DB2PRE.DSQTLIBE'  )    /* QMF      */  +
          REUSE
    ERROR RETURN
    GOTO INVKPDF
 /*                                                                  */
 /*  SET UP TSO ENVIRONMENT                                          */
 /*                                                                  */
ALCMVSX: +
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
                             '&DB2PRE.DSQCLSTE'       /* QMF      */  +
                             '&CSPPRE.ADCLIST'        /* CSP/AD   */  +
                             '&CSPPRE.AECLIST'   )    /* CSP/AE   */
    FREE FI(SYSEXEC)
    ALLOC FI(SYSEXEC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             '&DB2PRE.DSQEXECE')      /* QMF      */
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(CSC@MSTR)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD'            /* ISPF     */  +
                             '&DB2PRE.DSNLOAD'        /* DB2      */  +
                             '&DB2PRE.DSQLOAD'        /* QMF      */  +
                             '&CSPPRE.AELOAD'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
                             '&DB2PRE.DSQMLIBE'       /* QMF      */  +
                             '&CSPPRE.ADPLIB'         /* CSP/AD   */  +
                             '&CSPPRE.AEPLIB'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
                             '&DB2PRE.DSQPLIBE'       /* QMF      */  +
                             '&CSPPRE.ADPLIB'         /* CSP/AD   */  +
                             '&CSPPRE.AEPLIB'    )    /* CSP/AE   */  +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
                             '&DB2PRE.DSQSLIBE'  )    /* QMF      */  +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
                             '&DB2PRE.DSQTLIBE'  )    /* QMF      */  +
          REUSE
    ERROR RETURN
    GOTO INVKPDF
ALCMVSZ: +
    SET &DB2PRE = &STR(DB2M.)
    SET &CSPPRE = &STR(XDBS.CSPX.)
    IF (&SYSID = MVSZ) THEN +
      DO
        IF (&SYSPROC = DB2DEVL) THEN +
          DO
            SET &DB2PRE = &STR(DB2M.)
            SET &CSPPRE = &STR(XDBS.CSPX.)
          ENDO
        ELSE +
          DO
            SET &DB2PRE = &STR(DB2X.)
            SET &CSPPRE = &STR(XDBS.CSPX.)
          ENDO
      ENDO
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             '&SYSUID..CLIST'         /* USER     */  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
/*                           '&DB2PRE.DSQCLSTE'       /* QMF      */  +
                            ) +
                  REUSE
    SET &MYCC = &LASTCC
    IF (&MYCC ^= 0) THEN +
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
/*                           '&DB2PRE.DSQCLSTE'       /* QMF      */  +
                            ) +
                  REUSE
    FREE FI(SYSEXEC)
    ALLOC FI(SYSEXEC) SHR DA('XDBS.TSOISPF.EXEC')     /* DB2 GROUP*/
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(CSC@MSTR)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD'            /* ISPF     */  +
                             '&DB2PRE.DSNLOAD'        /* DB2      */  +
                             '&DB2PRE.DSQLOAD' )      /* QMF      */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
/*                           '&DB2PRE.DSQMLIBE'       /* QMF      */  +
                            ) +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
/*                           '&DB2PRE.DSQPLIBE'       /* QMF      */  +
                            ) +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
/*                           '&DB2PRE.DSQSLIBE'       /* QMF      */  +
                            ) +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
/*                           '&DB2PRE.DSQTLIBE'       /* QMF      */  +
                            ) +
          REUSE
    ERROR RETURN
    GOTO INVKPDF
 /*                                                                  */
 /*  SET UP TSO ENVIRONMENT                                          */
 /*                                                                  */
ALCMVSW: +
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             'SYS1.CSC.CLIST'         /* MVS GROUP*/  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
                             '&DB2PRE.DSQCLSTE')      /* QMF      */
    FREE FI(SYSEXEC)
    ALLOC FI(SYSEXEC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             '&DB2PRE.DSQEXECE')      /* QMF      */
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(CSC@MSTR)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD')           /* ISPF     */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             'SYS1.CSC.USRMLIB'       /* MVS GROUP*/  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
                             '&DB2PRE.DSQMLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             'SYS1.CSC.USRPLIB'       /* MVS GROUP*/  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
                             '&DB2PRE.DSQPLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
                             '&DB2PRE.DSQSLIBE'  )    /* QMF      */  +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
                             '&DB2PRE.DSQTLIBE'  )    /* QMF      */  +
          REUSE
    ERROR RETURN
    GOTO INVKPDF
/*********************************************************************/
/*  CHECK FOR USER DEFINED INVOCATION
/*********************************************************************/
INVKPDF: +
    SET &DSNOK = &SYSDSN('&SYSUID..CLIST(ADDON)')
    IF (&STR(&DSNOK) EQ OK) THEN +
      GOTO INVKUSER
    WRITE
    WRITE Press ENTER when &STR(***) appears.
    WRITE
    ISPSTART &PNL
    WRITE
    WRITE SYSTEM&STR(:)&SYSID
    WRITE
    WRITE You are now out of ISPF.
    WRITE      OPTIONS are:
    WRITE         %l (to logon as &sysuid)
    WRITE         %x or logoff (to logoff)
    WRITE         %on (to get back to ispf menu)
    WRITE
    CONTROL NOPROMPT MSG
    SET SYSOUTTRAP = 10
    ATTR IPCSINVK
    SET LINES = &SYSOUTLINE
    FREE F(IPCSINVK)
    SET SYSOUTTRAP = 0
    IF &LINES = 0 THEN GOTO NOIPCS
    WRITE *************************************************************
    WRITE *                                                           *
    WRITE *     IPCS IS IN THE PROCESS OF COMING UP.  THIS WILL       *
    WRITE *     TAKE SEVERAL SECONDS TO ACCOMPLISH.  PLEASE WAIT.     *
    WRITE *                                                           *
    WRITE *************************************************************
    IPCS
    ISPSTART &PNL
NOIPCS: +
    EXIT CODE(&MAXCC)
ISPFC828: +
    WRITE
    WRITE Hi &PGMR.. Welcome to the &SYSID system.
    WRITE
    IF (&SYSPROC = DB2PROD) THEN +
      DO
        SET &DB2PRE = &STR(error)
      ENDO
    ELSE +
      DO
        SET &DB2PRE = &STR(D2DB.)
      ENDO
    PROFILE MODE WTPMSG MSGID PREFIX(&SYSUID)
 /*                                                                  */
 /*  SET UP TSO ENVIRONMENT                                          */
 /*                                                                  */
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
                             '&DB2PRE.DSQCLSTE')      /* QMF      */  +
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(CSC@MSTR)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD')           /* ISPF     */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
                             '&DB2PRE.DSQMLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
                             '&DB2PRE.DSQPLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
                             '&DB2PRE.DSQSLIBE'  )    /* QMF      */  +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
                             '&DB2PRE.DSQTLIBE'  )    /* QMF      */  +
          REUSE
    ERROR RETURN
    WRITE
    WRITE Press ENTER when &STR(***) appears.
    WRITE
    ISPSTART &PNL
    WRITE
    WRITE SYSTEM&STR(:)&SYSID
    WRITE
    WRITE You are now out of ISPF.
    WRITE      OPTIONS are:
    WRITE         %l (to logon as &sysuid)
    WRITE         %x or logoff (to logoff)
    WRITE         %on (to get back to ispf menu)
    WRITE
    EXIT CODE(&MAXCC)
/*********************************************************************/
/*  Using Jack's panels
/*********************************************************************/
NEWC828: +
    WRITE
    WRITE Hi &PGMR.. Welcome to the &SYSID system.
    WRITE
    IF (&SYSPROC = DB2PROD) THEN +
      DO
        SET &DB2PRE = &STR(error)
      ENDO
    ELSE +
      DO
        SET &DB2PRE = &STR(D2DB.)
      ENDO
    PROFILE MODE WTPMSG MSGID PREFIX(&SYSUID)
 /*                                                                  */
 /*  SET UP TSO ENVIRONMENT                                          */
 /*                                                                  */
    FREE FI(SYSPROC)
    ALLOC FI(SYSPROC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST'     /* DB2 GROUP*/  +
                             'SYS1.CSC.CLIST'         /* MVS GROUP*/  +
                             'ISR.ISRCLIB'            /* ISPF/PDF */  +
                             '&DB2PRE.DSNCLIST'       /* DB2      */  +
                             '&DB2PRE.DSQCLSTE')      /* QMF      */  +
 /*                                                                  */
 /*  SET UP ISPF ENVIRONMENT                                         */
 /*                                                                  */
    FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPPROF,ISPTABL)
    SET &DSNAME = &SYSUID..ISPF.ISPPROF
    ALLOC FI(ISPPROF) SHR  DA('&DSNAME.') REUSE
    IF &LASTCC ^= 0 THEN +
      DO
        FREE FI(ISPCRTE)
        CONTROL MSG
        ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)
        ALLOC DA('&DSNAME.') SP(2,2) TRACKS DIR(8) USING(ISPCRTE) +
            FI(ISPPROF)
        IF &LASTCC = 0 THEN +
          WRITE *** ISPF PROFILE DATA SET '&DSNAME.' HAS BEEN CREATED
        ELSE +
         DO
          WRITE  *** UNABLE TO ALLOCATE ISPF PROFILE DATA SET '&DSNAME.'
          FREE FI(ISPCRTE)
          EXIT CODE(12)
         ENDO
        FREE FI(ISPCRTE)
      ENDO
    CONTROL MSG
    ERROR EXIT
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(PRIMPNL)
    ELSE +
      SET &PNL = PANEL(&PANEL)

    ALLOC FI(ISPLLIB) SHR DA('ISR.ISRLOAD'            /* ISPF/PDF */  +
                             'ISP.ISPLOAD')           /* ISPF     */  +
          REUSE
    ALLOC FI(ISPMLIB) SHR DA( +
                             'XDBS.TSOISPF.MSGS'      /* DB2 GROUP*/  +
                             'ISR.ISRMENU'            /* ISPF/PDF */  +
                             'ISP.ISPMENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFM'        /* DB2      */  +
                             '&DB2PRE.DSQMLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPPLIB) SHR DA( +
                             'XDBS.TSOISPF.PANELS'    /* DB2 GROUP*/  +
                             'SYS1.CSC.USRPLIB'       /* MVS GROUP*/  +
                             'ISF.ISFPLIB'            /* SDSF     */  +
                             'ISR.ISRPENU'            /* ISPF/PDF */  +
                             'ISP.ISPPENU'            /* ISPF     */  +
                             '&DB2PRE.DSNSPFP'        /* DB2      */  +
                             '&DB2PRE.DSQPLIBE')      /* QMF      */  +
          REUSE
    ALLOC FI(ISPSLIB) SHR DA( +
                             'XDBS.TSOISPF.SKELS'     /* DB2 GROUP*/  +
                             'SYS1.CSC.USRSLIB'       /* MVS GROUP*/  +
                             'ISR.ISRSENU'            /* ISPF/PDF */  +
                             'ISP.ISPSLIB'            /* ISPF     */  +
                             '&DB2PRE.DSQSLIBE'  )    /* QMF      */  +
          REUSE
    ALLOC FI(ISPTABL) SHR DA('&DSNAME.')              /* USER     */  +
          REUSE
    ALLOC FI(ISPTLIB) SHR DA('&DSNAME' +
                             'XDBS.TSOISPF.TABLES'    /* DB2 GROUP*/  +
                             'ISF.ISFTLIB'            /* SDSF     */  +
                             'ISR.ISRTLIB'            /* ISPF/PDF */  +
                             'ISP.ISPTENU'            /* ISPF     */  +
                             '&DB2PRE.DSQTLIBE'  )    /* QMF      */  +
          REUSE
    ERROR RETURN
    WRITE
    WRITE Press ENTER when &STR(***) appears.
    WRITE
    ISPSTART &PNL
    WRITE
    WRITE SYSTEM&STR(:)&SYSID
    WRITE
    WRITE You are now out of ISPF.
    WRITE      OPTIONS are:
    WRITE         %l (to logon as &sysuid)
    WRITE         %x or logoff (to logoff)
    WRITE         %on (to get back to ispf menu)
    WRITE
    EXIT CODE(&MAXCC)
/*********************************************************************/
/*  USER HAS OWN INVOCATION CLIST
/*********************************************************************/
INVKUSER: +
    EX '&SYSUID..CLIST(ADDON)'
    EXIT CODE(&MAXCC)
/*********************************************************************/
/*  DOF Enhancement - add XDBS.TSOISPF
/*********************************************************************/
DOFBEGIN: +
    IF &PANEL = &STR() THEN +
      SET &PNL = PANEL(ISP@MSTR)
    ALLOC FI(XDBSPRC) SHR DA('XDBS.TSOISPF.EXEC'      /* DB2 GROUP*/  +
                             'XDBS.TSOISPF.CLIST')    /* DB2 GROUP*/  +
          REUSE
    CONCAT (SYSPROC,XDBSPRC)
    CONTROL MSG
    ERROR EXIT
    ALLOC FI(XDBSMLB) SHR DA('XDBS.TSOISPF.MSGS')     /* DB2 GROUP*/  +
          REUSE
    CONCAT (ISPMLIB,XDBSMLB)
    ALLOC FI(XDBSPLB) SHR DA('XDBS.TSOISPF.PANELS')   /* DB2 GROUP*/  +
          REUSE
    CONCAT (ISPPLIB,XDBSPLB)
    ALLOC FI(XDBSSLB) SHR DA('XDBS.TSOISPF.SKELS')    /* DB2 GROUP*/  +
          REUSE
    CONCAT (ISPSLIB,XDBSSLB)
    ALLOC FI(XDBSTLB) SHR DA('XDBS.TSOISPF.TABLES')   /* DB2 GROUP*/  +
          REUSE
    CONCAT (ISPTLIB,XDBSTLB)
    ERROR RETURN
    WRITE
    WRITE     XDBS Enhanced Version
    WRITE Press ENTER when &STR(***) appears.
    WRITE
    ISPSTART &PNL
    WRITE
    WRITE SYSTEM&STR(:)&SYSID
    WRITE
    WRITE You are now out of ISPF.
    WRITE      OPTIONS are:
    WRITE         %l (to logon as &sysuid)
    WRITE         %x or logoff (to logoff)
    WRITE         %on (to get back to ispf menu)
    WRITE
    EXIT CODE(&MAXCC)
./ ADD NAME=ISVTAMUP 0100-93333-93333-0941-00054-00054-00000-KETCSC
/*=============== ISVTAMUP - REXX EXEC =============================*/
/*                                                                  */
/* LIB: EXEC(ISVTAMUP)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC WAITS FOR VTAM TO BE EXECUTING.                   */
/*                                                                  */
/*=============== ISVTAMUP - REXX EXEC =============================*/
    SAY ' '
    SAY ' LIB: XDBS.TSOISPF.EXEC(ISVTAMUP)'
    SAY ' GDE: KENNETH E. TOMIAK'
    SAY ' DOC: THIS EXEC WAITS FOR VTAM TO BE EXECUTING'
    SAY ' '
    SAY ' EXECUTING ON' DATE() 'AT' TIME()'.'
    SAY ' '

    ARG JUNK

/*========================================================*/
/* FIND DETAILS                                           */
/*========================================================*/
ISITUP:
    X=OUTTRAP(JOBLIST.,25)
    "STATUS NET"
    RX=OUTTRAP(OFF)
    IF (JOBLIST = 0) THEN
        DO
          SAY TOID JOBNAME STATUS "NOT FOUND BY STATUS COMMAND",
            DATE() TIME()
        END
      ELSE
       DO
         DO I = JOBLIST.0 TO 1 BY -1
           IF (WORD(JOBLIST.I,4) = "EXECUTING") THEN
             DO
               SIGNAL VTAMISUP
             END
           ELSE
             DO
               NOP
             END
         END
       END
    SIGNAL ISITUP

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/
VTAMISUP:
    PAUSE = TIME('M') + 2
    SAY 'WAITING FOR UP TO TWO MINUTES.'
KILLTIME:
    NEWTIME = TIME('M')
    IF (NEWTIME < PAUSE) THEN SIGNAL KILLTIME
    EXIT
./ ADD NAME=LASTIPL  0102-93318-93318-1035-00080-00029-00054-KETCSC
/*-- REXX --- LASTIPL -----------------------------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(LASTIPL)                                           */
/* GDE: KENNETH E. TOMIAK                                            */
/* DOC: FOLLOWS MVS CONTROL BLOCKS TO GET SMF SYSTEM ID, FMID,       */
/*      PRODUCT LEVEL, CPU MODEL, AND IPL INFORMATION.               */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG JUNK
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO CVT FROM PSA                                    */
/*-------------------------------------------------------------------*/
PTR2PSA = 0
CVTPTR = STORAGE(D2X(PTR2PSA + 16),4)
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO SMCA, THEN GET SMF SYSTEM ID                    */
/*-------------------------------------------------------------------*/
CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
SMFID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
IF (JUNK = SHOW) THEN SAY "SMFID="SMFID
/*-------------------------------------------------------------------*/
/* GET JOBNAME, STEP, AND PROCEDURE                                  */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
IF (JUNK = SHOW) THEN,
  SAY "JOB="JOBNAME", STEP="STEPNAME", PROC="PROCNAME
/*-------------------------------------------------------------------*/
/* GET FMID, PRODUCT LEVEL, AND RELEASE                              */
/*-------------------------------------------------------------------*/
CVTPRODI = STORAGE(D2X(C2D(CVTPTR)+X2D(0E0)-256),8)
CVTPRODN = STORAGE(D2X(C2D(CVTPTR)+X2D(0D8)-256),8)
CVTRELNO = STORAGE(D2X(C2D(CVTPTR)+X2D(0FC)-256),4)
IF (JUNK = SHOW) THEN,
  SAY "FMID="CVTPRODI", LEVEL="CVTPRODN", RELEASE="CVTRELNO
/*-------------------------------------------------------------------*/
/* GET CPU MODEL                                                     */
/*-------------------------------------------------------------------*/
CVTMDL   = C2X(STORAGE(D2X(C2D(CVTPTR)+X2D(0FA)-256),2))
IF (JUNK = SHOW) THEN,
  SAY "CPU="CVTMDL
/*-------------------------------------------------------------------*/
/* GET IPL ADDRESS                                                   */
/*-------------------------------------------------------------------*/
CVTSYSAD = STORAGE(D2X(C2D(CVTPTR)+X2D(030)),4)
UCBVOLI  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(01C)),6)
UCBNAME  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(0D)),3)
IF (JUNK = SHOW) THEN,
  SAY "SYSRES="UCBVOLI", UCB="UCBNAME
/*-------------------------------------------------------------------*/
/* GET IPL PARAMETERS                                                */
/*-------------------------------------------------------------------*/
CVTEXT2  = STORAGE(D2X(C2D(CVTPTR)+X2D(148)),4)
CVTIOCID = STORAGE(D2X(C2D(CVTEXT2)+X2D(06)),2)
CVTNUCLS = STORAGE(D2X(C2D(CVTEXT2)+X2D(04)),2)
IF (JUNK = SHOW) THEN,
  SAY "IO CONFIG="CVTIOCID", NUCLEUS="CVTNUCLS
/*-------------------------------------------------------------------*/
/* GET IPL DATE AND TIME                                             */
/*-------------------------------------------------------------------*/
CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
SMCADATE = C2X(STORAGE(D2X(C2D(CVTSMCA)+340),4))
IPLYY    = SUBSTR(SMCADATE,3,2)
IPLDDD   = SUBSTR(SMCADATE,5,3)
SMCATIME = C2D(STORAGE(D2X(C2D(CVTSMCA)+336),4))
TEMPHR   = SMCATIME / 360000
IPLHR    = TRUNC(TEMPHR,0)
TEMPTIME = SMCATIME - (IPLHR * 360000)
TEMPMN   = TEMPTIME / 6000
IPLMN    = TRUNC(TEMPMN,0)
TEMPTIME = TEMPTIME - (IPLMN * 6000)
TEMPSC   = TEMPTIME / 100
IPLSC    = TRUNC(TEMPSC,0)
TEMPTIME = TEMPTIME - (IPLSC * 100)
IF (JUNK = SHOW) THEN,
  SAY "IPL DATE="IPLYY"."IPLDDD", TIME="IPLHR":"IPLMN":"IPLSC
EXIT 0
./ ADD NAME=LAWCSP   0101-93119-93164-0845-00164-00164-00000-KETCSC
/*=============== INVKCSP - REXX EXEC =============================*/
/*                                                                 */
/* LIB: EXEC(INVKCSP)                                              */
/* GDE: LEIGHTON A. WESTON                                         */
/* DOC: THIS EXEC ALLOCATES LIBRARIES AND INVOKES CSP/370AD        */
/*                                                                 */
/*=============== INVKCSP - REXX EXEC =============================*/

   TRACE ?R
MYRC = 0

SYSPROC = SYSVAR(SYSPROC);
SYSUID  = SYSVAR(SYSUID);

IF (SYSPROC = 'D2DBEVL') THEN,
  DO
    CSPNAME = XDBS.CSPX
    SSID = 'DB2M'
  END

IF (SYSPROC = 'DB2PROD') THEN,
  DO
    CSPNAME = CSP.PROD
    SSID = 'P1DB'
  END

MSG_WAS = MSG(OFF)

/*                    INITALIZATION AREA                             */

MSLRW ="USR1MSL"
DSNRW =SYSUID××.USR1MSL
MSLRO1="SAMPMSL"
DSNRO1=CSPNAME××.SAMPMSL
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"

ADDRESS TSO

SIGNAL ON ERROR

/*          ALLOCATION OF ALL SYSTEMS CSP/370AD FILE               */

/* ALLOCATE USER CLIST LIBRARY                                     */

IF SYSDSN("'"SYSUID".TSO.EZECLST'") ^=OK THEN,
 DO
   "ALLOC FI(EZECLST) DA('"SYSUID".TSO.EZECLST') NEW DIR(05)",
   "BLKSIZE(6160) LRECL(80) RECFM(F B) DSORG(PO) SPACE(02,01)",
   "CYLINDERS UNIT(SYSDA)"
  END
ELSE "FREE FI(EZECLST)"

IF SYSDSN("'"SYSUID".TSO.EZEFOBJ'") ^=OK THEN,
  DO
    "ALLOC FI(EZEFOBJ) DA('"SYSUID".TSO.EZEFOBJ') NEW DIR(15)",
    "BLKSIZE(3200) LRECL(80) RECFM(F B) DSORG(PO) SPACE(2,1)",
    "CYLINDERS UNIT(SYSDA)"
  END
ELSE "FREE FI(EZEFOBJ)"

IF SYSDSN("'"SYSUID".TSO.EZEJCLP'") ^=OK THEN,
  DO
    "ALLOC FI(EZEJCLP) DA('"SYSUID".TSO.EZEJCLP') NEW DIR(08)",
    "BLKSIZE(6160) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(01,01)",
    "CYLINDERS UNIT(SYSDA)"
  END
ELSE "FREE FI(EZEJCLP)"

IF SYSDSN("'"SYSUID".TSO.EZELINK'") ^=OK THEN,
 DO
   "ALLOC FI(EZELINK) DA('"SYSUID".TSO.EZELINK') NEW DIR(08)",
   "BLKSIZE(3200) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(10,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(EZELINK)"

IF SYSDSN("'"SYSUID".TSO.EZEPCTL'") ^=OK THEN,
 DO
   "ALLOC FI(EZEPCTL) DA('"SYSUID".TSO.EZEPCTL') NEW DIR(20)",
   "BLKSIZE(6160) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(10,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(EZEPCTL)"

IF SYSDSN("'"SYSUID".TSO.EZESRC'") ^=OK THEN,
 DO
   "ALLOC FI(EZESRC) DA('"SYSUID".TSO.EZESRC') NEW DIR(20)",
   "BLKSIZE(6160) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(02,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(EZESRC)"

IF SYSDSN("'"SYSUID".TSO.LOAD'") ^=OK THEN,
 DO
   "ALLOC FI(EZELOAD) DA('"SYSUID".TSO.LOAD') NEW DIR(20)",
   "BLKSIZE(6144) LRECL(00) RECFM(U) DSORG(PO) SPACE(10,02)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(EZELOAD)"

IF SYSDSN("'"SYSUID".TSO.OBJECT'") ^=OK THEN,
 DO
   "ALLOC FI(OBJECT) DA('"SYSUID".TSO.OBJECT') NEW DIR(20)",
   "BLKSIZE(3200) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(03,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(OBJECT)"

IF SYSDSN("'"SYSUID".TSO.EZEWORK'") ^=OK THEN,
 DO
   "DEFINE CLUSTER (NAME('"SYSUID".EZEWORK')",
   "CYLINDERS(1 1)",
   "KEYS(14 0)",
   "RECORDSIZE(272 272)",
   "SHR(3 3)",
   "INDEXED)",
   "DATA (NAME('"SYSUID".EZEWORK.DATA'))",
   "INDEX (NAME('"SYSUID".EZEWORK.INDEX'))"
 END

IF SYSDSN("'"SYSUID".TSO.DBRMLIB'") ^=OK THEN,
 DO
   "ALLOC FI(DBRMLIB) DA('"SYSUID".TSO.DBRMLIB') NEW DIR(05)",
   "BLKSIZE(6160) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(02,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(DBRMLIB)"

IF SYSDSN("'"SYSUID".TSO.EZEBIND'") ^=OK THEN,
 DO
   "ALLOC FI(EZEBIND) DA('"SYSUID".TSO.EZEBIND') NEW DIR(05)",
   "BLKSIZE(6160) LRECL(80) RECFM(F,B) DSORG(PO) SPACE(01,01)",
   "CYLINDERS UNIT(SYSDA)"
 END
ELSE "FREE FI(EZEBIND)"


/*    EXECUTION OF CLIST XSPD TO ACCESS CSP ENVIRONMENT            */
"%CSPEZE"
"%CSP370"
SIGNAL OFF ERROR

ENDIT:
MSG_WAS = MSG(MSG_WAS)

EXIT MYRC

ERROR:
MY_LINE = SIGL
MY_RC = RC
SIGNAL OFF ERROR
/*                                                                 */
ADDRESS ISPEXEC
"CONTROL ERRORS RETURN"
ZERRHM = '*'                         /*  ISPF HELP PANEL  */
ZERRALRM = 'NO'                      /*  ALARM STATUS     */
ZERRSM = 'SEVERE ERROR'          /*  SHORT MESSAGE    */
ZERRLM = 'LINE' MY_SIGL 'FAILED WITH RC=' MY_RC
"VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
"SETMSG MSG(ISRZ002)"              /* SIGNAL MSGID      */
MYRC = 4
SIGNAL ENDIT
/*                                                                 */
./ ADD NAME=MODELLDS 0108-93293-93293-1010-00142-00149-00142-DD20008
/* REXX PROGRAM NAME: MODELLDS                                  */
/*                                                              */
/* LIB: XDBS.TSOISPF.CLIST(MODELLDS)                            */
/* GDE: D.BORGES/ DB2 SYSTEMS GROUP                             */
/* DOC: DEFINE A NEW LINEAR DATASET(OUTDS), MODELING IT AFTER AN */
/*      ALREADY EXISTING ONE (INDS). THE NEW LINEAR DATASET     */
/*      WILL ONLY BE ALLOCATED THE SPACE USED, NOT SPACE ALLO-  */
/*      CATED TO ORIGINAL MODEL.                                */
/* NOTE: THIS REXX EXEC IS CURRENTLY SET UP TO BE USED IN       */
/*       BATCH MODE. SAMPLE JCL IN 'XDBS.INSTALL.CNTL(XDBSCHKR)'*/
/*                                                              */
/*                                                              */
   TRACE O
/*                                                              */
ARG LABEL1 INDS LABEL2 OUTDS LABEL3 OUTVOL
   INDS = STRIP(INDS,LEADING)
   OUTDS = STRIP(OUTDS,LEADING)
   OUTVOL = STRIP(OUTVOL,LEADING)
   SAY
   SAY "SYSTSIN CONTROL CARDS"
   SAY "******************************************************"
   SAY LABEL1 INDS
   SAY LABEL2 OUTDS
   SAY LABEL3 OUTVOL
   SAY "******************************************************"
   SAY
/*                                                              */
   CALL ON ERROR NAME ERROR_RTN
   CALL ON FAILURE NAME ERROR_RTN
   SIGNAL ON SYNTAX NAME ERROR_RTN
/*                                                              */
   IF (INDS = " ")
     THEN
       DO
         SAY "INPUT DATA SET NAME MISSING; EXEC TERMINATED"
         RC = 12
         EXIT RC
       END
   IF (OUTDS = " ")
     THEN
       DO
         SAY "OUTPUT DATA SET NAME MISSING; EXEC TERMINATED"
         RC = 12
         EXIT RC
       END
   IF (OUTVOL = " ")
     THEN
       DO
         SAY "OUTPUT VOLUME NOT SPECIFIED; EXEC TERMINATED"
         RC = 12
         EXIT RC
       END
/*                                                              */
   DUMMY = OUTTRAP("SYSOUTLINE.","*")
   "LISTCAT ENTRIES('"INDS"') ALLOC"
/*                                                              */
/* DO  I = 1 TO SYSOUTLINE.0                                    */
/*    START_POS = POS("IN-CAT",SYSOUTLINE.I)                    */
/*    IF START_POS <> 0                                         */
/*      THEN    /* THE "IN-CAT" STRING WAS FOUND "  */          */
/*        DO                                                    */
/*          PARSE VAR SYSOUTLINE.I . . CATLG                    */
/*          SAY CATLG                                           */
/*        END                                                   */
/*  END                                                         */
/*                                                              */
   DO  I = 1 TO SYSOUTLINE.0
      START_POS = POS("HI-USED-RBA",SYSOUTLINE.I)
      IF START_POS <> 0
        THEN    /* THE "HI-USED-RBA" STRING WAS FOUND "  */
          DO
            END_POS = START_POS + 23  /* MARK END OF STRING */
            CALL EXTRACT_RBA  START_POS,END_POS,SYSOUTLINE.I
            HI_USED_RBA = RESULT      /* THIS VAR CONTAINS RBA VALUE */
            CALL RBA2TRKS HI_USED_RBA /* CONVERT RBA VALUE TO TRACKS */
            CALL DFNCLSTR INDS,OUTDS,PRIMARY,SECONDARY,OUTVOL
            LEAVE
          END
   END
   DUMMY = OUTTRAP("OFF")
   SAY
   SAY "RC(0)"
   EXIT
/*                                                              */
   EXTRACT_RBA: PROCEDURE
   ARG START_POS,END_POS,DISPLAY_LINE
   NUMERIC_STRING = "NO"
   NEW_START = START_POS + 11
   STRNG_LEN = (END_POS - NEW_START) + 1
   DO WHILE NUMERIC_STRING = "NO"
      NEXT_CHAR = SUBSTR(DISPLAY_LINE,NEW_START,1)
      IF DATATYPE(NEXT_CHAR) = "NUM"
        THEN
           DO
              NUMERIC_STRING = "YES"
              HI_RBA = SUBSTR(DISPLAY_LINE,NEW_START,END_POS)
           END
        ELSE NEW_START = NEW_START + 1
   END
   RETURN HI_RBA
/*                                                              */
   RBA2TRKS: PROCEDURE EXPOSE PRIMARY SECONDARY
   ARG HI_RBA
      BYTES_PER_3380_TRK = 49151
      TRACKS = HI_RBA % BYTES_PER_3380_TRK
      PRIMARY = TRACKS
      IF TRACKS > 16
         THEN SECONDARY = TRACKS % 16
         ELSE SECONDARY = 1
/*    PRI_RECORDS = (TRACKS * 12) + 1                           */
/*    SEC_RECORDS = PRIMARY % 16                             */
   RETURN
/*                                                              */
   DFNCLSTR: PROCEDURE
   ARG INDS,OUTDS,PRIMARY,SECONDARY,OUTVOL
/*                                                                  */
/* DEFINE_CMD = '"' ×× "DEF CL " ××,              */
/*              "(NAME('" ×× OUTDS ×× "') " ××,       */
/*              "MODEL('" ×× INDS ×× "') " ××,        */
/*              "VOL(" ×× OUTVOL  ×× ") " ××,     */
/*              "TRK(" ×× PRIMARY SECONDARY  ×× "))" ×× '"'  */
/*                                                                  */
/*                                                                  */
   INDS_D  = OVERLAY('DSNDBD',INDS,INDEX(INDS,'DSNDBC'))
   OUTDS_D = OVERLAY('DSNDBD',OUTDS,INDEX(OUTDS,'DSNDBC'))
/*                                                                  */
   ADDRESS TSO,
  "DEF CL (NAME('"OUTDS"') ",
  "VOL("OUTVOL") MODEL('"INDS"')) ",
  "DATA (NAME('"OUTDS_D"') VOL("OUTVOL") ",
  "TRK("PRIMARY SECONDARY")) "
/*                                                                  */
   RETURN
/*                                                              */
   ERROR_RTN:
       MYRC = RC
       SAY "ERROR ON LINE" SIGL
       SAY "LINE CONTAINING ERROR IS" SOURCELINE(SIGL)
       SAY "THE PROBLEM IS IN:" CONDITION("D")
       SAY "ERROR MESSAGE FROM REXX IS " ERRORTEXT(RC)
       SAY "THE RETURN CODE WAS " MYRC
   EXIT MYRC
./ ADD NAME=MYINDEX  0114-93274-93323-0846-00252-00254-00041-KETCSC
/*---------REXX INDEX$ -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(INDEX$)  */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST USES ISPF LIBRARY SERVICES TO BUILD A TABLE     */
/*      AND ALLOWS COMMAND PROCESSING FROM THERE.                  */
/*                                                      */
/*---------REXX INDEX$ -------------------------------*/
ISREDIT MACRO
/*                                                                 */
PARSE ARG DEBUG
    MYID = SYSVAR(SYSUID)
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    "GETIDS"
    ADDRESS ISPEXEC "VGET (SYSID)"
    SYSI = SUBSTR(SYSID,1,3)
    ZERRLM = " "
AGAIN:
    ADDRESS ISREDIT "X 'OR CHANGED' ALL"
    ADDRESS ISREDIT "X 'FROM 8' ALL"
    ADDRESS ISREDIT "X 'FROM 9' ALL"
    ADDRESS ISREDIT "DEL X ALL"
    ADDRESS ISREDIT "(DATASET) = DATASET"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    PDSDSN = "'"DATASET"'"
    MYCC = LISTDSI(PDSDSN)
    IF (SYSDSORG ^= "PO") THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE NOT A PDS"
          ZERRLM = "THE FILE" PDSDSN "IS NOT A PDS"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
    TITLE     = CENTER(CTRAREA,80," ")
    IF (DEBUG = "DEBUG") THEN ,
      DO
          PROGMSG1 =  "CHECKING"
          PROGMSG2 =  " "
          PROGMSG3 =  "MEMBER LIST :" PDSDSN
          PROGMSG4 =  " "
          PROGMSG5 =  " "
        ADDRESS ISPEXEC "CONTROL DISPLAY LOCK"
        ADDRESS ISPEXEC "DISPLAY PANEL(PROGRESS)"
      END
      PDSDSN = PDSDSN
    ADDRESS ISPEXEC "LMINIT DATAID(PDSID)",
      "DATASET("PDSDSN") ENQ(SHR)"
    IF (RC ^= 0) THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE IN USE"
          ZERRLM = "THE FILE" PDSDSN "IS IN USE"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
    ADDRESS ISPEXEC "LMOPEN DATAID("PDSID")",
      "OPTION(INPUT)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
          ZERRSM = "FILE FAILED TO OPEN"
          ZERRLM = "THE FILE" PDSDSN "FAILED TO"
          ZERRLM = ZERRLM "OPEN RC="MYCC
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
        SIGNAL ABNEXIT
      END
        MYCTR = 0
PDSREAD:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID")",
      "OPTION(LIST) MEMBER(PDSMBR) STATS(YES)"
      MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
        ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
        ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
        SIGNAL DISPLAY
      END
    MECMD =  " "
    MEMBR     = PDSMBR
    MEPGMR = ZLUSER
    IF (SYSI = "DOF") THEN SIGNAL DOFIDS
MVSIDS:
    IF (MEPGMR = "DD20001") THEN    MEPGMR = "PETE"
    IF (MEPGMR = "DD20002") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20003") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20004") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "DB2CSC"
    IF (MEPGMR = "DD20005") THEN    MEPGMR = "MJLCSC"
    IF (MEPGMR = "DD20006") THEN    MEPGMR = "MANN"
    IF (MEPGMR = "DD20007") THEN    MEPGMR = "LAWCSC"
    IF (MEPGMR = "DD20008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "KETCSC"
    IF (MEPGMR = "DD20009") THEN    MEPGMR = "FMMCSC"
    IF (MEPGMR = "DD20011") THEN    MEPGMR = "ACSCFSG"
    IF (MEPGMR = "DD20010") THEN ,
        MEPGMR = "MANN PETE ACSCFSG MJLCSC LAWCSC FMMCSC"
    IF (MEPGMR = "DB2CSC") THEN ,
        MEPGMR = "MANN PETE ACSCFSG MJLCSC LAWCSC FMMCSC"
    IF (MEPGMR = " ") THEN ,
        MEPGMR = "KETCSC"
    SIGNAL DOIT
DOFIDS:
    IF (MEPGMR = "PETE") THEN    MEPGMR = "DD20001"
    IF (MEPGMR = "DB2CSC") THEN    MEPGMR = "DD20010"
/*  IF (MEPGMR = "DD20003") THEN    MEPGMR = "DB2CSC"           */
    IF (MEPGMR = "SERCSC") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "BORGY") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "MJLCSC") THEN    MEPGMR = "DD20005"
    IF (MEPGMR = "MANN") THEN    MEPGMR = "DD20006"
    IF (MEPGMR = "LAWCSC") THEN    MEPGMR = "DD20007"
    IF (MEPGMR = "KETCSC") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "DOFN008") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "DMV0016") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "TS01KT") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "TS03KT") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "SYS004") THEN    MEPGMR = "DD20008"
    IF (MEPGMR = "FMMCSC") THEN    MEPGMR = "DD20009"
    IF (MEPGMR = "ACSCFSG") THEN    MEPGMR = "DD20011"
    IF (MEPGMR = "DD20010") THEN ,
        MEPGMR = "DD20001 DD20005 DD20006 DD20007 DD20009 DD20011"
    IF (MEPGMR = "DB2CSC") THEN ,
        MEPGMR = "DD20001 DD20005 DD20006 DD20007 DD20009 DD20011"
    IF (MEPGMR = " ") THEN ,
        MEPGMR = "DD20008"
DOIT:
    MECREAT = ZLCDATE
    MEVM      = ZLVERS"."ZLMOD
    MECHGDT = ZLMDATE
    MECHGTM = ZLMTIME
    ADDRESS ISREDIT "F '"PDSMBR"' 3 FIRST"
      MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        SIGNAL PDSREAD
      END
    CHGMEM = SUBSTR(PDSMBR"        ",1,8)
    ALPHABIT = "@$#ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    MBREND = LENGTH(CHGMEM)
/* -------------------------------------------------------------- */
/*       FIND CLOSEST MATCH                                       */
/* -------------------------------------------------------------- */
PARTNAME:
    MBREND = MBREND - 1
    IF (MBREND < 1) THEN SIGNAL NEXTLETR
    CHGMEM = SUBSTR(CHGMEM"       ",1,MBREND)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 FIRST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL PARTNAME
/* -------------------------------------------------------------- */
/*       NOT THERE, FIND NEXT CLOSEST LETTER BEFORE               */
/* -------------------------------------------------------------- */
NEXTLETR:
    PLTR = POS(CHGMEM,ALPHABIT)
    IF (PLTR < 1) THEN,
      DO
        ADDRESS ISREDIT "CURSOR = .ZLAST 1"
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    PLTR = PLTR - 1
    CHGMEM = SUBSTR(ALPHABIT,PLTR,1)
    ADDRESS ISREDIT "F '"CHGMEM"' 3 LAST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL NEXTLETR
ADDIT:
    IF (MEPGMR = MYID) THEN ,
      DO
          MEMBER = PDSMBR
        ADDRESS ISPEXEC "BROWSE DATASET('"DATASET"("MEMBER")')"
        ADDRESS ISPEXEC "DISPLAY PANEL(SAVPNL)"
          MYCC = RC
        IF (MYCC ^= 0) THEN ,
          DO
              ZERRHM = "*"
              ZERRALRM = "YES"
              ZERRSM = "$INDEX REQUIRED"
              ZERRLM = "YOU MUST ENTER A DESCRIPTION"
              ZERRLM = ZERRLM "FOR" CHGMEM
            ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
              "ZERRHM ZERRALRM) SHARED"
            ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
            SIGNAL ADDIT
          END
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
          "'  "PDSMBR"  "DESC"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
      DO
       SAY DASHES "FAILED INSERT RC="MYCC
      END
          DASHES = "  -------- "
          DASHES = DASHES "------------------------"
          DASHES = DASHES"------------------------"
          DASHES = DASHES"------------------------"
          DASHES = SUBSTR(DASHES"------------------------",1,72)
        ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
            "'"DASHES"'"
          MYCC = RC
        IF (MYCC > 0) THEN ,
          DO
       SAY DASHES "FAILED INSERT RC="MYCC
          END
      END
      MYCTR = MYCTR + 1
    SIGNAL PDSREAD
ABNEXIT:
    ADDRESS ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    ADDRESS ISPEXEC "LMCLOSE DATAID("PDSID")"
    ADDRESS ISPEXEC "LMFREE DATAID("PDSID")"
    IF (ZERRLM ^= " ") THEN EXIT 4
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
      ZERRSM = "ADDED" MYCTR
      ZERRLM = "I HAD TO ADD" MYCTR "ENTRIES"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"      /* SIGNAL MSGID      */
    EXIT 4
/* -------------------------------------------------------------- */
/*       DISPLAY TABLE                                            */
/* -------------------------------------------------------------- */
DISPLAY:
      ZERRHM = "*"                             /*  ISPF HELP PANEL  */
      ZERRALRM = "NO"                          /*  ALARM STATUS     */
      ZERRSM = "ADDED" MYCTR
      ZERRLM = "I HAD TO ADD" MYCTR "ENTRIES"
    ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
    ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"     /* SIGNAL MSGID      */
/*                                                                 */
    EXIT 0
./ ADD NAME=OMGINST  0107-93341-94021-1413-00102-00090-00100-KETCSC
/*---------REXX OMGINST -------------------------------*/
/*                                                     */
/* LIB: XDBS.TSOISPF.EXEC(OMGINST)                     */
/* GDE: KETCSC                                         */
/* DOC: THIS REXX EXEC ALLOCATES OMEGAMON II FOR DB2   */
/*      AND RUNS THE CUSTOMIZATION CLIST.              */
/*                                                     */
/*---------REXX OMGINST -------------------------------*/
PARSE UPPER ARG DB2ID CUST JUNK
    IF (CUST = "YES") × (CUST = "Y") THEN
        CUST = "YES"
    ELSE,
        CUST = "NO"
    IF (DB2ID = "") THEN,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "DB2ID REQUIRED"
        ZERRLM = "YOU MUST SUPPLY A DB2 SUBSYSTEM ID"
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        EXIT 4
      END
BEGIN:
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    PTR2PSA = 0
    CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
    CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
    SYSID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
    CHCKSSID DB2ID
    MYCC = RC
    ADDRESS TSO,
      ALTLIB "DEACTIVATE APPLICATION(CLIST)"
    IF (MYCC = 0) THEN SIGNAL ITSGOOD
    SAY "DB2 SUBSYSTEM "DB2ID" IS NOT INSTALLED ON",
      SYSID", TRY ANOTHER."
    EXIT 16
 /*----------------------------------------------------*/
 /*           TSO AND ISPF DATASETS                    */
 /*----------------------------------------------------*/
ITSGOOD:
    V250OK = SYSDSN("'"DB2ID".OMEGDB2.CLIST'")
    IF (V250OK = "OK") THEN,
        ADDRESS TSO ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".OMEGDB2.CLIST')"
    MYCC = RC
    IF (MYCC = 0) THEN SIGNAL ITSOKAY
    IF (CUST = "YES") × (CUST = "Y") THEN
        CUST = "Y"
    ELSE,
        CUST = "N"
    V260OK = SYSDSN("'"DB2ID".OMEGDB2.TO2CLIST'")
    IF (V260OK = "OK") THEN,
        ADDRESS TSO ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".OMEGDB2.TO2CLIST')"
    MYCC = RC
    IF (MYCC = 0) THEN SIGNAL ITSOKAY
    V260OK = SYSDSN("'"DB2ID".TOMGDB2.TARGET.TO2CLIST'")
    IF (V260OK = "OK") THEN,
        ADDRESS TSO ALTLIB "ACTIVATE APPLICATION(CLIST)",
          "DATASET('XDBS.TSOISPF.EXEC'",
                  "'XDBS.TSOISPF.CLIST'",
                  "'"DB2ID".TOMGDB2.TARGET.TO2CLIST')"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        ZERRHM = "*"
        ZERRALRM = "NO"
        ZERRSM = "REQUEST FAILED"
        ZERRLM = "CLIST ALTLIB FAILED "MYCC
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        EXIT 4
      END
/* */
 /*----------------------------------------------------*/
 /*       INVOKE THE PRODUCT                           */
 /*----------------------------------------------------*/
ITSOKAY:
    ADDRESS ISPEXEC "VPUT (DB2ID) SHARED"
    IF (V250OK = "OK") THEN,
      DO
        ADDRESS ISPEXEC "SELECT CMD(SETOMGOP" DB2ID") NEWAPPL(O2AP)"
        O2SPF "O2CUST("CUST")"
      END
    IF (V260OK = "OK") THEN,
      DO
        ADDRESS ISPEXEC "SELECT CMD(SETOMGOP" DB2ID") NEWAPPL(O2AP)"
        KO2SPF "CUST("CUST")"
      END
    MYCC = RC
 /*----------------------------------------------------*/
 /*       FREE THE MESS ALLOCATED                      */
 /*----------------------------------------------------*/
    ADDRESS TSO,
      ALTLIB "DEACTIVATE APPLICATION(CLIST)"
QMFXIT:
    EXIT 0
./ ADD NAME=PASTE
/* REXX ***************************************************************/
/***                                                                  */
/*** ISPF/PDF edit macro to write lines from the user PROFILE pool    */
/*** into the current file.  This macro is used in conjunction with   */
/*** the CUT macro.                                                   */
/***                                                                  */
/*** To run:                                                          */
/***   Enter PASTE on the COMMAND line and use the A or B line        */
/***   command to specify where the lines are to be pasted.           */
/***                                                                  */
/***   A parameter of K or KEEP can be specified to prevent the macro */
/***   from setting the profile variables to null after the lines     */
/***   have been pasted into the file.                                */
/***                                                                  */
/***   If line truncation occurs, the profile variables will not be   */
/***   set to null.  When this occurs, edit a data set with a large   */
/***   enough record length or use CUT REPLACE to replace the lines   */
/***   in the PROFILE pool.                                           */
/**********************************************************************/
Trace
Address ISPEXEC

'ISREDIT MACRO (PARM1) NOPROCESS'
parm1 = translate(parm1)
If parm1 = '?' Then
  Do
    Call help
    Exit
  End

If parm1 ^= ' ' & parm1 ^= 'K' & parm1 ^= 'KEEP' Then
  Do
    zedsmsg = 'Invalid parameter'
    zedlmsg = 'Use ? for help, K or KEEP to prevent variable deletion'
    'SETMSG MSG(ISRZ001)'
    Exit 12
  End

/* Process line commands, check if A or B was specified              */
'CONTROL ERRORS RETURN'
'ISREDIT PROCESS DEST'
Select
  When rc = 0 Then
    'ISREDIT (ZDEST) = LINENUM .ZDEST'
  When rc <= 8 Then /* No A or B entered */
    Do
       zedsmsg = 'Enter "A"/"B" line cmd'
       zedlmsg = 'PASTE requires an "A" or "B" line command'
       'SETMSG MSG(ISRZ001)'
       Exit 12
    End
  When rc < 20 Then /* Conflicting line commands - edit sets message */
    Exit 12
  When rc = 20 Then
    zdest = 0
  Otherwise
    Exit 12
End
'CONTROL ERRORS CANCEL'

/* Get the number of lines variable                                  */
'VGET (CUTCNT,CUTCNTMX) PROFILE'
If rc ^= 0 Then
  Do
    zedsmsg = 'Use CUT before PASTE'
    zedlmsg = 'The CUTCNT profile variable was not found-use CUT first'
    'SETMSG MSG(ISRZ001)'
    Exit 12
  End
If cutcnt <= 0 Then
  Do
    zedsmsg = 'Use CUT before PASTE'
    zedlmsg = 'No data has been stored via the CUT macro'
    'SETMSG MSG(ISRZ001)'
    Exit 12
  End

trunccnt = 0
cutcount = cutcnt
/* get each cut line from the profile and add it to the file         */
Do i = cutcnt to 1 by -1
  'VGET (CL'i') PROFILE'
  'ISREDIT LINE_AFTER 'zdest' = DATALINE (CL'i')'
  If rc = 4 Then trunccnt = trunccnt + 1
End


/* If KEEP parameter not given and no lines were truncated, set to    */
/* null all variables stored in the profile.  Variable cutcntmx       */
/* contains the number of lines cut but not deleted.                  */
If parm1 ^= 'K' & parm1 ^= 'KEEP' & trunccnt = 0 Then
  Do
    'VGET (ZENVIR) SHARED'
    Do i = 1 to cutcntmx by 1
      'VERASE (CL'i') PROFILE'
    End
    cutcnt   = 0
    cutcntmx = 0
    'VPUT (CUTCNT,CUTCNTMX) PROFILE'
  End

/* Check if truncation occurred, if so display message                */
If trunccnt > 0 Then
  Do
    zedsmsg = trunccnt 'lines truncated'
    msg     = 'Current record length shorter than origin'
    zedlmsg = msg '-' trunccnt 'of' cutcount 'records were truncated'
    'SETMSG MSG(ISRZ001)'
  End
Else
  Do
    zedsmsg = cutcount 'lines pasted'
    zedlmsg = cutcount 'lines were pasted into the current file'
    'SETMSG MSG(ISRZ000)'
  End

line1 = zdest + 1
'ISREDIT CURSOR = 'line1 0
Exit

help:
Say '                                                                '
Say ' ISPF/PDF edit macro to write lines from the user PROFILE pool  '
Say ' into the current file. This macro is used in conjunction with  '
Say ' the CUT macro.                                                 '
Say '                                                                '
Say ' To run:                                                        '
Say '  Enter PASTE on the COMMAND line and use the A or B line       '
Say '  command to specify where the lines are to be pasted.          '
Say '                                                                '
Say '  A parameter of K or KEEP can be specified to prevent the macro'
Say '  from setting the profile variables to null after the lines    '
Say '  have been pasted into the file.  If you want to paste the same'
Say '  set of lines many places, specify the K or KEEP parameter.    '
Say '                                                                '
Say '  If line truncation occurs, the profile variables will not be  '
Say '  set to null.  If this occurs, edit a data set with a large    '
Say '  enough record length or use CUT REPLACE to replace the lines  '
Say '  in the PROFILE pool.                                          '
Say '                                                                '
Return
./ ADD NAME=PEEK     0100-93084-93084-1446-00012-00012-00000-KETCSC
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(REXXID)                                            */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: RETRIEVES THE SYSID FOR THE SYSTEM ENVIRONMENT               */
/*      FOR ISPEXEC DISPLAY                                          */
/*                                                                   */
/*-------------------------------------------------------------------*/
PTR2CVT = STORAGE(10,4)
PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
SAY 'SYSTEM ID IS:'SYSID
./ ADD NAME=REXXDW   0100-93022-93022-0857-00033-00033-00000-KETCSC
/*------------------ REXX1    - REXX -----------------------------*/
/*                                                                */
/* LIB: REXX.EXEC(REXX1)                                          */
/* GDE: SC28-1882 TSO Extensions Version 2: Procedures Language   */
/*      MVS/REXX User's Guide                                     */
/* DOC: Add a dataset to the front of any ddname concatenation.   */
/*                                                                */
/*----------------------------------------------------------------*/

TRAPALC:
    QUEUE 'ABOUT TO ALLOC'
    x = Outtrap('name.')
    "ALLOC FILE(TEMP) DATASET('KETCSC.JCL.CNTL(TEMP)') SHR"
    MYRC = RC
    x = Outtrap('OFF')
    QUEUE 'ALLOC RC=' MYRC

/******************************************************************/
/* QUEUE ON THE STACK.                                            */
/******************************************************************/
    DO I = 1 TO NAME.0 BY 1
      QUEUE NAME.I
    END

/******************************************************************/
/* WRITE IT OUT.                                                  */
/******************************************************************/
    "EXECIO * DISKW TEMP (FINIS"
    MYRC = RC
    SAY 'DID IT WORK' MYRC
    ADDRESS ISPEXEC "EDIT DATASET('KETCSC.JCL.CNTL(TEMP)'"

    Exit MYRC
./ ADD NAME=SAV      0102-93194-93200-2216-00054-00054-00011-KETCSC
/*---------REXX SAV --------------------------------*/
/*                                                  */
/* LIB: XDBS.TSOISPF.EXEC(SAV)                      */
/* GDE: KENNETH E. TOMIAK                           */
/* DOC: THIS EDIT MACRO ENFORCES THE $INDEX UPDATE. */
/*                                                  */
/*---------REXX SAV --------------------------------*/
    ISREDIT MACRO
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISREDIT "(DATASET) = DATASET"
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    IF (MEMBER = "$INDEX") THEN SIGNAL ENDIT
    CHANGED = YES
    IF (CHANGED = "YES") THEN ,
      DO
        CHKIDX = SYSDSN("'"DATASET"($INDEX)'")
        IF (CHKIDX = "OK") THEN ,
          DO
            CHGMEM = MEMBER
            ADDRESS ISPEXEC "VPUT (CHGMEM)"
            ADDRESS ISPEXEC "EDIT DATASET('"DATASET"($INDEX)')",
              "MACRO(SAVMAC)"
            ADDRESS ISPEXEC "VGET (EXITCC)"
            MYCC = EXITCC
            IF (MYCC = 0) THEN ,
              DO
                ZERRHM = "*"
                ZERRALRM = "NO"
                ZERRSM = "$INDEX HAS IT"
                ZERRLM = "IT IS NICE TO HAVE THE $INDEX"
                ZERRLM = ZERRLM "MEMBER UPDATED ISN'T IT?"
                ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
                  "ZERRHM ZERRALRM) SHARED"
                ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
              END
            IF (MYCC = 4) THEN ,
              DO
                ZERRHM = "*"
                ZERRALRM = "NO"
                ZERRSM = "THANKS"
                ZERRLM = "IT IS NICE TO HAVE YOU"
                ZERRLM = ZERRLM "UPDATE THE $INDEX MEMBER"
                ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM",
                  "ZERRHM ZERRALRM) SHARED"
                ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
              END
          END
/*===================================================================*/
/*  SAVE MEMBER                                                      */
/*===================================================================*/
        ADDRESS ISREDIT "SAVE"
      END
ENDIT:
    EXIT RC
./ ADD NAME=SAVMAC   0120-93194-93205-1303-00145-00058-00103-KETCSC
/*---------REXX SAVMAC -------------------------------*/
/*                                                      */
/* LIB: XDBS.TSOISPF.EXEC(SAVMAC)          */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EDIT MACRO PROMPTS FOR THE DESCRIPTION AND DOES THE    */
/*      INSERT AT THE BOTTOM OF THE MEMBER.                         */
/*                                                      */
/*---------REXX SAVMAC -------------------------------*/
    ISREDIT MACRO
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    ADDRESS ISPEXEC "VGET (CHGMEM)"
    MEMBER = SUBSTR(CHGMEM"        ",1,8)
/* -------------------------------------------------------------- */
/*       REMOVE IT IF IT HAS NOT BEEN PROPERLY DESCRIBED          */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "X 'OR CHANGED' ALL"
    ADDRESS ISREDIT "X 'FROM 8' ALL"
    ADDRESS ISREDIT "X 'FROM 9' ALL"
    ADDRESS ISREDIT "X ')ATTR' ALL"
    ADDRESS ISREDIT "X ')BODY' ALL"
    ADDRESS ISREDIT "X ')INIT' ALL"
    ADDRESS ISREDIT "X ')PROC' ALL"
    ADDRESS ISREDIT "X ')END' ALL"
    ADDRESS ISREDIT "X ')MODEL' ALL"
    ADDRESS ISREDIT "X '%COMMA' ALL"
    ADDRESS ISREDIT "X '%OPTIO' ALL"
    ADDRESS ISREDIT "X '%-\-\-' ALL"
    ADDRESS ISREDIT "X '@ TYPE' ALL"
    ADDRESS ISREDIT "X '# TYPE' ALL"
    ADDRESS ISREDIT "X '$ TYPE' ALL"
/* -------------------------------------------------------------- */
/*       SEARCH TO SEE IF IT IS THERE                             */
/* -------------------------------------------------------------- */
SRCHIT:
    ADDRESS ISREDIT "F '"CHGMEM"' 3 WORD NX FIRST"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        EXITCC = 0
        SIGNAL ENDIT
      END
    ADDRESS ISREDIT "F ' ' ALL"
    MYCC = RC
    ADDRESS ISREDIT "X '"CHGMEM"' 3 WORD"
    MYCC = RC
    ADDRESS ISREDIT "DEL X ALL"
NEEDIT:
    ADDRESS ISREDIT "CURSOR = .ZFIRST 1"
    ADDRESS ISPEXEC "DISPLAY PANEL(SAVPNL)"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        ZERRHM = "*"
        ZERRALRM = "YES"
        ZERRSM = "$INDEX REQUIRED"
        ZERRLM = "YOU MUST ENTER A DESCRIPTION"
        ZERRLM = ZERRLM "FOR" CHGMEM
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL NEEDIT
      END
    ADDRESS ISREDIT "CURSOR = .ZLAST 1"
    ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
    ADDRESS ISREDIT "CURSOR = .ZFIRST 1"
    ALPHABIT = "@$#ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    MEMBR = STRIP(CHGMEM,T," ")
/* -------------------------------------------------------------- */
/*       COPY ISPF DIRECTORY STATISTICS INTO MY VARIABLES         */
/* -------------------------------------------------------------- */
    MECREAT = ZLCDATE
    MEVM      = ZLVERS"."ZLMOD
    MECHGDT = ZLMDATE
    MECHGTM = ZLMTIME
/* -------------------------------------------------------------- */
/*       NOT THERE                                                */
/* -------------------------------------------------------------- */
    ADDRESS ISREDIT "CURSOR = .ZLAST 1"
    ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
    MBREND = LENGTH(MEMBR) + 1
/* -------------------------------------------------------------- */
/*       FIND CLOSEST MATCH                                       */
/* -------------------------------------------------------------- */
PARTNAME:
    MBREND = MBREND - 1
    IF (MBREND < 1) THEN SIGNAL NEXTLETR
    MEMBR = SUBSTR(MEMBR"         ",1,MBREND)
    ADDRESS ISREDIT "F '"MEMBR"' 3 FIRST NX"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL PARTNAME
/* -------------------------------------------------------------- */
/*       NOT THERE, FIND NEXT CLOSEST LETTER BEFORE               */
/* -------------------------------------------------------------- */
NEXTLETR:
    PRIOR_LETTER = POS(MEMBR,ALPHABIT)
    IF (PRIOR_LETTER < 1) THEN,
      DO
        ADDRESS ISREDIT "CURSOR = .ZLAST 1"
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    PRIOR_LETTER = PRIOR_LETTER - 1
    MEMBR = SUBSTR(ALPHABIT,PRIOR_LETTER,1)
    ADDRESS ISREDIT "F '"MEMBR"' 3 LAST NX"
    MYCC = RC
    IF (MYCC = 0) THEN ,
      DO
        ADDRESS ISREDIT "(LPTR,COL) = CURSOR"
        SIGNAL ADDIT
      END
    SIGNAL NEXTLETR
/* -------------------------------------------------------------- */
/*       ONE WAY OR THE OTHER ADD IT, MAYBE AT BOTTOM             */
/* -------------------------------------------------------------- */
ADDIT:
    ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
      "'  "MEMBER"  "DESC"'"
    MYCC = RC
    IF (MYCC > 0) THEN ,
      DO
        SAY DASHES "FAILED INSERT RC="MYCC
      END
    DASH   = COPIES("-",72)
    DASHES = "  -------- "
    DASHES = SUBSTR(DASHES DASH,1,72)
    ADDRESS ISREDIT "LINE_AFTER" LPTR "= DATALINE",
        "'"DASHES"'"
    MYCC = RC
    IF (MYCC > 0) THEN ,
      DO
        SAY DASHES "FAILED INSERT RC="MYCC
      END
    ADDRESS ISREDIT "SAVE"
    EXITCC = 4
/*===================================================================*/
/*  EXIT EDIT ON $INDEX                                              */
/*===================================================================*/
ENDIT:
    ADDRESS ISPEXEC "VPUT (EXITCC)"
    ADDRESS ISREDIT "END"
    EXIT EXITCC
./ ADD NAME=SDSFEXTR 0109-93252-93252-1458-00119-00114-00013-KETCSC
/*============== SDSFEXTR - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(SDSFEXTR)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC PROCESSES OUTPUT USING SDSF.                      */
/*                                                                  */
/*============== SDSFEXTR - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    PARSE ARG HILVL JUNK
    SAY 'RUN ON ' DATE() ' AT ' TIME() 'FOR' HILVL '.'
    IF (HILVL = "") THEN,
      DO
        SAY "YOU MUST PROVIDE THE PREFIX, I'LL ATTACH THE *"
        EXIT 4
      END

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    CDATE = DATE('J')
    YY   = SUBSTR(CDATE,1,2)
    DDD  = SUBSTR(CDATE,3,3)
    "ALLOC FILE(ISFIN) DATASET('KETCSC.JCL.CNTL(ISFIN)') SHR REUSE"
    "DELETE 'KETCSC.ISFOUT'"
    "ALLOC FILE(ISFOUT) DATASET('KETCSC.ISFOUT') NEW CATALOG",
      "SPACE(15,15) TRACKS RECFM(F B) BLKSIZE(1470) LRECL(147)"
    QUEUE "PREFIX" HILVL"*"
    QUEUE "H"
    QUEUE "++ALL"
    QUEUE ""
/*========================================================*/
/* WRITE OUT STACK.                                       */
/*========================================================*/
    "EXECIO * DISKW ISFIN (FINIS"
    SDSF '++24,132'
    SDSFRC = RC
    IF (SDSFRC ^= 0) THEN,
      DO
        SAY 'SDSF RC='SDSFRC
        EXIT SDSFRC
      END

    INDX = 0
/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
    "EXECIO * DISKR ISFOUT(STEM RECORD. FINIS"
    DO R = 1 TO RECORD.0 BY 1
      ISITCICS = INDEX(RECORD.R,HILVL)
      IF (ISITCICS > 0) THEN,
        DO
          PARSE VAR RECORD.R STCNAME TYPE STCNBR JUNK
          INDX = INDX + 1
          ARYNAME.INDX = STCNAME
          ARYNBR.INDX = STCNBR
        END
    END
/*========================================================*/
/* PROCESS THE ARRAY                                      */
/*========================================================*/
    IF (INDX > 0) THEN,
      DO
        SAY "PROCESSING" INDX "ENTRIES."
        DO R = 1 TO INDX BY 1
          SAY "#"INDX ARYNAME.R ARYNBR.R
          "FREE FILE(ISFIN)"
          "DELETE 'KETCSC.ISFIN'"
          "ALLOC FILE(ISFIN) DATASET('KETCSC.ISFIN') NEW CATALOG",
            "SPACE(5,5) TRACKS RECFM(F B) BLKSIZE(8000) LRECL(80)"
          "FREE FILE(ISFOUT)"
          "DELETE 'KETCSC.ISFOUT'"
          "ALLOC FILE(ISFOUT) SYSOUT(V)"
          "ALLOC FILE(TEMP)",
            "DATASET('XDBS."ARYNAME.R××,
            ".STC"ARYNBR.R"')",
            "NEW CATALOG DSORG(PS)",
            "SPACE(45,45) TRACKS RECFM(F B) BLKSIZE(1470) LRECL(147)"
          "FREE FILE(TEMP)"
          QUEUE "PREFIX" ARYNAME.R
          QUEUE "H"
          QUEUE "F" ARYNAME.R
          QUEUE "++S"
          QUEUE "PRINT ODSN 'XDBS."ARYNAME.R××,
            ".STC"ARYNBR.R"' * OLD"
          QUEUE "PRINT"
          QUEUE "PRINT CLOSE"
          QUEUE ""
/*========================================================*/
/* WRITE OUT STACK.                                       */
/*========================================================*/
          "FREE FILE(ISFIN)"
          "DELETE 'KETCSC.ISFIN'"
          "ALLOC FILE(ISFIN) DATASET('KETCSC.ISFIN') NEW CATALOG",
            "SPACE(5,5) TRACKS RECFM(F B) BLKSIZE(8000) LRECL(80)"
          "EXECIO * DISKW ISFIN (FINIS"
          SDSF '++24,132'
          IF RC ^= 0 THEN
            DO
              SAY 'SDSF RC='RC
              EXIT RC
            END
          SAY 'SDSF RC='RC
          MINITYPE = SUBSTR(ARYNBR.R,1,1)
          QUEUE "/$C"MINITYPE××ARYNBR.R",P"
          QUEUE "LOG"
        END
      END
    ELSE,
      DO
        SAY "NO WORK TO PROCESS"
      END

    "FREE FILE(ISFIN)"
    "FREE FILE(ISFOUT)"
    "DELETE 'KETCSC.ISFIN'"
    "DELETE 'KETCSC.ISFOUT'"
    EXIT 0
./ ADD NAME=SETOMGOP 0100-94021-94021-1412-00013-00013-00000-KETCSC
/************** SETOMGOP - REXX EXEC ********************************/
/*                                                                  */
/* LIB: EXEC(SETOMGOP)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC USES THE PASSED DB2 SUBSYSTEM TO BUILD THE        */
/*      OMEGAMON VARIABLES O2DB2ID O2APPL.                          */
/*                                                                  */
/************** SETOMGOP - REXX EXEC ********************************/
    ARG DB2ID
    O2DB2ID = DB2ID
    O2APPL = "OMEG"DB2ID
    ADDRESS ISPEXEC "VPUT (O2DB2ID O2APPL) PROFILE"
    EXIT
./ ADD NAME=SF       0102-93209-93209-1455-00059-00048-00000-DMV0016
/*---------REXX SF -------------------------------*/
/*                                                */
/* LIB: XDBS.TSOISPF.EXEC(SF)                     */
/* GDE: KETCSC                                    */
/* DOC: THIS REXX EXEC PROMPTS FOR A DEST AND     */
/*      ISSUES TRANSMIT. LIKE VM'S SENDFILE.      */
/*                                                */
/*---------REXX SF -------------------------------*/
PARSE UPPER ARG DATASET
BEGIN:
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    APOST = SUBSTR(DATASET,1,1)
    IF (APOST = "'") THEN ,
      DO
        DATASETE = STRIP(DATASET,B,"'")
      END
    ELSE ,
      DO
        DATASETE = DATASET
      END
    PDSDSN = DATASETE
LOOP:
    ADDRESS ISPEXEC "DISPLAY PANEL(SF)"
    MYCC = RC
    IF (MYCC ^= 0) THEN EXIT 0
    OK = SYSDSN("'"DATASETE"'")
    IF (OK ^= "OK") THEN,
      DO
        ZERRHM = "*"
        ZERRALRM = "YES"
        ZERRSM = OK
        ZERRLM = "DATASET:" DATASETE "IS" OK
        ADDRESS ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        ADDRESS ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL LOOP
      END
    GETSYSID
    SYSCLASS = "X"
    IF (SYSID = "MVSP") THEN SYSCLASS = "7"
    IF (SYSID = "MVSW") THEN SYSCLASS = "7"
    IF (SYSID = "MVSX") THEN SYSCLASS = "7"
    IF (SYSID = "DOFD") THEN SYSCLASS = "Z"
    IF (SYSID = "DOFP") THEN SYSCLASS = "Z"
    IF (SYSID = "DOFX") THEN SYSCLASS = "Z"
    IF (TONODE ^= "") THEN ,
      "TRANSMIT" TONODE"."SENDTO "DSNAME('"DATASETE"')",
      "SYSOUT("SYSCLASS") SEQ",
      "NONOTIFY "
    ELSE ,
      "TRANSMIT" SENDTO "DSNAME('"DATASETE"')",
      "SYSOUT("SYSCLASS") SEQ",
      "NONOTIFY"
    MYCC = RC
    IF (MYCC ^= 0) THEN ,
      DO
        SAY "TRANSMIT RC WAS"MYCC
        EXIT MYCC
      END
    EXIT 0
./ ADD NAME=SMCASID  0101-93235-93238-1717-00011-00005-00000-DD20001
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: XDBS.TSOISPF.EXEC(SMCASID)                                   */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: GET MVS SYSID OF SYSTEM ON WHICH THIS EXEC IS RUN            */
/*                                                                   */
/*-------------------------------------------------------------------*/
@CVT = STORAGE(10,4)
@SMCA = STORAGE(D2X(C2D(@CVT)+197),3)
SYSID = STORAGE(D2X(C2D(@SMCA)+16),4)
'ISPEXEC VPUT (SYSID) SHARED'
./ ADD NAME=STAT     0146-92267-92273-0919-00074-00040-00000-LAWCSC
/*================= STAT - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(STAT)                                                  */
/* GDE: LEIGHTON A. WESTON                                          */
/* DOC: THIS EXEC CHECKS THE STATUS OF DB2.                         */
/*                                                                  */
/*================= STAT - REXX EXEC ===============================*/

/* TRACE R? */

    MYRC=0
    COUNT=0
    ARG JOBNAME
    IF (JOBNAME = '') THEN
      DO
         SAY "JOBNAME NOT SUPPLIED JOB"
         MYRC=3
         EXIT MYRC
      END
    LAST4=RIGHT(JOBNAME,4)
/*  IF (LAST4 = 'MSTR') × (LAST4 = 'DBM1') × (LAST4 = 'DIST')
      THEN SIGNAL DOIT
    ELSE
       DO
         SAY JOBNAME ":THIS IS NOT A VALID DB2 SUBSYSTEM."
         MYRC=3
         EXIT MYRC
       END */

/*========================================================*/
/* ALLOW USER TO CONTINUE                                 */
/*========================================================*/

DOIT:

    MSGSTAT = MSG(ON)

/*========================================================*/
/* FIND DETAILS                                           */
/*========================================================*/

    X=OUTTRAP(JOBLIST.,25)
    "STATUS" JOBNAME
    RX=OUTTRAP(OFF)
    MSGSTAT = MSG(OFF)
    DO I = JOBLIST.0 TO 1 BY -1
      IF (WORD(JOBLIST.I,4) = "EXECUTING") THEN
       DO
          SAY JOBNAME STATUS DATE() TIME() JOBLIST.I
          COUNT = COUNT + 1
       END
    END

/*=============================================================*/
/*  RETURN CODE SET TO 0 INDICATES THAT DB2 IS RUNNING         */
/*  CORRECTLY                                                  */
/*=============================================================*/

    IF COUNT = 1
      THEN MYRC=0

/*=============================================================*/
/*  RETURN CODE SET TO 3 INDICATES THAT THERE IS SOME KIND OF  */
/*  PROBLEM WITH DB2 RUNNING.                                  */
/*=============================================================*/

    IF COUNT > 1
      THEN MYRC=3

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/

    EXIT MYRC
./ ADD NAME=TOREXX   0110-93190-93364-1110-00110-00089-00036-KETCSC
/*  REXX EDIT MACRO                                                */
/*                                                                 */
ISREDIT MACRO
/*                                                                 */
/* LIB: XDBS.TSOISPF.EXEC(TOREXX)                                  */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST USES ISPF EDIT MACRO SERVICES TO HELP CONVERT   */
/*      A CLIST TO A REXX EXEC.                                    */
/*                                                                 */
    ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
    LASTCC = RC
    IF (LASTCC ^= 0) THEN,
      DO
        SAY "CONTROL ERRORS RETURN RC="LASTCC
      END
    ADDRESS ISREDIT "(DATASET) = DATASET"
    LASTCC = RC
    IF (LASTCC ^= 0) THEN,
      DO
        SAY "ISREDIT (DATASET) RC="LASTCC
      END
    ADDRESS ISREDIT "(MEMBER) = MEMBER"
    LASTCC = RC
    IF (LASTCC ^= 0) THEN,
      DO
        SAY "ISREDIT (MEMBER) RC="LASTCC
      END
    DSN = DATASET"("MEMBER")"
    ADDRESS ISREDIT "F" DSN "FIRST"
    LASTCC = RC
    IF (LASTCC ^= 0) THEN,
      DO
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/*---------REXX" MEMBER "-------------------------------*/'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/*                                                      */'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/* DOC: THIS REXX EXEC ......                           */'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/* GDE:" SYSVAR(SYSUID) "                               */'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/* LIB:" DSN "         */'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/*                                                      */'"
        ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = DATALINE",
          "'/*---------REXX" MEMBER "-------------------------------*/'"
      END
    ADDRESS ISREDIT "F PROC WORD FIRST"
    MYCC = RC
    IF (MYCC = 0) THEN,
      DO
        ADDRESS ISREDIT "LINE = (LINE)"
        PARSE VAR PROC NUM OPTIONS
        ADDRESS ISREDIT "C 'PROC' 'PARSE ARG' FIRST"
        ADDRESS ISREDIT "C" NUM "' ' FIRST"
      END
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "C 'EXIT' WORD ALL"
    ADDRESS ISREDIT "C 'CODE(' '' NX ALL"
    ADDRESS ISREDIT "C ')' '' NX ALL"
    ADDRESS ISREDIT "C ' SET ' ' '  ALL"
    ADDRESS ISREDIT "C ' WRITE ' ' SAY ""' ALL"
    ADDRESS ISREDIT "C ' SAYNR ' ' SAY ""' ALL"
    ADDRESS ISREDIT "C '&' '' ALL"
    ADDRESS ISREDIT "C 'ISPEXEC ' 'ADDRESS ISPEXEC ""' ALL"
    ADDRESS ISREDIT "C 'ISREDIT ' 'ADDRESS ISREDIT ""' ALL"
    ADDRESS ISREDIT "C '**' '--' ALL"
    ADDRESS ISREDIT "C '/-' '/*' ALL"
    ADDRESS ISREDIT "C '-/' '*/' ALL"
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "F ':' ALL"
    ADDRESS ISREDIT "C '+' ' ' NX ALL"
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "F '+' ALL"
    ADDRESS ISREDIT "C '+' ',' NX ALL"
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "F 'THEN' WORD ALL"
    ADDRESS ISREDIT "F 'ELSE' WORD ALL"
    ADDRESS ISREDIT "C ' ,' '"",' X ALL"
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "F 'IF' WORD ALL"
    ADDRESS ISREDIT "C 'NE' '^=' NX WORD ALL"
    ADDRESS ISREDIT "C 'ENDO' 'END' WORD ALL"
    ADDRESS ISREDIT "C 'GOTO' 'SIGNAL' WORD ALL"
    ADDRESS ISREDIT "C 'NRSTR(' '' ALL"
    ADDRESS ISREDIT "C 'STR(' '' WORD ALL"
    ADDRESS ISREDIT "C 'LASTCC' 'RC' WORD ALL"
    ADDRESS ISREDIT "C 'MAXCC' 'RC' WORD ALL"
    ADDRESS ISREDIT "X ALL"
    ADDRESS ISREDIT "F '/*' ALL"
    ADDRESS ISREDIT "X '*/' ALL"
    ADDRESS ISREDIT "F 'SUBSTR' WORD ALL"
    ADDRESS ISREDIT "F 'SAY' WORD ALL"
    ADDRESS ISREDIT "F 'ADDRESS' WORD ALL"
    ADDRESS ISREDIT "F 'STR' WORD ALL"
    ADDRESS ISREDIT "F 'SEND' WORD ALL"
    ADDRESS ISREDIT "F 'ALLOC' WORD ALL"
    ADDRESS ISREDIT "F 'LENGTH' WORD ALL"
    ADDRESS ISREDIT "C 'SYSDATE' 'DATE()' ALL"
    ADDRESS ISREDIT "C 'SYSTIME' 'TIME()' ALL"
    ADDRESS ISREDIT "C 'SYSUID' 'SYSVAR(SYSUID)' ALL"
    ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = NOTELINE",
      "'/*- COMMENT LINES MUST END WITH */          -*/'"
    ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = NOTELINE",
      "'/*- SUBSTR FORMAT IS (STR,STARTPOS,LENGTH)  -*/'"
    ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = NOTELINE",
      "'/*-   AND TO CONTINUED LINES                -*/'"
    ADDRESS ISREDIT "LINE_BEFORE .ZFIRST = NOTELINE",
      "'/*- ADD "" TO ENDS OF ISPEXEC/ISREDIT LINES -*/'"
    EXIT 1
./ ADD NAME=TRCKACTL 0104-94038-94038-1724-00506-00450-00000-KETCSC
/*------ TRCKACTL - REXX ------------------------------------------*/
/* LIB: EXEC(TRCKACTL)                                             */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS EXEC USES ISPF LIBRARY SERVICES TO READ All the       */
/*      TIME TRACKING Tables for a week and summarize them.        */
/*------ TRCKACTL - REXX ------------------------------------------*/
/*                                                                 */
    Parse Upper ARG DEBUG
    ZERRHM = "*"
    ZERRALRM = "NO"
    DEBUG = "noDEBUG"
    Address ISPEXEC "CONTROL ERRORS RETURN"
    PROGMSG1 =  "Capture Actuals"
    PROGMSG2 =  " "
    PROGMSG3 =  "Summarizing Daily Time Tracking Reports"
    PROGMSG4 =  " "
    PROGMSG5 =  " "
    Address ISPEXEC "CONTROL DISPLAY LOCK"
    Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
    Address ISPEXEC "VGET (WEMM WEDD WEYY)"
    WEEKEND = WEMM"/"WEDD"/"WEYY
    Address ISPEXEC "VPUT (WEEKEND)"
    TRCKWEEK
    Address ISPEXEC "VGET (WEYR WEEKDATE)"
    TITLE       = CENTER("PDS MEMBER LIST",78,"-")
    PDSDSN = XDBS.TIMETRCK.TABLES
    If (DEBUG = "DEBUG") Then,
      Do
        PROGMSG1 =  "RETRIEVING:"
        PROGMSG2 =  " "
        PROGMSG3 =  "MEMBER LIST :" PDSDSN
        PROGMSG4 =  " "
        PROGMSG5 =  " "
        Address ISPEXEC "CONTROL DISPLAY LOCK"
        Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
      End
    Address ISPEXEC "LMINIT DATAID(PDSID)",
      "DATASET('"PDSDSN"') ENQ(SHR)"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "FILE IN USE"
        ZERRLM = "THE FILE" PDSDSN "IS IN USE"
        Address ISPEXEC "VPUT (ZERRHM ZERRALRM ZERRSM ZERRLM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ABNEXIT
      End
    WhyTrap = Outtrap(trapit.)
    Address TSO "ALLOC FILE(TIMETRK)",
      "DATASET('"PDSDSN"') SHR REUSE"
    WhyTrap = Outtrap("OFF")
    Address ISPEXEC "LMOPEN DATAID("PDSID")",
      "OPTION(INPUT)"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "FILE FAILED TO OPEN"
        ZERRLM = "THE FILE" PDSDSN "FAILED TO"
        ZERRLM = ZERRLM "OPEN RC="MYCC
        Address ISPEXEC "VPUT (ZERRHM ZERRALRM ZERRSM ZERRLM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ABNEXIT
      End
    GRPTBL = "YDB2"WEYY××WEYR
    Address ISPEXEC "TBEND" GRPTBL
    If (DEBUG = "DEBUG") Then,
      Do
        PROGMSG1 =  "Table:"
        PROGMSG2 =  " "
        PROGMSG3 =  "Period Ending:" GRPTBL
        PROGMSG4 =  " "
        PROGMSG5 =  " "
        Address ISPEXEC "CONTROL DISPLAY LOCK"
        Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
      End
    Address ISPEXEC "TBERASE" GRPTBL,
            "LIBRARY(TIMETRK)"
    FUNCSERV = "TBOPEN"
    Address ISPEXEC "TBOPEN" GRPTBL,
            "NOWRITE LIBRARY(TIMETRK)",
      "SHARE"
    MYCC = RC
    If (MYCC = 8) Then,
      Do
        If (DEBUG = "DEBUG") Then,
          Do
            PROGMSG1 =  "Table:"
            PROGMSG2 =  " "
            PROGMSG3 =  "Creating:" GRPTBL
            PROGMSG4 =  " "
            PROGMSG5 =  " "
            Address ISPEXEC "CONTROL DISPLAY LOCK"
            Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
          End
        FUNCSERV = "TBCREATE"
        Address ISPEXEC "TBCREATE" GRPTBL,
          "NAMES(PROJID USER1 USER2 USER3 USER4 USER5 USER6 USER7",
                "USER8 USER9 USER10 PROJTOT) LIBRARY(TIMETRK)",
          "REPLACE NOWRITE"
        MYCC = RC
      End
    If (DEBUG = "DEBUG") Then,
      Do
        PROGMSG1 =  "Table:"
        PROGMSG2 =  " "
        PROGMSG3 =  "Open or Create:" MYCC
        PROGMSG4 =  " "
        PROGMSG5 =  " " FUNCSERV
        Address ISPEXEC "CONTROL DISPLAY LOCK"
        Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
      End
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "TBCREATE Failed"
        ZERRLM = "THE Table" GRPTBL "FAILED TO"
        ZERRLM = ZERRLM "CREATE RC="MYCC
        Address ISPEXEC "VPUT (ZERRHM ZERRALRM ZERRSM ZERRLM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        Address ISPEXEC "LMCLOSE DATAID(PDSID)"
        Address ISPEXEC "LMFREE DATAID(PDSID)"
        SIGNAL NOTOTAL
      End
    PDSMBR = "X"
    UserNumber = 0
    USERN1 = "   "
    USERN2 = "   "
    USERN3 = "   "
    USERN4 = "   "
    USERN5 = "   "
    USERN6 = "   "
    USERN7 = "   "
    USERN8 = "   "
    USERN9 = "   "
    USERN10 = "Other"
    UserT1 = 0
    UserT2 = 0
    UserT3 = 0
    UserT4 = 0
    UserT5 = 0
    UserT6 = 0
    UserT7 = 0
    UserT8 = 0
    UserT9 = 0
    UserT10 = 0
    If (DEBUG = "DEBUG") Then,
      Do
        PROGMSG1 =  "LMMLIST"
        PROGMSG2 =  " "
        PROGMSG3 =  "About to loop"
        PROGMSG4 =  " "
        PROGMSG5 =  " "
        Address ISPEXEC "CONTROL DISPLAY LOCK"
        Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
      End
LOOPPDS:
    Address ISPEXEC "LMMLIST DATAID("PDSID")",
      "OPTION(LIST) MEMBER(PDSMBR) STATS(YES)"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        Address ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
        Address ISPEXEC "LMCLOSE DATAID(PDSID)"
        Address ISPEXEC "LMFREE DATAID(PDSID)"
        SIGNAL TOTALIT
      End
    If (DEBUG = "DEBUG") Then,
      Do
        PDSDSN = DSN"("PDSMBR")"
        PROGMSG1 =  "RETRIEVING:"
        PROGMSG2 =  " "
        PROGMSG3 =  "MEMBER LIST :" PDSDSN
        PROGMSG4 =  " "
        PROGMSG5 =  " "
        Address ISPEXEC "CONTROL DISPLAY LOCK"
        Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
      End
XTRCKNAM:
    FullName = PDSMBR
    FirstChar = SubStr(FullName,1,1)
    If (FirstChar <> "X") Then,
      Do
        Signal LOOPPDS
      End
    UsersThree = SubStr(FullName,2,3)
    Select
      When UsersThree = "BLU" Then,
        UsersThree = "PAB"
      When UsersThree = "GAN" Then,
        UsersThree = "FSG"
      When UsersThree = "LOV" Then,
        UsersThree = "MJL"
      When UsersThree = "MUN" Then,
        UsersThree = "FMM"
      When UsersThree = "SOP" Then,
        UsersThree = "PXS"
      When UsersThree = "TOM" Then,
        UsersThree = "KET"
      When UsersThree = "WES" Then,
        UsersThree = "LAW"
      Otherwise
        NOP
    End
    TBLYear = SubStr(FullName,5,2)
    TBLWkYr = SubStr(FullName,7,2)
COMPWKYR:
    If (TBLYear <> WEYY) Then,
      Do
        Signal LOOPPDS
      End
    If (TBLWkYr <> WEYR) Then,
      Do
        Signal LOOPPDS
      End
ITMATCHD:
    PROGMSG1 =  "Processing:"
    PROGMSG2 =  " "
    PROGMSG3 =  "Table:" FullName
    PROGMSG4 =  " "
    PROGMSG5 =  " "
    Address ISPEXEC "CONTROL DISPLAY LOCK"
    Address ISPEXEC "DISPLAY PANEL(PROGRESS)"
    TBL = FullName
    Address ISPEXEC "TBEND" TBL
    TBLCTR = 0
    Address ISPEXEC "TBOPEN" TBL "NOWRITE LIBRARY(TIMETRK) SHARE"
    MYCC = RC
    If (MYCC = 8) Then,
      Do
        ZERRSM = "NO ENTRIES FOR" TBL
        ZERRLM = "USE OPTION 2 TO ADD ENTRIES"
        ZERRHM = "*"
        ZERRALRM = "NO"
        Address ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        Signal LOOPPDS
      End
    ELSE,
    If (MYCC = 0) Then,
      Do
        Address ISPEXEC "TBSTATS" TBL,
          "CDATE(CDATNAME)    CTIME(CTIMNAME)",
          "UDATE(UDATNAME)    UTIME(UTIMNAME)",
          "USER(USERNAME)     ROWCREAT(RCRTNAME)",
          "ROWCURR(RCURNAME)"
        If (RCURNAME = 0) Then,
          Do
            Signal LOOPPDS
          End
        Signal PANLLOOP
      End
    ELSE,
      Do
        ZERRSM = "TABLE IN USE"
        ZERRLM = "THE TABLE" TBL "IS IN USE RC="MYCC
        Address ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
      End
    Signal LOOPPDS
/*--------------------------------------------------------------*/
/*       PANLLOOP TABLE                                         */
/*--------------------------------------------------------------*/
PANLLOOP:
    Address ISPEXEC "TBTOP" TBL
    UserNumber = UserNumber + 1
    Select
      When UserNumber = 1 Then,
        UserN1 = UsersThree
      When UserNumber = 2 Then,
        UserN2 = UsersThree
      When UserNumber = 3 Then,
        UserN3 = UsersThree
      When UserNumber = 4 Then,
        UserN4 = UsersThree
      When UserNumber = 5 Then,
        UserN5 = UsersThree
      When UserNumber = 6 Then,
        UserN6 = UsersThree
      When UserNumber = 7 Then,
        UserN7 = UsersThree
      When UserNumber = 8 Then,
        UserN8 = UsersThree
      When UserNumber = 9 Then,
        UserN9 = UsersThree
      Otherwise
        NOP
    End
    ENTRIES = 0
TOTSKP:
    Address ISPEXEC "TBSKIP" TBL "NUMBER(1)"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        Signal DISPLAY
      End
    If (TOT = 0) Then,
       Signal TOTSKP
PROJMTCH:
    ENTRIES = ENTRIES + 1
    Address ISPEXEC "TBTOP" GRPTBL
GRPSKP:
    Address ISPEXEC "TBSKIP" GRPTBL "NUMBER(1)"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        Signal ADDTOGRP
      End
    Address ISPEXEC "TBGET" GRPTBL
    Parse Upper VAR CDMAJ UCDMAJ
    Parse Upper VAR PROJID UPROJID
    If (UCDMAJ <> UPROJID) Then,
       Signal GRPSKP
    Select
      When UserNumber = 1 Then,
        Do
          User1 = User1 + TOT
          UserT1 = UserT1 + TOT
        End
      When UserNumber = 2 Then,
        Do
          User2 = User2 + TOT
          UserT2 = UserT2 + TOT
        End
      When UserNumber = 3 Then,
        Do
          User3 = User3 + TOT
          UserT3 = UserT3 + TOT
        End
      When UserNumber = 4 Then,
        Do
          User4 = User4 + TOT
          UserT4 = UserT4 + TOT
        End
      When UserNumber = 5 Then,
        Do
          User5 = User5 + TOT
          UserT5 = UserT5 + TOT
        End
      When UserNumber = 6 Then,
        Do
          User6 = User6 + TOT
          UserT6 = UserT6 + TOT
        End
      When UserNumber = 7 Then,
        Do
          User7 = User7 + TOT
          UserT7 = UserT7 + TOT
        End
      When UserNumber = 8 Then,
        Do
          User8 = User8 + TOT
          UserT8 = UserT8 + TOT
        End
      When UserNumber = 9 Then,
        Do
          User9 = User9 + TOT
          UserT9 = UserT9 + TOT
        End
      Otherwise
        Do
          User10 = User10 + TOT
          UserT10 = UserT10 + TOT
        End
    End
    PROJTOT = PROJTOT + TOT
    Address ISPEXEC "TBPUT" GRPTBL
    Signal TOTSKP
ADDTOGRP:
    User1  = 0
    User2  = 0
    User3  = 0
    User4  = 0
    User5  = 0
    User6  = 0
    User7  = 0
    User8  = 0
    User9  = 0
    User10 = 0
    PROJTOT = TOT
    Select
      When UserNumber = 1 Then,
        Do
          User1 = TOT
          UserT1 = UserT1 + TOT
        End
      When UserNumber = 2 Then,
        Do
          User2 = TOT
          UserT2 = UserT2 + TOT
        End
      When UserNumber = 3 Then,
        Do
          User3 = TOT
          UserT3 = UserT3 + TOT
        End
      When UserNumber = 4 Then,
        Do
          User4 = TOT
          UserT4 = UserT4 + TOT
        End
      When UserNumber = 5 Then,
        Do
          User5 = TOT
          UserT5 = UserT5 + TOT
        End
      When UserNumber = 6 Then,
        Do
          User6 = TOT
          UserT6 = UserT6 + TOT
        End
      When UserNumber = 7 Then,
        Do
          User7 = TOT
          UserT7 = UserT7 + TOT
        End
      When UserNumber = 8 Then,
        Do
          User8 = TOT
          UserT8 = UserT8 + TOT
        End
      When UserNumber = 9 Then,
        Do
          User9 = TOT
          UserT9 = UserT9 + TOT
        End
      Otherwise
        Do
          User10 = TOT
          UserT10 = UserT10 + TOT
        End
    End
    Projid = CDMAJ
    Address ISPEXEC "TBADD" GRPTBL
    Signal TOTSKP
ABNEXIT:
    Address ISPEXEC "LMMLIST DATAID("PDSID") OPTION(FREE)"
    Address ISPEXEC "LMCLOSE DATAID("PDSID")"
    Address ISPEXEC "LMFREE DATAID("PDSID")"
    EXIT 4
DISPLAY:
    Address ISPEXEC "TBEND" TBL
    Signal LOOPPDS
TOTALIT:
    TTOTAL = UserT1 + UserT2 + UserT3 + UserT4 + UserT5
    TTOTAL = TTOTAL + UserT6 + UserT7 + UserT8 + UserT9 + UserT10
    TBL = "YDB2"WEYY××WEYR
    Address ISPEXEC "TBSORT" TBL "FIELDS(PROJID)"
    WhyTrap = Outtrap(trapit.)
    Address TSO "FREE FILE(ISPFILE)"
    OutDSN = "XDBS.TRCKACTL.WK"WEYY××WEYR
    TBLDSN = "XDBS.TRCKACTL.WK"WEYY××WEYR
    Address TSO "DELETE '"OutDSN"'"
    Address TSO "ALLOC FILE(ISPFILE) DATASET('"OutDSN"')",
      "RECFM(F B) BLKSIZE(3120) LRECL(80)",
      "NEW CATALOG UNIT(SYSDA)",
      "SPACE(1 5) TRACKS"
    Address ISPEXEC "VPUT (TBL TBLDSN) SHARED"
    Address ISPEXEC "FTOPEN"
    Address ISPEXEC "FTINCL TRCKACTL"
    MYCC = RC
    Address ISPEXEC "FTCLOSE"
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "FTINCL Failed" MYCC
        ZERRLM = "File tailoring failed with the aforementiond RC"
        ZERRLM = ZERRLM "doing TRCKACTL"
        Address ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ABNEXIT
      End
    Address TSO "FREE FILE(ISPFILE)"
    WhyTrap = Outtrap("OFF")
    If (DEBUG = "DEBUG") Then,
      Do
        Address ISPEXEC "BROWSE DATASET('"TBLDSN"')"
        EXIT 0
      End
    Address ISPEXEC "FTOPEN TEMP"
    Address ISPEXEC "FTINCL TRCKD00"
    MYCC = RC
    Address ISPEXEC "FTCLOSE"
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "FTINCL Failed" MYCC
        ZERRLM = "File tailoring failed with the aforementiond RC"
        ZERRLM = ZERRLM "doing TRCKD00"
        Address ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ABNEXIT
      End
    Address ISPEXEC "VGET ZTEMPF"
/*  */
/* SUBMIT JCL     */
/*  */
    Address ISPEXEC "CONTROL DISPLAY SM START(13)"
    Address TSO "SUBMIT '"ZTEMPF"' NOHOLD"
    MYCC = RC
    If (MYCC <> 0) Then,
      Do
        ZERRSM = "Submit Failed" MYCC
        ZERRLM = "Job submission failed with the aforementiond RC"
        Address ISPEXEC "VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED"
        Address ISPEXEC "SETMSG MSG(ISRZ002)"
        SIGNAL ABNEXIT
      End
NOTOTAL:
    EXIT 0
./ ADD NAME=TRCKADD  0101-92106-92174-0912-00031-00017-00014-DMV0016
/*  TRCKTOT  REXX - ADD DAILY TOTALS */
ADDRESS ISPEXEC
'CONTROL ERRORS RETURN'
ADDRESS ISPEXEC
'VGET (DAY1 DAY2 DAY3 DAY4 DAY5 DAY6 DAY7 TOT)'
IF RC ^= 0 THEN EXIT
IF DAY1 = "" THEN DAY1 = 0.0
IF DAY2 = "" THEN DAY2 = 0.0
IF DAY3 = "" THEN DAY3 = 0.0
IF DAY4 = "" THEN DAY4 = 0.0
IF DAY5 = "" THEN DAY5 = 0.0
IF DAY6 = "" THEN DAY6 = 0.0
IF DAY7 = "" THEN DAY7 = 0.0
IF TDAY1 = "" THEN TDAY1 = 0.0
IF TDAY2 = "" THEN TDAY2 = 0.0
IF TDAY3 = "" THEN TDAY3 = 0.0
IF TDAY4 = "" THEN TDAY4 = 0.0
IF TDAY5 = "" THEN TDAY5 = 0.0
IF TDAY6 = "" THEN TDAY6 = 0.0
IF TDAY7 = "" THEN TDAY7 = 0.0
IF DATATYPE(DAY1) ^= NUM THEN DAY1 = 0
IF DATATYPE(DAY2) ^= NUM THEN DAY2 = 0
IF DATATYPE(DAY3) ^= NUM THEN DAY3 = 0
IF DATATYPE(DAY4) ^= NUM THEN DAY4 = 0
IF DATATYPE(DAY5) ^= NUM THEN DAY5 = 0
IF DATATYPE(DAY6) ^= NUM THEN DAY6 = 0
IF DATATYPE(DAY7) ^= NUM THEN DAY7 = 0
TOT = DAY1 + DAY2 + DAY3 + DAY4 + DAY5 + DAY6 + DAY7 + 0.0
ADDRESS ISPEXEC
'VPUT (TOT) SHARED'
EXIT
./ ADD NAME=TRCKPGMR 0103-94026-94038-0754-00011-00009-00007-KETCSC
/*  TRCKPGMR REXX - STRIP NAME       */
ADDRESS ISPEXEC,
  "CONTROL ERRORS RETURN"
ADDRESS ISPEXEC,
  "VGET (PGMR)"
IF RC <> 0 THEN EXIT
NAMEA = WORD(PGMR,1)
NAMEB = WORD(PGMR,2)
PGMR = NAMEA NAMEB
ADDRESS ISPEXEC "VPUT (PGMR NAMEA NAMEB)"
EXIT 0
./ ADD NAME=TRCKTOT  0101-92106-92174-0911-00032-00018-00014-DMV0016
/*  TRCKTOT  REXX - ADD DAILY TOTALS */
ADDRESS ISPEXEC
'CONTROL ERRORS RETURN'
ADDRESS ISPEXEC
'VGET (DAY1 DAY2 DAY3 DAY4 DAY5 DAY6 DAY7 TOT)'
'VGET (TDAY1 TDAY2 TDAY3 TDAY4 TDAY5 TDAY6 TDAY7 TTOT)'
IF RC ^= 0 THEN EXIT
IF DAY1 = "" THEN DAY1 = 0.0
IF DAY2 = "" THEN DAY2 = 0.0
IF DAY3 = "" THEN DAY3 = 0.0
IF DAY4 = "" THEN DAY4 = 0.0
IF DAY5 = "" THEN DAY5 = 0.0
IF DAY6 = "" THEN DAY6 = 0.0
IF DAY7 = "" THEN DAY7 = 0.0
IF TDAY1 = "" THEN TDAY1 = 0.0
IF TDAY2 = "" THEN TDAY2 = 0.0
IF TDAY3 = "" THEN TDAY3 = 0.0
IF TDAY4 = "" THEN TDAY4 = 0.0
IF TDAY5 = "" THEN TDAY5 = 0.0
IF TDAY6 = "" THEN TDAY6 = 0.0
IF TDAY7 = "" THEN TDAY7 = 0.0
TDAY1 = TDAY1 + DAY1 + 0.0
TDAY2 = TDAY2 + DAY2 + 0.0
TDAY3 = TDAY3 + DAY3 + 0.0
TDAY4 = TDAY4 + DAY4 + 0.0
TDAY5 = TDAY5 + DAY5 + 0.0
TDAY6 = TDAY6 + DAY6 + 0.0
TDAY7 = TDAY7 + DAY7 + 0.0
TTOT  = TTOT  + TOT + 0.0
ADDRESS ISPEXEC
'VPUT (TDAY1 TDAY2 TDAY3 TDAY4 TDAY5 TDAY6 TDAY7 TTOT)'
EXIT
./ ADD NAME=TSO2ISPF 0130-93325-93342-1000-01181-01031-01181-KETCSC
/*-- REXX --- TSO2ISPF ----------------------------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(TSO2ISPF)                                          */
/* GDE: KENNETH E. TOMIAK                                            */
/* DOC: GETS YOU FROM TSO TO ISPF BY ALLOCATING FILES NOT IN         */
/*      THE TSO LOGON PROCEDURE (BY SYSTEM OR LOGON).                */
/* NTE: Vertical represented by x'63'. Check after upload. If you    */
/*      do not see the bar here =>×<= then change all.               */
/* NTE: NOT      represented by x'52'. Check after upload. If you    */
/*      do not see the NOT here =>^<= then change all.               */
/*                                                                   */
/* WRN: Initial panel set in REXX exec AGAIN.                        */
/*                                                                   */
/*-------------------------------------------------------------------*/
ARG junk
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO CVT FROM PSA                                    */
/*-------------------------------------------------------------------*/
PTR2PSA = 0
CVTPTR = STORAGE(D2X(PTR2PSA+16),4)
/*-------------------------------------------------------------------*/
/* ADDRESSABILITY TO SMCA, THEN GET SMF SYSTEM ID                    */
/*-------------------------------------------------------------------*/
CVTSMCA = STORAGE(D2X(C2D(CVTPTR)+197),3)
SMFID = STORAGE(D2X(C2D(CVTSMCA)+16),4)
/*-------------------------------------------------------------------*/
/* GET JOBNAME, STEP, AND PROCEDURE                                  */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
TSOPROC  = SYSVAR(SYSPROC)
/*-------------------------------------------------------------------*/
/* GET FMID, PRODUCT LEVEL, AND RELEASE                              */
/*-------------------------------------------------------------------*/
CVTPRODI = STORAGE(D2X(C2D(CVTPTR)+X2D(0E0)-256),8)
CVTPRODN = STORAGE(D2X(C2D(CVTPTR)+X2D(0D8)-256),8)
CVTRELNO = STORAGE(D2X(C2D(CVTPTR)+X2D(0FC)-256),4)
/*--------------------------------------------------------------------*/
/*      USE RACF LISTUSER command to determine which groups a user    */
/*      is connected to.                                              */
/*--------------------------------------------------------------------*/
SYSUID = SYSVAR(SYSUID)
rgroup = ""
    x = Outtrap('name.')
    "LISTUSER" SYSUID
    x = Outtrap('OFF')
    OWNR = "NO ONE"
    PGMR = "NO ONE"
/*--------------------------------------------------------------------*/
/* Loop through trapped output and find the group= lines.             */
/* Display each group.                                                */
/*--------------------------------------------------------------------*/
    Do i = 1 to name.0 by 1
      loc = index(name.i,'GROUP=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+6,8)
          there = find(rgroup,thisgrp)
          if there = 0 then rgroup = rgroup thisgrp
        end
      loc = INDEX(name.i,' OWNER=')
      If loc > 0 then,
        do
          thisgrp = substr(name.i,loc+7,8)
          OWNR = thisgrp
          loc = INDEX(name.i,'NAME=')
          PGMR = substr(name.i,loc+5,20)
        end
    End
/*--------------------------------------------------------------------*/
/*  check user authority                                              */
/*--------------------------------------------------------------------*/
    If (OWNR = "CSCDB2") Then SIGNAL NOTHRA
CHKAUTH:
/*--------------------------------------------------------------------*/
/*  If HRA: exit to act like NYCHA process (poorly done way)          */
/*--------------------------------------------------------------------*/
    HRAs = INDEX(SYSUID,"069")
    HRAo = INDEX(OWNR,"069")
    HRAg = INDEX(rgroup,"069")
    If (HRAs > 0) ×,
       (HRAo > 0) ×,
       (HRAg > 0) then,
      do
        Address TSO,
        "FREE FILE(SYSPROC)"
        Address TSO,
        "ALLOC FILE(SYSPROC) DATASET('SYS1.CSC.HRACLIB') SHR REUSE"
        Say "Press ENTER when *** appears."
        Exit 0
      end
NOTHRA:
/*--------------------------------------------------------------------*/
/*  Wasn't HRA: see who else it could be.                             */
/*--------------------------------------------------------------------*/
/*  If RACF group: allow to get on                                    */
/*--------------------------------------------------------------------*/
    RACFo = INDEX(OWNR,"CSCRAC")
    RACFg = INDEX(rgroup,"CSCRAC")
    If (RACFo > 0) ×,
       (RACFg > 0) then,
      Do
        SIGNAL BEGIN
      End
/*--------------------------------------------------------------------*/
/*  If Auditor group: allow to get on                                 */
/*--------------------------------------------------------------------*/
    AUDo = INDEX(OWNR,"CSCAUD")
    AUDg = INDEX(rgroup,"CSCAUD")
    If (AUDo > 0) ×,
       (AUDg > 0) then,
      SIGNAL BEGIN
/*--------------------------------------------------------------------*/
/*  If IBM Consulting team: allow to get on like DEP                  */
/*--------------------------------------------------------------------*/
    IF (SYSUID = "SXSCSC")  ×,
       (SYSUID = "ACSCRLB") ×,
       (SYSUID = "JOEF")    ×,
       (SYSUID = "MLC")     ×,
       (SYSUID = "SXICSC")  ×,
       (SYSUID = "HEC")     ×,
       (SYSUID = "DMV0016") ×,
       (SYSUID = "JXCCSC")  Then,
      do
        Signal BEGIN
      end
/*--------------------------------------------------------------------*/
/*  If MVS group: allow to get on                                     */
/*--------------------------------------------------------------------*/
    MVSo = INDEX(OWNR,"CSCMVS")
    MVSg = INDEX(rgroup,"CSCMVS")
    If (MVSo > 0) ×,
       (MVSg > 0) then,
      SIGNAL BEGIN
/*--------------------------------------------------------------------*/
/*  If CICS group: allow to get on                                    */
/*--------------------------------------------------------------------*/
    CICSo = INDEX(OWNR,"CSCCICS")
    CICSg = INDEX(rgroup,"CSCCICS")
    If (CICSo > 0) ×,
       (CICSg > 0) then,
      SIGNAL BEGIN
/*--------------------------------------------------------------------*/
/*  If DB2 group: allow to get on                                     */
/*--------------------------------------------------------------------*/
    DB2o = INDEX(OWNR,"CSCDB2")
    DB2g = INDEX(rgroup,"CSCDB2") + INDEX(rgroup,"DD200")
    If (DB2o > 0) ×,
       (DB2g > 0) then,
        Signal BEGIN
/*--------------------------------------------------------------------*/
/*  If DEP users: allow to get on                                     */
/*--------------------------------------------------------------------*/
    BWECg = INDEX(rgroup,"828")
    If (BWECg > 0) then,
      do
        Signal BEGIN
      end
/*--------------------------------------------------------------------*/
/*  Not a known user of this process:                                 */
/*--------------------------------------------------------------------*/
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) Then,
      Address TSO "SE '"SYSUID" logged on using "TSOPROC,
        OWNR DATE() TIME(),
        "' U(KETCSC) LOGON"
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) Then,
      Address TSO "SE '"SYSUID" logged on using "TSOPROC,
        OWNR DATE() TIME(),
        "' U(KETCSC) LOGON"
    Say "Your use of this logon procedure is not supported."
    Say "Contact your Client Services Representative."
    EXIT 0
/*--------------------------------------------------------------------*/
/*  User authorized to receive allocations from this exec             */
/*--------------------------------------------------------------------*/
BEGIN:
    SAY " "
    SAY "Hi" PGMR". Welcome to the" smfid "system."
    SAY " "
/*--------------------------------------------------------------------*/
/*  If MVS group or Ken: retrieve IPL information                     */
/*--------------------------------------------------------------------*/
    If (MVSo > 0) ×,
       (MVSg > 0) ×,
       (SYSUID = "KETCSC") Then,
      Do
/*--------------------------------------------------------------------*/
/* GET CPU MODEL                                                      */
/*--------------------------------------------------------------------*/
        CVTMDL   = C2X(STORAGE(D2X(C2D(CVTPTR)+X2D(0FA)-256),2))
/*--------------------------------------------------------------------*/
/* GET IPL ADDRESS                                                    */
/*--------------------------------------------------------------------*/
        CVTSYSAD = STORAGE(D2X(C2D(CVTPTR)+X2D(030)),4)
        UCBVOLI  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(01C)),6)
        UCBNAME  = STORAGE(D2X(C2D(CVTSYSAD)+X2D(0D)),3)
        Say SMFID "was IPLed from:" UCBVOLI ":" UCBNAME"."
      End
/*--------------------------------------------------------------------*/
/* Initialize ddname dataset defaults                                 */
/*--------------------------------------------------------------------*/
    SYSPROC = ""                          /* TSO command lists (CLIST)*/
    SYSEXEC = ""                          /* TSO REXX execs           */
    SYSHELP = ""                          /* TSO HELP file            */
    ISPLLIB = ""                          /* ISPF load library        */
    ISPMLIB = ""                          /* ISPF message library     */
    ISPPLIB = ""                          /* ISPF panel library       */
    ISPSLIB = ""                          /* ISPF skeleton library    */
    ISPTLIB = "'"SYSUID".ISPF.ISPPROF'"   /* ISPF table input library */
    ISPTABL = "'"SYSUID".ISPF.ISPPROF'"   /* ISPF table output dataset*/
    DBID = SYSUID".JCL.ERROR."            /* DB2 subsystem prefix     */
    If (SMFID = "DOFD") &,
       (TSOPROC = "IKJACCNT") then,
      Do
        DBID = "DDB2"
        SIGNAL ADDUSR
      End
    If (SMFID = "DOFD") &,
       (TSOPROC = "TS1ACCNT") then,
      Do
        DBID = "DSN"
        SIGNAL ADDUSR
      End
    If (SMFID = "DOFP") &,
       (TSOPROC = "IKJACCNT") then,
      Do
        DBID = "PDB2"
        SIGNAL ADDUSR
      End
    If (SMFID = "DOFX") &,
       (TSOPROC = "IKJACCNT") then,
      Do
        DBID = "DB2X"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) &,
       (TSOPROC = "DB2DEVL") then,
      Do
        DBID = "D1DB"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) &,
       (TSOPROC = "DB2PROD") then,
      Do
        DBID = "P1DB"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) &,
       (TSOPROC = "DB2DWEC") then,
      Do
        DBID = "D2DB"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) &,
       (TSOPROC = "DB2PWEC") then,
      Do
        DBID = "P2DB"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSP") × (SMFID = "MVSW")) &,
       (TSOPROC = "DB2P2DB") then,
      Do
        DBID = "P2DB"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) &,
       (TSOPROC = "DB2DEVL") then,
      Do
        DBID = "DB2X"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) &,
       (TSOPROC = "DB2PROD") then,
      Do
        DBID = "DB2M"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) &,
       (TSOPROC = "DB2DWEC") then,
      Do
        DBID = "DB2M"
        SIGNAL ADDUSR
      End
    If ((SMFID = "MVSX") × (SMFID = "MVSZ")) &,
       (TSOPROC = "DB2PWEC") then,
      Do
        DBID = "DB2M"
        SIGNAL ADDUSR
      End
ADDUSR:
/*--------------------------------------------------------------------*/
/* If DEP: jump past this                                             */
/*--------------------------------------------------------------------*/
    LOC = INDEX(rgroup,"828")
    If (LOC > 0) then,
      do
        Signal ADDDB2G
      end
/*--------------------------------------------------------------------*/
/* If user has matching names append to ddname lists                  */
/*--------------------------------------------------------------------*/
    DSNOK = SYSDSN("'"SYSUID".CLIST'")
    DSNFM = LISTDSI("'"SYSUID".CLIST'")
    If (DSNOK = "OK") &,
       (SYSRECFM = "FB") Then,
      SYSPROC = SYSPROC "'"SYSUID".CLIST'"
    DSNOK = SYSDSN("'"SYSUID".EXEC'")
    If (DSNOK = "OK") then,
      Do
        SYSPROC = SYSPROC "'"SYSUID".EXEC'"
        SYSEXEC = SYSEXEC "'"SYSUID".EXEC'"
      End
    DSNOK = SYSDSN("'"SYSUID".HELP'")
    If (DSNOK = "OK") then,
      SYSHELP = SYSHELP "'"SYSUID".HELP'"
    DSNOK = SYSDSN("'"SYSUID".LOADLIB'")
    If (DSNOK = "OK") then,
      ISPLLIB = ISPLLIB "'"SYSUID".LOADLIB'"
    DSNOK = SYSDSN("'"SYSUID".MSGS'")
    If (DSNOK = "OK") then,
      ISPMLIB = ISPMLIB "'"SYSUID".MSGS'"
    DSNOK = SYSDSN("'"SYSUID".PANELS'")
    If (DSNOK = "OK") then,
      ISPPLIB = ISPPLIB "'"SYSUID".PANELS'"
    DSNOK = SYSDSN("'"SYSUID".SKELS'")
    If (DSNOK = "OK") then,
      ISPSLIB = ISPSLIB "'"SYSUID".SKELS'"
    DSNOK = SYSDSN("'"SYSUID".TABLES'")
    If (DSNOK = "OK") then,
      Do
        ISPTLIB = ISPTLIB "'"SYSUID".TABLES'"
      End
ADDDB2G:
/*--------------------------------------------------------------------*/
/* If DB2 group: add group libraries                                  */
/*--------------------------------------------------------------------*/
    If (DB2o > 0) × (DB2g > 0) then,
      do
        NOP
      End
        DSNOK = SYSDSN("'XDBS.TSOISPF.CLIST'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'XDBS.TSOISPF.CLIST'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.EXEC'")
        If (DSNOK = "OK") then,
          Do
            SYSPROC = SYSPROC "'XDBS.TSOISPF.EXEC'"
            SYSEXEC = SYSEXEC "'XDBS.TSOISPF.EXEC'"
          End
        DSNOK = SYSDSN("'XDBS.TSOISPF.HELP'")
        If (DSNOK = "OK") then,
          SYSHELP = SYSHELP "'XDBS.TSOISPF.HELP'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.LOADLIB'")
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'XDBS.TSOISPF.LOADLIB'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.MSGS'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'XDBS.TSOISPF.MSGS'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.PANELS'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'XDBS.TSOISPF.PANELS'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.SKELS'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'XDBS.TSOISPF.SKELS'"
        DSNOK = SYSDSN("'XDBS.TSOISPF.TABLES'")
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'XDBS.TSOISPF.TABLES'"
ADDCICS:
/*--------------------------------------------------------------------*/
/* If CICS group: add group libraries                                 */
/*--------------------------------------------------------------------*/
    If (CICSo > 0) × (CICSg > 0) then,
      do
        DSNOK = SYSDSN("'XCICS.TSOISPF.CLIST'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'XCICS.TSOISPF.CLIST'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.EXEC'")
        If (DSNOK = "OK") then,
          Do
            SYSPROC = SYSPROC "'XCICS.TSOISPF.EXEC'"
            SYSEXEC = SYSEXEC "'XCICS.TSOISPF.EXEC'"
          End
        DSNOK = SYSDSN("'XCICS.TSOISPF.HELP'")
        If (DSNOK = "OK") then,
          SYSHELP = SYSHELP "'XCICS.TSOISPF.HELP'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.LOADLIB'")
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'XCICS.TSOISPF.LOADLIB'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.MSGS'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'XCICS.TSOISPF.MSGS'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.PANELS'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'XCICS.TSOISPF.PANELS'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.SKELS'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'XCICS.TSOISPF.SKELS'"
        DSNOK = SYSDSN("'XCICS.TSOISPF.TABLES'")
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'XCICS.TSOISPF.TABLES'"
      End
ADDDB2U:
/*--------------------------------------------------------------------*/
/* Add DB2 group libraries for DB2 user support                       */
/*--------------------------------------------------------------------*/
    DSNOK = SYSDSN("'"DBID".TSOISPF.CLIST'")
    If (DSNOK = "OK") then,
      SYSPROC = SYSPROC "'"DBID".TSOISPF.CLIST'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.EXEC'")
    If (DSNOK = "OK") then,
      Do
        SYSPROC = SYSPROC "'"DBID".TSOISPF.EXEC'"
        SYSEXEC = SYSEXEC "'"DBID".TSOISPF.EXEC'"
      End
    DSNOK = SYSDSN("'"DBID".TSOISPF.HELP'")
    If (DSNOK = "OK") then,
      SYSHELP = SYSHELP "'"DBID".TSOISPF.HELP'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.LOADLIB'")
    If (DSNOK = "OK") then,
      ISPLLIB = ISPLLIB "'"DBID".TSOISPF.LOADLIB'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.MSGS'")
    If (DSNOK = "OK") then,
      ISPMLIB = ISPMLIB "'"DBID".TSOISPF.MSGS'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.PANELS'")
    If (DSNOK = "OK") then,
      ISPPLIB = ISPPLIB "'"DBID".TSOISPF.PANELS'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.SKELS'")
    If (DSNOK = "OK") then,
      ISPSLIB = ISPSLIB "'"DBID".TSOISPF.SKELS'"
    DSNOK = SYSDSN("'"DBID".TSOISPF.TABLES'")
    If (DSNOK = "OK") then,
      ISPTLIB = ISPTLIB "'"DBID".TSOISPF.TABLES'"
/*--------------------------------------------------------------------*/
/* Add RACF group libraries for RACF/DB2 dialog support               */
/*--------------------------------------------------------------------*/
    If (RACFo > 0) × (RACFg > 0) ×,
       (AUDo > 0) × (AUDg > 0) ×,
       (SYSUID = "KETCSC") Then,
      Do
        DSNOK = SYSDSN("'CSCSEC.RACF.CLIB'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'CSCSEC.RACF.CLIB'"
        DSNOK = SYSDSN("'CSCSEC.RACF.EXEC'")
        If (DSNOK = "OK") then,
          Do
            SYSPROC = SYSPROC "'CSCSEC.RACF.EXEC'"
            SYSEXEC = SYSEXEC "'CSCSEC.RACF.EXEC'"
          End
        DSNOK = SYSDSN("'CSCSEC.RACF.LOADLIB'")
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'CSCSEC.RACF.LOADLIB'"
        DSNOK = SYSDSN("'CSCSEC.RACF.MSGS'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'CSCSEC.RACF.MSGS'"
        DSNOK = SYSDSN("'CSCSEC.RACF.PANELS'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'CSCSEC.RACF.PANELS'"
        DSNOK = SYSDSN("'CSCSEC.RACF.SKELS'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'CSCSEC.RACF.SKELS'"
        DSNOK = SYSDSN("'CSCSEC.RACF.TABLES'")
        If (DSNOK = "OK") then,
          Do
            ISPMLIB = ISPMLIB "'CSCSEC.RACF.TABLES'"
            ISPSLIB = ISPSLIB "'CSCSEC.RACF.TABLES'"
            ISPTLIB = ISPTLIB "'CSCSEC.RACF.TABLES'"
          End
      End
/*--------------------------------------------------------------------*/
/* Add MVS group libraries for user support                           */
/*--------------------------------------------------------------------*/
    If (SMFID = "DOFD") × (SMFID = "DOFP") then,
      Do
        DSNOK = SYSDSN("'TECHSERV.SYSPROC'")             /* MVS      */
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'TECHSERV.SYSPROC'"
        DSNOK = SYSDSN("'TECHSERV.HELP'")                /* MVS      */
        If (DSNOK = "OK") then,
          SYSHELP = SYSHELP "'TECHSERV.HELP'"
        DSNOK = SYSDSN("'TECHSERV.ISPLLIB'")             /* MVS      */
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'TECHSERV.ISPLLIB'"
        DSNOK = SYSDSN("'TECHSERV.ISPMLIB'")             /* MVS      */
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'TECHSERV.ISPMLIB'"
        DSNOK = SYSDSN("'TECHSERV.ISPPLIB'")             /* MVS      */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'TECHSERV.ISPPLIB'"
        DSNOK = SYSDSN("'TECHSERV.ISPSLIB'")             /* MVS      */
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'TECHSERV.ISPSLIB'"
        DSNOK = SYSDSN("'TECHSERV.ISPTLIB'")             /* MVS      */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'TECHSERV.ISPTLIB'"
      End
ADDIBM:
/*--------------------------------------------------------------------*/
/* Add IBM product libraries                                          */
/*--------------------------------------------------------------------*/
    DSNOK = SYSDSN("'SYS1.HELP'")
    If (DSNOK = "OK") then,
      SYSHELP = SYSHELP "'SYS1.HELP'"
    IF (CVTPRODN = "SP4.1.0") then,
      Do
        DSNOK = SYSDSN("'ISR.ISRCLIB'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'ISR.ISRCLIB'"
        DSNOK = SYSDSN("'ISR.ISRLOAD'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'ISR.ISRLOAD'"
        DSNOK = SYSDSN("'ISP.ISPLOAD'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'ISP.ISPLOAD'"
        DSNOK = SYSDSN("'ISR.ISRMENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'ISR.ISRMENU'"
        DSNOK = SYSDSN("'ISP.ISPMENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'ISP.ISPMENU'"
        DSNOK = SYSDSN("'ISF.ISFPLIB'")                  /* SDSF     */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISF.ISFPLIB'"
        DSNOK = SYSDSN("'ISR.ISRPENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISR.ISRPENU'"
        DSNOK = SYSDSN("'ISP.ISPPENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISP.ISPPENU'"
        DSNOK = SYSDSN("'ISR.ISRSENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'ISR.ISRSENU'"
        DSNOK = SYSDSN("'ISP.ISPSLIB'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'ISP.ISPSLIB'"
        DSNOK = SYSDSN("'ISF.ISFTLIB'")                  /* SDSF     */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISF.ISFTLIB'"
        DSNOK = SYSDSN("'ISR.ISRTENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISR.ISRTLIB'"
        DSNOK = SYSDSN("'ISP.ISPTENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISP.ISPTENU'"
      End
    IF (CVTPRODN = "SP4.3.0") then,
      Do
        DSNOK = SYSDSN("'ISR.ISRCLIB'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'ISR.ISRCLIB'"
        DSNOK = SYSDSN("'ISR.ISRLOAD'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'ISR.ISRLOAD'"
        DSNOK = SYSDSN("'ISP.ISPLOAD'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPLLIB = ISPLLIB "'ISP.ISPLOAD'"
        DSNOK = SYSDSN("'ISR.ISRMENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'ISR.ISRMENU'"
        DSNOK = SYSDSN("'ISP.ISPMENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'ISP.ISPMENU'"
        DSNOK = SYSDSN("'ISF.ISFPLIB'")                  /* SDSF     */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISF.ISFPLIB'"
        DSNOK = SYSDSN("'ISR.ISRPENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISR.ISRPENU'"
        DSNOK = SYSDSN("'ISP.ISPPENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'ISP.ISPPENU'"
        DSNOK = SYSDSN("'ISR.ISRSENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'ISR.ISRSENU'"
        DSNOK = SYSDSN("'ISP.ISPSLIB'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'ISP.ISPSLIB'"
        DSNOK = SYSDSN("'ISF.ISFTLIB'")                  /* SDSF     */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISF.ISFTLIB'"
        DSNOK = SYSDSN("'ISR.ISRTENU'")                  /* ISPF/PDF */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISR.ISRTLIB'"
        DSNOK = SYSDSN("'ISP.ISPTENU'")                  /* ISPF     */
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'ISP.ISPTENU'"
      End
/*--------------------------------------------------------------------*/
/* Add MVS group libraries for user support                           */
/*--------------------------------------------------------------------*/
    IF (CVTPRODN = "SP4.1.0") then,
      Do
        If (SMFID = "MVSP") × (SMFID = "MVSW") then,
          Do
            DSNOK = SYSDSN("'SYS1.CSC.CLIST'")           /* MVS      */
            If (DSNOK = "OK") then,
              SYSPROC = SYSPROC "'SYS1.CSC.CLIST'"
            DSNOK = SYSDSN("'SYS1.CSC.USRMLIB'")         /* MVS      */
            If (DSNOK = "OK") then,
              ISPMLIB = ISPMLIB "'SYS1.CSC.USRMLIB'"
            DSNOK = SYSDSN("'SYS1.CSC.USRPLIB'")         /* MVS      */
            If (DSNOK = "OK") then,
              ISPPLIB = ISPPLIB "'SYS1.CSC.USRPLIB'"
          End
      End
    IF (CVTPRODN = "SP4.3.0") then,
      Do
        If (SMFID = "MVSP") then,
          Do
            DSNOK = SYSDSN("'MVSP.USER.SYSPROC'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              SYSPROC = SYSPROC "'MVSP.USER.SYSPROC'"
            DSNOK = SYSDSN("'MVSP.USER.ISPLLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPLLIB = ISPLLIB "'MVSP.USER.ISPLLIB'"
            DSNOK = SYSDSN("'MVSP.USER.ISPMLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPMLIB = ISPMLIB "'MVSP.USER.ISPMLIB'"
            DSNOK = SYSDSN("'MVSP.USER.ISPPLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPPLIB = ISPPLIB "'MVSP.USER.ISPPLIB'"
            DSNOK = SYSDSN("'MVSP.USER.ISPSLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPSLIB = ISPSLIB "'MVSP.USER.ISPSLIB'"
            DSNOK = SYSDSN("'MVSP.USER.ISPTLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPTLIB = ISPTLIB "'MVSP.USER.ISPTLIB'"
          End
        If (SMFID = "MVSW") then,
          Do
            DSNOK = SYSDSN("'MVSW.USER.SYSPROC'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              SYSPROC = SYSPROC "'MVSW.USER.SYSPROC'"
            DSNOK = SYSDSN("'MVSW.USER.ISPLLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPLLIB = ISPLLIB "'MVSW.USER.ISPLLIB'"
            DSNOK = SYSDSN("'MVSW.USER.ISPMLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPMLIB = ISPMLIB "'MVSW.USER.ISPMLIB'"
            DSNOK = SYSDSN("'MVSW.USER.ISPPLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPPLIB = ISPPLIB "'MVSW.USER.ISPPLIB'"
            DSNOK = SYSDSN("'MVSW.USER.ISPSLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPSLIB = ISPSLIB "'MVSW.USER.ISPSLIB'"
            DSNOK = SYSDSN("'MVSW.USER.ISPTLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPTLIB = ISPTLIB "'MVSW.USER.ISPTLIB'"
          End
        If (SMFID = "MVSZ") then,
          Do
            DSNOK = SYSDSN("'MVSZ.USER.SYSPROC'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              SYSPROC = SYSPROC "'MVSZ.USER.SYSPROC'"
            DSNOK = SYSDSN("'MVSZ.USER.ISPLLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPLLIB = ISPLLIB "'MVSZ.USER.ISPLLIB'"
            DSNOK = SYSDSN("'MVSZ.USER.ISPMLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPMLIB = ISPMLIB "'MVSZ.USER.ISPMLIB'"
            DSNOK = SYSDSN("'MVSZ.USER.ISPPLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPPLIB = ISPPLIB "'MVSZ.USER.ISPPLIB'"
            DSNOK = SYSDSN("'MVSZ.USER.ISPSLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPSLIB = ISPSLIB "'MVSZ.USER.ISPSLIB'"
            DSNOK = SYSDSN("'MVSZ.USER.ISPTLIB'")        /* MVS      */
            IF (DSNOK = "OK") THEN,
              ISPTLIB = ISPTLIB "'MVSZ.USER.ISPTLIB'"
          End
      End
/*--------------------------------------------------------------------*/
/* Add IBM DB2 product support                                        */
/*--------------------------------------------------------------------*/
    DSNOK = SYSDSN("'"DBID".DSNCLIST'")                   /* DB2      */
    If (DSNOK = "OK") then,
      SYSPROC = SYSPROC "'"DBID".DSNCLIST'"
    DSNOK = SYSDSN("'"DBID".DSNSPFM'")                    /* DB2      */
    If (DSNOK = "OK") then,
      ISPMLIB = ISPMLIB "'"DBID".DSNSPFM'"
    DSNOK = SYSDSN("'"DBID".DSNLOAD'")                    /* DB2      */
    If (DSNOK = "OK") then,
      ISPLLIB = ISPLLIB "'"DBID".DSNLOAD'"
    DSNOK = SYSDSN("'"DBID".DSNSPFP'")                    /* DB2      */
    If (DSNOK = "OK") then,
      ISPPLIB = ISPPLIB "'"DBID".DSNSPFP'"
    DSNOK = SYSDSN("'"DBID".DSQCLSTE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      SYSPROC = SYSPROC "'"DBID".DSQCLSTE'"
    DSNOK = SYSDSN("'"DBID".DSQEXECE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      SYSEXEC = SYSEXEC "'"DBID".DSQEXECE'"
    DSNOK = SYSDSN("'"DBID".DSQLOAD'")                    /* QMF      */
    If (DSNOK = "OK") then,
      ISPLLIB = ISPLLIB "'"DBID".DSQLOAD'"
    DSNOK = SYSDSN("'"DBID".DSQMLIBE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      ISPMLIB = ISPMLIB "'"DBID".DSQMLIBE'"
    DSNOK = SYSDSN("'"DBID".DSQPLIBE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      ISPPLIB = ISPPLIB "'"DBID".DSQPLIBE'"
    DSNOK = SYSDSN("'"DBID".DSQSLIBE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      ISPSLIB = ISPSLIB "'"DBID".DSQSLIBE'"
    DSNOK = SYSDSN("'"DBID".DSQTLIBE'")                   /* QMF      */
    If (DSNOK = "OK") then,
      ISPTLIB = ISPTLIB "'"DBID".DSQTLIBE'"
/*--------------------------------------------------------------------*/
/* Add IBM CSP product support                                        */
/*--------------------------------------------------------------------*/
    If (HRAo > 0) × (HRAg > 0) ×,
       (DB2o > 0) × (DB2g > 0) Then,
      Do
        If (TSOPROC = "DB2DEVL") Then,
          Do
            If (SMFID = "MVSP") then,
              Do
                DSNOK = SYSDSN("'CSP.DEVL.ADCLIST'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.DEVL.ADCLIST'"
                DSNOK = SYSDSN("'CSP.DEVL.AECLIST'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.DEVL.AECLIST'"
                DSNOK = SYSDSN("'CSP.DEVL.AELOAD'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'CSP.DEVL.AELOAD'"
                DSNOK = SYSDSN("'CSP.DEVL.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.DEVL.ADPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.DEVL.AEPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.DEVL.ADPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.DEVL.AEPLIB'"
              End
            If (SMFID = "MVSW") then,
              Do
                DSNOK = SYSDSN("'CSP.DEVL.ADCLIST'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.DEVL.ADCLIST'"
                DSNOK = SYSDSN("'CSP.DEVL.AECLIST'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.DEVL.AECLIST'"
                DSNOK = SYSDSN("'CSP.DEVL.AELOAD'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'CSP.DEVL.AELOAD'"
                DSNOK = SYSDSN("'CSP.DEVL.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.DEVL.ADPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.DEVL.AEPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.DEVL.ADPLIB'"
                DSNOK = SYSDSN("'CSP.DEVL.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.DEVL.AEPLIB'"
              End
            If (SMFID = "MVSX") then,
              Do
                DSNOK = SYSDSN("'XDBS.CSPX.ADCLIST'")    /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.ADCLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AECLIST'")    /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.AECLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AELOAD'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'XDBS.CSPX.AELOAD'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.AEPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.AEPLIB'"
              End
            If (SMFID = "MVSZ") then,
              Do
                DSNOK = SYSDSN("'XDBS.CSPX.ADCLIST'")    /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.ADCLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AECLIST'")    /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.AECLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AELOAD'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'XDBS.CSPX.AELOAD'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.AEPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.AEPLIB'"
              End
          End
        If (TSOPROC = "DB2PROD") then,
          Do
            If (SMFID = "MVSP") then,
              Do
                DSNOK = SYSDSN("'CSP.PROD.ADCLIST'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.PROD.ADCLIST'"
                DSNOK = SYSDSN("'CSP.PROD.AECLIST'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.PROD.AECLIST'"
                DSNOK = SYSDSN("'CSP.PROD.AELOAD'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'CSP.PROD.AELOAD'"
                DSNOK = SYSDSN("'CSP.PROD.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.PROD.ADPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.PROD.AEPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.PROD.ADPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.PROD.AEPLIB'"
              End
            If (SMFID = "MVSW") then,
              Do
                DSNOK = SYSDSN("'CSP.PROD.ADCLIST'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.PROD.ADCLIST'"
                DSNOK = SYSDSN("'CSP.PROD.AECLIST'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'CSP.PROD.AECLIST'"
                DSNOK = SYSDSN("'CSP.PROD.AELOAD'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'CSP.PROD.AELOAD'"
                DSNOK = SYSDSN("'CSP.PROD.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.PROD.ADPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'CSP.PROD.AEPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.ADPLIB'")      /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.PROD.ADPLIB'"
                DSNOK = SYSDSN("'CSP.PROD.AEPLIB'")      /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'CSP.PROD.AEPLIB'"
              End
            If (SMFID = "MVSX") then,
              Do
                DSNOK = SYSDSN("'XDBS.CSPX.ADCLIST'")    /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.ADCLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AECLIST'")    /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.AECLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AELOAD'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'XDBS.CSPX.AELOAD'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.AEPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.AEPLIB'"
              End
            If (SMFID = "MVSZ") then,
              Do
                DSNOK = SYSDSN("'XDBS.CSPX.ADCLIST'")    /* CSP/AD   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.ADCLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AECLIST'")    /* CSP/AE   */
                If (DSNOK = "OK") then,
                  SYSPROC = SYSPROC "'XDBS.CSPX.AECLIST'"
                DSNOK = SYSDSN("'XDBS.CSPX.AELOAD'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPLLIB = ISPLLIB "'XDBS.CSPX.AELOAD'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPMLIB = ISPMLIB "'XDBS.CSPX.AEPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.ADPLIB'")     /* CSP/AD   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.ADPLIB'"
                DSNOK = SYSDSN("'XDBS.CSPX.AEPLIB'")     /* CSP/AE   */
                If (DSNOK = "OK") then,
                  ISPPLIB = ISPPLIB "'XDBS.CSPX.AEPLIB'"
              End
          End
      End
/*--------------------------------------------------------------------*/
/* Add IBM RACF product support                                       */
/*--------------------------------------------------------------------*/
    If (RACFo > 0) × (RACFg > 0) ×,
       (AUDo > 0) × (AUDg > 0) ×,
       (MVSo > 0) × (MVSg > 0) ×,
       (SYSUID = "KETCSC") Then,
      do
        DSNOK = SYSDSN("'SYS1.HRFCLST'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'SYS1.HRFCLST'"
        DSNOK = SYSDSN("'SYS1.HRFMSG'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'SYS1.HRFMSG'"
        DSNOK = SYSDSN("'SYS1.HRFPANL'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'SYS1.HRFPANL'"
        DSNOK = SYSDSN("'SYS1.HRFSKEL'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'SYS1.HRFSKEL'"
      End
/*--------------------------------------------------------------------*/
/* Add IBM ISMF product support                                       */
/*--------------------------------------------------------------------*/
    If (MVSo > 0) × (MVSg > 0) ×,
       (SYSUID = "KETCSC") Then,
      do
        DSNOK = SYSDSN("'SYS1.DGTCLIB'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'SYS1.DGTCLIB'"
        DSNOK = SYSDSN("'SYS1.DGTMLIB'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'SYS1.DGTMLIB'"
        DSNOK = SYSDSN("'SYS1.DGTPLIB'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'SYS1.DGTPLIB'"
        DSNOK = SYSDSN("'SYS1.DGTSLIB'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'SYS1.DGTSLIB'"
        DSNOK = SYSDSN("'SYS1.DGTTLIB'")
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'SYS1.DGTTLIB'"
      End
/*--------------------------------------------------------------------*/
/* Add IBM IPCS product support                                       */
/*--------------------------------------------------------------------*/
    If (MVSo > 0) × (MVSg > 0) ×,
       (DB2o > 0) × (DB2g > 0) ×,
       (SYSUID = "KETCSC") Then,
      do
        DSNOK = SYSDSN("'SYS1.SBLSCLI0'")
        If (DSNOK = "OK") then,
          SYSPROC = SYSPROC "'SYS1.SBLSCLI0'"
        DSNOK = SYSDSN("'SYS1.SBLSMSG0'")
        If (DSNOK = "OK") then,
          ISPMLIB = ISPMLIB "'SYS1.SBLSMSG0'"
        DSNOK = SYSDSN("'SYS1.SBLSPNL0'")
        If (DSNOK = "OK") then,
          ISPPLIB = ISPPLIB "'SYS1.SBLSPNL0'"
        DSNOK = SYSDSN("'SYS1.SBLSKEL0'")
        If (DSNOK = "OK") then,
          ISPSLIB = ISPSLIB "'SYS1.SBLSKEL0'"
        DSNOK = SYSDSN("'SYS1.SBLSTLB0'")
        If (DSNOK = "OK") then,
          ISPTLIB = ISPTLIB "'SYS1.SBLSTLB0'"
      End
/*--------------------------------------------------------------------*/
/* Add IBM Netview File Transfer product support                      */
/*--------------------------------------------------------------------*/
    If (MVSo > 0) × (MVSg > 0) ×,
       (DB2o > 0) × (DB2g > 0) ×,
       (SYSUID = "KETCSC") Then,
      do
        IF (CVTPRODN = "SP4.1.0") then,
          Do
            DSNOK = SYSDSN("'DVG.SDVGLMD1'")
            If (DSNOK = "OK") then,
              ISPLLIB = ISPLLIB "'DVG.SDVGLMD1'"
            DSNOK = SYSDSN("'DVG.V211.MESSAGES'")
            If (DSNOK = "OK") then,
              ISPMLIB = ISPMLIB "'DVG.V211.MESSAGES'"
            DSNOK = SYSDSN("'DVG.V211.PANELS'")
            If (DSNOK = "OK") then,
              ISPPLIB = ISPPLIB "'DVG.V211.PANELS'"
          End
      End
/*--------------------------------------------------------------------*/
/* RACF group uses common output table library else D37 abends        */
/*--------------------------------------------------------------------*/
    If (RACFo > 0) ×,
       (RACFg > 0) then,
      Do
        ISPTABL = "'CSCSEC.RACF.TABLES'"
        ISPTLIB = "'CSCSEC.RACF.TABLES'" ISPTLIB
      End
/*====================================================================*/
/* Allocate TSO libraries                                             */
/*====================================================================*/
    Address TSO
    x = Outtrap('name.')
    "FREE FI(SYSPROC)"
    x = Outtrap('OFF')
    "ALLOC FI(SYSPROC) SHR DA(",
      SYSPROC,
      ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of SYSPROC failed with RC="MYRC
      End
    x = Outtrap('name.')
    "FREE FI(SYSEXEC)"
    x = Outtrap('OFF')
    "ALLOC FI(SYSEXEC) SHR DA(",
      SYSEXEC,
      ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of SYSEXEC failed with RC="MYRC
      End
    x = Outtrap('name.')
    "FREE FI(SYSHELP)"
    x = Outtrap('OFF')
    "ALLOC FI(SYSHELP) SHR DA(",
      SYSHELP,
      ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of SYSHELP failed with RC="MYRC
      End
/*====================================================================*/
/* Allocate ISPF libraries                                            */
/*====================================================================*/
    DSNAME = SYSUID".ISPF.ISPPROF"
    "ALLOC FI(ISPPROF) DATASET('"DSNAME"') SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      DO
        x = Outtrap('name.')
        Address TSO,
          "FREE FI(ISPCRTE)"
        x = Outtrap('OFF')
        Address TSO,
          "ATTRIB ISPCRTE DSORG(PO) RECFM(F B) LRECL(80) BLKSIZE(3120)"
        Address TSO,
          "ALLOC DA('"DSNAME"') SP(2,2) TRACKS DIR(8) USING(ISPCRTE)",
            "FI(ISPPROF)"
        MYRC = RC
        x = Outtrap('name.')
        Address TSO "FREE FI(ISPCRTE)"
        x = Outtrap('OFF')
        IF MYRC = 0 THEN ,
          SAY "--* ISPF PROFILE DATA '"DSNAME"' HAS BEEN CREATED."
        ELSE ,
         DO
            SAY " --* UNABLE TO ALLOCATE ISPF PROFILE DATA '"DSNAME"'."
            EXIT 12
         END
      END
    x = Outtrap('name.')
    Address TSO,
      "FREE FILE(ISPLLIB,ISPMLIB,ISPPLIB,ISPSLIB,ISPTLIB,ISPTABL)"
    x = Outtrap('OFF')
    Address TSO,
      "ALLOC FI(ISPLLIB) SHR DA(",
        ISPLLIB,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPLLIB failed with RC="MYRC
      End
    Address TSO,
      "ALLOC FI(ISPMLIB) SHR DA(",
        ISPMLIB,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPMLIB failed with RC="MYRC
      End
    Address TSO,
      "ALLOC FI(ISPPLIB) SHR DA(",
        ISPPLIB,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPPLIB failed with RC="MYRC
      End
    Address TSO,
      "ALLOC FI(ISPSLIB) SHR DA(",
        ISPSLIB,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPSLIB failed with RC="MYRC
      End
    Address TSO,
      "ALLOC FI(ISPTABL) SHR DA(",
        ISPTABL,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPTABL failed with RC="MYRC
      End
    Address TSO,
      "ALLOC FI(ISPTLIB) SHR DA(",
        ISPTLIB,
        ") SHR REUSE"
    MYRC = RC
    IF MYRC ^= 0 THEN ,
      Do
        Say "Allocate of ISPTLIB failed with RC="MYRC
      End
/*--------------------------------------------------------------------*/
/* DB2 group can run REXX addon                                       */
/*--------------------------------------------------------------------*/
INVKPDF:
    If (DB2o > 0) × (DB2g > 0) ×,
       (SYSUID = "KETCSC") Then,
      do
        DSNOK = SYSDSN("'"SYSUID".EXEC(ADDON)'")
        IF (DSNOK = "OK") THEN ,
          SIGNAL INVKUSER
      End
    Call AGAIN
/*--------------------------------------------------------------------*/
/* On MVS 4.1 we tried to trick our way to IPCS                       */
/*--------------------------------------------------------------------*/
    IF (CVTPRODN = "SP4.2.0") then,
      Do
        x = Outtrap('name.')
        Address TSO "ATTR IPCSINVK"
        x = Outtrap('OFF')
        Address TSO "FREE F(IPCSINVK)"
        LINES = name.0
        IF LINES > 0 THEN exit 0
        SAY "*-------------------------------------------------------*"
        SAY "*                                                       *"
        SAY "*  IPCS IS IN THE PROCESS OF COMING UP.  THIS WILL      *"
        SAY "*  TAKE SEVERAL SECONDS TO ACCOMPLISH.  PLEASE WAIT.    *"
        SAY "*                                                       *"
        SAY "*-------------------------------------------------------*"
        IPCS
        ISPSTART PNL
      end
    EXIT 0
/*--------------------------------------------------------------------*/
/*  USER HAS OWN INVOCATION REXX exec                                 */
/*--------------------------------------------------------------------*/
INVKUSER:
    Address TSO "EXEC '"SYSUID".EXEC(ADDON)'"
    SAY " "
    SAY "SYSTEM:"SMFID
    SAY " "
    SAY "You are now out of ISPF."
    SAY "   OPTIONS if you did not mess with SYSPROC or SYSEXEC are:"
    SAY "         %l (to logon as "SYSUID")"
    SAY "         %x or logoff (to logoff)"
    SAY "         %again (to get back to ISPF menu)"
    SAY " "
    EXIT 0
./ ADD NAME=VMMSG    0102-92111-92114-2200-00053-00052-00003-DMV0016
/***************** VMMSG - REXX EXEC ********************************/
/*                                                                  */
/* LIB: EXEC(VMMSG)                                                 */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC USES TSO TRANSMIT TO SEND A MESSAGE TO A VM ID.   */
/*                                                                  */
/***************** VMMSG - REXX EXEC ********************************/
    SAY ' '
    SAY ' LIB: XDBS.TSOISPF.EXEC(VMMSG)'
    SAY ' GDE: KENNETH E. TOMIAK'
    SAY ' DOC: THIS EXEC COPIES THE SYSIN TO VMMSG AND ISSUES'
    SAY '      THE TSO TRANSMIT COMMAND TO SEND IT TO THE USER.'
    SAY ' '

    ARG TOID
    DO WHILE TOID = ' '
      SAY 'YOU FORGOT WHO IT GOES TO.'
      EXIT 16
    END
/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'

/**********************************************************/
/* PROCESS INPUT                                          */
/**********************************************************/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR SYSIN"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
        DO
          DONE = 'YES'
          "EXECIO 0 DISKW VMMSG (FINIS"
          "EXECIO 0 DISKR SYSIN (FINIS"
        END
      ELSE
       DO
         PARSE PULL TEXT 72 NBR
         SAY TEXT
         PUSH TEXT
         "EXECIO 1 DISKW VMMSG"
       END
    END
    "TRANSMIT " TOID "MSGDDNAME(VMMSG)"
    RCSAVE = RC

/**********************************************************/
/* DIALOG IS FINISHED.                                    */
/**********************************************************/

    EXIT RCSAVE
./ ADD NAME=VMMSGIT  0110-92336-94026-1531-00122-00144-00104-PETE
/*============== VMMSGIT - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(VMMSGIT)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC READS A MSG FILE AND SENDS MESSAGES TO THE        */
/*      DESIGNATED IDS.                                             */
/*                                                                  */
/*============== VMMSGIT - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    ARG SSID
    SAY 'RUN ON ' DATE() ' AT ' TIME() 'FOR SSID' SSID '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'
    XMITRC = 0
    ICTR = 1
    MSG.DB2SYS.ICTR = "TO: "SSID"SYS"
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "

/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR SYSIN"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
        DO
          DONE = 'YES'
          "EXECIO 0 DISKR SYSIN (FINIS"
          IF (MC > 0) THEN
            DO
              SIGNAL WRAPUP
            END
        END
      ELSE
       DO
         PARSE PULL TEXT
         JOBNAME = WORD(TEXT,2)
         IF (JOBNAME ^= 'INITIALIZED') THEN
           DO
             ICTR = ICTR + 1
             JOBNAME = LEFT(JOBNAME"        ",8)
             STATUS   = WORD(TEXT,3)
             STATUS = SUBSTR(STATUS'               ',1,15)
             RUNDD    = WORD(TEXT,4)
             RUNMM    = WORD(TEXT,5)
             RUNYYYY  = WORD(TEXT,6)
             RUNTIME  = WORD(TEXT,7)
             RUNMSG   = WORD(TEXT,8)
             RUNJOB   = WORD(TEXT,9)
             RUNDESC  = WORD(TEXT,10)
             JOBDS = "JOB#"
             JS = POS('(JOB',RUNDESC)
             IF (JS = 0) THEN JOBDS = "STC#"
             IF (JS = 0) THEN JS = POS('(STC',RUNDESC)
             IF (JS = 0) THEN JOBDS = "TSU#"
             IF (JS = 0) THEN JS = POS('(TSU',RUNDESC)
             JNBR = SUBSTR(RUNDESC,JS+4,5)
             RUNTEXT  = WORD(TEXT,11)
             MSG.DB2SYS.ICTR = JOBNAME JOBDS JNBR,
                STATUS RUNMM RUNDD"," RUNYYYY RUNTIME
           END
         ELSE
           DO
             ICTR = ICTR + 1
             MSG.DB2SYS.ICTR = TEXT
           END
       END
    END
WRAPUP:
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = "CC: DB2MGR"
    DO J = ICTR TO 1 BY -1
      TEXTLINE = MSG.DB2SYS.J
      PUSH TEXTLINE
    END
    DO J = 1 TO ICTR BY 1
      TEXTLINE = MSG.DB2SYS.J
      SAY TEXTLINE
    END
    SUBSYS = SSID
    MSGSTAT = MSG(ON)
    ADDRESS TSO "FREE  FILE(VMMSG)"
    ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".VMMSG'"
    ADDRESS TSO "ALLOC FILE(VMMSG) NEW CATALOG",
        "DATASET('XDBS."DB2SYS"."SUBSYS".VMMSG')",
        "DIR(0) RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)"
    RCSAVE = RC
    IF (RCSAVE = 0) THEN
      DO
        "EXECIO" ICTR "DISKW VMMSG (FINIS"
        "TRANSMIT " SSID"SYS MSGDDNAME(VMMSG) NONOTIFY NOLOG"
        XMITRC = RC
        ADDRESS TSO "FREE  FILE(VMMSG)"
        ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".VMMSG'"
      END
    ELSE
      DO
        SAY "ALLOC FAILED SO NO TXMIT"
        DO K = 1 TO CTR.DB2SYS
          PULL JUNK
          SAY JUNK
        END
        XMITRC = 16
      END
    MSGSTAT = MSG(OFF)

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/
    XMITRC = XMITRC + 0

    EXIT XMITRC
./ ADD NAME=VMMSGMG  0100-93020-93020-1657-00119-00119-00000-DMV0016
/*============== VMMSGIT - REXX EXEC ===============================*/
/*                                                                  */
/* LIB: EXEC(VMMSGIT)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC READS A MSG FILE AND SENDS MESSAGES TO THE        */
/*      DESIGNATED IDS.                                             */
/*                                                                  */
/*============== VMMSGIT - REXX EXEC ===============================*/
    DO LINE = 1 WHILE SUBSTR(SOURCELINE(LINE),1,2) = "/*"
      SAY SOURCELINE(LINE)
    END
    ARG SSID
    SAY 'RUN ON ' DATE() ' AT ' TIME() 'FOR SSID' SSID '.'

/*========================================================*/
/* PRELIMINARY SETUP                                      */
/*========================================================*/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'
    XMITRC = 0
    ICTR = 1
    MSG.DB2SYS.ICTR = "TO: DB2 MANAGER"
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "

/*========================================================*/
/* PROCESS INPUT                                          */
/*========================================================*/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR SYSIN"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
        DO
          DONE = 'YES'
          "EXECIO 0 DISKR SYSIN (FINIS"
          IF (MC > 0) THEN
            DO
              SIGNAL WRAPUP
            END
        END
      ELSE
       DO
         PARSE PULL TEXT
         JOBNAME = WORD(TEXT,2)
         IF (JOBNAME ^= 'INITIALIZED') THEN
           DO
             ICTR = ICTR + 1
             JOBNAME = LEFT(JOBNAME"        ",8)
             STATUS   = WORD(TEXT,3)
             STATUS = SUBSTR(STATUS'               ',1,15)
             RUNDD    = WORD(TEXT,4)
             RUNMM    = WORD(TEXT,5)
             RUNYYYY  = WORD(TEXT,6)
             RUNTIME  = WORD(TEXT,7)
             RUNMSG   = WORD(TEXT,8)
             RUNJOB   = WORD(TEXT,9)
             RUNDESC  = WORD(TEXT,10)
             JOBDS = "JOB#"
             JS = POS('(JOB',RUNDESC)
             IF (JS = 0) THEN JOBDS = "STC#"
             IF (JS = 0) THEN JS = POS('(STC',RUNDESC)
             IF (JS = 0) THEN JOBDS = "TSU#"
             IF (JS = 0) THEN JS = POS('(TSU',RUNDESC)
             JNBR = SUBSTR(RUNDESC,JS+4,5)
             RUNTEXT  = WORD(TEXT,11)
             MSG.DB2SYS.ICTR = JOBNAME JOBDS JNBR,
                STATUS RUNMM RUNDD"," RUNYYYY RUNTIME
           END
         ELSE
           DO
             ICTR = ICTR + 1
             MSG.DB2SYS.ICTR = TEXT
           END
       END
    END
WRAPUP:
    ICTR = ICTR + 1
    MSG.DB2SYS.ICTR = " "
    DO J = ICTR TO 1 BY -1
      TEXTLINE = MSG.DB2SYS.J
      PUSH TEXTLINE
    END
    DO J = 1 TO ICTR BY 1
      TEXTLINE = MSG.DB2SYS.J
      SAY TEXTLINE
    END
    SUBSYS =KETCSC
    ADDRESS TSO "FREE  FILE(VMMSG)"
    ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".VMMSG'"
    MSGSTAT = MSG(ON)
    ADDRESS TSO "ALLOC FILE(VMMSG) NEW CATALOG",
        "DATASET('XDBS."DB2SYS"."SUBSYS".VMMSG')",
        "DIR(0) RECFM(F B) BLKSIZE(3120) LRECL(80)",
        "SPACE(1 1) TRACKS UNIT(SYSDA)"
    RCSAVE = RC
    IF (RCSAVE = 0) THEN
      DO
        "EXECIO" ICTR "DISKW VMMSG (FINIS"
        "TRANSMIT DB2MGR MSGDDNAME(VMMSG) NONOTIFY NOLOG"
        ADDRESS TSO "FREE  FILE(VMMSG)"
        ADDRESS TSO "DELETE 'XDBS."DB2SYS"."SUBSYS".VMMSG'"
      END
    ELSE
      DO
        SAY "ALLOC FAILED SO NO TXMIT"
        DO K = 1 TO CTR.DB2SYS
          PULL JUNK
          SAY JUNK
        END
        XMITRC = 16
      END
    MSGSTAT = MSG(OFF)

/*========================================================*/
/* DIALOG IS FINISHED.                                    */
/*========================================================*/
    XMITRC = XMITRC + 0

    EXIT XMITRC
./ ADD NAME=WHATPROC 0102-93273-93273-0910-00013-00013-00002-KETCSC
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(WHATPROC)                                          */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: FIGURES OUT YOUR TSO ID OR BATCH JOBNAME.                    */
/*                                                                   */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
SAY JOBNAME STEPNAME PROCNAME DATE() TIME()
./ ADD NAME=WHO      0102-92240-93238-1720-00008-00002-00008-DD20001
/*-------------------------- REXX -----------------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(WHO)                                               */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: WRITE TIME AND USERID TO TERMINAL                            */
/*                                                                   */
/*-------------------------------------------------------------------*/
SAY TIME() USERID()
./ ADD NAME=WHOAMI   0108-91203-93092-2154-00013-00015-00013-DD20008
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(WHOAMI)                                            */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: FIGURES OUT YOUR TSO ID OR BATCH JOBNAME.                    */
/*                                                                   */
/*-------------------------------------------------------------------*/
PSATOLD  = STORAGE(21C,4)                        /* POINTER TO TCB */
PTRTIOT  = STORAGE(D2X(C2D(PSATOLD)+12),4)       /* POINTER TO TIOT */
JOBNAME  = STORAGE(D2X(C2D(PTRTIOT)),8)
STEPNAME = STORAGE(D2X(C2D(PTRTIOT)+8),8)
PROCNAME = STORAGE(D2X(C2D(PTRTIOT)+16),8)
ADDRESS  ISPEXEC "VPUT (TIOTJOB TIOTSTEP TIOTPROC)"

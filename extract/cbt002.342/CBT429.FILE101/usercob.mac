PROC 0 DEBUG
CONTROL NOMSG NOFLUSH NOPROMPT NOLIST
IF &DEBUG NE &STR() THEN +
  CONTROL MSG PROMPT CONLIST SYMLIST LIST
FREE F(SYSUT1,SYSUT2,SYSUT3,SYSUT4,SYSUT5,SYSUT6)
FREE F(SYSPUNCH,SYSIN,SYSTERM,SYSPRINT,SYSLIB,SYSLIN)
FREE A(COBLIST)
ISPEXEC CONTROL ERRORS RETURN
ISPEXEC VGET (PRJ1,LIB1,COBT,MEM,BCLA,FCOB) PROFILE
SET &LISTOPT EQ &STR()
SET &SYSUT5DS EQ &STR()
SET &SORSWT EQ &STR()
SET &SLIB1 EQ &STR()
SET &SLIB2 EQ &STR()
SET &SLIB3 EQ &STR()
SET &SLIB4 EQ &STR()
IF &STR(&BCLA) EQ &STR() THEN +
  SET &BCLA EQ A
IF &STR(&BCLA) EQ &STR( ) THEN +
  SET &BCLA EQ A
ISPEXEC DISPLAY PANEL(COBOL2) CURSOR(MEM)
IF &LASTCC EQ 8 THEN +
  EXIT
SET &LISTER EQ &STR(OFF)
SET &SYSDVAL EQ &STR(&FCOB)
READDVAL COBP1,COBP2,COBP3,COBP4,COBP5,COBP6,COBP7,COBP8,COBP9
IF &STR(&COBP1) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP1)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP1)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP2) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP2)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP2)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP3) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP3)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP3)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP4) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP4)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP4)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP5) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP5)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP5)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP6) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP6)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP6)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&STR(&COBP7)) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&STR(&COBP7))) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&STR(&COBP7))) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP8) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP8)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP8)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
IF &STR(&COBP9) NE &STR() THEN +
  DO
    IF &LENGTH(&STR(&COBP9)) GE 3 THEN +
      DO
        IF &SUBSTR(1:3,&STR(&COBP9)) EQ &STR(LST) THEN +
          DO
            SET &LISTER EQ &STR(ON)
            GOTO LSTCHK2
          END
      END
  END
SET &SORSWT EQ &STR(ON)
GOTO ENDLSTCK
LSTCHK2: +
SET &SORSWT EQ &STR(OFF)
IF &STR(&COBP1) NE &STR() THEN +
  DO
    IF &STR(&COBP1) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP2) NE &STR() THEN +
  DO
    IF &STR(&COBP2) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP3) NE &STR() THEN +
  DO
    IF &STR(&COBP3) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP4) NE &STR() THEN +
  DO
    IF &STR(&COBP4) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP5) NE &STR() THEN +
  DO
    IF &STR(&COBP5) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP6) NE &STR() THEN +
  DO
    IF &STR(&COBP6) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&STR(&COBP7)) NE &STR() THEN +
  DO
    IF &STR(&STR(&COBP7)) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP8) NE &STR() THEN +
  DO
    IF &STR(&COBP8) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
IF &STR(&COBP9) NE &STR() THEN +
  DO
    IF &STR(&COBP9) EQ &STR(L120) THEN +
      DO
        SET &LISTER EQ &STR(OFF)
        GOTO ENDLSTCK
      END
  END
ENDLSTCK: +
IF &SLIB1 NE &STR() THEN +
  SET &SLIB1 EQ &STR(&STR(')&STR(&SLIB1)&STR(')&STR(,))
IF &SLIB2 NE &STR() THEN +
  SET &SLIB2 EQ &STR(&STR(')&STR(&SLIB2)&STR(')&STR(,))
IF &SLIB3 NE &STR() THEN +
  SET &SLIB3 EQ &STR(&STR(')&STR(&SLIB3)&STR(')&STR(,))
IF &SLIB4 NE &STR() THEN +
  SET &SLIB4 EQ &STR(&STR(')&STR(&SLIB4)&STR(')&STR(,))
ALLOC F(SYSLIB) +
 DA(&SLIB1&SLIB2&SLIB3&SLIB4'DLX1.COBCOPY.COBOL') SHR
ALLOC F(SYSIN) DA('&PRJ1..&LIB1..&COBT(&MEM)') SHR
ALLOC F(SYSLIN) DA('&PRJ1..&LIB1..OBJ(&MEM)') SHR
ALLOC F(SYSPUNCH) DUMMY
ALLOC F(SYSTERM) DA(*)
ALLOC F(SYSUT1) UNIT(VIO) SPACE(10 2) CYLINDERS
ALLOC F(SYSUT2) UNIT(VIO) SPACE(10 2) CYLINDERS
ALLOC F(SYSUT3) UNIT(VIO) SPACE(10 2) CYLINDERS
ALLOC F(SYSUT4) UNIT(VIO) SPACE(10 2) CYLINDERS
IF &SYSUT5DS NE &STR() THEN +
  DO
    WHATIF DATASET('&SYSUT5DS') CATALOGED
    IF &LASTCC EQ 0 THEN +
      DO
        ALLOC F(SYSUT5) DA('&SYSUT5DS') SHR RELEASE
      END
    ELSE +
      DO
        ALLOC F(SYSUT5) DA('&SYSUT5DS') UNIT(SYSTSO) NEW CATALOG +
          SPACE(25 5) TRACKS RELEASE
      END
  END
ELSE +
  DO
    ALLOC F(SYSUT5) UNIT(VIO) SPACE(10 2) CYLINDERS
  END
ALLOC F(SYSUT6) UNIT(VIO) SPACE(10 2) CYLINDERS
IF &LISTER EQ &STR(OFF) THEN +
  ATTR COBLIST RECFM(F B A) LRECL(121) BLKSIZE(1210)
ELSE +
  ATTR COBLIST RECFM(F B A) LRECL(133) BLKSIZE(1330)
ALLOC F(SYSPRINT) DA('&PRJ1..&MEM..COBOL.LIST') NEW CATALOG SPACE(10 5)+
  TRACKS UNIT(SYSTSO) USING(COBLIST)
SET &COBOPT EQ &STR()
IF &STR(&FCOB) NE &STR() THEN +
  SET &COBOPT EQ &STR(&STR(,)&STR(&FCOB))
IF &SYSUT5DS NE &STR() THEN +
IF &LISTER EQ &STR(OFF) THEN +
  SET &COBOPT EQ &STR(&STR(,SYMDMP)&STR(&COBOPT))
IF &SORSWT EQ &STR(OFF) THEN +
  SET &COBOPT EQ &STR(&STR(,NOSOURCE)&STR(&COBOPT))
$ IKFCBL00 'TERM&COBOPT'
SET &RC = &LASTCC
WRITE COBOL COMPLETED RETURN CODE &RC
ISPEXEC BROWSE DATASET('&PRJ1..&MEM..COBOL.LIST')
ISPEXEC VPUT (PRJ1,LIB1,COBT,MEM,BCLA,FCOB) PROFILE
FREE F(SYSUT1,SYSUT2,SYSUT3,SYSUT4,SYSUT5,SYSUT6)
FREE F(SYSPUNCH,SYSIN,SYSTERM,SYSPRINT,SYSLIB,SYSLIN)
FREE A(COBLIST)
IF &LISTOPT NE &STR() THEN +
  DO
    IF &SUBSTR(1:1,&LISTOPT) EQ &STR(P) THEN +
      DO
        ALLOC F(SYSIN) DUMMY
        ALLOC F(SYSPRINT) DUMMY
        ALLOC F(SYSUT1) DA('&PRJ1..&MEM..COBOL.LIST') SHR
        ALLOC F(SYSUT2) SYSOUT(&BCLA) NOHOLD KEEP
        $ IEBGENER
        FREE F(SYSIN,SYSPRINT,SYSUT1,SYSUT2)
      END
  END
DELETE '&PRJ1..&MEM..COBOL.LIST'
ALLOC F(SYSIN) DA(*)
ALLOC F(SYSPRINT) DA(*)
ALLOC F(SYSTERM) DA(*)
ALLOC F(SYSUT1) NEW DELETE UNIT(VIO) SPACE(4) CYL
ALLOC F(SYSUT2) NEW DELETE UNIT(VIO) SPACE(4) CYL
ALLOC F(SYSUT3) NEW DELETE UNIT(VIO) SPACE(4) CYL
ALLOC F(SYSUT4) NEW DELETE UNIT(VIO) SPACE(4) CYL
IF &RC EQ 0 THEN +
  ISPEXEC SELECT CMD(USERLNK &DEBUG)
IF &RC EQ 4 THEN +
  ISPEXEC SELECT CMD(USERLNK &DEBUG)
END

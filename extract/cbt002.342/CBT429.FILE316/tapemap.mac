         TITLE '   T A P E M A P  '
**$DOC@****************************************************************
*                                                                     *
*  TAPEMAP - PROGRAM TO LIST A SUMMARY OF THE CONTENTS OF A TAPE.     *
*                                                                     *
*  DISASSEMBLED CODE --- THIS IS NOT THE ORIGINAL SOURCE CODE.        *
*                                                                     *
*  THIS SOURCE CODE CAME FROM A DISASSEMBLY OF THE TAPEMAP LOAD       *
*  MODULE FROM THE UCLA COMPUTER CLUB.  ONLY THE LOAD MODULE WAS      *
*  PROVIDED ON THE MVS MODS TAPES FROM SHARE AND CBT.  THE LOAD       *
*  MODULE WAS PROCESSED BY A DISASSEMBLER PROGRAM, AND THE            *
*  THE SOURCE CODE GENERATED BY THE DISASSEMBLER HAS BEEN             *
*  PARTIALLY CLEANED UP, GIVEN COMMENTS AND NEW LABELS, BY            *
*  BILL GODFREY, OF PLANNING RESEARCH CORPORATION.                    *
*                                                                     *
*  THE CLEANUP IS NOT COMPLETE - THERE ARE STILL SECTIONS OF          *
*  CODE WITH NO COMMENTS AND MEANINGLESS NAMES - BUT THE OBJECT       *
*  CODE GENERATED BY ASSEMBLING THIS SOURCE HAS BEEN COMPARED         *
*  TO THE DISTRIBUTED LOAD MODULE AND FOUND TO MATCH EXACTLY          *
*  (WHEN STATEMENTS CONTAINING STRING '.FIX.' ARE REMOVED).           *
*                                                                     *
*  THIS CODE DOES SHOW A LOT OF THE LOGIC OF THE PROGRAM, SO          *
*  THAT SIMPLE CHANGES LIKE LINES PER PAGE (FOR 8 LINES PER INCH)     *
*  COULD BE MADE.                                                     *
*                                                                     *
*  KNOWN BUGS (OR UNDESIRED FEATURES) IN THE ORIGINAL.                *
*  .  THE LINE OF DASHES HAS AN INVALID CARRIAGE CONTROL BYTE.        *
*     SHOULD BE BLANK INSTEAD OF HEX 00.                              *
*  .  FOR NL TAPES, THE VOLUME SERIAL IN THE TOP LINE IS              *
*     OVERPRINTED WITH GARBAGE.                                       *
*  .  THE DSNAME IN THE JFCB IS ALTERED, WHICH IS A PROBLEM ONLY      *
*     WHEN THE INSTALLATION RUNS CERTAIN TAPE MGMT SYSTEMS.           *
*  .  THE AUTHORS NAMES ARE PRINTED IN THE FIRST HEADING.             *
*  THESE PROBLEMS ARE FIXED IN STATEMENTS CONTAINING STRING '.FIX.'   *
*                                                                     *
*  LOG OF CHANGES.                                                    *
*     19NOV81 - ABOVE FIXES INSERTED.                                 *
*     30NOV81 - SYSDATE AND SYSTIME IN PROLOG.                        *
*     21JAN82 - FIX S0C1 IN FMTUPDTE (CHANGED H,F,H TO 4H)            *
*                                                                     *
**$DOC$****************************************************************
         SPACE
TAPEMAP  CSECT
         USING *,R12,R11
         B     @PROLOG-*(,R15)
         DC    AL1(25)
         DC    C'TAPEMAP '
         DC    CL14' /7/0709 15.44',X'00'
         ORG   *-15                                               .FIX.
         DC    CL15'&SYSDATE &SYSTIME '                           .FIX.
@BASE2   DC    A(TAPEMAP+4096)
@SIZE    DC    AL1(1)
         DC    AL3(X'008800')
         SPACE
@EXIT    XR    R15,R15             RETURN CODE ZERO
         LR    R1,R13              R1 FOR FREEMAIN
         L     R13,4(,R13)         OLD SAVEAREA
         ST    R15,16(,R13)        STORE RETURN CODE
         L     R0,@SIZE            R0 FOR FREEMAIN
         LA    R1,0(,R1)           FREEMAIN
         SVC   10                  FREEMAIN
         LM    R14,12,12(R13)      RESTORE REGS
         MVI   12(R13),X'FF'       STANDARD FOOTPRINT
         BR    R14                 EXIT
         SPACE
@PROLOG  STM   R14,12,12(R13)      SAVE REGS
         LR    R12,R15             BASE REGISTER
         L     R11,@BASE2          BASE REGISTER
         L     R2,0(,R1)           SAVE PARM ADDRESS
         L     R0,@SIZE            R0 FOR GETMAIN
         BAL   R1,*+4              GETMAIN
         SVC   10                  GETMAIN
         ST    R1,8(,R13)          PUT NEW ADDRESS IN OLD SAVEAREA
         ST    R13,4(,R1)          PUT OLD ADDRESS IN NEW SAVEAREA
         LR    R13,R1              SWITCH TO NEW SAVEAREA
         USING @DATA,R13
         B     INIT                GO TO INITIALIZATION
NEXTRUN  L     R1,SINDCBA          GET DCB
         LA    R0,CARD             GET AREA
         L     R15,48(,R1)         GET
         BALR  R14,R15             GET
         OI    FLAG1,X'01'
         CLC   PSDDNAME,CARD       ./DDNAME
         BE    SPECDD
         CLC   PSVOLUME,CARD       ./VOLUME
         BNE   *+10                NO, ASSUME VOL IN COL 1-6
         MVC   CARD(6),CARD+9      YES, MOVE VOL TO COL 1-6
         MVI   JFCBVOLS-1,1        JFCBNVOL
         MVC   JFCBVOLS,CARD
         MVI   JFCB+52,X'40' JFCBTSDM      INDICATE VOL SER CHANGED
         B     A0000E6
SPECDD   L     R1,UT1DCBA
         MVC   40(8,R1),CARD       CHANGE SYSUT1 DDNAME
A0000B2  LA    R1,UT1DCBA
         SVC   64                  RDJFCB
         B     A0000E6
STOP     LA    R1,PRTDCBA
         SVC   20                  CLOSE
         TM    FLAG2,USEPRNT2
         BNO   @EXIT
         LA    R1,PR2DCBA
         SVC   20                  CLOSE
         B     @EXIT
EODSIN   TM    FLAG1,X'01'
         BO    STOP
         MVC   PSTOP,ASTOP
         B     A0000B2
A0000E6  LA    R7,1
         SR    R9,R9
         STH   R9,EOVCOUNT
         OI    FLAG1,FIRST+X'04'
         MVC   JFCB(40),NEWDSN
         MVC   JFCB+40(4),AUTH
         ORG   *-12                BACK UP 2 MVC'S                .FIX.
         DC    3X'0700'            NULLIFY MVC                    .FIX.
         DC    3X'0700'            NULLIFY MVC                    .FIX.
         MVC   JFCB+44(8),BLANKS
         STH   R7,JFCB+70          JFCBVLSQ
         MVI   JFCB+98,X'40'       JFCDSORG PS
         MVI   JFCB+100,X'90'      RECFM FB
         MVC   LINEH1+5(6),JFCBVOLS
         XC    COUNT,COUNT
         LA    R1,UT1DCBA
         SVC   22                  OPEN TYPE J
         L     R1,UT1DCBA
         TM    48(R1),X'10'        WAS OPEN SUCCESSFUL
         BO    OKUT1
         BAL   R10,PRTPAGE
         MVC   LINEWK(40),OPERRUT1 TAPE VOLUME COULD NOT BE OPENED
         BAL   R14,PRTLINE
         B     A0008C4
OKUT1    NI    42(R1),X'F7'
         XC    WORDX(8),WORDY-4    CLEAR WORDX WORDY
         NI    FLAG1,255-X'18' E7
         MVI   FLAG5,X'00'
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008EE
         MVC   LABEL(80),BUFFER
A000166  LH    R2,HWB
         LA    R0,CCWSENS
         BAL   R10,EXCP
         B     A0008E0
         LA    R1,C'3'
         TM    SENSE+3,X'04'
         BO    A000192
         LA    R1,C'4'
         TM    SENSE+9,X'08'
         BO    A000192
         LA    R1,C'2'
A000192  LR    R0,R1                       SAVE CHAR DEN
         N     R1,F15                      CONVERT DEN TO BINARY
         SLL   R1,2                        MULTIPLY BY 4
         LA    R1,BPIV(R1)                 POINT TO 4 CHAR BPI
         ST    R1,BPIA                     STORE ADDRESS OF 4 CHARS
         STC   R0,BPIA                     STORE DENSITY CHAR
         CLI   EOVCOUNT+1,0
         BNE   A0001CE
         CLC   LABEL(4),VOL1
         BE    A000418
         MVC   LABEL+4(6),JFCBVOLS         FIX NL BUG             .FIX.
         BAL   R10,PRTPAGE                 PERFORM
         MVC   LINEWK(52),A001610          NO VOL1, NL ANALYSIS
         BAL   R14,PRTLINE                 PERFORM
         BCTR  R8,R0
         BAL   R14,PRTLINE                 PERFORM
A0001CE  MVC   LABBUF1+4(17),BLANKS
         MVC   LABEL+4(6),JFCBVOLS
A0001DA  STH   R2,HWB
         STH   R2,FWB+2
         XC    FWB(2),FWB
         STH   R2,HWA
         MVC   FWA,F1
         MVI   FLAG3,X'40'
         CH    R2,BUFFER
         BNE   *+8
         OI    FLAG3,X'80'
         MVI   FLAG5,X'03'
         MVC   UTILITY(9),UTILITY-1
         LH    R1,COUNT
         LA    R1,1(,R1)
         STH   R1,COUNT
         CVD   R1,DOUBLE
         UNPK  DOUBLE(5),DOUBLE+5(3)
         OI    DOUBLE+4,X'F0'
         MVC   LABBUF1+31(4),DOUBLE+1
CHKPGM1  BAL   R10,CHKMOVE
         B     CHKPGM2
         B     FMTMOVE
         B     ITSMOVE
CHKPGM2  CLC   BUFFER(8),COPYRDW
         BNE   CHKPGM3
         BAL   R10,CHKCOPY
         B     CHKPGM3
         B     FMTCOPY
         B     ITSCOPY
CHKPGM3  BAL   R10,CHKDASDR
         B     CHKPGM4
         B     ITSDASDR
CHKPGM4  BAL   R10,CHKUPDTE
         B     CHKPGM5
         B     FMTUPDTE
         MVC   LINEW2+8(27),UPDTEMSG
         B     CHKPGMX
CHKPGM5  BAL   R10,CHKFDR
         B     CHKPGM6
         B     CHKPGMX
CHKPGM6  BAL   R10,CHKISAM
         B     CHKPGMX
         B     FMTISAM
         B     ITSISAM
CHKPGMX  LA    R0,CCWREAD
         BAL   R10,EXCP
         B     *+8
         B     CHKPGMX
A0002A4  CLI   UTILITY,C' '
         BE    A0002B4
         LA    R0,2
         BAL   R10,PRTPAGEQ                PERFORM
A0002B4  MVC   LINEWK+1(9),UTILITY
         LH    R1,COUNT
         CVD   R1,DOUBLE
         MVC   LINEWK+10(5),PATT5
         ED    LINEWK+9(6),DOUBLE+5
A0002CE  CLC   PNULLP,UTILITY+3
         BE    A0003C6
         MVI   LINEWK+59,C'V'
         TM    FLAG3,X'80'
         BO    A0002F4
         MVI   LINEWK+59,C'F'
         TM    FLAG3,X'40'
         BO    A0002F4
         MVI   LINEWK+59,C'U'
A0002F4  LH    R0,HWA
         CVD   R0,DOUBLE
         MVC   LINEWK+72(5),PATT5
         ED    LINEWK+71(6),DOUBLE+5
         L     R0,FWA
         CVD   R0,DOUBLE
         MVC   LINEWK+78(7),PATT7
         ED    LINEWK+77(8),DOUBLE+4
         MVC   LINEWK+88(1),BPIA
         L     R14,BPIA
         TM    FLAGP,X'10'                 PARM = DEN1
         BO    *+10
         MVC   LINEWK+87(4),20(R14)
         L     R15,FWA
         L     R1,FWB
         M     R0,F100
         D     R0,0(,R14)
         AH    R1,H375
         TM    FLAG1,X'08'
         BNO   A000358
         AH    R1,H750
         LA    R15,4(,R15)
A000358  M     R14,F60
         CLI   BPIA,C'4'
         BNE   *+8
         SRL   R15,1
         AR    R1,R15
         LR    R2,R1
         LA    R15,LINEWK+97
         BAL   R14,DIV1200                 PERFORM
         A     R2,WORDY
         ST    R2,WORDY
         LR    R1,R2
         LA    R15,LINEWK+105
         BAL   R14,DIV1200                 PERFORM
         BAL   R14,PRTLINE                 PERFORM
         CLI   UTILITY,C' '
         BE    A0003AA
         TM    FLAGP,X'40'                 PARM = INLINE
         BNO   A0003AA
         MVC   LINEWK(133),LINEW2
         BAL   R14,PRTLINE                 PERFORM
         MVC   LINEW2,LINEW2-1
A0003AA  TM    FLAG1,X'08'
         BO    A0003C6
A0003B2  LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0003CE
         LH    R2,HWB
         B     A0001DA )
A0003C6  BAL   R14,PRTLINE                 PERFORM
         B     A00048E
A0003CE  LH    R1,EOVCOUNT
         LA    R1,1(,R1)
         STH   R1,EOVCOUNT
         CH    R1,EOVBYPAS                 BYPASS THIS EOV
         BH    EOV                         NO, IT'S THE REAL EOV
         LH    R1,COUNT
         LA    R1,1(,R1)
         STH   R1,COUNT
         MVC   LINEWK+10(5),PATT5
         CVD   R1,DOUBLE
         ED    LINEWK+9(6),DOUBLE+5
         MVC   LINEWK+4(6),PNULLP
         BAL   R14,PRTLINE                 PERFORM
         L     R0,WORDY
         AH    R0,H375
         ST    R0,WORDY
         B     A0003B2
A000418  OI    FLAG1,X'08'
         MVC   LINEH1+5(6),LABEL+4         VOLSER
         MVC   LINEH1+19(10),LABEL+41      OWNER ID
         MVC   LINEH1+13(6),LINEH1+12
         CLC   LABEL+41(10),BLANKS
         BE    *+10
         MVC   LINEH1+13(6),OWNERE         OWNER=
         NI    FLAG2,255-X'80'
         CLC   LABEL+4(6),JFCBVOLS         DOES VOLSER MATCH
         BE    VOLSAME                     YES
         OI    FLAG2,VOLDIF                NO, INDICATE MISMATCH
         MVC   REQVOL+19(6),JFCBVOLS       AND PUT REQ VOL IN MSG
VOLSAME  BAL   R10,PRTPAGE         PRINT
         NI    FLAG1,255-X'04' FB
         TM    FLAGP,X'03'         PARM = CHECK, SCAN, NL
         BZ    *+8                 BRANCH IF NONE
         OI    FLAG1,X'04'
         TM    FLAGP,X'01'         PARM = NL
         BNO   A00047A
         XI    FLAG1,X'08'
         B     A0001DA
A00047A  MVI   FLAG5,X'01'
         LA    R0,CCWLBL
         BAL   R10,EXCP
         B     A000940             INITT
         B     A0004AA
A00048E  LA    R0,CCWFSF
         BAL   R10,EXCP            FORWARD SPACE FILE
         B     A0008E0
         MVI   FLAG5,X'01'
         LA    R0,CCWLBL
         BAL   R10,EXCP
         B     EOV
A0004AA  MVC   UTILITY,UTILITY-1
         LA    R0,CCWFSF
         BAL   R10,EXCP
         B     A0008E0             UNEXPECTED TM
         MVI   FLAG3,X'C0'
         MVI   FLAG5,X'03'
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008CA
         LH    R1,HWB
         STH   R1,HWA
         AH    R1,H320
         ST    R1,FWB
         MVC   FWA,F1
         NI    FLAG3,255-X'20'
         OI    FLAG3,X'40'
         CLI   LABBUF2+4,C'F'      LABBUF2+4
         BNE   A000518
         CLC   LABBUF2+10(5),C00080
         BNE   A0005B2
         CLI   LABBUF2+38,C'B'     LABBUF+38
         BNE   A000558
         BAL   R10,CHKMOVE         CHKMOVE
         B     A000558
         B     FMTMOVE
         B     CHKOK
A000518  CLI   LABBUF2+4,C'V'      LABBUF2+4
         BNE   A000538
         CLI   LABBUF2+38,C'S'     LABBUF2+38
         BNE   A0005B2
         BAL   R10,CHKCOPY         CHKCOPY
         B     A0005B2
         B     FMTCOPY
         B     CHKOK
A000538  CLI   LABBUF2+4,C'U'
         BNE   A0005B2
         BAL   R10,CHKDASDR        CHKDASDR
         B     *+8
         B     CHKOK
         BAL   R10,CHKFDR          CHKFDR
         B     A0005B2
         B     CHKOK
A000558  BAL   R10,CHKUPDTE        CHKUPDTE
         B     A00056E
         B     FMTUPDTE
         MVC   LINEW2+8(27),UPDTEMSG
         B     CHKOK
A00056E  BAL   R10,CHKISAM         CHKISAM
         B     A0005B2
         B     FMTISAM
CHKOK    TM    FLAGP,X'40'         PARM = INLINE
         BNO   A0005B2
         LA    R0,2
         BAL   R10,PRTPAGEQ
         CLC   IEBCOPY,UTILITY
         BE    ITSCOPY
         CLC   IEHMOVE,UTILITY
         BE    ITSMOVE
         CLC   IEBISAM,UTILITY
         BE    ITSISAM
         CLC   IEHDASDR,UTILITY
         BE    ITSDASDR
A0005B2  TM    FLAGP,X'02'         PARM = CHECK, SCAN
         BO    A0005F8
         LA    R0,CCWFSF
         BAL   R10,EXCP            FORWARD SPACE FILE
         B     A0008E0             UNEXPECTED TM
A0005C6  MVI   FLAG5,X'02'
         LA    R0,CCWLBL
         BAL   R10,EXCP            READ EOF LABELS
         B     A0005EA             NOT FOUND
A0005D6  CLC   EOF1,LABBUF1        EOF
         BE    GOTEOFV
         CLC   EOV1,LABBUF1        EOV
         BE    GOTEOFV
A0005EA  MVC   LINEWK(42),EONF     EOF/EOV LABEL EXPECTED, NOT FOUND
         BAL   R14,PRTLINE         PRINT
         B     UT1CLOSE
A0005F8  LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A000608
         B     A0005F8
A000608  MVC   HWSV(12),HWA        6 HALFWORDS
         MVC   F3SV,FLAG3
         B     A0005C6
GOTEOFV  LA    R1,1
         TM    FLAGP,X'02'         PARM = CHECK, SCAN
         BNO   *+8
         LA    R1,2(,R1)
         CLI   UTILITY,C' '
         BE    *+8
         LA    R1,1(,R1)
         LR    R0,R1
         BAL   R10,PRTPAGEQ                PERFORM
         MVC   LINEWK+1(9),UTILITY
         MVC   LINEWK+11(4),LABBUF1+31
         LA    R1,LINEWK+11
         BAL   R14,ZSUPR                   PERFORM
         MVC   LINEWK+18(17),LABBUF1+4     DSNAME
         CLI   LABBUF1+53,C'0'
         BE    A000686
         CLI   LABBUF1+53,C'1'
         BE    A000680
         CLI   LABBUF1+53,C'3'
         BNE   A000676
         MVC   LINEWK+37(3),WRT
         B     A000686
A000676  MVC   LINEWK+37(3),QQQ
         B     A000686
A000680  MVC   LINEWK+37(3),YES
A000686  MVC   LINEWK+42(2),LABBUF1+42
         MVI   LINEWK+44,X'4B'
         MVC   LINEWK+45(3),LABBUF1+44
         MVC   LINEWK+50(2),LABBUF1+48
         MVI   LINEWK+52,X'4B'
         MVC   LINEWK+53(3),LABBUF1+50
         MVC   LINEWK+79(6),LABBUF1+54
         LA    R1,LINEWK+79
         BAL   R14,ZSUPR                   PERFORM
         MVC   LINEWK+59(1),LABBUF2+4
         MVC   LINEWK+60(1),LABBUF2+38
         MVC   LINEWK+61(1),LABBUF2+36
         CLI   LINEWK+60,C'R'
         BNE   A0006DA
         MVC   LINEWK+62(1),LINEWK+61
         MVC   LINEWK+60(2),BS
A0006DA  MVC   LINEWK+72(5),LABBUF2+5
         LA    R1,LINEWK+72
         BAL   R14,ZSUPR                   PERFORM
         MVC   LINEWK+65(5),LABBUF2+10
         LA    R1,LINEWK+65
         BAL   R14,ZSUPR                   PERFORM
         IC    R15,LABBUF2+15
         STC   R15,LINEWK+88
         CLC   BPIA(1),LABBUF2+15
         BE    *+8
         OI    FLAG1,X'10'
         N     R15,F15
         SLL   R15,2
         LA    R3,BPIV(R15)
         TM    FLAGP,X'10'                 PARM = DEN1
         BO    A000736
         CLI   LABBUF2+15,C'4'
         BH    A000736
         CLI   LABBUF2+15,C'0'
         BL    A000736
         MVC   LINEWK+87(4),20(R3)
A000736  MVC   LINEWK+94(2),LABBUF2+34
         MVC   LINEWK+114(17),LABBUF2+17
         PACK  DOUBLE,LABBUF1+54(6)
         CVB   R15,DOUBLE
         LA    R1,4(,R15)
         M     R0,F60
         L     R3,BPIA
         CLI   BPIA,C'4'
         BNE   *+8
         SRL   R0,1
         LR    R2,R1
         PACK  DOUBLE,LABBUF2+5(5)
         CVB   R1,DOUBLE
         MR    R0,R15
         AH    R1,H320
         M     R0,F100
         D     R0,0(,R3)
         AH    R1,H1125
         AR    R2,R1
         LR    R1,R2
         LA    R15,LINEWK+97
         BAL   R14,DIV1200         DIVIDE BY 1200?
         A     R2,WORDX
         ST    R2,WORDX
         LR    R1,R2
         LA    R15,LINEWK+105
         BAL   R14,DIV1200         DIVIDE BY 1200?
         BAL   R14,PRTLINE
         CLC   ZZZ1,LABBUF1+27     VOL SEQUENCE NUMBER = 0001
         BE    A0007C4             YES, BRANCH
         MVC   MULTMSG+22(4),LABBUF1+27
         MVC   MULTMSG+80(6),LABBUF1+21
         MVC   LINEWK(87),MULTMSG  THIS IS VOLUME XXXX OF MULTIVOLUME
         BAL   R14,PRTLINE         PRINT
A0007C4  CLC   EOV2,LABBUF2        EOV2
         BNE   A0007DC
         MVC   LINEWK(50),CONTIN   CONTINUED ON ANOTHER VOLUME
         BAL   R14,PRTLINE                 PERFORM
         B     EOV
A0007DC  TM    FLAGP,X'02'                 PARM = CHECK, SCAN
         BZ    A0007F4
         MVC   HWA(12),HWSV
         MVC   FLAG3,F3SV
         B     A0002CE
A0007F4  TM    FLAGP,X'40'                 PARM = INLINE
         BNO   A00048E
         CLI   UTILITY,C' '
         BE    A00048E
         MVC   LINEWK(133),LINEW2
         BAL   R14,PRTLINE
         MVC   LINEW2(133),LINEW2-1
         B     A00048E
EOV      MVC   LINEWK(17),EOVMSG
         BAL   R14,PRTLINE         PRINT EOV MSG
         LTR   R9,R9               IS THERE A PRT2
         BZ    A000832             NO, BRANCH
         MVC   LINEW2(17),EOVMSG
         BAL   R14,PR2LINE         PRINT2
A000832  TM    FLAG1,X'10'
         BNO   A000886
         LA    R0,9
         TM    FLAGP,X'04'         PARM = NONOTE
         BNO   *+8
         LA    R0,6
         BAL   R10,PRTPAGEQ
         LA    R8,1(,R8)
         MVC   LINEWK(113),DENMSG  DENSITY INCORRECT IN LABEL
         L     R2,BPIA             POINT TO DENSITY CHARS
         CLI   BPIA,C'2'           IS IT 2
         BNE   *+6                 NO
         BCTR  R2,R0               YES, BACK UP 1
         MVC   LINEWK+98(4),20(R2)
         BAL   R14,PRTLINE         PRINT
         MVI   LINEWK,C'+'         CC OVERPRINT
         MVC   LINEWK+98(4),20(R2)
         LA    R0,LINEWK
         BAL   R14,PRTPUT
         BAL   R14,PRTLINE
A000886  TM    FLAGP,X'04'         PARM = NONOTE
         BO    UT1CLOSE
         LA    R0,4
         BAL   R10,PRTPAGEQ
         MVC   LINEWK(110),NOTELINE
         BAL   R14,PRTLINE
         TM    FLAG1,X'04'
         BO    UT1CLOSE
         MVC   LINEWK(88),LENGTHS
         BAL   R14,PRTLINE
UT1CLOSE LA    R0,CCWREW
         BAL   R10,EXCP            REWIND
         B     A0008E0
A0008BE  LA    R1,UT1DCBA
         SVC   20                  CLOSE TAPE FILE
A0008C4  L     R14,PSTOP
         BR    R14                 EXIT
         SPACE
A0008CA  MVC   UTILITY+3(6),PNULLP (NULL)
         LA    R0,CCWLBL
         BAL   R10,EXCP
         B     A0008E0
         B     A0005D6
         SPACE
A0008E0  MVC   LINEWK(29),A00191A  UNEXPECTED TAPEMARK
         BAL   R14,PRTLINE
         B     UT1CLOSE
         SPACE
A0008EE  BAL   R10,PRTPAGE
         MVC   LINEWK(37),A001937  LTM
         BAL   R14,PRTLINE
         BCTR  R8,R0
         BAL   R14,PRTLINE
         MVI   LABEL,C'X'
         MVI   COUNT+1,1
         MVI   EOVCOUNT+1,1
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     *+8
         B     A000166
         MVI   EOVCOUNT+1,2
         CLI   EOVBYPAS+1,2
         BL    EOV
         MVC   LINEWK+4(6),PNULLP
         MVI   LINEWK+14,C'1'
         MVI   COUNT+1,2
         BAL   R14,PRTLINE
         B     A000166
A000940  MVC   LINEWK(50),HINITT    IEHINITT
         BAL   R14,PRTLINE
         B     UT1CLOSE
         SPACE
CHKMOVE  CLC   MOVEID,BUFFER+16
         BCR   7,R10
         MVC   UTILITY(7),IEHMOVE
CHKOUT   TM    FLAG2,USEPRNT2
         BO    4(,R10)
         B     8(,R10)
         SPACE
CHKCOPY  CLC   COPYID(4),BUFFER+8
         BCR   7,R10
         MVC   UTILITY(7),IEBCOPY
         B     CHKOUT
         SPACE
CHKUPDTE ST    R10,DOUBLE
         LA    R2,80
         LA    R15,BUFFER
         LR    R3,R15
         AH    R3,HWB
         SR    R3,R2
BXLOOP   LR    R1,R15
         BAL   R10,UPDMEM          GET MEMBER NAME
         B     UPDREC              NOT FOUND
         MVC   UTILITY(8),IEBUPDTE
         L     R10,DOUBLE
         B     CHKOUT
UPDREC   BXLE  R15,R2,BXLOOP       ADD 80 TO R15 AND LOOP
         L     R10,DOUBLE          END OF BLOCK
         BR    R10
         SPACE
UPDMEM   CLC   DOTSLASH,0(R1)              ./
         BCR   7,R10
         LA    R1,2(,R1)
         LA    R0,69
         BAL   R14,FINDEND                 PERFORM
         BAL   R14,FINDNXT                 PERFORM
         CLC   ADDB,0(R1)                  ./ ADD
         BE    A0009E8
         CLC   REPLB,0(R1)                 ./ REPL
         BE    A0009E8
         CLC   CHANGEB,0(R1)               ./ CHANGE
         BE    A0009E8
         BR    R10
A0009E8  MVC   ARC,0(R1)                   SAVE A, R, OR C
A0009EE  LA    R1,1(,R1)
         CLC   MEMBERE,0(R1)               MEMBER=
         BE    A000A0C
         CLC   NAMEE,0(R1)                 NAME=
         BE    A000A14
         BCT   R0,A0009EE
         BR    R10
A000A0C  LA    R1,7(,R1)
         B     *+8
A000A14  LA    R1,5(,R1)
         MVI   8(R1),X'6B'
         B     4(,R10)
         SPACE
FINDEND  BCTR  R0,R0
FINDELP  CLI   0(R1),C' '
         BCR   8,R14
         LA    R1,1(,R1)
         BCT   R0,FINDELP
         BR    R10
         SPACE
FINDNXT  BCTR  R0,R0
FINDNLP  CLI   0(R1),C' '
         BCR   7,R14
         LA    R1,1(,R1)
         BCT   R0,FINDNLP
         BR    R10
         SPACE
CHKDASDR CLC   DASDRID,BUFFER+12
         BCR   7,R10
         MVC   UTILITY(8),IEHDASDR
         MVC   HOLD24,BUFFER
         LR    R2,R10
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008E0
A000A66  LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008E0
         B     4(,R2)
         SPACE
CHKFDR   CLC   FDRID,BUFFER+4
         BCR   7,R10
         MVC   UTILITY(3),FDR
         LR    R2,R10
         B     A000A66
         SPACE
CHKISAM  CLC   BUFFER(4),F154
         BCR   7,R10
         CLC   BUFFER+80(2),F1+2
         BCR   7,R10
         TM    BUFFER+52,X'10'
         BCR   14,R10
         CLI   BUFFER+30,X'80'
         BE    A000AAE
         CLI   BUFFER+30,X'81'
         BCR   7,R10
A000AAE  MVC   UTILITY(7),IEBISAM
         B     CHKOUT
ITSMOVE  MVC   LINEW2+79(4),DSNE           DSN=
         MVC   LINEW2+83(44),BUFFER+85
         BAL   R10,SHOWATTR
         DC    X'00A900AB'
         DC    X'00AD00AF'
ITSCOPY  BAL   R10,SHOWATTR
         DC    X'000C0012'
         DC    X'000E0010'
ITSISAM  BAL   R10,SHOWATTR
         DC    X'001E0028'
         DC    X'00420058'
SHOWATTR MVC   LINEW2+8(24),ATTRMSG        ATTRIBUTES: DSORG=
         LA    R15,LINEW2+32
         BAL   R14,SHOWDSOR
         LA    R15,LINEW2+59
         BAL   R14,SHOWRECF
         LA    R1,BUFFER
         AH    R1,4(,R10)                  BLKSI
         LA    R15,LINEW2+71
         BAL   R14,EDITHALF
         LA    R1,BUFFER
         AH    R1,6(,R10)                  LRECL
         LA    R15,LINEW2+64
         BAL   R14,EDITHALF
A000B1E  TM    FLAG1,X'04'
         BNO   A0005B2
         B     CHKPGMX
ITSDASDR MVC   LINEW2+8(15),DUMPFROM
         UNPK  LINEW2+23(9),HOLD24(5)
         TR    LINEW2+23(8),HEXTR-240
         MVC   LINEW2+31(5),OFA           =C' OF A'
         IC    R1,HOLD24+21
         N     R1,F255
         MH    R1,H6
         LA    R14,DEVTAB1
         LA    R14,0(R14,R1)
         MVC   LINEW2+37(6),0(R14)
         CLC   F0,HOLD24+8                IS IT ZERO
         BNE   A000B1E
         CLC   VOL1(8),BUFFER+216     VOL1VOL1
         BNE   A000B1E
         MVC   LINEW2+46(7),VOLUMEE       VOLUME=
         MVC   LINEW2+53(6),BUFFER+224
         MVC   LINEW2+61(6),OWNERE
         MVC   LINEW2+67(10),BUFFER+261
         B     A000B1E
FMTMOVE  LA    R0,7
         TM    FLAGP,X'20'                 PARM = NOMEM
         BO    *+8
         LA    R0,9
         TM    BUFFER+169,X'02'
         BO    *+8
         LA    R0,7
         BAL   R10,PR2PAGEQ
         BAL   R10,SHOWDCB
         DC    X'00A900AB'                 OFFSETS TO DSORG RECFM
         DC    X'00AD00AF'                 OFFSETS TO BLKSI LRECL
         MVC   LINEW2+47(7),IEHMOVE
         LA    R1,BUFFER+282
         BAL   R10,A00101C
         BAL   R14,PR2LINE
         MVI   LINEW2,C'0'
         MVC   LINEW2+25(7),CDATE          C-DATE=
         LA    R1,BUFFER+138
         LA    R15,LINEW2+32
         BAL   R10,UNPKDATE
         MVC   LINEW2+42(7),EDATE          E-DATE=
         LA    R1,BUFFER+141
         LA    R15,LINEW2+49
         BAL   R10,UNPKDATE
         MVC   LINEW2+59(4),DSNE           DSN=
         MVC   LINEW2+63(44),BUFFER+85
         TM    BUFFER+132,X'0F'
         BO    A000C1A
         CLI   BUFFER+135,X'00'
         BE    A000C1A
         MVC   LINEW2+120(4),VOLE          VOL=
         MVC   LINEW2+124(6),BUFFER+130
A000C1A  BAL   R14,PR2LINE
         TM    BUFFER+169,X'02'
         BNO   A000EF6
         BAL   R10,A000F2E
         LH    R2,HWB
         SH    R2,H80
         LA    R3,BUFFER+80
         BAL   R10,A000CE4
         BAL   R10,A000CE4
         BAL   R10,A000CE4
         BAL   R10,A000CE4
         LA    R5,HOLD78+46
         CLI   0(R5),C'H'
         BE    A000C62
         LA    R5,3(,R5)
         CLI   0(R5),C'H'
         BE    A000C62
         BAL   R14,A000FBE
A000C62  LA    R5,4(,R5)
A000C66  BAL   R10,A000E04
         BAL   R10,A000CDE
A000C6E  CLI   2(R5),X'E0'
         BE    A000CB4
         CLI   2(R5),X'D0'
         BE    A000CB4
         CLI   2(R5),C'H'
         BE    A000CD2
         CLI   2(R5),C'D'
         BE    A000C9E
         CLI   2(R5),X'0A'
         BNH   A000DF2
         BAL   R14,PR2LINE
         BAL   R14,A000FBE
A000C9E  MVC   DOUBLE(2),0(R5)
         LH    R4,DOUBLE
         LA    R5,12(R5,R4)
         BAL   R10,A000CDE
         B     A000C66
A000CB4  MVC   DOUBLE(2),0(R5)
         LH    R4,DOUBLE
         LA    R5,6(R5,R4)
A000CC2  CL    R5,ADDR78
         BL    A000C6E
         BAL   R10,A000CE4
         B     A000CC2
A000CD2  LA    R5,6(,R5)
         BAL   R10,A000CDE
         B     A000C66
A000CDE  CL    R5,ADDR78
         BCR   4,R10
A000CE4  MVC   HOLD78,KEEP78
         LTR   R2,R2
         BP    A000D14
         BZ    *+8
         B     A000DF2
         ST    R10,PRTSAVE2
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A000D28
         L     R10,PRTSAVE2
         LA    R3,BUFFER
         LH    R2,HWB
A000D14  SH    R2,H80
         MVC   KEEP78,2(R3)
         LA    R3,80(,R3)
         SH    R5,H78
         BR    R10
A000D28  BCTR  R2,R0
         L     R10,PRTSAVE2
         OI    FLAG1,X'02'
         BR    R10
         SPACE
UNPKDATE SR    R0,R0
         IC    R0,0(,R1)                   GET YY
         CVD   R0,DOUBLE
         UNPK  0(3,R15),DOUBLE+6(2)
         OI    2(R15),X'F0'
         MVC   0(2,R15),1(R15)
         MVI   2(R15),C'.'
         MVC   DOUBLE(2),1(R1)             GET DDD
         LH    R0,DOUBLE
         CVD   R0,DOUBLE
         UNPK  3(3,R15),DOUBLE+6(2)
         OI    5(R15),X'F0'
         BR    R10
         SPACE
FMTCOPY  LA    R0,7
         TM    FLAGP,X'20'                 PARM = NOMEM
         BNO   *+8
         LA    R0,5
         BAL   R10,PR2PAGEQ
         BAL   R10,SHOWDCB
         DC    X'000C0012'                 OFFSETS TO DSORG RECFM
         DC    X'000E0010'                 OFFSETS TO BLKSI LRECL
         MVC   LINEW2+47(7),IEBCOPY
         LA    R1,BUFFER+24
         BAL   R10,A00101C
         BAL   R10,A000F2A
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008E0
A000DAA  LA    R0,CCWREAD
         BAL   R10,EXCP
         B     A0008E0
         LH    R2,BUFFER+4
         SH    R2,H8
         LA    R3,BUFFER+8
A000DC2  LA    R5,22(,R3)
         LH    R4,20(,R3)
         SH    R4,H2
A000DCE  CLC   0(8,R5),ALLFF
         BE    A000DF2
         BAL   R10,A000E04                 PERFORM
         LTR   R4,R4
         BP    A000DCE
         LA    R3,276(,R3)
         SH    R2,H276
         BP    A000DC2
         B     A000DAA
A000DF2  LA    R0,LINEW2+20
         CR    R0,R6
         BE    A000EF6
         BAL   R14,PR2LINE                 PERFORM
         B     A000EF6
A000E04  MVC   0(8,R6),0(R5)
         IC    R1,11(,R5)
         N     R1,F31
         LA    R1,12(R1,R1)
         AR    R5,R1
         SR    R4,R1
         LA    R6,10(,R6)
         CL    R6,EDGE1
         BCR   13,R10
         LR    R6,R10
         BAL   R14,PR2LINE                 PERFORM
         LR    R10,R6
         LA    R6,LINEW2+20
         BR    R10
         SPACE
FMTUPDTE LA    R0,7
         TM    FLAGP,X'20'                 PARM = NOMEM
         BNO   *+8
         LA    R0,5
         BAL   R10,PR2PAGEQ                PERFORM
         BAL   R10,A000F9E                 PERFORM
         DC    4H'0'                       WAS H'0',F'0',H'0'
         MVC   LINEW2+31(27),UPDTEMSG
         BAL   R10,A000F2A                 PERFORM
A000E5C  LA    R2,80                       LENGTH FOR BXLE
         LA    R5,BUFFER
         LR    R3,R5
         AH    R3,HWB
         SR    R3,R2
BXLOOP2  LR    R1,R5
         BAL   R10,UPDMEM                  PERFORM
         B     A000EBC
         MVC   0(1,R6),ARC
         MVI   1(R6),X'60'
         MVC   2(8,R6),0(R1)
         LA    R1,1(,R6)
A000E8A  CLI   0(R1),X'6B'
         BE    A000EA2
         CLI   0(R1),C' '
         BE    A000EA2
         LA    R1,1(,R1)
         B     A000E8A
A000EA2  MVC   0(7,R1),LINEWK+1
         LA    R6,11(,R6)
         CL    R6,EDGE2
         BNH   A000EBC
         BAL   R14,PR2LINE                 PERFORM
         LA    R6,LINEW2+20
A000EBC  BXLE  R5,R2,BXLOOP2
         LA    R0,CCWREAD
         BAL   R10,EXCP
         B     *+8
         B     A000E5C
         OI    FLAG1,X'02'
         B     A000DF2
         SPACE
FMTISAM  BAL   R10,SHOWDCB                 PERFORM
         DC    X'001E0028'                 OFFSETS TO DSORG RECFM
         DC    X'00420058'                 OFFSETS TO BLKSI LRECL
         MVC   LINEW2+47(7),IEBISAM
         LA    R1,BUFFER+18
         BAL   R10,A00101C                 PERFORM
         BAL   R14,PR2LINE                 PERFORM
A000EF6  MVC   LINEW2(2),ASTER
         MVC   LINEW2+2(131),LINEW2+1      FILL WITH ASTERISKS
         BAL   R14,PR2LINE                 PERFORM
         TM    FLAG1,X'02'
         BO    A000F1A
         TM    FLAG1,X'08'
         BO    A0005B2
         B     CHKPGMX
A000F1A  NI    FLAG1,255-X'02' FD
         TM    FLAG1,X'08'
         BO    A000608
         B     A0002A4
A000F2A  BAL   R14,PR2LINE                 PERFORM
A000F2E  TM    FLAGP,X'20'                 PARM = NOMEM
         BO    A000EF6
         MVI   LINEW2,C'0'
         MVC   LINEW2+16(27),FMEMUN        FOLLOWING MEMBERS UNLOADED
         BAL   R14,PR2LINE                 PERFORM
         MVI   LINEW2,C'0'
         LA    R6,LINEW2+20
         BR    R10
SHOWDCB  MVC   LINEW2+54(17),PPPWAS        ...  WAS:  DSORG=
         LA    R15,LINEW2+71
         BAL   R14,SHOWDSOR                PERFORM
         MVC   LINEW2+76(6),LRECLE         LRECL=
         LA    R1,BUFFER
         AH    R1,6(,R10)
         LA    R15,LINEW2+82
         BAL   R14,EDITHALF                PERFORM
         BAL   R14,LEFTJUST                PERFORM
         MVC   LINEW2+90(6),RECFME         RECFM=
         LA    R15,LINEW2+96
         BAL   R14,SHOWRECF
         MVC   LINEW2+104(8),BLKSIZEE
         LA    R1,BUFFER
         AH    R1,4(,R10)
         LA    R15,LINEW2+112
         BAL   R14,EDITHALF                PERFORM
         BAL   R14,LEFTJUST                PERFORM
A000F9E  MVI   LINEW2,C'-'
         MVC   LINEW2+1(17),LABBUF1+4      DSNAME
         MVC   LINEW2+19(5),PFILEP         (FILE)
         MVC   LINEW2+25(4),LABBUF1+31
         MVC   LINEW2+29(17),WASUNBY-1
         B     8(,R10)
A000FBE  STM   R0,R15,SAVEALL              SAVE REGS
         MVC   LINEW2(34),LOGIC
         BAL   R14,PR2LINE                 PERFORM
         TM    FLAGP,X'80'                 PARM = TEST
         BNO   A000EF6
         LA    R1,PRTDCBA
         SVC   20                          CLOSE
         TM    FLAG2,USEPRNT2
         BNO   A000FE8
         LA    R1,PR2DCBA
         SVC   20                          CLOSE SYSPRNT2
A000FE8  LA    R14,SAVEALL
         EX    R0,*                        ABEND S0C3
EDITHALF MVC   DOUBLE(2),0(R1)
         LH    R0,DOUBLE
         CVD   R0,DOUBLE
         MVC   1(5,R15),PATT5
         ED    0(6,R15),DOUBLE+5
         BR    R14
         SPACE
LEFTJUST CLI   0(R15),C' '
         BCR   7,R14
         MVC   0(6,R15),1(R15)
         B     LEFTJUST
A00101C  MVC   LINEW2+120(9),UNITE            UNIT=????
         CLI   3(R1),X'0D'
         BCR   2,R10
         IC    R14,3(,R1)
         N     R14,F255
         BCR   8,R10
         BCTR  R14,R0
         MH    R14,H6
         LA    R15,DEVTAB2
         LA    R14,0(R14,R15)
         MVC   LINEW2+125(6),0(R14)
         BR    R10
SHOWDSOR LA    R1,BUFFER
         AH    R1,0(,R10)
         TM    0(R1),X'01'
         BNO   *+8
         MVI   2(R15),C'U'
         MVC   0(2,R15),PO
         TM    0(R1),X'02'
         BCR   1,R14
         MVC   0(2,R15),DA
         TM    0(R1),X'20'
         BCR   1,R14
         MVC   0(2,R15),PS
         TM    0(R1),X'40'
         BCR   1,R14
         MVC   0(2,R15),IS
         TM    0(R1),X'80'
         BCR   1,R14
         MVC   0(2,R15),UK
         BR    R14                         EXIT
         SPACE
SHOWRECF LA    R1,BUFFER
         AH    R1,2(,R10)
         TM    0(R1),X'C0'
         BNO   A0010AC
         MVI   0(R15),C'U'
         B     A0010C8
A0010AC  TM    0(R1),X'80'
         BNO   A0010BC
         MVI   0(R15),C'F'
         B     A0010C8
A0010BC  TM    0(R1),X'40'
         BNO   A0010C8
         MVI   0(R15),C'V'
A0010C8  LA    R15,1(,R15)
         TM    0(R1),X'10'
         BNO   A0010DC
         MVI   0(R15),C'B'
         LA    R15,1(,R15)
A0010DC  TM    0(R1),X'08'
         BNO   A0010EC
         MVI   0(R15),C'S'
         LA    R15,1(,R15)
A0010EC  TM    0(R1),X'20'
         BNO   A0010FC
         MVI   0(R15),C'T'
         LA    R15,1(,R15)
A0010FC  TM    0(R1),X'02'
         BNO   A00110C
         MVI   0(R15),C'A'
         LA    R15,1(,R15)
A00110C  TM    0(R1),X'01'
         BCR   14,R14
         MVI   0(R15),C'M'
         BR    R14                         EXIT
         SPACE
DIV1200  XR    R0,R0
         D     R0,F1200            DIVIDE BY 1200
         CH    R0,H600             IS REMAINDER GT 600
         BL    *+6                 NO
         AR    R1,R7               YES, ROUND UP
         CVD   R1,DOUBLE
         MVC   1(5,R15),PATT5
         ED    0(6,R15),DOUBLE+5
         BR    R14                 RETURN
         SPACE
EXCP     ST    R0,EXCPIOB+16       STORE ADDRESS OF CCW IN IOB
         LA    R1,EXCPIOB
         SVC   0                   EXCP
         LA    R1,EXCPECB
         LA    R0,1
         SVC   1                   WAIT
         CLI   EXCPECB,X'7F'
         BE    EXCPOK
         CLI   EXCPECB,X'41'
         BNE   EXCPERR
         CLI   EXCPIOB+12,X'0D'    TAPEMARK
         BCR   8,R10               YES, RETURN TO +0
         SPACE
EXCPERR  CH    R8,H60
         BL    *+8
         BAL   R10,PRTPAGE
         MVC   LINEWK(44),EXCPMSG
         UNPK  LINEWK+33(3),EXCPECB(2)
         TR    LINEWK+33(2),HEXTR-240
         MVI   LINEWK+35,C' '
         UNPK  LINEWK+44(15),EXCPIOB+9(8) CSW
         TR    LINEWK+44(14),HEXTR-240
         MVI   LINEWK+58,C' '
         MVC   LINEWK+59(24),EXCPMSG2
         UNPK  LINEWK+75(5),EXCPIOB+2(3)
         TR    LINEWK+75(4),HEXTR-240
         MVI   LINEWK+79,C' '
         BAL   R14,PRTLINE                 PERFORM
         L     R1,UT1DCBA                  DCB
         L     R1,44(,R1)                  DEB
         L     R1,32(,R1)
         L     R1,24(,R1)
         MVC   LINEWK(16),EXCPMSG3
         UNPK  LINEWK+16(9),0(5,R1)
         TR    LINEWK+16(8),HEXTR-240
         MVI   LINEWK+24,C' '
         UNPK  LINEWK+25(9),4(5,R1)
         TR    LINEWK+25(8),HEXTR-240
         MVI   LINEWK+33,C' '
         UNPK  LINEWK+35(9),8(5,R1)
         TR    LINEWK+35(8),HEXTR-240
         MVI   LINEWK+43,C' '
         UNPK  LINEWK+44(9),12(5,R1)
         TR    LINEWK+44(8),HEXTR-240
         MVI   LINEWK+52,C' '
         UNPK  LINEWK+54(9),16(5,R1)
         TR    LINEWK+54(8),HEXTR-240
         MVI   LINEWK+62,C' '
         UNPK  LINEWK+63(9),20(5,R1)
         TR    LINEWK+63(8),HEXTR-240
         MVI   LINEWK+71,C' '
         BAL   R14,PRTLINE                 PERFORM
         CLI   FLAG5,X'03'
         BNE   A0008BE
         L     R1,EXCPIOB+16               POINT TO CCW
         CLI   0(R1),X'02'
         BNE   A0008BE
         LA    R0,CCWFSF
         B     EXCP
         SPACE
EXCPOK   L     R0,F32768
         MVC   DOUBLE+2(2),EXCPIOB+14      RESIDUAL COUNT
         XC    DOUBLE(2),DOUBLE
         S     R0,DOUBLE
         STH   R0,HWB                      ACTUAL LENGTH READ
         TM    FLAG1,X'04'
         BNO   4(,R10)
         SPACE
         A     R0,FWB
         ST    R0,FWB
         L     R1,FWA
         LA    R1,1(,R1)
         ST    R1,FWA
         CLC   HWB,BUFFER
         BE    *+8
         NI    FLAG3,255-X'80'
         CLC   HWB,HWA
         BE    4(,R10)
         SPACE
         BC    2,A0012A6
         TM    FLAG3,X'20'
         BO    A0012B0
         OI    FLAG3,X'20'
         B     4(,R10)
         SPACE
A0012A6  OI    FLAG3,X'20'
         MVC   HWA,HWB
A0012B0  NI    FLAG3,255-X'40'
         B     4(,R10)
         SPACE
TESTDD   L     R1,TIOTDD                   POINT TO FIRST DD IN TIOT
         XR    R0,R0
         BAL   R14,*+6                     SET UP R14
         AR    R1,R0
         IC    R0,0(,R1)
         LTR   R0,R0
         BCR   8,R10                       RETURN TO +0 IF NOT FOUND
         CLC   4(8,R1),0(R15)              COMPARE TO DDNAME
         BCR   7,R14                       LOOP IF NOT EQUAL
         CLC   F0,16(R1)                   IS UCB ADDRESS ZERO (DUMMY)
         BNE   4(,R10)                     RETURN TO +4 IF UCB NZ
         BR    R10                         RETURN TO +0 IF UCB ZERO
         SPACE
ZSUPR    CLI   0(R1),C'0'                  IS IT A ZERO
         BCR   7,R14                       NO, RETURN
         MVI   0(R1),C' '                  YES, REPLACE WITH BLANK
         AR    R1,R7                       POINT TO NEXT CHAR
         B     ZSUPR
         SPACE
PRTPAGEQ CR    R8,R0                       IS LINECOUNT LT R0
         BCR   11,R10     BNLR             NO, RETURN
         SPACE
PRTPAGE  LA    R8,58                       LINECOUNT
         MVC   LINEWK(132),LINEH1
         BAL   R14,PRTLINE                 PERFORM
         MVI   LINEWK,C'+'                 OVERPRINT CC
         MVC   LINEWK+5(6),LABEL+4         VOLSER
         LA    R0,LINEWK
         BAL   R14,PRTPUT                  PERFORM
         BAL   R14,PRTLINE                 PERFORM
         TM    FLAG1,FIRST                 FIRST TIME
         BNO   PRTPNF                      BRANCH IF NOT
         NI    FLAG1,255-FIRST             INDICATE FIRST TIME DONE
         MVC   AUTHOR+1(28),AUTHOR         FILL WITH BLANKS
         TM    FLAG2,VOLDIF                VOL MISMATCH
         BNO   A00133C                     NO
         MVC   AUTHOR+1(28),REQVOL+1       ** REQUESTED VOL = "XXXXXX"
         B     A001352
A00133C  TM    FLAG1,PARMSPEC              IS PARM FIELD USED
         BNO   A001352                     NO, LEAVE BLANK
         TM    FLAG2,PARMLONG              IS PARM TOO LONG FOR THIS
         BO    A001352                     YES, USE SEPARATE LINE
         MVC   AUTHOR+1(28),PARMCOPY+1     NO, MOVE PARM HERE
A001352  EQU   *
         CLC   AUTHOR+1(28),AUTHOR         IS SHORT MESSAGE BLANK .FIX.
         BE    NOAUTH                      YES, SKIP THAT LINE    .FIX.
         MVC   LINEWK(131),AUTHOR          WRITTEN BY
         BAL   R14,PRTLINE                 PRINT
NOAUTH   EQU   *                           TAG                    .FIX.
         SPACE
         TM    FLAG2,VOLDIF                VOL MISMATCH
         BNO   A00137C                     NO
         LA    R8,2(,R8)                   2 EXTRA LINES OVERPRINT
         MVC   LINEWK(29),REQVOL           ** REQUESTED VOL
         BAL   R14,PRTLINE                 PERFORM
         MVC   LINEWK(29),REQVOL           ** REQUESTED VOL
         BAL   R14,PRTLINE                 PERFORM
A00137C  TM    FLAG1,PARMSPEC              IS PARM USED
         BNO   PRTPNF                      NO, SUPPRESS PARM LINE
         TM    FLAG2,PARMLONG              YES, IS IT LONG
         BO    A001394                     YES, NOT IN AUTHOR LINE
         TM    FLAG2,VOLDIF                WAS THERE A VOL MISMATCH
         BNO   A00139E                     NO, PARM ALREADY SHOWN
A001394  MVC   LINEWK(110),PARMCOPY        SHOW THE PARM
         BAL   R14,PRTLINE                 PRINT THE PARM
A00139E  TM    FLAG1,KWERR                 PARM KEYWORD ERROR
         BNO   PRTPNF                      NO
         MVC   LINEWK(61),PARMERR          YES,
         BAL   R14,PRTLINE                 PRINT ERROR MESSAGE
         SPACE
PRTPNF   LA    R0,DASHES
         BAL   R14,PRTPUT                  PRINT DASHES
         L     R15,ALINEH2
         MVC   LINEWK(131),0(R15)
         BAL   R14,PRTLINE                 PRINT HEADING 2
         L     R15,ALINEH3
         MVC   LINEWK(131),0(R15)
         BAL   R14,PRTLINE                 PRINT HEADING 3
         LA    R0,DASHES
         BAL   R14,PRTPUT                  PRINT DASHES
         LA    R0,LINEWK
         BAL   R14,PRTPUT                  PRINT LINEWK
         BR    R10
         SPACE
PRTLINE  ST    R14,PRTSAVE1
         LA    R0,LINEWK
         BAL   R14,PRTPUT                  PERFORM
         L     R14,PRTSAVE1
         MVC   LINEWK(133),LINEWK-1
         BCTR  R8,R14
         ST    R14,PRTSAVE3
         ST    R10,PRTSAVE2
         BAL   R10,PRTPAGE                 PERFORM
         L     R14,PRTSAVE3
         L     R10,PRTSAVE2
         BR    R14                         EXIT
         SPACE
PRTPUT   L     R1,PRTDCBA
         L     R15,48(,R1)
         BR    R15
         SPACE
PR2PAGEQ CR    R0,R9                       IS R0 LESS THAN LINECOUNT
         BCR   4,R10                       YES, RETURN
         SPACE
PR2PAGE  LA    R0,LINEH1
         BAL   R14,PR2PUT                  PERFORM
         LA    R0,DASHES
         BAL   R14,PR2PUT                  PERFORM
         LA    R9,58                       RESET LINECOUNT
         BR    R10
         SPACE
PR2LINE  ST    R14,PRTSAVE1
         LA    R1,3                        TRIPLE SPACE
         CLI   LINEW2,C'-'
         BE    PR2LCT
         BCTR  R1,R0                       DOUBLE SPACE
         CLI   LINEW2,C'0'
         BE    PR2LCT
         BCTR  R1,R0                       SINGLE SPACE
         CLI   LINEW2,C' '
         BE    PR2LCT
         MVI   LINEW2,C' '                 FORCE SINGLE SPACE
PR2LCT   SR    R9,R1                       COUNT 1 OR MORE LINES
         BP    PR2DET
         BAL   R10,PR2PAGE                 PERFORM
         MVI   LINEW2,C'-'
         SH    R9,H3
PR2DET   BAL   R14,PR2PUTL                 PERFORM
         MVC   LINEW2(133),LINEW2-1
         L     R14,PRTSAVE1
         BR    R14                         EXIT
PR2PUTL  LA    R0,LINEW2
PR2PUT   L     R1,PR2DCBA
         L     R15,48(,R1)
         BR    R15
         SPACE
         USING *,R15
PRTEXT   CLC   62(2,R1),F0                 IS BLKSIZE ZERO
         BNE   16(,R15)                    NO
         MVC   62(2,R1),H3458              26*133
         CLI   20(R1),X'00'
         BCR   7,R14
         MVI   20(R1),X'01'
         BR    R14                         EXIT
         DROP  R15
         SPACE
         DC    F'0'
PSDDNAME DC    C'./DDNAME'
PSVOLUME DC    C'./VOLUME'
OPERRUT1 DC    C'-*** TAPE VOLUME COULD NOT BE OPENED ***'
VOL1     DC    C'VOL1'
         DC    C'VOL1'
COPYRDW  DC    AL2(60,0,56,0)
LENGTHS  DC    C'        '
         DC    C'LENGTHS FOR RECFMS OTHER THAN F,FB,ETC MAY NOT BE'
         DC    C' VERY CLOSE TO THE TRUE LENGTH.'
MOVEID   DC    C'UNLOADED'
DASDRID  DC    X'F47006016663B24D'
FDRID    DC    C'TTHATS ALL FOLKS'
ATTRMSG  DC    C'TRUE ATTRIBUTES:  DSORG='
DEVTAB1  DC    C'2321  '
         DC    C'2311  '
         DC    C'2314  '
         DC    C'2302  '
         DC    C'2301  '
         DC    C'2305-1'
         DC    C'2305-2'
         DC    C'3330  '
         DC    C'??0A  '
         DC    C'??0B  '
         DC    C'??0C  '
         DC    C'3330-1'
ALLFF    DC    8X'FF'
BLKSIZEE DC    C'BLKSIZE='
EXCPMSG2 DC    C'*** IOBSENSE0,1=XXXX ***'
EXCPMSG3 DC    C' *** SENSE DATA='
ASTOP    DC    A(STOP)
AUTH     DC    C'/LDW'
A001610  DC    C'0++++ NO VOL1 LABEL FOUND.  NL ANALYSIS FOLLOWS ++++'
F100     DC    F'100'
F60      DC    F'60'
EOF1     DC    C'EOF1'
EOV1     DC    C'EOV1'
ZZZ1     DC    C'0001'
EOV2     DC    C'EOV2'
COPYID   DC    X'00CA6D0F'         IEBCOPY ID
ADDB     DC    C'ADD '
F154     DC    F'154'
DSNE     DC    C'DSN='
F255     DC    F'255'
F0       DC    F'0'
VOLE     DC    C'VOL='
F31      DC    F'31'
F1200    DC    F'1200'
EXCPMSG  DC    C'-*** TAPE I/O ERROR *** ECB CODE=XX *** CSW='
F32768   DC    F'32768'
ALINEH2  DC    A(LINEH2)
ALINEH3  DC    A(LINEH3)
PNULLP   DC    C'(NULL)'
H375     DC    H'375'
H750     DC    H'750'
OWNERE   DC    C'OWNER='
H320     DC    H'320'
EONF     DC    C'0EOF OR EOV LABEL NOT FOUND WHERE EXPECTED'
BS       DC    C'BS'
H1125    DC    H'1125'
CONTIN   DC    C' *** THE ABOVE FILE IS CONTINUED ON ANOTHER VOLUME'
NOTELINE DC    C'0NOTE:  LENGTH(S) ARE COMPUTED, '
         DC    C'(BASED ON BLKSIZE, BLKCOUNT, AND DENSITY), '
         DC    C'AND ARE THEREFORE ONLY APPROXIMATE.'
HINITT   DC    C'-++++ TAPE HAS BEEN RE-LABELLED WITH IEHINITT ++++'
DOTSLASH DC    C'./'
H6       DC    H'6'
H80      DC    H'80'
H78      DC    H'78'
H8       DC    H'8'
H2       DC    H'2'
H276     DC    H'276'
ASTER    DC    C'0*'
LRECLE   DC    C'LRECL='
RECFME   DC    C'RECFM='
LOGIC    DC    C'0*** LOGIC ERROR - CONTACT LDW ***'
DEVTAB2  DC    C'2311  '
         DC    C'2301  '
         DC    C'2303  '
         DC    C'2302  '
         DC    C'2321  '
         DC    C'2305-1'
         DC    C'2305-2'
         DC    C'2314  '
         DC    C'3330  '
         DC    C'3340  '
         DC    C'3350  '
         DC    C'??0C  '
         DC    C'3330-1'
PO       DC    C'PO'
DA       DC    C'DA'
PS       DC    C'PS'
IS       DC    C'IS'
UK       DC    C'**'
H600     DC    H'600'
H60      DC    H'60'
H3       DC    H'3'
H3458    DC    H'3458'
UPDTEMSG DC    C'IS AN IEBUPDTE INPUT STREAM'
PATT5    DC    X'2020202120'
PATT7    DC    X'20202020202120'
WRT      DC    C'WRT'
QQQ      DC    C'???'
YES      DC    C'YES'
EOVMSG   DC    C'-     *** EOV ***'
DENMSG   DC    C'-*****  ONE OR MORE FILES '
         DC    C'HAVE DENSITY INDICATED INCORRECTLY IN LABELS.'
         DC    C'  ALL FILES ARE WRITTEN AT '
         DC    C'XXXX'
         DC    C' BPI  *****'
A00191A  DC    C'0*** UNEXPECTED TAPE MARK ***'
A001937  DC    C'0++++ TAPE HAS LEADING TAPE MARK ++++'
REPLB    DC    C'REPL '
CHANGEB  DC    C'CHANGE '
MEMBERE  DC    C'MEMBER='
NAMEE    DC    C'NAME='
DUMPFROM DC    C'DUMP FROM CCHH='
OFA      DC    C' OF A'
VOLUMEE  DC    C'VOLUME='
CDATE    DC    C'C-DATE='
EDATE    DC    C'E-DATE='
FMEMUN   DC    C'FOLLOWING MEMBERS UNLOADED:'
PPPWAS   DC    C'...  WAS:  DSORG='
PFILEP   DC    C'(FILE)'
WASUNBY  DC    C' WAS UNLOADED BY'
UNITE    DC    C'UNIT=????'
         DC    0F'0'
PR2DCBA  DC    X'8F'
         DC    AL3(PR2DCB)
PRTDCBA  DC    X'8F'
         DC    AL3(PRTDCB)
SINDCBA  DC    X'80'
         DC    AL3(SINDCB)
UT1DCBA  DC    X'80'
         DC    AL3(UT1DCB)
UT1EXL   EQU   *
         DC    F'0'
PRTEXL   EQU   *
         DC    X'85'
         DC    AL3(PRTEXT)
EXCPECB  DC    F'0'
EXCPIOB  EQU   *
         DC    X'42000000'
         DC    A(EXCPECB)
         DC    F'0'
         DC    F'0'
         DC    F'0'
         DC    A(UT1DCB)
         DC    F'0'
         DC    F'65536'
         DC    F'0'
CCWFSF   CCW   X'3F',0,0,1
CC       EQU   X'40'               COMMAND CHAINING
SLI      EQU   X'20'               SUPPRESS INCORRECT LENGTH INDICATION
CCWLBL   CCW   X'02',0,CC,80       READ AN 80 BYTE RECORD
CCWLBL2  CCW   X'02',0,0,80        READ ANOTHER 80 BYTE RECORD
CCWREAD  CCW   X'02',0,SLI,X'8000' READ ANY BLOCK
CCWREW   CCW   X'07',0,0,1         REWIND
CCWSENS  CCW   X'04',SENSE,SLI,24  READ SENSE DATA
SENSE    DC    6F'0'
FLAG1    DC    X'00'
PARMSPEC EQU   X'80'               PARM FIELD SPECIFIED
KWERR    EQU   X'40'               KEYWORD ERROR
FIRST    EQU   X'20'               FIRST HEADING IS SPECIAL
FLAG2    DC    X'00'
VOLDIF   EQU   X'80'
PARMLONG EQU   X'40'
USEPRNT2 EQU   X'20'
FLAG3    DC    X'00'
FLAGP    DC    X'00'
IEBCOPY  DC    C'IEBCOPY'
IEHMOVE  DC    C'IEHMOVE'
IEBISAM  DC    C'IEBISAM'
IEHDASDR DC    C'IEHDASDR'
IEBUPDTE DC    C'IEBUPDTE'
FDR      DC    C'FDR'
         DC    C' ' UTILITY-1
UTILITY  DC    CL9' '
C00080   DC    C'000800'
PSTOP    DC    A(STOP)
BPIV     DC    F'200'
         DC    F'556'
BPIV800  DC    F'800'
         DC    F'1600'
         DC    F'6250'
         DC    C'200 556 800 16006250'
BPIA     DC    C'3'
         DC    AL3(BPIV800)
F1       DC    F'00001'
F15      DC    F'00015'
EOVBYPAS DC    H'0'
EOVCOUNT DC    H'0'
FLAG5    DC    X'00'
HEXTR    DC    C'0123456789ABCDEF'
LINEH1   DC    C'1VOL='
         DC    CL29' '
NEWDSN   DC    CL50'UCLA COMPUTER CLUB TAPE ANALYSIS PROGRAM (TAPEMAP)'
         DC    C'     DAYDAYDAY  '
         DC    C'MON DD, 19YY  (YY.DDD)'
         DC    C'  HH:MM:SS'
AUTHOR   DC    CL33' '
         DC    CL30' WRITTEN BY LEONARD D. WOREN  '
         DC    CL26'     VERSION=06-28-78     '
         DC    CL42'(ORIGINAL SL VERSION BY MICHAEL S. MAITEN)'
         ORG   *-98                                               .FIX.
         DC    CL98' '                                            .FIX.
REQVOL   DC    C'+** REQUESTED VOL="123456" **'
MULTMSG  DC    C' *** THIS IS VOLUME # XXXX OF THE ABOVE MULTIPLE'
         DC    C' VOLUME FILE.  FIRST VOLUME WAS XXXXXX.'
PARMERR  DC    C' UNKNOWN PARM OPTION AT COL=XXX.  ANY REMAINING PARM'
         DC    C' IGNORED.'
         DC    X'00'
         DC    X'BCB2'
         DC    X'BCB4'
         DC    X'BCB6'
         DC    X'BCB8'
         DC    X'BCBA'
         DC    X'BCBC'
         DC    X'BCBE'
         DC    X'BCC0'
         DC    X'BCC2'
         DC    X'BCC4'
         DC    X'BCC6'
         DC    X'BCC8'
         DC    X'BCCA'
         DC    X'BCCC'
         DC    X'BCCE'
         DC    X'BCD0'
         DC    X'BCD2'
         DC    X'BCD4'
         DC    X'BCD6'
         DC    X'BCD8'
         DC    X'BCDA'
         DC    X'BCDC'
         DC    X'BCDE'
         DC    X'BCE0'
         DC    X'BCE2'
         DC    X'BCE4'
         DC    X'BCE6'
         DC    X'BCE8'
         DC    X'BCEA'
         DC    X'BCEC'
         DC    X'BCEE'
         DC    X'BCF0'
         DC    X'BCF2'
         DC    X'BCF4'
         DC    X'BCF6'
         DC    X'BCF8'
         DC    X'BCFA'
         DC    X'BCFC'
         DC    X'BCFE'
         DC    X'BD00'
         DC    X'BD02'
         DC    X'BD04'
         DC    X'BD06'
         DC    X'BD08'
         DC    X'BD0A'
         DC    X'BD0C'
         DC    X'BD0E'
         DC    X'BD10'
         DC    X'BD12'
         DC    X'BD14'
         EJECT
INIT     BALR  R5,0
         USING *,R5
         MVI   BLANKS,C' '
         MVC   BLANKS+1(150),BLANKS        BLANK BLANKS AND LINEWK
         MVC   LINEW2-1(135),LINEWK-1
         MVI   DASHES,C' '                 BLANK CARRIAGE CONTROL .FIX.
         MVI   DASHES+1,X'60'              FIRST DASH
         MVC   DASHES+2(131),DASHES+1      PROPOGATE DASHES
         MVC   PARMCOPY+1(109),PARMCOPY
         XC    JFCB(176),JFCB
         LA    R0,JFCB
         ST    R0,UT1EXL
         MVI   UT1EXL,X'87'
         LA    R0,BUFFER
         ST    R0,CCWREAD
         MVI   CCWREAD,X'02'
         LA    R1,LABBUF1
         ST    R1,CCWLBL
         MVI   CCWLBL,X'02'
         LA    R0,LABBUF2
         ST    R0,CCWLBL2
         MVI   CCWLBL2,X'02'
         LA    R1,KEEP78
         ST    R1,ADDR78
         LA    R0,LINEW2+110               LINEW2+110
         ST    R0,EDGE1
         LA    R0,LINEW2+120               LINEW2+120
         ST    R0,EDGE2
         SPACE
         LA    R1,PRTDCBA
         SVC   19                          OPEN SYSPRINT
         L     R1,PRTDCBA
         TM    48(R1),X'10'
         BO    PRTOK
         LA    R1,100
         SVC   13                          ABEND 100 IF OPEN FAILS
         SPACE
PRTOK    LH    R15,0(,R2)                  GET LENGTH OF PARM FIELD
         LTR   R15,R15                     IS THERE A PARM
         BNP   PARMX                       NO, BRANCH
         LA    R14,2(,R2)
         LR    R0,R14
         MVC   PARMCOPY(8),BPARMEQB
         MVC   PARMCOPY+8(102),PARMCOPY+7
         CH    R15,H21                     IS PARM LONGER THAN 21
         BNH   *+8                         NO
         OI    FLAG2,PARMLONG              YES, TOO LONG FOR AUTHOR LNE
         EX    R15,INITMVC
         LA    R1,PARMCOPY+7(R15)
         MVI   0(R1),X'7D'                 CLOSE QUOTE
         OI    FLAG1,PARMSPEC
KWLOOPO  LM    R1,R3,KWBXLE                RESTORE REGS
KWLOOPI  LH    R4,0(,R1)                   GET LENGTH CODE OF KEYWORD
         EX    R4,INITCLC                  DOES KEYWORD MATCH
         BNE   NEXTKW                      NO, BRANCH
         OC    FLAGP,11(R1)                YES, SET ON FLAG BIT
         LA    R14,2(R14,R4)               POINT TO NEXT FIELD IN PARM
         SR    R15,R4                      REDUCE LENGTH
         SH    R15,V2                      REDUCE LENGTH
         BP    KWLOOPO
         B     PARMX
KWNULLE  SH    R15,H5                      REDUCE LENGTH BY 5
         BNP   PARMX
         LA    R14,5(,R14)                 POINT PAST NULL=
         SR    R1,R1                       START WITH VALUE ZERO
KWNULLL  CLI   0(R14),C'0'                 IS NEXT CHAR NUMERIC
         BL    KWNULLX                     NO, BRANCH
         IC    R0,0(,R14)                  GET THE DIGIT
         N     R0,F15                      CONVERT TO BINARY
         MH    R1,H10                      MULTIPLY PREV VALUE BY 10
         AR    R1,R0                       ADD DIGIT TO PREV VALUE
         LA    R14,1(,R14)                 POINT TO NEXT DIGIT
         BCT   R15,KWNULLL                 LOOP
KWNULLX  LTR   R1,R1                       IS VALUE STILL ZERO
         BNP   *+8                         YES, SKIP STH
         STH   R1,EOVBYPAS                 NO, STORE VALUE
         LA    R14,1(,R14)                 POINT PAST COMMA
         SH    R15,F1+2                    REDUCE LENGTH
         BP    KWLOOPO                     BRANCH IF MORE PARM
         B     PARMX                       END OF PARM
NEXTKW   BXLE  R1,R2,KWLOOPI
         CLC   NULLE,0(R14)
         BE    KWNULLE
         SR    R14,R0              COMPUTE OFFSET INTO PARM
         LA    R14,1(,R14)         ADD 1 TO MAKE IT COLUMN
         CVD   R14,DOUBLE
         UNPK  PARMERR+28(3),DOUBLE+6(2)
         OI    PARMERR+30,X'F0'
         OI    FLAG1,KWERR
PARMX    LA    R8,60
         L     R1,16                       CVT ADDRESS
         UNPK  LINEH1+116(5),57(3,R1)      UNPACK YYDDD FROM CVTDATE
         OI    LINEH1+120,X'F0'
         MVC   LINEH1+115(2),LINEH1+116    SHIFT YY LEFT
         MVI   LINEH1+117,C'.'             AND INSERT PERIOD
         TM    57(R1),X'01'                IS IT AN ODD YEAR
         BO    NOTLEAP                     YES, BRANCH
         TM    57(R1),X'12'                IS IT DIVISIBLE BY 4
         BM    NOTLEAP                     NO, BRANCH
         MVI   FEBSIZE+1,29                CHANGE FEB TO 29 DAYS
NOTLEAP  MVC   DOUBLE+6(2),58(R1)          GET PACKED DDD
         XC    DOUBLE(6),DOUBLE
         CVB   R0,DOUBLE                   CONVERT DDD TO BINARY
         LA    R15,MONTHS
MONLOOP  SH    R0,0(,R15)                  REDUCE DDD BY MONTH SIZE
         BNP   MONX                        STOP IF DDD NOT POSITIVE
         LA    R15,6(,R15)                 POINT TO NEXT MONTH
         B     MONLOOP
MONX     MVC   LINEH1+100(3),2(R15)
         AH    R0,0(,R15)
         CVD   R0,DOUBLE
         UNPK  LINEH1+104(2),DOUBLE+6(2)
         OI    LINEH1+105,X'F0'
         MVC   LINEH1+110(2),LINEH1+115
         ST    R0,DOUBLE
         LA    R14,MONTHS-6
         SR    R15,R14
         XR    R14,R14
         D     R14,F6
         SH    R15,V2
         BP    *+8
         AH    R15,H12
         IC    R0,57(,R1)
         SRL   R0,4
         N     R0,F15
         MH    R0,H10
         IC    R1,57(,R1)
         N     R1,F15
         AR    R1,R0
         CH    R15,H10
         BNH   *+6
         BCTR  R1,R0
         MH    R15,H13
         BCTR  R15,R0
         XR    R14,R14
         D     R14,F5
         LR    R0,R1
         SRL   R0,2
         AR    R15,R0
         SH    R15,H34
         A     R15,DOUBLE
         AR    R15,R1
         XR    R14,R14
         D     R14,F7
         MH    R14,H9
         LA    R14,DAYS(R14)
         MVC   LINEH1+89(9),0(R14)         DAY OF WEEK
         LA    R1,2                        TIME
         SVC   11                          TIME
         ST    R0,DOUBLE
         OI    DOUBLE+3,X'0F'
         MVC   LINEH1+123(9),TIMEPATT
         ED    LINEH1+123(9),DOUBLE        HH:MM:SS
         L     R1,16                       CVT ADDRESS
         L     R1,0(,R1)                   TCB WORDS
         L     R1,4(,R1)                   CURRENT TCB
         L     R1,12(,R1)                  TIOT
         LA    R1,24(,R1)                  FIRST DD
         ST    R1,TIOTDD
         TM    FLAGP,X'48'                 PARM = INLINE OR NOATTR
         BNZ   OKPR2                       BYPASS SYSPRNT2 IF EITHER
         L     R2,PR2DCBA
         LA    R15,40(,R2)                 POINT TO DDNAME
         BAL   R10,TESTDD                  IS SYSPRNT2 PRESENT
         B     OKPR2                       NO, BRANCH
         LA    R1,PR2DCBA
         SVC   19                          OPEN SYSPRNT2
         OI    FLAG2,USEPRNT2
         TM    48(R2),X'10'                WAS OPEN SUCCESSFUL
         BO    OKPR2                       YES, BRANCH
ABEND99  LA    R1,99
         SVC   13                          ABEND
OKPR2    L     R2,SINDCBA
         LA    R15,40(,R2)                 POINT TO DDNAME
         BAL   R10,TESTDD                  IS SYSIN PRESENT
         B     A0000B2                     NO, BRANCH
         MVC   PSTOP,ANEXTR
         LA    R1,SINDCBA
         SVC   19                          OPEN SYSIN
         TM    48(R2),X'10'                WAS OPEN SUCCESSFUL
         BZ    ABEND99                     NO, ABEND
         MVI   PRTDCBA,X'00'
         B     NEXTRUN                     GO READ SYSIN STATEMENT
         SPACE
INITMVC  MVC   PARMCOPY+7(0),0(R14)
INITCLC  CLC   2(1,R1),0(R14)
         DROP  R5
         SPACE
BPARMEQB DC    C' PARM='' '
KWBXLE   DC    A(KWFIRST)
         DC    F'00012'
         DC    A(KWLAST)
F6       DC    F'00006'
F5       DC    F'00005'
F7       DC    F'00007'
ANEXTR   DC    A(NEXTRUN)
H21      DC    H'21'
V2       DC    H'2'
H5       DC    H'5'
H10      DC    H'10'
H12      DC    H'12'
H13      DC    H'13'
H34      DC    H'34'
H9       DC    H'9'
NULLE    DC    C'NULL='
TIMEPATT DC    X'4021207A20207A2020'
         SPACE
KWFIRST  DC    H'3'
         DC    C'TEST     '
         DC    X'80'
         SPACE
         DC    H'5'
         DC    C'INLINE   '
         DC    X'40'
         SPACE
         DC    H'8'
         DC    C'NOMEMBERS'
         DC    X'20'
         SPACE
         DC    H'4'
         DC    C'NOMEM    '
         DC    X'20'
         SPACE
         DC    H'3'
         DC    C'DEN1     '
         DC    X'10'
         SPACE
         DC    H'5'
         DC    C'NOATTR   '
         DC    X'08'
         SPACE
         DC    H'5'
         DC    C'NONOTE   '
         DC    X'04'
         SPACE
         DC    H'4'
         DC    C'CHECK    '
         DC    X'02'
         SPACE
         DC    H'3'
         DC    C'SCAN     '
         DC    X'02'
         SPACE
KWLAST   EQU   *
         DC    H'1'
         DC    C'NL       '
         DC    X'01'
         SPACE
         DC    H'0'
UT1DCB   EQU   *
         DC    5F'0'
         DC    F'00001'
         DC    H'0'
         DC    X'4000'
         DC    A(EXCPIOB)
         DC    F'00001'
         DC    X'00'
         DC    AL3(UT1EXL)
         DC    C'SYSUT1  '
         DC    X'0200D008'
SINDCB   EQU   *
         DC    5F'0'
         DC    X'01000001'
         DC    H'0'
         DC    C' '
         DC    X'00'
         DC    F'00001'
         DC    X'00'
         DC    AL3(EODSIN)
         DC    F'0'
         DC    C'SYSIN   '
         DC    X'02005000'
         DC    F'1,1,0,0,1,1,1'
         DC    F'80'
         DC    F'1,0,1'
PRTDCB   EQU   *
         DC    5F'0'
         DC    F'00001'
         DC    H'0'
         DC    C' '
         DC    X'00'
         DC    F'00001'
         DC    F'00001'
         DC    X'94'
         DC    AL3(PRTEXL)
         DC    C'SYSPRINT'
         DC    X'02000050'
         DC    F'1,1,0,0,1,1,1'
         DC    F'133'
         DC    F'1,0,1'
PR2DCB   EQU   *
         DC    5F'0'
         DC    F'00001'
         DC    H'0'
         DC    C' '
         DC    X'00'
         DC    F'00001'
         DC    F'00001'
         DC    X'94'
         DC    AL3(PRTEXL)
         DC    C'SYSPRNT2'
         DC    X'02000050'
         DC    F'1,1,0,0,1,1,1'
         DC    F'133'
         DC    F'1,0,1'
LINEH2   DC    C' UNLOADED  FILE                     PSWD          '
         DC    C'                      BLOCK  BLOCKS             LENGT'
         DC    C'H  TOTAL       CREATOR      '
LINEH3   DC    C' BY / FOR  SEQ#   DATA SET NAME     REQD  C-DATE  '
         DC    C'E-DATE  RECFM  LRECL   SIZE   USED   DEN   TRT  (FEET'
         DC    C')  LENGTH  JOB NAME/STEPNAME'
DAYS     DC    C'SUNDAY   '
         DC    C'MONDAY   '
         DC    C'TUESDAY  '
         DC    C'WEDNESDAY'
         DC    C'THURSDAY '
         DC    C'FRIDAY   '
         DC    C'SATURDAY '
         DC    X'00'
MONTHS   DC    H'31'
         DC    C'JAN '
FEBSIZE  DC    H'28'
         DC    C'FEB '
         DC    H'31'
         DC    C'MAR '
         DC    H'30'
         DC    C'APR '
         DC    H'31'
         DC    C'MAY '
         DC    H'30'
         DC    C'JUN '
         DC    H'31'
         DC    C'JUL '
         DC    H'31'
         DC    C'AUG '
         DC    H'30'
         DC    C'SEP '
         DC    H'31'
         DC    C'OCT '
         DC    H'30'
         DC    C'NOV '
         DC    H'31'
         DC    C'DEC '
         SPACE
@DATA    DSECT
         DS    18F
TIOTDD   DS    F                   72
WORDX    DS    F                   76
WORDY    DS    F                   80
COUNT    DS    H                   84
         DS    H                   86
PRTSAVE1 DS    F                   88
PRTSAVE2 DS    F                   92
PRTSAVE3 DS    F                   96-99
SAVEALL  DS    16F                 100-163
HWA      DS    H                   164
HWB      DS    H                   166
FWA      DS    F                   168
FWB      DS    F                   172
HWSV     DS    CL12                176
F3SV     DS    C                   188
ARC      DS    C                   189
BLANKS   DS    CL17                190-206
LINEWK   DS    CL133               207-339
         DS    C                   340
LINEW2   DS    CL133               341-473
         DS    CL7                 474-480
DASHES   DS    CL133               481
CARD     DS    CL80                614
LABEL    DS    CL80                694
LABBUF1  DS    CL80                774
LABBUF2  DS    CL80                854
         DS    CL2                 934-935
ADDR78   DS    F                   936
HOLD78   DS    CL78                940-1017
KEEP78   DS    CL78                1018-1095
PARMCOPY DS    CL110               1096-1205
         DS    XL2                 1206-1207
EDGE1    DS    F                   1208
EDGE2    DS    F                   1212
HOLD24   DS    CL24                1216
DOUBLE   DS    D                   1240
JFCB     DS    CL176               1248-1423
         ORG   JFCB+118
JFCBVOLS DS    CL6
         ORG
         ORG   @DATA+2048
BUFFER   DS    C
         SPACE
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END

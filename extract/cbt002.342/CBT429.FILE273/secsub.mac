++ USERMOD (#Z88005) .
++ VER   (Z038)     FMID (EBB1102)
                    PRE (UZ25987)  /* 7910 */ .
++ IF    (JBB1329)  THEN
                    REQ (#Z88105) .
++ IF    (HBB2102)  THEN
                    REQ (#Z88205) .
++ IF    (JBB2110)  THEN
                    REQ (#Z88305)
         /*

         THE PURPOSE OF THIS MODIFICATION IS TO PROVIDE THE
         ABILITY TO HAVE TSO USERS LOG ONTO AND STARTED TASKS
         BE STARTED TO A SECONDARY JOB ENTRY SUBSYSTEM.

         IN ORDER TO LOG ONTO A SECONDARY JES, THREE THINGS
         MUST BE MODIFIED ON BEHALF OF THE STC OR TSU, ONE
         PERMANENTLY AND TWO TEMPORARILY.  THE PERMANENT CHANGE
         IS TO THE NAME OF THE SUBSYSTEM IN THE LIFE-OF-JOB
         SSIB FOR THE REQUESTING STC OR TSU.  THE TEMPORARY
         CHANGES ARE TO THE MASTER SCHEDULER'S INTERNAL READER
         JFCB AND DSAB.

         THE PROTOCOL THAT THIS MODIFICATION USES TO DETECT A
         REQUEST FOR A SECONDARY SUBSYSTEM IS "==XXXX==" IN
         COLUMNS 73-80 OF THE STC OR TSU JOB STATEMENT.
         "XXXX" IS THE NAME OF THE REQUESTED SUBSYSTEM.  NO
         CHECK IS MADE TO SEE THAT IT IS A VALID AND ACTIVE
         SUBSYSTEM.

         FOR STARTED TASKS, THIS MODIFICATION WILL DETECT THE
         SPECIFICATION OF A SPECIAL KEYWORD PARAMETER ("SUB=XXXX")
         ON THE JCL OF THE STARTED TASK.  THIS PARAMETER MUST BE
         ENTERED BY THE OPERATOR, AS ONLY THE JCL CREATED BY
         STARTED TASK CONTROL, AND NOT THE SPECIFIED PROCEDURE,
         IS SCANNED FOR THE KEYWORD.  THIS PARAMETER DOES NOT
         HAVE BE DEFINED IN THE PROCEDURE AND MUST NOT BE USED
         IN THE PROCEDURE, AS IT IS REMOVED FROM THE GENERATED JCL.
         THE VALUE FOLLOWING THE KEYWORD IS MOVED, ALONG WITH THE
         EQUAL SIGNS, TO COLUMNS 73-80 OF THE FIRST STARTED TASK
         JCL STATEMENT.

         IT IS THE INSTALLATION'S RESPONSIBILITY TO PLACE THE
         "==XXXX==" IN 73-80 OF THE FIRST JCL STATEMENT OF THE
         TSU JCL.  THE "SUB=" KEYWORD PARAMETER IS NOT SCANNED FOR,
         AS ANOTHER MODIFICATION IS NECESSARY TO PLACE THE
         SUBSYSTEM NAME IN THE GENERATED TSU JCL AND THIS
         MODIFICATION CAN PLACE IT IN COLUMNS 73-80 OF THE FIRST
         JCL STATEMENT ITSELF.  ALSO, BY NOT MAKING IT A KEYWORD
         PARAMETER, A USER'S LOGON JCL IS NOT RESTRICTED FROM
         USING IT AS A VALID SYMBOLIC PARAMETER.  THE EASIEST
         WAY TO PLACE THIS PARAMETER ON THE TIME SHARING USER'S
         JCL IS TO GENERATE THE LOGON JCL IN THE LOGON PRE-PROMPT
         EXIT (IKJEFLD).

         THESE MODIFICATIONS ARE INSERTED AT THE POINT THAT IEFJSWT
         ENQUEUES ON EITHER STCQUE OR TSOQUE.  THIS PROVIDES
         PROPER SERIALIZATION OF THE CONTROL BLOCK CHANGES
         BEING MADE.  HOWEVER, THIS SERIALIZATION IS SYSTEM-WIDE.
         THIS MEANS THAT IF, FOR ANY REASON, IEFJSWT CANNOT
         FINISH SUBMITTING THE STC OR TSU ON THE INTERNAL READER,
         NO OTHER STC OR TSU JOBS MAY BE STARTED ON ANY SUBSYSTEM
         (EITHER PRIMARY OR SECONDARY).  THE PERFECT EXAMPLE OF
         THIS IS THAT A TSU BEING LOGGED ONTO A SECONDARY JES
         ENCOUNTERS A JOB QUEUE FULL CONDITION.  SINCE THE ENQUEUE
         ON TSOQUE IS HELD BY THE SUBMITTING ADDRESS SPACE,
         NO TSU'S CAN LOG ONTO THE PRIMARY JES.  NOTE THAT
         TSU'S AND STC'S HAVE SEPARATE ENQUEUE NAMES AND HANGING
         ONE UP WILL NOT HANG THE OTHER (UNLESS IT ENCOUNTERS
         THE SAME CONDITION THAT HUNG THE OTHER).

         LOGIC OF THESE MODIFICATIONS

         AT THE POINT WHERE STARTED TASK OR MOUNT COMMAND PROCESSING
         BRANCHES TO ENQUEUE ON THE STCQUE, A BRANCH IS MADE TO THE
         PATCH AREA.  EACH JCL STATEMENT EXCEPT THE FIRST (WHICH
         IS ASSUMED TO BE THE JOB STATEMENT) IS SCANNED FOR ",SUB=".
         IF NOT FOUND ON ANY JCL STATEMENT, PROCESSING RESUMES AT
         THE ENQUEUE.  IF FOUND, COLUMNS 73-80 OF THE FIRST JCL
         STATEMENT ARE SET TO "==    ==" AND COLUMNS 73-80 OF THE
         STATEMENT THAT ",SUB=" WAS FOUND ON ARE BLANKED. THE
         DATA FOLLOWING THE KEYWORD IS ASSUMED TO BE A SUBSYSTEM
         NAME AND IS MOVED ONE CHARACTER AT A TIME TO COLUMNS 75-78
         OF THE FIRST JCL STATEMENT.  WHEN EITHER A BLANK OR A COMMA
         IS ENCOUNTERED OR 4 CHARACTERS HAVE BEEN MOVED, THE
         REMAINDER OF THE JCL STATEMENT IS SHIFTED OVER THE
         ",SUB=XXXX", EFFECTIVELY DELETING IT. NOTE THAT THE
         KEYWORD PARAMETER WILL NOT BE FOUND IF IT IS THE FIRST
         PARAMETER ON A JCL CONTINUATION STATEMENT, SINCE A
         LEADING COMMA IS ASSUMED.  HENCE, IT BEHOOVES THE USER
         TO ENTER THE PARAMETER BEFORE OTHER PARAMETERS ON THE
         START COMMAND.  ALSO NOTE THAT NO VALIDITY CHECK IS DONE
         ON THE "SUBSYSTEM NAME" AND IT IS TRUNCATED AT 4 CHARACTERS,
         WHICH WILL PROBABLY CAUSE A JCL ERROR IF IT IS ACTUALLY
         LONGER.

         IMMEDIATELY AFTER THE ENQUEUE ON STCQUE OR TSOQUE
         (IN FACT THE ENQUEUE IS OVERLAID AND MOVED TO THE
         PATCH AREA), THE TIOT IS SCANNED FOR THE DDNAME BEING
         USED (STCINRDR OR TSOINRDR IN THE ACB).  IF NOT FOUND,
         WE GIVE UP AND RETURN TO NORMAL PROCESSING (THIS SHOULD
         NEVER HAPPEN).  THE DSAB CHAIN IS THEN SEARCHED FOR A
         MATCHING TIOT ADDRESS.  IF NOT FOUND, WE GIVE UP HERE
         (THIS IS ALSO A "SHOULD NEVER HAPPEN").  THE JFCB ADDRESS
         IN THE TIOT ENTRY IS LOADED.  IF ZERO,  WE GIVE UP AGAIN.
         THE JESCT IS LOCATED AND IS USED TO "REFRESH" THE JFCB
         DATA SET NAME AND THE DSAB SUBSYSTEM NAME (DSABSSNM)
         BACK TO THE NAME OF THE PRIMARY JES.  THIS IS BECAUSE
         THEY MAY HAVE BEEN CHANGED THE LAST TIME THEY WERE USED
         AND THIS MODIFICATION DOES NOT CHANGE THEM BACK AFTER USE.

         COLUMNS 73-74 AND 79-80 ARE CHECKED FOR "==".  IF NOT
         THERE, THIS IS A "NORMAL" STC OR TSU AND WE RESUME WHERE
         WE LEFT OFF.  IF THIS IS A SECONDARY SUBSYSTEM REQUEST,
         THE LIFE-OF-JOB SSIB, THE JFCB DATA SET NAME, AND THE
         DSAB SUBSYSTEM NAME ARE CHANGED TO WHATEVER IS IN
         COLUMNS 75-78 OF THE JOB STATEMENT.

         NO VALIDITY CHECK WHATSOEVER IS DONE ON THE SUBSYSTEM NAME.
         IF IT IS NOT A VALID SUBSYSTEM, THE STARTED TASK OR TSO
         USER WILL DISAPPEAR AND NO INDICATION OF AN ERROR WILL
         BE GIVEN.  FOR TSO, THE LOGON PRE-PROMPT EXIT (OR WHATEVER
         SET THE SUBSYSTEM NAME) SHOULD VALIDITY CHECK THE SPECIFIED
         SUBSYSTEM TO INSURE THAT IT IS AN ACTIVE SUBSYSTEM THAT
         SUPPORTS THE JOB SELECT FUNCTION.  FOR STARTED TASKS, THE
         OPERATOR (OR SYSTEMS PROGRAMMER) SHOULD TYPE WITH CARE.

         THE "SUB=" PARAMETER IS USED IN PLACE OF THE "SS="
         PARAMETER USED IN PREVIOUS VERSIONS OF THIS MODIFICATION
         IN ORDER TO PROVIDE COMPATIBILITY WITH MVS/XA.  IN MVS/XA,
         ONLY THE "TSO" PORTION OF THIS MODIFICATION WILL BE
         NECESSARY.

         THIS MODIFICATION IS DISTRIBUTED WITH THE USUAL CAVEATS.

                                                                   */ .
++ ZAP   (IEFJSWT)  DISTLIB (AOSB3) .
         EXPAND IEFJSWT(384)                EXPAND WILL START AT X'420'
         NAME  IEFJSWT
*
*        VERIFY BASE REGISTER (BASE REGISTER IS R12, VALUE X'0022')
*
         VER   0020 05C0                    BALR @12,0 (BASE REG)
*
*        CODE OVERLAID FOR SUB= KEYWORD SCAN
*
         VER   0098 4110,B108               LA   R1,ENQCORE1
         VER   009C 47F0,C0B4               B    @RC00055
*
         VER   00C0 4110,B108               LA   R1,ENQCORE1
         VER   00C4 47F0,C0B4               B    @RC00061
*
*        CODE OVERLAID FOR SETTING THE SUBSYSTEM NAME
*
         VER   00D6 0A38                    SVC  56
         VER   00D8 1875                    LR   @7,ACBREG
*
*        VERIFY EXPANDED PATCH AREA  (LEAVE ROOM IN FRONT)
*
         VER   0430 0000,0000               START OF PATCH AREA
         VER   057C 0000,0000               END OF PATCH AREA
*
*        BRANCH TO SCAN FOR SUB= KEYWORD
*
         REP   009C 47F0,C4CE               B    SSEQSCAN
         REP   00C4 47F0,C4CE               B    SSEQSCAN
*
*        BRANCH (AND LINK) TO SET SUBSYSTEM CODE
*
         REP   00D6 45E0,C40E               BAL  @14,SETSUB
*
*        REPLACE OVERLAID INSTRUCTIONS
*
         REP   0430 0A38           SETSUB   SVC  56
         REP   0432 1875                    LR   @7,ACBREG
*
*        SET UP FOR TIOT SCAN
*
         REP   0434 5810,021C               L    @1,PSATOLD
         REP   0438 5810,100C               L    @1,TCBTIO
         REP   043C 4110,1018               L    @1,TIOENTRY
         REP   0440 1F00                    SLR  @0,@0
*
*        SCAN TIOT LOOKING FOR DDNAME FROM ACB
*
         REP   0442 9500,1000      TIOTLP   CLI  TIOELNGH,0
         REP   0446 078E                    BER  @14
         REP   0448 D507,1004,7028          CLC  TIOEDDNM,ACBDDNM
         REP   044E 4780,C43A               BE   TIOTFND
         REP   0452 4300,1000               IC   @0,TIOELNGH
         REP   0456 1E10                    ALR  @1,@0
         REP   0458 47F0,C420               B    TIOTLP
*
*        TIOT ENTRY FOUND - SET UP FOR DSAB SCAN
*
         REP   045C 58F0,021C      TIOTFND  L    @15,PSATOLD
         REP   0460 58F0,F0B4               L    @15,TCBJSCB
         REP   0464 58F0,F15C               L    @15,JSCBACT
         REP   0468 58F0,F140               L    @15,JSCDSABQ
         REP   046C 58F0,F00C               L    @15,QDBFELMP
*
*        SCAN DSAB LOOKING FOR MATCHING TIOT ADDRESS
*
         REP   0470 12FF           DSABLP   LTR  @15,@15
         REP   0472 078E                    BZR  @14
         REP   0474 5800,F010               L    @0,DSABTIOT
         REP   0478 1910                    CR   @1,@0
         REP   047A 4780,C464               BE   DSABFND
         REP   047E 58F0,F004               L    @15,DSABFCHN
         REP   0482 47F0,C44E               B    DSABLP
*
*        PICK UP INTERNAL READER JFCB ADDRESS
*
         REP   0486 BF17,100C      DSABFND  ICM  @1,7,TIOEJFCB
         REP   048A 078E                    BZR  @14
*
*        PICK UP PRIMARY JES NAME AND RESET THE JFCB AND DSAB
*
         REP   048C 180F                    LR   @0,@15
         REP   048E 58F0,0010               L    @15,CVTPTR
         REP   0492 58F0,F128               L    @15,CVTJESCT
         REP   0496 D203,1010,F01C          MVC  JFCB(4),JESPJESN
         REP   049C 18F0                    LR   @15,@0
         REP   049E D203,F030,1010          MVC  DSABSSNM,JFCB
*
*        CHECK FOR THE "==" IN 73-74 AND 79-80
*
         REP   04A4 D501,4050,C4B0          CLC  THEJCL+72(2),EQUAL
         REP   04AA 077E                    BNER @14
         REP   04AC D501,4056,C4B0          CLC  THEJCL+78(2),EQUAL
         REP   04B2 077E                    BNER @14
*
*        UPDATE SSIB, JFCB, AND DSAB TO CONTAIN THE 2NDARY SUBSYS NAME
*
         REP   04B4 58F0,8008               L    @15,SSOBPTR(,PARMPTR)
         REP   04B8 58F0,F008               L    @15,SSOBSSIB
         REP   04BC D203,F008,4052          MVC  SSIBSSNM,THEJCL+74
         REP   04C2 D203,1010,F008          MVC  JFCB(4),SSIBSSNM
         REP   04C8 18F0                    LR   @15,@0
         REP   04CA D203,F030,1010          MVC  DSABSSNM,JFCB
         REP   04D0 07FE                    BR   @14
*
*        THE SPECIAL FLAG TO IDENTIFY THE SUBSYSTEM NAME
*
         REP   04D2 7E7E           EQUAL    DC   C'=='
*
*        THE SPECIAL KEYWORD USED TO SPECIFY THE SUBSYSTEM FOR STCS
*
         REP   04D8 6BE2,E4C2,7E   SSKEY    DC   C',SUB='
*
*        BLANKS FOR CLEARING THINGS
*
         REP   04E0 4040,4040      BLANK    DC   CL9' '
         REP   04E4 4040,4040,40            "
*
*        SET UP FOR SCAN OF JCL (EXCEPT JOB STATEMENT)
*
         REP   04F0 18E4           SSEQSCAN LR   @14,JCLPTR
*
*        PICK UP NEXT JCL STATEMENT POINTER
*
         REP   04F2 58E0,E000      SSJCLLP  L    @14,NEXTJCLS
         REP   04F6 12EE                    LTR  @14,@14
         REP   04F8 4780,C0B4               BZ   @RC00055/61
*
*        SET SCAN LIMITS ON THE JCL STATEMENT
*
         REP   04FC 41F0,E00C               LA   @15,THEJCL+4
         REP   0500 4100,E048               LA   @0,THEJCL+64
*
*        SCAN FOR ",SUB=" KEYWORD ON JCL STATEMENT
*
         REP   0504 D504,C4B6,F000 SSSCANLP CLC  SSKEY,0(@15)
         REP   050A 4780,C4FA               BE   SSFOUND
         REP   050E 41F0,F001               LA   @15,1(,@15)
         REP   0512 19F0                    CR   @15,@0
         REP   0514 4740,C4E2               BL   SSSCANLP
         REP   0518 47F0,C4D0               B    SSJCLLP
*
*        ",SUB=" KEYWORD PARAMETER FOUND - SET UP JCL AREAS
*
         REP   051C D201,4050,C4B0 SSFOUND  MVC  THEJCL+72(2),EQUAL
         REP   0522 D203,4052,C4BE          MVC  THEJCL+74(4),BLANK
         REP   0528 D201,4056,C4B0          MVC  THEJCL+78(2),EQUAL
         REP   052E D208,E04F,C4BE          MVC  THEJCL+71(9),BLANK
*
*        SET UP FOR EXTRACT OF THE SUBSYSTEM NAME
*
         REP   0534 180F                    LR   @0,@15
         REP   0536 41F0,F005               LA   @15,5(,@15)
         REP   053A 4170,4052               LA   @7,THEJCL+74
*
*        MOVE SUBSYSTEM NAME ONE CHARACTER AT A TIME
*
         REP   053E D200,7000,F000 SSMOVE   MVC  0(1,@7),0(@15)
         REP   0544 41F0,F001               LA   @15,1(,@15)
         REP   0548 4170,7001               LA   @7,1(,@7)
*
*        LOOK FOR END OF SUBSYSTEM NAME
*
         REP   054C 957E,7000               CLI  0(@7),C'='
         REP   0550 4780,C542               BE   SSEND
         REP   0554 9540,F000               CLI  0(@15),C' '
         REP   0558 4780,C542               BE   SSEND
         REP   055C 956B,F000               CLI  0(@15),C','
         REP   0560 4770,C51C               BNE  SSMOVE
*
*        SHIFT AND BLANK OUT ",SUB=XXXX" PARAMETER
*
         REP   0564 41E0,E057      SSEND    LA   @14,THEJCL+79
         REP   0568 1BEF                    SR   @14,@15
         REP   056A 1870                    LR   @7,@0
         REP   056C 44E0,C552               EX   @14,SHIFTJCL
*
*        RETURN TO MAINLINE CODE
*
         REP   0570 47F0,C0B4               B    @RC00055/61
*
*        EXECUTED INSTRUCTION TO OVERLAY ",SUB=XXXX" PARAMETER
*
         REP   0574 D200,7000,F000 SHIFTJCL MVC  0(*-*,@7),0(@15)
*
         IDRDATA #Z88005
++ USERMOD (#Z88105) .
++ VER   (Z038)     FMID (JBB1329)
                    SUP (#Z88005) .
++ IF    (HBB2102)  THEN
                    REQ (#Z88205) .
++ IF    (JBB2110)  THEN
                    REQ (#Z88305)
         /*

         THE PURPOSE OF THIS MODIFICATION IS TO PROVIDE THE
         ABILITY TO HAVE TSO USERS LOG ONTO A SECONDARY JOB
         ENTRY SUBSYSTEM.  IBM HAS ALREADY PROVIDED THE ABILITY
         TO DIRECT STARTED TASKS TO A SECONDARY SUBSYSTEM.

         IN ORDER TO LOG ONTO A SECONDARY JES, THREE THINGS
         MUST BE MODIFIED ON BEHALF OF THE TSU, ONE PERMANENTY
         AND TWO TEMPORARILY.  THE PERMANENT CHANGE IS TO THE
         NAME OF THE SUBSYSTEM IN THE LIFE-OF-JOB SSIB FOR THE
         REQUESTING TIME SHARING USER.  THE TEMPORARY CHANGES
         ARE TO THE MASTER SCHEDULER'S INTERNAL READER JFCB AND
         DSAB AND ARE ALREADY MODIFIED BY THIS MODULE AS
         SUPPLIED BY IBM.

         THE PROTOCOL THAT THIS MODIFICATION USES TO DETECT A
         REQUEST FOR A SECONDARY SUBSYSTEM IS "==XXXX==" IN
         COLUMNS 73-80 OF THE TSU JOB STATEMENT.
         "XXXX" IS THE NAME OF THE REQUESTED SUBSYSTEM.  NO
         CHECK IS MADE TO SEE THAT IT IS A VALID AND ACTIVE
         SUBSYSTEM.

         IT IS THE INSTALLATION'S RESPONSIBILITY TO PLACE THE
         "==XXXX==" IN 73-80 OF THE FIRST JCL STATEMENT OF THE
         TSU JCL.  THE EASIEST WAY TO PLACE THIS PARAMETER ON
         THE JOB STATEMENT OF THE TIME SHARING USER'S JCL IS
         TO GENERATE THE LOGON JCL IN THE LOGON PRE-PROMPT
         EXIT (IKJEFLD).

         THE CHANGES TO THE JFCB AND DSAB ARE MADE AFTER IEFJSWT
         ENQUEUES ON EITHER STCQUE OR TSOQUE.  THIS PROVIDES
         PROPER SERIALIZATION OF THE CONTROL BLOCK CHANGES
         BEING MADE.  HOWEVER, THIS SERIALIZATION IS SYSTEM-WIDE.
         THIS MEANS THAT IF, FOR ANY REASON, IEFJSWT CANNOT
         FINISH SUBMITTING THE STC OR TSU ON THE INTERNAL READER,
         NO OTHER STC OR TSU JOBS MAY BE STARTED ON ANY SUBSYSTEM
         (EITHER PRIMARY OR SECONDARY).  THE PERFECT EXAMPLE OF
         THIS IS THAT A TSU BEING LOGGED ONTO A SECONDARY JES
         ENCOUNTERS A JOB QUEUE FULL CONDITION.  SINCE THE ENQUEUE
         ON TSOQUE IS HELD BY THE SUBMITTING ADDRESS SPACE,
         NO TSU'S CAN LOG ONTO THE PRIMARY JES.  NOTE THAT
         TSU'S AND STC'S HAVE SEPARATE ENQUEUE NAMES AND HANGING
         ONE UP WILL NOT HANG THE OTHER (UNLESS IT ENCOUNTERS
         THE SAME CONDITION THAT HUNG THE OTHER).

         LOGIC OF THIS MODIFICATION

         AT THE POINT WHERE THE TSU ENQUEUE PARAMETER LIST HAS BEEN
         BUILD, INSTEAD OF BRANCHING TO THE ENQUEUE, A BRANCH TO
         THE PATCH AREA IS MADE.  COLUMNS 73-74 AND 79-80 OF THE
         FIRST JCL STATEMENT IS CHECKED FOR "==".  IF THEY ARE NOT
         NOT "==", THEN THE ENQUEUE IS BRANCHED TO.  IF THE "=="
         HAS BEEN FOUND, COLUMNS 75-78 OF THIS FIRST JCL STATEMENT
         IS MOVED TO THE SUBSYSTEM NAME IN THE LIFE-OF-JOB SSIB,
         AND A BRANCH TO THE ENQUEUE IS PERFORMED.

         NO VALIDITY CHECK WHATSOEVER IS DONE ON THE SUBSYSTEM NAME.
         IF IT IS NOT A VALID SUBSYSTEM, THE TIME SHARING USER
         WILL DISAPPEAR AND NO INDICATION OF AN ERROR WILL
         BE GIVEN.  THE LOGON PRE-PROMPT EXIT (OR WHATEVER SET
         THE SUBSYSTEM NAME) SHOULD VALIDITY CHECK THE SPECIFIED
         SUBSYSTEM TO INSURE THAT IT IS AN ACTIVE SUBSYSTEM THAT
         SUPPORTS THE JOB SELECT FUNCTION.

         THIS MODIFICATION IS DISTRIBUTED WITH THE USUAL CAVEATS.

                                                                   */ .
++ ZAP   (IEFJSWT)  DISTLIB (AOSB3) .
         NAME  IEFJSWT
*
*        VERIFY BASE REGISTER (BASE REGISTER IS R12, VALUE X'0020')
*
         VER   001E 05C0                    BALR @12,0 (BASE REG)
*
*        CODE OVERLAID FOR SETTING THE SUBSYSTEM NAME IN THE SSIB
*
         VER   0074 47F0,C0B6               B    @RC00090
*
*        VERIFY PATCH AREA
*
         VER   02F2 D7C1,E3C3,C840,C1D9     PATCH AREA IDENTIFICATION
*
         VER   030E C2EE,C2F0,C2F2,C2F4     START OF NEEDED PATCH AREA
         VER   032E C30E,C310,C312,C314     END OF NEEDED PATCH AREA
*
*        BRANCH TO CHECK FOR A SECONDARY SUBSYSTEM LOGON
*
         REP   0074 47F0,C2EE               B    @PSPACE
*
*        CHECK FOR THE "==" IN 73-74 AND 79-80
*
         REP   030E D501,9050,C314          CLC  THEJCL+72(2),EQUAL
         REP   0314 4770,C0B6               BNE  @RC00090
         REP   0318 D501,9056,C314          CLC  THEJCL+78(2),EQUAL
         REP   031E 4770,C0B6               BNE  @RC00090
*
*        UPDATE THE SSIB TO CONTAIN THE SECONDARY SUBSYSTEM NAME
*
         REP   0322 58F0,4008               L    @15,SSOBPTR(,PARMPTR)
         REP   0326 58F0,F008               L    @15,SSOBSSIB
         REP   032A D203,F008,9052          MVC  SSIBSSNM,THEJCL+74
         REP   0330 47F0,C0B6               B    @RC00090
*
*        THE SPECIAL FLAG TO IDENTIFY THE SUBSYSTEM NAME
*
         REP   0334 7E7E           EQUAL    DC   C'=='
*
         IDRDATA #Z88105
++ USERMOD (#Z88205) .
++ VER   (Z038)     FMID (HBB2102)
                    SUP  (#Z88005 #Z88105) .
++ IF    (JBB2110)  THEN
                    REQ (#Z88305)
         /*

         THE PURPOSE OF THIS MODIFICATION IS TO PROVIDE THE
         ABILITY TO HAVE TSO USERS LOG ONTO A SECONDARY JOB
         ENTRY SUBSYSTEM.  IBM HAS ALREADY PROVIDED THE ABILITY
         TO DIRECT STARTED TASKS TO A SECONDARY SUBSYSTEM.

         IN ORDER TO LOG ONTO A SECONDARY JES, THREE THINGS
         MUST BE MODIFIED ON BEHALF OF THE TSU, ONE PERMANENTY
         AND TWO TEMPORARILY.  THE PERMANENT CHANGE IS TO THE
         NAME OF THE SUBSYSTEM IN THE LIFE-OF-JOB SSIB FOR THE
         REQUESTING TIME SHARING USER.  THE TEMPORARY CHANGES
         ARE TO THE MASTER SCHEDULER'S INTERNAL READER JFCB AND
         DSAB AND ARE ALREADY MODIFIED BY THIS MODULE AS
         SUPPLIED BY IBM.

         THE PROTOCOL THAT THIS MODIFICATION USES TO DETECT A
         REQUEST FOR A SECONDARY SUBSYSTEM IS "==XXXX==" IN
         COLUMNS 73-80 OF THE TSU JOB STATEMENT.
         "XXXX" IS THE NAME OF THE REQUESTED SUBSYSTEM.  NO
         CHECK IS MADE TO SEE THAT IT IS A VALID AND ACTIVE
         SUBSYSTEM.

         IT IS THE INSTALLATION'S RESPONSIBILITY TO PLACE THE
         "==XXXX==" IN 73-80 OF THE FIRST JCL STATEMENT OF THE
         TSU JCL.  THE EASIEST WAY TO PLACE THIS PARAMETER ON
         THE JOB STATEMENT OF THE TIME SHARING USER'S JCL IS
         TO GENERATE THE LOGON JCL IN THE LOGON PRE-PROMPT
         EXIT (IKJEFLD).

         THE CHANGES TO THE JFCB AND DSAB ARE MADE AFTER IEFJSWT
         ENQUEUES ON EITHER STCQUE OR TSOQUE.  THIS PROVIDES
         PROPER SERIALIZATION OF THE CONTROL BLOCK CHANGES
         BEING MADE.  HOWEVER, THIS SERIALIZATION IS SYSTEM-WIDE.
         THIS MEANS THAT IF, FOR ANY REASON, IEFJSWT CANNOT
         FINISH SUBMITTING THE STC OR TSU ON THE INTERNAL READER,
         NO OTHER STC OR TSU JOBS MAY BE STARTED ON ANY SUBSYSTEM
         (EITHER PRIMARY OR SECONDARY).  THE PERFECT EXAMPLE OF
         THIS IS THAT A TSU BEING LOGGED ONTO A SECONDARY JES
         ENCOUNTERS A JOB QUEUE FULL CONDITION.  SINCE THE ENQUEUE
         ON TSOQUE IS HELD BY THE SUBMITTING ADDRESS SPACE,
         NO TSU'S CAN LOG ONTO THE PRIMARY JES.  NOTE THAT
         TSU'S AND STC'S HAVE SEPARATE ENQUEUE NAMES AND HANGING
         ONE UP WILL NOT HANG THE OTHER (UNLESS IT ENCOUNTERS
         THE SAME CONDITION THAT HUNG THE OTHER).

         LOGIC OF THIS MODIFICATION

         AT THE POINT WHERE THE TSU ENQUEUE PARAMETER LIST HAS BEEN
         BUILD, INSTEAD OF BRANCHING TO THE ENQUEUE, A BRANCH TO
         THE PATCH AREA IS MADE.  COLUMNS 73-74 AND 79-80 OF THE
         FIRST JCL STATEMENT IS CHECKED FOR "==".  IF THEY ARE NOT
         NOT "==", THEN THE ENQUEUE IS BRANCHED TO.  IF THE "=="
         HAS BEEN FOUND, COLUMNS 75-78 OF THIS FIRST JCL STATEMENT
         IS MOVED TO THE SUBSYSTEM NAME IN THE LIFE-OF-JOB SSIB,
         AND A BRANCH TO THE ENQUEUE IS PERFORMED.

         NO VALIDITY CHECK WHATSOEVER IS DONE ON THE SUBSYSTEM NAME.
         IF IT IS NOT A VALID SUBSYSTEM, THE TIME SHARING USER
         WILL DISAPPEAR AND NO INDICATION OF AN ERROR WILL
         BE GIVEN.  THE LOGON PRE-PROMPT EXIT (OR WHATEVER SET
         THE SUBSYSTEM NAME) SHOULD VALIDITY CHECK THE SPECIFIED
         SUBSYSTEM TO INSURE THAT IT IS AN ACTIVE SUBSYSTEM THAT
         SUPPORTS THE JOB SELECT FUNCTION.

         THIS MODIFICATION IS DISTRIBUTED WITH THE USUAL CAVEATS.

                                                                   */ .
++ ZAP   (IEFJSWT)  DISTLIB (AOSB3) .
         NAME  IEFJSWT
*
*        VERIFY BASE REGISTER (BASE REGISTER IS R12, VALUE X'0020')
*
         VER   001E 05C0                    BALR @12,0 (BASE REG)
*
*        CODE OVERLAID FOR SETTING THE SUBSYSTEM NAME IN THE SSIB
*
         VER   008A 47F0,C0D4               B    @RC00089
*
*        VERIFY PATCH AREA
*
         VER   0360 D7C1,E3C3,C840,C1D9     PATCH AREA IDENTIFICATION
*
         VER   037C C35C,C35E,C360,C362     START OF NEEDED PATCH AREA
         VER   039C C37C,C37E,C380,C382     END OF NEEDED PATCH AREA
*
*        BRANCH TO CHECK FOR A SECONDARY SUBSYSTEM LOGON
*
         REP   008A 47F0,C35C               B    @PSPACE
*
*        CHECK FOR THE "==" IN 73-74 AND 79-80
*
         REP   037C D501,9050,C382          CLC  THEJCL+72(2),EQUAL
         REP   0382 4770,C0D4               BNE  @RC00089
         REP   0386 D501,9056,C382          CLC  THEJCL+78(2),EQUAL
         REP   038C 4770,C0D4               BNE  @RC00089
*
*        UPDATE THE SSIB TO CONTAIN THE SECONDARY SUBSYSTEM NAME
*
         REP   0390 58F0,4008               L    @15,SSOBPTR(,PARMPTR)
         REP   0394 58F0,F008               L    @15,SSOBSSIB
         REP   0398 D203,F008,9052          MVC  SSIBSSNM,THEJCL+74
         REP   039E 47F0,C0D4               B    @RC00089
*
*        THE SPECIAL FLAG TO IDENTIFY THE SUBSYSTEM NAME
*
         REP   03A2 7E7E           EQUAL    DC   C'=='
*
         IDRDATA #Z88205
++ USERMOD (#Z88305) .
++ VER   (Z038)     FMID (JBB2110)
                    SUP  (#Z88005 #Z88105 #Z88205)
         /*

         THE PURPOSE OF THIS MODIFICATION IS TO PROVIDE THE
         ABILITY TO HAVE TSO USERS LOG ONTO A SECONDARY JOB
         ENTRY SUBSYSTEM.  IBM HAS ALREADY PROVIDED THE ABILITY
         TO DIRECT STARTED TASKS TO A SECONDARY SUBSYSTEM.

         IN ORDER TO LOG ONTO A SECONDARY JES, THREE THINGS
         MUST BE MODIFIED ON BEHALF OF THE TSU, ONE PERMANENTY
         AND TWO TEMPORARILY.  THE PERMANENT CHANGE IS TO THE
         NAME OF THE SUBSYSTEM IN THE LIFE-OF-JOB SSIB FOR THE
         REQUESTING TIME SHARING USER.  THE TEMPORARY CHANGES
         ARE TO THE MASTER SCHEDULER'S INTERNAL READER JFCB AND
         DSAB AND ARE ALREADY MODIFIED BY THIS MODULE AS
         SUPPLIED BY IBM.

         THE PROTOCOL THAT THIS MODIFICATION USES TO DETECT A
         REQUEST FOR A SECONDARY SUBSYSTEM IS "==XXXX==" IN
         COLUMNS 73-80 OF THE TSU JOB STATEMENT.
         "XXXX" IS THE NAME OF THE REQUESTED SUBSYSTEM.  NO
         CHECK IS MADE TO SEE THAT IT IS A VALID AND ACTIVE
         SUBSYSTEM.

         IT IS THE INSTALLATION'S RESPONSIBILITY TO PLACE THE
         "==XXXX==" IN 73-80 OF THE FIRST JCL STATEMENT OF THE
         TSU JCL.  THE EASIEST WAY TO PLACE THIS PARAMETER ON
         THE JOB STATEMENT OF THE TIME SHARING USER'S JCL IS
         TO GENERATE THE LOGON JCL IN THE LOGON PRE-PROMPT
         EXIT (IKJEFLD).

         THE CHANGES TO THE JFCB AND DSAB ARE MADE AFTER IEFJSWT
         ENQUEUES ON EITHER STCQUE OR TSOQUE.  THIS PROVIDES
         PROPER SERIALIZATION OF THE CONTROL BLOCK CHANGES
         BEING MADE.  HOWEVER, THIS SERIALIZATION IS SYSTEM-WIDE.
         THIS MEANS THAT IF, FOR ANY REASON, IEFJSWT CANNOT
         FINISH SUBMITTING THE STC OR TSU ON THE INTERNAL READER,
         NO OTHER STC OR TSU JOBS MAY BE STARTED ON ANY SUBSYSTEM
         (EITHER PRIMARY OR SECONDARY).  THE PERFECT EXAMPLE OF
         THIS IS THAT A TSU BEING LOGGED ONTO A SECONDARY JES
         ENCOUNTERS A JOB QUEUE FULL CONDITION.  SINCE THE ENQUEUE
         ON TSOQUE IS HELD BY THE SUBMITTING ADDRESS SPACE,
         NO TSU'S CAN LOG ONTO THE PRIMARY JES.  NOTE THAT
         TSU'S AND STC'S HAVE SEPARATE ENQUEUE NAMES AND HANGING
         ONE UP WILL NOT HANG THE OTHER (UNLESS IT ENCOUNTERS
         THE SAME CONDITION THAT HUNG THE OTHER).

         LOGIC OF THIS MODIFICATION

         AT THE POINT WHERE THE TSU ENQUEUE PARAMETER LIST HAS BEEN
         BUILD, INSTEAD OF BRANCHING TO THE ENQUEUE, A BRANCH TO
         THE PATCH AREA IS MADE.  COLUMNS 73-74 AND 79-80 OF THE
         FIRST JCL STATEMENT IS CHECKED FOR "==".  IF THEY ARE NOT
         NOT "==", THEN THE ENQUEUE IS BRANCHED TO.  IF THE "=="
         HAS BEEN FOUND, COLUMNS 75-78 OF THIS FIRST JCL STATEMENT
         IS MOVED TO THE SUBSYSTEM NAME IN THE LIFE-OF-JOB SSIB,
         AND A BRANCH TO THE ENQUEUE IS PERFORMED.

         NO VALIDITY CHECK WHATSOEVER IS DONE ON THE SUBSYSTEM NAME.
         IF IT IS NOT A VALID SUBSYSTEM, THE TIME SHARING USER
         WILL DISAPPEAR AND NO INDICATION OF AN ERROR WILL
         BE GIVEN.  THE LOGON PRE-PROMPT EXIT (OR WHATEVER SET
         THE SUBSYSTEM NAME) SHOULD VALIDITY CHECK THE SPECIFIED
         SUBSYSTEM TO INSURE THAT IT IS AN ACTIVE SUBSYSTEM THAT
         SUPPORTS THE JOB SELECT FUNCTION.

         THIS MODIFICATION IS DISTRIBUTED WITH THE USUAL CAVEATS.

                                                                   */ .
++ ZAP   (IEFJSWT)  DISTLIB (AOSB3) .
         NAME  IEFJSWT
*
*        VERIFY BASE REGISTER (BASE REGISTER IS R12, VALUE X'0020')
*
         VER   001E 05C0                    BALR @12,0 (BASE REG)
*
*        CODE OVERLAID FOR SETTING THE SUBSYSTEM NAME IN THE SSIB
*
         VER   008A 47F0,C0D4               B    @RC00089
*
*        VERIFY PATCH AREA
*
         VER   035C D7C1,E3C3,C840,C1D9     PATCH AREA IDENTIFICATION
*
         VER   0378 C358,C35A,C35C,C35E     START OF NEEDED PATCH AREA
         VER   0398 C378,C37A,C37C,C37E     END OF NEEDED PATCH AREA
*
*        BRANCH TO CHECK FOR A SECONDARY SUBSYSTEM LOGON
*
         REP   008A 47F0,C358               B    @PSPACE
*
*        CHECK FOR THE "==" IN 73-74 AND 79-80
*
         REP   0378 D501,9050,C37E          CLC  THEJCL+72(2),EQUAL
         REP   037E 4770,C0D4               BNE  @RC00089
         REP   0382 D501,9056,C37E          CLC  THEJCL+78(2),EQUAL
         REP   0388 4770,C0D4               BNE  @RC00089
*
*        UPDATE THE SSIB TO CONTAIN THE SECONDARY SUBSYSTEM NAME
*
         REP   038C 58F0,4008               L    @15,SSOBPTR(,PARMPTR)
         REP   0390 58F0,F008               L    @15,SSOBSSIB
         REP   0394 D203,F008,9052          MVC  SSIBSSNM,THEJCL+74
         REP   039A 47F0,C0D4               B    @RC00089
*
*        THE SPECIAL FLAG TO IDENTIFY THE SUBSYSTEM NAME
*
         REP   039E 7E7E           EQUAL    DC   C'=='
*
         IDRDATA #Z88205

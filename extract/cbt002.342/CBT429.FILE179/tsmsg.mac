**UCLA** APRIL 1979                     ALSO MVSUSER JUNE 1977
         MACRO
&LABEL   TSMSG &ID,&TYPE=,&CSECT=,&MF=E,&TABLE=
         LCLA  &I
         LCLB  &INFO,&HEX,&WTO,&REV
&LABEL   DS    0H
         AIF   (T'&ID EQ 'O').L5        IF ID PARAMETER OMMITTED  .L5
         AIF   ('&ID'(1,1) EQ '(').IDREG ID IN REGISTER NOTATION .IDREG
         AIF   ('&ID'(1,1) EQ '''').IDQUOTE  QUOTED STRING ?
         MVC   MPLMSGID(4),=CL4'&ID'    SET 4 BYTE MESSAGE ID
         AGO   .L5
.IDREG   ANOP                           ID WAS IN REGISTER NOTATION
         MVC   MPLMSGID(4),0&ID         SET 4 BYTE MESSAGE ID
         AGO   .L5
.IDQUOTE ANOP
         MVC   MPLMSGID(4),=CL4&ID      SET 4 BYTE MESSAGE ID
.L5      ANOP
         AIF   (T'&TYPE EQ 'O').NOTYPE    IF NO TYPE  PARM THEN .NOTYPE
&I       SETA  0                        INITIALIZE I TO 0
&INFO    SETB  0                        DEFAULT TO NOINFO (=PROMPT)
&HEX     SETB  0                        DEFAULT TO NOHEX
&WTO     SETB  0                        DEFAULT TO NOWTO
&REV     SETB  0                        DEFAULT TO NOREV
.NEXTYPE ANOP
&I       SETA  &I+1                     INCREMENT I
         AIF   ('&TYPE(&I)' EQ '').TYPEND  ANY MORE TYPES?
         AIF   ('&TYPE(&I)' EQ 'INFO').INFO
         AIF   ('&TYPE(&I)' EQ 'HEX' ).HEX
         AIF   ('&TYPE(&I)' EQ 'WTO' ).WTO
         AIF   ('&TYPE(&I)' EQ 'REV' ).REV
         AIF   ('&TYPE(&I)' EQ 'PROMPT').NEXTYPE  DO NOTHING FOR NOTYPE
         AIF   ('&TYPE(&I)' EQ 'NOINFO').NEXTYPE  DO NOTHING FOR NOTYPE
         AIF   ('&TYPE(&I)' EQ 'NOHEX' ).NEXTYPE  DO NOTHING FOR NOTYPE
         AIF   ('&TYPE(&I)' EQ 'NOWTO' ).NEXTYPE  DO NOTHING FOR NOTYPE
         AIF   ('&TYPE(&I)' EQ 'NOREV' ).NEXTYPE  DO NOTHING FOR NOTYPE
         MNOTE 4,'UNKNOWN TYPE = &TYPE(&I) IGNORED'
         AGO   .NEXTYPE                 LOOK AT NEXT TYPE PARAMETER
.INFO    ANOP
&INFO    SETB  1                        INFORMATION MESSAGE BIT ON
         AGO   .NEXTYPE
.HEX     ANOP
&HEX     SETB  1                        HEX CONVERSION BIT ON
         AGO   .NEXTYPE
.WTO     ANOP
&WTO     SETB  1                        WRITE TO OPERATOR BIT ON
         AGO   .NEXTYPE
.REV     ANOP
&REV     SETB  1                        MESSAGE REVERSAL BIT ON
         AGO   .NEXTYPE
.TYPEND  ANOP
&I       SETA  128*&INFO+64*&REV+32*&WTO+16*&HEX SET FLAG VALUE
         MVI   MPLSW,&I                 SET MESSAGE OPTIONS BITS
.NOTYPE  ANOP
         AIF   (T'&CSECT EQ 'O').NOCSECT IF NO CSECT PARM THEN .NOCSECT
         AIF   (T'&TABLE EQ 'O').NOTBOTH BOTH CANNOT BE SPECIFIED
   MNOTE 4,'CSECT AND TABLE ARE MUTUALLY EXCLUSIVE.  CSECT IS ASSUMED.'
.NOTBOTH AIF   ('&CSECT'(1,1) EQ '(').CSREG  CSECT IN REGISTER NOTATION
         MVC   MPLCSECT(4),=V(&CSECT)   SET ADRS OF MESSAGE CSECT
         AGO   .L8
.CSREG   ST    &CSECT,MPLCSECT          SET ADRS OF MESSAGE CSECT
         AGO   .L8
.NOCSECT ANOP
         AIF   (T'&TABLE EQ 'O').NOTABLE IF NO TABLE PARM THEN .NOTABLE
         AIF   ('&TABLE'(1,1) EQ '(').TAREG  TABLE IN REGISTER NOTATION
         MVC   MPLCSECT(4),=A(&TABLE)   SET ADRS OF MESSAGE CSECT
         AGO   .L8
.TAREG   ST    &TABLE,MPLCSECT          SET ADRS OF MESSAGE CSECT
         AGO   .L8
.NOTABLE ANOP
.L8      ANOP
         AIF   ('&MF' EQ 'L').END       &MF=L MEANS LIST
         LA    1,MPL                    ADRS OF MESSAGE PARAMETER LIST
         LINK  EP=IKJEFF02              LOAD MESSAGE PROCESSING ROUTINE
         SPACE
* RETURN       IN REGISTER 15 IS FROM PUTLINE OR PUTGET OR
* CODES        0 IF WTO WAS REQUESTED.
         SPACE
.END     MEND

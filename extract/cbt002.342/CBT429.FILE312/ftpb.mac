*\INMR01
0
_
 





C    
Q

     /* this rexx exec is expected to be invoked by the EXEC command
        thus:
        EXec 'dsname(FTPBREC)'
          and it will then issue the TSO RECEIVE command for the
          EXEC and PANELS members to create 2 new datasets:
          userid.FTPB.NEW.EXEC and
          useÿ
            You will then need to copy these datasets/members into
            datasets for production use.
            */              ÿ

           parse source with x1 x2 x3 dsn .
            x = PROMPT("ON") /* enable promÿ
             queue "dsn(ftpb.new.exec)"
             "Receive inds('"dsn"(exec)')"
             queue "dsn(ftpb.new.panels)"                 `
               "Receive inds('"dsn"(panels)')"
       

                                 This application is distributed in a PD
he primary members (EXEC         aÿ
o use this dialog you              need to issue TSO EXEC 'restored.dsna
EC)' which will convert            the EXEC and PANELS members into an E
ary and a PANELS library           from which youÿ
asets.                               There will be 4 members:

                                        $DOC     -  What you areÿ
                                          EXEC     -  The REXX Execs in
smit format.                              FTPBREC  -  used to receive me
EC and PANELS into                                    partitioned datase

ransmit format.
                                         After creating the installation
t:            ÿ
                                           1.  Process members EXEC and
sing the FTPBREC exec as described             above.
                             ÿ
                                             2.  Copy FTPB.PANELS into a
anel library in your ISPPLIB concatenation.
                                            ÿ
 in your SYSPROC or SYSEXEC concatenation.
                                                   These REXX procedures
tten to be installed in a library that is          DCB=(RECÿ
one that is DCB=(RECFM=VB,LRECL=255) to              support the format
SYSEXEC or SYSPROC libraries.
                                                 4.  Edit the FTPBCUST e
d make make any updates as required for your           installation.

                                                       - Panel FTPBHF2 n
be updateÿ
                                                     5.  Test by enterin
he ISPF Command line:  TSO %FTPB
                        ÿ
estions can be directed to (please mention the         release of the co
re using):
                                       +
ce dsname of "egg" and see what happeÿ
                                                              Lionel B.
                                                              Internet:
b.dyck@ncal.kaiperm.org                             ÿ
                                                             Introductio
c.
                                                                   ÿ
 The File Transfer Protocol Batch ISPF Dialog
       by Lionel B. Dyck

  ÿ
g provides a simple to use ISPF interface for using the          TCP/IP
tion to transfer data sets from the current MVS host             system
 host systems thaÿ
t Unix, ...).
                                                                   The d
esent the user with a simple ISPÿ
 source (original) data set, the target host, optionally the         nam
 target data set if it is different from the source, and             sig
rmation (userid and password).  Once this inforÿ
the dialog generates the necessary JCL and FTP statements to           a
 user to execute the FTP in the foreground (execpt for load            l
ransfers) or to submit the JCL for a batch execution of FTP.  ÿ
o submission the user is allowed to review and change (edit) the
ed JCL and FTP control statements if they desire.

troduced with 1.100 level of the code is the ability to setup an FTP
 to 10 hostnames.  Each must be the same type (e.g. MVS) and use the
userid and password.  Any changes made in the submit portion of the
g using Editÿ
tname.  This capability is activated by entering a target hostname of
'*'.  Also introduced with this level is the ability to bring up a
ection list of prior used hÿ
ield.

he JCL will be submitted using an FTP servÿ
 minutes (as defined by the FTP.DATA used by the installation) and if th
 JOB ends within 10 minutes the sysout will be retrieved and printed in
 the FTPPRINT generated step.  The PRINT job step will pr+
   to the //REPORT DD and will process the data to geneÿ
     equal to the max return code for the remote job.

     For partitioned data sets the dialog provides member selection ifÿ
       member is not specified as part of the source data set name.  Two
       options are provided for the transfer of a PDS.  One option is to
       the data set using IEBCOPY and to transfer that sequential data s
     ÿ
e        other option is to not unload in which case the dialog processe
er       at a time.
                    ÿ
           For VSAM and DA data sets the dialog will prompt to ask if th
           data set should be Replaced or not on the restore.  The trans
           occur in batch using genÿ
uses         IBM's DFSMSdss (PGM=ADRDSSU) to DUMP the data set (using th
             option) and then the restore JCL and the dump'd data set ar
to           the target host.  Once these FTP's arÿ
ted to         the target system for processing where ADRDSSU will be us
STORE          the data set.  The batch process is the same as described
or load        library transfers except that ADRDSSU is used instÿ
Y.
                 Also supported are pattern dsnames which will then cons
 set             of data sets dump'd and restore'd using ADRDSSU.
ÿ
                   Known Problems/Challenges:

               ÿ
                           updated but if you have these problems you ca
ent                        the code to return these restrictions.
                              ÿ
                       1.  There exists a problem when using FTP to tran
d modules                  caused by the inability of FTP to correctly t
the directory              information for thÿ
r this is to                 use IEBCOPY to unload the load library into
ntial data set               and then transfer that with a reload using
at the target                site.                          ÿ

                           2.  The FTP of an IEBCOPY UNLOAD'd PDS where
inal PDS had a                 BLKSIZE of 32753 or greater results in a
et that FTP is                   unable to successfully transfer.  The d
will detect this and               present the user with a warning panel
 perform the                       transfer.  The data set must be reblo
or to the IEBCOPY                  UNLOAD.
        ÿ
                                     ** This has been fixed (YES) but yo
ave the maintenance to                  support VBS dataset transfers.
                       ÿ
                                   3.  The submitted JOB's SYSOUT will r
 the remote executiion                 site in the SPOOL until the SPOOL
 removes it as it is                  ÿ
to be held so that it can                be retrieved by the FTP GET (wh
ype=jes is used) and thus                included in the originating JOB
.                                                    ÿ
                                       4.  The FTP of a RECFM=VBS datase
ot work directly until IBM                 fixes the FTP Client (target
OS/390 2.5 release maybe).                 This transfer will use DFÿ
t as VSAM for now.
                                             ** This has been fixed (YES
u must have the maintenance to                  support VBS dataset tran
   ÿ
                                           5.  When using DFSMSdss to du
estore a PDSE the target may not               restore if PDSE is not en
d you will need toÿ
 syntax) in the restore.
                                             Product Components
                                 ÿ
                                               The product consists of t
wing elements:
                                                ÿ

                                                     FTPB             Pr
PF Panel called by FTPB                              FTPBEXEC  ÿ
 panel displayed for online FTP executions             FTPBGS
xec ISPF Menu for non-unload transfers                 FTPBGSU
SPF Menu for unload transfers                          FTPBGSUP
ation on submitted job if reload used                    FTPBHF*
ield level tutorial panels                               FTPBHFx
level help                                               FTPBH0
utorial Panel+
 Tutorial Pÿ
PF Tutorial Panel for FTPBGSU                                FTPBM
PF member selection Panel                                    FTPBSHST
st selection panel        ÿ
Transfer Prompting when using DFSMSdss                         FTPBPPDS
PDS Transfer Prompting                                         FTPBPRCL
Prompt to recall for himgrated datasets  ÿ
  Panel display of target allocation options                     FTPBPWR
  Warning for Unsupported Blksize Transfer  **
                                                        ÿ
 unless you uncomment code in the FTPB exec
is only used if you are running without the
maintenance for vbs support.                                           ÿ
                                                                     Pan
ved:  FTPBHHST, FTPBHOST
                                                                     REX
      ÿ
                                                                       F
         Primary Exec and the starting point for FTPB                  F
         ISPF Edit Maÿ
           ISPF Edit Macro when the END command/key is used
           ISPF Edit Macro when the SAVE command/key is used
2          Exec used to process the ÿ
                                                                       N
 an ISPF Table is built and maintained in Library(ISPPROF)             t
ains the jobcard information for each target node. Ý




OPYÇ





×Î°‰°×
rô
°




--ÿ
     FTPBEM                                             *
                                                        *       ÿ
tion:  Establish ÿ
         when editing the FTP Batch JCL                     *
                                                            *
 ÿ
*                                                               *
* Syntax:    n/a                                                *
*                 ÿ
    * Author:    Lionel B. Dyck                                     *
    *            Kaiser Permanente                                  *
    *            Walnut Creek, CA 9ÿ
        *            (510) 926-5332
        *            IBMMail:  USKFHLBD
        *            Internet: LIONEL.B.DYCK@NCAL.kaÿ
            *            IBMLINK:  SYSLBD
            *
            * History:                                               ÿ
            ÿ
*               *            11/26/96 - creation
*               *
*     ÿ
--- */                   ÿ
                     Address ISREDIT
                         ÿ
                       "MACRO"          ÿ

                         exit_rc = ""     ÿ
                                                       ÿ
                             "RECOVERY ON"
                             "NUMBER OFF"                  ÿ
                               "NULL ON"                              ÿ
                                 "AUTOLIST OFF"
                                 "PACK OFF"
                                   "HEX OFF"
     ÿ
                                     "RESET"
             +
           ÿ
                                           "DEFINE END ALIAS FTPBEME"
                                           "DEFINE SAVE ALIAS FTPBEMS"
                            ÿ
                                                       "'** CAPS have be
n by default but if  **'"                      "LINE_Before 1     = Note
                                             ÿ
the FTP statements then  **'"                      "LINE_Before 1     =
 " ,                                                       "'** you migh
o change to CAPS OFF if  **'"                      "LINE_Befor˜ eÿ
line " ,                                                       "'** the
ite is case sensitive.       **'"                      "CAPS ON"
                                               {
ÿ

     /* ----------------------------------------------------------- */
       /*      ÿ
         /*  This ISPF Edit Macro is used as an Alias for the ISPF EDIT
         /*  'END' command by the FTPB exec.
         /*    ÿ
             /* --------------------------------------------------------
             Address ISREDIT
             "MACRO (PARM) NOPROÿ
                                           ÿ
                   "DEFINE END RESET"     /* reset END back to normal */
                   "DEFINE SAVE RESET  "  /* reset ÿ
                                                          ÿ
                       "(num) = NUM"
                       if num = "ON" then "UNNUM"                   ÿ

                           "SAVE"
                           "END"
     º               
        ÿ
                                                         /* ------------
--------------------------------------- */        ÿ
                       ÿ
Macro is used as an Alias for the ISPF EDIT */               /*  'SAVE'
by the FTPB exec.                           */               /*    ÿ
                                      ÿ
----------------------------------------------- */               Address
                                                                 "MACRO
OPROÿ
                                                                     "DE
 RESET"     /* reset END back to normal */                           "DE
E RESET  "  /* reset ÿ

= NUM"
= "ON" then "UNNUM"                   ÿ
   ÿ
VE"
D"                                                     º               

----------- *               * Name:      FTPBJOB2
            *               *
            *       ÿ
xecuted         *               *            at the remote host and retu
the highest     *               *            return code.
                *               *    ÿ
                    *               * Syntax:    %ftpbjob2
                    *               *
                    *               * Author:   J.O. Sÿ
                        *               *           Southern ÿ
                          *               *           Enterprise System
 PAX 2-7535               *               *           Rosemead GO-2, 626
535                         *               *           robinsjo@sce.com
                              *               *
                              *               * History:
          ÿ
he rptdsn (ÿ
nput dsn a parm (lbd)             *               *            06/22/98
t checks for JCL error (SR)ÿ
ributed by Skip Robinson  ÿ
------------------------------------- */
                                            ÿ
                                         ÿ
then do                                                      say "Error:
me provided - exec terminating"                              ÿ
                                                        ÿ

                                                             if left(rpt
 <> "'" then                                                      rptdsÿ
rptdsn"'"
                                                                 /* ----
-------------- ÿ
eport ÿ
------------------ */                                                 "A
OB2LIST) ds("rptdsn") shr"      ÿ
                     ÿ
---------------------- *
 in job 2              *                         +
------------------------ */         ÿ
EXECIO * DISKR JOB2LIST (Finis STEM J2L.)"

* -------------------------- *                     ÿ
    * Free JOB2LIST              *
    * and delete the rptdsn      *
    * -------------------------- */                               ÿ
   ÿ
       "Delete" rptdsn

 +

              * -------------------------- */
             "EXECIO * DISKW REPORT  ÿ
              ÿ
                 /* -------------------------- *
                  * setup default values       *      ÿ
                    * -------ÿ
                      /* end of sysout marker */
                     end_of_sysout = "!! END OF JES SPOOL FILE !!"     ÿ
                       /* max condition codeÿ
                         cond_max = 0

        ÿ
                              * Find end of sysout record  *
                              * -------------------------- */
                         ÿ
jx) > 0; END
                                 /* -------------------------- *
                                  * JCL Seÿ
         ÿ
                                     jcl_1st = jx + 1
                                                           ÿ
                        ÿ
                                          * Look for abend message     *
                                          * -------------------------- *
                                       ÿ
n Unnnn REASON=nnnnnnnn */                   DO jx = 1 TO jcl_1st UNTIL
450I",j2l.jx) > 0; END /* abend? */          IF jx < jcl_1st THEN cond_m
5 /* abend oc+
             ÿ
 *                                                  * Find max return co
 *                                                  * ---------------ÿ
-- */                         ÿ
                                                         /* IEF452I jobn
OB NOT RUN - JCL ERROR */                                DO jx = 1 TO jc
TIL ÿ
N cond_max = 3333 /* JCL error */                          END
                                                           IF cond_max =
DO                 +
ame - JOB FAILED ÿ
jcl_1st UNTIL POS("IEF453I",j2l.jx) > 0; END /* JCL? */            IF jx
st THEN cond_max = 3333 /* JCL error */                          END
 ÿ
 = 0 THEN DO /* no other problem, get highest cond code */             D
cl_1st TO j2l.0 UNTIL ,
(end_of_sysout,j2lÿ
g_1st = jx + 1 /* job msgs start here */
 = jobmsg_1st TO j2l.0 UNTIL ,
 POS(end_of_sysout,j2l.jx) > 0; ENDÿ
ysprint_1st = jx + 1 /* utility sysprint starts here */
jx = jobmsg_1st TO sysprint_1st /* scan job msgs */
 /* IEF142I jobname step - STEP WAS EXECUTED - COND ÿ
     IF POS("IEF142I",j2l.jx) > 0 THEN DO /* got a step cond code */
       PARSE VAR j2l.jx . " - COND CODE " cond_code .
       IF cond_code > cond_max THEN cond_max = cond_code /* update */ÿ
       END  ÿ
       END
     END
     E¤ XIT cond_max /* thiÿ
 {
                                     Address ISPEXEC
                                     call ÿ
                                ÿ
                                         do i = 1 to credit.0-1
                                            int_credit = ÿ
"                                             intÿ
                                                call listdsi "'sys1.lpal
r"                                              "Control Display Lock"
                                                  "Display panel(fÿ
                                                    end
                                                 i = credit.0
       ÿ
ditÿ
                                                     "Display panel(ftpb
                      ÿ
                    ÿ
                                                         Set_Credits:
                                     +
redti1 credit2 credit3 credit4 ,   ÿ
   credti5 credit6 credit7 credit8                               credit.
A. Thomas"                                                       credit.
c Wolf"                                           ÿ
"Werner Kuehne"                                                      cre
"Ole Knudsen"                                                        cre
"Skip Robinson"                                                  ÿ
6 = "Don Farrar"
7 = "Dave Alcock"
8 = "Mike Theys"
ÿ
urn                                                                
ç
----- *        ÿ
        *               *
        *       ÿ
ISPF      *               *   ÿ
            *               *
            *               *    ÿ
              *               *              ÿ
                *               * Syntax:    %ftpbcust
                *               *                 ÿ
                  *               * Author:    Lionel B. Dycÿ
                    *               *            Kaiser Permanente
                    *               *            Walnut Creek, CA 9ÿ
                      *               *            (925) 926-5332
                        *               *            Internet: lionel.b.
l.kaiperm.org           *               *
    ÿ
          ÿ
 dsn variable               *               *            08/12/99 - add
iable                ÿ
sd from 3390 to work     ÿ
                                *               *
                                *     ÿ
--------------------------------- */    ÿ
                                                    Address ISPEXEC
                                                       ÿ
                                                     /*+
---- *                                               ÿ
       *                                                  * system deter
blksize  *                                                  *   0 = use
         *                                                  *   1 = ÿ
size       *                                                  * --------
---------- ÿ

   ÿ
-------------- *            ÿ
                 *                                                  * Se
vice name        *ÿ
 device name       *                         +
pe device name       *                     ÿ
---------------------- */        ÿ
 = "VIO"
 = "WORK"                                                   ÿ
pe = "3490"                                     ÿ

* -------------------------- *
  * Custom:                    *                               ÿ
    * Set NETRC usage            *
    *     0 = don't use it       *
    *     1 = ÿ
        * -------------------------- */
        netrc = 0
                               ÿ
         /* -ÿ
            * Custom:                    *
            * Set SYSFTPD DD usage       *      ÿ
              *     0 = don'ÿ
                *     1 = use it             *
                * -------------------------- */                  ÿ
                  sysftpd = 0              ÿ

                   /* -------------------------- *
  ÿ
                        * Set SYSFTPDS dsname to     *
                        *  the local site dsname     *
                   ÿ
                            sysftpds = "TCPIP.FTP.DATA"                ÿ

                             /* ------ÿ
                                * Custom:                    *
      ÿ
                                  *     SYSEXEC membersÿ
                                    * Note: I test for 2 diff.   *
                     ÿ
                                      * -------------------------- */
                                        njenode = sysvar('sysnode')
                                    ÿ
                                             execlib = "SYS2.REXX.EXEC"
         +
       ÿ

                                               /* ----------------------
                        ÿ
 *                                                  * Save password in I
 *                                                  * Profile. May viola
 *                                       ÿ
 ÿ
     *                                                  *  1 = save
     *                                                  * ÿ
------ */       ÿ

                                                           /* ----------
-------------------------------ÿ
                                         *                      * Firewa
rt.                                      *                      *   1. A
 we use userÿ
all userid prompt                            *                      *
e this for your site as necessary            *                      *
ith hostname                 ÿ
id by itself                                     *
------------------------------------------------ */
= 0                                           ÿ

------------------------ *
stom:                    *                                     ÿ
Set the flaÿç
            * initial remote jobname to  *
            * be userid plus 1 char.     *
            ÿ
                * Y to force                 *
                * anything else to leave     *
                * -----------ÿ
                     forcejbn = "Y"

                   "Vget (zuser zacctnum)"    ÿ

                       /* -------------------------- *
                        * Custom:                    *         +
                            * setup accounting number    *     ÿ
                              * if ',' then put in ()      *
                              * if '/' then fixup          *
      ÿ
ÿ
                                  Select
                     ÿ
                 ÿ
                                         when pos(' ',zacctnum) > 0 then
                                    ÿ
                                  ÿ
                                                  parse value zacctnum w
/" a2 "/" a3                                      zÿ
                                                   ÿ
                                                 otherwise nop
                                                 end              ÿ
                                                                    ÿ
                                                     /* ----------------
-- *                                                  * Custom:
 ÿ
     ÿ
       *                                                  *     1 = use
       *        ÿ
-------- */           ÿ

                               +
------------ *               ÿ
                 *                                                  * Se
DS dsname to     *                                                  *  t
 site dsname     *                          ÿ
-------------------- */
 = null
                                                           ÿ
 "//"zuser"A  JOB" zacctnum",'FTP JOB',NOTIFY=&SYSUID, "
 "// TIME=15,MSGLEVEL=1,REGION=6M,CLASS=L,MSGCLASS=X"
 "//HOLD OUTPUT JESDS=ALL,DEFAULT=Y,OUTDISP=(HOLD,HOLD)"
            ÿ
 (sdb vio dasd netrc sysftpd njenode execlib savepwd" ,
"FirIDwH forcejbn jc1 jc2 jc3 tape sysftpds" ,
"systcpd ÿ
Address TSO                
p
------------- */        ÿ
                               /* Name:      FTPB
                *       ÿ
                  *               * Funÿ
                    *               *
                    *               * Synÿ
                      *               *               ÿ
                        *               *            where options are:
                        *               *             ANONÿ
                          *               *             BINARY       ÿ
                            *               *             HOST host-name
                            *               *             MVS or NOMVS
                              *               *
    ÿ
                                *               *            Kaiser Perm
            ÿ
94598              ÿ
                                    *               *            Interne
l.b.dyck@kp.org              ÿ
                                  ÿ
                                        *               *
                                        *     ÿ
                                          *      +
                                            *  ÿ
      <== replaced by adrdssu code            *               *  ÿ
                                                *               *   Save
d (changed to an option via switch)             *             ÿ
tory support                                      *               *   e-
icÿ
                                                    *               *
udsen                                                 *               *
vel extract routineÿ
                                                        *
a Thomas andÿ
                                    ÿ
Skip Robinson - provided the code to test the return        *
                code of theÿ
  ROBINSJO@sce.com                                   +
*                                                  ÿ
  *   Werner Kuehnel - more great suggestiÿ
    *                   find_vsam_space routine                     *
    *                                                               ÿ
      * Installation customization:                      ÿ
        *   1. Update the FTPBCUST REXX exec for your installation
        *      defaults.
     ÿ
            *   3. find 'pdo 9712' and uncomment if you have problems
            *      with ftp'ing unloaded datasets that originally have
            *      a vÿ
       ÿ
*               *      the default table library (thus isptabl must be i
*               *      isptlib).       ÿ
  *               *   ÿ
    *               * History:
    *               *            05/31/2000  - 1.190  - ÿ
      *               *            05ÿ
        *               *                                 - add ALLDATA(
n       *               *                                 - corrections
TALOG     *               *                         ÿ
and .I      *               *                                   thx to L
ikoff       *               *            03/11/2000  - 1.188  - add syst
systcpds  ÿ
ndeman          *               *            02/11/2000  - 1.187 ÿ
vol before mkdir  *               *            01/12/2000  - 1.186  - re
it for online FTP *          ÿ
c and allow netrc   *               *
ÿ
 sysout(b) to (a)     *               *       ÿ
netrc                   *               *            10/22/99    - 1.183
w Create/Replacÿ
rd for non-unload         *               *            10/20/99ÿ
sort target host table      *               *            10/15/99    - 1
fix rfind                   * ÿ
- add find to host table list *               *            09/24/99    -
ÿ
  - add options for direct use  *            ÿ
66  - fix members in s m=()       *               *            06/23/99
65  - fix locatio+
.164  - fix popÿ
 - 1.163  - add locsite lrecl for getput*               *            04/
 - 1.162  - fix vsam space problem      *               *            04/
 - 1.161  - Minor cleanup for joÿ
9    - 1.160  - Move customized options to  *               *
                external exec: ftpbcust     *               *
                - changed variable names    *    ÿ
/99    - 1ÿ
09/99    - 1.150  - add variable for unit (3390)*               *
                  - fix sp to TR                *               * ÿ
                    - addÿ
                      - misc. corrections           *               *
                      - add REFRESH option          *               *
 03ÿ
     03/23/99    - 1.140  - major change in dfdss       *
                            dataset selection process   *
                    ÿ
                              - add NETRC DD for batch      *
                                as an option                *
         03/19/99    - 1.132  - fixesÿ
*                          - for pattern add ** for *           *
*                          - fix space variable in some cases   *
*                          - remove quotes from dss dsÿ
  *  +
   ÿ
      *            10/17/98    - 1.130  - cleanup submit datasets     *
        *            .... history cleaned up
        *         ÿ
          *            11/21/96-12/02/96 - creation
          ÿ
                                 ÿ
             arg options
                           ÿ
               Address ISPEXEC "VGET ZAPPLID"   ÿ
                   if zapplid <> "FTP" then do
                      Address ISPEXEC       ÿ
                        "TBCreate ftpcmds names(zctverb zcttrunÿ
c)",                        "replace share nowrite"
                          zctverb = "RFIND"                  +
                            zcttrunc = 0                   ÿ
                                zctact = "&FTPRFIND"
                                zctdesc = "RFIND for FTP Dialog"
                                "TBAdd ftpcmds"
             ÿ
ewappl(FTP)"                        "TBEnd ftpcmds"
                                    Exit 0
             ÿ

                                    parse value "" with null loadjcl_dsn
ssword passwvfy ,             ÿ
 odymc shost
                                       Address ISPExec
                                       "Select ÿ
                                           "Vget (sdb vio dasd netrc sys
node execlib savepwd" ,                         "FirIDwH forcejbn jc1 jc
sftpds systcpd systcpds) "                 Address TSO          ÿ

                                               /* ----------------------
                                                * If options is null the
 ÿ
 *                                                  * ------------------
 */                                                 if length(options) >
                  ÿ
ith sdsname more     ÿ

                                     ÿ
----------------------------------- ÿ
 any options                          *                       *    MVS o
sets the mvs value to Yes or No       *               ÿ
ets the userid to anonymous             *          ÿ
ts the bin value to Yes                   *                       *    H
 the target host to the host name         *                       *    ÿ
pplied as the next word in the options      *                     ÿ
--------------------------------------------- */                      if
more) > 0 then do
pos("MVSÿ
rÿ
wordpos("BINARY",more) > 0 then bin = "Y"
wordpos("ANONYMOUS",more)+
f wordpos("HOST"ÿ
      x = wordpos("HOST",more)
      thost = word(more,x+1)
      end                      ÿ
       end

   /* -------------------------- *            ÿ
        * Set default Environment    *
        * -------------------------- */
        Address ISPExec                                      ÿ

           /* -------------------------- *
            * Add Version to ISPF Pool   *
             ÿ
                "Vput (ftpbver sdsname)"

           ÿ
                    * Get basic information      *
                    * -------------------------- */
                    "Vget ÿ

                       /* ----------------------------- *
                        * If password sav+
                            * ---------ÿ
                              if savepwd = 1 then
                                 "Vget (password passwvfy) Profile"
 ÿ
                                 Start:
                                 /* -------------------------- *
                  ÿ
                                      * the FTPB Panel             *
                                      * -------------------------- */
                                   ÿ
    ÿ
mbers unl do_pds_flag od ,                         mhst submit_flag load
flag dss                                     ftp.0  ÿ
                   ÿ
                                                 dc     = 0
                                                 excluded.0 = 0      +
                                  ÿ
                                                       if loadjcl_dsn_fl
hen                                                       if submit_flag
en call clean_up_submit                          ÿ
      ÿ
ll
                                                           if shÿ
en do                  ÿ
                                                                  shost
                                                                  end

****" then thost = "?"
                                                                   ftprf
ASSTHRU"      ÿ
rfind"
                                                                       "
Panel(ftpb)"                 ÿ
 > 4 then do
          if savepwd = 1 then exit
          parse value "" with password passwÿ
           ÿ
              end
         else                                              +
          if sdsname = "EGG"ÿ
                 Address TSO "%ftpbcrdt"
                 sdsname = null
                 end                         ÿ
                  else call do_it
         end
                                                              ÿ
       ÿ
          * Start the actual processing with the Do_It procedure.      *
          * ---------------------------------------------------------- *

              Do_It:
              "Vput (sdsname thost userid bin mvs other other2) Profile"
              "Vÿ

                 /* -------------------------- *
                  * Clear some va+
                      * ---------ÿ
                        parse value null with to_mem to_dsn from_dsn sds
                                              tdsnamex gdg rename mÿ
                                                syÿ

                           /* -------------------------- *
  ÿ
                                * or if multiple dsn xfer ?  *
                                * -------------------------- */
                 ÿ
    ÿ
                                      parse value sdsname with sdsnamex
ers ")"                         ÿ
                     ÿ
then call get_gdg                            When datatype(members) = "N
 call get_gdg                                Otÿ
                                      ÿ
                                              if gdg = null then
                                                 if left(sdsnaÿ
n                                                     sÿ
                                                  end
                                               /* ----------------------
------------------------- *                       * Look for wildcard.
                              *                       * - set multiple f
                              *                       * - if .* then mak
 df/dss requires that for     *                       *   more than a si
el       ÿÿ
--------------------------------- */                     when pos("*",sd
 0 then do                                                 if left(sdsna
"'" then                 ÿ
tr(sdsname,2,length(sdsname)-2)                                 if right
,2) = ".*" then do                                                 sdsna
name"*"                                 ÿ
                                                                    mult
on"                                                                 end
                                                       ÿ
op                                                                   end

                                                                     /ÿ

nd target member ?       *
------------------------ */
ngth(ÿ
pos("(",tdsnamÿ
  parse value tdsname with tdsnamex "(" to_mem ")"
  if left(tdsname,1)ÿ
       tdsnamex = tdsnamex"'"  ÿ
      end
                                   ÿ
     /* -------------------------- *            ÿ
        * Set from dsname var        *
        * -------------------------- */           ÿ
         if length(sdsnamex) > 0 then do                         ÿ
              from_dsn = sdsnamex
              end                                                ÿ
             else do
  ÿ
                    sdsnamex = sdsname
ÿ                     end
                   q
                   if pos("'",sdsnamex) > 0 then
           ÿç
do                                                   parse value sdsname
" from_dsn "(" .                                     from_dsn = "'"from_
                              ÿ

                                                   if length(tdsnamex) >
do                                           ÿ
                                                          rename = "on"
                                                          end
                                                          elÿ
" then do                                                          tdsna
snamex                                                             to_ds
snamex                                                             tdsna
tdsnamex     ÿ

                                                               if pos("'
ex) > 0 thÿ
,tdsnamex) > 0 then do
alue tdsnamex with "'" to_dsn "(" to_mem .
= "'"to_dsn"'"           ÿ

 "Yes" then do
mex = translate(tdsnamex)               ÿ
o_dsn   = translate(to_dsn)
nd
ength(to_mem) > 0 then to_mem = translate(to_mem)      ÿ
 ÿ
* -------------------------- *
* Test status of the source  *                                        ÿ
  * data set.     ÿ
    * -------------------------- */
    if multiple = null then do
     ÿ
           sysreason = sysreason /* remove leading zero's */
           if sysreason = 5 then do
              zedsmsÿ
                  zedlmsg = "DSN" sdsname ,
                            "Invalid dsname or dsname not found"
                  "Setmsg Msg(isrz0+
                      return     ÿ
                          end
                       if length(members) > 0 then do
                          dsn_stat = sysdsn(sdsnÿ
      ÿ
                                 zedsmsg = "Source DSN Error"
                                 zedlmsg = "DSN:" sdsname dsn_sÿ
                       ÿ
                                     return
                                     end
                                    end ÿ
                                end

             ÿ
                                    * Check target Hostname      *
                                    * -------------------------- */
                            ÿ
                                        if thost = "?" then call get_hos
                                        zcmd = null
                                        if ÿ
           ÿ
"
                                            if thost = "?"ÿ
"                           ÿ
                                               /* ----------------------
---------------------------- *                  * Build password for ano
 connections using the current *             ÿ
                                 *                  * ------------------
-------------------------------- */                 if userid = "anonymo
        ÿ
 0 then do                                                    res= Socke
alize','ANYNAME')                                             xhost=
('GetHostId')          ÿ

erminate')                                                        passwo
var('sysuid')"@"word(phost,2)         ÿ
                ÿ
                                                               /* ------
-------------------------------------------- *       +
 id character for the job card al+
nd account number information.   ÿ
---------------------------------------------------- */
_jobid                                                            ÿ
"FTP"                                             ÿ
ength(zprefix) = 0
hen  hlq = zuser
lÿ

"Vget (lj1 lj2 lj3) Profile"
                ÿ
 /* ÿ
    * Setup Default Job Card     *
    * -------------------------ÿ
      if lj1 = null tÿ

       /* -------------------------- *        ÿ
          * Add comments to job       ÿ
            * -------------------------- */
            call setup_local_jobcard                         ÿ
              ftp.4  = "//*----------------------------ÿ
                ftp.5  = "//*    FTP Batch JCL Generated by FTPB Dialog
                datex = left(date(),11)
                  timex = left(time(),8)
                    ftp.6 =  "//*    Release" ftpbver "on" datex "at" ti
"                   ftp.7  = "//*---------------------------------------
*"         ÿ
         ÿ
                       /* -------------------------- *
                        * ÿ
                          ÿ
                            if rj1 = null then do
                               load.1 = fÿ
                                 load.2 = fÿ
                                   load.3 = ftp.3
                                   end                  ÿ
                                     else call setup_remote_ÿ
                                    load.4 = "//*-----------------------
----------------*"                  load.5 = "//*    FTP ReLoad JCL Gen+
by FTPB Dialog    *"                  load.6 = "//*    Release" ftpbvÿ

------------------------*"                  load.0 = 7

    ÿ
              ÿ
                                               lj3 = ftp.3
                   ÿ
                               ÿ
                                                   rj2 = load.2
                                  ÿ
                                                ÿ
                                                       /* --------------
---- *                                           ÿ
 then  *                                                  * set dÿ
ks = to  *                                                  * members/3
         *                                                  * --ÿ
---------- */                                                 if sysadir
O_ÿ
lk = sysmembers / 3

 sysadirblk with syÿ
                                                                    sele
              ÿ
sunits = "TRACK"    then do         ÿ
                           space = "TRK"
                           spÿ
                             end                     ÿ
hen sysunits = "CYLINDER" then do
                               space = "CYL"ÿ
                                 sp    = "CY"                         ÿ
                                   end
   when sysunits = "BLOCK"    then do                      ÿ
                                     space  = sysblksize
       ÿ
                                       end
         otherwise do
                   spaceÿ
                     sp    = "TR"
         +
       ÿ
                                         ÿ
                   if sp = "TR" then site_sp = "Tracks"
                      ÿ
                                                          ÿ
                   /* -------------------------- *
                    * Set target dsnaÿ
                      * -------------------------- */
                       if length(to_dsn) = 0 then do
                          if mvs = "Yes"            ÿ
                               then targ_dsn = from_dsn
            ÿ
                                 end                               ÿ
                             if length(to_dsn) > 0
                             ÿ
                                  else targ_dsn = null
  ÿ
                                  palloc = "("ÿ
lk")"                               direct = sysadirblk
                 ÿ
                                     /* -----------------------ÿ
                                        * Setup for PDS Member Xfer  *
                                ÿ
                                          * Check for dsorg types      *
ÿ
                                            Selÿ
                                              When multiple = "on" then
                 ÿ
                                                   do until zcÿ
                                                        call Do_Pattern
                                  ÿ
                                                       zcmd = null
                                                         if cancel = 1 t
 start                                             ÿ
                                                              zedsmsg =
            ÿ
tasets match pattern:" sdsname,                                     ÿ
sname pattern must have a valid hlq."                             "Setms
rz000)"                    +
                         ÿ
       +
     ÿ
s"                                      ÿ
y Panel(ftpbpdss)"
----------------------ÿ
ange the primary and      *                            ÿ
secondary allocations in    *
balloc to suite your site   *          ÿ
* and general usage for.      *                                       ÿ
  * --------------------------- */
  balloc     = "("mult_space","mult_space")"            ÿ
    sysalloc   = mult_space
    sÿ
     call build_dump
       end
    When sysdsorg = ÿ
         unl = "Yes"
         dÿ
           "Display Panel(ftpbpdss)ÿ
             call build_dump
             end           ÿ
            When sysdsorg = "DA" then do          ÿ
                 unl = "Yes"
                 dss = "Yes"                ÿ
                   "Display Panel(ftpbpdss)"                     ÿ
                     call build_dump
                     end                                     ÿ
                    When sysrecfm = "VBS" then do
ÿ
                         dss = "Yes"
                           "Display Panel(ftpbpdss)"
               ÿ
                             end
               ÿ
                              ÿ
                                    unl = "No"
                                ÿ
                                   if result +
                                     end   ÿ
                                    When sysdsorg =+
                                         call setÿ
                                           nn = ftp.0 + 1 ÿ
                                             if mvs = "Yes" then do
                                                ftp.nn = "Site priÿ
sec="sysseconds site_sp                           nn = nn + 1
                                                    end
                                                 if from_dsn = targ_dsn
   ÿ
        ÿ
                                                             if length(f
 + length(targ_dsn) ÿ
 from_dsn targ_dsn     ÿ

= "Put" from_dsn "+"                 ÿ
nn + 1                                ÿ
.nn = targ_dsn
                                                      ÿ
                                                     ÿ
                                                                 unl   =
                                                                 end   ÿ
                                                                Otheÿ
                                                                      ze
"*Error*"                                                             ze
sdsname ÿ
  "ÿ
g Msg(isrz001)"
                         ÿ
                  ÿ

                                          ÿ
------------------------ *       ÿ
Closing FTP instructions   *
-------------------------- */                              ÿ
nn = ftp.0 + 1                                  ÿ
  ftp.nn = "Close"
  nn = nn + 1
    ftp.nn = "Quit"                                            +
      nn = nn + 1                                            ÿ
        ftp.nn = "/*"
        if unl +
            nÿ
                ftp.nn = "//DELSTEP  EXEC PGM=IEFBR14"
                nn = nn + 1
                ftp.nn = "//DEÿ
           ÿ
                    ftp.nn = "//            DSN="hlq"."loadjcl_dsn
                    ftp.nn = translate(ftp.nn) ÿ
                      nn =ÿ
                        ftp.nn = "//DELULOAD DD DISP=(OLD,DELETE),"
                        nn = nn + 1                             ÿ
                          ftp.nn = "//   ÿ
                            ftp.nn = translate(ftp.nn)
                            nn = nn + 1
 ÿ
                                end
                              ftp.0 = nn
                  ÿ
                                 /* ------------------------------------
---------- *                      * Now if unl is 'Yes'  go build the jc
nt the job *                      *q  that was submitted and executed at
ote siÿ
-------------- */            ÿç
                                                       call set_ftpget_j
                     ÿ
                                              ÿ
------------------------------------ *                  * Display for Ed
se, Submit or eXecute the generated ÿ
statements.                            *                  * ---ÿ
---------------------------------------- */
                                                   ÿ
 then do                                                        /* -----
ÿ
l jcl           *                                                 ÿ
----------------- */                                                 rwl
                 ÿ
ocal_jcl
 +

reate remote jcl          *
------------------------- */
unl = "Yes" thÿ
    rwrj = 1
    call do_remote_jcl
    end                      ÿ
     end

     ftprfind = null                        ÿ
       ÿ

     /* ---------------------------------------------------ÿ
        * Begin the tranÿ
          *                                                            *
          * if mhost is not null then we have multiple target hosts    *
            * ---------------------------ÿ
              if mhst = null then
                 Call do_ftp
         ÿ
                     /* ------------------------------------------------
                      * Process each host selection
                      * ÿ
-- */                      do hn = 1 to words(mhst)
                                   phost = thost
                                   thosÿ
                                     call Fix_FTP
          ÿ
                                    end               ÿ
                                   end
                           ÿ
                                Return                               ÿ

                                 /* --------ÿ
----------------- *                 * Alloc and write generated jcl to v
set ÿ for browse,   *                 * edit, submit, or eXecute.
                    *                 *                      ÿ
                      *                 * Note: the password is only inc
 the submitted fileÿç
----------------------------------- */                do_local_jcl:
          ÿ
                                  ÿ
                                                             "LMFree dat
aid")"                     ÿ
                                                 ÿ
ee  f("ddn")"                                                    end
                                            ÿ
m()                                                             ÿ
                                                                  "Alloc
) new Unit("vio") spa(1,1) tr" ,                             ÿ
m(F b) Lrecl(80) Blksize(0) Reuse"                                  "Exe

PExec                                                                 "L
Dataid(dataid) DDName("ddn")"
              ÿ

---------------ÿ
rite out reload jcl dsn   *  ÿ
 -------------------------- */
_remote_jcl:                    ÿ
   if rwrj = 0 then return                  ÿ
     if unl = "No" then return
     Address TSO                                 +
       if loadjcl_dsn_flag = 1 then do         ÿ
             x=msg("off")
             "Free F(Reload)"
             "Delete '"hlq"."loadjcl_dsn"'"                     ÿ
                 end
               "Alloc f(Reload) new Unit("dasd") spa(1,1) tr Recfm(F b)"
                      "Lrecl(80) Blksize(0) Reuse ds('"hlq"."loadjcl_dsn
 ÿ
                   "Free  f(Reload)"
                   loadjcl_dsn_flag = 1
                  ÿ
                       return

                    Do_Pds:        ÿ
                           if do_pds_ÿ
                             "Lminit Dataid(dataid) Dataset("from_dsn")
"                            "Lmopen Dataid("dataid") ÿ
                               if pos("*",members) =ÿ
                                    "Lmmdisp Dataid("dataid") Option(Dis
                                            "Commands(Any) Panel(FTPBM)ÿ
                                      else do                      ÿ
                                         call build_list
                                        "Lmmdisp Dataid("dataid") Option
)",     ÿ
mbÿ
                                           do while rc == 0
                         ÿ
                 ÿ
n(Get)"                                           if rc == 8
                                          ÿ
aid") Option(Display)",         ÿ
el(FTPBM)"                                         end
                                                   "Lmmdispÿ
ption(Free)"                                   ÿ
"                                                      "Lmfree  Dataid("
"                                                     /* ---------------
----- *                                                  * droÿ
 if > 1 *                                                  * or replace
w/all   *                                                  * -----------
------- */   +
 = 1 then do ÿ
,members) > 1
mbers = all_mem                                                       en
            ÿ

ount = words(members)
= null                     ÿ
x = 1 to member_count
f pos("*",word(members,mx)) = 0
  then new_mem = new_mem word(members,mx) ÿ
end
members = new_mem
                                                         +
oÿ
 return

ocess_Selection:  ÿ
     if left(from_dsn,1) = "'"
        then parse value from_dsn with "'" w_dsn "'"
        else w_dsn = sysvar("syspreÿ
     ÿ
         Select
         When zllcmd = "/" × zllcmd = "S"           ÿ
               Then ÿ
                   "Lmmdisp Dataid("dataid") Option(Put) Member("zlmembe
                       "Zludata(selected)"                           ÿ
                     call do_sel zlÿ
                       end
                 When zllcmd = "\" × zllcmd = "U"
      ÿ
                           "Lmmdisp Dataid("dataid") Option(Put) Member(
r")"                       call do_usel zlmember
                       ÿ
                         When zllcmd = "B"
                           Then "Browse Dataid("dataid") Member("zlmembe
                         Otherwise nop; ÿ
ÿ
                             return
                                                         +
               ÿ
                                   /* first make sure we don't already h
/                                  if wordpos(zlmember,members) > 0 then
                              ÿ
                                       members = strip(members zlmember)
                                       return
                                             ÿ
           ÿ
                                           p = wordpos(zlmember,members)
                                           members = delwordÿ
                            ÿ

                                           /* --------------------------
                                             ÿ
                                                  * bumping the last cha
                                                  * --------------------
/                                                 Get_JobID:  ÿ
        ÿ
                                                      if length(jobsuf)
 jobsuf = "A"                                            else

jobsuf, ,                                                              '
JKLMNOPQRSTUVWXYZA1234567890', ,                                       '
IJKLMNOPQRSTUVWXÿ
FILE"                                                         return

                                 ÿ
                                                                  /* com
ut as this works with pdo 9712          */                        /* if
 = "U" then do                          */        ÿ
ysblksize > 32759 then big_load = "Y"       */                        /*
= "Yes"                                     */                        /*
                                            */                     ÿ
   ÿ
mvs = "No" then
   if unl = null then do
    ÿ
          unl = "No"
          end
 if mvs = "Yes" then +
                     ÿ
       "Display Panel(ftpbppds)"
          if rc > 4 then return 4               ÿ
                                      ÿ
        /* commented out as this works with pdo 9712          */
        /* if unl = "Yes" then                                *ÿ
          /*    if sysrecfm <> "U" then                ÿ
            /*       if sysblksize > 32752 then do                */
            /*          "Display Panel(ftpbpwrn)"                 */
              /*          zedsmsg = "Error"                         */
                /*          zedlmsg = "FTP Request cancelled because",*/
                /*                    "of unsupported blksize"        */
             +
         ÿ
                      /*          end

                         Sÿ
                             when unl = "No" then do
                                call set_ftp
                                put = "Puÿ
                                    putr = ""
                                    nn = ftp.0
                                    if mvs = "Yes" then ÿ
                                           if new = "Yes" then do
                                              Call ftp_site_info
                                              nn = nn + 1              ÿ

                                                  nn = nn + 1
                                                  ftp.nn = "Site recfm="
 "lrecÿ
                                                      nn = nn + 1
                                                      if direct > 0 then
                     ÿ
="direct                                                  ftp.nn = "Site
salloc "sec="sysseconds ,                                           dire
sp                                  ÿ
 0 then ns = "Unit="tunit
   else ns = null                                             if length(
0 then nv = "Volume="tvol                          ÿ
      else nv = null                                             ÿ
)+length(nv) > 0 then do                                               n
 1                                                                ÿ
= "Site" ns nv
  ÿ
+ 1
 ÿ
                   ÿ
th(targ_dsn) > 0 then do
 nn + 1         ÿ
p.nn = "cd" targ_dsn                ÿ
end
                               +
vs <> "Yes" then             ÿ
   if length(targ_dsn) > 0 then do
      if new = "Yes" then do
         nn = nn + 1                        ÿ
             ftp.nn = "MKDir" targ_dsn
             end
          nn = nn + 1                                      ÿ
         ÿ
              end
        nn = nn + 1
          ftp.nn = "lcd" fÿ
            ftp.0 = nn
            end
         ÿ
                  call build_iebcopy
                  end
             Otherwise nÿ
                 end

                 Select                ÿ
                     When pos("*",members) > 1 then do
                        call do_pds
                        If unl = "No" then            ÿ
              ÿ
                               nn = ftp.0 + 1
                               ftp.nn = put""word(members,i)""putr   ÿ
                               +
                             ÿ
                                  If words(members) = 0 then
    ÿ
                                          nn  ÿ
                                            ftp.nn = "Mput *"
                   ÿ
                                              zedsmsg = ""     ÿ
                                                zedlmsg = "*** No member
ed so ALL assumed ***"            ÿ
                                                  end
ÿ
                                           When m+
                                               ÿ
                   ÿ
                                                       ftp.nn = "mput *"
                                                       ftp.0  ÿ
                                    ÿ
                                                     When words(members)
en do                                                      nn = ftp.0 +
                                                     q         if length
 = 0 then                                                         ftp.nn
members""putr                                ÿç
e           ÿ
  ftp.nn = "put" members to_mem
tp.0 = nn                                                     ÿ
 end                       ÿ
n length(members) = 0 then do
call do_pds

       do i = 1 to words(members)
       nn = ftp.0 + 1
       ftp.nn = ÿ
           ftp.0 = nn
           end
        If words(members) = 0 theÿ
               if unl = "No" then do
                  nn     = ftp.0 + 1
                  ftp.nn = "Mput *"               ÿ
       ÿ
                      zedsmsg = ""
                      zedlmsg = "*** No members selected so ALL assÿ
                      ÿ
                          end
                    end
    ÿ
                     end
                     return
                     ÿ
                        /* -------------------------- *
                         * Build list of all members  *
                         * that match ÿ
                             * -------------------------- */     ÿ
                               Build_List:
                               Parse value "" with all_meÿ
                                 "Lminit Dataid(buildid) Dataset("from_d
ÿ
                                   do forever
                                        "LmmList Dataid("buildid") Optio
Member(amem)", ÿ
                                          if rc > 7 then leave
           +
         ÿ
                                             "Lmclose Dataid("buildid")"
                                             "Lmfree  Dataid("buildid")"
                          ÿ

                                                 Set_FTP:
                                           ÿ
                                                     nn = nn + 1
                                                     if fir = 'Yes'
                                                        thenÿ
STEP EXEC PGM=FTP,PARM='"firewall" (EXIT'"                  else ftp.nn
STEP EXEC PGM=FTP,PARM='"thost" (EXIT'"                  nn = nn + 1
                                                         ftp.nn = "//SYS
DD SYSOUT=ÿ
 do                                                             nn = nn
                                                                ftp.nn =
TPD DD DISP=SHÿ
                                                                 if syst
then do                                                             nn =
                               ÿ
 "//SYSTCPD  DD DISP=SHR,DSN="systcpds

                                                ÿ
c = 1 then do
date(u)
 = substr(d,7,2)substr(d,1,2)substr(d,4,2)                       ÿ
s = time("L")  /* get the current time hh:mm:ss.th */
t = substr(s,1,2)substr(s,4,2)substr(s,7,2)substr(s,10,1)
netrc_dsn   = hlq"."mlq".NETRC.D"date".T"t
  ÿ
   ÿ
      ftp.nn = "//NETRC    DD DISP=(OLD,DELETE,DELETE),"
      nn = nn + 1    ÿ
        ftp.nn = "ÿ

          if fir = 'No' then          ÿ
                  id = userid;   ÿ
              else if fir = 'Yes' then do
                 if FirIDwH = 0 then do                +
                      id = userid"@"thost;      ÿ
                          end
                       else do
                          id = userid;                         ÿ
                              end
                           end
                        if fir = "Yes" then
         ÿ
                            else
                               pw = password
             ÿ
                                netrc.1 = "MACHINE" thost "LOGIN" id "PA
pw
                            ÿ
                                    "Alloc f(netrcdd) new Unit("dasd") s
tr" ,                                      "Recfm(V B)" ,
                                           ÿ
"netrc_dsn"')"                          "Execio * diskw netrcdd (Finis S
c."                                     drop netrc.
                                        "Free  f(netrcdd)"ÿ
                                            Address ISPExec
                                         end

              ÿ
----------------- *                       * Now create the //INPUT DD
                  */                         nn = nn + 1
        ÿ                      ÿ

                                                 if netrc = 0 then do
                       ÿç
s' then do                                                             i
H = 0 then do
n + 1                                 ÿ
p.nn = userid"@"thost;
d
do                                                   ÿ
nn = nn + 1   ÿ
  ftp.nn = thost;
  nn = nn + 1                                                       ÿ
    ftp.nn = userid;           +
      end                    ÿ
     end
  nÿ
    ftp_password = left('@',length(password),'ÿ
      if fir = "Yes" then
         ftp.nn = ÿ
        else                                                   ÿ
             ftp.nn = userid ftp_password
       end                       ÿ

ÿ
           if length(other) > 0 then do         ÿ
                nn = ftp.0 + 1
                fÿ
                  ftp.0 = nn                                   ÿ
                    end
                 if length(other2)ÿ
                      nn = ftp.0 + 1
                        ftp.nn = other2
                        ftp.0 = nn                 ÿ
                          end
             ÿ
                            nn = ftp.0 + 1                          ÿ
                              ftp.nn = "Binary"
                            ÿ
                                end
     ÿ
                               if sysdsorg +
                                       nnÿ
                        ÿ
                                           nn = nn + 1
                                           ftp.nn = "typÿ
                                         ÿ
                                               end
                                            else                       ÿ
                                              if mvs = "Yeÿ
                                                   nn = ftp.0 + 1
                                                   ftp.nn = "type e"  /*
e ebcdÿ
                                                       ftp.nn = "mode b"
et block mode transfer */                                ftp.0 = nn
                     ÿ
                                                        if mvs <> "Yes"
          ÿ
) > 0 then do                       ÿ
targ_dsn,1) = "\" then tdsn = 0
                  else tdsnÿ
n = translate(targ_dsn," ","\")                    ÿ
 words(targ_dsn)
 = 1 to tdw-1                               ÿ
nn = nn + 1                                                       ÿ
  ftp.nn = "cd" word(targ_dsn,td)
  end                                                        ÿ
 if tdsn = 1 then do
 ÿ
      targ_dsn = word(targ_dsn,tdw)
        end
        else do ÿ
             nn = nn + 1
             ftÿ
               targ_dsn = null ÿ
                 end
      end                       ÿ
     ftp.0 = nn                               ÿ
    return
                                                 ÿ
   Set_FTPGet_JCL:                                           +
     nn = ftp.0 + 1                                        ÿ
       ftp.nn = "//PRINT   EXEC PGM=IKJEFT1B,"                      ÿ
         nn = nn + 1
         ftp.nn = "//             PARM='FTPBJOB2 "ftprpt_dsn"'"
           nn = nn + 1
     ÿ
             nn = nn + 1
         ÿ
               nn = nnÿ
                 ftp.nn = "//SYSTSPRT DD   SYSOUT=*,DCB=(RECFM=VB,LRECL=
                 nn = nnÿ
                   ftp.nn = "//SYSTSIN +
                     nn = nn + 1     ÿ
                       ftp.nn = "/*"   ÿ
                         nn = nn + 1
                         ftp.0 = nn                   ÿ
                           return                     ÿ

                         Build_IEBCOPY:                                ÿ
                            put = "  S M=("                          ÿ
                              putr = ")"
                              nn = ftp.0 + 1
        ÿ
    ÿ
                                  ftp.nn = "//SYSPRINT DD SYSOUT=*"
                         ÿ
                   ÿ
                                         then call fix_send_dsn
                                         eÿ
                                  ÿ
strip(send_dsn,,"'")
                                          call set_unl_loadÿ
                                                 ÿ
                                              if new = "Yes" then
                                                 call ftp_site_info
                                                                ÿ
                                                  if big_load = "Y" then
                                                     nn = nn + 1
             ÿ

                                                           ftp.nn = "//
=(RECFM="sysrecfm",LRECL="syslreÿ
                                                             ftp.nn = "/
LKSIZE=27998ÿ
                                                 ÿ
   SPACE=("space","palloc",RLSE)"                                end
                           ÿ
                                                                ftÿ
TPUT   DD DISP=(,CATLG),UNIT="dasd","                             nn = n
                                          ÿ
         DSN="unload_dsn","                                         nn =
   +
/ÿ
 = "Yes" then do
= nn + 1
.nn = "//SYSUT3   ÿ
 end
 = nn + 1
p.nn = "//SYSIN    DD  *"          ÿ
nn = nnÿ
  if big_load = "Y" then
     ftp.nn = "  COPYMOD INDD=INPUT,OUTDD=TEMP,MAXBLÿ
       else ftp.nn = "ÿ
      ftp.0 = nn
                                                                     ÿ
        nn = load.0 + 1              ÿ
          if new = "Yes"
             then do
      ÿ
                 nn = nn + 1
                 if left(targ_dsn,1) <> "'" then
                   loadÿ
'")","               else
                       load.nn = "//DELOAD   DD  DSN="strip(targ_dsn,,"'
                     load.nn = translateÿ
  ÿ
                         load.nn = "//             DISP=(MOD,DELETE),"
                         nn = nn + 1                     ÿ
                 +
))"            ÿ
                               end
                              load.nn = "//LOAD     EXEC   PGM=IEBCOPY"
                              ÿ
                                load.nn = "//SYSPRINT DD  SYSOUT=*"
             ÿ
                                  load.nn = "ÿ
"                                   nn = nn + 1
                              ÿ
load_dst                              load.nn = translate(loÿ
                                        if big_load = "Y" then do
                                           nn =+
                                             ÿ
(,DELETE),UNIT="dasd","                          nn = nn + 1
                                                 load.nn = "//         S
pace","palloc",RLSE)"                            end          ÿ
          ÿ
                                                  if left(targ_dsn,1) =
                                                     load.nn = "//OUTPUT

                                                         load.nn = "//OU
D  DSN="userid"."targ_dsn","                             load.nn = trans
d.nn)           ÿ
                                                          if new = "No"
                                                             load.nn = "
   DISP=SHR"                     ÿ

= "//         DISP=(,CATLG),"
h(tunit) > 0 then tun = tunit                     ÿ
                 else tun = ""dasd""
ength(tvol) > 0 then tvl = ",VOL=SER="tvol
                else tvl = null                                    q
 = nnÿ
load.nn = "//         UNIT="tun""tvl","                      ÿç
              nn = nn + 1
              load.nÿ
              end
        if ut3 = "Yes" then do
           nn = nn + 1             +
             load.nn = "//SYSUT3 ÿ
               enÿ
              nn = nn + 1
              load.nn = "//SYSIN   DD *"        ÿ
                if big_load = "Y" ÿ
                     nn = nn + 1
                     load.nn = " COPY INDD=INPUT,OUTDD=TEMP"   ÿ
                       nn = nn + 1                 ÿ
                         load.nn = " COPYMOD INDD=((TEMP,R)),OUTDD=OUTPU
="t                      nn = nn + 1
                           load.nn = "/*"                           ÿ
                             end
                             else do
             ÿ
     ÿ
TPUT"                                 nn = nn + 1
                            ÿ
                      ÿ
                                  load.0 = nn
                                           ÿ
                                    selÿ
                                         when length(members) = 0 then
                                            call do_pds   ÿ
                                           when pos("*",ÿ
                                                call do_pds
                                             otherwise nop
                                            end

                                              nn = ftp.0
        ÿ
          ÿ
                                                  When members = "*" the
                       ÿ
 do                        +
                         ÿ
 then                                 ÿ
rip(members)""putr                                           else
                                          ÿ
members","to_mem""putr                               +
                                                   ÿ
rs) > 1 then                                                 ÿ
 words(members)
+ 1                                                               ÿ
 = put""word(members,i)""putr
                                                                      Ot
nop                                                                   en
 ÿ
               ÿ
_load = "Y" then do
= nn + 1        ÿ
tp.nn = "  COPY INDD=((TEMP,R)),ÿ
 nn = nn + 1
 ftp.nn = "/*"                 ÿ
   end                                           ÿ
  ftp.0 = nn
                                              ÿ
  call set_ftp                                                    ÿ

    nn = ftp.0 + 1                                           ÿ
      ftp.nn = "Site pri="sysalloc "sec="sysseconds site_sp
   ÿ
        ftp.nn = "Put '"unload_dsn"'" reload_dst
          nn = nn + 1
          ftp.nn = "ÿ
            nn = nn + 1
           ÿ
              nn = nn + 1            ÿ
                ftp.nn = "mode s"
                nn = nn + ÿ
                  ftp.nn = "Site filetype=jes"        ÿ
                    nn = nn + 1
                    ftp.nn = "Locsite lreÿ
                      nn = nn + 1                                      +
                        ftp.nn = "get" ftpjcl  "'"ftprpt_dsn"'"      ÿ
                          nn = nn + 1                   ÿ
                            ftp.nn = "site filetype=seq"
                            nn = nn + 1
      ÿ
                                nn = nn + 1                          ÿ
                                  ftp.nn = "delete" ftpjcl
                         ÿ
                                    if length(members) > 0 then do
    ÿ
                                         dÿ
                                           end
                   ÿ
                                                           ÿ
                                             build_dump:
                                  ÿ
                                                ftp.nn = "//UNLOAD EXEC
RDSSU"                                            nn = nn + 1
                                                 ÿ
UT=*"                                               if left(from_dsn,1)
             ÿ
                                                         else seÿ
late(from_dsn)
                              ÿ
en                                                           if sysdsorg

_space send_dsn                                ÿ
                                                              call set_u
              ÿ
                                                                ÿ
TPUT   DD DISP=(,CATLG),UNIT="dasd","                             nn = n
                             ÿ
         DSN="unload_dsn","                                         nn =
 ÿ
g = "VS" then                               ÿ
n = "//         SPACE=(TRK,"balloc",RLSE)"
                  ÿ
.nn = "//         SPACE=("space","balloc",RLSE)"           ÿ
 nn + 1
nn = "//SYSIN    DD  *"            +
 = nn + 1                        ÿ
  ftp.nn = "  DUMP OUTDD(OUTPUT) - "

  if sysdsorg = "VS" then do                      ÿ
       nn+
       ÿ
           end                                                       ÿ
          if vex = "No" then do
             nn = nn +ÿ
               ftp.nn = "       SHARE TOL(ENQF)  -"
      ÿ
              nn = nn + 1            ÿ
                ftp.nn = "       COMPRESS - "
                nn = nnÿ
                  if multiple <> "on" then          ÿ
                       ftp.nn = "       DATASET(INCLUDE("strip(send_dsn,
"                      else do          ÿ
                              if scnt + ecnt = 0 then do           ÿ
                                   ftp.nn = "       DATASET(INCLUDE("str
me,,"'")"))"                       end                   ÿ
                                  /* -------------------------- *
  ÿ
                                     * -------------------------- */
                                      if scnt > 0 then do
                 ÿ
                                           ftp.nn = "       DATASET( -"
           ÿ
                                ÿ
                                                     nn = nn + 1
                            ÿ
                                               ÿ
LUDE("selected.i ", -"                                      in1 = 1
                                             ÿ
                                                           elsÿ
                                                                ftp.nn =
          "selected.i ", -"                                  eÿ
                                                               nn = nn +
                                                                 ftp.nn
  ))"                                                      end

            ÿ                                                 /* -------
----------- *                                                  * Process
d datasets  *                                                  * -------
----------- */ÿ
 ecnt > 0 then do
in1 = 0
 ftp.nn = "       DATASET(INCLUDE("strip(sÿ
     if excluded.0 > 0 then do
        do i = 1 to excluded.0
           nn = nn + 1                                   ÿ
               if in1 = 0 then do
                  ftp.nn = "       EXCLUDE("excluded.i ", -"
                  in1 = 1

                   else
                      ftp.nn = "                "excluded.i ", -"
       ÿ
                       nn = nn + 1
                       ftp.nn = "       ))"
                 end  ÿ
                     end
             end
          ftp.0 = nn                 ÿ
              nn = load.0 + 1
              load.nn = "//LOAD     EXEC   PGM=ADRDSSU"
              nn = nn + 1                           ÿ
                  load.nn = "//SYSPRINT DD  SYSOUT=*"
                  nn = nn + 1
                  load.nn = "//INPUT    DD  DISP=(OLD,DELETE,DELETEÿ
    ÿ
                      load.nn = "//             DSN="userid"."reload_dst
                      load.nn = translate(load.nn)
  ÿ
                          load.nn = "//SYSIN   DD *"
                          nn = nn + 1
                 ÿ
                              if sysdsorg = "VS" then do
                                 nn = nn + 1
                                ÿ
                                     end             ÿ
                                    if odymc <> null then do
                                       Select  +
                                           whÿ
C"                                             otherwise mc = "MGMTCLAS(
"                                              end
                                             nn = nn + 1    ÿ
         ÿ
                                                 end
                                              if odysc <> null then do
                          ÿ
                                                       when odysc = "NON
sc = "NSC"                                             otherwise sc = "S
"odysc")" ÿ
                                                         nn = nn + 1
                                                         load.nn = "
c "- "                   ÿ
                                                          if odyvol <> n
 do                                                          nn = nn + 1
                                        ÿ
      OUTDYNAM("odyvol") - "                                     end
                                                              nn = nn +
                                                       ÿ
     CATALOG -ÿ
 then do                                                             nn
                                                                     lÿ
 "          REPLACE -"         ÿ
                                                                      if
 "Yes" then do
 + 1 ÿ
d.nn = "          TOL(ENQF) -"

l = "All" then do   ÿ
 nn = nn + 1
 load.nn = "          ALLDATA(*) -"
 end                               ÿ
reÿ
  if rename = "on" then do
     nn = nn + 1                                  ÿ
       if left(targ+
            renamÿ
              else                                               +
                rename_dsn = hlq"."targ_dsn                    ÿ
               if multiple = "on" thÿ
                    load.nn = "          RENAMEU("sdsname", - "
                    nn      = nn + 1
                      if right(tdsname,2) = ".*" thenÿ
                           tdsname = tdsname"*"
                        rt_dsn = strip(tdsname,,"'")
             ÿ
                            end
                         else do
                            ÿ
       ÿ
                                if right(rename_dsn,2) = ".*" then
                                   rename_dÿ
                        ÿ
"                                   end
                                 end                      ÿ
                                nn = nn +ÿ
                                  load.nn = "          DATASET(INCLUDE(*
                                  nn = nn + 1
                                    load.nn = "/*"        ÿ
                                      load.0 = nn
                                    call set_ftp
        ÿ
                                        ftp.nn = "Site pri="sysalloc "se
conds site_sp                           nn = nn + 1
                       ÿ
st          ÿ
                                            ftp.nn = "Site pri=1 sec=1 T
                                      ÿ
                             ÿ
n"'" ftpjcl                                     nn = nn + 1
                                                ftp.nÿ
                                              ÿ
                                                    ftp.nn = "Site filet
                                                    nn = nn + 1     ÿ
                                                      ftp.nn = +
 sec=15 tracks lrecl=255"                               nn = ÿ
                                                          ftp.nn = "get"
 "'+
 ÿ
ÿ
                                                                ftp.nn =
"               ÿ
                 ÿ
lete"  ftpjcl                                                       ftp.
                               ÿ
members) > 0 then do              ÿ
rs = null
s_flag = 1                                    ÿ
                                                   ÿ
rn
                                                             ÿ
-------------------------- *                                        ÿ
* Check for any migrated d/s *
* for multiple (dss) xfers   *
  * -------------------------- */
  Do_q Pattern:
     parse value '' with cmdsn cmflag zcmd zsel action cancel

                    t_dsn   = strip(sdsname,,"'")

              ÿ
                         "Lmdinit Listid(ftpb) Level("t_dsn")"
                         lrc = rc
                               ÿ
                             tblname = "ftpb"random(9999)
                             "TBCreate" tblname "names(zsel cmdsn action
g zdlsize zdlvol)" ,                            ÿ

                                 x_rc   = 0
                                 scnt   = 0                      ÿ
                                     ecnt   = 0
                                     t_rc = 0
                                     mult_sels = 0
  ÿ
                                         "Control Display Lock"
                                         "Display Panel(ftpbpdsl)"
                   ÿ
                   ÿ
                                                  "Lmdlist Listid("ftpb"
YES) Dataset(cmdsn) Option(LIST)"     ÿ
                                  ÿ
                                                        "TBAdd" tblname
                                                       ÿ
                                                 ÿ
                                                          end
                                                       "Lmdfree listid("
"                                                               ÿ
                                                           if scnt = 0 t
                                                              "TBEnd" tb
         ÿ

                                                                  zedlms
cess Cancelled - no eligibÿ
isrz001)"     ÿ
                                                                      en
                                           +
                             ÿ
0
ls = 0
                                            ÿ
crp = 0
t_find = 1
                                                           ÿ
 "TBTop" tblname

 Do forever
     zcmd = nuÿ
       if mult_sels = 0 then do
         "TBTop" tblname
         ÿ
             if rowcrp = 0 then
                "TBDispl" tblname "Panel(ftpbsdsl)"
             else       ÿ
                    "TBDispl" tblname "Panel(ftpbsdsl)" ,
                              "Csrrow("rowcrp") AutoSel(No)"
                 end                   +
                   else              ÿ
                       "TBDispl" tblname
                     t_rc = rc
  ÿ
                         if t_rc > 7 then leave
                         if zcmd = "REFRESH" then leave
                   ÿ
                             if abbrev("FIND",word(zcmd,1),1)  = 1 then
find tblname                 if abbrev("RFIND",word(zcmd,1),1) = 1 then
                                zcmdÿ
  ÿ
                                    end
                                 if zsel = "\" then zÿ
                 ÿ
                                          When zsel = "S" then do
                                               if cmflag = "E" then doÿ
                                ÿ
                                                      zedlmsg = "Select
ude may not be",                                                "used in
e trans+
       ÿ
                                                            "TBPut" tbln
                                                            enÿ
                        ÿ
                                                                  cmflag
                                                                  if act
"Select" then leave                      ÿ
t + 1                                                                 ac
Select"                                                               zs
l           ÿ
istdsi "'"cmdsn"'" "Norecall"
reason = 9 then
left(zdlvol,6) = "MIGRAT" tÿ
    Address TSO "HRecall '"cmdsn"'"
 sysreason <> 9 then
 zdlvol = sysvolume                       ÿ
"TBPut" tblnÿ
  action = null
  end                                                    +
nd                           ÿ
en zsel = "E" then do
   if cmflag = "S" then do
      zedsmsg = null                          ÿ
          zedlmsg = "Exclude and Select may not be",
                    "used in the same transfer."
          "Setmsg msg(isrz001)"                                ÿ
     ÿ
              "TBPut" tblname
              end
ÿ
                    cmflag = "E"
                    ecnt = ecnt + 1
                 ÿ
                        zsel = null
                        "TBPut" tblname
                        action = nÿ
                            end
                       end
                  When zsel = "R" then do          +
                           if action <> "Select" thÿ
                                action = "Recall"
                             zsel = null
ÿ
                                 if sysreason = 9 then
                                    if left(zdlvol,6) = "MIGRAT" then
               ÿ
     ÿ
                                        zdlvol = sysvolume
                              ÿ
                      ÿ
                                         end
                                    When zselÿ
                                       ÿ
                                                action = "Migrate"
                                                scnt = scnt ÿ
                                                  if scnÿ
ll                                                  end
                                                 else action = "Migrate"
                                                   zsel = null
                                                       "TBPut" tblname
                                                       action = null
                                                       Address TSO "HMig
mdsn"'" ÿ
                                                      When zsel = "U" th
                                                           Select
                       ÿ
ion,1) = "E" then do
cnt - 1
= 0 then cmflag = null                ÿ
                                                                       W
(action,1) = "S" then do
 = scnt - 1                                          ÿ
if scnt = 0 then cmflag = null
end
wise nop                                                            ÿ
ÿ
n = ""
= null
t" ÿ
ction = null   ÿ
 end
rwise nop;        ÿ
d                               ÿ

                                 ÿ
rol Display Lock"                                ÿ
splay Panel(ftpbpdsc)"
                                                ÿ
f wordpos(zcmd,"REFRESH CANCEL") = 0 then do                      ÿ
    "TBTop" tblname
    mult_space = 0                                             ÿ
      do forever
   ÿ
           if rc > 0 then leave
             if scnt + ecnt = 0 then
                if lÿ
                      action = "D"
             +
           ÿ
                           if left(zdlvol,6) <> "MIGRAT" then
                              action = "D"
                          ÿ
                               end
                            end
                         if left(action,1ÿ
                             if action = "D" then do
                                call listdsi "'"cmdsn"'"
                                select                  ÿ
          ÿ
                                           call find_vsam_space "'"cmdsn
                                           if "'"cmdsn"'" <> vsam_dsn tÿ
                           ÿ
h(vsam_dsn)-2)                                   end
                                               mult_space = mult_space +
ri    ÿ
                                              when left(sysunits,1) = "B
                                                   mult_space = mult_spa
alloc                ÿ
en                                                     multÿ
 + (sysalloc*15)                                    when left(sysunits,1
then                                ÿ
ce + sysalloc                                         otherwise nop
                                                        end
                                                   ÿ
                                                        do cd = 1 to sel
             ÿ
,1) = cmdsn then do                                             cdÿ
                                                                  scnt
t - 1                         ÿ
                                                                 end
 ÿ
en do                                          ÿ
ted.0 + 1                                                            sel
t = cmdsn       ÿ                                                      s
0 = cnt                                                         ÿ
                                                                      en
                               ÿç
 if left(action,1) = "E" then do
    e = excluÿ
      excluded.e = cmdsn                      ÿ
        excluded.0 = e
        end                   ÿ
       end                                                   ÿ
   end
   "TBEnd" tblname                             ÿ
     if zcmd = "CANCEL" then do
          zcmd = null
          cancel = 1                                            ÿ
            zedsmsg = null
           ÿ
              "Setmsg msg(isrz001)"
 ÿ
            return        ÿ

            /* ---ÿ
               * Find_Vsam_Space routine ÿ
 *               * -----------------------------------------------------
 */               Find_Vsam_Space: +
                    arg vsam_dsn ÿ
                        space_pri = 0    /* moved here in case vsam chec
*/                      if multiple = "on" then do
                           if right(vsam_dsn,6) = ÿ
                               if right(vsam_dsn,7) = ".INDEX'" then ret
                               /* fixed to reflect index and data for dd
                               if right(vsam_dsn,3) = ".D'" then reÿ
      ÿ
                                   end

    ÿ
                                    do until ve = 1
                                       drop vsam.
                     ÿ
                                           "LISTCAT ENT("vsam_dsn") ALL"
                                           call outtrap "off"
                                      ÿ
                                               ifÿ
 then ve = 1                                     else do i = 1 to vsam.0
                                                      if ÿ
i) > 0 then                                                parseÿ
with "CLUSTER--" cluster                                  if cluster <>
n do                                                         vsam_dsn =
ip(cluster)"'"                                                 end

 then leave                                                   end
           ÿ
              ÿ
                                                          do i = 1 to vs
                            ÿ
",vsam.i) > 0 then do        ÿ
nslate(vsam.i," ","-")                                              spac
word(vsam.i,8) + space_pri                   ÿ
                                            ÿ

                                                              ÿ
= space_pri                                                ÿ
  = space_pri                                                          s
s = space_pri                                                          A



GDG:
exx - finÿ
              code from Ole Knudsen
      - IBM Global Services - MVS Application Development Support
*/                      ÿ
       "control errors return"
       "lminit dataset("sdsname") dataid(dataid)"
       if rc=0 then do                 ÿ
              "lmquery dataid("dataid") ddname(ddname)"
              cc=listdsi(ddname "FILE")
              realdsn=space(sysdsname)                ÿ
                  "lmfree dataid("dataid")"
                  sdsnamex = "'"realdsn"'"
                  end                                                +
    ÿ
                     members = null
                     return
                     q
  ÿ
               ÿç
                                      date = substr(d,7,2)substr(d,1,2)s
4,2)             ÿ
h:mm:ss.th */                   ÿ
,7,2)substr(s,10,1)                      /* ----------------------------
-------------- *                ÿ
hat will be used *                          * in ÿ
                   *                          * ------------------------
------------------ */                         uÿ
D"date".T"t                                     unload_dst  = mlq"ÿ
te".T"t                                           reload_dsn  = hlq"."ml
D.D"date".T"t                                     reload_dst  ÿ
date".T"t                                           loadjcl_dsn = mlq".L
te"ÿ
D"date".T"t                                           ftprpt_dsn  = hlq"
pt                                                      ftpjcl      = ml
L.D"date".T"t       ÿ

            ÿ
                                     ÿ
lq"."from_dsn"'"                                                 return
                           ÿ
                                                      ÿ
------------------------------------------------- *               * Fix_
 routine to change the thost to the multi ÿ
ple target hostnames are used                       *               * -ÿ
----------------------------------------------------- */              Fi
                                                         ÿ
------------------------------------------------------- *
nge the ÿ
lean up any submit datasets if submit bypassed            *
 Change remote hostname in jcl to new remote hostname       *
 Change the work dsnames ÿ
------------------------------------------------------------- */
rghost +
call ÿ
    call setup_local_jobcard
    call setup_remote_jobcard
    call clean_up_suÿ
        if od = null then                                  ÿ
             od = "D"date
          else od = oda            ÿ
                 dc  = dc + 1
                   oda = "D"date""dc
              do t = 1 to ftp.0                   ÿ
                   if pos(phost,ftp.t) > 0 then do
             ÿ
                        pos = pos(phost,ftp.t)                   ÿ
                          nl = left(ftp.t,pos-1)
                          nr =ÿ
                            ftp.t = nl""thost""nr
ÿ
                           if pos(od".",ftp.t) ÿ
                                tl = length(od)
               ÿ
                                  nl = left(ftp.t,pos-1)        ÿ
                                    nr = substr(ftp.t,pos+tl,71)
                              ÿ
                                      end
 ÿ
tatement */                          if pos(oÿ
                                          tl = length(od)
                  ÿ
                                            nl = left(ftp.t,ÿ
                                              nr = substr(ftp.t,pos+tl,7
                                   ÿ
                                                end
                                               end
                                           /* ------ÿ
                                              * fix temp/working dsnames
          ÿ
                                                * -------------------ÿ
/                                                 do t = 1 to load.0
                         +
n do                   ÿ
        ÿ
t)                                                            nl = left(
os-1)                                 ÿ
.t,pos+tl,71)            +
da""nr                 ÿ
                                                     ÿ
                                                                if pos(o
l_dsn) > 0 then do                      ÿ
gth(od)                                                             ÿ
pos(od,loadjcl_dsn)
eft(loadjcl_dsn,pos-1)                                   ÿ
 substr(loadjcl_dsn,pos+tl,44)
jclÿ
d
(od,ftprpt_dsn) > 0 then do
tl = length(od)   ÿ
  pos = pos(od,ftprpt_dsn)
  nl = leftÿ
    nr = substr(ftprpt_dsn,pos+tlÿ
      ftprpt_dsn = strip(nl""oda""nr)
      end                   ÿ
 /* -------------------------- *                ÿ
    * Write out the new jcl into *
    * temp d/s.                  *           ÿ
      * -------------------------- */                          ÿ
        if rwlj = 0 then do
           rwlj = 1                                           ÿ
             call do_local_jcl
               end
            call do_local_jcl

             ÿ
                   call do_remote_jcl
                ÿ
                  Return    ÿ

                   /* -----------ÿ
----- *               * Now process the for+
        *               * submissions forÿ
          *               * ------------------------ÿ
----------- */              Do_FTP:
                            call save_remote_jobcard    ÿ
                              do forever                             +
                                   if unl = "No" then              ÿ
                                        "Display Panel(ftpbgs)"        ÿ
                                          else
                                          "Display Panel(ftpbgsu)"
    ÿ
      ÿ
                                                "Lmfree  Dataid("dataid"
                     ÿ
                     ÿ
                                                    if netrc = 1 then
                                      ÿ
etrc_dsn"'"                         ÿ
                                                        end
                                                     reÿ
                                                   ÿ
                                                       rwlj = 0
                                                       rwrj = 0
                                                         if ftp.1 ÿ
rwlj = 1                                                   if ftp.2 <> l
rwlj = 1                                                   if ftp.3 <> l
rwlj = 1 ÿ
nÿ
                                                               ftp.2 = l
                          ÿ
                ÿ
" then do                                                             if
<> rj1 then rwrj = 1                       ÿ
2 <> rj2 then rwrj = 1         ÿ
d.3 <> rj3 then rwrj = 1
 = rj1                                                      ÿ
.2 = rj2                                      ÿ
ad.3 = rj3
ll do_remote_jcl
end                                                          +
all do_local_jcl                                           ÿ
 "Vput (lj1 lj2 lj3) Profile"
 call save_remotÿ
   select
       when opt = "S" then do
            submit_flag = 1      +
              Address TSO      ÿ
         ÿ
                        "Recfm(F B)"
                                                ÿ
                    "Exeÿ
                      if netrc = 0 then do
                         do p = 1 to in.0                        ÿ
                              if wordpoÿ
                                   if password = '*' then
                                      apass = null
  ÿ
                                       if userid <> "anonymous" then
                                          in.p = userid apass
                   ÿ
                                           end
                                        end
                                    ÿ
    ÿ
" .                                      "Execio * diskw I"ddn" (Finis S
                                         drop in.    ÿ
                   ÿ

                                          Address ISPExec             ÿ
                                  ÿ
                                              if unl <> "No" then do
                                                 "Addpop"
       ÿ
                                                        "Display Panel(f
"                                                    else
                        ÿ
sup)"                                                    "Rempop"
                                                         end
                                         ÿ

                                                                 zedlmsg
 jobname ,                                                  ÿ
s been submitted successfully"                                     "Setm
srz001)"    ÿ
                                                                Address
ree F("ddn")"                                                     return
                           ÿ
                                                                 when op
then do                                                            if un
 then do    ÿ
s TSO
 f(Input) new Unit("vio") spa(1,1) tr Recfm(F b)" ,
 "Lrecl(80) Blksize(0) Reuse"ÿ
xecio * diskr "ddn" (Finis Stem in."
= 0
 i = 1 to in.0                                ÿ
     if left(in.i,1) = "/" then iterate
     if wordpos(ftp_password,in.i) > 0 then
        in.i = userid password                                 ÿ
       ÿ
         out.n = in.i
         end
ÿ
          "Alloc f(Output) new unit("vio") spa(15,15) tr reuse"
          if netrc = 1 then
             "Allÿ

              Address ISPEXEC
              "Control Display Locÿ
                  "Display Panel(ftpbexec)"

                  "Select PGM(FTP) PARM("thost")"  ÿ

                      Address TSO
                      "Free f(input)"                               ÿ
  ÿ
                             "Free f(netrc)"
                          Address ISPExec
     ÿ
               ÿ
                                "Lmfree  Dataid("outid")"
                        ÿ
                              ÿ
                                    zedlmsg = "Foreground FTP Execution
."                                  "Setm+
                                      "ÿ
                                          Address TSO "Free F("ddn")"
                                          return
                                          end           ÿ
                                           else do
                                                zedsmsg = "Error"
                                                zedlmsg = "X Option not
d with Unloaded Load Library"                       "Setmsg Msg(isrz001)
                                                    end
                                               end
          ÿ
                                                      "Edit Dataid("data
ro(ftpbem)"                                            Address TSO,
                         ÿ
 (Finis Stem ftp."                                        end
                                                     when opt = "B" then
                                        ÿ
taid")"                                                  when opt = "EL"
                                                              "Edit   Da
hlq"."loadjcl_dsn"') Macro(ftpbem)"                    ÿ
                                                                  "Alloc
") shr reuse ds('"hlq"."loadjcl_dsn"')"                           "Execi
r T"ddn "(finis stem load."                                       "Freÿ
ÿ
PExec                                                                 en
                                                                 when op
 thenÿ
e Dataset('"hlq"."loadjcl_dsn"')"                                    oth
op;                                                                  end
                    ÿ             ÿ
                                                                    Retu

                                   ÿç
   /* -------------------------- *
    * Clean up datasets used     *
    * for job submission.        *                ÿ
ÿ
        Clean_Up_Submit:
        if submit_flag <> 1 then do                              ÿ
             x = +
               ÿ
                 Address TSO "Delete '"netrc_dsn"'"
ÿ
                submit_flag     ÿ
                  loadjcl_dsn_flag = null
               ÿ
                                                 ÿ
                     /* ------------------------------------------------
----- *               * Setup ÿ
b       *               * submission.                             ÿ
          *               * Use correct userid for jobname to allow jesg
          *               * -----------------ÿ
----------- */              Setup_Remote_Jobcard:
   ÿ
                              "TBOpen ftpjobcd Write Libraryÿ
                                if rc = 8 then call create_table
                    ÿ
                                  do forever
                                       "TBSkip ftpjobcd"
                                     q   if rc > 0 then leave
                                         if targhost = thost then leave
          ÿ
                                                      if rj1 = null then
                                                         rj1 = ftp.1
                         ÿ
                                                             rj3 = ftp.3
                                                             end
                                        ÿ
th "//" jobname "JOB" rest                                    Uuserid =
e(userid)                                                     if forcejb
then do                                                +
erÿ
"jobname "JOB" strip(rest)                                             e
                                                                    else
                   ÿ
ft(jobname,length(Uuserid)) = userid then do
bname = Uuserid""jobsuf
1 = "//"jobname "JOB" strip(rest)   ÿ
endÿ
f left(jobname,length(zuser)) = zuser then do
  jobname = Uuserid""jobsuf                          ÿ
    rj1 = "//"jobnÿ
      end
   end                                                                ÿ
  load.1 = rj1                   ÿ
    load.2 = rj2
    load.3 = rj3
    tbpÿ
        if targhost = thost then do
          "TBPut   ftpjobcd"
          tbput_rc = 4  ÿ
              end
            if tbput_rc = 4 then
              if left(thost,1) <> "*" theÿ
                     if pos(thost,"*?") = 0 then do
                        targhost = thost
                       "TBAdd   ftpjobcd"                 ÿ
             ÿ
                    "TBSort  ftpjobcd Fields(targhost)"
                    "TBSave  ftpjobcd Library(ISPPROF)"
                      "TBCloÿ
                          return

                         /* ---------------ÿ
            ÿ
                              * be used locally.           *
                              * --------------------------ÿ
                             ÿ
                                  parse value lj1 with "//" jobname "JOB
                                  if left(jobname,length(zuser)) = zuser
do                                     jobnameÿ
                                           lj1 = "//"jobname "JOB" strip
                                           end
                                        ftp.1 = lj1            ÿ
      ÿ
                                            ftp.3 = lj3
                                            return
ÿ
                                               /* ----------------------
                                                * Save the remote jobcar
                 ÿ
 *                                                  * ------------------
 */                                                 Save_Remote_Jobcard:
                                  ÿ
ibrary(ISPPROF)"                                         if rc = 8 then
ate_table                                               do forever
                                                   ÿ
                                                               if rc > 0
ave                                                            if targho
st then leave                                                  end  ÿ
 ÿ
                                                                rj2 = lo
                                                                rj3 = lo
     ÿ
host                                                                if r
en                                                                    "T
tpjobcd"              ÿ

   ftpjobcd"
 ftpjobcd Fields(targhost)"            +
ave  ftpjobcd Library(ISPPROF)"        ÿ
BClose ftpjobcd Library(ISPPROF)"
turn                                                         ÿ
                                                        ÿ
 /* ------------------------------------------------------------- *
  * Get_Hostname routine.                                         *
    * Used when the user enters a ? on the target Hostname field    *
      * to display the current set of used hostnames from which to    *
      * select.                                                       *
      * Opt+
        *ÿ
            *     C - clone entry (create new host name)
            *     U - update entry (change JCL)
            *     \ - unÿ
*               * ------------------------------------------------------
*/              Get_Hostname:
                call build_thost_table ÿ
                      mult_sels = 0
                      mhst = null
                      crp = 1                         ÿ
                          rowcrp = 0
                          last_find = 1
                          do forever                                 ÿ
ÿ
                              if words(mhst) > 0 then do
                                 zedsmsg = null
    ÿ
) or ENTER",                                   "when ready to proceed."
                                     "Setmsg Msg(isrz001)"
                   ÿ
                                      zcmd = null
                                      "TBTop  thosttbl"
                                  ÿ
                                          if mult_sels = 0 then do
                                             if rowcrp = 0 then
                                                "ÿ
shst)"                                           else
                                                    "TBDispl thosttbl Pa
shst)",                                                     "Csrÿ
AutoS+
   ÿ
                                                       "TBDispl thosttbl

                    ÿ
                                                        if xrc > 7 then
              ÿ
le                                   ÿ
0 then return                                                   signal s
                             +
                           ÿ
l"                                                                Select
                                                                     whe
("FIND",word(zcmd,1),1) = 1 then do       ÿ
ll do_find "thosttbl"
rghost = "?"
c = 0                                                    ÿ
end       ÿ
n abbrev("RFIND",word(zcmd,1),2) = 1 then do
  zcmd = "RFIND" argument
    call do_find "thosttbl"ÿ
      targhost = "?"
      xrc = 0
      eÿ
     when hsel = "D" then do
       "TBDelete thosttbl"
       xrc = 0        ÿ
           end
         when hsel = "C" then do
           currhost = targhost       ÿ
               "control display save"
               "Display Panel(FTPBCHST)"
               if rc = 0 then do                    ÿ
               ÿ
                      "TBAdd thosttbl order"
                      end                                          ÿ
                     "control diÿ
                       end
                     when hsel = "U" then do
  ÿ
                           "Display Panel(FTPBUÿ
                             if rc = 0 then do
                 ÿ
                                  "TBMod thosttbl"              ÿ
                                    end
                                ÿ
                                   end
 ÿ
                                     pw = wordp+
                                       mhst =ÿ
                    ÿ
                                          "TBMod thosttbl"
                                          targhost = "?"    ÿ
                                     ÿ
                                               end
                                             when hsel = null then targh
null                                           otherwiÿ
                                                           mhst = mhst t
                                                           tsel = "Selec
          ÿ
                                                               if mult_s
then                                                              targho
                         ÿ
        ÿ
                                                      if pos(hsel,"CDU")
n targhost = "?"                        ÿ
                         ÿ
eave                                                      end
                                                       ÿ
e                                         ÿ

                                                            Create_Tabÿ
                                                           ÿ
bcd keys(targhost)",
es(rj1  rj2  rj3 thdesc) Library(ISPPROF)",
lace"ÿ

                                                                    Save
able:               ÿ
te_Table     +
thosttbl"  ÿ
ery thosttbl rownum(rows)"         ÿ
rw = 1 to rows
TBSkip thosttbl"            ÿ
 "TBGet  thosttbl"                                ÿ
   "TBAdd ftpjobcd"
   end                                       ÿ
   "TBSave  ftpjobcd Library(ISPPROF)"                           +
     "TBClose ftpjobcd Library(ISPPROF)"                       ÿ
       "TBEnd   thosttbl"                                       ÿ
         if words(mhst) = 1 then thost = strip(mhst)
         return

 ÿ
             "TBOpen ftpjobcd Write Library(ISPPROF)"
             ÿ
                  ÿ
                    targhost = "temp"
                    call setÿ
                      rj1 = lj1    ÿ
                        rj2 = lj2
                        rj3 = lj3          ÿ
                          "TBadd ftpjobcd"          ÿ
                            end
                         "TBTop ftpjobcd"                 ÿ
                           "TBCreate thosttbl keys(targhost)",       ÿ
                                        "Names(tsel rj1  rj2  rj3 thdesc
                              tsel = null
                               "TBQuery ftpjobcd rownum(rows)"
      ÿ
                                    "TBSkip ftpjobcd"
        ÿ
                       ÿ
                                        end
                       ÿ
                                       "ÿ
                                         "TBClose ftpjobcd Library(ISPPR
                                      ÿ
                                                         +
                                           /* ---------ÿ
                                              * setupÿ
                                                * ----------------------
                                                set_initial_jobcard:
                                                     lj1 = jc1      ÿ
                                                       lj2 = jc2
                                                       lj3 = jc3
         ÿ
fil+
 ÿ
                            ÿ
                                                           /* ----------
-------- *      ÿ
tion       *                                 ÿ
             *                                                  * ------
------------ */                ÿ
n blk = 0                                                     ÿ
lse blk = sysblksize                                                if s
cks" then blk = sysblksize                    ÿ
lloc                                                                  se

 sysadirblk                                                  ÿ
n = targ_dsn
ay Panel(FTPBSITÿ
irect = 0 then direct = null
 length(direct) > 0 then
 sysadirblk = direct             ÿ
sysalloc   = pri
sysseconds ÿ
  select                                          ÿ
       when sp = "Blocks" then space = blk
       when sp = "TR" thenÿ
         when sp = "CYL" then space = "CYL"                        ÿ
           otherwise space = sp
           end                           ÿ
          balloc = "("sysalloc","sysseconds")"
    ÿ
            direct = sysadirblk                         ÿ
              if rel = "Yes" then rlse = ",RLSE"
                     +
                retÿ

                   /* --------------------------------------------------
                    * Find sub-routiÿ
      ÿ
*/                     Do_Find:
                             arg table_name          ÿ
                     +
                   ÿ
                                   argument = strip(argument)
                                     zsel = ''
                                  ÿ
                                       hcc  = 0
         ÿ
                                         find_looÿ
                                           search    = ''
                          ÿ
                                             if o1     = "RFIND"ÿ
                                                  last_find = last_find
                                           q        "TBTOP " table_name
                                                    "TBSKIP" table_name

                                                                    else

" table_name "ÿ
                                                                     if
hen do
    "TBTop" table_name       ÿ
        "TBSKIP" table_name "Position(ROWID)"
        s_smsg = "Wrapped"
        end                                 ÿ
     elsÿ

perform search */                                          ÿ
                         ÿ
 do forever
    if left(table_name,4) = "FTPB" then
         search = translate(cmdsn)        ÿ
        if left(table_name,5) = "THOST" then
           search = translate(targhost) translate(thdesc)
        iÿ
               crp = rowid + 0
               rowcrp = crp
               last_findÿ  = crp
                       zedsmsg = s_smsg  /* "Found" */
                       zedlmsg = argument "found during search in row:"
                      "Setmsg Msg(isrz0ÿç
                         ÿ
                                   end
                                "TBSKIP" table_name "Pÿ
                                  if rc = ÿ
                                          "TBTOP" table_name
                                           s_smsg = "Wrapped"        ÿ
                                         if find_loop = "onÿ
                                               zedsmsg = "Not Found"
                                               zedlmsg = argument "Not f
ing ÿ
                                                  "Setmsg Msg(isrz001)"
                                                   leave
                   ÿ
             +
           ÿ
                                  ÿ
                                                    end
                            Ø                 return
                                     {

143839

¦

ÈWUõ


 

†
qÃ^²
TPBHF4 
¸
ü©
q¦×


×
TPBPDSSÿ
Ø
ì
oÌ"
ƒ
½
ô

Å


                                                         _ TYPE(INPUT) C
 INTENS(HIGH)                                            × AREA(DYNÿ
L(ON) EXTEND(ON)                                          ÿ
(LOW)                                                        # TYPE(OUTP
NS(HIGH) JUST(RIGHT) PAD(0)                                 01 TYPE(DATA
NSÿ
 INTENS(LOW)                                                    03 TYPE(
 INTENS(HIGH) CAPS(ON)                                          04 TYPE(
  INTENS(LOW)    +
T)  INTENS(Hÿ
TAOUT)  INTENS(LOW)                                                  )BO
(80)                                                                 %Me
t -- &ZDSN ------------------ÿÿ
d ===>_ZCMD                                            %Scroll ===>_Z
ds:      LOCATE, RESET, SELECT, SORT, HELP
ommands: / or S = Select, B = Browse, \ or U ÿ
LCOLS
ATA --------------------------------------------------------------------
                                                            ÿ
×× ---------------------------------------------------------------------
×)INIT
   .ZVARS = 'ZSCML'         /* SCROLL AMT VARIABLE NAME  */
  ÿ
     )PROC
       VPUT (ZSCML) PROFILE
     )END ÿ
          /*  $M1= MEMLIST   M230     860923   158590 : FUNCTION TEST
/         /*   PTM00000184
/         /*             ÿ
   */         /*   CHANGED 3 LINES
M1C*/        /* 5665-402 (C) COPYRIGHT IBM CORP 1980, 1989 */
             
                                         /* + type(text  ) intens(low )
          information only  */              _ type( input) intens(high)
) just(left )                             ÿ
s(off) just(left ) color(yellow)                @ type(output) intens(hi
s(off) just(left ) color(white)                 % type(text) intens(high
                                                ~ type(textÿ
lor(blue) hilite(reverse)                        )Body
                                                 +----------------------
CP/IP FTP Executing+-----------------------------+
     ÿ
     ~Patience+                 ~Patience+           +
                                                     +    Your TCP/IP Fi
fer is now inÿ
                                                         +    From data
sname                                                    +    To   data
snamex                        ÿ
 @thost                          ÿ
                                                               +    Star
zdate    `ztime                                  ¼               +
                                                ÿ
                                                                   
ç
             /* + type(text  ) intens(low )                   iÿ
  */              _ type( input) intens(high) caps(off) just(left )
                ÿ
low)                % type(text) intens(high)
                      ~ type(text) intens(high) color(blue) hilite(rever
                   )Body         ÿ
                     +-----------------------------~TCP/IP FTP Warning+-
-------------ÿ
                                                  ÿ
                         ~WARNING+ ~WARNING+ ~WARNING+ ~WARNING+ ~WARNIN
ING+ ~WARNING+ ~WARNING+ +  ÿ
                           + The data set you are attempting to traÿ
data set that when unloaded  + will have a DCB that can not be successfu
sferred using FTP.           +             ÿ
                               + Your options are:
    ÿ
                                 +    1.  Reblock the dataÿ
ss than 32756 permanently          +    2.  Reblock the data set into a
y data set with a BLKÿ
                                     +    3.  Don't use the unload trans
tion                                   +
                                      ÿ
                                         )Init
        ÿ
                                           )End        ˆ
                                             
ault(%+_)              ÿ
 input) intens(high) caps(on ) just(left ) pad('_') color(turq)
text) intens(high) caps(off) just(asis ) color(yellow)
e(text) intens(high) caps(off) just(asÿ
ype(text) intens(high)
ype(text) intens(high) color(turq) hilite(reverse)
DY WINDOW(6ÿ
                       #FTP Userid+                ÿ
   %Command ===>_ZCMD
                              ÿ
      `Userid+                                                    ÿ
       +
       ~This input field defines the#userid~to ÿ
         ~system.  It may not be the same as the userid in use at
 ÿ
           ~                                                    ÿ
             ~If userid of `anonymous~is used then the password fields a
             ~noÿ
               )Init
 %               )End
                 
                                             @ type( input) intens(high)
 ) just(left ) pad('_') color(turq)          ` type(text) intens(high) c
 just(asis ) color(yellow)                   ~ÿ
off) just(asis ) color(turq)                     % type(text) intens(hig
                                                 # type(text) intens(hig
(turq) hilite(reverse)                           )BODY WINDOWÿ

P Password+                                          %Command ===>_ZCMD

  ÿ
 Password+                                               ~
                                                         ~These input fi
`non-displaÿ
idden and secure.  Enter the password                        ~for the sp
userid twice as a way to verify that                         ~at least i
tered the same both times.ÿ
                                                                 )Init
                                                                 )End
                                         ÿ

               @ type( input) intens(high) caps(on ) just(left ) pad('_'
turq)          ` type(text) intens(high) caps(off) just(ÿ
                 ~ÿ
                   % type(text) intens(high)
                   # type(text) intens(high) color(turq) hilite(reverse+
                     )BODY WINDOW(6ÿ
                                            #FTP MVS option+
                         %Command ===>_ZCMD
                                                    ÿ
    ÿ
                             ~
                             ~If the target (remote) system is anotheÿ
tem                ÿ
ate that                         ~the transfer should not use the MVS op
paramaters.                      ~
      I                           ÿ
                                     )End
                                     
)                                                ÿ
intens(high) caps(on ) just(left ) pad('_') color(turq)          ` type(
tens(high) caps(off) just(asis ) color(yellow)                   ~ÿ
intens(high) caps(off) just(asis ) color(turq)                  ÿ
) intens(high)                                                       # t
) intens(high) color(turq) hilite(reverse)                           )BO
W(6ÿ

d ===>_ZCMD
                    ÿ
ary+          ÿ

 the target (remote) system is#not~anÿ
then you might want to specifÿ
 ~not text type data.  If it contains packed decimal or
 ~other non-alphanumeric data it should probably be   ÿ
   ~sent as binary.                         ÿ
     ~
     ~Caution should be exercise when using this option as             ÿ
       ~the application at the remote system must be able tÿ
         ~understand the data in EBCDIC format which is the format
         ~of the data on the MVS system.
        ø  )Init
             )End
             
                                       @ type( input) intens(high) caps(
t(left ) +
t(asis ÿ
 just(asis ) color(turq)                     % type(text) intens(high)
                                             # type(text) intens(high) c
q) hilite(reverse)    ÿ
                                                                    #FTP
l option+                                        %Command ===>_ZCMD
                                     ÿ
                                                      `Firewall+
                                                     ~
                                                    ÿ
your data outsiÿ
to pass thru a firewall. A                               ~firewall prote
internal TCP/IP environment                              ~from the ÿ
                                ÿ
                                                             ~When you s
es~to Firewall then the address                              ~you define
 uÿ
                                                                 )End
                                                                 

             @ type( input) intens(high) caps(on ) just(left ) pad('_')
rq)          ` type(text) intens(high) caps(off) just(asis ) color(yello
             ~ÿ
                 % type(text) intens(high)
                 # type(text) intens(high) color(turq) hilite(reverse)
                 )BODY WINDOW(5ÿ
                                        #FTP Initial Command+
                     %Command ===>_ZCMD
                                                ÿ
                          `Initial Commands+
                         ~
                         ~These fields allow you to enter 2 optioÿ
                             ~subcommands that will be processed before
                             ~PUT command is processed to do the transfe
                             ~the TCP/IP documentation for a list of val
  ÿ
                                 )Init
                                 )End
                   º       +
)                        ÿ
intens(high) caps(off) just(asis ) color(yellow)                   ~ typ
intens(high) caps(off) just(asis ) color(turq)                    ÿ
) intens(high)                          ÿ
xt) intens(high) color(turq) hilite(reverse)                         )BO
W(65,19)
   ÿ
d ===>_ZCMD

rget Data Set+      ÿ

is input field is optional and if used defines the new
me of the Source Data Set on the remoÿ
non-Mÿ
 ~
 ~No validity check is made until execution time for tÿ
   ~                ÿ
     ~This field can also contain a target drive:\directory\filename
     ~for workstation targets. (e.g. c:\t\newname.txt)                 ÿ
       ~                           ÿ
         `Examples:
         +
        ÿ
             ~  userid.TEST.**            + new name for input library m
             ~  c:\temp\newname.txt       + drive 'c' directory temp w/n
             )Init       s                                       ÿ
                 )End
                 
                                           @ type( input) intens(high) c
ÿ
 just(asis ) color(yellow)                   ~ÿ
f) just(asis ) color(turq)                     % type(text) intens(high)
               ÿ
(turq) hilite(reverse)                           )BODY WINDOW(6ÿ
                                                                      #F
e Data Set+                   ÿ

ÿ
                                             +
                                           ÿ
ines the input dataÿ
P from the current system to the defined                     ~target (re
st.                                                       ÿ
                                    ÿ
                                                                 +
                                                                 ~  TEST
                + prompt for members if PDS          ÿ
T.CLIST(*)'       + send all members of PDS                          ~
T.CLIST(AB*)      + prompt members AB* only                          ~
EST.**  ÿ
                      +    with userid.TEST

                       ÿ
½
                     /* + type(text  ) intens(low )                   in
n only  */              _ type( input)ÿ
                        ÿ
or(yellow)                  @ type(output) intens(high)  caps(off) just(
olor(blue)                  % type(text) intens(high)ÿ
                              ~ type(textÿ
erse)                        )Body window(67,16)
                             +------------~TCP/IP FTP Batch Submissiÿ
tion+------------              %Command ===>_Zcmd         ÿ
                                 `
                                 ` Successfully submitted JOB: @jobname
   ÿ
                                     ` The Batch JOB that was just submi
l transfer the unloaded              ` data set to the target host site.
the data set is   ÿ
ubmitted to ÿ
 set (PDS).  This original               ` Batch JOB will wait for up to
tes for the Reload JOB to        ÿ
thin that 10 minute period   ÿ
JOBs print out.  If the Reload               ` JOB does not complete wit
 10 minute period you will have              ` tÿ
te and review the Reload JOBs                 ÿ
                                                 )Init
                                                 )Proc         +
                                                   )End      ÿ
                                                       
-)Panel Keylist(ISPHelp,ISP)
 )Attr Default(%+_)
   /* _ type( input) intens(high) caps(on ) just(left )               */
    ÿ
        ! type(output) intens(high) caps(off) just(asis ) color(white)
        ` tÿ
          ~ type(textÿ
            % type(text) intens(high)
            + type(text  )ÿ
                skip(on)              ÿ
                # area(SCRL) Extend(ON)
             )Body                       ÿ
               +---------------%TCP/IP Batch FTP Submitÿ
-----------------%Command ===>_zcmd
                 %                                      ÿ
                   +
     %Up F10 Dn F11  #help ---------------------------------------------
--------------------#)Area Help                                        ÿ
                       ~ This portion of the TCP/IP FTP Dialog allows yo
iew (Browÿ
), and execute           ~ the file transfer in the foreground (eXecute)
      ÿ
                          ÿ
ll not be displayed          ~ as a security measure.  It will be includ
he~S~and%X~options.  ÿ
                               ~ You have tÿ
                                 +
                                 %  ÿ
                                   ~                        ÿ
                                     ~        This option allows you to
he generated JCL and FTP             ~        instrÿ
you with a review to insure            ~        that the changes you mad
 option%E~are what you want.             ~
                                         %    E -+Edit~the generatÿ ed F
                                           ~
              ÿ
pdates to the JCL and/or FTP commands.       ~        For example, you m
tÿç
ter the actual PUT instruction and this opt+
 this capability.                        ÿ
                ÿ
~the generated FTP job                                           ~
                                                          ÿ
it will take the generated JCL ÿ
bmit them to the internal reader for execution in batch.             ~
                                                                     %
eXecute~FTP+now, in the foreground            ÿ

  This option will invoke the file transfer immediately under
  your TSO/Iÿ
      your terminal (unfortunately at this time it is not possible
      to capture these messages to a file for archiving and/or printing
      so if you require that ÿ
 ~
 ~    The JOB card displayed will be used if you select option%S~ and is
 ~    available for changing here.  Any changeÿ
   ~    betÿ
     ~    then it will have the suffix character updated for each sessio
     ~                                                         ÿ
       )Init              ÿ
           .cursor = zcmd
         )Proc
$          )end                          ÿ
             {
                                         )Attr Default(%+_)
                                         /* _ type( inpuÿ
n ) just(left )               */            ÿ
(on ) just(left ) pad('_') color(turq)          ! type(output) intens(hi
(off) just(asis ) color(white)                  ` type(text) intens(higÿ
(off) just(asis ) color(yellow)                   ~ type(textÿ
ps(off) just(asis ) color(turq)                     % type(text) intens(
                                                    + type(text  ) inten
      ÿ
                                                        # area(SCRL) Ext
                                                     )Body
                     +
CP/IP Batch FTPÿ
                                                           %
                                                           +
                                ÿ
--------------------------------------------------------------#)Area Hel
                                                               ~ This po
 the TCP/IP FTP Dialog allows you to review (Browÿ
t), review the reload JCL (Browse Load), update the reload         ~ JCL
oad), and submit JCL for batch execution (Submit).                 ~
                                                                ÿ
at the password will not be displayed as a security measure.  It       ~
 included only for the%S~option.                                       ~
                                                                       ~


 have the following options on the menu:
              ÿ
    B -+Browse~the generated FTP job

        This option allows yoÿ
   ~        instructions.  It also provides you with a review to insure
   ~        that the changes you made with option%E~are what you want.
   ~                                        ÿ
       %    BL-+Browse~the generated JCL for reloading the load library
       ~
       ~        This option allows you to review the generaÿ
PY         ~        instructions.  It also provides you with a review tÿ
e that       ~        the changes you made with option%EL~are what you w
             ~
               %    E -+Edit~the generated FTP job
        ÿ
                 ~        You can use this to make updates to the JCL an
 commandsÿ
 commands          ~     ÿ
s option             ~        allows you this capability.
                     ~  ÿ
                       %    EL-+Edit~the gÿ
library                  ~
                         ~        This +
ed JCL and IEBCOPY         ~        iÿ
alter the JCL, for             ~        example, you could change the un
for the allocation of the      ~        target data set.
                               ~                    ÿ
                                   %    S -+Submit~the generated FTP job
                                   ~
                                   ~        Submit will take the geÿ
 and FTP instruÿ
er for execution in batch.             ~
                                       ~
  ÿ
used if you select option%S~and is         ~    available for changing h
y changes will be remembered               ~    between sessions.  If th
e is your userid ÿ
 character updated for each session.           ~    The first (top) set
tatements are for the JCL that will be         ~    submitted and execut
e local system to unload and traÿ
d (bottom) set of JOB statements will be           ~    submitted using
r the data set has been transferred and            ~    executed at the
ite.                                           ÿ
   ÿ
Information                                            ~
                                                       ~    Thÿ
be submitted to reloÿ
 retrieved by this application and will be printed         ~    by the l
rated JOB STEP.`IF~the JOB runs longer than 10 minutes     ~    then thi
on will not occur as the FTP JOB will+
the submitted JOB to end before theÿ
have to LOGON to the remote system to view the SYSOUT for        ~    th
 JOB.       ÿ
                                                    ÿ
nt:~The JOB card for the Reload Job%must~be of the format            ~
plus 1 character in order fÿ
e submitting job.  The userid must be the userid used for the        ÿ
ote logon.
                                          ÿ
rsor = zcmd
      p
d                                                        +
{
                             )Attr Default(%+_)
                             /* _ type( input) intens(high) caps(on ) ju
)               */            ÿ
eft ) pad('_') color(turq)          ! type(output) intens(high) caps(off
sis ) color(white)                  ` type(text) intens(high) caps(off)
s ) color(yellow)                   ~ type(textÿ
sis )ÿ
                                        + type(text  ) intens(low )
                                          skip(on)              ÿ
                    ÿ
                                         )Body
                                         +------------------------%TCP/I
Fÿ
                                             %
                                             +
                  ÿ
------------------------------------------------#)Area Help
                                                 + This ISPF Dialog is d
to simplify the use of IBM's TCP/IPÿ
or transferring files from the current MVS           + system to another
enabled system.   Press~ENTER+to scroll down.        +
                                                    ÿ
ÿ
 PF1 (HELP).                                             +
                                                         + To move upÿ
 in this tutoriÿ
keys (PF7 and PF8).                                          +
                                                             +
      ÿ
             Description                                         + ~
           +                                                     + ~Sour
Set        +This is theÿ
               +is to be transmitted.                                + ~
               +                                                     + ~
               +Note that the transfer oÿ
                   +sequential data set is not supported.  But
                   +you can transfer members of a PDS to a directory
                   +on your workstation.  You will also b+
                       +option of using IEBCOPY to unloadÿ
 + ~                       +the transfer, and then using IEBCOPY to relo
 + ~                       +the PDS - all using Batch JCL.
 + ~                       +
   + ~  ÿ
     + ~                       +a load library that the direct FTP of a
     + ~                       +member will not be successful as FTP doe
     + ~   ÿ
         + ~                       +information correctly.  Thus, for lo
         + ~                       +libraries, the transfer will be perf
         + ~                ÿ
load         + ~                       +library into a sequential data s
he           + ~                       +transfer.
             + ~                       +     ÿ
                 + ~                       +For transferring a PDS you c
fy a member      + ~                       +name, a member name pattern
*), or *         + ~                       +for all members.  ÿ
                     + ~                       +
                     + ~                       +You can also specify a p
ataset name          + ~                       +for dump/restore using D

                         + ~                       +
                         + %Target Information     +
                ÿ
                             + ~Hostname               +This is the TCP/
(or IP Address) of the       + ~                       +target system th
ource Data Set is to         + ~ ÿ
                                 + ~                       +
                                 + ~                       +if the hostn
n~?+a selection list of          + ~            ÿ
hostnames will be displayed from     + ~                       +which yo
lect from one to n.                  + ~                       +
                                     + ~Target Data Set        ÿ
onal and if blank will default to        + ~                       +the
e as the Source Data Set.  If filled     + ~                       +in t
 set name will be used.                  + ~                       +
      ÿ
S2.TEST.NEW                                  + ~                       +
S2.NEWTEST.**                                + ~                       +
             +
non-MVS tarÿ
the drive and directory information and an           + ~
optional new filename.                               + ~
                          ÿ
   +  e.g. c:\temp\newname.txt                           + ~
   +                                                     + %User Informa
   +                                     ÿ
       +                                                     + ~Userid
       +This is your TSO Userid that will be used by FTP     + ~
       +when it logs into the target host.              ÿ
           +                                                     + ~
           +Note: the userid field is case sensitive to          + ~
           +support accessing workstations that allow mixed      + ~   ÿ
           ÿ
               +                                                     + ~
                This is the password for the specified Userid of     + ~
      ÿ
                   +displayed for security reasons and you must
                   +enter it a second time for verification.
                   +Nÿ
                       +support accessing workstations that allow mixed
                       +case passwords.
                       +            ÿ
 + %Optional Information   +
 + ~                       +
 + ~MVS Target             +Asks if the target hostÿ

     + ~                       +
     + ~Binary                 +If you are transferring the Sourceÿ
       + ~      ÿ
         + ~                       +can specify that you want to transfe
ta       + ~                       +in binary`if~the data contains non a
rÿ
ecimal).     + ~                       +
             + ~Firewall               +If you need to FTP through a Fir
is gives     + ~ÿ
 then to         + ~                       +specify the host name of the
l.               + ~                       +
                 + ~Initial    +
er any other FTP     + ~   Coÿ
.  These will be         + ~                       +executed prior to th
 transfer of the         + ~                       +Source Data Set.
                         + ~                ÿ
    ÿ
nter:  cd a:                 + ~                       +if you wanted to
 file onto a diskette        + ~                       +Youÿ
 dir                 ÿ
directory to be displayed.       )Init
                                   .cursor = zcmd
                                   )Prô oc
                                     )end
                                     {
         ÿ
) EXTEND(ON)                                                         ` t
) intens(high) caps(off) just(asis ) color(yellow)                  ÿ
xt) intens(high) caps(ofÿ
text) intens(high)
text) intens(high) color(turq) hilite(reverse)                         )
DOW(6ÿ
AND =  ==>_ZCMD                                         +
                                           %Up F10 Dn F11
 ---------------------ÿ
AREA FTPA
Hostname+
                                       ÿ
   ~This input field defines the TCP/IP Host Name of the target
   ~(remote) system or host that the Source Data Set will be
   ~copied to. The key to a host name is that it referenÿ
    ÿ
       ~data set(s) to be copied.
       ~
         ~If%?~is uÿ
           ~all previously used hostnames from which you may select from
           ~1 to n.  You can also Clone, Update, and delete hostnames.
          ÿ
               `Examples:
               +
               ~  nkaisera.ÿ
)                  ~  nkaiserd.ncal.kaiperm.orgÿ
v)                   ~  mvsp20e.kpscal.org        + Southern California
od)                  ~  mvsd10a.kpscal.org    ÿ
dev)                   )INIT                                  ÿ
                         &ZCONT = FTPBH0
                         )PROC                                 h
                           )END
                             
                                                       /* + type(text  )
low )                   information only  */              _ type( input)
high) caps(oÿ
ens(high)  caps(off) just(left ) color(yellow)                @ type(tex
s(high) color(blue)                                           ~ type(tex
s(high) color(blue) hilite(ÿ
                                                               +--------
--------------~TCP/IP Credits+---------------------------------%Command
d                                         ÿ
            ÿ
ng individuals assisted, debugged, provided code, suggestions,     @ or
 encouragement in the creation of this application:      ÿ
                             ÿ
   `credit1
   `credit2
     `credit3                                 ÿ
       `credit4
       `credit5
       ÿ
           `credit7
           `credit8
           `credit9   ÿ
ÿ
               `credit11
               `credit12             ÿ
     )Init       2
       )Proc
       )End                                         ÿ
         
                                   /* + type(text  ) intens(low )
    information only  */              _ type( input) intens(high) c+
st(left )                             ÿ
f) just(left ) color(yellow)                % type(text) intens(high)
                                            ~ type(text) intens(high) co
) hilite(reverse)                        )Body         ÿ
ÿ
 FTP PDS Prompt+-----------------------------%Command ===>_Zcmd

               ÿ
itioned data set (PDS).                          +
                                                 +   Create/Replace data
target%==ÿ
                                                     +   Unload for tran
          %===>_unl+   Yes or No  (Should always     +
                       be ÿ
                                                         +   Create SYSU
EBCOPY Unload %===>_ut3+   Yes or No. Need for large PDS +   e.g. //SYSU
ACE=(CYL,(50,50)),UNIT=SYSDA               ÿ
                                                             +   Note: ~
pecify Create YES the dataset~will be deleted+prior to the   +
t the target host.                                          ÿ
                                                                 +   Not
ransferring a large number of members it can be faster to        +   unl
PDS using IEBCOPY, FTP it, then reload it at the target site     +   usi
COPY.     ÿ
                                                                     +
l now be prompted (unless you specified all members) to select the   +
 for transfer ÿ

r = new
 trans(trunc(&new,1) Y,Yes N,Noÿ
nl = trans(trunc(&unl,1) Y,Yes N,No y,Yes n,No &z,Yes)
t3 = trans(trunc(&ut3,1) Y,Yes N,No y,Yes n,No &z,No)
host = &thost                                   ÿ
  if (&thost = '*****')
      &xhost = 'multiple target hostnames'
                                                                 +
     )Proc                                                       ÿ
        &new = trans(trunc(&new,1) Y,Yes N,No y,Yes n,No *,*)
        &unl = trans(trunc(&unl,1) Y,Yes N,No y,Yes n,No *,*)
     ÿç
              ÿ
                        ver (&unl,nb,list,Yes,No)
                    ÿ
                         )End  <
                           {
                                   ÿ
s(low )                   information only  */              % type( inpu
s(high) caps(on ) just(left )                             ÿ
ens(high) caps(off) just(left )                   ÿ
ens(high)  caps(off) just(left ) color(yellow)                  @ type(o
ntens(high)  caps(off) just(left ) color(white)                 ~ type(t
ntens(high) color(blue) hilite(reverse)                        )Bÿ
                                                                 +------
----------~TCP/IP FTP Space Verification+------------------------+
            ÿ
ÿ
                                                                     + T
taset:   @targdsn            ÿ
               ÿ

FM:         _sysrecfm`     Record Format      ÿ
RECL:         _syslrecl`     Lÿ
 BLKSIZE:       _blk     `     Blocksize or 0 for System Determined Blks
                                                               ÿ
SPACE=                                       ÿ
 +   Allocation:    _sp     `       Blocks, TRK, or CYL
 +   Primary:       _pri     `      Primary space allocation
ÿ
     +   Directory:     _direct`        Directory blocks if a PDS
     +   Release:       _rel`           Release (Yes or No)
     +           ÿ
         +Optional:
         +   Device:        %tunit    `     Optional target device or es
         +   Volser:        %tvol ÿ
          ÿ
             )Init
               &sp = trans(trunc(&sp,1) B,Blocks T,ÿ
                 &rel = t+
                 )ReIniÿ
                     &sp = trans(trunc(&sp,1) B,Blocks b,Blocks T,TRK ÿ
CYL c,CYL)             &rel = trans(trunc(&rel,1) Y,Yes N,No &z,Yes)
                     )Proc            ÿ
                         &sp = trans(trunc(&sp,1) B,Blocks b,Blocks T,TR
CYL c,C+
     ÿ
                               Ver (&rel,nb,list,Yes,No)
                             )End
                      °        {
                                                             /* + type(t
ntens(low )                   information only  */           /* _ type(
ntens(high) caps(on ) just(left )               */            ÿ
 inÿ
t) intens(high) caps(off) just(left ) pad('_')                      ` ty
t) intens(non)  caps(off) just(left )                               % ty

ext) intens(high) color(yellow)                                      )Bo
                                                                     +--
-------------~FTÿ
 Processing Option:%===>_OPT

-~Browse+the generated FTP job   ÿ
  E -~Edit+the generated FTP job
  BL-~Browse+the generated Load JCL job
  EL-~Edit+the generated Load JCL job             ÿ
 %    S -~Submit+the generated FTP job
 +
 ~    Target host: @thost                                          ÿ
     +
     %Review/Update:                                        ~See Help fo
nfo+ +     Local Batch Job Card:
    ÿ
       +  ===> _lj2
       +  ===> _lj3
       + +     Reloadÿ
ame Info...+  ===> _rj1
           +  ===> _rj2
           +  ===> _rj3               ÿ
               + )INIT                   ÿ
                    .CURSOR = OPT
                    .help = ftpbh2                       ÿ
                      &OPT = &Z                         ÿ
                       )PROC
                        VER (&OPT,LIST,B,E,S,BL,EL)
                         )END                                          ÿ
                           
                                                     /* + type(text  ) i
w )                   information only  */           /* _ type( input) i
gh) caÿ
s(high) caps(off) just(left )                               $ type( inpu
s(high) caps(off) just(left ) pad('_')                      ` type( inpu
s(non)  caps(off) jusÿ
ens(high)                                                       ~ type(t
ens(high) color(yellow)                                      )Body
                                    ÿ
-----~FTP ÿ
ing Option:%===>_OPT                                             +
                                                   ÿ
se+the generated FTP job   ÿ
it+the generated FTP job                                             %
bmit+the generated FTP job                                        ÿ
eXecute+FTP~now+in the foreground           ÿ

rget host: @thost
 ÿ
view/Update:
   Local Batch Job Card:
=> _lj1         ÿ
  ===> _lj2
  ===> _lj3
 )INIT                         ÿ
    .cursor = oÿ
      .help = ftpbh1
      &opt = &z                               ÿ
       )PROC                    V
          ver (&opt,list,B,E,S,X)
         )END                                                +
           
                                       @ type( input) intens(high) caps(
t(left ) pad('_') color(turq)          ` type(text) intens(high) caps(of
asis ) color(yellow)                   ~ÿ
ust(asis ) color(turq)                     % type(text) intens(high)
                                           # type(text) intens(high) col
 hilite(reverse)                           )BODY WINDOW(5ÿ
         ÿ
r Prompt+                                      %Command ===>_ZCMD

                        ÿ
.4 like panel from which                            `you should issue an
 command for any data sets                          `which have a volser
AT`otherwisÿ
transfer.
                                                        `Press PF3 (END)
inue                        I                         ÿ
                                                           )End
                                                           

       @ type( input) intens(high) caps(on ) just(left ) pad('_') color(
       ` type(text) intens(high) caps(off) just(asis ) color(yellow)
       ~ÿ
    ÿ
           # type(text) intens(high) color(turq) hilite(reverse)
           )BODY         ÿ
                   ÿ
               %Command ===>_ZCMD
                                          ÿ
                 +This selection tÿ
s to be            +transfered using FTP from this system to another.  A
aka DF/DSS)        +is used to unload all eligible datasetsÿ
file to be           +sent via FTP and then reloaÿ
                       +
                       `Notes:+
                         +Datasets that are in MIGRAT status wilÿ
ible for processing.       +No`Selections+or`Exclusions+will cause all e
datasets to be processed.  `Select+and`Exclude+are mutually exclusive.
             ÿ

                                 +
                                ÿ
o Select a dataset                  `M+to Migrate a dataset using DFSMSh
o UnSelect oÿ
                                     +           ÿ
                                       +See the DFSMSdss documentation f
er information on Select (Iÿ
                                         )Init                    n
                                           )End
                                          ÿ
ault(%+_)                                                              @
nput) intens(high) caps(on ) just(left ) pad('_') color(turq)          `
xt) intens(high) caps(off) just(asis ) color(yellow)     ÿ
e(output) intens(high) caps(off) just(asis ) color(turq)
e(text) intens(high)
e(text) intens(high) color(turq) hilite(reverse)
DY         ÿ
              #Patience - Calculating the Space Requirements+
Command ===>_ZCMD
       ÿ
    #Patience+     #Patience+     #Patience+     #Patience+     #Patienc

              `The diaÿ
                  `required for the unload of the selected datasets.

       )Init                         ÿ
           )End
           
                                     @ type( input) ÿ
t(left ) pad('_') color(turq)          ` type(text) intens(high) caps(of
asis ) color(yellow)                   ~ÿ
ust(asis ) color(turq)                   % type(text) intens(high) ÿ
                                           # type(text) intens(high) col
 hilite(reverse)                           )BODY         ÿ
                                                             #Patience -
g ÿ

                                                  #Patience+     #Patien
#Patience+     #P+
               ÿ
uilding a lisÿ
e some time depending on how generic                              `your
n criteria is.                ÿ
                              ÿ
 ~sdsname                                                  )Init
                                             ÿ
                                               º               

         /* + type(text  ) intens(low )                   inÿ
           /* _ type( input) intens(high) caps(on ) just(left )
            ÿ
                $ type( input) intens(high) caps(off) just(left ) pad('_
                  ` type( input) intens(high) caps(off) just(left) color
                  # type( inpÿ
                    % type(text) intens(high)
          ÿ
                   )Body                      ÿ
                     +-------------------------~FTP Remote Hostname Upda
---------------------%Comÿ
                       +                                       ÿ
                         +  Hostname:     `targhost
                         +  Description:ÿ

ÿ
                                                       ÿ
                               +===> _rj1
                 ÿ
                               + +===> _rj3                           ÿ
                                 + )INIT
                                  ÿ
                                        .CURSOR = thdesc
     ÿ
                                          .CURSOR =2  rj1
                                         )PROC
                    ÿ
                                           
lt(%+_)                                                              /*
ext  ) intens(low )                +
( input) intens(high) caps(off) jÿ
type(text) intens(high)  caps(off) just(left ) color(yellow)
type(output) intens(high)  caps(off) just(left ) color(blue)
type(text) intens(high)                         ÿ
~ type(textÿ
Body window(67,16)
------------~TCP/IP FTP Batch Submission Information+----------ÿ
 %Command ===>_Zcmd         ÿ
   `
   ` Successfully submitted JOB: @jobname
     `                                       ÿ
       ` The Batch JOB that was just submitted will transfer the unloade
       ` data set to the target host site.  After the data set is
       ` tranÿ
           ` unloaded datasets using DF/DSS.
           `
           ` This original Bÿ

               ` minute period then it will retrieve the Reload JOBs pri
               ` If the Reload JOB does notÿ
iod             ÿ
the                ` Reload JOBs print out there.
                   )Init                                  ÿ
                     )Proc       s
                       )End
                       
                                                   /* + type(text  ) int
)                   information only  */           /* _ type( input) int
) caps(on ) just(left )               */            ÿ
gh) capsÿ
high) caps(off) just(left ) pad('_')                      ` type( input)
high) caps(off) just(left ) pad('_') color(blue)          % type(textÿ
high)                  ÿ
s(high) color(yellow)                                      )Body
                                                           +------------
-----~ÿ
md                                                             +
                                                               +  Curren
me: @currhost          ÿ
me:     `targhost                                  ÿ
cription: #thdesc                          +                         +
                                          ÿ
/Update Remote Job Card information:                              ÿ

rj1                                                        ÿ
 _rj2
 ÿ
IT
.CURSOR = targhost
PROC            ÿ
  VER (&targhost,nb)
 )END        ˆ
   
                               /* % type(text  ) intens(high)
lts displayed for */           /* + type(text  ) intens(low )
information only  */           /ÿ
(left )               */              ! type( input) intens(high) caps(o
(left ) pad('_')                      ^ type( input) intens(low ) caps(o
(asis ) pad(' ')                      @ type( inpÿ
just(right) pad(' ')                      ~ type(text) intens(high) colo
hilite(reverse)                           ` type(text) intens(high) colo
                                       )Body  Expand(//)          ÿ
                                           %-/-/- ~FTP Dataset Selection
                                           %Command ===>_zcmd
              / /%Scroll ===>_amt +        %
   ÿ
+to refresh the list or`Cancel+                +Selection Options:`S+Sel
select`E+Exclude or`R+Recall and`M+Migrate     +No selection will transf
on-MIGRAT datasets. ÿ
                                                   %Sel  Action  Dataset
                                Dsorg Size  Volume +
                                     ÿ
                                                       !z+  ^z      ^z
                                   ^z    @z   +^z      )Init
                                                      ÿ
ion cmdsn zdldsorg zdlsize zdlvol)'                          &amt = csr
                                                             .help = ftp
                                                           )Reinit     +
                                                                .cursÿ
d                                                                )Proc
                                                                 if (&zs
          ÿ
z   ÿ
list,S,U,\,E,R,M,&z)                                                 )En
                           Î                                           

                   /* % type(text  ) intens(high)              Defaults
d for */           /* + type(text  ) intens(low )                   info
only  */           /ÿ
          */              ! type( input) intens(high) caps(on ) just(lef
'_')                      ^ type(output) intens(low ) caps(off) just(asi
' ')                      # type(outpÿ
pad(' ')                        hilite(uscore)
                              ~ type(text) intens(high) color(blue) hili
se)                           ` type(text) intens(highÿ
                               )Body  Expand(//)
                               %-/-/- ~FTP Target Host Selection+ -/-/-
                               %Command ===>_zcmd                      ÿ

                                   +Command Options:  `Find+to find a st
                                   +Selection Options:`C+to clone`D+to d
to updatÿ
                                       %Sel  Action  Target Hostname
                                       +                    Description
                         ÿ
                                           )Model
                                           !z+  ^z       ^z
                                          ÿ
                                               )Init
                                                 .ZVARS = '(hsel tsel ta
hdesc)'                                          &amt = csrÿ
                                                   )Reinit
                                                   )Proc
                                                   )End
                                                       
0)Attr Default(%+_)
 /* + type(text  ) intens(low )                   information only  */
 /* _ typÿç
  */            ÿ
                    $ type( input) intens(high) caps(off) just(left ) pa
                    ` tyÿ
                      % type(textÿ
                        ~ type(text) intens(high) color(blue) hilite(rev
                        # type(output) ÿ
                       )Body                      ÿ
                         +-------------------------~TCP/IP FTP Dialog+--
----------------#ftpbver+%Command ===>_Zcmd           ÿ
                                                                   ÿ
                             +Source Data Set%===>_sdsname
                             +                     member of '*' for ÿ
rs if PDS or pattern x*        +Target Information:
    ÿ
                           +or%?++ Host Data Set %===>_tdsname
    ÿ
                     ÿ
                                     +   Userid    %===>@userid
                 + ÿ
sword%===>`passwvfy+blank for anonymouÿ
                                         +Optional Information:
                                  ÿ
 target system running MVS? Yes or No      +   Binary  ÿ
or No (use No for MVS to MVS)                +   Firewall  %===>@fir+
ess if Yes ===>@firewall                     +   ÿ
                                             %<+      cmds   %===>$other
                                               %<+
                                                        ~Move cuÿ
and press HELP (PF1) or+                                  ~See the IBM T
er's Guidÿ
                                                      .help = ftpbh0

1) &z,Yes Y,Yes N,No *,*) ÿ
n,1) &z,No  Y,Yes N,No *,*)                               &fir = trans(t
r,1) &z,No  Y,ÿ
                                           +
                                         ÿ
c(&mvs,1) &z,Yes Y,Yes N,No y+
unc(&bin,1) &z,No  Y,Yes N,ÿ
trunc(&fir,1) &z,No  Y,Yes N,No y,Yes,n,No *,*)             ÿ
me,nb)                                                               ver
,nb)                                      ÿ
rid,nb)                                                                i
erid NE anonymous)
(&password,nb)                                           ÿ
r (&passwvfy,nb)
r (&password,lÿ
(&fir EQ Yes)
   ver (&firewall,nb)
er (&bin,nb,list,Yes,No)       ÿ
 ver (&mvs,nb,list,Yes,No)
 )Help ÿ
    Field(sdsname)  panel(ftpbhf1)              ÿ
      Field(thost)    panel(ftpbhf2)
      Field(tdsname)  ÿ
        Field(userid)   panel(ftpbhf4)                           ÿ
          Field(password) panel(ftpbhf5)
          Field(passwvfy) panel(ftpbhÿ
            Field(mvs)      panel(ftpbhf6)
  ÿ
              Field(fir)      panel(ftpbhf8)        ÿ
                Field(firewall) panel(ftpbhf8)
                Fieî ld(other)    panel(ftpbhf9)
                  Field(other2)   panel(ftpbhf9)                   ÿ
                   )End
                   {
                                               /* + type(text  ) intens(
  ÿ
caps(off) just(left )                             ÿ
) caps(on) just(left )                                ` type(output) int
)  caps(off) justÿ
)                                                       ~ type(textÿ
gh) color(blue) hilite(reverse)                        )Body
                                ÿ
--~TCP/IP FTP DFSMSdss Prompt+---------------------------%Command ===>_Z
    ÿ
                                               +
SU) will be used to unload the selected data ÿ
g FTP and used there foÿ
                                                                 +   DFS
tions:                                                      ÿ
                                        ÿ
ve use of data set(s) during unload:       %===>_vex+  Yes or No     +
                                                                     +
All data or only Used data                   %===>_val + ÿ

ional Restore Options:
Replace daÿ
    Volser                                         %===>$odyvol+
    Management Class, blank, or NONE               %===>$odymc   +
    Storage Class, blank,ÿ
      Tolerÿ
 +
 )Init                                  ÿ
    .cursor = vex           ÿ
      .help = FTPBPH0
      &vex = trans(trunc(&vex,1) &z,No Y,Yes N,No y,Yesÿ
        &val = trans(trunc(&val,1) &z,Used A,ÿ
          &vrp = trans(trunc(&vrp,1) &z,Yes Y,Yes N,No y,Yes n,No)
          &otenq = trans(trunc(&otenq,1) &z,No Y,Yes N,No y,Yes n,No) ÿ
           )Proc                                              ÿ
              &vex = trans(trunc(&vex,1) Y,Yes N,No y,Yes n,No *,*)
              ver (&vex,nb,list,Yes,No)
     ÿ

                    &vrp = trans(trunc(&vrp,1) Y,Yes N,No y,Yes n,No *,*
                    ÿ
                      &otenq = trans(trunc(&otenq,1) Y,Yes N,No y,Yes n,
              z         ver (&otenq,nb,list,Yes,No)
                       )End        ÿ
                         {
                                                     )Attr Default(%+_)
                                                  ÿ
high) caps(on ) just(left )               */            ÿ
s(high) caps(on ) just(left ) pad('_') color(turq)          ! type(outpu
s(high) caps(off) just(asis ) color(white)                  ` typ+
s(high) caps(off) just(asis ) color(yellow)                   ~ÿ
ntens(high) caps(off) just(asis ) color(turq)                     % type
ntens(high)                                                       + type
 intens(low )                                                       skip
            ÿ
L) Extend(ON)                                                      )Body
                                                                   +----
-----%TCP/IP ÿ
===>_zcmd                                                              %
                                                                       +
                            ÿ
 -----------------------------------------------------------------------
 Help
s panel is used to prompt the user when a sÿ
 been analyzed and determined that DFSMSdss should be used.

 The information that you will be prompted to provide is: ÿ
ÿ
   % Exclusive use of data set(s) during unload:+
   ~
     ~%Yes~means ÿ
       ~ dataset(s).  No other batch or online job/user will be allowed
       ~ use it while your transfer unload is running.  Nor will your jo
       ~ÿ
           ~
           ~%No~means that you don't require exclusive ownership of the
           ~ dataset(s)ÿ
               ~
               % Dump All data or only Used data
               ~                      ÿ
                   %All~will dump all allocated data for the specified d
                   ~
                   %Used~will only dump the used spacÿ
     +
   ÿ
d them.                  ~                                          ÿ
                           %    Replace
                    ÿ
                                 ~%Yes~means that if the dataset exists
arg+
 ÿ
                                       ~%No~means that if the dataset al
ists to leave it alone and             ~ not to replace it.
                ÿ
                                       %    Volser
                                       ~
                               ÿ
et(s) to a specific volume enter           ~    that volser here.
                                           ~
                                           %  ÿ
NE        ÿ
                                               ~    If you want to overr
existing SMS Management Class or have          ~    the existÿ
 specify it here.  A class ÿ
t class to be used during the restore.             ~    NONE may be code
icate no Management class is to be used.           ~
                                            ÿ
, or NONE                                              ~
                                                       ~    If you want
ide the exiÿ
ss ignored specify it here.  A class name will             ~    cause th
torage class to be used during the restore.  NONE          ~    may be c
indicate no Storage class ÿ
                                                               %    Tole
 Failure on Restore                                            ~
                                         ÿ
n an ENQ failurÿ
                                                                   )Init
                                                        ÿ
 zcmd                           G                                      )
                                                                       )
                                                                       <
î

BD                     /* ---------------------  rexx procedure  -------
------- */              ftpbver = "1.190"
                ÿ
          *               *
          *               * Function:  Generate a Batch TCP/IP FTP Job
          *               *    ÿ
            *               * Syntax:    %ftpb send_dsname options
            *               *
            *               *            whereÿ
              *               *             ANONYMOUS
              *               *             BINARY
              *               *             HOST host-name   ÿ
                *               *             MVS or NOMVS
                *               *
                *               * Author:    Lionel B. Dyck
                  *               *            Kaiser Permanente
                  *               *            Walnut Creek, CA 94598
                  *               *            (925) 926-5332
           ÿ
                    *               *
                    *               * Contributions from:
                    *     ÿ
                      *               *   Eric Wolf:
                      *               *   Support added:
                      *               *  ÿ
adrdssu code            *               *   Firewall
                        *               *   Save Password (changed to an
via switch)             *               *   root directoÿ
                          *               *   e-mail: eric.wolff@western
life.com                  *               *
                          *               *   Ole Knudsen              ÿ
                            *               *   GDG level extract routin
                            *               *
                            *               *   Linda Thomas and Skip Ro
 lots ÿ
                              *               *   Skip Robinson - provid
ode to test the return        *               *                   code o
mote submission job. +
                   ÿ
                                  *               *   Werner Kuehnel - m
t suggestions and an updated      *               *                   fi
space routine                     ÿ
                                    *               * Installation custo
:                                   *               *   1. Update the FT
EXX exec for your installation      *            ÿ
                                      *               *   2. Let me know
ssed tagging a section                *               *   3. find 'pdo 9
 uncomment if you have problems       *               *      witÿ
aded datasets that originally have      *               *      a variabl
and a blksize > 32756.                  *               *   4. An ISPF t
used for jobcard information in         *               *      the defau

                                          *               *
                                          *               * History:
              ÿ
000  - 1.190  - fixed anonymous usage       *               *
000  - 1.189  - add TOL(ENQF) option        *               *
              - add ALLDATA(*ÿ
                - corrections for CATALOG     *               *
                  and for VSAM .D and .I      *               *
                  thx to Larry Belikoff     ÿ
11/2000  - 1.188  - add systcpd and systcpds    *               *
                    from Bert Lindeman          *               *
11/2000  - 1.187  - move site vol before mkdir  *          ÿ
1/12/2000  - 1.186  - remove (Exit for online FTP *               *
1/09/99    - 1.185  - fix netrc and allow netrc   *               *
                      in foreground               *               *
                      - change sysout(b) to (a)     *               *
 11/02/99    - 1.184  - fix netrc                   *               *
 10/22/99    - 1.183  - allow Create/Replace to     *               *
         ÿ
   10/20/99    - 1.182  - sort target host table      *               *
   10/15/99    - 1.181  - fix rfind                   *               *
   10/14/99    - 1.180  ÿ
     09/24/99    - 1.171  - move sysftpds to ftpbcust   *
     09/21/99    - 1.170  - add options for direct use  *
     06/27/99    - 1.166  - fix members+
       06/23/99    - 1.165  - fix locÿ
         06/03/99    - 1.164  - fix popup for submit for dss*
         04/21/99    - 1.163  - add locsite lrecl for getput*
         04/20/99    - 1.162  - fix vsam space problÿ
           04/20/99    - 1.161  - Minor cleanup for jobcard   *
           04/19/99    - 1.160  - Move customized options to  *
                                  external exec: ftpbcust     *    ÿ
*                                   - changed variable names    *
*            04/09/99    - 1.151  - Make nmc and nsc upper case *
*            04/09/99    - 1.150  - add variable for unit (3390)*
* ÿ
  *                                 - add target host description *
  *                                 - misc. corrections           *
  *              ÿ
    *            03/23/99    - 1.141  - add SYSFTPD DD (optional)   *
    *            03/23/99    - 1.140  - major change in dfdss       *
    *                           ÿ
      *                                 - add recfm(fb) to intrdr     *
      *                                 - add NETRC DD for batch      *
      *                                   as anÿ
        *            03/19/99    - 1.132  - fixes from Werner
        *                          - for pattern add ** for *
        *                          - fix space variable in somÿ
          *                          - remove quotes from dss dsname
          *                          - test for null 3rd job statement
          *            03/18/99    - 1.131  - unsel for host select
            *            10/17/98    - 1.130  - cleanup submit datasets
            *            .... history cleaned up
            *            06/03/97    - 1.000  - set to Version 1.000
            ÿ
              * --------------------------------------------------------

             arg options   ÿ

               Address ISPEXEC "VGET ZAPPLID"
                 if zapplid <> "FTP" then ÿ
                      Address ISPEXEC
                      "TBCreate ftpcmds names(zctverb zcttrunc zctact zc
                        "replace share nowrite"          +
                        zctverb = "RFIND"              ÿ
                          zcttrunc = 0
                          zctact = "&FTPRFIND"
                          zctdesc = "RFIND for FTP Dialog"            ÿ
                            "TBAdd ftpcmds"
                            "Select CMD(%"sysvar('sysicmd') options ") N
TP)"                        "TBEnd ftpcmds"
     ÿ
                              end

                    ÿ
asswvfy ,                                  ddn big_load odyvol odysc ody

                           Address ÿ
                             "Select Cmd(ftpbcust)"
                             "Vget (sdb vio dasd netrc sysftpd njenode e
avepwd" ,                         "FirIDwH forcejbÿ
pd systcpds) "                 Address TSO

                               /* -------------------------- *   ÿ
                                  * If options is null then    *
                                  * set send dsname (sdsname)  *
                                  * -------------------------- */
ÿ
                                       parse value options with sdsname
                                       else sdsname = null
               ÿ
                                     /* --------------------------------
------------- *                       * Test and process any options
              *               ÿ
Yes or No       *                       *    ANONYMOUS sets the userid t
ous             *                       *    BINARY sets the bin value t
                *                       *    ÿ
host name         *                       *         supplied as the next
 the options      *                       * ----------------------------
----------------- */                      if length(more) > ÿ
                                               If wordpos("MVS",more)
 mvs = "Y"                                     If wordpos("NOMVS",more)
 mvs = "N"                                     If wordpos("BINARY",more)
hen bin = "Y"                                    If wordpos("ANONYMOUS",
> 0 then userid = "anonymous"                      If wordpos("HOST",mor
hen do                                                x = wordpos("HOST"
                                                      thost = word(more,
        ÿ
                                                     end

                       ÿ
 *                                                  * Set default Enviro
 *                                                  * ------------------
 */                                   ÿ

                                                     /* ----------------
-- *                                                 ÿ
ol   *                                                  * --------------
---- */                                                 "Vput (ftpbver s
                                                                    ÿ
                                                         /* ------------
------ *                                                  * Get basic in
n      *                                                  * ------------
---ÿ
)"
                                                           /* ----------
----------- *     ÿ
d then get it *                                               * --------
------------- */                                              if savepwd
n                                ÿ
rd passwvfy) Profile"
                                                               Start:
                                                ÿ
-------------- *                                                  * Do F
isplaying      *                                                  * the
el             *                                               ÿ
---------------- */                                                 Do f
                                                                       p
ue null with ftp. load. members unl do_pds_flag od ,
hst submit_flag loadjcl_dsn_flag dss
= 0
= 0
= 0          +
ded.0 = 0  ÿ
ected.0 = 0
loadjcl_dsn_flag = 1 then
if submit_flag <> 1 then cÿ
ubmit_flag      = null
oadjcl_dsn_flag = null
                                         ÿ
 if shost <> null then do
    thost = shost
    shost = null                                        ÿ
      end
   if thost = "*****" then thost = "?"
                                                                       ÿ
     ftprfind = "PASSTHRU"
     "Vput ftprfind"

     "ÿ
       if rc > 4 then do
                      if savepwd = 1 then exit
                     ÿ
                        exit
                        end
                   else             ÿ
                    if sdsname = "EGG" then do
                       Address TSO "%ftpbcrdt"
                       sdsname = null              ÿ
                         end
                      else call do_it
             end                                                  ÿ

           /* ----------------------------------------------------------
            * Start the actual processing with the Do_It procedure.
 ÿ

              Do_It:
              "Vÿ
                "Vput (fir firewall) Profile"

               /* -------------+
                  * Clear somÿ
                    * -------------------------- */
                    parse value null with to_mem to_dsn from_dsn sdsname
                                          tdÿ
                                            sysalloc sysseconds direct s

                     /* -------------------------- *       ÿ
                        * Find sending member ?      *
                        * or if multiple dsn xfer ?  *
                        * -------------------------- */
                         Select
                         when pos("(",sdsname) > 0 then do
                            parse value sdsname with sdsnamex "(" member
         ÿ
                                 When pos(left(members,1),"-+") > 0 then
t_gdg                            When datatype(members) = "NUM" then cal
g                       ÿ
                                   end
                                if gdg = null then
                                   if lÿ
                                        sdsnamex = sdsnamex"'"
                                  end
                               /* --------------------ÿ
--------- *                       * Look for wildcard.
          *                       * - set multiple flag on
          *                       * - if .* then make .** as df/dss rÿ
hat for     *                       *   more than a single level
            *                       * ----------------------------------
----------- */                     when pos("*",sdsname) > 0 then do
    ÿ
                                          sdsname = substr(sdsname,2,len
ame)-2)                                 if right(sdsname,2) = ".*" then
                   ÿ
                                             end
                                          multiple = "on"
                                  ÿ
                                         otherwise nop
                                         end
                                                 +
                                           /* -ÿ
                                              * Find target member ?
                                              * ------------------------
                                             if length(tdsnameÿ
mex = tdsname                                  if pos("(",tdsname) > 0 t
                                                  parse value tdsname wi
mex "(" to_mem ")"                                if left(tdsname,1) = "
n                                                      tdsnamex = tdsnam
                                                    end

            ÿ
 *                                                  * Set from dsname va
 *                                                  * ------------------
 */                        ÿ
n do                                                    from_dsn = sdsna
                                                        end
                                          ÿ
                                                            from_dsn = s
                                                            sdsnamex = s
                                                         ÿ

                                                         if pos("'",sdsn
0 then                                                      if pos("(",s
x) > 0 then do                                                   parse v
name with "'" from_dsn "(" .                                     from_ds
rom_dsn"'"                                                       end
       ÿ
                                                             if length(t
 > 0 then do                                                    to_dsn =
x                     ÿ
                                                                  end
                                                                  else i
"Yes" then do                        ÿ
x = sdsnamex
  = tdsnamex
x = tdsnamex                                        ÿ

                                                                   if po
snamex) > 0 then                                                   +
(",tdsnamex) > 0 then do                                         ÿ
se value tdsnamex with "'" to_dsn "(" to_mem .
dsn = "'"to_dsn"'"

ÿ
namex = translate(tdsnamex)
dsn   = translate(to_dsn)
               ÿ
ength(to_mem) > 0 then to_mem = translate(to_mem)

------------------------ *    ÿ
Test status of the source  *
data set.                  *
-------------------------- */                ÿ
if multiple = null then do
   call listdsi sdsnamex 'dir'
   sysreason = sysreason /* remove leading zero's */        ÿ
     if sysreason = 5 then do
        zedsmsg = "Source DSN Error"
        zedlmsg = "DSN" sdsname ,
                    "Invalid dsname or dsname not found"
          "Setmsg Msg(isrz001)"
          return
          ÿ
         if length(members) > 0 then do
            dsn_stat = sysdsn(sdsnamex)
            if dsn_stat <ÿ
                 zedsmsg = "Source DSN Error"
                 zedlmsg = "DSN:" sdsname dsn_stat
                 "Setmsg msg(isrz001)"  ÿ
                   return
                   end
                end                                    ÿ
            end

           /* -------------------------- *                            ÿ
              * Check target Hostname      *
              * -------------------------- */
              shost = thost
     ÿç
                            zcmd = null
                            if savepwd = 1 then
                    ÿ

                              if thost = "?" then thost = "*****"
                                   ÿ
                               /* --------------------------------------
------------ *                  * Build password for anonymous connectio
 the current *                  * userid and hostnÿ
               *                  * ------------------------------------
-------------- */                 if userid = "anonymous" then
                                     if length(password) = 0 thenÿ
                                          res= Socket('Initialize','ANYN
                                          xhost=      Socket('GetHostId'
                                          phost = Socket('GetHostByAddr'
ÿ
                                            password = sysvar('sysuid')"
host,2)                                     end
               ÿ
                                       /* ------------------------------
-------------------- *                  * Get a unique id character for
card along with the  *        ÿ
n.                     *                  * ----------------------------
---------------------- */                 call get_jobid
                                          mlqÿ
                                            if length(zprefix) = 0
                                               then  hlq = zuser
                                               else  hlq = zÿ

                                              "Vget (lj1 lj2 lj3) Profil

                                               /* ----------------------
                                                * Setup Default Job Card
                                                * ----------------------
          ÿ
itial_jobcard
                                                 /* --------------------
                         +
 *                     ÿ
-- */                                                 call setup_local_j
                                                      ftp.4  = "//*-----
----------------------------------*"  ÿ
ch JCL Generated by FTPB Dialog     *"                  datex = left(dat
                                                        timex = left(tim
                                                     ÿ
se" ftpbver "on" datex "at" timex "  *"                   ftp.7  = "//*-
--------------------------------------*"                  ftp.0  = 7
                                                                    ÿ
                                                           /* ----------
-------- *                                                  * setup relo
ard      *                                                  * ----------
---ÿ
 do                                                              load.1
                                                                 load.2
                  ÿ
3                                                                  end
                                                                   else
up_remote_jobcard                ÿ
----------------------------------------------*"                  load.5
   FTP ReLoad JCL Generated by FTPB Dialog    *"                  load.6
   Release" ftpbver "on" datex "at" timex "  *" ÿ
*-----------------------------------------------*"                  load

                                                               ÿ
                                                                     lj2
                                                                     lj3

                                                                       r
d.1                                                                    r
d.2                                                                    r
d.3          ÿ

---------------------- *
he pds is a pdse then  *    ÿ
t directory blocks = to  *
mbers/3 for ftp.         *
------------------------ */                +
 sysadirblk = "NO_LIM"                   ÿ
   then sysadirblk = sysmembers / 3

   parse value sysadirblk with sysadirblk '.' .         ÿ

  select
     when sysunits = "TRACK"    then do                                ÿ
                                       space = "TRK"
                                       sp    = "TR"
                                       end
      ÿ
                                         space = "CYL"
                                         sp    = "CY"
                     ÿ
           when sysunits = "BLOCK"    then do
                                           space  = sysblksize
                                    ÿ
                                             end
             otherwise do
                       space = "TRK"               ÿ
                         sp    = "TR"
                         end
               end                                                ÿ

                 if sp = "TR" then site_sp = "Tracks"
                              else site_sp = sp
 ÿ
               /* -------------------------- *
                * Set target dsname          *
                ÿ
                 if length(to_dsn) = 0 then do
                    if mvs = "Yes"
                       then tarÿ
                         else targ_dsn = to_dsn
                         end
                   if length(to_dsn) > 0      ÿ
                        then targ_dsn = to_dsn
                        else targ_dsn = null
                      balloc = "("sysalloc","sysseconds")"   +
                        palloc = "("sysalloc","sysseconds",ÿ
                          direct = sysadirblk

                         /* -------------------------- *
                            * Setup for PDS Member Xfer  *
                            * But first check the        *
                            * Check for dsorg types      *
         ÿ
                              Select
                              When multiple = "on" then do
                        ÿ
                                   do until zcmd = null
                                      call Do_Pattern
                                      eÿ
                                     zcmd = null
                                     if cancel = 1 then call start
                                     if lrc <> 0 then ÿ
                                          zedsmsg = null
                                          zedlmsg = "No datasets match p
 sdsname,                                           "a dsname patternÿ
e a valid hlq."                             "Setmsg msg(isrz000)"
                                            call start
                                            end
    ÿ
                                           dss = "Yes"
                                           "Display Panel(ftpbpdss)"
                   ÿ
                                              * change the primary and
                                              * secondary allocations in
                                  ÿ
                                                * and general usage for.
                                                * ----------------------
                                                bÿ
ult_space")"                                      sysalloc   = mult_spac
                                                  sysseconds = mult_spac
                                                 call build_dumpÿ
                                                   end
                                                When sysdsorg = "VS" the
                                                   unl = "Yes"

                                                       "Display Panel(ft
                                                       call build_dump
                                                       end
            ÿ
do                                                       unl = "Yes"
                                                         dss = "Yes"
                           ÿ
ss)"                                                       call build_du
                                                           end
                                          ÿ
then do                                                      unl = "Yes"
                                                             dss = "Yes"
                                                         ÿ
pbpdss)"                                                       call buil
                                                               end
                                                            When sysdsor
O" then do                                                       if sysr
"U" then                                                            unl
                                                                 call do
       ÿ
 then return                                                       end
                                                                When sys
"PS" then do          ÿ
p                                                                    nn
+ 1                                                                  if
es" then do                          ÿ
 = "Site pri="sysalloc "sec="sysseconds site_sp
n + 1
                                                    ÿ
_dsn = targ_dsn then
nn = "Put" from_dsn
 do                                                                ÿ
   if length(from_dsn) + length(targ_dsn) < 50 then
      ftp.nn = "Put" from_dsn targ_dsn
      else do
  ÿ
             nn = nn + 1
             ftp.nn = targ_dsn
             end +
       end     ÿ
 ftp.0 = nn
 unl   = "No"
 end                          ÿ
Otherwise do
    zedsmsg = "*Error*"
    zedlmsg = sdsname "is an unsupported fileÿ
                "of" sysdsorg
      "Setmsg Msg(isrz001)"
      return                                                ÿ
        end
    end

     /* -------------------------- *
      * Closing FTP instructions   *
      * -------------------------- */
      nn =ÿ
        ftp.nn = "Close"
        nn = nn + 1
        ftp.nn = "Quit"  ÿ
          nn = nn + 1
          ftp.nn = "/*"
          if unl = "Yes" then do        ÿ
              nn = nn + 1
              ftp.nn = "//DELSTEP  EXEC PGM=IEFBR14"
              nn = nn + 1                              ÿ
                ftp.nn = "//DELLOAD  DD DISP=(OLD,DELETE),"
                nn = nn + 1
                ftp.nn = "//            DSN="hlq"."loadjcl_dsn        ÿ
                  ftp.nn = translate(ftp.nn)
                  nn = nn + 1
                  ftp.nn = "//DELULOAD DD DISP=(OLD,DELETE),"
     ÿ
                    ftp.nn = "//            DSN="hlq"."unload_dst
                    ftp.nn = translate(ftp.nn)
                    ÿ
                      ftp.nn = "/*"
                      end
                    ftp.0 = nn     +
                                 ÿ
                       /* ----------------------------------------------
 *                      * Now if unl is 'Yes'  go build the jcl to print
 *                      * that was submitted andÿ
   *                      * --------------------------------------------
-- */                     if unl = "Yes" then
                             call set_ftpget_jcl               ÿ

                           /* ------------------------------------------
-------- *                  * Display for Edit, Browse, Submit or eXecut
generated  *                  * JCL and FTP control statements.
           *                  * ----------------------------------------
---------- */
             ÿ
                                  /* -------------------------- *
                                   * Create local jcl           *
                            ÿ
                                     rwlj = 1
                                     call do_local_jcl
                                           ÿ
                                      /* -------------------------- *
                                       * Create remote jcl          *
                                       * -----------------ÿ
                                         if unl = "Yes" then do
                                            rwrj = 1
                                            call do_remote_jcl
                                              end
                                           end

        ÿ
                                             "Vput ftprfind"

                       ÿ
------------------------ *                  * Begin the transfer process
                         *                  *
                         *            ÿ
e multiple target hosts    *                  * ------------------------
-------------------------- */                 if mhst = null then
                                                 Call+
                                                elsÿ
                                                     /* ----------------
------------------------------ *                      * Process each hos
ion                            *                      * ----------ÿ
-------------------------------- */                      do hn = 1 to wo
)                                                              phost = t
                                                               thost = w
,ÿ
                                                                 call Do
                                                              end
                ÿ

                                                        Return
                               ÿ
                                                         /* ------------
--------------------------------------- *                 * Alloc and wr
rated jcl to vio data set for browse,   *     ÿ
Xecute.                                   *                 *
                                          *                 * Note: the
 is only included in the submitted file.  *                 *ÿ
------------------------------------------- */                do_local_j
                                                              if rwlj =
eturn                                                         if ddn <>
hen do                                                             "LMFr
d("dataid")"                                                       x=msg
                                                                   Addre
Free  f("ddÿ
                                                                  ddn =
dom()                                                             Addres
                          ÿ
n") new Unit("vio") spa(1,1) tr" ,
m(F b) Lrecl(80) Blksize(0) Reuse"                                  "Exe
skw" ddn "(Finis stem ftp."              ÿ
PExec                                                                 "L
taid(dataid) DDName("ddn")"                                           re
                                                        ÿ

--------------------- *
 out reload jcl dsn   *                                                +
----------------------- */                                           ÿ
emote_jcl:
f rwrj = 0 then return
f unl = "No" then return
ddreÿ
 if loadjcl_dsn_flag = 1 then do
   x=msg("off")
   "Free F(Reload)"ÿ
     "Delete '"hlq"."loadjcl_dsn"'"
     end
   "Alloc f(Reload) new Unit("dasdÿ
            "Lrecl(80) Blksize(0) Reuse ds('"hlq"."loadjcl_dsn"')"
     "Execio * diskw reload (Finis Stem load."
     "Free  f(Reload)"                           ÿ
       loadjcl_dsn_flag = 1
       Address ISPExec
       return                                                   ÿ

      Do_Pds:
         if do_pds_flag = 1 then return

           "Lmopen Dataid("dataid") Option(Input)"
           if pos("*",members) = 0 then
              ÿ
                        "Commands(Any) Panel(FTPBM)"
                else do
                 call build_lÿ
                  "Lmmdisp Dataid("dataid") Option(Display)",
                          "Commands(Any) Panel(FTPBM) Member("members")"
                   end                      ÿ
                   do while rc == 0
                      Call process_selection
                     "Lmmdisp Dataid("dataid") Option(Get)"ÿ
                        if rc == 8
                           then "Lmmdisp Dataid("dataid") Option(Display
                                "Commands(Any) Panel(FTPBM)"
                       end
                       "Lmmdisp Dataid("dataid") Option(Free)"
                       "Lmclose Dataid("dataid")"
         ÿç
                                    /* -------------------------- *
                                     * drop pattern member if > 1 *
                        ÿ
                                       * -------------------------- */
                                       if words(members) = 1 then do
                                       ÿ
                                                 then members = all_mem
                                              end
                                         else do      ÿ
                                              member_count = words(membe
                                              new_mem = null
                                              do mx = 1 to member_couÿ
                                                   if pos("*",word(membe
= 0                                                   then new_mem = new
d(members,mx)                                   end
    ÿ
                                               end
                                               do_pds_flag = 1
                   ÿ

                                            Process_Selection:
                                  ÿ
                                                    then parse value fro
th "'" w_dsn "'"                                    else w_dsn = sysvar(
")"."from_dsn                                    ÿ
                                                   Select
                                                   When zllcmd = "/" × z
"S"                                                    Then do  ÿ
                                                           "Lmmdisp Data
id") Option(Put) Member("zlmember")",                          "Zludata(
)"                                                         call do_sel z

                                                       When zllcmd = "\"
d = "U"                                                    Then do
              ÿ
dataid") Option(Put) Member("zlmember")"                       call do_u
mber                                                           end
                             +
                           ÿ
id("dataid") Member("zlmember")"                             Otherwise n
                                                             End
                                          ÿ

                                                             Do_Sel:
                                                         ÿ
ure we don't already have it */                                  if word
mber,members) > 0 then return                                    /* now
nto our list */                                                  members
ip(members zlmember)                                               retur

                                                                 Do_Usel
       ÿ
(zlmember,members)                                                   mem
elword(members,p,1)                                                  ret
                      ÿ
                                                                   /* --
---------------- *                                                  * Ge
ue jobid by      *                   ÿ
the last char      *                                                  *
------------------ */                                                 Ge
                                                    ÿ
OBSUF) PROFILE"
h(jobsuf) = 0 then jobsuf = "A"
                                                                   ÿ
suf = translate(jobsuf, ,
       'BCDEFGHIJKLMNOPQRSTUVWXYZA1234567890', ,
       'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789')
(Jÿ
rn

embers:          ÿ
 commented out as this works with pdo 9712          */
 if sysrecfm = "U" then do                          */
    if sysblksize > 32759 then bÿ
/*    unl = "Yes"                                     */
/*    end                                             */
                                               +
     if mvs = "No" then                      ÿ
             if unl = null then do
                new = "No"
                unl = "No"                                  ÿ
                  end
         if mvs = "Yes" then new = null

           "Display Panel(ftpbppds)"
              if rc > 4 then return 4

        /*ÿ
          /* if unl = "Yes" then                                */
          /*    if sysrecfm <> "U" then                         */
          /*       if sysÿ
            /*          "Display Panel(ftpbpwrn)"                 */
            /*          zedsmsg = "Error"                         */
            /*          zedlmsg = "FTP Rÿ
              /*                    "of unsupported blksize"        */
              /*          "Setmsg Msg(isrz001)"                     */
              /*          return 4                     ÿ
                /*          end                                       */

                   Select                                             ÿ
                     when unl = "No" then do
                        call set_ftp
                        put = "Put "
     ÿ
                          nn = ftp.0
                          if mvs = "Yes" then do
                    ÿ
                                  Call ftp_site_info
                                  nn = nn + 1
                                  fÿ
                                    nn = nn + 1
                                    ftp.nn = "Site recfm="sysrecfm "lrec
ecl ,                                        " blkÿ
                                      nn = nn + 1
                                      if direct > 0 then
                                         direct = "Directory="dir+
                                        ftp.nn = "Site pri="sysÿ
seconds ,                                           direct site_sp
                                          if length(tunit) > 0 then ns =
tunit                                                          else ns =
                                            if length(tvol) > 0 then nv
e="tvol                                                         else nv
                                            if length(ns)+length(nv) > 0
             ÿ
                                                 ftp.nn = "Site" ns nv
                                                 end
                            ÿ
                                                ftp.nn = "MKDir" targ_ds
                                                end
                                           ÿ
                                                  nn = nn + 1
                                                  ftp.nn = "cd" targ_dsn
                                                  end     ÿ
                                                 end
                                              if mvs <> "Yes" then
                                                 if length(targ_dsn) > 0
do                                                    if new = "Yes" the
                                                         nn = nn + 1
                                                         ftp.nn = "MKDir
sn      ÿ
                                                        nn = nn + 1
                                                        ftp.nn = "cd" ta
                       ÿ
                                                    nn = nn + 1
                                                    ftp.nn = "lcd" from_
                                      ÿ
                                                      end
                                                   When unl = "Yes" then
                                                     ÿ
                                                          end
                                                     Otherwise nop
                                                     end            ÿ

                                                       Select
                                                       When pos("*",memb
 th+
 ÿ
                                                                 do i =
ds(members)                                                      nn = ft
                ÿ
"word(members,i)""putr                                             ftp.0
                                                                   end
                               ÿ
rs) = 0 then                                                         if
o" then do
 ftp.0 + 1                                    ÿ
 = "Mput *"
 = nn
g = ""                                                       ÿ
msg = "*** No members selected so ALL assumed ***"
msg Msg(isrz001)"
                                                                      en
                                                                     Whe
s = "*" then
 "No" then do
  = ftp.0 +ÿ
.nn = "mput *"
.0  =  nn
                          ÿ
rds(members)  = 1 then do
n = ftp.0 + 1
f length(to_mem) = 0 then                ÿ
    ftp.nn = put""members""putr
 else
    ftp.nn = "put" members to_mem                       ÿ
   ftp.0 = nn
   end
n length(members) = 0 then do                                          ÿ
  call do_pds
  If unl = "No" then
     do i = 1 to words(members)
     nÿ
       ftp.nn = put""word(members,i)""putr
       ftp.0 = nn
       end           +
      If words(membÿ
           if unl = "No" then do
              nn     = ftp.0 + 1
              ftp.nn = "Mput *"   ÿ
                ftp.0  = nn
                zedsmsg = ""
                zedlmsg = "*** No members selecteÿ
                  "Setmsg Msg(isrz001)"
                  end
            end                                                 ÿ
           Otherwise nop;
           end
           return

            /* -------------------------- *
             * Build list of all members  *
             *ÿ
               * -------------------------- */
               Build_List:
               Parse value ""ÿ
                 "Lminit Dataid(buildid) Dataset("from_dsn") Enq(Shr)"
                 "Lmopen Dataid("buildid") Option(Input)"
                 do forever                 ÿ
                      "LmmList Dataid("buildid") Option(List) Member(ame
                              "Pattern("members")"
                      if rc > 7 then leave                 ÿ
                        all_mem = all_mem amem
                        end
                     "Lmclose Dataid("buildid")"
                       "Lmfree  Dataid("buildid")"
                       return

         ÿ
                         nn = ftp.0
                         nn = nn + 1
                        ÿ
                              then ftp.nn = "//FTPSTEP EXEC PGM=FTP,PARM
all" (EXIT'"                  else ftp.nn = "//FTPSTEP EXEC PGM=FTP,PARM
" (EXIT'"                  nn = nn + 1 +
                             ftp.nn =ÿ
                               if sysftpd = 1 then do
                                  nn = nn + 1
                                  ftp.nn = "//SYSFTPÿ
s                                   end
                                 if systcpd = 1 then do
                                    nn = nn + 1                    ÿ
                                      ftp.nn = "//SYSTCPD  DD DISP=SHR,D
cpds                                  end

  ÿ
                                        d = date(u)
                                        date = substr(d,7,2)substr(d,1,2
d,4,2)           ÿ
 hh:mm:ss.th */                           t = substr(s,1,2)substr(s,4,2)
,7,2)substr(s,10,1)                       netrc_dsn   = hlq"."mlq".NETRC
.T"t                            ÿ
                                            nn = nn + 1
                                            ftp.nn = "//NETRC    DD DISP
LETE,DELETE),"                              nn ÿ
                                              ftp.nn = "//            DS
_dsn
                                              if fir = 'No' thÿ
                                                      id = userid;
                                                else if fir = 'Yes' then
                                                   if FirIDwH = 0 then d
                                                        id = userid"@"th
                                                        end
                                                     else do
            ÿ
                                                          end
                                                       end
                           ÿ
                                                         pw = password
                                                      else
                                          ÿ

                                                        netrc.1 = "MACHI
t "LOGIN" id "PASSWORD" pw                               +
                                                       ÿ
                                                            "Alloc f(net
w Unit("dasd") spa(1,1) tr" ,                                      "Recf
,                                                                  "Lrÿ
 Blksize(0) Reuse ds('"netrc_dsn"')"                          "Execio *
trcdd (Finis Stem netrc."                                     drop netrc
                                                              "Free  f(n
     ÿ
                                                             end

                    ÿ
----------------------------------- *                       * Now create
NPUT DD                             */                         nn = nn +
                                   ÿ
UT    DD *"
                                                                 if netr
en do                                             ÿ
Yes' then do
DwH = 0 then do
 nn + 1                                                          ÿ
p.nn = userid"@"thost;
d
do
ÿ
ftp.nn = thost;
nn = nn + 1
ftp.nn = useridÿ
  end
nd
 nn + 1                       ÿ
p_password = left('@',length(password),'@')
 fir = "Yes" then
 ftp.nn = ftp_password                       ÿ
else
   ftp.nn = userid ftp_password
                                                            ÿ

tp.0 = nn
f length(other) > 0 then do
    nn = ftp.0 + 1
      ftp.nn = other
      ftp.0 = nn
      end
   if leÿ
        nn = ftp.0 + 1
        ftp.nn = other2
        ftp.0 = nn     ÿ
          end
       if bin = "Yes" then do
          nn = ftp.0 + 1              ÿ
            ftp.nn = "Binary"
            ftp.0 = nn
            end                                      ÿ

           if sysdsorg = "VS" then do
                 nn = ftp.0 + 1                                     ÿ
                   ftp.nn = "mode b"
                   nn = nn + 1
                   ftp.nn = "type e"
   ÿ
                     end
                  else
                  ÿ
                       nn = ftp.0 + 1
                       ftp.nn = "type e"  /* set type ebcdic */
                       nn = nn + ÿ
                         ftp.nn = "mode b"  /* set block mode transfer *
                         ftp.0 = nn
                         end                    ÿ
                        if mvs <> "Yes" then
                           if pos("\",targ_dsn) > 0 then do
                                   if right(targ_dsn,1) = "\" tÿ
                                                                else tds
                                     targ_dsn = translate(targ_dsn," ","
                                     tdw = words(targ_dsn)
                                       do td = 1 to tdw-1
                                          nn = nn + 1
                                          ftp.nn = "cd" word(targ_dsn,td
             ÿç
                                                     if tdsn = 1 then do
                                                        tdw = words(targ
                            ÿ
sn,tdw)                                                   end
                                                          else do
                                           ÿ
                                                               ftp.nn =
d(targ_dsn,tdw)                                                targ_dsn
                                                          ÿ
                                                      end
                                                   ftp.0 = nn
                                                return

                                               Set_FTPGet_JCL:
                                               nn = ftp.0 + 1
        ÿ
JEFT1B,"                                         nn = nn + 1
                                                 ftp.nn = "//
FTPBJOB2 "ftprpt_dsn"'"ÿ
                                                   ftp.nn = "//SYSEXEC
P=SHR,DSN="execlib                                 nn = nn + 1
                                      ÿ
YSOUT=*,DCB=(RECFM=VB,LRECL=255)"                    nn = nn + 1
                                                     ftp.nn = "//SYSTSPR
YSOUT=*,DCB=(RECFM=VB,LRECL=255)"                    ÿ
                                                       ftp.nn = "//SYSTS
 DUMMY"                                                nn = nn + 1
                                                       ftp.nn = "/*"ÿ
                                                         nn = nn + 1
                                                         ftp.0 = nn
                                                         return
   ÿ
                                                       Build_IEBCOPY:
                                                        put = "  S M=("
                  ÿ
                                                          nn = ftp.0 + 1
                                                          ftp.nn = "//UN
C PGM=IEBCOPY"                   +
                               ÿ
NT DD SYSOUT=*"                                               nn = nn +
                                                              if left(fr
) <> "'"                                      ÿ
_send_dsn                                                          else
 = translate(from_dsn)                                          ftp.nn =
T    DD DISP=SHR,DSN="strip(send_dsn,,"'")                   ÿ
                                                                  call s
oad
                                                                  if new
s" then                                                                c
site_info
                                                                    if b
= "Y" then ÿ
 + 1
= "//TEMP  DD UNIT="dasd",DISP=(,DELETE),"
 + 1                      ÿ
n = "//      DCB=(RECFM="sysrecfm",LRECL="syslrecl","
nn + 1
n = "//      BLKSIZE=27998),"            ÿ
= nn + 1
.nn = "//      SPACE=("space","palloc",RLSE)"
                                                        ÿ
 nn + 1
nn = "//OUTPUT   DD DISP=(,CATLG),UNIT="dasd","
 nn + 1                                                                ÿ
p.nn = "//         DSN="unload_dsn","
 = nn + 1
p.nn = "//         SPACE=("space","balloc",RLSE)"
 ut3 =ÿ
   nn = nn + 1
   ftp.nn = "//SYSUT3   DD UNIT=SYSDA,SPACE=(CYL,(50,50))"
   end               ÿ
  nn = nn + 1
  ftp.nn = "//SYSIN    DD  *"
  nn = nn + 1                       ÿ
    if big_load = "Y" then
       ftp.nn = "  COPYMOD INDD=INPUT,OUTDD=TEMP,MAXBLK=27998"
       else ftp.nn = "  COPY INDD=INPUT,OUTDD=OUTPU+
      ftp.0 = nn                                 ÿ

        nn = load.0 + 1
        if new = "Yes"                                          ÿ
             then do
             load.nn = "//DELOAD   EXEC   PGM=IEFBR14"
             nn = nn + 1

                 load.nn = "//DELOAD   DD  DSN="userid"."strip(targ_dsn,
               else
              ÿ
                 load.nn = translate(load.nn)
                 nn = nn + 1
                 load.nn = "/ÿ
                   nn = nn + 1
                   load.nn = "//             UNIT="dasd",SPACE=(TRK,(0))
                   nn = nn + 1              ÿ
                     end
                  load.nn = "//LOAD     EXEC   PGM=IEBCOPY"
                  nn = nn + 1                              ÿ
                    load.nn = "//SYSPRINT DD  SYSOUT=*"
                    nn = nn + 1
                    load.nn = "//INPUT    DD  DISP=(OLD,DELETE),"
                      nn = nn + 1
                      load.nn = "//             DSN="userid"."reload_dst
                      load.nn = translate(load.nn)
         ÿ
                           nn = nn + 1
                           load.nn = "//TEMP     DD  DISP=(,DELETE),UNIT
"                       ÿ
                             load.nn = "//         SPACE=("space","pallo
"                            end
                          nn = nn + 1  ÿ
                            if left(targ_dsn,1) = "'" then
                               load.nn = "//OUTPUT   DD  DSN="strip(targ
")","                          else                   ÿ
                                 load.nn = "//OUTPUT   DD  DSN="userid".
n","                             load.nn = translate(load.nn)
                              nn = nn + 1                            +
                                if new = "No" then                 ÿ
                                     load.nn = "//         DISP=SHR"
                                     else do
                                            load.nn = "//         DISP=(
" ÿ
nit                                                                else
dasd""                                        if length(tvol) > 0 then t
OL=SER="tvol     ÿ
ull                                             nn = nn + 1
                                                load.nn = "//         UN
"tvl","                         ÿ
                                                  load.nn = "//
space","palloc""rlse")"                         end
                                        if ut3 ÿ
                                             nn = nn + 1
                                             load.nn = "//SYSUT3   DD UN
,SPACE=(CYL,(100,50))"                       end              ÿ
                                            nn = nn + 1
                                            load.nn = "//SYSIN   DD *"
                                            if big_load = "Y" then do
                                                 nn = nn + 1
                                                 load.nn = " COPY INDD=I
DD=TEMP"                                         nn = nn + 1
            ÿ
MP,R)),OUTDD=OUTPUT,MAXBLK="t                      nn = nn + 1
                                                   load.nn = "/*"
                           ÿ
                                                     else do
                                                          nn = nn + 1
                                          ÿ
D=((INPUT,R)),OUTDD=OUTPUT"                                 nn = nn + 1
                                                            load.nn = "/
                                                         ÿ
                                                      load.0 = nn

                                                      select
                                                           when length(m
= 0 then                                                      call do_pd
                                                           when pos("*",
 > 1 th+
     ÿ
                                                            end

                    ÿ

                                                              Select
                                   ÿ
*" then nop                                                     When wor
rs) = 1 then do                                                    nn =
                                                  ÿ
o_mem) = 0 then
 put""strip(members)""putr                                           els
                                                                 ÿ
 = put""members","to_mem""putr                                         e
                                                                    When
embers) > 1 then                                                       d
ÿ
 nn + 1
nn = put""word(members,i)""putr
               ÿ
e nop

                              ÿ
_load = "Y" then do
= nn + 1
.nn = "  COPY INDD=((TEMP,R)),OUTDD=OUTPUT"  ÿ
n = nn + 1
tp.nn = "/*"
nd                                                          ÿ
p.0 = nn

 set_ftp

 = ftp.0 + 1
p.nn = "Site pri="sysalloc "sec="sysseconds site_sp
 = nn + 1 ÿ
ftp.nn = "Put '"unload_dsn"'" reload_dst
nn = nn + 1
ftp.nn = "Site pri=1 sec=+
  nn = nn + 1          ÿ
    ftp.nn = "Put '"hlq"."loadjcl_dsn"'" ftpjcl
    nn = nn + 1
    ftp.nn = "mode s"                 ÿ
      nn = nn + 1
      ftp.nn = "Site filetype=jes"
      nn = nn + 1                                    ÿ
        ftp.nn = "Locsite lrecl=255"
        nn = nn + 1
        ftp.nn = "get" ftpjcl  "'"ftprpt_dsn"'"                     ÿ
          nn = nn + 1
          ftp.nn = "site filetype=seq"
          nn = nn + 1
   ÿ
            nn = nn + 1
            ftp.nn = "delete" ftpjcl
            ftp.0 ÿ
              if length(members) > 0 then do
                 members = null
                 do_pds_flag = 1 ÿ
                   end
                 return
                                                ÿ
                   build_dump:
                    nn = ftp.0 + 1
                    ftp.nn = "//UNLOAD EXEC PGM=ADRDSSU"       ÿ
                      nn = nn + 1
                      ftp.nn = "//SYSPRINT DD SYSOUT=*"
                      if left(from_dsn,1) <> "'"
                           then call fix_send_dsn
                           else send_dsn = translate(from_dsn)

             ÿ
                             if sysdsorg = "VS" then do
                                call find_vsam_space send_dsn
                            ÿ
                            call set_unl_load
                            nn = nn + 1
                            ftp.nn = "//OUT+
"                             nn = nn + 1ÿ
                                ftp.nn = "//         DSN="unload_dsn","
                                nn = nn + 1
                                if sysdsorg = "VS" then ÿ
                                     ftp.nn = "//         SPACE=(TRK,"ba
SE)"                              else
                                     ftp.nn = "//         SPACE=("spaceÿ
oc",RLSE)"                          nn = nn + 1
                                    ftp.nn = "//SYSIN    DD  *"
                                    nn = nn + 1
      ÿ

                                      if sysdsorg = "VS" then do
                     ÿ
                                           ftp.nn = "       SPHERE - "
                                           end
                                    ÿ
                                             nn = nn + 1
                                             ftp.nn = "       SHARE TOL(
"                                            end   ÿ
                                            nn = nn + 1
                                            ftp.nn = "       COMPRESS -
                                            nn = nn + 1           ÿ
                                              if multiple <> "on" then
                                                 ftp.nn = "       DATASE
E("strip(send_dsn,,"'")"))"                      else do
 ÿ
do                                                         ftp.nn = "
SET(INCLUDE("strip(sdsname,,"'")"))"                       end
                ÿ
------- *                                                  * Process Sel
tasets  *                                                  * -----------
------- */                     ÿ
                                                              in1 = 0
                                                               ftp.nn =
DATASET( -"                                   ÿ
 0 then do                                                          do i
selected.0                                                             n
 1                                                           +
= 0 then do                                                ÿ
p.nn = "       INCLUDE("selected.i ", -"
1 = 1
d
e
ftp.nn = "                "selected.i ", -"

= nn + 1 ÿ
tp.nn = "       ))"

                        ÿ
--------------------- *
ss Excluded datasets  *
--------------------- */               ÿ
t > 0 then do
= 0
.nn = "       DATASET(INCLUDE("strip(sdsname,,"'")") -ÿ
f excluded.0 > 0 then do
  do i = 1 to excluded.0
     nn = nn + 1                                                     ÿ
       if in1 = 0 then do
          ftp.nn = "       EXCLUDE("excluded.i ", -"
          in1 = 1
    ÿ
         else
            ftp.nn = "                "excluded.i ", -"
         end       ÿ
           nn = nn + 1
           ftp.nn = "       ))"
     end                          ÿ
       end
nd
0 = nn                                           ÿ
 = load.0 + 1
ad.nn = "//LOAD     EXEC   PGM=ADRDSSU"
 = nn + 1                                                       ÿ
load.nn = "//SYSPRINT DD  SYSOUT=*"
nn = nn + 1
load.nn = "//INPUT    DD  DISP=(OLD,DELETE,DELETE), "

    load.nn = "//             DSN="userid"."reload_dst
    load.nn = translate(load.nn)
    nn = nn + 1
    load.nn ÿ
      nn = nn + 1
      load.nn = "  RESTORE INDD(INPUT) -"
      if sysdsorg = "VS" thÿ
           nn = nn + 1
           load.nn = "          SPHERE - "
           end                            ÿ
          if odymc <> null then do
             Select
               when odymc = "NONE" then mc = "NMC"       ÿ
                 otherwise mc = "MGMTCLAS("odymc")"
                 end
               nn = nn + 1
                 load.nn = "         " mc "- "
                 end
              if odysc <> null then do
       ÿ
                     when odysc = "NONE" then sc = "NSC"
                     otherwise sc = "STORCLAS("odysc")"
                     eÿ
                     nn = nn + 1
                     load.nn = "         " sc "- "
                     end             ÿ
                    if odyvol <> null then do
                       nn = nn + 1
                       load.nn = "          OUTDYNAMÿ
                         end
                      nn = nn + 1
                      load.nn = "          CATALOG - "             ÿ
                        if vrp = "Yes" then do
                           nn = nn + 1
                           load.nn = "          REPLACE -"
  ÿ                          end
                          if otenq = "Yes" then do
                             nn = nn + 1
                 ÿç
                                           end
                                        if vall = "All" then do
                                ÿ
                                             load.nn = "          ALLDAT
                                             end
                                          restoÿ
                                            if rename = "on" then do
                                               nn = nn + 1
                                               if left(targ_dsÿ
                                                    rename_dsn = strip(t
,"'")                                               else
                                                    rename_dsn = hlq"."t
n                                                  if multiple = "on" th
                                                      load.nn = "
EU("sdsname", - "                                     nn      = nn + 1
            ÿ
*" then                                                    tdsname = tds
                                                        rt_dsn = strip(t
"'")                       ÿ
       "rt_dsn") -"                                       end
                                                       else do
                                          ÿ
 RENAMEU("restore_dsn", - "                                 nn      = nn
                                                            if right(ren
2) = ".*" then                                           ÿ
name_dsn"*"                                                   load.nn =
           "rename_dsn") -"                                   end
                                                           end
                                                          nn = nn + 1
                                                          load.nn = "
ATASET(INCLUDE(**))"                                      nn = nn + 1
       ÿ
                                                            load.0 = nn
                                                          call set_ftp
                      ÿ
                                                            ftp.nn = "Si
sysalloc "sec="sysseconds site_sp                           nn = nn + 1
                                     +
load_dsn"'" reload_dst             ÿ
                                                                ftp.nn =
ri=1 sec=1 Tracks"                                              nn = nn
                                                  ÿ
'"hlq"."loadjcl_dsn"'" ftpjcl                                     nn = n
                                                                  ftp.nn
 s"                                                              ÿ
                                                                    ftp.
te filetype=jes"                                                    nn =
                                                                    ftp.
ÿ
1                                                                     ft
get" ftpjcl  "'"ftprpt_dsn"'"                                         nn
1              ÿ
 "site filetype=seq"
+ 1
 "mode b"                     ÿ
n + 1
 = "delete"  ftpjcl
= nn                                         ÿ
ength(members) > 0 then do
embers = null
o_pds_flag = 1                                              ÿ
 end
turn

* -------------------------- *
* Check for any migrated d/s *
* for multiple (dss) xfers   *
* --------ÿ
  Do_Pattern:
   parse value '' with cmdsn cmflag zcmd zsel action cancel
                         ÿ
    t_dsn   = strip(sdsname,,"'")

     Address ISPEXEC                    ÿ
       "Lmdinit Listid(ftpb) Level("t_dsn")"
       lrc = rc
                                                       +
         tblname = "ftpb"random(9999)                ÿ
           "TBCreate" tblname "names(zsel cmdsn action zdldsorg zdlsize
 ,                            "Write"
                                                                    ÿ
             x_rc   = 0
             scnt   = 0
             ecnt   = 0
   ÿ
               mult_sels = 0

               "Coÿ
                 "Display Panel(ftpbpdsl)"

                 do until x_rc > ÿ
                      "Lmdlist Listid("ftpb") Stats(YES) Dataset(cmdsn)
IST)"                 x_rc = rc
                      if x_rc = 0 then do       ÿ
                          "TBAdd" tblname
                          scnt = scnt + 1
                          end                                  ÿ
                          end
                       "Lmdfree listid("ftpb")"

                         if scnt = 0 then do
                            "TBEnd" tblname
                            cancel = 1
             ÿ
                              zedlmsg = "Process Cancelled - no eligible
s."                           "Setmsg msg(isrz001)"
                            ÿ
                                end

                             scnt = 0      ÿ
                               mult_sels = 0
                               crp = 1
                               rowcrp = 0                 ÿ
                                 last_find = 1

                                 "TBTop" tblname
                                                                       ÿ
                                     Do forever
                                       zcmd = null
                                       if mult_sels = 0 then do
      ÿ
                                           "TBSkip" tblname "Number("crp
                                           if rowcrp = 0 then
                     ÿ
l)"                                          else
                                                "TBDispl" tblname "Panel
l)" ,                               ÿ
toSel(No)"                                     end
                                             else
                                               "TBDÿ
                                               t_rc = rc
                                               mult_sels = ztdsels
                                               if t_rc > 7 then leÿ
                                                 if zcmd = "REFRESH" the
                                                 if zcmd = "CANCEL" then
                                                 if abbrev("FIND",word(z
)ÿ
),1) = 1 then do                                      zcmd = "RFIND" arg
                                                      call do_find tblna
                ÿ
                                                     if zsel = "\" then
U"                                                      Select
                               ÿ
 do                                                              if cmfl
 then do                                                            zeds
ll                                            ÿ
"Select and Exclude may not be",
"used in the same transfer."                                          "S
g(isrz001)"                                                  ÿ
ull
tblname
                                                                     els

ag = "S"
ction = "Select" then leave
 = scnt + 1+
tion = "Sÿ
zsel = null
call listdsi "'"cmdsn"'" "Norecall"
if sysreason = 9 then   ÿ
     if left(zdlvol,6) = "MIGRAT" then
        Address TSO "HRecall '"cmdsn"'"
  if sysreason <> 9 then               ÿ
       zdlvol = sysvolume
    "TBPut" tblname
    action = null                                     ÿ
      end
 end
 zsel = "E" then do                                                  ÿ
   if cmflag = "S" then do
      zedsmsg = null
      zedlmsg = "Exclude and Select may not be",
    ÿ
        "Setmsg msg(isrz001)"
         zsel = null
        "TBPut" tblÿ
          end
       Else do
            cmflag = "E"          ÿ
              ecnt = ecnt + 1
              action = "Exclude"
              zsel = null                        ÿ
                "TBPut" tblname
                action = null
                end                                             ÿ
             end
        When zsel = "R" then do
             if action <> "Select" then

               zsel = null
               call listdsi "'"cmdsn"'" "Norecall"
              ÿ
                    if left(zdlvol,6) = "MIGRAT" then
                       Address TSO "HRecall '"cmdsn"'"
                 if sysreason+
                      zdlvoÿ
                    "TBPut" tblname
                     action = null
                     end                  ÿ
                  When zsel = "M" then do
                       if action = "Select" then do
                          action = "Migrate"             ÿ
                            scnt = scnt - 1
                            if scnt = 0 then cmflag = null
                            end
                           else action = "Migrate"
                           zsel = null
                           "TBPut" tblname
       ÿ
                             Address TSO "HMigrate '"cmdsn"'"
                             end
                      ÿ
                               Select
                                   When left(action,1) = "E" then do
                                     ÿ
                                          if ecnt = 0 then cmflag = null
                                          end
                                     When left(actioÿ
                                            scnt = scnt - 1
                                            if scnt = 0 then cmflag = nu
                                            end                    ÿ
                                         Otherwise nop
                                         end
                                     action = ""
  ÿ
                                       "TBPut" tblname
                                       action = null
                 ÿ
                                    Otherwise nop;
                                    end
                               eÿ

                               "Control Display Lock"
                               "Display Panel(f+
                                             ÿ
                                   if wordpos(zcmd,"REFRESH CANCEL") = 0
                                      "TBTop" tblname
                                      mult_space = 0        ÿ
                                        do forever
                                           "TBSkip" tblname
                                           if rc > 0 then leave
                                             if scnt + ecnt = 0 then
                                                if left(zdlvol,6) <> "MI
en                                                  action = "D"
          ÿ
                                                if action = null then do
                                                     if left(zdlvol,6) <
T" then                  ÿ
                                                       else action = nul
                                                       end
                                        ÿ
                                                   if left(action,1) = "
action = "D"                                       if action = "D" then
                                                      cÿ
                                                        select
                                                          when zdldsorg
hen do                                                         call fiÿ
space "'"cmdsn"'"                                                if "'"c
<> vsam_dsn then do                                                cmdsn
r(vsam_dsn,2,length(vsam_dsn)-2)                                   end
     ÿ
mult_space + space_pri                                             end
                                                              when left(
,1) = "B" then      ÿ
= mult_space + sysalloc                                         when lef
ts,1) = "C" then                                                     mul
= mult_space + (sysalloc*15)       ÿ
nits,1) = "T" then                                                     m
e = mult_space + sysalloc                                         otherw
                                                  ÿ
                                                                  cd_hit
                                                                  do cd
elected.0                                                        +
elected.cd,1) = cmdsn then do                                  ÿ
it = 1
     = scnt - 1


t = 0 then do
 selected.0 + 1
ted.cnt = cmdÿ
ected.0 = cnt

                            ÿ
(action,1) = "E" then do
excluded.0 + 1
uded.e = cmdsn                             ÿ
cluded.0 = e
d
                                                          ÿ
                                                                       "
blname                                                                 i
 "CANCEL" then do
 = null
el = 1
msg = null
msg = "Pÿ
etmsg msg(isrz001)"
d
                       ÿ

---------------------------------------------------------- *
d_Vsam_Space routine                  ÿ
------------------------------------------------------------ */
nd_Vsam_Space:
g vsam_dsn                                           ÿ
space_pri = 0    /* moved here in case vsam check early */
if multiple = "on" then do
   if right(vsam_dsn,6) = ".DATA'" then return                      ÿ
     if right(vsam_dsn,7) = ".INDEX'" then return
     /* fixed to reflect index and data for ddir */
     if right(vsam_dsn,3) = ".D'" then return
   +
 ÿ

      Address TSO
      do until vÿ
           drop vsam.
           call outtrap "vsam."
           "LISTCAT ENT("vsam_dÿ
             call outtrap "off"
             cluster = null
             if pos("CLUSTER --",vsam.1) > 0 tÿ
               else do i = 1 to vsam.0
                    if pos("CLUSTER--",vsam.i) > 0 then
                       parse value vsam.i with "CLUSTER--" clÿ
                      if cluster <> null then do
                         vsam_dsn = "'"strip(cluster)"'"
                         end
                        if cluster <> null then leave
                        end
                end
           ÿ
                  do i = 1 to vsam.0
                     If pos("TRACKS---",vsam.i) > 0 then do
                        vsÿ
                          space_pri = word(vsam.i,8) + space_pri
                          end
                       end               ÿ

                       balloc     = space_pri
                       sysalloc   = space_pri           ÿ
                         sysseconds = space_pri
                         Address ISPExec
                         return                                        ÿ

                          Get_GDG:
                          /* Rexx - find out absolute dataset name from
 GDG nÿ umber                             code from Ole Knudsen
                                  - IBM Global Services - MVS Applicatio
pment Support               */
                     ÿç
                                             "lminit dataset("sdsname")
ataid)"                                      if rc=0 then do
                                    ÿ
me(ddname)"                                       cc=listdsi(ddname "FIL
                                                  realdsn=space(sysdsnam
                                                  "ÿ
                                                    sdsnamex = "'"realds
                                                    end
                                                 gdg = "on"       ÿ
                                                   members = null
                                                   return

 ÿ
                                                    d = date(u)
                                                    date = substr(d,7,2)
,1,2)substr(d,4,ÿ
current time hh:mm:ss.th */                           t = substr(s,1,2)s
4,2)substr(s,7,2)substr(s,10,1)                      /* ----------------
-------------------------- *   ÿ
aset names that will be used *                          * in this applic
                             *                          * --------------
---------------------------- */               ÿ
q".UNLOAD.D"date".T"t                                     unload_dst  =
OAD.D"date".T"t                                           reload_dsn  =
q".RELOAD.D"date".T"t                                     relÿ
ELOAD.D"date".T"t                                           loadjcl_dsn
OAD.D"date".T"t                                             ftprpt
TPRPT.D"date".T"t                                           ftprpt_dsn
."ftprpt                                                      ftpjcl
.FTPJCL.D"date".T"t                                           return

           ÿ
                                                                   send_
"hlq"."from_dsn"'"                                                 retur
                          ÿ
                                                                 /* ----
------------------------------------------------- *               * Fix_
 routine to change the thost to the multi+
ple target hostnames are used          ÿ
----------------------------------------------------- */              Fi
                                                                     /*
----------------------------------------------------- ÿ
nge the remote jobcard for remote host                  *
an up any submit datasets if submit bypassed            *
nge remote hostname in jcl to new remote hostname       *            ÿ
hange the work dsnames to avoid duplicates                *
--------------------------------------------------------- */
st = thost
et_jÿ
 setup_local_jobcard
 setup_remote_jobcard
 clean_up_submit   ÿ
 od = null then
 od = "D"date
se od = oda                       ÿ
     dc  = dc + 1
     oda = "D"date""dc
do t = 1 to ftp.0                                ÿ
     if pos(phost,ftp.t) > 0 then do
        tl = length(phost)
        pos = pos(phost,ftp.t)                                  ÿ
          nl = left(ftp.t,pos-1)
          nr = substr(ftp.t,pos+tl,71)
          ftp.t = nl""thost""nr

         if pos(od".",ftp.t) > 0 then do
            tl = length(od)
            poÿ
              nl = left(ftp.t,pos-1)
              nr = substr(ftp.t,pos+tl,71)
              ftp.t = nl""odaÿ
                end
             /* test for 2nd occurance of Ddate on FTP statement */
             if pos(od".",ftp.t) > 0 then doÿ
                  tl = length(od)
                  pos = pos(od".",ftp.t)
                  nl = left(ftp.t,pos-1)                   +
                    nr = substr(ftp.t,pos+tl,71)         ÿ
                      ftp.t = nl""oda""nr
                      end
                   end
                 /* -------------------------- *
                  * fix temp/working dsnames   *
                  * to eliminate duplicates    *
       ÿ
                    do t = 1 to load.0
                       if pos(od,load.t) > 0 then do
                      ÿ
                            pos = pos(od,load.t)
                            nl = left(load.t,pos-1)
                            nr = subsÿ
                              load.t = nl""oda""nr
                              end
                           end                      ÿ
                          if pos(od,loadjcl_dsn) > 0 then do
                                tl = length(od)
                                pos = pos(od,loadjcl_dsn)          ÿ
                                  nl = left(loadjcl_dsn,pos-1)
                                  nr = substr(loadjcl_dsn,pos+tl,44)
                                  loadjcl_dsn = strip(nl""oda""nr)
  ÿ
                              if pos(od,ftprpt_dsn) > 0 then do
                                    tl = length(od)
                 ÿ
                                      nl = left(loadjcl_dsn,pos-1)
                                      nr = substr(ftprpt_dsn,pos+tl,44)
                                ÿ
                                        end
                                 /* -------------------------- *
                                  * Write out tÿ
                                    * temp d/s.                  *
                                    * -------------------------- */
                                    if rwlj = 0 then do       ÿ
                                         rwlj = 1
                                         call do_local_jcl
                                         end
                                        call do_local_jcl
                                          if unl = "Yes" then do
                                             rwrj = 1
                                             call do_remote_jcl
          ÿ
                                            Return

                         ÿ
----------------------------- *               * Now process the foregrou
tion or background job        *               * submissions for the file
r                             *         ÿ
------------------------------- */              Do_FTP:
                                                call save_remote_jobcard
                                                do foreÿ
                                                     if unl = "No" then
                                                        "Display Panel(f
                                                        else          ÿ
                                                          "Display Panel
)"                                                     if rc > 4 then do
                                                         if dataid <> nu
do   ÿ
ataid")"                                                      call msg("
                                                              Address TS
F("ddn")"           ÿ
n                                                                  Addre
Delete '"netrc_dsn"'"                                           call cle
bmit                               ÿ
                                                               return
                                                               end
                                                  ÿ
                                                               rwrj = 0
                                                               if ftp.1
hen rwlj = 1                                                   ifÿ
 then rwlj = 1                                                   if ftp.
 then rwlj = 1                                                   if lj3
 then lj3 = "//*  "                                              ftp.1 =
ÿ
                                                                   ftp.3
                                                                   if un
" then do      +
1 <> rj1 thenÿ
d.2 <> rj2 then rwrj = 1
d.3 <> rj3 then rwrj = 1
 = rj1                      ÿ
.2 = rj2
.3 = rj3
 do_remote_jcl                             ÿ
d
do_local_jcl
 (lj1 lj2 lj3) Profile"                                   ÿ
l save_remote_jobcard
ect
hen opt = "S" then do
      submit_flag = 1
      Address TSO
      "Alloc f(I"ddn") Sysout(A) Writer(INTRDR)",
        ÿ

        "Execio * diskr "ddn" (Finis Stem in."
        if netrc = 0 thÿ
             do p = 1 to in.0
                if wordpos(ftp_password,in.p) > 0 then do
                   if password = '*' tÿ
                        apass = null
                        else apass = password
                     if userid <> "anonymous" then   ÿ
                          in.p = userid apass
                       else in.p = userid apass
                       end                                          ÿ
                      end
                   end
                   parse value in.1 with "//" jobname "JOB" .
   ÿ
                     drop in.
                     "Free f(I"ddn")"
                  ÿ
                    Address ISPExec
                    "Lmfree  Dataid("dataid")"
                    if unl <> "No+
                         "Addpoÿ
                           if dss = "Yes" then
                              "Display Panel(ftpbgsur)"
                           else               ÿ
                                "Display Panel(ftpbgsup)"
                             "Rempop"
                             end                             ÿ
                            else do
                                 zedsmsg = null
                                 zedlmsg = "Job" jobname ,
                                             "has been submitted success
                                   "Setmsg Msg(isrz001)"
                                 end
           ÿ
                                return
                                end
                          ÿ
                               if unl = "No" then do
                                  Address TSO
                                  "Alloc ÿ
Recfm(F b)" ,                              "Lrecl(80) Blksize(0) Reuse"
                                    "Execio * diskr "ddn" (Finis Stem in
                                    n = 0               ÿ
                                      do i = 1 to in.0
                                         if left(in.i,1) = "/" then iter
                                         if wordpos(ftp_password,in.i) ÿ
n                                             in.i = userid password
                                           n = n + 1
                                           out.n = in.i
      ÿ
                                          "Execio * diskw input (Finis S
"                                         "Alloc f(Output) new unit("vio
5,15) tr reuse"      ÿ
                                               "Alloc f(netrc) shr ds('"
n"')"
                                    ÿ
                                              "Control Display Lock"
                                              "Display Panel(ftpbexec)"
                                                   +
                                                "ÿ
"
                                                  Address TSO
                                                  "Free f(input)ÿ
                                                    if netrc = 1 then
                                                       "Free f(netrc)"
                                                    Address ISPExec

me(Output)"                                           "Browse Dataid("ou
                                                      "Lmfree  Dataid("o
              ÿ
ut)"                                                    zedsmsg = ""
                                                        zedlmsg = "Foreg
P Execution Complete."       ÿ
                                                          "Lmfree  Datai
d")"                                                      Address TSO "F
dn")"                                       ÿ
                                                            end
                                                         else do
                                                           ÿ
"                                                               zedlmsg
ion not valid with Unloaded Load Library"                       "Setmsg
001)"                                                           end
                                                             end
                                                           when opt = "E
o                                                               "Edit Da
taid") Maÿ
                                                                   "Exec
kr "ddn" (Finis Stem ftp."                                        end
                        ÿ
en                                                                  "Bro
id("dataid")"                                                  when opt
hen do                                 ÿ
taset('"hlq"."loadjcl_dsn"') Macro(ftpbem)"                           Ad
O                                                                     "A
"ddn") shr reuse ds('"hlq"."loadjcl_dsn"')"           ÿ
* diskr T"ddn "(finis stem load."
T"ddn")"
ISPExec                                                              +
                                                                   ÿ
= "BL" then
wse Dataset('"hlq"."loadjcl_dsn"')"                                    o
 nop;                                                                  e
  ÿ
                                                                    Retu

                 ÿ
------------------ *                                                  *
 datasets used     *                                                  *
submission.        *            ÿ
-------------------- */
_Submit:
t_flag <> 1 then do                            ÿ
 Msg("off")
ress TSO "Delete" loadjcl_dsn
ress TSO "Delete '"netrc_dsn"'"                               ÿ
nd
it_flag      = null
jcl_dsn_flag = null
turn

------------------------------------------------------------- *
Setup the reÿ
* submission.                                                   *
* Use correct userid for jobname to allow jesgetputto.          *
* -------------------------ÿ
  Setup_Remote_Jobcard:
  parse value "" with rj1 rj2 rj3
  "TBOpen ftpjobcd Write Library(ISPPROF)"ÿ
    if rc = 8 then call create_table
    "TBTop ftpjobcd"
    do forever                                           ÿ
         "TBSkip ftpjobcd"
         if rc > 0 then leave
         if targhost = thost then leave
           end
        if rj1 = null then do
           rj1 = ftp.1
       +
     ÿ
               end
            parse value rj1 with "//" jobname "JOB" rest
            Uuserid ÿ
              if forcejbn = "Y" then do
                 jobname = Uuserid""jobsuf
                 rj1 = "//"jobname ÿ
                   end
                else do
                   if left(jobname,length(Uuserid)ÿ
                        jobname = Uuserid""jobsuf
                        rj1 = "//"jobname "JOB" strip(rest)
                        end                                      ÿ
                       if left(jobname,length(zuser)) = zuser then do
                          jobname = Uuserid""jobsuf
                          rj1 = "//"jobname "JOB" strip(rest)
ÿ
                         end
                      load.1 = rj1
               ÿ
                        load.3 = rj3
                        tbput_rc = 0
                        if tarÿ
                            "TBPut   ftpjobcd"
                            tbput_rc = 4
                            end              ÿ
                            if tbput_rc = 4 then
                              if left(thost,1) <> "*" then
                                 if pos(thost,"*?") = 0 thenÿ
                                      targhost = thost
                                     "TBAdd   ftpjobcd"
                                      end
                                "TBSort  ftpjobcd Fields(targhost)"
                                "TBSave  ftpjobcd Library(ISPPROF)"
                                "TBClose ftpjobcd Library(ISPPROF)"
          ÿ                       return

                                 /* -------------------------- *
                         ÿç
                                                * be used locally.
                                                * ----------------------
                                        ÿ
                                                  parse value lj1 with "
ame "JOB" rest                                    if left(jobname,length
 = zuser then do                                     joÿ
                                                       lj1 = "//"jobname
trip(rest)                                             end
                                                    ftp.1 = lj1       ÿ
                                                      ftp.2 = lj2
                                                      ftp.3 = lj3
                                                      return
     ÿ
                                                       /* --------------
---- *                                                  * Save the remot
d    *              ÿ
       *                                                  * ------------
------ */                                                 Save_Remote_Jo
                                   ÿ
te Library(ISPPROF)"                                         if rc = 8 t
 create_table                                               do forever
                                                  ÿ
d"                                                               if rc >
leave                                                            if targ
host then leave                                                  ÿ
                                                                rj1 = lo
                                                                rj2 = lo
                                                                rj3 = lo
ÿ
st                                                                if rc
                                                                    "TBA
jobcd"         ÿ
                                                                      "T
tpjobcd"                                                            "TBS
jobcd Fields(targhost)"       ÿ
tpjobcd Library(ISPPROF)"                                             "T
tpjobcd Library(ISPPROF)"                                             re
                                             +
                                           ÿ
--------------------------------------------------------- *
Hostname routine.                                         *
 when the user enters a ? on the target Hostname field    ÿ
 display the current set of used hostnames from which to    *
lect.                                                       *
tionally:                                                   *
    D - delete entry from the table.                          *
    C - clone entry (create new host name)                    *
    U - update entry (change JCL)                             *
    \ - ÿ
* ------------------------------------------------------------- */
Get_Hostname:
call build_thost_table ÿ
    mult_sels = 0
    mhst = null
    crp = 1                           ÿ
      rowcrp = 0
      last_find = 1
      do forever                                     ÿ
        hsel = null
        if words(mhst) > 0 then do
           zedsmsg = null                                           ÿ
             zedlmsg = "Selections made  - enter PF3(END) or ENTER",
                       "when ready to proceed."
             "Setmsg Msg(isrz001)"
   ÿ
            zcmd = null
            "TBTop  thosttbl"
            "TBSkiÿ
              if mult_sels = 0 then do
                 if rowcrp = 0 then
                    "TBDispl thosÿ
                   else
                      "TBDispl thosttbl Panel(ftpbshst)",
                              "Csrrow("rowcrp") ÿ
                     end
                   else
                     "TBDispl thosttbl"                        +
                    xrc = rc                                 ÿ
                      mult_sels = ztdsels
                      if xrc > 7 then do
                         call save_thost_table
                           if words(mhst) > 0 then return
                            signal start
                            end
           ÿ
                          Select
                             when abbrev("FIND",word(zcmd,1),1) = 1 then
                          ÿ
                                    targhost = "?"
                                    xrc = 0
                                    end  ÿ
                                 when abbrev("RFIND",word(zcmd,1),2) = 1
                                      zcmd = "RFIND" argument
                                      call do_find "thosÿ
                                        targhost = "?"
                                        xrc = 0
                                        end                            ÿ
                                     when hsel = "D" then do
                                       "TBDelete thosttbl"
                                       xrc = 0
      ÿ
                                       when hsel = "C" then do
                                         currhost = targhost
                     ÿ
                                           "Display Panel(FTPBCHST)"
                                           if rc = 0 then do
                                    ÿ
                                                "TBAdd thosttbl order"
                                                end
                                             "contrÿ
                                               end
                                             when hsel = "U" then do
                                               "control display saÿ
                                                 "Display Panel(FTPBUHST
                                                 if rc = 0 then do
                                                    tsel = "Update"
 +

                                                     "control display re
                                                     end
              ÿ
                                                       pw = wordpos(targ
t)                                                     mhst = delword(mh
                             ÿ
                                                        "TBMod thosttbl"
                                                        targhost = "?"
                                            ÿ
                                                           end
                                                         when hsel = nul
arghost = null                                           otÿ
                                                                     mhs
 targhost                                                            tse
ect"                                                                 "TB
osttbl"                                                                i
els > 0 then
st = "?"                                                               e
         ÿ
                                                            if pos(hsel,
 0 then targhost = "?"                                      thost = targ
                        ÿ
en leave                                                      end
                                                              call save_
ble                                    ÿ

                                                              Create_Tab
                                                      ÿ
bcd keys(targhost)",
es(rj1  rj2  rj3 thdesc) Library(ISPPROF)",
lace"                                                             retÿ

                                                                  Save_T
le:                                                                call
ableÿ
ttbl"                                                                "TB
osttbl rownum(rows)"                                                 do
o rows             +
 thosttbl"       ÿ
t  thosttbl"
d ftpjobcd"
                                ÿ
ve  ftpjobcd Library(ISPPROF)"
ose ftpjobcd Library(ISPPROF)"
d   thosttbl"                                  ÿ
words(mhst) = 1 then thost = strip(mhst)
urn
                                                              ÿ
ild_Thost_Table:
TBOpen ftpjobcd Write Library(ISPPROF)"
f rc = 8 then do
    call Create_Table
    targhost = "temp"
    call set_initial_jobcard
    rj1 = ljÿ
      rj2 = lj2
      rj3 = lj3
      "TBadd ftpjobcd"     ÿ
        end
     "TBTop ftpjobcd"
     "TBCreate thosttbl keys(targhost)",  ÿ
                  "Names(tsel rj1  rj2  rj3 thdesc)"
        tsel = null
       "TBQuery ftpjobcd rownum(rows)"                   ÿ
         do rw = 1 to rows
            "TBSkip ftpjobcd"
            "TBGet  ftpjobcd"
              "TBAdd  thosttbl"
              end
           "TBSort thosttbl fields(targhost)"
       ÿ
             "TBClose ftpjobcd Library(ISPPROF)"
             return
                      ÿ
             /* -------------------------- *
              * setup initial jobcard mask *
              * ---------------------+
                set_initial_jobcardÿ
                     lj1 = jc1
                     lj2 = jc2
                     lj3 = jc3                    ÿ
                       "Vput (lj1 lj2 lj3) Profile"
                       return
                                                                 ÿ
                     FTP_Site_Info:
                     /* -------------------------- *
                      * Set space allocation       *
ÿ
                        * -------------------------- */
                        if sdb = 0 then blk = 0
               ÿ
                          if sp = "Blocks" then blk = sysblksize
                          pri = sysalloc
                          sec ÿ
                            direct = sysadirblk
                            targdsn = targ_dsn
                            "Display Panel(FTÿ
                              if direct = 0 then direct = null
                              if length(direct) > 0 then
                                 sysadirblk = direct        ÿ
                                sysalloc   = pri
                                sysseconds = sec
                                select
                                     when sp = "Blocks" then space = blk
                                     when sp = "TR" then space = "TRK"
                                     when sp = "CYL" then space = "CYL"
          ÿ
                                       end
                                    balloc = "("sysalloc","sysseconds")"
                         ÿ
rblk")"                               direct = sysadirblk
                                      if rel = "Yes" then rlse = ",RLSE"
                                        ÿ
                                        return

                                       /* -------------+
----------------- *                       * Find sub-ÿ
                    *                       * --------------------------
------------------- */                     Do_Find:
                                                 arg table_name     ÿ
                                                   parse value zcmd with
ment                                               upper argument
                                                   argument = strip(argu
   ÿ
                                                     hit  = 1
                                                     hcc  = 0
                  ÿ
                                                       find_loop = ''
                                                       search    = ''
                                 ÿ
                                                         if o1     = "RF
n do                                                        last_find =
d + 1                                           ÿ
e                                                             "TBSKIP" t
e "Position(ROWID) Number("Last_find")"                       end
                                                              eÿ
                                                                     "TB
ble_name "Position(rowid)"                                           end
                                                             if rc = 8 t

BTop" table_name
BSKIP" table_name "Position(ROWID)"
smsg = "Wrappÿ
end
s_smsg = "Found"
                            ÿ
arch */
                                                                   do fo
                                           ÿ
table_name,4) = "FTPB" then
h = translate(cmdsn)
table_name,5) = "THOST" then                              ÿ
rch = translate(targhost) translate(thdesc)
(argument,search) > 0 then do
 = rowid + 0
owcrp = crp                                                            ÿ
 last_find = crp
     zedsmsg = s_smsg  /* "Found" */
     zedlmsg = argument "found during search in row:" crp
    "Sÿ
   leave
   end
"TBSKIP" table_name "ÿ
  if rc = 8 then do
        "TBTOP" table_name
         s_smsg = "Wrapped"         ÿ
       if find_loop = "on" then do
           zedsmsg = "Not Found"
           zedlmsg = argument "Not found during seaÿ
             rowid = crp
            "Setmsg Msg(isrz001)"
             leave                                                ÿ
               end
               else find_loop = "on"
           end
 ÿ
          end
  return
NAME=FTPBCRDT 01ÿ
   /* rexx */
   Address ISPEXEC
   call set_credits            ÿ
        "Control Display Lock"
     do i = 1 to credit.0-1
        int_credit = "credit"i" = credit.i"   ÿ
          interpret int_credit
          call listdsi "'sys1.lpalib'" "dir"
          "Control Display Lock"                             ÿ
            "Display panel(ftpbcrdt)"
            end
         i = credit.0
           int_credit = "credit"i" = credit.i"
           interpret int_credit
           "Display panel(ftpbcrdt)"
           +
         ÿ
               Set_Credits:
               parse value "" with credti1 credit2 credit3 credit4 ,
                        ÿ
                   credit.1 = "L. A. Thomas"
                   credit.2 = "Eric Wolf"
                   credit.3 = "Werner Kÿ
                     credit.4 = "Ole Knudsen"
                     credit.5 = "Skip Robinson"
                     credit.6 = "Don Farrar"          ÿ
                       credit.7 = "Dave Alcock"
                       credit.8 = "Mike Theys"
                       credit.0 = 8                                  ÿ
                         return
               ./ ADD NAME=FTPBCUST 0108-99109-00072-0227-00156-00128-00
BD                     /* ---------------------  rexx procedure  -------
----ÿ
          *               *
          *               * Function:  Setup installation defaults for t
ISPF      *        ÿ
            *               *
            *               *            Called by FTPB
            *               *     ÿ
              *               * Syntax:    %ftpbcust
              *               *
              *               * Author:    Lionelÿ
                *               *            Kaiser Permanente
                *               *            Walnut Creek, CA 94598
                *               *            (925) 926-5332     ÿ
                  *               *            Internet: lionel.b.dyck@n
erm.org           *               *
                  *               * History:

iable               *               *            08/12/99 - add tape var
                    *               *            04/29/99 - changed dasd
90 to work    ÿ       *               *            04/19/99 - created
                      *               *
                      *               * --------------------------------
--------------------- */     ÿç
                                                    Address ISPEXEC

                                            ÿ
-- *                                                  * Custom:
   *                                                  * system determine
e  *                                                  *   0ÿ
     *                                                  *   1 = use sysb
     *                                                  * --------------
---- */                                                 sdb = 0

                                                         /* ------------
------ *                                                  * Custom:
       * ÿ
e        *                                                  * Set Dasd d
me       *                                                  * Set Tape d
me       *              ÿ
---------- */                                                 vio  = "VI
                                                              dasd = "WO
                                       ÿ

                                                               /* ------
------------ *                                        ÿ
               *                                                  * Set
age            *                                                  *
t use it       *                                                  *  ÿ
e it             *                                                  * --
---------------- */                                                 netr

    ÿ
------------------ *                                                  *
                   *                                                  *
TPD DD usage       ÿ
= don't use it       *
= use it             *
-------------------- */           ÿ
d = 0

---------------------- *                         +
stom:                    *                     ÿ
Set SYSFTPDS dsname to     *
 the local site dsname     *
-------------------------- */                                 ÿ
sysftpds = "TCPIP.FTP.DATA"

* -------------------------- *
  * Custom:                    *
  * Set library dsn for FTPB   *
  *     SYSEXEC members.       *
  * Note: I ÿ
    *       NJE nodes for dsns   *
    * -------------------------- */
    njenode = sysvar('sysnoÿ
      if left(njenode,3) = "NKA" then
         execlib = "SYS2.REXX.EXEC"
      if left(njenode,3) = "SKA" then     ÿ
           execlib = "SYS1.USER.REXX"

       /* -------------------------- *                   ÿ
          * Custom:                    *
          * Save password in ISPF      *
          * Profile. May violate your  *
            * security policies.         *
            *  0 = no save               *
            *  1 = save                  *
       ÿ
              savepwd = 0

             /* ------ÿ
                * Custom:
                * Firewall support.
                *   1. At Kaiser we uÿ
                  *      firewall userid prompt
                  *   2. Change this for your site as necessary
                  *   0 = id with hostname          ÿ
                    *   1 = id by itself
                    * --------------------------------------------------
                    FirIDwH = 0                                    +
                                                                 ÿ
                       /* -------------------------- *
                        * Custom:                    *
                        * Set the flag to force the  *
ÿ
                          * be userid plus 1 char.     *
                          * -------------------------- *
               ÿ
                            * anything else to leave     *
                            * -------------------------- */
                             fÿ

                             "Vget (zuser zacctnum)"
                                             ÿ
                               /* -------------------------- *
                                * Custom:                    *
                                * setup accounting number   ÿ
                                  * if ',' then put in ()      *
                                  * if '/' then fixup          *
                                  * if ' ' then put in quotes  *
                                    * -------------------------- */
                                    Select
                                       when pos(',',zacctnum) > 0 then
          ÿ
                                         when pos(' ',zacctnum) > 0 then
                                              zacctnum = "'"zacctnum"'"
                         ÿ
                                                parse value zacctnum wit
 a2 "/" a3                                      zacctnum = "'"a1","a2",D
                                        ÿ
                                             otherwise nop
                                             end
                                                       ÿ
                                               /* ----------------------
                                                * Custom:
                                                * Set SYSTCPD DD usageÿ
                                                  *     0 = don't use it
                                                  *     1 = use it
                                                  * --------------------
/    +
   ÿ
                                                     /* ----------------
-- *                                                  * Custom:
   *              ÿ
     *                                                  *  the local sit
     *                                                  * --------------
---- */                          ÿ

                                                         jc1 = "//"zuser
 zacctnum",'FTP JOB',NOTIFY=&SYSUID, "          ÿ
LEVEL=1,REGION=6M,CLASS=L,MSGCLASS=X"                      jc3 = "//HOLD
JESDS=ALL,DEFAULT=Y,OUTDISP=(HOLD,HOLD)"
                                                       "Vput (sÿ
rc sysftpd njenode execlib savepwd" ,                         "FirIDwH f
jc1 jc2 jc3 tape sysftpds" ,                                  "systcpd s
 "                                                        Address TSO
                                                   ./ ADD NAME=FTPBEM
22-97234-1954-00051-00038-00000-SYSLBD                     /* ----------
---  rexx procedure  ---------------------- *               * Name:
             ÿ
                                              *               * Function
lish the ISPF Edit environment to be used     *               *
editing the FTP Batch JCL   ÿ
                                                *               *
ernally called by FTPB via IMACRO               *               *
                                           ÿ
/a                                                *               *
                                                  *               * Auth
ionel B. Dyck                                     *       ÿ
 Kaiser Permanente                                  *               *
 Walnut Creek, CA 94598                             *               *
 (510) 926-5332                                     *               *
   IBMMail:  USKFHLBD                                 *               *
   Internet: LIONEL.B.DYCK@NCAL.kaiperm.org           *               *
   IBMLINK:  SYSLBD                                   *               *
        ÿ
y:                                                      *
     03/25/97 - add notelines                           *
     11/26/96 - creatio+
                     ÿ
----------------------------------------------------------- */

ss ISREDIT                          ÿ

CRO"
                                                   ÿ
xit_rc = ""

RECOVERY ON"                                                      ÿ
 "NUMBER OFF"
 "NULL ON"
 "AUTOLIST OFF"
 ÿ
   "HEX OFF"
   "AUTOSAVE ON"
   "RESET"      ÿ
     "DEFINE FTPBEME MACRO CMD"
     "DEFINE FTPBEMS MACRO CMD"
     "DEFINE END ALIAS FTPBEME"ÿ
       "DEFINE SAVE ALIAS FTPBEMS"
       "LINE_Before 1     = Noteline " ,
               "'** CAPS have been set on by dÿ
         "LINE_Before 1     = Noteline " ,
                 "'** you are editing the FTP statements then  **'"
         "LINE_Before 1     = Noteline " ,                   ÿ
                   "'** you might want to change to CAPS OFF if  **'"
           "LINE_Before 1     = Noteline " ,
                   "'** the target site is case sensitive.       **'"
             "CAPS ON"
     ./ ADD NAME=FTPBEME  0109-90022-97112-1542-00019-00014-00000-SYSLBD
             /*  Rexx ISPF Edit Macro
           ÿ
               /* ------------------------------------------------------
               /*
               /*  This ISÿ
*/               /*  'END' command by the FTPB exec.
*/               /*
*/               /* ---------------------+
- */               Address ISREDIT     ÿ
                     "MACRO (PARM) NOPROCESS"

                     "DEFINE END RESET"     /* reset Eÿ
                       "DEFINE SAVE RESET  "  /* reset SAVE back to norm

                       "(num) = NUM"                                 ÿ
                         if num = "ON" then "UNNUM"

                         "SAVE"
    ÿ
                   ./ ADD NAME=FTPBEMS  0109-90022-97112-1542-00019-0001
SYSLBD                     /*  Rexx ISPF Edit Macro
          */       ÿ
                             /* ----------------------------------------
----------- */               /*
            */               /*  Tÿ
the ISPF EDIT */               /*  'SAVE' command by the FTPB exec.
              */               /*
              */               /* ---------------ÿ
--------------- */               Address ISREDIT
                                 "MACRO (PARM) NOPROCESS"
                                                                ÿ
                                   "DEFINE END RESET"     /* reset END b
ormal */                           "DEFINE SAVE RESET  "  /* reset SAVE
normal */

                                     if num = "ON" then "UNNUM"

              ÿ
                                       "END"
                               ./ ADD NAME=FTPBJOB2 0115-98167-98247-070
00022-00000-SYSLBD           ÿ
e  ---------------------- *               * Name:      FTPBJOB2
                          *               *
                          *               * ÿ
om the job executed         *               *            at the remote h
return with the highest     *               *            return code.
                            *               *              +
                              *               * Syntax:  ÿ
                                *               *
                                *               * Author:   J.O. Skip Ro
                                *               *           Southern Cal
a Edison                          *               *           Enterprise
Support, PAX 2-7535               *               *           Rosemead G
-302-7535                         *               *           robinsjo@s
       ÿ
                                    *               * History:
                                    *               *            09/04/9
te the rptdsn (lbd)   ÿ
ke input dsn a parm (lbd)             *               *            06/22
rrect checks for JCL error (SR)       *               *            06/16
ntributed by Skip Robinson           ÿ
--------------------------------------- */
                                                        arg rptdsn
                                                    ÿ
then do                                                      say "Error:
me provided - exec terminating"                              Exit 8
                                                             end   ÿ

                                                           if left(rptds
"'" then                                                      rptdsn = "
"'ÿ
                                                             /* --------
---------- *                                                  * Allocate
dataset    *     ÿ
------------ */                                                 "Alloc f
T) ds("rptdsn") shr"
                                ÿ
-------------- *                                                  * Read
2              *                                                  * ----
-------------- */                              ÿ
KR JOB2LIST (Finis STEM J2L.)"
                                                                   /* --
---------------- *                                            ÿ
2LIST              *                                                  *
te the rptdsn      *                                                  *
------------------ */                                                "Fr
OB2LIST)"                                                              "
" rptdsn

---------------------- *
e it out tÿ
------------------------ */
IO * DISKW REPORT   (Finis STEM J2L.)"
                         ÿ
-------------------------- *
setup default values       *
-------------------------- */           ÿ
/* end of sysout marker */
nd_of_sysout = "!! END OF JES SPOOL FILE !!"
* max condition code - we hope */                      ÿ
 cond_max = 0

 /* -------------------------- *                                      ÿ
    * Find end of sysout record  *
    * -------------------------- */
   DO jx = 1 TO j2l.0 UNTIL POS(end_of_sysout,j2l.jx) > 0; END
     ÿ
     /* -------------------------- *
      * JCL Section starts here    *
      * ------------ÿ
       jcl_1st = jx + 1

       /* -------------------------ÿ
          * Look for abend message     *
          * -------------------------- */
         /* IEF450I jobname step - ABEND=Snnn Unnnÿ
           DO jx = 1 TO jcl_1st UNTIL POS("IEF450I",j2l.jx) > 0; END /*
/          IF jx < jcl_1st THEN cond_max = 4095 /* abend occurred */
                                                                 ÿ
             /* -------------------------- *
              * Find max return code       *
              * -------------------------- */
ÿ
                 /* IEF452I jobname  - JOB NOT RUN - JCL ERROR */
                 DO jx = 1 TO jcl_1st UNTIL POS("IEF452I",j2l.jx) > 0; E
CL? */         +
             ÿ
                   IF cond_max = 0 THEN DO
                     /* IEF453I jobname - JOB FAILED - JCL ERROR - TIME=
 */                  DO jx =ÿ
 /* JCL? */            IF jx < jcl_1st THEN cond_max = 3333 /* JCL error
                     END
                     IF cond_max = 0 THEN Dÿ
cond code */             DO jx = jcl_1st TO j2l.0 UNTIL ,
                               POS(end_of_sysout,j2l.jx) > 0; END /* loc
JCL */                   jobmsg_1st = jx + 1 /* job msgs sÿ
                           DO jx = jobmsg_1st TO j2l.0 UNTIL ,
                                 POS(end_of_sysout,j2l.jx) > 0; END /* l
f job msgs */              sysprint_1st = jx + 1 /* utility sysprint sta
re */                      DO jx = jobmsg_1st TO sysprint_1st /* scan jo
/                              /* IEF142I jobname step - STEP WAS EXECUT
D CODE nnnn */                 IF POS("IEF142I",j2l.jx) > 0 THEN DO /* g
p cond cÿ
.                                  IF cond_code > cond_max THEN cond_max
code /* update */                END
                       0         END
                               END
                               EXIT cond_max /* this code is passed to M
urrent step */         {
23-00019-1353-00067-00028-00000-SYSLBD             )Attr Default(%+_)
                                                   /* + type(text  ) int
)                   information only  */           /ÿ
gh) caps(on ) just(left )               */              @ type( input) i
gh) caps(off) just(left )                               $ type( input) i
gh) caps(off) just(left ) pad('_')                      ` type( inpÿ
non)  caps(off) just(left )                               % type(text) i
gh)                                                       ~ type(text) i
gh) color(blue) hilite(reverse)                           # type(output)
hiÿ
                                                         +--------------
---~TCP/IP FTP Dialog+--------------------------#ftpbver+%Command ===>_Z
                 ÿ
                                                           +Source Data
_sdsname                                                   +
 member of '*' for all members iÿ
:                                                            + Hostname
=>@thost                                               +or%?++ Host Data
=>_tdsname                                     ÿ
     New dsname or file name                                   +User Inf
:                                                              +   Useri
=>@userid                                  +                  ÿ
===>`password+  Verify Password%===>`passwvfy+blank for anonymous+
                                                                 +Option
mation:                                                          +   MVS
t%===>@mvs+       Is the target system running MVS? Yes or No      +   B
 %===>@bin+       Yes or No (use No for MVS to MVS)                +   F
 %===>@fir+       Address if Yes ===>@firewall                     +   I
 %===>$otherÿ
   %===>$other2                                                    %<+

e cursor to field and pressÿ
ee the IBM TCP/IP User's Guide for more information on FTP+            )

ftpbh0                                    ÿ
 trans(trunc(&mvs,1) &z,Yes Y,Yes N,No *,*)
 trans(trunc(&bin,1) &z,No  Y,Yes N,No *,*)
 trans(trunc(&fir,1) &z,No  Y,Yes N,No *,*)              +
sor = zcmd                                             ÿ
oc
s = trans(trunc(&mvs,1) &z,Yes Y,Yes N,No y,Yes n,No *,*)
n = trans(trunc(&bin,1) &z,No  Y,Yes N,No y,Yes n,No *,*)             ÿ
fir = trans(trunc(&fir,1) &z,No  Y,Yes N,No y,Yes,n,No *,*)
er (&sdsname,nb)
er (&thost,nb)
er (&ÿ
 if (&userid NE anonymous)
    ver (&password,nb)
    ver (&passwvfy,nÿ
      ver (&password,list,&passwvfy)
   if (&fir EQ Yes)
       ver (&firewall,nb)          ÿ
     ver (&bin,nb,list,Yes,No)
     ver (&mvs,nb,list,Yes,No)
     )Help                                        ÿ
        Field(sdsname)  panel(ftpbhf1)
        Field(thost)    panel(ftpbhf2)
        Field(tdsname)  panel(ftpbhf3)                           ÿ
          Field(userid)   panel(ftpbhf4)
          Field(password) panel(ftpbhf5)
          Field(passwvfy) panel(ftpbhf5)
ÿ
            Field(bin)      panel(ftpbhf7)
            Field(fir)      panel(ftpbhf8)
            Fieÿ
              Field(other)    panel(ftpbhf9)
              Field(other2)   panel(ftpbhf9)
             )End             ÿ
               ./ ADD NAME=FTPBCHST 0108-98169-99167-0740-00026-00024-00
BD             )Attr Default(%+_)
               /* + type(text  ) intens(low )ÿ
ly  */           /* _ type( input) intens(high) caps(on ) just(left )
    */              @ type(output) intens(high) caps(off) just(left )
                    # type( input) intens(high) caps(off) juÿ
                      ` type( input) intens(high) caps(off) just(left )
 color(blue)          % type(text) intens(high)
                      ~ type(text) intens(high) color(yellow)
                     )Body
                       +-------------------------~FTP Remote Hostname Cl
-----------------------%Command:%===>_zcmd
                       +
        ÿ
                         +  New Hostname:     `targhost
                         +  Host Description: #thdesc
                       ÿ
                           +  Review/Update Remote Job Card information:
                           +
                            ===> _rj1 ÿ
                           +  ===> _rj2
                           +  ===> _rj3
                           + )INIT                   ÿ
                                .CURSOR = targhost
                               )PROC
                                VER (&targhost,nb)                  ÿ
                                 )END
                                 ./ ADD NAME=FTPBCRDT 0102-98174-98247-0
8-00025-00000-SYSLBD             )Attr Default(%+_)
   ÿ
    information only  */              _ type( input) intens(high) caps(o
(left )                               ` type(output) intens(high)  caps(
t(left ) color(yelÿ
                                        ~ type(text) intens(high) color(
lite(reverse)                        )Body
                                 ÿ
edits+---------------------------------%Command ===>_Zcmd

                                       @ The folÿ
ebugged, provided code, suggestions,     @ or provided encouragement in
tion of this application:                +
                                                     `credit1  ÿ
                                                       `credit2
                                                       `credit3
                                                       `credit4
                                                         `credit5
                                                         `credit6
                                                         `credit7
             +
           ÿ
                                                             `credit10
                                                             `credit11
                          ÿ
                                                   )Init
                                                   )Proc
                                         ÿ
                                                     ./ ADD NAME=FTPBEXE
7010-98020-1545-00021-00026-00000-SYSLBD             )Attr Default(%+_)
                                                     /* ÿ
low )                   information only  */              _ type( input)
high) caps(off) just(left )                               ` type(output)
high)  caps(off) just(left ) color(yellow)                @ type(outputÿ
s(high)  caps(off) just(left ) color(white)                 % type(text)
high)                                                       ~ type(text)
high) color(blue) hilite(reverse)                        )Body
      ÿ
--------~TCP/IP FTP Executing+-----------------------------+
                                                                     ~Pa
           ~Patience+ÿ
                                                             +    Your T
le Transfer is now in progress:                              +
                                    ÿ
t: `sdsname                                                    +    To
t: @tdsnamex                                                   +      At
   @thost                                          ÿ
                                                                 +    St
 `zdate    `ztime                                                +
                                                                 )ÿ
                                                                   ./ AD
TPBGS   0114-96327-98285-0714-00031-00026-00000-SYSLBD             )Attr
(%+_)                                                              /* +
tÿ
input) intens(high) caps(on ) just(left )               */
utput) intens(high) caps(off) just(left )
input) intens(hiÿ
( input) intens(non)  caps(off) just(left )
(text) intens(high)
(text) intens(high) color(yello+
                             ÿ
-----------------~FTP Generalized Submit/Exec Panel+--------------------
ct Processing Option:%===>_OPT
                                            ÿ
  B -~Browse+the generated FTP job
  E -~Edit+the generated FTP job
  S -~Submit+the generated FTP job                         ÿ
    X -~eXecute+FTP~now+in the foreground

    Target host: @thost
 +
 %Review/Update:
 +     Local Batch Job Card:
  ===> _lÿ
 +  ===> _lj2
 +  ===> _lj3
 + )INIT                ÿ
      .cursor = opt
      .help = ftpbh1
      &opt = &z                        ÿ
       )PROC
        ver (&opt,list,B,E,S,X)
       )END                                           ÿ
         ./ ADD NAME=FTPBGSU  0116-96327-98285-0714-00036-00026-00000-SY
         )Attr Default(%+_)
         /* + type(text  ) intens(low )                   informationÿ
           /* _ type( input) intens(high) caps(on ) just(left )
              @ type( input) intens(high) caps(off) just(left )
              $ type( input) intens(high) caps(off) just(left ) pad('_')
    ÿ
                % type(text) intens(high)
                ~ type(text) intens(high) color(yellow)
             )Body ÿ
               +-----------------------~FTP Generalized Submit Panel+---
---------------%Select Processing Option:%===>_OPT
               +                  ÿ
                 %    B -~Browse+the generated FTP job
                 %    E -~Edit+the generated FTP job
                 %    BL-~Browse+the generated Lo+
                   %    EL-~Edit+the generated ÿ
                     %    S -~Submit+the generated FTP job
                     +
                     ~    Target host: @thost                 ÿ
                       +
                       %Review/Update:
ee Help for more info+ +     Local Batch Job Card:
                          ===> _lj1
                       +  ===> _lj2
                       +  ===> _lj3
            ÿ
important JOBName Info...+  ===> _rj1
                         +  ===> _rj2
                         + ÿ
                           + )INIT
                              .CURSOR = OPT
                              .help = ftpbÿ
                                &OPT = &Z
                               )PROC
                                VER (&OPT,LIST,B,E,S,BL,Eÿ
                                 )END
                                 ./ ADD NAME=FTPBGSUP 0109-97010-98086-1
6-00026-00000-SYSLBD             )Attr Default(%+_)
                                   /* + type(text  ) intens(low )
    information only  */              _ type( input) intens(high) caps(o
(left )                               ` type(text) intens(high)  caps(of
left ) ÿ
ust(left ) color(blue)                  % type(text) intens(high)
                                        ~ type(text) intens(high) color(
lite(reverse)         ÿ
                                       +------------~TCP/IP FTP Batch Su
 Information+------------              %Command ===>_Zcmd
                                     ÿ
                                         ` Successfully submitted JOB: @
                                         `
                                         ` The Batchÿ
ed will transfer the unloaded              ` data set to the target host
After the data set is                      ` transferred another Batch J
be submitted to Reload the                 ` data set back into a p+
data set (PDS).  This original               ` Batch JOB will waiÿ
0 minutes for the Reload JOB to                ` complete and if it does
e within that 10 minute period                 ` then it will retrieve t
d JOBs print out.  If the Reload               ` JOB does not complete w
ÿ
site and review the Reload JOBs                  ` print out there.
                                                 )Init
               ÿ
                                                   )End
                                                   ./ ADD NAME=FTPBGSUR
10-99154-0645-00027-00026-0000ÿ
                                                     /* + type(text  ) i
w )                   information only  */              _ type( input) i
gh) caps(off) just(left )                    ÿ
gh)  caps(off) just(left ) color(yellow)                  @ type(output)
high)  caps(off) just(left ) color(blue)                  % type(text) i
gh)                                                       ~ ÿ
high) color(blue) hilite(reverse)                        )Body window(67
                                                         +------------~T
P Batch Submission Information+------------              %Command ===>_Z
                                                           `
                                                           ` Successfull
ted JOB: @jobname                                          `
          ÿ
t was just submitted will transfer the unloaded              ` data set
arget host site.  After the data set is                      ` transferr
er Batch JOB will be submÿ
ts using DF/DSS.                                               `
                                                               ` This or
atch JOB will wait for up to 10 minutes ÿ
 complete and if it does complete within that 10                 ` minut
 then it will retrieve the Reload JOBs print out.                ` If th
 JOB does not complete within that 10 minute period    ÿ
ve to logon to that remote host site and review the                ` Rel
 print out there.                                                  )Init
                                                                   )Prÿ
                                                                     )En
                                                                     ./
=FTPBHF1  0103-98044-98084-1127-00025-00026-00000-SYSLBD             )at
lt(%++
npuÿ
text) intens(high) caps(off) just(asis ) color(yellow)
text) intens(high) caps(off) just(asis ) color(turq)
text) intens(high)ÿ
e(text) intens(high) color(turq) hilite(reverse)
 WINDOW(60,17)
              #FTP Source Data Seÿ
mmand ===>_ZCMD

ource Data Set+                                 ÿ

This input field defines the input data set name that will
be copied using FTP from the current system to the defined     ÿ
 ~target (remote) host.
 +
 `Examples:
   +
   ~  TEST.CLIST                + prompt for members if PDS
   ~  'hlq.TEST.CLIST(*)'       + send all members of PDS
   ~  'hlq.TEÿ
     ~  userid.TEST.**            + send all data sets that start
                                  +    with userid.TEST
     )Init                  ÿ
       )End
       ./ ADD NAME=FTPBHF2  0110-98096-98173-0811-00033-00029-00000-SYSL
       )ATTR                               ÿ
           # AREA(SCRL) EXTEND(ON)
           ` type(text) intens(high) caps(off) just(asis ) color(yellow)
           ~ type(text) intens(high) caps(off) just(asis )ÿ
             % type(text) intens(high)
             @ type(text) intens(high) color(turq) hilite(reverse)
           )BODY WINDOW(63,15)
             %COMMAND =  ==>_ZCMD
             +                                               %Up F10 Dn
             #FTPA -----------------------------------------------------
        ÿ
               `Hostname+
               +
               ~This in+
                 ~(reÿ
                   ~copied to. The key to a host name is that it referen
                   ~system that is part of the DASD complex where you wa
                   ~data set(s) to bÿ
                     ~
                     ~If%?~is used then you will be prompted with table
of                   ~all previously used hostnamesÿ
from                   ~1 to n.  You can also Clone, Update, and delete
s.                     ~
                       `Examples:                                 ÿ
                         +
                         ~  nkaisera.ncal.kaiperm.org + Northern Califor
 (prod)                  ~  nkaiserd.ncal.kaiperm.org + Northern Califor
 ÿ
0E (prod)                  ~  mvsd10a.kpscal.org        + Southern Calif
0A (dev)                   )INIT
                ÿ
                             )PROC
                             )END
                             ./ÿ
00024-00000-SYSLBD             )attr default(%+_)
                                 ` type(text) intens(high) caps(off) jus
 color(yellow)                   ~ type(text) ÿ
 ) color(turq)                     % type(text) intens(high)
                                   # type(text) intens(high) color(turq)
reverse)                         )BODY WINDOW(65,19)         ÿ
                                                         #FTP Target Dat
                                   %Command ===>_ZCMD
                                   +
                                         `Target Data Set+
                                     +
                                     ~This input field is optional and i
efines the ÿ
e system.  Or for                      ~non-MVS the new file name.
                                       ~
                          ÿ              ~No validity check is made unti
ion time for this field.                 ~
                                         ~This field can also contain a
rive:\directory\filename                 ÿç
 (e.g. c:\t\newname.txt)                               ~
                                                       `Examples:
                                                       +ÿ
                                                         ~  userid.TEST.
      + new name for input library                       ~  userid.TEST.
      + new name for input library mask                  ~  c:\temp\newÿ
t       + drive 'c' directory temp w/newname               )Init
                                                           )End
                                                           ./ ADD NAME=F
0104-9ÿ
                                                             @ type( inp
ns(high) caps(on ) just(left ) pad('_') color(turq)          ` type(text
(high) caps(off) justÿ
ns(high) caps(off) just(asis ) color(turq)                     % type(te
ns(high)                                                       # type(te
ns(high) color(turq) hilite(reverse)ÿ
,12)
       #FTP Userid+                                              %Comman
CMD                                                ÿ
                                                                    `Use
                                                                   +
                                                                  ÿ
 field defines the#userid~to be used at the remote                   ~sy
t may not be the same as the userid in use at                        ~du
 currently active TSO session.                                       ~
 ÿ
d of `anonymous~is used then the password fields are                   ~
dated.                                                                 )
                ÿ

NAME=FTPBHF5  0103-98044-98044-1126-00019-00024-00000-SYSLBD
efault(%+_)                    ÿ
e( input) intens(high) caps(on ) just(left ) pad('_') color(turq)
e(text) intens(high) caps(off) just(asis ) color(yellow)
e(text) intens(high) caps(off) just(asis ) colÿ
ype(text) intens(high)
ype(text) intens(high) color(turq) hilite(reverse)
DY WINDOW(62,12)                                             +
                       #FTP Password+                      ÿ
 %Command ===>_ZCMD

  `Password+ and `Verify Password+
   ~
   ~These input fields are`non-display~fields so that your
   ~password is kept hidden and secure.  Enter the password
   ~for tÿ
     ~at least it was entered the same both times.
     ~
     )Init              ÿ
       )End
       ./ ADD NAME=FTPBHF6  0104-98044-98044-1127-00018-00024-00000-SYSL
       )attr default(%+_)              ÿ
         @ type( input) intens(high) caps(on ) just(left ) pad('_') colo
         ` type(text) intens(high) caps(off) just(asis ) color(yellow)
         ~ type(text) intens(high) caps(off) just(asisÿ
           % type(text) intens(high)
           # type(text) intens(high) color(turq) hilite(reverse)
           )BODY WINDOW(62,10)                                       ÿ
                                #FTP MVS option+
             %Command ===>_ZCMD

    ÿ
               ~
               ~If the target (remote) system is another MVS system
               ~theÿ
                 ~the transfer should not use the MVS optimized paramate
                 ~
                 )Init            ÿ
                   )End
                   ./ ADD NAME=FTPBHF7  0105-98044-98044-1127-00024-0002
SYSLBD             )attr default(%+_)            ÿ
                     @ type( input) intens(high) caps(on ) just(left ) p
color(turq)          ` type(text) intens(high) caps(off) just(asis ) col
w)                   ~ type(text) intens(high) caps(off) just(asÿ
q)                     % type(text) intens(high)
                       # type(text) intens(high) color(turq) hilite(reve
                       )BODY WINDOW(60,16)

                           %Command ===>_ZCMD

                            `Binary+
            ÿ
                             ~If the target (remote) system is#not~an MV
                             ~then you might want to specify`binary~if t
is                         ÿ
al or                          ~other non-alphanumeric data it should pr
e                              ~sent as binary.
                               ~          ÿ
                                 ~Caution should be exercise when using
ion as                           ~the application at the remote system m
ble to                           ~understand the data in ÿ
s the format                       ~of the data on the MVS system.
                                   )Init
                                   )End
                                     ./ ADD NAME=FTPBHF8  0106-98044-980
00021-00024-00000-SYSLBD             )attr default(%+_)
                                     @ type( input) intens(high) caps(on
left ) ÿ
asis ) color(yellow)                   ~ type(text) intens(high) caps(of
asis ) color(turq)                     % type(text) intens(high)
                      ÿ
ilite(reverse)                           )BODY WINDOW(50,13)
                                                            #FTP Firewal
+                                    ÿ

                                            `Firewall+
                                           ~        ÿ
                                             ~If you are going to FTP yo
outside the                                  ~company you will have to p
 a firewall. A                               ~firewall protects theÿ
CP/IP environment                              ~from the 'world'.
                                               ~
                                               ~When you specify#yes~to
 tÿ
                                                 )Init
                                                 )End
                 +
44-98044-1127-0ÿ
                                                     @ type( input) inte
 caps(on ) just(left ) pad('_') color(turq)          ` type(text) intens
aps(off) just(asis ) color(yelÿ
 caps(off) just(asis ) color(turq)                     % type(text) inte
                                                       # type(text) inte
 color(turq) hilite(reverse)                 ÿ

 Initial Command+                                        %Command ===>_Z
                                                            ÿ
                                                            `Initial Com
                                                           ~
                                                           ~These fields
 you to enter 2 optional FTP                                 ~subcommand
ill be processed before the FTP                              ~PUT comman
cessed to do the transfer.  See                              ~the TCP/IP
tation forÿ
descriptions.                                                  )Init
                                                               )End
                         ÿ
BH0   0126-96337-98173-0810-00128-00068-00000-SYSLBD             )Panel
ISPHelp,ISP)                                                     )Attr D
+_)                                     ÿ
put) intens(high) caps(on ) just(left )               */              @
put) intens(high) caps(on ) just(left ) pad('_') color(turq)          !
put) intens(high) caps(off) just(asis ) color(white)   ÿ
ext) intens(high) caps(off) just(asis ) color(yellow)
ext) intens(high) caps(off) just(asis ) color(turq)
ext) intens(high)                                                     ÿ
(text  ) intens(low )
(on)
(SCRL) Extend(ON)                                                      )
     ÿ
------------------%TCP/IP Batch FTP Tutorial+---------------------------
d ===>_zcmd
                    ÿ
                                                            %Up F10 Dn F
 -----------------------------------------------------------------------
 Help                              +
his ISPF Dialog is designed to siÿ
 Transfer Protocol (FTP) for transferring files from the current MVS
 system to another TCP/IP enabled system.   Press~ENTER+to scroll down.
                                                ÿ
 + Field level help is available by moving the cursor to the field in
 + question and pressing PF1 (HELP).
 +                                                             ÿ
   + To move up and down in this tutorial use the Left (Up) and Right (D
   + program function keys (PF7 and PF8).
   +
     +
     + %Fields                   Description
     + ~                       +
     + ~Sourcÿ
       + ~                       +is to be transmitted.
       + ~                       +
       + ~                  ÿ
         + ~                       +sequential data set is not supported
         + ~                       +you can transfer members of a PDS to
tory     + ~                       +on yourÿ
en the     + ~                       +option of using IEBCOPY to unload
 doing     + ~                       +the transfer, and then using IEBCO
load       + ~                       +the PDS - all using ÿ
             + ~                       +
             + ~                       +It is~important+to remember when
rring        + ~                       +a load library that the direct F
a              + ~                       +member will not be successful
oes not        + ~                       +transfer the load module direc
               + ~                       +information correctly.  Thus,
        ÿ
ormed in         + ~                       +batch only using IEBCOPY to
the load         + ~                       +library into a sequential da
or the           + ~   ÿ
                   + ~                       +
                   + ~                       +For transferring a PDS you
cify a member      + ~                ÿ
. xx*), or *         + ~                       +for all members.
                     + ~                       +
                     + ~                       +You c+
 dataset name          + ~                       +fÿ
dss.                     + ~                       +(e.g. SYS1.TEST.*)
                         + ~                       +
                         + %Target Information     +              ÿ
                           + ~                       +
                           + ~Hostname               +This is the TCP/IP
r IP Address) of the       + ~                       +target system that
rÿ
                             + ~                       +
                             + ~                       +if the hostname
a selection listÿ
mes will be displayed from     + ~                       +which you can
rom one to n.                  + ~                       +
                               ÿ
 if blank will default to        + ~                       +the same nam
 Source Data Set.  If filled     + ~                       +in this data
e will be used.                  + ~          ÿ
                                   + ~                       +e.g.  SYS2
W                                  + ~                       +      SYS2
.**                                + ~                       ÿ
                                     + ~                       +For non-
ets this field can be contain        + ~                       +the driv
rectory information and an           + ~                       +optional
ilename.                               + ~                       +
                                       + ~                       +  e.g.
\newname.txt                           + ~                       +
           ÿ
                                         + ~                       +
                                         + ~Userid                 +This
 TSO Userid that will be uÿ
gs into the target host.                   + ~                       +
                                           + ~                       +No
userid field is case sensitive to        ÿ
accessing workstations that allow mixed      + ~                       +
rids.                                        + ~                       +
                                             + ~Passwordÿ
s the password for the specified Userid of     + ~
rget host system.  The password is not         + ~
yed for security reasons and you must          + ~                     +
r it a second time for verification.             + ~                 ÿ
te: the password field is case sensitive to        + ~
pport accessing workstations that allow mixed      + ~
se passwords.                                      + ~
    ÿ
                                                     + ~
                                                     + ~MVS Target
Asks if the target ÿ
 +operating system.                                    + ~
 +                                                     + ~Binary
 +If you are transferring the Sourÿ
   +a non-MVS host (e.g. a Unix system) then you         + ~
   +can specify that you want to transfer the data       + ~
   +in binary`if~the data contains non alphanumerÿ
     +characters (e.g. hexadecimal or packed decimal).     + ~
     +                                                     + ~Firewall
     +If you need to FTP through a Firewall this gives     + ~  ÿ
       +you the ability to indicate that and then to         + ~
       +specify the host name of the firewall.               + ~
       +                                                     + ~Initial

         +commands that you would like.  These will be         + ~
         +executed prior to the actual transfer of the         + ~
         +Sourÿ
           +                                                     + ~
           +For example, you could enter:  cd a:                 + ~
           +if you wanted to ÿ
             +You could also enter:  dir                           + ~
             +to cause the target directory to be displayed.       )Init
                                            ÿ
 zcmd                                                                )Pr
                                                                     )en
                                                           ÿ
ME=FTPBH1   0109-96338-98097-0944-00062-00058-00000-SYSLBD             )
ylist(ISPHelp,ISP)                                                     )
ault(%+_)                                                              /
pe( input) intens(high) caps(on ) just(left )               */
pe( input) intens(high) caps(on ) just(left ) pad('_') color(turq)
pe(output) intens(high) caps(off) just(asis ) color(white)
pe(text) +
type(teÿ
% type(text) intens(high)
+ type(text  ) intens(low )
  skip(on)            ÿ
  # area(SCRL) Extend(ON)
Body
---------------%TCP/IP Batch FTP Submÿ
-%Command ===>_zcmd
 %
 +                                                  ÿ
1  #help ---------------------------------------------------------------
--#)Area Help
   ~ This portion of the TCP/IP FTP Dialog allows you to review (Brÿ
     ~ update (Edit), submit JCL for batch execution (Submit), and execu
     ~ the file transfer in the foreground (eXecute).
     ~
  ÿ
       ~ as a security measure.  It will be included for the~S~and%X~opt
       ~
       ~ You haveÿ
         +
         %    B -+Browse~the generated FTP job
         ~                      ÿ
           ~        This option allows you to review the generated JCL a
           ~        instructions.  It also provides you with a review to
           ~        that the changes you made wÿ
             ~
             %    E -+Edit~the generated FTP job
             ~                                                ÿ
               ~        You can use this to make updates to the JCL and/
ommands.       ~        For example, you might want to insert additional
mands          ~        before or after the actual PUT instruction and t
tion             ~        allows you this capability.
                 ~
                 %    S -+Submit~the generated FTP job
            ÿ
                   ~        Submit will take the generated JCL and FTP i
ons and            ~        submit them to the internal reader for execu
batch.             ~       +
                     %   ÿ
                       ~
                       ~        This option will invoke the file transfe
ately under            ~        your TSOÿ
be displayed on          ~        your terminal (unfortunately at this t
s not possible           ~        to capture these messages to a file fo
ing and/or printing      ~        so if you require thaÿ
he%S~option).              ~
                           ~    The JOB card displayed will be used if y
t option%S~ and is         ~    available for changing here.  Any chanÿ
 be remembered               ~    between sessions.  If the jobname is y
id plus one character        ~    then it will have the suffix character
 for each session.           ~
     ÿ
                                 .cursor = zcmd
                               )Proc
                    ÿ
                                 ./ ADD NAME=FTPBH2   0110-96338-98162-1
9-00058-00000-SYSLBD             )Panel Keylist(ISPHelp,ISP)
                                 )Aÿ
                                   /* _ type( input) intens(high) caps(o
(left )               */              @ type( input) intens(high) caps(o
(left ) pad('_') color(turq)          ! type(outpuÿ
st(asis ) color(white)                  ` type(text) intens(high) caps(o
(asis ) color(yellow)                   ~ type(text) intens(high) caps(o
(asis ) color(turq)                     % type(text) intens(high)ÿ
                                          + type(text  ) intens(low )
                                            skip(on)
                                          # area(SCRL) Extend(ON)
ÿ
                                         +----------------------%TCP/IP
P Submit Tutorial+-----------------------%Command ===>_zcmd
               ÿ
                                           +
                           %Up F10 Dn F11  #help -----------------------
------------------------------ÿ ------------#)Area Help
                                             ~ This portion of the TCP/I
alog allows you to review (Browse),          ~ update (Edit), review the
JCL (Browse Load), update the reload         ÿç
d submit JCL for batch execution (Submit).                 ~
                                                           ~ Note that t
ord will not be displayed as a security measure.  It       ~ÿ
only for the%S~option.                                       ~
                                                             ~ Read the
below on where the submitted JOB's SYSOUT can be found.      ~
                                                               ~ You hav
llowing options on the menu:                                   +
                                                               %    B -+
he generatÿ
                                                                 ~
ption allows you to review the generated JCL and FTP             ~
ctions.  It also providesÿ
 the changes you made with option%E~are what you want.             ~
                                                                   %
se~the generated JCL for reloading the lÿ
                                                                     ~
is option allows you to review the generated JCL and IEBCOPY         ~
structions.  It also provides you with a review to insuÿ
the changes you made with option%EL~are what you want.                 ~
                                                                       %
Edit~the generated FTP job                                            ÿ

  You can use this to make updates to the JCL and/or FTP commands.
  For example, you might want to insert additional FTP commands
  befÿ
    allows you this capability.

EL-+Edit~the generatÿ

      This option allows you to update the generated JCL and IEBCOPY
      instructions.  WIth this optiÿ
        example, you could change the unit type for the allocation of th
        target data set.
                                                  ÿ
 %    S -+Submit~the generated FTP job
 ~
 ~        Submit will take the generated JCL and FTP instructions+
   ~        submit them to the internal reader for execution inÿ
     ~
     ~
     ~    The JOB cards displayed will be used if you select option%S~an
       ~    available for changing here.  Any changes will be remembered
       ~    between sessions.  If the jobname is your userid plus one ch
       ~    then it will have the suffix character updated for each sess
       ~    Tÿ
         ~    submitted and executed on the local system to unload and t
         ~    the data set.  The second (bottom) set of JOB statements w
         ~    submitted usinÿ
           ~    executed at the target site.
           +
           ` Submitted JOB's SYSOUT Informaÿ
             ~
             ~    The JOB that will be submitted to reload the unloaded
 will        ~    automatically be retrieved by this appliÿ
rinted         ~    by the last generated JOB STEP.`IF~the JOB runs long
10 minutes     ~    then this action will not occur as the FTP JOB will
t for 10       ~    minutes for the submitted JOB to end before the wait
nates.  You      ~    will then have to LOGON to the remote system to vi
YSOUT for        ~    the reload JOB.
                 ~
        ÿ
 format            ~   userid plus 1 character in order for its output t
rieved             ~   to the submitting job.  The userid must be the us
d for the          ~   ÿ
                     )Init
                       .cursor = zcmd
                     )Proc            ÿ
                       )end
                       ./ ADD NAME=FTPBM    0102-96326-97318-1441-00031-
000-SYSLBD             )ATTR                         ÿ
                           _ TYPE(INPUT) CAPS(OFF) INTENS(HIGH)
                           × AREA(DYNAMIC) SCROLL(ON) EXTEND(ON)
                           + TYPE(TEXT) INTENS(LOW)                 ÿ
                             # TYPE(OUTPUT) INTENS(HIGH) JUST(RIGHT) PAD
                            01 TYPE(DATAIN) INTENS(HIGH) CAPS(ON)
                            02 TYPE(DATAOUT) INTENS(LOW)
   +
 ÿ
                                05 TYPE(DATAOUT)  INTENS(HIGH)
                                06 TYPE(DATAOUT)  INTENS(LOW)
                ÿ
                                 %Member List -- &ZDSN -----------------
-------------%ROW#ZMLCR%OF#ZMLTR+%Command ===>_ZCMD
               %Scroll ===>_Z  ÿ
HELP                              +%Line commands: / or S = Select, B =
\ or U = Unselect                 +&ZMLCOLS
                                   ×ZDATA ----ÿ
------------------------------------××
                                    ×× ---------------------------------
------------------------------------×)INIT                   ÿ
                                         .ZVARS = 'ZSCML'         /* SCR
VARIABLE NAME  */                        .HELP = ISR01130
                                       )PROC
                                           VPUT (ZSCML) PROFILE
                                         )END
                                          /*  $M1= MEMLIST   M230     86
58590 : FUNÿ
                                 */         /*
                                 */         /*   CHANGED 3 LINES
                          ÿ
1980, 1989 */                                ./ ADD NAME=FTPBPDSC 0101-9
88-1101-00017-00017-00000-SYSLBD             )attr default(%+_)
                                         ÿ
on ) just(left ) pad('_') color(turq)          ` type(text) intens(high)
f) just(asis ) color(yellow)                   ~ type(output) intens(hig
off) just(asis ) color(turq)                   % type(teÿ
                                                 # type(text) intens(hig
(turq) hilite(reverse)                           )BODY
                                                                #Patienÿ
lculating the Space Requirements+                  %Command ===>_ZCMD

                                                    #Patience+     #Pati
  #Patÿ
                                                                `The dia
alculating the temporary space                                  `require
e unload of the selec+
                   ÿ
                                                         )End
                                                         ./ ADD NAME=FTP
06-98075-99088-1101-00019-00018-00ÿ
                                                           @ type( input
(high) caps(on ) just(left ) pad('_') color(turq)          ` type(text)
igh) caps(off) just(asis ) color(yellow)         ÿ
ns(high) caps(off) just(asis ) color(turq)                   % type(text
(high)                                                       # type(text
(high) color(turq) hilite(reverse)                           )BOÿ

Patience - Building List of Eligible Datasets+                 %Command
D

 #Patience+     #Patience+     #Patience+     #Patience+

 dialog is buiÿ
hich may take some time depending on how generic
our selection criteria is.
                             ÿ
n pattern: ~sdsname                                                  )In
                                                                     )En
                                            ÿ
ME=FTPBPDSS 0126-96347-00139-1010-00044-00023-00000-SYSLBD             )
ault(%+_)                                                              /
(text  ) intens(low )                   information only  *ÿ
pe( input) intens(high) caps(off) just(left )
pe( input) intens(high) caps(on) just(left )
pe(output) intens(high)  caps(off) just(left ) color(yellow)
type(text) intens(high)
type(text) intens(high) color(blue) hilite(reverse)

---------ÿ
mmand ===>_Zcmd

 DFSMSdss (ADRDSSU) willÿ
   transfer using FTP and used there for the reload.

   DFSMSdss options:                   +
 +                                   ÿ
   +   Exclusive use of data set(s) during unload:       %===>_vex+  Yes
   +
   +   Dump All data or only Used data              ÿ
ed   +
     +   Optional Restore Options:
     +      Replace dataset                                %===>_vrÿ
No     +      Volser                                         %===>$odyvo
       +      Management Class, blank, or NONE               %===>$odymc
       +      Storage Class, blank, or NONE                  %===>$odysc
  ÿ
s or No  +
         )Init
          .cursorÿ
            .help = FTPBPH0
            &vex = trans(trunc(&vex,1) &z,No Y,Yes N,No y,Yes n,No)
            &val = trans(trunc(&ÿ
              &vrp = trans(trunc(&vrp,1) &z,Yes Y,Yes N,No y,Yes n,No)
              &otenq = trans(trunc(&otenq,1) &z,No Y,Yes N,No y,Yes n,No
             )Proc                             ÿ
                &vex = trans(trunc(&vex,1) Y,Yes N,No y,Yes n,No *,*)
                ver (&vex,nb,list,Yes,No)
                &val = trans(trunc(&val,1) A,All U,Used a,All ÿ
                  ver (&val,nb,list,All,Used)
                  &vrp = trans(trunc(&vrp,1) Y,Yes N,No y,Yes n,No *,*)
                  ver (&vrp,nb,list,Yes,No)
                    &otenq = trans(trunc(&otenq,1) Y,Yes N,No y,Yes n,No
                    ver (&otenq,nb,list,Yes,No)
                   )End
            ÿ
0-SYSLBD             )Panel Keylist(ISPHelp,ISP)
                     )Attr Default(%+_)
                     /* _ tÿ
          */              @ type( input) intens(high) caps(on ) just(lef
'_') color(turq)          ! type(output) intens(high) caps(off) just(asi
r(white)                  ` type(text) intÿ
r(yellow)                   ~ type(text) intens(high) caps(off) just(asi
r(turq)                     % type(text) intens(high)
                            + type(text  ) intens(low )  +
                                skip(on)               ÿ
                                # area(SCRL) Extend(ON)
                             )Body
                             +-----------------%TCP/IP Batch FTP DSSMSÿ
pt Tutorial+-------------------%Command ===>_zcmd
                               %
                               +
     ÿ
--------------------------------#)Area Help
                                 ~ This panel is used to prompt the user
selected transfer haÿ
should be used.                    ~
                                   ~ The information that you will be pr
o provide is:                      ÿ
                                     % Exclusive use of data set(s) duri
d:+                                  ~
                                     ~%Yes~means tÿ
quire exclusive use of the             ~ dataset(s).  No other batch or
ob/user will be allowed to             ~ use it while your transfer unlo
nning.  Nor will your job run          ~ until it can gain exclusÿ
                                         ~
                                         ~%No~means that you don't requi
sive ownership of the                    ~ dataset(s) and is the suggest
ÿ
                                           % Dump All data or only Used
                                           ~
               ÿ
or the specified datasets                    ~
                                             %Used~will only dump the us
.                             ÿ
                                               % Optional Restore Option
ovided in case you need them.                  ~
                                             ÿ
                                                 ~
                                                     ~%Yes~means that if
aset exists at the target site already that          ~ you wÿ
with this transfer                                     ~
                                                       ~%No~means that i
taset already exists to leave it alone and             ~ not to replace
                                                     ~
                                                       %    Volser
                                                       ~
                                                       ~    If you want
re the dÿ
                                                         ~
                                                         %    Management
blank, or NONE         ÿ
                                                           ~    If you w
verride the existing SMS Management Class or have          ~    the exis
ss ignored specify it here.  A class nÿ
 Management class to be used during the restore.             ~    NONE m
ded to indicate no Management class is to be used.           ~
                                                     ÿ
s, blank, or NONE                                              ~
                                                               ~    If y
to override the existing SMS Storage Class or have             ~    ÿ
ng class ignored specify it here.  A class name will             ~    ca
 new Storage class to be used during the restore.  NONE          ~    ma
ed to indicate no Storage class is to be used.                   ~
   ÿ
 ENQ Failure on Restore                                            ~
                                                                   ~
hen an ENQ failureÿ
                                                                     )In
                                                                       .
 zcmd                            ÿ
                                                                       )
                                                                       .
ME=FTPBPPDS 0111-96347-98279-0710-00046-00023-00ÿ
efault(%+_)
pe(text  ) intens(low )                   information only  */
pe( input) intens(high) caps(off) just(left )                  ÿ
type(output) intens(high)  caps(off) just(left ) color(yellow)
type(text) intens(high)
type(text) intens(high) color(blue) hilite(reverse)
dy
-------------------------~TCP/IP FTP PDS Prompt+------------------------
mmand ===>_Zcmd
             +
   You are ÿ
 +
 +   Create/Replace data set at target%===>_new+   Yes or No
 +                        ÿ
   +   Unload for transfer              %===>_unl+   Yes or No  (Should
   +                                                 be Yes for load lib
   +                                     ÿ
     +   Create SYSUT3 for IEBCOPY Unload %===>_ut3+   Yes or No. Need f
 PDS +   e.g. //SYSUT3 DD SPACE=(CYL,(50,50)),UNIT=SYSDA
     +                                                  ÿ
       +   Note: ~If+you specify Create YES the dataset~will be deleted+
 the   +          reload at the target host.
       +                                                               ÿ
         +   Note when transferring a large number of members it can be
o        +   unload the PDS using IEBCOPY, FTP it, then reload it at the
site     +   using IEBCOPY.
      ÿ
           +   You will now be prompted (unless you specified all member
lect the   +   members for transfer to:`xhost
           )Init     ÿ
              .cursor = new
              &new = trans(trunc(&new,1) Y,Yes N,No y,Yes n,No &z,&z)
              &unl = trans(trunc(&unÿ
                &ut3 = trans(trunc(&ut3,1) Y,Yes N,No y,Yes n,No &z,No)
                &xhost = &thost
                if (&thost = '*****')              ÿ
                      &xhost = 'multiple target hostnames'

                 )Proc                                            ÿ
                    &new = trans(trunc(&new,1) Y,Yes N,No y,Yes n,No *,*
                    &unl = trans(trunc(&unl,1) Y,Yes N,No y,Yes n,No *,*
                    &ut3 = trans(trunc(&ut3,1) Y,Yes N,No y,Yes n,No *,*
 ÿ
                      ver (&unl,nb,list,Yes,No)
                      ver (&ut3,nb,list,Yes,No)
                ÿ
                       ./ ADD NAME=FTPBPRCL 0103-98075-98168-0620-00018-
000-SYSLBD             )attr default(%+_)
                       @ type( +
_') color(turq)          ` tyÿ
(yellow)                   ~ type(text) intens(high) caps(off) just(asis
(turq)                     % type(text) intens(high)
                           # type(text) inteÿ
e)                           )BODY WINDOW(57,10)
                                    #Multiple Data Set Transfer Prompt+
                             %Command ===>_ZCMD            ÿ

                                `The next panel is an ISPF 3.4 like pane
hich                            `you should issue an HRECALL command for
ata sets                          `which have a volser of%MIGRAT`otherwi
 will                             `not be included in the transfer.

         ÿ
                                   )Init
                                   )End
                        ÿ
00026-00026-00000-SYSLBD             )Attr Default(%+_)
                                     /* + type(text  ) intens(low )
      information only  */             ÿ
just(left )                               ` type(output) intens(high)  c
 just(left ) color(yellow)                % type(text) intens(high)
                                          ~ type(text)ÿ
) hilite(reverse)                        )Body
                                         +-----------------------------~
TP Warning+------------------------------%Command ===>_Zcmd          ÿ

                                           ~WARNING+ ~WARNING+ ~WARNING+
G+ ~WARNING+ ~WARNING+ ~WARNING+ ~WARNING+ +
    ÿ
o transfer is a data set that when unloaded  + will have a DCB that can
uccessfully transferred using FTP.           +
                   ÿ
                                               +
                                               +    1.  Reblock the data
a BLKSIZE less than 32756 permanenÿ tly          +    2.  Reblock the da
nto a temporary data set with a BLKSIZE          +        less than 3275
                                                 +    3.  Don't use the
ransfer option                                   ÿç
                                                               +
                                                               )Init
                                                               )ÿ
                                                                 )End
                                                                 ./ ADD
BSDSH 0101-99079-99079-2210-00030-00023-00000-SYSLBD             )attr d

) intens(high) caps(on ) just(left ) pad('_') color(turq)          ` typ
intens(high) caps(off) just(asis ) color(yellow)                   ~ typ
intens(high) cÿ
) intens(high)                                                       # t
) intens(high) color(turq) hilite(reverse)                           )BO
                             ÿ
                   #FTP DataSet Select+                                %
===>_ZCMD
                                            ÿ
election table allows you to select`or+exclude datasets to be
ered using FTP from this system to another.  ADRDSSU (aka DF/DSS)
d to unload all eligible datasets into a sequential file toÿ
 via FTP and then reloaded at the remote system.

s:+
tasets that are in MIGRAT status will`are+not eligible for processing.
`Selections+or`Exclusions+will cause all eligible datasets to be process
lect+and`Exclude+are mutually exclusive.
         ÿ
Available line commands are:

`E+to Exclude a dataset ÿ
  `M+to Migrate a dataset using DFSMShsm  `U+to UnSelect or UnExclude a
  `R+to Recall a dataset using DFSMShsm
 +                                     ÿ
   +See the DFSMSdss documentation for further information on Select (In
   +or Exclude processing.
   )Init                                              ÿ
     )End
     ./ ADD NAME=FTPBSDSL 0122-99071-99287-1350-00032-00024-00000-SYSLBD
     )Attr Default(%+_)                                              +
       /* % type(text  ) intens(high)              Defaults displayÿ
         /* + type(text  ) intens(low )                   information on
         /* _ type( input) intens(high) caps(on ) just(left )
            ! type( input) intens(high) caps(on ) just(left ) pad('_')
  ÿ
              @ type( input) intens(low ) caps(off) just(right) pad(' ')
              ~ type(text) intens(high) color(blue) hilite(reverse)
              ` tÿ
             )Body  Expand(//)
             %-/-/- ~FTP Dataset Selection+ -/-/-
             %Command ===>_zcmd ÿ
>_amt +        %
               +Command Options:`Find+or`Refresh+to refresh the list or`
               +Selection Options:`S+Select`U+Uÿ
nd`M+Migrate     +No selection will transfer all non-MIGRAT datasets.
                 +
                 %Sel  Action  Dataset                        ÿ
Dsorg Size  Volume +
                   )Model
                   !z+  ^z      ^z
 ^z    @z   +^z      )Init
                       .ZVARS = '(zsel action cmdsn zdldsorg zdlsize zdl
                       &amt = csr
            ÿ
                       )Reinit
                        .cursor = &zcmd
                       )Proÿ
                         if (&zsel = _)
                             &zsel = &z
                         ver (&zsel,list,Sÿ
                           )End
                           ./ ADD NAME=FTPBSHST 0123-98163-99287-1353-00
5-00000-SYSLBD             )Attr Default(%+_)            ÿ
                             /* % type(text  ) intens(high)
s displayed for */           /* + type(text  ) intens(low )
formation only  */           /* _ type( input) intens(high) caps(on ) ju
t )               */              ! type( input) intens(high) caps(on )
t ) pad('_')                      ^ type(output) intens(low ) caps(off)
s ) pad(' ')                      # type(output) intens(high) caps(off)
s ) pad+
     ÿ
te(reverse)                           ` type(text) intens(high) color(re
                                   )Body  Expand(//)
                    ÿ
                                     %Command ===>_zcmd
        / /%Scroll ===>_amt +        %
                                   ÿ
                                       +Selection Options:`C+to clone`D+
e`U+to update`\+to unSelect            +
                                       %Sel  Actioÿ
                                         +                    Descriptio
                                         +
                                         )Model                  ÿ
                                           !z+  ^z       ^z
                                           +             #z
                                           )Init
ÿ
esc)'                                          &amt = csr
                                             )Reinit
               ÿ
                                               )End
                                               ./ ADD NAME=FTPBSITE 0115
8281-0842-00042-00027-00000-SYÿ
                                                 /* + type(text  ) inten
                  information only  */              % type( input) inten
caps(on ) just(left )                        ÿ
) caps(off) just(left )                               ` type(text) inten
 caps(off) just(left ) color(yellow)                  @ type(output) int
)  caps(off) just(left ) color(white)                 ~ typeÿ
) color(blue) hilite(reverse)                        )Body
                                                     +------------------
CP/IP FTP Space Verification+------------------------+
                                                       + Enter/Verify th
ing space allocation information for:                  +
                                                       + Target Dataset:
dsn       ÿ
                                                         `DCB=
                                                         +   RECFM:
recfm`     Record Format +
yslrecl`     Logical Reÿ
_blk     `     Blocksize or 0 for System Determined Blksize  +
                                                             `SPACE=
                                      ÿ
  _sp     `       Blocks, TRK, or CYL                          +   Prima
  _pri     `      Primary space allocation                     +   Secon
  _sec     `      Secondary space allocation         ÿ
    _direct`        Directory blocks if a PDS                    +   Rel
    _rel`           Release (Yes or No)                          +
                                                                 +Opÿ
                                                                   +   D
      %tunit    `     Optional target device or esoteric           +   V
      %tvol  `        Optional target volser                       +
   ÿ
                                                                       &
ns(trunc(&sp,1) B,Blocks T,TRK C,CYL)                                  &
ans(trunc(&rel,1) ÿ

rans(trunc(&sp,1) B,Blocks b,Blocks T,TRK t,TRK C,CYL c,CYL)
trans(trunc(&rel,1) Y,Yes N,No &zÿ

 trans(trunc(&sp,1) B,Blocks b,Blocks T,TR t,TR C,CYL c,CYL *,*)
= trans(trunc(&rel,1) Y,Yes N,No y,Yes n,No *,*)ÿ
 (&sp,nb,list,Blocks,TR,CYL)
 (&rel,nb,list,Yes,No)
                                                               ÿ
ADD NAME=FTPBUHST 0112-98169-99096-0745-00028-00022-00000-SYSLBD
tr Default(%+_)
+ type(text  ) intens(low )                   information only  */
* _ type( input) intens(high) caps(on ) just(left )               */
  @ type(text) intens(high) caps(off) just(left )
  $ type( input) intens(high) caps(off) just(left ) pad('_')
  ` type( inpÿ
    # type( input) intens(high) caps(off) just(left) color(blue)
    % type(text) intens(high)
    ~ type(text) intens(highÿ
   )Body
   +-------------------------~FTP Remote Hostname Update+---------------
---%Command:%===>_zcmd                     +
     +                                   ÿ
       +  Hostname:     `targhost
       +  Description:  #thdesc                          +
                                                        ÿ
           @Review/Update Remote Job Card information:

         +===> _rj1                                                    ÿ
         + +===> _rj2
         + +===> _rj3
         + )INIT
      ÿ
                .CURSOR = thdesc
             if (&thdesc NE &z)
                .CURSý OR = rj1
               )PROC
               )END
               {

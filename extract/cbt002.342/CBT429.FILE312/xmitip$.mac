Lionel B. Dyck             Page 1                   08/21/00

Distributing Reports from Batch Jobs via E-Mail

How many times have you wanted to have `that' report in
your e-mail inbox instead of having to wait for it to be
printed and then delivered to you?

This document describes a simple process that can be used
by any batch job to distribute reports as e-mail
attachments to electronic mail addresses. You can
distribute from one to n files to from one to n addresses.
The attachment will be translated from EBCDIC to ASCII
during the electronic mail processing so only text files
should be sent (note that special characters may not
translate correctly so you should test your file before
implementing this process into a production job).

The benefit is that you can send reports, using the FORMAT
keyword, as rich text formats (RTF), documents, and
specify landscape or portrait orientation as well as the
font size. This approach is useful as the batch, formerly
printed reports, arrive in the users mailbox in a format
similar to the printed report. You can also send reports
as HTML files so they can be viewed using a standard web
browser.

With the latest update support has been provided to create
Adobe Portable Document Format (PDF) file attachments from
your mainframe reports.  PDF file attachments can be read
on the workstation using Adobe Acrobat.  The advantage of
the PDF format over the RTF format is that, while you get
the same relative display fidelity compared to a printed
version of the report, with PDF the user can not change
the contents of the report and can use the free Adobe
Acrobat reader.

Support is also available to send a file attachment as a
binary attachment. This option is used for files that are
already in ASCII or should be transported in binary format
such as a ZIP file (created by PKZIP/MVS or ISPZIP on
OS/390). If you wish the file can be ZIP'd as part of the
XMITIP process (see the FORMAT keyword below).

This document is in four parts. Part 1 documents how to
use the XMITIP REXX Application to electronically
distribute messages and/or text files (as text
attachments) to electronic mail addresses via the intranet
or internet. Part 2 documents how to view the attachment
on the workstation. Part 3 describes how to install and
customize this application. Part 4 documents how to
customize your own application to do this.


Part I.   Using the XMITIP REXX Application
The XMITIP application can be used in Batch using the
Batch Terminal Monitor Program (TMP), under native TSO or
any other environment, which uses the TMP (e.g. many
automation products), and utilizing an ISPF interface.

The Batch process is shown in this example:

     //xxx JOB ...
     //TSOB EXEC PGM=IKJEFT1B
     //SYSEXECDD DISP=SHR,DSN=rexx.exec
     //SYSPRINT DD SYSOUT=*
     //SYSTSPRT DD SYSOUT=*
     //SYSTSINDD *
     %XMITIP userid@domain.com MSGDS 'message.data.set'-
     FILE 'report.data.set' -
     SUBJECT 'subject line' FROM reply-to-address

This example demonstrates a very simple usage of the
XMITIP application to send a message, contained in a
dataset, and an attachment file.  A Subject is specified
and a From address is defined.

ISPF Dialog
If the XMITIP command is executed without any options
while under ISPF then the ISPF Dialog will be invoked.
This dialog is a simple front-end to the XMITIP
application and can be used to `model' a planned batch
usage. The ISPF Panel is shown below. Note that field
level help is available on this panel if there are
questions about what to code for each parameter.

     ----------------------------  E-Mail Dialog   4.12 --
     --------------------------
     Command ===>
     Up F7 Dn F8

     Recipient Address ===> lionel.b.dyck@kp.org
     Message DSN       ===>
                            dsn or * to edit a message or
     null for no message
     Optional information
     Subject           ===> test for share
     CC Address        ===>
     BCC Address       ===>
     From Address      ===> lionel.b.dyck@kp.org
     Reply-To Address  ===>
     Receipt Address   ===>
     Signature DSN     ===>
     Attachment DSN    ===> ?
     or ?
     Attachment Name   ===>
     Attachment Desc   ===>
     Murphy            ===>               Yes or No
     Importance        ===>               High, Normal,
     Low
     Priority          ===>               Urgent, Non-
     Urgent, Normal
     Sensitivity       ===>               Private,
     Personal, Confidential, Company
     Format (?=prompt) ===>
     ZipMethod         ===>                 Compression
     method
     ZipPass           ===>
     Password
     Margins - in inches (e.g. 8.5 for 8 1/2 inches)
         Left ===>       Right ===>        Top ===>
     Bottom ===>

                      Field level help available via PF1

In the Recipient Address, CC Address and BCC Address the
use of a ? will bring up a list of previously used
addresses in which you may select To, CC, and BCC
addresses, as well as add and delete addresses. This is
shown in the next example:

     -------------------------XMITIP E-Mail Address List -
     ------- Row 1 to 5 of 5
     Command ===>Scroll ===> CSR

      Comands:Find and Insert
      or S Select B Blind Copy C Carbon Copy D Delete I
     Insert U Update \ Unselect

     Sel Action Recipients Name
                E-Mail Address

     _       Joe Doe
             joe.doe@domain.org
     _       Lionel at home
             lionel.b.dyck@domain.net
     _       Lionel B. Dyck
             lionel.b.dyck@kp.org
     _       Lionel B. Dyck
             lbdyck@pop3.domain.net
     _       Walter Doe
             wdoe@domain.net
     ******************************* Bottom of data
     ********************************

Notice that there are two lines for each address. The
first is a name or description and the second line is the
e-mail address.

If a ? is entered for the Attachment DSN the following
selection table will be displayed:

     ---------------------------  XMITIP File Attachment -
     --------- Row 2 to 2 of 2
     Command ===>
     Scroll ===> CSR

      Commands: Find Insert Cancel or Clear
      Line:     S Select  D Delete  I Insert  U unSelect
     or overtype to change

     Sel   Dsname
           Filename (that will appear in the e-mail)
           Format (of the file attachment - use ? for
     prompting)
           Description (of the file attachment - no
     blanks)
           Left   Right  Top   Bottom    (Margins in
     inches .5 =1/2 inch)
     _
     _____________________________________________________
     ________

     _____________________________________________________
     ________

     _____________________________________________________
     ________

     _____________________________________________________
     ________
           ___    ___    ___    ___
     ******************************* Bottom of data
     ********************************

This table will retain all files defined via this table
and only those files explicitly Selected will be sent as
attachments for the current session.

Once e-mail is sent with the ISPF Dialog the user is
presented with the following report:

     Generated Command:
     %xmitip lionel.b.dyck@kp.org +
             Nomsg +
             From lionel.b.dyck@kp.org +
             Subject 'test for share'  +
             File 'SYS1.PROCLIB(JES2)' +
             Filename jes2.txt +
             Filedesc jes2-proc +
             Format RTF/p/8/l/ +
             Margin (1/1/1/1)

     XMITIP: XMITIP Application level: 4.12
     XMITIP:
     XMITIP: Message Addressing Information:
     XMITIP: From:  lionel.b.dyck@kp.org
     XMITIP: To:    lionel.b.dyck@kp.org
     XMITIP:
     XMITIP: The Mail Envelope:
     XMITIP: Sender:   lionel.b.dyck@kp.org
     XMITIP: Date:     14 Jul 2000 13:25:45 -0700
     XMITIP: To:       lionel.b.dyck@kp.org
     XMITIP: Subject:  test for share
     XMITIP: File:     'SYS1.PROCLIB(JES2)'
     XMITIP: -records: 133 as Rich Text
     XMITIP: as attachment name: jes2.txt
     XMITIP:
     XMITIP: Message maximum lrecl is: 259
     XMITIP:
     XMITIP: Message successfully transmitted
     XMITIP: Sent 168 records as text, attachments, and
     control information.
     XMITIP: Approximate byte count is: 12,034

Note that the Generated Command presents the XMITIP
command that can be copied into a batch execution as shown
in the discussions below. The report is the same report
generated by the XMITIP application whether invoked via
the ISPF dialog or in batch.

Syntax (keywords are case insensitive):

%XMITIP user@address
     or (u1@address u2@address..)
     or *list-id*
     or *
        AddressFile
        AddressFileDD
        BCC user@address
     or BCC (u1@add1 u2@add2 ..)
        CC user@address
     or CC (u1@add1 u2@add2 ..)
        FILE dsn
     or FILE (dsn1 dsn2 ...)
        FILEDD ddn1
     or FILEDD (ddn1 ddn2 ...)
        FILEDESC file-description
     or FILEDESC (desc1 desc2 ...)
        FILENAME filename
     or FILENAME (file1 file2 ..)
        FORMAT options (see the doc)
        FROM from@address
        HTML (for MSGDx only)
        IMPORTANCE High Normal or Low
        MSGDS data-set-name
        MARGIN Lm/Rm/Tm/Bm
     or MARGIN (Lm/Rm/Tm/Bm Lm/Rm/Tm/Bm ...)
     or MSGDS *
     or MSGDD ddname or MSGQ
     or NOMSG (if no MSGDS, MSGDD or MSGQ)
        Murphy
        NOConfirm
        PRIORITY Urgent Normal or Non-Urgent
        RECEIPT receipt@address
        REPLYTO reply@address
        SENSITIVITY Private Personal or Confidential
        SIG dsname or SIGDD ddname
        SUBJECT 'subject text'
        ZIPMETHOD zip-compression-method
        ZIPPASS password for zip files


Notes on the example and syntax explanation:

PGM=IKJEFT1B                      This program is used instead of
                                  IKJEFT01 because it will pass a
                                  return code if it is non-zero.
Rexx.exec                         The dataset that contains the
                                  XMITIP REXX Program
                                  NCal: SYS2.REXX.EXECSCal:
                                  SYS1.USER.REXX
                                  Hawaii: OPS.USER.REXX
Userid@domain.com                 This is the electronic mail
                                  address to receive the e-mail.
Or
(u1@domain.com u2@domain.com .)   Two formats are allowed.
                                  Without parenthesis a single e-
Or                                mail address may be
First Last                        specified.If more than one
<first.last@domain.com>           address is desired then enclose
                                  the addresses within
Or                                parenthesis with a space
"First Last"                      separating each address.
<first.last@domain.com>
                                  Or the address may be in the
Or                                format:
("first last" <first.last@addr>
"first last2" <first.last2@addr>) First Last <first.last@address>
                                  or
                                  "First Last"
*list-id                          <first.last@address>

Or                                (Note that this form of
*                                 addressing is not displayed
or                                (honored) by all e-mail
                                  clients.Lotus Notes does not
                                  honor the "First Last" when
                                  displaying the note.

                                  *list-id is any name, with a
                                  preceding asterisk, that you
'list id'                         want used in the TO: field of
                                  the mail envelope. Typically
                                  used with BCC so that all the
                                  recipients don't see the long
                                  (or short) list of who else is
                                  receiving the e-mail.

                                  If using and AddressFile or
                                  AddressFileDD then an address
                                  of * here is allowed as it will
                                  be replaced by the addresses in
                                  the file.

                                  Anything that is not a valid
                                  address in quotes will be used
                                  for the To address or list id
                                  but not for the SMTP address.
AddressFile dsname                This keyword defines a DSName
                                  that contains a list of
                                  keywords and addresses..

                                  This sequential file has the
                                  following syntax:

                                       To address
                                       CC address
                                       BCC address
                                       * comment

                                  Note that the address may be in
                                  the format defined in the TO
                                  keyword.

                                  Only one address per line is
                                  supported. The process is case
                                  insensitive. If a *list-id is
                                  used and any TO statements are
                                  found, any address defined will
                                  be converted to a CC. If an *
                                  is used in the address then any
                                  TO statements will be used to
                                  replace that * in the address.
AddressFileDD ddname              This keyword defines a DDName
                                  that contains a list of
                                  keywords and addresses..

                                  See AddressFile for information
                                  on the layout of this file.
BCC user@domain.com               This is the electronic `blind-
Or                                carbon
BCC (u1@domain.com u2@domain.com
.)                                Two formats are allowed.
Or                                Without parenthesis a single e-
BCC First Last                    mail address may be specified.
<first.last@address>              If more than one address is
Or                                desired enclose the addresses
BCC "First Last"                  within parenthesis with a space
<first.last@address>              separating each address.
or
BCC ("first last"                 Typically used with an address
<first.last@addr> "first last2"   of *list-id* format.
<first.last2@addr>)
CC user@domain.com                This is the electronic `carbon
Or
CC (u1@domain.com u2@domain.com   Two formats are allowed.
.)                                Without parenthesis a single e-
Or                                mail address may be specified.
CC First Last                     If more than one address is
<first.last@address>              desired enclose the addresses
Or                                within parenthesis with a space
CC "First Last"                   separating each address.
<first.last@address>
or
CC ("first last"
<first.last@addr> "first last2"
<first.last2@addr>)
DEBUG                             Will cause the message to be
                                  written to SYSTSPRT or the
                                  screen for review instead of to
                                  the spool for delivery.

                                  Note that this can also be
                                  activated from the ISPF dialog
                                  or via the XMITIP directly
                                  using a MSGDS where the
                                  parameter begins with *@ (e.g.
                                  msgds *@*).
FILE dataset-name                 Defines the dataset or datasets
                                  that you want to e-mail as
Or                                attachments. The dataset(s)
                                  will be e-mailed as text and
FILE (dataset-name1 dataset-name2 will be translated from EBCDIC
.)                                to ASCII so verify that the
                                  report will translate usably
                                  before making this production.
                                  Be conscious of the size as
                                  well as the larger the dataset
                                  the more time it takes to e-
                                  mail and the more space it
                                  takes in the user's inbasket.

                                  Note that the dataset-name
                                  should be fully qualified with
                                  single quotes. Without the use
                                  of quotes the dataset-name will
                                  have the userid under which the
                                  batch job was submitted
                                  appended as the high level
                                  qualifier.

                                  A dsname of *create* may be
                                  used when under ISPF to create
                                  and edit a new dataset.
                                  Helpful with html or rtf option
                                  to dynamically create a
                                  attachment.
FILEDD ddn1                       Defines a pre-allocated DD
                                  statement that references
Or                                sequential data. This dataset
                                  may be temporary, a member of a
FILEDD (ddn1 ddn2 ..)             PDS, a GDG, or a concatenation
                                  of multiple sequential
                                  datasets. If more than one
                                  ddname is specified then the
                                  ddnames must be coded within
                                  parenthesis.
FILEDESC file-description         A short file description
or                                specified with no spaces and
FILEDESC file-name/file-          not in quotes.
description
or                                e.g.
FILEDESC (file-desc1 file-desc2
..)                               FILEDESC process-document

                                  where x (or X) may be used as a
                                  placeholder if there is no
                                  description for a particular
                                  file)
FILENAME filename                 Defines the name to be used for
or                                the attachment file name for
FILENAME (filename1 filename2     the associated FILE or FILEDD.
...)
                                  FILENAME report.txt
                                  or
                                  FILENAME (report.txt daily.rtf)
FORMAT                            Defines the File attachment
                                  properties.
FORMAT xxx
                                  xxx = any file type (e.g. XLS,
                                  TXT) and will result in a plain
FORMAT BIN/suffix                 text file attachment

                                  BIN is a binary file
                                  attachment.

FORMAT HTML/color/suffix          suffix will be used as the file
                                  attachment suffix (e.g. .bin,
                                  .xmt, ...)

                                  HTML will cause the text file
                                  to be converted to HTML format
                                  (very basic) and attached as an
                                  HTML file attachment.

                                  color is either text color or
                                  background-text color. Default
                                  is black text on white
                                  background.

                                  Color      Abbrev   Color
                                  Abbrev
                                  Aqua       A        Navy      N
                                  Black      Bla      Olive     O
                                  Blue       Blu      Purple    P
FORMAT PDF/layout/font/paper/lpi  Fuchsia    F        Red       R
                                  Gray       Gra      Silver    S
                                  Green      Gre      Teal      T
                                  Lime       L        White     W
                                  Maroon     M        Yellow    Y

                                  suffix will be used as the file
                                  attachment suffix (e.g. .htm,
                                  .html ...) - default is .html

                                  PDF will cause the text file to
                                  be converted to Portable
                                  Document Format (PDF) which can
                                  be read by the Adobe Acrobat
                                  reader.
FORMAT
RTF/layout/font/paper/suffix      layout defines the page
                                  orientation and is either
                                  Portrait or Landscape

                                  font is the font size to use.
                                  The font is Courier New and the
                                  default font size is 9 (where
                                  72 = 1 inch)

                                  paper defines the paper size:
                                  LETTER, LEGAL, A4, or
                                  heightXwidth (e.g. 8.5X11)

                                  lpi defines the lines per inch
                                  for the PDF attachment

FORMAT ZIP/name-in-archive        RTF will cause the text file to
                                  be converted to Rich Text
                                  Format (RTF) which means that
                                  the file will be opened in
                                  Microsoft Word or other word
                                  processor.

                                  layout defines the page
                                  orientation and is either
FORMAT ZIPBIN/name-in-archive     Portrait or Landscape

                                  font is the font size to use.
                                  The font is Courier New and the
                                  default font size is 9 (where
                                  72 = 1 inch)

FORMAT ZIPHTML/name-in-           paper defines the paper size:
archive/color                     LETTER, LEGAL, A4, or
                                  heightXwidth (e.g. 8.5X11)

                                  suffix will be used as the file
                                  attachment suffix (e.g. .rtf,
FORMAT ZIPPDF/name-in-            .doc ...) - default is .rtf
archive/layout/font/paper/lpi
                                  ZIP will cause the text file to
                                  be compressed using a ZIP
                                  utility (assuming one is
                                  available on the system) and
                                  then attached as a binary file
FORMAT ZIPRTF/name-in-            attachment.
archive/layout/font/paper
                                  name-in-archive defines the
                                  name that will be used in the
                                  zip file for the input file.
                                  If the input file is
                                  hlq.test.data(member) the name-
                                  in-archive could be
                                  member.text.

                                  ZIPBIN will just ZIP the
                                  specified file using the binary
                                  keyword.  This means that the
                                  input file will not have any
                                  EBCDIC to ASCII conversion
                                  performed prior to the ZIP.

                                  name-in-archive - see above.

                                  ZIPHTML will convert the input
                                  text file to HTML format (see
                                  above for information on this
                                  and the color keyword) and then
                                  zip the converted file which
                                  will then be attached as a
                                  binary file attachment.

                                  ZIPPDF will convert the input
                                  text file to PDF format and
                                  then zip the converted file,
                                  which will then be attached as
                                  a binary file attachment. See
                                  above for information on the
                                  name-in-archive and on layout,
                                  font and lpi specifications

                                  ZIPRTF will convert the input
                                  text file to RTF and then zip
                                  the converted file, which will
                                  then be attached as a binary
                                  file attachment. See above for
                                  information on the name-in-
                                  archive and on layout, font and
                                  paper specifications.
FROM reply-to-address             Defines an e-mail address that
Or                                the recipient can use with the
FROM first last <first.last@addr> reply function of their e-mail
Or                                package to send questions,
FROM "first last"                 comments, or ?
<first.last@addr>
                                  If this keyword is not used
                                  then the reply address will be
                                  the userid on the NJE node
                                  where the application is
                                  executed at the host name where
                                  the SMTP server executes.

                                  e.g. user%njenode@host-
                                  name.domain
MARGIN left/right/top/bottom      Defines the margins for the
                                  FORMAT attachments in Inches
                                  (e.g. 8.5 for 8 + inches).
MSGDS data-set-name               This keyword defines a
                                  sequential dataset (or member
Or                                of a partitioned dataset) which
                                  contains the text of a message
MSGDS *                           to be e-mailed.

                                  If * is coded then (1) you must
                                  be under ISPF and then (2) the
                                  ISPF Editor will be invoked to
                                  create a note.
MSGDD ddname                      This keyword defines the
                                  DDname, which references a
                                  sequential dataset (or member
                                  of a partitioned dataset),
                                  which contains the text of a
                                  message to be e-mailed.
MSG72                             Use only the first 72
                                  characters per record in the
                                  message.  This option can be
                                  used to ignore sequence numbers
                                  in the message for batch jobs.
NOMSG                             Indicates that no message text
                                  is to be e-mailed. Use this
                                  when you are sending just a
                                  file attachment(s) and have no
                                  explanatory text.
NOCONFIRM                         Indicates that you do not want
                                  the REXX program to generate
                                  few lines of confirmation text
                                  that it has generated the
                                  requested e-mail.
RECEIPTaddress                    Defines the e-mail address to
Or                                be used to send a receipt when
RECEIPT first last                the mail is received by the
<first.last@addr>                 user. This option does not work
Or                                with all e-mail clients.
RECEIPT "first last"
<first.last@addr>
REPLYTO address                   Defines the e-mail address to
Or                                be used when the user does a
REPLYTO first last                reply. This may be different
<first.last@addr>                 than the address defined in the
Or                                FROM keyword.
REPLYTO "first last"
<first.last@addr>
SIG dsname                        The dsname contains a signature
                                  block that will be used and
                                  appended to any Message text.
SUBJECT `subject text'            Enclosed within single (') or
                                  double (") quotes is your
                                  subject.  If using single (')
                                  quotes then you can include
                                  double (") quotes within your
                                  subject and vice versa.

                                  The subject can contain 3
                                  special keywords:

                                  &DATE or &DATE-n
                                  &DAY or &DAY-n
                                  &TIME

                                  Note that these keywords can be
                                  repeated:

                                  e.g. Subject "Reports for &date-
                                  7 to &date"
ZIPMETHOD method                  Defines the ZIP compression
                                  method to be used. Currently
                                  only PKZIP is supported for
                                  this option and the supported
                                  options are:

                                       Normal
                                       Fast
                                       Maximum
                                       Store
                                       Superfast
ZIPPASS password                  Specifies a password (case
                                  sensitive) that will be used by
                                  the ZIP utility to encrypt the.
                                  Currently only PKZIP is
                                  supported for this option.  The
                                  password may be up to 64
                                  characters

The minimum required syntax is:

          XMITIP user@domain.com MSGDS
          dataset.name

Or
          XMITIP user@domain.com NOMSG FILE
          dataset.name

The sample JCL is an execution of the TSO Batch Terminal
Monitor Program (or TMP). The dash (-) is used to indicate
a continuation follows when a command cannot fit on a
single card image.

Dataset coding conventions are the same as for any TSO
Batch TMP invocation. The dataset must be fully qualified
within single quotation marks otherwise the userid under
which the job is submitted will be appended as the high
level qualifier. Members of partitioned datasets may be
distributed as well by coding the member name within
parenthesis as is the common JCL coding standard.

Examples:

Example 1.Sending a member of a partitioned dataset with
no message text and a short subject to 2 users.

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP (user1@domain.com user2@domain.com) nomsg file
`hlq.data.set(member)' -
     subject `send a file but no message'

Example 2.Sending a message but no file to 1 user.

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP user@domain.com msgds my.message.text subject
`urgent message'

Example 3.Sending example 2 with 2 CCs with a From of my
Lotus Notes e-mail so questions about what I'm sending can
be sent there.

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP user@domain.com msgds my.message.text subject
`urgent message' -
     cc (user2@domain.com user3@domain.com) from
mynotes@domain.com

Example 4.Sending a member of a partitioned dataset to a
single address.

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP user@domain.com nomsg file `hlq.data.set(member)'
-
subject `pds member'

Example 5.Sending a dataset in Landscape with a 9 point
font.

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//REPORT DD DISP=(OLD,DELETE),DSN=&&RPT
//SYSTSIN DD *
%XMITIP user@domain.com nomsg filedd reportdd subject
`passed report' -
format rtf/land/9
/*


Example 6.Sending a passed dataset to a list using blind
copies.

//REPORT EXEC PGM=DOREPORT
//SYSPRINT DD SYSOUT=*
//INPUT DD DISP=SHR,DSN=data.base
//OUTPUT DD DISP=(,PASS),UNIT=SYSDA,DSN=&&RPT
/*
//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//REPORT DD DISP=(OLD,DELETE),DSN=&&RPT
//SYSTSIN DD *
%XMITIP *report-list bcc user@domain.com nomsg filedd
reportdd -
subject `report distribution'
/*

Example 7. Sending a dataset as a file attachment and
using a AddressFile dataset:

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP user@domain.com nomsg file `hlq.data.set(member)'
subject `pds member' -
Addressfile `hlq.data.set(address)'

Where `hlq.data.set(address)' contains the following:

     To user1@domain.com
     CC user2@domain.org
     Cc user3@domain.ca
     Bcc user4@domain.uk

Example 8. Sending a SPOOL file as a text attachment:

What this example does is:

     z    create SYSUT2 in SPOOL for printing
     z    batch SDSF
       z    set PREfix to jobname
       z    blank out OWNER
       z    invoke Status command
       z    do a Find for the DD we want (SYSUT2)
       z    Print to File (DD) LOGFILE
     z    then run the batch TMP to execute XMITIP

//SDSFTEST JOB acct,'Batch Job',CLASS=L,NOTIFY=&SYSUID,
// MSGLEVEL=(1,1),MSGCLASS=X
//GENER EXEC PGM=IEBGENER
//SYSPRINT DD SYSOUT=*
//SYSUT1 DD DISP=SHR,DSN=SYS1.PARMLIB(IEASYS00)
//SYSUT2 DD SYSOUT=*
//SYSIN DD DUMMY
//****
//SDSFBTCH EXEC PGM=SDSF
//ISFOUT DD SYSOUT=*
//LOGFILE DD
DISP=(,CATLG),UNIT=SYSTSO,DSN=SYSLBD.LOGFILE.LIST,
// SPACE=(TRK,(30,30),RLSE)
//ISFIN DD *
PRE SDSFTEST
OWNER
ST
FIND SDSFTEST
++?
FIND SYSUT2
++S
PRINT FILE LOGFILE
PRINT
PRINT CLOSE
//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%XMITIP user.name@domain.com NOMSG FILE LOGFILE.LIST -
   SUBJECT 'TEST WITH IEASYS00'
DELETE LOGFILE.LIST

Example 9. Sending a text file in RTF format using ZIP to
save space

//TSOB EXEC PGM=IKJEFT1B
//SYSEXEC DD DISP=SHR,DSN=rexx.exec
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSTSIN DD *
%xmitip user.name@domain.com nomsg file
'hlq.weekly.report' -
  subject 'weekly report' format
ziprtf/weekly.rtf/port/9/let


Part II:  Reading the Attachment on the Workstation:

When reading the attachment in Lotus Notes the user can
either (1) launch the attachment which will open the
attachment in Microsoft Notepad or (2) use the Lotus Notes
View option. The default font in both cases will probably
be a proportional font which will not present the report
in a usable manner. To view the report properly the user
will need to change the default font. When using Microsoft
Exchange when clicking on the attachment you will be asked
to open or save it. When you select Open the attachment is
opened in Microsoft Notepad.

In Microsoft NOTEPAD to change the default font:

     Select EDIT
     Select Set Font
     Select Courier or Courier New
     Select a reasonable font size (e.g. 10)

In Lotus Notes View to change the default font:

     Click on Document on the tool bar
     Click on Options
     Click on Display
     Click on Font
     Set the font to Courier New and size 9 (these work
for me)

     ** Note that this technique does not work with the
Notes R5.0 client.

Part III  Installing and Customizing XMITIP

Receiving the code
To get a copy of this application download from
http://www.share.org/mvs.html to your workstation.  Then:

1.   Unzip the file
2.   Read the readme
3.   Upload the XMITIP.XMIT file to your OS/390 system.
  The file transfer must be a binary transfer and the upload
  dataset must be RECFM=FB and LRECL=80.
4.   Issue the TSO command: RECEIVE INDS(upload.dsn) to
  create a partitioned dataset
5.   Issue the TSO command: EX upload.dsn(RECEIVE) EX to
  expand the members to create a ISPF Panel library and a
  REXX EXEC library.
6.   Review the REXX EXEC XMITIPCU for local defaults and
  customizations.  This is IMPORTANT.

Customizing XMITIPCU
This is an important step before using.  There are a
number of defaults defined in this application that should
be reviewed.  The comments in the code should be adequate
to understand the default specifications.


Part IV   Coding Your Own Application

There may be situations where you want to code into your
application specific distribution information and not use
this XMITIP application. You might want to do this for
customized or individualized report distribution. To do so
you will need to code the Simple Mail Transport Protocol
(SMTP) control statements. The basic format of the SMTP
mail file is shown in this example with each statement
explained below. If you are really ambitious you can
review the standards for e-mail at
http://www.oac.uci.edu/indiv/ehood/MIME/MIME.html. You
will also need to have a DD statement or a dynamic
allocation that directs the SMTP control statements with
your data to the local SMTP server.

Note: if you want to be creative use the XMITIP
application to generate and test what you want to do and
then use that output as an example of what to generate.

The DD statement requires an OUTPUT JCL statement and they
would look like this:

//SMTPOUTPUT DEST=NKAISERA.SMTP
//. EXEC ..
//smtpmail DD SYSOUT=A,OUTPUT=*.SMTP,
// DCB=(RECFM=xx,LRECL=nnnn,BLKSIZE=nnnnn)

A dynamic allocation will need to route the output to the
destination defined in the OUTPUT JCL statement. The DEST
defines the NJE Node where the OS/390 TCP/IP SMTP server
is running and the name of the server started task. In
this case the NJE Node is NKAISERA and the server started
task name is SMTP.

The use of SYSOUT Class A is to allow data with logical
records larger than a card image (80 bytes).A record
format (RECFM) of FB or VB (recommended)with a logical
record length (LRECL) at least as large as the largest
expected record. You can use up to 1024 (which is the IBM
limit) for the LRECL and then a block size (BLKSIZE) that
matches the LRECL.I would recommend RECFM=VB, LRECL=255,
BLKSIZE=2554 (remember that variable records require an
extra 4 bytes in the BLKSIZE for the block descriptor
word).

The destination of NKAISERA.SMTP is used for all of Kaiser
at this point.

Helo domain.name
Mail from:<your.id@domain.name>
Rcpt to:<user1.id@domain.name>
Rcpt to:<user2.id@domain.name>
data
x-mailer: description of generating application
Date:     dd mmm yyyy hh:mm:ss zone
From:     from address or name
To:  to address or name
Cc:  carbon copy address or name
Subject:  subject for e-mail
Mime-Version 1.0
Content-type: multipart/mixed;
Boundary= "Mime.Part.random.characters"
--Mime.Part.random.characters
Content-Type: text/plain

Text of a message that will be sent as e-mail
--Mime.Part.random.characters
Content-Type: text/plain;
     Name= "data.set.name.txt"
Content-Transfer-Encoding: 7bit

Data to be sent as a file attachment......
More data
--Mime.Part.random.characters--


1.   Start with the helo statement
  helo domain.name
  use your proper host domain name
2.   Then define your return e-mail address:
  mail from:<your.id@domain.name>
  This is the address that the recipient will see in the
  from field in their mailer when they receive your e-mail.
  If this address is invalid they will not be able to reply
  to you to ask questions or to comment about what you are
  sending.
3.   Then define the addresses to receive the mail:
  rcpt to:<user.id@domain.name>
  rcpt to:<user2.id@domain.name>
  This may be repeated for each e-mail address, with one
  address per record, as many times as required.
4.   Next insert the data statement
  data
  Code this statement as is. It is part of the smtp header
  standard.
5.   x-mailer: description of generating application
  This statement is optional and if used can define the
  application that is being used to generate the e-mail.
6.   Date: dd mmm yyyy hh:mm:ss zone
  This statement is also optional and somewhat free form. It
  defines the date, time, and time zone from which the e-
  mail is being sent.
7.   From: address or name
  This statement will be displayed in the e-mail `envelope'
  to identify the sender of this e-mail
8.   To: address or name
  This statement is optional and identifies who you are
  sending the e-mail to. It could be something like "report
  recipients" or an actual address.
9.   Cc: address or name
  This statement is optional and just like the To statement
  identifies who you are sending this e-mail.
10.  Subject: text
  This statement defines the subject of the e-mail that will
  appear in the recipients e-mail system to identify the
  subject of this e-mail
11.  Mime-Version 1.0
  Code this statement as is - it is part of the Mime
  standard.
12.  Content-type: multipart/mixed
  Code this statement as is - it is part of the Mime
  standard.
13.  Boundary="Mime.Part.random.characters"
  The text defined by this statement is a unique character
  string that is used by the e-mail packages to parse the
  e-mail data. Pick any set of random characters that you
  know will not be repeated within the data.
14.  --Mime.Part.random.characters
  This is your boundary without the quotes and proceeded by
  two dashes --.
15.  Content-Type: text/plain
  Code this statement as is - it is part of the Mime
  standard and identifies the text that follows as plain
  (e.g. not HTML or some other format).
16.  Insert a blank line here. It seems to be required for
  some mailers.
17.  Insert any text that you want delivered as the text
  of this e-mail. This text is NOT included in the
  attachment that will be defined later but is the normal
  text of the e-mail.
18.  --Mime.Part.random.characters
  This is your boundary without the quotes and proceeded by
  two dashes --.
19.  Content-Type: text/plain
  Code this statement as is - it is part of the Mime
  standard and identifies the text that follows as plain
  (e.g. not HTML or some other format).
20.  Name="data.set.name.txt"
  This statement defines the name of the attachment dataset
  with the last qualifier (.txt) defining the type of data
  in the attachment. By using `.txt' this attachment will be
  opened in a text based reader. If you use `.doc' Microsoft
  Word would open the attachment if you have installed Word
  on your workstation.
21.  Content-Transfer-Encoding: 7bit
  Code this statement as is - it is part of the Mime
  standard and defines the character encoding that will be
  used when sending the data to the recipient.
22.  Insert a blank line here. It seems to be required for
  some mailers.
23.  Insert the text that you want transmitted as the file
  attachment. It may be up to logical record length of 1024
  (perhaps larger but that is what I've tested).
24.  --Mime.Part.random.characters--
  This is your boundary without the quotes and proceeded by
  two dashes - and ended with two dashes. This is the last
  boundary and ends the e-mail.
25.  Close the file or insert a null record.

Repeat 18-24 for multiple file attachments with 23 being
used as the last control statement.

Here is a complete example including a short note and a
small file attachment:

helo NKAISERA
mail from:<lbdyck@pop3.kaiperm.org>
rcpt to:<lionel.b.dyck@kp.org>
data
X-Mailer:XMITIP 1.61Rexx Exec on MVS
Date: 08 Feb 99 14:57:45 PST
From: lbdyck@pop3.kaiperm.org
To: lionel.b.dyck@kp.org
Subject:Test Message
Mime-Version: 1.0
Content-type: multipart/mixed;
boundary="Mime.Part.XMITIP.24jul65lrhg.0x0zax1d"
--Mime.Part.XMITIP.24jul65lrhg.0x0zax1d
Content-Type: text/plain

Test message.
--Mime.Part.XMITIP.24jul65lrhg.0x0zax1d
Content-Type: text/plain;
name="test.output.txt"
Content-Transfer-Encoding: 7bit

//SYSLBD JOB666001,'LIONEL
DYCK',CLASS=L,NOTIFY=&SYSUID,00010000
// MSGLEVEL=(1,1),MSGCLASS=X00020000
/*ROUTE PRINT FETCH 00030000
--Mime.Part.XMITIP.24jul65lrhg.0x0zax1d--

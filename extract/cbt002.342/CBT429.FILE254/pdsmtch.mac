/* REXX EXEC to compare/match PDS directory member names     */
parse upper arg dsname1 dsname2 . ;
if dsname2 = "" then exit 16; /* Missing input */
if substr(dsname1,1,1)^="'" then ,
      dsname1 = "'"dsname1"'";
if substr(dsname2,1,1)^="'" then ,
      dsname2 = "'"dsname2"'";
dummy = listdsi(dsname1 "directory");
if sysreason=5 then do;say "Invalid dsname: "dsname1;exit 16;end;
mem1dir = sysmembers;
dummy = listdsi(dsname2 "directory");
if sysreason=5 then do;say "Invalid dsname: "dsname2;exit 16;end;
mem2dir = sysmembers;
dummy = outtrap("dsn1list.");
"LISTDS" dsname1 "MEMBERS";
dummy = outtrap("OFF");
dummy = outtrap("dsn2list.");
"LISTDS" dsname2 "MEMBERS";
dummy = outtrap("OFF");
in1not2 = "";
in2not1 = "";
mem1 = 0;
mem2 = 0;
do i = 1 to dsn1list.0;
  if dsn1list.i="--MEMBERS--" then do;
       dsn1ptr = i+1; /* first member name */
       leave i;
       end;
end;
do i = 1 to dsn2list.0;
  if dsn2list.i="--MEMBERS--" then do;
       dsn2ptr = i+1; /* first member name */
       leave i;
       end;
end;
do loop=1 to 99999; /* forever loop */
    dsn1list.dsn1ptr = word(dsn1list.dsn1ptr,1);
    dsn2list.dsn2ptr = word(dsn2list.dsn2ptr,1);
    if dsn1list.dsn1ptr = dsn2list.dsn2ptr then do;
           mem1 = mem1+1; mem2 = mem2+1;
           dsn1ptr = dsn1ptr+1;
           dsn2ptr = dsn2ptr+1;
           end;
    else if dsn1list.dsn1ptr > dsn2list.dsn2ptr then do;
           mem2 = mem2+1;
           in2not1 = in2not1 dsn2list.dsn2ptr;
           dsn2ptr = dsn2ptr+1;
           end;
    else if dsn1list.dsn1ptr < dsn2list.dsn2ptr then do;
           mem1 = mem1+1;
           in1not2 = in1not2 dsn1list.dsn1ptr;
           dsn1ptr = dsn1ptr+1;
           end;
    if dsn1ptr>dsn1list.0 & dsn2ptr>dsn2list.0 then leave loop;
    if dsn1ptr>dsn1list.0 then do;
           do i = dsn2ptr to dsn2list.0;
           dsn2list.i = word(dsn2list.i,1);
           mem2 = mem2+1;
           in2not1 = in2not1 dsn2list.i;
           end;
           leave loop;
           end;
    if dsn2ptr>dsn2list.0 then do;
           do i = dsn1ptr to dsn1list.0;
           dsn1list.i = word(dsn1list.i,1);
           mem1 = mem1+1;
           in1not2 = in1not2 dsn1list.i;
           end;
           leave loop;
           end;
end;
"VMFCLEAR";
alias1 = mem1dir-mem1;
alias2 = mem2dir-mem2;
say "DSNAME: "dsname1";   member count: "mem1"; alias(es): "alias1;
say "DSNAME: "dsname2";   member count: "mem2"; alias(es): "alias2;
if in1not2^="" then do;
      say "Members in "dsname1" and NOT in "dsname2;
      ctr = words(in1not2);
      do i = 1 to ctr;
         say "   "word(in1not2,i);
      end;
end;
if in2not1^="" then do;
      say "Members in "dsname2" and NOT in "dsname1;
      ctr = words(in2not1);
      do i = 1 to ctr;
         say "   "word(in2not1,i);
      end;
end;
exit 0;

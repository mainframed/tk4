         MACRO
&LABEL   OACVTOC &TYPE,&DSECT=YES,&PREFIX=
.**********************************************************************
.* THIS MACRO GENERATES ALL DATA STRUCTURES REQUIRED TO COMMUNICATE   *
.* WITH THE VTOC PROGRAM. THE DATA STRUCTURE TO BE DEFINED IS         *
.* SPECIFIED VIA THE '&TYPE' PARAMETER. THE FOLLOWING TYPES EXIST:    *
.*      CALL - GENERATE VTOC PARM DATA AND CALL THE PROGRAM           *
.*     DSECT - GENERATE DSECTS WITH DEFAULT LABELS/PREFIXES           *
.*      PARM - GENERATE PARMS DSECT OR DATA                           *
.*      EXIT - GENERATE EXIT DSECT OR DATA                            *
.*      TEST - PERFORM FLAG TESTS (ALLOWS FLAG OFFSET CHANGES)        *
.* IF THE TYPE PARAMETER IS NOT CODED, IT DEFAULTS TO 'DSECTS'.       *
.**********************************************************************
         LCLB  &DEF               FLAG TO INDICATE DEFAULT DSECT DATA
         LCLC  &P,&LAB            LOCAL PREFIX,LOCAL LABEL
         AIF   (T'&TYPE EQ 'O').C#DSE BIF NO TYPE - DO DEFAULT
         AIF   ('&TYPE' EQ 'CALL').C#CAL BIF TYPE=CALL
         AIF   ('&TYPE' EQ 'DSECT').C#DSE BIF TYPE=DSECT
         AIF   ('&TYPE' EQ 'EXIT').C#EXI BIF TYPE=EXIT
         AIF   ('&TYPE' EQ 'PARM').C#PAR BIF TYPE=PARM
         MNOTE 8,'INVALID GEN TYPE ''&TYPE'' - PROCESSING TERMINATED'
         MEXIT
.C#DSE   ANOP                     GENERATE DSECTS HERE
&DEF     SETB  1                  FLAG DSECT DEFAULT USAGE
.C#PAR   SPACE 2                  GENERATE PARMS DATA HERE
&P       SETC  'VTP'              SET DEFAULT PREFIX
&LAB     SETC  'VTPARMS'          SET DEFAULT LABEL
         AIF   (&DEF).PA#DS       BIF DSECT GENERATION
         AIF   (T'&LABEL EQ 'O').PA#PRE BIF NO LABEL PASSED
&LAB     SETC  '&LABEL'           ELSE USE USER ENTRY
.PA#PRE  AIF   (T'&PREFIX EQ 'O').PA#CKD BIF NO PREFIX PASSED
&P       SETC  '&PREFIX'(1,3)     SET MAX PREFIX SIZE
         AIF   (K'&PREFIX LE 3).PA#CKD BIF LENGTH OK
         MNOTE 8,'PREFIX &PREFIX TRUNCATED TO &P'
.PA#CKD  AIF   ('&DSECT' EQ 'YES').PA#DS BIF DSECT REQUESTED
&LAB     DC    0F'0'              DEFINE VTOC PARM MAPPING
         AGO   .PA#GEN            BIF TO GEN DATA
.PA#DS   ANOP
&LAB     DSECT ,                  DEFINE VTOC PARM MAPPING
.PA#GEN  ANOP
&P.#FLAG DC    0F'0'              CONTROL FLAGS
&P.#FG1  DC    X'00'              CONTROL FLAG 1
&P.#F1SB EQU   X'80'              THIS IS A SUBROUTINE CALL (ALWAYS ON)
&P.#F1PR EQU   X'40'              PROVIDE A SYSPRINT PRINT ROUTINE
&P.#F1AL EQU   X'20'              RETURN ALL DSCBS IN VTOC ORDER
&P.#F1LD EQU   X'10'              RETURN LOGICAL DATASETS
&P.#FG2  DC    X'00'              CONTROL FLAG 2
&P.#FG3  DC    X'00'              CONTROL FLAG 3
&P.#FG4  DC    X'00'              CONTROL FLAG 4
&P.#WORK DC    A(0)               WORK STORAGE AREA OR ZERO
&P.#CSIZ DC    F'0'               STORAGE USAGE LIMIT OR ZERO
&P.#USER DC    A(0)               USER DATA TO BE PASSED TO EXIT
&P.#EXIT DC    A(0)               ADDR OF USER EXIT
&P.#USIZ DC    F'0'               SIZE OF WORKAREA TO PASS EXIT OR ZERO
&P.#VOL  DC    CL6' '             VOLUME TO SEARCH
         AIF   (&DEF).C#EXI       BIF DSECT GENERATION
         MEXIT
.C#EXI   SPACE 2                  GENERATE EXIT DATA HERE
&P       SETC  'VTX'              SET DEFAULT PREFIX
&LAB     SETC  'VTEXIT'           SET DEFAULT LABEL
         AIF   (&DEF).EX#DS       BIF DSECT GENERATION
         AIF   (T'&LABEL EQ 'O').EX#PRE BIF NO LABEL PASSED
&LAB     SETC  '&LABEL'           ELSE USE USER ENTRY
.EX#PRE  AIF   (T'&PREFIX EQ 'O').EX#CKD BIF NO PREFIX PASSED
&P       SETC  '&PREFIX'(1,3)     SET MAX PREFIX SIZE
         AIF   (K'&PREFIX LE 3).EX#CKD BIF LENGTH OK
         MNOTE 8,'PREFIX &PREFIX TRUNCATED TO &P'
.EX#CKD  AIF   ('&DSECT' EQ 'YES').EX#DS BIF DSECT REQUESTED
&LAB     DC    0F'0'              DEFINE VTOC EXIT PARM MAPPING
         AGO   .EX#GEN            BIF TO GEN DATA
.EX#DS   ANOP
&LAB     DSECT ,                  DEFINE VTOC EXIT PARM MAPPING
.EX#GEN  ANOP
&P.#FLAG DC    0F'0'              CONTROL FLAGS
&P.#FG1  DC    X'00'              CONTROL FLAG 1
&P.#F1CB EQU   X'80'              ALL EXTENTS ON CYLINDER BOUNDARY
&P.#F1LD EQU   X'40'              LOGICAL DATASET RETURNED
&P.#FG2  DC    X'00'              CONTROL FLAG 2
&P.#FG3  DC    X'00'              CONTROL FLAG 3
&P.#FG4  DC    X'00'              CONTROL FLAG 4
&P.#DS1  DC    A(0)               ADDR - RETURNED DSCB OR LOGICAL FMT1
&P.#DS2  DC    A(0)               ADDR - ZERO OR LOGICAL FMT2
&P.#DS3  DC    A(0)               ADDR - ZERO OR LOGICAL FMT3
&P.#USER DC    A(0)               USER DATA PASSED FROM VTOC CALLER
&P.#EXIT DC    A(0)               ADDR OF USER EXIT
&P.#TRKS DC    F'0'               TOTAL ALLOCATED TRACKS
&P.#UCB  DC    A(0)               UCB ADDRESS - CURRENT VOLUME
&P.#TCYL DC    H'0'               TRACKS/CYL - CURRENT VOLUME
&P.#CHR  DC    XL5'0'             CCHHR OF DSCB RETURNED
&P.#VOL  DC    CL6' '             CURRENT VOLUME BEING SEARCHED
&P.#CDEV DC    CL8' '             CHARACTER DEVICE TYPE - CURRENT VOL
         MEXIT
.C#CAL   ANOP                     GENERATE CALL HERE
         MEND

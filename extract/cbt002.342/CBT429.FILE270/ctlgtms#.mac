//DNX00155 JOB (2100,56-D),'DPARS 0682-T',CLASS=H,MSGCLASS=T,
//   TIME=2
//* CATALOG CHECK FOR TAPE VOLUMES. ANY MISMATCHES BETWEEN THE TMC
//*  AND CATALOG CAN BE UNCATALOGED.
//* SEE CTLGDISK  FOR THE DISK VERSION.
//*
//* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//* GATHER NONVSAM RECORDS FROM THE CATALOG
//* PARM='XXXXXXXX'             PASSWORD UP TO 8 CHARACTERS.
//*
//Z1       EXEC PGM=VSAMSCAN,PARM=CARE,TIME=4
//STEPCAT  DD DSN=SYS1.SOFTCAT,DISP=SHR
//VSAMCAT  DD DSN=SYS1.SOFTCAT,DISP=SHR
//STEPLIB DD DSN=WDPSC.TSAEXAM,DISP=SHR
//SYSPRINT DD SYSOUT=*
//AMSCARD DD DSN=&&AMS1,DISP=(,PASS),UNIT=WORK,
//   SPACE=(CYL,(1,1)),DCB=BLKSIZE=3200
//SYSUDUMP DD SYSOUT=*
//* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//* ELIMINATE THE RECORDS FOR DISK DATASETS
//* LOOK AT UNIT TYPE FROM CATALOG RECORD AND KEEP THE TAPE OR '80'
//*
//M8       EXEC DYL260,TIME=2
//SYS260A DD DSN=&&AMS1,DISP=(OLD,PASS)
//SYS260K DD DSN=&&AMS2,DISP=(,PASS),UNIT=SYSSQ,
//   SPACE=(CYL,(1,1)),DCB=BLKSIZE=3200
C
FA F
FK F    80     A
D       1A73                  EQ  1VX'80'                  REJ
D       3A69                  EQ  3V001                 OUTREJ
//* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//*   PRODUCE RECORDS FROM THE TMC
//*
//V5      EXEC PGM=TMSDATA,TIME=2
//STEPLIB  DD DSN=TMS.LOADMOD,DISP=SHR
//SYSUT1   DD DSN=TMS.TMC,DISP=SHR
//SYSUT3   DD DSN=&&TMSDATA,DISP=(,PASS),UNIT=SYSSQ,
//      SPACE=(CYL,(10,5)),DCB=(BLKSIZE=6000)
//SYSUT4   DD DUMMY,DCB=BLKSIZE=100
//TMSRPT   DD SYSOUT=*
//* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//* SORT RECORDS INTO VOLUME SEQUENCE FOR TMS MATCH
//*
//W4  EXEC SORT,TIME=2
//SORTIN DD DSN=&&AMS2,DISP=(OLD,PASS)
//SORTOUT DD DSN=&&AMS1,DISP=(OLD,PASS)
 SORT FIELDS=(75,6,CH,A,73,2,CH,A),DYNALLOC=WORK
//* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
//* MATCH CATALOG RECORDS AGAINST TMS DATA
//*
//T7       EXEC DYL260,TIME=2
//SYS260A DD DSN=&&TMSDATA,DISP=(OLD,PASS) TMC DERIVED RECORDS
//SYS260B DD DSN=&&AMS1,DISP=(OLD,PASS)     CATALOG DERIVED RECORDS
//SYS260K DD DSN=&&AMS2,DISP=(OLD,PASS)
C
FA F
FB F
FK F    80     B
D    1                        RB
D    1                        RA
* MATCH VOLUME SERIAL NUMBER
DAAA    6A72                  EQ  6B75                  D1
D       6A72                  LT  6B75                  RDA
D                             WK                        RDB
*
* VOLUME MATCH MADE, CHECK FOR EQUAL DATA SET NAMES
* IF EQUAL, READ NEXT CATALOG RECORD.
* IF TMS LESS THAN CATALOG, READ CATALOG FILE.
* IF TMS GREATER THAN CATALOG, WRITE CATALOG RECORD FOR FURTHER
* PROCESSING AND READ CATALOG FILE.
DD1    44A1                   EQ 44B6                   RDB
D      44A1                   LT 44B6                   RDA
D                             WK                        RDB
*
* EOF ON FILEA IS GREATER THAN OR EQUAL TO FILEB, NEVER LESS. THUS NO
* CHECK IS NEEDED
DRDA                          RA                        AAA
* EOF ON FILEB MEANS NO MORE CAN BE DONE
DRDB    5B1                   EQ  5VX'FFFFFFFFFF'       OFF
D                             RB                        AAA
*
DOFF    1V2                       1UEOJ                 OUT
//*
//* PUT "K" FILE OUT FOR EDITING AND OTHER PROCESSING.
//S8  EXEC FTL,TIME=2
//IN01  DD DSN=&&AMS2,DISP=(OLD,PASS)
//OUT01 DD DSN=DN00155.SOFTCAT.TAPE,DISP=(,CATLG),
//   SPACE=(CYL,(1,1)),UNIT=WORK

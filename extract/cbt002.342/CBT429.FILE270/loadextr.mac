000010 ID DIVISION.
000020 PROGRAM-ID.     LOADEXTR.
000030 AUTHOR.         JEFF SPREHN.
000040     EJECT
000050 ENVIRONMENT DIVISION.
000060 CONFIGURATION SECTION.
000070 SOURCE-COMPUTER. IBM-370.
000080 OBJECT-COMPUTER. IBM-370.
000090 INPUT-OUTPUT SECTION.
000100 FILE-CONTROL.
000110
000120     SELECT  INPUT-FILE          ASSIGN UT-S-INPUT.
000130     SELECT  EXTRACT-FILE        ASSIGN UT-S-OUTPUT.
000140     EJECT
000150 DATA DIVISION.
000160
000170 FILE SECTION.
000180
000190 FD  INPUT-FILE
000200     LABEL RECORDS ARE   STANDARD
000210     RECORDING MODE IS   F
000220     RECORD CONTAINS     121 CHARACTERS
000230     BLOCK CONTAINS      0 RECORDS
000240     DATA RECORDS IS     INPUT-REC.
000250
000260
000270 01  INPUT-REC.
000280     05  BYTE-1                              PIC X(01).
000290     05  FILLER                              PIC X(01).
000300     05  BYTES-3-19.
000310         10  BYTES-3-10.
000320             15  BYTES-3-5.
000330                 20  BYTE-3                  PIC X(01).
000340                 20  FILLER                  PIC X(02).
000350             15  FILLER                      PIC X(05).
000360         10  FILLER                          PIC X(09).
000370     05  FILLER                              PIC X(13).
000380     05  BYTES-33-80.
000390         10  FILLER                          PIC X(05).
000400         10  BYTE-38                         PIC X(01).
000410         10  BYTES-39-46.
000420             15  BYTES-39-41.
000430                 20  BYTE-39                 PIC X(01).
000440                 20  FILLER                  PIC X(02).
000450             15  FILLER                      PIC X(05).
000460         10  FILLER                          PIC X(34).
000470     05  FILLER                              PIC X(01).
000480     05  BYTES-82-89                         PIC X(08).
000490     05  FILLER                              PIC X(32).
000500     EJECT
000510 FD  EXTRACT-FILE
000520     LABEL RECORDS ARE   STANDARD
000530     RECORDING MODE IS   F
000540     RECORD CONTAINS     16 CHARACTERS
000550     BLOCK CONTAINS      0 RECORDS
000560     DATA RECORDS IS     EXTRACT-REC.
000570
000580
000590 01  EXTRACT-REC.
000600     05  CALLING-PROGRAM                     PIC X(8).
000610     05  CALLED-PROGRAM                      PIC X(8).
000620     EJECT
000630 WORKING-STORAGE SECTION.
000640
000650
000660 77  TIME-TO-STOP                            PIC X(3).
000670 77  END-OF-RUN                VALUE 'NO '   PIC X(3).
000680 77  SAVE-CALLING-PGM-NAME                   PIC X(8).
000690
000700 01  ABOUT-TO-ABORT                          PIC X.
000710
000720 01  ABORT-NUMBER
000730       REDEFINES ABOUT-TO-ABORT              PIC 9.
000740
000750
000760     EJECT
000770 PROCEDURE DIVISION.
000780
000790 0000-OPEN.
000800
000810     OPEN   INPUT   INPUT-FILE
000820           OUTPUT  EXTRACT-FILE.
000830
000840 1000-READ.
000850
000860     READ INPUT-FILE
000870         AT END
000880             GO TO 9999-QUIT.
000890
000900 1100.
000910
000920     IF BYTES-33-80 OF INPUT-REC
000930        = 'ALPHABETICAL CROSS-REFERENCE LIST OF LOAD MODULE'
000940            NEXT SENTENCE
000950     ELSE
000960            GO TO 1000-READ.
000970
000980     MOVE 'NO ' TO TIME-TO-STOP.
000990
001000     PERFORM 2000-MAIN-PROCESS
001010        THRU 2999-EXIT-MAIN-PROCESS
001020
001030             UNTIL
001040
001050                    TIME-TO-STOP = 'YES'.
001060
001070     IF END-OF-RUN = 'YES'
001080         GO TO 9999-QUIT
001090     ELSE
001100         GO TO 1100.
001110     EJECT
001120 2000-MAIN-PROCESS.
001130
001140     MOVE BYTES-82-89 OF INPUT-REC
001150        TO SAVE-CALLING-PGM-NAME.
001160
001170 2100.
001180
001190     READ INPUT-FILE
001200         AT END
001210             DISPLAY '*****************'
001220             DISPLAY '* ABORTING      *'
001230             DISPLAY '*   PURPOSELY   *'
001240             DISPLAY '*               *'
001250             DISPLAY '* PROGRAM       *'
001260             DISPLAY '*   BUG #1      *'
001270             DISPLAY '*               *'
001280             DISPLAY '*****************'
001290             MOVE SPACE TO ABOUT-TO-ABORT
001300             ADD 1 TO ABORT-NUMBER.
001310
001320     IF BYTES-3-19 OF INPUT-REC = ' SYMBOL   AT LMOD'
001330        NEXT SENTENCE
001340     ELSE
001350        GO TO 2100.
001360
001370 2200.
001380
001390     READ INPUT-FILE
001400         AT END
001410             MOVE 'YES' TO TIME-TO-STOP
001420             MOVE 'YES' TO END-OF-RUN
001430             GO TO 2999-EXIT-MAIN-PROCESS.
001440
001450     IF BYTE-1 OF INPUT-REC = '1'
001460             MOVE 'YES' TO TIME-TO-STOP
001470             GO TO 2999-EXIT-MAIN-PROCESS.
001480
001490     IF BYTES-3-10 OF INPUT-REC = '*****END'
001500             MOVE 'YES' TO TIME-TO-STOP
001510             GO TO 2999-EXIT-MAIN-PROCESS.
001520
001530     PERFORM 3000-WRITE
001540        THRU 3999-EXIT-WRITE.
001550
001560     GO TO 2200.
001570
001580 2999-EXIT-MAIN-PROCESS.
001590     EXIT.
001600     EJECT
001610 3000-WRITE.
001620
001630     IF  (BYTE-3 OF INPUT-REC = '$')
001640       OR
001650         (BYTES-3-5 OF INPUT-REC = 'ILB')
001660       OR
001670         (BYTES-3-5 OF INPUT-REC = 'IHC')
001680       OR
001690         (BYTES-3-5 OF INPUT-REC = 'IHE')
001700       OR
001710         (BYTES-3-5 OF INPUT-REC = 'IBM')
001720       OR
001730         (BYTES-3-5 OF INPUT-REC = 'PLI')
001740       OR
001750         (BYTES-3-5 OF INPUT-REC = 'IEL')
001760       OR
001770         (BYTES-3-5 OF INPUT-REC = 'IKF')
001780       OR
001790         (BYTES-3-5 OF INPUT-REC = 'IHD')
001800               GO TO 3500.
001810
001820     MOVE SAVE-CALLING-PGM-NAME
001830       TO CALLING-PROGRAM OF EXTRACT-REC.
001840
001850     MOVE BYTES-3-10 OF INPUT-REC
001860       TO CALLED-PROGRAM OF EXTRACT-REC.
001870
001880     WRITE EXTRACT-REC.
001890
001900 3500.
001910
001920     IF  (BYTE-38 OF INPUT-REC = '$')
001930       OR
001940         (BYTE-39 OF INPUT-REC = '$')
001950       OR
001960         (BYTES-39-41 OF INPUT-REC = 'ILB')
001970       OR
001980         (BYTES-39-41 OF INPUT-REC = 'IHC')
001990       OR
002000         (BYTES-39-41 OF INPUT-REC = 'IHE')
002010       OR
002020         (BYTES-39-41 OF INPUT-REC = 'IBM')
002030       OR
002040         (BYTES-39-41 OF INPUT-REC = 'PLI')
002050       OR
002060         (BYTES-39-41 OF INPUT-REC = 'IEL')
002070       OR
002080         (BYTES-39-41 OF INPUT-REC = 'IKF')
002090       OR
002100         (BYTES-39-41 OF INPUT-REC = 'IHD')
002110               GO TO 3999-EXIT-WRITE.
002120
002130     MOVE SAVE-CALLING-PGM-NAME
002140       TO CALLING-PROGRAM OF EXTRACT-REC.
002150
002160     MOVE BYTES-39-46 OF INPUT-REC
002170       TO CALLED-PROGRAM OF EXTRACT-REC.
002180
002190     WRITE EXTRACT-REC.
002200
002210 3999-EXIT-WRITE.
002220     EXIT.
002230     EJECT
002240 9999-QUIT.
002250
002260     CLOSE INPUT-FILE
002270           EXTRACT-FILE.
002280
002290     STOP RUN.

00010000PROC 0 DEBUG
00020000/*                                                               */
00030000/*  PHONOPER - PRINT OPERATORS PHONE LIST                        */
00040000/*                                                               */
00041005/*  FIND ?? FOR TESTING NOTES                                    */
00042005/*                                                               */
00050004CONTROL NOLIST NOMSG NOFLUSH PROMPT
00060004IF &DEBUG NE &STR() THEN +
00070004  CONTROL LIST MSG NOFLUSH PROMPT CONLIST SYMLIST
00071000ISPEXEC CONTROL ERRORS RETURN
00080000ISPEXEC DISPLAY PANEL(PHONOPER)
00090000IF &LASTCC = 8 THEN +
00090100  DO
00090200    ISPEXEC  SETMSG MSG(PHN009T)
00091000    GOTO DONE
00092000  END
00170000CKCOPIES: +
00180000  ISPEXEC  VGET (PHONADM PHONAEB PHONDMT PHONFMS PHONPAS PHONPSB PHONREG8 PHONSHV PHONSTP) ASIS
00240000  IF (&PHONADM = ' ') OR (&PHONADM = &STR()) OR (&PHNADM = 0) THEN +
00240100    IF (&PHONAEB = ' ') OR (&PHONAEB = &STR()) OR (&PHNAEB = 0) THEN +
00240200      IF (&PHONDMT = ' ') OR (&PHONDMT = &STR()) OR (&PHNDMT = 0) THEN +
00240300        IF (&PHONFMS = ' ') OR (&PHONFMS = &STR()) OR (&PHNFMS = 0) THEN +
00240400          IF (&PHONPAS = ' ') OR (&PHONPAS = &STR()) OR (&PHNPAS = 0) THEN +
00240500            IF (&PHONPSB = ' ') OR (&PHONPSB = &STR()) OR (&PHNPSB = 0) THEN +
00240600              IF (&PHONFOX = ' ') OR (&PHONFOX = &STR()) OR (&PHNFOX = 0) THEN +
00240700                IF (&PHONSHV = ' ') OR (&PHONSHV = &STR()) OR (&PHNSHV = 0) THEN +
00240800                  IF (&PHONREG8 = ' ') OR (&PHONREG8 = &STR()) OR (&PHNREG8 = 0) THEN +
00240900                    IF (&PHONSTP = ' ') OR (&PHONSTP = &STR()) OR (&PHNSTP = 0) THEN +
00241000                      DO
00241100                        SET &PHNMSG = PHN009O
00241200                        GOTO DSPLERR
00241300                      END
00242000  IF (&PHONADM = ' ') OR (&PHONADM = &STR()) THEN +
00250000    SET &PHONADM = 0
00251000  IF (&PHONAEB = ' ') OR (&PHONAEB = &STR()) THEN +
00252000    SET &PHONAEB = 0
00260000  IF (&PHONDMT = ' ') OR (&PHONDMT = &STR()) THEN +
00270000    SET &PHONDMT = 0
00271000  IF (&PHONFMS = ' ') OR (&PHONFMS = &STR()) THEN +
00290000    SET &PHONFMS = 0
00291000  IF (&PHONPAS = ' ') OR (&PHONPAS = &STR()) THEN +
00310000    SET &PHONPAS = 0
00311000  IF (&PHONPSB = ' ') OR (&PHONPSB = &STR()) THEN +
00330000    SET &PHONPSB = 0
00330100  IF (&PHONFOX = ' ') OR (&PHONFOX = &STR()) THEN +
00330200    SET &PHONFOX = 0
00331000  IF (&PHONSHV = ' ') OR (&PHONSHV = &STR()) THEN +
00350000    SET &PHONSHV = 0
00350100  IF (&PHONREG8 = ' ') OR (&PHONREG8 = &STR()) THEN +
00350200    SET &PHONREG8 = 0
00351000  IF (&PHONSTP = ' ') OR (&PHONSTP = &STR()) THEN +
00370000    SET &PHONSTP = 0
00382000  SET &PHONETOT = &PHONADM + &PHONAEB + &PHONDMT + &PHONFMS + &PHONPAS + &PHONPSB +&PHONFOX + &PHONREG8 + &PHONSHV + &PHONSTP
00400002  IF &PHONETOT ^> 20 THEN +
00410000    GOTO CONT
00411000  SET &PHNMSG = PHN009M
00413000DSPLERR: +
00420000ISPEXEC  DISPLAY  PANEL(PHONOPER) MSG(&PHNMSG)
00421000  IF &LASTCC = 8 THEN +
00422000    DO
00423000      ISPEXEC  SETMSG MSG(PHN009T)
00424000      GOTO DONE
00425000    END
00510000GOTO CKCOPIES
00520000CONT: +
00520100  DO WHILE &PHONADM > 0
00520200    SET &PHONPARM = &STR(&PHONPARM.ADM )
00520300    SET &PHONADM = &PHONADM - 1
00520400  END
00520500  DO WHILE &PHONAEB > 0
00520600    SET &PHONPARM = &STR(&PHONPARM.AEB )
00520700    SET &PHONAEB = &PHONAEB - 1
00520800  END
00520900  DO WHILE &PHONDMT > 0
00521000    SET &PHONPARM = &STR(&PHONPARM.DMT )
00521100    SET &PHONDMT = &PHONDMT - 1
00521200  END
00521300  DO WHILE &PHONFMS > 0
00521400    SET &PHONPARM = &STR(&PHONPARM.FMS )
00521500    SET &PHONFMS = &PHONFMS - 1
00521600  END
00521700  DO WHILE &PHONPAS > 0
00521800    SET &PHONPARM = &STR(&PHONPARM.PAS )
00521900    SET &PHONPAS = &PHONPAS - 1
00522000  END
00522100  DO WHILE &PHONPSB > 0
00522200    SET &PHONPARM = &STR(&PHONPARM.PSB )
00522300    SET &PHONPSB = &PHONPSB - 1
00522400  END
00522500  DO WHILE &PHONFOX > 0
00522600    SET &PHONPARM = &STR(&PHONPARM.FOX )
00522700    SET &PHONFOX = &PHONFOX - 1
00522800  END
00522900  DO WHILE &PHONSHV > 0
00523000    SET &PHONPARM = &STR(&PHONPARM.SHV )
00523100    SET &PHONSHV = &PHONSHV - 1
00523200  END
00523300  DO WHILE &PHONREG8 > 0
00523400    SET &PHONPARM = &STR(&PHONPARM.REG8)
00523500    SET &PHONREG8 = &PHONREG8 - 1
00523600  END
00523700  DO WHILE &PHONSTP > 0
00523800    SET &PHONPARM = &STR(&PHONPARM.STP )
00523900    SET &PHONSTP = &PHONSTP - 1
00524000  END
00524600/*                                                               */
00524700/*  CREATE SEQUENTIAL C271 FILE FROM PHONE TABLE                 */
00524800/*                                                               */
00524905ERROR +
00525005  DO
00525105    ISPEXEC  SETMSG MSG(PHN009Y)
00525205    EXIT
00525305  END
00525400ISPEXEC  CONTROL DISPLAY REFRESH
00525500ALLOC F(SYSUDUMP) SYSOUT(X)
00525600ALLOC F(SYSOUT) SYSOUT(X)
00525700ALLOC F(O271C) DA(&SYSUID..T271C) NEW SPACE(65 10) BLKSIZE(6160) REUSE UNIT(SYSDA) RELEASE CATALOG LRECL(80) RECFM(F B)
00525800ERROR OFF
00525900ISPEXEC SELECT PGM(PHONDUMP) NEWAPPL(PHN)
00526000SET &RC = &LASTCC
00526100FREE F(SYSUDUMP SYSOUT O271C)
00526700/*                                                               */
00526800/*  SORT C271                                                    */
00526900/*                                                               */
00527005ERROR +
00527105  DO
00527205    ISPEXEC  SETMSG MSG(PHN009Y)
00527305    FREE F(&FREE)
00527405    EXIT
00527505  END
00527600ALLOC F(SYSUDUMP) DUMMY
00527705SET &FREE EQ &STR(SYSUDUMP)
00527800ALLOC F(SYSOUT) DUMMY
00527905SET &FREE EQ &STR(&FREE SYSOUT)
00528000ALLOC F(SYSIN) NEW SPACE(1 1) BLOCK(80) BLKSIZE(80) REUSE UNIT(SYSDA) RELEASE DELETE LRECL(80) RECFM(F)
00528105SET &FREE EQ &STR(&FREE SYSIN)
00528200OPENFILE SYSIN OUTPUT
00528300SET &SYSIN EQ &STR( SORT FIELDS=(20,25,A),FORMAT=CH)
00528400PUTFILE SYSIN
00528500CLOSFILE SYSIN
00528600ALLOC F(SORTIN) DA(&SYSUID..T271C) SHR REUSE DELETE
00528705SET &FREE EQ &STR(&FREE SORTIN)
00528800ALLOC F(SORTOUT) DA(&SYSUID..T271CS) NEW SPACE(65 10) BLOCK(80) BLKSIZE(6160) REUSE UNIT(SYSDA) RELEASE CATALOG LRECL(80) RECFM(F B)
00528905SET &FREE EQ &STR(&FREE SORTOUT)
00529000$ SORT
00529105FREE F(&FREE)
00529300/*                                                               */
00529400/*  CREATE PHONE DIRECTORY                                       */
00529500/*                                                               */
00529600ALLOC F(SYSUDUMP) DUMMY
00529705SET &FREE EQ &STR(SYSUDUMP)
00529803ALLOC F(SYSOUT) SYSOUT(X)
00529905SET &FREE EQ &STR(&FREE SYSOUT)
00530002ALLOC F(SYSIN) NEW SPACE(1 1) BLOCK(80) BLKSIZE(80) REUSE UNIT(SYSDA) RELEASE DELETE LRECL(80) RECFM(F)
00530105SET &FREE EQ &STR(&FREE SYSIN)
00530202OPENFILE SYSIN OUTPUT
00530302SET &SYSIN EQ &STR(&PHONPARM)
00530402PUTFILE SYSIN
00530502CLOSFILE SYSIN
00530600ALLOC F(I271C) DA(&SYSUID..T271CS) SHR REUSE DELETE
00530705SET &FREE EQ &STR(&FREE I271C)
00530803XRXALLOC DDNAME(PRINTER1) FORM(P001) REUSE
00530905SET &FREE EQ &STR(&FREE PRINTER1)
00531005/*?? UNCOMMENT WHEN TESTING SO LIST WILL NOT GET PRINTED:        */
00531105/*     FREE F(PRINTER1)                                          */
00531205/*     ALLOC F(PRINTER1) SYSOUT(X)                               */
00531500STEPLIB DATASET('MIS.LINKLIB') SHR
00531602$ MIS03500
00531700STEPLIB
00531805FREE F(&FREE)
00533005SET &FREE EQ &STR()
00540000ISPEXEC  SETMSG MSG(PHN009W)
00545000DONE: +
00546000  SET &PHONADM = &STR( )
00546100  SET &PHONAEB = &STR( )
00547000  SET &PHONDMT = &STR( )
00548000  SET &PHONFMS = &STR( )
00549000  SET &PHONPAS = &STR( )
00549100  SET &PHONPSB = &STR( )
00549200  SET &PHONFOX = &STR( )
00549300  SET &PHONSHV = &STR( )
00549400  SET &PHONREG8 = &STR( )
00549500  SET &PHONSTP = &STR( )
00549600  ISPEXEC  VPUT (PHONADM PHONAEB PHONDMT PHONFMS PHONPAS PHONPSB PHONFOX PHONREG8 PHONSHV PHONSTP) ASIS
00549700  EXIT
00550000END

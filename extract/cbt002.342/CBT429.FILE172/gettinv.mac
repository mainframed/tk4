***********************************************************************
*                                                                     *
*        PDSDOC *GET LOCATE FOR VARIABLE LENGTH RECORDS...............*
*                                                                     *
*        ON ENTRY R2 --> MDSCB                                        *
*                 R4  =  RETURN ADDRESS                               *
*        ON EXIT  R1 --> RECORD DATA (RDW), OR ZERO IF CANNOT READ    *
*                 R0  =  DATA LENGTH                                  *
*                                                                     *
* 13JUL00 DC  PER FLEMMING SMIT, NYKREDIT DO NOT ALLOW ZERO LENGTH    *
* 06FEB95 DC  CHANGE FROM 'RIN' TO 'SUBIN'. LOSE RE-ENTRANCY          *
*                                                                     *
***********************************************************************
         SPACE 1
GETTING  SUBIN SAVE=(R3,R4)        READ AN INPUT RECORD
         PUSH  USING               SAVE CURRENT STATUS
         USING MDCB,R2             ESTABLISH MDCB ADDRESSABILITY
         SR    R1,R1               ASSUME WE WILL FAIL
         TM    MDCBFLAG,DDINT+DDPRES+DDOPEN TEST IF WE CAN READ
         BO    GETTINVS            YES, CARRY ON
         GOSUB OPEN                GO OPEN FILE
         TM    MDCBFLAG,DDINT+DDPRES+DDOPEN TEST IF CAN READ
         BNO   GETTINVX            NO, ASSUMED FAILURE DID OCCUR
         SPACE 1
GETTINVS DS    0H                  GET A RECORD
         L     R3,MDCBDCB          GET DCB ADDRESS
         USING IHADCB,R3           ESTABLISH MDCB ADDRESSABILITY
         GET   (R3)                READ IN A RECORD
         AP    MDCBCNT,ONE         INCREMENT RECORD COUNTER
         SR    R0,R0               CLEAR LENGTH REGISTER
         ICM   R0,B'0011',DCBLRECL GET RECORD LENGTH
         TM    DCBRECFM,DCBRECV    ARE THEY VARIABLE LENGTH RECORDS?
         BNO   GETTINVX            NO, USE DCBLRECL VALUE
         ICM   R0,B'0011',0(R1)    ELSE GET LENGTH FROM RDW
         BNZ   GETTINVX            OK, THERE IS ONE
         ICM   R0,B'0011',DCBLRECL ELSE SET DEFAULT
         SPACE 1
GETTINVX DS    0H                  RETURN TO CALLER
         SUBOUT RESTORE=(R3,R4)    SUBROUTINE EXIT
         DROP  R2,R3               FINISHED WITH MDCB AND DCB
         POP   USING               RESTORE STATUS

//*
//*      PDSDOC *USE VTOC, RELEASE SPACE IN OVER-ALLOC PS FILES.......*
//*
//* THIS IS A SAMPLE OF HOW TO USE 'VTOC' IN BATCH TO MANAGE DISK SPACE
//* IN THIS JOB WE USE THE PUBLIC DOMAIN TSO COMMAND 'RLSE' TO RELEASE
//* UNUSED SPACE IN SEQUENTIAL FILES WHICH HAVE MORE THAN 30 TRACKS
//* FREE. THIS IS AN ACTUAL JOB I RUN TWICE A WEEK, BUT THE CONCEPTS
//* ARE EASILY EXTENDED TO MANY OTHER FUNCTIONS.
//*
//VTOC     EXEC PGM=IKJEFT01,REGION=8M
//SYSTSPRT DD SYSOUT=*
//ISPLLIB  DD DISP=SHR,DSN=SYS2.LINKLIB
//VTOCOUT  DD DSN=&&VTOC,
//            DISP=(,PASS),
//            UNIT=WORK,
//            SPACE=(TRK,(5,1),RLSE)
//SYSTSIN  DD *
  VTOC ( PROD PRD TEST TST WRK I8K I8E TSO SHAR ) +
     NOHEADING +
     TRK +
     LIMIT(DSO EQ PS) +
     AND1(UNUSED GT 30) +
     PRINT(NEW (DSNAME VOLUME ALLOC UNUSED PCT CDATE REFDT))
/*
//*
//STEP02  EXEC PGM=ICEGENER
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  DUMMY
//SYSUT1   DD  DISP=(OLD,PASS),DSN=&&VTOC
//SYSUT2   DD  SYSOUT=*
//*
//STEP03  EXEC PGM=IEBUPDTE,PARM=NEW
//SYSPRINT DD  SYSOUT=*
//SYSUT2   DD  DISP=(,PASS),DSN=&&CLIST,
//             UNIT=VIO,SPACE=(TRK,(5,,1),RLSE),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=6160)
//SYSIN    DD  *
./ ADD NAME=P
PROC 0 MIGL(1)
CONTROL NOFLUSH NOLIST NOCONLIST NOSYMLIST   MSG
ERROR DO
 SET RC = &LASTCC
 IF &RC = 400 THEN DO
    SET DONE = YES
    WRITE END-OF-FILE
    END
 RETURN
END   /*END OF FILE ROUTINE */

SET DONE = NO
SET FOUND = NO
OPENFILE SYSDVAL
DO WHILE &DONE = NO
         GETFILE SYSDVAL
         READDVAL IFP
         IF &IFP = 0 THEN DO
            SET DONE = YES
            EXIT
            END
    /*   WRITE FILE &IFP  */
         RLSE '&IFP'
         SET RC = 0
END
CLOSFILE SYSDVAL
RETURN
/*
//*
//TSOBTCH EXEC PGM=IKJEFT01,REGION=4096K
//SYSTSPRT DD  SYSOUT=A,DEST=RMT23
//SYSPROC  DD  DISP=(OLD,PASS),DSN=&&CLIST
//SYSTSIN  DD  *
  %P
/*
//SYSDVAL  DD  DISP=(OLD,PASS),DSN=&&VTOC

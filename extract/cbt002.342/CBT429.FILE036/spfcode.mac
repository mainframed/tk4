         SPACE 2
*        DATA CONTROL BLOCKS
         SPACE 1
EXCPDCB  DCB   MACRF=E,DDNAME=LIBRARY,DSORG=PS,EXLST=JFCBEXIT
         EJECT
BPAMDCB  DCB   MACRF=(R,W),DDNAME=LIBRARY,DSORG=PO,BUFNO=1
         EJECT
BSAMDCB  DCB   MACRF=W,DDNAME=FPDS0001,DSORG=PS
         EJECT
*        DATA EVENT CONTROL BLOCK FOR BPAM
         SPACE 1
         READ  DECB,SF,BPAMDCB,MF=L
         SPACE 2
*        DATA EVENT CONTROL BLOCK FOR BSAM
         SPACE 1
         WRITE DECBS,SF,BSAMDCB,,'S',MF=L
         SPACE 2
*        JOB FILE CONTROL BLOCK
         SPACE 1
JFCB     DS    CL176
         SPACE 2
*        EXIT LIST FOR RDJFCB
         SPACE 1
JFCBEXIT DS    0F
         DC    X'87'
         DC    AL3(JFCB)
         SPACE 2
*        CATALOG MANAGEMENT PARAMETER LIST
         SPACE 1
DSCBCAM  CAMLST SEARCH,CAMDSN,CAMVOL,DSCB
         SPACE 2
*        PARAMETER FIELDS FOR CATALOG MANAGEMENT
      SPACE 1
CAMDSN   DS    CL44                    DATASET NAME
CAMVOL   DS    CL6                     VOLUME SERIAL
         SPACE 2
*        DATA SET CONTROL BLOCK
         SPACE 1
         DS    0D
DSCB     DS    XL148
         SPACE 2
*        INPUT OUTPUT BLOCK
         SPACE 1
IOB      DS    0XL40
IOBFLAG1 DC    B'01000010'
IOBFLAG2 DC    X'00'
IOBSENS0 DC    X'00'
IOBSENS1 DC    X'00'
IOBECBCC DC    X'00'
IOBECBPT DC    AL3(ECB)
IOBFLAG3 DC    X'00'
IOBCSW   DC    XL7'00'
IOBSIOCC DC    X'00'
IOBSTART DC    AL3(0)
         DS    X'00'
IOBDCBPT DC    AL3(EXCPDCB)
         DC    XL8'00'
IOBSEEK  DS    0XL8
IOBSM    DC    X'00'
IOBSBB   DC    X'0000'
IOBCCHHR DS    0XL5
IOBSCCHH DS    0XL4
IOBSCC   DC    X'0000'
IOBSHH   DC    X'0000'
IOBSR    DC    X'00'
         SPACE 2
*        EVENT CONTROL BLOCK
         SPACE 1
ECB      DC    F'0'
         SPACE 2
*        COUNT AND DATA FIELD FOR I-O
         SPACE 1
CNTDATA  DS    0CL9
CNT      DS    0XL8
CNTCCHHR DS    0XL5
CNTCCHH  DS    0XL4
CNTCC    DS    XL2
CNTHH    DS    XL2
CNTR     DS    X
         DS    XL3
DATA     DS    CL1
         SPACE 2
DIRBUF   DS    CL256
         EJECT
*        CHANNEL COMMAND WORDS
         SPACE 1
CCWCSSEC EQU   X'23'                   SET SECTOR
CCWCSHAE EQU   X'39'                   SEARCH HOME ADDRESS EQUAL
CCWCSIDE EQU   X'31'                   SEARCH ID EQUAL
CCWCSKHE EQU   X'69'                   SEARCH KEY HIGH OR EQUAL
CCWCRCKD EQU   X'1E'                   READ COUNT, KEY, AND DATA
CCWCRC   EQU   X'12'                   READ COUNT
CCWCRD   EQU   X'06'                   READ DATA
CCWCWD   EQU   X'05'                   WRITE DATA
CCWCTIC  EQU   X'08'                   TRANSFER IN CHANNEL
CCWCMT   EQU   X'80'                   MULTI-TRACK
CCWFCC   EQU   X'40'                   CHAIN COMMANDS
CCWFSLI  EQU   X'20'                   SUPRESS LENGTH INDICATION
         SPACE 3
CPSTRT   DS    0D                      START OF EXTENT CP
         CCW   CCWCSSEC,ZERO,CCWFCC,1  SET SECTOR ZERO
         CCW   CCWCSHAE,IOBCCHHR,CCWFCC,4
         CCW   CCWCTIC,*-8,0,0
CPRDLOP  DS    0D                      LOOP FOR FINDING EOF
         CCW   CCWCRCKD+CCWCMT,CNTDATA,CCWFCC+CCWFSLI,L'CNTDATA
         CCW   CCWCTIC,*-8,0,0
CPLOOK   DS    0D                      PICK UP WHERE LEFT OFF
         CCW   CCWCSIDE,IOBCCHHR,CCWFCC,5
         CCW   CCWCTIC,*-8,0,0
         CCW   CCWCTIC,CPRDLOP,0,0
         SPACE 2
CPGET    DS    0D                      FIND RECORD AFTER EOF
         CCW   CCWCSIDE,IOBCCHHR,CCWFCC,5
         CCW   CCWCTIC,*-8,0,0
         CCW   CCWCRD,DATA,CCWFSLI,L'DATA
         SPACE 2
CPRDDIR  DS    0D                      FIND CORRECT DIR BLOCK AND RD
         CCW   CCWCSSEC,ZERO,CCWFCC,1  SET SECTOR ZERO
         CCW   CCWCSHAE,IOBSCCHH,CCWFCC,4 SEARCH HOME ADDRESS
         CCW   CCWCTIC,*-8,0,0
KEYLOOP  DS    0D
         CCW   CCWCRC,CNT,CCWFCC,8     SAVE COUNT OF NEXT RECORD
         CCW   CCWCSKHE+CCWCMT,MEMBER,CCWFCC,L'MEMBER FIND BLOCK
         CCW   CCWCTIC,KEYLOOP,0,0     IF NOT RIGHT, LOOP
         CCW   CCWCRD,DIRBUF,0,L'DIRBUF READ BLOCK
         SPACE 2
CPWTDIR  DS    0D
         CCW   CCWCSIDE,IOBCCHHR,CCWFCC,5 FIND RIGHT RECORD
         CCW   CCWCTIC,*-8,0,0
         CCW   CCWCWD,DIRBUF,0,L'DIRBUF
         EJECT
*        LIST FORM OF OPEN AND CLOSE MACRO
         SPACE 2
OPENEXCP OPEN  (EXCPDCB,INPUT),MF=L
OPENBPAM OPEN  (BPAMDCB,INPUT),MF=L
OPENBSAM OPEN  (BSAMDCB,OUTPUT),MF=L
CLOSEXCP CLOSE EXCPDCB,MF=L
CLOSBPAM CLOSE BPAMDCB,MF=L
CLOSBSAM CLOSE BSAMDCB,MF=L
         SPACE 2
*        WORKING STORAGE
         SPACE 1
POINTER  DC    A(0)
MEMBER   DS    CL8
LSTARFDA DS    CL8                     MBBCCHHR OF END OF DATASET
BUFRADDR DS    A                       ADDRESS OF BPAM IO BUFFER
         SPACE 2
*        CONSTANTS
         SPACE 1
ZERO     DC    X'00'

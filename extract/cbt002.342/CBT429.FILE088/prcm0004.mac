//C7B285I  JOB (M096,0616,99,9999),'SYSTEMS*BRIAN',NOTIFY=C7BRIAN,
//       MSGCLASS=T,CLASS=W
//SMP     EXEC PGM=GIMSMP,REGION=4096K,TIME=60
//SMPCSI   DD  DSN=SMPE.GLOBAL.CSI,DISP=SHR
//* * * * * * * * * * * * * * * * * * * * *
//* THIS SYSMOD REQUIRES PRCM0003 ALSO  * *
//* * * * * * * * * * * * * * * * * * * * *
//SMPOUT   DD  SYSOUT=*
//SMPRPT   DD SYSOUT=*
//SMPSNAP  DD SYSOUT=*
//SYSABEND DD SYSOUT=*
//SMPLIST  DD SYSOUT=*
//SYSPRINT DD SYSOUT=*
//SYSUT1   DD UNIT=SYSDA,SPACE=(3120,(0380,0760))
//SYSUT2   DD UNIT=SYSDA,SPACE=(3120,(0380,0760))
//SYSUT3   DD UNIT=SYSDA,SPACE=(3120,(0380,0760))
//SMPHOLD  DD DUMMY
//SYSUT4   DD UNIT=SYSDA,SPACE=(3120,(0038,0100)),
//         DCB=(LRECL=80,BLKSIZE=3120,RECFM=FB)
//SMPWRK1  DD UNIT=SYSDA,
//            SPACE=(3120,(0364,0380,111)),
//            DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//SMPWRK2  DD UNIT=SYSDA,
//            SPACE=(3120,(0364,0380,111)),
//            DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//SMPWRK3  DD UNIT=SYSDA,
//            SPACE=(3120,(0364,0380,111)),
//            DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//SMPWRK4  DD UNIT=SYSDA,
//            SPACE=(3120,(0364,0380,111)),
//            DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//SMPWRK5  DD UNIT=SYSDA,
//            SPACE=(6144,(0183,0380,195)),
//            DCB=(RECFM=U,BLKSIZE=6144)
//SMPCNTL  DD  *
  SET BDY (GLOBAL).
  RECEIVE SELECT(PRCM004).
  SET BOUNDARY(M211TAA).
  APPLY  SELECT(PRCM004) REDO.
//SMPPTFIN  DD *
++USERMOD  (PRCM004) .
++VER      (Z038) FMID(EBB1102).
++ZAP     (IEFAB4B0) DISTLIB(AOSB3)  /* LMOD IS IEFW21SD */.
 NAME IEFAB4B0
 EXPAND IEFAB4B0(256)
 VER 0076 D248          MVC MSGBUFFER+1(73),MSGBUFFER
 VER 0118 41A00037      LINE1LEN IS 55
 VER 011C 1EA2          ALR   R10,R2
 VER 03E8 E600010C      SP 230, LENGTH IS 268
 VER 0052 4220B10B      STC   R2,@OLDKEY
 VER 02EE 4320B10B      IC    R2,@OLDKEY
 REP 0076 D250          MVC MSGBUFFER+1(81),MSGBUFFER
 REP 0118 41A00052      CHANGE LENGTH OF MSG FROM 55+13 TO 82
 REP 011C 0700          KEEP MGS LENGTH FIXED (DONT ADD 13)
 REP 03E8 E6000128      CHANGE LENGTH OF WORKAREA FROM 268 TO 296
 REP 0052 4220B118      STC   R2,@OLDKEY
 REP 02EE 4320B118      IC    R2,@OLDKEY
 *
 *        HOOK IN IEFAB4B0
 *
 VER 0180 45E0C300      BAL R14,WRITEMSG
 REP 0180 45E0C474      LINK TO EXCP SUBROUTINE IN EXPAND AREA
 *
 *        REGISTERS
 *  R1, R12, R15 - WORK REGISTERS
 *                 R10 - EXCP BASE REGISTER
 *                 R11 - AB4B0 WORKAREA PTR
 *                 R12 = ON EXCP EXIT, AB4B0 BASE REG
 *                 R14 - LINK RETURN REG
 *
 *                 EXCP CSECT
 *   048E = CSECT LENGTH BEFORE EXPAND
 VER 031C 90ECB05C STM R14,R12,@SA00002 SAVE REGS
 REP 0490 90ECB05C STM R14,R12,@SA00002 SAVE REGS
 REP 0494 05A0     BALR R10,0  SETUP BASE
 *                 00006 USING *,R10  INFORM ASM
 REP 0496 58100010                L    R1,CVTPTR  CVT
 REP 049A 58101000                L    R1,0(,R1)  TCB WORDS
 REP 049E 58101004                L    R1,4(,R1)  CURRENT TCB ADDRESS
 REP 04A2 58C010A4                L    R12,TCTPTR GET TCT ADDRESS
 REP 04A6 12CC                    LTR  R12,R12    IS THERE A TCT
 REP 04A8 4780A0A2                BZ   EXIT       NO, BRANCH
 REP 04AC 58C0C00C                L    R12,TCTIOTBL
 REP 04B0 12CC                    LTR  R12,R12    IS THERE A TABLE
 REP 04B2 4780A0A2                BZ   EXIT       NO, BRANCH
 *
 ************************************************************
 *
 REP 04B6 5820B058                L    R2,@PC00001+16
 REP 04BA 58202000                L    R2,0(,R2)  GET JSCBPTR
 REP 04BE 5820214C                L    R2,JSCTMCOR
 REP 04C2 1222                    LTR  R2,R2      IS IT ZERO
 REP 04C4 4780A0A2                BZ   EXIT       YES, BRANCH
 REP 04C8 58202018                L    R2,24(,R2) GET TIOT ADDRESS
 REP 04CC 58F0D004                L    R15,4(,R13) OLD SAVEAREA
 REP 04D0 58F0F03C                L    R15,60(,R15) IEFAB4A2'S R10
 * DISPLACEMENT ON NEXT INSTRUCTION MUST MATCH THAT OF IEFAB4A2   *
 REP 04D4 58FF0138                L    R15,DSABPTR  IEFAB4A2'S DSABPTR
 REP 04D8 12FF                    LTR  R15,R15    IS IT ZERO
 REP 04DA 4780A0A2                BZ   EXIT       YES, BRANCH
 *
 **************************************************************
 *
 REP 04DE 58F0F010                L    R15,DSABTIOT
 REP 04E2 1BF2                    SR   R15,R2     GET TIOT OFFSET
 REP 04E4 4110C008                LA   R1,8(,R12) POINT TO TCT LOOKUP
 REP 04E8 1722                    XR   R2,R2      GET A ZERO
 *
 REP 04EA 49201000       SEARCH   CH    R2,0(,R1) END OF LOOKUP TABLE
 REP 04EE 4780A0A2                BE    EXIT      YES, BRANCH
 REP 04F2 49F01000                CH    R15,0(,R1) TIOT OFFSET EQUAL
 REP 04F6 4780A06C                BE    FOUND     YES, BRANCH
 REP 04FA 41101004                LA    R1,4(,R1) NO, NEXT ENTRY
 *
 REP 04FE 47F0A054                B     SEARCH
 *
 REP 0502 48101002       FOUND    LH    R1,2(,R1) OFFSET TO DD ENTRY
 *
 REP 0506 4111C000                LA    R1,0(R1,R12) ADD TCT BASE
 *
 REP 050A 17CC                    XR    R12,R12   PREPARE TO IC
 REP 050C 43C01002                IC    R12,2(,R1) NUMBER OF CONCATS
 REP 0510 17FF                    XR    R15,R15   ZERO THE COUNTER
 *
 REP 0512 5AF01004       DEVLOOP  A     R15,4(,R1) ADD TO COUNTER
 *
 REP 0516 41101008                LA    R1,8(,R1)  NEXT DEVICE
 REP 051A 46C0A07C                BCT   R12,DEVLOOP LOOP IF CONCAT
 *
 REP 051E 4EF0B120                CVD   R15,DOUBLE
 REP 0522 960FB127                OI    DOUBLE+7,X'0F'
 REP 0526 D207B105A0AF            MVC   B105(8),EXCPPAT
 REP 052C DE07B105B124            ED    B105(8),DOUBLE+4(4)
 *   052C F363B10BB124            UNPK  B10B(7),DOUBLE+4(4)
 REP 0532 D203B10EA0AA            MVC   B10E(4),EXCPCON
 *
 REP 0538 98ECB05C       EXIT     LM    14,12,@SA00002
 REP 053C 47F0C300                B     WRITEMSG
 *
 REP 0540 C5E7C3D77E     EXCPCON  DC    C'EXCP='
 REP 0545 4020202020202120 CPPAT  DC    X'4020202020202120'
 IDRDATA ST85100
/*
//

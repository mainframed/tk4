* SHUTDOWN MVS/ESA V5.2.2 AT UCSF AS OF 6/18/98
* FIRST VARY THE VTAM CONNECTION CLOSED TO CICS'S
F CICSPRMP,CEMT S VTAM CLOSE,IMM
F CICSPRCA,CEMT S VTAM CLOSE,IMM
F CICSTRMP,CEMT S VTAM CLOSE,IMM
F CICSTRCA,CEMT S VTAM CLOSE,IMM
F CICSTSMP,CEMT S VTAM CLOSE,IMM
F CICSTSCA,CEMT S VTAM CLOSE,IMM
F CICSTSGL,CEMT S VTAM CLOSE,IMM
F CICSRETR,CEMT S VTAM CLOSE,IMM
F CICSPRDS,CEMT S VTAM CLOSE,IMM
* DRAIN JES2 INITS AND DEVICES
$PI
$PLNE1
$PLNE2
$PLNE3
$PLNE4
$PLNE5
$PLNE6
$PPRT1
$PPRT2
$PPRT3
$PPRT4
$PLGN1
* WAIT 5 SECONDS FOR THE COMMANDS TO COMPLETE
DELAY=005
* SEE IF TSI TASKS ARE UP AND BEGIN THEIR SHUTDOWN
* FIRST DO EOD, LATER WE WILL DO AN EOJ
IFSTARTED TSIPROD
REPLY TSIPROD * EOD
ENDIF
IFSTARTED TSITEST
REPLY TSITEST * EOD
ENDIF
IFSTARTED ZTSIPROD
REPLY ZTSIPROD * EOD
ENDIF
IFSTARTED ZTSITEST
REPLY ZTSITEST * EOD
ENDIF
* NOW SHUT DOWN THE CICS'S
F CICSPRMP,CEMT P SHUT IMM
F CICSPRCA,CEMT P SHUT IMM
F CICSTRMP,CEMT P SHUT IMM
F CICSTRCA,CEMT P SHUT IMM
F CICSTSMP,CEMT P SHUT IMM
F CICSTSCA,CEMT P SHUT IMM
F CICSTSGL,CEMT P SHUT IMM
F CICSRETR,CEMT P SHUT IMM
F CICSPRDS,CEMT P SHUT IMM
* SHUT DOWN INFOPAC
P INFOPAC
* NOW SHUTDOWN TSO
P TSO
* WAIT 5 SECONDS FOR TSO TO EITHER SHUTDOWN OR ASK FOR FSTOP
DELAY=005
* REPLY TO OUTSTANDING TSO MESSAGE IF THERE IS ONE
REPLY TSO * FSTOP
* STOP TERMINAL RESET PROC
P RESET2VM
* STOP CANDLE SUBSYSTEM
P KCNDL
* STOP ENF
P ENF
* WAIT 5 SECONDS FOR ENF REPLY IF ANY
DELAY=005
* REPLY TO ENF SHUTDOWN REPLY
REPLY ENF * Y
* SET STK LIBRARY MANAGER OFF
#MOD 000,OFF
* DELAY 5 SECONDS TO LET LIBRARY MANAGER SETTLE DOWN
DELAY=005
* STOP SLM STARTED TASK SLS0
P SLS0
* STOP CCFXAPPL
IFSTARTED CCFXAPPL
F CCFXAPPL,SHU
DELAY=015
P CCFXAPPL
ENDIF
* BRING DOWN THE CANDLE STATUS MONITOR
P KC2PROC
* SHUT DOWN CMF
P MVSPAS
* SHUT DOWN MAINVIEW
P BBCS
* STOP JSF
P JSF
* SHUTDOWN EPS
P RUNEPS
* SHUT DOWN RUNIUCV
P RUNIUCV
* WAIT 5 SECONDS FOR RUNIUCV TO CATCH UP
DELAY=005
* REPLY TO RUNIUCV MESSAGE TO SHUTDOWN
REPLY RUNIUCV * YES
* NOW SEE IF TSI TASKS ARE UP AND BEGIN THEIR SHUTDOWN
* NOW DO EOJ
IFSTARTED TSIPROD
REPLY TSIPROD * EOJ
ENDIF
IFSTARTED TSITEST
REPLY TSITEST * EOJ
ENDIF
IFSTARTED ZTSIPROD
REPLY ZTSIPROD * EOJ
ENDIF
IFSTARTED ZTSITEST
REPLY ZTSITEST * EOJ
ENDIF
* SHUT DOWN TCP/IP (RUNCETI)
F RUNCETI,P CLEAR
* WAIT 5 SECONDS FOR TCP TO CATCH UP
DELAY=005
* REPLY TO TCP/IP SHUTDOWN MESSAGE
F RUNCETI * YES
* SHUT DOWN POOLDASD
F POOLDASD,SHUTDOWN
* SHUT DOWN DLF PHASE 1
F DLF,MODE=QUIESCE
* WAIT 5 SECONDS FOR DLF TO RESPOND
DELAY=005
* SHUT DOWN DLF
P DLF
* STOP BOTH LLA AND VLF
P LLA
P VLF
* STOP ZEBB ZEKE AND ZACK
!KILL
.KILL
ZKILL COLD
* STOP THE APPLMON GUYS
C APPLPRMP
C APPLPRCA
C APPLTRMP
C APPLM204
C APPLZ204
C APPLT204
* IF TCP/IP IS STILL UP THEN SHUT IT DOWN
IFSTARTED RUNCETI
F RUNCETI,P CLEAR
* WAIT 5 SECONDS FOR TCP TO CATCH UP
DELAY=005
* REPLY TO TCP/IP SHUTDOWN MESSAGE
F RUNCETI * YES
DELAY=015
P RUNCETI
* WAIT 15 SECONDS
DELAY=015
P RUNCETI
ENDIF
* ALL THAT SHOULD BE UP NOW ARE VTAM ACF2 AND JES2 MAKE SURE
IFSTARTED CICSPRMP
F CICSPRMP,CEMT P SHUT,I
DELAY=030
C CICSPRMP
C APPLPRMP
ENDIF
IFSTARTED CICSPRCA
F CICSPRCA,CEMT P SHUT,I
DELAY=030
C CICSPRCA
C APPLPRCA
ENDIF
IFSTARTED CICSTRMP
F CICSTRMP,CEMT P SHUT,I
DELAY=030
C CICSTRMP
C APPLTRMP
ENDIF
IFSTARTED CICSTRCA
F CICSTRCA,CEMT P SHUT,I
DELAY=030
C CICSTRCA
C APPLTRCA
ENDIF
IFSTARTED CICSTSMP
F CICSTSMP,CEMT P SHUT,I
DELAY=030
C CICSTSMP
C APPLTSMP
ENDIF
IFSTARTED CICSTSCA
F CICSTSCA,CEMT P SHUT,I
DELAY=030
C CICSTSCA
C APPLTSCA
ENDIF
IFSTARTED CICSTSGL
F CICSTSGL,CEMT P SHUT,I
DELAY=030
C CICSTSGL
C APPLTSGL
ENDIF
IFSTARTED CICSRETR
F CICSRETR,CEMT P SHUT,I
DELAY=030
C CICSRETR
C APPLRETR
ENDIF
IFSTARTED CICSPRDS
F CICSPRDS,CEMT P SHUT,I
DELAY=030
C CICSPRDS
C APPLPRDS
ENDIF
* MAKE SURE ALL APPLMONS ARE DOWN AGAIN
C APPLPRMP
C APPLPRCA
C APPLTRMP
C APPLM204
C APPLZ204
C APPLT204
* SHUT DOWN VTAM
Z NET,QUICK
* WAIT 15 SECONDS TO CATCH UP
DELAY=015
* CHECK TCP/IP
IFSTARTED RUNCETI
P RUNCETI
DELAY=015
C RUNCETI
ENDIF
* SHUT DOWN ACF2
P ACF2
* WAIT ANOTHER 10 SECONDS
DELAY=10
* SEE IF VTAM STILL UP
IFACTIVE VTMLCL
DELAY=015
Z NET,CANCEL
DELAY=30
ENDIF
* SHUT DOWN JES2
$P
DELAY=005
$PJES2

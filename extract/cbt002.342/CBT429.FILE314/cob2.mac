000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.    COB2.
000300 ENVIRONMENT DIVISION.
000400 CONFIGURATION SECTION.
000500 SOURCE-COMPUTER. IBM-3090.
000600 OBJECT-COMPUTER. IBM-3090.
000700 INPUT-OUTPUT SECTION.
000800 FILE-CONTROL.
000900     SELECT REPORT-FILE ASSIGN TO UT-S-REPORT.
001000 DATA DIVISION.
001100 FILE SECTION.
001200 FD  REPORT-FILE
001300     RECORDING MODE IS V
001400     BLOCK CONTAINS 0 RECORDS.
001500 01  RPTSYSTABAUTH.
001600     10 GRANTOR              PIC X(8).
001700     10 FILLER               PIC X(1).
001800     10 GRANTEE              PIC X(8).
001900     10 FILLER               PIC X(1).
002000     10 TCREATOR             PIC X(8).
002100     10 TTNAME.
002200        49 TTNAME-TEXT       PIC X(18).
002300     10 FILLER               PIC X(2).
002400     10 DATEGRANTED          PIC X(6).
002500     10 FILLER               PIC X(8).
002600     10 UPDATECOLS           PIC X(1).
002700     10 FILLER               PIC X(8).
002800     10 ALTERAUTH            PIC X(1).
002900     10 FILLER               PIC X(8).
003000     10 DELETEAUTH           PIC X(1).
003100     10 FILLER               PIC X(8).
003200     10 INDEXAUTH            PIC X(1).
003300     10 FILLER               PIC X(8).
003400     10 INSERTAUTH           PIC X(1).
003500     10 FILLER               PIC X(8).
003600     10 SELECTAUTH           PIC X(1).
003700     10 FILLER               PIC X(8).
003800     10 UPDATEAUTH           PIC X(1).
003900 01  RPT-HEADINGS            PIC X(132).
004000 WORKING-STORAGE SECTION.
004100 01  WS-START             PIC X(16)  VALUE 'XXXXXXXXXXXXXXXX'.
004200 01  ALPHA-FIELDS.
004300   05  TABNAME            PIC X(18)  VALUE SPACES.
004400   05  CURRENT-DATE.
004500       10  YR             PIC X(2).
004600       10  MO             PIC X(2).
004700       10  DY             PIC X(2).
004800   05  TIME-OF-DAY.
004900       10  HH             PIC X(2).
005000       10  MM             PIC X(2).
005100       10  SS             PIC X(2).
005200       10  CC             PIC X(2).
005300   05  PRINT-DATE         PIC X(8).
005400   05  PRINT-TIME         PIC X(8).
005500 01  ALPHA-LITERALS.
005600   05  DUMMY              PIC X(4)   VALUE SPACES.
005700 01  NUMERIC-FIELDS.
005800   05  GROUP-COUNTER        PIC S9(8) COMP VALUE +0.
005900   05  COUNTER              PIC S9(8)      VALUE +0.
006000   05  PRINT-RC             PIC  9(3).
006100 01  RPT-HEADER1.
006200     10 GRANTOR-H            PIC X(9)  VALUE 'GRANTOR'.
006300     10 GRANTEE-H            PIC X(9)  VALUE 'GRANTEE'.
006400     10 TCREATOR-H           PIC X(8)  VALUE 'CREATOR'.
006500     10 TTNAME-H.
006600        49 TTNAME-LEN-H      PIC S9(4) USAGE COMP.
006700        49 TTNAME-TEXT-H     PIC X(18) VALUE 'TABLENAME'.
006800     10 DATEGRANTED-H        PIC X(6)  VALUE 'DATE'.
006900     10 FILLER               PIC X(8).
007000     10 UPDATECOLS-H         PIC X(9)  VALUE 'COLUMNS'.
007100     10 ALTERAUTH-H          PIC X(9)  VALUE 'ALTER'.
007200     10 DELETEAUTH-H         PIC X(9)  VALUE 'DELETE'.
007300     10 INDEXAUTH-H          PIC X(9)  VALUE 'INDEX'.
007400     10 INSERTAUTH-H         PIC X(9)  VALUE 'INSERT'.
007500     10 SELECTAUTH-H         PIC X(9)  VALUE 'SSELECT'.
007600     10 UPDATEAUTH-H         PIC X(9)  VALUE 'UPDATE'.
007700******************************************************************
007800*    SQLCA INCLUDE                                               *
007900******************************************************************
008000     EXEC SQL INCLUDE SQLCA END-EXEC.
008100******************************************************************
008200*    DCLGEN TABLE(SYSIBM.SYSTABAUTH)                             *
008300******************************************************************
008400     EXEC SQL DECLARE SYSIBM.SYSTABAUTH TABLE
008500     ( GRANTOR                        CHAR(8) NOT NULL,
008600       GRANTEE                        CHAR(8) NOT NULL,
008700       GRANTEETYPE                    CHAR(1) NOT NULL,
008800       DBNAME                         CHAR(8) NOT NULL,
008900       SCREATOR                       CHAR(8) NOT NULL,
009000       STNAME                         VARCHAR(18) NOT NULL,
009100       TCREATOR                       CHAR(8) NOT NULL,
009200       TTNAME                         VARCHAR(18) NOT NULL,
009300       AUTHHOWGOT                     CHAR(1) NOT NULL,
009400       TIMESTAMP                      CHAR(12) NOT NULL,
009500       DATEGRANTED                    CHAR(6) NOT NULL,
009600       TIMEGRANTED                    CHAR(8) NOT NULL,
009700       UPDATECOLS                     CHAR(1) NOT NULL,
009800       ALTERAUTH                      CHAR(1) NOT NULL,
009900       DELETEAUTH                     CHAR(1) NOT NULL,
010000       INDEXAUTH                      CHAR(1) NOT NULL,
010100       INSERTAUTH                     CHAR(1) NOT NULL,
010200       SELECTAUTH                     CHAR(1) NOT NULL,
010300       UPDATEAUTH                     CHAR(1) NOT NULL,
010400       IBMREQD                        CHAR(1) NOT NULL,
010500       GRANTEELOCATION                CHAR(16) NOT NULL,
010600       LOCATION                       CHAR(16) NOT NULL,
010700       COLLID                         CHAR(18) NOT NULL,
010800       CONTOKEN                       CHAR(8) NOT NULL,
010900       CAPTUREAUTH                    CHAR(1) NOT NULL
011000     ) END-EXEC.
011100******************************************************************
011200* COBOL DECLARATION FOR TABLE   SYSIBM.SYSTABAUTH                *
011300******************************************************************
011400 01  DCLSYSTABAUTH.
011500     10 GRANTOR              PIC X(8).
011600     10 GRANTEE              PIC X(8).
011700     10 GRANTEETYPE          PIC X(1).
011800     10 DBNAME               PIC X(8).
011900     10 SCREATOR             PIC X(8).
012000     10 STNAME.
012100        49 STNAME-LEN        PIC S9(4) USAGE COMP.
012200        49 STNAME-TEXT       PIC X(18).
012300     10 TCREATOR             PIC X(8).
012400     10 TTNAME.
012500        49 TTNAME-LEN        PIC S9(4) USAGE COMP.
012600        49 TTNAME-TEXT       PIC X(18).
012700     10 AUTHHOWGOT           PIC X(1).
012800     10 TIMESTAMP            PIC X(12).
012900     10 DATEGRANTED          PIC X(6).
013000     10 TIMEGRANTED          PIC X(8).
013100     10 UPDATECOLS           PIC X(1).
013200     10 ALTERAUTH            PIC X(1).
013300     10 DELETEAUTH           PIC X(1).
013400     10 INDEXAUTH            PIC X(1).
013500     10 INSERTAUTH           PIC X(1).
013600     10 SELECTAUTH           PIC X(1).
013700     10 UPDATEAUTH           PIC X(1).
013800     10 IBMREQD              PIC X(1).
013900     10 GRANTEELOCATION      PIC X(16).
014000     10 LOCATION             PIC X(16).
014100     10 COLLID               PIC X(18).
014200     10 CONTOKEN             PIC X(8).
014300     10 CAPTUREAUTH          PIC X(1).
014400******************************************************************
014500* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 25      *
014600******************************************************************
014700 01  WS-IND.
014800   02  INDY             PIC S9(2)  COMP  OCCURS  25 TIMES.
014900     EXEC SQL DECLARE C1 CURSOR FOR
015000       SELECT
015100       GRANTOR,
015200       GRANTEE,
015300       GRANTEETYPE,
015400       DBNAME,
015500       SCREATOR,
015600       STNAME,
015700       TCREATOR,
015800       TTNAME,
015900       AUTHHOWGOT,
016000       TIMESTAMP,
016100       DATEGRANTED,
016200       TIMEGRANTED,
016300       UPDATECOLS,
016400       ALTERAUTH,
016500       DELETEAUTH,
016600       INDEXAUTH,
016700       INSERTAUTH,
016800       SELECTAUTH,
016900       UPDATEAUTH,
017000       IBMREQD,
017100       GRANTEELOCATION,
017200       LOCATION,
017300       COLLID,
017400       CONTOKEN,
017500       CAPTUREAUTH
017600       FROM SYSIBM.SYSTABAUTH
017700       WHERE TTNAME  = :TABNAME
017800       END-EXEC.
017900 01  WS-END             PIC X(16)  VALUE 'XXXXXXXXXXXXXXXX'.
018000 LINKAGE SECTION.
018100 01  EXEC-PARM.
018200   05  PARM-LENGTH          PIC S9(4) COMP.
018300   05  PARM-DATA            PIC X(18).
018400 PROCEDURE DIVISION USING EXEC-PARM.
018500     DISPLAY 'EXECUTION STARTED'.
018600 SIGNON.
018700     IF PARM-LENGTH LESS THAN 4
018800     THEN GO TO SIGNOFF
018900     ELSE STRING PARM-DATA DELIMITED X'00' INTO TABNAME.
019000     DISPLAY 'TABLE ' TABNAME.
019100     OPEN OUTPUT REPORT-FILE.
019200     ACCEPT CURRENT-DATE FROM DATE.
019300     ACCEPT TIME-OF-DAY FROM TIME.
019400     STRING HH ':' MM ':' SS DELIMITED SIZE INTO PRINT-TIME.
019500     STRING YR '/' MO '/' DY DELIMITED SIZE INTO PRINT-DATE.
019600     EXEC SQL OPEN C1 END-EXEC.
019700     MOVE RPT-HEADER1 TO RPT-HEADINGS.
019800     WRITE RPT-HEADINGS.
019900     MOVE SPACES TO RPT-HEADINGS.
020000     WRITE RPT-HEADINGS.
020100 MAINLINE.
020200     EXEC SQL FETCH C1 INTO :DCLSYSTABAUTH :INDY END-EXEC.
020300     PERFORM PTSQLCA.
020400     IF SQLCODE NOT EQUAL ZERO
020500     THEN GO TO SIGNOFF
020600     END-IF.
020700     MOVE SPACES TO TTNAME-TEXT OF RPTSYSTABAUTH.
020800     MOVE CORRESPONDING DCLSYSTABAUTH TO RPTSYSTABAUTH.
020900     WRITE RPTSYSTABAUTH.
021000     GO TO MAINLINE.
021100 SIGNOFF.
021200     EXEC SQL CLOSE C1 END-EXEC.
021300     MOVE 'LEGEND: G = GRANTABLE, Y = NOT GRANTABLE'
021400          TO RPT-HEADINGS.
021500     WRITE RPT-HEADINGS.
021600     CLOSE REPORT-FILE.
021700     DISPLAY 'EXECUTION COMPLETE'.
021800     GOBACK.
021900 PTSQLCA.
022000     MOVE SQLCODE TO PRINT-RC.
022100     DISPLAY 'RC=' PRINT-RC.
022200 PTSQLCA-EXIT.
022300     EXIT.
022400*END*

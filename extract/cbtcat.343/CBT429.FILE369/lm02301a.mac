*-------     RESTORED BY S.GOLOB - NEWSWEEK INC.
*-------
*------- TITLE LM02301...I/O COUNT  IN MSG IEF285I
*-------
*------- AUTHOR LARRY KRAUSE...LITTON COMPUTER SERVICES 1978
*-------        DICK SZIEDE....GENERAL ELECTRIC 1983
*-------
*------- BACKGROUND AS FAR AS I KNOW,LARRY IS THE ONLY ONE TO
*-------       WRITE A MVS VERSION  OF THIS MOD,  ALTHOUGH IT
*-------       COMMON IN MVT (RICK  DUVALL...CSC) AND SVS (AUTHOR
*-------       UNKNOWN).  THIS VERSION HAS BEEN RECODED IN ASMTOZAP
*-------       FORMAT FOR MVS SP1.3, WITH SOME COSMETIC CHANGES.
*-------       ...DICK SZIEDE...CSC 1982.
*-------       MAKE WORK UNDER VS ASSEMBLER INSTEAD OF ASMH, AND
*-------       MORE COSMETIC CHANGES...DICK SZIEDE, GE 1983.
*-------
*ZAP     CARD ++ USERMOD(LM02301) /* I.O COUNTS IN IEF285I */.
*ZAP     CARD ++ VER(Z038) FMID(EBB1102) PRE(JBB1326).
*ZAP     CARD ++ ZAP (IEFAB4B0).
*ZAP     CARD  NAME IEFAB4B0
*ZAP     CARD  EXPAND IEFAB4B0(128)
LM02301A CSECT
IEFAB4B0 DS    0H
         PRINT ON,GEN,DATA
         ORG   @PSTART
         USING *,@12
         USING @DATD,@11
*ZAP     START VER
         ORG   CLRKEY
         STC   @02,@OLDKEY
         ORG   CLRTXT
         MVC   MSGBUFFR+1(73),MSGBUFFR  BLANK ENTIRE BUFFER
         ORG   STEAL
         MVI   MSGDISP+1,C' '      DISPLACED INSTRUCTION
         ORG   @EL00001
         IC    @02,@OLDKEY
         ORG   @SIZDATD
         DC    AL1(230),AL3(@ENDATD-@DATD)
         ORG   PATCH
         DC    4F'0'
*ZAP     START REP
         ORG   CLRKEY
         STC   @02,@NEWKEY
         ORG   CLRTXT
         MVC   MSGBUFFR+1(78),MSGBUFFR  BLANK ENTIRE BUFFER
         ORG   STEAL
         B     PATCH
MAINLINE EQU   *
         ORG   @EL00001
         IC    @02,@NEWKEY
         ORG   @SIZDATD
         DC    AL1(230),AL3(@NEWDATD-@DATD)
         ORG   PATCH
PATCHOUT MVI   MSGLNGTH+3,79       SET MSGLNGTH TO 79
         L     @10,@PC00001        ADDR OF MSGID
         TM    0(@10),X'01'        MSGID=1 ?
         BNO   PATEXIT                 NO ==> WE EXIT.
         L     @10,4(,@13)         ADDR OF IEFAB4A2'S SAVE AREA
         L     @10,X'3C'(,@10)     IEFAB4A2'S R10
*        ICM   @10,15,X'13C'(@10)  ADDR OF DSAB (IEFAB4A2 DSABPTR
*                                       LEVEL JBB1326)
         ICM   @10,15,X'138'(@10)  ADDR OF DSAB (IEFAB4A2 DSABPTR
*                                   LEVELS UZ75725 AND UZ84610)
         BZ    PATEXIT             EXIT IF NO DSAB
         L     @10,DSABTIOT(,@10)  ADDR OF TIOT ENTRY
         SLR   @06,@06             CLEAR WORK REG
         CH    @06,TIOPSTTB(,@10)  IS THERE A UCB ENTRY IN TIOT?
         BZ    PATEXIT                NO ==> WE QUIT.
         L     @01,@PC00001+16     ADDR OF JSCB PTR
         L     @01,0(,@01)         ADDR OF JSCB
         L     @04,JSCBTCBP(,@01)  ADDR OF INIT'S TCB
         L     @01,JSCTMCOR(,@01)  ADDR OF TIOT MGMT AREA
         S     @10,X'18'(,@01)     CALC TIOT ENTRY OFFSET
         ICM   @04,15,TCBTCT(@04)  ADDR OF TIMING CONTROL TABLE
         BZ    PATEXIT             EXIT IF NONE
         L     @04,TCTIOTBL(,@04)  ADDR OF TCT I/O TABLE
         LA    @05,TCTDCBTD(,@04)  ADDR OF 1ST DD LOOKUP TABLE ENTRY
PATDDLOP CH    @06,0(,@05)         LAST ENTRY IS ZERO
         BZ    PATEXIT                  EXIT IF ZERO.
         CH    @10,0(,@05)         DO THE TIOT DISPLACEMENTS MATCH?
         BE    PATPRINT                 YES ==> PRINT I/O COUNT.
         LA    @05,4(,@05)         BUMP TO NEXT DD TABLE ENTRY
         B     PATDDLOP
         SPACE
PATPRINT AH    @04,TCTIOTSD(,@05)  OFFSET TO THE DEVICE ENTRY
*                                  (TCTDDENT OR TCBUCBP)
         L     @06,TCTDCTR(,@04)   GET THE I/O COUNT
         CVD   @06,MSGDISP+1       INTO PACKED FORMAT
         MVC   MSGCOUNT(L'EDMSK1),EDMSK1 PREPARE TO EDIT
         ED    MSGCOUNT(L'EDMSK1),MSGDISP+5 STICK IN SOME COMMAS
         MVI   MSGCOUNT,C'*'       MARK WITH A SPLAT
PATEXIT  MVI   MSGDISP+1,C' '      DISPLACED INSTRUCTION
         B     MAINLINE
*
EDMSK1   DC    X'60206B2020206B202120'
*ZAP     END
@DATD    DSECT
         ORG   @DATD+X'48'
@PC00001 DS    5F
         ORG   @DATD+X'B4'
MSGLNGTH DS    F
         DS    2F
MSGBUFFR DS    C
         ORG   @DATD+X'F7'
MSGDISP  DS    X
         ORG   @DATD+X'105'
MSGCOUNT DS    CL6
@OLDKEY  DS    AL1
@ENDATD  EQU   *
         ORG   @DATD+X'120'
@NEWKEY  DS    AL1
         DS    D                   ALIGN TO DUBBLEWORD FOR GETMAIN
@NEWDATD EQU   *
         SPACE
LM02301A CSECT
*        ***** EQUATES FOR DSECTS  I'M TOO LAZY TO DO THE DROPS
*        ***** 'N USINGS FOR.
DSABTIOT EQU   X'10'
TIOPSTTB EQU   X'12'
JSCBTCBP EQU   X'D0'                   '
JSCTMCOR EQU   X'14C'                  '
TCBTCT   EQU   X'A4'
TCTIOTBL EQU   X'C'
TCTDCBTD EQU   X'8'
TCTIOTSD EQU   X'2'
TCTDCTR  EQU   X'4'
*
*        ***** EQUATES FOR LOCATIONS WITHIN IEFAB4B0
@PSTART  EQU   IEFAB4B0+X'1C'
CLRKEY   EQU   IEFAB4B0+X'52'
CLRTXT   EQU   IEFAB4B0+X'76'
STEAL    EQU   IEFAB4B0+X'156'
@EL00001 EQU   IEFAB4B0+X'2EE'
@SIZDATD EQU   IEFAB4B0+X'3E8'
PATCH    EQU   IEFAB4B0+X'45C'
*        ***** AND OF COURSE, THE REGISTERS
@01      EQU   01
@02      EQU   02
@04      EQU   04
@05      EQU   05
@06      EQU   06
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
         END

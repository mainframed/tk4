//PDSXBAT  JOB (...),PDSXREF
/*JOBPARM SYSAFF=*
//*---------------------------------------------------------------------
//*   CREATE PDS XREF FILE
//*---------------------------------------------------------------------
//VTOC   EXEC  PGM=IKJEFT01
//SYSPROC  DD  DSN=PDSX.PDSMEM.EXEC,DISP=SHR
//SYSTSPRT DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSOUT   DD  SYSOUT=*
//SYSTSIN  DD  *
 PROFILE NOPREFIX
 DELETE 'PDSX.PDSMEM.TEMP' PURGE
 DELETE 'PDSX.PDSMEM.VTOCOUT.DATAV' PURGE
 ALLOC F(VTOCOUT) DA('PDSX.PDSMEM.VTOCOUT.DATAV') -
                      NEW CAT SP(5 5) TRACKS
 VTOC ALL NOHEADING LIMIT(DSO EQ PO) -
   PRINT(NEW,(DSNAME VOLUME REFDT))
 %VTOCFLTR
//*
//* CREATE MEMBER LIST
//*
//MEMLIST EXEC PGM=PDSMEM1
//STEPLIB DD DSN=...    <=== YOUR STEPLIB GOES HERE
//OUTPUT DD DSN=PDSX.PDSMEM.TEMP,
// DISP=(,CATLG,DELETE),UNIT=WORK,
// SPACE=(TRK,(50,50),RLSE),
// DCB=(RECFM=VB,LRECL=1000,BLKSIZE=20000)
//SYSPRINT DD SYSOUT=*
//VTOCIN DD DSN=PDSX.PDSMEM.VTOCOUT.DATAV,DISP=SHR
//*
//* SORT MEMBER LIST
//*
//SORT     EXEC  PGM=SORT,PARM='SIZE(MAX)'
//SYSOUT   DD    SYSOUT=*
//SORTIN   DD    DSN=PDSX.PDSMEM.TEMP,DISP=SHR
//SORTOUT DD DSN=&&TEMPSORT,
// DISP=(NEW,PASS),UNIT=WORK,
// SPACE=(TRK,(50,50),RLSE),
// DCB=(RECFM=VB,LRECL=1000,BLKSIZE=20000)
//SORTWK01 DD    UNIT=WORK,SPACE=(CYL,(20),RLSE)
//SORTWK02 DD    UNIT=WORK,SPACE=(CYL,(20),RLSE)
//SORTWK03 DD    UNIT=WORK,SPACE=(CYL,(20),RLSE)
//SYSIN    DD    *
   RECORD   TYPE=V
   OMIT     COND=((5,1,EQ,C'M',AND,6,8,LT,C'$       '),
               OR,(5,1,EQ,C'M',AND,6,8,GT,C'Z9999999')),FORMAT=CH
   SORT     FIELDS=(5,17,CH,A)
   SUM      FIELDS=NONE
//*
//* DEFINE CLUSTER AND LOAD
//*
//LOAD EXEC PGM=IDCAMS
//CLUSTER DD DSN=PDSX.PDSMEM.DATAV,DISP=OLD
//SYSPRINT DD SYSOUT=*
//IN DD DSN=&&TEMPSORT,DISP=SHR
//SYSIN DD *
  DELETE (PDSX.PDSMEM.DATAV) -
           PURGE
  SET LASTCC = 0
  SET MAXCC  = 0
  DEF CLUSTER -
      (NAME(PDSX.PDSMEM.DATAV) -
      VOLUMES(*,*) -
      SHR(2 3) -
      CYL(20 1) -
      UNIQUE SPEED)-
    DATA -
      (NAME(PDSX.PDSMEM.DATAV.DATA) -
      RECORDSIZE (20 61) -
      KEYS (17 0) -
      FREESPACE (0 0)) -
    INDEX -
      (NAME(PDSX.PDSMEM.DATAV.INDEX))

 REPRO INFILE(IN) ODS(PDSX.PDSMEM.DATAV)

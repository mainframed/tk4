         MACRO
&NAME    EDIT  &FIELD,&DOIF=FAIL
         COPY  $MGBLDEF
         LCLC  &X,&Y
         AIF   ('&DOIF' EQ 'FAIL' OR '&DOIF' EQ 'PASS').DOIFOK
         MNOTE 12,'''&DOIF'' INVALID - MACRO ABORTED'
         AIF   ('&NAME' EQ '').MEND
&NAME    DC    0H'0'               DEFINE TAG
         MEXIT
.DOIFOK  ANOP
&$MDGLVL SETA  &$MDGLVL+1          UP DO-GROUP LEVEL
&$MDGSEQ(&$MDGLVL) SETC '&SYSNDX'  SET DO-GROUP SEQUENCE
&$MDGNAM(&$MDGLVL) SETC '&NAME'    SET DO-GROUP NAME
&$MIFELS(&$MDGLVL) SETC 'F'
&X       SETC  '&SYSNDX'           SHORTHAND
&Y       SETC  '$MDF&$MDGSEQ(&$MDGLVL)' SHORTHAND
         AIF   ('&NAME' NE '').SKIP07
&$MDGNAM(&$MDGLVL) SETC '$MDG&$MDGSEQ(&$MDGLVL)'
.SKIP07  AIF   ('&DOIF' EQ 'PASS').DOPASS GO IF PASS SPECIFIED
&NAME    ST    R2,$MEDRSV          SAVE R2 (OK TO DESTROY R1?)
         TRT   &FIELD.(L'&FIELD-1),$EDITTB1 ALL BUT LOW ORDER
         L     R2,$MEDRSV          RESTORE R2 - CC IS UNCHANGED
         BC    6,$MDP&X            EXECUTE DO-GROUP IF FAILED
         TRT   &FIELD-1+L'&FIELD.(1),$EDITTB2 LOOK AT LOW ORDER
         L     R2,$MEDRSV          RESTORE R2 - CC IS UNCHANGED
         BC    8,&Y                SKIP DO-GROUP IF PASS
$MDP&X   DC    0H'0'               START PROCESSING DO-GROUP
         AGO   .TEST30
.DOPASS  ANOP                      EXECUTE DO-GROUP IF PASS
&NAME    ST    R2,$MEDRSV          SAVE R2 (OK TO DESTROY R1?)
         TRT   &FIELD.(L'&FIELD-1),$EDITTB1 ALL BUT LOW ORDER
         L     R2,$MEDRSV          RESTORE R2 - CC IS UNCHANGED
         BC    6,&Y                SKIP DO-GROUP IF FAIL
         TRT   &FIELD-1+L'&FIELD.(1),$EDITTB2 LOOK AT LOW ORDER
         L     R2,$MEDRSV          RESTORE R2 - CC IS UNCHANGED
         BC    2,&Y                SKIP DO-GROUP IF FAIL
.TEST30  AIF   (D'$MEDRSV).MEND
         $WA
$MEDRSV  DC    F'0'
$EDITTB1 DC    X'000000000000000000000A0B0C0D0E0F'
         DC    X'000000000000000000001A1B1C1D1E1F'
         DC    X'000000000000000000002A2B2C2D2E2F'
         DC    X'000000000000000000003A3B3C3D3E3F'
         DC    X'000000000000000000004A4B4C4D4E4F'
         DC    X'000000000000000000005A5B5C5D5E5F'
         DC    X'000000000000000000006A6B6C6D6E6F'
         DC    X'000000000000000000007A7B7C7D7E7F'
         DC    X'000000000000000000008A8B8C8D8E8F'
         DC    X'000000000000000000009A9B9C9D9E9F'
         DC    96AL1(*-$EDITTB1)
$EDITTB2 DC    X'010102030405060708090A0B00000E00'
         DC    X'101112131415161718191A1B00001E00'
         DC    X'202122232425262728292A2B00002E00'
         DC    X'303132333435363738393A3B00003E00'
         DC    X'404142434445464748494A4B00004E00'
         DC    X'505152535455565758595A5B00005E00'
         DC    X'606162636465666768696A6B00006E00'
         DC    X'707172737475767778797A7B00007E00'
         DC    X'808182838485868788898A8B00008E00'
         DC    X'909192939495969798999A9B00009E00'
         DC    96AL1(*-$EDITTB2)
         $IA
.MEND    MEND

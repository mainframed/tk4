         MACRO
&NAME    $MENDDO1 &DOGROUP=
         COPY  $MGBLDEF
         LCLA  &J
&$MDGERR SETA  0                   ASSUME NO ERROR
&J       SETA  &$MDGLVL
         AIF   (&J GT 0).OK02
         MNOTE 8,'NO ACTIVE DO-GROUP TO TERMINATE'
         MNOTE 0,' - MACRO GENERATION ABORTED'
&$MDGERR SETA  4                   WARN OTHERS
         MEXIT
.OK02    AIF   ('&DOGROUP' EQ '').SKIP15
         AIF   ('&DOGROUP' NE '*ALL*').TEST10 FALL THROUGH IF *ALL*
&J       SETA  1                   END ALL BUT OUTERMOST DO-GROUP
         AGO   .SKIP20             ENTER COMMON LOOP
.TEST10  AIF   ('&DOGROUP' EQ '&$MDGNAM(&J)').SKIP20
&J       SETA  &J-1
         AIF   (&J GE 1).TEST10
         MNOTE 8,'ATTEMPT TO END NON-EXISTANT DO-GROUP ''&DOGROUP'''
         MNOTE 0,'ALL ACTIVE DO-GROUPS TERMINATED'
&J       SETA  1
         AGO   .SKIP20
.SKIP15  AIF   ('&NAME' EQ '').ENDIT DO NOTHING IF ONLY 1 LEVEL
&NAME    DC    0H'0'               WELL, MAYBE A TAG...
         MEXIT
.SKIP20  AIF   ('&NAME' EQ '').LOOP30
&NAME    DC    0H'0'               DEFINE END OF DO-GROUP
.LOOP30  AIF   (&J GE &$MDGLVL).ENDIT END 1 BEFORE LAST LEVEL
         $MENDDO2                  END 1 LEVEL
         AIF   (&$MDGERR NE 0).ENDIT QUIT IF ERROR OCCURRED
         AIF   (&$MDGLVL LE 1).ENDIT
         AGO   .LOOP30
.ENDIT   MEND

C          DATA SET ANBANLYSIS AT LEVEL 001 AS OF 25/02/76
C   ***********************************
C
C   MAIN ANALYSIS ROUTINE
C
C   ***********************************
      COMMON/OPTION/ISTRM,GRAPH,LIST,ALL,DUMP,TRACE
      REAL*8 KEY1/'GRAPH   '/,KEY2/'LIST    '/
      REAL*8 KEY3/'ALL     '/,KEY4/'DUMP    '/
      REAL*8 KEY5/'TRACE   '/
      REAL*8 KEY6/'NONE    '/
      REAL*8 DATE
      REAL*8 NULL/'        '/
      REAL*8 SELECT/'SELECT= '/
      INTEGER NAME/'MAIN'/,MINT(26)
      INTEGER*4 NAME2/'DATE'/
      LOGICAL SINGLE
      LOGICAL NONE
      LOGICAL TRACE
      LOGICAL DUMP
      LOGICAL ANY,ALL
      LOGICAL GRAPH,LIST
      LOGICAL FIRST
      LOGICAL*1 TIT1(40)
      DATA IEND/'END '/
      DATA MONS/'MONS'/
      DATA MONP/'MONP'/
      DATA MONQ/'MONQ'/
      DATA MONR/'MONR'/
      DATA MONU/'MONU'/
      DATA MONA/'MONA'/,MONZ/'MONZ'/
      DATA MONB/'MONB'/,MONC/'MONC'/,MOND/'MOND'/,MONE/'MONE'/,
     *MONF/'MONF'/,MONG/'MONG'/,MONH/'MONH'/,MONI/'MONI'/,MONJ/'MONJ'/
      DATA MONK/'MONK'/,MONL/'MONL'/,MONM/'MONM'/,MONN/'MONN'/,
     *MONO/'MONO'/,MONT/'MONT'/,MONV/'MONV'/,MONW/'MONW'/,
     *MONX/'MONX'/,MONY/'MONY'/
      DATA LENGTH/26/
C
C   SET UP OPTIONS REQUIRED FOR THIS RUN
C
      FIRST=.TRUE.
      ISTRM=1
      CALL ZA06CS(5,KEY1,GRAPH)
      CALL ZA06CS(4,KEY2,LIST)
      CALL ZA06CS(3,KEY3,ALL)
      CALL ZA06CS(4,KEY4,DUMP)
      CALL ZA06CS(5,KEY5,TRACE)
      CALL ZA06CS(4,KEY6,NONE)
      CALL ZA06AS(7,SELECT,M,IVAL)
      SINGLE=(IVAL.GT.0.AND.IVAL.LE.26.AND.M.NE.0)
      WRITE(6,6000)
 6000 FORMAT('1APEMAN - AERE PERFORMANCE EVALUATION MONITOR',
     *' AND ANALYZER')
      WRITE(8,6000)
      WRITE(6,6030) GRAPH,LIST,ALL,DUMP,TRACE,NONE
 6030 FORMAT(' OPTIONS ARE :',/' GRAPH=',L1,',LIST=',L1,',ALL=',
     *L1,',DUMP=',L1,',TRACE=',L1,',NONE=',L1)
      WRITE(8,6030) GRAPH,LIST,ALL,DUMP,TRACE,NONE
C
C   READ DATE OF RUN FROM LOG
C
      DATE=NULL
      IFLAG=-1
      CALL MONRD(NAME2,2,DATE,IFLAG)
      IF(IFLAG.GT.0) GOTO 99
      IFLAG=0
      CALL MONRD(NAME2,2,DATE,IFLAG)
      IF(IFLAG.GT.0) GOTO 100
      WRITE(6,6040) DATE
 6040 FORMAT(' MONITOR RUN ON ',A8)
      WRITE(8,6040) DATE
  100 CONTINUE
      IF(DUMP) CALL HEXDMP
      IF(ALL) GOTO 20
C
C   FIND ACTIVE MONITORS
C
      DO 200 I=1,26
      MINT(I)=0
  200 CONTINUE
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,MINT,IFLAG)
      IF(IFLAG.GT.0) GOTO 99
      IFLAG=0
      CALL MONRD(NAME,LENGTH,MINT,IFLAG)
      IF(.NOT.NONE) GOTO 201
      DO 202 I=1,26
      MINT(I)=0
  202 CONTINUE
  201 CONTINUE
      IF(SINGLE) MINT(IVAL)=1
      ANY=.FALSE.
      DO 5 I=1,26
      IF(MINT(I).GT.0) ANY=.TRUE.
    5 CONTINUE
      IF(ANY) GOTO 30
   99 CONTINUE
      WRITE(6,6020)
 6020 FORMAT('0NO MONITORS ACTIVE OR NONE SELECTED')
      WRITE(8,6020)
      GOTO 50
   20 CONTINUE
C
C   ALL SELECTED - EVERY ANALYSIS ROUTINE TO BE CALLED
C
      CALL ANLA(MONA,DATE)
      CALL ANLB(MONB,DATE)
      CALL ANLC(MONC,DATE)
      CALL ANLD(MOND,DATE)
      CALL ANLE(MONE,DATE)
      CALL ANLF(MONF,DATE)
      CALL ANLG(MONG,DATE)
      CALL ANLH(MONH,DATE)
      CALL ANLI(MONI,DATE)
      CALL ANLJ(MONJ,DATE)
      CALL ANLK(MONK,DATE)
      CALL ANLL(MONL,DATE)
      CALL ANLM(MONM,DATE)
      CALL ANLN(MONN,DATE)
      CALL ANLO(MONO,DATE)
      CALL ANLP(MONP,DATE)
      CALL ANLQ(MONQ,DATE)
      CALL ANLR(MONR,DATE)
      CALL ANLS(MONS,DATE)
      CALL ANLT(MONT,DATE)
      CALL ANLU(MONU,DATE)
      CALL ANLV(MONV,DATE)
      CALL ANLW(MONW,DATE)
      CALL ANLX(MONX,DATE)
      CALL ANLY(MONY,DATE)
      CALL ANLZ(MONZ,DATE)
      GOTO 50
   30 CONTINUE
C
C   CALL ANALYSIS ROUTINES CORRESPONDING TO ACTIVE MONITORS ONLY
C
      IF(MINT(1).GT.0) CALL ANLA(MONA,DATE)
      IF(MINT(2).GT.0) CALL ANLB(MONB,DATE)
      IF(MINT(3).GT.0) CALL ANLC(MONC,DATE)
      IF(MINT(4).GT.0) CALL ANLD(MOND,DATE)
      IF(MINT(5).GT.0) CALL ANLE(MONE,DATE)
      IF(MINT(6).GT.0) CALL ANLF(MONF,DATE)
      IF(MINT(7).GT.0) CALL ANLG(MONG,DATE)
      IF(MINT(8).GT.0) CALL ANLH(MONH,DATE)
      IF(MINT(9).GT.0) CALL ANLI(MONI,DATE)
      IF(MINT(10).GT.0) CALL ANLJ(MONJ,DATE)
      IF(MINT(11).GT.0) CALL ANLK(MONK,DATE)
      IF(MINT(12).GT.0) CALL ANLL(MONL,DATE)
      IF(MINT(13).GT.0) CALL ANLM(MONM,DATE)
      IF(MINT(14).GT.0) CALL ANLN(MONN,DATE)
      IF(MINT(15).GT.0) CALL ANLO(MONO,DATE)
      IF(MINT(16).GT.0) CALL ANLP(MONP,DATE)
      IF(MINT(17).GT.0) CALL ANLQ(MONQ,DATE)
      IF(MINT(18).GT.0) CALL ANLR(MONR,DATE)
      IF(MINT(19).GT.0) CALL ANLS(MONS,DATE)
      IF(MINT(20).GT.0) CALL ANLT(MONT,DATE)
      IF(MINT(21).GT.0) CALL ANLU(MONU,DATE)
      IF(MINT(22).GT.0) CALL ANLV(MONV,DATE)
      IF(MINT(23).GT.0) CALL ANLW(MONW,DATE)
      IF(MINT(24).GT.0) CALL ANLX(MONX,DATE)
      IF(MINT(25).GT.0) CALL ANLY(MONY,DATE)
      IF(MINT(26).GT.0) CALL ANLZ(MONZ,DATE)
   50 CONTINUE
      WRITE(6,6010)
 6010 FORMAT('0END OF ANALYSIS')
      WRITE(8,6010)
      STOP
      END
      SUBROUTINE MRD(ICT,IBUF,IFL)
      COMMON/OPTION/ISTRM
      DIMENSION IBUF(1000)
      IFL=0
      READ(ISTRM,1000,END=10) IBUF
 1000 FORMAT(4(250A4))
      ICT=1
      RETURN
   10 CONTINUE
      IFL=1
      RETURN
      END
      SUBROUTINE MONRD(NAME,LENGTH,IDATA,IFLAG)
      COMMON/OPTION/ISTRM,IX(4),TRACE
      LOGICAL TRACE
      DIMENSION IBUF(1000),IDATA(LENGTH)
      DATA ICT/1/
      DATA IEND/'END '/
      DATA ITRCT/0/
C
C   IFLAG.LT.0 START OF READING
C   IFLAG.EQ.0 NORMAL
C   IFLAG.EQ.1 EOF
C   IFLAG.GT.1 ERROR RETURN
C
C   LENGTH IS THE MAX LENGTH OF DATA
C
      IF(IFLAG.GE.0) GOTO 10
      REWIND ISTRM
      CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      RETURN
   10 CONTINUE
      IF(ICT.GT.1000) CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      IF(NAME.EQ.IBUF(ICT)) GOTO 20
C
C   SKIP THIS RECORD
C
      IF(IEND.EQ.IBUF(ICT)) GOTO 900
      ICT=ICT+1
      IF(ICT.GT.1000) CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      ILEN=IBUF(ICT)
      ICT=ICT+1
      IF(ILEN.LE.0) GOTO 10
      DO 15 I=1,ILEN
      IF(ICT.GT.1000) CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      ICT=ICT+1
   15 CONTINUE
      GOTO 10
C
C   THIS RECORD WANTED
C
   20 CONTINUE
      ICT=ICT+1
      IF(ICT.GT.1000) CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      IF(LENGTH.LT.IBUF(ICT)) GOTO 999
      ILEN=IBUF(ICT)
      ICT=ICT+1
      IF(LENGTH.LE.0) GOTO 30
      DO 25 I=1,ILEN
      IF(ICT.GT.1000) CALL MRD(ICT,IBUF,IFL)
      IF(IFL.GT.0) GOTO 900
      IDATA(I)=IBUF(ICT)
      ICT=ICT+1
   25 CONTINUE
   30 CONTINUE
C
C   SET MAXIMUM LIMIT OF 1000 RECORDS FOR TRACE
C
      IF(TRACE) ITRCT=ITRCT+1
      IF(ITRCT.GT.1000) TRACE=.FALSE.
      IF(.NOT.TRACE) ITRCT=0
      IF(TRACE) WRITE(6,6010) NAME,ILEN,(IDATA(I),I=1,ILEN)
 6010 FORMAT(1X,A4,1X,I3,10(1X,Z8,1X))
      IFLAG=0
      RETURN
C
C   EOF RETURN
C
  900 CONTINUE
      IFLAG=1
      RETURN
C
C   ERROR RETURN
C
  999 CONTINUE
      IFLAG=2
      WRITE(6,6000) LENGTH,IBUF(ICT)
 6000 FORMAT(' INCORRECT LENGTH IN RECORD',2I5)
      RETURN
      END
      SUBROUTINE HEXDMP
      COMMON/OPTION/ISTRM
      DIMENSION IBUF(1000)
C
C   HEX DUMP ROUTINE
C
      REWIND ISTRM
      WRITE(6,6000)
 6000 FORMAT('1 HEX DUMP OPTION')
   20 CONTINUE
      READ(ISTRM,1000,END=10) IBUF
 1000 FORMAT(4(250A4))
      WRITE(6,6010) IBUF
 6010 FORMAT((5(1X,Z8,1X),3X,5(1X,Z8,1X)))
      GOTO 20
   10 CONTINUE
      RETURN
      END
      SUBROUTINE ANLP(NAME,DATE)
      COMMON/OPTION/ISTRM,GRAPH,LIST
      DIMENSION IDATA(7)
      REAL*8 VIO/'*VIO    '/
      REAL*8 DATE
      REAL*8 MODL(10)
      REAL*8 MODT
      REAL*8 MODULE(1000),NULL/'        '/
      INTEGER LIMSKS(7)
      INTEGER IFLGS(425),IT4,TYPE,ASID,FLAGS
      INTEGER VBMAX,VBMIN,VBSTEP
      INTEGER*2 NT2(2),IVBN(425),IFIX(425)
      INTEGER*2 IT2(2),IDAT(14),VBN,FIX
      INTEGER*2 IG2,NG2,ANAX(11)
      REAL COUNT(1000)
      REAL*8 JOBNAM,IJOB
      REAL TOTALS(7)
      INTEGER ICNTS(7)
      LOGICAL LFLAGS/Z8000FF00/
      LOGICAL GRAPH,LIST
      LOGICAL PMSK(425),LMSKS(7)
      LOGICAL PLOT/.TRUE./,ILG,MSKS(4),ANY,FIRST/.TRUE./,PAGE/.FALSE./
      LOGICAL*1 INDIC(1000),BLNK/' '/,AST/'*'/,LINE(100)
      LOGICAL*1 MINUS/'-'/
      LOGICAL*1 LTIME(4),LTTIME(4)
      LOGICAL*1 PLINE(110),NOS(16)
      LOGICAL*1 IG1(2),NG1(2)
      DATA NOS/'FEDCBA987654321 '/
      EQUIVALENCE(LTIME(1),TIME),(LTTIME(1),TTIME)
      EQUIVALENCE(ITMP,ILG),(NT2(1),NT4),(IT2(1),IT4)
      EQUIVALENCE(IDATA(1),IDAT(1)),(IDATA(1),TIME),(IDATA(2),TYPE),
     *(IDATA(3),JOBNAM),(IDATA(5),ASID),(IDAT(11),VBN),(IDAT(12),FIX),
     *(IDATA(7),FLAGS)
      EQUIVALENCE(PMSK(1),IFLGS(1)),(LIMSKS(1),LMSKS(1))
      EQUIVALENCE(IG2,IG1(1)),(NG2,NG1(1))
      DATA ITOP/Z0000B000/
      DATA MSKS/Z0000F000,Z00000F00,Z000000F0,Z0000000F/
      DATA LMSKS/Z0000FF00,Z00008400,Z00008000,Z00000C00,
     *Z00000800,Z00000400,Z80000000/
      DATA LENGTH/7/
C
C   ROUTINE WRITES OUT RECORDS WRITTEN BY MONP
C
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      WRITE(6,6100)
 6100 FORMAT('1MVS PAGING ANALYSIS')
      WRITE(6,6101)
 6101 FORMAT(' --- ------ --------',/,1X)
      IFLAG=0
  100 CONTINUE
C   ***********************************
C
C   WRITE OUT TYPE 0 RECORDS - JOBNAME NOT FOUND
C
C   ***********************************
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 199
      IF(TYPE.NE.0) GOTO 100
      WRITE(6,6300) LTIME,JOBNAM
 6300 FORMAT(3X,3(Z2,'.'),Z2,'   PROGRAM ',A8,' WAS NOT FOUND')
      GOTO 100
  199 CONTINUE
C   ***********************************
C
C   WRITE OUT TYPE 1 RECORDS - PFTE'S
C
C   ***********************************
      IASNXT=-1
  400 CONTINUE
      IASID=IASNXT
      IF(IASID.EQ.-2) GOTO 99
      IASNXT=-2
      IF(IASID.EQ.-1) IASNXT=0
      PLOT=.TRUE.
      XMIN=0.
      ANY=.FALSE.
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      IFLAG=0
  410 CONTINUE
C
C   FIND MAX AND MIN VBN'S
C
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 420
      IF(TYPE.NE.1) GOTO 410
      IF(IASNXT.EQ.-2.AND.ASID.GT.IASID) IASNXT=ASID
      IF(ASID.LT.IASNXT.AND.ASID.GT.IASID) IASNXT=ASID
      IF(IASID.EQ.0.AND.JOBNAM.EQ.VIO) GOTO 411
      IF(ASID.NE.IASID) GOTO 410
  411 CONTINUE
      IT2(1)=0
      IT2(2)=VBN
      IF(IASID.GE.0.AND.IT4.GT.ITOP) GOTO 410
      IF(ANY) GOTO 430
      VBMAX=IT4
      VBMIN=IT4
      ANY=.TRUE.
  430 CONTINUE
      IF(VBMAX.LT.IT4) VBMAX=IT4
      IF(VBMIN.GT.IT4) VBMIN=IT4
      GOTO 410
  420 CONTINUE
      IF(.NOT.ANY) GOTO 400
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      IFLAG=0
C
C   SET COUNTERS TO ZREO
C
      IPGCT=0
      NCALLS=0
      DO 412 I=1,7
      TOTALS(I)=0.
      ICNTS(I)=0
      INDIC(I)=BLNK
      COUNT(I)=0.
  440 CONTINUE
      IF(IASID.EQ.-1) CALL MAPLPA(MODULE,INDIC,VBMIN)
      IF(.NOT.LIST) WRITE(6,6102)
      FIRST=.TRUE.
  300 CONTINUE
C
C   WRITE OUT PFTE AT ANY ONE TIME
C
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 310
      IF(TYPE.NE.1) GOTO 300
      IF(IASID.EQ.0.AND.JOBNAM.EQ.VIO) GOTO 301
      IF(ASID.NE.IASID) GOTO 300
  301 CONTINUE
      IF(.NOT.FIRST) GOTO 303
C
C   SET UP FOR FIRST PFTE
C
      IJOB=JOBNAM
      TTIME=TIME
      FIRST=.FALSE.
  303 CONTINUE
      IF(TTIME.NE.TIME) GOTO 310
  305 CONTINUE
      IPGCT=IPGCT+1
      IVBN(IPGCT)=VBN
      IFIX(IPGCT)=FIX
      IFLGS(IPGCT)=FLAGS
      GOTO 300
  310 CONTINUE
      NCALLS=NCALLS+1
C
C   NEW ASID - SORT AND WRITE/PLOT
C
      DO 320 I=1,IPGCT
      DO 330 J=I,IPGCT
      IT2(1)=0
      NT2(1)=0
      IT2(2)=IVBN(I)
      NT2(2)=IVBN(J)
      IF(IT4.LT.NT4) GOTO 330
      IT2(2)=IVBN(I)
      IVBN(I)=IVBN(J)
      IVBN(J)=IT2(2)
      IT2(2)=IFIX(I)
      IFIX(I)=IFIX(J)
      IFIX(J)=IT2(2)
      IT4=IFLGS(I)
      IFLGS(I)=IFLGS(J)
      IFLGS(J)=IT4
  330 CONTINUE
  320 CONTINUE
      IT2(1)=0
C
C   INCREMENT COU T FOR HISTOGRAM
C
      DO 309 I=1,IPGCT
      IT2(2)=IVBN(I)
      IMOD=IT4/16-VBMIN+1
      IF(IMOD.GT.1000) GOTO 309
      COUNT(IMOD)=COUNT(IMOD)+1.
  309 CONTINUE
      IPCT=1
      PAGE=.TRUE.
      DO 500 I=1,IPGCT
      IF(.NOT.LIST) GOTO 520
      IF(.NOT.PAGE) GOTO 510
C
C   WRITE OUT FULL LIST OF PFTE'S
C
      WRITE(6,6102)
 6102 FORMAT(1H1)
      WRITE(6,6105)IPCT
 6105 FORMAT('  TYPE     TIME      JOBNAME  ASID  VBN  FIX   FLAGS',
     *45X,'PAGE ',I3)
      WRITE(6,6106)
 6106 FORMAT('  ----     ----      -------  ----  ---  ---   -----',
     *45X,'--------',/,1X)
      IPCT=IPCT+1
      PAGE=.FALSE.
  510 CONTINUE
      WRITE(6,6000)TYPE,LTTIME,IJOB,IASID,IVBN(I),IFIX(I),IFLGS(I)
 6000 FORMAT(3X,I2,3X,3(Z2,'.'),Z2,2X,A8,2X,I2,2X,Z4,2X,I2,3X,Z8)
  520 CONTINUE
C
C   CHECK FOR TYPE OF PFTE
C
      DO 700 J=1,7
      ILG=PMSK(I).AND.LFLAGS
      IF(ITMP.NE.LIMSKS(J)) GOTO 700
      ICNTS(J)=ICNTS(J)+1
      IF(.NOT.LIST) GOTO 700
      IF(J.EQ.1) WRITE(6,6501)
 6501 FORMAT('+',65X,'NOT QUEUED')
      IF(J.EQ.2) WRITE(6,6502)
 6502 FORMAT('+',65X,'LSQA')
      IF(J.EQ.3) WRITE(6,6503)
 6503 FORMAT('+',65X,'LOCAL')
      IF(J.EQ.4) WRITE(6,6504)
 6504 FORMAT('+',65X,'SQA')
      IF(J.EQ.5) WRITE(6,6505)
 6505 FORMAT('+',65X,'COMMON')
      IF(J.EQ.6) WRITE(6,6506)
 6506 FORMAT('+',65X,'SQA RESERVED')
      IF(J.EQ.7) WRITE(6,6507)
 6507 FORMAT('+',65X,'AVAILABLE')
  700 CONTINUE
      IF(MOD(I,36).EQ.0) PAGE=.TRUE.
      IF(IASID.NE.-1) GOTO 500
      IF(.NOT.LIST) GOTO 500
      IT4=0
      IT2(2)=IVBN(I)
      IMOD=IT4/16-VBMIN+1
      IF(IMOD.GT.1000) GOTO 500
      WRITE(6,6022) MODULE(IMOD)
 6022 FORMAT('+',55X,A8)
  500 CONTINUE
C
C   WRITE OUT SUMMARY
C
      WRITE(6,6020) LTTIME,IJOB,IASID
 6020 FORMAT(1X,/,3X,3(Z2,'.'),Z2,3X,A8,'   ASID=',I3)
      WRITE(6,6021) ICNTS,IPGCT
 6021 FORMAT(' BAD PAGES',11X,I3,7X,'LSQA PAGES',10X,I3,7X,
     *'LOCAL PAGES',9X,I3,7X,'SQA PAGES',11X,I3,/,' COMMON PAGES',
     *8X,I3,7X,'SQA RESERVED',8X,I3,7X,'AVAILABLE PAGES',5X,I3,7X,
     *'TOTAL PAGES',9X,I3)
      IF(IASID.NE.-1) GOTO 504
      MODT=NULL
      WRITE(6,6023)
 6023 FORMAT(' MODULES PRESENT -')
      LCT=1
      DO 503 I=1,IPGCT
      IT4=0
      IT2(2)=IVBN(I)
      IMOD=IT4/16-VBMIN+1
      IF(IMOD.GT.1000.OR.IMOD.LE.0) GOTO 503
      IF(MODULE(IMOD).EQ.MODT.OR.MODULE(IMOD).EQ.NULL) GOTO 503
      MODT=MODULE(IMOD)
      MODL(LCT)=MODT
      LCT=LCT+1
      IF(LCT.LE.10) GOTO 503
      WRITE(6,6024) MODL
 6024 FORMAT(1X,10(A8,','))
      LCT=1
  503 CONTINUE
      LCT=LCT-1
      IF(LCT.EQ.0) GOTO 504
      WRITE(6,6024) (MODL(I),I=1,LCT)
  504 CONTINUE
C
C   INCREMENT COUNTERS
C
      DO 501 I=1,7
      TOTALS(I)=TOTALS(I)+ICNTS(I)
  501 CONTINUE
      TOTPGC=TOTPGC+IPGCT
      IF(.NOT.GRAPH) GOTO 530
      IF(.NOT.PLOT) GOTO 340
      PLOT=.FALSE.
C
C   DRAW AXIS
C
      WRITE(7,9002) DATE,IJOB,IASID
 9002 FORMAT('1PAGE FRAMES ON ',A8,5X,A8,3X,'ASID = ',I3)
      IVBMAX=VBMIN+109
      IF((VBMAX-VBMIN).LT.109) GOTO 336
      IVBMAX=((VBMAX-VBMIN+1)/110+1)*110+VBMIN-1
  336 CONTINUE
      INCR=(IVBMAX-VBMIN+1)/10
      NT4=VBMIN
      DO 337 J=1,11
      ANAX(J)=NT2(2)
      NT4=NT4+INCR
  337 CONTINUE
      WRITE(7,9000) ANAX
 9000 FORMAT('0    TIME    ',Z3,10(8X,Z3))
      WRITE(7,9001)
 9001 FORMAT(1X,13('-'),'+',10(10('-'),'+'))
      LNCNT=4
  340 CONTINUE
C
C   INITIALIZE PLINE WITH .
C
      DO 339 I=1,110
      PLINE(I)=NOS(16)
  339 CONTINUE
      DO 380 I=1,IPGCT
      NT2(1)=0
      NT2(2)=IVBN(I)
      RTEMP=IVBMAX-VBMIN
      RTEMP=(NT4/16-VBMIN)/RTEMP
      NT4=RTEMP*109.+1.
      IF(NT4.GT.110.OR.NT4.LE.0) GOTO 380
      DO 338 J=2,16
      IG2=0
      NG2=0
      IG1(2)=PLINE(NT4)
      NG1(2)=NOS(J)
      IF(IG2.NE.NG2) GOTO 338
      PLINE(NT4)=NOS(J-1)
      GOTO 380
  338 CONTINUE
  380 CONTINUE
      WRITE(7,9003) LTTIME,PLINE
 9003 FORMAT(1X,3(Z2,'.'),Z2,' ×',110A1)
      LNCNT=LNCNT+1
      IF(LNCNT.GE.43) PLOT=.TRUE.
  530 CONTINUE
      IF(IFLAG.GT.0) GOTO 399
      TTIME=TIME
      IPGCT=0
      DO 502 I=1,7
      ICNTS(I)=0
  502 CONTINUE
      GOTO 305
C
C   END OF DATA FOR ASID - WRITE OUT AVERAGES
C
  399 CONTINUE
      WRITE(6,6400) IJOB,IASID
 6400 FORMAT('1 AVERAGE PAGES FOR ',A8,'   ASID=',I3)
      TOTPGC=TOTPGC/NCALLS
      DO 701 I=1,7
      TOTALS(I)=TOTALS(I)/NCALLS
  701 CONTINUE
      WRITE(6,6401) TOTALS,TOTPGC
 6401 FORMAT(' BAD PAGES',11X,F5.1,5X,'LSQA PAGES',10X,F5.1,5X,
     *'LOCAL PAGES',9X,F5.1,5X,'SQA PAGES',11X,F5.1,/,' COMMON PAGES',
     *8X,F5.1,5X,'SQA RESERVED',8X,F5.1,5X,'AVAILABLE PAGES',5X,
     *F5.1,5X,'TOTAL PAGES',9X,F5.1)
      WRITE(8,8000) IJOB,IASID
 8000 FORMAT('0AVERAGE PAGES FOR ',A8,'    ASID=',I3)
      WRITE(8,6401) TOTALS,TOTPGC
      IF(.NOT.GRAPH) GOTO 400
C
C   PLOT HISTOGRAM
C
      IPCT=1
      PAGE=.TRUE.
      NCT=1
      IMAX=VBMAX-VBMIN+1
      IF(IMAX.GT.1000) IMAX=1000
  600 CONTINUE
      IF(.NOT.PAGE) GOTO 610
      IF(NCT.GT.IMAX) GOTO 630
      IEND=NCT+40
      IF(IEND.GT.IMAX) IEND=IMAX
      ANY=.FALSE.
      DO 609 I=NCT,IEND
      IF(COUNT(I).NE.0.) ANY=.TRUE.
  609 CONTINUE
      IF(ANY) GOTO 608
      ISTRT=NCT+VBMIN-1
      IEND=IEND+VBMIN-1
      WRITE(7,6415) IJOB,IASID,ISTRT,IEND
 6415 FORMAT('0',A8,'   ASID=',I3,' - VBN ',Z3,' TO ',Z3,
     *' WERE NOT REFERENCED')
      NCT=NCT+41
      IF(NCT.GT.IMAX) GOTO 630
      IPCT=IPCT+1
      GOTO 600
  608 CONTINUE
C
C   WRITE HEADINGS
C
      WRITE(7,6410) IJOB,IASID,IPCT
 6410 FORMAT('1',A8,'   ASID=',I3,45X,'PAGE ',I3)
      WRITE(7,6420)
 6420 FORMAT(' MODULE   CONT  PERCENT  BLOCK 0',8X,'10',8X,'20',
     *8X,'30',8X,'40',8X,'50',8X,'60',8X,'70',8X,'80',8X,'90',8X,'100')
      WRITE(7,6430) (MINUS,I=1,132)
 6430 FORMAT(1X,132A1)
      IPCT=IPCT+1
      PAGE=.FALSE.
      LCT=0
  610 CONTINUE
      IMOD=VBMIN+NCT-1
      RCOUNT=COUNT(NCT)/NCALLS*100.
      DO 620 I=1,100
      LINE(I)=BLNK
      X=I
      IF(X.LE.RCOUNT) LINE(I)=AST
  620 CONTINUE
      WRITE(7,6440) MODULE(NCT),INDIC(NCT),RCOUNT,IMOD,LINE
 6440 FORMAT(1X,A8,3X,A1,3X,F7.3,3X,Z3,2X,'×',100A1)
      NCT=NCT+1
      IF(NCT.GT.IMAX) GOTO 630
      LCT=LCT+1
      IF(LCT.GT.40) PAGE=.TRUE.
      GOTO 600
  630 CONTINUE
      GOTO 400
   99 CONTINUE
C   ***********************************
C
C
C   WRITE OUT TYPE 2 RECORDS - JOBNAME/ASID
C
C   ***********************************
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      IFLAG=0
      FIRST=.TRUE.
  200 CONTINUE
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 900
      IF(TYPE.NE.2) GOTO 200
      IF(.NOT.FIRST.AND.TIME.EQ.TTIME) GOTO 210
      IF(FIRST) WRITE(6,6102)
      TTIME=TIME
      FIRST=.FALSE.
      WRITE(6,6200) LTTIME
 6200 FORMAT(//,3X,3(Z2,'.'),Z2,'   JOBNAME  ASID')
      WRITE(6,6210)
 6210 FORMAT('   -----------   -------  ----',/,1X)
  210 CONTINUE
      WRITE(6,6220) JOBNAM,ASID
 6220 FORMAT(17X,A8,2X,I3)
      GOTO 200
  900 CONTINUE
      WRITE(6,6030)
 6030 FORMAT(1X,/,' END OF PAGING ANALYSIS')
      WRITE(8,6030)
  999 RETURN
      END
      SUBROUTINE MAPLPA(MODULE,INDIC,IMIN)
      REAL*8 MODULE(1000),NAME(2),NULL/'        '/
      INTEGER LOC(2),LEN(2)
      LOGICAL*1 INDIC(1000),AST/'*'/,LTEST(2),LTST(2)
      INTEGER*2 ITEST,ONE/' 1'/,NUM/' N'/,BLNK/'  '/,ITST
      EQUIVALENCE(ITEST,LTEST(1)),(ITST,LTST(1))
C
C   ROUTINE READS IN MODULE NAMES FROM STREAMS 10 AND 11
C   AND PLACES THEM IN MODULE . INDIC=* IF MORE THAN ONE MODULE/PFTE
C
   20 CONTINUE
      ITST=BLNK
      ITEST=BLNK
      READ(10,1000,END=10) LTEST(2),LTST(2)
 1000 FORMAT(A1,30X,A1)
      IF(ITEST.NE.ONE.OR.ITST.NE.NUM) GOTO 20
C
C   BEGINNING OF NUMERICAL LPA MAP
C
   30 CONTINUE
      READ(10,1010,END=10) LTEST(2)
 1010 FORMAT(A1)
      IF(ITEST.NE.BLNK) GOTO 30
      BACKSPACE 10
      READ(10,1011,END=10) (NAME(I),LOC(I),LEN(I),I=1,2)
 1011 FORMAT(1X,A8,1X,Z3,7X,Z3,38X,A8,1X,Z3,7X,Z3)
      DO 40 I=1,2
      IF(NAME(I).EQ.NULL) GOTO 40
      IT=LOC(I)-IMIN+1
      IF(IT.GT.1000.OR.IT.LE.0) GOTO 40
      IEND=IT+LEN(I)-1
      IF(IEND.LT.IT) IEND=IT
      DO 35 J=IT,IEND
      IF(MODULE(J).NE.NULL) INDIC(J)=AST
      IF(MODULE(J).EQ.NULL) MODULE(J)=NAME(I)
   35 CONTINUE
   40 CONTINUE
      GOTO 30
   10 CONTINUE
C
C   END OF LPA DATA
C
      READ(11,1100,END=11) NAME(1),LOC(1),LEN(1)
 1100 FORMAT(A8,1X,Z3,1X,Z3)
      IT=LOC(1)-IMIN+1
      IF(IT.GT.1000.OR.IT.LE.0) GOTO 10
      IEND=IT+LEN(1)-1
      IF(IEND.LT.IT) IEND=IT
      DO 50 J=IT,IEND
      IF(MODULE(J).NE.NULL) INDIC(J)=AST
      IF(MODULE(J).EQ.NULL) MODULE(J)=NAME(1)
   50 CONTINUE
      GOTO 10
   11 CONTINUE
C
C   END OF MLPA DATA
C
      NAME(1)=MODULE(1)
      DO 60 I=2,1000
      IF(MODULE(I).EQ.NULL) MODULE(I)=NAME(1)
      NAME(1)=MODULE(I)
   60 CONTINUE
      RETURN
      END
      SUBROUTINE ANLQ(NAME,DATE)
C   ***********************************
C
C   ROUTINE FORMATS QCB TRACE
C
C   ************************************
      REAL*8 MAJOR,BLNK/'        '/,MAJ,MINOR(6),MIN(6),
      LOGICAL*1 NEWL
C
      EQUIVALENCE(TTIME,LTTIME(1)),(TIME,IDATA(1)),
     *(MAJOR,IDATA(3)),(TYPE,IDATA(2)),(MINOR(1),IDATA(5))
      EQUIVALENCE(LT4,LT1(1)),(LT4,LT),(LT4,LT2(1))
C
C   REWIND LOG
C
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      WRITE(6,6100) DATE
 6100 FORMAT('1QCB ANALYSIS ON ',A8)
C
  100 CONTINUE
      IFLAG=0
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 200
      IF(FIRST) GOTO 10
      IF(TTIME.EQ.TIME) GOTO 5
   10 CONTINUE
C   NEW TIME - WRITE HEADER
      TTIME=TIME
      WRITE(6,6010) LTTIME,DATE
 6010 FORMAT('0ENQS AT ',3(Z2,'.'),Z2,' ON ',A8)
      WRITE(6,6030)
      FIRST=.FALSE.
      NEWL=.TRUE.
      GOTO 16
    5 CONTINUE
C
C   CHECK FOR NEW MAJORNAME
C
      NEWL=.TRUE.
      IF(MAJOR.EQ.MAJ) GOTO 15
   16 CONTINUE
C
C   NEW MAJORNAME
C
      MAJ=MAJOR
      WRITE(6,6020) MAJ
 6020 FORMAT(1X,A8)
      NEWL=.FALSE.
      IF(TYPE.EQ.1) GOTO 100
      GOTO 21
   15 CONTINUE
C
C   CHECK FOR NEW MINORNAME
C
      DO 20 I=1,6
      IF(MINOR(I).NE.MIN(I)) GOTO 21
   20 CONTINUE
      IF(TYPE.EQ.2) GOTO 100
      GOTO 30
   21 CONTINUE
C
C   NEW MINORNAME
C
      IF(NEWL) WRITE(6,6030)
      NEWL=.FALSE.
      SCOPE=BLNK
      LT4=IDATA(17)
      ASID=LT2(2)
      LT=LT.AND.MSK
      LT2(1)=LT2(1)/16
      IF(LT2(1).EQ.8) SCOPE=SYSTEM
      IF(LT2(1).EQ.4) SCOPE=SYSTES
      IF(LT2(1).EQ.2) SCOPE=STEP
      IF(LT2(1).EQ.1) SCOPE=NOENQS
      DO 22 I=1,6
      MIN(I)=MINOR(I)
   22 CONTINUE
      WRITE(6,6040) MIN,SCOPE
 6040 FORMAT('+',10X,6A8,1X,A8)
      IF(SCOPE.EQ.STEP) WRITE(6,6041) ASID,IDATA(23),IDATA(24)
 6041 FORMAT('+',67X,I3,3X,2A4)
      IF(TYPE.EQ.2) GOTO 100
   30 CONTINUE
C
C   NEW QEL
C
      IF(NEWL) WRITE(6,6030)
 6030 FORMAT(1X)
      WRITE(6,6050) IDATA(18)
 6050 FORMAT('+',71X,Z8)
      LT4=IDATA(19)
      ASID=LT2(2)
      LT2(2)=LT2(1)
      DO 40 I=1,4
      LT2(1)=0
      LT4=LT4*2
      IF(I.EQ.1.AND.LT2(1).EQ.0) WRITE(6,6052)
 6052 FORMAT('+',80X,'EXCL')
      IF(LT2(1).EQ.0) GOTO 40
      IF(I.EQ.1) WRITE(6,6051)
 6051 FORMAT('+',80X,'SHR')
      IF(I.EQ.2) WRITE(6,6053)
 6053 FORMAT('+',85X,'MC')
      IF(I.EQ.4) WRITE(6,6054)
 6054 FORMAT('+',88X,'RES')
   40 CONTINUE
      LT4=LT4*16
      LT2(1)=0
      LT4=LT4*4
      IF(LT2(1).EQ.3) WRITE(6,6055)
 6055 FORMAT('+',92X,'ECB')
      IF(LT2(1).EQ.2) WRITE(6,6056)
 6056 FORMAT('+',92X,'RB')
      WRITE(6,6057) ASID,IDATA(23),IDATA(24)
 6057 FORMAT('+',96X,I3,3X,2A4)
      GOTO 100
  200 CONTINUE
C
C   EOF FOUND
C
      IF(FIRST) GOTO 999
      WRITE(6,6999)
 6999 FORMAT('0END OF ENQ TRACE')
  999 CONTINUE
      RETURN
      END
      SUBROUTINE ANLR(NAME,DATE)
C   ***********************************
C
C   ROUTINE ANALYSES SRM CONTROL BLOCKS
C
C   ***********************************
      REAL*8 DATE
      INTEGER IDATA(180),LENGTH/180/,IT4,BSRM
      INTEGER*4 PVT4(10),CCC4(19),ICC4(16),MCC4(20),RMPT4(24)
      INTEGER*4 BTOD,CCT4(13),ICT4(6),MCT4(18),RMCA4(44),RLCT4(9)
      INTEGER*2 IT2(2),NBIT,RLCT(18),CCT(26),ICT(12),MCT(18),RMCA(90)
      INTEGER*2 CCC(38),ICC(32),MCC(40),RMPT(48),LCHUSE(4,3),LCH(4)
      INTEGER*2 PVT(20)
      LOGICAL*1 LTTIME(4),FIRST/.TRUE./,LTEMP(4)
C
      EQUIVALENCE(IT4,IT2(1)),(PVT4(1),PVT(1))
      EQUIVALENCE(CCT(1),CCT4(1)),(ICT(1),ICT4(1)),(MCT(1),MCT4(1)),
     *(RMCA(1),RMCA4(1)),(RLCT(1),RLCT4(1))
      EQUIVALENCE(CCC(1),CCC4(1)),(ICC(1),ICC4(1)),
     *(MCC(1),MCC4(1)),(RMPT(1),RMPT4(1))
      EQUIVALENCE(IDATA(1),LTTIME(1)),(IDATA(2),CCT(1)),
     *(IDATA(15),ICT(1)),(IDATA(21),MCT(1)),(IDATA(39),RMCA(1)),
     *(IDATA(81),RLCT(1)),(IDATA(90),BTOD),(IDATA(91),BSRM),
     *(IDATA(121),ICC(1)),(IDATA(137),MCC(1)),(IDATA(102),CCC(1)),
     *(IDATA(157),RMPT(1)),(IDATA(92),PVT(1))
      EQUIVALENCE(RTEMP,LTEMP(1))
C
      COMMON/SRMTIM/BASE
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      AVRCPU=0.
      AVRWKL=0.
      AVRLCH=0.
      AVRAVQ=0.
      AVRSWP=0.
      NCALLS=0
  100 CONTINUE
      IFLAG=0
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 200
      NCALLS=NCALLS+1
      IF(.NOT.FIRST) GOTO 5
C
C   WRITE OUT CONSTANTS FROM CCT,ICT,MCT,RMPT
      FIRST=.FALSE.
      WRITE(6,6100) LTTIME,DATE
 6100 FORMAT('1SRM CONTROL CONSTANTS AT ',3(Z2,'.'),Z2,' ON ',A8)
      CALL DECVB(IDATA(1),LAST)
      DO 150 I=1,4
      LCHUSE(I,1)=RMCA(I*4+66)
      LCHUSE(I,2)=RMCA(I*4+67)
      LCHUSE(I,3)=RMCA(I*4+68)
      LCH(I)=RMCA(I*4+66)
  150 CONTINUE
      NTIME=LAST
      WRITE(6,6101)
 6101 FORMAT(46X,'CPU CONTROL CONSTANTS (CCT)',/)
      WRITE(6,6102)
 6102 FORMAT(' MINIMUM APG INVOCATION INTERVAL')
      RTEMP=CITIME(CCC4(3))
      WRITE(6,6003) RTEMP
      WRITE(6,6103)
 6103 FORMAT('+',60X,'MAXIMUM APG INVOCATION INTERVAL')
      RTEMP=CITIME(CCC4(4))
      WRITE(6,6004) RTEMP
      WRITE(6,6104)
 6104 FORMAT(' DELTA FOR CHANGING APG INTERVAL')
      RTEMP=CITIME(CCC4(2))
      WRITE(6,6003) RTEMP
      WRITE(6,6106)
 6106 FORMAT(' MINIMUM TIME IN STORE BEFORE SWAP OUT')
      RTEMP=CITIME(CCC4(6))
      WRITE(6,6003) RTEMP
      WRITE(6,6107)
 6107 FORMAT('+',60X,'MINIMUM INTERVAL FOR CPU UTILIZATION')
      RTEMP=CITIME(CCC4(7))
      WRITE(6,6004) RTEMP
      WRITE(6,6108)
 6108 FORMAT(' % APG USERS CHAPPED LOW THRESHOLD')
      WRITE(6,6001) CCC(24)
      WRITE(6,6109)
 6109 FORMAT('+',60X,'% APG USERS CHAPPED HIGH THRESHOLD')
      WRITE(6,6002) CCC(25)
      WRITE(6,6110)
 6110 FORMAT(' HIGH CPU UTILIZATION IMBALANCE THRESHOLD')
      WRITE(6,6001) CCC(26)
      WRITE(6,6111)
 6111 FORMAT('+',60X,'LOW CPU UTILIZATION IMBALANCE THRESHOLD')
      WRITE(6,6002) CCC(27)
      WRITE(6,6112)
 6112 FORMAT(' SIGNIFICANT CPU USER D PRIORITY')
      WRITE(6,6001) CCC(33)
      WRITE(6,6113)
 6113 FORMAT('+',60X,'SIGNIFICANT MEAN TIME TO WAIT')
      WRITE(6,6002) CCC(34)
C
      WRITE(6,6120)
 6120 FORMAT(/,46X,'I/O CONTROL CONSTANTS (ICT)',/)
      WRITE(6,6121)
 6121 FORMAT(' MINIMUM INTERVAL FOR LCH UTILIZATION')
      RTEMP=CITIME(ICC4(2))
      WRITE(6,6003) RTEMP
      WRITE(6,6122)
 6122 FORMAT('+',60X,'MAX TIME WITHOUT I/O MONITORING')
      RTEMP=CITIME(ICC4(3))
      WRITE(6,6004) RTEMP
      WRITE(6,6123)
 6123 FORMAT(' MINIMUM INTERVAL FOR I/O MONITORING')
      RTEMP=CITIME(ICC4(4))
      WRITE(6,6003) RTEMP
      WRITE(6,6124)
 6124 FORMAT('+',60X,'MINIMUM SWAP OUT TIME FOR I/O')
      RTEMP=CITIME(ICC4(5))
      WRITE(6,6004) RTEMP
      WRITE(6,6125)
 6125 FORMAT(' LOGICAL CHANNEL COUNT')
      WRITE(6,6001) ICC(13)
      WRITE(6,6126)
 6126 FORMAT('+',60X,'PAGING LOGICAL CHANNEL COUNT')
      WRITE(6,6002) ICC(14)
      WRITE(6,6128)
 6128 FORMAT(' HIGH I/O UTILIZATION IMBALANCE THRESHOLD')
      WRITE(6,6001) ICC(21)
      WRITE(6,6129)
 6129 FORMAT('+',60X,'LOW I/O UTILIZATION IMBALANCE THRESHOLD')
      WRITE(6,6002) ICC(22)
      WRITE(6,6127)
 6127 FORMAT(' MIN I/O RATE FOR USER I/O MONITORING')
      WRITE(6,6001) ICC(15)
      WRITE(6,6130)
 6130 FORMAT('+',60X,'THRESHOLD FOR DEVICE ALLOCATION SYSEVENT')
      RTEMP=ICC(23)/256.
      WRITE(6,6004) RTEMP
      WRITE(6,6131)
 6131 FORMAT(' HIGH THRESHOLD LCH INITIAL VALUE')
      WRITE(6,6001) ICC(24)
      WRITE(6,6132)
 6132 FORMAT('+',60X,'LOW THRESHOLD LCH INITIAL VALUE')
      WRITE(6,6002) ICC(26)
      WRITE(6,6133)
 6133 FORMAT(' DEV ALLOC THRESHOLD INITIAL VALUE')
      ITEMP=ICC(28)/256
      WRITE(6,6001) ITEMP
      WRITE(6,6134)
 6134 FORMAT('+',60X,'SIGNIFICANT USER LCH USAGE')
      WRITE(6,6002) ICC(30)
      WRITE(6,6140)
 6140 FORMAT(/,44X,'STORAGE CONTROL CONSTANTS (MCT)',/)
      WRITE(6,6141)
 6141 FORMAT(' MINIMUM STEAL INTERVAL')
      RTEMP=CITIME(MCC4(9))
      WRITE(6,6003) RTEMP
      WRITE(6,6142)
 6142 FORMAT('+',60X,'MAXIMUM STEAL INTERVAL')
      RTEMP=CITIME(MCC4(10))
      WRITE(6,6004) RTEMP
      WRITE(6,6143)
 6143 FORMAT(' DELTA FOR STEAL INTERVAL')
      RTEMP=CITIME(MCC4(11))
      WRITE(6,6003) RTEMP
      WRITE(6,6144)
 6144 FORMAT('+',60X,'MAX STEAL INTERVAL FOR SYSTEM AREAS')
      RTEMP=CITIME(MCC4(8))
      WRITE(6,6004) RTEMP
      WRITE(6,6145)
 6145 FORMAT(' MIN MIN WSS FOR STEALING')
      WRITE(6,6001) MCC(23)
      WRITE(6,6146)
 6146 FORMAT('+',60X,'MAX MIN WSS FOR STEALING')
      WRITE(6,6002) MCC(24)
      WRITE(6,6147)
 6147 FORMAT(' DELTA FOR CHANGING MIN WSS')
      WRITE(6,6001) MCC(25)
      WRITE(6,6148)
 6148 FORMAT('+',60X,'CRITERIA NUMBER FOR PAGE STEAL')
      WRITE(6,6002) MCC(26)
      WRITE(6,6149)
 6149 FORMAT(' STEAL NUMBER FOR MASTER,RSM')
      IT4=0
      IT2(2)=MCC(28)
      IT4=IT4*16
      WRITE(6,6001) IT2(1)
      WRITE(6,6150)
 6150 FORMAT('+',60X,'STEAL CRITERIA FOR SYSTEM AREAS')
      IT2(1)=0
      IT4=IT4*16
      WRITE(6,6002) IT2(1)
      WRITE(6,6151)
 6151 FORMAT(' CPU USAGE HIGH THRESHOLD')
      RTEMP=MCC(29)/256.
      WRITE(6,6003) RTEMP
      WRITE(6,6152)
 6152 FORMAT('+',60X,'CPU USAGE LOW THRESHOLD')
      RTEMP=MCC(30)/256.
      WRITE(6,6004) RTEMP
      WRITE(6,6153)
 6153 FORMAT(' % ASM BUFFER FOR ASM OVERLOAD')
      WRITE(6,6001) MCC(31)
      WRITE(6,6154)
 6154 FORMAT(' HIGH THRESHOLD FOR AVQ LOW TIME')
      WRITE(6,6001) MCC(32)
      WRITE(6,6156)
 6156 FORMAT('+',60X,'LOW THRESHOLD FOR AVQ LOW TIME')
      WRITE(6,6002) MCC(33)
      WRITE(6,6162)
 6162 FORMAT(' DELTA FOR TARGET')
      WRITE(6,6001) MCC(34)
      WRITE(6,6157)
 6157 FORMAT('+',60X,'MINIMUM TARGET VALUE')
      WRITE(6,6002) MCC(35)
      WRITE(6,6158)
 6158 FORMAT(' % TOTAL FRAME COUNT')
      WRITE(6,6001) MCC(36)
      WRITE(6,6159)
 6159 FORMAT('+',60X,'MINIMUM USER READY COUNT')
      WRITE(6,6002) MCC(40)
      WRITE(6,6160)
 6160 FORMAT(' FIRST AUX SHORTAGE THRESHOLD')
      WRITE(6,6001) MCC(38)
      WRITE(6,6161)
 6161 FORMAT('+',60X,'SECOND AUX SHORTAGE THRESHOLD')
      WRITE(6,6002) MCC(39)
C
      WRITE(6,6170)
 6170 FORMAT(/,47X,'EXTERNAL CONSTANTS (RMPT)',/)
      WRITE(6,6171)
 6171 FORMAT(' CPU RESOURCE FACTOR')
      WRITE(6,6001) RMPT4(2)
      WRITE(6,6172)
 6172 FORMAT('+',60X,'I/O RESOURCE FACTOR')
      WRITE(6,6002) RMPT4(3)
      WRITE(6,6173)
 6173 FORMAT(' MAXIMUM ANALYSIS INTERVAL')
      RTEMP=CITIME(RMPT4(7))
      WRITE(6,6003) RTEMP
      WRITE(6,6174)
 6174 FORMAT('+',60X,'MINIMUM ANALYSIS INTERVAL')
      RTEMP=CITIME(RMPT4(8))
      WRITE(6,6004) RTEMP
      WRITE(6,6175)
 6175 FORMAT(' ADJ ANALYSIS INTERVAL')
      RTEMP=CITIME(RMPT4(9))
      WRITE(6,6003) RTEMP
      WRITE(6,6176)
 6176 FORMAT('+',60X,'ENQ RESIDENCE INTERVAL')
      RTEMP=CITIME(RMPT4(5))
      WRITE(6,6004) RTEMP
      WRITE(6,6177)
 6177 FORMAT(' MINIMUM INTERVAL SERVICE VALUE')
      WRITE(6,6001) RMPT4(11)
      WRITE(6,6178)
 6178 FORMAT('+',60X,'MINIMUM EXECUTION BEFORE SWAP OUT')
      RTEMP=CITIME(RMPT4(12))
      WRITE(6,6004) RTEMP
      WRITE(6,6179)
 6179 FORMAT(' MAXIMUM TRIVIAL SERVICE VALUE')
      WRITE(6,6001) RMPT4(13)
      WRITE(6,6180)
 6180 FORMAT('+',60X,'MAXIMUM TRIVIAL INTERVAL TIME')
      RTEMP=CITIME(RMPT4(14))
      WRITE(6,6004) RTEMP
      WRITE(6,6181)
 6181 FORMAT(' SWAP IN PAGE FRAME THRESHOLD')
      WRITE(6,6001) RMPT(39)
      WRITE(6,6182)
 6182 FORMAT('+',60X,'ANALYZE PAGE FRAME THRESHOLD')
      WRITE(6,6002) RMPT(40)
      WRITE(6,6183)
 6183 FORMAT(' ANALYSIS SWAP OUT THRESHOLD')
      ITEMP=RMPT4(21)/256
      WRITE(6,6001) ITEMP
      WRITE(6,6184)
 6184 FORMAT('+',60X,'ANALYSIS SWAP IN THRESHOLD')
      ITEMP=RMPT4(22)/256
      WRITE(6,6002) ITEMP
      ISWPIN=PVT4(8)
      ISWPOT=PVT4(9)
      IPGIN=PVT4(3)
 6004 FORMAT('+',107X,F6.2)
 6005 FORMAT('+',45X,3(Z2,'.'),Z2)
 6006 FORMAT('+',105X,3(Z2,'.'),Z2)
 6007 FORMAT('+',46X,Z4)
 6008 FORMAT('+',106X,Z4)
C
C   WRITE HEADER
C
      WRITE(6,6000) LTTIME,DATE
 6000 FORMAT('1SRM ANALYSIS AT ',3(Z2,'.'),Z2,' ON ',A8,/,1X)
      WRITE(6,6009)
 6009 FORMAT(' BASE SRM TIME')
      BASE=0.
      RTEMP=CTIME(BTOD)
      WRITE(6,6005) LTEMP
      WRITE(6,6018)
 6018 FORMAT('+',60X,'CURRENT SRM TIME')
      RTEMP=CTIME(BSRM)
      WRITE(6,6006) LTEMP
      CALL DECVB(IDATA(1),NOW)
      BASE=FLOAT(NOW)*1.0E-02-FLOAT(BSRM)*1.024E-03
C
C   WRITE OUT FIELDS FROM CCT
C
      WRITE(6,6017)
 6017 FORMAT(/,53X,'SRM CPU TABLE',/)
      WRITE(6,6012)
 6012 FORMAT(' PRESENT SYSTEM CPU UTILIZATION')
      WRITE(6,6001) CCT(18)
      AVRCPU=AVRCPU+CCT(18)
      WRITE(6,6013)
 6013 FORMAT('+',60X,'AVERAGE SYSTEM CPU UTILIZATION')
      RTEMP=CCT(21)/256.
      WRITE(6,6004) RTEMP
      WRITE(6,6014)
 6014 FORMAT(' AVERAGE CPU RATE PER PAGE')
      WRITE(6,6001) CCT(20)
      WRITE(6,6015)
 6015 FORMAT('+',60X,'AVERAGE AVAILABLE FRAME COUNT')
      AVRAVQ=AVRAVQ+PVT(1)
      RTEMP=AVRAVQ/NCALLS
      WRITE(6,6004) RTEMP
      WRITE(6,6016)
 6016 FORMAT(' NO OF USERS N.S. FOR ENQS')
      WRITE(6,6001) CCT(23)
      WRITE(6,6011)
 6011 FORMAT('+',60X,'TIME OF LAST CPU IMBALANCE')
      RTEMP=CTIME(CCT4(8))
      WRITE(6,6006) LTEMP
      IT4=0
      IT2(2)=CCT(25)
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6010)
 6010 FORMAT(' *LOW PRIORITY USER NOT DISPATCHED')
C
C   WRITE OUT FIELDS FROM ICT
C
      WRITE(6,6030)
 6030 FORMAT(/,53X,'SRM I/O TABLE',/)
      WRITE(6,6034)
 6034 FORMAT(' AVERAGE PAGING LCH UTILIZATION')
      ITEMP=ICT(11)
      RTEMP=FLOAT(ITEMP)/256.
      WRITE(6,6003) RTEMP
      AVRLCH=AVRLCH+RTEMP
      WRITE(6,6031)
 6031 FORMAT('+',60X,'LCH IMBALANCE BIT PATTERN')
      IT2(2)=ICT(3)
      NBIT=0
      DO 10 I=1,4
      NBIT=NBIT*16
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).EQ.0) GOTO 10
      NBIT=NBIT+1
   10 CONTINUE
      WRITE(6,6008) NBIT
      WRITE(6,6032)
 6032 FORMAT(' LCH OVERUTILIZATION BIT PATTERN')
      IT2(2)=ICT(5)
      NBIT=0
      DO 11 I=1,4
      NBIT=NBIT*16
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).EQ.0) GOTO 11
      NBIT=NBIT+1
   11 CONTINUE
      WRITE(6,6007) NBIT
      WRITE(6,6033)
 6033 FORMAT('+',60X,'LCH UNDERUTILIZATION BIT PATTERN')
      IT2(2)=ICT(7)
      NBIT=0
      DO 12 I=1,4
      NBIT=NBIT*16
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).EQ.0) GOTO 12
      NBIT=NBIT+1
   12 CONTINUE
      WRITE(6,6008) NBIT
      WRITE(6,6035)
 6035 FORMAT(' LCH UTILIZATION COMPUTATION BASE TIME')
      RTEMP=CTIME(ICT4(1))
      WRITE(6,6005) LTEMP
      WRITE(6,6036)
 6036 FORMAT('+',60X,'TIME OF LAST I/O IMBALANCE')
      RTEMP=CTIME(ICT4(5))
      WRITE(6,6006) LTEMP
      CALL DECVB(IDATA(1),NOW)
      IF(NOW.EQ.LAST) GOTO 160
      DO 170 I=1,4
      NT4=I-1
      WRITE(6,6300)
 6300 FORMAT('0LOGICAL CHANNEL NUMBER')
      WRITE(6,6001) NT4
      WRITE(6,6301)
 6301 FORMAT('+',60X,'# I/O STARTED/ENQED PER SEC')
      RTEMP=RMCA(I*4+66)-LCHUSE(I,1)
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
      LCHUSE(I,1)=RMCA(I*4+66)
      WRITE(6,6302)
 6302 FORMAT(' # LOGICALLY BUSY REQUESTS PER SEC')
      RTEMP=RMCA(I*4+67)-LCHUSE(I,2)
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6003) RTEMP
      LCHUSE(I,2)=RMCA(I*4+67)
      WRITE(6,6303)
 6303 FORMAT('+',60X,'# PHYSICALLY BUSY REQUESTS PER SEC')
      RTEMP=RMCA(I*4+68)-LCHUSE(I,3)
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
      LCHUSE(I,3)=RMCA(I*4+68)
  170 CONTINUE
  160 CONTINUE
      IF(LAST.EQ.NOW) LAST=NOW-100
      IT4=0
      IT2(2)=ICT(12)
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6037)
 6037 FORMAT(' *SOME LOGICAL CHANNELS OVERLOADED')
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6039)
 6039 FORMAT(' *I/O LOAD BALANCING ACTIVE')
C
C   WRITE OUT FIELDS FROM MCT
C
      WRITE(6,6040)
 6040 FORMAT(/,51X,'SRM STORAGE TABLE',/)
      WRITE(6,6041)
 6041 FORMAT(' TIME OF LAST AVQ LOW SYSEVENT')
      RTEMP=CTIME(MCT4(1))
      WRITE(6,6005) LTEMP
      WRITE(6,6042)
 6042 FORMAT('+',60X,'ACCUMULATED TIME AVQ LOW')
      RTEMP=CITIME(MCT4(2))
      WRITE(6,6004) RTEMP
      WRITE(6,6043)
 6043 FORMAT(' AVQ LOW THRESHOLD')
      WRITE(6,6001) PVT(2)
      WRITE(6,6044)
 6044 FORMAT('+',60X,'AVQ SATISFACTORY LEVEL')
      WRITE(6,6002) PVT(3)
      WRITE(6,6045)
 6045 FORMAT(' USER EXECUTION INTERVAL FOR RFR')
      RTEMP=CITIME(MCT4(5))
      WRITE(6,6003) RTEMP
      WRITE(6,6046)
 6046 FORMAT('+',60X,'TIME RFR LAST CALLED')
      RTEMP=CTIME(MCT4(6))
      WRITE(6,6006) LTEMP
      WRITE(6,6047)
 6047 FORMAT(' TIME FOR NEXT SPA STEAL')
      RTEMP=CTIME(MCT4(7))
      WRITE(6,6005) LTEMP
      WRITE(6,6048)
 6048 FORMAT('+',60X,'TIME OF LAST TARGET COMPUTATION')
      RTEMP=CTIME(MCT4(8))
      WRITE(6,6006) LTEMP
      WRITE(6,6049)
 6049 FORMAT(' # SWAP-INS/SEC')
      RTEMP=PVT4(8)-ISWPIN
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6003) RTEMP
      WRITE(6,6050)
 6050 FORMAT('+',60X,'# SWAP-OUTS/SEC')
      RTEMP=PVT4(9)-ISWPOT
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
      WRITE(6,6051)
 6051 FORMAT(' TARGET MAXIMUM')
      WRITE(6,6001) MCT(28)
      WRITE(6,6052)
 6052 FORMAT('+',60X,'MINIMUM WSS FOR PAGE STEALING')
      WRITE(6,6002) MCT(30)
      WRITE(6,6056)
 6056 FORMAT(' # CSA,LPA PAGES')
      WRITE(6,6001) PVT(4)
      WRITE(6,6059)
 6059 FORMAT('+',60X,'AVAILABLE FRAME COUNT')
      WRITE(6,6002) PVT(1)
      WRITE(6,6058)
 6058 FORMAT(' NON SWAP PAGE TRANSFER RATE')
      WRITE(6,6001) MCT(27)
      AVRSWP=AVRSWP+MCT(27)
      WRITE(6,6062)
 6062 FORMAT('+',60X,'MAX NONSWAP PAGE TRANSFER RATE')
      WRITE(6,6002) MCT(36)
      WRITE(6,6060)
 6060 FORMAT(' NO OF PAGES STOLEN AT LAST RFR')
      WRITE(6,6001) MCT(31)
      WRITE(6,6061)
 6061 FORMAT('+',60X,'TARGET FOR PAGE STEAL')
      WRITE(6,6002) MCT(32)
      IT4=0
      IT2(2)=MCT(33)
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6064)
 6064 FORMAT(' *SQA FIRST LEVEL SHORTAGE')
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6065)
 6065 FORMAT(' *SQA SECOND LEVEL SHORTAGE')
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6066)
 6066 FORMAT(' *AVQ BELOW LIMIT')
      IT4=IT4*32
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6067)
 6067 FORMAT(' *ASM FIRST LEVEL SHORTAGE')
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).NE.0) WRITE(6,6068)
 6068 FORMAT(' *ASM SECOND LEVEL SHORTAGE')
C
C   WRITE OUT FIELDS FROM RMCA
C
      WRITE(6,6080)
 6080 FORMAT(/,51X,'SRM CONTROL TABLE',/)
      WRITE(6,6082)
 6082 FORMAT(' WLM SWAP-IN WORKLOAD')
      ITEMP=RMCA(2)
      RTEMP=FLOAT(ITEMP)/256.
      WRITE(6,6003) RTEMP
      WRITE(6,6083)
 6083 FORMAT('+',60X,'WLM SWAP-OUT WORKLOAD')
      ITEMP=RMCA(3)
      RTEMP=FLOAT(ITEMP)/256.
      WRITE(6,6004) RTEMP
      WRITE(6,6081)
 6081 FORMAT(' WLM SYSTEM WORKLOAD')
      ITEMP=RMCA(1)
      RTEMP=FLOAT(ITEMP)/256.
      WRITE(6,6003) RTEMP
      AVRWKL=AVRWKL+RTEMP
      WRITE(6,6084)
 6084 FORMAT('+',60X,'NO OF IN-CORE USERS')
      WRITE(6,6002) RMCA(6)
      WRITE(6,6085)
 6085 FORMAT(' NO OF READY OUT USERS')
      WRITE(6,6001) RMCA(7)
      WRITE(6,6086)
 6086 FORMAT('+',60X,'NO OF WAITING OUT USERS')
      WRITE(6,6002) RMCA(8)
      WRITE(6,6087)
 6087 FORMAT(' # PAGE-INS/SEC')
      RTEMP=PVT4(3)-IPGIN
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6003) RTEMP
      WRITE(6,6088)
 6088 FORMAT('+',60X,'# PAGE-OUTS/SEC')
      RTEMP=PVT4(4)-IPGOUT
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
      WRITE(6,6089)
 6089 FORMAT(' # VIO-INS/SEC')
      RTEMP=PVT4(5)-IVIOIN
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6003) RTEMP
      WRITE(6,6090)
 6090 FORMAT('+',60X,'# VIO-OUTS/SEC')
      RTEMP=PVT4(6)-IVIOUT
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
      WRITE(6,6091)
 6091 FORMAT(' # PAGE RECLAIMS/SEC')
      RTEMP=PVT4(10)-IPGRC
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6003) RTEMP
      WRITE(6,6092)
 6092 FORMAT('+',60X,'# VIO RECLAIMS')
      RTEMP=PVT4(7)-IVIORC
      RTEMP=RTEMP/(NOW-LAST)*100.
      WRITE(6,6004) RTEMP
C
C   WRITE OUT SRM CANDIDATE LIST
C
      WRITE(6,6310)
 6310 FORMAT(/,51X,'SRM CANDIDATE LIST',/,1X)
      N=0
      DO 270 I=1,10
      IF(RMCA(I+63).EQ.0) GOTO 270
      IF(N.NE.0) GOTO 280
      WRITE(6,6311) RMCA(I+58),RMCA4(I*2+8),RMCA4(I*2+9)
 6311 FORMAT(' ASID = ',I3,8X,'JOBNAME = ',2A4)
      N=1
      GOTO 270
  280 CONTINUE
      WRITE(6,6312) RMCA(I+58),RMCA4(I*2+8),RMCA4(I*2+9)
 6312 FORMAT('+',60X,'ASID = ',I3,8X,'JOBNAME = ',2A4)
      N=0
  270 CONTINUE
C
      LAST=NOW
      ISWPIN=PVT4(8)
      ISWPOT=PVT4(9)
      IPGIN=PVT4(3)
      IPGOUT=PVT4(4)
      IVIOIN=PVT4(5)
      IVIOUT=PVT4(6)
      IPGRC=PVT4(10)
      IVIORC=PVT4(7)
      GOTO 100
  200 CONTINUE
      IF(FIRST) GOTO 999
      WRITE(6,6200) DATE
 6200 FORMAT('1SRM AVERAGES ON ',A8)
      WRITE(8,8000) DATE
 8000 FORMAT('0SRM AVERAGES ON ',A8)
      AVRCPU=AVRCPU/NCALLS
      AVRWKL=AVRWKL/NCALLS
      AVRLCH=AVRLCH/NCALLS
      AVRSWP=AVRSWP/NCALLS
      AVRAVQ=AVRAVQ/NCALLS
      WRITE(6,6201) AVRCPU
 6201 FORMAT('0AVERAGE CPU UTILIZATION = ',F6.2)
      WRITE(8,6201) AVRCPU
      WRITE(6,6202) AVRLCH
 6202 FORMAT(' AVERAGE PAGING LCH UTILIZATION = ',F6.2)
      WRITE(8,6202) AVRLCH
      WRITE(6,6203) AVRWKL
 6203 FORMAT(' AVERAGE WLM SYSTEM WORKLOAD = ',F6.2)
      WRITE(8,6203) AVRWKL
      WRITE(6,6204) AVRSWP
 6204 FORMAT(' AVERAGE N-S PAGE TRANSFER RATE = ',F6.2)
      WRITE(8,6204) AVRSWP
      WRITE(6,6208) AVRAVQ
 6208 FORMAT(' AVERAGE AVAILABLE FRAME COUNT = ',F6.2)
      WRITE(8,6208) AVRAVQ
      IF(NTIME.EQ.LAST) GOTO 260
      DO 250 I=1,4
      NT4=I-1
      RTEMP=LCHUSE(I,1)-LCH(I)
      RTEMP=RTEMP/(LAST-NTIME)*100.
      WRITE(6,6207) NT4,RTEMP
 6207 FORMAT(' AVERAGE LCH UTILIZATION FOR CHANNEL',I2,' = ',F6.2)
      WRITE(8,6207) NT4,RTEMP
  250 CONTINUE
  260 CONTINUE
      WRITE(8,6205)
      WRITE(6,6205)
 6205 FORMAT('0END OF SRM ANALYSIS')
  999 CONTINUE
      RETURN
      END
      REAL FUNCTION CTIME(NTIME)
      COMMON/SRMTIM/BASE
      LOGICAL*1 LTEMP(4),IT1(4)
      EQUIVALENCE(RTEMP,LTEMP(1)),(IT4,IT1(1))
      TIME=FLOAT(NTIME)*1.024E-03+BASE
C
C   FIND HOURS
C
      IT4=TIME/3600.
      TIME=TIME-IT4*3600.
      IT4=MOD(IT4,10)+16*(IT4/10)
      LTEMP(1)=IT1(4)
C
C   FIND MINUTES
C
      IT4=TIME/60.
      TIME=TIME-IT4*60.
      IT4=MOD(IT4,10)+16*(IT4/10)
      LTEMP(2)=IT1(4)
C
C   FIND SECONDS
C
      IT4=TIME
      TIME=TIME-IT4
      IT4=MOD(IT4,10)+16*(IT4/10)
      LTEMP(3)=IT1(4)
C
C   FIND TENTHS,HUNDREDTHS
C
      IT4=TIME*100.
      IT4=MOD(IT4,10)+16*(IT4/10)
C
C   STORAGE AREAS FOR 1 PAGE OF SNAPSHOTS
C
      REAL*8 DATE
      REAL*8 JOBNAM(256)
      LOGICAL*1 TYPE(18)
      LOGICAL FIRST
      INTEGER*2 PGRP(18),DISPRT(18),NODSPQ(18),DWAIT(18),
     *VIOS(18),NVIO(18),WLM(18),SWPIN(18),SWPOUT(18)
      INTEGER*2 NOWTS(256),SWCT(18)
      INTEGER*4 DSTEP(18),DSRB(18),ALLOC(18),LSQA(18),LOCAL(18),
     *FIXED(18),VIOF(18),
     *DSRVSM(18),RRV(18),EVENT(18),STATUS(18)
      INTEGER*4 STPTIM(256),SRBTIM(256),SRVSUM(256)
      INTEGER*4 STP(18),SRB(18),IASID(18),NASID
      INTEGER*4 TOTSTP,TOTSRB,TOTWAT,TOTSRV,TOTIN
      INTEGER*4 TOTOUT,TOTNSR
      INTEGER*4 TOTTSO,TOTINT
      INTEGER*4 SWAP(18,2),ALGOR(18,2),ENQH(18),DONTS(18),CPUPF(18),
     *IOPF(18),PAGPF(18)
      REAL*4 PCCPU(18)
      REAL*8 INIT/'INIT    '/
C
C   STORAGE AREAS FOR DATA INPUT
C
      INTEGER*4 IDATA(23),TIME,TTIME,ASID
      REAL*8 R81
      REAL*8 RBIT(4)
      INTEGER J1(2,256)
      INTEGER*4 IT4,NT4
      INTEGER*2 IT2(2),NT2(2)
      LOGICAL*1 IT1(4),NT1(4)
      LOGICAL MASK/Z00007000/
      LOGICAL DELTA
      LOGICAL*1 S/'S'/,L/'L'/,B/'B'/,M/'M'/,EVNT(8)
      LOGICAL*1 LTIME(4),LTTIME(4)
      LOGICAL*1 IBIT(8,4)
      INTEGER*2 IDAT(46)
      REAL*8 FMT(20),NAPP,APP
      INTEGER*4 IN/'  IN'/,STS(2),IFLG(2),BLNK/'    '/
      INTEGER*4 MIN4/'-   '/
      LOGICAL*4 LTEMP,LFLG(2)
      INTEGER*2 MIN/'- '/
C
      EQUIVALENCE(IT4,IT2(1)),(IT4,IT1(1)),(NT4,NT1(1))
      EQUIVALENCE(LTTIME(1),TTIME)
      EQUIVALENCE(IDATA(1),TIME),(TIME,LTIME(1)),(IDATA(4),NASID),
     *(IDATA(1),IDAT(1)),(R81,IDATA(2)),(LTEMP,ITEMP),(LFLG(1),IFLG(1))
      EQUIVALENCE(JOBNAM(1),J1(1,1))
      EQUIVALENCE(RBIT(1),IBIT(1,1)),(NT4,NT2(1))
C
      DATA EVNT/'M','P','Q','E','C','T','O','L'/
      DATA FMT/'(1H+,12X',18*'        ',')       '/
      DATA APP/',I6     '/,NAPP/',5X,A1  '/
      DATA STS/' OUT','NS/R'/
      DATA LFLG/Z00008400,Z00000001/
      DATA LENGTH/23/
      DATA RBIT/'OIB WRT ','NCW APET','WARCSIQD','XBERPAIC'/
C   ***********************************
C
C   DUMP OF SNAPSHOTS
C
C   ***********************************
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      IFLAG=0
C
C   INITIALIZE COUNTERS AND STORAGE AREAS
C
      DELTA=.TRUE.
      FIRST=.TRUE.
C   COUNTERS FOR TOTALS FOR SNAPSHOTS
      TOTSTP=0
      TOTSRB=0
      TOTWAT=0
      TOTSRV=0
      TOTIN=0
      TOTOUT=0
      TOTNSR=0
      TOTINT=0
      TOTTSO=0
      NCALLS=0
C   COUNTERS FOR AVERAGES
      AVRIN=0.
      AVROUT=0.
      AVRNSR=0.
      AVRINT=0.
      AVRTSO=0.
      AVRSTP=0.
      AVRSRB=0.
      AVRWAT=0.
      AVRSRV=0.
C   STORAGE AREAS FOR SNAPSHOTS
      ICT=0
      DO 5 I=1,18
      VIOS(I)=0
      NVIO(I)=0
      STATUS(I)=BLNK
    5 CONTINUE
  100 CONTINUE
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 20
      IF(NASID.LE.0) GOTO 100
      IF(.NOT.FIRST) GOTO 10
      TTIME=TIME
C
C   OBTAIN BINARY REPRESENTATION OF TIME OF CALL
C
      CALL DECVB(TTIME,LSTIM)
      IFSTIM=LSTIM
      FIRST=.FALSE.
   10 CONTINUE
C
C   CHECK FOR END OF CURRENT SNAPSHOT
C
      IF(TTIME.NE.TIME) GOTO 20
  105 CONTINUE
      ICT=ICT+1
      IF(ICT.GT.18) GOTO 20
      ASID=ICT
C
C   SET DATA INTO STORAGE AREAS
C
      IASID(ASID)=NASID
      IF(JOBNAM(NASID).EQ.R81) GOTO 13
C
C   ASID HAS NEW JOBNAME - RESET COUNTERS
C
      VIOS(ASID)=0
      NVIO(ASID)=0
      NOWTS(NASID)=0
      STPTIM(NASID)=0
      SRBTIM(NASID)=0
      SRVSUM(NASID)=0
      DWAIT(ASID)=0
      JOBNAM(NASID)=R81
   13 CONTINUE
      IF(JOBNAM(NASID).EQ.INIT) TOTINT=TOTINT+1
C
C   FIND IF ADDRESS SPACE IS IN,OUT,NS/R
C
      STATUS(ASID)=IN
      DO 15 I=1,2
      ITEMP=IDAT(21)
      LTEMP=LTEMP.AND.LFLG(I)
      IF(ITEMP.NE.0) STATUS(ASID)=STS(I)
   15 CONTINUE
C
C   INCREMENT COUNTERS
C
      IF(STATUS(ASID).EQ.IN) TOTIN=TOTIN+1
      IF(STATUS(ASID).EQ.STS(1)) TOTOUT=TOTOUT+1
      IF(STATUS(ASID).EQ.STS(2)) TOTNSR=TOTNSR+1
C
C   SET UP # WAITS,D-WAIT,# VIO SLOTS,# NON-VIO SLOTS
C
      DWAIT(ASID)=IDAT(34)-NOWTS(NASID)
      IF(DELTA) DWAIT(ASID)=0
      IF(DWAIT(ASID).LT.0) DWAIT(ASID)=0
      NOWTS(NASID)=IDAT(34)
      VIOS(ASID)=IDAT(35)
      NVIO(ASID)=IDAT(36)
      TOTWAT=TOTWAT+DWAIT(ASID)
      PGRP(ASID)=IDAT(23)
      DISPRT(ASID)=IDAT(14)
      NODSPQ(ASID)=IDAT(13)
      WLM(ASID)=IDAT(24)/256
      SWPIN(ASID)=IDAT(29)
      SWPOUT(ASID)=IDAT(30)
C
C   GET STEP TIME INTO MILLISECS
C
      IT2(1)=IDAT(10)
      IT2(2)=IDAT(11)
      IT4=(IT4/1000)*16
      DSTEP(ASID)=IT4-STPTIM(NASID)
      IF(DELTA) DSTEP(ASID)=0
      IF(DSTEP(ASID).LT.0) DSTEP(ASID)=0
      STPTIM(NASID)=IT4
      STP(ASID)=IT4/100
      TOTSTP=TOTSTP+DSTEP(ASID)
C
C   GET SRB TIME INTO MILLISECS
C
      IT2(1)=IDAT(18)
      IT2(2)=IDAT(19)
      IT4=(IT4/1000)*16
      DSRB(ASID)=IT4-SRBTIM(NASID)
      IF(DELTA) DSRB(ASID)=0
      IF(DSRB(ASID).LT.0) DSRB(ASID)=0
      SRBTIM(NASID)=IT4
      SRB(ASID)=IT4/100
      TOTSRB=TOTSRB+DSRB(ASID)
C
C   MOVE ALLOC,LSQA,LOCAL,FIXED,VIO FRAME COUNTS
C
      ALLOC(ASID)=IDAT(22)
      LSQA(ASID)=IDAT(40)
      LOCAL(ASID)=IDAT(42)
      FIXED(ASID)=IDAT(44)
      VIOF(ASID)=IDATA(23)
      SWCT(ASID)=IDAT(31)
      DSRVSM(ASID)=IDATA(14)-SRVSUM(NASID)
      IF(DELTA) DSRVSM(ASID)=0
      IF(DSRVSM(ASID).LT.0) DSRVSM(ASID)=0
      SRVSUM(NASID)=IDATA(14)
      TOTSRV=TOTSRV+DSRVSM(ASID)
      RRV(ASID)=IDATA(13)/256
C
C   SET UP TYPE OF JOB
C
      TYPE(ASID)=B
      ITEMP=IDAT(33)
      LTEMP=LTEMP.AND.MASK
      IT4=ITEMP/4096
      IF(IT4.EQ.1) TYPE(ASID)=M
      IF(IT4.EQ.2) TYPE(ASID)=L
      IF(IT4.EQ.2) TOTTSO=TOTTSO+1
      IF(IT4.EQ.4) TYPE(ASID)=S
C
C   SET UP TYPE OF EVENT
C
      NT4=BLNK
      JCT=4
      IT2(1)=IDAT(33)
      DO 17 I=1,8
      IT2(2)=0
      IT4=IT4/2
      IF(IT2(2).EQ.0) GOTO 17
      NT1(JCT)=EVNT(I)
      JCT=JCT-1
      IF(JCT.EQ.0) GOTO 18
   17 CONTINUE
   18 CONTINUE
      EVENT(ASID)=NT4
C
C   MOVE CPU,I/O,PAGE PROFILES
C
      CPUPF(ASID)=IDAT(39)
      IOPF(ASID)=IDAT(41)
      PAGPF(ASID)=IDAT(43)
C
C   MOVE # ENQHOLDS,DONTSWAPS
C
      NT4=0
      NT2(2)=IDAT(38)
      NT4=NT4*16
      ENQH(ASID)=NT2(1)
      NT2(1)=0
      NT4=NT4*16
      DONTS(ASID)=NT2(1)
C
C   SET UP TYPE OF SWAP
C
      NT4=BLNK
      JCT=4
      IT2(2)=IDAT(32)
      DO 210 I=1,16
      IF(I.NE.9) GOTO 211
      SWAP(ASID,1)=NT4
      JCT=4
      NT4=BLNK
  211 CONTINUE
      IF(JCT.EQ.0) GOTO 210
      IT2(1)=0
      IT4=IT4*2
      IF(I.EQ.4.OR.I.EQ.8.OR.I.EQ.12) GOTO 210
      IF(IT2(1).EQ.0) GOTO 210
      NT1(JCT)=IBIT(I,1)
      JCT=JCT-1
  210 CONTINUE
      SWAP(ASID,2)=NT4
C
C   SET UP TYPE OF TRANSACTION/ALGORITHM
C
      NT4=BLNK
      JCT=4
      IT2(2)=IDAT(37)
      DO 220 I=1,16
      IF(I.NE.9) GOTO 221
      ALGOR(ASID,1)=NT4
      JCT=4
      NT4=BLNK
  221 CONTINUE
      IF(JCT.EQ.0) GOTO 220
      IT2(1)=0
      IT4=IT4*2
      IF(IT2(1).EQ.0) GOTO 220
      NT1(JCT)=IBIT(I,3)
      JCT=JCT-1
  220 CONTINUE
      ALGOR(ASID,2)=NT4
      GOTO 100
C   ***********************************
   20 CONTINUE
C
C   WRITE OUT SNAPSHOTS OF FIRST 18 ASIDS
C
C   ***********************************
      IF(FIRST) GOTO 999
      IF(ICT.GT.18) ICT=18
      IF(ICT.LE.0) GOTO 999
      IF(TTIME.NE.TIME) DELTA=.FALSE.
      DO 25 I=2,19
      FMT(I)=APP
      IF(STATUS(I-1).NE.STS(2)) GOTO 25
      FMT(I)=NAPP
      PGRP(I-1)=MIN
      SWPIN(I-1)=MIN
      SWPOUT(I-1)=MIN
      WLM(I-1)=MIN
      RRV(I-1)=MIN4
   25 CONTINUE
      WRITE(6,6000) LTTIME,DATE
 6000 FORMAT('1SNAPSHOT AT ',3(Z2,'.'),Z2,' ON ',A8)
 6001 FORMAT('+',12X,18I6)
 6002 FORMAT('+',12X,18(2X,A4))
 6003 FORMAT('+',12X,18(5X,A1))
      WRITE(6,6010)
 6010 FORMAT(' ASID')
      WRITE(6,6001) (IASID(I),I=1,ICT)
      WRITE(6,6011)
 6011 FORMAT(' JOBNAMES')
      WRITE(6,6002) (J1(1,IASID(I)),I=1,ICT)
      WRITE(6,6012)
 6012 FORMAT(1X)
      WRITE(6,6002) (J1(2,IASID(I)),I=1,ICT)
      WRITE(6,6013)
 6013 FORMAT(' TYPE')
      WRITE(6,6003) (TYPE(I),I=1,ICT)
      WRITE(6,6014)
 6014 FORMAT(' PERF GRP')
      WRITE(6,FMT) (PGRP(I),I=1,ICT)
      WRITE(6,6015)
 6015 FORMAT(' SWP-IN SIZE')
      WRITE(6,FMT) (SWPIN(I),I=1,ICT)
      WRITE(6,6016)
 6016 FORMAT(' SWP-OT SIZE')
      WRITE(6,FMT) (SWPOUT(I),I=1,ICT)
      WRITE(6,6017)
 6017 FORMAT(' DISP PRTY')
      WRITE(6,6001) (DISPRT(I),I=1,ICT)
      WRITE(6,6018)
 6018 FORMAT(' # IN DISP Q')
      WRITE(6,6001) (NODSPQ(I),I=1,ICT)
      WRITE(6,6019)
 6019 FORMAT(' STEP TIME')
      WRITE(6,6001) (STP(I),I=1,ICT)
      WRITE(6,6020)
 6020 FORMAT(' D-STEP TIME')
      WRITE(6,6001) (DSTEP(I),I=1,ICT)
      WRITE(6,6021)
 6021 FORMAT(' SRB TIME')
      WRITE(6,6001) (SRB(I),I=1,ICT)
      WRITE(6,6022)
 6022 FORMAT(' D-SRB TIME')
      WRITE(6,6001) (DSRB(I),I=1,ICT)
      WRITE(6,6023)
 6023 FORMAT(' # I/O REQS')
      WRITE(6,6001) (NOWTS(IASID(I)),I=1,ICT)
      WRITE(6,6024)
 6024 FORMAT(' D-I/O REQS')
      WRITE(6,6001) (DWAIT(I),I=1,ICT)
      WRITE(6,6025)
 6025 FORMAT(' ALLOC FRAME')
      WRITE(6,6001) (ALLOC(I),I=1,ICT)
      WRITE(6,6026)
 6026 FORMAT(' LSQA FRAMES')
      WRITE(6,6001) (LSQA(I),I=1,ICT)
      WRITE(6,6027)
 6027 FORMAT(' LOCAL FRAME')
      WRITE(6,6001) (LOCAL(I),I=1,ICT)
      WRITE(6,6028)
 6028 FORMAT(' FIXED FRAME')
      WRITE(6,6001) (FIXED(I),I=1,ICT)
      WRITE(6,6029)
 6029 FORMAT(' VIO FRAMES')
      WRITE(6,6001) (VIOF(I),I=1,ICT)
      WRITE(6,6030)
 6030 FORMAT(' VIO SLOTS')
      WRITE(6,6001) (VIOS(I),I=1,ICT)
      WRITE(6,6031)
 6031 FORMAT(' N-VIO SLOTS')
      WRITE(6,6001) (NVIO(I),I=1,ICT)
      WRITE(6,6032)
 6032 FORMAT(' # OF SWAPS')
      WRITE(6,6001) (SWCT(I),I=1,ICT)
      WRITE(6,6033)
 6033 FORMAT(' SERV SUM')
      WRITE(6,6001) (SRVSUM(IASID(I)),I=1,ICT)
      WRITE(6,6034)
 6034 FORMAT(' D-SERV SUM')
      WRITE(6,6001) (DSRVSM(I),I=1,ICT)
      WRITE(6,6035)
 6035 FORMAT(' WLM RV')
      WRITE(6,FMT) (WLM(I),I=1,ICT)
      WRITE(6,6036)
 6036 FORMAT(' RESOURCE RV')
      WRITE(6,FMT) (RRV(I),I=1,ICT)
      WRITE(6,6102)
 6102 FORMAT(' ALGORITHM')
      WRITE(6,6002) (ALGOR(I,1),I=1,ICT)
      WRITE(6,6103)
 6103 FORMAT(' TRANSACTION')
      WRITE(6,6002) (ALGOR(I,2),I=1,ICT)
      WRITE(6,6104)
 6104 FORMAT(' # ENQHOLDS')
      WRITE(6,6001) (ENQH(I),I=1,ICT)
      WRITE(6,6105)
 6105 FORMAT(' # DONTSWAPS')
      WRITE(6,6001) (DONTS(I),I=1,ICT)
      WRITE(6,6106)
 6106 FORMAT(' CPU PROF')
      WRITE(6,6001) (CPUPF(I),I=1,ICT)
      WRITE(6,6107)
 6107 FORMAT(' I/O PROF')
      WRITE(6,6001) (IOPF(I),I=1,ICT)
      WRITE(6,6108)
 6108 FORMAT(' PAGE PROF')
      WRITE(6,6001) (PAGPF(I),I=1,ICT)
      WRITE(6,6038)
 6038 FORMAT(' STATUS')
      WRITE(6,6002) (STATUS(I),I=1,ICT)
      CALL DECVB(TTIME,NOWTIM)
      RINT=FLOAT(NOWTIM-LSTIM)
      IF(RINT.LT.0.) RINT=RINT+8640000.
      DO 200 I=1,ICT
      PCCPU(I)=0.
      IF(RINT.LE.0.) GOTO 200
      PCCPU(I)=(DSTEP(I)+DSRB(I))/RINT*10.
  200 CONTINUE
      WRITE(6,6070)
 6070 FORMAT(' % TIME/SEC')
      WRITE(6,6071) (PCCPU(I),I=1,ICT)
 6071 FORMAT('+',12X,18F6.1)
      IF(TTIME.EQ.TIME.AND.IFLAG.LE.0) GOTO 110
C
C   WRITE OUT TOTALS FOR SNAPSHOT
C
      NCALLS=NCALLS+1
      CALL DECVB(TTIME,NOWTIM)
      RINT=FLOAT(NOWTIM-LSTIM)/100.
      IF(RINT.LT.0.) RINT=RINT+86400.
      LSTIM=NOWTIM
      WRITE(6,6039) LTTIME,RINT
 6039 FORMAT('1TOTALS AT ',3(Z2,'.'),Z2,5X,'(INTERVAL= ',F6.2,' SECS)')
      WRITE(6,6041)
 6041 FORMAT(' # IN')
      WRITE(6,6040) TOTIN
      WRITE(6,6042)
 6042 FORMAT('+',30X,'# OUT')
      WRITE(6,6060) TOTOUT
 6060 FORMAT('+',48X,I6)
      WRITE(6,6043)
 6043 FORMAT(' # NS/R')
      WRITE(6,6040) TOTNSR
      WRITE(6,6061)
 6061 FORMAT('+',30X,'# TSO')
      WRITE(6,6060) TOTTSO
      WRITE(6,6063)
 6063 FORMAT(' # INITS')
      WRITE(6,6040) TOTINT
      WRITE(6,6020)
 6040 FORMAT('+',18X,I6)
      WRITE(6,6040) TOTSTP
      WRITE(6,6022)
      WRITE(6,6040) TOTSRB
      WRITE(6,6024)
      WRITE(6,6040) TOTWAT
      WRITE(6,6034)
      WRITE(6,6040) TOTSRV
      AVRIN=AVRIN+TOTIN
      AVROUT=AVROUT+TOTOUT
      AVRNSR=AVRNSR+TOTNSR
      AVRTSO=AVRTSO+TOTTSO
      AVRINT=AVRINT+TOTINT
      IF(RINT.EQ.0.) GOTO 115
      RSTP=FLOAT(TOTSTP)/(RINT*1000.)
      RSRB=FLOAT(TOTSRB)/(RINT*1000.)
      RWAIT=FLOAT(TOTWAT)/RINT
      RSRV=FLOAT(TOTSRV)/RINT
C
C   INCREMENT AVERAGE COUNTERS
C
      AVRSTP=AVRSTP+TOTSTP/1000.
      AVRSRB=AVRSRB+TOTSRB/1000.
      AVRWAT=AVRWAT+TOTWAT
      AVRSRV=AVRSRV+TOTSRV
      WRITE(6,6044)
 6044 FORMAT(' STEP TIME/SEC')
      WRITE(6,6045) RSTP
 6045 FORMAT('+',18X,F6.4)
      WRITE(6,6046)
 6046 FORMAT(' SRB TIME/SEC')
      WRITE(6,6045) RSRB
      WRITE(6,6047)
 6047 FORMAT(' # I/O /SEC')
      WRITE(6,6048) RWAIT
 6048 FORMAT('+',18X,F6.1)
      WRITE(6,6049)
 6049 FORMAT(' SERV SUM/SEC')
      WRITE(6,6048) RSRV
C
C   RESET COUNTERS
C
  115 CONTINUE
      TOTSTP=0
      TOTSRB=0
      TOTWAT=0
      TOTSRV=0
      TOTIN=0
      TOTOUT=0
      TOTNSR=0
      TOTINT=0
      TOTTSO=0
  110 CONTINUE
      IF(IFLAG.GT.0) GOTO 999
      ICT=0
      TTIME=TIME
      GOTO 105
  999 CONTINUE
      IF(FIRST) GOTO 99
C
C   WRITE OUT AVERAGES
C
      AVRIN=AVRIN/NCALLS
      AVROUT=AVROUT/NCALLS
      AVRNSR=AVRNSR/NCALLS
      AVRINT=AVRINT/NCALLS
      AVRTSO=AVRTSO/NCALLS
      RINT=FLOAT(LSTIM-IFSTIM)/100.
      IF(RINT.LT.0.) RINT=RINT+86400.
      AVRSTP=AVRSTP/RINT
      AVRSRB=AVRSRB/RINT
      AVRWAT=AVRWAT/RINT
      AVRSRV=AVRSRV/RINT
      WRITE(6,6050)
 6050 FORMAT('1SNAPSHOT AVERAGES',/,1X)
 6062 FORMAT('+',48X,F6.1)
      WRITE(6,6041)
      WRITE(6,6048) AVRIN
      WRITE(6,6042)
      WRITE(6,6062) AVROUT
      WRITE(6,6043)
      WRITE(6,6048) AVRNSR
      WRITE(6,6061)
      WRITE(6,6062) AVRTSO
      WRITE(6,6063)
      WRITE(6,6048) AVRINT
      WRITE(6,6044)
      WRITE(6,6045) AVRSTP
      WRITE(6,6046)
      WRITE(6,6045) AVRSRB
      WRITE(6,6047)
      WRITE(6,6048) AVRWAT
      WRITE(6,6049)
      WRITE(6,6048) AVRSRV
      WRITE(8,8000) DATE
 8000 FORMAT('0SNAPSHOT AVERAGES ON ',A8,/,1X)
      WRITE(8,6041)
      WRITE(8,6048) AVRIN
      WRITE(8,6042)
      WRITE(8,6062) AVROUT
      WRITE(8,6043)
      WRITE(8,6048) AVRNSR
      WRITE(8,6061)
      WRITE(8,6062) AVRTSO
      WRITE(8,6063)
      WRITE(8,6048) AVRINT
      WRITE(8,6044)
      WRITE(8,6045) AVRSTP
      WRITE(8,6046)
      WRITE(8,6045) AVRSRB
      WRITE(8,6047)
      WRITE(8,6048) AVRWAT
      WRITE(8,6049)
      WRITE(8,6048) AVRSRV
   99 CONTINUE
      RETURN
      END
      SUBROUTINE ANLT(NAME,DATE)
C
C   ROUTINE ANALYSES TRACE ATABLE ENTRIES
C
      INTEGER*4 NAME,IDATA(8),LENGTH/8/,TIME,TOD,TYPE(9)
      REAL*8 DATE
      LOGICAL*1 FIRST,LTIME(4),LTTIME(4)
      INTEGER*2 IDAT(16)
      LOGICAL*4 GRAPH,LIST
      INTEGER COUNTS(9),BEGIN,NOW,JOB(2)
         INTEGER*2 SVCS(256),SVCNO
      REAL ACTIVE
      COMMON/OPTION/ISTRM,GRAPH,LIST
      EQUIVALENCE(IDATA(1),TIME),(TIME,LTIME(1)),(TOD,LTTIME(1)),
     *(IDAT(1),IDATA(1))
      DATA TYPE/'SIO ','EXT ','SVC ','PGM ','ISD ','I/O ','SSR ',
     *'DSP ','ALL '/
      DATA SVCS/256*0/
      WRITE(8,8200) DATE
 8200 FORMAT('0TRACE TABLE AVERAGES ON ',A8,/,1X)
      WRITE(6,6200) DATE
 6200 FORMAT('1TRACE TABLE ANALYSIS ON ',A8)
      IASNXT=-1
      ACTIVE=0.
  200 CONTINUE
      IASID=IASNXT
      IF(IASID.EQ.-2) GOTO 990
      IASNXT=-2
      DO 201 I=1,9
      COUNTS(I)=0
  201 CONTINUE
C
C   REWIND DATA SET
C
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      FIRST=.TRUE.
  100 CONTINUE
      IFLAG=0
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 99
      IF(IDAT(4).LE.IASID) GOTO 203
      IF(IASNXT.EQ.-2) IASNXT=IDAT(4)
      IF(IDAT(4).LT.IASNXT) IASNXT=IDAT(4)
  203 CONTINUE
      IF(IASID.EQ.-1) GOTO 202
      IF(IDAT(4).NE.IASID) GOTO 100
  202 CONTINUE
      IF(.NOT.FIRST) GOTO 10
      JOB(1)=IDATA(4)
      JOB(2)=IDATA(5)
      TOD=TIME
      FIRST=.FALSE.
      GOTO 20
   10 CONTINUE
      IF(TOD.EQ.TIME) GOTO 30
      IF(IASID.EQ.-1) ACTIVE=ACTIVE+(BEGIN-NOW)*1.302E-05
   20 CONTINUE
      TOD=TIME
      BEGIN=IDATA(3)
      IF(.NOT.LIST) GOTO 30
      WRITE(6,6000) LTTIME,DATE
 6000 FORMAT('0TRACE TABLE ANALYSIS AT ',3(Z2,'.'),Z2,' ON ',A8)
      WRITE(6,6005)
 6005 FORMAT('0TYPE  ASID    TIME    JOBNAME          PSW',
     *'           CSW',/,1X)
   30 CONTINUE
      IF(IDAT(3).NE.2.OR.IASID.NE.-1) GOTO 40
      SVCNO=IDAT(12)-8191
      IF(SVCNO.GT.0.AND.SVCNO.LE.256) SVCS(SVCNO)=SVCS(SVCNO)+1
   40 CONTINUE
      NOW=IDATA(3)
      COUNTS(IDAT(3)+1)=COUNTS(IDAT(3)+1)+1
      COUNTS(9)=COUNTS(9)+1
      IF(.NOT.LIST) GOTO 100
      WRITE(6,6010) TYPE(IDAT(3)+1),IDAT(4),(IDATA(I),I=3,7)
 6010 FORMAT(1X,A4,2X,I3,3X,Z8,2X,2A4,2X,Z8,1X,Z8)
      IF(IDAT(3).NE.7.AND.(IDAT(3).GT.3.OR.IDAT(3).LT.1))
     * WRITE(6,6015) IDATA(8)
 6015 FORMAT('+',51X,Z8)
      GOTO 100
   99 CONTINUE
      IF(IASID.EQ.-1) ACTIVE=ACTIVE+(BEGIN-NOW)*1.302E-05
      WRITE(6,6300)
 6300 FORMAT('0FREQUENCY OF EVENTS')
      IF(IASID.NE.-1) WRITE(6,6301) IASID,JOB
 6301 FORMAT('+',20X,'FOR ASID = ',I3,8X,2A4)
      WRITE(6,6302)
 6302 FORMAT(1X)
      DO 204 I=1,9
      IF(COUNTS(I).EQ.0) GOTO 204
      TEMP=COUNTS(I)/ACTIVE
      IF(IASID.EQ.-1) WRITE(8,6303) TYPE(I),TEMP,COUNTS(I)
      WRITE(6,6303) TYPE(I),TEMP,COUNTS(I)
 6303 FORMAT(4X,A4,4X,F6.1,2X,' PER SECOND (SAMPLE SIZE = ',I5,')')
  204 CONTINUE
      GOTO 200
  990 CONTINUE
      WRITE(6,6020) DATE
 6020 FORMAT('1SVC COUNTS ON ',A8,/,1X)
      DO 50 I=1,256
      IF(SVCS(I).EQ.0) GOTO 50
      J=I-1
      WRITE(6,6030) J,SVCS(I)
 6030 FORMAT(' SVC',I4,'   COUNT = ',I6)
   50 CONTINUE
      WRITE(6,6100)
 6100 FORMAT('0END OF TRACE TABLE ANALYSIS')
      WRITE(8,6100)
  999 CONTINUE
      RETURN
      END
      SUBROUTINE ANLU(NAME,DATE)
C   ***********************************
C
C   ROUTINE PRINTS OUT UCB RECORDS
C
C   ***********************************
      REAL*8 DATE,BLNK/'        '/
      INTEGER*4 IDATA(17),LENGTH/17/,TIME,TTIME,VOLSER(2),VOLS(2),
     *LT4,UNIT,BLNK4/'    '/
      INTEGER*4 UNNO(10),SNPVOL(2,10)
      DIMENSION RCNTS(11)
      INTEGER*2 COUNTS(10,11)
      INTEGER*2 LT2(2)
      LOGICAL*1 LTTIME(4),FIRST/.TRUE./,UL(4),BLNK1/' '/,VLSR(8)
      LOGICAL*1 NEWL
      DATA COUNTS/110*0/
      DATA UNNO/10*'    '/,SNPVOL/20*'    '/
C
      EQUIVALENCE(IDATA(1),TIME),(TTIME,LTTIME(1)),(UNIT,UL(1)),
     *(VLSR(1),VOLSER(1)),(VOLS(1),IDATA(13)),(LT4,LT2(1))
C
      COMMON/OPTION/ISTRM,GRAPH,LIST
      LOGICAL*4 GRAPH,LIST
C
C   REWIND LOG
C
      ICT=0
      IMAX=10
      NCALLS=0
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
  100 CONTINUE
      IFLAG=0
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 200
      IF(FIRST) GOTO 5
      IF(TTIME.EQ.TIME) GOTO 10
    5 CONTINUE
C
C   NEW TIME - WRITE HEADER
C
      NCALLS=NCALLS+1
      FIRST=.FALSE.
      TTIME=TIME
      IF(.NOT.LIST) GOTO 10
      WRITE(6,6000) LTTIME,DATE
 6000 FORMAT('1UCBS AT ',3(Z2,'.'),Z2,' ON ',A8)
   10 CONTINUE
C   PICK UP UNIT NAME
      UNIT=IDATA(5)
      UL(1)=BLNK1
      DO 600 I=1,IMAX
      ICT=I
      IF(UNNO(I).EQ.BLNK4) GOTO 603
      IF(UNNO(I).EQ.UNIT) GOTO 603
  600 CONTINUE
      ICT=IMAX+1
  603 CONTINUE
      IF(ICT.LE.IMAX) UNNO(ICT)=UNIT
      IF(.NOT.LIST) GOTO 400
      WRITE(6,6010) UNIT
 6010 FORMAT('0UNIT NAME',A4)
  400 CONTINUE
C   PICK UP CLASS OF DEVICE
      ITYPE=0
      LT4=IDATA(6)
      L1=11
      DO 20 I=1,8
      LT2(1)=0
      LT4=LT4*2
      IF(LT2(1).EQ.0) GOTO 20
      IF(I.EQ.8.AND.ITYPE.EQ.1) ITYPE=9
      IF(ITYPE.NE.9) ITYPE=I
   20 CONTINUE
C
C   WRITE CLASS OF DEVICE
C
      IF(.NOT.LIST) GOTO 401
      IF(ITYPE.EQ.1) WRITE(6,6001)
      IF(ITYPE.EQ.2) WRITE(6,6002)
      IF(ITYPE.EQ.3) WRITE(6,6003)
      IF(ITYPE.EQ.4) WRITE(6,6004)
      IF(ITYPE.EQ.5) WRITE(6,6005)
      IF(ITYPE.EQ.6) WRITE(6,6006)
      IF(ITYPE.EQ.9) WRITE(6,6009)
 6001 FORMAT('+',15X,'TAPE')
 6002 FORMAT('+',15X,'COMMUNICATIONS')
 6003 FORMAT('+',15X,'DIRECT ACCESS')
 6004 FORMAT('+',15X,'DISPLAY')
 6005 FORMAT('+',15X,'UNIT RECORD')
 6006 FORMAT('+',15X,'CHARACTER READER')
 6009 FORMAT('+',15X,'CHANNEL ADAPTOR')
  401 CONTINUE
      IF(ICT.GT.IMAX) GOTO 500
      SNPVOL(1,ICT)=BLNK4
      SNPVOL(2,ICT)=BLNK4
  500 CONTINUE
      IF(ITYPE.NE.1.AND.ITYPE.NE.3) GOTO 30
C
C   IF TAPE OR D.A. PICK UP VOLSER
C
      L1=17
      DO 21 I=1,2
      VOLSER(I)=VOLS(I)
   21 CONTINUE
C
C   FIND STATUS OF UCB
C
      DO 50 I=1,8
      LT2(2)=0
      LT4=LT4/2
      IF(LT2(2).EQ.0) GOTO 50
      IF(I.EQ.3.AND.LIST) WRITE(6,6050)
 6050 FORMAT('+',35X,'PERM RES')
      IF(I.EQ.4) IALL=1
      IF(I.EQ.4.AND.LIST) WRITE(6,6051)
 6051 FORMAT('+',46X,'ALLOCATED')
      IF(I.EQ.6.AND.LIST) WRITE(6,6052)
 6052 FORMAT('+',58X,'RESERVED')
      IF(I.EQ.8.AND.LIST) WRITE(6,6053)
 6053 FORMAT('+',69X,'ONLINE')
      IF(I.EQ.8.AND.ICT.LE.IMAX) COUNTS(ICT,9)=COUNTS(ICT,9)+1
   50 CONTINUE
C
C   WRITE ASID
C
      LT4=IDATA(11)
      IF(IALL.EQ.1.AND.LIST) WRITE(6,6054) LT2(2)
 6054 FORMAT('+',78X,'ASID=',I3)
      IF(L1.EQ.17.AND.LIST) WRITE(6,6015) VOLSER
 6015 FORMAT('+',89X,2A4)
      IF(ITYPE.NE.1) GOTO 51
C
C   CHECK IF TAPE IS REWINDING
C
      LT4=IDATA(5)
      LT2(2)=LT2(1)
      LT4=LT4*8
      LT2(1)=0
      LT4=LT4*2
      IF(LT2(1).NE.0.AND.LIST) WRITE(6,6056)
 6056 FORMAT('+',100X,'REWIND')
      IF(LT2(1).NE.0.AND.ICT.LE.IMAX) COUNTS(ICT,10)=COUNTS(ICT,10)+1
   51 CONTINUE
      NEWL=.FALSE.
C
C   PICK UP SUPERVISOR FLAG A
C
      LT4=IDATA(3)
      DO 60 I=1,8
      LT2(1)=0
      LT4=LT4*2
      IF(LT2(1).EQ.0) GOTO 60
C   NEWLINE?
      IF(NEWL.OR..NOT.LIST) GOTO 61
      WRITE(6,6060)
 6060 FORMAT(1X)
      NEWL=.TRUE.
   61 CONTINUE
      IF(ICT.LE.IMAX) COUNTS(ICT,I)=COUNTS(ICT,I)+1
      IF(.NOT.LIST) GOTO 60
      IF(I.EQ.1) WRITE(6,6061)
 6061 FORMAT('+BUSY')
      IF(I.EQ.2) WRITE(6,6062)
 6062 FORMAT('+',6X,'NOT READY')
      IF(I.EQ.3) WRITE(6,6063)
 6063 FORMAT('+',17X,'POST')
      IF(I.EQ.4) WRITE(6,6064)
 6064 FORMAT('+',23X,'SENSE PENDING')
      IF(I.EQ.5) WRITE(6,6065)
 6065 FORMAT('+',38X,'C.U. BUSY')
      IF(I.EQ.6) WRITE(6,6066)
 6066 FORMAT('+',50X,'SAP ACTIVE')
      IF(I.EQ.7) WRITE(6,6067)
 6067 FORMAT('+',63X,'CP ACTIVE')
      IF(I.EQ.8) WRITE(6,6068)
 6068 FORMAT('+',75X,'QUIESCED')
   60 CONTINUE
C
C   FIND COUNT OF QED REQUESTS
C
      LT4=IDATA(4)
      LT2(2)=0
      LT4=LT4/256
      LT2(1)=0
      LT4=LT4/256
      IF(LIST) WRITE(6,6069) LT4
 6069 FORMAT('+',110X,'# QED REQUESTS=',I4)
      IF(ICT.LE.IMAX) COUNTS(ICT,11)=COUNTS(ICT,11)+LT4
C
C   WRITE UCB IN HEX
C
      IF(.NOT.LIST) GOTO 100
      WRITE(6,6020) (IDATA(I),I=2,7)
 6020 FORMAT(' UCB ',6(Z8,1X))
      IF(L1.EQ.17) WRITE(6,6021) (IDATA(I),I=12,17)
 6021 FORMAT(' DDS ',6(Z8,1X))
      WRITE(6,6022) (IDATA(I),I=8,11)
 6022 FORMAT(' EXT ',4(Z8,1X))
      GOTO 100
  200 CONTINUE
      IF(FIRST) GOTO 999
      WRITE(6,6100) DATE
 6100 FORMAT('1UCB AVERAGES ON ',A8,/,1X)
      WRITE(8,8000) DATE
 8000 FORMAT('0UCB AVERAGES ON ',A8,/,1X)
      WRITE(6,6102) NCALLS
 6102 FORMAT(' NO OF CALLS = ',I4,/,1X)
      WRITE(8,6102) NCALLS
      WRITE(6,6101)
 6101 FORMAT(' UNIT  VOLSER  BUSY  NOT READY  POST  SENSE  CU BUSY',
     *'  SAP ACT  CP ACT  QUIESCED  ONLINE  REWIND  QED REQT',/,1X)
      WRITE(8,6101)
      DO 300 I=1,IMAX
      IF(UNNO(I).EQ.BLNK4) GOTO 300
      DO 301 J=1,11
      RCNTS(J)=COUNTS(I,J)
      RCNTS(J)=RCNTS(J)/NCALLS
  301 CONTINUE
      WRITE(6,6103) UNNO(I),(SNPVOL(J,I),J=1,2),(RCNTS(J),J=1,11)
 6103 FORMAT(1X,A4,2X,2A4,F4.2,4X,F4.2,5X,F4.2,3X,F4.2,3X,F4.2,
     *5X,F4.2,4X,F4.2,5X,F4.2,5X,F4.2,4X,F4.2,5X,F4.2)
      WRITE(8,6103) UNNO(I),(SNPVOL(J,I),J=1,2),(RCNTS(J),J=1,11)
  300 CONTINUE
      WRITE(8,6030)
      WRITE(6,6030)
 6030 FORMAT('0END OF UCB TRACE')
  999 CONTINUE
      RETURN
      END
      SUBROUTINE DUM1
      ENTRY ANLA
      ENTRY ANLB
      ENTRY ANLC
      ENTRY ANLD
      ENTRY ANLE
      ENTRY ANLF
      ENTRY ANLG
      ENTRY ANLH
      ENTRY ANLI
      ENTRY ANLJ
      ENTRY ANLK
      RETURN
      END
      SUBROUTINE DUM2
      ENTRY ANLL
      ENTRY ANLM
      ENTRY ANLN
      ENTRY ANLO
      ENTRY ANLV
      ENTRY ANLW
      ENTRY ANLX
      ENTRY ANLY
      ENTRY ANLZ
      RETURN
      END

1









 OUR MF USER DOCUMENTATION



 VERSION 1.0  JUNE 77

  HOWARD GILBERT
  YALE COMPUTER CENTER
  175 WHITNEY AVE.
  NEW HAVEN, CT. 06520



 CONTENTS:

      I        INSTALLATION INSTRUCTIONS

      II       OPERATIONS

      III      STORAGE AND TIME ESTIMATES

      IV       PARAMETER DATASET

      V        DESIGN

      VI       GENERATION PARAMETERS

      VII      DATA AREAS

      VIII     OUTPUT DOCUMENTATION - CPU COMMAND

      IX       OUTPUT DOCUMENTATION - WKLOAD COMMAND

      X        OUTPUT DOCUMENTATION - PAGES, RCT, AND DMN

      XI       OURMF TRACE RECORDS

      XII      WRITING POST-PROCESSORS

      XIII     COMPONENT INDEX

      APNDX    ASMTOZAP

1                             OUR-MF GUIDE                       PAGE 1





                     OUR-MF INSTALLATION PROCEDURE



 A) THE NECESSARY STEPS



      PREREQUISITES:

           MVS R3.7

           SUPERVISOR 2  ( SU 7 )

           PLI OPTIMIZING COMPLIER AND LIBRARIES R3.0

               (CAN BE LINKEDITED WITH ONLY R2 LIBRARY)



  AUXILIARY STORAGE REQUIREMENTS:

  DSN               TRK  DIR  COMMENTS

  SYS1.OURMFSRC     98   5    HOLDS THE SOURCE AND OBJECT DURING

                              INSTALLATION. CAN BE MOVED OFFLINE

                              LATER.

  SYS1.LPALIB        1   1    MEMBERS ADDED: STATDIE,

                                STATSTDE,STATWAMT,DIEPURG

  SYS1.LINKLIB      18   2    MEMBERS ADDED: CPU,DMN,

                                RCT,PAGES,OMFPST2,OURMF,WKLOAD

  SYS1.PARMLIB      1    1    MEMBER ADDED: OMFPRM00

  SYS1.OURMF.DISK   150       COULD BE SMALLER IF NECESSARY.



      OUR-MF IS DISTRIBUTED AS A SINGLE TAPE FILE OF CARD IMAGE MEMBERS

 OF A PDS IN IEBUPDTE SYSIN FORMAT.  INDIVIDUAL MEMBERS MAY BE


1                             OUR-MF GUIDE                       PAGE 2





 PROCEDURES, ASSEMBLER SUBROUTINES, PLI MACROS, BILINGUAL MACROS, JCL,

 OBJECT DECKS, OR DOCUMENTATION.  THIS FILE MAY BE LOADED WITH THE

 FOLLOWING JCL:

     // EXEC PGM=IEBUPDTE,PARM=NEW
     //SYSPRINT DD DUMMY
     //SYSUT2 DD DSN=SYS1.OURMFSRC,DISP=(,CATLG),UNIT=SYSDA,
     //       SPACE=(TRK,(100,20,5)),
     //       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
     //SYSIN DD

 THE SPECIFIC FORM FOR THE SYSIN CARD WILL VARY DEPENDING UPON THE

 MODS-TAPE OR OTHER DISTRIBUTION MATERIAL YOU HAVE RECEIVED.

      THE JOB IN MEMBER OURMFJOB WILL LINKEDIT THE VARIOUS OURMF

 MODULES INTO THE LPALIB AND LINKLIB OF THE RECEIVING SYSTEM USING THE

 DISTRIBUTED OBJECT DECKS.  THIS JOB IS IMPLICITLY FULL DOCUMENTATION

 ON THE LINKAGE EDITOR OPTIONS AND CONTROL CARDS APPROPRIATE FOR EACH

 OURMF COMPONENT. THERE ARE COMMENT CARDS AT THE BEGINNING OF THE

 OURMFJOB WHICH COMPLETE THE INSTALLATION DOCUMENTATION. THEY HIGHLIGHT

 THOSE ITEMS IN THE JOBSTREAM WHICH ARE SUBJECT TO LOCAL VALIDATION.

 THE JOB SHOULD BE PRINTED OUT AND REVIEWED PRIOR TO SUBMITTAL.

      OURMFJOB CONTAINS AN OPTIONAL PTF TO MF1 WORKLOAD COLLECTION. IT

 SUPPORTS THE WKLOAD COMMAND AND OURMF WORKLOAD RECORD, AND ESSENTIALLY

 MAKES MF1 ALMOST AS SMART AS RMF IN WORKLOAD REPORTING. YOU MAY OMIT

 THIS PTF IF YOU NEED TO, BUT IT COMES HIGHLY RECOMMENDED.

      PRIOR TO ACTIVATING OURMF FOR THE FIRST TIME YOU HAVE FIVE SMALL

 TASKS TO PERFORM.

      1) PUT A STATDIE PROC IN SYS1.PROCLIB.  IT NEEDS ONLY ONE CARD:

        //STATDIE EXEC PGM=STATDIE

      2) ALLOCATE A DISK DATASET FOR THE OURMF RECORDS.  A SUGGESTION

 IS:

1                             OUR-MF GUIDE                       PAGE 3





        //DD1 DD DSN=SYS1.OURMF.DISK,DISP=(,CATLG),UNIT=SYSDA
        //  SPACE=(TRK,(50,20))


      3) ADD AN OURMF PROC TO PROCLIB.  A SUGGESTION IS:

        //OURMF EXEC PGM=OURMF,REGION=100K,TIME=1440
        //SYSPRINT DD SYSOUT=A
        //OUT   DD DSN=SYS1.OURMF.DISK,DISP=MOD
        //OLD   DD DSN=SYS1.OURMF.DISK,DISP=OLD
        //SYSIN DD DSN=SYS1.PARMLIB(OURMF00),
        // DISP=SHR,FREE=CLOSE


      4) ADD A OURMF00 TO PARMLIB.  A SUGGESTION IS:

       /* THIS IS AN EMPTY MEMBER. ALL THE DEFAULTS
           WILL BE USED */



      5) CLPA TO PUT STATDIE INTO THE LPA.



 B) OPTIONAL BUT RECOMMENDED STEPS



      THE JOB IN MEMBER OMFCMPL WILL  COMPILE ALL RELEVANT PLI ROUTINES

 AND  ASSEMBLE  THE TWO  ASSEMBLER  MODULES.   SINCE OBJECT  DECKS  ARE

 INCLUDED AS  MEMBERS OF THE PDS,  THIS JOB IS OPTIONAL.   HOWEVER, THE

 LISTINGS PRODUCED WILL BE HELPFUL IN DOCUMENTING AND UNDERSTANDING THE

 OUR-MF SYSTEM.

      THE  OMFCMPL JOB CONTAINS CORRECT  JCL FOR THE SYSLIB  DDCARD, BUT

 THE PROBLEMS ASSOCIATED WITH SYSLIB PROBABLY NEED FURTHER EXPLANATION.

 SYS1.OURMFSRC MUST BE THE SYSLIB DATASET  FOR THE PLI COMPILES, AND IT

 SHOULD  BE  THE  LAST  MEMBER OF  THE  SYSLIB  CONCATENATION  FOR  THE

 ASSEMBLIES.  AS INDICATED IN THE  COMPONENT INDEX (CHAPTER XIII), SOME

 OF THE MAPPING MACROS IN OURMFSRC ARE  PLI-ONLY AND HAVE THE SAME NAME

1                             OUR-MF GUIDE                       PAGE 4





 AS OTHER MACROS IN MACLIB AND  AMODGEN. THUS ASSEMBLY ERRORS MAY OCCUR

 IF OURMFSRC IS  CONCATENATED BEFORE THESE OTHER  TWO LIBRARIES.  THREE

 MEMBERS FROM  PVTMACS ARE REPRODUCED  UNMODIFIED IN  OURMFSRC: IRARCT,

 IHATQE, AND IRADMDT.  THESE ARE AT THE SU 7 LEVEL.  IT IS THEREFORE AN

 ERROR TO  CONCATENATE OURMFSRC AFTER A  PVTMACS DATASET FROM  THE BASE

 3.7 OPTIONAL TAPES, BUT IT IS NOT INCORRECT IF THE PVTMACS DATASET HAS

 BEEN UPDATED BY  THE APPROPRIATE FILES ON THE SU  OPTIONAL TAPES.  THE

 BLKSIZE  OF  SYSLIB  IS  RELATED TO  THE SIZE   PARAMETER OF  THE PLIX

 COMPILER.  IF  YOU INCREASE THE  BLKSIZE OF  OURMFSRC YOU MAY  HAVE TO

 CHANGE THE PARM FIELD FOR PLI TO ALLOW MORE FREE SPACE.



 C) CHANGE CONTROL TOPICS



      THE OPTIONAL  ZAP TO  MF1 IS  THE ONLY  MODIFICATION TO  IBM CODE

 PROVIDED WITH  OUR-MF. MANY  SHOPS MAY  BE RUNNING  RMF INSTEAD,  SO A

 CHANGE TO  MF1 WOULD NOT  REQUIRE EXTENSIVE  CHECKING PRIOR TO  A TEST

 INSTALLATION. STILL, THE ZAP  RUNS IN KEY 0 AND MAY  THEREFORE HAVE TO

 BE READ  THROUGH. THE  ONLY DOCUMENTATION  ON THE  LPA SEARCH  ROUTINE

 CALLED BY THE ZAP IS IN THE  COMMENT CARDS IN MODULE IEAVLK00 OF WHICH

 THE SEARCH ROUTINE  IEAVVMSR IS AN ENTRY POINT. THIS  INTERFACE IS NOT

 EXACTLY PUBLIC, BUT IT  IS USED BY THE LOADER, EDIT,  THE TMP MAINLINE

 ROUTINE, AND  ENOUGH OTHER PLACES THAT  IT COULD NOT CHANGE  SIMPLY BY

 SOME PTF.

      THE ONLY OTHER KEY  0 CODE IN OURMF IS IN  THE STATDIE MODULE. TO

 SIMPLIFY CHANGE  CONTROL VALIDATION AND  TO PERMIT  EASY MODIFICATION,


1                             OUR-MF GUIDE                       PAGE 5





 EXTENSIVE EFFORT HAS  BEEN PUT INTO THE  STRUCTURING AND DOCUMENTATION

 OF THAT CODE. STILL, INSTALLATIONS  WITH REQUIREMENTS ABOUT INSTALLING

 KEY 0 CODE  WILL HAVE TO REVIEW  THE WHOLE 2K OF  INSTRUCTIONS IN THAT

 MODULE.



 D) SUPPORT PROGRAMS



      ANY NON-TRIVIAL ZAP AT YALE IS WRITTEN USING ASMTOZAP.  THIS IS A

 VERY SIMPLE PLI  PROGRAM WHICH READS IN THE  SYSPRINT DATASET PRODUCED

 BY THE  IBM XF ASSEMBLER AND  PRODUCES AMASPZAP CONTROL CARDS.   A FEW

 ASMTOZAP CONTROL CARDS  EXIST.  THEY ARE WRITTEN  AS ASSEMBLER COMMENT

 STATEMENTS  IN  THE  ORIGINAL  ASSEMBLER  INPUT  FILE.   THE  ASMTOZAP

 DOCUMENTATION IS INCLUDED  AS AN APPENDIX TO  THE OURMF DOCUMENTATION.

 THE ASMTOZAP  SOURCE IS DISTRIBUTED  IN OURMFSRC, THE  MEMBER IRBMFDWP

 CONTAINS  ASSEMBLER INPUT  WHICH  CREATED THE  OPTIONAL  PTF, AND  THE

 MEMBER ASZAPJCL  CONTAINS A JOB WHICH  WILL RUN ASMTOZAP  TO REPRODUCE

 THE PTF.



 )E MULTIPROCESSORS



      THE STATDIE  PROGRAM OBTAINS ALL  THE NECESSARY LOCKS  FOR PROPER

 OPERATION IN AN MP ENVIRONMENT. HOWEVER, A DIE ROUTINE WILL ALWAYS GET

 CONTROL ON CPU 0 DUE TO THE  DESIGN OF TIMER MANAGEMENT. THUS THE DATA

 COLLECTED  ON CPU  UTILITZATION  WILL  SPECIFICALLY REFLECT  ONLY  THE


1                             OUR-MF GUIDE                       PAGE 6





 ACTIVITY ON  CPU 0 OF  AN MP OR AP  ENVIRONMENT. WHILE THE  AUTHOR HAS

 SOME STRONG IDEAS CONCERNING MP SUPPORT, IT IS NOT POSSIBLE TO DEVELOP

 THAT  SUPPORT  AT  YALE.  IF  ANY  USER  IS  SERIOUSLY  INTERESTED  IN

 DEVELOPING MP SUPPORT, HE SHOULD CONTACT HOWARD GILBERT FOR THE LATEST

 NEWS AND SUGGESTIONS.
















1                             OUR-MF GUIDE                       PAGE 7





                               OPERATIONS



      THIS  DISCUSSION  ASSUMES  YOU HAVE  COMPLETED  THE  INSTALLATION

 PROCEDURE DOCUMENTED IN  CHAPTER I AND HAVE INSTALLED  THE STATDIE AND

 OURMF PROCEDURES  IN PROCLIB. THE STATDIE  MODULE IS ASSUMED TO  BE IN

 LPALIB   AND  THE   OTHER  MODULES   ARE  SOMEWHERE   IN  THE   LNKLST

 CONCATENATION.

      FIRST, A  NOTE ON  PROGRAM INTERDEPENDENCIES.  THE RCT,  DMN, AND

 PAGES PROGRAMS  ARE INDEPENDENT OF EVERYTHING  AND CAN BE RUN  WITH OR

 WITHOUT THE OTHER OUR-MF PROGRAMS. IT IS  RECOMMENDED THAT THEY BE USED

 IN TSO AS COMMANDS. THEY HAVE NO PARAMETERS. THEY ASSUME THAT SYSPRINT

 IS ALREADY ALLOCATED  TO THE TERMINAL, AS  WOULD BE TRUE IF  THE LOGON

 PROCEDURE CONTAINS A DDCARD:

      //SYSPRINT DD TERM=TS
 STATDIE, ISSUE THE OPERATOR COMMAND:

                S STATDIE

 THE STATDIE JOB WILL START UP  AND END ALMOST IMMEDIATELY. THE STATDIE

 ADDRESS  SPACE  IS  USED  ONLY  DURING  INITIALIZATION.  THE  PERIODIC

 SAMPLING WILL  CONTINUE UNDER  CONTROL OF  A TIMER  DISABLED INTERRUPT

 EXIT (DIE) ROUTINE. THE DIE IS NOT RELATED TO ANY TASK, JOB OR ADDRESS

 SPACE. IT WILL CONTINUE TO RUN, UNLESS STOPPED, TILL THE NEXT IPL. THE


1                             OUR-MF GUIDE                       PAGE 8





 DIE CANNOT BE DISPLAYED  BY ANY MVS OR JES COMMAND.  THE CPU AND OURMF

 PROGRAMS CHECK THE  DIE TO INSURE IT  IS STILL ALIVE AND  WELL. SHOULD

 THE DIE  TERMINATE DUE TO  AN ERROR, OURMF  WILL DETECT THE  ERROR AND

 TERMINATE ITSELF.  NORMALLY ONE DOES  NOT STOP THE  DIE, BUT IF  IT IS

 DESIRABLE TO DO SO FOR ANY REASON, SUBMIT THE FOLLOWING JCL:

      //DIEPURG EXEC PGM=DIEPURG

 THE DIEPURG ENTRY POINT OF THE STATDIE MODULE  STOPS THE DIE AND FREES

 THE PAGABLE  DATA AREAS.  AFTER THE  DIE HAS  BEEN STOPPED  IT CAN  BE

 RESTARTED BY STATDIE AGAIN.

      TO START OURMF, ISSUE THE COMMAND:

                S OURMF

 STATDIE MUST BE STARTED AND IT IS  SUGGESTED THAT MF1 ALSO BE STARTED.

 SINCE IT  IS FREQUENTLY DESIRABLE TO  PUT ALL THREE START  COMMANDS IN

 THE LIST  OF COMMANDS ISSUED AUTOMATICALLY  AT IPL, AND  THE RESULTING

 ORDER OF  INITIALIZATION IS RANDOM, OURMF  WILL WAIT 60  SECONDS AFTER

 BEING STARTED  BEFORE IT ACTUALLY  BEGINS PROCESSING. THIS  PAUSE WILL

 GIVE THE OTHER TWO PROGRAMS A HEAD START.

      TO STOP OURMF ISSUE THE OPERATOR COMMAND:

                P OURMF

      OURMF COPIES DATA  FROM CORE TO A DISK  DATASET. PERIODICALLY THE

 DISK  DATASET  BECOMES  FULL,  AND   OURMF  DYNAMICALLY  ALLOCATES  AN

 INSTALLATION SPECIFIED  TAPE DATASET AND COPIES  THE DISK DATA  TO IT.

 WHEN THIS OCCURS, THE OPERATOR WILL GET A MESSAGE:

  IEF455D MOUNT VOLSER ON ADR FOR OURMF,OURMF OR REPLY 'NO'

 THIS WTOR WILL BE CANCELLED AS SOON AS THE TAPE IS MOUNTED. OURMF WILL

 ALSO ALLOCATE  THE TAPE AT INITIALIZATION  IF THE DISK DATASET  IS NOT


1                             OUR-MF GUIDE                       PAGE 9





 ALREADY EMPTY, AND AFTER RECEIVING AN OPERATOR 'P' COMMAND. IF YOU ARE

 IN A RUSH TO  STOP OURMF IT IS PERFECTLY ALRIGHT TO  REPLY 'NO' TO THE

 IEF455D MESSAGE. OURMF WILL SIMPLY  POSTPONE EMPTYING THE DISK DATASET

 UNTIL THE NEXT TIME IT IS STARTED.

      THE CPU, WKLOAD, AND PAGES MODULES ARE INTENDED  PRIMARILY FOR USE

 AS TSO COMMANDS. SINCE THEY WRITE TO  SYSPRINT THEY CAN ALSO BE RUN IN

 BATCH  IF TSO  IS  NOT  AVAILABLE OR  WHEN  HARDCOPY  IS DESIRED.  FOR

 EXAMPLE:

      //CPU EXEC PGM=CPU

      //SYSPRINT DD SYSOUT=A

 AND SIMILARLY FOR ALL THE OTHERS.












1                             OUR-MF GUIDE                      PAGE 10





 _________________________________
 OUR-MF STORAGE AND TIME ESTIMATES



 STATDIE:

         FIXED STORAGE:             4K

         PAGEABLE COMMON STORAGE:  40K

         PRIVATE STORAGE:   NONE (NO ADDRESS SPACE)

      THE ESTIMATION OF STATDIE CPU UTILIZATION IS RATHER TRICKY.

 THERE ARE 275 INSTRUCTIONS FROM THE TIMER INTERRUPT TO THE DIE ENTRY

 POINT.  THE PATH LENGTH THROUGH THE DIE IS VARIABLE, BUT THERE IS A

 STCK AT THE BEGINNING AND END AND AN ELAPSED TIME CALCULATION.  THERE

 ARE A MINIMUM OF 75 INSTRUCTIONS IN BACKEND PROCESSING AND REDISPATCH

 (THIS IS THE TIME TO REDISPATCH THE WAIT TASK ON AN IDLE MACHINE).  AT

 YALE, ON AN IBM 158 MODEL 1 UNIPROCESSOR WE FIND THAT THE DIE ITSELF

 CONSUMES NO MORE THAN 3.7 SECONDS OF CPU PER HOUR OF OPERATION.  ONE

 MUST ADD IN THE INTERRUPT AND REDISPATCH TIME FOR WHICH  WE HAVE NO

 USABLE AVERAGE MEASURE. STILL, AT 4 SAMPLES PER SECOND ONE CAN STATE

 WITH CONFIDENCE THAT THE STATDIE OVERHEAD SHOULD BE LESS THAN .2% OF

 THE CPU.



 OUR-MF:

       THE BASIC COST OF OUR-MF IS ONE SWAPPED OUT ADDRESS SPACE AND

 ITS ASSOCIATED CONTROL BLOCKS.  IT WILL RUN ALL DAY AND NOT CONSUME 30

 SECONDS OF CPU.  IT HAS A MINIMAL WORKING SET SIZE.  IT IS SWAPPED IN

 ONCE EVERY 15 MINUTES.


1                             OUR-MF GUIDE                      PAGE 11





 _________________
 OUR-MF PARAMETERS

      DURING INITIALIZATION, OUR-MF READS IN PARAMETERS FROM DDNAME

 SYSIN.  THE SYNTAX FOR THESE CARDS IS IDENTICAL TO THE MF1 PARAMETER

 SYNTAX IN IRBMF100, EXCEPT THE KEYWORDS ARE DIFFERENT.  THE CURRENTLY

 SUPPORTED KEYWORDS ARE:



 TUNIT     A UNIT NAME FOR THE ALLOCATION OF THE TAPE SPILL FILE WHEN

            THE DISK DATASET FILLS UP.

 TDSN      A DATASET NAME FOR THE TAPE SPILL FILE.

 DISKSIZE  THE MAXIMUM NUMBER OF RECORDS TO BE WRITTEN TO DISK BEFORE

            COPYING THE DISK DATASET TO THE END OF THE TAPE SPILL FILE.

 INTERVAL  THE LENGTH OF TIME OURMF IS TO REMAIN SWAPPED OUT BETWEEN

            GROUPS OF TRACE RECORDS.  THIS VALUE SHOULD BE THE SAME AS

            THE MF1 INTERVAL, AND IT IS HIGHLY RECOMMENDED THAT BOTH BE

            15.



 DEFAULTS:



 TUNIT(TAPE)                      /* UNIT=TAPE*/
 TDSN(SYS1.OURMF.TAPE)            /* DSN=ETC */
 DISKSIZE(300)                    /* SPACE=(2000,(300,5)) AT LEAST
                                     FOR THE DATASET ALLOCATED TO
                                     DDNAMES 'OUT' AND 'OLD' */
 INTERVAL(15)





1                             OUR-MF GUIDE                      PAGE 12





                             _____________
                             OUR-MF DESIGN



     (NOTE: THIS DOCUMENT WAS PREPARED PRIOR TO THE
      ANNOUNCEMENT OF RMF R2, AND SO ALL REFERENCES
      TO RMF ARE TO RELEASE 1.)



      WHAT IS A MEASUREMENT FACILITY?  BASED ON THE TWO PREVIOUS

 EXAMPLES WE CAN GENERALLY STATE THAT AN MF HAS FOUR COMPONENTS.



      1) THERE IS A MEASUREMENT TASK RUNNING AS A STARTED TASK IN ITS

 OWN ADDRESS SPACE.  THIS JOB SPENDS MOST OF ITS TIME SWAPPED OUT IN

 LONG WAIT UNDER A STIMER.  IN REGULAR INTERVALS IT WAKES UP, GATHERS

 SOME NUMBERS OUT OF VARIOUS CONTROL BLOCKS, AND BUILDS RECORDS TO

 WRITE TO A DATASET.

      2) THERE IS A REALTIME REPORT GENERATOR WHICH GETS CONTROL FROM

 THE MEASUREMENT TASK IF THE USER REQUESTS FORMATTED PRINTED REPORTS.

 IT FORMATS THE INFORMATION IN THE RECORDS BUILT BY THE MEASUREMENT

 TASK.

      3) THERE IS A TIMER DISABLED INTERRUPT EXIT.  THIS IS AN EXIT

 ESTABLISHED BY THE SUPERVISOR SERVICE SETDIE WHICH GETS CONTROL FROM

 THE TIMER INTERRUPT HANDLER IN REGULAR FREQUENT INTERVALS.  IT

 EXAMINES DATA IN VARIOUS SYSTEM CONTROL BLOCKS, COUNTS ENTRIES IN

 IMPORTANT QUEUES, AND POSSIBLY TESTS IO STATUS.  THE MF1 DIE ONLY

 GATHERS CHANNEL BUSY AND DEVICE BUSY INFORMATION.  THE RMF DIE WOULD

 APPEAR TO ALSO IMPLEMENT TRACE AND TABULATE  FRAME AND SLOT ALLOCATION

 INFORMATION.

     4) THERE MAY BE A POST-PROCESOR.  THIS COMPONENT PRODUCES SOME


1                             OUR-MF GUIDE                      PAGE 13





 KIND OF REPORT BASED ON THE RECORDS WRITTEN BY THE MEASUREMENT TASK.



      WE AT YALE HAD A NUMBER OF SPECIFIC OBJECTIONS TO THE DESIGN OF

 EXISTING  MEASUREMENT FACILITIES. OUR-MF STARTED AS ISOLATED PIECES OF

 CODE INTENDED TO SUPPLEMENT MF1 AND RMF TO ACHIEVE OUR LOCAL

 OBJECTIVES.  GRADUALLY IT GREW INTO A MEASUREMENT FACILITY IN ITS OWN

 RIGHT.

      OBJECTION 1:  THE REAL TIME REPORTS WERE USUALLY A WASTE OF

 PAPER.  ONE HAD ONLY THREE POSSIBLE ALTERNATIVES:  TO PRINT OUT

 REPORTS CONTINUOUSLY AND FILL UP BOXES OF PAPER WITH REPORTS NO-ONE

 EVER READ, TO DEFER OUTPUT IN A SPECIAL SYSOUT QUEUE WHICH MUST BE

 PERIODICALLY EMPTIED, AND WHICH GUSHES ONTO ALL AVAILABLE PRINTERS

 WITH EVERYTHING RECORDED TODAY WHEN ONE DECIDES IT IS IMPORTANT TO SEE

 THE LAST REPORT GENERATED. OF COURSE THE THIRD ALTERNATIVE IS TO GET

 NO REPORTS AT ALL. NONE OF THESE ALTERNATIVES MET THE SIMPLE NEED TO

 HAVE THE INFORMATION AVAILABLE IMMEDIATELY BUT ONLY WHEN IT WAS

 SPECIFICALLY REQUESTED.

      OBJECTION 2:  THE AVAILABLE POST-PROCESSORS COMPOUNDED THE

 PREVIOUS OBJECTION. THEY SIMPLY REPRODUCED THE REAL TIME REPORTS WHILE

 PROVIDING NO USEFUL SUMMARY CAPABILITY OR STATISTICAL ANALYSIS.

 FURTHERMORE, BY REFUSING TO ALLOW YALE TO DISTRIBUTE PLI MAPPING

 MACROS FOR THE RMF RECORDS, IBM MADE IT IMPOSSIBLE FOR MANY USERS TO

 DEVELOP SENSIBLE POST PROCESSORS THEMSELVES.

      OBJECTION 3:  THE TIMER DIE HAD SOME BAD DESIGN AND

 INFLEXIBILITY.  IT ALLOWED YOU TO MEASURE ONLY WHAT IBM WAS INTERESTED


1                             OUR-MF GUIDE                      PAGE 14





 IN LETTING YOU MEASURE.  IT WAS NOT POSSIBLE TO EASILY MODIFY IT TO

 EXTEND ITS CAPABILITIES.  AND BASED ON THE STORAGE ESTIMATES SECTION

 OF THE RMF REFERENCE AND USER'S GUIDE SC28-0740 IT APPEARS THAT THE

 TRACE DATA GATHERED BY THE DIE REMAINS IN FIXED STORAGE FOR THE ENTIRE

 REPORTING INTERVAL, WHICH COULD BECOME EXPENSIVE IF THE NUMBER OF

 TRACED FIELDS INCREASES.

      OBJECTION 4: THERE WAS AN IMPORTANT TUNING PRINCIPLE WHICH WAS

 NOT EMBODIED IN THE DESIGNS OF EITHER PREVIOUS MEASUREMENT FACILITY.

     'WHILE EVERYONE SHARES A CERTAIN COLLECTION OF COMMON PERFORMANCE
     PROBLEMS, THE BIGGEST HEADACHES IN ANY ONE SHOP ARE PROBABLY
     HOME-GROWN.  A TUNING TOOL MUST HAVE THE FLEXIBILITY SO THAT IT
     CAN BE ADAPTED LOCALLY TO MEET THE LOCAL NEEDS.'


 OBVIOUSLY NO SYSTEM COMPONENT OR PROGRAM PRODUCT WILL MEET THIS DESIGN

 PRINCIPLE. WE ARE TALKING ABOUT LOCALLY WRITTEN OR MODIFIED CODE, AND

 IBM WILL NOT ENCOURAGE MODIFICATIONS TO A PROGRAM PRODUCT.

      OUR-MF DEVELOPED SPECIFIC APPROACHES TO MEETING EACH OBJECTION:

      1) INSTEAD OF GENERATING REPORTS IN THE MEASUREMENT TASK, OUR-MF

 KEEPS THE LAST 20 MINUTES WORTH OF DATA IN COMMON PAGEABLE STORAGE.

 THERE ARE SEPARATE REPORT GENERATING MODULES WRITTEN IN PLI WHICH CAN

 LOCATE THE DATA AND WRITE SUMMARY TABLES TO SYSPRINT.  THEY CAN BE

 INVOKED AS TSO COMMANDS OR RUN IN THE BATCH. THUS REPORTS ARE

 AVAILABLE IMMEDIATELY TO 'SNAPSHOT' PERFORMANCE, BUT THEY ARE

 GENERATED ONLY ON DEMAND.

      2) POST PROCESSING IS LARGELY LEFT TO THE USER.  PLI MAPPING

 MACROS FOR OURMF RECORDS AND EXAMPLE POST PROCESSORS MAKE IT EASY TO

 BUILD A POST PROCESOR IN A FEW HOURS WHICH WILL REFLECT THE LOCAL

 PERFORMANCE GROUP AND DOMAIN DEFINITIONS AND HIGHLIGHT THE VARIABLES


1                             OUR-MF GUIDE                      PAGE 15
 YALE OR OTHER USERS AS OURMF USAGE GROWS.

      3) THE DIE HAS BEEN WRITTEN AS A SEPARATE AND TOTALLY INDEPENDENT

 ASSEMBLER LANGUAGE MODULE.  IT HAS BEEN WRITTEN SPECIFICALLY SO THAT

 OTHERS CAN EASILY MODIFY IT OR EVEN REPLACE THE ENTIRE DATA SAMPLING

 CODE WITH ALTERNATE SAMPLING LOGIC.  THE MODULE ACQUIRES NO PERMANENT

 GLOBAL RESOURCES AND SO IT IS POSSIBLE, BY SIMPLY CHANGING THE

 EXTERNAL NAMES AND ALIASES, TO DEVELOP SEVERAL DIE ROUTINES ALL BASED

 ON THE SAME MODEL.  ALL DATA AREAS USED BY THE DIE ARE DESCRIBED IN

 BILINGUAL (PLI AND ASSEMBLER) MAPPING MACROS.  THE CODE HAS BEEN

 WRITTEN SO THAT A CHANGE TO ONE OF THESE MACROS IS AUTOMATICALLY

 REFLLECTED IN ALL MODULES AFTER RECOMPILATION. WHILE CERTAIN REPORT

 GENERATORS MUST ASSUME THAT CERTAIN KINDS OF DATA ARE BEING GATHERED

 BY THE DIE, THE MEASUREMENT TASK, 'OURMF', DOESN'T  CARE AT ALL ABOUT

 THE CONTENTS OF THE TRACE BUFFERS PRODUCED BY THE DIE AND IT WILL COPY

 TO DISK AND TAPE ANYTHING YOU DECIDE TO TRACE.

      NOW HAVING EULOGIZED THE ADVANTAGES OF LOCALLY MODIFIED CODE IT

 IS NECESSARY TO RETURN TO REALITY AND TACK ON THREE FINAL DESIGN

 POINTS:

      1) IF WE WERE TO GO TO ALL THIS EFFORT, OUR-MF WOULD HAVE TO MEET

 ENOUGH OF OUR LOCAL TUNING OBJECTIVES THAT WE COULD DISPENSE WITH RMF

 ENTIRELY.  OUR-MF DOES NOT DO EVERYTHING RMF DOES, BUT IT MEETS OUR

 NEEDS AND POSSIBLY THOSE OF MANY OTHER USERS.

      2) MOST POTENTIAL RECIPIENTS WOULD NOT WANT TO MODIFY OUR-MF

 ANYWAY. THUS THE DISTRIBUTED PACKAGE SHOULD OFFER ENOUGH SIGNIFICANT


1                             OUR-MF GUIDE                      PAGE 16





 NEW FEATURES TO ATTRACT THEIR ATTETION 'AS IS.'

      3) FIRST IMPRESSIONS ARE LASTING.  OUR-MF HAS TO INSTALL SIMPLY

 AND EASILY ON THE RECEIVING SYSTEM.  THIS MEANS INSTALLATION FROM

 OBJECT DECKS WITH NO PREREQUISITE SYSTEM MODS (THERE IS AN OPTIONAL

 MF1 PTF).
















1                             OUR-MF GUIDE                      PAGE 17





                         GENERATION PARAMETERS



      THE OURMF CONSTANTS MOST SUBJECT TO CHANGE ARE GATHERED IN THE

 MEMBER 'STATGLBL' IN OURMFSRC. THESE VALUES ARE SPECIFIED TO PLI AT

 COMPILE TIME TO ENSURE MAXIMUM EFFICIENCY FOR THE EXECUTION OF THE TSO

 COMMANDS. THEY MAY BE CHANGED AND EVERYTHING RECOMPILED SUBJECT ONLY

 TO THE RESTRICTION ON THE SIZE OF THE STDE DATA AREA DOCUMENTED IN THE

 DATA AREAS CHAPTER. THE DISTRIBUTED VERSION OF THE PARAMETERS IS:

 *  % GOTO STATPARM1;
          MACRO
          STATGLBL
 * %STATPARM1:;
 */*
 * STATDIE PARAMETERS:                                               YCC
 *                                                                   YCC
 * THE FOLLOWING SECTION COLLECTS NUMERIC VALUES WHICH THE           YCC
 * AUTHOR REGARDS AS MOST LIKELY SUBJECT TO LOCAL MODIFICATION.      YCC
 * THIS IS NOT INTENDED TO BE A TRUE SYSTEM GENERATION OPTION,       YCC
 * BECAUSE THE VALUES CHOSEN BELOW ARE FAIRLY GENEROUS AND           YCC
 * SHOULD SERVICE MOST USERS AS IS. AS FEEDBACK DEVELOPS             YCC
 * ON THIS RELEASE, NEW OPTIONS MAY BE ADDED HERE LATER.             YCC
 *                                                                   YCC
 * PGBFCT    THIS IS THE NUBER OF PAGABLE BUFFERS TO BE ALLOCATED    YCC
 *           IN CSA. THIS IS THE RETENTION PERIOD OF THE INCORE      YCC
 *           AREA. IF THE SRB IS BEING DISPATCHED EVERY 30           YCC
 *           SECONDS THEN THE DEFAULT VALUE OF 40 MEANS THAT         YCC
 *           THE LAST 20 MINUTES OF DATA WILL BE IN VIRTUAL          YCC
 *           MEMORY AT ANY TIME. THE DELAY TIME OF OURMF MUST        YCC
 *           BE SHORT ENOUGH SO THAT THE BUFFERS ARE NOT             YCC
 *           REUSED BETWEEN SWAPS. THE DEFAULT SWAP TIME OF          YCC
 *           OURMF IS 15 MINUTES, WHICH LEAVES LOTS OF ROOM          YCC
 *           ALSO, THE CPU COMMAND DISPLAYS THE WHOLE INCORE         YCC
 *           AREA, SO SELECTION OF THIS PARAMETER EFFECTS THE        YCC
 *           PERIOD OVER WHICH CPU WILL AVERAGE FOR ITS REPORT.      YCC
 * SRBINTVL  THIS IS THE NUMBER OF SAMPLES WHICH ARE TAKEN           YCC
 *           BEFORE THE INCORE BUFFER IS COPIED TO ONE OF THE        YCC
 *           PAGABLE BUFFERS. EVERY SRBINTVL*MILLISC                 YCC
 *           MILLISECONDS THE SRB IS SCHEDULED. THIS ALSO            YCC
 *           EFFECTS THE SAMPLE PERIOD FOR RCT AND DOMAIN            YCC
 *           INFORMATION. THE DEFAULT VALUE OF 120 SETS THIS         YCC
 *           PERIOD TO EVERY 30 SECONDS.                             YCC
 * MILLISC  THIS IS THE NUMBER OF MILLISECONDS BETWEEN               YCC

1                             OUR-MF GUIDE                      PAGE 18





 *           TIMER POPS AND SETS THE PSW SAMPLING FREQUENCY.         YCC
 * MAXDMN    THIS IS THE MAXIMUM NUMBER OF DOMAINS TO BE             YCC
 *           TABULATED WHEN GATHERING DOMAIN MPLT AND RUA.           YCC
          GBLA  &MILLISC                                             YCC
 PGBFCT   EQU   40                 NUMBER OF PAGEABLE BUFFERS        YCC
 SRBINTVL EQU   120                NUMBER OF SAMPLES TILL SRB        YCC
 &MILLISC SETA  250                4 TIMES A SECOND                  YCC
 MAXDMN   EQU   10                                                   YCC
          MEND
   */
  %DCL (SRBINTVL,PGBFCT,MAXDMN,MILLISC) FIXED;
   % PGBFCT=40;
   % SRBINTVL=120;
   % MAXDMN=10;
   % MILLISC=250;














F1                            OUR-MF GUIDE                      PAGE 19





                               DATA AREAS

     LPA DIRECTORY

     'STATSTDE'       ->    STDE

                            STDEBUFP  ->   PGBUF

     'STATWAMT'       ->    STDEWAMT  ->   WAMT BUFFER



      THERE ARE THREE OURMF CONTROL BLOCKS:  THE DIE FIXED WORKAREA

 (STDE), THE PAGEABLE COMMON BUFFERS (PGBUF), AND THE WAMT BUFFER.  THE

 STDE IS ASSEMBLED INTO THE STATDIE MODULE IN THE LPA, AND ITS ORIGIN

 IS KNOWN BY THE  ALIAS STATSTDE.  THUS OTHER MODULES CAN LOCATE THE

 STDE BY USING THE LOAD MACRO OR BY CALLING THE DISTRIBUTED SUBROUTINE

 LOADPTR.

      LOAD EP=STATSTDE

          OR

      CALL LOADPTR('STATSTDE', PTRVARIABLE);

 THE PGBUF ARRAY AND THE WAMT BUFFER ARE GETMAINED FROM PAGEABLE COMMON

 STORAGE BY THE STATDIE INITIALIZATION ENTRY POINT, AND THEIR ADDRESSES

 ARE STORED AT OFFSETS INTO THE STDE.  THE PGBUF ARRAY ORIGIN IS STORED

 IN THE DATA FIELD STDEBUFP, AND THE WAMT BUFFER ADDRESS IS STORED IN

 STDEWAMT.  SINCE THE OFFSETS IN THE STDE ARE SUBJECT TO CHANGE, AND

 THE WAMT BUFFER MUST BE LOCATED BY THE CODE ZAPPED INTO IRBMFDWP, THE

 STDEWAMT LOCATION IS ALSO KNOWN BY THE EXTERNAL NAME STATWAMT AND THIS

 IS ALSO AN ALIAS IN THE LPA.  THUS ONE CAN MODIFY THE STDE WITHOUT

 HAVING TO REWORK THE ZAP.




1                             OUR-MF GUIDE                      PAGE 20





      THERE IS ALSO A DSECT AND SUBSTRUCTURE DEFINED BY MACRO 'STATPSW'

 IN OURMFSRC.  THIS IS NOT A DATA AREA, BUT DESCRIBES THE DATA STORED

 BY ONE DIE SAMPLE INTO THE FIXED DATA BUFFER OF THE STDE AND

 SUBSEQUENTLY MOVED TO THE PGBUF ARRAY.  CURRENTLY THE PSW IS 16 BYTES

 AND CONSISTS OF AN EXTERNAL OLD PSW OVERLAYED IN PART WITH SOME

 SOFTWARE INFORMATION AND A CDENAME FOR THE CURRENT PROGRAM.

      ANY CHANGE IN THE SIZE OF THE PSW AUTOMATICALLY PRODUCES A

 CORRESPONDING ADJUSTMENT IN THE STDE AND PGBUF SIZES UPON A

 RECOMPILATION.  THERE IS ONLY ONE RESTRICTION.  THE STATDIE MODULE IS

 DESIGNED TO BE EXACTLY 4K LONG.  IF IT BECOMES NECESSARY TO EXTEND IT

 BEYOND 4K, A LITTLE RECODING WILL BE NECESSARY.  FIRST THE GOOD NEWS.

 THE STDE ALWAYS HAS ITS OWN BASE REGISTER (6).  AND THE PSW ARRAY IS

 EFFECTIVELY THE LAST THING IN THE STDE.  AND THE ADDRESS OF THE NEXT

 PSW IS CALCULATED AND LEFT IN REGISTER 2.  STATDIE WAS WRITTEN SO THAT

 THE STDE IS MOVABLE AND EXPANDABLE.

      NOW THE BAD NEWS.  THERE ARE A FEW PLACES WHERE AN 8K STDE WOULD

 PRODUCE AN ERROR. FIRST, YOU MUST EXTEND THE LONG TERM FIX CODE TO FIX

 MORE THAN ONE PAGE (OR PUT STATDIE IN THE FIXED LPA).  SECOND, GO BACK

 AND CORRECT THE 3 OR 4 BASE-DISPLACEMENT ERRORS GENERATED BY

 REFERENCES TO LOCATIONS THAT ARE NO LONGER ADDRESSABLE.  STATDIE WAS

 WRITTEN TO MILDLY DISCOURAGE SUCH EXPANSION.

      A BETTER STRATEGY IS THIS:  EVERY TIME YOU DOUBLE THE SIZE OF THE

 PSW, YOU DOUBLE THE INTERVAL BETWEEN SAMPLES AND HALVE THE COUNT OF

 PAGEABLE BUFFERS.  ALTERNATELY YOU CAN HALVE THE SIZE OF THE FIXED

 BUFFER AND DOUBLE THE NUMBER OF PAGEABLE BUFFERS.  SO YOU CAN PUT A

 LOT OF DATA IN THE PSW WITHOUT INCREASING THE STDE.  IF THE GLOBAL


1                             OUR-MF GUIDE                      PAGE 21





 PARAMETERS IN STATGLBL ARE SET:


     MILLISC     EQU    1000   ONCE A SECOND SAMPLING
     SRBINTVL    EQU      15   EMPTY EVERY 15 SECONDS
     PGBUFCT     EQU      80   80 PACKAGE BUFFERS


 THEN WITH A LITTLE ADJUSTMENT YOU COULD GATHER 128 BYTES OF DATA PER

 SAMPLE IN THE SAME SIZED STDE.
















1                             OUR-MF GUIDE                      PAGE 22





 /********************************************************************/
 /* STDE: THE STATDIE FIXED DATA AREA                                */
 /* STORAGE FOR THIS CONTROL BLOCK IS ASSEMBLED INTO THE             */
 /*    STATDIE MODULE AT ENTRY POINT 'STATSTDE'.                     */
 /* METHOD OF ACCESS:                                                */
 /*    ASSEMBLER: THIS MACRO EXPANDS TO A DSECT 'STDE'. YOU          */
 /*    CAN LOCATE THE DATA AREA BY A                                 */
 /*            LOAD EP=STATSTDE                                      */
 /*            LR    RX,R0                                           */
 /*            USING STDE,RX                                         */
 /*     PLIX :   DCL STDEPTR PTR;                                    */
 /*              CALL LOADPTR('STATSTDE',STDEPTR);                   */
 /* DEPENDENCIES: USES VALUES SPECIFIED IN 'STATGLBL' AND 'STATPSW'  */
 /*     DSECTS.                                                      */
 /* VERSION DATE: MAY 26,1977                                        */
 /********************************************************************/
 DCL 1 STDE BASED(STDEPTR),
    5 STDETQE(0:127) BIT(8) ALIGNED,   /* TQE FOR DIEEXIT            */
    5 STDESRB(0:43) BIT(8) ALIGNED,    /* SRB FOR STATSRB            */
    5 STDELAST,                        /*                            */
         9 STDEFLGS BIT(8) ALIGNED,    /* DEFINED BELOW              */
         9 STDEFILL1 BIT(8) ALIGNED,   /* RESERVED                   */
         9 STDELSTO FIXED BIN,         /* OFFSET OF NEXT PSW         */
    5 STDEBUFP PTR,                    /* ADDR OF PGBUF'S            */
    5 STDEGET FIXED BIN(31),           /* FREEMAIN INFO              */
    5 STDEPLEN FIXED BIN,              /* LEN OF PGBUF               */
    5 STDEPCNT FIXED BIN,              /* # OF PGBUF'S               */
    5 STDESRBI FIXED BIN,              /* SRBINVTL VALUE             */
    5 STDEMDMN FIXED BIN,              /* MAXDMN VALUE               */
    5 STDEWAMT PTR,                    /* PGBL WAMT COPY             */
    5 STDEWORK CHAR(16),               /* STATDIE WORK AREA          */
    5 STDELADR FIXED BIN(31),          /* LOWEST PRIVATE ADDR        */
    5 STDEHADR FIXED BIN(31),          /* LOWEST CSA ADDR            */
    5 STDEENTY CHAR(0);                /* START OF PSWS              */
  /* STDEFLGS FLAGS                                                  */
 DCL STDEPURG BIT(8) ALIGNED INIT('10000000'B);
 DCL STDEPAUS BIT(8) ALIGNED INIT('01000000'B);
 DCL STDEATIV BIT(8) ALIGNED INIT('00100000'B);
 DCL STDESRBA BIT(8) ALIGNED INIT('00010000'B);






1                             OUR-MF GUIDE                      PAGE 23





 DCL 1 PGBUF(      40) BASED(STDEBUFP),
 /********************************************************************/
 /* PGBUF: THE STATDIE PAGABLE DATA STORAGE AREA. ALSO THE           */
 /*   CONTENTS OF THE 'OMF1' TYPE RECORD WRITTEN BY OURMF.           */
 /* METHOD OF ACCESS:                                                */
 /* TO ALLOW THIS MACRO TO BE USED BOTH TO DEFINE THE INCORE         */
 /*   BUFFER POOL AND ALSO THE OMF1 RECORD, NO DSECT OR LEVEL        */
 /*   1 STRUCTURE NAME IS GENERATED. YOU PROVIDE THE FIRST           */
 /*   PART OF THE DSECT OR STRUCTURE AND THEN USE THIS TO FILL       */
 /*   IN THE REST.                                                   */
 /* ASSEMBLER - SUPPLY THE DSECT AND POSSIBLE THE OMF1ID FIELD, THEN */
 /*    USE THE MACRO TO FILL IN THE REST:                            */
 /*  PGBUF     DSECT                                                 */
 /*            PGBUF                                                 */
 /* OR                                                               */
 /*  OMF1REC   DSECT                                                 */
 /*  OMF1ID    DS   CL4                                              */
 /*            PGBUF                                                 */
 /* PLIX- SUPPLY THE DCL 1 STRUCTURENAME    AND POSSIBLY THE OMF1ID. */
 /*  DCL 1 PGBUF(PGBFCT) BASED(STDEBUFP),                            */
 /*       % INCLUDE PGBUF;                                           */
 /* OR                                                               */
    5 OMF1DATE FIXED DEC(7),
    5 OMF1TIME FIXED DEC(7),
     5 RCTINFO,                   /* SRM RCT TABLE VALUES            */
          9 RCTRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 UICA FIXED BIN,       /* PAGE STEAL HIGHEST UIC          */
          9 CPUA FIXED BIN,       /* CPU UTILIZATION *16             */
          9 AVQC FIXED BIN,       /* COUNT OF AVQ LOW                */
          9 ASMQ FIXED BIN,       /* AVERAGE ASM QUEUE               */
          9 PTR  FIXED BIN,       /* PAGE FAULT RATE                 */
          9 RSV  FIXED BIN,
     5 PVTINFO,                   /* PAGE FRAME INFO                 */
          9 PVTRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 AFC FIXED BIN,        /* AVAILABLE FRAMES                */
          9 POOL FIXED BIN,       /* TOTAL FRAMES                    */
          9 CFMCT FIXED BIN,      /* COMMON FRAMES                   */
          9 CNTFX FIXED BIN,      /* FIXED FRAMES                    */
          9 SQAFX FIXED BIN,      /* SQA FRAMES                      */
          9 COMFX FIXED BIN,      /* COMMON FIXED FRAMES             */
     5 DMN,                       /* DOMAIN INFO                     */
          9 DMNRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 DMDTENTRY( 10),    /* ARRAY OF ENTRIES                */

1                             OUR-MF GUIDE                      PAGE 24





              13 MPLT FIXED BIN,  /* MULTI-PROGRAMMING TARGET        */
              13 RUA FIXED BIN,   /* READY USER AVERAGE              */
     5 SAMPLES,                   /* PSW SAMPLES                     */
          9 PSWRDW CHAR(4),       /* RDW FOR THIS FIELD              */

















1                             OUR-MF GUIDE                      PAGE 25





          9 PSWS(     120) ,
 /********************************************************************/
 /* THE STATPSW CONTROL BLOCK HAS EVOLVED OVER SEVERAL VERSIONS      */
 /* OF STATDIE. ORIGINALLY IT WAS JUST A COPY OF THE EXTERNAL        */
 /* OLD PSW, AND THUS IT RECEIVED ITS NAME. BUT MANY OF THE          */
 /* FIELDS OF THE PSW ARE IRRELEVANT OR NEVER CHANGE, AND SO         */
 /* NEW SOFTWARE DEFINED BYTES AND BITS WERE OVERLAYED ON PARTS      */
 /* OF THE HARDWARE PSW.                                             */
 /* THE STATPSW'S ARE STORED FIRST IN THE STDE FIXED BUFFER, THEN    */
 /* MOVED TO THE PAGABLE BUFFER EVERY 'SRBINTVL*MILLISC'             */
 /* MILLISECONDS. THEY ARE EVENTUALLY WRITTEN OUT IN THE 'OMF1'      */
 /* RECORD.                                                          */
 /*                                                                  */
 /* METHOD OF ACCESS:                                                */
 /* ASSEMBLER: GENERATES A DSECT NAMED 'PSW'                         */
 /* PLIX: SINCE THE PSWS ARE ALWAYS AN ARRAY SUBSTRUCTURE,           */
 /*    THIS MACRO DOES NOT INCLUDE A HIGH LEVEL STRUCTURE LABEL.     */
 /*    SO BUILD THE REST OF THE STRUCTURE AND INCLUDE THIS           */
 /*    AT THE END.                                                   */
 /*                                                                  */
 /* VERSION DATE: MAY 25, 1977                                       */
 /********************************************************************/
              13 SVC BIT(8) ALIGNED,         /* SVC # IF SVCMD       */
              13 FLAGS BIT(8) ALIGNED,       /* DEFINED BELOW        */
              13 TCBRDY BIT(8) ALIGNED,      /* READY TCB COUNT      */
              13 PERFORM   BIT(8) ALIGNED,   /* PERFORMANCE GRP      */
              13 ADDRESS FIXED BIN(31) ,
              13 CDENAME CHAR(8);            /* MODULE NAME          */
   /* FLAGS BIT MASKS                                                */
 DCL SVCMD BIT(8) ALIGNED INIT('00001000'B);
 DCL SRB   BIT(8) ALIGNED INIT('00000100'B);
 DCL WAIT  BIT(8) ALIGNED INIT('00000010'B);
 DCL PBLM  BIT(8) ALIGNED INIT('00000001'B);








1                             OUR-MF GUIDE                      PAGE 26





                                       ELEMENT   TOTAL
 NAME      LVL      DIMS     OFFSET    LENGTH    LENGTH
 PGBUF     1        1                  2008      80320
 OMF1DATE  2        1                     4
 OMF1TIME  2        1           4         4
 RCTINFO   2        1           8        16         16
 RCTRDW    3        1           8         4
 UICA      3        1          12         2
 CPUA      3        1          14         2
 AVQC      3        1          16         2
 ASMQ      3        1          18         2
 PTR       3        1          20         2
 RSV       3        1          22         2
 PVTINFO   2        1          24        16         16
 PVTRDW    3        1          24         4
 AFC       3        1          28         2
 POOL      3        1          30         2
 CFMCT     3        1          32         2
 CNTFX     3        1          34         2
 SQAFX     3        1          36         2
 COMFX     3        1          38         2
 DMN       2        1          40        44         44
 DMNRDW    3        1          40         4
 DMDTENTRY 3        2          44         4         40
 MPLT      4        2          44         2
 RUA       4        2          46         2
 SAMPLES   2        1          84      1924       1924
 PSWRDW    3        1          84         4
 PSWS      3        2          88        16       1920
 SVC       4        2          88         1
 FLAGS     4        2          89         1
 TCBRDY    4        2          90         1
 PERFORM   4        2          91         1
 ADDRESS   4        2          92         4
 CDENAME   4        2          96         8








1                             OUR-MF GUIDE                      PAGE 27





                                       ELEMENT   TOTAL
 NAME      LVL      DIMS     OFFSET    LENGTH    LENGTH
 STDE      1                            220        220
 STDETQE   2        1                     1        128
 STDESRB   2        1         128         1         44
 STDELAST  2                  172         4          4
 STDEFLGS  3                  172         1
 STDEFILL1 3                  173         1
 STDELSTO  3                  174         2
 STDEBUFP  2                  176         4
 STDEGET   2                  180         4
 STDEPLEN  2                  184         2
 STDEPCNT  2                  186         2
 STDESRBI  2                  188         2
 STDEMDMN  2                  190         2
 STDEWAMT  2                  192         4
 STDEWORK  2                  196        16
 STDELADR  2                  212         4
 STDEHADR  2                  216         4
 STDEENTY  2                  220
 THE PLI STRUCTURE FOR THE STDE DOES NOT INCLUDE THE PSW FIXED BUFFER

 WHICH BEGINS AT 'STDEENTY' AND EXTENDS FOR 2000 BYTES.












1                             OUR-MF GUIDE                      PAGE 28





 OUTPUT DOCUMENTATION - CPU COMMAND



 CPU UTILIZATION    99.8           SAMPLE SIZE        4800
 SUPERVISOR STATE   36.6           TIME              17:02
 USERSTATE          61.8           AVG READY TCBS      3.2
 SUPERVISOR STATE IS  SVC: 23.2   SRB:  9.6   OTHER:  3.7
 KEY  PCT  ×  SVC  PCT  ×   PG  PCT  ×  PGM      PCT
  0  31.8  ×    0  4.5  ×   0   5.5  ×  MAIN      27.0
  1   2.9  ×   10  3.4  ×   1  64.2  ×  CML        9.9
  2   0.0  ×   16  1.9  ×   2  22.8  ×  DEJEXE     5.6
  3   0.0  ×   99  1.0  ×   3   0.0  ×  $$GO       3.5
  4   0.0  ×   56  0.8  ×   4   0.0  ×  VSAPL      3.3
  5   0.7  ×   26  0.7  ×   5   0.0  ×  QEDMAIN    3.0
  6   1.6  ×   20  0.6  ×   6   0.0  ×  IEDTCAM2   2.7
  7   0.0  ×   19  0.6  ×   7   0.0  ×  IEFIIC     2.5
  8  62.8  ×  114  0.6  ×   8   3.5  ×  IEWL       2.3
  9   0.0  ×    1  0.5  ×   9   3.8  ×  IEL0AC     2.1


      THIS IS THE OUTPUT OF THE CPU COMMAND.  IT PRESENTS A NUMBER OF

 ESTIMATES OF CPU USE BROKEN DOWN BY VARIOUS FACTORS.  THE ESTIMATES

 ARE BASED ON THE DATA  GATHERED BY STATDIE PERIODIC SAMPLING.  AS

 DISTRIBUTED BY YALE, STATDIE INTERRUPTS THE CPU FOUR TIMES A SECOND

 AND GATHERS DATA FROM THE EXTERNAL OLD PSW OF THE INTERRUPTED TASK OR

 SRB, FROM FIXED COMMON SYSTEM CONTROL BLOCKS, AND FROM THE LSQA OF THE

 INTERRUPTED USER.



      EACH ITEM IN THE REPORT WILL NOW BE INDIVIDUALLY DOCUMENTED.  THE

 ITEMS WILL BE PRESENTED IN THE ORDER WHICH ALLOWS THE BEST LOGICAL

 DEVELOPMENT OF EACH DEFINITION.  WHEN APPROPRIATE, COMMENTS WILL BE

 MADE ON INTER-DEPENDENCIES, ACCURACY, AND POSSIBLE CORROBORATION.



 SAMPLE SIZE - AS DISTRIBUTED, STATDIE ALLOCATES 40 PAGEABLE BUFFERS

       EACH OF WHICH HOLDS 120 SAMPLES.  WHEN IT IS STARTED IN THE

1                             OUR-MF GUIDE                      PAGE 29





      MORNING, THE VALUE OF SAMPLE SIZE GROWS BY UNITS OF 120 EVERY 30

      SECONDS UNTIL AFTER 20 MINUTES ALL 40 BUFFERS HAVE BEEN FILLED.

      THEREAFTER THE SAMPLE SIZE IS 4800.



           ALL VALUES IN CPU ASSUME THAT THIS IS A RANDOM SAMPLE OF CPU

      UTILIZATION.  ACTUALLY, IT IS A SAMPLE OF _______ CPU
                                                ENABLED

      UTILIZATION.  SHOULD A COMPONENT ACQUIRE A DISABLED LOCK AND THEN

      SUBSEQUENTLY RELEASE IT WITH AN INTERRUPT PENDING, THE SAMPLE

      WILL BE 'CHARGED' TO THE ROUTINE RELEASING THE LOCK, AND THIS

      POSES NO SERIOUS STATISTICAL PROBLEM.  THE REAL TROUBLE MAKERS

      ARE THE ROUTINES WHICH OPERATE 'PHYSICALLY DISABLED' AND WHICH

      ENABLE BY USING A LPSW INSTRUCTION. THIS INCLUDES THE INTERRUPT

      HANDLERS AND THE DISPATCHER.  THESE DISABLED SYSTEM ROUTINES WILL

      UNFAIRLY 'CHARGE' THEIR CPU TO THE NEXT DISPATCHED TASK OR SRB.

      THIS BIAS IS 'SPREAD AROUND', BUT IT PRESUMABLY HURTS SRB'S MOST,

      THEN TASKS WITH THE HIGHEST DISPATCHING PRIORITY.  ONE WOULD

      THEREFORE EXPECT ESTIMATES OF SUPERVISOR STATE DERIVED FROM SUCH

      SAMPLES TO BE SLIGHTLY LOWER THAN HARDWARE MEASUREMENTS.



      THERE ARE THREE POINTS IN FAVOR OF SAMPLING: 1) MANY PEOPLE CAN'T

 AFFORD HARDWARE MONITORS; 2) HARDWARE MONITORS CAN'T MEASURE SVC

 NUMBER, PERFORMANCE GROUP, SRB MODE, OR PROGRAM NAME; AND 3) THE BIAS,

 WHATEVER IT IS, IS CONSTANT OVER TIME AND THOSE NUMBERS CAN BE USED TO

 TRACK TRENDS AND MEASURE RESPONSES TO TUNING EFFORTS.



 TIME - CURRENT TIME OF DAY IN CASE YOU FILE THIS REPORT FOR FUTURE


1                             OUR-MF GUIDE                      PAGE 30





      REFERENCE.



 CPU UTILIZATION - THE PERCENTAGE OF THE TOTAL SAMPLE WHEN THE WAIT BIT

      IS OFF. THERE ARE OTHER SOURCES FOR ESTIMATES OF THIS QUANTITY:

      THE LCCAWAIT VALUE REPORTED IN THE OMF3 RECORD OF OURMF OR IN THE

      SMF 70 RECORD OF MF1 OR RMF. AND OF COURSE, ONE CAN MEASURE THIS

      VALUE BY HARDWARE PROBES.  THIS IS THE ONLY VALUE IN WHICH THE

      DENOMINATOR OF THE FRACTION IS THE WHOLE SAMPLE SIZE.  ALL OTHER

      PERCENTAGES WILL BE BASED ONLY ON THE COUNT OF SAMPLES IN WHICH

      THE CPU WAS ACTIVE.



 SUPERVISOR STATE - THE PERCENTAGE OF THE ACTIVE SAMPLES IN WHICH THE

      PROBLEM BIT IS OFF.



 USER STATE - THE PERCENTAGE OF THE ACTIVE SAMPLES IN WHICH THE PROBLEM

      BIT IS ON AND THE PROTECT KEY IS GREATER THAN OR EQUAL TO 8.  IN

      THIS EXAMPLE, THE SUM OF SUPERVISOR AND USER STATES IS 98.4,

      MEANING THAT 1.6% OF THE SAMPLES WERE IN PROBLEM STATE BUT SYSTEM

      PROTECT KEY.



 THE FOURTH LINE IN THE DISPLAY BREAKS SUPERVISOR STATE INTO THREE

 CATEGORIES:



     SVC - THE PERCENTAGE OF THE ACTIVE SAMPLES WHEN THE INTERRUPTED

          USER WAS IN TYPE 1 SVC MODE OR WAS EXECUTING UNDER AN SVRB.

     SRB - THE PERCENTAGE OF THE ACTIVE SAMPLES WHEN THE INTERRUPTED


1                             OUR-MF GUIDE                      PAGE 31





          USER WAS RUNNING IN SRB MODE.

     OTHER - THE PERCENTAGE OF THE ACTIVE SAMPLE WHEN THE USER WAS IN

          SUPERVISOR STATE BUT NEITHER UNDER AN SVC OR AN SRB.  THIS IS

          TIME CONSUMED BY TASKS WHICH ACHIEVED SUPERVISOR STATE BY A

          MODESET OR BY AN ENTRY IN THE PROGRAM PROPERTIES TABLE.



 THE SUM OF SVC, SRB, AND OTHER SHOULD ADD EXCEPT FOR ROUNDING ERROR,

 TO THE VALUE OF SUPERVISOR STATE IN LINE 2 OF THE DISPLAY.



 AVG READY TCBS - THE AVERAGE NUMBER OF DISPATCHABLE TASKS IN ALL

      ADDRESS SPACES ON THE DISPATCHER QUEUE.  THIS IS A GENERALLY USED

      MEASURE OF THE ABILITY OF THE CURRENT WORKLOAD AND CONFIGURATION

      TO CONSUME MORE CPU HORSEPOWER IF IT COULD BE MADE AVAILABLE.



 LINE 5 BEGINS FOUR SEPARATE BREAKDOWNS OF ACTIVE TIME BY PROTECT KEY,

 SVC NUMBER, PERFORMANCE GROUP, AND PROGRAM NAME.  THESE COLUMNS ARE




 KEY - THIS IS A BREAKDOWN BY PROTECT KEY.  THE SYSTEM USE OF VARIOUS

      PROTECT KEYS IS DOCUMENTED IN SPL:  DEBUGGING HANDBOOK,

      GC28-0708, PAGES 5-66.  KEY 1 IS JES, KEY 5 IS IOS, KEY 6 IS

      TCAM.  KEYS 9-L5 ARE RESERVED FOR V=R JOBS, AND SO THE OMISSION


1                             OUR-MF GUIDE                      PAGE 32





      OF 10-15 IS NOT DEEMED SERIOUS.  NOTE THE 1.0% DIFFERENCE BETWEEN

      KEY 8 REPORTED HERE AND USER STATE REPORTED ABOVE IN ROW THREE.

      SINCE YALE HAS NO V=R JOBS, THIS MEANS THAT 1.0% OF THE ACTIVE

      SAMPLES WERE IN SUPERVISOR STATE IN KEY 8.



 SVC - THIS IS A BREAKDOWN OF THE ACTIVE SAMPLE BY THE SVC IN CONTROL

      AT THE TIME OF THE SAMPLE. ONLY THE 10 LARGEST SVC'S ARE

      REPORTED.  IF THE COLUMN WERE EXTENDED TO INCLUDE ALL 256

      POSSIBLE SVC'S, IT WOULD ADD UP TO 23.2 AS REPORTED IN ROW 4 OF

      THE DISPLAY ABOVE.



 PG - THIS IS A BREAKDOWN OF THE ACTIVE SAMPLE BY  THE FIRST 10

      PERFORMANCE GROUP NUMBERS.



 PGM - THIS IS A BREAKDOWN OF THE ACTIVE SAMPLE BY THE PROGRAM NAME IN

      THE CDE POINTED TO BY THE HIGHEST PRB IN THE RB CHAIN.  THIS

      REFLECTS THE CURRENT MODULE ACTIVATED BY ATTACH, LINK, OR XCTL

      BUT DOES NOT INVOLVE LINKAGES BY DIRECT BRANCH, LOAD AND BRANCH,

      OR BY SVC.  WE FEEL THIS IS A MORE USEFUL DEFINITION THAN THE

      'CDENAME' THAT GTF BUILDS FOR SOME EVENTS, WHERE IT CONSTRUCTS A

      MODULE NAME FOR THE CURRENT SVC IF AN SVC IS IN CONTROL.



      NOW A FEW WORDS ON THE USE OF CPU IN TUNING.  FIRST, IT IS

 IMPORTANT TO NOTE THAT WE DO NOT BREAK DOWN CPU BY JOB NAME.  THERE IS

 NOT ENOUGH ROOM ON THE SCREEN.  USE SIRTSO OR CHIMP FOR SUCH A DIPLAY.

 CPU CAN BE USED TO TROUBLE-SHOOT PERIODS OF SLOWDOWN, AND IT WILL


1                             OUR-MF GUIDE                      PAGE 33





 IDENTIFY PROBLEMS ASSOCIATED WITH AN SVC OR PROGRAM.  FOR EXAMPLE, IF

 TCAM HAS A HOT LINE AND IS SPINNING IN ERROR RECOVERY, THE VALUES FOR

 KEY 6, SVC 15, PG 8, AND PROGRAM IEDTCAM2 WILL ALL INCREASE

 DRAMATICALLY.



      A MORE IMPORTANT USE OF CPU IS TO ESTABLISH AND TRACK LONG TERM

 PATTERNS. AT YALE OUR PRIMARY OBJECTIVE IS TO INCREASE THE VALUE OF

 USERSTATE, AND WE HAVE FOUND THE NUMBERS REPORTED BY CPU TO BE THE

 BEST INDICATOR OF SUCCESS IN MODERATING PAGE RATES, INCREASING

 BLOCKSIZES, AND OTHER SUCH TUNING EFFORTS.














1                             OUR-MF GUIDE                      PAGE 34





                                 WKLOAD



      THE WORKLOAD ACTIVITY MEASUREMENT TABLE IS CREATED AND

 INITIALIZED BY RMF OR MF1.  THERE IS ONLY ONE WAMT, ONLY ONE WAMT

 FORMAT, AND IT IS MAINTAINED BY THE SRM IDENTICALLY FOR BOTH MF1 AND

 RMF.  IT CONTAINS ALL THE WORKLOAD INFORMATION REPORTED BY THE RMF FOR

 PERFORMANCE GROUPS AND PERIODS.  MF1 IS SMART ENOUGH TO IGNORE MUCH OF

 THE WAMT INFORMATION, THEREBY ENSURING A MARKET FOR RMF. WKLOAD IS A

 TSO COMMAND TO FORMAT INFORMATION IN THE LAST WAMT COLLECTED BY MF1.

 THIS SATISFIES THE OCCASIONAL DESIRE TO LOOK AT THE SYSTEM WITHOUT THE

 GENERATION OF BOXES OF OLD MF1/RMF REPORTS.  ALL THE USUAL NUMBERS ARE

 THERE, BUT A FEW EDITORIAL DECISIONS HAVE BEEN MADE FOR THE TSO

 ENVIRONMENT:

     1) ONLY THE BREAKDOWN BY PGP IS PROVIDED.  IT IS EASY TO SUM THE

          COLUMNS IF YOU WANT, BUT THE VARIOUS OTHER REPORTS DO NOT

          SEEM AS IMPORTANT AS THE BREAKDOWN BY PGP.



     2) ALL THE SEVICE UNITS ARE REPORTED 'PER SECOND' BECAUSE THE

          LENGTH OF THE REPORTING INTERVAL IS NOT AT THE USERS CONTROL

          AND ABSOLUTE NUMBERS SEEM LESS USEFUL.








1                             OUR-MF GUIDE                      PAGE 35





     WORKLOAD DURING  858 SECONDS ENDING AT 16.54
     IPS=00 CPU=10.0 IOC= 1.0 MSO= 3.0
     PG PGP OBJ DMN SRV CPU IO  MSO ABS TSR WLL SWP  ACT   TRLEN
      0   1   0   0   8   8   0   0   8   8   0 0.00 1.02  0.00
      1   1   2   1 214 162  12  39  65  65  84 0.00 3.28 114.56
      1   2   3   1 109  91   1  16  79  77  62 0.00 1.42 401.45
      2   1   1   2  57  49   1   6  58  52  99 0.50 1.10   1.72
      2   2   3   4  41  32   0   7  58  53  73 0.03 0.77  21.14
      2   3   6   1  49  38   0   9  93  93  40 0.00 0.53 194.19
      3   1   2   5 ZEROS
      4   1   4   1 ZEROS
      5   1   1   2 ZEROS
      5   2   3   4 ZEROS
      5   3   4   1 ZEROS
      6   1   2   5   0   0   0   0   0   0 100 0.00 0.09  0.00
      7   1   2   6 ZEROS
      8   1   2   5  20  17   0   2  20  20  95 0.00 1.02  0.00
      9   1   2   5  23  16   0   7  23  23  94 0.00 1.02  0.00


     FIELDS REPORTED:



     PG  PERFORMANCE GROUP

     PGP PERFORMANCE GROUP PERIOD

     OBJ SERVICE OBJECTIVE

     DMN DOMAIN

     SRV SERVICE UNITS PER SECOND CONSUMED BY PGP

     CPU CPU COMPONENT OF SRV

     IO  IO COMPONENT OF SRV

     MSO STORAGE COMPONENT OF SRV

     ABS ABSORPTION RATE (SERVICE/TRANS-RESIDENT TIME).  THIS IS THE

          RATE AT WHICH A USER IN THIS PGP CONSUMES SERVICE WHILE IN

          CORE.  IT IS TOTAL SERVICE PER SECOND OF SWAPPED-IN TIME.

     TSR TRANS SERVICE RATE (SERVICE/TRANS-ACTIVE TIME).  THIS IS THE

          RATE AT WHICH A USER IN THS PGP CONSUMES SERVICE INCLUDING

          BOTH SWAPPED IN AND SWAPPED OUT TIME.  'TSR'<='ABS' WITH


1                             OUR-MF GUIDE                      PAGE 36





          EQUALITY ONLY IF THE USER IS NOT SWAPPED OUT DURING THIS PGP.

     WLL WORKLOAD LEVEL

     SWP SWAPS PER SECOND

     ACT ACTIVITY (TRANS-RESIDENT/ELAPSED TIME). ESSENTIALLY THIS IS

          THE AVERAGE NUMBER OF INCORE TRANSACTIONS IN THIS PGP OVER

          THIS REPORTING PERIOD.  IT IS A MEASURE OF MULTIPROGRAMMING

          LEVEL FOR THE PGP.

     TRLEN AVERAGE TRANSACTION ELAPSED TIME.  THIS IS THE AVERAGE

          ELAPSED TIME FOR  ENDED TRANSACTIONS.  IT IS A MEASURE OF

          RESPONSE TIME FOR TSO OR TURNAROUND FOR BATCH, BUT EXCEPT FOR

          TSO TRIVIAL PERIODS THIS VALUE IS DANGEROUSLY UNSTABLE AS A

          TUNING CRITERION.












1                             OUR-MF GUIDE                      PAGE 37





                   OUTPUT DOCUMENTATION - PAGES, RCT, AND DMN



               THESE COMMANDS REQUIRE LESS EXPLANATION. MOST OF THE

          REPORTED INFORMATION HAS AN OBVIOUS MEANING OR IS DOCUMENTED

          ELSEWHERE. THE PAGES COMMAND FORMATS INFORMATION IN THE PART

          AND SART SYSTEM CONTROL BLOCKS CONCERNING THE ACTIVE PAGE

          DATASETS:

          PAGE DATASETS:
          TYPE      SER       SLOTS      % USED   ERRORS    NAME
          PLPA      USER04     3654        38         0     PAGE1
          COMMON    USER12      580        15         0     COMMDS
          LOCAL     USER11     3480        13         0     PAGE11
          LOCAL     USER13     3480        11         0     PAGE13
          LOCAL     USER14     3480        11         0     PAGE14
          PAGE SLOTS ARE  35 % RESERVED
          SWAP DATASETS:
                    SER       SETS       % USED   ERRORS    NAME
                    USER12      100        15         0     SWAP1


               THE RCT COMMAND PRINTS THE CURRENT VALUES OF THE FOUR

          SRM CRITERIA USED TO DETERMINE IF THE TOTAL MULTIPROGRAMMING

          LEVEL OF THE SYSTEM SHOULD BE INCREASED OR DECREASED.

          SRM VARIABLES:
          CPU UTILIZATION       101
          AVG ASM QUEUE           1
          PAGE RATE               6
          AVG UIC                10







1                             OUR-MF GUIDE                      PAGE 38





               THE DMN COMMAND PRODUCES FOR TSO THE SAME INFORMATION

          THAT THE OPERATOR 'D DMN' COMMAND PRODUCES ON THE OPERATORS

          CONSOLE:
              #  MIN  MAX   WT MPLT   RUA GOOU CMPL OUTQ INCU
              0  255  255    1  255    2    0    1    0    1
              1    1    7    4    7    7    0    7    0    7
              2    4    5   10    4    2    0    1    0    1
              3    0    0    1    0    0    0    0    0    0
              4    1    5    4    3    2    0    0    0    0
              5    2    2    1    2    1    0    0    0    0
              6    0    0    1    0    0    0    0    0    0














1                             OUR-MF GUIDE                      PAGE 39





                          OURMF TRACE RECORDS



      THE OURMF PROGRAM PRODUCES THREE KINDS OF TRACE RECORDS. EACH IS

 IDENTIFIED BY A FOUR CHARACTER ID, 'OMF1', 'OMF2', OR 'OMF3' AT THE

 BEGINNING OF THE RECORD.  THE NEXT TWO WORDS OF THE RECORD ARE 4 BYTE

 DECIMAL DATE AND TIME STAMPS IN THE FORM '00YYDDDF' AND '0HHMMSSF'.

 THE OURMF DATA IS WRITTEN FIRST TO DISK, THEN PERIODICALLY WHEN THE

 DISK FILE FILLS UP ITS CONTENTS ARE MOVED TO A TAPE ARCHIVE DATASET.

 THE DATASET IS RECFM=VB. THE DESCRIPTIONS AND OFFSETS FOR THE RECORDS

 GIVEN BELOW ARE PLI ORIENTED AND DO NOT INCLUDE THE RECORD DESCRIPTOR

 WORD WHICH WOULD BE ENCOUNTERED IN ASSEMBLER. THERE IS NO ASSEMBLER

 MAPPING MACRO FOR THESE RECORDS. A PLI PROGRAM CAN OBTAIN THESE

 STRUCTURE DECLARATIONS BY:

      % INCLUDE STATGLBL;

      % INCLUDE OURMFDEF;










1                             OUR-MF GUIDE                      PAGE 40





 DCL 1 OMF1 BASED(OMFRECPTR),
    5 OMF1ID CHAR(4),
 /* ASSEMBLER - SUPPLY THE DSECT AND POSSIBLE THE OMF1ID FIELD, THEN */
 /*    USE THE MACRO TO FILL IN THE REST:                            */
 /*  PGBUF     DSECT                                                 */
 /*            PGBUF                                                 */
 /* OR                                                               */
 /*  OMF1REC   DSECT                                                 */
 /*  OMF1ID    DS   CL4                                              */
 /*            PGBUF                                                 */
 /* PLIX- SUPPLY THE DCL 1 STRUCTURENAME    AND POSSIBLY THE OMF1ID. */
 /*  DCL 1 PGBUF(PGBFCT) BASED(STDEBUFP),                            */
 /*       % INCLUDE PGBUF;                                           */
 /* OR                                                               */
 /*  DCL 1 OMF1REC BASED(OMFRECPTR),                                 */
 /*         5 OMF1ID CHAR(4),                                        */
 /* % INCLUDE PGBUF;                                                 */
 /*                                                                  */
 /* DEPENDENCIES: USES VALUES IN 'STATGLBL' AND 'STATPSW'            */
 /*      MACROS.                                                     */
 /*                                                                  */
 /* VERSION DATE: MAY 26,1977                                        */
 /********************************************************************/
    5 OMF1DATE FIXED DEC(7),
    5 OMF1TIME FIXED DEC(7),
     5 RCTINFO,                   /* SRM RCT TABLE VALUES            */
          9 RCTRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 UICA FIXED BIN,       /* PAGE STEAL HIGHEST UIC          */
          9 CPUA FIXED BIN,       /* CPU UTILIZATION *16             */
          9 AVQC FIXED BIN,       /* COUNT OF AVQ LOW                */
          9 ASMQ FIXED BIN,       /* AVERAGE ASM QUEUE               */
          9 PTR  FIXED BIN,       /* PAGE FAULT RATE                 */
          9 RSV  FIXED BIN,
     5 PVTINFO,                   /* PAGE FRAME INFO                 */
          9 PVTRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 AFC FIXED BIN,        /* AVAILABLE FRAMES                */
          9 POOL FIXED BIN,       /* TOTAL FRAMES                    */
          9 CFMCT FIXED BIN,      /* COMMON FRAMES                   */
          9 CNTFX FIXED BIN,      /* FIXED FRAMES                    */
          9 SQAFX FIXED BIN,      /* SQA FRAMES                      */
          9 COMFX FIXED BIN,      /* COMMON FIXED FRAMES             */
     5 DMN,                       /* DOMAIN INFO                     */
          9 DMNRDW CHAR(4),       /* RDW FOR THIS FIELD              */

1                             OUR-MF GUIDE                      PAGE 41





          9 DMDTENTRY( 10),    /* ARRAY OF ENTRIES                */
              13 MPLT FIXED BIN,  /* MULTI-PROGRAMMING TARGET        */
              13 RUA FIXED BIN,   /* READY USER AVERAGE              */
     5 SAMPLES,                   /* PSW SAMPLES                     */
          9 PSWRDW CHAR(4),       /* RDW FOR THIS FIELD              */
          9 PSWS(     120) ,
 /********************************************************************/
 /* THE STATPSW CONTROL BLOCK HAS EVOLVED OVER SEVERAL VERSIONS      */
 /* OF STATDIE. ORIGINALLY IT WAS JUST A COPY OF THE EXTERNAL        */
 /* OLD PSW, AND THUS IT RECEIVED ITS NAME. BUT MANY OF THE          */
 /* FIELDS OF THE PSW ARE IRRELEVANT OR NEVER CHANGE, AND SO         */
 /* NEW SOFTWARE DEFINED BYTES AND BITS WERE OVERLAYED ON PARTS      */
 /* OF THE HARDWARE PSW.                                             */
 /* THE STATPSW'S ARE STORED FIRST IN THE STDE FIXED BUFFER, THEN    */
 /* MOVED TO THE PAGABLE BUFFER EVERY 'SRBINTVL*MILLISC'             */
 /* MILLISECONDS. THEY ARE EVENTUALLY WRITTEN OUT IN THE 'OMF1'      */
 /* RECORD.                                                          */
 /*                                                                  */
 /* METHOD OF ACCESS:                                                */
 /* ASSEMBLER: GENERATES A DSECT NAMED 'PSW'                         */
 /* PLIX: SINCE THE PSWS ARE ALWAYS AN ARRAY SUBSTRUCTURE,           */
 /*    THIS MACRO DOES NOT INCLUDE A HIGH LEVEL STRUCTURE LABEL.     */
 /*    SO BUILD THE REST OF THE STRUCTURE AND INCLUDE THIS           */
 /*    AT THE END.                                                   */
 /*                                                                  */
 /* VERSION DATE: MAY 25, 1977                                       */
 /********************************************************************/
              13 SVC BIT(8) ALIGNED,         /* SVC # IF SVCMD       */
              13 FLAGS BIT(8) ALIGNED,       /* DEFINED BELOW        */
              13 TCBRDY BIT(8) ALIGNED,      /* READY TCB COUNT      */
              13 PERFORM   BIT(8) ALIGNED,   /* PERFORMANCE GRP      */
              13 ADDRESS FIXED BIN(31) ,
              13 CDENAME CHAR(8);            /* MODULE NAME          */
   /* FLAGS BIT MASKS                                                */
 DCL SVCMD BIT(8) ALIGNED INIT('00001000'B);
 DCL SRB   BIT(8) ALIGNED INIT('00000100'B);
 DCL WAIT  BIT(8) ALIGNED INIT('00000010'B);
 DCL PBLM  BIT(8) ALIGNED INIT('00000001'B);







1                             OUR-MF GUIDE                      PAGE 42





  DCL 1 OMF2 BASED(OMFRECPTR),
    3 OMF2ID CHAR(4),
    3 OMF2DATE FIXED DEC(7),
    3 OMF2TIME FIXED DEC(7),
    3 WAMT,
 /********************************************************************/
 /* IRAWAMT - PLI MAPPING MACRO FOR THE                              */
 /*     WORKLOAD ACTIVITY MEASUREMENT TABLE (WAMT)                   */
 /*                                                                  */
 /* METHOD OF ACCESS:                                                */
 /* THE WAMT MAY BE IN CORE OR IN THE 'OMF2' RECORD. TO ALLOW        */
 /* USE OF THIS STRUCTURE IN BOTH CASES, NO LEVEL 1 STRUCTURE        */
 /* NAME IS INCLUDED IN THIS MEMBER. DECLARE THE STRUCTURE AND       */
 /* IF YOU ARE MAPPING THE OMF2 RECORD INCLUDE ALSO THE ID AND       */
 /* TIMESTAMP FIELDS. THEN INCLUDE THIS MEMBER TO COMPLETE THE       */
 /* DECLARATION.                                                     */
 /*       DCL 1 WAMT BASED(WAMTPTR),                                 */
 /* %INCLUDE IRAWAMT                                                 */
 /* DCL WAMTPTR PTR BASED(STATPTR);                                  */
 /* CALL LOADPTR('STDEWAMT',STATPTR);                                */
 /*                                                                  */
 /* OR                                                               */
 /*                                                                  */
 /*  DCL 1 OMF1REC BASED(OMFRECPTR),                                 */
 /*          2 OMF2ID CHAR(4),                                       */
 /*          2 OMF2DATE FIXED DEC(7),                                */
 /*          2 OMF2HOUR FIXED DEC(7),                                */
 /*          2 WAMT,                                                 */
 /* %INCLUDE IRAWAMT;                                                */
 /********************************************************************/
         5 WAR PTR,               /* ADDR OF ROUTINE                 */
         5 SIZ FIXED BIN(31),     /* SIZE OF WAMT IN BYTES           */
         5 STARTIME,              /* INTERVAL START TIME             */
               9 (TMA,TMA2)       /*    IN 64 BIT TOD                */
              FIXED BIN(31),      /*    CLOCK FORMAT                 */
         5 STOPTIME,              /* INTERVAL END TIME               */
               9 (TOC,TOC2)       /*    IN 64 BIT TOD                */
              FIXED BIN(31),      /*    CLOCK FORMAT                 */
         5 ASD FIXED BIN(31),     /* MF1 ASID                        */
         5 TCB PTR,               /* MF1 TCB                         */
         5 IPS CHAR(2),           /* IPS SUFFIX                      */
         5 (CPD,                  /* COUNT OF PGP'S                  */
            SPD,                  /* LENGTH OF ONE WAMP              */
            HPG) FIXED BIN,       /* HIGHEST PG NUMBER               */
         5 (IPC,                  /* CPU COEFFICIENT                 */
            IPI,                  /* IO  COEFFICIENT                 */
            IPM) CHAR(4),         /* MSO COEFFICIENT                 */
         5 NDX(0:N REFER(HPG))    /* OFFSET TO EACH WAMP             */
              FIXED BIN(31);      /*   1 PER PGP                     */
 DCL 1 WAMP BASED(WAMPNEXT),      /* DATA FOR PGP                    */
         5 (TRN,                  /* TRANSACTIONS ENDED              */
            TAT,                  /* TRANS ACTIVE TIME               */

1                             OUR-MF GUIDE                      PAGE 43





            SRV,                  /* TOTAL SERVICE                   */
            TET,                  /* TRANS ELAPSED TIME              */
            NWL,                  /* NORMALIZED WKLOAD               */
            CPU,                  /* CPU SERVICE                     */
            IOC,                  /* IO SERVICE                      */
            MSO,                  /* MSO SERVICE                     */
            TRR,                  /* TOTAL RESIDENT TIME             */
            SWC) FIXED BIN(31),   /* SWAP COUNT                      */
         5 (OBJ,                  /* OBJECTIVE NUMBER                */
            DMN) BIT(8) ALIGNED,  /* DOMAIN NUMBER                   */
         5 FILL CHAR(2);          /* RESERVED                        */
















1                             OUR-MF GUIDE                      PAGE 44





 DCL 1 OMF3 BASED(OMFRECPTR),
    5 OMF3ID   CHAR(4) INIT('OMF3'),    /* RECORD ID FIELD         */
    5 OMF3DATE FIXED DEC(7),
    5 OMF3TIME FIXED DEC(7),
    5 RDW CHAR(4),
    5 LCCAWTIM CHAR(8),                  /* ACCUMULATED WAIT TIME   */
    5 PAGINGINFO,
     9 PVTNPIN  FIXED(31),          /* NUMBER OF PAGES PAGED IN,
                                       EXCLUDING SWAP-INS AND VIO
                                       PAGE-INS.                     */
     9 PVTNPOUT FIXED(31),          /* NUMBER OF PAGES PAGED OUT,
                                       EXCLUDING SWAP-OUTS AND VIO
                                       PAGE-OUTS                     */
     9 PVTVAMI  FIXED(31),          /* NUMBER OF VIO PAGE-INS
                                       EXCLUDING SWAP                */
     9 PVTVAMO  FIXED(31),          /* NUMBER OF VIO PAGE-OUTS
                                       EXCLUDING SWAP                */
     9 PVTVAMR  FIXED(31),          /* NUMBER OF VIO RECLAIMS        */
     9 PVTSPIN  FIXED(31),          /* NUMBER OF PAGES SWAPPED-IN    */
     9 PVTSPOUT FIXED(31),          /* NUMBER OF PAGES SWAPPED-OUT   */
     9 PVTNPREC FIXED(31),          /* NUMBER OF PAGES RECLAIMED,
                                       EXCLUDING SWAP AND VIO RECLAIMS
                                                                    */
     9 PVTNSWPS FIXED(31),          /* NUMBER OF SUCCESSFUL SWAP-INS */
     9 PVTCAIN  FIXED(31),          /* NUMBER OF COMMON AREA PAGE-INS
                                                                    */
     9 PVTCAOUT FIXED(31),          /* NUMBER OF COMMON AREA
                                       PAGE OUTS                    */
     9 PVTCAREC FIXED(31),          /* NUMBER OF RECLAIMS OF COMMON
                                       AREA PAGES                   */
     9 PVTSPREC FIXED(31),          /* NUMBER OF PRIVATE AREA PAGEABLE
                                       PAGES RECLAIMED ACROSS A SWAP
                                                                    */
    5 SWAPINFO ,
        9 RMCATOSC FIXED(31),     /* TERMINAL OUTPUT SWAP COUNT     */
        9 RMCATISC FIXED(31),     /* TERMINAL  INPUT SWAP COUNT     */
        9 RMCALWSC FIXED(31),     /* LONG WAIT SWAP COUNT           */
        9 RMCAXSSC FIXED(31),     /* AUT STOR SHORTAGE SWAP COUNT   */
        9 RMCARSSC FIXED(31),     /* REAL STOR SHORTAGE SWAP COUNT  */
        9 RMCADWSC FIXED(31),     /* DETECTED WAIT SWAP COUNT       */
        9 RMCARQSC FIXED(31),     /* REQSWAP SWAP COUNT             */
        9 RMCANQSC FIXED(31),     /* CAP ENQ EXCHANGE SWAP COUNT    */
        9 RMCAEXSC FIXED(31),     /* CAP EXCHANGE BASED ON RECOMM.
                                       VALUE SWAP COUNT             */
        9 RMCAUSSC FIXED(31);     /* CAP UNILATERAL SWAP OUT COUNT  */


 NOTE: THE VALUES IN THIS RECORD REPRESENT THE INCREMENT TO THE NAMED
 FIELD IN THE CURRENT REPORTING INTERVAL. THE ACTUAL VALUE IN THE
 INCORE CONTROL BLOCK IS INSTEAD TYPICALLY A CUMULATE COUNT.



1                             OUR-MF GUIDE                      PAGE 45





                                       ELEMENT   TOTAL
 NAME      LVL      DIMS     OFFSET    LENGTH    LENGTH
 OMF1      1                           2012       2012
 OMF1ID    2                              4
 OMF1DATE  2                    4         4
 OMF1TIME  2                    8         4
 RCTINFO   2                   12        16         16
 RCTRDW    3                   12         4
 UICA      3                   16         2
 CPUA      3                   18         2
 AVQC      3                   20         2
 ASMQ      3                   22         2
 PTR       3                   24         2
 RSV       3                   26         2
 PVTINFO   2                   28        16         16
 PVTRDW    3                   28         4
 AFC       3                   32         2
 POOL      3                   34         2
 CFMCT     3                   36         2
 CNTFX     3                   38         2
 SQAFX     3                   40         2
 COMFX     3                   42         2
 DMN       2                   44        44         44
 DMNRDW    3                   44         4
 DMDTENTRY 3        1          48         4         40
 MPLT      4        1          48         2
 RUA       4        1          50         2
 SAMPLES   2                   88      1924       1924
 PSWRDW    3                   88         4
 PSWS      3        1          92        16       1920
 SVC       4        1          92         1
 FLAGS     4        1          93         1
 TCBRDY    4        1          94         1
 PERFORM   4        1          95         1
 ADDRESS   4        1          96         4
 CDENAME   4        1         100         8







1                             OUR-MF GUIDE                      PAGE 46





                                       ELEMENT   TOTAL
 NAME      LVL      DIMS     OFFSET    LENGTH    LENGTH
 OMF2      1                            ADJ        ADJ
 OMF2ID    2                              4
 OMF2DATE  2                    4         4
 OMF2TIME  2                    8         4
 WAMT      2                   12       ADJ        ADJ
 WAR       3                  ADJ         4
 SIZ       3                  ADJ         4
 STARTIME  3                  ADJ         8          8
 TMA       4                  ADJ         4
 TMA2      4                  ADJ         4
 STOPTIME  3                  ADJ         8          8
 TOC       4                  ADJ         4
 TOC2      4                  ADJ         4
 ASD       3                  ADJ         4
 TCB       3                  ADJ         4
 IPS       3                  ADJ         2
 CPD       3                  ADJ         2
 SPD       3                  ADJ         2
 HPG       3                  ADJ         2
 IPC       3                  ADJ         4
 IPI       3                  ADJ         4
 IPM       3                  ADJ         4
 NDX       3        1         ADJ         4        ADJ










1                             OUR-MF GUIDE                      PAGE 47





                                       ELEMENT   TOTAL
 NAME      LVL      DIMS     OFFSET    LENGTH    LENGTH
 OMF3      1                            116        116
 OMF3ID    2                              4
 OMF3DATE  2                    4         4
 OMF3TIME  2                    8         4
 RDW       2                   12         4
 LCCAWTIM  2                   16         8
 PAGINGINF 2                   24        52         52
 PVTNPIN   3                   24         4
 PVTNPOUT  3                   28         4
 PVTVAMI   3                   32         4
 PVTVAMO   3                   36         4
 PVTVAMR   3                   40         4
 PVTSPIN   3                   44         4
 PVTSPOUT  3                   48         4
 PVTNPREC  3                   52         4
 PVTNSWPS  3                   56         4
 PVTCAIN   3                   60         4
 PVTCAOUT  3                   64         4
 PVTCAREC  3                   68         4
 PVTSPREC  3                   72         4
 SWAPINFO  2                   76        40         40
 RMCATOSC  3                   76         4
 RMCATISC  3                   80         4
 RMCALWSC  3                   84         4
 RMCAXSSC  3                   88         4
 RMCARSSC  3                   92         4
 RMCADWSC  3                   96         4
 RMCARQSC  3                  100         4
 RMCANQSC  3                  104         4
 RMCAEXSC  3                  108         4
 RMCAUSSC  3                  112         4








1                             OUR-MF GUIDE                      PAGE 48





                        WRITING A POST-PROCESSOR



      OUR-MF VERSION 1.0 HAS ONLY ONE POST-PROCESSOR, OMFPST2. IT IS

 EXTREMELY DIFFICULT TO WRITE A GOOD GENERAL PURPOSE POST-PROCESSOR.

 FIRST, EACH INSTALLATION HAS ITS OWN IPS AND HAS ITS OWN PERFORMANCE

 GROUP DEFINITIONS AND OBJECTIVES FOR EACH PGP. ONE PLACE MAY BE

 INTERESTED IN PG 1,2, AND 5, ANOTHER MAY BE INTERESTED PRIMARILY IN PG
 GROUPS, BUT NOT IN A DELAY DOMAIN.

      NOR ARE THINGS MUCH BETTER WITH RESPECT TO THE OTHER SYSTEM

 VARIABLES. ONE SHOP MAY BE INVOLVED IN A MAJOR EFFORT TO REDUCE THE

 COST OF A SPECIFIC PROGRAM, ANOTHER SHOP MAY BE STARVED FOR STORAGE

 AND BE PINCHING FRAMES, AND A THIRD SHOP MAY BE CONSIDERING AN AP AND

 LOOKING FOR PERIODS OF CPU OVER SATURATION.

      THE FUNCTION OF POST PROCESSING SHOULD BE TO DELIVER IN THE MOST

 COMPACT AND USABLE FORM POSSIBLE ALL THE RELEVANT INFORMATION FOR

 MAKING THE APPROPRIATE LOCAL TUNING AND MANAGEMENT DECISIONS.

 ELEGANTLY FORMATTED REPORTS AGGREGATING 6 INCHES OF OUTPUT PER WEEK DO

 NOT MEET THESE CRITERIA. THE OBJECTIVE SHOULD BE TO PUT THE MAXIMUM

 INFORMATION READABLY ON A SINGLE SHEET OF PAPER. A FEW TABLES SHOWING

 AVERAGES, A FEW GRAPHS SHOWING THE TRENDS, AND DETAILS ABOUT THE BEST

 AND WORST CASES REPRESENT A REASONABLE GENERAL  REPORTING STRATEGY.


1                             OUR-MF GUIDE                      PAGE 49





      BUT EVEN MORE IMPORTANT IS THE THROW-AWAY POST-PROCESSOR, A

 PROGRAM PUT TOGETHER IN A FEW HOURS AND RUN FOR A FEW DAYS TO TRY

 SOMETHING NEW OR TO ANSWER A SPECIFIC QUESTION. IN PLI SUCH A PROGRAM

 IS QUITE POSSIBLE. INDEED, OMFPST2 WAS ITSELF WRITTEN AND DEBUGGED IN

 LESS THAN 6 HOURS. AND THERE IT WAS NECESSARY TO START FROM SCRATCH

 WITHOUT EXAMPLES OR PRECEDENT TO GUIDE IT.

      OF COURSE SERIOUS STATISTICAL OR GRAPHIC ANALYSIS MAY REQUIRE

 CONSIDERABLY MORE DEVELOPMENT TIME. SPECIALIZED AND TECHNICAL ANALYSIS

 ROUTINES WILL BE ADDED WITH FUTURE RELEASES OF OUR-MF.

      TO WRITE YOUR OWN POST-PROCESSOR, START WITH THE AVAILABLE

 EXAMPLES. OMFPST2 WAS WRITTEN MORE TO BE A PROTOTYPE THAN FOR WHAT IT

 ACTUALLY DOES. THE IMPORTANT THING IS NOT THE PROCESSING IT DOES,

 WHICH IS BASICALLY JUST A READ AND A PUT, BUT RATHER THE DEFINITION OF

 INPUT RECORDS, THE PARSING OF CONTROL CARDS, AND THE FILE HANDLING.

 THE OURMFDEF MACRO DEFINES THE THREE TYPES OF RECORDS, AND ONCE YOU

 HAVE ACCESS TO DATA AS PLI VARIABLES THE HARDEST PART IS PAST. IF YOU

 ARE WRITING THROW AWAY CODE, YOU CAN HARD CODE THE OPTIONS IN IT, BUT

 IF YOU ARE WRITING SOMETHING TO BE USED MANY TIMES YOU SHOULD CONSIDER

 THE DISTRIBUTED CONTROL CARD SUPPORT SO WE CAN ALL HAVE COMMON SYNTAX.

 AND IF YOU ARE PROCESSING THE PSW'S IN THE OMF1 RECORD USE CPU AS A

 MODEL, WHILE IF YOU ARE PROCESSING MOSTLY OMF2 WORKLOAD INFORMATION

 USE THE WKLOAD MODULE FOR AN EXAMPLE OF THE ACCESS TO PERFORMANCE

 GROUP PERIOD DATA.




1                             OUR-MF GUIDE                      PAGE 50





                           OUR-MF COMPONENTS



 NAME     TYPE        LANGUAGE  COMMENTS



 AMDPRSEG OBJECT                 TOD CONVERSION
 ASMTOZAP PROCEDURE   PLI        SUPPORT ROUTINE
 CNTLCRD  MACRO       PLI        PARAMETER PARSE SUPPORT
 CNTLOMF  SUBROUTINE  PLI        PARSE OURMF PARMS
 CPU      PROCEDURE   PLI        TSO COMMAND
 CVT      MACRO       PLI
 DMN      PROCEDURE   PLI        TSO COMMAND
 DYNALLOC MACRO       PLI        DYNAMIC ALLOCATION FROM PLI
 HG00101  PTF                    WORKLOAD COLLECTION ZAP
 IHALCCA  MACRO       BILINGUAL
 IHAPFTE  MACRO       BILINGUAL
 IHAPSA   MACRO       PLI
 IHAPVT   MACRO       PLI
 IHATQE   MACRO       ASM
 IRADMDT  MACRO       ASM
 IRARCT   MACRO       ASM
 IRAMCA   MACRO       PLI
 IRAMCT   MACRO       PLI
 IRAWAMT  MACRO       PLI
 IRBMFDWP ASMTOZAP
 OMFCMPL  JCL                    COMPILE ALL SOURCE
 OMFPST2  PROCEDURE   PLI        SIMPLE POST PROCESSOR
 OURMF    PROCEDURE   PLI        MEASUREMENT TASK
 OURMFDEF MACRO       PLI        DEFINE TRACE RECORDS
 OURMFJOB JCL                    INSTALLATION LKED AND SMP
 PAGES    PROCEDURE   PLI        TSO COMMAND
 PGBUF    MACRO       BILINGUAL  DATA AREA
 PLIMISC  SUBROUTINE  ASM        PLI CALLABLE PRIMITIVES
 RCT      PROCEDURE   PLI        TSO COMMAND
 STATDIE  PROCEDURE   ASM        TIMER DIE SUPPORT
 STATGLBL MACRO       BILINGUAL  GENERATION PARAMETERS
 STATPSW  MACRO       BILINGUAL  DATA AREA
 STDE     MACRO       BILINGUAL  DATA AREA
 S99FAIL  SUBROUTINE  PLI        SUPPORT DYNALLOC
 WKLOAD   PROCEDURE   PLI        TSO COMMAND
 YCCSTART MACRO       PLI        GENERAL PLI MACRO SUPPORT





1                             OUR-MF GUIDE                      PAGE 51





                                ASMTOZAP



      ASMTOZAP IS A UTILITY WHICH READS AN ASSEMBLER LISTING AND

 PRODUCES AMASPZAP CONTROL CARDS.  THIS ALLOWS NON-TRIVIAL PATCHES TO

 BE WRITTEN IN ASSEMBLER LANGUAGE WITH FULL USE OF SYMBOLIC REFERENCES,

 DSECTS, AND MACROS.  CODE IS POSITIONED AT THE CORRECT OFFSETS BY USE

 OF ORG.  SYMBOLIC ADDRESSES CAN BE GENERATED BY ORG, OR FAKED BY EQU,

 OR COPYED, ETC.  THERE IS LESS ROOM FOR ERROR, IMPROVED LEGIBILITY,

 AND CONVERSION FROM ONE RELEASE TO ANOTHER USUALLY INVOLVES ONLY

 CHANGING A FEW ORG'S TO REFLECT THE NEW ADDRESSES OF THE PATCH AREA OR

 ZAPPED INSTRUCTIONS.



      THERE ARE FOUR CONTROL CARDS WHICH ARE INCLUDED IN THE ASSEMBLER

 SOURCE AS COMMENTS WITH '*ZAP' IN COLUMNS 1-4.



 *ZAP CARD ZAP STATEMENTS

     EVERYTHING AFTER THE WORD 'CARD' IS REPRODUCED IN THE OUTPUT

     DATASET.  THIS IS USED TO PRODUCE NAME, DUMP, DUMPT, ++PTF, ++VER,

     ++ZAP, OR EXPAND CARDS.

     EXAMPLE:

     *ZAP CARD NAME IGG0003B IGG0003B

     *ZAP CARD DUMP IGG0003B

 *ZAP START {VER × REP}

     THIS MARKS THE BEGINNING OF A SECTION OF ASSEMBLER LANGUAGE WHICH

     IS TO BE PROCESSED BY ASMTOZAP.  ASSEMBLER COMMENT CARDS,

     ASSEMBLER CONTROL CARDS (PRINT, ORG, ETC.), MACRO REFERENCES, AND


1                             OUR-MF GUIDE                      PAGE 52





     OTHER LINES WHICH DO NOT GENERATE DATA WILL GENERATE ZAP COMMENT

     CARDS.  IF NEITHER VER NOR REP IS SPECIFIED, THE DEFAULT IS THE

     OPTION SPECIFIED ON THE PREVIOUS *ZAP START CARD.  VER OR REP MUST

     BE SPECIFIED BEFORE THE FIRST DATA GENERATING LINE IS ENCOUNTERED.

     MACHINE INSTRUCTIONS OR DC INSTRUCTIONS IN MAINLINE CODE OR IN

     MACRO EXPANSIONS ARE DATA GENERATING.

 *ZAP PAUSE

     THIS INHIBITS PROCESSING OF ASSEMBLER STATEMENTS UNTIL THE NEXT

     *ZAP START CARD IS ENCOUNTERED.  INITIALLY PROCESSING IS IN THE

     PAUSE'D STATE.

 *ZAP STOP

     THIS TERMINATES ASMTOZAP PROCESSING.  THIS CARD IS NECESSARY.  AN

     END-OF-FILE ON INPUT IS REGARDED AS AN ERROR.

      THE FOLLOWING HELPFUL HINTS ARE PROVIDED FOR POTENTIAL USERS:

     1) SPECIFY 'PRINT DATA'.  ANY OTHER SETTING OF PRINT IS PROBABLY

         WRONG.

     2) WHEN POSSIBLE, WRITE THE ASSEMBLER CODE AS A REAL PROGRAM WHICH

         CAN ACTUALLY RUN.  THIS HELPS YOU TO DEBUG THE ZAP BEFORE IT

         IS APPLIED.  IF THIS IS NOT POSSIBLE, TRY TO INCLUDE

         SUGGESTIONS FOR EXECUTING SECTIONS OF THE CODE UNDER TSO TEST.

         REMEMBER TO PAUSE PROCESSING BEFORE SECTIONS OF CODE INTENDED

         ONLY FOR DEBUGGING.

     3) PUT ALL THE VER SECTIONS FIRST - NOTE THAT THE ASSEMBLER WILL

         OVERWRITE CODE IF ORG SETS THE LOCATION COUNTER BACK, SO THIS

         SCHEME FOR VER AND THEN REP CODE WILL LEAVE THE NEW

         INSTRUCTIONS WHERE THEY ARE SUPPOSED TO BE DURING ASSEMBLER


1                             OUR-MF GUIDE                      PAGE 53





         DEBUGGING.

     4) GATHER ALL SENSITIVE MODULE OFFSETS TOGETHER AS A SEQUENCE OF

         EQU STATEMENTS AT THE BEGINNING OF THE ASSEMBLER SOURCE.

         THESE OFFSETS ARE THE MOST LIKELY TARGET OF SUBSEQUENT

         MAINTENANCE, AND PUTTING THEM ALL TOGETHER MAKES IT VERY EASY

         TO RECOVER FROM SUBSEQUENT IBM PTF'S.

      FOR AN EXAMPLE OF THE USE OF ASMTOZAP, EXAMINE THE MEMBER

 IRBMFDWP IN OURMFSRC AND RUN THE JOB ASZAPJCL WHICH WILL ASSEMBLE

 IRBMFDWP AND COMPILE AND RUN ASMTOZAP TO REPRODUCE THE HG00101  PTF.















DYNAMASK TITLE 'PROGRAM TO MODIFY ELIGIBLE DEVICE TABLE'
***********************************************************************
*    CHANGE DATE: MAY 1991       MVS 2.2 - ESA 3.1.3                  *
*                                                                     *
*    PROGRAM TO MODIFY THE ELIGIBLE DEVICES TABLE BASED ON            *
*    MOUNTED VOLUMES (DASD ONLY) OR ADDRESS CHANGE LIST               *
*                                                                     *
*    WRITTEN BY STEVE SMITH, CIRCA 1975,                              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*                                                                     *
*    MODIFIED FOR SU 64 BY DICK HINTON AND DOUG MERCER, JUNE 1980,    *
*       FOR THE LOCKHEED-CALIFORNIA COMPANY                           *
*                                                                     *
*    MODIFIED BY STEVE SMITH FEB 1981 TO INCLUDE 1976 MODS            *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*                                                                     *
*    MODIFIED TO USE DSECTS BY DOUG MERCER, JUNE 1983,                *
*       FOR THE LOCKHEED-CALIFORNIA COMPANY                           *
*                                                                     *
*    MODIFIED FOR XA ASSEMBLY BY DOUG MERCER, JUNE 1983,              *
*       FOR THE LOCKHEED-CALIFORNIA COMPANY. THE EXPECTED             *
*       VALUES IN SYSPARM ARE SYSPARM() FOR MVS/370,                  *
*       SYSPARM(TEST) FOR MVS/370 WITH TEST CODE (DOES NOT            *
*         MODIFY THE REAL EDT OR RUN AUTHORIZED)                      *
*       SYSPARM(XA) FOR MVS/XA,                                       *
*       SYSPARM(TESTXA) FOR MVS/XA WITH TEST CODE (DOES NOT           *
*         MODIFY THE REAL EDT OR RUN AUTHORIZED)                      *
*                                                                     *
*    MODIFIED FOR XA BY DOUG MERCER, NOVEMBER 1983,                   *
*       FOR THE LOCKHEED-CALIFORNIA COMPANY. THE UCB LOOKUP           *
*       TABLE HAS DISAPPEARED AND VARIOUS CHANGES HAVE BEEN           *
*       TO THE EDT. THE UCB HAS ALSO CHANGED BUT NOT IN ANY           *
*       MANNER AFFECTING DYNAMASK.                                    *
*                                                                     *
*    MODIFIED BY STEVE SMITH JAN 1984 FOR XA                          *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       SYSPARM(XA) REPLACED BY CONDITIONAL EXECUTION                 *
*                   BY TESTING FOR THE MVSE BIT IN CVT                *
*                                                                     *
*    MODIFIED BY STEVE SMITH AUG 1984 FOR MVS/370 AND XA              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       SYSPARM(NONXA) OR SYSPARM(TEST) ALLOW ASSEMBLY                *
*                   WITHOUT XA MACLIBS                                *
*       PROVIDE FREEMAIN FOR XA EDT EXECESS MEMORY AND OLD EDT        *
*       BUILD EDT REPLACED UNIT NAMES IN ORGINAL ORDER                *
*                                                                     *
*    MODIFIED BY STEVE SMITH APR 1985 FOR MVS/370 AND XA              *
*       AT  SECURITY PACIFIC NATIONAL BANK                            *
*       TO INCLUDE FIX SUPPLIED BY BRAIN COMPTON AND DWIGHT CLARKE    *
*       OF LITTON COMPUTER SEVICES: LOGIC ERROR FOR SPECIFIC UNIT     *
*       WHERE INDEX REGISTER WAS OMITTED IN GROUP BIT MASK UPDATE     *
*                                                                     *
*    MODIFIED BY STEVE SMITH SEP 1985 FOR MVS/370 AND XA              *
*       AT  SECURITY PACIFIC NATIONAL BANK                            *
*       ADD AIF CONDINTIONAL ASM TO BYPASS BSM INSTRUCTIONS           *
*       IN NONXA ONLY SHOPS.                                          *
*                                                                     *
*    MODIFIED BY STEVE SMITH APR 1986 FOR MVS/370 AND XA              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       TO ALLOW FOR COMMENT CARD IN CONTROL FILE                     *
*       TO ALLOW MODEL VOLUME OR UNIT ADDRESS                         *
*       (I.E.  TSODA*  /18* )                                         *
*                                                                     *
*    MODIFIED BY STEVE SMITH JUN 1986 FOR MVS/370 AND XA              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       TO ALLOW FOR PARM VALUE TO BE PLACE IN MESSAGE                *
*       USEFUL FOR SIGNALLING WTO EXITS AND AUTOMATIC                 *
*       OPERATOR SUBSYSTEMS                                           *
*                                                                     *
*    MODIFIED BY STEVE SMITH NOV 1986 FOR MVS/370 AND XA              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       TO BYPASS XA CODE IN TEST (NONXA) MODE                        *
*                                                                     *
*    MODIFIED BY STEVE SMITH MAR 1987 FOR MVS/370 AND XA              *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       TO ALLOW CUU RANGE SPECIFICATION AND ONE CHAR MODEL CUU       *
*       FIXED 0C4 IN TEST COMPARE ROUTINE                             *
*                                                                     *
*    MODIFIED BY STEVE SMITH MAR 1987 FOR XA                          *
*       FOR SECURITY PACIFIC NATIONAL BANK                            *
*       BYPASS LOAD OF EDT.  USE NIP GENERATED EDT IN JESCT.          *
*       THIS VERSION WILL USE THE EDT POINTED TO BY JESCT AND WILL    *
*       PASS GENERATED EDT IN HEADER FOR USE BY LATER EXECUTIONS      *
*       DO ENQ BEFORE UPDATING JESCT WITH EDT AND UPT
*                                                                     *
*    MODIFIED BY STEVE SMITH FEB 1988 FOR XA 2.2.0                    *
*       REQUIRED HEAVY MODIFICATION.  ALL POINTERS WITHIN             *
*       THE EDT ARE NOW INDEXES.   THIS VERSION ONLY SUPPORTS         *
*       XA 2.2.0,  IF A NON XA2.2.0 EDT IS DETECTED,  DYNAMSK2        *
*       WILL PASS CONTROL TO THE NONE 2.2.0 VERSION OF DYAMASK        *
*       WHICH MUST HAVE BEEN LINKEDITED WITH THIS VERSION             *
*                                                                     *
*    MODIFIED BY STEVE SMITH FEB 1988                                 *
*       PROVIDE OPTION TO FORCE A DEVICE GROUPS FOR A SELECTED        *
*       ESOTARIC TO BE MOVED IN FRONT OF OTHER DEVICES OF THE SAME    *
*       DEVICE TYPE.    THIS IS USEFULL FOR TAPE DEVICES TO AFFECT    *
*       SRM SELECTION ALGORITHEMS                                     *
*                                                                     *
*    MODIFIED BY STEVE SMITH NOV 1989                                 *
*       FIX ALTERNATE MASK BUILD LOGIC                                *
*                                                                     *
*    MODIFIED BY STEVE SMITH JUN 1990                                 *
*       PROVIDE FOR OPTION BITS TO BE TURNED OFF IN DEVTYPE           *
*       VALUE FOR SEVERAL DEVICE CLASSES                              *
*                                                                     *
*    MODIFIED BY STEVE SMITH NOV 1990                                 *
*       PROVIDE FOR 3480 IDRC AFFINITY MASK.                          *
*       PROVIDE SYSPARM(CKER) OPTION TO GENERATE A SYSIN VALIDATION   *
*       PROGRAM                                                       *
*                                                                     *
*    MODIFIED BY STEVE SMITH MAY 1991                                 *
*       FIX EDT LEV VALUE FOR IPCS EDT VALIDATION                     *
*       FIX 0C1 FOR 3480 IDRC AFFINITY MASK.                          *
*                                                                     *
*     ABSTRACT                                                        *
*                                                                     *
*     DYNAMSK2 PROVIDES THE ABILITY TO DYNAMICALLY CHANGE AND ADD     *
*     TO THE UNIT NAMES DEFINED AT SYSGEN.   DYNAMSK2 OPTIONALLY      *
*     CAN BE GIVEN UNIT ADDRESSES OR VOLUMES AND THE UNIT NAMES       *
*     WILL BE ASSIGNED TO THE UNIT ADDRESSES THAT THE VOLUMES ARE     *
*     CURRENTLY MOUNTED.  IT CAN BE RUN AT ANY TIME THE SYSTEM        *
*     IS DAINED OF ALL ACTIVITY.  DYNAMSK2 RUNS AS AN OPERATOR        *
*     REQUESTED OR BATCH SUBMITTED UTILITY WHICH MAKES THE            *
*     NECESSARY CONTROL BLOCK CHANGES AND EXITS.  IT REQUIRES         *
*     MINIMUM RESOURCES AND EXECUTES IN A FEW SECONDS.                *
*                                                                     *
*     DYNAMSK2 SUPPORTS THE FOLLOWING RELEASES:                       *
*                                                                     *
*     MVS/XA 2.2.0 -MVS/ESA 3.1.3                                     *
*        (SEE DYNAMASK FOR SUPPORT FOR PREVIOUS RELEASES)             *
*                                                                     *
*     INQUIRES:                                                       *
*                                                                     *
*     SEND INQUIRES TO:                                               *
*              STEVEN D. SMITH   G12-99                               *
*              SECURITY PACIFIC AUTOMATION COMPANY                    *
*              611 NORTH BRAND                                        *
*              GLENDALE, CA, 91203                                    *
*                                                                     *
*     OR PHONE: (818) 507-3014                                        *
*                                                                     *
*                                                                     *
*     INSTALLATION                                                    *
*                                                                     *
*     DYNAMSK2 IS A SINGLE MODULE AND MUST BE LINK EDITED INTO        *
*     AN AUTHORIZED LIBRARY WITH ATTRIBUTES AC=1 RENT REUS REFR       *
*     ASSEMBLY USING ASMH AND XA MACRO LIBRARY                        *
*     THERE IS ALSO A TEST MODE NOTED LATER IN THIS DOCUMENATION      *
*     IF DYNAMSK2 DETECTS A NON XA 2.2.0 EDT IT WILL ATTEMPT TO       *
*     PASS CONTROL TO DYNAMSK2.   IF YOU WANT TO UTILITIZE THIS       *
*     FEATURE IN ORDER TO HAVE ONLY ONE DYNAMASK FOR ALL LEVELS       *
*     OF THE OPERATION SYSTEM, YOU WILL NEED TO ALSO ASSEMBLE         *
*     THE REGULARE DYNAMASK AND LINK EDITED THE TWO TOGETHER.         *
*     DYNAMSK2 PROVIDE A WEEK EXTERNAL REFERANCE FOR THIS PURPOSE.    *
*                                                                     *
*     DYNAMSK2 SPECIFICATIONS MUST BE PROVIDED IN A CONTROL           *
*     LIBRARY LIKE SYS1.PARMLIB                                       *
*                                                                     *
*     THE DYNAMSK2 JCL MUST PROVIDE A SYSIN TO THE CONTROL            *
*     LIBRARY AND MEMBER.  WHEN RUN AS A STARTED TASK A PROC          *
*     MEMBER MUST BE PROVIDE IN SYS1.PROCLIB,                         *
*     A PARM VALUE MAY BE INCLUDED.  THE PARM VALUE IS PLACED         *
*     IN A WTO MESSAGE AND DISPLAYED AT THE END OF DYNAMSK2           *
*     PROCESSING.  THIS IS USEFUL FOR SIGNALING INSTALLATION          *
*     WTO EXIT OR AUTOMATIC OPERATOR SUBSYSTEM                        *
*     SAMPLE:                                                         *
*                                                                     *
*      //DYNAMSK2 PROC M=EDTUPDTE,P='START IPL POSTPROCESS'           *
*      //DYNAMSK2 EXEC PGM=DYNAMSK2,PARM=&P                           *
*      //SYSIN DD DISP=SHR,DSN=SYS1.PARMLIB(&M.)                      *
*                                                                     *
*     DYNAMSK2 CONTROL CARD FORMAT                                    *
*                                                                     *
*     STARTING IN COLLUME 1 THE UNIT NAME TO BE CHANGED OR ADDED      *
*     FOLLOWED BY A BLANK.                                            *
*                                                                     *
*     FOLLOWED BY VOLUME(S) AND/OR UNIT ADDRESS(ES) TO BE ASSIGNED    *
*     TO THIS UNIT NAME.  VOLUMES CAN BE SPECIFIED ONLY FOR DISK      *
*     DEVICES FOR UNIT NAMES OF DASD ONLY.                            *
*                                                                     *
*     VOLUMES ARE OF THE FORM: ONE TO SIX CHARACTER VOLUME IDS.       *
*     LIKEWISE A MODEL VOLUME OF ONE TO FIVE CHARACTERS PLUS          *
*     AN ASTERISK WILL SELECT ALL VOLUMES THAT MATCH THE MODEL.       *
*                                                                     *
*     UNIT ADDRESS ARE OF THE FORM: SLASH (/) AS FIRST CHARACTER,     *
*     FOLLOWED BY THE 3 DIGIT HEXIDECIMAL UNIT ADDRESS.               *
*     LIKEWISE A MODEL 1 OR 2 DIGIT HEXIDECIMAL ADDRESS PLUS          *
*     AN ASTERISK WILL SELECT ALL UNITS THAT MATCH THE FIRST GIVEN    *
*     DIGITS. A RANGE OF UNITS MAY BE SPECIFIED AS FOLLOWS /CUU-CUU   *
*                                                                     *
*                                                                     *
*     IF MORE THAN ONE VOLUME OR UNIT ADDRESS IS NEEDED EACH IS       *
*     SEPARATED BY A COMMA.  IF MORE ENTRIES ARE REQUIRED THAN        *
*     CAN BE CONTAINED ON ONE CARD, THE CARD CAN BE CONTINUED BY      *
*     PLACEING A COMMA AFTER THE LAST ENTRY. THE NEXT CARD MUST       *
*     BE CONTINUED ON OR AFTER COLUME 2.                              *
*                                                                     *
*     THE SPECIFIED UNIT NAME ASSIGNMENSTS NORMALLY REPLACE ALL       *
*     PREVIOUS ASSIGNMENTS.  HOWERER, IF A MINUS (-) PRECEDES         *
*     THE UNIT NAME, THE SPECIFIED UNIT.VOLUES ENTRIES WILL BE        *
*     EXCLUED FROM THE EXISTING ASSIGNMENTS FROM SYSGEN.              *
*                                                                     *
*     IF A PLUS (+) PRECEDES THE UNIT NAME, THE UNIT NAME IS          *
*     MARKED FOR VIO.                                                 *
*                                                                     *
*     AN ASTERISK (*) IN COLUME 1 INDICATES A COMMENT CARD.           *
*     A COMMENT CARD CAN BE PLACED ANYWHERE.                          *
*                                                                     *
*     SAMPLES:                                                        *
*                                                                     *
*          SYSDA SYSDA*                                               *
*                                                                     *
*          SORT  SYSDA1,SYSDA2,                                       *
*          * COMMENT CARD, THE NEXT CARD IS CONTINUATION OF PREVIOUS  *
*           SYSDA3,SYSDA4                                             *
*                                                                     *
*          -2400-3 /48E,/48F                                          *
*                                                                     *
*          TAPE1  /42*,/5*,/440-45F                                   *
*                                                                     *
*          +SYSVIO SYSDA1                                             *
*                                                                     *
*     IF THE SAME UNIT NAME IS SPECIFED MORE THAN ONCE, ONLY          *
*     THE FIRST IS USED.                                              *
*                                                                     *
*     ANY ERROR OR INVALID SPECIFICATION IN A UNIT NAME CAUSES        *
*     THAT UNIT NAME NOT TO BE UPDATED                                *
*                                                                     *
*     ANY ERROR OR INVALID SPECIFICATION IN A UNIT ADDRESS OR         *
*     VOLUME WILL BE IGNORED AND THE UNIT NAME WILL BE UPDATED        *
*     WITH ANY CORRECT UNIT ADDRESSES AND/OR VOLUMES. MISSING         *
*     VOLUMES ARE IGNORED.                                            *
*                                                                     *
*     ALL UNCHANGED UNIT NAMES FROM THE SYSGEN ARE RETAINED.          *
*     ONLY UNIT NAMES TO BE CHANGED NEED BE SPECIFIED.                *
*                                                                     *
*     RESTRICTIONS                                                    *
*                                                                     *
*     CURRENTLY, THERE IS NO ENCOMPASSING ENQUEUE NAME TO PROTECT     *
*     JOBES IN ALLOCATION WHEN THE EDT IS REPLACED.  DYNAMSK2         *
*     SHOULD BE RUN ONLY WHEN THE SYSTEM IS IN A DRAINED STATE        *
*     OR RIGHT AFTER IPL.  MOST SHOPS INCLUDE A START DYNAMSK2        *
*     COMMAND IN THE COMMND00 OF PARMLIB                              *
*                                                                     *
*     THE 'CGA' SOFTWARE PRODUCT GROUP'S 'MSX' MUST RUN START AFTER   *
*     DYNAMSK2.  TO FORCE SERIALATION WITH DYNAMSK2, INCLUDE A        *
*     DD CARD FOR THE MSX TABLE DATASET IF YOU USE MSX.               *
*     MSX WAS RENAMED TO MIM AND IS NOW OWNED BY LEGENT.              *
*     MIM 2.0 HAS CODE TO DETECT EDT REPLACEMENT BY DYNAMASK AND      *
*     DOES NOT REQUIRE SERIALATION.                                   *
*                                                                     *
*     STC 4400 (SILO, OR AUTO CART SYSTEM) SOFTWARE (HSC) IS AFFECTED *
*     BY EDT CHANGES.  AFTER RUNNING DYNAMASK THE HSC MUST BE         *
*     RESTARTED WITH A PARM OF COLD,RESET.  THIS CAN BE AVOIDED IN    *
*     SOME CASES BY USING DYNASWAP IN PLACE OF DYNAMASK.   A REQUEST  *
*     HAS BEEN MADE TO STORAGETEK TO DETECT EDT CHANGES LIKE MIM.     *
*                                                                     *
*     LOGIC FLOW                                                      *
*                                                                     *
*     DURING INITIZATION WORKING STORAGE IS UPTAINED AND CSA STORAGE  *
*     IS UPTAINED FOR THE NEW EDT (ELIGIBLE DIVICE TABLE). A LOAD     *
*     IS DONE FOR IEFEDTTB BUILD FROM SYSGEN AND USED FOR A MODEL.    *
*     FROM THE MODEL EDT AND INCORE CONTROL BLOCKS A DYNAMSK2 GROUP   *
*     UNIT CROSS REFERENCE TABLE (GXREF) IS BUILT.                    *
*                                                                     *
*     DYNAMSK2 THEN READS THE SYSIN FILE FOR CONTROL CARD AND BUILDS  *
*     A DYNAMSK2 MODIFIED NAME TABLE (MNT) ASSIGNING A MASK BIT       *
*     EACH UNIT NAME AND MARKS THE MASK IN THE GXREF FOR ALL RELATED  *
*     DEVICE ADDRESS (EXPLICED OR VOLUME RELATED) FOR EACH UNIT NAME. *
*                                                                     *
*     THE DEVICES REFERENCED IN THE GXREF CAN THEN BE REGROUPED BY    *
*     SORTING ON THE OLD GROUP NUMBER AND MASK IN THE GXREF.  THEN    *
*     NEW GROUP NUMBERS CAN BE ASSIGNED AND A NEW EDT CAN BE BUILD.   *
*     IN XA A NEW UCB POINTER LIST (UPL) IS BUILT IN FRONT OF THE     *
*     EDT JUST AFTER THE HEADER SECTION. THE FOLLOWING EDT SECTIONS   *
*     ARE BUILD IN ORDER: UCB INDEX SECTION, GROUP ID SECTION,        *
*     GROUP POINTER SECTION, GENERIC SECTION, GROUP LOOKUP SECTION,   *
*     AND LAST THE GROUP MASK SECTION.                                *
*                                                                     *
*     THE COMPLETED EDT (AND IN XA THE UPT) POINTERS ARE UPDATED      *
*     IN THE JESCT. THEN THE OLD EDT IF IT WAS BUILT BY DYNAMSK2      *
*     IS DELETED FROM STORAGE. THEN ANY USER SUPPLIED EXITS ARE       *
*     CALLED.                                                         *
*                                                                     *
*     TEST MODE                                                       *
*                                                                     *
*     TEST MODE CONTROLLED BY SYSPARM(TEST) OR SYSPARM(TESTXA).       *
*     ALSO A SECOND CSECT AFTER THE END CARD PROVIDE DUMP FORMATING   *
*     REQUIRES ASMH BATCH MODE FOR ASSEMBLY OR THE SECOND CSECT       *
*     COULD BE SEPERATED OUT FOR SEPERATE ASSEMBLY                    *
*                                                                     *
*     TEST MODE PROVIDES FOR BUILDING A NEW EDT WITHOUT UPDATING      *
*     CURRENT EDT POINTERS.  IT ALSO DUMPS GEN, OLD, AND NEW EDTS,    *
*     ALSO PROVIDING A COMPARE DUMP OF OLD AND NEW EDTS.              *
*     IN TEST MODE APF AUTHORIZATION IS NOT NEEDED.                   *
*                                                                     *
*     A VERSION OF DYNAMSK2 THAT WILL CHECK THE SYSIN INPUT AND       *
*     VALIDATE ALL VOLUME AND UNIT SPECIFICATION CAN BE CREATED.      *
*     TO DO THIS USE THE ASSEMBLER PARM OPTION OF SYSPARM(CKER)       *
*     THIS VERSION WILL NOT BUILD A EDT AND DOES NOT REQUIRE          *
*     AUTHORIZATION.                                                  *
*     NOTES                                                           *
*                                                                     *
*     ALL MESSAGES ARE OF THE FORM TSDXXX WHICH CAN BE EDITTED        *
*     TO LOCAL MESSAGE ID STANDARDS                                   *
*                                                                     *
*    ATTRIBUTES - REENTRANT                                           *
*    TAB SETTINGS - 10 16 36 41 72                                    *
*                                                                     *
***********************************************************************
***********************************************************************
         SPACE 3                                               DM JUN83
         PRINT OFF                                             DM JUN83
         MACRO ,                                               DM JUN83
         EDT   &TYPE=SP                                        DM NOV83
.* WRITTEN BY DOUG MERCER, JUNE 1983, FOR THE LOCKHEED-CALIFORNIA CO.
.* CHANGED BY DOUG MERCER, NOVEMBER 1983, FOR XA DIFFERENCES   DM NOV83
.* CHANGED BY STEVE SMITH, JANUARY  1984, FOR XA DIFFERENCES   SS JAN84
.* CHANGED BY STEVE SMITH, FEBRUARY 1988, FOR XA2.2            SS FEB88
EDT      DSECT ,                   ELIGIBLE DEVICES TABLE      DM JUN83
EDTNAME  DS    CL3                   EDT NAME                  SS FEB88
EDTLEVEL DS    C                     LEVEL                     SS FEB88
EDTCREAT DS    0CL8                EDT CREATION ID             SS FEB88
EDTCBNAM DS    CL6                 EDT CB NAME                 SS FEB88
EDTIDNUM DS    CL2                 EDT VER ID                  SS FEB88
EDTDATE  DS    CL8                   CREATION DATE (MM/DD/YY)  SS FEB88
EDTTIME  DS    CL5                     TIME (HH.MM)            SS FEB88
         DS    XL3                                             SS FEB88
EDTLKUP  DS    A                   POINTER TO LOOK-UP SECTION  DM JUN83
EDTGNRC  DS    A                   POINTER TO GENERIC SECTION  DM JUN83
EDTGRP   DS    A                   POINTER TO GROUP SECTION    DM JUN83
EDTUCB   DS    A                   POINTER TO UCB SECTION      DM JUN83
EDTMSK   DS    A                   POINTER TO MASK SECTION     DM JUN83
EDTGRPT  DS    A                   POINTER TO GROUP POINTERS   DM JUN83
EDTPREF  DS    A                   POINTER TO PREFERENCE TABLE DM JUN83
EDTTAPE  DS    A                   POINTER TO TAPE DEVICE EL   SS FEB88
* THE FOLLOWING ADDED TO HEADER FOR DYNAMSK2                   SS FEB88
EDTGENE  DS    A                   MVSCP GENERATED EDT ADDRESS SS FEB88
EDTSIZE  DS    A                   SUBPOOL AND SIZE OF EDT     SS FEB88
EDTHDRLX EQU   *-EDT               LENGTH OF THE HEADER        DM JUN83
         SPACE 2                                               DM JUN83
* EACH OF THE FOLLOWING SECTIONS IS PREFIXED BY                SS FEB88
*   A HEADER  - MOST ARE 12 BYTES LONG EXCEPT FOR LOOKUP HDR   SS FEB88
*   FIRST 8 BYTES ARE HEADER ID                                SS FEB88
*   NEXT  4 BYTES ARE THE NUMBER OF ENTRYS                     SS FEB88
*   NEXT  4 BYTES ARE FOR LOOKUP SECTION ONLY                  SS FEB88
*         2 BYTES ARE FOR LOOKUP INDEX TO FIRST ENTRY          SS FEB88
*         2 BYTES ARE RESERVED                                 SS FEB88
         SPACE ,                                               DM JUN83
LKPSECT  DSECT ,                   LOOK-UP SECTION             DM JUN83
LKPNAME  DS    CL8                 UNITNAME                    DM JUN83
LKPDEVT  DS    XL4                 DEVICE TYPE (AS IN CATALOG) DM JUN83
LKPMSKPT DS    A                   INDEX   TO MASK ENTRY       SS FEB88
LKPALTPT DS    A                   ALTERNATE MASK INDEX        SS FEB88
LKPGNRC# DS    F                   NUMBER OF GENERICS          DM JUN83
LKPFLAGS DS    XL2                 FLAGS                       DM JUN83
LKPVIO   EQU   X'80'               ELIGIBLE FOR VIO            SS JAN84
LKPAGMSK EQU   X'40'               GENERIC HAS ALT MASK        SS JAN84
LKPMGEN  EQU   X'20'               ALLOC OF MUTL GEN OK        SS JAN84
LKPGENR  EQU   X'10'               THIS IS A GENERIC: FULL DEV SS JAN84
LKPESOTR EQU   X'08'               THIS IS A ESOTERIC          SS JAN84
LKPGGERN EQU   X'04'               THIS IS A GENERATED GEN     SS JAN84
LKPGESOR EQU   X'08'               THIS IS A GENERATED ESOTR   SS FEB88
LKPAFFIX DS    H                   AFFINITY INDEX              SS FEB88
LKPGNRC1 DS    H                   INDEX   TO FIRST GENERIC    SS FEB88
LKPNXT   DS    H                   INDEX TO NEXT ENTRY         SS FEB88
LKPLNG   EQU   *-LKPSECT           LENGTH OF SECTION           DM JUN83
         SPACE ,                                               DM JUN83
GNRCSECT DSECT ,                   GENERIC SECTION             DM JUN83
GNRCDEVT DS    XL4                 DEVICE TYPE (AS IN CATALOG) DM JUN83
GNRCGRP# DS    F                   NUMBER OF GROUPS            DM JUN83
GNRCGRP1 DS    H                   INDEX   TO FIRST GROUP      SS FEB88
GNRCNXT  DS    H                   INDEX TO NEXT ENTRY         SS FEB88
GNRCLNG  EQU   *-GNRCSECT          LENGTH OF SECTION           DM JUN83
         SPACE ,                                               DM JUN83
GRPTSECT DSECT                     GROUP POINTER SEC           SS JAN84
GRPTPTR  DS    H                   A GROUP INDEX               SS FEB88
GRPTNXT  DS    H                   INDEX TO NEXT ENTRY         SS FEB88
GRPTLNG  EQU   *-GRPTSECT          LENGTH OF SECTION           SS FEB88
         SPACE ,                                               SS JAN84
GRPSECT  DSECT ,                   GROUP SECTION               DM JUN83
GRPID    DS    H                   GROUP ID NUMBER             SS FEB88
GRPDEV#  DS    H                   NUMBER OF DEVICES           SS FEB88
GRPUCB1  DS    A                   INDEX   TO FIRST UCB        SS FEB88
GRPNXT   DS    H                   INDEX TO NEXT ENTRY         SS FEB88
         DS    H                   RESERVED                    SS FEB88
GRPLNGX  EQU   *-GRPSECT           LENGTH OF SECTION XA SECT   DM JUN83
         SPACE ,                                               DM JUN83
MSKSECT  DSECT ,                   GROUP MASK SECTION          DM JUN83
MSKMASK  DS    X                   GROUP MASK (LENGTH VARIABLE)DM JUN83
MSKLNG   EQU   *-MSKSECT           LENGTH OF SECTION           DM JUN83
         SPACE ,                                               DM JUN83
UCBSECT  DSECT ,                   UCB POINTER SECTION         DM JUN83
DEV#     DS    CL3                 DEVICE NUMBER IN EBCDIC     DM NOV83
         DS    C                   EXTRA BYTE                  SS FEB88
DEVNXT   DS    F                   INDEX TO NEXT ENTRY         SS FEB88
UCBLNGX  EQU   *-UCBSECT           LENGTH OF SECTION XA SECT   DM JUN83
         SPACE ,                                               DM JUN83
         MEND  ,                                               DM JUN83
         PRINT ON                                              DM JUN83
         SPACE 3
DYNAMSK2 START ,
*                                                              SS AUG84
*  SETTING SYMBOLICS                                           SS AUG84
*                                                              SS AUG84
         GBLC  &SUBP,&XASP
&SUBP    SETC  '241'                                           SS AUG84
&XASP    SETC  '241'                                           SS AUG84
         AIF   ('&SYSPARM' NE 'TESTXA').TEST1A                 SS MAR87
&XASP    SETC  '0'                                             SS AUG84
.TEST1A  ANOP  ,
         AIF   ('&SYSPARM' NE 'TEST').TEST1B                   SS FEB88
&XASP    SETC  '0'                                             SS FEB88
.TEST1B  ANOP  ,
*
*  EQUATES FOR REGISTERS AND FLAGS
*
FF       EQU   X'FF'
EXCLUDE  EQU   X'01'
REPL     EQU   X'02'
PROMOTE  EQU   X'04'               PROMOTE IN SORT             SS FEB88
CVTPT    EQU   16                  PSA POINTER TO CVT
CVTILK2  EQU   40                  CVT POINTER TO UCB LOOK-UP  DM JUN83
CVTJESCT EQU   X'128'              JESCT ADDR                  SS JAN84
CVTDCB   EQU   X'74'               CVT SYSTEM TYPE OFFSET      SS JAN84
CVTMVSE  EQU   X'80'               XA MODE                     SS JAN84
JESUPLP  EQU   X'5C'               UCB POINTER LIST            SS JAN84
JESEDTA  EQU   X'34'               EDT POINTER                 SS JAN84
UPLUCBA  EQU   X'10'               FIRST POINTER IN LIST       SS JAN84
UCBSTAT  EQU   3,1,C'X'            UCB STATUS                  DM NOV83
UCBONLI  EQU   128                 DEVICE IS ONLINE            DM NOV83
UCBCHGS  EQU   64                  DEVICE IS TO BE CHANGED TO  DM NOV83
*               OFFLINE & ALLOCATION IS ENQUEUED OR DEVICE     DM NOV83
*               IS ALLOCATED                                   DM NOV83
UCBUNLD  EQU   16                  UNLOAD IN PROCESS           DM NOV83
UCBNAME  EQU   13,3,C'C'           UCB NAME                    DM NOV83
UCBNUM   EQU   4,2,C'X'            UCB DEVICE NUMBER           SS MAR87
UCBTYPE  EQU   16,4,C'X'           DEVICE TYPE                 DM NOV83
UCBDVCLS EQU   18,1,C'X'           DEVICE CLASS                DM NOV83
UCB3DACC EQU   32                  DASD CLASS                  DM NOV83
UCBVOLI  EQU   28,6,C'C'           VOLUME SERIAL               DM NOV83
R0       EQU   0
R1       EQU   1
R2       EQU   2                   USED FOR COUNTER
R3       EQU   3                   USED AS POINTER IN LOOP
R4       EQU   4                   UCB, POINTER  NEXT IN NEW EDT
R5       EQU   5                   COUNTER OR POINTER  NEW PTXREF
R6       EQU   6                   COUNTER OR POINTER  OLD PTXREF
R7       EQU   7                   COUNTER TO TOTAL FOR EACH SEC
R8       EQU   8                   POINTER TO MODEL EDT
R9       EQU   9                   SIZE OF GROUP - UNIT XREF
R10      EQU   10                  POINTER TO NEW EDT
R11      EQU   11                  PROGRAM BASE
R12      EQU   12                  PROGRAM BASE TWO
R13      EQU   13                  SAVE AREA/WORK BASE
R14      EQU   14
R15      EQU   15
         SPACE 3                                               DM JUL80
         SAVE  (14,12),T,DYNAMSK2                              SS FEB88
         LR    R11,R15             SET UP BASE                 DM JUN83
         USING DYNAMSK2,R11,R12                                SS FEB88
         LA    R12,2048(,R11)                                  DM JUN83
         LA    R12,2048(,R12)                                  DM JUN83
         L     R2,CVTPT                                        SS FEB88
         TM    CVTDCB(R2),CVTMVSE                              SS FEB88
         BZ    XA0                                             SS FEB88
         LA    R2,IN31J                 *                      SS FEB88
         O     R2,=X'80000000'          *                      SS FEB88
         BSM   0,R2                     *                      SS FEB88
IN31J    DS    0H                       *                      SS FEB88
         L     R2,CVTPT                 LOAD CVT ADDR          SS FEB88
         L     R2,CVTJESCT(R2)          LOAD JESCT ADDR        SS FEB88
         L     R2,JESEDTA(R2)           LOAD EDT ADDR          SS FEB88
         CLC   0(3,R2),=C'EDT'          XA2.2 EDT              SS FEB88
         BE    XA220                    YES                    SS FEB88
         LA    R2,XA0                   *                      SS FEB88
         BSM   0,R2                     *                      SS FEB88
XA0      DS    0H                                              SS FEB88
         L     R15,OLDDYNA              *                      SS FEB88
         LM    0,12,20(13)              RELOAD REG 0-12        SS FEB88
         BR    R15                      *                      SS FEB88
         WXTRN DYNAMASK                 *                      SS FEB88
OLDDYNA  DC    A(DYNAMASK)              *                      SS FEB88
XA220    DS    0H                       *                      SS FEB88
         LA    R2,IN24J                 *                      SS FEB88
         BSM   0,R2                     *                      SS FEB88
IN24J    DS    0H                                              SS FEB88
         L     R0,GETMLEN          LENGTH OF GETMAIN           RCHJUN79
         LR    R6,R1               SAVE PARM ADDR              SS JUN86
         GETMAIN R,LV=(0)          STORAGE FOR WORK AND TABLES
         LR    R2,R1               AREA TO ZERO                RCHJUN79
         L     R3,GETMLEN          LENGTH TO ZERO              RCHJUN79
         SR    R4,R4               FROM ADDRESS NULL           RCHJUN79
         SR    R5,R5               FILL CHAR & FROM LEN        RCHJUN79
         MVCL  R2,R4               ZERO GETMAIN AREA           RCHJUN79
         ST    R1,8(R13)           FORWARD POINTER
         ST    R13,4(R1)           BACK POINTER
         LR    R13,R1              SET BASE/SAVE AREA
         USING SAVE,R13                                        SS AUG84
         L     R2,=A(GXREFEND-SAVE)     ADDRESS END OF XREF    DM JUN83
         AR    R2,R1                      GETMAIN AREA         RCHJUN79
         ST    R2,GXREFXXX                                     SS AUG84
         MVC  0(8,R2),=C'ENDXXXXX' GETMAIN END INDICATOR       RCHJUN79
         MVC   SYSIN,SYSINDCB      COPY DCB'S TO               DM JUN83
         MVC   SYSPRINT,SYSPRDCB        GETMAINED CORE         DM JUN83
         MVI   OCLIST,X'80'        SET END                     DM JUL80
         OPEN  (SYSIN,INPUT),MF=(E,OCLIST)                     DM JUN83
         TM    SYSIN+48,X'10'      DID IT OPEN                 DM JUN83
         BZ    MSG1                NO, ERROR
         OPEN  (SYSPRINT,OUTPUT),MF=(E,OCLIST)                 DM JUN83
         MVI   FLAG2,0                                         SS JAN84
         MVI   SAVEPARM,C' '            BLANK AREA             SS JUN86
         MVC   SAVEPARM+1(19),SAVEPARM  RIPPLE                 SS JUN86
         LTR   R5,R6               ANY PARM PASSED             SS JUL86
         BZ    NOPARM              NO                          SS JUN86
         L     R5,0(R5)            PARM ADDRESS                SS JUN86
         LTR   R5,R5               ANY                         SS JUN86
         BZ    NOPARM              NO                          SS JUN86
         LH    R1,0(R5)            GET LENGTH                  SS JUN86
         LTR   R1,R1               ANY LENGTH                  SS JUN86
         BZ    NOPARM              NO                          SS JUN86
         CH    R1,=H'20'           MAX SIZE                    SS JUN86
         BNH   *+8                 OK                          SS JUN86
         LH    R1,=H'20'           ONLY FIRST 20               SS JUN86
         BCTR  R1,0                ONE LESS FOR MVC            SS JUN86
         MVC   SAVEPARM(0),2(R5)        EXECUTED MOVE          SS JUN86
         EX    R1,*-6                   EXECUTE THE MOVE       SS JUN86
NOPARM   DS    0H                                              SS JUN86
         MVI   FLAGS,1             INIT, = LOOK FOR UNIT NAME  SS MAR87
         AIF   ('&SYSPARM' EQ 'CKER').CKER1                    SS NOV90
         AIF   ('&SYSPARM' EQ 'TEST' OR                                -
               '&SYSPARM' EQ 'TESTXA').TEST3                   DM JUN83
         MODESET KEY=ZERO
.TEST3   ANOP  ,                                               DM JUN83
         L     R0,CORESIZX         SET GETMAIN SIZE            SS JAN84
         GETMAIN RU,LV=(0),LOC=ANY,SP=&XASP AREA FOR EDT       SS JAN84
         LR    R10,R1              SET AREA TO R10             SS MAR87
.CKER1   ANOP  ,                                               SS NOV90
*
*  BUILD GROUP - UNIT CROSS REFERENCE TABLE FOR XA
*
         LA    R1,IN31A                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31A    DS    0H                                              SS JAN84
         L     R2,CVTPT            LOAD CVT ADDR               DM NOV83
         L     R2,CVTJESCT(R2)     LOAD JESCT ADDR             SS JAN84
         L     R3,JESEDTA(R2)      LOAD OLD EDT PTR            SS JAN84
         CLC   DYNAHDR(8),EDTCREAT-EDT(R3)  OWR EDT            SS MAR87
         BE    GETGEN              YES, GET GEN EDT            SS MAR87
         LR    R8,R3               ASSUME GEN EDT              SS MAR87
         OI    FLAG2,GENEDT        CURRENT IS GEN EDT          SS MAR87
         B     SETEDT                   *                      SS MAR87
         USING EDT,R8                   *                      SS FEB88
GETGEN   DS    0H                       *                      SS MAR87
         L     R8,EDTGENE-EDT(R3)       GET GEN EDIT           SS MAR87
SETEDT   LA    R8,0(,R8)                CLEAR BIT ZERO         SS AUG84
         ST    R8,EDTPTR                SAVE SYSGEN EDT        SS AUG84
         AIF   ('&SYSPARM' EQ 'CKER').CKER3                    SS NOV90
         ST    R8,EDTGENE-EDT(R10) SAVE GEN EDT                SS MAR87
         MVC   EDTSIZE-EDT(4,R10),CORESIZX  SAVE CURRENT SIZE  SS FEB88
         MVI   EDTSIZE-EDT(R10),&XASP       SAVE SUBPOOL       SS FEB88
.CKER3   ANOP  ,                                               SS NOV90
         L     R1,CVTPT                 CVT                    SS JAN84
         L     R1,CVTJESCT(R1)          JESCT                  SS JAN84
         L     R1,JESUPLP(R1)           UCB PT TLE             SS JAN84
         LA    R1,UPLUCBA-4(R1)         OFFSET FOR INDEX       SS JAN84
         MVC   PREFTAB,EDTPREF     SAVE IBM PREFTAB ADDR       DM JUN83
         MVC   TAPETAB,EDTTAPE     SAVE IBM TAPETAB ADDR       SS FEB88
         L     R3,EDTGRP                GRP PT SEC             DM JUN83
         USING GRPSECT,R3                                      DM JUN83
         L     R2,8(R3)                 NUM OF PT              SS FEB88
         LA    R3,12(R3)                OVER HDR               SS FEB88
         LA    R4,GXREF
         USING GXREFDEF,R4                                     DM JUN83
BLDGX2   LH    R5,GRPID                 GRP ID                 SS JAN84
         LH    R6,GRPDEV#               UCBS IN GRP            SS JAN84
         L     R7,EDTUCB                UCB SEC                SS JAN84
         L     R7,GRPUCB1               FIRST DEV INDEX        SS JAN84
         LR    R14,R7                   SAVE INDEX             SS FEB88
         SLA   R7,2                     TIMES 4 (FULL WORD)    SS JAN84
         ALR   R7,R1                    INDEX INTO UCB LIST    SS JAN84
         USING UCBSECT,R7                                      DM JUN83
BLDGXE2  STH   R5,GXROLDID              OLD GRP ID             SS JAN84
         XC    GXRNEWID,GXRNEWID        ZERO NEW ID            DM JUN83
         MVC   GXRUCBPT(4),0(R7)        COPY UCB ADDR          SS JAN84
         XC    GXRMASKS,GXRMASKS        ZERO  MASK             SS JAN84
         OI    GXRMASKS,X'80'           NOT PROMOTED           SS FEB88
         LR    R7,R14                   GET DEVICE ENTRY       SS FEB88
         SLA   R7,3                     TIMES 8                SS FEB88
         AL    R7,EDTUCB                ADD SECTION ADDRESS    SS FEB88
         LA    R7,12-8(,R7)             ADJUST FOR TRUE ADDR   SS FEB88
         L     R7,DEVNXT                GET NEXT INDEX         SS FEB88
         LR    R14,R7                   SAVE THIS INDEX        SS FEB88
         SLA   R7,2                     TIMES 4                SS FEB88
         ALR   R7,R1                    INDEX TO UCB LIST      SS FEB88
         LA    R4,GXRLNG(R4)            NEXT GXE               DM JUN83
         C     R4,GXREFXXX              END OF GETMAIN AREA    SS AUG84
         BNL   MSG7                     YES....EXIT WITH ERROR SS AUG84
         BCT   R6,BLDGXE2               FOR EACH IN GRP
         LA    R3,GRPLNGX(R3)           NEXT GRP               DM JUN83
         BCT   R2,BLDGX2                FOR ALL GRPS
         DROP  R3,R4,R7                                        DM JUN83
         L     R9,EDTUCB                UCB PT SEC             DM JUN83
         L     R9,8(R9)                 NUM UCBS               SS FEB88
         ST    R9,NUMUNIT               SAVE FOR LATER         SS JAN84
         LA    R1,IN24A                 BACK TO 24  BIT MODE   SS JAN84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24A    DS    0H                                              SS JAN84
.TEST3E  ANOP  ,                                               SS SEP85
XA4      DS    0H                                              SS JAN84
*
*  BUILD MODIFIED NAME TABLE FROM INPUT AND SET MASK IN GXREF
*  FOR EACH VOLSER OR CUU
*
         L     R6,=X'40000000'          MASK BIT ONE           SS FEB88
         LA    R5,MNT                   MODIFIED NAME TABLE
         LA    R9,0                     MASK INDEX             SS JAN84
BLDMNT   BAL   R14,GETNEXT              NEXT FIELD
         C     R15,=F'255'              END OF FILE
         BE    SORTGRP
         MVI   MNTFLAG(R5),X'00'        PRE ZERO FLAG          SS JAN84
         CLI   BUF,C'<'                 PROMOTE FLAG           SS FEB88
         BNE   TESTEXD                  NO                     SS FEB88
         OI    MNTFLAG(R5),PROMOTE      YES                    SS FEB88
         B     OVERCHAR                                        SS FEB88
TESTEXD  DS    0H                       *                      SS FEB88
         CLI   BUF,C'-'                 IS IT EXCLUDE FUNCTION
         BNE   TESTVIO                  NO NEXT TEST
         OI    MNTFLAG(R5),EXCLUDE      INDICATES EXCLUDE      SS JAN84
         B     OVERCHAR
TESTVIO  CLI   BUF,C'+'                 IS IT VIO
         BNE   SKIPFLAG                 NO
         OI    MNTFLAG(R5),LKPVIO       INDICATES VIO          SS JAN84
OVERCHAR C     R15,=F'9'                MAX OF 1+8 CHARS
         BH    MSG2                     TOO BIG
         MVC   MNTNAME(8,R5),BUF+1      COPY UNIT NAME         SS JAN84
         B     SETMASK
SKIPFLAG C     R15,=F'8'                MAX OF 8 CHARS
         BH    MSG2                     TOO BIG
         MVC   MNTNAME(8,R5),BUF        COPY UNIT NAME         SS JAN84
SETMASK  ST    R6,MNTMASK(R5)           SAVE MASK              SS JAN84
         STH   R9,MNTMASKI(R5)          SAVE MASK INDEX        SS JAN84
EACHU    BAL   R14,GETNEXT              GET A UNIT
         C     R15,=F'255'              END OF RECORD
         BE    BUMPMNT                  YES BUMP FOR NEXT NAME
         CLI   BUF,C'/'                 IS IT CUU
         BE    SCANALL                  YES
         C     R15,=F'6'                MAX CHAR IN VOLSER
         BH    MSG3                     TOO BIG
         BCTR  R15,0                    SET TO END             SS APR86
         LA    R14,BUF(R15)                 OF VOLUME          SS APR86
         CLI   0(R14),C'*'              IS IT GENERIC          SS APR86
         BE    SCANGEN                  YES                    SS APR86
         SR    R14,R14                  ZERO COUNT             SS APR86
         LA    R15,5                    SET COMPARE LENGTH     SS APR86
         B     SCANINIT                 DO SCAN                SS APR86
SCANGEN  DS    0H                                              SS APR86
         LTR   R15,R15                  ONE CHAR LONG          SS APR86
         BZ    EACHU                    YES IGNORE             SS APR86
         SR    R14,R14                  ZERO COUNT             SS APR86
         BCTR  R15,0                    ADJUST COMPARE LENGTH  SS APR86
SCANINIT DS     0H                      COMMENT                SS APR86
         L     R2,NUMUNIT               NUM OF UCBS            SS JAN84
         LA    R3,GXREF                 START SCAN ON TABLE
         USING GXREFDEF,R3                                     DM JUN83
SCANVOL  L     R4,GXRUCBPT              UCB ADDR               SS JAN84
         TM    UCBDVCLS(R4),UCB3DACC    IS IT DASD             SS JAN84
         BNO   BUMPU                    NO                     SS JAN84
         TM    UCBSTAT(R4),UCBCHGS+UCBUNLD OFFLINE/UNLOAD BITS DM NOV83
         BNZ   BUMPU                    YES DO NOT USE
         TM    UCBSTAT(R4),UCBONLI      ONLINE/SL BITS         DM NOV83
         BNO   BUMPU                    NOT THERE DO NOT USE
         CLC   UCBVOLI(0,R4),BUF        IS THIS A VOLUME MATCH SS APR86
         EX    R15,*-6                  COMPARE WITH LENGTH    SS APR86
         BNE   BUMPU                    NO SKIP
         TM    MNTFLAG(R5),PROMOTE      PROMOTE                SS FEB88
         BZ    NOPRM1                   NO                     SS FEB88
         NI    GXRMASKS,X'7F'           OFF NO PROMOTE BIT     SS FEB88
NOPRM1   DS    0H                       *                      SS FEB88
         L     R4,GXRMASK(R9)           YES ... GET MASK       SS JAN84
         OR    R4,R6                    OR INTO MASK
         ST    R4,GXRMASK(R9)           PUT MASK BACK          SS JAN84
         C     R15,=F'5'                FULL VOL SER           SS APR86
         BE     EACHU                   YES, NO MORE COMPARES  SS APR86
         LA     R14,1(,R14)             BUMP COUNT OF VOLS     SS APR86
BUMPU    LA    R3,GXRLNG(R3)            NEXT UNIT IN GXE       DM JUN83
         BCT   R2,SCANVOL
         DROP  R3                                              DM JUN83
         LTR   R14,R14                  ANY VOLUMES            SS APR86
         BNZ   EACHU                    YES, NO MSG            SS APR86
         B     MSG4
SCANALL  DS    0H                                              SS APR86
         NI    FLAG2,255-RANGE      CLEAR FLAG                 SS MAR87
         C     R15,=F'8'            RANGE OF DEVICES           SS MAR87
         BE    SCANRNG              YES                        SS MAR87
         C     R15,=F'4'            MAX SIZE FOR ONE CUU       SS MAR87
         BH    MSG8                 OVER... ERROR              SS MAR87
         CLI   BUF+2,C'*'               GENERIC ONE CHAR       SS MAR87
         BE    UNITGEN1                 SETUP                  SS MAR87
         CLI   BUF+3,C'*'               GENERIC                SS APR86
         BE    UNITGENC                 YES                    SS APR86
         LA    R15,2                    SET COMPARE LENGH      SS APR86
         SR    R14,R14                  ZERO VOL COUNT         SS APR86
         B     SCANALLI                 CONTINUE               SS APR86
SCANRNG  DS    0H                   *                          SS MAR87
         CLI   BUF+4,C'-'           SYTAX CHECK                SS MAR87
         BNE   MSG8                 ERROR                      SS MAR87
         LA    R1,BUF+1             POINT TO FIRST CUU         SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         LA    R1,1(,R1)            CHAR 2                     SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         LA    R1,1(,R1)            CHAR 3                     SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         LA    R1,2(,R1)            NEXT CUU                   SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         LA    R1,1(,R1)            CHAR 2                     SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         LA    R1,1(,R1)            CHAR 4                     SS MAR87
         BAL   R14,CHECKHEX         *                          SS MAR87
         MVI   BUF+4,C'0'           SIGN AND PAD               SS MAR87
         MVI   BUF+8,C'0'           SIGN AND PAD CUU 2         SS MAR87
         PACK  DBLWRD(3),BUF+1(4)                              SS MAR87
         MVC   LOWCUU(2),DBLWRD     *                          SS MAR87
         PACK  DBLWRD(3),BUF+5(4)                              SS MAR87
         MVC   HICUU(2),DBLWRD      *                          SS MAR87
         CLC   HICUU,LOWCUU         RANGE MUST BE IN ORDER     SS MAR87
         BNH   MSG8                 ERROR.. OUT OF ORDER       SS MAR87
         OI    FLAG2,RANGE          *                          SS MAR87
         B     SCANALLI                 CONTINUE               SS APR86
UNITGEN1 DS    0H                                              SS MAR87
         LA    R15,0                    SET COMPARE LENGH      SS MAR87
         SR    R14,R14                  ZERO VOL COUNT         SS MAR87
         B     SCANALLI                 CONTINUE               SS MAR87
UNITGENC DS    0H                                              SS APR86
         LA    R15,1                    SET COMPARE LENGH      SS APR86
         SR    R14,R14                  ZERO VOL COUNT         SS APR86
SCANALLI L     R2,NUMUNIT               NUM OF UCBS            SS APR86
         LA    R3,GXREF                 START AT TOP
         USING GXREFDEF,R3                                     DM JUN83
SCANUCB  L     R4,GXRUCBPT              UCB PT                 DM JUN83
         TM    FLAG2,RANGE              PROCESSING RANGE       SS MAR87
         BO    CKRANGE                  YES                    SS MAR87
         CLC   UCBNAME(0,R4),BUF+1      MATCH UNIT ADDRESS     SS APR86
         EX    R15,*-6                  COMPARE WITH LENGTH    SS APR86
         BNE   NEXTU                    NO MATCH
         B     SETCUU               *                          SS MAR87
CKRANGE  DS    0H                   *                          SS MAR87
         CLC   UCBNUM(2,R4),LOWCUU  LOWER THAN LOW             SS MAR87
         BL    NEXTU                YES, SKIP                  SS MAR87
         CLC   UCBNUM(2,R4),HICUU   HIGHER THAN HI             SS MAR87
         BH    NEXTU                YES, SKIP                  SS MAR87
         B     SETCUU               GOOD ON                    SS MAR87
SETCUU   L     R4,GXRMASK(R9)           YES, GET MASK          SS MAR87
         OR    R4,R6                    OR MASKS TOGETHER
         ST    R4,GXRMASK(R9)           PUT NEW MASK BACK      SS APR85
         TM    MNTFLAG(R5),PROMOTE      PROMOTE                SS FEB88
         BZ    NOPRM2                   NO                     SS FEB88
         NI    GXRMASKS,X'7F'           OFF NO PROMOTE BIT     SS FEB88
NOPRM2   DS    0H                       *                      SS FEB88
         TM    FLAG2,RANGE              PROCESSING RANGE       SS MAR87
         BO    BUMPVC                   *                      SS MAR87
         C     R15,=F'2'                IS IT GENERIC          SS APR86
         BE    EACHU                    NO, CONTINUE NEXT CUU  SS APR86
BUMPVC   LA    R14,1(,R14)              BUMP VOL COUNT         SS MAR87
NEXTU    LA    R3,GXRLNG(R3)            NEXT UNIT              DM JUN83
         BCT   R2,SCANUCB
         DROP  R3                                              DM JUN83
         LTR   R14,R14                  ANY VOLUMES            SS APR86
         BNZ   EACHU                    YES, CONTINUE NEXT CUU SS APR86
         B     MSG5                     NEVER FOUND IT
         SPACE ,                                               DM JUN83
BUMPMNT  LA    R5,MNTLN(R5)             NEXT NAME              SS JAN84
         SRL   R6,1                     SHIFT MASK TO NEXT BIT
         LTR   R6,R6                    MAX OF 32 SHIFTS
         BNZ   BLDMNT                   CONTINUE INPUT
         LA    R9,4(R9)                 BUMP MASK INDEX        SS JAN84
         LA    R2,GXRMASKZ              MAX INDEX SIZE         SS JAN84
         CR    R2,R9                    AT END OF MASK         SS JAN84
         BE    MSG6                     YES, MESSAGE           SS JAN84
         L     R6,=X'80000000'          START NEXT MASK        SS FEB88
         B     BLDMNT                   CONTINUE
SORTGRP  MVI   0(R5),FF                 END FLAG
         AIF   ('&SYSPARM' EQ 'CKER').CKER2                    SS NOV90
*
* SORT GROUP - UNIT XREF BY OLD GROUP AND MASK BITS
*
SORTAGN  MVI   BFLAG,0                  ZERO SORT COMPLETE FLAG
         LA    R2,GXREF                 START OF TABLE
         USING GXREFDEF,R2                                     DM JUN83
         L     R3,NUMUNIT               NUM OF UNITS           SS JAN84
         BCTR  R3,0                     LESS ONE
COMPAIR  CLC   GXROLDID(GXRSORTL),GXROLDID+GXRLNG  COMPRE      SS JAN84
         BNH   INORDER                  NO SWITCH
         XC    GXREFDEF(GXRLNG),GXREFDEF+GXRLNG  SWITCH        SS JAN84
         XC    GXREFDEF+GXRLNG(GXRLNG),GXREFDEF    CURRENT AND SS JAN84
         XC    GXREFDEF(GXRLNG),GXREFDEF+GXRLNG      NEXT      SS JAN84
         MVI   BFLAG,FF                 SORT INCOMPLETE
INORDER  LA    R2,GXRLNG(R2)            MOVE TO NEXT           DM JUN83
         DROP  R2                                              DM JUN83
         BCT   R3,COMPAIR               REPEAT
         CLI   BFLAG,FF                 ANY CHANGES
         BE    SORTAGN                  YES, RESORT
         DROP  R8                       *                      SS FEB88
*                                                              SS FEB88
* BUILD UCB POINTER LIST  (UPL)                                SS FEB88
*                                                              SS FEB88
         LA    R1,IN31B                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31B    DS    0H                                              SS JAN84
         USING EDT,R10                                         DM JUN83
         MVC   EDTCREAT,DYNAHDR    IDENTIFY CREATOR            DM JUN83
         TIME  DEC                                             DM JUN83
         SRL   R0,12               SHIFT OFF SECONDS           DM JUN83
         STM   R0,R1,DBLWRD                                    DM JUN83
         OI    DBLWRD+3,15         SIGN TIME                   DM JUN83
         MVC   WTOE(7),=X'402120204B2020'                      DM JUN83
         ED    WTOE(7),DBLWRD+1    FORMAT TIME                 DM JUN83
         MVC   EDTTIME,WTOE+2      TO HEADER                   DM JUN83
         XC    DBLWRD(4),DBLWRD    ZERO TIME FROM DBLWRD       DM JUN83
         BAL   R14,TOCAL           CONVERT DATE TO CALENDAR    DM JUN83
         MVC   WTOE(10),=X'40212020612020612020'               DM JUN83
         ED    WTOE(10),DBLWRD+4   FORMAT DATE                 DM JUN83
         MVC   EDTDATE,WTOE+2      TO EDT HEADER               DM JUN83
         LA    R2,GXREF
         USING GXREFDEF,R2                                     DM JUN83
         L     R3,NUMUNIT               NUM OF UNITS           SS JAN84
         LA    R4,EDT+EDTHDRLX          NEW UCB PT SEC         SS AUG84
         ST    R4,UPLSTR                SAVE START OF UPL      SS JAN84
*        MVC   EDTNAME(4),=CL4'EDT '                           SS AUG84
         MVC   EDTNAME(4),EDTNAME-EDT(R8) COPY ID VALUE        SS MAY91
         L     R1,CVTPT                 CVT                    SS JAN84
         L     R1,CVTJESCT(R1)          JESCT                  SS JAN84
         L     R1,JESUPLP(R1)           UCB PT LIST            SS JAN84
         MVC   0(UPLUCBA,R4),0(R1)      COPY HEADER            SS JAN84
         LA    R4,UPLUCBA(R4)           START OF UCP PT LIST   SS JAN84
BLDUS2   L     R1,GXRUCBPT              UCB ADDR               SS JAN84
         ST    R1,0(R4)                 ADD TO UCB PT LIST     SS JAN84
         LA    R4,4(R4)                 NEXT ENTRY             DM JUN83
         LA    R2,GXRLNG(R2)            NEXT GXREF ENTRY       DM JUN83
         BCT   R3,BLDUS2
*                                                              SS FEB88
* BUILD UCB (DEVICE) SECTION                                   SS FEB88
*                                                              SS FEB88
         USING UCBSECT,R4               *                      SS FEB88
         L     R3,NUMUNIT               NUM OF UNITS           SS JAN84
         ST    R4,EDTUCB                INIT HDR               DM JUN83
         MVC   0(8,R4),=CL8'DEVTAB'     ID                     SS FEB88
         ST    R3,8(R4)                 CNT IN UCB PT SEC HDR  SS FEB88
         LA    R4,12(R4)                OVER HEADER            SS FEB88
         LA    R2,GXREF
         LA    R6,1                     STARTING INDEX         SS FEB88
BLDUS3   L     R1,GXRUCBPT              UCB ADDR               SS JAN84
         MVC   DEV#,UCBNAME(R1)         COPY DEV CUU           SS JAN84
         LA    R6,1(,R6)                NEXT ENTRY             SS FEB88
         ST    R6,DEVNXT                SET NEXT INDEX         SS FEB88
         LA    R4,UCBLNGX(R4)           NEXT ENTRY             SS FEB88
         LA    R2,GXRLNG(R2)            NEXT GXREF ENTRY       DM JUN83
         BCT   R3,BLDUS3
         DROP  R2                                              DM JUN83
*                                                              SS FEB88
* BUILD NEW GROUP ID SECTION RE GROUPING BASED ON MASK         SS FEB88
*                                                              SS FEB88
         LA    R4,3(R4)                 ROUND UP TO FULL WORD
         N     R4,=F'-4'                TRUNCATE TO FULLWORD   DM NOV84
         USING GRPSECT,R4                                      DM JUN83
         ST    R4,EDTGRP                INIT HDR               DM JUN83
         MVC   0(8,R4),=CL8'GRPTAB'     INIT GRP SEC HDR       SS FEB88
         LA    R4,12(R4)                OVER GRP SEC HDR       SS FEB88
         LA    R2,GXREF
         USING GXREFDEF,R2                                     DM JUN83
         L     R3,NUMUNIT               NUM OF UNITS           SS JAN84
         LA    R5,1                     FIRST NEW GRP ID
         LA    R9,1                     FIRST UCB INDEX        SS JAN84
         LR    R6,R2                    TO COMPRESS GXREF
BLDGS    SR    R7,R7                    TO COUNT UCBS IN GRP
TESTGRP  CLC   GXROLDID,GXROLDID-GXREFDEF(R6)   CHK GRP ID     DM JUN83
         BNE   SETGE                    NO, SET UP FOR NEXT
         CLC   GXRMASKS,GXRMASKS-GXREFDEF(R6) CHK MASK         SS JAN84
         BNE   SETGE                    NO, SET UP FOR NEXT
         LA    R2,GXRLNG(R2)            NEXT GXE               DM JUN83
         LA    R7,1(R7)                 COUNT UNITS THIS GRP
         BCT   R3,TESTGRP               KEEP COUNTING UNITS IN GRP
SETGE    STH   R5,GXRNEWID-GXREFDEF(R6) NEW GRP IN GXREF       SS JAN84
         STH   R5,GRPID                 GRP ID IN ENTRY        DM JUN83
         STH   R7,GRPDEV#               NUM UCBS IN GRP        DM JUN83
         ST    R9,GRPUCB1               POINT TO 1ST UCB OF GR SS FEB88
         L     R14,GXRUCBPT             GET OLD UCB POINTER    SS FEB88
         L     R15,GXRUCBPT-GXREFDEF(R6) NEW UCB POINTER       SS FEB88
         LA    R15,1(,R5)               INDEX TO NEXT ENTRY    SS FEB88
         STH   R15,GRPNXT               SET CHAIN              SS FEB88
         CLC   UCBTYPE+1(1,R14),UCBTYPE+1(R15) NEW DEV GROUP   SS FEB88
         BE    SETNXTIX                 NO                     SS FEB88
         SR    R15,R15                  YES, ZERO              SS FEB88
         ST    R15,GRPNXT                 CHAIN                SS FEB88
SETNXTIX LA    R9,0(R7,R9)              FIRST INDEX OF NEXT    SS JAN84
         LR    R15,R9                   *                      SS FEB88
         BCTR  R15,0                    LAST ENTRY OF GROUP    SS FEB88
         SLA   R15,3                    OFFSET TO LAST         SS FEB88
         AL    R15,EDTUCB               ADDRESS HEADER         SS FEB88
         LA    R15,12-8(,R15)           ADJUST ADDRESS         SS FEB88
         XC    DEVNXT-UCBSECT(4,R15),DEVNXT-UCBSECT(R15) CLEAR SS FEB88
         LA    R4,GRPLNGX(R4)           NEXT ENTRY             DM JUN83
         LTR   R3,R3                    WAS IT LAST UCB
         BZ    FIXGS                    YES, COMPLETE HDR
         LA    R6,GXRLNG(R6)            NEXT GXE               SS JAN84
*              COMPRESS                                        DM JUN83
         MVC   GXREFDEF-GXREFDEF(GXRLNG,R6),GXREFDEF           DM JUN83
         LA    R5,1(R5)                 NEXT NEW GRP ID
         B     BLDGS
         DROP  R2,R4                                           DM JUN83
         SPACE ,                                               DM JUN83
FIXGS    L     R1,EDTGRP                HDR GRP SEC            DM JUN83
         ST    R5,8(R1)                 INIT HDR WITH NUM OF GRPS
         ST    R5,NUMUNIT               NEW SIZE OF GXREF
         LA    R6,GXRLNG(R6)            START PTXREF AFTER GXREF
         ST    R6,APTXREF               HOLD FOR LATER
         LA    R4,3(R4)                 ROUND UP TO FULL WORD  SS JAN84
         N     R4,=F'-4'                TRUNCATE TO FULLWORD   SS JAN84
*
*  BUILD GROUP POINTER TABLE
*
         ST    R4,ADRGRPT               SAVE ADDRESS           DM NOV83
         ST    R4,EDTGRPT               INIT HDR ADDR GRP PTR  DM NOV83
         MVC   0(8,R4),=CL8'GPPTAB'     INIT HEADER            SS FEB88
         LA    R4,12(R4)                OVER HEADER            SS FEB88
         SR    R7,R7                    ZERO COUNT OF ENTRIES
         L     R3,EDTLKUP-EDT(,R8)      OLD LOOK UP SEC        DM JUN83
         L     R2,8(R3)                 NUM OF ENTRIES         SS FEB88
         LH    R14,12(R3)               INDEX TO FIRST ENTRY   SS FEB88
         LA    R15,16                   ENTY LENG -HEADR LENG  SS FEB88
         SLR   R3,R15                   ADJUST ADDR            SS FEB88
         ST    R3,SAVELUAD              SAVE IT                SS FEB88
         SLA   R14,5                    TIMES 32 (LENGTH)      SS FEB88
         ALR   R3,R14                   ADDR FIRST ENTRY       SS FEB88
         USING LKPSECT,R3                                      DM JUN83
BLDGPLU  LA    R1,MNT                   MODIFIED NAME TABLE
SCANNM   CLI   0(R1),FF                 END OF NAMES
         BE    NOMOD                    YES,  NO FOUND .. NO MOD
         CLC   MNTNAME(8,R1),LKPNAME    ARE UNIT NAMES SAME    SS JAN84
         BNE   NEXTNM                   NO, TRY NEXT
         TM    MNTFLAG(R1),EXCLUDE      WE GOING TO MODIFY IT  SS JAN84
         BZ    RPUNIT                   NO, WE REPLACE IT      SS AUG84
         MVC   MASK,MNTMASK(R1)         YES,  SAVE MASK FOR CMPSS JAN84
         LH    R9,MNTMASKI(R1)          GET MASK INDEX         SS JAN84
         B     SETGN                    CONTINUE WORKING THE EDT
NEXTNM   LA    R1,MNTLN(,R1)            NEXT MOD NAME TABLE EN SS JAN84
         B     SCANNM
NOMOD    MVC   MASK,=F'0'               USE NULL MASK
         LA    R9,0                     USE NULL INDEX         SS JAN84
SETGN    STM   R2,R3,COUNT1             SAVE OUTER LOOP CONTROL
         PUSH  USING                                           DM JUN83
         L     R2,LKPGNRC#              COUNT FOR GENERIC      SS FEB88
         LTR   R2,R2                    TEST FOR ZERO GENERICS SS SEP84
         BZ    BUMPUN2                  SKIP THIS NAME         SS SEP84
         LH    R15,LKPGNRC1             INDEX OF FIRST GENERIC SS FEB88
         AH    R15,LKPGNRC1             TIMES 2                SS FEB88
         AH    R15,LKPGNRC1             PLUE 1 = X3            SS FEB88
         LR    R3,R15                   COPY TO R3             SS FEB88
         SLA   R3,2                     THEN TIMES 4 = X12     SS FEB88
         AL    R3,EDTGNRC-EDT(,R8)      ADD ADDRESS            SS FEB88
         SR    R15,R15                  ZERO FOR NULL GENERIC  SS FEB88
         USING GNRCSECT,R3                                     DM JUN83
GENGN    STM   R2,R3,COUNT2             SAVE NEXT IN LOOP CONTROL
         PUSH  USING                                           DM JUN83
         L     R2,GNRCGRP#              COUNT OF POINTER       SS FEB88
         LH    R3,GNRCGRP1              INDEX FIRST POINTER    SS FEB88
         SLA   R3,2                     TIMES 4                SS FEB88
         AL    R3,EDTGRPT-EDT(,R8)      ADD ADDRESS            SS FEB88
         LA    R3,12-4(,R3)             ADJUST ADDRESS         SS FEB88
         USING GRPTSECT,R3                                     SS JAN84
         SR    R15,R15                  NEW COUNT OF PT
         ST    R15,SAVEGRPT             SET FOR NULL           SS FEB88
GETGP    LH    R1,GRPTPTR               LOAD INDEX   TO GRP    SS FEB88
         AH    R1,GRPTPTR               TIME 2                 SS FEB88
         AH    R1,GRPTPTR               PLUE 1 = X3            SS FEB88
         SLA   R1,2                     THEN TIMES 4 = X12     SS FEB88
         AL    R1,EDTGRP-EDT(,R8)       ADD ADRESS             SS FEB88
*              ADJUST +12 FOR HEADER -12 FOR FIRST ENTRY       SS FEB88
         MVC   GROUP,GRPID-GRPSECT(R1)  SAVE FOR COMPARE       SS JAN84
         L     R5,NUMUNIT               NUM UNITS              SS JAN84
         LA    R14,GXREF                FOR SCAN OF TABLE
         USING GXREFDEF,R14                                    DM JUN83
FINDGP   CLC   GROUP,GXROLDID           SAME GROUP             DM JUN83
         BNE   NEXTGRP                  NO TRY NEXT
         L     R0,GXRMASK(R9)           MASK                   SS JAN84
         N     R0,MASK                  SAME BIT ON
         BNZ   NEXTGRP                  BIT ON, EXCLUDE THIS GROUP
         LA    R15,1(R15)               ONE MORE INCLUDED
         LA    R7,1(R7)                 1 TO TOTAL
         MVC   0(2,R4),GXRNEWID         SET INDEX (ID)         SS FEB88
         LA    R0,1(R7)                 NEXT ENTRY             SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R4)  SET CHAIN              SS FEB88
         ST    R4,SAVEGRPT              SAVE IF LAST IN CHAIN  SS FEB88
         LA    R4,GRPTLNG(R4)           BUMP TO NEXT PLACE     DM JUN83
NEXTGRP  DS    0H                                              SS FEB88
         LA    R14,GXRLNG(R14)          NEXT IN GXREF          DM JUN83
         BCT   R5,FINDGP                WORK ALL GROUPS
         LA    R3,GRPTLNG(R3)           NEXT OLD POINTER       DM JUN83
         BCT   R2,GETGP
         DROP  R14                                             DM JUN83
         STH   R15,0(R6)                SAVE COUNT             SS JAN84
         ICM   R15,15,SAVEGRPT          GET LAST ENTRY         SS FEB88
         BZ    NULLGRPT                 *                      SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R15)   CHAIN                SS FEB88
NULLGRPT LA    R6,2(R6)                 NEXT PTXREF            SS JAN84
         LM    R2,R3,COUNT2             RESTORE LOOP CONTROL
         POP   USING                                           DM JUN83
         LA    R3,GNRCLNG(R3)           NEXT GENERIC           DM JUN83
         BCT   R2,GENGN                 REPEAT FOR THIS GENERIC
         B     BUMPUN
RPUNIT   OI    MNTFLAG(R1),REPL         INDICATE REPLACED      SS AUG84
         STM   R2,R3,COUNT1             SAVE OUTER LOOP CONTROL
*        PUSH  USING ALREADY DONE AFTER LABEL SETGN            SS AUG84
*                                                              SS AUG84
*    SET GROUP POINTERS FOR REPLACED NAMES                     SS AUG84
*                                                              SS AUG84
         L     R5,NUMUNIT               GXREF COUNTER          SS AUG84
         LA    R14,GXREF                TO SCAN GXREF          SS AUG84
         USING GXREFDEF,R14                                    SS AUG83
         SR    R15,R15                  COUNTER OF GROUPS      SS AUG84
         ST    R15,SAVEGRPT             SET FOR NULL GRPT      SS FEB88
         LH    R9,MNTMASKI(R1)          MASK INDEX             SS AUG84
MATCHMSK L     R0,GXRMASK(R9)           MASK FROM GXREF        SS AUG84
         N     R0,MNTMASK(R1)           COMPARE MASKS          SS AUG84
         BZ    NOTMATCH                 GROUP NOT INCLUDED     SS AUG84
         MVC   0(2,R4),GXRNEWID         SET INDEX (ID)         SS FEB88
         LA    R7,1(R7)                 ADD 1 TO TOTAL         SS AUG84
         LA    R0,1(R7)                 NEXT ENTRY             SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R4)  SET CHAIN              SS FEB88
         ST    R4,SAVEGRPT              SAVE IF LAST IN CHAIN  SS FEB88
         LA    R15,1(R15)               NUM GROUPS FOR THIS NAMES AUG84
         LA    R4,GRPTLNG(R4)           NEXT PLACE FOR POINTER SS AUG84
NOTMATCH DS    0H                                              SS FEB88
         LA    R14,GXRLNG(R14)          NEXT GROUP IN GXREF    SS AUG84
         BCT   R5,MATCHMSK              KEEP LOOKING OF MATCHESSS AUG84
         DROP  R14                                             SS AUG84
BUMPUN2  DS    0H                       MAKE PLACE HOLDER      SS SEP84
         STH   R15,0(R6)                SAVE COUNT IN PTXREF   SS AUG84
         ICM   R15,15,SAVEGRPT          GET LAST ENTRY         SS FEB88
         BZ    NULLGRP2                 *                      SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R15)   CHAIN                SS FEB88
NULLGRP2 LA    R6,2(R6)                 NEXT PLACE IN PTXREF   SS AUG84
         B     BUMPUN                                          SS AUG84
*
*
BUMPUN   LM    R2,R3,COUNT1             RESTORE LOOP CONTROL
         POP   USING                                           DM JUN83
         LH    R3,LKPNXT                INDEX OF NEXT ENTRY    SS FEB88
         SLA   R3,5                     TIMES 32               SS FEB88
         AL    R3,SAVELUAD              ADD ADJUSTED ADDRESS   SS FEB88
         BCT   R2,BLDGPLU
         DROP  R3                                              DM JUN83
*
*    ADD GROUP POINTERS FOR NEW NAMES
*
         USING GRPTSECT,R4                                     DM JUN83
         LA    R2,MNT                   USE MODIFIED NAME TABLE
ADDGP    CLI   0(R2),FF                 LAST ENTRY INDICATOR
         BE    ENDGP                    YES, CLEANUP THIS SECTION
         TM    MNTFLAG(R2),EXCLUDE      EXCLUDE OPERATION
         BO    BUMPMNTB                 YES, DO NOT ADD
         TM    MNTFLAG(R2),REPL         REPLACED UNIT
         BO    BUMPMNTB                 YES, DO NOT ADD
         L     R5,NUMUNIT               GXREF COUNTER          SS JAN84
         LA    R14,GXREF                TO SCAN GXREF
         USING GXREFDEF,R14                                    DM JUN83
         SR    R15,R15                  COUNTER OF GROUPS
         ST    R15,SAVEGRPT             SAVE NULL GROUPS       SS FEB88
SCANMASK LH    R9,MNTMASKI(R2)          MASK INDEX             SS JAN84
         L     R0,GXRMASK(R9)           MASK FROM GXREF        SS JAN84
         N     R0,MNTMASK(R2)           COMPARE MASKS          SS JAN84
         BZ    NOMATCH                  GROUP NOT INCLUDED
         MVC   0(2,R4),GXRNEWID         SET INDEX (ID)         SS FEB88
         LA    R7,1(R7)                 ADD 1 TO TOTAL
         LA    R0,1(R7)                 NEXT ENTRY             SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R4)  SET CHAIN              SS FEB88
         ST    R4,SAVEGRPT              SAVE IF LAST IN CHAIN  SS FEB88
         LA    R15,1(R15)               NUM GROUPS FOR THIS NAME
         LA    R4,GRPTLNG(R4)           NEXT PLACE FOR POINTER DM JUN83
NOMATCH  DS    0H                                              SS FEB88
         LA    R14,GXRLNG(R14)          NEXT GROUP IN GXREF    DM JUN83
         BCT   R5,SCANMASK              KEEP LOOKING OF MATCHES
         DROP  R14                                             DM JUN83
         STH   R15,0(R6)                SAVE COUNT OF GROUPS IN PTXREF
         ICM   R15,15,SAVEGRPT          GET LAST ENTRY         SS FEB88
         BZ    NULLGRP3                 *                      SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(R15)   CHAIN                SS FEB88
NULLGRP3 LA    R6,2(R6)                 NEXT PLACE IN PTXREF   SS FEB88
BUMPMNTB LA    R2,MNTLN(R2)             NEXT NAME IN MNT
         B     ADDGP
ENDGP    L     R14,ADRGRPT              HEAD OF GROUP PT SEC   DM NOV83
         ST    R7,8(R14)                INIT HDR .. COUNT      SS FEB88
*
*   BUILD GENERIC SECTION
*
         LA    R14,1                    POINTER INDEX AT ONE   SS FEB88
         ST    R4,EDTGNRC               INIT HDR .. NEW GENERIC SEC
         USING GNRCSECT,R4                                     DM JUN83
         MVC   0(8,R4),=CL8'GENTAB'     INIT HEADER            SS FEB88
         LA    R4,12(R4)                OVER HEADER            SS FEB88
         SR    R7,R7                    ZERO COUNT OF TOTAL ENTRIES
         L     R6,APTXREF               RESET TO BEGINNING OT PTXREF
         LR    R5,R6                    BUILD OVER OLD
         L     R3,EDTLKUP-EDT(R8)       LOOKUP SEC IN OLD EDT  DM JUN83
         L     R2,8(R3)                 ENTRIES IN LOOKUP SEC  SS FEB88
         LH    R3,12(,R3)               INDEX OF FIRST ENTRY   SS FEB88
         SLA   R3,5                     TIMES 32               SS FEB88
         AL    R3,SAVELUAD              ADD ADJUSTED ADDRESS   SS FEB88
         USING LKPSECT,R3               *                      SS FEB88
BLDGN    LA    R1,MNT                   CHECK WITH MODIFIED NAME TABLE
CKNM     CLI   0(R1),FF                 END OF NAME INDICATOR
         BE    ENDCK                    YES
         CLC   0(8,R1),0(R3)            UNIT NAME SAME
         BNE   MORECK                   TRY AGAIN
         TM    MNTFLAG(R1),EXCLUDE      IS IT EXCLUDE OPER
         BO    ENDCK                    YES, OK, PROCESS IT
         B     REPLTHIS                 NO, REPLACED           SS AUG84
MORECK   LA    R1,MNTLN(R1)             NEXT NAME IN MNT
         B     CKNM
ENDCK    STM   R2,R3,COUNT1             SAVE LOOP CONTROL
         L     R2,LKPGNRC#              COUNT FOR GENERIC      SS FEB88
         LH    R15,LKPGNRC1             INDEX OF FIRST GENERIC SS FEB88
         AH    R15,LKPGNRC1             TIMES 2                SS FEB88
         AH    R15,LKPGNRC1             PLUE 1 = X3            SS FEB88
         LR    R3,R15                   COPY TO R3             SS FEB88
         SLA   R3,2                     THEN TIMES 4 = X12     SS FEB88
         AL    R3,EDTGNRC-EDT(,R8)      ADD ADDRESS            SS FEB88
         SR    R15,R15                  ZERO                   SS FEB88
         ST    R15,SAVEGRPT             NULL ENTRY             SS FEB88
         LR    R15,R2                   MAY ADJUST COUNT
         LTR   R2,R2                    CHECK FOR ANY GENERICS SS SEP84
         BNZ   BLDGNE                   NORMAL                 SS SEP84
         LA    R6,2(,R6)                SKIP PLACE HOLDER      SS SEP84
         B     NOGENR                   NO REAL GENERICS       SS SEP84
BLDGNE   LH    R1,0(R6)                 COUNT OF POINTERS      SS JAN84
         LTR   R1,R1                    HAS IT BEEN NULLED
         BZ    COMPACT                  YES, DONT USE THIS GENERIC
         MVC   GNRCDEVT,GNRCDEVT-GNRCSECT(R3) COPY OLD DEVTYP  DM JUN83
         ST    R1,GNRCGRP#              COUNT OF POINTERS      DM JUN83
         STH   R14,GNRCGRP1             SET INDEX OF FIRST     SS FEB88
         AR    R14,R1                   INDEX OF NEXT SET      SS FEB88
         LA    R7,1(,R7)                BUMP TOTAL GENERICS
         LA    R0,1(,R7)                INDEX OF NEXT ENTRY    SS FEB88
         STH   R0,GNRCNXT               SET CHAIN              SS FEB88
         ST    R4,SAVEGRPT              SAVE IN CASE LAST      SS FEB88
         LA    R4,GNRCLNG(R4)           NEXT NEW GENERIC       DM JUN83
         B     BUMPGN
COMPACT  BCTR  R15,0                    ONE LESS GENERIC THAN BEFORE
BUMPGN   LA    R6,2(R6)                 PT GO SIZE OF NEXT SET SS JAN84
         LA    R3,GNRCLNG(R3)           NEXT OLD GENERIC       SS JAN84
         BCT   R2,BLDGNE
NOGENR   DS    0H                       SET GENERICS TO ZERO   SS SEP84
         STH   R15,0(R5)                SAVE NUM OF GENERICS   SS JAN84
         ICM   R15,15,SAVEGRPT          GET LAST ENTRY         SS FEB88
         BZ    NULLGRP4                 *                      SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GNRCNXT-GNRCSECT(R15)   CHAIN                SS FEB88
NULLGRP4 LA    R5,2(R5)                 NEXT SLOT              SS JAN84
         B     OVERTHIS                                        SS AUG84
*
*   BUILD GENERICS FOR  REPLACED UNIT NAMES
*
REPLTHIS STM   R2,R3,COUNT1             SAVE OUTTER LOOP REGS  SS AUG84
         LA    R15,GXRLNG               LENGTH OF GRXREF ENT   SS AUG84
         STH   R15,GXRLNG2              SAVE LENG FOR MH       SS AUG84
         LH    R2,0(R6)                 CNT PT FOR NEW NAME    SS AUG84
         ST    R6,COUNT2                HOLD SO REG CAN BE USEDSS AUG84
         SR    R6,R6                    ZERO COUNT OF GENERICS SS AUG84
         LTR   R2,R2                    ARE THERE ANY DEV      SS AUG84
         BZ    NOGENER                  NO NO GN FOR THIS ONE  SS AUG84
         SR    R0,R0                    NULL DEVTYP            SS AUG84
         SR    R15,R15                  START WITH NO POINTERS SS AUG84
         ST    R15,SAVEGRPT             NULL ENTRY             SS FEB88
SCANON   DS    0H                                              SS FEB88
         LR    R1,R14                   SET UP INDEX           SS FEB88
         SLA   R1,2                     TIMES 4                SS FEB88
         AL    R1,EDTGRPT               ADD ADDRESS OF SEC     SS FEB88
         LA    R1,12-4(,R1)             ADJUST ADDRESS         SS FEB88
         ST    R1,SAVEGRPT              SAVE FOR LATER         SS FEB88
         LH    R1,0(,R1)                GET INDEX VALUE (ID)   SS FEB88
         BCTR  R1,0                     OFFSET TO ZERO         SS AUG84
         MH    R1,GXRLNG2               OFFSET INTO  GXREF     SS AUG84
         LA    R1,GXREF(R1)             ADDRES OF ENTRY        SS AUG84
         L     R1,GXRUCBPT-GXREFDEF(R1) GET UCB ADDR           SS AUG84
         CLI   UCBTYPE+2(R1),X'20'      DASD TYPE              SS JUN90
         BE    YESDASD                  YES                    SS JUN90
         CLI   UCBTYPE+2(R1),X'08'      UNIT RECORD            SS JUN90
         BE    YESUR                    YES                    SS JUN90
         CLI   UCBTYPE+2(R1),X'10'      GRAPFICS DEVICE        SS JUN90
         BE    OPTOFF                   YES, OPTIONS OFF       SS JUN90
         CLI   UCBTYPE+2(R1),X'40'      TELEPROCESSING         SS JUN90
         BE    OPTOFF                   YES, OPTIONS OFF       SS JUN90
         CLI   UCBTYPE+2(R1),X'41'      CTC                    SS JUN90
         BE    YESCTC                   YES                    SS JUN90
         L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JUN90
         B     NODASD                   NO SHR BIT             SS JUN90
YESDASD  L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JUN90
         N     R1,=X'FFDFFFFF'          TURN OFF SHR BITS      SS JUN90
         B     NODASD                   NO SHR BIT             SS JUN90
YESUR    CLI   UCBTYPE+3(R1),X'09'      3211 TYPE              SS JUN90
         BE    YES3211                  YES                    SS JUN90
OPTOFF   L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JUN90
         N     R1,=X'FF00FFFF'          TURN OFF OPT BITS      SS JUN90
         B     NODASD                   NO SHR BIT             SS JUN90
YES3211  L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JUN90
         N     R1,=X'FF80FFFF'          TURN OFF OPT BITS      SS JUN90
         B     NODASD                   NO SHR BIT             SS JUN90
YESCTC   L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JUN90
         N     R1,=X'0000FFFF'          TURN OFF OPT BITS      SS JUN90
         B     NODASD                   NO SHR BIT             SS JUN90
NODASD   CR    R0,R1                    SAME AS CURRENT        SS AUG84
         BE    DONTADD                  COUNT UNTIL NEW DEVTYP SS AUG84
         LTR   R0,R0                    YES,  FIRST TIME       SS AUG84
         BZ    FIRSTONE                 YES, SET UP THIS DEVTYPSS AUG84
         ST    R15,GNRCGRP#             GROUPS CNT - THIS GENERIC AUG84
         LA    R15,GRPTLNG              POINTER LENGTH         SS FEB88
         LNR   R15,R15                  NEG TO BACK UP         SS FEB88
         AL    R15,SAVEGRPT                FROM LAST GR PTER   SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(,R15)  CHAIN                SS FEB88
         SR    R15,R15                  RESET TO ZERO FOR NEXT SS AUG84
         LA    R7,1(,R7)                BUMP TOTAL GENERICS    SS FEB88
         LA    R0,1(,R7)                INDEX OF NEXT ENTRY    SS FEB88
         STH   R0,GNRCNXT               SET CHAIN              SS FEB88
         LA    R4,GNRCLNG(R4)           NEXT NEW GENERIC       SS AUG84
FIRSTONE ST    R1,GNRCDEVT              SET DEVTYPE            SS AUG84
         STH   R14,GNRCGRP1             SET INDEX OF FIRST     SS FEB88
         LR    R0,R1                    NEW BECOMES OLD DEVTYPESS AUG84
         LA    R6,1(R6)                 ONE MORE GENERIC       SS AUG84
DONTADD  LA    R14,1(R14)               NEXT GROUP POINTER     SS FEB88
         LA    R15,1(R15)               ONE MORE POINTER TO COUNT AUG84
         BCT   R2,SCANON                                       SS AUG84
         ST    R15,GNRCGRP#             GRPS FOR THIS GENERIC  SS AUG84
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GNRCNXT-GNRCSECT(R4)    CHAIN                SS FEB88
         LA    R4,GNRCLNG(R4)           NEXT SLOT FOR GENERIC  SS AUG84
         LA    R7,1(R7)                 ONE TO TOTAL COUNT     SS AUG84
NOGENER  STH   R6,0(R5)                 SAVE COUNT OF GENERICS SS AUG84
         LA    R5,2(R5)                 BUMP FOR NEXT UNITNAME SS AUG84
         L     R6,COUNT2                RESTORE THIS REG       SS AUG84
         LA    R6,2(R6)                 NEXT COUNT TO POINTERS SS AUG84
OVERTHIS LM    R2,R3,COUNT1             RESTORE LOOP CONTROL   SS AUG84
         USING LKPSECT,R3               *                      SS FEB88
         LH    R3,LKPNXT                INDEX OF NEXT ENTRY    SS FEB88
         SLA   R3,5                     TIMES 32               SS FEB88
         AL    R3,SAVELUAD              ADD ADJUSTED ADDRESS   SS FEB88
         BCT   R2,BLDGN
         DROP  R3                       *                      SS FEB88
*
*   ADD GENERICS FOR NEW UNIT NAMES                            SS AUG84
*
         LA    R3,MNT                   GET NAMES FROM MNT
         LA    R15,GXRLNG               LENGTH OF GRXREF ENT   SS JAN84
         STH   R15,GXRLNG2              SAVE LENG FOR MH       SS JAN84
ADDGN    CLI   0(R3),FF                 END OF TABLE
         BE    SETGNC                   YES, CLEANUP
         TM    MNTFLAG(R3),EXCLUDE      EXCLUDE OPERATION
         BO    NXTNM                    ALREADY PROCESSED
         TM    MNTFLAG(R3),REPL         REPLACED UNIT          SS AUG84
         BO    NXTNM                    ALREADY PROCESSED      SS AUG84
         LH    R2,0(R6)                 CNT PT FOR NEW NAME    SS JAN84
         ST    R6,COUNT2                HOLD SO REG CAN BE USED
         SR    R6,R6                    ZERO COUNT OF GENERICS
         LTR   R2,R2                    ARE THERE ANY DEV
         BZ    NOGNS                    NO NO GN FOR THIS ONE
         SR    R0,R0                    NULL DEVTYP
         SR    R15,R15                  START WITH NO POINTERS
SCANMORE DS    0H                                              SS FEB88
         LR    R1,R14                   SET UP INDEX           SS FEB88
         SLA   R1,2                     TIMES 4                SS FEB88
         AL    R1,EDTGRPT               ADD ADDRESS OF SEC     SS FEB88
         LA    R1,12-4(,R1)             ADJUST ADDRESS         SS FEB88
         ST    R1,SAVEGRPT              SAVE FOR LATER         SS FEB88
         LH    R1,0(,R1)                GET INDEX VALUE (ID)   SS FEB88
         BCTR  R1,0                     OFFSET TO ZERO         SS JAN84
         MH    R1,GXRLNG2               OFFSET INTO  GXREF     SS JAN84
         LA    R1,GXREF(R1)             ADDRES OF ENTRY        SS JAN84
         L     R1,GXRUCBPT-GXREFDEF(R1) GET UCB ADDR           SS JAN84
         CLI   UCBTYPE+2(R1),X'20'      DASD TYPE              SS JAN84
         L     R1,UCBTYPE(R1)           GET DEVICE TYPE        SS JAN84
         BNE   NOTDASD                  NO SHR BIT             SS JAN84
         N     R1,=X'FFDFFFFF'          TURN OFF SHR BITS
NOTDASD  CR    R0,R1                    SAME AS CURRENT        SS JAN84
         BE    NOADD                    NO COUNT UNTIL NEW DEVTYP
         LTR   R0,R0                    YES,  FIRST TIME
         BZ    FIRST                    YES, SET UP THIS DEVTYP
         ST    R15,GNRCGRP#             GROUPS COUNTED FOR THIS GENERIC
         LA    R15,GRPTLNG              POINTER LENGTH         SS FEB88
         LNR   R15,R15                  NEG TO BACK UP         SS FEB88
         AL    R15,SAVEGRPT                FROM LAST GR PTER   SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GRPTNXT-GRPTSECT(,R15)  CHAIN                SS FEB88
         SR    R15,R15                  RESET TO ZERO FOR NEXT
         LA    R7,1(,R7)                BUMP TOTAL GENERICS    SS FEB88
         LA    R0,1(,R7)                INDEX OF NEXT ENTRY    SS FEB88
         STH   R0,GNRCNXT               SET CHAIN              SS FEB88
         LA    R4,GNRCLNG(R4)           NEXT NEW GENERIC       DM JUN83
FIRST    ST    R1,GNRCDEVT              SET DEVTYPE            DM JUN83
         STH   R14,GNRCGRP1             POINT TO FIRST OF BUNC SS FEB88
         LR    R0,R1                    NEW BECOMES OLD DEVTYPESS AUG84
         LA    R6,1(R6)                 ONE MORE GENERIC
NOADD    LA    R14,1(R14)               NEXT GROUP POINTER     SS FEB88
         LA    R15,1(R15)               ONE MORE POINTER TO COUNT
         BCT   R2,SCANMORE
         ST    R15,GNRCGRP#             GRPS FOR THIS GENERIC  DM JUN83
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,GNRCNXT-GNRCSECT(R4)   CHAIN                 SS FEB88
         LA    R4,GNRCLNG(R4)           NEXT SLOT FOR GENERIC  DM JUN83
         LA    R7,1(R7)                 ONE TO TOTAL COUNT
NOGNS    STH   R6,0(R5)                 SAVE COUNT OF GENERICS SS JAN84
         LA    R5,2(R5)                 BUMP FOR NEXT UNITNAME SS JAN84
         L     R6,COUNT2                RESTORE THIS REG
         LA    R6,2(R6)                 NEXT COUNT TO POINTERS SS JAN84
NXTNM    LA    R3,MNTLN(R3)             NEXT NAME
         B     ADDGN
SETGNC   L     R14,EDTGNRC              TOP OF GENERIC SEC     DM JUN83
         ST    R7,8(R14)                TOTAL COUNT OF GENERIC SS FEB88
         DROP  R4                                              DM JUN83
*
*   BUILD  LOOK UP SECTION OF EDT
*
         MVC   AFF3480,=X'0008'         SET DEFAULT 3480 AFFIN SS NOV90
         LA    R14,1                    INDEX TO FIRST GENERIC SS FEB88
         L     R6,APTXREF               LIST OF COUNTS OF GENERICS
         ST    R4,EDTLKUP               INIT HDR LOOKUP SEC    DM JUN83
         MVC   0(8,R4),=CL8'LUVTAB'     SET HEADER             SS FEB88
         USING LKPSECT,R4                                      DM JUN83
         STH   R14,12(R4)               FIRST INDEX TO ONE     SS FEB88
         LA    R4,16(R4)                OVER HEADER            SS FEB88
         SR    R7,R7                    USED FOR TOTAL COUNT OF ENTRIES
         L     R3,EDTLKUP-EDT(R8)       LOOKUP SEC IN OLD EDT  DM JUN83
         L     R2,8(R3)                 COUNT OF ENTRIES       SS FEB88
         LH    R3,12(,R3)               INDEX OF FIRST ENTRY   SS FEB88
         SLA   R3,5                     TIMES 32               SS FEB88
         AL    R3,SAVELUAD              ADD ADJUSTED ADDRESS   SS FEB88
BLDLU    LA    R1,MNT                   CHECK WITH MNT
TESTMN   CLI   0(R1),FF                 END OF TABLE
         BE    EXITCK                   YES, NO CHANGES FOUND
         CLC   0(8,R1),0(R3)            IS UNIT NAME SAME
         BE    EXITCK                   YES, PROCESS IT        SS AUG84
AROUND   LA    R1,MNTLN(R1)             NEXT NAME
         B     TESTMN
EXITCK   LR    R15,R1                   SAVE MNT ENTRY ADDR    SS AUG84
         SR    R1,R1                    FOR IC INST            SS AUG84
         LH    R1,0(R6)                 NUMBER OF GENERICS     SS JAN84
         LTR   R1,R1                    IS THERE ANY
         BZ    ONLYGN                   NO, SKIP, ONLY INC GN COUNT
*              COPY NAME AND DEVTYP FROM MODEL EDT             DM JUN83
         MVC   LKPNAME(12),LKPNAME-LKPSECT(R3)                 DM JUN83
         CLC   LKPAFFIX,=X'0108'       3480 IDRC AFFIN         SS NOV90
         BNE   *+10                     *                      SS MAY91
         MVC   AFF3480,=X'0108'        SET FOR 3480 IDRC       SS NOV90
         CLI   LKPDEVT+3-LKPSECT(R3),0  NO, IS IT FULL DEVTYP  SS JAN84
         BNE   FULLD                    YES, SKIP
         MVC   UNIQUE,LKPDEVT-LKPSECT(R3) SAVE, MAY BE LAST
FULLD    ST    R1,LKPGNRC#              SET NUMBER OF GENERICS DM JUN83
         STH   R14,LKPGNRC1             POINT TO FIRST GENERIC SS FEB88
*              COPY FLAGS AND AFFINITY FROM MODEL EDT          SS FEB88
         MVC   LKPFLAGS(4),LKPFLAGS-LKPSECT(R3)                SS FEB88
         CLI   0(R15),FF                LAST ENTRY             SS AUG84
         BE    NOTVIO                   NO FLAGS               SS AUG84
         TM    MNTFLAG(R15),LKPVIO      IS IT A VIO UNIT       SS AUG84
         BZ    NOTVIO                   NO, NORMAL             SS AUG84
         OI    LKPFLAGS,LKPVIO          SET VIO FLAG           SS AUG84
NOTVIO   TM    24(R3),X'40'             ALT MASK FLAG          SS AUG84
         BZ    NOFLG                    NO FLAG, NORMAL
         LA    R0,1                     IF ONLY ONE GENERIC
         CR    R0,R1                    THEN NO ALT MASK
         BNE   NOFLG                    MORE THAN ONE
         NI    LKPFLAGS,X'AF'           ONLY ONE ZERO FLAG     DM JUN83
NOFLG    DS    0H                                              SS FEB88
         AR    R14,R1                   INDEX TO NEXT ENTRY    SS FEB88
         LA    R7,1(R7)                 ADD ONE TO TOTAL COUNT
         LA    R0,1(,R7)                NEXT ENTRY INDEX       SS FEB88
         STH   R0,LKPNXT                SET CHAIN              SS FEB88
         LA    R4,LKPLNG(R4)            NEXT NEW UNIT NAME     DM JUN83
ONLYGN   LA    R6,2(R6)                 NEXT GENERIC COUNT     SS JAN84
BUMPLU   LA    R3,LKPLNG(R3)            NEXT OLD UNIT IN LU SECDM JUN83
         BCT   R2,BLDLU
*
*  ADD TO LOOK UP SEC FOR MODIFIED NAME TABLE
*
         LA    R3,MNT
         LH    R15,UNIQUE               LAST UNIQUE QUALIFIER  SS JAN84
         LA    R15,1(R15)               BUMP UNIQUE QUALIFIER
MORELU   CLI   0(R3),FF                 END OF TABLE
         BE    SETLU                    YES, DONE HERE
         TM    MNTFLAG(R3),EXCLUDE      EXCLUDE OPERATION
         BO    NEXTNAME                 YES, ALREADY DONE
         TM    MNTFLAG(R3),REPL         REPLACED UNIT          SS AUG84
         BO    NEXTNAME                 YES, ALREADY DONE      SS AUG84
         MVC   LKPNAME,MNTNAME(R3)      COPY NAME              SS JAN84
         SR    R1,R1                    FOR IC
         LH    R1,0(R6)                 GENERIC COUNT          SS JAN84
         LTR   R1,R1                    ARE THERE ANY GENERICS
         BZ    NOLU                     NO, THEN DON'T BUILD
         SR    R0,R0                    MAKE ZERO
         ST    R0,LKPDEVT               ZERO DEVTYPE
         ST    R0,LKPFLAGS              ZERO FLAGS             SS JAN84
         MVI   LKPFLAGS,LKPESOTR        THIS IS A ESOTERIC     SS FEB88
         LR    R1,R14                   SET UP GENERIC INDEX   SS FEB88
         AR    R1,R14                   TIMES 2                SS FEB88
         AR    R1,R14                   PLUS 1 = X3            SS FEB88
         SLA   R1,2                     TIMES 4 = X12          SS FEB88
         AL    R1,EDTGNRC               ADD ADDRESS            SS FEB88
         LA    R1,GNRCDEVT+2-GNRCSECT(R1) DEV CLASS            SS FEB88
         MVC   LKPDEVT+2(1),0(R1)       DEV CLASS FROM GENERIC SS FEB88
         CLI   LKPDEVT+2,X'80'          TAPE CLASS             SS FEB88
         BNE   SETAFF                   NO, SET AFFINITY       SS FEB88
         CLI   GNRCDEVT+3-GNRCSECT(R1),X'80' 3480 TAPE         SS FEB88
         BE    SETAFF80                 YES                    SS FEB88
         TM    GNRCDEVT+1-GNRCSECT(R1),X'80'  7 TRACK          SS FEB88
         BO    SETAFF40                 YES                    SS FEB88
         TM    GNRCDEVT-GNRCSECT(R1),X'02' 6250 BPI            SS FEB88
         BO    SETAFF10                 YES                    SS FEB88
SETAFF20 MVC   LKPAFFIX,=X'0020'        AFFINITY INDEX 1620BPI SS FEB88
         B     DONEAFF                  *                      SS FEB88
SETAFF10 MVC   LKPAFFIX,=X'0010'        AFFINITY INDEX 6250BPI SS FEB88
         B     DONEAFF                  *                      SS FEB88
SETAFF40 MVC   LKPAFFIX,=X'0040'        AFFINITY INDEX 7 TRK   SS FEB88
         B     DONEAFF                  *                      SS FEB88
SETAFF80 DS    0H                       *                      SS FEB88
         MVC   LKPAFFIX,AFF3480         AFFINIITY INDEX 3480   SS NOV90
         B     DONEAFF                  *                      SS FEB88
SETAFF   DS    0H                       *                      SS FEB88
         MVC   LKPAFFIX,=X'FFFF'        AFFINIITY INDEX OTHERS SS FEB88
DONEAFF  DS    0H                       *                      SS FEB88
         STC   R15,LKPDEVT+1            DEV LOOK VALUE UNIQUE  DM JUN83
         LA    R15,1(R15)               BUMP UNIQUE QUALIFIER
         LH    R1,0(R6)                 GENERIC COUNT          SS FEB88
         ST    R1,LKPGNRC#              SET WITH NUMBER OF GENERICS
         STH   R14,LKPGNRC1             INDEX TO FIRST GENERIC DM JUN83
         TM    MNTFLAG(R3),LKPVIO       IS IT A VIO UNIT       SS JAN84
         BZ    NOVIO                    NO, NORMAL
         OI    LKPFLAGS,LKPVIO          SET VIO FLAG           SS JAN84
NOVIO    DS    0H                                              SS FEB88
         LA    R7,1(R7)                 BUMP TOTAL
         LA    R0,1(,R7)                NEXT ENTRY INDEX       SS FEB88
         STH   R0,LKPNXT                SET CHAIN              SS FEB88
         LA    R4,LKPLNG(R4)            NEXT ENTRY             SS FEB88
NOLU     LA    R6,2(R6)                 NEXT COUNT OF GENERICS SS JAN84
         AR    R14,R1                   INDEX TO NEXT GENERICS SS FEB88
NEXTNAME LA    R3,MNTLN(R3)             NEXT NAME IN MNT
         B     MORELU
         DROP  R4                                              DM JUN83
SETLU    L     R3,EDTLKUP               START OF LOOK UP SEC   DM JUN83
         LR    R1,R4                    AFTER LAST ENTRY       SS FEB88
         SL    R1,=F'2'                 CHAIN FOR LAST ENTRY   SS FEB88
         SR    R0,R0                    ZERO                   SS FEB88
         STH   R0,0(,R1)                     CHAIN             SS FEB88
         USING LKPSECT,R3                                      DM JUN83
         ST    R7,8(R3)                 INIT HDR WITH TOTAL NUM ENTRIES
*
*   BUILD MASK SECTION
*
         SR    R7,R7                    ZERO COUNT FOR TOTAL MASKS
         ST    R4,EDTMSK                INIT HEADER / MASK SEC DM JUN83
         L     R15,EDTGRP               GROUP SEC              DM JUN83
         L     R15,8(R15)               COUNT OF GROUPS        SS FEB88
         LA    R15,07(R15)              ROUND UP TO 1 BYTES
         SRL   R15,3                    DIVIDE BY 8 GIVES 8 BITS/BYTE
         ST    R15,12(R4)               LENGTH OF EACH ENTRY   SS FEB88
         MVC   0(8,R4),=C'GMSTAB'       INIT HEADER            SS FEB88
         LA    R4,16(R4)                OVER HEADER            SS FEB88
         USING MSKSECT,R4                                      DM JUN83
         L     R2,8(R3)                 NUMBER IN LOOK UP SEC  SS FEB88
         LA    R3,16(R3)                OVER HEADER            SS FEB88
BLDMSK   XC    MSKMASK(0),MSKMASK       FOR CLEAR USE EX INST  DM JUN83
         EX    R15,BLDMSK
         XC    LKPALTPT,LKPALTPT        CLEAR ALT MASK FIELD   DM JUN83
         L     R5,LKPGNRC#              COUNT OF GENERICS      SS FEB88
         LH    R6,LKPGNRC1              INDEX TO FIRST         SS FEB88
         AH    R6,LKPGNRC1              TIMES 2                SS FEB88
         AH    R6,LKPGNRC1              PLUE 1 = X3            SS FEB88
         SLA   R6,2                     TIME 4 = X12           SS FEB88
         AL    R6,EDTGNRC               ADD ADDRESS OF SECTION SS FEB88
*              ADJUST +12 FOR HEADER -12 FOR FIRST ENTRY       SS FEB88
         USING GNRCSECT,R6                                     DM JUN83
         ST    R2,COUNT1                SAVE LOOP CONTROL
         LR    R0,R3                    SAVE LOOP CONTROL
         OI    FLAG2,ALTT               START MASK             SS NOV89
         DROP  R3
FOREACH  LH    R8,GNRCGRP1              FIRST GROUP INDEX      SS FEB88
         SLA   R8,2                     TIMES 4                SS FEB88
         AL    R8,EDTGRPT               ADD ADDRESS            SS FEB88
         LA    R8,12-4(,R8)             ADJUST ADDRESS         SS FEB88
         USING GRPTSECT,R8                                     DM JUN83
         L     R14,GNRCGRP#             COUNT OF POINTERS      DM JUN83
GPID     LH    R2,GRPTPTR               GROUP INDEX (ID)       SS FEB88
         BCTR  R2,0                     REFERENCE TO ZERO
         SRDL  R2,3                     SEPARATE 3 LOWER BITS
         SRL   R3,29                    RIGHT JUSTIFY
         SR    R1,R1                    CLEAR FOR ICM INST
         ICM   R1,B'1000',=X'80'        BIT TO BE POSITIONED
         SRL   R1,0(R3)                 POSITION BIT WITHIN BYTE
         O     R1,MSKMASK(R2)           PUT BIT IN MASK        DM JUN83
         ST    R1,MSKMASK(R2)             AT PROPER BYTE       DM JUN83
         LA    R8,GRPTLNG(R8)           NEXT POINTER           DM JUN83
         BCT   R14,GPID
         DROP  R8                                              DM JUN83
         LR    R3,R0                    RESTORE LOOP CONTROL
         USING LKPSECT,R3               *                      SS FEB88
         TM    LKPFLAGS,X'40'           ALTERNATE MASK         DM JUN83
         BZ    BUMPX                    NO, CONTINUE WITH THIS MASK
         TM    FLAG2,ALTT               STILL ON FIRST MASK    SS NOV89
         BZ    BUMPX                    NO, CONTINUE THIS MASK SS NOV89
         NI    FLAG2,255-ALTT           DONE ON FIRST MASK     SS NOV89
         LA    R7,1(R7)                 BUMP TOTAL COUNT OF MK SS FEB88
         ST    R7,LKPALTPT              YES, SET ALT MASK      SS FEB88
         LR    R1,R4                    SAVE FOR MOVE
         AR    R4,R15                   NEXT ENTRY
CLRMSK   MVC   MSKMASK(0),0(R1)         BUILD NEXT FROM ALT
         EX    R15,CLRMSK
BUMPX    LA    R6,GNRCLNG(R6)           NEXT GENERIC           DM JUN83
         BCT   R5,FOREACH
         DROP  R6                                              DM JUN83
         LA    R7,1(R7)                 BUMP TOTAL COUNT OF MK SS FEB88
         ST    R7,LKPMSKPT              SET INDEX OF THIS MSK  SS FEB88
         AR    R4,R15                   NEXT ENTRY SLOT
         L     R2,COUNT1                RESTORE LOOP CONTROL
         LA    R3,LKPLNG(R3)            NEXT UNIT NAME IN LOOKUP  JUN83
         BCT   R2,BLDMSK
         DROP  R3,R4                                           SS FEB88
         L     R1,EDTMSK                START OF MASK SECTION  DM JUN83
         ST    R7,8(R1)                 SET HDR WITH COUNT     SS FEB88
         SPACE ,                                               DM JUL80
         LR    R14,R4              LAST BYTE USED              SS FEB88
         LA    R14,15(,R14)        7 BYTES PAST END            SS FEB88
         N     R14,=F'-8'          ROUND TO DOUBLE WORD        DM JUL80
         LR    R0,R14              CALCULATE HOW MUCH LEFT     DM JUL80
         SR    R0,R10                                          SS FEB88
         SR    R15,R15             CLEAR R15                   SS AUG84
         ICM   R15,7,EDTSIZE+1     GET CURRENT SPACE           SS AUG84
         STCM  R0,7,EDTSIZE+1      SET NEW LENGTH              DM JUL80
         SR    R15,R0              CALCULATE FREEMAIN LENGTH   DM JUL80
         ICM   R15,B'1000',=X'0000' CLEAR SUBPOOL NUMBER       SS AUG84
         FREEMAIN RU,LV=(15),A=(14),SP=&XASP                   SS AUG84
         MVC   EDTPREF,PREFTAB     IBM PREFTAB IN OUR EDT      DM JUN83
         MVC   EDTTAPE,TAPETAB     IBM TAPETAB IN OUR EDT      SS FEB88
         L     R2,CVTPT            LOAD CVT ADDR               DM NOV83
         L     R2,CVTJESCT(R2)     LOAD JESCT ADDR             SS JAN84
         L     R3,JESEDTA(R2)      LOAD OLD EDT PTR            SS JAN84
         LA    R3,0(,R3)           CLEAR BIT 0                 SS MAR87
         AIF   ('&SYSPARM' EQ 'TEST' OR                                -
               '&SYSPARM' EQ 'TESTXA').TEST5                   SS MAR87
         L     R5,JESUPLP          SAVE OLD UCB PT LIST        SS MAR87
         ENQ   MF=(E,ENQLST)       STOP SCHEDULING             SS MAR87
         STIMER WAIT,BINTVL=BINTVL WAIT 5 SECONDS              SS MAR87
         MVC   JESUPLP(4,R2),UPLSTR NEW UCB PT LIST            SS MAR87
         ST    R10,JESEDTA(R2)     NEW EDT ADDR IN JESCT       SS MAR87
         TM    FLAG2,GENEDT        IBM SYSGEN EDT              SS MAR87
         BO    DODEQ                                           SS MAR87
         CLC   DYNAHDR(8),EDTCREAT-EDT(R3)  OWR EDT            SS MAR87
         BNE   ABEND999            NO... ABEND                 SS MAR87
         CLI   EDTSIZE-EDT(R3),0   SPOOL ZERO                  SS FEB88
         BE    DODEQ                                           SS MAR87
         SR    R0,R0               CLEAR FOR ICM               SS MAR87
         SR    R2,R2               CLEAR FOR IC                SS MAR87
         ICM   R0,7,EDTSIZE+1-EDT(R3) LENGTH                   SS FEB88
         IC    R2,EDTSIZE-EDT(R3)  SUBPOOL NUMBER              SS FEB88
         LR    R1,R3               ADDRESS OF EDT              SS MAR87
         FREEMAIN RU,LV=(0),A=(1),SP=(R2)                      SS MAR87
         B     DODEQ               FREE IT                     SS MAR87
DODEQ    DEQ   MF=(E,ENQLST)       ALLOW SCHEDULING TO RESUME  DM JUL80
Y12      DS    0H
         AGO   .TEST6
.TEST5   ANOP  ,                   TEST - PRINT THE EDT'S      DM JUN83
         TM    SYSPRINT+48,16                                  DM JUN83
         BZ    ENDPRINT                                        DM JUN83
         MVI   WTOE,C' '           BLANK                       DM JUN83
         MVC   WTOE+1(L'WTOE-1),WTOE    LINE                   DM JUN83
         L     R1,EDTPTR           BASE (SYSGEN) EDT           DM JUN83
         BAL   R14,PRINTEDT          PRINT IT                  DM JUN83
         TM    FLAG2,GENEDT        IBM SYSGEN EDT              SS FEB88
         BO    NOPRT2                                          SS FEB88
         LR    R1,R3               CURRENT EDT                 DM JUN83
         BAL   R14,PRINTEDT          PRINT IT                  DM JUN83
NOPRT2   LR    R1,R10              NEW EDT                     SS FEB88
         BAL   R14,PRINTEDT          PRINT IT                  DM JUN83
         TM    FLAG2,GENEDT        IBM SYSGEN EDT              SS FEB88
         BO    ENDPRINT                                        SS FEB88
         LR    R1,R3               CURRENT EDT                 DM JUN83
         LA    R15,DUMPARM1                                    DM JUN83
         BAL   R14,PRTEDT2           FORMAT PARMS              DM JUN83
         LR    R1,R10              NEW EDT                     DM JUN83
         LA    R15,DUMPARM2                                    DM JUN83
         BAL   R14,PRTEDT2           FORMAT PARMS              DM JUN83
         MVI   WTOE,C'1'                                       DM JUN83
         LR    R6,R3               CALCULATE ADDRESS           DM NOV83
         SR    R6,R10                DIFFERENCE (OLD - NEW)    DM NOV83
         SPACE ,                                               DM JUN83
PRTEDT3  L     R1,DUMPARM1+12      REMAINING LENGTH            DM JUN83
         C     R1,DUMPARM2+12                                  DM JUN83
         BNH   *+8                                             DM JUN83
         L     R1,DUMPARM2+12      USE SHORTER                 DM JUN83
         CH    R1,=H'32'                                       DM JUN83
         BNH   *+8                                             DM JUN83
         LH    R1,=H'32'           USE SHORTER                 DM JUN83
         LR    R4,R1               CALCULATE NUMBER            DM NOV83
         SR    R5,R5                                           DM NOV83
         SRDL  R4,2                  OF WORDS                  DM NOV83
         LTR   R5,R5               SEE IF ANY REMAINDER        DM NOV83
         BZ    *+6                 NO                          DM NOV83
         SR    R4,R4               DON'T DO ADDRESS COMPARE    DM NOV83
         SPACE ,                                               DM NOV83
         L     R14,DUMPARM1        CURRENT EDT                 DM JUN83
         A     R14,DUMPARM1+16       ADDRESS                   DM JUN83
         LR    R15,R1                                          DM JUN83
         LA    R2,DIFF             TARGET                      DM JUN83
         LA    R3,L'DIFF                                       DM JUN83
         MVCL  R2,R14              COPY DATA                   DM JUN83
         LTR   R1,R1               LENGTH ZERO                 SS MAR87
         BZ    PRTEDT3A            AVOID OC4 DO TO OVERLAY     SS MAR87
         BCTR  R1,0                                            DM JUN83
         L     R15,DUMPARM2        NEW EDT                     DM JUN83
         A     R15,DUMPARM2+16       ADDRESS                   DM JUN83
         EX    R1,EXXC1            EXCLUSIVE OR                DM JUN83
PRTEDT3A TR    DIFF,DIFFTBL                                    SS MAR87
         LA    R5,DIFF             IN CASE NOT ADDRESS DIFF.   DM NOV83
         BZ    PRTEDT6             ALL EQUAL (FROM EXC. OR)    DM NOV83
         LTR   R4,R4               SEE HOW MANY WORDS          DM NOV83
         BZ    PRTEDT6             NONE                        DM NOV83
         L     R14,DUMPARM1        OLD EDT                     DM NOV83
         A     R14,DUMPARM1+16       ADDRESS                   DM NOV83
         SPACE ,                                               DM NOV83
PRTEDT7  L     R0,0(,R14)          WORD FROM OLD EDT           DM NOV83
         L     R1,0(,R15)          WORD FROM NEW EDT           DM NOV83
         CR    R0,R1               SEE IF SAME                 DM NOV83
         BE    PRTEDT8             YES                         DM NOV83
         AR    R1,R6               SEE IF DIFFERENCE           DM NOV83
         CR    R0,R1                 IN ADDRESS                DM NOV83
         BNE   PRTEDT6             NO - LEAVE AS IS            DM NOV83
PRTEDT8  LA    R14,4(,R14)         NEXT                        DM NOV83
         LA    R15,4(,R15)           WORDS                     DM NOV83
         BCT   R4,PRTEDT7          ITERATE                     DM NOV83
         LA    R5,=CL32'ALL DIFFERENCES ARE ADDRESSES'         DM NOV83
         SPACE ,                                               DM JUN83
PRTEDT6  ICM   R0,15,DUMPARM1+12   LENGTH                      DM JUN83
         BZ    PRTEDT4             EXHAUSTED                   DM JUN83
         LA    R1,DUMPARM1                                     DM JUN83
         L     R15,=V(XDUMPFMT)                                DM JUN83
         BALR  R14,R15                                         DM JUN83
         LA    R1,IN24C                 BACK TO 24  BIT MODE   SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24C    DS    0H                                              SS JAN84
         PUT   SYSPRINT,WTOE                                   DM JUN83
         LA    R1,IN31C                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31C    DS    0H                                              SS JAN84
         MVI   WTOE,C' '                                       DM JUN83
PRTEDT4  ICM   R0,15,DUMPARM2+12   LENGTH                      DM JUN83
         BZ    PRTEDT5             EXHAUSTED                   DM JUN83
         LA    R1,DUMPARM2                                     DM JUN83
         L     R15,=V(XDUMPFMT)                                DM JUN83
         BALR  R14,R15                                         DM JUN83
         LA    R1,IN24D                 BACK TO 24  BIT MODE   SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24D    DS    0H                                              SS JAN84
         PUT   SYSPRINT,WTOE                                   DM JUN83
         LA    R1,IN31D                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31D    DS    0H                                              SS JAN84
PRTEDT5  MVI   DIFF+L'DIFF,C' '                                DM JUN83
         MVI   WTOE,C' '           BLANK                       DM JUN83
         MVC   WTOE+1(L'WTOE-1),WTOE    LINE                   DM JUN83
         MVC   WTOE+16(74),DIFFMASK                            DM JUN83
         TR    WTOE+16(74),DIFF                                DM JUN83
         MVC   WTOE+93(32),0(R5)   DIFFERENCES OR MSG          DM NOV83
         LA    R1,IN24E                 BACK TO 24  BIT MODE   SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24E    DS    0H                                              SS JAN84
         PUT   SYSPRINT,WTOE                                   DM JUN83
         LA    R1,IN31E                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31E    DS    0H                                              SS JAN84
         L     R0,DUMPARM1+12      SEE IF SOME                 DM JUN83
         A     R0,DUMPARM2+12        TO GO                     DM JUN83
         BP    PRTEDT3             NO                          DM JUN83
         B     ENDPRINT                                        DM JUN83
EXXC1    XC    DIFF(0),0(R15)                                  DM JUN83
DIFFTBL  DC    C' ',255C'*'                                    DM JUN83
DIFFMASK DC    AL1(0,0,1,1,2,2,3,3,32)                         DM JUN83
         DC    AL1(4,4,5,5,6,6,7,7,32)                         DM JUN83
         DC    AL1(8,8,9,9,10,10,11,11,32)                     DM JUN83
         DC    AL1(12,12,13,13,14,14,15,15,32,32,32,32)        DM JUN83
         DC    AL1(16,16,17,17,18,18,19,19,32)                 DM JUN83
         DC    AL1(20,20,21,21,22,22,23,23,32)                 DM JUN83
         DC    AL1(24,24,25,25,26,26,27,27,32)                 DM JUN83
         DC    AL1(28,28,29,29,30,30,31,31)                    DM JUN83
         SPACE 2                                               DM JUN83
PRINTEDT ST    R14,COUNT1          SAVE RETURN                 DM JUN83
         LA    R15,DUMPARM1
         BAL   R14,PRTEDT2
         MVI   WTOE,C'1'           START ON NEW PAGE           DM JUN83
         SPACE ,                                               DM JUN83
PRTEDT1  LA    R1,DUMPARM1                                     DM JUN83
         L     R15,=V(XDUMPFMT)                                DM JUN83
         BALR  R14,R15             FORMAT 32 BYTES             DM JUN83
         LR    R2,R15              SAVE RETURN CODE            DM JUN83
         LA    R1,IN24F                 BACK TO 24  BIT MODE   SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24F    DS    0H                                              SS JAN84
         PUT   SYSPRINT,WTOE                                   DM JUN83
         LA    R1,IN31F                 START OF 31 BIT MODE   SS JAN84
         O     R1,=X'80000000'          MODE BIT ON            SS JAN84
         ST    R1,GXREFXXX              TRACE FOR DEBUGGING    SS AUG84
         BSM   0,R1                     SWITCH MODES TO 31     SS JAN84
IN31F    DS    0H                                              SS JAN84
         MVI   WTOE,C' '                                       DM JUN83
         LTR   R2,R2               SEE IF MORE DATA            DM JUN83
         BNZ   PRTEDT1               YES - ITERATE             DM JUN83
         SPACE ,                                               DM JUN83
         L     R14,COUNT1                                      DM JUN83
         BR    R14                 RETURN                      DM JUN83
         SPACE ,                                               DM JUN83
PRTEDT2  STM   R14,R12,12(R13)     SAVE REGS                   DM JUN83
         LR    R2,R15                                          DM JUN83
         LA    R0,12(,R2)          PARMS                       DM JUN83
         ST    R0,4(,R2)                                       DM JUN83
         LA    R0,WTOE+1           OUTPUT AREA                 DM JUN83
         ST    R0,8(,R2)                                       DM JUN83
         OI    8(R2),X'80'         SET END FLAG                DM JUN83
         ST    R1,0(,R2)           DATA ADDRESS                DM JUN83
         ST    R1,20(,R2)                                      DM JUN83
         CLC   EDTCREAT-EDT(8,R1),DYNAHDR MY EDT               SS FEB88
         BE    CALCLEN             YES, CALC LENGTH            SS FEB88
         L     R15,EDTPREF         SECTION ATFER EDT           SS FEB88
         B     LASTBYTE                 *                      SS FEB88
CALCLEN  L     R1,EDTMSK-EDT(,R1)  CALCULATE                   DM JUN83
         L     R15,8(,R1)            END OF                    SS FEB88
         M     R14,12(R1)              EDT                     SS FEB88
         AR    R15,R1                                          DM JUN83
LASTBYTE BCTR  R15,0               LAST BYTE                   DM JUN83
         S     R15,0(,R2)          LENGTH                      DM JUN83
         ST    R15,12(,R2)                                     DM JUN83
         SR    R0,R0                                           DM JUN83
         ST    R0,16(,R2)          INITIALIZE OFFSET           DM JUN83
         LM    R14,R12,12(R13)     RESTORE REGS                DM JUN83
         BR    R14                 RETURN                      DM JUN83
ENDPRINT EQU   *                                               DM JUN83
.TEST6   ANOP  ,                                               DM JUN83
         SPACE 2                                               DM JUN83
         TM    FLAG2,LDEDT              WAS EDT LOADED         SS MAR87
         BZ    NODEL                    NO, SKIP DELETE        SS MAR87
         DELETE EP=IEFEDTTB             NO LONGER NEEDED       SS JAN84
NODEL    DS    0H                       *                      SS MAR87
         AIF   ('&SYSPARM' EQ 'TEST' OR                                -
               '&SYSPARM' EQ 'TESTXA').TEST4                   DM JUN83
         MODESET KEY=NZERO         BACK TO TCB PROTECT KEY     DM JUL80
.TEST4   ANOP  ,                                               DM JUN83
         AIF   ('&SYSPARM' EQ 'TEST' OR                                -
               '&SYSPARM' EQ 'NONXA').TEST4D                   SS MAR87
         LA    R1,IN24G                 BACK TO 24  BIT MODE   SS JAN84
         BSM   0,R1                     SWITCH MODES TO 24     SS JAN84
IN24G    DS    0H                                              SS JAN84
.TEST4D  ANOP  ,                                               SS SEP85
.CKER2   ANOP  ,                                               SS NOV90
         SPACE ,                                               DM JUN83
         CLOSE (SYSIN),MF=(E,OCLIST)                           DM JUN83
         FREEPOOL SYSIN                                        DM JUN83
         TM    SYSPRINT+48,16      SEE IF OPEN                 DM JUN83
         BZ    Y13                   NO                        DM JUN83
         CLOSE (SYSPRINT),MF=(E,OCLIST)                        DM JUN83
         FREEPOOL SYSPRINT                                     DM JUN83
Y13      EQU   *                                               DM JUN83
         AIF   ('&SYSPARM' EQ 'CKER').CKER4                    SS NOV90
         WTO 'TSDXXXI DYNAMASK DONE ****',ROUTCDE=(2,11)
         CLI   SAVEPARM,C' '            ANY PARM               SS JUN86
         BE    NOWTOP                   NO                     SS JUN86
         MVC   WTOE(WTOPLN),WTOP                               SS JUN86
         MVC   WTOE+13(20),SAVEPARM                            SS JUN86
         WTO   MF=(E,WTOE)                                     SS JUN86
NOWTOP   DS    0H                                              SS JUN86
         SPACE 2                                               DM JUL80
         WXTRN VATUCB                                          DM JUN83
         L     R1,4(,R13)          HIGHER SAVE AREA            DM JUL80
         L     R1,24(,R1)          R1 (PARM PTR) FROM CALLER   DM JUL80
         L     R15,=A(VATUCB)                                  DM JUL80
         LTR   R15,R15                                         DM JUL80
         BZ    *+6                 UNRESOLVED - SKIP CALL      DM JUL80
         BALR  R14,R15             CALL VATUCB                 DM JUL80
         SPACE 2                                               DM JUL80
         AGO   .CKER5                                          SS NOV90
.CKER4   ANOP  ,                                               SS NOV90
         WTO 'TSDXXXI CHECK DYNAMASK PARMS DONE ****',ROUTCDE=(2,11)
.CKER5   ANOP  ,                                               SS NOV90
EXIT     LR    R1,R13
         L     R0,GETMLEN          LENGTH TO FREE              RCHJUN79
         PUSH  USING                                           DM JUL80
         DROP  ,                                               DM JUL80
         L     R13,4(R13)
         FREEMAIN R,A=(1),LV=(0)
         RETURN (14,12),RC=0                                   DM JUL80
         POP   USING                                           DM JUL80
*
*  SUBROUTINE TO READ INPUT AND EXTRACT FIELDS
*
GETNEXT  MVC   BUF,=CL9' '              BLANK BUFFER
         CLI   FLAGS,1                  IS WE LOOKING FOR UNIT NAME
         BE    READ                     YES, START WITH NEW CARD
         L     R15,ABUF                 CURRENT CHARACTER
         CLI   FLAGS,2                  IS WE LOOKING FOR FIRST VOL/CUU
         BE    SCANBEG                  YES, LOOK FOR IT
         CLI   FLAGS,3                  IS WE LOOKING FOR NEXT VOL/CUU
         BNE   MSG10                    NOT ANY OF ABOVE, ERROR
         CLI   0(R15),C','              COMMA SAYS THERE ARE MORE
         BNE   EOR                      NO COMMA.. NO MORE ON RECORD
SCANBEG  LA    R15,1(R15)               NEXT CHAR
         C     R15,ENDBUF               WE AT END OF CARD
         BE    READ                     YES, GET NEXT CARD
CLIBLK   CLI   0(R15),C' '              IS IT NON BLANK
         BE    SCANBEG                  NO, TRY NEXT
         LR    R1,R15                   FOUND FIRST CHAR, SAVE LOCATION
SCANEND  LA    R15,1(R15)               NEXT CHAR .. LOOKING FOR END
         C     R15,ENDBUF               END OF CARD
         BE    MSG11                    YES, SHOULD NOT BE
         CLI   0(R15),C' '              IS IT FIRST BLANK
         BE    ENDFIELD                 YES, END OF FIELD
         CLI   0(R15),C','              OR IS IT A COMMA
         BNE   SCANEND                  NOT END, CONTINUE SCAN
ENDFIELD ST    R15,ABUF                 SAVE FOR NEXT REQUEST
         SR    R15,R1                   CALC LENGTH OF FIELD
         C     R15,=F'9'                SHOULD NOT BE MORE THAN 9 CHAR
         BH    MSG12                    IT IS, ERROR
         BCTR  R15,0                    LESS ONE FOR MVC INST
MOVE     MVC   BUF(0),0(R1)             USED BY EX INST
         EX    R15,MOVE                 COPY FIELD INTO BUF LEN IN R15
         LA    R15,1(R15)               ADD ONE BACK
TESTFLG  CLI   FLAGS,2                  WE DONE WITH FIRST
         BE    SET3                     YES, SET FOR MORE
         CLI   FLAGS,1                  WE DONE WITH UNIT NAME
         BE    SET2                     YES, SET FOR FIRST VOL OR CUU
         BR    R14                      NONE OF ABOVE .. NORMAL RETURN
SET2     MVI   FLAGS,2                  NEXT WILL BE FIRST VOL OR CUU
         BR    R14                      RETURN
SET3     MVI   FLAGS,3                  SET FOR MORE FIELD
         BR    R14                      RETURN
EOR      MVI   FLAGS,1                  WILL START WITH NEW UNIT NAME
         LA    R15,FF                   INDICATE EOR
         BR    R14                      RETURN
READ     ST    R14,ABUF                 SAVE RETURN ADDRESS
READ2    GET   SYSIN                                           DM JUN83
         CLI   0(R1),C'*'               COMMENT CARD           SS APR86
         BE    READ2                    YES, SKIP              SS APR86
         LR    R15,R1                   BUFFER ADDRESS
         L     R14,ABUF                 RESTORE RETURN ADDRESS TO R14
         LA    R1,72(R1)                CALC END OF CARD
         ST    R1,ENDBUF                SAVE FOR REGULAR USE
         B     CLIBLK                   START SCANING THIS CARD
EOF      L     R14,ABUF                 RESTORE RETURN ADDR TO R14
         MVI   FLAGS,FF                 CAUSE ERROR IS CALLED AGAIN
         LA    R15,FF                   INDICATE EOF
         BR    R14                      RETURN
         EJECT ,
CHECKHEX DS    0H                   *                          SS MAR87
         CLI   0(R1),C'0'           IN NUMBER RANGE            SS MAR87
         BL    CHECKCHR             NO, MAYBE ALPHA            SS MAR87
         CLI   0(R1),C'9'           IN NUMBER RANGE            SS MAR87
         BH    MSG8                 NO, SYNTAX ERROR           SS MAR87
         BR    R14                  GOOD, RETURN TO CALLER     SS MAR87
CHECKCHR DS    0H                   *                          SS MAR87
         CLI   0(R1),C'A'           IS IT A-F                  SS MAR87
         BL    MSG8                 NO,  SYNTAX ERROR          SS MAR87
         CLI   0(R1),C'F'           IS IT A-F                  SS MAR87
         BH    MSG8                 NO,  SYNTAX ERROR          SS MAR87
         SR    R15,R15              ZERO FOR INSERT            SS MAR87
         IC    R15,0(R1)            *                          SS MAR87
         LA    R15,X'FA'-C'A'(,R15) ADJUST TO FA-FF            SS MAR87
         STC   R15,0(R1)            SET                        SS MAR87
         BR    R14                  RETURN                     SS MAR87
         EJECT ,
*        CONVERT JULIAN DATE TO CALENDAR DATE
*
*        ALGORITHM IS NON-ITERATIVE USING TABLES
         SPACE 2
TOCAL    STM   R14,R3,12(R13)                                  DM JUN83
         CVB   R14,DBLWRD                                      DM JUN83
         SRDA  R14,32                                          DM JUN83
         D     R14,=F'1000'  SEPARATE YEAR/DAY                 DM JUN83
         SPACE ,                                               DM JUN83
* IF THE DATE IS MARCH OR LATER AND THE YEAR IS NOT A LEAP     DM JUN83
* YEAR THEN ADD 1 TO THE DAY TO MAKE THE DATE LOOK LIKE A      DM JUN83
* LEAP YEAR DATE                                               DM JUN83
         CH    R14,=H'59'                                      DM JUN83
         BNH   PASTADD1      NOT PAST FEBRUARY                 DM JUN83
         EX    R15,EXTM03    SEE IF LEAP YEAR                  DM JUN83
         BZ    PASTADD1      LEAP YEAR                         DM JUN83
         LA    R14,1(,R14)   NOT A LEAP YEAR - ADD A DAY       DM JUN83
PASTADD1 CH    R14,=H'366'                                     DM JUN83
         BH    BADRTN        ERROR - JULIAN DAY IS TOO LARGE   DM JUN83
         LTR   R14,R14                                         DM JUN83
         BNP   BADRTN        ERROR - JULIAN DAY L/T 1          DM JUN83
         LR    R3,R15        SAVE YEAR                         DM JUN83
         SRDL  R14,5         DIVIDE DAY BY 32                  DM JUN83
         AR    R14,R14       DOUBLE QUOTIENT FOR USE AS INDEX  DM JUN83
         SRL   R15,27        JUSTIFY REMAINDER                 DM JUN83
         SH    R15,FACTOR1(R14)   DEVELOP DAY OF MONTH FROM REMAINDER
         BP    DATEOK        EVERYTHING OK                     DM JUN83
         SH    R15,FACTOR2(R14)   CORRECT DAY OF MONTH AND MONTH       *
                                  (MONTH WILL BE ADDED NEXT)   DM JUN83
         SPACE ,                                               DM JUN83
DATEOK   AH    R15,MNTHTBL(R14)   ADD MONTH  (* 100)           DM JUN83
         MH    R15,=H'100'        SHIFT OVER FOR YEAR          DM JUN83
         AR    R15,R3             ADD YEAR                     DM JUN83
         CVD   R15,DBLWRD                                      DM JUN83
         OI    DBLWRD+7,15                                     DM JUN83
         SR    R15,R15            SET GOOD RETURN CODE         DM JUN83
         SPACE ,                                               DM JUN83
RETURN   RETURN (14,3),RC=(15)                                 DM JUN83
         SPACE 3                                               DM JUN83
BADRTN   LA    R15,12        SET ERROR RETURN CODE             DM JUN83
         B     RETURN                                          DM JUN83
EXTM03   TM    =X'03',0            FOR EXECUTE                 DM JUN83
         SPACE 3                                               DM JUN83
MNTHTBL  DC    H'100,300,400,500,600,700,800,900,1000,1100,1200,1300'  *
                             MONTHS (* 100)                    DM JUN83*
                             (* 100 TO ALLOW A SINGLE CVD)     DM JUN83
FACTOR1  DC    H'0,28,27,25,24,22,21,20,18,17,15,14'           DM JUN83*
                             FACTORS TO ADJUST REMAINDER TO    DM JUN83*
                             BE THE DAY OF THE MONTH           DM JUN83
FACTOR2  DC    Y(100-0,100-29,100-31,100-30,100-31,100-30)     DM JUN83
         DC    Y(100-31,100-31,100-30,100-31,100-30,100-31)    DM JUN83
*              100 - DAYS IN THE PRIOR MONTH                   DM JUN83
*              (USED TO BACK UP THE MONTH AND CORRECT DAY)     DM JUN83
         EJECT                                                 CJKMAY79
MSG1     WTO   'TSDXXXI OPEN FAILED, TERMINATED WITH NO ACTION',       X
               ROUTCDE=(2,11)
         B     EXIT
MSG2     WTO   'TSDXXXI UNIT NAME MORE THAN 8 CHAR, IGNORED',          X
               ROUTCDE=(2,11)
PURGE    BAL   R14,GETNEXT
         C     R15,=F'255'
         BNE   PURGE
         B     BLDMNT
MSG3     WTO   'TSDXXXI VOL NAME MORE THAN 6 CHAR, IGNORED',           X
               ROUTCDE=(2,11)
         B     EACHU
MSG4     MVC   WTOE(WTO4LN),WTO4
         MVC   WTOE+30(6),BUF
         WTO   MF=(E,WTOE)
         B     EACHU
WTO4     WTO   'TSDXXXI VOLUME NOT FOUND           ',ROUTCDE=(2,11),   X
               MF=L
WTO4LN   EQU   *-WTO4
MSG5     MVC   WTOE(WTO5LN),WTO5
         MVC   WTOE+30(3),BUF+1
         WTO   MF=(E,WTOE)
         B     EACHU
WTO5     WTO   'TSDXXXI UNIT NOT FOUND             ',ROUTCDE=(2,11),   X
               MF=L
WTO5LN   EQU   *-WTO5
WTOP     WTO   'TSDXXXI                            ',ROUTCDE=(2,11),   X
               MF=L
WTOPLN   EQU   *-WTOP
MSG6     WTO   'TSDXXXI MAX OF 128 NAMES EXCEEDED, REST IGNORED',      X
               ROUTCDE=(2,11)                                  SS AUG84
         B     SORTGRP
MSG7     WTO   'DYNAMASK - GETMAIN AREA EXCEEDED - PROGRAM ABORTED',   X
               ROUTCDE=(2,11)
         B     EXIT
MSG8     MVC   WTOE(WTO8LN),WTO8
         MVC   WTOE+34(8),BUF
         WTO   MF=(E,WTOE)
         B     EACHU
WTO8     WTO   'TSDXXXI SYNTAX ERROR IN UNIT             ',            X
               ROUTCDE=(2,11),                                         X
               MF=L
WTO8LN   EQU   *-WTO8
MSG10    ABEND 10,DUMP
MSG11    WTO   'TSDXXXI FIELD DOES NOT END BEFORE COLUMN 72, IGNORED', X
               ROUTCDE=(2,11)
         B     READ
MSG12    MVC   WTOE(WTO12LN),WTO12
MVCFD    MVC   WTOE+4(0),0(R1)
         EX    R15,MVCFD
         WTO   MF=(E,WTOE)
         B     TESTFLG
WTO12    WTO   '                                                       X
                                                  ',ROUTCDE=(2,11),MF=L
WTO12LN  EQU   *-WTO12
         DS    0F
ABEND999 ABEND 999,DUMP                                        RCHJUN80
ENQLST   ENQ   (SYSIEFSD,Q4,E,2,SYSTEM),MF=L                   DM JUL80
SYSIEFSD DC    CL8'SYSIEFSD'       ENQ MAJOR NAME              DM JUL80
Q4       DC    CL2'Q4'             ENQ MINOR NAME              DM JUL80
         DS    0F                                              SS AUG84
         AIF   ('&SYSPARM' EQ 'TEST' OR                                -
               '&SYSPARM' EQ 'TESTXA').TEST1                   DM JUN83
CORESIZE DC    AL1(&SUBP),AL3(16384)    FOR EDT IN CSA         SS AUG84
         AGO   .TEST2                                          DM JUN83
.TEST1   ANOP  ,                                               DM JUN83
CORESIZE DC    A(X'01000000'+65536)     FOR EDT IN USER AREA   DM JUN83
.TEST2   ANOP  ,                                               DM JUN83
CORESIZX DC    A(65536)                 FOR EDT IN ECSA (XA)   SS AUG84
GETMLEN  DC    A(SAVEEND-SAVE)          FOR TEMPORARY WORK AREA
DYNAHDR  DC    CL12'DYNAMASK EDT'                              DM JUL80
DYNAHDR2 DC    CL8'DYNAMSK2'                                   SS MAR87
BINTVL   DC    F'500'                                          RCHJUN80
         LTORG
         SPACE 3                                               DM JUN83
SYSINDCB DCB   DDNAME=SYSIN,LRECL=80,MACRF=GL,DSORG=PS,                X
               EODAD=EOF
         SPACE 3                                               DM JUN83
SYSPRDCB DCB   DDNAME=SYSPRINT,MACRF=PM,DSORG=PS,              DM JUN83X
               RECFM=FBA,LRECL=133                             DM JUN83
         EJECT
GXREFDEF DSECT ,                   GROUP/UNIT CROSS-REFERENCE  DM JUN83
GXRUCBPT DS    F                   UCB INDEX TO UCB LOOKUP     DM JUN83
GXRUCBIX DS    0H                  UCB LOOKUP INDEX            SS JAN84
GXRNEWID DS    H                   NEW GROUP ID                SS JAN84
GXROLDID DS    H                   OLD GROUP ID                SS JAN84
GXRMASKS DS    0XL16               MASK 1-4                    SS SEP87
GXRMASK  DS    XL4                 MASK                        DM JUN83
GXRMASK2 DS    XL4                 MASK WORD 2                 SS JAN84
GXRMASK3 DS    XL4                 MASK WORD 3                 SS AUG84
GXRMASK4 DS    XL4                 MASK WORD 4                 SS AUG84
GXRMASKZ EQU   *-GXRMASK           MASK SIZE                   SS JAN84
GXRSORTL EQU   *-GXROLDID          LENG OF SORT FIELDS         SS JAN84
GXRLNG   EQU   *-GXREFDEF                                      DM JUN83
         EJECT ,                                               DM JUN83
SAVE     DSECT
SAVEAREA DS    18F
DBLWRD   DS    D                                               DM JUN83
UPLSTR   DS    F                   SAVE POINTER TO UCB PT LIST SS JAN84
COUNT1   DS    2F
COUNT2   DS    2F
MASK     DS    F
NUMUNIT  DS    F                   NUMBER OF UNITS             SS JAN84
UCBLU    DS    F
APTXREF  DS    F
ABUF     DS    F
ENDBUF   DS    F
GXREFXXX DS    F                   SAVE END OF GXREF
ADRGRPT  DS    A                   ADDRESS OF GROUP POINTERS   DM NOV83
GXRLNG2  DS    H                   SAVE LENGTH GXREF           SS JAN84
UNIQUE   DS    H                   SAVE LOOK UP DEVT           SS JAN84
LOWCUU   DS    H                   LOWER CUU OF RANGE          SS MAR87
HICUU    DS    H                   HIGHER CUU OF RANGE         SS MAR87
GROUP    DS    H                   SAVE GROUP NUMBER           SS JAN84
AFF3480  DS    H                   SAVE FOR 3480 AFFINATY      SS NOV90
SYSIN    DS    XL96                AREA FOR SYSIN DCB          DM JUN83
SYSPRINT DS    XL96                AREA FOR SYSPRINT DCB       DM JUN83
PREFTAB  DS    A                                               RCHMAY80
TAPETAB  DS    A                        *                      SS FEB88
SAVELUAD DS    A                        *                      SS FEB88
SAVEGRPT DS    A                        *                      SS FEB88
EDTPTR   DS    A                                               RCHMAY80
OCLIST   OPEN  (0),MF=L                                        DM JUL80
FLAGS    DS    X                    READ FLAGS                 SS MAR87
RDNAME   EQU   1                    LOOKING FOR DEVTYPE NAME   SS MAR87
RDDEV    EQU   2                    LOOKING FOR DEVICE         SS MAR87
RDMORE   EQU   3                    LOOKING FOR MORE DEVICES   SS MAR87
BFLAG    DS    X                    SORT FLAG
FLAG2    DS    X                    MISC FLAGS                 SS JAN84
*        EQU   X'80'                CVTMVSE  (XA SYSTEM)
ALTT     EQU   X'10'                PROCESSING ALT MASK        SS NOV89
GENEDT   EQU   X'04'                CURRENT EDT IS GEN EDT
LDEDT    EQU   X'02'                EDT WAS LOADED
RANGE    EQU   X'01'                RANGE OF CUU TO PROCESS
BUF      DS    CL9
SAVEPARM DS    CL20                 SAVE PARM                  SS JUN86
WTOE     DS    CL133                                           DM JUN83
         SPACE 2                                               DM JUN83
         AIF   ('&SYSPARM' NE 'TEST' AND                               -
               '&SYSPARM' NE 'TESTXA').TEST8                   DM JUN83
         SPACE ,                                               DM JUN83
DIFF     DS    CL32,C              DIFFERENCE HOLD AREA        DM JUN83
DUMPARM1 DS    A                   DATA POINTER FOR XDUMPFMT   DM JUN83
         DS    A                   PARMS                       DM JUN83
         DS    A(WTOE+1+X'80000000')    PRINT LINE             DM JUN83
         DS    3F                  LENGTH, OFFSET, FACTOR      DM JUN83
         SPACE ,                                               DM JUN83
DUMPARM2 DS    A                   DATA POINTER FOR XDUMPFMT   DM JUN83
         DS    A                   PARMS                       DM JUN83
         DS    A(WTOE+1+X'80000000')    PRINT LINE             DM JUN83
         DS    3F                  LENGTH, OFFSET, FACTOR      DM JUN83
         SPACE ,                                               DM JUN83
.TEST8   ANOP  ,                                               DM JUN83
         SPACE ,                                               DM JUN83
         DS    0F
* MODITFIED NAME TABLE                                         SS JAN84
MNTNAME  EQU   0                        GENERIC NAME           SS JAN84
MNTMASK  EQU   8                        MASK 4 BYTES           SS JAN84
MNTMASKI EQU   12                       MASK INDEX H           SS JAN84
MNTFLAG  EQU   14                       FLAG BYTE              SS JAN84
MNTLN    EQU   16                       ENTRY LENGTH           SS JAN84
MNT      DS    128CL(MNTLN)                                    SS AUG84
GXREF    DS    4096XL(GXRLNG)      GROUP/UNIT XREF TABLE       DM JUN83
GXREFEND DS    CL8
SAVEEND  EQU   *
         EJECT ,                                               DM JUN83
         AIF   ('&SYSPARM' EQ 'XA' OR                                  -
               '&SYSPARM' EQ 'TESTXA').XA17                    DM NOV83
         EDT   ,                                               DM JUN83
         AGO   .XA18                                           DM NOV83
.XA17    ANOP  ,                                               DM NOV83
         EDT   TYPE=BOTH                                       DM NOV83
.XA18    ANOP  ,                                               DM NOV83
         END
XDUMPFMT TITLE 'FORMAT DATA AS IN A DUMP'
XDUMPFMT START ,
         SPACE ,
***********************************************************************
*                                                                     *
*        SUBPROGRAM TO FORMAT DATA IN A MANNER SIMILAR                *
*        TO ABEND/SNAP DUMPS (SVC 51)                                 *
*                                                                     *
*        CALLING SEQUENCE:                                            *
*          PARM 1 - DATA TO BE PRINTED                                *
*          PARM 2 - FULLWORD LENGTH                                   *
*                   FULLWORD OFFSET (0 FIRST TIME)                    *
*                   FULLWORD FACTOR (TO BE ADDED TO PRINT ADDRESS)    *
*          PARM 3 - OUTPUT AREA (125 BYTES) - IF FACTOR IN PARM2      *
*                   IS ZERO THEN THE FIRST 5 BYTES WILL BE BLANK      *
*                                                                     *
*        RETURN CODES -                                               *
*          0 - ALL DATA HAS BEEN FORMATTED                            *
*          4 - SOME DATA IS LEFT                                      *
*                                                                     *
*        WRITTEN BY DOUG MERCER, JUNE 30, 1982,                       *
*          FOR THE LOCKHEED-CALIFORNIA COMPANY                        *
*                                                                     *
*        MODIFIED BY DOUG MERCER, AUGUST 13, 1982,                    *
*          TO PRINT BOTH OFFSET AND FACTOR PLUS                       *
*          OFFSET IF OFFSET IS NON-ZERO                               *
*                                                                     *
*        MODIFIED BY DOUG MERCER, SEPTEMBER 1, 1982,                  *
*          TO SUPPRESS FIRST 2 LEADING ZEROS ON THE                   *
*          ADDRESSES                                                  *
*                                                                     *
*        ATTRIBUTES - REENTRANT                                       *
*        TAB SETTINGS - 10 16 35 40 72                                *
*                                                                     *
***********************************************************************
         SPACE 3
R0       EQU   0
R1       EQU   1
R2       EQU   2                   USED FOR COUNTER
R3       EQU   3                   USED AS POINTER IN LOOP
R4       EQU   4                   UCB, POINTER  NEXT IN NEW EDT
R5       EQU   5                   COUNTER OR POINTER  NEW PTXREF
R6       EQU   6                   COUNTER OR POINTER  OLD PTXREF
R7       EQU   7                   COUNTER TO TOTAL FOR EACH SEC
R8       EQU   8                   POINTER TO MODEL EDT
R9       EQU   9                   SIZE OF GROUP - UNIT XREF
R10      EQU   10                  POINTER TO NEW EDT
R11      EQU   11                  PROGRAM BASE
R12      EQU   12                  PROGRAM BASE TWO
R13      EQU   13                  SAVE AREA/WORK BASE
R14      EQU   14
R15      EQU   15
         SPACE 3
         SAVE  (14,12),,XDUMPFMT_&SYSDATE
         LR    R12,R15
         SPACE ,
         USING XDUMPFMT,R12
         LM    R9,R11,0(R1)       PICK PARM POINTERS
         USING PARM2,R10
         USING PARM3,R11
         SPACE ,
         LR    R0,R11             BLANK
         LA    R1,L'PARM3           THE
         SR    R14,R14                OUTPUT
         SR    R15,R15                  AREA
         ICM   R15,8,=C' '        FILL BYTE
         MVCL  R0,R14
         SPACE ,
         MVI   AST1,C'*'
         LR    R1,R9              DEVELOP
         A     R1,OFF2              DATA ADDRESS
         SPACE ,
* FORMAT ADRESS(ES)                                            DM AUG82
         L     R0,FCT2            ADDRESS FACTOR               DM AUG82
         LTR   R0,R0                                           DM AUG82
         BZ    ADDRB              ZERO - USE SINGLE ADDRESS    DM AUG82
         A     R0,OFF2            FULL ADDRESS                 DM AUG82
         STCM  R0,15,DATA1                                     DM AUG82
         UNPK  ADDR3(9),DATA1(5)                               DM AUG82
         TR    ADDR3,HEXTBL                                    DM AUG82
         MVI   ADDR3+8,C' '       BLANK GARBAGE FROM UNPK      DM AUG82
         C     R0,=XL4'FFFF'      SEE IF SMALL                 DM SEP82
         BNL   *+10               NOT SMALL ENOUGH             DM SEP82
         MVC   ADDR3+2(2),=C'  '  BLANK ZEROS                  DM SEP82
         C     R0,=XL4'FFFFFF'    SEE IF LEADING ZEROS         DM SEP82
         BNL   *+10               NO                           DM SEP82
         MVC   ADDR3(2),=C'  '    BLANK                        DM SEP82
         UNPK  ADDR3A(5),OFF2+2(3)     OFFSET                  DM AUG82
         TR    ADDR3A,HEXTBL                                   DM AUG82
         MVI   ADDR3A+4,C' '      BLANK GARBAGE FROM UNPK      DM AUG82
         B     FORMREST           CONTINUE FORMATTING          DM AUG82
         SPACE ,                                               DM AUG82
ADDRB    UNPK  ADDR3B(9),OFF2(5)    DEVELOP PRINT              DM AUG82
         TR    ADDR3B,HEXTBL          ADDRESS                  DM AUG82
         MVI   ADDR3B+8,C' '      BLANK GARBAGE FROM UNPK      DM AUG82
         CLC   OFF2,=XL4'FFFF'    SEE IF SMALL                 DM SEP82
         BNL   *+10               NOT SMALL ENOUGH             DM SEP82
         MVC   ADDR3B+2(2),=C'  ' BLANK ZEROS                  DM SEP82
         CLC   OFF2,=XL4'FFFFFF'  SEE IF LEADING ZEROS         DM SEP82
         BNL   *+10               NO                           DM SEP82
         MVC   ADDR3B(2),=C'  '   BLANK                        DM SEP82
         SPACE ,
* FORMAT THE REST OF THE DATA                                  DM AUG82
FORMREST LR    R0,R1              SOURCE ADDRESS               DM AUG82
         LA    R1,32              MAX LENGTH FOR ONE LINE
         C     R1,LNG2            SEE IF AT LEAST THIS MUCH AVAILABLE
         BNH   *+8                YES
         L     R1,LNG2            LIMIT TO WHAT'S AVAILABLE
         LR    R2,R1
         LA    R14,DATA3          RESULT AREA
         LR    R15,R1
         MVCL  R14,R0             MOVE DATA TO CHARACTER AREA
         MVI   0(R14),C'*'        PUT ON 'SPLAT'
         SPACE ,
         LA    R3,DATA1           FORMAT FIRST
         LA    R4,DATA3             4 WORDS
         BAL   R5,FMTHEX              IN HEX
         SPACE ,
         LA    R3,DATA2           FORMAT LAST
         LA    R4,DATA3+16          4 WORDS
         BAL   R5,FMTHEX              IN HEX
         SPACE ,
         TR    DATA3,PRINTABL     CONVERT UNPRINTABLE BYTES TO '.'
         LA    R0,32              DEVELOP
         L     R1,LNG2              REMAINING
         SR    R1,R0                  LENGTH
         BP    LNGOK              STILL SOME LEFT
         AR    R0,R1              ADJUST TO LENGTH USED
         SR    R1,R1              ZERO REMAINDER
LNGOK    ST    R1,LNG2            UPDATE REMAINING LENGTH
         L     R1,OFF2
         AR    R1,R0
         ST    R1,OFF2            UPDATE OFFSET
         SPACE ,
         L     R0,LNG2
         SR    R15,R15            SET RETURN CODE
         LTR   R0,R0              SEE IF ANY LENGTH LEFT
         BZ    *+8                NO
         LA    R15,4              RESET RETURN CODE
         RETURN (14,12),T,RC=(15)
         SPACE 3
* FORMAT 4 WORDS IN HEX, R2 IS NUMBER OF BYTES TO FORMAT,
*  R3 POINTS TO RESULT AREA, R4 POINTS TO SOURCE AREA,
*  R5 IS RETURN
         SPACE ,
FMTHEX   LA    R0,4               WORD COUNT
         LTR   R2,R2              SEE IF ANY TO DO
         BNPR  R5                 NO - RETURN
         SPACE ,
FH1      UNPK  0(9,R3),0(5,R4)    MAKE HEX
         TR    0(8,R3),HEXTBL       PRINTABLE
         MVI   8(R3),C' '         BLANK GARBAGE BYTE
         LA    R3,9(,R3)          INCREMENT
         LA    R4,4(,R4)            ADDRESSES
         SH    R2,=H'4'           DECREMENT REMAINING BYTES
         BM    FH2                GONE TOO FAR - MUST BLANK SOME
         BZR   R5                 EXHAUSTED - RETURN
         BCT   R0,FH1             TO NEXT WORD
         BR    R5                 RETURN
         SPACE 2
FH2      SH    R3,=H'3'           TOO MUCH FORMATTED - BLANK SOME
         SPACE ,
FH3      MVC   0(2,R3),=C'  '     BLANK 2 DIGITS
         SH    R3,=H'2'           BACK UP 2 MORE
         AH    R2,=H'1'           ADJUST REMAINING COUNT
         BM    FH3                MORE TO GO
         SPACE ,
         BR    R5                 DONE - RETURN
         SPACE 3
PRINTABL DC    256C'.'            TRANSLATE TABLE - NON-GRAPHICS
         ORG   PRINTABL+C' '           TO PERIODS
         DC    C' '
         ORG   PRINTABL+C''
         DC    C'.<(+.&&'
         ORG   PRINTABL+C'!'
         DC    C'!$*);-/'
         ORG   PRINTABL+C','
         DC    C',%_>?'
         ORG   PRINTABL+C':'
         DC    C':#@''="'
         ORG   PRINTABL+C'A'
         DC    C'ABCDEFGHI'
         ORG   PRINTABL+C'J'
         DC    C'JKLMNOPQR'
         ORG   PRINTABL+C'S'
         DC    C'STUVWXYZ'
         ORG   PRINTABL+C'0'
         DC    C'0123456789'
         ORG   ,
         SPACE 3
HEXTBL   EQU   *-240              TO MAKE UNPACKED HEX PRINTABLE
         DC    C'0123456789ABCDEF'
         SPACE 3
PARM2    DSECT ,                  PARAMETER 2 FROM CALL
LNG2     DS    F                  (REMAINING) LENGTH
OFF2     DS    F                  OFFSET FROM BEGINNING OF PARM1
FCT2     DS    F                  FACTOR TO ADD TO ADDRESS IN PRINT
         SPACE 3
         DSECT ,                  PARAMETER 3 FROM CALL
PARM3    DS    0CL125             DATA RETURN AREA             DM AUG82
ADDR3    DS    CL8,C              FACTOR + OFFSET              DM AUG82
ADDR3A   DS    CL4,CL2            OFFSET                       DM AUG82
         ORG   ADDR3+5                                         DM AUG82
ADDR3B   DS    CL8,CL2            ADDRESS OF HIGH-ORDER BYTE   DM AUG82
DATA1    DS    4CL9,CL3           4 WORDS (HEX)
DATA2    DS    4CL9,C             4 WORDS (HEX)
AST1     DS    C'*'
DATA3    DS    CL32,C'*'          32 BYTES (CHAR)
         SPACE 2
         END   ,

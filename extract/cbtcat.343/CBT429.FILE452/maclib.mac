./ ADD NAME=#BALR    0100-00038-00038-1646-00022-00022-00000-MACRO
         MACRO ,
&LABEL   #BALR &R1,&R2
.**********************************************************************
.*                                                                    *
.*       THIS MACRO IS USED TO GENERATE LINKAGE VIA A POINTER         *
.*       DEFINED VALUE.  IS SPLEVEL IS ONE, MVS/370 WILL BE CHECKED   *
.*       FOR AND A BALR USED INSTEAD OF BASSM IF 370 IS RUNNING.      *
.*                                                                    *
.**********************************************************************
         GBLC  &SYSSPLV                 SPLEVEL
         SPLEVEL TEST
         AIF   ('&SYSSPLV' EQ '1').LEVEL1
&LABEL   BASSM &R1,&R2                  MVS/XA LINKAGE
         MEXIT ,
.LEVEL1  ANOP  ,
&LABEL   L     &R1,16                   POINT TO CVT
         TM    116(&R1),128             MVS/XA ?
         BO    *+10
         BALR  &R1,&R2                  MVS/370 LINKAGE
         B     *+6
         BASSM &R1,&R2                  MVS/XA LINKAGE
         MEND  ,
./ ADD NAME=#BLANK   0100-00038-00038-1646-00037-00037-00000-MACRO
         MACRO ,
&NAME    #BLANK &F,&LEN=,&PAD=C' '
         LCLC  &L
         AIF   ('&F' EQ '').BLA0700   ERROR - MISSING FIELD
         AIF   ('&F'(1,1) EQ '(').BLA0100   FIELD IS A REGISTER
         AIF   ('&LEN' NE '').BLA0400   LENGTH SPECIFIED
&L       SETC  'L''&F'
&NAME    MVI   &F,&PAD
         MVC   &F+1(&L-1),&F
         MEXIT ,
.BLA0100 ANOP  ,
&NAME    LR    0,&F(1)                  R0 @ FIELD
         AIF   ('&LEN' NE '').BLA0200   LENGTH CODED
         LA    1,4095                   R1 HAS DEFAULT LENGTH
         AGO   .BLA0600                 CONTINUE
.BLA0200 AIF   ('&LEN'(1,1) EQ '(').BLA0300   LENGTH IS A REGISTER
         LA    1,&LEN                   R1 HAS LENGTH OF FIELD
         AGO   .BLA0600                 CONTINUE
.BLA0300 LR    1,&LEN(1)                R1 HAS LENGTH OF FIELD
         AGO   .BLA0600                 CONTINUE
.BLA0400 ANOP  ,
&NAME    LA    0,&F                     R0 @ FIELD
         AIF   ('&LEN'(1,1) EQ '(').BLA0500   LEN IS A REGISTER
         LA    1,&LEN                   R1 HAS LENGTH OF FIELD
         AGO   .BLA0600                 CONTINUE
.BLA0500 ANOP  ,
         LR    1,&LEN(1)                R1 HAS LENGTH OF FIELD
.BLA0600 ANOP  ,
         AIF   ('&PAD' EQ '0' OR '&PAD'  EQ 'X''00''').BLA0640
         LA    15,&PAD                  R15 HAS PAD CHARACTER
         SLL   15,24                    IN HIGH ORDER BYTE
         AGO   .BLA0660
.BLA0640 SR    15,15                    ZERO PAD AND LENGTH
.BLA0660 MVCL  0,14                     PROPOGATE PAD CHARACTER
         MEXIT ,
.BLA0700 MNOTE 8,'BLA001I - NO FIELD NAME SPECIFIED'
         MEND  .
./ ADD NAME=#BLKLEN  0100-00038-00038-1646-00038-00038-00000-MACRO
         MACRO ,
&NAME    #BLKLEN &DECB,&REG,&WKREG=R15,&ACSMETH=BSAM
         LCLC  &A,&B,&R,&O,&F
&O       SETC  '4'                 FLAG OFFSET FOR BSAM
&F       SETC  '128'               'S' FLAG FOR BSAM
         AIF   ('&ACSMETH' EQ 'BSAM' OR '&ACSMETH' EQ 'BPAM').BLK0100
         AIF   ('&ACSMETH' NE 'BDAM').BLK0600
&O       SETC  '5'                 FLAG OFFSET FOR BDAM
&F       SETC  '64'                'S' FLAG FOR BDAM
.BLK0100 ANOP  ,
.*
&R       SETC  '&REG'
         AIF   ('&REG' NE '').BLK0200
&R       SETC  'R1'
.*
.BLK0200 AIF   ('&DECB' EQ '').BLK0500
         AIF   ('&DECB'(1,1) EQ '(').BLK0300
&A       SETC  '&DECB+'
&B       SETC  ''
         AGO   .BLK0400
.BLK0300 ANOP  ,
&A       SETC  ''
&B       SETC  '&DECB'
.*
.BLK0400 ANOP  ,
&NAME    LH    &R,&A.6&B                GET BLKSIZE FROM DECB
         TM    &A.&O&B,&F               WAS 'S' CODED ON READ ?
         BZ    *+12                     YES, SKIP DCB STUFF
         L     &R,&A.8&B                GET DCB ADDRESS
         LH    &R,62(0,&R)              GET BLKSIZE FROM DCB
         L     &WKREG,&A.16&B           LOAD IOB ADDRESS
         SH    &R,14(0,&WKREG)          GET ACTUAL # BYTES READ
         MEXIT EXIT
.BLK0500 MNOTE 8,'BLK001A - DECB ADDRESS MISSING'
         MEXIT EXIT
.BLK0600 MNOTE 4,'BLK002A - INVALID ACCESS METHOD, BSAM ASSUMED'
         AGO   .BLK0100                 CONTINUE
         MEND  ,
./ ADD NAME=#CATRC   0100-00038-00038-1646-00224-00224-00000-MACRO
*---------------------------------------------------------------------*
* VSAM SETS ERROR CODES IN THE RPL AND THE ACB.  ERROR CODES SET IN   *
* THE RPL ARE LISTED AND EXPLAINED IN OS/VS VIRTUAL STORAGE ACCESS    *
* METHOD (VSAM) PROGRAMMER'S GUIDE AND IN OS/VS2 VSAM LOGIC.  THOSE   *
* SET IN THE ACB TO INDICATE OPEN,CLOSE, OR END OF VOLUME ERRORS ARE  *
* LISTED AND EXPLAINDED IN OS/VS2 VSAM LOGIC.                         *
*                                                                     *
* OS/VS2 CATALOG MANAGEMENT SETS ERROR AND REASON CODES IN CCAPROB.   *
* (FOR A DESCRIPTION OF THE CCA, SEE "CATALOG MANAGEMENT CONTROL      *
* BLOCK DESCRIPTIONS" IN THE "DATA AREAS" SECTION OF OS/VS2 CATALOG   *
* MANAGEMENT LOGIC.)  CCAPROB INCLUDES AN IDENTIFICATION OF THE       *
* CATALOG MANAGEMENT MODULE THAT SET THE CODE (CCAMODID), A REASON    *
* CODE (CCAREASN), AND A RETURN CODE (CCACD1), WICH APPEARS IN R15.   *
* COMPLETE EXPLANATIONS OF THE ERROR AND RETURN CODES, TOGETHER WITH  *
* THE APPROPRIATE PROGRAMMER RESPONSES ARE GIVEN IN THE DESCRIPTION   *
* OF MESSAGE IDC3009I IN OS/VS MESSAGE LIBRARY: VS2 SYSTEM MESSAGES.  *
* BRIEF DESCRIPTIONS OF THE RETURN CODES ARE GIVEN BELOW:             *
*---------------------------------------------------------------------*
         SPACE ,
RCS      EQU   0         OPERATION COMPLETED SUCCESSFULLY.
         SPACE ,
RCCAT    EQU   4         AN ERROR OCCURRED WHILE PERFORMING OPEN/CLOSE
*                        PROCESSING FOR A VSAM CATALOG OR A CATALOG
*                        RECOVERY AREA.  IF NO JOBCAT/STEPCAT DD
*                        STATEMENT WAS SUPPLIED, DYNAMIC ALLOCATION
*                        MAY HAVE FAILED BECAUSE THE VOLUME IS
*                        ALLOCATED EXCLUSIVELY.  THE VOLUME MAY BE
*                        ALLOCATED EXCLUSIVELY BECAUSE (1) THE DD
*                        STATEMENT SPECIFIED DEFERRED MOUNT, (2) THE
*                        VOLUME COUNT IS GREATER THAN THE UNIT COUNT
*                        ON THE DD STATEMENT, OR (3) A PREVIOUS ACCESS
*                        METHOD SERVICES COMMAND DEMOUNTED THE VOLUME
*                        AND CHANGED THE ALLOCATION OF THE VOLUME TO
*                        EXCLUSIVE.
         SPACE ,
RCENT    EQU   8         ENTRY DOES NOT EXIST, IF ACTION IS ONE THAT
*                        LOCATES AN ENTRY, OR ENTRY ALREADY EXISTS, IF
*                        ACTION IS ONE THAT ADDS AN ENTRY TO THE CATLG.
         SPACE ,
RCINSP   EQU   20        NOT ENOUGH SPACE IS AVAILABLE IN THE CATALOG
*                        DATASET.  ANOTHER EXTENT CANNOT BE OBTAINED,
*                        BECAUSE THERE IS NO MORE SPACE ON THE VOLUME
*                        IN WHICH THE CATALOG RESIDES OR THE MAXIMUM
*                        NUMBER OF EXTENTS HAS BEEN REACHED.
         SPACE ,
RCIOL    EQU   24        PERMANENT READ ERROR IN VSAM CATALOG.
         SPACE ,
RCIONL   EQU   28        PERMANENT I/O ERROR IN VSAM CATALOG.
         SPACE ,
RCINCPL  EQU   32        ERROR WAS DETECTED IN THE CATALOG PARAMETER
*                        LIST (CTGPL).
         SPACE ,
RCDSNF   EQU   36        DATASET WAS NOT FOUND.
         SPACE ,
RCVLSZ   EQU   40        VOLUME LIST OR WORK AREA IS TOO SMALL - THE
*                        REQUIRED LENGTH VALUE IS RETURNED IN THE
*                        FEEDBACK FIELD.
         SPACE ,
RCVLSM   EQU   44        WORK AREA IS TOO SMALL; SYSTEM IS UNABLE TO
*                        RETURN THE REQUIRED SIZE.
         SPACE ,
RCINFUNC EQU   48        OPERATION IS NOT A VALID ONE.
         SPACE ,
RCIOU    EQU   52        I/O ERROR WAS DETECTED ON A USER VOLUME.
*                        AN ATTEMPT TO MODIFY THE VTOC OF THE VOLUME
*                        ON WHICH A USER-SPECIFIED DATASET IS BEING
*                        DEFINED OR MODIFIED FAILED BECAUSE OF A READ
*                        OR WRITE ERROR.
         SPACE ,
RCSEC    EQU   56        PASSWORD IS INCORRECT.
         SPACE ,
RCINENT  EQU   60        CATALOG RECORD TYPE IS INVALID.
         SPACE ,
RCNAME   EQU   64        DATASEET OR INDEX CATALOG RECORD ASSOCIATED
*                        WITH THE CLUSTER OR ALTERNATE INDEX CATALOG
*                        RECORD WAS NOT FOUND.
         SPACE ,
RCNOSP   EQU   68        NO SPACE IS AVAILABLE ON A USER VOLUME.
         SPACE ,
RCNMNTD  EQU   72        USER VOLUME IS NOT MOUNTED.
         SPACE ,
RCNUNIT  EQU   76        UNIT IS NOT AVAILABLE FOR MOUNTING USER VOLUME
*                        OR VOLUME NOT MOUNTED.
         SPACE ,
RCRELOP  EQU   80        INVALID RELATED OBJECT.  THE OBJECT SPECIFIED
*                        IN THE RELATED PARAMETER OF THE DEFINE COMMAND
*                        DOES NOT EXIST OR IS IMPROPER FOR THE OBJECT
*                        BEING DEFINED.
         SPACE ,
RCDATE   EQU   84        PURGE DATE HAS NOT EXPIRED.
         SPACE ,
RCCRAOPC EQU   88        ERROR WITH A CATALOG RECOVERY AREA DEFINE
*                        OPERATION.
         SPACE ,
RCDSEXT  EQU   92        DATASET HAS REACHECK THE MAXIMUM NUMBER OF
*                        EXTENTS.
         SPACE ,
RCOBTAIN EQU   94        AN OS/VS DADSM OBTAIN REQUEST FAILED DURING
*                        A VSAM CATALOG DELETE REQUEST.
         SPACE ,
RCSPANCK EQU   96        ERROR IN SPECIFYING KEY LENGTH, KEY POSITION,
*                        OR RECORD SIZE FOR AN ALTERNATE INDEX OR A
*                        SPANNED CLUSTER.
         SPACE ,
RCRENAME EQU   98        AN UNUSUAL CONDITION OCCURRED DURING ALTER
*                        NAME OF A UNIQUE OR NONVSAM DATASET.
         SPACE ,
RCSCRTCH EQU   102       AN OS/VS DADSM SCRATCH REQUEST FAILED DURING
*                        A VSAM DELETE REQUEST FOR A UNIQUE OR NONVSAM
*                        DATASET.
         SPACE ,
RCCATEX  EQU   104       CATALOG EXISTS.
         SPACE ,
RCNTFMT4 EQU   106       A FMT-4 DSCB PROCESSING ERROR WAS ENCOUNTERED.
         SPACE ,
RCINFNAM EQU   108       FIELD NAME IS INVALID.
         SPACE ,
RCINFPL  EQU   112       FIELD PARAMETER LIST (CTGFL) CONTAINS
*                        INVALID PARAMETERS.
         SPACE ,
RCCATBAL EQU   116       CATALOG RECORDS ARE INVALID.
         SPACE ,
RCSYSFLD EQU   120       USER ATTEMPTED TO MODIFY A SYSTEM FIELD OR
*                        NONEXISTENT FIELD.
         SPACE ,
RCINCI   EQU   124       CONTROL INTERVAL NUMBER IS INVALID.
         SPACE ,
RCBLKVCK EQU   128       USER PROVIDED WORK AREA IS OUTSIDE HIS ADDRESS
*                        SPACE.
         SPACE ,
RCINPTR  EQU   132       POINTER IS NOT VALID.
         SPACE ,
RCMISPAR EQU   136       REQUIRED PARAMETER IS MISSING.
         SPACE ,
RCINCNPM EQU   140       SPECIFIED PARAMETERS ARE INCONSISTENT OR
*                        CONFLICTING.
         SPACE ,
RCINENTN EQU   144       ENTRY NAME IS INVALID.
         SPACE ,
RCVOLOWN EQU   148       VOLUME IS ALREADY OWNED BY ANOTHER VSAM CATLG.
         SPACE ,
RCDNECAT EQU   152       USER ATTEMPTED TO DELETE A CATALOG THAT IS NOT
*                        EMPTY.
         SPACE ,
RCNOSPSA EQU   156       NO SPACE AVAILABLE TO SUBALLOCATE.
         SPACE ,
RCVNDSPD EQU   160       DELETION OF SPACE OBJECT DID NOT CAUSE VOLUME
*                        TO BE DELETED.
         SPACE ,
RCINSSWA EQU   164       NOT ENOUGH STORAGE IS AVAILABLE FOR WORK AREA.
         SPACE ,
RCINVDTY EQU   168       SPECIFIED DEVICE-TYPE IS NOT SUPPORTED.
         SPACE ,
RCDUPNVL EQU   172       VOLUME HAS DUPLICATE DATA SPACE NAME.
         SPACE ,
RCNSPVTC EQU   176       NO SPACE AVAILABLE ON VTOC FOR DSCB.
         SPACE ,
RCDSNFND EQU   180       DATA SPACE WAS NOT FOUND.
         SPACE ,
RCDSO    EQU   184       DATA SET IS CURRENTLY OPEN, SO THE CATALOG
*                        RECORD CANNOT BE MODIFIED.
         SPACE ,
RCCATUNA EQU   188       THE CATALOG IS UNAVAILABLE.
         SPACE ,
RCMLRSZ  EQU   192       MAXIMUM LOGICAL RECORD LENGTH SPECIFIED IS
*                        GREATER THAN 32,761.
         SPACE ,
RCMCISZD EQU   196       DATA COMPONENT CONTROL INTERVAL SIZE SPECIFIED
*                        IS GREATER THAN 32,767.
         SPACE ,
RCMCISZI EQU   200       INDEX COMPONENT CONTROL INTERVAL SIZE
*                        SPECIFIED IS GREATER THAN 32,767.
         SPACE ,
RCKEYINC EQU   204       KEY EXTENDS BEYOND END OF RECORD.
         SPACE ,
RCBUFSIZ EQU   208       BUFFER SIZE IS TOO SMALL.
         SPACE ,
RCSIZCAL EQU   212       CONTROL INTERVAL SIZE CANNOT BE CALCULATED.
         SPACE ,
RCVTCBAL EQU   216       VOLUME'S VTOC IS INVALID.
         SPACE ,
RCDOSVTC EQU   220       DOS VTOC CANNOT BE CONVERTED TO OS/VS VTOC.
         SPACE ,
RCMXGRP  EQU   224       CATALOG RECORD HAS EXCEEDED THE MAXIMUM NUMBER
*                        OF SETS OF FIELDS ALLOWED.
         SPACE ,
RCTSAUTH EQU   226       TEST AUTHORIZATION FAILED.
         SPACE ,
RCLOCKER EQU   228       ERROR DETECTED IN THE TIME-OF-DAY CLOCK.
         SPACE ,
RCHIGH   EQU   230       VSAM CATALOG RETRIEVE OF THE CONTROL INTERVAL
*                        FAILED TO GET A LOW-RANGE RECORD FROM THE VSAM
*                        CATALOG.
         SPACE ,
RCSMFER  EQU   232       ERROR DETECTED IN SMF PROCESSING.
         SPACE ,
RCLEOD   EQU   234       END OF DATA ENCOUNTERED WHILE READING THE LOW
*                        DATA KEY RANGE OF THE VSAM CATALOG.
         SPACE ,
RCSPMAPE EQU   236       ERROR DETECTED IN SCANNING THE SPACE MAP.
         SPACE ,
RCNOUCEN EQU   238       NO USER CATALOG ENTRY IN THE MASTER CATALOG
*                        FOR CONVERT VOLUME PROCESSING.
         SPACE ,
RCINDER  EQU   240       REQUIRED DD STATEMENT MISSING.
         SPACE ,
RCEFRMPH EQU   242       A PHYSICAL I/O ERROR OCCURRED DURING AN ERASE
*                        OF THE DATASET BEING DELETED.
         SPACE ,
RCEF     EQU   244       ERASE OPERATION FAILED - DELETE OPERATION WAS
*                        NOT PERFORMED.
         SPACE ,
RCVOLENT EQU   248       THE VOLUME CATALOG RECORD (IDENTIFIED WITH A
*                        CALLER-SUPPLIED VOLUME SERIAL NUMBER) WAS NOT
*                        FOUND.
         SPACE ,
RCEFRM   EQU   250       VSAM RECORD MANAGEMENT FOUND A LOGICAL ERROR
*                        DURING ERASE PROCESSING WHILE DELETING A VSAM
*                        DATASET.
         SPACE ,
RCEE     EQU   252       ERROR WAS DETECTED, AND THE OPERATION WAS NOT
*                        COMPLETED.
         SPACE ,
RCBADE   EQU   400       ---------------------------------------------
./ ADD NAME=#CCW     0100-00038-00038-1646-00091-00091-00000-MACRO
         MACRO ,
         #CCW  &LIST=YES
         GBLB  &####CCW
         AIF   (&####CCW).MEND
&####CCW SETB  1
         AIF   ('&LIST' NE 'NO').BEGIN
         PUSH  PRINT
         PRINT OFF
.BEGIN   ANOP  ,
.*                    0 1 2 3  4 5 6 7
.*    FORMAT-0 CCW   CCAAAAAA FFXXKKKK
.*    FORMAT-1 CCW   CCFFKKKK AAAAAAAA
*
*        CCW FLAG BYTE MAPPING  (BITS 32-37 OR 8-15)
*
CD       EQU   B'10000000'   CHAIN DATA
CC       EQU   B'01000000'   CHAIN COMMAND
SLI      EQU   B'00100000'   SUPPRESS LENGTH INDICATION
SKIP     EQU   B'00010000'   SKIP
PCI      EQU   B'00001000'   PROGRAM CONTROLLED INTERRUPT
IDA      EQU   B'00000100'   INDIRECT DATA ADDRESS
SUSP     EQU   B'00000010'   SUSPEND
*
*        GENERAL COMMAND CODE MAPPING  (BITS 0-7)
*
WRITE    EQU   B'00000001'   WRITE
READ     EQU   B'00000010'   READ
NOP      EQU   B'00000011'   NO OPERATION
SENSE    EQU   B'00000100'   SENSE
SENSEID  EQU   B'11100100'   SENSE ID
TIC      EQU   B'00001000'   TRANSFER-IN-CHANNEL
*
*        TAPE COMMAND CODE MAPPING
*
RBACK    EQU   B'00001100'   READ BACKWARD
REW      EQU   B'00000111'   REWIND
RUN      EQU   B'00001111'   REWIND AND UNLOAD
ERG      EQU   B'00010111'   ERASE GAP
WTM      EQU   B'00011111'   WRITE TAPE MARK
BSB      EQU   B'00100111'   BACKSPACE BLOCK
BSF      EQU   B'00101111'   BACKSPACE FILE
FSB      EQU   B'00110111'   FORWARD SPACE BLOCK
FSF      EQU   B'00111111'   FORWARD SPACE FILE
DSE      EQU   B'10010111'   DATA SECURITY ERASE
M800     EQU   B'11001011'   9 TRACK, 800 BPI
M1600    EQU   B'11000011'   9 TRACK, 1600 BPI
M6250    EQU   B'11010011'   9 TRACK, 6250 BPI
*
*        DASD COMMAND CODE MAPPING
*
RECAL    EQU   B'00010011'   RECALIBRATE
SEEK     EQU   B'00000111'   FULL SEEK (BBCCHH)
SEEKC    EQU   B'00001011'   SEEK CYLINDER (00CCHH)
SEEKH    EQU   B'00011011'   SEEK HEAD (0000HH)
SPCNT    EQU   B'00001111'   SPACE COUNT
SFM      EQU   B'00011111'   SET FILE MASK
SSEC     EQU   B'00100011'   SET SECTOR
DEFEXT   EQU   B'01100011'   DEFINE EXTENT
LOCREC   EQU   B'01000111'   LOCATE RECORD
MT       EQU   B'10000000'   MUILITRACK ON (OR'ED WITH CMD CODE)
*
SHAEQ    EQU   B'00111001'   SEARCH HOME ADDRESS EQUAL (CCHH)
SIDEQ    EQU   B'00110001'   SEARCH ID EQUAL (CCHHR)
SIDHI    EQU   B'01010001'   SEARCH ID HIGH  (CCHHR)
SIDHEQ   EQU   B'01110001'   SEARCH ID HIGH OR EQUAL (CCHHR)
SKEQ     EQU   B'00101001'   SEARCH KEY EQUAL
SKHI     EQU   B'01001001'   SEARCH KEY HIGH
SKHEQ    EQU   B'01101001'   SEARCH KEY HIGH OR EQUAL
*
RHA      EQU   B'00011010'   READ HOME ADDRESS
DRHA     EQU   B'00001010'   DIAGNOSTIC READ HOME ADDRESS
RCT      EQU   B'00010010'   READ COUNT (CCHHRKDD)
RR0      EQU   B'00010110'   READ RECORD 0
RDT      EQU   B'00000110'   READ DATA
RKD      EQU   B'00001110'   READ KEY AND DATA
RCKD     EQU   B'00011110'   READ COUNT, KEY AND DATA
RMCKD    EQU   B'01011110'   READ MULTIPLE COUNT, KEY AND DATA
RSEC     EQU   B'00100010'   READ SECTOR
*
WHA      EQU   B'00011001'   WRITE HOME ADDRESS
DWHA     EQU   B'00001001'   DIAGNOSTIC WRITE HOME ADDRESS
WR0      EQU   B'00010101'   WRITE RECORD 0
WDT      EQU   B'00000101'   WRITE DATA
WKD      EQU   B'00001101'   WRITE KEY AND DATA
WCKD     EQU   B'00011101'   WRITE COUNT, KEY AND DATA
WSCKD    EQU   B'00000001'   WRITE SPECIAL COUNT, KEY AND DATA
ERASE    EQU   B'00010001'   ERASE
*
         AIF   ('&LIST' NE 'NO').MEND
         POP   PRINT
.MEND    MEND  ,
./ ADD NAME=#COPY    0100-00038-00038-1646-00083-00083-00000-MACRO
         MACRO ,
&LABEL   #COPY &FUNC,&BR=NO,&SIZE=,&WHO=,&YEAR=
.**********************************************************************
.*                                                                    *
.*     THIS MACRO IS USED TO INSERT THE NECESSARY COPYRIGHT           *
.*     NOTICE INTO BOTH THE LISTING AND THE OBJECT CODE.  NOTE        *
.*     THAT MNOTES PRINT REGARDLESS OF USE OF PRINT NOGEN.            *
.*                                                                    *
.*     THE MACRO HAS TWO FUNCTIONS, 'SET' AND 'GEN'.  'SET' IS        *
.*     USED TO ESTABLISH THE NAME OF THE COPYRIGHT HOLDER AND/OR      *
.*     SET THE GLOBAL &#COPYSZ FOR USE IN AN OUTER MACRO.  'GEN'      *
.*     IS CODED TO ACTUALLY GENERATE THE COPYRIGHT.  IF NEITHER       *
.*     IS CODED, 'GEN' IS ASSUMED.                                    *
.*                                                                    *
.**********************************************************************
         GBLA  &#COPY
         GBLA  &#COPYSZ                 TOTAL SIZE OF STRING IN BYTES
         GBLC  &#COPYYR                 YEAR OF COPYRIGHT
         GBLC  &#COPYWH                 NAME OF COPYRIGHT HOLDER
         LCLA  &N
         LCLC  &X,&Y
.*
&X       SETC  '&SYSDATC'(1,4)
         AIF   ('&YEAR' EQ '').NOYEAR
&#COPYYR SETC  '&YEAR'
.NOYEAR  ANOP  ,
.*
         AIF   ('&WHO' NE '').EXPLW     NAME CODED ?
         AIF   ('&#COPYWH' NE '').SIZE  FIRST TIME THRU ?
&#COPYWH SETC  'MVS-JES2@HOME.COM'      SET DEFAULT NAME
         AGO   .SIZE                    GO SET SIZE
.*
.EXPLW   ANOP  ,                        EXPLICIT NAME CODED
&#COPYSZ SETA  0                        MUST RESET SIZE
         AIF   ('&WHO'(1,1) NE '''').NOQUOTE
&N       SETA  K'&WHO-2                 STRIP APOSTROPHES
&#COPYWH SETC  '&WHO'(2,&N)
         AGO   .SIZE
.NOQUOTE ANOP  ,
&#COPYWH SETC  '&WHO'                   UNQUOTED EXPLICIT NAME
.*
.SIZE    AIF   ('&SIZE' NE '').EXPL     IS SIZE CODED ?
         AIF   (&#COPYSZ NE 0).FUNC
&#COPYSZ SETA  ((42+K'&#COPYWH+1)/2)*2  EVEN DEFAULT SIZE
         AGO   .FUNC
.EXPL    ANOP  ,
&#COPYSZ SETA  ((&SIZE+1)/2)*2          ROUNDED EXPLICIT SIZE
.*
.FUNC    ANOP  ,
         AIF   (&#COPY NE 0).FUNC1
&#COPY   SETA  1
         AIF   ('&#COPYYR' NE '').YEAROK
&#COPYYR SETC  '1985, &X'
&#COPYSZ SETA  &#COPYSZ+6
         AGO   .FUNC1
.YEAROK  ANOP  ,
         AIF   ('&#COPYYR' EQ '&X').FUNC1
&#COPYYR SETC  '&#COPYYR., &X'
&#COPYSZ SETA  &#COPYSZ+6
.FUNC1   ANOP  ,
         AIF   ('&FUNC' EQ 'SET').MEND
         AIF   ('&FUNC' EQ '' OR '&FUNC' EQ 'GEN').GEN
         MNOTE 4,'INVALID FUNCTION &FUNC, GEN ASSUMED'
.*
.GEN     ANOP  ,                        GENERATE THE COPYRIGHT
         AIF   ('&BR' EQ 'NO').NOBR     BRANCH NEEDED ?
&N       SETA  &#COPYSZ+4
         B     *+&N                     BR AROUND COPYRIGHT NOTICE
.NOBR    ANOP  ,
*
         MNOTE '*        (C) COPYRIGHT &#COPYYR &#COPYWH.'
         MNOTE '*        PROGRAM PROPERTY OF &#COPYWH.'
         MNOTE '*        ALL RIGHTS RESERVED.'
 MNOTE '*        NO PART OF THIS PROGRAM MAY BE REPRODUCED, STORED'
 MNOTE '*        IN A RETRIEVAL SYSTEM OR TRANSMITTED IN ANY FORM'
 MNOTE '*        OR BY ANY MEANS, INCLUDING PHOTOCOPYING, RECORDING,'
 MNOTE '*        ELECTRONIC, MECHANICAL OR OTHERWISE WITHOUT THE'
 MNOTE '*        WRITTEN CONSENT OF THE COPYRIGHT HOLDER.'
*
&N       SETA  &#COPYSZ-22
&LABEL   DC    CL&N.' (C) COPYRIGHT &#COPYYR &#COPYWH  '
         DC    CL22' ALL RIGHTS RESERVED.'
.MEND    MEND  ,
./ ADD NAME=#CTGFL   0100-00038-00038-1646-00196-00196-00000-MACRO
         MACRO ,
&NAME    #CTGFL &FLDNAME,               NAME OF CTGFL TO BE BUILT      X
               &DATA=,                  ADDR OF DATA FOR FIELD         X
               &CHAIN=,                 ADDR OF CTGFL FOR TESTS        X
               &TYPE=REQUEST,           TYPE OF CTGFL (TEST OR REQ)    X
               &MF=L,                   MACRO FORMAT (LIST OR EXEC)    X
               &GROUP=,                 GROUP CODE OF FIELD            X
               &PREFIX=CTG              PREFIX FOR LABEL GENERATION
.*
.* DEFINE LOCAL SET SYMBOLS
.*
         LCLA  &I                       LOOP COUNTER
         LCLB  &REQ                     =1 IF THIS IS A REQUEST TYPE
         LCLB  &TST                     =1 IF THIS IS A TEST TYPE
         LCLC  &NOENT                   SET TO NUMBER OF FIELDS
         LCLC  &COND                    SET TO HEX VALUE FOR TEST
         LCLC  &CTBL(19)                TABLE TO TRANSLATE TEST CONDS
         LCLC  &LABEL                   DEFINITION OF LABEL
         LCLC  &IX                      SET TO &SYSNDX VALUE
         LCLC  &REG                     USED WHEN REG ADDR SPECD
.*
.* INITIALIZE SET SYMBOLS TO NONSTANDARD DEFAULTS
.*
&NOENT   SETC  '01'                     1 ENTRY IF NOT MULTITYPE
&IX      SETC  '&SYSNDX'                INITIALIZE SHORT INDEX
&LABEL   SETC  '&PREFIX'(1,4)           ONLY USE FOUR CHARS FROM PREF
&LABEL   SETC  '&LABEL.&IX'             GENERATE A UNIQUE LABEL
.*
&CTBL(1) SETC  'EQ'                     --+
&CTBL(2) SETC  'NE'
&CTBL(3) SETC  'GT'
&CTBL(4) SETC  'LT'
&CTBL(5) SETC  'GE'
&CTBL(6) SETC  'LE'                     THIS TABLE PROVIDES
&CTBL(7) SETC  'Z'
&CTBL(8) SETC  'ON'                     A REFERENCE TO DETERMINE
&CTBL(9) SETC  'MX'
&CTBL(11) SETC 'CTGFLDEQ'               TEST CONDITIONS FROM
&CTBL(12) SETC 'CTGFLDNE'
&CTBL(13) SETC 'CTGFLDGT'               INPUT MNEMONICS
&CTBL(14) SETC 'CTGFLDLT'
&CTBL(15) SETC 'CTGFLDGE'
&CTBL(16) SETC 'CTGFLDLE'
&CTBL(17) SETC 'CTGFLDZ'
&CTBL(18) SETC 'CTGFLDON'
&CTBL(19) SETC 'CTGFLDMX'               --+
.*
.*  PARSE THE FIELDNAME PARAMETER
.*
.FLD1    ANOP  ,
         AIF   ('&FLDNAME' EQ '').ERR1   ERROR IF NO FIELDNAME
         AIF   ('&FLDNAME' NE 'MULTITYP').FEND
&NOENT   SETC  '04'                     MULTITYP HAS 4 ENTRIES
.FEND    ANOP  ,
.*
.*  PARSE THE TYPE PARAMETER
.*
.TYPE1   ANOP  ,
         AIF   (N'&TYPE NE 1).TYPE2      CHECK FOR REQUEST TYPE
         AIF   ('&TYPE' NE 'REQUEST').ERR2
&REQ     SETB  1                         SET REQUEST TYPE FLAG
         AGO   .TEND                    END OF TYPE PARSE
.TYPE2   AIF   (N'&TYPE NE 2).ERR2       CHECK FOR (TEST,COND) TYPE
         AIF   ('&TYPE(1)' NE 'TEST').ERR2
&TST     SETB  1                         SET TEST TYPE FLAG
&I       SETA  1                        SET UP TO SEARCH COND TABLE
.TYPE3   AIF   ('&TYPE(2)' EQ '&CTBL(&I)').TYPE4   FOUND MNEMONIC
&I       SETA  &I+1                     INCREMENT COUNTER
         AIF   (&I GT 9).ERR5            MNEMONIC NOT FOUND => ERROR
         AGO   .TYPE3                   KEEP SEARCHING
.TYPE4   ANOP  ,
&I       SETA  &I+10                    INDEX INTO HEX CODE TABLE
&COND    SETC  '&CTBL(&I)'              SET COND CODE HEX VALUE
.TEND    ANOP  ,
.*
.*  PARSE THE DATA PARAMETER
.*
.DATA1   ANOP  ,
         AIF   ('&DATA' EQ '').DEND      CHECK IF DATA SUPPLIED
         AIF   (N'&DATA NE 2).ERR3       CHECK IF DATA VALID
.DEND    ANOP  ,
.*
.*  PARSE THE MF PARAMETER
.*
.MF1     ANOP  ,
         AIF   (N'&MF NE 1).MF2          CHECK FOR MF=?
         AIF   ('&MF' NE 'L').ERR4       NOT MF=L => ERROR
         AGO   .LFORM1                  PRODUCE LIST FORM OF CTGFL
.MF2     AIF   (N'&MF NE 2).ERR4         MF NOT (?,?) => ERROR
         AIF   ('&MF(1)' NE 'E').ERR4    MF NOT (E,?) => ERROR
         AGO   .EFORM1                  PRODUCE EXECUTE FORM OF CTGFL
.MEND    ANOP  ,
.*
.* GENERATE THE LIST FORM OF THE CTGFL
.*
.LFORM1  ANOP  ,
&NAME    DS    0F                       #CTGFL MACRO JAN 21 1980
         DC    X'&NOENT'                NO OF LEN/ADDR ENTRIES
         AIF   (&TST).LFORM2             FILL IN CONDITION FIELD
         DC    X'00'                    NOT A TEST CTGFL
         AGO   .LFORM3                  CONTINUE WITH CTGFL
.LFORM2  ANOP  ,
         DC    AL1(&COND)               TEST CONDITION
.LFORM3  ANOP  ,
         AIF   ('&GROUP' EQ '').LFORM4   NO GROUP CODE SPECD
         DC    C'&GROUP'                TYPE (GROUP) CODE
         AGO   .LFORM5
.LFORM4  ANOP  ,
         DS    C                        RESERVED
.LFORM5  ANOP  ,
         DS    X                        TEST RESULTS
         DS    XL4                      WORKAREA
         DC    A(&LABEL)                ADDR OF FIELDNAME
         AIF   ('&CHAIN' EQ '').LFORM6   NO CHAIN SPECIFIED
         DC    A(&CHAIN)                ADDR OF CTGFL FOR TESTS
         AGO   .LFORM7
.LFORM6  ANOP  ,
         DS    A                        RESERVED
.LFORM7  ANOP  ,
         AIF   ('&DATA' NE '').LFORM8    NO DATA SPECIFIED
&I       SETA  &NOENT*2                 NUMBER OF WORDS FOR DATA
         DS    &I.A                     LEN/ADDR OF DATA
         AGO   .LFORM9
.LFORM8  DC    A(&DATA(2))              DATA LENGTH
         DC    A(&DATA(1))              DATA ADDRESS
         AIF   ('&NOENT' EQ '01').LFORM9   NOT A MULTITYP CTGFL
         DS    6A                       LEN/ADDR FOR MULTITYP
.LFORM9  ANOP  ,
&LABEL   DC    CL8'&FLDNAME'            NAME OF THE FIELD
         MEXIT ,
.*
.* GENERATE THE EXECUTE FORM OF THE CTGFL MACRO
.*
.EFORM1  ANOP  ,
         PUSH  USING                    #CTGFL MACRO JAN 21 1980
         USING CTGFL,15                 ADDRESS THE CTGFL
         AIF   ('&MF(2)'(1,1) EQ '(').EREGS   TEST IF REG SPECD
&NAME    LA    15,&MF(2)                REG 1 -> CTGFL
         AGO   .EBLD                    GO BUILD PARM LIST
.EREGS   ANOP  ,
&REG     SETC  '&MF(2)'(2,K'&MF(2)-2)   STRIP THE PARENTHESIS
&NAME    LR    15,&REG                  REG 1 -> CTGFL
.EBLD    ANOP  ,
         MVI   CTGFLDNO,X'&NOENT'       NUMBER OF ENTRIES
         AIF   (NOT &TST).EFORM3              NOT BUILDING A TEST CTGFL
         MVI   CTGFLDCD,&COND           TEST CONDITION
.EFORM3  AIF   ('&GROUP' EQ '').EFORM4        NO GROUP CODE SPECIFIED
         MVI   CTGFLDGC,C'&GROUP'       TYPE (GROUP) CODE
.EFORM4  ANOP  ,
         AIF   ('&FLDNAME'(1,1) EQ '(').FLDREG   TEST IF REG SPECD
         LA    0,=CL8'&FLDNAME'         SAVE ADDRESS OF
         ST    0,CTGFLDNM               THE FIELD NAME
         AGO   .ECHAIN
.FLDREG  ANOP  ,
&REG     SETC  '&FLDNAME'(2,K'&FLDNAME-2) STRIP THE PARANTHESIS
         ST    &REG,CTGFLDNM            SAVE FIELD NAME ADDRESS
.ECHAIN  ANOP  ,
         AIF   ('&CHAIN' EQ '').EFORM5        NO CHAIN CTGFL
         AIF   ('&CHAIN'(1,1) EQ '(').ECREG   CHAIN SPECD BY REG
         LA    0,&CHAIN                 SAVE ADDRESS OF
         ST    0,CTGFLCHN               THE CTGFL FOR TESTS
         AGO   .EFORM5
.ECREG   ANOP  ,
&REG     SETC  '&CHAIN'(2,K'&CHAIN-2)   GET RID OF PARENS
         ST    &REG,CTGFLCHN            SET PTR TO CTGFL FOR TEST
.EFORM5  AIF   ('&DATA' EQ '').EFORM7         NO DATA POINTERS
         AIF   ('&DATA(2)'(1,1) EQ '(').EDREG2   LENGTH SPECD BY REG
         LA    0,&DATA(2)               SAVE THE LENGTH
         ST    0,CTGFLNG                OF THE FIELD DATA
         AGO   .EFORM6
.EDREG2  ANOP  ,
&REG     SETC  '&DATA(2)'(2,K'&DATA(2)-2) GET RID OF PARENS
         ST    &REG,CTGFLNG             SET DATA LENGTH
.EFORM6  AIF   ('&DATA(1)'(1,1) EQ '(').EDREG1   ADDR SPECD BY REG
         LA    0,&DATA(1)               SAVE THE ADDRESS
         ST    0,CTGFLPT                OF THE FIELD DATA
         AGO   .EFORM7
.EDREG1  ANOP  ,
&REG     SETC  '&DATA(1)'(2,K'&DATA(1)-2) GET RID OF PARENS
         ST    &REG,CTGFLPT             SET POINTER TO DATA
.EFORM7  ANOP  ,
         POP   USING
         MEXIT ,
.*
.* ERROR MESSAGES ISSUED FROM THIS MACRO
.*
.ERR1    MNOTE 8,'NO FIELD NAME SPECIFIED'
         MEXIT ,
.ERR2    MNOTE 8,'INVALID TYPE PARAMETER'
         MEXIT ,
.ERR3    MNOTE 8,'INVALID DATA PARAMETER'
         MEXIT ,
.ERR4    MNOTE 8,'INVALID MF PARAMETER'
         MEXIT ,
.ERR5    MNOTE 8,'INVALID TEST CONDITION'
         MEND  ,
./ ADD NAME=#CTGFV   0100-00038-00038-1646-00378-00378-00000-MACRO
         MACRO ,
&NAME    #CTGFV &TYPE=,                 CATALOG RECORD TYPE            X
               &OPTIONS=,               CATLG MGMT SERVICES OPTIONS    X
               &NUMBER=,                ELEMENT NUMBER OF CMSPCATR     X
               &DATA=,                  CLUSTERS DATA  CTGFV           X
               &INDEX=,                 CLUSTERS INDEX CTGFV           X
               &VOLUME=,                SPACE CTGFV                    X
               &FILE=,                  ADDRESS OF JCL DD STATEMENT    X
               &ENTRY=,                 ENTRY NAME CTGFL               X
               &SEC=,                   SECURITY INFORMATION CTGFL     X
               &OWNER=,                 OWNER IDENTIFICATION CTGFL     X
               &EXPDT=,                 EXPIRATION DATE CTGFL          X
               &CREDT=,                 CREATION DATE CTGFL            X
               &VOLSER=,                VOLUME SERIAL NUMBER LIST      X
               &KEY=,                   KEY RANGE LIST                 X
               &DEVT=,                  DEVICE TYPE CTGFL              X
               &SPACE=,                 SPACE ALLOCATION CTGFL         X
               &AMDSB=,                 AMDSB CTGFL                    X
               &SEQ=,                   SEQUENCE NUMBER CTGFL          X
               &ATTR=,                  DATASET ATTIBUTES CTGFL        X
               &BUFFSIZ=,               BUFFER SIZE CTGFL              X
               &RECSIZ=,                AVERAGE RECORD SIZE CTGFL      X
               &GDGLIM=,                GDG LIMIT CTGFL                X
               &EXIT=,                  EXCEPTION EXIT PARAMETER LIST  X
               &GDGATTR=,               GDG ATTRIBUTES CTGFL           X
               &TRUENM=,                TRUE NAME CTGFL                X
               &PASSWRD=,                RELATED OBJECT'S PASSWORD     X
               &FEEDBK=,                CRA FEEDBACK AREA              X
               &MF=L                    MACRO FORMAT
.**********************************************************************
         LCLC  &REG
.**********************************************************************
.*  PARSE THE MF PARAMETER                                            *
.**********************************************************************
.MF1     ANOP  ,
         AIF   (N'&MF NE 1).MF2               CHECK FOR MF=?
         AIF   ('&MF' EQ 'L').LFORM1          NOT MF=L => ERROR
.MF2     AIF   (N'&MF NE 2).MFERR             MF NOT (?,?) => ERROR
         AIF   ('&MF(1)' EQ 'E').EFORM1       MF NOT (E,?) => ERROR
.MFERR   ANOP  ,
         MNOTE 8,'INVALID MF PARAMETER' ERROR *  INVALID MF=
         MEXIT ,
.**********************************************************************
.* GENERATE THE LIST FORM OF THE #CTGFV MACRO                         *
.**********************************************************************
.LFORM1  ANOP  ,
         MNOTE 8,'LIST FORM NOT AVAILABLE AT THIS TIME'
         MEXIT ,
.**********************************************************************
.* GENERATE THE EXECUTE FORM OF THE #CTGFV MACRO                      *
.**********************************************************************
.EFORM1  ANOP  ,
         PUSH  USING
         USING CTGFV,15                 ADDRESS THE CTGFV
         AIF   ('&MF(2)'(1,1) EQ '(').EFORM2   CHECK IF REG SPECIFIED
&NAME    LA    15,&MF(2)                >>--> FIELD VECTOR TABLE
         AGO   .TYPE1
.EFORM2  ANOP  ,
&REG     SETC  '&MF(2)'(2,K'&MF(2)-2)   STRIP THE PARENTHESIS
&NAME    LR    15,&REG                  >>--> FIELD VECTOR TABLE
.**********************************************************************
.* UPDATE THE TYPE FIELD                                              *
.**********************************************************************
.TYPE1   ANOP  ,
         AIF   ('&TYPE'(1,1) EQ '(').TYPE2    CHECK IF REG SPECIFIED
         MVI   CTGFVTYP,&TYPE           INSERT RECORD TYPE
         AGO   .OPTION1
.TYPE2   ANOP  ,
&REG     SETC  '&TYPE'(2,K'&TYPE-2)     STRIP THE PARENTHESIS
         STC   &REG,CTGFVTYP            INSERT RECORD TYPE
.**********************************************************************
.* UPDATE THE CATALOG MANAGEMENT SERVICES PROCESSING OPTIONS          *
.**********************************************************************
.OPTION1 ANOP  ,
         AGO   .NUMBER1
.**********************************************************************
.* UPDATE THE ELEMENT NUMBER OF CMSPCATR                              *
.**********************************************************************
.NUMBER1 ANOP  ,
         AIF   ('&NUMBER' EQ '').DATA1        SKIP IF NOT SPECIFIED
         AIF   ('&NUMBER'(1,1) EQ '(').NUMBER2 CHECK IF REG SPECIFIED
         MVI   CTGFVELM,&NUMBER         INSERT ELEMENT NUMBER
         AGO   .DATA1
.NUMBER2 ANOP  ,
&REG     SETC  '&NUMBER'(2,K'&NUMBER-2) STRIP THE PARENTHESIS
         STC   &REG,CTGFVELM            INSERT ELEMENT NUMBER
.**********************************************************************
.* UPDATE THE ADDRESS OF THE CLUSTER'S DATA CTGFV                     *
.**********************************************************************
.DATA1   ANOP  ,
         AIF   ('&DATA' EQ '').INDEX1         SKIP IF NOT SPECIFIED
         AIF   ('&DATA'(1,1) EQ '(').DATA2    CHECK IF REG SPECIFIED
         LA    R0,&DATA                 SAVE ADDRESS OF THE
         ST    R0,CTGFVDCH              CLUSTER'S DATA CTGFV
         AGO   .INDEX1
.DATA2   ANOP  ,
&REG     SETC  '&DATA'(2,K'&DATA-2)     STRIP THE PARENTHESIS
         ST    &REG,CTGFVDCH            SAVE DATA PORTION CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE CLUSTER'S INDEX CTGFV                    *
.**********************************************************************
.INDEX1  ANOP  ,
         AIF   ('&INDEX' EQ '').VOLUME1       SKIP IF NOT SPECIFIED
         AIF   ('&INDEX'(1,1) EQ '(').INDEX2   CHECK IF REG SPECIFIED
         LA    R0,&INDEX                SAVE ADDRESS OF THE
         ST    R0,CTGFVICH              CLUSTER'S INDEX CTGFV
         AGO   .VOLUME1
.INDEX2  ANOP  ,
&REG     SETC  '&INDEX'(2,K'&INDEX-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVICH            SAVE INDEX PORTION CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE SPACE CTGFV                              *
.**********************************************************************
.VOLUME1 ANOP  ,
         AIF   ('&VOLUME' EQ '').FILE1        SKIP IF NOT SPECIFIED
         AIF   ('&VOLUME'(1,1) EQ '(').VOLUME2   CHECK IF REG SPECIFIED
         LA    R0,&VOLUME               SAVE ADDRESS OF THE
         ST    R0,CTGFVVCH              SPACE CTGFV
         AGO   .FILE1
.VOLUME2 ANOP  ,
&REG     SETC  '&VOLUME'(2,K'&VOLUME-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVVCH            SAVE SPACE CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE ASSOCIATED JCL DD STATEMENT              *
.**********************************************************************
.FILE1   ANOP  ,
         AIF   ('&FILE' EQ '').ENTRY1         SKIP IF NOT SPECIFIED
         AIF   ('&FILE'(1,1) EQ '(').FILE2    CHECK IF REG SPECIFIED
         LA    R0,&FILE                 SAVE ADDRESS OF THE
         ST    R0,CTGFVIND              JCL DD STATEMENT
         AGO   .ENTRY1
.FILE2   ANOP  ,
&REG     SETC  '&FILE'(2,K'&FILE-2)     STRIP THE PARENTHESIS
         ST    &REG,CTGFVIND            SAVE JCL DD STMT ADDR
.**********************************************************************
.* UPDATE THE ADDRESS OF THE ENTRY NAME CTGFL                         *
.**********************************************************************
.ENTRY1  ANOP  ,
         AIF   ('&ENTRY' EQ '').SECUR1        SKIP IF NOT SPECIFIED
         AIF   ('&ENTRY'(1,1) EQ '(').ENTRY2   CHECK IF REG SPECIFIED
         LA    R0,&ENTRY                SAVE ADDRESS OF THE
         ST    R0,CTGFVENT              ENTRY NAME CTGFL
         AGO   .SECUR1
.ENTRY2  ANOP  ,
&REG     SETC  '&ENTRY'(2,K'&ENTRY-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVENT            SAVE ENTRY NAME CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE SECURITY INFORMATION CTGFL               *
.**********************************************************************
.SECUR1  ANOP  ,
         AIF   ('&SEC' EQ '').OWNER1          SKIP IF NOT SPECIFIED
         AIF   ('&SEC'(1,1) EQ '(').SECUR2    CHECK IF REG SPECIFIED
         LA    R0,&SEC                  SAVE ADDRESS OF THE
         ST    R0,CTGFVSTY              SECURITY INFO CTGFL
         AGO   .OWNER1
.SECUR2  ANOP  ,
&REG     SETC  '&SEC'(2,K'&SEC-2)       STRIP THE PARENTHESIS
         ST    &REG,CTGFVSTY            SAVE SECURITY CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE OWNER IDENTIFICATION CTGFL               *
.**********************************************************************
.OWNER1  ANOP  ,
         AIF   ('&OWNER' EQ '').EXPDT1        SKIP IF NOT SPECIFIED
         AIF   ('&OWNER'(1,1) EQ '(').OWNER2   CHECK IF REG SPECIFIED
         LA    R0,&OWNER                SAVE ADDRESS OF THE
         ST    R0,CTGFVOWN              OWNER IDENT CTGFL
         AGO   .EXPDT1
.OWNER2  ANOP  ,
&REG     SETC  '&OWNER'(2,K'&OWNER-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVOWN            SAVE SECURITY CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE EXPIRATION DATE CTGFL                    *
.**********************************************************************
.EXPDT1  ANOP  ,
         AIF   ('&EXPDT' EQ '').CREDT1        SKIP IF NOT SPECIFIED
         AIF   ('&EXPDT'(1,1) EQ '(').EXPDT2   CHECK IF REG SPECIFIED
         LA    R0,&EXPDT                SAVE ADDRESS OF THE
         ST    R0,CTGFVEXP              EXPIRY DATE CTGFL
         AGO   .CREDT1
.EXPDT2  ANOP  ,
&REG     SETC  '&EXPDT'(2,K'&EXPDT-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVEXP            SAVE EXPIRY DATE CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE CREATION DATE CTGFL                      *
.**********************************************************************
.CREDT1  ANOP  ,
         AIF   ('&CREDT' EQ '').VOLSER1       SKIP IF NOT SPECIFIED
         AIF   ('&CREDT'(1,1) EQ '(').CREDT2   CHECK IF REG SPECIFIED
         LA    R0,&CREDT                SAVE ADDRESS OF THE
         ST    R0,CTGFVCRE              CREATE DATE CTGFL
         AGO   .VOLSER1
.CREDT2  ANOP  ,
&REG     SETC  '&CREDT'(2,K'&CREDT-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVCRE            SAVE CREATE DATE CTGFV
.**********************************************************************
.* UPDATE THE ADDRESS OF THE VOLUME SERIAL NUMBER LIST                *
.**********************************************************************
.VOLSER1 ANOP  ,
         AIF   ('&VOLSER' EQ '').KEY1         SKIP IF NOT SPECIFIED
         AIF   ('&VOLSER'(1,1) EQ '(').VOLSER2   CHECK IF REG SPECIFIED
         LA    R0,&VOLSER               SAVE ADDRESS OF THE
         ST    R0,CTGFVVLT              VOLUME SERIAL LIST
         AGO   .KEY1
.VOLSER2 ANOP  ,
&REG     SETC  '&VOLSER'(2,K'&VOLSER-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVVLT            SAVE VOLUME SERIAL LIST
.**********************************************************************
.* UPDATE THE ADDRESS OF THE KEY RANGE LIST                           *
.**********************************************************************
.KEY1    ANOP  ,
         AIF   ('&KEY' EQ '').DEVT1           SKIP IF NOT SPECIFIED
         AIF   ('&KEY'(1,1) EQ '(').KEY2      CHECK IF REG SPECIFIED
         LA    R0,&KEY                  SAVE ADDRESS OF THE
         ST    R0,CTGFVRNG              KEY RANGE LIST
         AGO   .DEVT1
.KEY2    ANOP  ,
&REG     SETC  '&KEY'(2,K'&KEY-2)       STRIP THE PARENTHESIS
         ST    &REG,CTGFVRNG            SAVE KEY RANGE LIST
.**********************************************************************
.* UPDATE THE ADDRESS OF THE DEVICE TYPE CTGFL                        *
.**********************************************************************
.DEVT1   ANOP  ,
         AIF   ('&DEVT' EQ '').SPACE1         SKIP IF NOT SPECIFIED
         AIF   ('&DEVT'(1,1) EQ '(').DEVT2    CHECK IF REG SPECIFIED
         LA    R0,&DEVT                 SAVE ADDRESS OF THE
         ST    R0,CTGFVDVT              DEVICE TYPE CTGFL
         AGO   .SPACE1
.DEVT2   ANOP  ,
&REG     SETC  '&DEVT'(2,K'&DEVT-2)     STRIP THE PARENTHESIS
         ST    &REG,CTGFVRNG            SAVE DEVICE TYPE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE SPACE ALLOCATION INFORMATION CTGFL       *
.**********************************************************************
.SPACE1  ANOP  ,
         AIF   ('&SPACE' EQ '').AMDSB1        SKIP IF NOT SPECIFIED
         AIF   ('&SPACE'(1,1) EQ '(').SPACE2   CHECK IF REG SPECIFIED
         LA    R0,&SPACE                SAVE ADDRESS OF THE
         ST    R0,CTGFVSPC              SPACE ALLOCATION CTGFL
         AGO   .AMDSB1
.SPACE2  ANOP  ,
&REG     SETC  '&SPACE'(2,K'&SPACE-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVSPC            SAVE DEVICE TYPE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE AMDSB CTGFL                              *
.**********************************************************************
.AMDSB1  ANOP  ,
         AIF   ('&AMDSB' EQ '').SEQ1          SKIP IF NOT SPECIFIED
         AIF   ('&AMDSB'(1,1) EQ '(').AMDSB2   CHECK IF REG SPECIFIED
         LA    R0,&AMDSB                SAVE ADDRESS OF THE
         ST    R0,CTGFVAMD              AMDSB CTGFL
         AGO   .SEQ1
.AMDSB2  ANOP  ,
&REG     SETC  '&AMDSB'(2,K'&AMDSB-2)   STRIP THE PARENTHESIS
         ST    &REG,CTGFVAMD            SAVE AMDSB CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE FILE SEQUENCER NUMBER CTGFL              *
.**********************************************************************
.SEQ1    ANOP  ,
         AIF   ('&SEQ' EQ '').ATTR1           SKIP IF NOT SPECIFIED
         AIF   ('&SEQ'(1,1) EQ '(').SEQ2      CHECK IF REG SPECIFIED
         LA    R0,&SEQ                  SAVE ADDRESS OF THE
         ST    R0,CTGFVFSN              FILE SEQUENCE CTGFL
         AGO   .ATTR1
.SEQ2    ANOP  ,
&REG     SETC  '&SEQ'(2,K'&SEQ-2)       STRIP THE PARENTHESIS
         ST    &REG,CTGFVFSN            SAVE FILE SEQUENCE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE DATA SET ATTRIBUTES CTGFL                *
.**********************************************************************
.ATTR1   ANOP  ,
         AIF   ('&ATTR' EQ '').BUFFER1        SKIP IF NOT SPECIFIED
         AIF   ('&ATTR'(1,1) EQ '(').ATTR2    CHECK IF REG SPECIFIED
         LA    R0,&ATTR                 SAVE ADDRESS OF THE
         ST    R0,CTGFVATR              DSN ATTRIBUTE CTGFL
         AGO   .BUFFER1
.ATTR2   ANOP  ,
&REG     SETC  '&ATTR'(2,K'&ATTR-2)     STRIP THE PARENTHESIS
         ST    &REG,CTGFVATR            SAVE DSN ATTRIBUTE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE BUFFER SIZE CTGFL                        *
.**********************************************************************
.BUFFER1 ANOP  ,
         AIF   ('&BUFFSIZ' EQ '').RECLEN1     SKIP IF NOT SPECIFIED
         AIF   ('&BUFFSIZ'(1,1) EQ '(').BUFFER2   CHECK IF REG SPEC
         LA    R0,&BUFFSIZ              SAVE ADDRESS OF THE
         ST    R0,CTGFVBUF              FILE BUFFER SIZE CTGFL
         AGO   .RECLEN1
.BUFFER2 ANOP  ,
&REG     SETC  '&BUFFSIZ'(2,K'&BUFFSIZ-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVBUF            SAVE BUFFER SIZE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE AVERAGE RECORD SIZE CTGFL                *
.**********************************************************************
.RECLEN1 ANOP  ,
         AIF   ('&RECSIZ' EQ '').GDGLIM1      SKIP IF NOT SPECIFIED
         AIF   ('&RECSIZ'(1,1) EQ '(').RECLEN2   CHECK IF REG SPECIFIED
         LA    R0,&RECSIZ               SAVE ADDRESS OF THE
         ST    R0,CTGFVLRS              AVERAGE REC SIZE CTGFL
         AGO   .GDGLIM1
.RECLEN2 ANOP  ,
&REG     SETC  '&RECSIZ'(2,K'&RECSIZ-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVLRS            SAVE AVG REC SIZE CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE GDG LIMIT CTGFL                          *
.**********************************************************************
.GDGLIM1 ANOP  ,
         AIF   ('&GDGLIM' EQ '').EXIT1        SKIP IF NOT SPECIFIED
         AIF   ('&GDGLIM'(1,1) EQ '(').GDGLIM2   CHECK IF REG SPECIFIED
         LA    R0,&GDGLIM               SAVE ADDRESS OF THE
         ST    R0,CTGFVLMT              GDG LIMIT CTGFL
         AGO   .EXIT1
.GDGLIM2 ANOP  ,
&REG     SETC  '&GDGLIM'(2,K'&GDGLIM-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVLMT            SAVE GDG LIMIT CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE EXCEPTION EXIT PARAMETER LIST            *
.**********************************************************************
.EXIT1   ANOP  ,
         AIF   ('&EXIT' EQ '').GDGATT1        SKIP IF NOT SPECIFIED
         AIF   ('&EXIT'(1,1) EQ '(').EXIT2    CHECK IF REG SPECIFIED
         LA    R0,&EXIT                 SAVE ADDRESS OF THE
         ST    R0,CTGFVEXT              GDG LIMIT CTGFL
         AGO   .GDGATT1
.EXIT2   ANOP  ,
&REG     SETC  '&EXIT'(2,K'&EXIT-2)     STRIP THE PARENTHESIS
         ST    &REG,CTGFVEXT            SAVE GDG LIMIT CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE GDG ATTIBUTES CTGFL                      *
.**********************************************************************
.GDGATT1 ANOP  ,
         AIF   ('&GDGATTR' EQ '').RELATE1     SKIP IF NOT SPECIFIED
         AIF   ('&GDGATTR'(1,1) EQ '(').GDGATT2   CHECK IF REG SPEC
         LA    R0,&GDGATTR              SAVE ADDRESS OF THE
         ST    R0,CTGFVGAT              GDG ATTRIB CTGFL
         AGO   .RELATE1
.GDGATT2 ANOP  ,
&REG     SETC  '&GDGATTR'(2,K'&GDGATTR-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVGAT            SAVE GDG ATTR CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE TRUE NAME CTGFL                          *
.**********************************************************************
.RELATE1 ANOP  ,
         AIF   ('&TRUENM' EQ '').PASS1        SKIP IF NOT SPECIFIED
         AIF   ('&TRUENM'(1,1) EQ '(').RELATE2   CHECK IF REG SPEC
         LA    R0,&TRUENM               SAVE ADDRESS OF THE
         ST    R0,CTGFVNAM              TRUE NAME CTGFL
         AGO   .PASS1
.RELATE2 ANOP  ,
&REG     SETC  '&TRUENM'(2,K'&TRUENM-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVNAM            SAVE TRUE NAME CTGFL
.**********************************************************************
.* UPDATE THE ADDRESS OF THE RELATED OBJECT'S PASSWORD                *
.**********************************************************************
.PASS1   ANOP  ,
         AIF   ('&PASSWRD' EQ '').FEEDBK1     SKIP IF NOT SPECIFIED
         AIF   ('&PASSWRD'(1,1) EQ '(').PASS2   CHECK IF REG SPEC
         LA    R0,&PASSWRD              SAVE ADDRESS OF THE
         ST    R0,CTGFVPWD              RELATED OBJECTS PASSWORD
         AGO   .FEEDBK1
.PASS2   ANOP  ,
&REG     SETC  '&PASSWRD'(2,K'&PASSWRD-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVPWD            SAVE PASSWORD ADDRESS
.**********************************************************************
.* UPDATE THE ADDRESS OF THE CRA FEEDBACK AREA                        *
.**********************************************************************
.FEEDBK1 ANOP  ,
         AIF   ('&FEEDBK' EQ '').MEXIT        SKIP IF NOT SPECIFIED
         AIF   ('&FEEDBK'(1,1) EQ '(').FEEDBK2   CHECK IF REG SPEC
         LA    R0,&FEEDBK               SAVE ADDRESS OF THE
         ST    R0,CTGFVWKA              CRA FEEDBACK AREA
         AGO   .MEXIT
.FEEDBK2 ANOP  ,
&REG     SETC  '&FEEDBK'(2,K'&FEEDBK-2) STRIP THE PARENTHESIS
         ST    &REG,CTGFVWKA            SAVE CRA FEEDBACK ADDR
.**********************************************************************
.MEXIT   ANOP  ,
         POP   USING
         MEND  ,
./ ADD NAME=#CTGPL   0100-00038-00038-1646-00528-00528-00000-MACRO
         MACRO ,
&NAME    #CTGPL &FUNC,                  USER REQUESTED FUNCTION        X
               &WORK=,                  ADDR OF WORKAREA               X
               &FIELDS=,                LIST OF CTGFL ADDRESSES        X
               &CRI=,                   ADDR OF CTLG REC IDENTIFIER    X
               &FV=,                    ADDR OF CTGFV                  X
               &CATALOG=,               ADDR OF CATALOG NAME OR ACB    X
               &CVOL=,                  ADDR OF CVVOL NAME             X
               &TYPE=,                  TYPE OF CATALOG RECORD REF'D   X
               &NEWNAME=,               ADDR OF NEW OBJECT NAME        X
               &DDNAME=,                ADDR OF JCL DD ASSOC WITH REQ  X
               &JSCB=,                  ADDR OF JSCB                   X
               &PASSWRD=,               ADDR OF USER SUPPLIED PASSWD   X
               &OPTIONS=,               LIST OF OPTIONS REQUESTED      X
               &DSORG=,                 DATASET ORG. FOR SUPERLOCATE   X
               &MF=L                    MACRO FORMAT (DEFAULT=LIST)
.**********************************************************************
.*                                                                    *
.* DEFINE LOCAL SET SYMBOLS                                           *
.*                                                                    *
.**********************************************************************
         LCLB  &O(32)                   FOUR OPTION BYTES
         LCLC  &OMN(44)                 OPTION MNEMONICS
         LCLA  &OBI(44)                 OPTION BIT
         LCLA  &I,&J,&K,&L              LOOP COUNTERS
         LCLC  &BYTE                    WORK STORAGE
         LCLB  &CMS                     CMS OPTIONS REQUESTED
         LCLC  &OPTN                    CMS OPTION BIT STRING
         LCLC  &REG                     REGISTER OPERAND
         LCLC  &WRKAREA                 WORKAREA POINTER
         LCLC  &WRKLEN                  WORKAREA LENGTH
         LCLC  &WRKFMT2                 FORMAT2 WORKAREA
.*
&OMN(1)  SETC  'BYPSS'                  --+
&OMN(2)  SETC  'MAST'
&OMN(3)  SETC  'CI'
&OMN(4)  SETC  'UPD'
&OMN(5)  SETC  'READ'
&OMN(6)  SETC  'NAME'
&OMN(7)  SETC  'CNAME'
&OMN(8)  SETC  'GENLD'
&OMN(9)  SETC  'EXT'
&OMN(10) SETC  'NSVS'                   DEFINE A TABLE OF
&OMN(11) SETC  'ERASE'                  VALID OPTIONS
&OMN(12) SETC  'SMF'
&OMN(13) SETC  'REL'
&OMN(14) SETC  'GTALL'
&OMN(15) SETC  'PURG'
&OMN(16) SETC  'VMNT'
&OMN(17) SETC  'RCATN'
&OMN(18) SETC  'GTNXT'
&OMN(19) SETC  'UCRAX'
&OMN(20) SETC  'DELRC'
&OMN(21) SETC  'DISC'
&OMN(22) SETC  'OVRID'
&OMN(23) SETC  'CNVTC'
&OMN(24) SETC  'SCR'
&OMN(25) SETC  'BOTH'
&OMN(26) SETC  'SUPLT'
&OMN(27) SETC  'GDGL'
&OMN(28) SETC  'SRH'
&OMN(29) SETC  'NUM'
&OMN(30) SETC  'AM0'
&OMN(31) SETC  'LBASE'
&OMN(32) SETC  'NODOCAT'
&OMN(33) SETC  'NPROF'
&OMN(34) SETC  'COIN'
&OMN(35) SETC  'BYPMT'
&OMN(36) SETC  'TIOT'
&OMN(37) SETC  'ICFC'
&OMN(38) SETC  'ICFOR'
&OMN(39) SETC  'GFLIC'
&OMN(40) SETC  'SWAP'
&OMN(41) SETC  'RESM'
&OMN(42) SETC  'CDI'
&OMN(43) SETC  'NDISC'
&OMN(44) SETC  'NOCON'                  --+
.*
&OBI(1)  SETA  1                        --+
&OBI(2)  SETA  2
&OBI(3)  SETA  3
&OBI(4)  SETA  4
&OBI(5)  SETA  5
&OBI(6)  SETA  6
&OBI(7)  SETA  7
&OBI(8)  SETA  8
&OBI(9)  SETA  9                        DEFINE THE TABLE OF BIT
&OBI(10) SETA  9                        POSITIONS CORRESPONDING
&OBI(11) SETA  10                       TO THE OPTIONS
&OBI(12) SETA  10
&OBI(13) SETA  10
&OBI(14) SETA  10
&OBI(15) SETA  11
&OBI(16) SETA  11
&OBI(17) SETA  11
&OBI(18) SETA  12
&OBI(19) SETA  12
&OBI(20) SETA  12
&OBI(21) SETA  13
&OBI(22) SETA  14
&OBI(23) SETA  14
&OBI(24) SETA  15
&OBI(25) SETA  16
&OBI(26) SETA  20
&OBI(27) SETA  21
&OBI(28) SETA  22
&OBI(29) SETA  23
&OBI(30) SETA  24
&OBI(31) SETA  25
&OBI(32) SETA  26
&OBI(33) SETA  27
&OBI(34) SETA  28
&OBI(35) SETA  29
&OBI(36) SETA  30
&OBI(37) SETA  31
&OBI(38) SETA  32
&OBI(39) SETA  10
&OBI(40) SETA  11
&OBI(41) SETA  13
&OBI(42) SETA  15
&OBI(43) SETA  25
&OBI(44) SETA  25                       --+
.*
.**********************************************************************
.*                                                                    *
.* PARSE THE FUNCTION PARAMETER                                       *
.*                                                                    *
.**********************************************************************
.FUNC1   ANOP  ,                        START OF FUNCTION PARSE
         AIF   ('&FUNC' EQ 'LOCATE').FLOC     GO SET LOCATE BITS
         AIF   ('&FUNC' EQ 'LSPACE').FLSP     GO SET LSPACE BITS
         AIF   ('&FUNC' EQ 'UPDATE').FUPD     GO SET UPDATE BITS
         AIF   ('&FUNC' EQ 'DEFINE').FDEF     GO SET DEFINE BITS
         AIF   ('&FUNC' EQ 'ALTER').FALT      GO SET ALTER BITS
         AIF   ('&FUNC' EQ 'DELETE').FDEL     GO SET DELETE BITS
         AIF   ('&FUNC' EQ 'LISTCAT').FLCT    GO SET LISTCAT BITS
         AIF   ('&FUNC' EQ 'CONVERT').FCON    GO SET CONVERTV BITS
         AIF   ('&FUNC' EQ 'GFL').FGFL        GO SET GFL BITS
         AGO   .ERR1                    INVALID FUNCTION
.FLOC    ANOP  ,
&O(17)   SETB  0                              SET OPTION BITS
&O(18)   SETB  0                              ON FOR THE
&O(19)   SETB  1                              LOCATE FUNCTION
         AGO   .FEND
.FLSP    ANOP  ,
&O(17)   SETB  0                              SET OPTION BITS
&O(18)   SETB  1                              ON FOR THE
&O(19)   SETB  0                              LSPACE FUNCTION
         AGO   .FEND
.FUPD    ANOP  ,
&O(17)   SETB  0                              SET OPTION BITS
&O(18)   SETB  1                              ON FOR THE
&O(19)   SETB  1                              UPDATE FUNCTION
         AGO   .FEND
.FGFL    ANOP  ,
&O(17)   SETB  1                              SET OPTION BITS
&O(18)   SETB  0                              ON FOR THE
&O(19)   SETB  1                              GFL FUNCTION
         AGO   .FEND
.FDEF    ANOP  ,
&OPTN    SETC  '00001000'               SET CMS OPTIONS FOR DEFINE
         AGO   .FCMS
.FALT    ANOP  ,
&OPTN    SETC  '00100000'               SET CMS OPTIONS FOR ALTER
         AGO   .FCMS
.FDEL    ANOP  ,
&OPTN    SETC  '00011000'               SET CMS OPTIONS FOR DELETE
         AGO   .FCMS
.FLCT    ANOP  ,
&OPTN    SETC  '00100000'               SET CMS OPTIONS FOR LISTCAT
         AGO   .FCMS
.FCON    ANOP  ,
&OPTN    SETC  '00110000'               SET CMS OPTIONS FOR CONVERTV
         AGO   .FCMS
.FCMS    ANOP  ,
&O(17)   SETB  1                         SET OPTION BITS
&O(18)   SETB  0                         FOR CMS TYPE
&O(19)   SETB  0                         REQUEST
&CMS     SETB  1                         SET CMS FLAG
.FEND    ANOP  ,
.**********************************************************************
.*                                                                    *
.* CHECK FOR WORKAREA PARAMETER                                       *
.*                                                                    *
.**********************************************************************
.WORK1   ANOP  ,
         AIF   ('&WORK' EQ '').ERR2      NO WORKAREA SPECD ERROR
&WRKAREA SETC  '&WORK(1)'               SETUP WORKAREA POINTER
&WRKLEN  SETC  '&WORK(2)'               SETUP WORKAREA LENGTH
&WRKFMT2 SETC  '&WORK(3)'               SET FORMAT 2 WORKAREA FLAG
         AIF   ('&WRKFMT2' EQ '').MUT1   CHECK FOR FORMAT2 WORKAREA
         AIF   ('&WRKFMT2' NE 'FORMAT2').ERR3
&OPTN    SETC  '00000100'               SET FORMAT-2 WORKAREA FLAG
&CMS     SETB  1                         SET CMS FLAG
.**********************************************************************
.*                                                                    *
.* CHECK FOR THE VARIOUS MUTUALLY EXCLUSIVE PARAMETERS                *
.*                                                                    *
.**********************************************************************
.MUT1    ANOP  ,
         AIF   (('&CRI' NE '') AND ('&FV' NE '')).ERR4
         AIF   (('&CATALOG' NE '') AND ('&CVOL' NE '')).ERR4
         AIF   (('&NEWNAME' NE '') AND ('&DDNAME' NE '')).ERR4
         AIF   (('&JSCB' NE '') AND ('&PASSWRD' NE '')).ERR4
.**********************************************************************
.*                                                                    *
.* CHECK THE OPTIONS PARAMETER LIST                                   *
.*                                                                    *
.**********************************************************************
.OPT1    ANOP  ,                        START OF OPTION PARSE
&O(24)   SETB  1                        CTGAM0 ALWAYS ON FOR CTGPL
&I       SETA  0                        INIT I TO LOOP THRU OPTIONS
.OSCAN   ANOP  ,
         AIF   (&I GE N'&OPTIONS).OEND   FINISHED ALL OPTIONS
&I       SETA  &I+1                     INCREMENT I
&J       SETA  0                        INIT J TO LOOP THRU OPTS LIST
.OSRCH   ANOP  ,
         AIF   (&J GT 44).ONFND          OPT SPECD NOT FOUND IN LIST
&J       SETA  &J+1                     INCREMENT J
         AIF   ('&OMN(&J)' NE '&OPTIONS(&I)').OSRCH   KEEP SEARCHING
&K       SETA  &OBI(&J)                 SET K TO BIT POSITION OF OPT
&O(&K)   SETB   1                        SET OPTION BYTE AT K
         AIF   ('&OMN(&J)' NE 'SUPLT').OSCAN   CHECK FOR SUPERLOCATE
&O(17)   SETB  0                              RESET CMS FLAG
         AIF   ('&WRKFMT2' NE '').OSCAN       CHECK FOR FMT2 WRKAREA
&CMS     SETB  0                              RESET CMS FLAG
         AGO   .OSCAN                   GO GET NEXT SPECD OPTION
.ONFND   ANOP  ,
         MNOTE 4,'INVALID OPTION, &OPTIONS(&I)' WARN USER ABOUT OPT
         AGO   .OSCAN                   GO GET NEXT SPECD OPTION
.OEND    ANOP  ,
.**********************************************************************
.*                                                                    *
.* PARSE THE MF PARAMETER                                             *
.*                                                                    *
.**********************************************************************
.MF1     ANOP  ,
         AIF   (N'&MF NE 1).MF2          CHECK FOR ONLY 1 PARM
         AIF   ('&MF' NE 'L').ERR5       IF SO IT MUST BE LIST FORM
         AGO   .LFORM1
.MF2     ANOP  ,
         AIF   (N'&MF NE 2).ERR5         CHECK FOR TWO PARMS
         AIF   ('&MF(1)' NE 'E').ERR5    IF SO MUST BE EXECUTE FORM
         AGO   .EFORM1
.**********************************************************************
.*                                                                    *
.*             GENERATE THE LIST FORM OF THE MACRO                    *
.*                                                                    *
.**********************************************************************
.LFORM1  ANOP  START                    OF LIST FORM OF MACRO
.**********************************************************************
.*                                                                    *
.* PARSE THE FIELDS PARAMETER                                         *
.*                                                                    *
.**********************************************************************
.FLD1    ANOP  ,
&NAME    DS    0F
&BYTE    SETC  '&O(1)&O(2)&O(3)&O(4)&O(5)&O(6)&O(7)&O(8)'
         DC    B'&BYTE'                 FIRST  OPTION BYTE
&BYTE    SETC  '&O(9)&O(10)&O(11)&O(12)&O(13)&O(14)&O(15)&O(16)'
         DC    B'&BYTE'                 SECOND OPTION BYTE
&BYTE    SETC  '&O(17)&O(18)&O(19)&O(20)&O(21)&O(22)&O(23)&O(24)'
         DC    B'&BYTE'                 THIRD  OPTION BYTE
&BYTE    SETC  '&O(25)&O(26)&O(27)&O(28)&O(29)&O(30)&O(31)&O(32)'
         DC    B'&BYTE'                 FOURTH OPTION BYTE
         AIF   ('&CRI' EQ '').LFORM2     NO CRI SPECIFIED
         DC    A(&CRI)                  CTLG REC IDENTIFIER
         AGO   .LFORM4
.LFORM2  ANOP  ,
         AIF   ('&FV' EQ '').LFORM3      NO FV SUPPLIED
         DC    A(&FV)                   ADDR OF CTGFV
         AGO   .LFORM4
.LFORM3  ANOP  ,
         DS    A                        RESERVED
.LFORM4  ANOP  ,
         AIF   ('&CATALOG' EQ '').LFORM5      NO CATALOG SPECIFIED
         DC    A(&CATALOG)              ADDR OF CTLG NAME / ACB
         AGO   .LFORM7
.LFORM5  ANOP  ,
         AIF   ('&CVOL' EQ '').LFORM6    NO CVOL SPECIFIED
         DC    A(&CVOL)                 ADDR OF CVOL NAME
         AGO   .LFORM7
.LFORM6  ANOP  ,
         DS    A                        RESERVED
.LFORM7  ANOP  ,
         DC    A(&WRKAREA)              ADDR OF WORKAREA
         AIF   (NOT &CMS).LFORM8         CMS => OPTION HERE
         DC    B'&OPTN'                 CMS OPTION BYTE
         DS    X                        RESERVED
         AGO   .LFORM10
.LFORM8  ANOP  ,
         AIF   ('&DSORG' EQ '').LFORM9   SUPERLOCATE DSORG ?
         DC    CL2'&DSORG'              DSORG FOR SUPERLOCATE
         AGO   .LFORM10
.LFORM9  ANOP  ,
         DS    CL2                      RESERVED
.LFORM10 ANOP  ,
         AIF   ('&TYPE' EQ '').LFORM11   NO RECORD TYPE SPECIFIED
         DC    CL1'&TYPE'               CATALOG RECORD TYPE
         AGO   .LFORM12
.LFORM11 ANOP  ,
         DS    CL1                      RESERVED
.LFORM12 ANOP  ,
&I       SETA  N'&FIELDS                GET NUMBER OF FIELDS
         DC    AL1(&I)                  NO OF CTGFL ENTRIES
         AIF   ('&DDNAME' EQ '').LFORM13   NO DDNAME ADDR SPECIFIED
         DC    A(&DDNAME)               ADDRESS OF DD NAME
         AGO   .LFORM15
.LFORM13 ANOP  ,
         AIF   ('&NEWNAME' EQ '').LFORM14     NO NEWNAME ADDR SPECIFIED
         DC    A(&NEWNAME)              ADDR OF NEW NAME FOR OBJ
         AGO   .LFORM15
.LFORM14 ANOP  ,
         DS    A                        RESERVED
.LFORM15 ANOP  ,
         AIF   ('&JSCB' EQ '').LFORM16   NO JSCB ADDR SPECIFIED
         DC    A(&JSCB)                 ADDR OF JSCB
         AGO   .LFORM18
.LFORM16 ANOP  ,
         AIF   ('&PASSWRD' EQ '').LFORM17   NO PASSWORD ADDR GIVEN
         DC    A(&PASSWRD)              ADDR OF PASSWORD
         AGO   .LFORM18
.LFORM17 ANOP  ,
         DS    A                        RESERVED
.LFORM18 ANOP  ,
&I       SETA  1                        INIT FOR LOOP THRU CTGFLS
.LFORM19 ANOP  ,
         AIF   (N'&FIELDS EQ 0).LFORM20    LEAVE AFTER ALL CTGFLS DONE
         AIF   (&I GT N'&FIELDS).LFORM20   LEAVE AFTER ALL CTGFLS DONE
         DC    A(&FIELDS(&I))           ADDR OF CTGFL
&I       SETA  &I+1                     INCREMENT I
         AGO   .LFORM19
.LFORM20 ANOP  ,
         MEXIT ,
.**********************************************************************
.*                                                                    *
.* DEFINE THE EXECUTE FORM OF THE MACRO                               *
.*                                                                    *
.**********************************************************************
.EFORM1  ANOP  ,
         PUSH  USING
         USING CTGPL,15                 ADDRESS THE CTGPL
         AIF   ('&MF(2)'(1,1) EQ '(').EREGS   TEST IF REG SPECD
&NAME    LA    15,&MF(2)                REG 15 -> CTGPL
         AGO   .EBLD                    GO BUILD PARM LIST
.EREGS   ANOP  ,
&REG     SETC  '&MF(2)'(2,K'&MF(2)-2)   STRIP THE PARENTHESIS
&NAME    LR    15,&REG                  REG 15 -> CTGPL
.EBLD    ANOP  ,
&BYTE    SETC  '&O(1)&O(2)&O(3)&O(4)&O(5)&O(6)&O(7)&O(8)'
         MVI   CTGOPTN1,B'&BYTE'        FIRST  OPTION BYTE
&BYTE    SETC  '&O(9)&O(10)&O(11)&O(12)&O(13)&O(14)&O(15)&O(16)'
         MVI   CTGOPTN2,B'&BYTE'        SECOND OPTION BYTE
&BYTE    SETC  '&O(17)&O(18)&O(19)&O(20)&O(21)&O(22)&O(23)&O(24)'
         MVI   CTGOPTN3,B'&BYTE'        THIRD  OPTION BYTE
&BYTE    SETC  '&O(25)&O(26)&O(27)&O(28)&O(29)&O(30)&O(31)&O(32)'
         MVI   CTGOPTN4,B'&BYTE'        FOURTH OPTION BYTE
         AIF   ('&CRI' EQ '').EFORM2     NO CRI SPECIFIED
         AIF   ('&CRI'(1,1) EQ '(').ECRIR   CHECK FOR REGS SPECD
         LA    0,&CRI                   SAVE CTLG REC IDENTIFIER
         ST    0,CTGENT
         AGO   .EFORM2
.ECRIR   ANOP  ,
&REG     SETC  '&CRI'(2,K'&CRI-2)       STRIP PARENS
         ST    &REG,CTGENT              SAVE CTLG REC IDENTIFIER
.EFORM2  ANOP  ,
         AIF   ('&FV' EQ '').EFORM3      NO FV SUPPLIED
         AIF   ('&FV'(1,1) EQ '(').EFVR       CHECK FOR REGS SPECD
         LA    0,&FV                    SAVE CTGFV POINTER
         ST    0,CTGFVT
         AGO   .EFORM3
.EFVR    ANOP  ,
&REG     SETC  '&FV'(2,K'&FV-2)         STRIP PARENS
         ST    &REG,CTGFVT              SAVE CTGFV POINTER
.EFORM3  ANOP  ,
         AIF   ('&CATALOG' EQ '').EFORM5      NO CATALOG SPECIFIED
         AIF   ('&CATALOG'(1,1) EQ '(').ECATR   CHECK FOR REGS SPECD
         LA    0,&CATALOG               SAVE CTLG NAME POINTER
         ST    0,CTGCAT
         AGO   .EFORM6
.ECATR   ANOP  ,
&REG     SETC  '&CATALOG'(2,K'&CATALOG-2) STRIP PARENS
         ST    &REG,CTGCAT              SAVE CTLG NAME / ACB
         AGO   .EFORM6
.EFORM5  ANOP  ,
         AIF   ('&CVOL' EQ '').EFORM6    NO CVOL SPECIFIED
         AIF   ('&CVOL'(1,1) EQ '(').ECVLR    CHECK FOR REGS SPECD
         LA    0,&CVOL                  SAVE CTLG CVOL POINTER
         ST    0,CTGCVOL
         AGO   .EFORM6
.ECVLR   ANOP  ,
&REG     SETC  '&CVOL'(2,K'&CVOL-2)     STRIP PARENS
         ST    &REG,CTGCVOL             SAVE CTLG CVOL POINTER
.EFORM6  ANOP  ,
         AIF   ('&WRKAREA'(1,1) EQ '(').EWRKR   CHECK FOR REGS SPECD
         LA    0,&WRKAREA               SAVE WORK AREA POINTER
         ST    0,CTGWKA
         AIF   ('&WRKLEN' EQ '').EFORM7   CHECK IF LENGTH SPECIFIED
         AIF   ('&WRKFMT2' NE '').EFORM6B
         XC    &WRKAREA+2(2),&WRKAREA+2 CLEAR RETURNED LENGTH
         AGO   .EFORM7
.EFORM6B ANOP  ,
         XC    &WRKAREA+4(4),&WRKAREA+4 CLEAR RETURNED LENGTH
         MVI   &WRKAREA+7,8             INDICATE HEADER LENGTH
         AGO   .EFORM7
.EWRKR   ANOP  ,
&REG     SETC  '&WRKAREA'(2,K'&WRKAREA-2) STRIP PARENS
         ST    &REG,CTGWKA              SAVE CTLG REC IDENTIFIER
         AIF   ('&WRKLEN' EQ '').EFORM7   CHECK IF LENGTH SPECIFIED
         AIF   ('&WRKFMT2' NE '').EFORM6C
         XC    2(2,&REG),2(&REG)        CLEAR RETURNED LENGTH
         AGO   .EFORM7
.EFORM6C ANOP  ,
         XC    4(4,&REG),4(&REG)        CLEAR RETURNED LENGTH
         MVI   7(&REG),8                INDICATE HEADER LENGTH
.EFORM7  ANOP  ,
         AIF   ('&WRKLEN' EQ '').EFORM8   CHECK IF LENGTH SPECIFIED
         AIF   ('&WRKLEN'(1,1) EQ '(').EWRKLR
&REG     SETC  '0'
         LA    &REG,&WRKLEN             LOAD WORK AREA LENGTH
         AGO   .ESTLEN
.EWRKLR  ANOP  ,
&REG     SETC  '&WRKLEN'(2,K'&WRKLEN-2) STRIP PARENS
.ESTLEN  ANOP  ,
         AIF   ('&WRKAREA'(1,1) NE '(').ESTWLEN   CHECK FOR REGS SPECD
&WRKAREA SETC  '0&WRKAREA'
.ESTWLEN ANOP  ,
         AIF   ('&WRKFMT2' NE '').ESTWLE2
         STH   &REG,&WRKAREA            SAVE LENGTH OF WRK AREA
         AGO   .EFORM8
.ESTWLE2 ANOP  ,
         ST    &REG,&WRKAREA            SAVE LENGTH OF WRK AREA
.EFORM8  ANOP  ,
         AIF   (NOT &CMS).EFORM9         CMS => OPTION HERE
         MVI   CTGDSORG,B'&OPTN'        CMS OPTION BYTE
         AGO   .EFORM10
.EFORM9  ANOP  ,
         AIF   ('&DSORG' EQ '').EFORM10       SUPERLOCATE DSORG ?
         MVC   CTGDSORG,=CL2'&DSORG'    DSORG FOR SUPERLOCATE
.EFORM10 ANOP  ,
         AIF   ('&TYPE' EQ '').EFORM11  NO RECORD TYPE SPECIFIED
         AIF   ('&TYPE'(1,1) EQ '(').EFRM10B
         MVI   CTGTYPE,C'&TYPE'         CATALOG RECORD TYPE
         AGO   .EFORM11
.EFRM10B ANOP  ,
&REG     SETC  '&TYPE'(2,K'&TYPE-2)     STRIP PARENS
         MVC   CTGTYPE,0(&REG)          CATALOG RECORD TYPE
.EFORM11 ANOP  ,
&I       SETA  N'&FIELDS                GET NUMBER OF FIELDS
         AIF   (&I EQ 0).EFORM12        SKIP IF NO FIELDS
         MVI   CTGNOFLD,&I              NUMBER OF FIELDS
.EFORM12 ANOP  ,
         AIF   ('&DDNAME' EQ '').EFORM13      NO DDNAME ADDR SPECIFIED
         AIF   ('&DDNAME'(1,1) EQ '(').EDDNR   CHECK FOR REGS SPECD
         LA    0,&DDNAME                SAVE ADDR OF JCL
         ST    0,CTGDDNM                DD CARD ASSOC WITH REQ
         AGO   .EFORM14
.EDDNR   ANOP  ,
&REG     SETC  '&DDNAME'(2,K'&DDNAME-2) STRIP PARENS
         ST    &REG,CTGDDNM             SAVE ADDR OF DD CARD
         AGO   .EFORM14
.EFORM13 ANOP  ,
         AIF   ('&NEWNAME' EQ '').EFORM14     NO NEWNAME ADDR SPECIFIED
         AIF   ('&NEWNAME'(1,1) EQ '(').ENNMR   CHECK FOR REGS SPECD
         LA    0,&NEWNAME               SAVE ADDR OF
         ST    0,CTGNEWNM               OBJECTS NEW NAME
         AGO   .EFORM14
.ENNMR   ANOP  ,
&REG     SETC  '&NEWNAME'(2,K'&NEWNAME-2) STRIP PARENS
         ST    &REG,CTGNEWNM            SAVE ADDR OF NEW NAME
.EFORM14 ANOP  ,
         AIF   ('&JSCB' EQ '').EFORM15   NO JSCB ADDR SPECIFIED
         AIF   ('&JSCB'(1,1) EQ '(').EJSBR    CHECK FOR REGS SPECD
         LA    0,&JSCB                  SAVE ADDR OF
         ST    0,CTGJSCB                JSCB
         AGO   .EFORM16
.EJSBR   ANOP  ,
&REG     SETC  '&JSCB'(2,K'&JSCB-2)     STRIP PARENS
         ST    &REG,CTGJSCB             SAVE ADDR OF JSCB
         AGO   .EFORM16
.EFORM15 ANOP  ,
         AIF   ('&PASSWRD' EQ '').EFORM16     NO PASSWORD ADDR GIVEN
         AIF   ('&PASSWRD'(1,1) EQ '(').EPSWR   CHECK FOR REGS SPECD
         LA    0,&PASSWRD               SAVE ADDR OF CALLER
         ST    0,CTGPSWD                SUPPLIED PASSWORD
         AGO   .EFORM2
.EPSWR   ANOP  ,
&REG     SETC  '&PASSWRD'(2,K'&PASSWRD-2) STRIP PARENS
         ST    &PASSWRD,CTGPSWD         SAVE PTR TO PASSWORD
.EFORM16 ANOP  ,
&I       SETA  1                        INIT FOR LOOP THRU CTGFLS
.EFORM17 ANOP  ,
         AIF   (&I GT N'&FIELDS).EFORM19      LEAVE AFTER ALL DONE
&J       SETA  (&I-1)*4                 SET J TO OFFSET IN CTGPL
         AIF   ('&FIELDS(&I)'(1,1) EQ '(').EFLDR   CHECK FOR REG SPEC
         LA    0,&FIELDS(&I)            SAVE CTGFL POINTER
         ST    0,CTGFIELD+&J
         AGO   .EFORM18
.EFLDR   ANOP  ,
&REG     SETC  '&FIELDS(&I)'(2,K'&FIELDS(&I)-2) STRIP PARENS
         ST    &REG,CTGFIELD+&J         SAVE CTGFL POINTER
         AGO   .EFORM18
.EFORM18 ANOP  ,
&I       SETA  &I+1                     INCREMENT I
         AGO   .EFORM17                 SCAN THRU ALL FIELD ADDR'S
.EFORM19 ANOP  ,
         POP   USING
         MEXIT ,
.**********************************************************************
.*                                                                    *
.* ERROR MESSAGES ISSUED BY THIS MACRO                                *
.*                                                                    *
.**********************************************************************
.ERR1    ANOP  ,
         MNOTE 8,'INVALID FUNCTION SPECIFIED'
         MEXIT ,
.ERR2    ANOP  ,
         MNOTE 8,'NO WORKAREA SPECIFIED'
         MEXIT ,
.ERR3    ANOP  ,
         MNOTE 8,'INVALID 3RD PARAMETER IN WORKAREA FIELD'
         MEXIT ,
.ERR4    ANOP  ,
         MNOTE 8,'MUTUALLY EXCLUSIVE PARAMETERS SPECIFIED'
         MEXIT ,
.ERR5    ANOP  ,
         MNOTE 8,'INVALID MACRO FORMAT SPECIFIED'
         MEND  ,
./ ADD NAME=#DATE    0100-00038-00038-1646-00426-00426-00000-MACRO
         MACRO ,                   
&LABEL   #DATE &TO,&FROM=,&FORMAT='YYDDD',&LIST=YES
.*--------------------------------------------------------------------*
.*                                                                    *
.*       TO     (REQUIRED) - OUTPUT BUFFER (WORKDATE OR (R2-R15))     *
.*                                                                    *
.*       FROM=             - SUPPLIED DATE (FULLWORD OR (R0-R15))     *
.*                                                                    *
.*       FORMAT= DAYOFWEEK - DAY OF WEEK (SUNDAY-SATURDAY)            *
.*               CCYY      - CENTURY & YEAR (1988)                    *
.*               DDD       - JULIAN DATE (000-365)                    *
.*               MMM       - MONTH OF YEAR (JAN-DEC)                  *
.*               DD        - DAY OF MONTH (01-31)                     *
.*               MM        - MONTH OF YEAR (01-12)                    *
.*               YY        - YEAR (88)                                *
.*               #D        - NUMBER OF DAYS IN YEAR                   *
.*               WD        - DAY OF THE WEEK (MON=1...SUN=7)          *
.*                                                                    *
.*       LIST=   YESNO    - PRINT GENERATION OPTION                  *
.*                                                                    *
.*--------------------------------------------------------------------*
.*                                                                    *
.*       NOTE: THIS MACRO DOES NOT PERFORM ALL THE TESTS NECESSARY    *
.*             TO CHECK FOR A LEAP YEAR.  THIS SHOULDN'T BE A PROBLEM *
.*             UNLESS THE YEAR BEING TESTED IS 1900 OR 2100.          *
.*             BY THEN IT WILL HAVE BEEN FIXED.                       *
.*                                                                    *
.*--------------------------------------------------------------------*
         GBLB  &STF(10)            
         GBLC  &STPREF             
         LCLA  &A,&B,&C,&D,&N      
         LCLB  &F,&G,&H            
         LCLC  &K,&P,&Q,&X,&REG    
&N       SETA  0                    INITALIZE LABEL COUNTER
&STF(8)  SETB  1                    INDICATE #STARTWA FIELDS WANTED
&X       SETC  'DT&SYSNDX'          GENERATE LABEL PREFIX
&P       SETC  '&STPREF.DBL1'       DOUBLE WORD WORKAREA #1
&Q       SETC  '&STPREF.DBL2'       DOUBLE WORD WORKAREA #2
         AIF   ('&LIST' EQ 'YES').DAT0100
         AIF   ('&LIST' NE 'NO').DATERR1
         PUSH  PRINT
         PRINT NOGEN
.DAT0100 ANOP  ,                   
         AIF   ('&LABEL' EQ '').DAT0200
&LABEL   DS    0H                  #DATE MACRO - START
.DAT0200 ANOP  ,                   
*-------
*        #DATE INITIALIZATION
*-------
         AIF   ('&TO' EQ '').DATERR2
         AIF   ('&FROM' EQ '').DAT0500
         AIF   ('&FROM'(1,1) EQ '(').DAT0300
         ICM   R0,15,&FROM         R0 HAS DATE - 0CYYDDDF
         AGO   .DAT0400            
.DAT0300 ANOP  ,                   
&REG     SETC  '&FROM'(2,K'&FROM-2)
         AIF   ('&REG' EQ 'R0' OR '&REG' EQ '0').DAT0400
         LR    R0,&REG             R0 HAS DATE - 0CYYDDDF
.DAT0400 ANOP  ,                   
         C     R0,&X.P             CHECK IF VALID DATE WAS SUPPLIED
         BE    &X.A                B. IF NOT
         LTR   R0,R0               CHECK IF VALID DATE WAS SUPPLIED
         BNZ   &X.B                B. IF YES
&X.A     DS    0H
.DAT0500 ANOP  ,                   
         L     R1,16               LOAD CVT ADDRESS
         L     R0,56(,R1)          R0 HAS DATE - 0CYYDDDF (CVTDATE)
&X.B     DS    0H
         AIF   ('&TO'(1,1) EQ '(').DAT0600
         LA    R1,&TO              R1 HAS DESTINATION FIELD ADDRESS
         AGO   .DAT0700            
.DAT0600 ANOP  ,                   
&REG     SETC  '&TO'(2,K'&TO-2)
         LR    R1,&REG             R1 HAS DESTINATION FIELD ADDRESS
.DAT0700 ANOP  ,                   
&A       SETA  K'&FORMAT-2          LENGTH OF FORMAT FIELD
&B       SETA  0                    INDEX INTO FORMAT
&K       SETC  '&FORMAT'(2,K'&FORMAT-2)
         MVC   0(&A,R1),&X.Q
.DAT0800 ANOP  ,                   
&C       SETA  &A-&B                CALCULATE # OF REMAINING BYTES
         AIF   (&C LT 9).DAT0900    IF 8 TO GO, CONTINUE
         AIF   ('&K'(&A-&C+1,9) EQ 'DAYOFWEEK').DAT1200
.DAT0900 ANOP  ,                   
         AIF   (&C LT 4).DAT1000    IF 3 TO GO, CONTINUE
         AIF   ('&K'(&A-&C+1,4) EQ 'CCYY').DAT1400
.DAT1000 ANOP  ,                   
         AIF   (&C LT 3).DAT1100    IF 2 TO GO, CONTINUE
         AIF   ('&K'(&A-&C+1,3) EQ 'DDD').DAT1600
         AIF   ('&K'(&A-&C+1,3) EQ 'MMM').DAT1800
.DAT1100 ANOP  ,                   
         AIF   (&C LT 2).DAT3000    IF 1 TO GO, EXIT
         AIF   ('&K'(&A-&C+1,2) EQ 'DD').DAT2000
         AIF   ('&K'(&A-&C+1,2) EQ 'MM').DAT2200
         AIF   ('&K'(&A-&C+1,2) EQ 'YY').DAT2400
         AIF   ('&K'(&A-&C+1,2) EQ '#D').DAT2600
         AIF   ('&K'(&A-&C+1,2) EQ 'WD').DAT2800
&B       SETA  &B+1                 POINT TO NEXT CHARACTER
&D       SETA  &D+1                 POINT TO NEXT CHARACTER
         AGO   .DAT0800            
.*                                 
.DAT1200 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "DAYOFWEEK" INTO DAY OF THE WEEK
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT1300   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT1300 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF'
         CVB   R15,&Q
         SLR   R14,R14
         D     R14,&X.R            DIVIDE YEAR BY LOOP FACTOR
         LA    R15,&X.T            LOAD "1ST DAY OF YEAR" TABLE ADDRESS
         IC    R14,0(R14,R15)      LOAD DAY INDEX
         STH   R0,&P+6             SAVE DDDF
         OI    &P+7,X'0F'          ENSURE SIGN IS VALID
         CVB   R15,&P              CONVERT DATE TO JULIAN
         AR    R15,R14             ADD INDEX TO CURRENT DATE
         SLR   R14,R14
         D     R14,&X.S            DIVIDE BY NUMBER OF DAYS IN A WEEK
         LA    R15,&X.U            LOAD "DAY OF WEEK" TABLE ADDRESS
&X.C&N   DS    0H
         CH    R14,0(,R15)         CHECK FOR DAY KEY
         BE    &X.D&N              B. IF FOUND
         LA    R15,14(,R15)        ADVANCE TO NEXT TABLE ENTRY
         B     &X.C&N
&X.D&N   DS    0H
         MVC   0(9,R1),2(R15)      INSERT - DAYOFWEEK
&B       SETA  &B+9                 POINT TO NEXT CHARACTER
&D       SETA  &D+9                 POINT TO NEXT CHARACTER
&G       SETB  1                    INDICATE TABLE GENERATION REQUIRED
         AGO   .DAT0800            
.*                                 
.DAT1400 ANOP  ,                   
*-------
*        CONVERT "CCYY" INTO CURRENT CENTURY & YEAR
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         AIF   (&D EQ 0).DAT1500   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT1500 ANOP  ,                   
         STCM  R0,8,&P+3           SAVE # OF CENTURIES PAST 20TH
         LA    R15,19              LOAD STARTING POINT
         A     R15,&P              ADD # OF CENTURIES PAST 20TH
         CVD   R15,&P              CONVERT NUMBER TO DECIMAL
         UNPK  0(2,R1),&P+6(2)
         OI    1(R1),X'F0'
         LR    R15,R0              LOAD YEAR IN 0CYYDDDF FORMAT
         STCM  R15,4,3(R1)         SAVE "YY"
         SRL   R15,4               CONVERT TO   00CYYDDD FORMAT
         STCM  R15,4,2(R1)         SAVE "CY'
         OI    2(R1),X'F0'         CONVERT X'0889' TO X'F8F9' (IE. 89)
         OI    3(R1),X'F0'
&B       SETA  &B+4                 POINT TO NEXT CHARACTER
&D       SETA  &D+4                 POINT TO NEXT CHARACTER
         AGO   .DAT0800            
.*                                 
.DAT1600 ANOP  ,                   
*-------
*        CONVERT "DDD" INTO JULIAN DATE
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         AIF   (&D EQ 0).DAT1700   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT1700 ANOP  ,                   
         STH   R0,&P+6             SAVE DDDF
         OI    &P+7,X'0F'          ENSURE SIGN IS VALID
         UNPK  0(3,R1),&P+6(2)
&B       SETA  &B+3                 POINT TO NEXT CHARACTER
&D       SETA  &D+3                 POINT TO NEXT CHARACTER
         AGO   .DAT0800            
.*                                 
.DAT1800 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "MMM" INTO MONTH OF YEAR
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT1900   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT1900 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF'
         CVB   R15,&Q
         STH   R15,&P+6
         LA    R14,&X.V            LOAD ADDRESS OF NON-LEAP YEAR TABLE
         TM    &P+7,3              CHECK IF YEAR DIVISIBLE BY 4
         BNZ   &X.E&N              B. IF NOT
         LA    R14,&X.V+2          LOAD ADDRESS OF LEAP     YEAR TABLE
&X.E&N   DS    0H
         STH   R0,&P+6             SAVE DDDF
         CVB   R15,&P
         CH    R15,0(,R14)         CHECK FOR DESIRED MONTH
         BH    &X.F&N              B. IF FOUND
         LA    R14,10(,R14)        LOAD ADDRESS OF NEXT MONTH
         B     &X.E&N
&X.F&N   DS    0H
         CLI   2(R14),C'X'         CHECK FOR LEAP YEAR
         BE    &X.G&N              B. IF YES
         LA    R14,2(,R14)         LOAD ADDRESS OF CURRENT MONTH
&X.G&N   DS    0H
         MVC   0(3,R1),3(R14)      INSERT - MMM
&B       SETA  &B+3                 POINT TO NEXT CHARACTER
&D       SETA  &D+3                 POINT TO NEXT CHARACTER
&F       SETB  1                    INDICATE TABLE GENERATION REQUIRED
         AGO   .DAT0800            
.*                                 
.DAT2000 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "DD" INTO DAY OF THE MONTH
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT2100   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT2100 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF"
         CVB   R15,&Q
         STH   R15,&P+6
         LA    R14,&X.V            LOAD ADDRESS OF NON-LEAP YEAR TABLE
         TM    &P+7,3              CHECK IF YEAR DIVISIBLE BY 4
         BNZ   &X.H&N              B. IF NOT
         LA    R14,&X.V+2          LOAD ADDRESS OF LEAP     YEAR TABLE
&X.H&N   DS    0H
         STH   R0,&P+6             SAVE DDDF
         OI    &P+7,X'0F'          ENSURE SIGN IS VALID
         CVB   R15,&P
         CH    R15,0(,R14)         CHECK FOR DESIRED MONTH
         BH    &X.I&N              B. IF FOUND
         LA    R14,10(,R14)        LOAD ADDRESS OF NEXT MONTH
         B     &X.H&N
&X.I&N   DS    0H
         SH    R15,0(,R14)         CALCULATE DAY OF CURRENT MONTH
         CVD   R15,&P
         UNPK  &Q.(3),&P+6(2)
         MVC   0(2,R1),&Q+1        INSERT - DD
         OI    1(R1),X'F0'
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
&F       SETB  1                    INDICATE TABLE GENERATION REQUIRED
         AGO   .DAT0800            
.*                                 
.DAT2200 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "MM" INTO MONTH OF THE YEAR
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT2300   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT2300 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF"
         CVB   R15,&Q
         STH   R15,&P+6
         LA    R14,&X.V            LOAD ADDRESS OF NON-LEAP YEAR TABLE
         TM    &P+7,3              CHECK IF YEAR DIVISIBLE BY 4
         BNZ   &X.J&N              B. IF NOT
         LA    R14,&X.V+2          LOAD ADDRESS OF LEAP     YEAR TABLE
&X.J&N   DS    0H
         STH   R0,&P+6             SAVE DDDF
         CVB   R15,&P
         CH    R15,0(,R14)         CHECK FOR DESIRED MONTH
         BH    &X.K&N              B. IF FOUND
         LA    R14,10(,R14)        LOAD ADDRESS OF NEXT MONTH
         B     &X.J&N
&X.K&N   DS    0H
         CLI   2(R14),C'X'         CHECK FOR LEAP YEAR
         BE    &X.L&N              B. IF YES
         LA    R14,2(,R14)         LOAD ADDRESS OF CURRENT MONTH
&X.L&N   DS    0H
         MVC   0(2,R1),6(R14)      INSERT - MM
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
&F       SETB  1                    INDICATE TABLE GENERATION REQUIRED
         AGO   .DAT0800            
.*                                 
.DAT2400 ANOP  ,                   
*-------
*        CONVERT "YY" INTO CURRENT YEAR
*-------
         AIF   (&D EQ 0).DAT2500   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT2500 ANOP  ,                   
         LR    R15,R0              LOAD YEAR IN 0CYYDDDF FORMAT
         STCM  R15,4,1(R1)         SAVE "YY"
         SRL   R15,4               CONVERT TO   00CYYDDD FORMAT
         STCM  R15,4,0(R1)         SAVE "CY'
         OI    0(R1),X'F0'         CONVERT X'0889' TO X'F8F9' (IE. 89)
         OI    1(R1),X'F0'
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .DAT0800            
.*                                 
.DAT2600 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "#D" INTO NUMBER OF DAYS IN THE YEAR
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT2700   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT2700 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF'
         CVB   R15,&Q
         STH   R15,&P+6            SAVE "00YY"
         MVC   0(2,R1),=Y(365)     ASSUME NON-LEAP YEAR
         TM    &P+7,3              CHECK IF YEAR DIVISIBLE BY 4
         BNZ   &X.M&N              B. IF NOT
         MVC   0(2,R1),=Y(366)     SET NUMBER TO LEAP YEAR DAYS
&X.M&N   DS    0H
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .DAT0800            
.*                                 
.DAT2800 ANOP  ,                   
&N       SETA  &N+1                BUMP LABEL COUNTER
*-------
*        CONVERT "WD" INTO CURRENT NUMERICAL DAY OF THE WEEK
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).DAT2900   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.DAT2900 ANOP  ,                   
         STCM  R0,12,&P+6          SAVE "CCYY"
         MVO   &Q+6(2),&P+6(2)
         OI    &Q+7,X'0F'          CONVERT TO "CYYF'
         CVB   R15,&Q
         SLR   R14,R14
         D     R14,&X.R            DIVIDE YEAR BY LOOP FACTOR
         LA    R15,&X.T            LOAD "1ST DAY OF YEAR" TABLE
         IC    R14,0(R14,R15)      LOAD DAY INDEX
         STH   R0,&P+6             SAVE DDDF
         OI    &P+7,X'0F'          ENSURE SIGN IS VALID
         CVB   R15,&P              CONVERT DATE TO JULIAN
         AR    R15,R14             ADD INDEX TO CURRENT DATE
         SLR   R14,R14
         D     R14,&X.S            DIVIDE BY DAYS IN A WEEK
         LA    R15,&X.U            LOAD "DAY OF WEEK" TABLE
&X.N&N   DS    0H
         CH    R14,0(,R15)         CHECK FOR DAY KEY
         BE    &X.O&N              B. IF FOUND
         LA    R15,14(,R15)        ADVANCE TO NEXT TABLE ENTRY
         B     &X.N&N
&X.O&N   DS    0H
         MVC   0(2,R1),12(R15)     INSERT - DAY OF THE WEEK
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
&G       SETB  1                    INDICATE TABLE REQUIRED
         AGO   .DAT0800            
.*                                 
.DAT3000 ANOP  ,                   
         B     &X.W                BRANCH AROUND CONSTANTS
*-------
*        #DATE CONSTANTS AND CONVERSION TABLES
*-------
&X.P     DC    0F'0',X'0000000F'   PACKED DECIMAL ZEROS
&X.Q     DC    C&FORMAT            FORMAT FIELD OVERLAY
         AIF   (NOT &G).DAT3100
&X.R     DC    F'28'               1ST DAY OF YEAR DIVISION FACTOR
&X.S     DC    F'7'                DAY OF WEEK DIVISION FACTOR
&X.T     DS    0H                  DAY OF WEEK TABLE (1ST DAY OF YEAR)
         DC    X'00020304050001'
         DC    X'02030506000103'
         DC    X'04050601020304'
         DC    X'06000102040506'
&X.U     DS    0H                  DAY OF WEEK TABLE (DAY OF WEEK)
         DC    H'0',CL10'SATURDAY  ',C'06'
         DC    H'1',CL10'SUNDAY    ',C'07'
         DC    H'2',CL10'MONDAY    ',C'01'
         DC    H'3',CL10'TUESDAY   ',C'02'
         DC    H'4',CL10'WEDNESDAY ',C'03'
         DC    H'5',CL10'THURSDAY  ',C'04'
         DC    H'6',CL10'FRIDAY    ',C'05'
.DAT3100 ANOP  ,                   
         AIF   (NOT &F).DAT3200
&X.V     DS    0H                  DAY OF MONTH/MONTH OF YEAR TABLE
         DC    AL2(334,335),CL6'XDEC12'
         DC    AL2(304,305),CL6'XNOV11'
         DC    AL2(273,274),CL6'XOCT10'
         DC    AL2(243,244),CL6'XSEP09'
         DC    AL2(212,213),CL6'XAUG08'
         DC    AL2(181,182),CL6'XJUL07'
         DC    AL2(151,152),CL6'XJUN06'
         DC    AL2(120,121),CL6'XMAY05'
         DC    AL2(090,091),CL6'XAPR04'
         DC    AL2(059,060),CL6'XMAR03'
         DC    AL2(031,031),CL6'XFEB02'
         DC    AL2(000,000),CL6'XJAN01'
.DAT3200 ANOP  ,                   
&X.W     DS    0H                  #DATE MACRO - END
         AGO   .MEND               
.DATERR1 MNOTE 8,'#DATE1E - "LIST=" PARAMETER IS INVALID (YES OR NO)'
         AGO   .MEND               
.DATERR2 MNOTE 8,'#DATE2E - "TO" POSITIONAL PARAMETER IS MISSING'
         AGO   .MEND               
.MEND    ANOP  ,                   
         AIF   ('&LIST' EQ 'YES').MEND2
         POP   PRINT
.MEND2   ANOP  ,                   
         MEND  ,                   
./ ADD NAME=#DCBEXIT 0100-00038-00038-1647-00152-00152-00000-MACRO
         MACRO ,
&NAME    #DCBEXIT &ASCII=NO,            RECFM=D SUPPORT                X
               &BLOCK=YES,              BLOCKING BY DEFAULT            X
               &CSECT=NO,               GENERATE NEW CSECT             X
               &EXTEND=,                EXTENDED DCB LOGIC             X
               &LRECL=80,               DEFAULT LRECL                  X
               &BLKSIZE=,               DEFAULT BLKSIZE                X
               &PPC=NO                  UNLIKE CONCAT SUPPORT
         LCLC  &LABEL,&P
***********************************************************************
*
*        DCB EXIT TO SET DEFAULT LRECL & BLKSIZE
*
.*       NOTE-  THIS CODE WILL FUNCTION ON ANY LEVEL OF OS/VS
.*
&P       SETC  'DCB&SYSNDX'
&L       SETC  'OPENBLK'
&LABEL   SETC  'OPENBLK'
         AIF   ('&NAME' EQ '').NONAME
&LABEL   SETC  '&NAME'
&L       SETC  '&NAME'
.NONAME  AIF   ('&CSECT' NE 'YES').BOTH
.CSECT   ANOP  ,
&L       CSECT ,
&L       SETC  ' '
.BOTH    ANOP  ,
         PUSH  USING
         DROP  ,
         USING IHADCB,R1
         USING &LABEL,R15
         SPACE 1
&L       LH    R0,DCBLRECL              GET ORIGINAL LRECL
         LH    R3,DCBBLKSI                     AND   BLKSIZE
         SPACE 1
         LTR   R0,R0                    IS LRECL NON-ZERO ?
         BNZ   &P.A                     YES, USE IT AS-IS
         LA    R0,&LRECL                OTHERWISE USE DEFAULT
         SPACE 1
&P.A     MVC   DCBBLKSI(1),DCBRECFM     ISOLATE F/V/U REC TYPE
         NI    DCBBLKSI,DCBRECL
         AIF   ('&ASCII'(1,1) EQ 'N').NOASCII
         SPACE 1
         TM    DCBRECFM,DCBRECD         FORMAT-D RECORDS ?
         BZ    *+8                      NO, SKIP
         MVI   DCBBLKSI,DCBRECV         YES, TREAT LIKE FORMAT-V
         SPACE 1
.NOASCII LTR   R3,R3                    BLKSIZE STILL ZERO ?
         BNZ   &P.D                     NO, LEAVE ALONE
         LR    R3,R0                    YES, SET BLKSIZE = LRECL
         SPACE 1
         TM    DCBBLKSI,DCBRECU         IS THIS TYPE-U
         BNM   &P.E                     YES, BRANCH
         AIF   ('&BLOCK'(1,1) NE 'Y').BASIC
         SPACE 1
         L     R2,16                    POINT TO CVT
         L     R2,0(0,R2)               POINT TO TCB WORDS
         L     R2,4(0,R2)               POINT TO OLD TCB
         L     R2,12(0,R2)              POINT TO TIOT
         AH    R2,DCBTIOT               POINT TO TIOT ENTRY
         ICM   R2,7,17(R2)              GET UCB ADDRESS
         BZ    &P.C                     IF NO UCB, NO BLOCKING
         TM    18(R2),160               TAPE OR DASD ?
         BZ    &P.C                     NEITHER, DO NOT BLOCK
         LA    R4,8                     ASSUME DASD FACTOR OF 256
         TM    18(R2),128               TAPE ?
         BZ    &P.B                     NO, SKIP
         LA    R4,10                    TAKE TAPE FACTOR OF 1024
&P.B     LA    R3,24                    BLOCKSIZE IS FACTOR*24 AND
         SLL   R3,0(R4)                 IS ROUNDED DOWN FOR F-TYPE
         B     &P.D                     SKIP BDW ALLOWANCE
.BASIC   SPACE 1
&P.C     CLI   DCBBLKSI,DCBRECV         IS THIS V-TYPE ?
         BNE   &P.D                     NO, NO OFFSET
         LA    R3,4(0,R3)               YES, ALLOW 4 BYTES FOR BDW
         SPACE 1
&P.D     CLI   DCBBLKSI,DCBRECF         IS THIS F-TYPE ?
         BNE   &P.F                     NO, ALL DONE
         SR    R2,R2
         DR    R2,R0                    YES, MAKE BLKSIZE EVEN
         MR    R2,R0                         MULTIPLE OF LRECL
         CR    R3,R0                    ENSURE RESULT NOT ZERO
         BH    &P.F                     OKAY, ALL DONE
         LR    R3,R0                    SET BLKSIZE TO LRECL
         NI    DCBRECFM,255-DCBRECBR    NO BLOCKING
         B     &P.F                     ALL DONE
         SPACE 1
&P.E     OI    DCBRECFM,DCBRECU         MAKE RECFM=U EXPLICIT
         NI    DCBRECFM,255-(DCBRECBR+DCBRECSB)   NEITHER B NOR S
         SR    R0,R0                    SET LRECL TO ZERO
         SPACE 1
&P.F     STH   R0,DCBLRECL              SET ACTUAL LRECL
         AIF   ('&BLKSIZE' EQ '').NOBLKSI
         LTR   R3,R3                    IS BLKSIZE STILL ZERO?
         BNZ   &P.H                     B. IF NOT
         L     R3,&P.G                  OTHERWISE USE DEFAULT
         B     &P.H                     BYPASS CONSTANT
&P.G     DC    A(&BLKSIZE)              USER DEFINED DEFAULT BLKSIZE
.NOBLKSI ANOP  ,
&P.H     STH   R3,DCBBLKSI              SET ACTUAL BLKSIZE
         AIF   ('&PPC'(1,1) EQ 'N').NOPPC
         SPACE 1
         TM    DCBOFLGS,DCBOFPPC        UNLIKE CONCATENATION ?
         BZR   R14                      NO, RETURN TO OPEN
         MVI   IHADCB,255               SET FLAG
.NOPPC   ANOP  ,
         BR    R14                      RETURN TO OPEN
         SPACE 1
         AIF   ('&EXTEND' EQ '').SKIP2
         SPACE 1
.*
.*  DCB  PREFIX FORMAT -
.*
.*  -8   DS    X  ID BYTE=X'ED'
.*  -7   DS    B  RECFM
.*  -6   DS    H  LRECL
.*  -4   DS    H  BLKSIZE
.*  -2   DS    B  OPTCD BITS
.*  -1   DS    X  BUFNO
.*
         USING &EXTEND,R15
&EXTEND  LA    R0,8                     DCB PREFIX LENGTH
         SR    R1,R0                    BACK UP TO PREFIX
         USING IHADCB-8,R1
         SPACE 1
         CLI   IHADCB-8,237             EXTENDED DCB ?
         BNE   &P.I                     NO, SKIP EXTENSIONS
         SPACE 1
         CLI   DCBRECFM,0
         BNZ   *+10
         MVC   DCBRECFM,IHADCB-7        SET DEFAULT RECFM
         SPACE 1
         ICM   R0,3,DCBLRECL
         BNZ   *+10
         MVC   DCBLRECL,IHADCB-6        SET DEFAULT LRECL
         SPACE 1
         ICM   R0,3,DCBBLKSI
         BNZ   *+10
         MVC   DCBBLKSI,IHADCB-4        SET DEFAULT BLKSIZE
         SPACE 1
         OC    DCBOPTCD,IHADCB-2        SET FORCED OPTCD BITS
         SPACE 1
         CLI   DCBBUFNO,0
         BNZ   *+10
         MVC   DCBBUFNO,IHADCB-1        SET DEFAULT BUFNO
         SPACE 1
&P.I     LA    R1,IHADCB                POINT TO BASIC DCB
         LA    R0,&EXTEND-&LABEL
         SR    R15,R0
         BR    R15                      BRANCH TO MAIN EXIT
.SKIP2   SPACE 1
         POP   USING
         MEND  ,
./ ADD NAME=#DCLSW   0100-00038-00038-1647-00183-00183-00000-MACRO
         MACRO
&NAME    #DCLSW &INIT=0,&MF=D,&GENERIC=
         GBLA  &DCLDSW#             COUNTER OF # OF SWITCH BYTES
         GBLA  &DCLGSW#             COUNTER OF # OF GENERIC BYTES
         GBLB  &DCLDSWD(99)         DEFER DECLARE INDICATIORS
         GBLC  &DCLDSWN(99)         SWITCH BYTE NAMES
         GBLC  &DCLDSWB(800)        SWITCH BIT NAMES
         GBLC  &DCLGSWN(99)         GENERIC SWITCH BYTE NAMES
         GBLC  &DCLGSWB(99)         GENERIC SWITCH BIT PREFIXES
         LCLA  &A,&B,&C,&D,&E       LOCAL WORK SYMBOLS
         LCLB  &F,&G
         LCLC  &K,&L,&M,&P
         AIF   ('&GENERIC' EQ '').DCL0200   NO GENERIC, CONTINUE
.*
.* THE FOLLOWING IS FOR THE GENERIC= OPTION
.*
&DCLGSW# SETA  &DCLGSW#+1           INCREMENT GENERIC SWITCH NUMBER
&DCLGSWN(&DCLGSW#) SETC '&NAME'     SET SWITCH NAME
&DCLGSWB(&DCLGSW#) SETC '&GENERIC'   SET GENERIC PREFIX
         AIF   ('&NAME' NE '').DCL0100   THERE WAS A NAME, EXIT
&DCLGSWN(&DCLGSW#) SETC '&GENERIC'   SET SWITCH NAME TO PREFIX
.DCL0100 MEXIT                       EXIT
.DCL0200 AIF   ('&MF' NE 'L').DCL2300   NOT MF=L, CONTINUE
.*
.* THE FOLLOWING IS FOR MF=L
.*
         AIF   ('&NAME' EQ '').DCL1200   IF NO NAME, DO ALL
&A       SETA  0                    START OF LOOP COUNTER
.DCL0300 AIF   (&A GE &DCLDSW#).DCL3400   ERROR - SWITCH NOT FOUND
&A       SETA  &A+1                 GET NEXT SWITCH
         AIF   ('&NAME' NE '&DCLDSWN(&A)').DCL0300   NO MATCH, LOOP
         AIF   (NOT &DCLDSWD(&A)).DCL3500   ERROR - NOT DEFERRED
&DCLDSWD(&A) SETB 0                 RESET DEFER BIT
&K       SETC  '&DCLDSWN(&A)'       GET SWITCH BYTE NAME
&K       DC    AL1(&INIT)           #DCLSW MACRO, JUNE 29TH, 1979
&C       SETA  &A*8-7               INDEX TO FIRST SWITCH BIT NAME
&L       SETC  '&DCLDSWB(&C+0)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0400   NULL, CONTINUE
&L       EQU   X'80'                1... ...
.DCL0400 ANOP
&L       SETC  '&DCLDSWB(&C+1)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0500   NULL, CONTINUE
&L       EQU   X'40'                .1.. ...
.DCL0500 ANOP
&L       SETC  '&DCLDSWB(&C+2)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0600   NULL, CONTINUE
&L       EQU   X'20'                ..1. ...
.DCL0600 ANOP
&L       SETC  '&DCLDSWB(&C+3)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0700   NULL, CONTINUE
&L       EQU   X'10'                ...1 ...
.DCL0700 ANOP
&L       SETC  '&DCLDSWB(&C+4)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0800   NULL, CONTINUE
&L       EQU   X'08'                .... 1..
.DCL0800 ANOP
&L       SETC  '&DCLDSWB(&C+5)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL0900   NULL, CONTINUE
&L       EQU   X'04'                .... .1.
.DCL0900 ANOP
&L       SETC  '&DCLDSWB(&C+6)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1000   NULL, CONTINUE
&L       EQU   X'02'                .... ..1
.DCL1000 ANOP
&L       SETC  '&DCLDSWB(&C+7)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1100   NULL, CONTINUE
&L       EQU   X'01'                .... ...1
.DCL1100 MEXIT                      EXIT
.DCL1200 ANOP
&A       SETA  0                    INDEX OF SWITCH BYTES
&B       SETA  &DCLDSW#             GET NUMBER OF SWITCHES
.DCL1300 AIF   (&A GE &B).DCL2200   FINISHED, EXIT
&A       SETA  &A+1                 POINT TO NEXT ONE
         AIF   (NOT &DCLDSWD(&A)).DCL1300   SKIP IF DEFER BIT NOT ON
&DCLDSWD(&A) SETB 0                 RESET DEFER BIT
&K       SETC  '&DCLDSWN(&A)'       GET SWITCH BYTE NAME
&K       DC    AL1(&INIT)           #DCLSW MACRO, JUNE 29TH, 1979
&C       SETA  &A*8-7               POINT TO FIRST SWITCH BIT NAME
&L       SETC  '&DCLDSWB(&C+0)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1400   NULL, CONTINUE
&L       EQU   X'80'                1... ...
.DCL1400 ANOP
&L       SETC  '&DCLDSWB(&C+1)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1500   NULL, CONTINUE
&L       EQU   X'40'                .1.. ...
.DCL1500 ANOP
&L       SETC  '&DCLDSWB(&C+2)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1600   NULL, CONTINUE
&L       EQU   X'20'                ..1. ...
.DCL1600 ANOP
&L       SETC  '&DCLDSWB(&C+3)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1700   NULL, CONTINUE
&L       EQU   X'10'                ...1 ...
.DCL1700 ANOP
&L       SETC  '&DCLDSWB(&C+4)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1800   NULL, CONTINUE
&L       EQU   X'08'                .... 1..
.DCL1800 ANOP
&L       SETC  '&DCLDSWB(&C+5)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL1900   NULL, CONTINUE
&L       EQU   X'04'                .... .1.
.DCL1900 ANOP
&L       SETC  '&DCLDSWB(&C+6)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL2000   NULL, CONTINUE
&L       EQU   X'02'                .... ..1
.DCL2000 ANOP
&L       SETC  '&DCLDSWB(&C+7)'     GET SWITCH BIT NAME
         AIF   ('&L' EQ '').DCL2100   NULL, CONTINUE
&L       EQU   X'01'                .... ...1
.DCL2100 AGO   .DCL1300             LOOP BACK TO DO NEXT SWITCH
.DCL2200 MEXIT                      FINISHED, EXIT
.DCL2300 AIF   ('&MF' NE 'E').DCL2600   NOT MF=E, CONTINUE
.*
.* THE FOLLOWING IS FOR MF=E
.*
&A       SETA  0                    INDEX INTO POSITIONAL PARMS
&B       SETA  N'&SYSLIST           GET NUMBER OF SWITCH BITS
         AIF   (&B EQ 0).DCL3600    ERROR - NO SWITCH BITS PRESENT
         AIF   ('&NAME' EQ '').DCL3700   ERROR - NO NAME SUPPLIED
&DCLDSW# SETA  &DCLDSW#+1           POINT TO NEXT SWITCH BYTE NAME
&C       SETA  &DCLDSW#*8-7         POINT TO FIRST SWITCH BIT NAME
&DCLDSWN(&DCLDSW#) SETC '&NAME'     SAVE SWITCH BYTE NAME
         AIF   (&B LT 9).DCL2400    LESS THAN 9 SWITCHES, CONTINUE
         MNOTE 4,'DCL001I - ONLY FIRST 8 SWITCHES USED'
&B       SETA  8                    SET MAX TO 8
.DCL2400 ANOP
&A       SETA  &A+1                 POINT TO NEXT SWITCH
         AIF   (&A GT &B).DCL2500   FINISHED, EXIT
&K       SETC  '&SYSLIST(&A)'       GET SWITCH BIT NAME
         AIF   ('&K' EQ '').DCL2400   A NULL, IGNORE IT
&DCLDSWB(&A+&C) SETC '&K'           SAVE SWITCH BIT NAME
         AGO   .DCL2400             LOOP THRU ALL 8 SWITCH BIT NAMES
.DCL2500 MEXIT                      EXIT
.DCL2600 AIF   ('&MF' EQ 'D').DCL2700   MF=D, CONTINUE
         MNOTE 4,'DCL002I - MF=&MF INVALID, MF=D ASSUMED'
.DCL2700 ANOP
.*
.* THE FOLLOWING IS FOR MF=D
.*
&A       SETA  0                    INDEX INTO POSITIONAL PARMS
&B       SETA  N'&SYSLIST           GET NUMBER OF SWITCH BITS
         AIF   (&B EQ 0).DCL3600    ERROR - NO SWITCH BITS PRESENT
         AIF   ('&NAME' EQ '').DCL3000   NO NAME SUPPLIED, CONTINUE
&DCLDSW# SETA  &DCLDSW#+1           POINT TO NEXT SWITCH BYTE NAME
&C       SETA  &DCLDSW#*8-8         POINT TO FIRST SWITCH BIT NAME
&DCLDSWN(&DCLDSW#) SETC '&NAME'     SAVE SWITCH BYTE NAME
&DCLDSWD(&DCLDSW#) SETB 1           SET DEFER BIT ON
         AIF   (&B LT 9).DCL2800    LESS THAN 9 SWITCHES, CONTINUE
         MNOTE 4,'DCL001I - ONLY FIRST 8 SWITCHES USED'
&B       SETA  8                    SET MAX TO 8
.DCL2800 ANOP
&A       SETA  &A+1                 POINT TO NEXT SWITCH
         AIF   (&A GT &B).DCL2900   FINISHED, EXIT
&K       SETC  '&SYSLIST(&A)'       GET SWITCH BIT NAME
         AIF   ('&K' EQ '').DCL2800   A NULL, IGNORE IT
&DCLDSWB(&A+&C) SETC '&K'           SAVE SWITCH BIT NAME
         AGO   .DCL2800             LOOP THRU ALL 8 SWITCH BIT NAMES
.DCL2900 MEXIT                      EXIT
.DCL3000 ANOP
&C       SETA  0                    BIT NUMBER, IN A BYTE
.DCL3100 ANOP
&E       SETA  &E+1                 GENERATED SWITCH BYTE NUMBER
&P       SETC  'DCL&SYSNDX&E'       GENERATE A SWITCH BYTE NAME
&DCLDSW# SETA  &DCLDSW#+1           POINT TO NEXT SWITCH BYTE NAME
&C       SETA  0                    INDEX OF BITS
&DCLDSWN(&DCLDSW#) SETC '&P'        SAVE SWITCH BYTE NAME
&DCLDSWD(&DCLDSW#) SETB 1           SET DEFER BIT ON
.DCL3200 AIF   (&C EQ 8).DCL3100    NEED NEW BYTE, GO GET IT
&C       SETA  &C+1                 POINT TO NEXT BIT
&A       SETA  &A+1                 POINT TO NEXT SWITCH
&K       SETC  '&SYSLIST(&A)'       GET SWITCH BIT NAME
         AIF   ('&K' EQ '').DCL3300   A NULL, IGNORE IT
&DCLDSWB(&DCLDSW#*8-8+&C) SETC '&K'   SAVE SWITCH BIT NAME
.DCL3300 AIF   (&A LT &B).DCL3200   LOOP THRU ALL BITS
         MEXIT                      EXIT
.DCL3400 MNOTE 8,'DCL003A - SWITCH "&NAME" NOT FOUND'
         MEXIT
.DCL3500 MNOTE 8,'DCL004A - SWITCH "&NAME" NOT PREVIOUSLY DEFERRED'   *
         MEXIT
.DCL3600 MNOTE 8,'DCL005A - NO SWITCHES PRESENT'
         MEXIT
.DCL3700 MNOTE 8,'DCL006A - MF=E REQUIRES A NAME TO BE SUPPLIED'
         MEND
./ ADD NAME=#DIRSCAN 0100-00038-00038-1647-00043-00043-00000-MACRO
         MACRO ,
&NAME    #DIRSCAN &DCB,&MEMPTR=,&NEXT=,&LAST=,&COUNTER=,&WKREG=
         LCLC  &L,&M,&N,&X
         AIF   ('&DCB' EQ '').DIR04     ERROR - NO DCB
         AIF   ('&MEMPTR' EQ '').DIR05  ERROR - NO MEMPTR
         AIF   ('&NEXT' EQ '').DIR06    ERROR - NO NEXT
         AIF   ('&LAST' EQ '').DIR07    ERROR - NO LAST
         AIF   ('&WKREG' EQ '').DIR08   ERROR - NO WORK REG
&L       SETC  '&WKREG'                 PICK UP WORK REGISTER
&M       SETC  '&MEMPTR'                MEMBER POINTER
&N       SETC  '&COUNTER'               COUNTER
&X       SETC  '&SYSNDX'                AND THE INDEX
&NAME    B     DIR&X.1                  GO READ FIRST DIRECTORY BLOCK
&NEXT    IC    R1,11(0,&M)              ISOLATE LENGTH
         SLL   R1,27                    OF NEXT ENTRY
         SRL   R1,26
         LA    &M,12(R1,&M)             POINT TO NEXT ENTRY
         CLR   &M,&L                    HAVE WE REACHED END OF BLOCK?
         BL    DIR&X.2                  NO, GO TEST FOR LAST ENTRY
DIR&X.1  GET   &DCB                     READ IN A DIRECTORY BLOCK
         AIF   ('&N' EQ '').DIR03       NO COUNTER, CONTINUE
         AIF   ('&N'(1,1) EQ '(').DIR02 COUNTER, IS A REG
         LA    R15,1                    INCREMENT COUNTER OF # BLOCKS
         A     R15,&N
         ST    R15,&N
         AGO   .DIR03
.DIR02   LA    &N(1),1(0,&N(1))         INCREMENT COUNTER OF # BLOCKS
.DIR03   LH    &L,0(0,R1)               GET LENGTH OF BLOCK
         LA    &L,0(R1,&L)              POINT TO LAST USED BYTE
         LA    &M,2(0,R1)               POINT TO FIRST ENTRY
DIR&X.2  CLI   0(&M),255                IS THIS END OF DIRECTORY ?
         BE    &LAST                    YES, TAKE EXIT
         MEXIT ,
.DIR04   IHBERMAC 1006,DCB
         MEXIT ,
.DIR05   IHBERMAC 1006,MEMPTR
         MEXIT ,
.DIR06   IHBERMAC 1006,NEXT
         MEXIT ,
.DIR07   IHBERMAC 1006,LAST
         MEXIT ,
.DIR08   IHBERMAC 1006,WKREG
         MEND  ,
./ ADD NAME=#DSECTS  0100-00038-00038-1647-01033-01033-00000-MACRO
         MACRO ,
         #DSECTS &LIST=NO,&TYPE=
.*---------------------------------------------------------------------
.*
.*  GEN SEQUENCE -
.*
.*       PSA CSD SVT LCCA LCCAT PCCA PCCAT GDA LDA CPAB CVT SCVT
.*       ASCB ASXB ASVT SRB TCB DCTCB OUCB OUXB SIOT TIOT TCT LCT SCT
.*       JCT JMR JMUD JSCB ATTCH SCB SMCA BASEA CSCB CIB ECB ACB RPL
.*       DCB DECB JFCB JFCBX JFCBE DEB IOB IOSB IPIB ATB IOCM UCB UCM
.*       WQE RQE DSCB DSAB RB IQE CDE LPDE LLE XL QCB QEL PSCB ECT UPT
.*       SDWA FRRS WSAVT TSB CPPL PPL CSPL CSOA IOPL ALLOC AMDSB CAXWA
.*       CCA CICB CTGCV CAMLST CTGFL CTGFV CTGPL CTGVL CTGWA EDT UPL
.*       ZB502 ZB505 ZB506 QMPA JESCT SSCVT SSVT SSIB SSOB SSAT JCTX
.*       DSNT PCCB SWB WPL SCTX IOBE
.*
.* --------------------------------------------------------------------
.*
.*  GROUP NAMES-
.*      DM -     ACB DCB DEB DECB DSAB DSCB IOB JFCB RPL
.*      ENQ -    QCB QEL
.*      IO -     ACB DCB DEB DECB ECB IOB IOBE JFCB RPL RQE UCB
.*      JOB -    ASCB CIB CSCB ECB JMR JMUD JSCB TCT TIOT
.*      PROG -   CDE LLE LPDE RB XL
.*      SUBSYS - JESCT SSCT SSIB SSOB SSVT
.*      SWA -    DSNT JCT JCTX JFCB JFCBE LCT SCT SIOT SCTX
.*      SWAM -   ZB502 ZB505 ZB506 QMPA
.*      SYS -    CVT ECB PSA CSD QCB QEL SCVT UCB UCM
.*      TASK -   SCB TCB TCT TIOT
.*      TSO -    CPPL ECT JSCB PSCB TSB UPT PPL IOPL
.*      VSAM -   ACB RPL
.*
.* --------------------------------------------------------------------
.*
.*      TO INCLUDE NEW DSECTS THE FOLLOWING STEPS ARE NECESSARY-
.*      1) DEFINE A GLOBAL SWITCH, FORMAT &RCPXXXX
.*      2) INSERT A SWITCH SETTING(S) FOR THE NEW SWITCH AS FOLLOWS
.*         &RCPXXXX SETB ('&O' EQ 'KEY' OR &RCPXXXX)
.*         WHERE KEY IS THE OPERAND WHICH REQUESTS THE DSECT
.*         ONE SETB IS REQUIRED FOR EACH KEY REQUIRED, EG. THE
.*         ACRONYM FOR THE DATA AREA, THE GENERIC NAME, AND ANY ALIASES
.*      3) DETERMINE WHERE IN THE ASSEMBLY YOU WANT THE DSECT TO APPEAR
.*         AND INSERT THE FOLLOWING STATEMENTS-
.*                  AIF   (NOT &RCPXXXX AND NOT &ALL).NOXXXX
.*                  TITLE 'DATA AREA NAME'
.*         XXXX     DSECT (IF NECESSARY)
.*                  DSECTMACRONAME LIST=&LIST (IFNECESSARY)
.*         .NOXXXX  ANOP
.*
.* --------------------------------------------------------------------
         GBLB  &RCPACB(2)
         GBLB  &RCPACEE(2)
         GBLB  &RCPALLC(2)
         GBLB  &RCPASCB(2)
         GBLB  &RCPASVT(2)
         GBLB  &RCPASXB(2)
         GBLB  &RCPATB(2)
         GBLB  &RCPATCH(2)
         GBLB  &RCPBASE(2)
         GBLB  &RCPCDE(2)
         GBLB  &RCPCIB(2)
         GBLB  &RCPCPAB(2)
         GBLB  &RCPCPPL(2)
         GBLB  &RCPCSCB(2)
         GBLB  &RCPCSD(2)
         GBLB  &RCPCSPL(2)
         GBLB  &RCPCTLG(2)
         GBLB  &RCPCVAF(2)
         GBLB  &RCPCVT(2)
         GBLB  &RCPDCB(2)
         GBLB  &RCPDCVT(2)
         GBLB  &RCPDEB(2)
         GBLB  &RCPDECB(2)
         GBLB  &RCPDSAB(2)
         GBLB  &RCPDSCB(2)
         GBLB  &RCPDSNT(2)
         GBLB  &RCPDTCB(2)
         GBLB  &RCPECB(2)
         GBLB  &RCPECT(2)
         GBLB  &RCPEDT(2)
         GBLB  &RCPFRRS(2)
         GBLB  &RCPGDA(2)
         GBLB  &RCPIOB(2)
         GBLB  &RCPIOBE(2)
         GBLB  &RCPIOPL(2)
         GBLB  &RCPIOSB(2)
         GBLB  &RCPIPIB(2)
         GBLB  &RCPIQE(2)
         GBLB  &RCPJCT(2)
         GBLB  &RCPJCTX(2)
         GBLB  &RCPJES(2)
         GBLB  &RCPJFCB(2)
         GBLB  &RCPJFCX(2)
         GBLB  &RCPJMR(2)
         GBLB  &RCPJMUD(2)
         GBLB  &RCPJSCB(2)
         GBLB  &RCPLCCA(2)
         GBLB  &RCPLCCT(2)
         GBLB  &RCPLCT(2)
         GBLB  &RCPLDA(2)
         GBLB  &RCPLLE(2)
         GBLB  &RCPLPDE(2)
         GBLB  &RCPOUCB(2)
         GBLB  &RCPOUXB(2)
         GBLB  &RCPPCCA(2)
         GBLB  &RCPPCCB(2)
         GBLB  &RCPPCCT(2)
         GBLB  &RCPPPL(2)
         GBLB  &RCPPSA(2)
         GBLB  &RCPPSCB(2)
         GBLB  &RCPQCB(2)
         GBLB  &RCPQEL(2)
         GBLB  &RCPQMPA(2)
         GBLB  &RCPRB(2)
         GBLB  &RCPRPL(2)
         GBLB  &RCPRQE(2)
         GBLB  &RCPSCB(2)
         GBLB  &RCPSCT(2)
         GBLB  &RCPSCTX(2)
         GBLB  &RCPSCVT(2)
         GBLB  &RCPSDWA(2)
         GBLB  &RCPSIOT(2)
         GBLB  &RCPSMCA(2)
         GBLB  &RCPSRB(2)
         GBLB  &RCPSSS(2)
         GBLB  &RCPSSAT(2)
         GBLB  &RCPSVT(2)
         GBLB  &RCPSWB(2)
         GBLB  &RCPTCB(2)
         GBLB  &RCPTCT(2)
         GBLB  &RCPTIOT(2)
         GBLB  &RCPTSB(2)
         GBLB  &RCPUCB(2)
         GBLB  &RCPUCBG(2)
         GBLB  &RCPUCM(2)
         GBLB  &RCPUPT(2)
         GBLB  &RCPWPL(2)
         GBLB  &RCPWQE(2)
         GBLB  &RCPWSVT(2)
         GBLB  &RCPXL(2)
         GBLB  &RCPZ502(2)
         GBLB  &RCPZ505(2)
         GBLB  &RCPZ506(2)
.*
         LCLA  &OP
         LCLC  &O
         LCLB  &ALL,&PRT
&PRT     SETB  ('&LIST' EQ 'YES')
&ALL     SETB  (N'&SYSLIST EQ 1 AND '&SYSLIST(1)' EQ 'ALL')
         AIF   (&ALL).DSE0200
.DSE0100 AIF   (&OP EQ N'&SYSLIST).DSE0200
&OP      SETA  &OP+1
&O       SETC  '&SYSLIST(&OP)'
.*
.*  SET UP REQUESTED CONTROL SWITCHES
.*
&RCPACB(1)  SETB ('&O' EQ 'ACB'   OR '&O' EQ 'VSAM' OR &RCPACB(1))
&RCPACB(1)  SETB ('&O' EQ 'DM'    OR &RCPACB(1))
&RCPACB(1)  SETB ('&O' EQ 'IO'    OR &RCPACB(1))
&RCPACEE(1) SETB ('&O' EQ 'ACEE'  OR &RCPACEE(1))
&RCPALLC(1) SETB ('&O' EQ 'ALLOC' OR '&O' EQ 'ALLOCX' OR &RCPALLC(1))
&RCPASCB(1) SETB ('&O' EQ 'ASCB'  OR &RCPASCB(1))
&RCPASCB(1) SETB ('&O' EQ 'JOB'   OR &RCPASCB(1))
&RCPASVT(1) SETB ('&O' EQ 'ASVT'  OR &RCPASVT(1))
&RCPASXB(1) SETB ('&O' EQ 'ASXB'  OR &RCPASXB(1))
&RCPASXB(1) SETB ('&O' EQ 'JOB'   OR &RCPASXB(1))
&RCPATB(1)  SETB ('&O' EQ 'ATB'   OR &RCPATB(1))
&RCPATCH(1) SETB ('&O' EQ 'ATTCH' OR &RCPATCH(1))
&RCPBASE(1) SETB ('&O' EQ 'BASEA' OR &RCPBASE(1))
&RCPBASE(1) SETB ('&O' EQ 'MSRDA' OR &RCPBASE(1))
&RCPCDE(1)  SETB ('&O' EQ 'CDE'   OR &RCPCDE(1))
&RCPCDE(1)  SETB ('&O' EQ 'PROG'  OR &RCPCDE(1))
&RCPCIB(1)  SETB ('&O' EQ 'CIB'   OR &RCPCIB(1))
&RCPCIB(1)  SETB ('&O' EQ 'JOB'   OR &RCPCIB(1))
&RCPCPAB(1) SETB ('&O' EQ 'CPAB'  OR &RCPCPAB(1))
&RCPCPPL(1) SETB ('&O' EQ 'CPPL'  OR &RCPCPPL(1))
&RCPCPPL(1) SETB ('&O' EQ 'TSO'   OR &RCPCPPL(1))
&RCPCSCB(1) SETB ('&O' EQ 'CSCB'  OR &RCPCSCB(1))
&RCPCSCB(1) SETB ('&O' EQ 'JOB'   OR &RCPCSCB(1))
&RCPCSD(1)  SETB ('&O' EQ 'CSD'   OR &RCPCSD(1))
&RCPCSD(1)  SETB ('&O' EQ 'SYS'   OR &RCPCSD(1))
&RCPCSPL(1) SETB ('&O' EQ 'CSOA'  OR &RCPCSPL(1))
&RCPCSPL(1) SETB ('&O' EQ 'CSPL'  OR &RCPCSPL(1))
&RCPCSPL(1) SETB ('&O' EQ 'TSO'   OR &RCPCSPL(1))
&RCPCTLG(1) SETB ('&O' EQ 'CATLG' OR &RCPCTLG(1))
&RCPCTLG(1) SETB ('&O' EQ 'CTLG'  OR &RCPCTLG(1))
&RCPCVAF(1) SETB ('&O' EQ 'CVAF'  OR &RCPCVAF(1))
&RCPCVT(1)  SETB ('&O' EQ 'CVT'   OR &RCPCVT(1))
&RCPCVT(1)  SETB ('&O' EQ 'SYS'   OR &RCPCVT(1))
&RCPDCB(1)  SETB ('&O' EQ 'DCB'   OR &RCPDCB(1))
&RCPDCB(1)  SETB ('&O' EQ 'DM'    OR &RCPDCB(1))
&RCPDCB(1)  SETB ('&O' EQ 'IO'    OR &RCPDCB(1))
&RCPDCVT(1) SETB ('&O' EQ 'SYS'   OR &RCPDCVT(1))
&RCPDEB(1)  SETB ('&O' EQ 'DEB'   OR &RCPDEB(1))
&RCPDEB(1)  SETB ('&O' EQ 'DM'    OR &RCPDEB(1))
&RCPDEB(1)  SETB ('&O' EQ 'IO'    OR &RCPDEB(1))
&RCPDECB(1) SETB ('&O' EQ 'DECB'  OR &RCPDECB(1))
&RCPDECB(1) SETB ('&O' EQ 'DM'    OR &RCPDECB(1))
&RCPDECB(1) SETB ('&O' EQ 'IO'    OR &RCPDECB(1))
&RCPDSAB(1) SETB ('&O' EQ 'DM'    OR &RCPDSAB(1))
&RCPDSAB(1) SETB ('&O' EQ 'DSAB'  OR &RCPDSAB(1))
&RCPDSCB(1) SETB ('&O' EQ 'DM'    OR &RCPDSCB(1))
&RCPDSCB(1) SETB ('&O' EQ 'DSCB'  OR &RCPDSCB(1))
&RCPDSNT(1) SETB ('&O' EQ 'DSNT'  OR &RCPDSNT(1))
&RCPDSNT(1) SETB ('&O' EQ 'SWA'   OR &RCPDSNT(1))
&RCPECB(1)  SETB ('&O' EQ 'ECB'   OR &RCPECB(1))
&RCPECB(1)  SETB ('&O' EQ 'IO'    OR &RCPECB(1))
&RCPECB(1)  SETB ('&O' EQ 'JOB'   OR &RCPECB(1))
&RCPECB(1)  SETB ('&O' EQ 'SYS'   OR &RCPECB(1))
&RCPECT(1)  SETB ('&O' EQ 'ECT'   OR &RCPECT(1))
&RCPECT(1)  SETB ('&O' EQ 'TSO'   OR &RCPECT(1))
&RCPEDT(1)  SETB ('&O' EQ 'EDT'   OR &RCPEDT(1))
&RCPFRRS(1) SETB ('&O' EQ 'FRRS'  OR &RCPFRRS(1))
&RCPGDA(1)  SETB ('&O' EQ 'GDA'   OR &RCPGDA(1))
&RCPIOB(1)  SETB ('&O' EQ 'DM'    OR &RCPIOB(1))
&RCPIOB(1)  SETB ('&O' EQ 'IO'    OR &RCPIOB(1))
&RCPIOB(1)  SETB ('&O' EQ 'IOB'   OR &RCPIOB(1))
&RCPIOBE(1) SETB ('&O' EQ 'IO'    OR &RCPIOBE(1))
&RCPIOBE(1) SETB ('&O' EQ 'IOBE'  OR &RCPIOBE(1))
&RCPIOPL(1) SETB ('&O' EQ 'IOPL'  OR &RCPIOPL(1))
&RCPIOPL(1) SETB ('&O' EQ 'TSO'   OR &RCPIOPL(1))
&RCPIOSB(1) SETB ('&O' EQ 'IOSB'  OR &RCPIOSB(1))
&RCPIPIB(1) SETB ('&O' EQ 'IPIB'  OR &RCPIPIB(1))
&RCPIQE(1)  SETB ('&O' EQ 'IQE'   OR &RCPIQE(1))
&RCPJCT(1)  SETB ('&O' EQ 'JCT'   OR &RCPJCT(1))
&RCPJCT(1)  SETB ('&O' EQ 'SWA'   OR &RCPJCT(1))
&RCPJCTX(1) SETB ('&O' EQ 'JCTX'  OR &RCPJCTX(1))
&RCPJCTX(1) SETB ('&O' EQ 'SWA'   OR &RCPJCTX(1))
&RCPJES(1)  SETB ('&O' EQ 'JESCT' OR &RCPJES(1))
&RCPJFCB(1) SETB ('&O' EQ 'DM'    OR &RCPJFCB(1))
&RCPJFCB(1) SETB ('&O' EQ 'IO'    OR &RCPJFCB(1))
&RCPJFCB(1) SETB ('&O' EQ 'JFCB'  OR &RCPJFCB(1))
&RCPJFCB(1) SETB ('&O' EQ 'SWA'   OR &RCPJFCB(1))
&RCPJFCX(1) SETB ('&O' EQ 'DM'    OR &RCPJFCX(1))
&RCPJFCX(1) SETB ('&O' EQ 'IO'    OR &RCPJFCX(1))
&RCPJFCX(1) SETB ('&O' EQ 'JFCBE' OR &RCPJFCX(1))
&RCPJFCX(1) SETB ('&O' EQ 'JFCBX' OR &RCPJFCX(1))
&RCPJFCX(1) SETB ('&O' EQ 'SWA'   OR &RCPJFCX(1))
&RCPJMR(1)  SETB ('&O' EQ 'JMR'   OR &RCPJMR(1))
&RCPJMR(1)  SETB ('&O' EQ 'JOB'   OR &RCPJMR(1))
&RCPJSCB(1) SETB ('&O' EQ 'JOB'   OR &RCPJSCB(1))
&RCPJSCB(1) SETB ('&O' EQ 'JSCB'  OR &RCPJSCB(1))
&RCPJSCB(1) SETB ('&O' EQ 'TSO'   OR &RCPJSCB(1))
&RCPLCCA(1) SETB ('&O' EQ 'LCCA'  OR &RCPLCCA(1))
&RCPLCCT(1) SETB ('&O' EQ 'LCCAT' OR &RCPLCCT(1))
&RCPLCT(1)  SETB ('&O' EQ 'LCT'   OR &RCPLCT(1))
&RCPLCT(1)  SETB ('&O' EQ 'SWA'   OR &RCPLCT(1))
&RCPLDA(1)  SETB ('&O' EQ 'LDA'   OR &RCPLDA(1))
&RCPLLE(1)  SETB ('&O' EQ 'LLE'   OR &RCPLLE(1))
&RCPLLE(1)  SETB ('&O' EQ 'PROG'  OR &RCPLLE(1))
&RCPLPDE(1) SETB ('&O' EQ 'LPDE'  OR &RCPLPDE(1))
&RCPLPDE(1) SETB ('&O' EQ 'PROG'  OR &RCPLPDE(1))
&RCPOUCB(1) SETB ('&O' EQ 'OUCB'  OR &RCPOUCB(1))
&RCPOUXB(1) SETB ('&O' EQ 'OUXB'  OR &RCPOUXB(1))
&RCPPCCA(1) SETB ('&O' EQ 'PCCA'  OR &RCPPCCA(1))
&RCPPCCB(1) SETB ('&O' EQ 'PCCB'  OR &RCPPCCB(1))
&RCPPCCT(1) SETB ('&O' EQ 'PCCAT' OR &RCPPCCT(1))
&RCPPPL(1)  SETB ('&O' EQ 'PPL'   OR &RCPPPL(1))
&RCPPPL(1)  SETB ('&O' EQ 'TSO'   OR &RCPPPL(1))
&RCPPSA(1)  SETB ('&O' EQ 'PSA'   OR &RCPPSA(1))
&RCPPSA(1)  SETB ('&O' EQ 'SYS'   OR &RCPPSA(1))
&RCPPSCB(1) SETB ('&O' EQ 'PSCB'  OR &RCPPSCB(1))
&RCPPSCB(1) SETB ('&O' EQ 'TSO'   OR &RCPPSCB(1))
&RCPQCB(1)  SETB ('&O' EQ 'ENQ'   OR &RCPQCB(1))
&RCPQCB(1)  SETB ('&O' EQ 'QCB'   OR &RCPQCB(1))
&RCPQCB(1)  SETB ('&O' EQ 'SYS'   OR &RCPQCB(1))
&RCPQEL(1)  SETB ('&O' EQ 'ENQ'   OR &RCPQEL(1))
&RCPQEL(1)  SETB ('&O' EQ 'QEL'   OR &RCPQEL(1))
&RCPQEL(1)  SETB ('&O' EQ 'SYS'   OR &RCPQEL(1))
&RCPQMPA(1) SETB ('&O' EQ 'QMPA'  OR &RCPQMPA(1))
&RCPQMPA(1) SETB ('&O' EQ 'SWAM'  OR &RCPQMPA(1))
&RCPRB(1)   SETB ('&O' EQ 'PROG'  OR &RCPRB(1))
&RCPRB(1)   SETB ('&O' EQ 'RB'    OR &RCPRB(1))
&RCPRPL(1)  SETB ('&O' EQ 'DM'    OR &RCPRPL(1))
&RCPRPL(1)  SETB ('&O' EQ 'IO'    OR &RCPRPL(1))
&RCPRPL(1)  SETB ('&O' EQ 'RPL'   OR '&O' EQ 'VSAM' OR &RCPRPL(1))
&RCPRQE(1)  SETB ('&O' EQ 'IO'    OR &RCPRQE(1))
&RCPRQE(1)  SETB ('&O' EQ 'RQE'   OR &RCPRQE(1))
&RCPSCB(1)  SETB ('&O' EQ 'SCB'   OR &RCPSCB(1))
&RCPSCB(1)  SETB ('&O' EQ 'TASK'  OR &RCPSCB(1))
&RCPSCT(1)  SETB ('&O' EQ 'SCT'   OR &RCPSCT(1))
&RCPSCT(1)  SETB ('&O' EQ 'SWA'   OR &RCPSCT(1))
&RCPSCTX(1) SETB ('&O' EQ 'SCTX'  OR &RCPSCTX(1))
&RCPSCTX(1) SETB ('&O' EQ 'SWA'   OR &RCPSCTX(1))
&RCPSCVT(1) SETB ('&O' EQ 'SCVT'  OR &RCPSCVT(1))
&RCPSCVT(1) SETB ('&O' EQ 'SYS'   OR &RCPSCVT(1))
&RCPSDWA(1) SETB ('&O' EQ 'SDWA'  OR &RCPSDWA(1))
&RCPSIOT(1) SETB ('&O' EQ 'SIOT'  OR &RCPSIOT(1))
&RCPSIOT(1) SETB ('&O' EQ 'SWA'   OR &RCPSIOT(1))
&RCPSMCA(1) SETB ('&O' EQ 'SMCA'  OR &RCPSMCA(1))
&RCPSMCA(1) SETB ('&O' EQ 'SMF'   OR &RCPSMCA(1))
&RCPSRB(1)  SETB ('&O' EQ 'SRB'   OR &RCPSRB(1))
&RCPSSAT(1) SETB ('&O' EQ 'SSAT'  OR &RCPSSAT(1))
&RCPSSS(1)  SETB ('&O' EQ 'SSCT'  OR &RCPSSS(1))
&RCPSSS(1)  SETB ('&O' EQ 'SSIB'  OR &RCPSSS(1))
&RCPSSS(1)  SETB ('&O' EQ 'SSOB'  OR &RCPSSS(1))
&RCPSSS(1)  SETB ('&O' EQ 'SSVT'  OR &RCPSSS(1))
&RCPSSS(1)  SETB ('&O' EQ 'SUBSYS' OR &RCPSSS(1))
&RCPSVT(1)  SETB ('&O' EQ 'SVT'   OR &RCPSVT(1))
&RCPSWB(1)  SETB ('&O' EQ 'SWB'   OR &RCPSWB(1))
&RCPTCB(1)  SETB ('&O' EQ 'TASK'  OR &RCPTCB(1))
&RCPTCB(1)  SETB ('&O' EQ 'TCB'   OR &RCPTCB(1))
&RCPTCT(1)  SETB ('&O' EQ 'JOB'   OR &RCPTCT(1))
&RCPTCT(1)  SETB ('&O' EQ 'TASK'  OR &RCPTCT(1))
&RCPTCT(1)  SETB ('&O' EQ 'TCT'   OR &RCPTCT(1))
&RCPTIOT(1) SETB ('&O' EQ 'DM'    OR &RCPTIOT(1))
&RCPTIOT(1) SETB ('&O' EQ 'IO'    OR &RCPTIOT(1))
&RCPTIOT(1) SETB ('&O' EQ 'JOB'   OR &RCPTIOT(1))
&RCPTIOT(1) SETB ('&O' EQ 'TASK'  OR &RCPTIOT(1))
&RCPTIOT(1) SETB ('&O' EQ 'TIOT'  OR &RCPTIOT(1))
&RCPTSB(1)  SETB ('&O' EQ 'TSB'   OR &RCPTSB(1))
&RCPTSB(1)  SETB ('&O' EQ 'TSO'   OR &RCPTSB(1))
&RCPUCB(1)  SETB ('&O' EQ 'IO'    OR &RCPUCB(1))
&RCPUCB(1)  SETB ('&O' EQ 'SYS'   OR &RCPUCB(1))
&RCPUCB(1)  SETB ('&O' EQ 'UCB'   OR &RCPUCB(1))
&RCPUCBG(1) SETB ('&O' EQ 'IOCM'  OR &RCPUCBG(1))
&RCPUCBG(1) SETB ('&O' EQ 'IOCOM' OR &RCPUCBG(1))
&RCPUCBG(1) SETB ('&O' EQ 'UCBLOOK' OR &RCPUCBG(1))
&RCPUCM(1)  SETB ('&O' EQ 'SYS'   OR &RCPUCM(1))
&RCPUCM(1)  SETB ('&O' EQ 'UCM'   OR &RCPUCM(1))
&RCPUPT(1)  SETB ('&O' EQ 'TSO'   OR &RCPUPT(1))
&RCPUPT(1)  SETB ('&O' EQ 'UPT'   OR &RCPUPT(1))
&RCPWPL(1)  SETB ('&O' EQ 'WPL'   OR &RCPWPL(1))
&RCPWQE(1)  SETB ('&O' EQ 'WQE'   OR &RCPWQE(1))
&RCPWSVT(1) SETB ('&O' EQ 'WSAVT' OR &RCPWSVT(1))
&RCPXL(1)   SETB ('&O' EQ 'PROG'  OR &RCPXL(1))
&RCPXL(1)   SETB ('&O' EQ 'XL'    OR &RCPXL(1))
&RCPZ502(1) SETB ('&O' EQ 'SWAM'  OR &RCPZ502(1))
&RCPZ502(1) SETB ('&O' EQ 'ZB502' OR &RCPZ502(1))
&RCPZ505(1) SETB ('&O' EQ 'EPA'   OR &RCPZ505(1))
&RCPZ505(1) SETB ('&O' EQ 'SWAM'  OR &RCPZ505(1))
&RCPZ505(1) SETB ('&O' EQ 'ZB505' OR &RCPZ505(1))
&RCPZ506(1) SETB ('&O' EQ 'EPA'   OR &RCPZ506(1))
&RCPZ506(1) SETB ('&O' EQ 'SWAM'  OR &RCPZ506(1))
&RCPZ506(1) SETB ('&O' EQ 'ZB506' OR &RCPZ506(1))
         AGO   .DSE0100
.*
.*  SET UP DEPENDENCIES
.*
.DSE0200    ANOP  ,
&RCPASCB(1) SETB (&RCPASCB(1) OR &RCPASXB(1))     ASXB  -->  ASCB
&RCPCSCB(1) SETB (&RCPCSCB(1) OR &RCPCIB(1))      CIB   -->  CSCB
&RCPCVT(1)  SETB (&RCPCVT(1)  OR &RCPEDT(1))      EDT   -->  CVT
&RCPCVT(1)  SETB (&RCPCVT(1)  OR &RCPQMPA(1))     QMPA  -->  CVT
&RCPCVT(1)  SETB (&RCPCVT(1)  OR &RCPSCVT(1))     SCVT  -->  CVT
&RCPCVT(1)  SETB (&RCPCVT(1)  OR &RCPZ505(1))     ZB505 -->  CVT
&RCPCVT(1)  SETB (&RCPCVT(1)  OR &RCPZ506(1))     ZB506 -->  CVT
&RCPJES(1)  SETB (&RCPJES(1)  OR &RCPEDT(1))      EDT   -->  JESCT
&RCPJES(1)  SETB (&RCPJES(1)  OR &RCPQMPA(1))     QMPA  -->  JESCT
&RCPJES(1)  SETB (&RCPJES(1)  OR &RCPSSS(1))      SUBSYS-->  JESCT
&RCPJES(1)  SETB (&RCPJES(1)  OR &RCPZ505(1))     ZB505 -->  JESCT
&RCPJES(1)  SETB (&RCPJES(1)  OR &RCPZ506(1))     ZB506 -->  JESCT
&RCPJFCB(1) SETB (&RCPJFCB(1) OR &RCPJFCX(1))     JFCBX -->  JFCB
&RCPLCCA(1) SETB (&RCPLCCA(1) OR &RCPLCCT(1))     LCCAT -->  LCCA
&RCPOUCB(1) SETB (&RCPOUCB(1) OR &RCPOUXB(1))     OUXB  -->  OUCB
&RCPPCCA(1) SETB (&RCPLCCA(1) OR &RCPPCCT(1))     PCCAT -->  PCCA
&RCPPSA(1)  SETB (&RCPPSA(1)  OR &RCPJMR(1))      JMR   -->  PSA
&RCPTCB(1)  SETB (&RCPTCB(1)  OR &RCPTCT(1))      TCT   -->  TCB
&RCPTCT(1)  SETB (&RCPTCT(1)  OR &RCPJMR(1))      JMR   -->  TCT
.*
         AIF   ('&TYPE' EQ '').DSE0300
         AIF   ('&TYPE' EQ 'DEFER        '(1,K'&TYPE)).DSE0500
.DSE0300 ANOP  ,
         AIF   (&PRT).DSE0400
         PUSH  PRINT
         PRINT OFF
.DSE0400 ANOP  ,
         AIF   (NOT &RCPPSA(1) AND NOT &ALL OR &RCPPSA(2)).NOPSA
&RCPPSA(2) SETB 1
         TITLE 'PREFIXED SAVE AREA'
PSA      DSECT ,
*        IHAPSA LIST=YES
         IHAPSA LIST=YES
.NOPSA   ANOP  ,
         AIF   (NOT &RCPCSD(1) AND NOT &ALL OR &RCPCSD(2)).NOCSD
&RCPCSD(2) SETB 1
         TITLE 'COMMON SYSTEM DATA AREA'
*        IHACSD ,
         IHACSD ,
.NOCSD   ANOP  ,
         AIF   (NOT &RCPSSAT(1) AND NOT &ALL OR &RCPSSAT(2)).NOSSAT
&RCPSSAT(2) SETB 1
         TITLE 'SUB SYSTEM AFFINITY TABLE'
*        IHASSAT ,
         IHASSAT ,
.NOSSAT  ANOP  ,
         AIF   (NOT &RCPSVT(1) AND NOT &ALL OR &RCPSVT(2)).NOSVT
&RCPSVT(2) SETB 1
         TITLE 'SUPERVISOR VECTOR TABLE'
*        IHASVT ,
         IHASVT ,
.NOSVT   ANOP  ,
         AIF   (NOT &RCPSWB(1) AND NOT &ALL OR &RCPSWB(2)).NOSWB
&RCPSWB(2) SETB 1
*        IEFSWB ,
         IEFSWB ,
.NOSWB   ANOP  ,
         AIF   (NOT &RCPLCCA(1) AND NOT &ALL OR &RCPLCCA(2)).NOLCCA
&RCPLCCA(2) SETB 1
         TITLE 'LOGICAL CONFIGURATION COMMUNICATION AREA'
*        IHALCCA ,
         IHALCCA ,
.NOLCCA  ANOP  ,
         AIF   (NOT &RCPLCCT(1) AND NOT &ALL OR &RCPLCCT(2)).NOLCCT
&RCPLCCT(2) SETB 1
         TITLE 'LCCA VECTOR TABLE'
*        IHALCCAT ,
         IHALCCAT ,
LCCATEND EQU   *
.NOLCCT  ANOP  ,
         AIF   (NOT &RCPPCCA(1) AND NOT &ALL OR &RCPPCCA(2)).NOPCCA
&RCPPCCA(2) SETB 1
         TITLE 'PHYSICAL CONFIGURATION COMMUNICATION AREA'
*        IHAPCCA ,
         IHAPCCA ,
.NOPCCA  ANOP  ,
         AIF   (NOT &RCPPCCB(1) AND NOT &ALL OR &RCPPCCB(2)).NOPCCB
&RCPPCCB(2) SETB 1
*        IEFPCCB ,
         IEFPCCB ,
.NOPCCB  ANOP  ,
         AIF   (NOT &RCPPCCT(1) AND NOT &ALL OR &RCPPCCT(2)).NOPCCT
&RCPPCCT(2) SETB 1
         TITLE 'PCCA VECTOR TABLE'
*        IHAPCCAT ,
         IHAPCCAT ,
PCCATEND EQU   *
.NOPCCT  ANOP  ,
         AIF   (NOT &RCPGDA(1) AND NOT &ALL OR &RCPGDA(2)).NOGDA
&RCPGDA(2) SETB 1
         TITLE 'VSM GLOBAL DATA AREA'
*        IHAGDA ,
         IHAGDA ,
.NOGDA   ANOP  ,
         AIF   (NOT &RCPLDA(1) AND NOT &ALL OR &RCPLDA(2)).NOLDA
&RCPLDA(2) SETB 1
         TITLE 'VSM LOCAL DATA AREA'
*        IHALDA ,
         IHALDA ,
.NOLDA   ANOP  ,
         AIF   (NOT &RCPCPAB(1) AND NOT &ALL OR &RCPCPAB(2)).NOCPAB
&RCPCPAB(2) SETB 1
         TITLE 'VSM CELL POOL ANCHOR BLOCK'
*        IHACPAB ,
         IHACPAB ,
.NOCPAB  ANOP  ,
         AIF   (NOT &RCPCVT(1) AND NOT &ALL OR &RCPCVT(2)).NOCVT
&RCPCVT(2) SETB 1
         TITLE 'COMMUNICATION VECTOR TABLE'
*        CVT   LIST=YES,DSECT=YES,PREFIX=YES
         CVT   LIST=YES,DSECT=YES,PREFIX=YES
CVT      EQU   CVTMAP
         IHAECVT LIST=YES,DSECT=YES
.NOCVT   ANOP  ,
         AIF   (NOT &RCPSCVT(1) AND NOT &ALL OR &RCPSCVT(2)).NOSCVT
&RCPSCVT(2) SETB 1
         TITLE 'SECONDARY COMMUNICATION VECTOR TABLE'
*        IHASCVT LIST=YES
         IHASCVT LIST=YES
.NOSCVT  ANOP  ,
         AIF   (NOT &RCPASCB(1) AND NOT &ALL OR &RCPASCB(2)).NOASCB
&RCPASCB(2) SETB 1
         TITLE 'ADDRESS SPACE CONTROL BLOCK'
*        IHAASCB ,
         IHAASCB ,
.NOASCB  ANOP  ,
         AIF   (NOT &RCPASXB(1) AND NOT &ALL OR &RCPASXB(2)).NOASXB
&RCPASXB(2) SETB 1
         TITLE 'ADDRESS SPACE EXTENSION BLOCK'
*        IHAASXB ,
         IHAASXB ,
.NOASXB  ANOP  ,
         AIF   (NOT &RCPASVT(1) AND NOT &ALL OR &RCPASVT(2)).NOASVT
&RCPASVT(2) SETB 1
         TITLE 'ADDRESS SPACE VECTOR TABLE'
*        IHAASVT ,
         IHAASVT ,
.NOASVT  ANOP  ,
         AIF   (NOT &RCPSRB(1) AND NOT &ALL OR &RCPSRB(2)).NOSRB
&RCPSRB(2) SETB 1
         TITLE 'SERVICE REQUEST BLOCK'
*        IHASRB ,
         IHASRB ,
.NOSRB   ANOP  ,
         AIF   (NOT &RCPTCB(1) AND NOT &ALL OR &RCPTCB(2)).NOTCB
&RCPTCB(2) SETB 1
         TITLE 'TASK CONTROL BLOCK'
*        IKJTCB LIST=YES
         IKJTCB LIST=YES
.NOTCB   ANOP  ,
         AIF   (NOT &RCPOUCB(1) AND NOT &ALL OR &RCPOUCB(2)).NOOUCB
&RCPOUCB(2) SETB 1
         TITLE 'SRM USER CONTROL BLOCK'
*        IRAOUCB ,
         IRAOUCB ,
.NOOUCB  ANOP  ,
         AIF   (NOT &RCPOUXB(1) AND NOT &ALL OR &RCPOUXB(2)).NOOUXB
&RCPOUXB(2) SETB 1
         TITLE 'SRM USER EXTENSION BLOCK'
*        IHAOUXB ,
         IHAOUXB ,
.NOOUXB  ANOP  ,
         AIF   (NOT &RCPSIOT(1) AND NOT &ALL OR &RCPSIOT(2)).NOSIOT
&RCPSIOT(2) SETB 1
         TITLE 'STEP INPUT/OUTPUT TABLE'
SIOT     DSECT ,
*        IEFASIOT ,
         IEFASIOT ,
.NOSIOT  ANOP  ,
         AIF   (NOT &RCPTIOT(1) AND NOT &ALL OR &RCPTIOT(2)).NOTIOT
&RCPTIOT(2) SETB 1
         TITLE 'TASK INPUT OUTPUT TABLE'
TIOT     DSECT ,
*        IEFTIOT1 ,
         IEFTIOT1 ,
.NOTIOT  ANOP  ,
         AIF   (NOT &RCPTCT(1) AND NOT &ALL OR &RCPTCT(2)).NOTCT
&RCPTCT(2) SETB 1
         TITLE 'TIMING CONTROL TABLE'
*        IEFTCT ,
         IEFTCT ,
.NOTCT   ANOP  ,
         AIF   (NOT &RCPLCT(1) AND NOT &ALL OR &RCPLCT(2)).NOLCT
&RCPLCT(2) SETB 1
         TITLE 'LINKAGE CONTROL TABLE'
LCT      DSECT ,
*        IEFALLCT ,
         IEFALLCT ,
.NOLCT   ANOP  ,
         AIF   (NOT &RCPSCT(1) AND NOT &ALL OR &RCPSCT(2)).NOSCT
&RCPSCT(2) SETB 1
         TITLE 'STEP CONTROL TABLE'
SCT      DSECT ,
*        IEFASCTB ,
         IEFASCTB ,
.NOSCT   ANOP  ,
         AIF   (NOT &RCPSCTX(1) AND NOT &ALL OR &RCPSCTX(2)).NOSCTX
&RCPSCTX(2) SETB 1
         TITLE 'STEP CONTROL TABLE EXTENSION'
SCTX     DSECT ,
*        IEFSCTX DSECT=NO
         IEFSCTX DSECT=NO
.NOSCTX  ANOP  ,
         AIF   (NOT &RCPJCT(1) AND NOT &ALL OR &RCPJCT(2)).NOJCT
&RCPJCT(2) SETB 1
         TITLE 'JOB CONTROL TABLE'
JCT      DSECT ,
*        IEFAJCTB ,
         IEFAJCTB ,
.NOJCT   ANOP  ,
         AIF   (NOT &RCPJCTX(1) AND NOT &ALL OR &RCPJCTX(2)).NOJCTX
&RCPJCTX(2) SETB 1
         TITLE 'JOB CONTROL TABLE EXTENSION'
JCTX     DSECT ,
*        IEFJCTX ,
         IEFJCTX ,
.NOJCTX  ANOP  ,
         AIF   (NOT &RCPJMR(1) AND NOT &ALL OR &RCPJMR(2)).NOJMR
&RCPJMR(2) SETB 1
         TITLE 'JOB MANAGEMENT RECORD'
*        IEFJMR ,
         IEFJMR ,
JMRCBLEN EQU    *-JMR
.NOJMR   ANOP  ,
         AIF   (NOT &RCPJSCB(1) AND NOT &ALL OR &RCPJSCB(2)).NOJSCB
&RCPJSCB(2) SETB 1
         TITLE 'JOB STEP CONTROL BLOCK'
*        IEZJSCB ,
         IEZJSCB ,
JSCB     EQU   IEZJSCB
.NOJSCB  ANOP  ,
         AIF   (NOT &RCPATCH(1) AND NOT &ALL OR &RCPATCH(2)).NOATTCH
&RCPATCH(2) SETB 1
         TITLE 'ATTACH (SVC 42) PARAMETER LIST'
*        IEZATTCH ,
         IEZATTCH ,
.NOATTCH ANOP  ,
         AIF   (NOT &RCPSCB(1) AND NOT &ALL OR &RCPSCB(2)).NOSCB
&RCPSCB(2) SETB 1
         TITLE 'STAE CONTROL BLOCK'
*        IHASCB ,
         IHASCB ,
.NOSCB   ANOP  ,
         AIF   (NOT &RCPSMCA(1) AND NOT &ALL OR &RCPSMCA(2)).NOSMCA
&RCPSMCA(2) SETB 1
         TITLE 'SYSTEM MANAGEMENT FACILITIES CONTROL AREA (SMCA)'
*        IEESMCA ,
         IEESMCA ,
SMCA     EQU   SMCABASE
.NOSMCA  ANOP  ,
         AIF   (NOT &RCPBASE(1) AND NOT &ALL OR &RCPBASE(2)).NOBASEA
&RCPBASE(2) SETB 1
         TITLE 'MASTER SCHEDULER RESIDENT DATA AREA (BASEA)'
*        IEEBASEA ,
         IEEBASEA ,
BASEA    EQU   BASE
.NOBASEA ANOP  ,
         AIF   (NOT &RCPCSCB(1) AND NOT &ALL OR &RCPCSCB(2)).NOCSCB
&RCPCSCB(2) SETB 1
         TITLE 'COMMAND SCHEDULING CONTROL BLOCK'
CSCB     DSECT ,
*        IEECHAIN ,
         IEECHAIN ,
.NOCSCB  ANOP  ,
         AIF   (NOT &RCPCIB(1) AND NOT &ALL OR &RCPCIB(2)).NOCIB
&RCPCIB(2) SETB 1
         TITLE 'COMMAND INPUT BUFFER'
CIB      DSECT ,
*        IEZCIB ,
         IEZCIB ,
.NOCIB   ANOP  ,
         AIF   (NOT &RCPECB(1) AND NOT &ALL OR &RCPECB(2)).NOECB
&RCPECB(2) SETB 1
         TITLE 'EVENT CONTROL BLOCK'
*        IHAECB ,
         IHAECB ,
.NOECB   ANOP  ,
         AIF   (NOT &RCPACB(1) AND NOT &ALL OR &RCPACB(2)).NOACB
&RCPACB(2) SETB 1
         TITLE 'ACCESS METHOD CONTROL BLOCK (ACB)'
*        IFGACB ,
         IFGACB ,
ACB      EQU   IFGACB
.NOACB   ANOP  ,
         AIF   (NOT &RCPACEE(1) AND NOT &ALL OR &RCPACEE(2)).NOACEE
&RCPACEE(2) SETB 1
         TITLE 'ACCESSOR ENVIRONMENT ELEMENT (ACEE)'
*        IHAACEE ,
         IHAACEE ,
.NOACEE  ANOP  ,
         AIF   (NOT &RCPRPL(1) AND NOT &ALL OR &RCPRPL(2)).NORPL
&RCPRPL(2) SETB 1
         TITLE 'REQUEST PARAMETER LIST'
*        IFGRPL ,
         IFGRPL ,
RPL      EQU   IFGRPL
.NORPL   ANOP  ,
         AIF   (NOT &RCPDCB(1) AND NOT &ALL OR &RCPDCB(2)).NODCB
&RCPDCB(2) SETB 1
         TITLE 'DATA CONTROL BLOCK'
*        DCBD  DSORG=(BX,DA,IS,PO,PS,XA,XE),DEVD=(BS,DA,RD,PC,PR,TA,WT)
         DCBD  DSORG=(BX,DA,IS,PO,PS,XA,XE),DEVD=(BS,DA,RD,PC,PR,TA,WT)
DCB      EQU   IHADCB
.NODCB   ANOP  ,
         AIF   (NOT &RCPDECB(1) AND NOT &ALL OR &RCPDECB(2)).NODECB
&RCPDECB(2) SETB 1
         TITLE 'DATA EVENT CONTROL BLOCK'
*        IHADECB ,                      (SUPPLANTS IECTDECB)
         IHADECB ,
IECTDECB EQU   DECB                     (DSECT NAME USED BY BTAM)
.NODECB  ANOP  ,
         AIF   (NOT &RCPJFCB(1) AND NOT &ALL OR &RCPJFCB(2)).NOJFCB
&RCPJFCB(2) SETB 1
         TITLE 'JOB FILE CONTROL BLOCK'
JFCB     DSECT ,
*        IEFJFCBN LIST=YES
         IEFJFCBN LIST=YES
.NOJFCB  ANOP  ,
         AIF   (NOT &RCPJFCX(1) AND NOT &ALL OR &RCPJFCX(2)).NOJFCBX
&RCPJFCX(2) SETB 1
         TITLE 'JOB FILE CONTROL BLOCK EXTENSION'
JFCBX    DSECT ,
*        IEFJFCBX ,
         IEFJFCBX ,
         EJECT ,
*        IEFJFCBE ,
         IEFJFCBE ,
.NOJFCBX ANOP  ,
         AIF   (NOT &RCPDEB(1) AND NOT &ALL OR &RCPDEB(2)).NODEB
&RCPDEB(2) SETB 1
         TITLE 'DATA EXTENT BLOCK'
*        IEZDEB LIST=YES
         IEZDEB LIST=YES
IECTDEB  EQU   DEB                      (DSECT NAME USED BY BTAM)
.*DEBSYSPG EQU   DEPOPATB+1,3,C'A'        (FROM IECTDEB MAPPING)
.NODEB   ANOP  ,
         AIF   (NOT &RCPIOB(1) AND NOT &ALL OR &RCPIOB(2)).NOIOB
&RCPIOB(2) SETB 1
         TITLE 'INPUT OUTPUT BLOCK'
*        IEZIOB ,
         IEZIOB ,
IECTIOB  EQU   IOBSTDRD                 (DSECT NAME USED BY BTAM)
.NOIOB   ANOP  ,
         AIF   (NOT &RCPIOBE(1) AND NOT &ALL OR &RCPIOBE(2)).NOIOBE
&RCPIOBE(2) SETB 1
         TITLE 'INPUT OUTPUT BLOCK EXTENSION'
*        IOSDIOBE ,
         IOSDIOBE ,
.NOIOBE  ANOP  ,
         AIF   (NOT &RCPIOSB(1) AND NOT &ALL OR &RCPIOSB(2)).NOIOSB
&RCPIOSB(2) SETB 1
         TITLE 'I/O SUPERVISOR BLOCK (IOSB)'
*        IECDIOSB ,
         IECDIOSB ,
.NOIOSB  ANOP  ,
         AIF   (NOT &RCPIPIB(1) AND NOT &ALL OR &RCPIPIB(2)).NOIPIB
&RCPIPIB(2) SETB 1
         TITLE 'I/O SUPERVISOR PURGE INTERFACE BLOCK (IPIB)'
*        IECDIPIB ,
         IECDIPIB ,
.NOIPIB  ANOP  ,
         AIF   (NOT &RCPATB(1) AND NOT &ALL OR &RCPATB(2)).NOATB
&RCPATB(2) SETB 1
         TITLE 'IOS ATTENTION TABLE'
*        IECDATB
         IECDATB ,
.NOATB   ANOP  ,
         AIF   (NOT &RCPUCBG(1) AND NOT &ALL OR &RCPUCBG(2)).NOUCBG
&RCPUCBG(2) SETB 1
         TITLE 'IOS COMMUNICATIONS AREA'
*        IECDIOCM
         IECDIOCM ,
.NOUCBG  ANOP  ,
         AIF   (NOT &RCPUCB(1) AND NOT &ALL OR &RCPUCB(2)).NOUCB
&RCPUCB(2) SETB 1
         TITLE 'UNIT CONTROL BLOCK'
*        IEFUCBOB LIST=YES,PREFIX=YES
         IEFUCBOB LIST=YES,PREFIX=YES
.NOUCB   ANOP  ,
         AIF   (NOT &RCPUCM(1) AND NOT &ALL OR &RCPUCM(2)).NOUCM
&RCPUCM(2) SETB 1
         TITLE 'UNIT CONTROL MODULE'
*        IEECUCM FORMAT=NEW,LIST=YES
         IEECUCM FORMAT=NEW,LIST=YES
.NOUCM   ANOP  ,
         AIF   (NOT &RCPWPL(1) AND NOT &ALL OR &RCPWPL(2)).NOWPL
&RCPWPL(2) SETB 1
         TITLE 'WRITE TO OPERATOR PARAMETER LIST'
*        IEZWPL
         IEZWPL ,
WPLRFLEN EQU   *-WPLRF
.NOWPL   ANOP  ,
         AIF   (NOT &RCPWQE(1) AND NOT &ALL OR &RCPWQE(2)).NOWQE
&RCPWQE(2) SETB 1
         TITLE 'WRITE TO OPERATOR QUEUE ELEMENT'
*        IHAWQE
         IHAWQE ,
.NOWQE   ANOP  ,
         AIF   (NOT &RCPRQE(1) AND NOT &ALL OR &RCPRQE(2)).NORQE
&RCPRQE(2) SETB 1
         TITLE 'REQUEST QUEUE ELEMENT'
*        IECDRQE ,
         IECDRQE ,
.NORQE   ANOP  ,
         AIF   (NOT &RCPDSCB(1) AND NOT &ALL OR &RCPDSCB(2)).NODSCB
&RCPDSCB(2) SETB 1
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 1'
DSCB     DSECT ,
         IECSDSL1 1
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 2'
         ORG   DSCB
         IECSDSL1 2
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 3'
         ORG   DSCB
         IECSDSL1 3
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 4'
         ORG   DSCB
         DS    XL44                     KEY
         IECSDSL1 4
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 5'
         ORG   DSCB
         IECSDSL1 5
         TITLE 'DATA SET CONTROL BLOCK - FORMAT 6'
         ORG   DSCB
         IECSDSL1 6
.NODSCB  ANOP  ,
         AIF   (NOT &RCPDSNT(1) AND NOT &ALL OR &RCPDSNT(2)).NODSNT
&RCPDSNT(2) SETB 1
         TITLE 'DATA SET NAME TABLE'
DSNT     DSECT ,
*        IEFDSNT ,
         IEFDSNT ,
.NODSNT  ANOP  ,
         AIF   (NOT &RCPDSAB(1) AND NOT &ALL OR &RCPDSAB(2)).NODSAB
&RCPDSAB(2) SETB 1
         TITLE 'DSAB QUEUE DESCRIPTOR BLOCK'
*        IEFZB4D5 ,
         IEFZB4D5 ,
         TITLE 'DATA SET ASSOCIATION BLOCK'
*        IHADSAB ,
         IHADSAB ,
.NODSAB  ANOP  ,
         AIF   (NOT &RCPRB(1) AND NOT &ALL OR &RCPRB(2)).NORB
&RCPRB(2) SETB 1
         TITLE 'REQUEST BLOCK'
*        IHARB ,
         IHARB ,
.NORB    ANOP  ,
         AIF   (NOT &RCPIQE(1) AND NOT &ALL OR &RCPIQE(2)).NOIQE
&RCPIQE(2) SETB 1
         TITLE 'INTERRUPTION QUEUE ELEMENT'
*        IHAIQE ,
         IHAIQE ,
IQE      EQU   IQESECT
.NOIQE   ANOP  ,
         AIF   (NOT &RCPCDE(1) AND NOT &ALL OR &RCPCDE(2)).NOCDE
&RCPCDE(2) SETB 1
         TITLE 'CONTENTS DIRECTORY ENTRY'
*        IHACDE ,
         IHACDE ,
.NOCDE   ANOP  ,
         AIF   (NOT &RCPLPDE(1) AND NOT &ALL OR &RCPLPDE(2)).NOLPDE
&RCPLPDE(2) SETB 1
         TITLE 'LINK PACK DIRECTORY ENTRY'
*        IHALPDE ,
         IHALPDE ,
.NOLPDE  ANOP  ,
         AIF   (NOT &RCPLLE(1) AND NOT &ALL OR &RCPLLE(2)).NOLLE
&RCPLLE(2) SETB 1
         TITLE 'LOAD LIST ELEMENT'
*        IHALLE ,
         IHALLE ,
.NOLLE   ANOP  ,
         AIF   (NOT &RCPXL(1) AND NOT &ALL OR &RCPXL(2)).NOXL
&RCPXL(2) SETB 1
         TITLE 'EXTENT LIST'
*        IHAXTLST ,
         IHAXTLST ,
.NOXL    ANOP  ,
         AIF   (NOT &RCPQCB(1) AND NOT &ALL OR &RCPQCB(2)).NOQCB
&RCPQCB(2) SETB 1
         TITLE 'GRS QUEUE CONTROL BLOCK'
*        ISGQCB ,
         ISGQCB ,
.NOQCB   ANOP  ,
         AIF   (NOT &RCPQEL(1) AND NOT &ALL OR &RCPQEL(2)).NOQEL
&RCPQEL(2) SETB 1
         TITLE 'GRS QUEUE ELEMENT'
*        ISGQEL ,
         ISGQEL ,
.NOQEL   ANOP  ,
         AIF   (NOT &RCPPSCB(1) AND NOT &ALL OR &RCPPSCB(2)).NOPSCB
&RCPPSCB(2) SETB 1
         TITLE 'PROTECTED STEP CONTROL BLOCK'
*        IKJPSCB ,
         IKJPSCB ,
.NOPSCB  ANOP  ,
         AIF   (NOT &RCPECT(1) AND NOT &ALL OR &RCPECT(2)).NOECT
&RCPECT(2) SETB 1
         TITLE 'ENVIRONMENT CONTROL TABLE'
*        IKJECT ,
         IKJECT ,
ECTLEN   EQU   *-ECT
.NOECT   ANOP  ,
         AIF   (NOT &RCPUPT(1) AND NOT &ALL OR &RCPUPT(2)).NOUPT
&RCPUPT(2) SETB 1
         TITLE 'USER PROFILE TABLE'
*        IKJUPT ,
         IKJUPT ,
UPTLNGTH EQU   *-UPT
.NOUPT   ANOP  ,
         AIF   (NOT &RCPSDWA(1) AND NOT &ALL OR &RCPSDWA(2)).NOSDWA
&RCPSDWA(2) SETB 1
         TITLE 'SYSTEM DIAGNOSTIC WORK AREA'
*        IHASDWA ,
         IHASDWA ,
.NOSDWA  ANOP  ,
         AIF   (NOT &RCPFRRS(1) AND NOT &ALL OR &RCPFRRS(2)).NOFRRS
&RCPFRRS(2) SETB 1
         TITLE 'FUNCTION RECOVERY ROUTINE (FRR) STACK'
*        IHAFRRS ,
         IHAFRRS ,
.NOFRRS  ANOP  ,
         AIF   (NOT &RCPWSVT(1) AND NOT &ALL OR &RCPWSVT(2)).NOWSAVT
&RCPWSVT(2) SETB 1
         TITLE 'GLOBAL WORK/SAVE AREA VECTOR TABLE'
*        IHAWSAVT CLASS=GLOBAL
         IHAWSAVT CLASS=GLOBAL
         TITLE 'LOCAL WORK/SAVE AREA VECTOR TABLE'
*        IHAWSAVT CLASS=LOCAL
         IHAWSAVT CLASS=LOCAL
         TITLE 'CPU WORK/SAVE AREA VECTOR TABLE'
*        IHAWSAVT CLASS=CPU
         IHAWSAVT CLASS=CPU
.NOWSAVT ANOP  ,
         AIF   (NOT &RCPTSB(1) AND NOT &ALL OR &RCPTSB(2)).NOTSB
&RCPTSB(2) SETB 1
         TITLE 'TERMINAL STATUS BLOCK AND EXTENSION'
*        IKJTSB LIST=YES,EXT=YES
         IKJTSB LIST=YES,EXT=YES
.NOTSB   ANOP  ,
         AIF   (NOT &RCPCPPL(1) AND NOT &ALL OR &RCPCPPL(2)).NOCPPL
&RCPCPPL(2) SETB 1
         TITLE 'COMMAND PROCESSOR PARAMETER LIST'
*        IKJCPPL ,
         IKJCPPL ,
.NOCPPL  ANOP  ,
         AIF   (NOT &RCPPPL(1) AND NOT &ALL OR &RCPPPL(2)).NOPPL
&RCPPPL(2) SETB 1
         TITLE 'TSO PARSE PARAMETER LIST'
*        IKJPPL ,
         IKJPPL ,
PPLLEN   EQU   *-PPL
.NOPPL   ANOP  ,
         AIF   (NOT &RCPCSPL(1) AND NOT &ALL OR &RCPCSPL(2)).NOCSPL
&RCPCSPL(2) SETB 1
         TITLE 'TSO COMMAND SCAN PARAMETER LIST && OUTPUT AREA'
*        IKJCSPL ,
         IKJCSPL ,
CSPLLEN  EQU   *-CSPL
         SPACE 2
*        IKJCSOA ,
         IKJCSOA ,
CSOALEN  EQU   *-CSOA
.NOCSPL  ANOP  ,
         AIF   (NOT &RCPIOPL(1) AND NOT &ALL OR &RCPIOPL(2)).NOIOPL
&RCPIOPL(2) SETB 1
         TITLE 'TSO INPUT/OUTPUT PARAMETER LIST'
*        IKJIOPL ,
         IKJIOPL ,
IOPLLEN  EQU   *-IOPL
.NOIOPL  ANOP  ,
         AIF   (NOT &RCPALLC(1) AND NOT &ALL OR &RCPALLC(2)).NOALLOC
&RCPALLC(2) SETB 1
         TITLE 'DYNAMIC ALLOCATION PARAMETER LIST'
*        IEFZB4D0 ,
         IEFZB4D0 ,
         TITLE 'DYNAMIC ALLOCATION TEXT UNIT KEYS'
*        IEFZB4D2 ,
         IEFZB4D2 ,
.NOALLOC ANOP  ,
         AIF   (NOT &RCPCTLG(1) AND NOT &ALL OR &RCPCTLG(2)).NOCTLG
&RCPCTLG(2) SETB 1
         TITLE 'ACCESS METHOD DATA STATISTICS BLOCK'
*        IDAAMDSB ,
         IDAAMDSB ,
         TITLE 'CATALOG AUXILIARY WORK AREA'
*        IGGCAXWA ,
         IGGCAXWA ,
         TITLE 'CATALOG COMMUNICATION AREA'
*        IGGCCA ,
         IGGCCA ,
         TITLE 'CATALOG COMMUNICATION AREA EXTENSION'
*        IGGCCX ,
         IGGCCX ,
         TITLE 'CATALOG INTEGRITY CONTROL BLOCK'
*        CICB  ,
         CICB  ,
         TITLE 'CATALOG CONTROL VOLUME LIST'
*        IEZCTGCV ,
         IEZCTGCV ,
         TITLE 'CATALOG CAMLST PARAMETER LIST'
*        IEZCAML ,
         IEZCAML ,
         TITLE 'CATALOG FIELD PARAMETER LIST'
*        IEZCTGFL ,
         IEZCTGFL ,
         TITLE 'CATALOG FIELD VECTOR TABLE'
*        IEZCTGFV ,
         IEZCTGFV ,
         TITLE 'CATALOG PARAMETER LIST'
*        IEZCTGPL ,
         IEZCTGPL
         TITLE 'CATALOG VOLUME LIST'
*        IEZCTGVL ,
         IEZCTGVL ,
         TITLE 'CATALOG WORK AREA'
*        IEZCTGWA ,
         IEZCTGWA ,
         TITLE 'CATALOG MANAGEMENT RETURN CODES'
*        COPY  #CATRC
         COPY  #CATRC
.NOCTLG  ANOP  ,
         AIF   (NOT &RCPCVAF(1) AND NOT &ALL OR &RCPCVAF(2)).NOCVAF
&RCPCVAF(2) SETB 1
         TITLE 'CVAF PARAMETER LIST'
*        ICVAFPL ,
         ICVAFPL ,
         TITLE 'CVAF BUFFER LIST'
*        ICVAFBFL ,
         ICVAFBFL ,
.NOCVAF  ANOP  ,
         AIF   (NOT &RCPEDT(1) AND NOT &ALL OR &RCPEDT(2)).NOEDT
&RCPEDT(2) SETB 1
         TITLE 'ELIGIBLE DEVICES TABLE AND UCB POINTER LIST'
*        IEFZB421 ,
         IEFZB421 ,
         SPACE 3
*        IEFZB461 ,
         IEFZB461 ,
.NOEDT   ANOP  ,
         AIF   (NOT &RCPZ502(1) AND NOT &ALL OR &RCPZ502(2)).NOZ502
&RCPZ502(2) SETB 1
         TITLE 'SWA BLOCK HEADER'
*        IEFZB502 ,
         IEFZB502 ,
SWPSIZE  EQU   *-ZB502
.NOZ502  ANOP  ,
         AIF   (NOT &RCPZ505(1) AND NOT &ALL OR &RCPZ505(2)).NOZ505
&RCPZ505(2) SETB 1
         TITLE 'SWA MANAGER EXTERNAL PARAMETER AREA - LOCATE MODE'
*        IEFZB505 ,
         IEFZB505 ,
.NOZ505  ANOP  ,
         AIF   (NOT &RCPZ506(1) AND NOT &ALL OR &RCPZ506(2)).NOZ506
&RCPZ506(2) SETB 1
         TITLE 'SWA MANAGER EXTERNAL PARAMETER AREA - MOVE MODE'
*        IEFZB506 ,
         IEFZB506 ,
.NOZ506  ANOP  ,
         AIF   (NOT &RCPQMPA(1) AND NOT &ALL OR &RCPQMPA(2)).NOQMPA
&RCPQMPA(2) SETB 1
         TITLE 'QUEUE MANAGER PARAMETER AREQ (QMPA)'
*        IEFQMNGR ,
         IEFQMNGR ,
.NOQMPA  ANOP  ,
         AIF   (NOT &RCPJES(1) AND NOT &ALL OR &RCPJES(2)).NOJES
&RCPJES(2) SETB 1
         TITLE 'JES CONTROL TABLE'
*        IEFJESCT ,
         IEFJESCT ,
.NOJES   ANOP  ,
         AIF   (NOT &RCPSSS(1) AND NOT &ALL OR &RCPSSS(2)).NOSSS
&RCPSSS(2) SETB 1
         TITLE 'SUBSYSTEM COMMUNICATIONS VECTOR TABLE'
*        IEFJSCVT ,
         IEFJSCVT ,
         TITLE 'SUBSYSTEM VECTOR TABLE'
*        IEFJSSVT ,
         IEFJSSVT ,
         TITLE 'SUBSYSTEM IDENTIFICATION BLOCK'
*        IEFJSSIB ,
         IEFJSSIB ,
         TITLE 'SUBSYSTEM OPTIONS BLOCK'
*        IEFJSSOB (SO,CS,JS,AL,EN,ET,WT,CM,US,JT,RQ,DM,VS,DA,RR,CF,
*              SI,CI,AG)
         IEFJSSOB (SO,CS,JS,AL,EN,ET,WT,CM,US,JT,RQ,DM,VS,DA,RR,CF,    X
               SI,CI,AG)
.NOSSS   ANOP  ,
         TITLE ' '
         AIF   (&PRT).DSE0500
         POP   PRINT
.DSE0500 MEND  ,
./ ADD NAME=#EXEC    0100-00038-00038-1647-00135-00135-00000-MACRO
         MACRO ,
&NAME    #EXEC &REG,&INST,&D,&S,&X
         GBLA  &EXECUTN            CURRENT EXECUTE NUMBER
         GBLA  &EXECUTL            CURRENT EXECUTE STATEMENT NUMBER
         GBLC  &EXECUTI(255)       INSTRUCTION CODE
         GBLC  &EXECUTD(255)       DESTINATION
         GBLC  &EXECUTS(255)       SOURCE
         GBLC  &EXECNAM            EXECUTE INSTRUCTION NAME
         LCLA  &I,&J               WORK COUNTERS
         LCLB  &MINUS              "-RX" SPECIFIED
         LCLC  &INS,&OP1,&OP2      CURRENT INSTRUCTION & OPERANDS
         LCLC  &RRR                CURRENT REGISTER VALUE
.*--------------------------------------------------------------------*
.*
.*    THIS MACRO ENABLES A PROGRAMMER TO EXECUTE AN INSTRUCTION
.*    WITHOUT THE NECESSITY FOR REMEMBERING TO CODE THE INSTRUCTIONS
.*    LATER ON IN THE PROGRAM.  FOR INSTANCE, IF A MVC INSTRUCTION IS
.*    TO BE EXECUTED, WITH THE THE MACHINE LENGTH OF THE DESTINATION
.*    WITHIN REGISTER 4, THE FOLLOWING SHOULD BE CODED.
.*              LABEL    #EXEC R4,MVC,TARGET,SOURCE
.*    IF THE ACTUAL TARGET FIELD LENGTH IS LOCATED IN REGISTER 4, THE
.*    FOLLOWING INSTRUCTION WILL CONVERT THE LENGTH TO THE MACHINE
.*    LENGTH THEN EXECUTE THE INSTRUCTION.
.*              LABEL    #EXEC -R4,MVC,TARGET,SOURCE
.*
.*    ONLY TWO OPERAND INSTRUCTIONS ARE SUPPORTED.
.*    THE MACRO ACCUMULATES ALL UNIQUE INSTRUCTIONS ENTERED, IGNORING
.*    ANY DUPLICATES.
.*    WHEN #EXEC IS CODED WITH NO OPERANDS, IT EXPANDS INTO THE
.*    NECESSARY INSTRUCTIONS.  EACH INSTRUCTION HAS A UNIQUE NAME IN
.*    THE FORM @EXEC###, WHERE ### IS A NUMBER FROM 1-255.
.*    THE EXPANSION PROCESS IS SIMILAR TO THAT OF AN LTORG STATEMENT
.*    FOR LITERALS.  SEVERAL EXECUTE POOLS CAN BE CREATED, IN A SIMILAR
.*    FASHION TO LITERAL POOLS.
.*
.*--------------------------------------------------------------------*
         AIF   (N'&SYSLIST EQ 0).EXPAND
         AIF   ('&INST' EQ '').EXPAND
.*       AIF   (N'&SYSLIST NE 4).ERROR2
.*
&RRR     SETC  '&REG'              SET REGISTER VALUE
&OP1     SETC  '&D'                SET FIRST OPERAND
&OP2     SETC  '&S'                SET SECOND OPERAND
.*
         AIF   (N'&SYSLIST GT 4).CHECK3
         AIF   ('&INST' EQ 'MVC' OR '&INST' EQ 'CLC').SS1
         AIF   ('&INST' EQ 'TR' OR '&INST' EQ 'TRT').SS1
         AIF   ('&INST' EQ 'MVZ' OR '&INST' EQ 'MVN').SS1
         AIF   ('&INST' EQ 'OC' OR '&INST' EQ 'NC').SS1
         AIF   ('&INST' EQ 'XC' OR '&INST' EQ 'ED').SS1
         AIF   ('&INST' EQ 'MVCIN' OR '&INST' EQ 'EDMK').SS1
.*
         AIF   ('&INST' EQ 'PACK' OR '&INST' EQ 'UNPK').SS2
         AIF   ('&INST' EQ 'MVO' OR '&INST' EQ 'ZAP').SS2
         AIF   ('&INST' EQ 'AP' OR '&INST' EQ 'CP').SS2
         AIF   ('&INST' EQ 'DP' OR '&INST' EQ 'MP').SS2
         AIF   ('&INST' EQ 'SP').SS2
         AGO   .TN
.CHECK3  ANOP
         AIF   (N'&SYSLIST GT 5).ERROR2
         AIF   ('&INST' EQ 'CLM' OR '&INST' EQ 'ICM').SS0
         AIF   ('&INST' EQ 'STCM').SS0
         AGO   .TN                 NOT SS, NEEDS NO LENGTH
.SS0     ANOP  ,
&OP1     SETC  '&D.,&S'
&OP2     SETC  '&X'
         AGO   .TN
.*
.*       IF THE DESTINATION ENDS IN A BRACKET, IT IS EITHER A REGISTER
.*       SPECIFICATION OR ALREADY HAS A LENGTH FIELD SPECIFIED, SO A
.*       LENGTH FIELD WILL NOT BE APPENDED
.*
.SS1     AIF   ('&OP1'(K'&OP1,1) EQ ')').TN
&OP1     SETC  '&D.(*-*)'          APPEND A LENGTH OF ZERO
         AGO   .TN
.*
.SS2     AIF   ('&OP2'(K'&OP2,1) EQ ')').TN
&OP2     SETC  '&S.(*-*)'          APPEND A LENGTH OF ZERO
.*
.TN      AIF   (&EXECUTN EQ 0).NEW IF FIRST TIME, DO NOT CHECK TABLE
.*
.LOOP    ANOP  ,
&I       SETA  &I+1
         AIF   (&I GT &EXECUTN).NEW
         AIF   ('&OP1' NE '&EXECUTD(&I)').LOOP
         AIF   ('&OP2' NE '&EXECUTS(&I)').LOOP
         AIF   ('&INST' NE '&EXECUTI(&I)').LOOP
&J       SETA  &I+&EXECUTL         ADD CURRENT EXECUTE STATEMENT NUMBER
         AGO   .GENEX
.*
.NEW     ANOP  ,
&EXECUTN SETA  &EXECUTN+1
         AIF   (&EXECUTN GT 255).ERROR
&EXECUTI(&EXECUTN) SETC '&INST'
&EXECUTD(&EXECUTN) SETC '&OP1'
&EXECUTS(&EXECUTN) SETC '&OP2'
&J       SETA  &EXECUTN+&EXECUTL   ADD CURRENT EXECUTE STATEMENT NUMBER
.GENEX   AIF   ('&RRR' EQ '').NAMEIT
&MINUS   SETB  0                   TURN OFF "-" FLAG
         AIF   ('&RRR'(1,1) NE '-').GENEX2
&MINUS   SETB  1                   TURN ON  "-" FLAG
&RRR     SETC  '&RRR'(2,K'&RRR-1)  REMOVE "-" FROM REGISTER VALUE
         BCTR  &RRR,0              DECREMENT FOR EXECUTE COMMAND
.GENEX2  ANOP  ,
&NAME    EX    &RRR,@EXEC&J
.MEXIT   MEXIT ,
.*
.ERROR   MNOTE 8,'NUMBER OF #EXEC MACROS EXCEEDS UPPER LIMIT (255)'
         MEXIT ,
.ERROR2  MNOTE 8,'INVALID NUMBER OF OPERANDS'
         MEXIT ,
.*
.*   IF &REG IS NULL, #EXEC WAS CALLED FROM WITHIN ANOTHER MACRO.
.*   THE GLOBAL SETC VARIABLE &EXECNAM IS SET TO THE INSTRUCTIONS
.*   LABEL FOR USE BY THE CALLING MACRO.
.*
.NAMEIT  ANOP  ,
&EXECNAM SETC  '@EXEC&J'                SET VARIABLE
         MEXIT ,
.*
.*   IF #EXEC WAS CODED, WITH NO OPERANDS, GENERATE EXECUTE COMMANDS.
.*
.EXPAND  ANOP  ,
&I       SETA  0                   INITIALIZE COUNTER
.LOOP1   ANOP  ,
&I       SETA  &I+1                ADD 1 TO COUNTER
         AIF   (&I GT &EXECUTN).EXIT1
&INS     SETC  '&EXECUTI(&I)'
&J       SETA  &I+&EXECUTL         ADD CURRENT EXECUTE STATEMENT NUMBER
@EXEC&J  &INS  &EXECUTD(&I),&EXECUTS(&I)
         AGO   .LOOP1
.EXIT1   ANOP  ,
&EXECUTL SETA  &EXECUTN+&EXECUTL   SET CURRENT EXECUTE STATEMENT NUMBER
&EXECUTN SETA  0                   RESET TABLE COUNTER
         MEND  ,
./ ADD NAME=#FPOST   0100-00038-00038-1647-00012-00012-00000-MACRO
         MACRO
&NAME    #FPOST &ECB,&CODE
         LCLC  &P
&NAME    IHBINNRA &ECB,&CODE
&P       SETC  'IHB&SYSNDX'
         ICM   0,8,=X'40'               INSERT POST BIT TO HI BYTE
         ICM   15,15,0(1)               LOAD ECB
         BM    &P                       AND IF WAIT BIT ON, GO TO POST
         CS    15,0,0(1)                SET POST BIT IF ECB UNCHANGED
         BE    &P+2                     AND IF SUCCESSFUL, SKIP POST
&P       SVC   2                        ISSUE POST SVC
         MEND
./ ADD NAME=#FREE    0100-00038-00038-1647-00023-00023-00000-MACRO
         MACRO ,
&NAME    #FREE &T,&A=
         GBLA  &RCPSWS(10)
         GBLC  &RCPPRE
         LCLC  &P,&LABEL
&P       SETC  '&RCPPRE'
&LABEL   SETC  '&NAME'
         AIF   (&RCPSWS(3) EQ 0).E1
         AIF   ('&A' EQ '(0)' OR '&A' EQ '' OR '&A' EQ '(R0)').F2
         AIF   ('&A'(1,1) EQ '(').FR
&LABEL   L     R0,=A(&A)                LOAD STORAGE ADDRESS
&LABEL   SETC  ''
         AGO   .F2
.FR      LR    R0,&A(1)                 LOAD STORAGE ADDRESS
&LABEL   SETC  ''
.F2      ANOP  ,
&LABEL   L     R1,0(,R13)               LOAD MODULE COMM. AREA ADDR
         L     R15,&P.A#FRE-&P.MCA(,R1) LOAD FREE ROUTINE ADDRESS
         BALR  R14,R15                  FREE REQUESTED STORAGE
         MEXIT ,
.E1      MNOTE 8,'LIFO OPTION NOT SPECIFIED ON BEGIN MACRO'
&LABEL   DS    0H
         MEND  ,
./ ADD NAME=#GET     0100-00038-00038-1647-00023-00023-00000-MACRO
         MACRO ,
&NAME    #GET  &T,&LV=
         GBLA  &RCPSWS(10)
         GBLC  &RCPPRE
         LCLC  &P,&LABEL
&P       SETC  '&RCPPRE'
&LABEL   SETC  '&NAME'
         AIF   (&RCPSWS(3) EQ 0).E1
         AIF   ('&LV' EQ '(0)' OR '&LV' EQ '' OR '&LV' EQ '(R0)').G2
         AIF   ('&LV'(1,1) EQ '(').GR
&LABEL   L     R0,=A(&LV)               LOAD LENGTH VALUE
&LABEL   SETC  ''
         AGO   .G2
.GR      LR    R0,&LV(1)                LOAD LENGTH VALUE
&LABEL   SETC  ''
.G2      ANOP  ,
&LABEL   L     R1,0(0,R13)              LOAD MODULE COMM AREA ADDR
         L     R15,&P.A#GET-&P.MCA(0,R1) LOAD GET ROUTINE ADDRESS
         BALR  R14,R15                  GET REQUESTED STORAGE
         MEXIT ,
.E1      MNOTE 8,'LIFO OPTION NOT SPECIFIED ON BEGIN MACRO'
&LABEL   #NULL ,
         MEND  ,
./ ADD NAME=#GETFL   0100-00038-00038-1647-00070-00070-00000-MACRO
         MACRO
&NAME    #GETFL &FLD,                   ADDR OF CTGFL BEING ACCESSED   &
               &A,                      STRG OR REG TO GET ADDR        &
               &L,                      STRG OR REG TO GET LENGTH      &
               &ZERO=                   BRANCH ADDRESS
.*********************************************************************
.*                                                                   *
.*   THIS MACRO IS USED TO RETRIEVE A PARTICULAR FIELD IN A CATALOG  *
.* PARAMETER LIST.  THE FORMAT IS:                                   *
.*      #GETFL CTGFLADDR,PTR(,LENREG)                                *
.*            CTGFLADDR -- IS THE ADDRESS OF THE CTGFL FROM WHICH    *
.*                         DATA IS TO BE RETRIEVED.                  *
.*            PTR -------- IS THE ADDRESS OR REGISTER WHERE THE      *
.*                         ADDRESS OF THE DATA WILL BE PLACED.       *
.*                         VALID REGS (1-14)                         *
.*            LENREG ----- IS THE ADDRESS OR REGISTER WHERE THE      *
.*                         LENGTH OF THE DATA IS TO BE PLACED.       *
.*            ZERO= ------ IS THE ADDRESS TO BE BRANCHED TO IF THE   *
.*                         POINTER FIELD IS ZERO                     *
.*                                                                   *
.*  NOTE. THE MACROS IEZCTGPL AND IEZCTGFL MUST BE CODED TO USE      *
.*        THIS MACRO.                                                *
.*                                                                   *
.*********************************************************************
         LCLC  &REG                         *
         AIF   ('&FLD' EQ '').E1            *
         AIF   ('&A' EQ '').E2              *
         PUSH  USING                        
         USING CTGFL,15                      ADDRESS THE CTGFL
         AIF   ('&FLD'(1,1) EQ '(').FR      *
&NAME    LA    15,&FLD                       REG 1 -> CTGFL
         AGO   .L1                          *
.FR      ANOP                               *
&REG     SETC  '&FLD'(2,K'&FLD-2)           * STRIP PARENTHESIS
&NAME    LR    15,&REG                       REG 1 -> CTGFL
.L1      AIF   ('&A'(1,1) EQ '(').AR        * PTR SPECD BY REG
         AIF   ('&ZERO' NE '').L11          * CHECK FOR ZERO=
         L     0,CTGFLPT                     PUT THE ADDRESS OF THE
         ST    0,&A                          DATA INTO STORAGE
         AGO   .L2                          *
.L11     ANOP                               *
         ICM   0,B'1111',CTGFLPT             GET POINTER TO DATA
         ST    0,&A                          DATA INTO STORAGE
         BZ    &ZERO                         CHECK FOR ZERO POINTER
         AGO   .L2                          *
.AR      ANOP                               *
&REG     SETC  '&A'(2,K'&A-2)               * STRIP PARENTHESIS
         AIF   ('&ZERO' NE '').AR1          * CHECK FOR ZERO=
         L     &REG,CTGFLPT                  GET POINTER TO DATA
         AGO   .L2                          *
.AR1     ANOP                               *
         ICM   &REG,B'1111',CTGFLPT          GET POINTER TO DATA
         BZ    &ZERO                         CHECK FOR ZERO POINTER
.L2      AIF   ('&L' EQ '').L3              * SKIP IF NO LENGTH REQUEST
         AIF   ('&L'(1,1) EQ '(').LR        * LENGTH TO GO IN REGISTER
         L     0,CTGFLNG                     SAVE THE LENGTH OF THE
         ST    0,&L                          DATA INTO STORAGE
         AGO   .L3                          *
.LR      ANOP                               *
&REG     SETC  '&L'(2,K'&L-2)               * STRIP PARENTHESIS
         L     &REG,CTGFLNG                  GET LENGTH OF DATA
.L3      ANOP                               *
         DROP  15                            REMOVE ADDRESSABILITY
         POP   USING                        
         MEXIT ,                            *
.E1      MNOTE 8,'FIELD ADDRESS MISSING'    *
         MEXIT ,                            *
.E2      MNOTE 8,'FIELD RESULT POINTER MISSING'
         MEXIT ,                            *
         MEND  ,                            *
./ ADD NAME=#GOIF    0100-00038-00038-1647-00202-00202-00000-MACRO
         MACRO
&NAME    #GOIF &SW,&ON=,&OFF=,&ANY=,&NOTALL=,&MIXED=
         GBLA  &DCLDSW#             COUNTER OF # OF SWITCH BYTES.
         GBLA  &DCLGSW#             COUNTER OF # OF GENERIC BYTES.
         GBLB  &DCLDSWD(99)         DEFER DECLARE INDICATORS.
         GBLC  &DCLDSWN(99)         SWITCH BYTE NAMES.
         GBLC  &DCLDSWB(800)        SWITCH BIT NAMES.
         GBLC  &DCLGSWN(99)         GENERIC SWITCH BYTE NAMES.
         GBLC  &DCLGSWB(99)         GENERIC SWITCH BIT PREFIXES.
         LCLA  &A,&B,&C,&D,&E       LOCAL WORK SYMBOLS.
         LCLB  &F(20),&G
         LCLC  &K(20),&L(20),&M,&N,&O,&P(2),&Q
         AIF   ('&ON&OFF&ANY&NOTALL&MIXED' EQ '').GOI3400   ERROR.
.*
.* FIRST LOCATE THE SWITCHES.
.*
         AIF   ('&SW' EQ '').GOI3500   ERROR - NO SWITCHES.
&A       SETA  N'&SW                GET # SWITCHES REQUESTED.
&B       SETA  0                    INDEX INTO SUPPLIED SWITCHES.
&C       SETA  &DCLDSW#*8           POINT TO LAST DECLARED SWITCH.
&E       SETA  0                    COUNTER OF # BYTES FOUND.
.GOI0100 AIF   (&B EQ &A).GOI1300   FINISHED, EXIT SEARCH.
&B       SETA  &B+1                 POINT TO NEXT SWITCH.
&M       SETC  '&SYSLIST(1,&B)'     GRAB SUPPLIED SWITCH.
&G       SETB  0                    RESET NOT FLAG.
&D       SETA  1                    INDEX INTO # DECLARED SWITCHES.
         AIF   ('&M'(1,4) NE 'NOT-').GOI0200   NO NOT, CONTINUE.
&G       SETB  1                    TURN NOT FLAG ON.
&M       SETC  '&M'(5,K'&M-4)       STRIP OFF NOT.
.GOI0200 AIF   (&DCLDSW# EQ 0).GOI0400   NO DECLARED, TRY GENERICS.
.GOI0300 AIF   ('&M' EQ '&DCLDSWB(&D)').GOI0600   FOUND HIM.
&D       SETA  &D+1                 INDEX TO NEXT BIT.
         AIF   (&D LE &C).GOI0300   KEEP LOOKING.
.GOI0400 AIF   (&DCLGSW# EQ 0).GOI3600   ERROR - SWITCH NOT FOUND.
&D       SETA  1                    INDEX INTO # GENERIC SWITCHES.
.GOI0500 AIF   ('&M'(1,K'&DCLGSWB(&D)) EQ '&DCLGSWB(&D)').GOI0700
&D       SETA  &D+1                 NOT HIM, INDEX TO NEXT PREFIX.
         AIF   (&D LE &DCLGSW#).GOI0500   KEEP LOOKING.
         AGO   .GOI3600             ERROR - SWITCH NOT FOUND.
.*
.* INCOMING SWITCH IA A DECLARED SWITCH.
.*
.GOI0600 ANOP
&D       SETA  (&D+7)/8             INDEX TO DECARED BYTE NAME TABLE.
&N       SETC  '&DCLDSWN(&D)'       GET BYTE NAME.
         AGO   .GOI0800             CONTINUE.
.*
.* INCOMING SWITCH IA A GENERIC SWITCH.
.*
.GOI0700 ANOP
&N       SETC  '&DCLGSWN(&D)'       GET BYTE NAME.
.*
.* ADD SWITCH BYTE AND SWITCH BIT NAME TO A TABLE AS FOLLOWS:
.*
.*    - IF THE BYTE NAME IS NOT IN THE TABLE, ADD IT.
.*    - IF IT IS BUT THE NOT FLAGS DONT MATCH, ADD IT AS A NEW ENTRY.
.*    - OTHERWISE, CONCATENATE THE NEW SWITCH BIT NAME TO THE OLD
.*      SWITCH BIT NAME, WITH A '+' SIGN IN BETWEEN.
.*
.GOI0800 AIF   (&E EQ 0).GOI1100    FIRST ENTRY, CONTINUE.
&D       SETA  1                    INDEX INTO FOUND TABLES.
.GOI0900 AIF   ('&N' EQ '&K(&D)').GOI1000   MATCHING NAME, CONTINUE.
&D       SETA  &D+1                 POINT TO NEXT ENTRY.
         AIF   (&D LE &E).GOI0900   KEEP LOOKING.
         AGO   .GOI1100             THIS GUY IS NEW.
.GOI1000 AIF   (&G EQ &F(&D)).GOI1200   SAME SEX TOO...
&D       SETA  &D+1                 POINT TO NEXT ENTRY.
         AIF   (&D LE &E).GOI0900   KEEP LOOKING.
.*
.* THIS ENTRY IS A NEW BYTE NAME.
.*
.GOI1100 ANOP
&E       SETA  &E+1                 BUMP COUNTER OF # FOUND.
&K(&E)   SETC  '&N'                 SAVE BYTE NAME.
&L(&E)   SETC  '&M'                 SAVE BIT NAME.
&F(&E)   SETB  (&G)                 SAVE NOT FLAG.
         AGO   .GOI0100             GO, GET NEXT SUPPLIED SWITCH.
.*
.* THIS ENTRY IS AN OLD ENTRY.
.*
.GOI1200 ANOP
&L(&E)   SETC  '&L(&E).+&M'         CONCATENATE SWITCH BIT NAMES.
         AGO   .GOI0100             GO, GET NEXT SUPPLIED SWITCH.
.*
.* THE FOLLOWING IS FOR WHEN ALL SWITCHES BELONG TO THE SAME BYTE.
.*
.GOI1300 AIF   (&E EQ 0).GOI3500    ERROR - NO SWITCHES CODED.
         AIF   (&E GT 1).GOI2400    MORE THAN 1, CONTINUE.
&NAME    TM    &K(1),&L(1)
         AIF   ('&ON' EQ '').GOI1500   NO ON, CONTINUE.
         AIF   ('&ON'(1,1) EQ '(').GOI1400   REGISTER, CONTINUE.
         BO    &ON                  BRANCH IF ON.
         AGO   .GOI1500             CONTINUE.
.GOI1400 ANOP
         BOR   &ON(1)               BRANCH IF ON.
.GOI1500 AIF   ('&OFF' EQ '').GOI1700   NO OFF, CONTINUE.
         AIF   ('&OFF'(1,1) EQ '(').GOI1600   REGISTER, CONTINUE.
         BZ    &OFF                 BRANCH IF OFF.
         AGO   .GOI1700             CONTINUE.
.GOI1600 ANOP
         BZR   &OFF(1)              BRANCH IF OFF.
.GOI1700 AIF   ('&MIXED' EQ '').GOI1900   NO MIXED, CONTINUE.
         AIF   ('&MIXED'(1,1) EQ '(').GOI1800   REGISTER, CONTINUE.
         BM    &MIXED               BRANCH IF MIXED.
         AGO   .GOI1900             CONTINUE.
.GOI1800 ANOP
         BMR   &MIXED(1)            BRANCH IF MIXED.
.GOI1900 AIF   ('&ANY' EQ '').GOI2100   NO ANY, CONTINUE.
         AIF   ('&ANY'(1,1) EQ '(').GOI2000   REGISTER, CONTINUE.
         BNZ   &ANY                 BRANCH IF ANY ON.
         AGO   .GOI2100             CONTINUE.
.GOI2000 ANOP
         BNZR  &ANY(1)              BRANCH IF ANY ON.
.GOI2100 AIF   ('&NOTALL' EQ '').GOI2300   NO NOTALL, CONTINUE.
         AIF   ('&NOTALL'(1,1) EQ '(').GOI2200   REGISTER, CONTINUE.
         BNO   &NOTALL              BRANCH IF NOT ALL ON.
         AGO   .GOI2300             CONTINUE.
.GOI2200 ANOP
         BNOR  &NOTALL(1)           BRANCH IF NOT ALL ON.
.GOI2300 MEXIT                      EXIT.
.*
.* THE FOLLOWING IS FOR 2 OR MORE BYTES.
.*
.GOI2400 ANOP
&N       SETC  ''                   DEFAULT TO NON-REGISTER BRANCH.
&O       SETC  '&NAME'              SAVE THE NAME.
         AIF   ('&MIXED' NE '').GOI3700   ERROR - CANT HANDLE MIXED.
&A       SETA  N'&ON+N'&OFF+N'&ANY+N'&NOTALL   GET # EXITS.
         AIF   (&A NE 1).GOI3800    ERROR - CANT HANDLE MORE THAN 1.
&B       SETA  0                    INDEX OF TESTS.
         AIF   ('&ON' NE '').GOI2500   GO HANDLE ON.
         AIF   ('&OFF' NE '').GOI2600   GO HANDLE OFF.
         AIF   ('&ANY' NE '').GOI3000   GO HANDLE ANY.
         AIF   ('&NOTALL' NE '').GOI3100   GO HANDLE NOTALL.
         MNOTE 16,'GOI999X - THIS MACRO HAS A BUG IN IT...'
.GOI2500 ANOP
&A       SETA  4                    SET LENGTH OF FINAL BRANCH.
&P(1)    SETC  'O'                  BRANCH MASK.
&P(2)    SETC  'Z'                  BRANCH MASK WHEN 'NOT-'.
&M       SETC  '&ON'                GET EXIT PARAMETER.
         AIF   ('&ON'(1,1) NE '(').GOI2700   NOT A REGISTER, CONT.
&A       SETA  2                    SET BRANCH LENGTH = 2.
&N       SETC  'R'                  REGISTER OP CODE.
&M       SETC  '&ON'(2,K'&ON-2)     STRIP OFF BRACKETS.
         AGO   .GOI2700             CONTINUE.
.GOI2600 ANOP
&A       SETA  4                    LELNGTH OF FINAL BRANCH.
&P(1)    SETC  'Z'                  BRANCH MASK.
&P(2)    SETC  'O'                  BRANCH MASK WHEN 'NOT-'.
&M       SETC  '&OFF'               GET EXIT PARAMETER.
         AIF   ('&OFF'(1,1) NE '(').GOI2700   NOT A REGISTER, CONT.
&A       SETA  2                    SET BRANCH LENGTH =2.
&N       SETC  'R'                  STRIP OFF BRACKETS.
&M       SETC  '&OFF'(2,K'&OFF-2)   STRIP OFF BRACKETS.
.GOI2700 ANOP
&A       SETA  (&E-1)*8+&A          INITIAL BRANCH AROUND LENGTH.
.GOI2800 AIF   (&B GE &E).GOI3300   FINISHED, GET THE HELL OUT.
&B       SETA  &B+1                 N, GET NEXT TEST.
&O       TM    &K(&B),&L(&B)
&O       SETC  ''                   ONLY WANT LABEL ONCE.
&Q       SETC  '&P(&F(&B)+1)'       ESTIMATE THE BRANCH LENGTH.
         AIF   (&B EQ &E).GOI2900   LAST ONE, GO DO FINAL BRANCH.
         BN&Q  *+&A
&A       SETA  &A-8                 DECREMENT BRANCH LENGTH.
         AGO   .GOI2800             LOOP THRU ALL TESTS.
.GOI2900 B&Q&N &M                   EXIT IF CONDITION SATISFIED.
         MEXIT                      EXIT.
.GOI3000 ANOP
&P(1)    SETC  'Z'                  BRANCH MASK.
&P(2)    SETC  'O'                  BRANCH MASK FOR 'NOT-'.
&M       SETC  '&ANY'               GET PARAMETER.
         AIF   ('&ANY'(1,1) NE '(').GOI3200   NOT A REGISTER, CONT.
&N       SETC  'R'                  REGISTER OP CODE.
&M       SETC  '&ANY'(2,K'&ANY-2)   STRIP OFF BRACKETS.
         AGO   .GOI3200             CONTINUE.
.GOI3100 ANOP
&P(1)    SETC  'O'                  BRANCH MASK.
&P(2)    SETC  'Z'                  BRANCH MASK FOR 'NOT-'.
&M       SETC  '&NOTALL'            PICK UP PARAMETER.
         AIF   ('&NOTALL'(1,1) NE '(').GOI3200   NOT A REGISTER, CONT.*
&N       SETC  'R'                  REGISTER OP CODE.
&M       SETC  '&NOTALL'(2,K'&NOTALL-2)   STRIP OFF BRACKETS.
.GOI3200 AIF   (&B GE &E).GOI3300   FINISHED, GET THE HELL OUT.
&B       SETA  &B+1                 GET NEXT TEST.
&O       TM    &K(&B),&L(&B)
&O       SETC  ''                   WANT LABEL ONLY ONCE.
&Q       SETC  '&P(&F(&B)+1)&N'     GET BRANCH MASK.
         BN&Q  &M
         AGO   .GOI3200             LOOP THRU ALL TESTS.
.GOI3300 MEXIT                      EXIT.
.GOI3400 MNOTE 8,'GOI001A - NO BRANCH CONDITIONS SPECIFIED'
         MEXIT                      EXIT.
.GOI3500 MNOTE 8,'GOI002A - NO SWITCHES SPECIFIED'
         MEXIT                      EXIT.
.GOI3600 MNOTE 8,'GOI003A - SWITCH  &M NOT DECLARED'
         MEXIT                      EXIT.
.GOI3700 MNOTE 8,'GOI004A - "MIXED" PARAMETER NOT SUPPORTED WHEN'
         MNOTE 0,'          MORE THAN 1 BYTE IS BEING TESTED'
         MEXIT
.GOI3800 MNOTE 8,'GOI005A - MULTIPLE TESTS NOT SUPPORTED WHEN'
         MNOTE 0,'          MORE THAN 1 BYTE IS BEING TESTED'
         MEND
./ ADD NAME=#IKJPSCB 0100-00038-00038-1647-00058-00058-00000-MACRO
         MACRO ,
         #IKJPSCB ,
         IKJPSCB ,
         SPACE 1
**********************************************************************
*                                                                    *
*   MAP THE INSTALLATION DEFINED FIELDS IN THE PSCB.                 *
*                                                                    *
*  +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+ *
*  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15  *
*  +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+ *
*                                                              *
*  <-PSBCUTL-><-- PSCBUFLG ------+--><-PSCBUIDL><-- PSCBUMLL -> *
*                                                                 *
*  <--------- PSCBUSR1 ----------><--------- PSCBUSR2 ----------> *
*                                                                  *
*  <------------------------ PSCBATR2 ---------------------------> *
*                                                                    *
*   PSCBATR2 -- THE LABEL GIVEN TO THE ENTIRE 16 BITS OF USER DATA   *
*   PSCBUSR1 -- THE FIRST 8 BITS OF USER DATA                        *
*   PSCBUSR2 -- THE SECOND 8 BITS OF USER DATA                       *
*   PSBCUTL  -- BITS 0 THRU 2 REPRESENT A THREE BIT NUMBER WHICH     *
*               INDICATES THE LIMIT OF CPU TIME THE SESSION MAY RUN  *
*               WITHOUT TERMINAL I/O.  000 = 1 MIN, 001 = 2 MINS,    *
*               ETCETERA WITH 111 = 8 MINS (THE ABSOLUTE MAXIMUM).   *
*   PSCBUFLG -- BITS 3 THRU 8 OF THE USER DATA FIELD ARE USED AS     *
*               BIT FLAGS                                            *
*   PSCBUIDL -- BITS 9 THRU 11 REPRESENT A THREE BIT NUMBER WHICH    *
*               INDICATES THE AMOUNT OF TIME A USER WILL BE LEFT     *
*               LOGGED ON WHILE IDLE IN MULTIPLES OF FIVE MINUTES.   *
*               (ZEROES IN THIS FIELD IMPLIES THAT A DEFAULT VALUE   *
*               BE USED)                                             *
*   PSCBUMLL -- BITS 12 THRU 15 REPRESENT A 4 BIT NUMBER FROM 1 TO   *
*               12 WHICH IS THE ORDINATE OF THE MONTH DURING WHICH   *
*               THE USER LAST LOGGED ON (ZEROES IN THIS FIELD WILL   *
*               DISABLE MONTHLY PASSWORD PROMPTING)                  *
*                                                                    *
**********************************************************************
         ORG   PSCBATR2           BACK TO INSTALLATION FIELDS
         SPACE 1
PSCBUSR1 DS    B                  FIRST BYTE OF USER FIELDS
PSCBUTL  EQU   B'11100000'        CPU SPIN LIMIT - 3-BIT NBR IS ONE    X
                                  LESS THAN LIMIT IN MINUTES
*        EQU   B'00010000'        RESERVED FOR FUTURE USE
*        EQU   B'00001000'        RESERVED FOR FUTURE USE
PSCBSPMT EQU   B'00000100'        PROMPT FOR SUB-ACCOUNT
PSCBPPMT EQU   B'00000010'        PROMPT FOR PROGRAMMER NAME
PSCBUCP  EQU   B'00000001'        USER ALLOWED TO CHANGE PASSWORD
         SPACE 1
PSCBUSR2 DS    B                  SECOND BYTE OF USER FIELDS
*        EQU   B'10000000'        RESERVED FOR FUTURE USE
PSCBUDFI EQU   B'01110000'        IDLE TIME LIMIT IN 5-MINUTE UNITS    X
                                  ZERO MEANS NO LIMIT IF 3270
PSCBUDFT EQU   B'00100000'        NON-3270 DEFAULT IS TEN MINUTES
PSCBUMPC EQU   B'00001111'        IF ANY BITS ON THEN USER WILL BE     X
                                  PROMPTED FOR NEW PSWD EVERY MONTH
         ORG   ,
         MEND  ,
./ ADD NAME=#IKJUPT  0100-00038-00038-1647-00031-00031-00000-MACRO
         MACRO ,
         #IKJUPT
.**********************************************************************
.*                                                                    *
.*       "CUSTOM" TSO USER PROFILE TABLE MAPPING                      *
.*                                                                    *
.*       THIS MACRO INVOKES IKJUPT TO MAP THE STANDARD USER PROFILE   *
.*       TABLE.  IN ADDITION IT DEFINES UPTUSER FIELDS.               *
.*                                                                    *
.**********************************************************************
         SPACE 1
         IKJUPT ,
         SPACE 2
         ORG   UPTUSER            UPTUSER FIELD DEFINITIONS
         IEZBITS ,
UPTSTACK DS    C                  XPCF STACK DELIMETER CHARACTER
UPTEXIT  DS    C                  XPCF EXIT  DELIMETER CHARACTER
         SPACE 1
UPTFLAGS DS    B                  XPCF FLAG BYTE
UPTTRACE EQU   BIT0               - XPCF TRACE
UPTINTER EQU   BIT1               - XPCF INTERACTIVE TRACE
UPTRES20 EQU   BIT2               - *  RESERVED FOR TESTING.
UPTRES10 EQU   BIT4               - *
UPTDBC   EQU   BIT4               - DBC USER FLAG
UPTAVERB EQU   BIT5               - ACCESS VERBOSITY FLAG
UPTRSVD  EQU   BIT6+BIT7          - RESERVED FOR FUTURE USE
         SPACE 1
UPTSPARE DS    XL7                RESERVED FOR FUTURE USE
         SPACE 1
         ORG   ,
         MEND  ,
./ ADD NAME=#INSTACK 0100-00038-00038-1647-00020-00020-00000-MACRO
         MACRO
        #INSTACK      &DSECT=INSTACK
*
*        I/O SERVICE ROUTINE INSTACK MAP
*
         SPACE
         AIF    ('&DSECT' EQ 'NO').ND
&DSECT   DSECT
.ND      ANOP
INSCODE  DS     XL1   TYPE OF ELEMENT
INSDATA  EQU    X'80' DATASET/TERMINAL
INSSTOR  EQU    X'40' STORAGE SOURCE/TERMIN DLM
INSINDD  EQU    X'20' INPUT DD PRESENT
INSOTDD  EQU    X'10' OUTPUT DD PRESENT
INSEXEC  EQU    X'08' EXEC COMMAND ELEMENT
INSPROM  EQU    X'04' PROMPTING ALLOWED
INSPROC  EQU    X'02' PROCEDURE ELEMENT
INSLIST  EQU    X'01' LIST OPTION
INADLSD  DS     AL3   LSD/IODSD ADDRESS
         MEND
./ ADD NAME=#IOSRL   0100-00038-00038-1647-00015-00015-00000-MACRO
         MACRO
        #IOSRL        &DSECT=IOSRL
*
*        I/O SERVICE ROUTINE WORK AREA MAP
*
         AIF    ('&DSECT' EQ 'NO').ND
         SPACE
&DSECT   DSECT
.ND      ANOP
IOSTELM  DS     A     CURRENT ELEMENT ADDRESS
IOSBELM  DS     A     BOTTOM ELEMENT ADDRESS
IOSTLEN  DS     XL2   TOTAL STACK SIZE
IOSNELM  DS     XL2   NOT USED
         DS     A     RESERVED
         MEND
./ ADD NAME=#LABELS  0100-00038-00038-1647-00082-00082-00000-MACRO
         MACRO
&NAME    #LABELS &DSECT=YES
         AIF   ('&DSECT' NE 'YES').#LBLCS
LBLDSECT DSECT
.#LBLCS  ANOP
DXLBL    DS    0CL80
VOLLABI  DS    CL3                          LABEL IDENTIFIER
VOLNO    DS    CL1                          VOLUME LABEL NUMBER
VOLSERNO DS    CL6                          VOLUME SERIAL NUMBER
VOLSEC   DS    CL1
         DS    0CL10                        RESERVED
VOLVTOC  DS    CL5                          VTOC ADDRESS (CCHHR)
         DS    CL5                          RESERVED
         DS    CL10                         RESERVED
         DS    CL10                         RESERVED
VOLOWNER DS    CL10                         OWNER NAME AND ADDRESS CODE
         DS    CL29                         RESERVED
         SPACE 1
***********************************************************************
*
*        ANSI VOLUME LABEL AREA
*        (ANSI AND IBM STANDARD LABEL DIFFERENCES)
*
***********************************************************************
         SPACE 1
         ORG   DXLBL+37
AVOLOWNR DS    CL14                     OWNER IDENTIFICATION
         DS    CL28                     RESERVED
LABSTAND DS    CL1                      LABEL STANDARD LEVEL
         SPACE 1
***********************************************************************
*
*        FILE LABEL 1 AREA - SEE 'DATA SET LABEL -- FL1'
*
***********************************************************************
         SPACE 1
         ORG   DXLBL
FL1LABI  DS    CL3                          LABEL IDENTIFIER
FL1NO    DS    CL1                          FILE LABEL NUMBER
FL1ID    DS    CL17                         FILE IDENTIFIER
FL1FILSR DS    CL6                          FILE SERIAL NUMBER
FL1VOLSQ DS    CL4                          VOLUME SEQUENCE NUMBER
FL1FILSQ DS    CL4                          FILE SEQUENCE NUMBER
FL1GNO   DS    CL4                          GENERATION NUMBER
FL1VNG   DS    CL2                          VERS. NUMBER OF GENERATION
FL1CREDT DS    CL6                          CREATION DATE
FL1EXPDT DS    CL6                          EXPIRATION DATE
FL1FSEC  DC    C'0'                         FILE SECURITY INDICATOR
FL1BLKCT DS    CL6                          BLOCK COUNT
FL1SYSCD DS    CL13                         SYSTEM CODE
FL1RES   DS    0CL7                         RESERVED
         DS    CL1                          RESERVED
FL1RES1  DS    CL6                          RESERVED
         SPACE 1
***********************************************************************
*
*        FILE LABEL 2 AREA - SEE 'DATA SET LABEL -- FL2'
*
***********************************************************************
         SPACE 1
         ORG   FL1ID
FL2RECFM DS    CL1                          RECORD FORMAT
FL2BLKL  DS    CL5                          BLOCK LENGTH
FL2LRECL DS    CL5                          RECORD LENGTH
FL2DEN   DS    CL1                          DENSITY
FL2FILP  DS    CL1                          FILE POSITION
FL2JSID  DS    0CL17                        JOB/STEP IDENTIFICATION
FL2JOBD  DS    CL8                          JOB IDENTIFICATION
FL2JSSP  DC    C'/'                         SLASH
FL2STEPD DS    CL8                          STEP IDENTIFICATION
FL2TRTCH DS    CL2                          TAPE RECORDING TECHNIQUE
FL2CNTRL DS    CL1                          CARRAIGE CONTROL CHARACTER
         DS    CL1                          RESERVED FOR FUTURE USE
FL2BLKA  DS    CL1                          BLOCK ATTRIBUTE
         DS    CL1                          RESERVED
FL2DRID  DS    0CL7                         TAPE DRIVE ID
         DS    CL2                          RESERVED
FL2ID    DS    CL5                          ID OF CREATING DRIVE
FL2DSIND DS    CL1                          DATA SET INDICATOR FIELD
FL2RES   DS    CL32                         RESERVED
         ORG   ,
         MEND
./ ADD NAME=#MODE    0100-00038-00038-1647-00034-00034-00000-MACRO
         MACRO ,
&LABEL   #MODE &WHAT,&R=R14
         GBLC  &SYSSPLV             SPLEVEL
         SPLEVEL TEST
         AIF   ('&SYSSPLV' NE '1').LEVEL2
         AIF   ('&R' EQ 'R14' OR '&R' EQ '14').LEVEL1
         MNOTE 12,'**** R=&R INVALID - MUST BE R14 WHEN SPLEVEL=1'
         MEXIT ,
.LEVEL1  AIF   ('&WHAT' EQ '24').SET124
         AIF   ('&WHAT' EQ '31').SET131
         MNOTE 8,'**** OPERAND MUST BE  ''24'' OR ''31'''
         MEXIT ,
.SET124  ANOP  ,
&LABEL   LA    &R,*+8                   POINT AFTER BRANCH
         B     890                      GO THROUGH PSARET
         MEXIT ,
.SET131  ANOP  ,
&LABEL   LA    &R,*+12                  POINT AFTER BRANCH
         O     &R,=X'80000000'          SET AMODE-31 BIT
         B     890                      GO THROUGH PSARET
         MEXIT ,
.LEVEL2  AIF   ('&WHAT' EQ '24').SET224
         AIF   ('&WHAT' EQ '31').SET231
         MNOTE 8,'**** OPERAND MUST BE  ''24'' OR ''31'''
         MEXIT ,
.SET224  ANOP  ,
&LABEL   LA    &R,*+6                   POINT AFTER BSM
         BSM   0,&R                     SET ADDRESSING MODE
         MEXIT ,
.SET231  ANOP  ,
&LABEL   LA    &R,*+10                  POINT AFTER BSM
         O     &R,=X'80000000'          SET AMODE-31 BIT
         BSM   0,&R                     SET ADDRESSING MODE
.MEND    MEND  ,
./ ADD NAME=#MODID   0100-00038-00038-1647-00151-00151-00000-MACRO
         MACRO
&LABEL   #MODID &VERS,&LVL,&BR=NO,&ID=
         GBLA  &#COPYSZ
         GBLB  &STBEG                   START/BEGIN PRESENT
         LCLA  &N(12),&D,&Y,&M,&X
         LCLC  &MON(12),&DAY,&YR,&VRS,&LEV,&MTH,&IDENT,&Q
         AIF   (NOT &STBEG).EXPAND
*  #MODID REDUNDANT DUE TO #START/BEGIN MACRO -- IGNORED
         MEXIT ,
.EXPAND  ANOP  ,
&MON(1)  SETC  'JAN'
&MON(2)  SETC  'FEB'
&MON(3)  SETC  'MAR'
&MON(4)  SETC  'APR'
&MON(5)  SETC  'MAY'
&MON(6)  SETC  'JUN'
&MON(7)  SETC  'JUL'
&MON(8)  SETC  'AUG'
&MON(9)  SETC  'SEP'
&MON(10) SETC  'OCT'
&MON(11) SETC  'NOV'
&MON(12) SETC  'DEC'
.*
.*   SET UP ARRAY FOR NUMBER OF DAYS PER MONTH
.*
&N(1)    SETA  31
&N(2)    SETA  28
&N(3)    SETA  31
&N(4)    SETA  30
&N(5)    SETA  31
&N(6)    SETA  30
&N(7)    SETA  31
&N(8)    SETA  31
&N(9)    SETA  30
&N(10)   SETA  31
&N(11)   SETA  30
&N(12)   SETA  31
.*
.*   PARSE OPERANDS (IF ANY)
.*
         AIF   ('&VERS' EQ '' OR T'&VERS EQ 'O').NOVERS
         AIF   (K'&VERS GT 1).ERR1
         AIF   ('&VERS' LT '1' OR '&VERS' GT '9').ERR1
         AIF   ('&SYSECT' EQ '').ERR4
.*
.*   IF NO VERSION NUMBER SPECIFIED, ASSUME VERSION 0
.*
&VRS     SETC  '&VERS'
         AGO   .CKLVL
.NOVERS  ANOP  ,
&VRS     SETC  '0'
.*
.*   SAME FOR LEVEL NO.
.*
.CKLVL   ANOP  ,
         AIF   ('&LVL' EQ '' OR T'&LVL EQ 'O').NOLVL
         AIF   (K'&LVL GT 1).ERR2
         AIF   ('&LVL' LT '0' OR '&LVL' GT '9').ERR2
&LEV     SETC  '&LVL'
         AGO   .GETDATE
.NOLVL   ANOP  ,
&LEV     SETC  '0'
.*
.*   GET THE DATE AND CONVERT IT TO JULIAN. THIS IS MESSY BUT IT'S
.*   THE ONLY WAY TO FIT IT INTO THE FORMAT. USE THE FORMAT OF THE DATE
.*   RETURNED TO DETERMINE WHICH ASSEMBLER WE ARE USING.
.*
.GETDATE ANOP  ,
&D       SETA  0
&M       SETA  0
         AIF   ('&SYSDATE'(3,1) EQ '/').NOTG
         MNOTE 12,'ASSEMBLER G MUST NOT BE USED'
         MEXIT ,
.*
.*   BUILD THE DAY FOR THE JULIAN DATE FROM THE ARRAY ABOVE
.*
.LOOP1   ANOP  ,
&M       SETA  &M+1
         AIF   (&M GT 12).ERR3
         AIF   ('&SYSDATE'(3,3) EQ '&MON(&M)').FOUND
&D       SETA  &D+&N(&M)
         AGO   .LOOP1
.FOUND   ANOP  ,
&DAY     SETC  '&SYSDATE'(6,2)
&X       SETA  &DAY
&D       SETA  &D+&X
         AIF   ('&SYSDATE'(1,2) EQ '00').NOTLEAP
&YR      SETC  '&SYSDATE'(1,2)
&X       SETA  &YR
         AIF   (((&X/4)*4)-&X NE 0).NOTLEAP
         AIF   (&M LT 3).NOTLEAP
&D       SETA  &D+1
         AGO   .NOTLEAP
.NOTG    ANOP  ,
&M       SETA  &M+1
         AIF   (&M GT 12).ERR3
&MTH     SETC  '&SYSDATE'(1,2)
&X       SETA  &MTH
         AIF   (&M EQ &X).ADD
&D       SETA  &D+&N(&M)
         AGO   .NOTG
.ADD     ANOP  ,
&DAY     SETC  '&SYSDATE'(4,2)
&X       SETA  &DAY
&D       SETA  &D+&X
         AIF   ('&SYSDATE'(7,2) EQ '00').NOTLEAP
&YR      SETC  '&SYSDATE'(7,2)
&X       SETA  &YR
         AIF   (((&X/4)*4)-&X NE 0).NOTLEAP
         AIF   (&M LT 3).NOTLEAP
&D       SETA  &D+1
.NOTLEAP ANOP  ,
.*
.*   PLAY A SILLY GAME TO ADD LEADING ZEROS
.*
         AIF   (K'&D EQ 3).GOOD
         AIF   (K'&D EQ 2).TWO
&DAY     SETC  '00&D'
         AGO   .CHKBR
.TWO     ANOP  ,
&DAY     SETC  '0&D'
         AGO   .CHKBR
.GOOD    ANOP  ,
&DAY     SETC  '&D'
.CHKBR   ANOP  ,
&Q       SETC  '#&VRS&LEV&YR&DAY'
         AIF   ('&BR' EQ 'NO').EQU
         #COPY SET
         B     &Q+&#COPYSZ                   AROUND THE DC'S
.EQU     ANOP  ,
.*
.*   EQUATE MODID TO CSECT NAME SO IT WILL SHOW IN LKED MAP
.*
.*       ENTRY &Q     (THIS IS UTTERLY USELESS IN AN SMP ENVIRONMENT)
         DC    CL8'&Q'                  MODULE ID
&IDENT   SETC  '&SYSECT'
         AIF   ('&ID' EQ '' OR T'&ID EQ 'O').DEFLT
&IDENT   SETC  '&ID'
.DEFLT   DC    CL8'&IDENT'              CSECT NAME
         DC    CL8'&SYSTIME'            TIME OF COMPILE
&Q       #COPY GEN                      COPYRIGHT NOTICE
*
         MEXIT ,
.ERR1    MNOTE 12,'VERSION NUMBER IS INVALID'
         MEXIT ,
.ERR2    MNOTE 12,'LEVEL NUMBER IS INVALID'
         MEXIT ,
.ERR3    MNOTE 16,'MORE THAN 12 MONTHS, YOU ARE IN TROUBLE'
         MEXIT ,
.ERR4    MNOTE 12,'NO CSECT NAME CODED'
         MEND  ,
./ ADD NAME=#PATCH   0100-00038-00038-1647-00019-00019-00000-MACRO
         MACRO ,
&LABEL   #PATCH &F=5,&ORG=
         GBLA  &#PATCHN
         LCLA  &N
         LCLC  &BEGIN
&#PATCHN SETA  &#PATCHN+1
&N       SETA  &#PATCHN
&BEGIN   SETC  '&SYSECT'
         AIF   ('&ORG' EQ '').Z
&BEGIN   SETC  '&ORG'
.Z       PUSH  PRINT
         PRINT ON,GEN,DATA
@PSIZE&N EQU   ((*-&BEGIN+99)/100)*&F
@PATCH&N DC    25S(*)                   MODULE PATCH AREA
         ORG   @PATCH&N
&LABEL   DC    ((@PSIZE&N+1)/2)S(*)
         ORG   ,
         POP   PRINT
         MEND  ,
./ ADD NAME=#REGS    0100-00038-00038-1647-00052-00052-00000-MACRO
         MACRO ,
         #REGS &TYPE=BAL
         GBLB  &REGS,&REGS##(3)
         AIF   ('&TYPE' NE 'PLS' AND '&TYPE' NE 'BOTH').BAL
         AIF   (&REGS##(1)).MEXIT
&REGS##(1) SETB 1
@00      EQU   0                        PL/S REGISTER EQUATES
@01      EQU   1
@02      EQU   2
@03      EQU   3
@04      EQU   4
@05      EQU   5
@06      EQU   6
@07      EQU   7
@08      EQU   8
@09      EQU   9
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
         AIF   ('&TYPE' NE 'BOTH').COMMON
.BAL     AIF   (&REGS##(2)).MEXIT
&REGS##(2) SETB 1
         AIF   (&REGS).COMMON           &REGS ALSO IN IBM YREGS MACRO
&REGS    SETB  1
R0       EQU   0                        STANDARD REGISTER EQUATES
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
.*
.COMMON  AIF   (&REGS##(3)).MEXIT
&REGS##(3) SETB 1
         IEZBITS ,                      EQUATES FOR BIT SETTINGS
FF       EQU   255                      GENERAL PURPOSE EQUATES
BF       EQU   255-C' '
X0       EQU   00
VL       EQU   X'80000000'
.MEXIT   MEND
./ ADD NAME=#SET     0100-00038-00038-1647-00155-00155-00000-MACRO
         MACRO
&NAME    #SET  &Z
         GBLA  &DCLDSW#             COUNTER OF # OF SWITCH BYTES
         GBLA  &DCLGSW#             COUNTER OF # OF GENERIC BYTES
         GBLB  &DCLDSWD(99)         DEFER DECLARE INDICATORS
         GBLC  &DCLDSWN(99)         SWITCH BYTE NAMES
         GBLC  &DCLDSWB(800)        SWITCH BIT NAMES
         GBLC  &DCLGSWN(99)         GENERIC SWITCH BYTE NAMES
         GBLC  &DCLGSWB(99)         GENERIC SWITCH BIT PREFIXES
         LCLA  &A,&B,&C,&D,&E       LOCAL WORK SYMBOLS
         LCLB  &F(20),&G
         LCLC  &K(20),&L(20),&M,&N,&O,&P,&Q,&SW(20),&MK(20),&MSK(20)
         AIF   (N'&SYSLIST EQ 0).SET2900   ERROR - NO SWITCHES
.*
.* FIRST ISOLATE ALL SWITCHES
.*
&O       SETC  '&NAME'              BUT FIRST GRAB THE LABEL
         AIF   ('&SYSLIST(1)'(1,1) EQ '(').SET0400   LIST, CONTINUE
&A       SETA  N'&SYSLIST           GET # PARAMETERS
&B       SETA  1                    INDEX INTO PARAMETERS
&C       SETA  1                    INDEX INTO FOUND SWITCHES
.SET0100 ANOP
&SW(&C)  SETC  '&SYSLIST(&B)'       ISOLATE SWITCH
&MK(&C)  SETC  'ON'                 DEFAULT MASK TO ON
         AIF   (&B EQ &A).SET0800   NO MORE, EXIT
         AIF   ('&SYSLIST(&B+1)' EQ '').SET0300   NO MASK, CONTINUE
         AIF   ('&SYSLIST(&B+1)' EQ 'ON').SET0300   ON, CONTINUE
         AIF   ('&SYSLIST(&B+1)' EQ 'OFF').SET0200   OFF, CONTINUE
         AIF   ('&SYSLIST(&B+1)' EQ 'FLIP').SET0200   FLIP, CONTINUE
         MNOTE 4,SET001I - MASK &SYSLIST(&B+1) INVALID, ON ASSUMED'   *
         AGO   .SET0300             CONTINUE
.SET0200 ANOP
&MK(&C)  SETC  '&SYSLIST(&B+1)'     SAVE MASK
.SET0300 ANOP
&C       SETA  &C+1                 BUMP FOUND INDEX
&B       SETA  &B+2                 BUMP PARAMETER INDEX
         AIF   (&B GT &A).SET0900   NO MORE, EXIT
         AGO   .SET0100             LOOP THROUGH ALL SWITCHES
.SET0400 ANOP
&M       SETC  'ON'                 DEFAULT MASK TO ON
         AIF   ('&SYSLIST(2)' EQ '' OR '&SYSLIST(2)' EQ 'ON').SET0600
         AIF   ('&SYSLIST(2)' EQ 'OFF').SET0500   OFF, CONTINUE
         AIF   ('&SYSLIST(2)' EQ 'FLIP').SET0500   FLIP, CONTINUE
         MNOTE 4,'SET001I - MASK &SYSLIST(2) INVALID, ON ASSUMED'
         AGO   .SET0600             CONTINUE
.SET0500 ANOP
&M       SETC  '&SYSLIST(2)'        SAVE MASK
.SET0600 ANOP
&A       SETA  N'&Z                 PICK UP NUMBER OF SWITCHES
&B       SETA  1                    INDEX INTO SWITCHES
&C       SETA  1                    INDEX INTO FOUND SWITCHES
.SET0700 ANOP
&SW(&C)  SETC  '&Z(&B)'             SAVE SWITCH
&MK(&C)  SETC  '&M'                 SAVE MASK
&C       SETA  &C+1                 BUMP FOUND INDEX
&B       SETA  &B+1                 BUMP SWITCH INDEX
         AIF   (&B GT &A).SET0900   FINISHED, EXIT
         AGO   .SET0700             LOOP THRU ALL SWITCHES
.SET0800 ANOP
&C       SETA  &C+1                 KEEP THE NEXT INSTRUCTION HAPPY
.*
.* THEN LOCATE THE SWITCHES
.*
.SET0900 ANOP
&A       SETA  &C-1                 GET # SWITCHES REQUESTED
         AIF   (&A EQ 0).SET2900    ERROR - NO SWITCHES
&B       SETA  0                    INDEX INTO SUPPLIED SWITCHES
&C       SETA  &DCLDSW#*8           POINT TO LAST DECLARED SWITCH
&D       SETA  1                    INDEX INTO # DECLARED SWITCHES
&E       SETA  0                    COUNTER OF # BYTES FOUND
.SET1000 AIF   (&B EQ &A).SET2200   FINISHED, EXIT SEARCH
&B       SETA  &B+1                 POINT TO NEXT SWITCH
&M       SETC  '&SW(&B)'            GRAB SUPPLIED SWITCH
.SET1100 AIF   (&DCLDSW# EQ 0).SET1300   NO DECLARED, TRY GENERICS
.SET1200 AIF   ('&M' EQ '&DCLDSWB(&D)').SET1500   FOUND HIM
&D       SETA  &D+1                 INDEX TO NEXT BIT
         AIF   (&D LE &C).SET1200   KEEP LOOKING
.SET1300 AIF   (&DCLGSW# EQ 0).SET3000   ERROR - SWITCH NOT FOUND
&D       SETA  1                    INDEX INTO # GENERIC SWITCHES
.SET1400 AIF   ('&M'(1,K'&DCLGSWB(&D)) EQ '&DCLGSWB(&D)').SET1600
&D       SETA  &D+1                 NOT HIM, INDEX TO NEXT PREFIX
         AIF   (&D LE &DCLGSW#).SET1400   KEEP LOOKING
         AGO   .SET3000             ERROR - SWITCH NOT FOUND
.*
.* INCOMING SWITCH IS A DECLARED SWITCH
.*
.SET1500 ANOP
&D       SETA  (&D+7)/8             INDEX TO DECARED BYTE NAME TABLE
&N       SETC  '&DCLDSWN(&D)'       GET BYTE NAME
         AGO   .SET1700             CONTINUE
.*
.* INCOMING SWITCH IS A GENERIC SWITCH
.*
.SET1600 ANOP
&N       SETC  '&DCLGSWN(&D)'       GET BYTE NAME
.*
.* ADD SWITCH BYTE AND SWITCH BIT NAME TO A TABLE AS FOLLOWS:
.*
.*    - IF THE BYTE NAME IS NOT IN THE TABLE, ADD IT
.*    - IF IT IS BUT THE MASKS DONT MATCH, ADD IT AS A NEW ENTRY
.*    - OTHERWISE, CONCATENATE THE NEW SWITCH BIT NAME TO THE OLD
.*      SWITCH BIT NAME, WITH A '+' SIGN IN BETWEEN
.*
.SET1700 AIF   (&E EQ 0).SET2000    FIRST ENTRY, CONTINUE
&D       SETA  1                    INDEX INTO FOUND TABLES
.SET1800 AIF   ('&N' EQ '&K(&D)').SET1900   MATCHING NAME, CONTINUE
&D       SETA  &D+1                 POINT TO NEXT ENTRY
         AIF   (&D LE &E).SET1800   KEEP LOOKING
         AGO   .SET2000             THIS GUY IS NEW
.SET1900 AIF   ('&MK(&B)' EQ '&MSK(&D)').SET2100   SAME SEX TOO..
&D       SETA  &D+1                 POINT TO NEXT ENTRY
         AIF   (&D LE &E).SET1800   KEEP LOOKING
.*
.* THIS ENTRY IS A NEW BYTE NAME
.*
.SET2000 ANOP
&E       SETA  &E+1                 BUMP COUNTER OF # FOUND
&K(&E)   SETC  '&N'                 SAVE BYTE NAME
&L(&E)   SETC  '&M'                 SAVE BIT NAME
&MSK(&E) SETC  '&MK(&D)'            SAVE MASK
         AGO   .SET1000             GO, GET NEXT SUPPLIED SWITCH
.*
.* THIS ENTRY IS AN OLD ENTRY
.*
.SET2100 ANOP
&L(&D)   SETC  '&L(&D).+&M'         CONCATENATE SWITCH BIT NAMES
         AGO   .SET1000             GO, GET NEXT SUPPLIED SWITCH
.*
.* NOW TO DO SOME REAL WORK
.*
.SET2200 AIF   (&E EQ 0).SET2900    ERROR - NO SWITCHES CODED
&A       SETA  1                    INDEX INTO FOUND SWITCHES
.SET2300 ANOP
.SET2400 AIF   ('&MSK(&A)' EQ '').SET2500   OMITTED, ASSUME ON
         AIF   ('&MSK(&A)' EQ 'ON').SET2500   ON, CONTINUE
         AIF   ('&MSK(&A)' EQ 'OFF').SET2600   OFF, CONTINUE
         AIF   ('&MSK(&A)' EQ 'FLIP').SET2700   FLIP, CONTINUE
         MNOTE 4,'SET001I - &MSK(&A) INVALID MASK, ''ON'' ASSUMED'
.SET2500 ANOP
&O       OI    &K(&A),&L(&A)
         AGO   .SET2800             CONTINUE
.SET2600 ANOP
&O       NI    &K(&A),255-(&L(&A))
         AGO   .SET2800             CONTINUE
.SET2700 ANOP
&O       XI    &K(&A),&L(&A)
.SET2800 ANOP
&O       SETC  ''                   CLEAR LABEL
&A       SETA  &A+1                 BUMP INDEX OF SWITCHES
         AIF   (&A LE &E).SET2300   LOOP THRU ALL SWITCHES
         MEXIT                      EXIT
.SET2900 MNOTE 8,'SET001A - NO SWITCHES SPECIFIED'
         MEXIT                      EXIT
.SET3000 MNOTE 8,'SET002A - SWITCH &M NOT DECLARED'
         MEND
./ ADD NAME=#SETRC   0100-00038-00038-1647-00023-00023-00000-MACRO
         MACRO
&NAME    #SETRC &R,&FIELD=,&FORCE=N
&NAME    DS    0H
         GBLB  &STWA                ON MEANS A WORK AREA EXISTS
         GBLC  &STPREF              WORK AREA PREFIX
         LCLC  &F                   USED TO HOLD FIELD NAME
         AIF   ('&FIELD' EQ '').SET0100   NO FIELD, CONTINUE
&F       SETC  '&FIELD'             PICK UP FIELD NAME
         AGO   .SET0200             CONTINUE
.SET0100 AIF   (NOT &STWA).SET0600   ERROR - NO FIELD PROVIDED
&F       SETC  '&STPREF.RCODE'      PICK UP WORK AREA RC FIELD
.SET0200 AIF   ('&R' EQ '').SET0400 ASSUME R15 HAS RETURN CODE
         AIF   ('&R'(1,1) EQ '(').SET0300   R IS A REGISTER
         LA    R15,&R               R15 HAS RETURN CODE
         AGO   .SET0400             CONTINUE
.SET0300 LR    R15,&R(1)            R15 HAS RETURN CODE
.SET0400 AIF   ('&FORCE' EQ 'Y' OR  '&FORCE' EQ 'YES').SET0500
         CL    R15,&F               COMPARE NEW RC TO CURRENT RC
         BNH   *+8                  KEEP THE HIGHEST
.SET0500 ST    R15,&F               RETURN CODE
         MEXIT                      EXIT
.SET0600 MNOTE 8,'SET001I - MISSING FIELD NAME'
         MEND
./ ADD NAME=#SIFT    0100-00038-00038-1647-00088-00088-00000-MACRO
         MACRO ,
&NAME    #SIFT &VEC,&REG,&VER=YES,&ERR=,&WORK=R0
         LCLA  &I,&J
         LCLB  &B
         LCLC  &R,&ERRLBL
&ERRLBL  SETC  'SIF&SYSNDX.E'
&R       SETC  'R15'                    SET DEFAULT INDEX REG
&B       SETB  ('&VEC(N'&VEC)' EQ '*')  IF NOOP AS LAST ELEMENT
         AIF   ('&REG' EQ '').NE
&R       SETC  '&REG'                   OR OVERRIDE REG
.*
.NE      AIF   ('&VER' EQ 'YES').VERIFY
*   CODE OPTIMIZED FOR VER=NO
&NAME    B     *+4(&R)                  ENTER BRANCH TABLE
         AGO   .SIFT
.VERIFY  ANOP  ,
         AIF   (N'&VEC GT 4).BRTAB
.XPLICIT ANOP  ,
&I       SETA  0
&NAME    LTR   &R,&R                    CHECK IF ZERO
.CHLOOP  AIF   (&I GE N'&VEC).CHEND
&J       SETA  &I*4
&I       SETA  &I+1
         AIF   (&I EQ 1).BIF
         C     &R,=F'&J'                CHECK CODE
.BIF     AIF   ('&VEC(&I)' EQ '').ERRBX
         AIF   ('&VEC(&I)' EQ '*').ENDBRX
         BE    &VEC(&I)                 BR IF EQUAL
         AGO   .CHLOOP
.ERRBX   BE    &ERRLBL                  TO ERROR IF EQUAL
         AGO   .CHLOOP
.ENDBRX  ANOP  ,
         BE    &ERRLBL+4                TO NSI AFTER MACRO
         AGO   .CHLOOP
.CHEND   ANOP  ,
         AIF   ('&ERR' EQ '').EXAST1
&ERRLBL  B     &ERR                     ERROR BRANCH
         MEXIT ,
.*
.EXAST1  ANOP  ,
&ERRLBL  EX    0,*                      ERROR  (ABEND 0C3)
         MEXIT ,
.*
.BRTAB   ANOP
&NAME    LCR   &WORK,&R
&I       SETA  1                        BYPASS ZERO CASE
         AIF   ('&VEC(1)' EQ '').ERRB
         AIF   ('&VEC(1)' EQ '*').ENDBR
         BZ    &VEC(1)                  BRANCH IF ZERO CODE
         AGO   .MORECHK
.ERRB    BZ    &ERRLBL                  BRANCH IF ZERO CODE ERROR
         AGO   .MORECHK
.ENDBR   ANOP  ,
&J       SETA  N'&VEC*4-4*&B
         BZ    &ERRLBL+&J               BRANCH IF ZERO CODE
.MORECHK NR    &WORK,&R                 CHECK CODE
         SRA   &WORK,2                  MULTIPLE OF 4?
         BNP   &ERRLBL                  NO, ERROR
&J       SETA  4*(N'&VEC-1)             CONSTANT GOOD INDEX RANGE
         CL    &R,=F'&J'                OVER MAX?
         BNH   &ERRLBL.(&R)             ENTER BRANCH TABLE IF GOOD
         AIF   ('&ERR' EQ '').BLOW
&ERRLBL  B     &ERR                     ELSE GO TO ERROR
         AGO   .SIFT
.*
.BLOW    ANOP  ,                        VER=YES, NO ERR EXIT
&ERRLBL  EX    0,*                      ELSE BLOW UP  (ABEND 0C3)
.*
.SIFT    ANOP  ,
&I       SETA  &I+1
         AIF   (&I GT N'&VEC).MEND
         AIF   ('&VEC(&I)' EQ '').EXAST NULL ARG
         AIF   ('&VEC(&I)' EQ '*').NOP  '*' -- GEN NO-OP
         B     &VEC(&I)                  *
         AGO   .SIFT
.*
.EXAST   AIF   ('&ERR' EQ '' AND '&VER' EQ 'NO').EX0C3
         B     &ERRLBL                   *  INVALID CASE
         AGO   .SIFT
.EX0C3   EX    0,*                       *  INVALID CASE
         AGO   .SIFT
.*
.NOP     AIF   (&I EQ N'&VEC).MEND       '*' TABLE ENTRY
&J       SETA  4*(N'&VEC-&I+1)-4*&B
         B     *+&J                      *  TO NSI AFTER MACRO
         AGO   .SIFT                    CLOSE LOOP
.*
.MEND    MEND  ,
./ ADD NAME=#START   0100-00038-00038-1647-00721-00721-00000-MACRO
         MACRO ,
&NAME    #START ,                       #START MACRO                   X
               &AMODE=,                 ADDRESSING MODE                X
               &APARS=5,                RESERVE 5 APAR SLOTS           X
               &BASE=,                  1 OR MORE BASE REGISTERS       X
               &BNDRY=,                 WHAT GETMAIN TO LOOK LIKE      X
               &CAPREG=,                REGISTER TO SAVE CAP WORD      X
               &COPY=YES,               GENERATE COPYRIGHT             X
               &COPYYR=,                COPYRIGHT YEAR                 X
               &CSECT=YES,              GENERATE A CSECT STATEMENT     X
               &ENUC=,                  EXTENDED NUCLEUS NAME          X
               &EXTKEY=,                SVC EXECUTION KEY              X
               &ID=,                    GENERATE ID INFORMATION        X
               &ISA=,                   INITIAL STACK AREA SIZE        X
               &LEVEL=,                 MODULE LEVEL (SMP ID)          X
               &LINK=YES,               LINK USED 'BALR 14,15'         X
               &LOC=,                   WHERE TO GETMAIN FROM          X
               &PATCH=,                 PATCH AREA REQUIRED            X
               &PREFIX=,                PREFIX FOR GENERATED SYMBOLS   X
               &REG0=,                  REGISTER 0 TO BE SAVED         X
               &REG1=,                  REGISTER 1 TO BE SAVED         X
               &RMODE=,                 RESIDENCY MODE                 X
               &RSECT=NO,               READ-ONLY CONTROL SECTION      X
               &SAVE=YES,               SAVE REGISTERS (YES/NO)        X
               &SP=,                    SUBPOOL FOR WORK DSECT         X
               &SPLEVEL=,               MVS LEVEL (1/2)                X
               &SVAREA=YES,             SAVE AREA REQUIRED (YES/NO)    X
               &SVC=,                   ROUTINE IS/IS NOT AN SVC       X
               &USING=,                 AREAS TO BE MAPPED             X
               &WKCSECT=,               NAME OF WORK CSECT             X
               &WKDSECT=                NAME OF WORK DSECT
.*
.* DEFINE SYMBOLS NEEDED
.*
         GBLA  &STWAC                   COUNTER FOR DEFERED WA DEFINES
         GBLA  &#COPYSZ
         GBLB  &STBEG                   START/BEGIN PRESENT
         GBLB  &STWA                    INDICATES CSECT HAS A WORK AREA
         GBLB  &STF(16)                 CONTROL FLAG BITS, AS FOLLOWS:
.*                                       (01) - PROC OPTION CODED
.*                                       (02) - MAIN OPTION CODED
.*                                       (03) - LIFO OPTION CODED
.*                                       (04) - WKCSECT OPTION CODED
.*                                       (05) - WKDSECT OPTION CODED
.*                                       (06) - #START HAS BEEN CODED
.*                                       (07) - ROUTINE IS AN SVC
.*                                       (08) - WORK FIELDS WANTED
.*                                       (09) - SVAREA=NO OPTION
.*                                       (10) - SAVE=YES OPTION
.*                                       (11) - RSECT=YES OPTION
.*                                       (12) - SVC=(YES,BRANCH)
.*                                       (13) - ENUC CAPPING
.*                                       (14) - PATCH AREA REQUEST
.*                                       (15) - MODID LABEL GENERATED
.*
         GBLC  &#COPYYR
         GBLC  &STACREG                 CAPWORD SAVE REGISTER
         GBLC  &STAGREG                 GET/FREEMAIN FORMAT
         GBLC  &STAMODE                 MODULE'S CAPPED AMODE
         GBLC  &STAXKEY                 SVC EXECUTION KEY
         GBLC  &STISASZ                 LIFO ISA SIZE
         GBLC  &STNAME                  MAIN CSECT NAME
         GBLC  &STPREF                  PREFIX CHARACTERS
         GBLC  &STSPN                   SUBPOOL NUMBER
         GBLC  &STWAD(1000)             WORK AREA DEFERED STACK
         GBLC  &STWANAM                 WORK AREA NAME
         GBLC  &SYSSPLV                 SPLEVEL
         LCLA  &A,&B,&C,&D,&E,&Q        LOCAL
         LCLB  &F,&G,&H,&I,&J,&QQ,&R2,&R3,&RRREGS WORK
         LCLC  &K,&L,&M,&N,&O,&P,&W     SYMBOLS
.*
.* INITIALIZE SYMBOLS, SET UP PREFIX, PICK UP ALL OPERANDS
.*
&STAXKEY SETC  '&EXTKEY'
         SPLEVEL TEST                   GET ORIGINAL SPLEVEL
&STAGREG SETC  'RU'                     SVC-78
         AIF   ('&LOC' EQ '').ST00000
&W       SETC  ',LOC=&LOC'
.ST00000 ANOP  ,
.*
&STWAC   SETA  1                        INITIALIZE WORK FIELD STACK
&STBEG   SETB  1                        START/BEGIN PRESENT
&STWA    SETB  0                        CLEAR ALL GLOBAL SYMBOLS
&STF(1)  SETB  0
&STF(2)  SETB  0
&STF(3)  SETB  0
&STF(4)  SETB  0
&STF(5)  SETB  0
&STF(6)  SETB  1                        FLAG TO SAY  #START
&STF(7)  SETB  0
&STF(9)  SETB  0
&STF(10) SETB  0
&STF(11) SETB  0
&STF(13) SETB  0
&STF(14) SETB  ('&PATCH' EQ 'YES' OR '&PATCH' EQ 'Y')
&STF(14) SETB  (&STF(14) OR ('&PATCH' EQ '' AND '&WKDSECT' NE ''))
&#COPYYR SETC  ''                       PASS YEAR TO #COPY
         AIF   ('&COPYYR' EQ '').NOYEAR
&#COPYYR SETC  '&COPYYR'                PASS YEAR TO #COPY
.NOYEAR  ANOP  ,
&STWANAM SETC  ''
&STAMODE SETC  ''
&STACREG SETC  '&CAPREG'
&QQ      SETB  ('&COPY' NE 'NO')        COPYRIGHT SWITCH
         #COPY SET                      SET COPYRIGHT LENGTH
.*
.*
         AIF   ('&NAME' EQ '').ST09010  ERROR - MISSING CSECT NAME
         AIF   ('&CSECT'(1,1) EQ 'N').ST00020
&STNAME  SETC  '&NAME'                  SAVE MAIN CSECT NAME
.ST00020 ANOP  ,
.*
         AIF   ('&ENUC' EQ '' OR '&SYSSPLV' NE '2').ST00030
&STNAME  SETC  '&ENUC'                  SAVE MAIN CSECT NAME
.ST00030 AIF   ('&WKDSECT&WKCSECT' EQ '').ST00040
         AIF   ('&SAVE' NE 'YES').ST09040
         AIF   ('&SVAREA' NE 'YES').ST09050
.ST00040 ANOP  ,
.*
&K       SETC  '&STNAME.XXX'(1,3)
         AIF   ('&CSECT'(1,1) EQ 'Y').ST00045
&K       SETC  '&NAME.XXX'(1,3)
         AIF   ('&WKDSECT&WKCSECT' EQ '').ST00045
&K       SETC  '&WKDSECT&WKCSECT.XXX'(1,3)
.ST00045 ANOP  ,
&STF(12) SETB  ('&SVC' EQ '(YES,BRANCH)')
&G       SETB  ('&SVC' EQ 'YES' OR '&SVC' EQ '(YES)' OR &STF(12))
         AIF   ('&SVC' NE '').ST00050
&F       SETB  ('&K' EQ 'IGC' OR '&K' EQ 'IGG' OR '&K' EQ 'IGX')
.ST00050 ANOP  ,
&STF(7)  SETB  (&F OR &G)               SET SVC SWITCH
.*
         AIF   (NOT &STF(7)).ST00090
         AIF   ('&WKCSECT' EQ '').ST00070
         IHBERMAC 1020,WKCSECT,SVC
&J       SETB  1
.ST00070 AIF   ('&BASE' EQ '').ST00080
         IHBERMAC 1020,BASE,SVC
&J       SETB  1
.ST00080 AIF   (&J).MEND
.*
.ST00090 AIF   ('&PREFIX' EQ '').ST00200   NO PREFIX, CONTINUE
         AIF   (K'&PREFIX GT 3).ST00100    PREFIX NEEDS TO BE CUT
&STPREF  SETC  '&PREFIX'                ESTABLISH PREFIX
         AGO   .ST00300                 CONTINUE
.ST00100 ANOP  ,
&STPREF  SETC  '&PREFIX'(1,3)           TRUNCATE PREFIX
         AGO   .ST00300                 CONTINUE
.ST00200 ANOP  ,
&STPREF  SETC  '&K'                     SET PREFIX TO CSECT 3 CHAR
.ST00300 ANOP  ,
&P       SETC  '&STPREF'                MAKE PREFIX EASIER TO WORK WITH
.*
&STSPN   SETC  '253'                    SET DEFAULT SUBPOOL FOR SVC
         AIF   (&STF(7)).ST00330        USE SUBPOOL 253 FOR SVC
&STSPN   SETC  '1'                      SET DEFAULT SUBPOOL TO 1
.ST00330 AIF   ('&SP' EQ '').ST00350    NO SUBPOOL CODED, CONTINUE
&STSPN   SETC  '&SP'                    PICK UP SUBPOOL
.ST00350 ANOP  ,
.*
&A       SETA  N'&SYSLIST               PICK UP NUMBER OF PARAMETERS
&B       SETA  0                        INDEX OF PARAMETER
.ST00400 ANOP  ,
&B       SETA  &B+1                     POINT TO NEXT PARAMETER
         AIF   (&B GT &A).ST00700       GOT ALL POSITIONAL PARAMETERS
&K       SETC  '&SYSLIST(&B)'           PICK UP PARMATER
         AIF   ('&K' NE 'PROC').ST00500 NOT PROC PARAMETER, CONT
&STF(1)  SETB  1                        INDICATE PROC PARAMETER
         AGO   .ST00400                 CONTINUE WITH NEXT PARAMETER
.ST00500 AIF   ('&K' NE 'PROC(MAIN)').ST00600   NOT MAIN PARM, CONT
&STF(1)  SETB  1                        INDICATE PROC PARAMETER
&STF(2)  SETB  1                        INDICATE MAIN PARAMETER
         AGO   .ST00400                 CONTINUE WITH NEXT PARAMETER
.ST00600 AIF   ('&K' NE 'LIFO').ST00400 NOT LIFO PARM, CONTINUE
&STF(3)  SETB  1                        INDICATE LIFO PARAMETER
         AGO   .ST00400                 CONTINUE  WITH NEXT PARAMETER
.ST00700 AIF   ('&WKDSECT' EQ '').ST00800   NO WORK DSECT, CONTINUE
&STF(5)  SETB  1                        INDICATE WORK AREA IS A DSECT
&STWA    SETB  1                        INDICATE WORK AREA IS PRESENT
&STWANAM SETC  '&WKDSECT'               SAVE WORK AREA NAME
.ST00800 AIF   ('&WKCSECT' EQ '').ST00900   NO WORK CSECT, CONTINUE
         AIF   (&STF(1)).ST09030        ERROR - PROC
         AIF   (&STF(5)).ST09020        ERROR - WKDSECT
&STF(4)  SETB  1                        INDICATE WORK AREA IS A CSECT
&STWA    SETB  1                        INDICATE WORK AREA IS PRESENT
&STWANAM SETC  '&WKCSECT'               SAVE WORK AREA NAME
.*
         AIF   ('&SP' EQ '').ST00900    NO SUBPOOL PARAMETER, CONTINUE
         IHBERMAC 1016,SP,WKCSECT
.*
.ST00900 AIF   ('&ISA' EQ '').ST00910   NO ISA PARM, CONTINUE
         AIF   (&STF(2) AND &STF(3)).ST00910   PROC(MAIN) AND LIFO?
         MNOTE 4,'ST1002I - ISA IGNORED WITHOUT PROC(MAIN) AND LIFO'
.ST00910 AIF   (NOT &STF(1)).ST01000    NOT PROC OPTION, CONTINUE
         AIF   (&STF(5)).ST01000        WKDSECT OPTION, CONTINUE
&STWANAM SETC  '&P.WA'                  GENERATE WORK AREA NAME
&STWA    SETB  1                        INDICATE A WORK AREA PRESENT
&STF(5)  SETB  1                        INDICATE WKDSECT OPTION
.*
.* NOW START WITH PRELIMINARIES, ETC
.*
.ST01000 AIF   ('&SPLEVEL' EQ '').ST01010
         AIF   ('&SPLEVEL' EQ '&SYSSPLV').ST01010
         SPLEVEL SET=&SPLEVEL
.*
.ST01010 AIF   ('&RSECT'(1,1) EQ 'Y').ST01020
         AIF   ('&CSECT'(1,1) EQ 'N').ST01015
&STNAME  CSECT ,                        #START MACRO
         AGO   .ST01030
.ST01015 ANOP  ,
&NAME    DS    0D                       #START MACRO
         ENTRY &NAME
         AGO   .ST01030
.ST01020 ANOP  ,
&STNAME  RSECT ,                        #START MACRO
&STF(11) SETB  1
.*
.ST01030 AIF   ('&ENUC' EQ '').ST01050
         AIF   ('&AMODE' EQ '').ST01032
         IHBERMAC 1016,AMODE,ENUC
.ST01032 AIF   ('&RMODE' EQ '').ST01034
         IHBERMAC 1016,RMODE,ENUC
.ST01034 ANOP  ,
&STNAME  AMODE 31
&STNAME  RMODE ANY
         AIF   ('&SYSSPLV' NE '2').ST01070
&STF(13) SETB  1                        FLAG FOR BSM RETURN
         SPACE 1
&NAME    RSECT ,                        FRONT-END MODULE FOR CODE
&NAME    AMODE ANY                      TO RESIDE IN EXTENDED NUCLEUS
&NAME    RMODE 24                       WHICH IS BRANCH-ENTERABLE
         L     R15,8(0,R15)             LOAD ADDRESS OF REAL MODULE
         BSM   R14,R15                  BRANCH AND HANDLE AMODE
         DC    H'0'
         DC    A(&STNAME+X'80000000')   ADDRESS OF REAL MODULE
         SPACE 1
         AIF   (&STF(11)).ST01036
&STNAME  CSECT ,                        RESUME MAIN CSECT
         AGO   .ST01070
.ST01036 ANOP  ,
&STNAME  RSECT ,                        RESUME MAIN RSECT
         AGO   .ST01070
.ST01050 AIF   ('&AMODE' EQ '').ST01060
         AIF   ('&AMODE' EQ 'CAP24' OR '&AMODE' EQ 'CAP31').ST01055
&STNAME  AMODE &AMODE
         AGO   .ST01060
.ST01055 ANOP  ,
&STAMODE SETC  '&AMODE'(4,2)            SAVE CAPPED AMODE
&STNAME  AMODE ANY
         AIF   ('&RMODE' NE '').ST01065
&STNAME  RMODE 24
         AGO   .ST01070
.ST01060 AIF   ('&RMODE' EQ '').ST01070
.ST01065 ANOP  ,
&STNAME  RMODE &RMODE
.ST01070 SPACE 1
         #REGS ,
         AIF   (&STF(7)).ST04000        GO TO SVC SECTION
.*
         SPACE 1
         AIF   ('&ID' EQ 'YES').ST01080
         AIF   ('&ID' EQ 'NO').ST01150
         AIF   ('&CSECT'(1,1) NE 'N').ST01080
         B     14(0,R15)                SKIP SUB-ROUTINE NAME
         DC    AL1(8)                   LENGTH OF SUB-ROUTINE NAME
         DC    CL8'&NAME'               SUB-ROUTINE NAME
*
         AGO   .ST01150
.ST01080 ANOP  ,
&Q       SETA  30+&#COPYSZ*&QQ
         AIF   ('&LEVEL' EQ '').ST01100
&Q       SETA  &Q+8                     ALLOW FOR LEVEL
.ST01100 AIF   ('&APARS' EQ '').ST01130
&Q       SETA  &Q+(&APARS*4)            ALLOW FOR APARS
.ST01130 B     &Q.(0,R15)               BRANCH AROUND PROGRAM ID
*
&Q       SETA  &Q-5-&#COPYSZ*&QQ
         DC    AL1(&Q)                  LENGTH OF PROGRAM ID
         AIF   (&STF(15)).ST01132       BIF LABEL GENERATED
&P.MODID DC    CL8'&NAME '              MODULE NAME
&STF(15) SETB  1                        SET LABEL GENERATED
         AGO   .ST01135                 GEN REST OF MODID
.ST01132 ANOP  ,                        MODULE NAME/NO LABEL
         DC    CL8'&NAME '              MODULE NAME
.ST01135 ANOP  ,
         DC    CL8' &SYSTIME '          TIME OF ASSEMBLY
         DC    CL9'&SYSDATC'            DATE OF ASSEMBLY
         AIF   ('&LEVEL' EQ '').ST01137
         DC    CL8'&LEVEL'              MODULE LEVEL
.*
.ST01137 AIF   ('&APARS' EQ '').ST01140
         DC    &APARS.CL4' '            APAR SLOTS
.*
.ST01140 AIF   ('&COPY' EQ 'NO').ST01150
         #COPY GEN                      COPYRIGHT NOTICE
*
.ST01150 AIF   ('&SAVE' NE 'YES').ST01160
         STM   R14,R12,12(R13)          SAVE CALLER'S REGISTERS
&STF(10) SETB  1
.*
.ST01160 AIF   ('&BASE' NE '').ST01200   BASE SPECIFIED, CONTINUE
.*
         AIF   (&STF(1) OR &STF(3) OR &STF(4) OR &STF(5)).ST01180
         AGO   .ST01300                 BASE WILL BE R13 (LATER)
.ST01180 ANOP  ,                        DEFAULT BASE IS R12
         AIF   ('&LINK' EQ 'NO').ST01190 'BALR 14,15'?
         LA    R12,0(0,R15)             LOAD BASE REGISTER WITH EPA
         USING &NAME,R12
         AGO   .ST01300                 CONTINUE
.ST01190 ANOP  ,
         BALR  R12,0                    GET
&P.BASE  DS    0H                       . BASE
         USING &P.BASE,R12              . REGISTER
         AGO   .ST01300                 CONTINUE
.*
.ST01200 ANOP  ,
         AIF   ('&LINK' EQ 'NO').ST01202 'BALR 14,15'?
         LA    &BASE(1),0(0,R15)        LOAD BASE REGISTER WITH EPA
         AIF   ('&BASE'(1,1) EQ '(').ST01205
         USING &NAME,&BASE
         AGO   .ST01204                 CONTINUE
.ST01202 ANOP  ,
         BALR  &BASE(1),0               GET
&P.BASE  DS    0H                       . BASE
         AIF   ('&BASE'(1,1) EQ '(').ST01205
         USING &P.BASE,&BASE            . REGISTER
.ST01204 ANOP  ,
&R2      SETB  (&R2 OR '&BASE' EQ '2' OR '&BASE' EQ 'R2')
&R3      SETB  (&R3 OR '&BASE' EQ '3' OR '&BASE' EQ 'R3')
         AGO   .ST01300                 ONLY ONE BASE REG
.ST01205 ANOP  ,
&K       SETC  '&BASE'(2,K'&BASE-2)     REMOVE PARENS
         AIF   ('&LINK' EQ 'NO').ST01207 'BALR 14,15'?
         USING &NAME,&K
         AGO   .ST01209                 CONTINUE
.ST01207 ANOP  ,
         USING &P.BASE,&K
.ST01209 ANOP  ,
&A       SETA  1
.ST01210 ANOP  ,
&R2      SETB  (&R2 OR '&BASE(&A)' EQ '2' OR '&BASE(&A)' EQ 'R2')
&R3      SETB  (&R3 OR '&BASE(&A)' EQ '3' OR '&BASE(&A)' EQ 'R3')
&A       SETA  &A+1
         AIF   ('&BASE(&A)' EQ '').ST01300   NO MORE, CONTINUE
         LA    &BASE(&A),2048(0,&BASE(&A-1))
         LA    &BASE(&A),2048(0,&BASE(&A))
         AGO   .ST01210
.*
.ST01300 AIF   (&STF(1) OR &STF(3) OR &STF(4) OR &STF(5)).ST01600
         AIF   ('&SVAREA' NE 'YES').ST01400
.*
.* FOLLOWING IS FOR NO FRILLS INLINE SAVE AREA
.*
         LR    R14,R13                  SAVE CALLERS SAVE AREA ADDRESS
         CNOP  0,4
         LA    R13,*+8-&NAME.(0,R15)    POINT TO SAVE AREA
         B     72(0,R13)                BR AROUND SAVE AREA
         AIF   ('&BASE' NE '').ST01320
         USING *,R13                    ADDRESSABILITY
.ST01320 ANOP  ,
&K       SETC  ''
         AIF   ('&STAMODE' EQ '').ST01330
&K       SETC  '&P.CAPWD'
.ST01330 ANOP  ,
&K       DC    18F'0'                   SAVE AREA
         ST    R14,4(0,R13)             CHAIN SAVE
         ST    R13,8(0,R14)             AREAS TOGETHER
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR SVAREA=NO OPTION
.*
.ST01400 ANOP  ,
&STF(9)  SETB  1                        REMEMBER FOR #STOP
         AIF   ('&BASE' NE '').ST02500
         USING &NAME,R15                ADDRESSABILITY
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR WKCSECT OPTION
.*
.ST01600 AIF   (&STF(1) OR &STF(5)).ST01700   PROC OR WKDSECT, CONT
         LR    R15,R13                  SAVE CALLER'S SAVE AREA ADRRESS
         L     R13,=A(&WKCSECT)         AND PICK UP ADDRESS OF NEW ONE
         USING &WKCSECT,R13             ESTABLISH ADDRESSABILITY TO IT
         ST    R15,4(0,R13)             CHAIN SAVE
         ST    R13,8(0,R15)             AREAS TOGETHER
         XC    &P.RCODE,&P.RCODE        CLEAR RETURN CODE FIELD
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR WKDSECT OPTION WHEN NO PROC(MAIN) OR PROC OPTIONS
.*
.ST01700 AIF   (&STF(1) OR &STF(2)).ST01800   PROC OR MAIN, CONTINUE
&RRREGS  SETB  1                        REGS WILL BE ALTERED
         MNOTE '         GETMAIN &STAGREG,LV=&P.WALEN&W,SP=&STSPN'
         GETMAIN &STAGREG,LV=&P.WALEN,LOC=&LOC,SP=&STSPN,BNDRY=&BNDRY
         L     R3,=A(&P.WALEN)          R3 HAS LENGTH OF WORK AREA
         LR    R2,R1                    R2 POINTS TO WORK AREA
         SR    R15,R15                  R15 HAS PAD BYTE & ZERO LENGTH
         MVCL  R2,R14                   CLEAR WORK AREA
         ST    R13,4(0,R1)              CHAIN SAVE AREAS
         ST    R1,8(0,R13)              TOGETHER
         LR    R13,R1                   PT TO WORK AREA AND SAVE AREA
         USING &WKDSECT,R13             ESTABLISH ADDRESSABILITY TO IT
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR PROC OPTION WITHOUT MAIN OR LIFO OPTION
.*
.ST01800 ANOP  SET                      WORK AREA NAME
&N       SETC  '&STWANAM'               PICK UP WORK AREA NAME
.ST01900 AIF   (&STF(2) OR &STF(3)).ST02000   MAIN OR LIFO, CONTINUE
         L     R15,0(0,R13)             PT TO COMMUNICATIONS AREA
         L     R15,&P.#O-&P.MCA(0,R15)  PT TO EXTERNAL DUMMY SECTION
         A     R15,&P.QCON              GET OFFSET TO WORK AREA
         ST    R15,8(0,R13)             CHAIN SAVE AREAS
         ST    R13,4(0,R15)             AREAS TOGETHER
         MVC   0(4,R15),0(R13)          COPY POINTER TO COMM AREA
         LR    R13,R15                  PT TO WORK AREA AND SAVE AREA
         USING &N,R13                   ESTABLISH ADDRESSABILITY TO IT
         XC    &P.RCODE,&P.RCODE        CLEAR RETURN CODE FIELD
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR PROC(MAIN) OPTION, WHEN NO LIFO OPTION
.*
.ST02000 AIF   (&STF(3)).ST02100        LIFO OPTION, CONTINUE
&RRREGS  SETB  1                        REGS WILL BE ALTERED
         AIF   (&R2).ST09060            REGISTER 2 NOT SUPPORTED BASE
         AIF   (&R3).ST09070            REGISTER 3 NOT SUPPORTED BASE
         L     R3,&P.GSIZE              R0 HAS LENGTH OF WORK AREA CXD
         MNOTE '         GETMAIN RU,LV=(R3)&W,SP=&STSPN,BNDRY=PAGE'
         GETMAIN RU,LV=(R3),LOC=&LOC,SP=&STSPN,BNDRY=PAGE
         LR    R2,R1                    R2 POINTS TO WORK AREA
         SR    R15,R15                  R15 HAS PAD BYTE & ZERO LENGTH
         MVCL  R2,R14                   CLEAR WORK AREA
         LR    R15,R13                  SAVE CALLER'S SAVE AREA ADDRESS
         LR    R13,R1                   PT TO EXTERNAL DUMMY SECTION @
         A     R13,&P.QCON              PT TO WORK AREA
         ST    R13,8(0,R15)             CHAIN SAVE AREAS
         ST    R15,4(0,R13)             TOGETHER
         USING &N,R13                   ESTABLISH ADDRESSABILITY TO IT
         XC    &P.RCODE,&P.RCODE        CLEAR RETURN CODE FIELD
         ST    R1,&P.#O                 STORE DUMMY SECTION @ IN MCA
         LA    R15,&P.MCA               PT TO MCA
         ST    R15,0(0,R13)             STORE IT IN WORD 1 OF SAVE AREA
         AGO   .ST02500                 CONTINUE
.*
.* FOLLOWING IS FOR PROC AND LIFO OPTIONS, WITHOUT MAIN OPTION
.*
.ST02100 AIF   (&STF(2)).ST02200        MAIN OPTION, CONTINUE
&RRREGS  SETB  1                        REGS WILL BE ALTERED
         L     R3,=A(&P.WALEN)          R3 HAS LENGTH OF WORK AREA
         LR    R0,R3                    R0 TOO
         L     R1,0(0,R13)              PT TO MCA
         L     R15,&P.#GET-&P.MCA(0,R1) PT TO LIFO GET ROUTINE
         BALR  R14,R15                  GET WORK AREA FROM LIFO STACK
         LR    R2,R1                    R2 POINTS TO WORK AREA
         SR    R15,R15                  R15 HAS PAD BYTE & ZERO LENGTH
         MVCL  R2,R14                   CLEAR WORK AREA
.*       LM    R2,R3,28(R13)            RESTORE REGS 2 AND 3
         ST    R1,8(0,R13)              CHAIN SAVE AREAS
         ST    R13,4(0,R1)              TOGETHER
         MVC   0(4,R1),0(R13)           PROPOGATE MCA ADDRESS
         LR    R13,R1                   PT TO WORK AREA
         USING &N,R13                   ESTABLISH ADDRESSABILITY TO IT
         AGO   .ST02500                 CONTINUE
.*
.* AND NOW FOR THE FINALE, THIS IS FOR PROC, MAIN, AND LIFO OPTIONS
.*
.ST02200 ANOP  ,                        FIRST TAKE CARE OF ISA PARM
&RRREGS  SETB  1                        REGS WILL BE ALTERED
&STISASZ SETC  '16*1024'                SET DEFAULT ISA SIZE
         AIF   ('&ISA' EQ '').ST02400   NO ISA PARAMETER, CONTINUE
         AIF   ('&ISA'(K'&ISA,1) EQ 'K').ST02300   ISA SIZE IS IN K
&STISASZ SETC  '&ISA'                   PICK UP ISA SIZE
         AGO   .ST02400                 CONTINUE
.ST02300 ANOP  ,
&STISASZ SETC  '&ISA'(1,K'&ISA-1)'*1024' CONVERT K TO 1024 BYTES
.ST02400 ANOP  ,
         AIF   (&R2).ST09060            R2 USED ? YES, BAD BASE
         AIF   (&R3).ST09070            R3 USED ? YES, BAD BASE
         L     R3,&P.GSIZE              R3 HAS LENGTH OF WORK AREA
         MNOTE '         GETMAIN RU,LV=(R3)&W,SP=&STSPN,BNDRY=PAGE'
         GETMAIN RU,LV=(R3),LOC=&LOC,SP=&STSPN,BNDRY=PAGE
         LR    R2,R1                    R2 POINTS TO WORK AREA
         SR    R15,R15                  R15 HAS PAD BYTE & ZERO LENGTH
         MVCL  R2,R14                   CLEAR WORK AREA
         ST    R1,8(0,R13)              CHAIN SAVE AREAS
         ST    R13,4(0,R1)              TOGETHER
         LR    R13,R1                   LOAD WORK AREA ADDRESS
         USING &N,R13                   ESTABLISH ADDRESSABILITY TO IT
*
* INITIALIZE MODULE COMMUNICATIONS AREA WITH POINTERS TO LIFO STACK
* AND LIFO GET/FREE ROUTINES
*
         ST    R1,&P.#O                 STORE DYNAMIC STORAGE ADDRESS
         A     R1,=A(&P.WALEN)          DETERMINE STACK ORIGIN
         ST    R1,&P.#S                 STACK ORIGIN POINTER
         ST    R1,&P.#N                 CURRENT STACK POINTER
         LA    R15,&P.MCA               PT TO MCA
         ST    R15,0(0,R13)             STORE IN WORD 1 OF SAVE AREA
         L     R14,&P.GSIZE             LOAD SIZE OF INITIAL STACK AREA
         AR    R14,R13                  COMPUTE STACK END ADDRESS
         ST    R14,&P.#E                STORE IT INTO MCA
         MVC   &P.#GET(8),=V(#####GET,####FREE)
.*
.* RESTORE REGISTERS WHICH HAVE BEEN CORRUPTED
.*
.ST02500 AIF   ('&SAVE' NE 'YES').ST06000 SKIP IF SAVE=NO SPECIFIED
         AIF   ('&SVAREA' NE 'YES').ST06000
         AIF   (NOT &RRREGS).ST06000
         L     R1,4(0,R13)              PT TO CALLER'S SAVE AREA
         LM    R14,R3,12(R1)            RESTORE REGISTERS
.*
.* RESYNCH BASE REGISTERS R2 OR R3 NEEDED ?
.*
         AIF   (NOT (&R2 OR &R3)).ST06000
.*
         LA    &BASE(1),0(,R15)         SET BASE REGISTER AGAIN
&A       SETA  2
.ST02530 AIF   ('&BASE(&A)' EQ '').ST06000   NO MORE, CONTINUE
         LA    &BASE(&A),2048(0,&BASE(&A-1))
         LA    &BASE(&A),2048(0,&BASE(&A))
&A       SETA  &A+1
         AGO   .ST02530
.*
.*       SVC LINKAGE IS GENERATED HERE
.*
.ST04000 EJECT ,
***********************************************************************
*                                                                     *
         AIF   (&G).ST04002
*        THE 'SVC' OPTION OF #START HAS BEEN DEFAULTED TO             *
*        FOR THIS CSECT NAME.  (CODE 'SVC=NO' TO SUPPRESS IT).        *
         AGO   .ST04003
.ST04002 ANOP  ,
*        THE 'SVC' OPTION OF #START HAS BEEN SELECTED                 *
.ST04003 ANOP  ,
*                                                                     *
***********************************************************************
*                                                                     *
*    THE PROLOG AND EPILOG CODE WILL BE GENERATED ACCORDING TO MVS    *
*    SVC LINKAGE STANDARDS.  WHEN THE SVC GETS CONTROL THE            *
*    REGISTERS ARE PRE-SET IN A DIFFERENT FASHION THAN FOR NORMAL     *
*    LINKAGE.  REGS 6 AND 15 DIFFER DEPENDING ON TYPE OF ENTRY:       *
*    CASE (A) IS FOR TYPES 1,2,3,6, AND THE FIRST LOAD OF A TYPE      *
*    4.  CASE (B) REFERS TO THE SUBSEQUENT LOADS OF A TYPE-4 SVC      *
*    (ENTERED VIA XCTL).                                              *
*                                                                     *
*          0,1   SAME INFO AS WHEN THE SVC WAS ISSUED                 *
*          2     UNPREDICTABLE                                        *
*          3     ADDRESS OF THE CVT                                   *
*          4     ADDRESS OF THE CURRENT TCB                           *
*          5     ADDRESS OF THE CURRENT REQUEST BLOCK (RB)            *
*          6     (A) - ENTRY POINT ADDRESS OF THE SVC ROUTINE         *
*                (B) - UNPREDICTABLE                                  *
*          7     ADDRESS OF THE CURRENT ASCB                          *
*          8-12  UNPREDICTABLE                                        *
*          13    SAME INFO AS WHEN THE SVC WAS ISSUED (SEE BELOW)     *
*          14    RETURN ADDRESS                                       *
*          15    (A) - SAME INFO AS WHEN THE SVC WAS ISSUED           *
*                (B) - ENTRY POINT ADDRESS OF THE SVC ROUTINE         *
*                                                                     *
*   **NOTE**  REGISTER 13 MAY OR MAY NOT POINT TO A SAVE AREA.  IN    *
*             ANY CASE, SVC ROUTINES MUST NEVER ATTEMPT TO SAVE       *
*             REGISTERS THERE BECAUSE (1) THE SAVE AREA MAY BE IN     *
*             USE ALREADY AND (2) THE SVC RUNS IN KEY ZERO AND        *
*             COULD OVERLAY DATA.  THE SYSTEM HAS SAVED ALL THE       *
*             CALLERS REGISTERS FOR YOU, AND WILL RESTORE ALL         *
*             EXCEPT R0, R1, AND R15.                                 *
*                                                                     *
*    WHEN THE PROLOG IS COMPLETE, ALL THE REGISTERS WILL BE LOADED    *
*    AS DESCRIBED ABOVE, EXCEPT FOR REGISTERS 12 AND 13.              *
*    REGISTER 12 WILL BE SET UP AS THE BASE REGISTER FOR THE MODULE.  *
         AIF   (NOT &STWA).ST04010
*    REGISTER 13 WILL POINT TO THE GETMAINED SAVE/WORK AREA.          *
         AGO   .ST04020
.ST04010 ANOP  ,
*    REGISTER 13 WILL BE SET TO ZEROS.                                *
.ST04020 ANOP  ,
         AIF   (NOT &STWA).ST04030
         AIF   (K'&NAME GT 6 OR &STF(12)).ST04030
*                                                                     *
*   THE CODE GENERATED HERE USES SVC-TYPE GETMAIN/FREEMAIN MACROS.    *
*   IT CANNOT BE USED WITH SVC TYPES 1 AND 6 BECAUSE THEY CANNOT      *
*   ISSUE ANY SVCS.  TYPE 1 MAY USE BRANCH-ENTRY SERVICES.            *
.ST04030 AIF   (NOT &STF(12)).ST04040
*                                                                     *
*   THE CODE GENERATED HERE USES BRANCH ENTRY GETMAIN AND FREEMAIN    *
*   MACROS.  THIS SVC MUST BE TYPE 1, OR REQUEST THE LOCAL LOCK VIA   *
*   THE SVCTABLE.                                                     *
.ST04040 ANOP  ,
*                                                                     *
***********************************************************************
         EJECT ,
.*
         BALR  R12,0                    SET UP SVC BASE REGISTER
         USING *,R12
         LA    R12,0(0,R12)             ENSURE BASE REG CLEAN
.*
         AGO   .ST04050
         USING CVTMAP,R3
         USING TCB,R4
         USING RBBASIC,R5
         USING ASCB,R7
         #DSECTS CVT,TCB,RB,ASCB,TYPE=DEFER MAP 'EM LATER, PLEASE
.*
.ST04050 AIF   ('&ID' EQ 'NO').ST04100
         SPACE 1
&Q       SETA  28+&#COPYSZ*&QQ
         AIF   ('&LEVEL' EQ '').ST04054
&Q       SETA  &Q+8                     ALLOW FOR LEVEL
.ST04054 AIF   ('&APARS' EQ '').ST04060
&Q       SETA  &Q+(&APARS*4)            ALLOW FOR APARS
.ST04060 B     *+&Q                     BRANCH AROUND ID
         DC    CL9'&NAME '              MODULE NAME
         DC    CL6'&SYSTIME '           TIME OF ASSEMBLY
         DC    CL9'&SYSDATC '           DATE OF ASSEMBLY
         AIF   ('&LEVEL' EQ '').ST04064
         DC    CL8'&LEVEL'              MODULE LEVEL
.ST04064 AIF   ('&APARS' EQ '').ST04070
         DC    &APARS.CL4' '            APAR SLOTS
.ST04070 AIF   ('&COPY' EQ 'NO').ST04100
         #COPY GEN                      36-BYTE COPYRIGHT
         SPACE 1
.*
.ST04100 AIF   ('&STAXKEY' EQ '').ST04200
.* THE MODESET PRECEDES THE GETMAIN SO THAT SP 229/230 MAY BE USED
         MNOTE '         MODESET EXTKEY=&STAXKEY'
         MODESET EXTKEY=&STAXKEY
.ST04200 AIF   (&STWA).ST04700
.* REG 13 IS ZEROED.  IT MIGHT OTHERWISE BE USED AS A SAVE AREA
.* POINTER LEADING TO VERY SUBTLE INTEGRITY PROBLEMS.  CLEARING IT
.* ENSURES THAT AN 0C4 ABEND WILL OCCUR IF AN ATTEMPT IS MADE TO
.* SAVE VIA R13  (EVEN IN KEY ZERO).
         SR    R13,R13                  TAKE OUT INSURANCE
         AGO   .ST06000                 NO FRILLS ENTRY STYLE
.*
.ST04700 AIF   (&STF(1) OR &STF(2)).ST04800
         LR    R2,R15                   SAVE REGS
         LR    R10,R0
         LR    R11,R1
         AIF   (&STF(12)).ST04730
         MNOTE '         GETMAIN &STAGREG,LV=&P.WALEN&W,SP=&STSPN'
         GETMAIN &STAGREG,LV=&P.WALEN,LOC=&LOC,SP=&STSPN
         AGO   .ST04750
.ST04730 LR    R9,R14                   SAVE REG 14
         MNOTE '         GETMAIN &STAGREG,LV=&P.WALEN&W,SP=&STSPN,BRANCX
               H=YES'
         GETMAIN &STAGREG,LV=&P.WALEN,LOC=&LOC,SP=&STSPN,BRANCH=YES
         LR    R14,R9                   RESTORE REG 14
         L     R3,16                    RESTORE CVT POINTER
.ST04750 LR    R13,R1                   R13 POINTS TO WORK AREA
         USING &WKDSECT,R13             ADDRESSABILITY
         LR    R0,R1
         L     R1,=A(&P.WALEN)
         SR    R9,R9
         MVCL  R0,R8                    CLEAR THE WORK AREA
         LR    R0,R10                   RELOAD REGS
         LR    R1,R11
         LR    R15,R2
         ST    R14,0(0,R13)             STASH RETURN ADDRESS
         AGO   .ST06000
.*
.ST04800 MNOTE 12,'OPTION NOT YET CODED'
         MEXIT ,
.*
.* FINISH UP WITH USING, REG0, REG1 PARMS
.*
.ST06000 AIF   ('&USING' EQ '').ST06700 NO USING PARAMETER, CONT
&A       SETA  1                        COUNTER OF NUMBER OF OPERANDS
&B       SETA  N'&USING                 PICK UP # OF OPTIONS ON USING
.ST06600 AIF   (&A GT &B).ST06700       NO MORE, CONTINUE
&K       SETC  '&USING(&A)'             PICK US ADDRESS
&L       SETC  '&USING(&A+1)'           PICK UP REGISTER
         AIF   ('&K' EQ '' OR '&L' EQ '').ST09000   MISSING PARMS
         USING &K,&L
&A       SETA  &A+2                     POINT TO NEXT SET
         AGO   .ST06600                 ON TO THE NEXT PAIR
.*
.ST06700 AIF   ('&STAMODE' EQ '').ST06780
         SPACE 1
         LA    R14,&P.RRR14             POINT INTO CAP EPILOG
         AIF   ('&SYSSPLV' NE '1').ST06730
         L     R15,16                   POINT TO CVT
         TM    116(R15),128             IS THIS MVS/XA ?
         BZ    &P.CAP00                 NO, DO NOT CAP
.ST06730 LA    R15,&P.CAP00             POINT AFTER BSM
         AIF   ('&STAMODE' EQ '24').ST06740
         O     R15,=X'80000000'         OUR AMODE IS 31
.ST06740 ANOP  ,
         BSM   R14,R15                  SAVE AND SET AMODE
         AIF   ('&STACREG' EQ '').ST06750
&P.CAP00 LR    &STACREG,R14             SAVE CAP WORD IN REG
         AGO   .ST06760
.ST06750 ANOP  ,
&P.CAP00 ST    R14,&P.CAPWD             SAVE CAP WORD
.*
.ST06760 AIF   ('&REG0&REG1' EQ '').ST06800
         SPACE 1
.*
.ST06780 AIF   ('&REG0' EQ '').ST06790  NO REG0, CONTINUE
         LR    &REG0,R0                 SAVE REGISTER 0
.ST06790 AIF   ('&REG1' EQ '').ST06800  NO REG1  CONTINUE
         LR    &REG1,R1                 SAVE REGISTER 1
.ST06800 SPACE 1
         MEXIT ,
.*
.ST09000 MNOTE 4,'ST1003I - REQUIRED OPERAND MISSING ON USING PARM'
         MEXIT ,
.ST09010 IHBERMAC 1006,NAME
         MEXIT ,
.ST09020 IHBERMAC 1304,WKCSECT,WKDSECT
         MEXIT ,
.ST09030 IHBERMAC 1020,WKCSECT,PROC
         MEXIT ,
.ST09040 MNOTE 12,'ST1004I - SAVE=&SAVE INVALID WITH WORKAREA'
         MEXIT ,
.ST09050 MNOTE 12,'ST1005I - SVAREA=&SVAREA INVALID WITH WORKAREA'
         MEXIT ,
.ST09060 MNOTE 12,'ST1006I - R2 NOT SUPPORTED AS BASE REGISTER'
         MEXIT ,
.ST09070 MNOTE 12,'ST1007I - R3 NOT SUPPORTED AS BASE REGISTER'
.MEND    MEND  ,
./ ADD NAME=#STARTWA 0100-00038-00038-1647-00154-00154-00000-MACRO
         MACRO ,
         #STARTWA &LTORG=YES,&EXTRAS=MAYBE,&PATCH=
.*
.* DEFINE SYMBOLS NEEDED, NOTE ALL GLOBALS ARE FROM #START MACRO
.*
         GBLA  &EXECUTN                 EXECUTE MACRO COUNTER
         GBLA  &STWAC                   COUNTER FOR DEFERED WA DEFINES
         GBLB  &STWA                    INDICATES CSECT HAS A WORK AREA
         GBLB  &STF(16)                 CONTROL FLAG BITS, AS FOLLOWS:
.*                                       (01) - PROC OPTION CODED
.*                                       (02) - MAIN OPTION CODED
.*                                       (03) - LIFO OPTION CODED
.*                                       (04) - WKCSECT OPTION CODED
.*                                       (05) - WKDSECT OPTION CODED
.*                                       (06) - #START HAS BEEN CODED
.*                                       (07) - ROUTINE IS AN SVC
.*                                       (08) - WORK FIELDS WANTED
.*                                       (09) - SVAREA=NO OPTION
.*                                       (10) - SAVE=YES OPTION
.*                                       (11) - RSECT=YES OPTION
.*                                       (12) - SVC=(YES,BRANCH)
.*                                       (13) - ENUC CAPPING
.*                                       (14) - PATCH AREA REQUIRED
.*
         GBLC  &STPREF                  PREFIX CHARACTERS
         GBLC  &STWANAM                 WORK AREA NAME
         GBLC  &STAMODE                 MODULE'S CAPPED AMODE
         GBLC  &STACREG                 CAPWORD SAVE REGISTER
         GBLC  &STISASZ                 LIFO ISA SIZE
         GBLC  &SYSSPLV                 SPLEVEL
         GBLC  &STWAD(1000)             WORK AREA DEFERED STACK
         LCLA  &A,&B,&C,&D,&E           LOCAL
         LCLB  &F,&G,&H,&I,&J           WORK
         LCLC  &K,&L,&M,&N,&O,&P        SYMBOLS
.*
.* INITIALIZE SYMBOLS, SET UP PREFIX, PICK UP ALL OPERANDS
.*
&P       SETC  '&STPREF'                MAKE PREFIX EASIER TO WORK WITH
         AIF   (NOT &STF(6)).ST01200    ERROR - NO #START MACRO CODED
         AIF   (NOT &STWA).ST01300      ERROR - NO WORK AREA SPECIFIED
         AIF   ('&LTORG' NE 'YES').ST00100   NO LTORG, CONTINUE
         SPACE 1
         AIF   (&EXECUTN EQ 0).ST00090       NO POOL, CONTINUE
*        #EXEC ,                        EXECUTE POOL
         #EXEC ,
         SPACE 1 ,
.ST00090 ANOP  ,
         LTORG ,                        LITERAL POOL
.ST00100 AIF   ('&PATCH' EQ 'NO').ST00110
         AIF   ('&PATCH' EQ '' AND NOT &STF(14)).ST00110
         AIF   ('&PATCH' EQ 'YES' OR '&PATCH' EQ 'Y' OR '&PATCH' EQ '')X
               .ST00105
         SPACE 1
         #PATCH F=&PATCH                EXPLICIT PATCH SIZE
         AGO   .ST00110
.ST00105 SPACE 1
         #PATCH ,                       DEFAULT PATCH SIZE
.ST00110 SPACE 1
.*
.* THE FOLLOWING IS FOR WKCSECT OPTION
.*
         AIF   (NOT &STF(4)).ST00200    NOT WORK CSECT, CONTINUE
&STWANAM CSECT ,                        #STARTWA MACRO
         DS    18F                      SAVE AREA
         AGO   .ST00500                 CONTINUE
.*
.* THE FOLLOWING IS FOR WKDSECT OPTION, WITH OR WITHOUT PROC AND LIFO
.* OPTIONS, BUT NOT WITH THE MAIN OPTION
.*
.ST00200 AIF   (&STF(2)).ST00300        MAIN OPTION, CONTINUE
&STWANAM DSECT ,                        #STARTWA MACRO
         DS    18F                      SAVE AREA
         AGO   .ST00500                 CONTINUE
.*
.* THE FOLLOWING IS FOR PROC AND MAIN OPTIONS, BUT NOT LIFO
.*
.ST00300 AIF   (&STF(3)).ST00400        LIFO OPTION, CONTINUE
&STWANAM DSECT ,                        #STARTWA MACRO
         DS    18F                      STANDARD SAVE AREA
&P.MCA   DS    0F                       MODULE COMMUNICATIONS AREA
&P.#O    DS    A                        ORIGIN OF GETMAINED AREA
         AGO   .ST00500                 CONTINUE
.*
.* THE FOLLOWING IS FOR PROC, MAIN, AND LIFO OPTIONS
.*
.ST00400 ANOP  ,
&STWANAM DSECT ,                        #STARTWA MACRO
         DS    18F                      STANDARD SAVE AREA
&P.MCA   DS    0F                       MODULE COMMUNICATIONS AREA
&P.#O    DS    A                        ORIGIN OF GETMAINED AREA
&P.#GET  DS    V(#####GET)              PTR TO LIFO GET ROUTINE
&P.#FRE  DS    V(####FREE)              PTR TO LIFO FREE ROUTINE
&P.#S    DS    A                        PTR TO START OF LIFO STACK
&P.#E    DS    A                        PTR TO END OF LIFO STACK
&P.#N    DS    A                        PTR TO NEXT FREE AREA
.*
.* THE FOLLOWING IS COMMON TO ALL TYPES OF WORK AREAS
.*
.ST00500 ANOP  ,
         AIF   ('&EXTRAS' EQ 'NO').ST00550
         AIF   (NOT &STF(8) AND '&EXTRAS' NE 'YES').ST00550
&P.DBL1  DS    D
&P.DBL2  DS    D
&P.DBL3  DS    D
&P.DBL4  DS    D
&P.WORD1 DS    F
&P.WORD2 DS    F
&P.WORD3 DS    F
&P.WORD4 DS    F
&P.HALF1 DS    H
&P.HALF2 DS    H
&P.HALF3 DS    H
&P.HALF4 DS    H
&P.BYTE1 DS    C
&P.BYTE2 DS    C
&P.BYTE3 DS    C
&P.BYTE4 DS    C
&P.FLAG1 DS    X
&P.FLAG2 DS    X
&P.FLAG3 DS    X
&P.FLAG4 DS    X
.ST00550 ANOP  ,
&STF(8)  SETB  0                        TURN BACK OFF
&P.RCODE DS    F                        RETURN CODE FIELD
         AIF   ('&STAMODE' EQ '' OR '&STACREG' NE '').ST00580
&P.CAPWD DS    A                        USED BY CAPPING SUPPORT
.ST00580 ANOP  ,
&A       SETA  &STWAC                   PICK UP # DEFERRED WORK FIELDS
&B       SETA  -1                       SET UP INDEX COUNTER
.ST00600 ANOP  ,                        DETERMINE IF ITS A DS OR A DC
&B       SETA  &B+2                     POINT TO NEXT ELEMENT ON STACK
         AIF   (&B GE &A).ST01100       NO MORE, CONTINUE
&K       SETC  '&STWAD(&B)'             PICK UP LABEL
&L       SETC  '&STWAD(&B+1)'           PICK UP OPERAND
&C       SETA  K'&L                     PICK UP LENGTH OF OPERAND
         AIF   ('&L'(&C,1) EQ '''').ST00900   THIS IS A DC
         AIF   ('&L'(&C,1) NE ')').ST01000    THIS IS A DS
.ST00700 ANOP  ,                        LOOK FOR LEFT PARENTHESIS,
&C       SETA  &C-1                     BY SCANNING BACKWARDS
         AIF   (&C LT 2).ST01000        ERROR - NO LEFT PARENTHESIS
         AIF   ('&L'(&C,1) EQ '(').ST00800   FOUND THE LEFT
         AGO   .ST00700                 GO CONTINUE SCAN
.ST00800 AIF   ('&L'(&C-1,1) EQ 'L').ST01000   ITS A DS WITH LENGTH
.ST00900 ANOP  ,                        DEFINE IT AS A DC
&K       DC    &L                       DEFERRED WORK FIELD
         AGO   .ST00600                 GO GET NEXT ELEMENT ON STACK
.ST01000 ANOP  ,                        DEFINE IT AS A DS
&K       DS    &L                       DEFERRED WORK FIELD
         AGO   .ST00600                 GO GET NEXT ELEMENT ON STACK
.ST01100 MEXIT ,                        EXIT
.ST01200 MNOTE 4,'ST3001A - #START MACRO NOT CODED IN THIS PROGRAM'
         MEXIT ,
.ST01300 MNOTE 4,'ST3002A - #START MACRO NOT DEFINED WITH WORKAREA'
.MEND    MEND  ,
./ ADD NAME=#STOP    0100-00038-00038-1647-00343-00343-00000-MACRO
         MACRO ,
&NAME    #STOP &RC=,                    RETURN CODE                    X
               &R0=,                    R0 CONTENTS TO PASS BACK       X
               &R1=,                    R1 CONTENTS TO PASS BACK       X
               &USE=BR                  RETURN TYPE (BR/BSM/SVC/PSARET)
.*
         SPLEVEL TEST                   OBTAIN SPLEVEL VALUE
.*
&NAME    DS    0H                       #STOP MACRO
.*
.* DEFINE SYMBOLS NEEDED
.*
         GBLA  &STWAC                   COUNTER FOR DEFERED WA DEFINES
         GBLB  &STWA                    INDICATES CSECT HAS A WORK AREA
         GBLB  &STF(16)                 CONTROL FLAG BITS, AS FOLLOWS:
.*                                       (01) - PROC OPTION CODED
.*                                       (02) - MAIN OPTION CODED
.*                                       (03) - LIFO OPTION CODED
.*                                       (04) - WKCSECT OPTION CODED
.*                                       (05) - WKDSECT OPTION CODED
.*                                       (06) - #START HAS BEEN CODED
.*                                       (07) - ROUTINE IS AN SVC
.*                                       (08) - WORK FIELDS WANTED
.*                                       (09) - SVAREA=NO OPTION
.*                                       (10) - SAVE=YES OPTION
.*                                       (11) - RSECT=YES OPTION
.*                                       (12) - SVC=(YES,BRANCH)
.*                                       (13) - ENUC CAPPING
         GBLC  &STACREG                 CAPWORD SAVE REGISTER
         GBLC  &STAGREG                 GET/FREEMAIN FORMAT
         GBLC  &STAMODE                 MODULE'S CAPPED AMODE
         GBLC  &STAXKEY                 SVC EXECUTION KEY
         GBLC  &STISASZ                 LIFO ISA SIZE
         GBLC  &STNAME                  MAIN CSECT NAME
         GBLC  &STPREF                  PREFIX CHARACTERS
         GBLC  &STSPN                   SUBPOOL NUMBER
         GBLC  &STWAD(1000)             WORK AREA DEFERED STACK
         GBLC  &STWANAM                 WORK AREA NAME
         GBLC  &SYSSPLV                 SPLEVEL
         LCLA  &A,&B,&C,&D,&E           LOCAL
         LCLB  &F,&G,&H,&I,&J           WORK
         LCLC  &K,&L,&M,&N,&O,&P        SYMBOLS
         LCLC  &XX1,&XX2,&R2
&XX1     SETC  'BR'
&XX2     SETC  'R14'
         AIF   ('&STAMODE' NE '').NOTPSA USE BR IF CAPPING
         AIF   ('&USE' NE 'BSM' AND NOT &STF(13)).NOTBSM
&XX1     SETC  'BSM'
&XX2     SETC  '0,R14'
         AIF   ('&SYSSPLV' NE '1').NOTPSA
         MNOTE 4,'**WARNING** USE=BSM CHANGED TO USE=PSARET BECAUSE SPLX
               EVEL=1'
         AGO   .USEPSA
.NOTBSM  ANOP  ,
         AIF   ('&USE' NE 'SVC').NOTSVC
&XX1     SETC  'SVC'
&XX2     SETC  '3'
.NOTSVC  ANOP  ,
         AIF   ('&USE' NE 'PSA' AND '&USE' NE 'PSARET').NOTPSA
.USEPSA  ANOP  ,
&XX1     SETC  'B'
&XX2     SETC  '890'
.NOTPSA  ANOP  ,
.*
.* INITIALIZE SYMBOLS, SET UP PREFIX, PICK UP ALL OPERANDS
.*
&P       SETC  '&STPREF'                PICK UP PREFIX
&N       SETC  '&STWANAM'               PICK UP WORK AREA NAME
.*
         AIF   (&STF(7)).ST01000        SVC EXIT HERE
.*
.*
.* THE FOLLOWING IS PRELIMINARIES, ETC
.*
         AIF   ('&R0' EQ '' AND '&R1' EQ '').ST00060   NO R0 OR R1
&R2      SETC  'R13'
         AIF   (&STF(09)).ST00008       SAVE=NO OPTION ?
         L     R2,4(0,R13)              PT TO CALLER'S SAVE AREA
&R2      SETC  'R2'
.ST00008 AIF   ('&R0' EQ '').ST00030   NO R0, CONTINUE
         AIF   ('&R0' EQ '0' OR '&R0' EQ 'R0').ST00020   0 OR R0
         AIF   ('&R0' EQ '(0)' OR '&R0' EQ '(R0)').ST00020
         AIF   ('&R0'(1,1) EQ '(').ST00010   ANOTHER REGISTER
         LA    R0,&R0                   R0 HAS RETURN VALUE
         AGO   .ST00020                 CONTINUE
.ST00010 LR    R0,&R0(1)                R0 HAS RETURN VALUE
.ST00020 ST    R0,20(0,&R2)             IN SAVE AREA
.ST00030 AIF   ('&R1' EQ '').ST00060    NO R1, CONTINUE
         AIF   ('&R1' EQ '1' OR '&R1' EQ 'R1').ST00050   1 OR R1
         AIF   ('&R1' EQ '(1)' OR '&R1' EQ '(R1)').ST00050
         AIF   ('&R1'(1,1) EQ '(').ST00040   ANOTHER REGISTER
         LA    R1,&R1                   R1 HAS RETURN VALUE
         AGO   .ST00050                 CONTINUE
.ST00040 LR    R1,&R1(1)                R1 HAS RETURN VALUE
.ST00050 ST    R1,24(0,&R2)             IN SAVE AREA
.ST00060 AIF   ('&RC' EQ '').ST00200    NO RETURN CODE SUPPLIED
         AIF   ('&RC'(1,1) EQ '(').ST00100   RETURN CODE IS A REG
         LA    R15,&RC                  R15 HAS RETURN CODE
         AGO   .ST00400                 CONTINUE
.ST00100 AIF   ('&RC' EQ '(15)' OR '&RC' EQ '(R15)').ST00400
         LR    R15,&RC(1)               R15 HAS RETURN CODE
         AGO   .ST00400                 CONTINUE
.ST00200 AIF   (NOT &STWA).ST00300      NO WORK AREA, CONTINUE
         L     R15,&P.RCODE             R15 HAS RETURN CODE
         AGO   .ST00400                 CONTINUE
.ST00300 SR    R15,R15                  SET RETURN CODE TO ZERO
.*
.* THE FOLLOWING IS FOR NO WORK AREA OPTION, WKCSECT OPTION, AND THE
.* PROC OPTION BUT NOT PROC(MAIN), LIFO OR PLAIN WKDSECT OPTIONS
.*
.ST00400 AIF   (&STF(2) OR &STF(3)).ST00500   MAIN OR LIFO, CONTINUE
         AIF   (&STF(5) AND NOT &STF(1)).ST00500   WKDSECT, CONTINUE
         AIF   (NOT &STF(10)).ST00560   SAVE=NO OPTION ?
         AIF   ('&STAMODE' EQ '').ST00480 CAPPED CODE ?
         AIF   ('&STACREG' EQ '').ST00440
         LR    R2,&STACREG              RETRIEVE CAP WORD
         AGO   .ST00480
.ST00440 L     R2,&P.CAPWD              RETRIEVE CAP WORD
.ST00480 AIF   (&STF(9)).ST00560        SVAREA=NO OPTION ?
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         AGO   .ST00560                 BR TO COMMON CODE
.*
.* THE FOLLOWING IS FOR A PLAIN WKDSECT OPTION
.*
.ST00500 AIF   (&STF(2) OR &STF(3)).ST00700   MAIN OR LIFO, CONTINUE
         LR    R1,R13                   SAVE WORK AREA ADDRESS
         AIF   ('&STAMODE' EQ '').ST00540 CAPPED CODE ?
         AIF   ('&STACREG' EQ '').ST00520
         LR    R2,&STACREG              RETRIEVE CAP WORD
         AGO   .ST00540
.ST00520 L     R2,&P.CAPWD              RETRIEVE CAP WORD
.ST00540 AIF   (NOT &STF(10)).ST00600   JUMP IF SAVE=NO
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         LR    R14,R15                  SAVE RETURN CODE
         MNOTE '         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN'
         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN
         LR    R15,R14                  RESTORE RETURN CODE
.*
.ST00560 AIF   ('&STAMODE' EQ '').ST00580 CAPPED CODE ?
         AIF   ('&SYSSPLV' NE '1').ST00570
         L     R1,16                    POINT TO CVT
         TM    116(R1),128              IS THIS MVS/XA ?
         BZR   R2                       NO, DO NOT CAP
.ST00570 BSM   0,R2                     RESUME CALLER'S AMODE
&K       SETC  '&P.RRR14'
.ST00580 ANOP  ,
&K       L     R14,12(0,R13)            RESTORE REGISTER 14
         LM    R0,R12,20(R13)           RESTORE REGISTERS 0-12
         &XX1  &XX2                     RETURN TO CALLER
         SPACE 1
         MEXIT ,
.*
.ST00600 LR    R13,R15                  SAVE RETURN CODE
         L     R0,=A(&P.WALEN)
         MNOTE '         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN'
         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN
         LR    R15,R13                  SET RETURN CODE
         AIF   ('&STAMODE' EQ '').ST00680 CAPPED CODE ?
         AIF   ('&SYSSPLV' NE '1').ST00670
         L     R1,16                    POINT TO CVT
         TM    116(R1),128              IS THIS MVS/XA ?
         BZR   R2                       NO, DO NOT CAP
.ST00670 BSM   0,R2                     RESUME CALLER'S AMODE
&K       SETC  '&P.RRR14'
.ST00680 ANOP  ,
&K       &XX1  &XX2                     RETURN TO CALLER
         SPACE 1
         MEXIT ,
.*
.* FOLLOWING IS FOR PROC, LIFO OPTIONS
.*
.ST00700 AIF   (&STF(2)).ST00800        MAIN OPTION, CONTINUE
         LR    R1,R13                   SAVE WORK AREA ADDRESS
         AIF   ('&STAMODE' EQ '').ST00750 CAPPED CODE ?
         AIF   ('&STACREG' EQ '').ST00720
         LR    R2,&STACREG              RETRIEVE CAP WORD
         AGO   .ST00750
.ST00720 L     R2,&P.CAPWD              RETRIEVE CAP WORD
.ST00750 ANOP  ,
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         ST    R15,16(0,R13)            STORE RETURN CODE
         LR    R0,R1                    PT TO AREA TO FREE
         L     R1,0(0,R13)              PT TO MODULE COMM AREA
         L     R15,&P.#FRE-&P.MCA(0,R1) PT TO LIFO FREE ROUTINE
         BALR  R14,R15                  GO FREE WORK AREA FROM STACK
.ST00760 AIF   ('&STAMODE' EQ '').ST00780 CAPPED CODE ?
         AIF   ('&SYSSPLV' NE '1').ST00770
         L     R1,16                    POINT TO CVT
         TM    116(R1),128              IS THIS MVS/XA ?
         BZR   R2                       NO, DO NOT CAP
.ST00770 BSM   0,R2                     RESUME CALLER'S AMODE
&K       SETC  '&P.RRR14'
.ST00780 ANOP  ,
&K       LM    R14,R12,12(R13)          RESTORE CALLER'S REGISTERS
         &XX1  &XX2                     RETURN TO CALLER
         SPACE 1
         MEXIT ,                        EXIT
.*
.* FOLLOWING IS FOR PROC(MAIN) WITH OR WITHOUT LIFO OPTION
.*
.ST00800 L     R1,0(0,R13)              R1 HAS MCA ADDRESS
         L     R1,&P.#O-&P.MCA(0,R1)    PT TO GETMAINED AREA
         AIF   ('&STAMODE' EQ '').ST00850 CAPPED CODE ?
         AIF   ('&STACREG' EQ '').ST00820
         LR    R2,&STACREG              RETRIEVE CAP WORD
         AGO   .ST00850
.ST00820 L     R2,&P.CAPWD              RETRIEVE CAP WORD
.ST00850 ANOP  ,
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         ST    R15,16(0,R13)            STORE RETURN CODE
         L     R0,&P.GSIZE              R0 HAS LENGTH OF LIFO STACK
         MNOTE '         FREEMAIN RU,LV=(0),A=(1),SP=&STSPN'
         FREEMAIN RU,LV=(0),A=(1),SP=&STSPN
.ST00860 AIF   ('&STAMODE' EQ '').ST00880 CAPPED CODE ?
         AIF   ('&SYSSPLV' NE '1').ST00870
         L     R1,16                    POINT TO CVT
         TM    116(R1),128              IS THIS MVS/XA ?
         BZR   R2                       NO, DO NOT CAP
.ST00870 BSM   0,R2                     RESUME CALLER'S AMODE
&K       SETC  '&P.RRR14'
.ST00880 ANOP  ,
&K       LM    R14,R12,12(R13)          RESTORE CALLER'S REGISTERS
         &XX1  &XX2                     RETURN TO CALLER
         SPACE 1
         AGO   .ST05000                 GO TO LIFO CHECK
.*
.* FOLLOWING IS FOR SVC TYPE LINKAGES
.*
.ST01000 AIF   ('&R0' EQ '').ST01030   NO R0, CONTINUE
         AIF   ('&R0' EQ '0' OR '&R0' EQ 'R0').ST01030   0 OR R0
         AIF   ('&R0' EQ '(0)' OR '&R0' EQ '(R0)').ST01030   0 OR R0
         AIF   ('&R0'(1,1) EQ '(').ST01010   ANOTHER REGISTER
         LA    R0,&R0                   R0 HAS RETURN VALUE
         AGO   .ST01030                 CONTINUE
.ST01010 LR    R0,&R0(1)                R0 HAS RETURN VALUE
.*
.ST01030 AIF   ('&R1' EQ '').ST01050    NO R1, CONTINUE
         AIF   ('&R1' EQ '1' OR '&R1' EQ 'R1').ST01050   1 OR R1
         AIF   ('&R1' EQ '(1)' OR '&R1' EQ '(R1)').ST01050   1 OR R1
         AIF   ('&R1'(1,1) EQ '(').ST01040   ANOTHER REGISTER
         LA    R1,&R1                   R1 HAS RETURN VALUE
         AGO   .ST01050                 CONTINUE
.ST01040 LR    R1,&R1(1)                R1 HAS RETURN VALUE
.*
.ST01050 AIF   ('&RC' EQ '').ST01200    NO RETURN CODE SUPPLIED
         AIF   ('&RC' EQ '(15)' OR  '&RC' EQ '(R15)').ST01400
         AIF   ('&RC'(1,1) EQ '(').ST01100   RETURN CODE IS A REG
         LA    R15,&RC                  R15 HAS RETURN CODE
         AGO   .ST01400                 CONTINUE
.ST01100 LR    R15,&RC(1)               R15 HAS RETURN CODE
         AGO   .ST01400                 CONTINUE
.ST01200 AIF   (NOT &STWA).ST01300      NO WORK AREA, CONTINUE
         L     R15,&P.RCODE             R15 HAS RETURN CODE
         AGO   .ST01400                 CONTINUE
.ST01300 SR    R15,R15                  SET RETURN CODE TO ZERO
.*
.ST01400 AIF   (&STF(2) OR &STF(3)).ST01500     MAIN OR LIFO
         AIF   (&STWA).ST01500          WORK AREA TO FREE
         &XX1  &XX2                     RETURN TO SVC IH
         SPACE 1
         AGO   .ST05000
.*
.ST01500 L     R14,0(0,R13)             RELOAD RETURN ADDRESS
         LR    R4,R15                   SAVE RETURN CODE
         LR    R2,R0
         LR    R5,R1
.ST01520 LR    R1,R13                   WORK AREA ADDR IN REG 1
         AIF   (&STF(12)).ST01540
         AIF   ('&STAXKEY' EQ '').ST01530
.* THE MODESET PRECEDES THE FREEMAIN SO THAT SP 229/230 MAY BE USED
         MNOTE '         MODESET EXTKEY=&STAXKEY'
         MODESET EXTKEY=&STAXKEY
.ST01530 MNOTE '         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN'
         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN
.*       AIF   ('&STAXKEY' EQ '').ST01550
.*       SPKA  0
         AGO   .ST01550
.ST01540 LR    R9,R14                   SAVE REG 14
         MNOTE '         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN,X
               BRANCH=YES'
         FREEMAIN &STAGREG,LV=&P.WALEN,A=(1),SP=&STSPN,BRANCH=YES
         LR    R14,R9                   RESTORE REG 14
.ST01550 LR    R0,R2                    RELOAD REGS
         LR    R1,R5
.ST01560 LR    R15,R4
         &XX1  &XX2                     RETURN TO SVC IH
         SPACE 1
.*
.* THE FOLLOWING IS FOR PROC(MAIN) AND LIFO OPTIONS
.*
.ST05000 AIF   (NOT &STF(3)).MEND       NOT LIFO, ALL FINISHED
***********************************************************************
*
*        LIFO STACK GET/FREE STORAGE ROUTINES
*
         PUSH  USING
         DROP  ,
         USING &P.MCA,R1                R1 POINTS TO MCA
#####GET RSECT ,                        LIFO GET ROUTINE
#####GET AMODE ANY
#####GET RMODE ANY
         USING #####GET,R15             R0 CONTAINS LENGTH NEEDED
         A     R0,&P.F7                 ROUND REQUEST UP TO
         N     R0,&P.F8                 A DOUBLEWORD BOUNDARY
         A     R0,&P.#N                 PT TO NEXT FREE LIFO SLOT
         CL    R0,&P.#E                 IF WE'VE GONE PAST THE END OF
         BH    &P.GA                    THE STACK, GIVE UP AND ABEND
         L     R15,&P.#N                PT TO ALLOCATED SLOT
         ST    R0,&P.#N                 SAVE ADDRESS OF NEXT SLOT
         LR    R1,R15                   MOVE SLOT POINTER
         BR    R14                      RETURN TO CALLER, R1 @ SLOT
*        ABEND 1000,DUMP                STACK TOO SMALL, USE ISA=
&P.GA    LA    R1,1000                  LOAD ABEND CODE
         O     R1,&P.X8                 TURN ON DUMP FLAG
         SVC   13                       ISSUE ABEND SVC
         SPACE 1
         ENTRY ####FREE                 LIFO FREE ROUTINE
         USING ####FREE,R15             R0 CONTAINS ADDRESS
####FREE CL    R0,&P.#S                 ENSURE THE ADDRESS
         BL    &P.FA                    TO BE FREE'ED
         CL    R0,&P.#E                 IS WITHIN THE BOUNDARIES
         BH    &P.FA                    OF THE CURRENT STACK ELEMENT
         A     R0,&P.F7                 FORCE AREA TO BE FREE'ED TO
         N     R0,&P.F8                 DOUBLEWORD BNDRY FOR NEXT GUY
         ST    R0,&P.#N                 SAVE @ NEXT FREE LIFO SLOT
         BR    R14                      RETURN TO CALLER
*        ABEND 1001,DUMP                INVALID AREA ADDRESS
&P.FA    LA    R1,1001                  LOAD ABEND CODE
         O     R1,&P.X8                 TURN ON DUMP FLAG
         SVC   13                       ISSUE ABEND SVC
         SPACE 1
         CNOP  0,4                      GET FULLWORD BOUNDARY
&P.F7    DC    F'7'                     CONSTANTS TO ROUND REQUEST UP
&P.F8    DC    F'-8'                    TO A DOUBLEWORD BOUNDARY
&P.X8    DC    X'80000000'              DUMP FLAG FOR ABEND
         POP   USING                    KILL ADDRESSABILITY
         SPACE 1
         AIF   (&STF(11)).MRSECT
&SYSECT  CSECT ,                        RESUME MAIN PROGRAM CSECT
         MEXIT ,
.MRSECT  ANOP  ,
&SYSECT  RSECT ,                        RESUME MAIN PROGRAM RSECT
.MEND    MEND  ,
./ ADD NAME=#STOPWA  0100-00038-00038-1647-00090-00090-00000-MACRO
         MACRO ,
         #STOPWA ,                      #STOPWA MACRO
.*
.* DEFINE SYMBOLS NEEDED, NOTE ALL GLOBALS ARE FROM #START MACRO
.*
         GBLA  &STWAC                   COUNTER FOR DEFERED WA DEFINES
         GBLB  &STWA                    INDICATES CSECT HAS A WORK AREA
         GBLB  &STF(16)                 CONTROL FLAG BITS, AS FOLLOWS:
.*                                       (01) - PROC OPTION CODED
.*                                       (02) - MAIN OPTION CODED
.*                                       (03) - LIFO OPTION CODED
.*                                       (04) - WKCSECT OPTION CODED
.*                                       (05) - WKDSECT OPTION CODED
.*                                       (06) - #START HAS BEEN CODED
.*                                       (07) - ROUTINE IS AN SVC
.*                                       (08) - WORK FIELDS WANTED
.*                                       (09) - SVAREA=NO OPTION
.*                                       (10) - SAVE=YES OPTION
.*                                       (11) - RSECT=YES OPTION
.*                                       (12) - SVC=(YES,BRANCH)
.*                                       (13) - ENUC CAPPING
.*                                       (14) - PATCH AREA REQUEST
.*
         GBLC  &STPREF                  PREFIX CHARACTERS
         GBLC  &STWANAM                 WORK AREA NAME
         GBLC  &STNAME                  MAIN CSECT NAME
         GBLC  &STAMODE                 MODULE'S CAPPED AMODE
         GBLC  &STACREG                 CAPWORD SAVE REGISTER
         GBLC  &STISASZ                 LIFO ISA SIZE
         GBLC  &SYSSPLV                 SPLEVEL
         GBLC  &STWAD(1000)             WORK AREA DEFERED STACK
         LCLA  &A,&B,&C,&D,&E           LOCAL
         LCLB  &F,&G,&H,&I,&J           WORK
         LCLC  &K,&L,&M,&N,&O,&P        SYMBOLS
.*
.* INITIALIZE SYMBOLS, SET UP PREFIX
.*
&P       SETC  '&STPREF'                MAKE PREFIX EASIER TO WORK WITH
         AIF   (NOT &STF(6)).ST00300    ERROR - NO #START MACRO CODED
         AIF   (NOT &STWA).ST00400      ERROR - NO WORK AREA SPECIFIED
.*
.* THE FOLLOWING IS COMMON TO ALL WORKAREAS
.*
         DS    0D                       FORCE WORK AREA TO DWD BOUNDARY
&P.WALEN EQU   *-&STWANAM               LENGTH OF WORK AREA
.*
.* THE FOLLOWING IS FOR THE PROC OPTION ONLY
.*
         AIF   (NOT &STF(1)).ST00200    NO PROC OPTION, CONTINUE
         AIF   (&STF(2)).ST00200        MAIN OPTION, CONTINUE
         AIF   (&STF(3)).ST00100        LIFO OPTION, CONTINUE
         SPACE 1
&P.MCA   DSECT ,                        MODULE COMMUNICATIONS AREA
&P.#O    DS    A                        ORIGIN OF GETMAINED AREA
         AGO   .ST00200                 CONTINUE
.*
.* THE FOLLOWING IS FOR PROC AND LIFO OPTIONS, BUT NOT MAIN
.*
.ST00100 SPACE 1
&P.MCA   DSECT ,                        MODULE COMMUNICATIONS AREA
&P.#O    DS    A                        ORIGIN OF GETMAINED AREA
&P.#GET  DS    V(#####GET)              PTR TO LIFO GET ROUTINE
&P.#FRE  DS    V(####FREE)              PTR TO LIFO FREE ROUTINE
&P.#S    DS    A                        PTR TO START OF LIFO STACK
&P.#E    DS    A                        PTR TO END OF LIFO STACK
&P.#N    DS    A                        PTR TO NEXT FREE AREA
.*
.* THE FOLLOWING IS COMMON FOR ALL WORK AREA TYPES
.*
.ST00200 SPACE 1
         AIF   (&STF(11)).ST00210
&STNAME  CSECT ,                        RESUME MAIN PROGRAM CSECT
         AGO   .ST00220
.ST00210 ANOP  ,
&STNAME  RSECT ,                        RESUME MAIN PROGRAM RSECT
.ST00220 AIF   (NOT &STF(2)).ST00230    NOT PROC(MAIN), CONTINUE
         AIF   (&STF(3)).ST00225        SKIP CXD IF LIFO
&P.GSIZE CXD   ,                        GET CUMULATIVE WORK AREA LENGTH
         AGO   .ST00230
.ST00225 ANOP  ,
&P.GSIZE DC    A(&STISASZ)              ISA SIZE REQUESTED
.ST00230 AIF   (NOT &STF(1)).ST00250    NOT PROC OPTION, CONTINUE
         AIF   (&STF(3)).ST00250        SKIP IF LIFO
&P.QCON  DC    Q(&STWANAM)              OFFSET TO EXTNL DUMMY SECTION
.ST00250 SPACE 1
         MEXIT ,
.ST00300 MNOTE 4,'ST4001A - #START MACRO NOT CODED IN THIS PROGRAM'
         MEXIT ,
.ST00400 MNOTE 4,'ST4002A - #START MACRO NOT DEFINED WITH WORKAREA'
.MEND    MEND  ,
./ ADD NAME=#TIME    0100-00038-00038-1647-00227-00227-00000-MACRO
         MACRO ,                   
&LABEL   #TIME &TO,&FROM=,&FORMAT='HHMMSSTH',&CLOCK=24,&PAD='0',       *
               &LIST=YES
.*--------------------------------------------------------------------*
.*                                                                    *
.*       TO     (REQUIRED) - OUTPUT BUFFER (WORKTIME OR (R2-R15))     *
.*                                                                    *
.*       FROM=             - SUPPLIED TIME (FULLWORD OR (R0-R15))     *
.*                                                                    *
.*       FORMAT= HH        - HOUR (00-23)                             *
.*               MM        - MINUTES (00-60)                          *
.*               SS        - SECONDS (00-60)                          *
.*               TH        - TENTHS & HUNDREDTHS OF SECONDS           *
.*               AMPM     - PART OF DAY (MORNING OR AFTERNOON)       *
.*                                                                    *
.*       CLOCK=  1224     - STANDARD OR MILITARY CLOCK OPTION        *
.*                                                                    *
.*       PAD=    '0'       - 1 BYTE PAD CHARACTER FOR HH ENCLOSED     *
.*                           WITHIN QUOTES                            *
.*                                                                    *
.*       LIST=   YESNO    - PRINT GENERATION OPTION                  *
.*                                                                    *
.*--------------------------------------------------------------------*
         GBLB  &STF(10)            
         GBLC  &STPREF             
         LCLA  &A,&B,&C,&D         
         LCLB  &F,&G,&H,&I         
         LCLC  &K,&P,&Q,&X,&REG    
&STF(8)  SETB  1                    INDICATE #STARTWA FIELDS WANTED
&X       SETC  'TM&SYSNDX'          GENERATE LABEL PREFIX
&P       SETC  '&STPREF.DBL1'       DOUBLE WORD WORKAREA #1
&Q       SETC  '&STPREF.DBL2'       DOUBLE WORD WORKAREA #2
         AIF   ('&LIST' EQ 'YES').TIM0100
         AIF   ('&LIST' NE 'NO').TIMERR1
         PUSH  PRINT
         PRINT NOGEN
.TIM0100 ANOP  ,                   
         AIF   ('&LABEL' EQ '').TIM0200
&LABEL   DS    0H                  #TIME MACRO - START
.TIM0200 ANOP  ,                   
&A       SETA  K'&PAD               LENGTH OF PAD FIELD
         AIF   (&A NE 3).TIMERR2    IF NOT 3 BYTES, ERROR
*-------
*        #TIME INITIALIZATION
*-------
         AIF   ('&TO' EQ '').TIMERR3
         AIF   ('&CLOCK' EQ '12').TIM0300
         AIF   ('&CLOCK' NE '24').TIMERR4
.TIM0300 ANOP  ,                   
         AIF   ('&FROM' EQ '').TIM0600
         AIF   ('&FROM'(1,1) EQ '(').TIM0400
         ICM   R0,15,&FROM         R0 HAS TIME - HHMMSSTH
         AGO   .TIM0500            
.TIM0400 ANOP  ,                   
&REG     SETC  '&FROM'(2,K'&FROM-2)
         AIF   ('&REG' EQ 'R0' OR '&REG' EQ '0').TIM0500
         LR    R0,&REG             R0 HAS TIME - HHMMSSTH
.TIM0500 ANOP  ,                   
         C     R0,&X.D             CHECK FOR MAXIMUM TIME OF DAY
         BH    &X.A                B. IF TOO HIGH
         LTR   R0,R0               CHECK FOR MINIMUM TIME OF DAY
         BNZ   &X.B                B. IF NOT TOO LOW
&X.A     DS    0H
&F       SETB  1                    INDICATE CONSTANTS REQUIRED
.TIM0600 ANOP  ,                   
         TIME  DEC                 GET CURRENT TIME OF DAY
&X.B     DS    0H
         AIF   ('&TO'(1,1) EQ '(').TIM0700
         LA    R1,&TO              R1 HAS DESTINATION FIELD ADDRESS
         AGO   .TIM0800            
.TIM0700 ANOP  ,                   
&REG     SETC  '&TO'(2,K'&TO-2)
         LR    R1,&REG             R1 HAS DESTINATION FIELD ADDRESS
.TIM0800 ANOP  ,                   
&A       SETA  K'&FORMAT-2          LENGTH OF FORMAT FIELD
&B       SETA  0                    INDEX INTO FORMAT
&K       SETC  '&FORMAT'(2,K'&FORMAT-2)
         MVC   0(&A,R1),&X.C
.TIM0900 ANOP  ,                   
&C       SETA  &A-&B                CALCULATE # OF REMAINING BYTES
         AIF   (&C LT 2).TIM2200    IF 1 TO GO, EXIT
         AIF   ('&K'(&A-&C+1,2) EQ 'HH').TIM1000
         AIF   ('&K'(&A-&C+1,2) EQ 'MM').TIM1400
         AIF   ('&K'(&A-&C+1,2) EQ 'SS').TIM1600
         AIF   ('&K'(&A-&C+1,2) EQ 'TH').TIM1800
         AIF   ('&K'(&A-&C+1,2) EQ 'AM').TIM2000
         AIF   ('&K'(&A-&C+1,2) EQ 'PM').TIM2000
&B       SETA  &B+1                 POINT TO NEXT CHARACTER
&D       SETA  &D+1                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM1000 ANOP  ,                   
*-------
*        CONVERT "HH" INTO HOURS
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).TIM1100   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.TIM1100 ANOP  ,                   
         STCM  R0,8,&P+7           SAVE "HH"
         MVO   &Q+6(2),&P+7(1)
         OI    &Q+7,X'0F'          CONVERT TO "0HHF'
         AIF   ('&CLOCK' EQ '24').TIM1200
&G       SETB  1                    INDICATE CONSTANTS REQUIRED
&I       SETB  1                    INDICATE CONSTANTS REQUIRED
         CL    R0,&X.E             CHECK IF CURRENT TIME IS PAST 12:59
         BL    *+14                B. IF NOT
         SP    &Q+6(2),&X.G
         OI    &Q+7,X'0F'          CONVERT TO "0HHF'
.TIM1200 ANOP  ,                   
         UNPK  0(2,R1),&Q+6(2)
&REG     SETC  '&PAD'(2,K'&PAD-2)  
         AIF   ('&REG' EQ '0').TIM1300
         CLI   0(R1),C'0'          CHECK IF 1ST BYTE IS ZERO
         BNE   *+8                 B. IF NOT
         MVI   0(R1),C&PAD         INSERT PAD CHARACTER
.TIM1300 ANOP  ,                   
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM1400 ANOP  ,                   
*-------
*        CONVERT "MM" INTO MINUTES
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).TIM1500   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.TIM1500 ANOP  ,                   
         STCM  R0,4,&P+7           SAVE "MM"
         MVO   &Q+6(2),&P+7(1)
         OI    &Q+7,X'0F'          CONVERT TO "0MMF'
         UNPK  0(2,R1),&Q+6(2)
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM1600 ANOP  ,                   
*-------
*        CONVERT "SS" INTO SECONDS
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).TIM1700   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.TIM1700 ANOP  ,                   
         STCM  R0,2,&P+7           SAVE "SS"
         MVO   &Q+6(2),&P+7(1)
         OI    &Q+7,X'0F'          CONVERT TO "0SSF'
         UNPK  0(2,R1),&Q+6(2)
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM1800 ANOP  ,                   
*-------
*        CONVERT "TH" INTO TENTHS & HUNDREDTHS OF SECONDS
*-------
         XC    &P,&P               CLEAR WORK AREA #1
         XC    &Q,&Q               CLEAR WORK AREA #2
         AIF   (&D EQ 0).TIM1900   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.TIM1900 ANOP  ,                   
         STCM  R0,1,&P+7           SAVE "TH"
         MVO   &Q+6(2),&P+7(1)
         OI    &Q+7,X'0F'          CONVERT TO "0THF'
         UNPK  0(2,R1),&Q+6(2)
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM2000 ANOP  ,                   
*-------
*        CONVERT "AM" OR "PM" INTO THE CURRENT PART OF THE DAY
*-------
         AIF   (&D EQ 0).TIM2100   
         LA    R1,&D.(,R1)         ADVANCE OUTPUT AREA POINTER
&D       SETA  0                    RESET INDEX INTO AREA
.TIM2100 ANOP  ,                   
&H       SETB  1                    INDICATE CONSTANTS REQUIRED
         MVI   0(R1),C'A'          SET TO "AM"
         CL    R0,&X.F             CHECK IF CURRENT TIME IS PAST NOON
         BL    *+8                 B. IF NOT
         MVI   0(R1),C'P'          CHANGE TO "PM"
&B       SETA  &B+2                 POINT TO NEXT CHARACTER
&D       SETA  &D+2                 POINT TO NEXT CHARACTER
         AGO   .TIM0900            
.*                                 
.TIM2200 ANOP  ,                   
         B     &X.H                BRANCH AROUND CONSTANTS
*-------
*        #TIME CONSTANTS
*-------
&X.C     DC    C&FORMAT            FORMAT FIELD OVERLAY
         AIF   (NOT &F).TIM2300     BYPASS UNNECESSARY CONSTANTS
&X.D     DC    A(X'23595999')      MAXIMUM TIME VALUE PER DAY
.TIM2300 ANOP  ,                   
         AIF   (NOT &G).TIM2400     BYPASS UNNECESSARY CONSTANTS
&X.E     DC    A(X'12595999')      MAXIMUM TIME TILL 1PM
.TIM2400 ANOP  ,                   
         AIF   (NOT &H).TIM2500     BYPASS UNNECESSARY CONSTANTS
&X.F     DC    A(X'12000000')      MAXIMUM TIME TILL PM
.TIM2500 ANOP  ,                   
         AIF   (NOT &I).TIM2600     BYPASS UNNECESSARY CONSTANTS
&X.G     DC    PL2'+12'            VALUE TO SUBTRACT IF TIME PAST 12:59
.TIM2600 ANOP  ,                   
&X.H     DS    0H                  #TIME MACRO - END
         AGO   .MEND
.TIMERR1 MNOTE 8,'#TIM01A - "LIST=" PARAMETER IS INVALID (YES OR NO)'
         AGO   .MEND               
.TIMERR2 MNOTE 8,'#TIM02A - "PAD=" PARAMETER IS INVALID'
         AGO   .MEND               
.TIMERR3 MNOTE 8,'#TIM03A - "TO=" PARAMETER IS MISSING'
         AGO   .MEND               
.TIMERR4 MNOTE 8,'#TIM04A - "CLOCK=" PARAMETER IS INVALID (12 OR 24)'
         AGO   .MEND               
.MEND    ANOP  ,                   
         AIF   ('&LIST' EQ 'YES').MEND2
         POP   PRINT
.MEND2   ANOP  ,                   
         MEND  ,                   
./ ADD NAME=#TSOTERM 0100-00038-00038-1647-00025-00025-00000-MACRO
         MACRO
&NAME    #TSOTERM &OBTAIN,&IF3270=,&IFTWX=,&IF2741=
         AIF  ('&OBTAIN' EQ '' OR '&OBTAIN' EQ 'UCB' OR                X
               '&OBTAIN' EQ 'TYPE').OOKAY
         IHBERMAC 1001,OBTAIN,&OBTAIN
         MEXIT ,
.OOKAY   ANOP  ,
&NAME    L     0,=X'FF000000'           TERMTYPE ENTRY CODE
         SVC   94                       TERMINAL CONTROL SVC
         AIF   ('&IF3270&IFTWX&IF2741' NE '').TYPE
         AIF   ('&OBTAIN' EQ 'TYPE').TYPE
         AIF   ('&OBTAIN' NE 'UCB').MEND
         N     15,=X'FFFF0000'          PICK UP UCB
         MEXIT ,
.TYPE    N     15,=X'000000FF'          PICK UP TERMINAL TYPE
         AIF   ('&IF2741' EQ '').T3270
         CLM   15,1,=AL1(12)            IS THIS A 2741 ?
         BE    &IF2741                  BRANCH IF YES
.T3270   AIF   ('&IF3270' EQ '').TTWX
         CLM   15,1,=AL1(4)             IS THIS A 3270 ?
         BE    &IF3270                  BRANCH IF YES
.TTWX    AIF   ('&IFTWX'  EQ '').MEND
         CLM   15,1,=AL1(16)            IS THIS A TWX ?
         BE    &IFTWX                   BRANCH IF YES
.MEND    MEND  ,
./ ADD NAME=ALLOC    0100-00038-00038-1647-00366-00366-00000-MACRO
         MACRO
&NAME    ALLOC &DUMMY,&PERM,&DSN=,&DDN=,&DDNRET=,&MEMBER=,&DISP=,      X
               &VOL=,&UNIT=,&SYSOUT=,&FREE=,&COPIES=,&LABEL=,          X
               &BLKSIZE=,&DEN=,&DSORG=,&KEYLEN=,&LRECL=,&RECFM=,       X
               &PASWORD=,&DSNRET=,&MF=AUTO,&PREFIX=,&ERROR=,           X
               &SPACE=,&F=,&FILE=,&DA=,&QNAME=,&DSORGRT=,              X
               &VOLRET=,&SPECIAL=,&DDNTO=,                             X
               &FORMS=,&DEST=,&SSREQ=,&FORUSER=,&TU=,&DSNPDE=,         X
               &VERB=S99VRBAL,&HOLD=,&OK=,&FLAG1=
.**********************************************************************
.*                                                                    *
.*    THIS MACRO PROVIDES A DYNAMIC ALLOCATION FUNCTION BY BUILDING   *
.*    A DYNAMIC ALLOCATION PARAMETER LIST AND INVOKING SVC 99.        *
.*    IT FIRST SETS UP A WORKAREA ENVIRONMENT FOR THE PARAMETER LIST  *
.*    AND THEN TESTS THE KEYWORDS SUPPLIED AND INVOKES INNER MACROS   *
.*    TO BUILD THE TEXT UNITS. THE INNER MACROS THEMSELVES USE INNER  *
.*    MACROS TO UPDATE GLOBAL VARIABLES, STORE TEXT UNIT POINTERS ETC *
.*    THERE ARE THREE WAYS OF SPECIFYING THE WORK AREA ADDRESS.       *
.*    A) MF=AUTO, MF=G, MF=(E,ADDRESS,LNTHSYMB).                      *
.*    IN THE FIRST FORM, AN INNER MACRO DYNSPACE IS CALLED TO NAME    *
.*    A WORK AREA, THE NAME BEING RETURNED IN THE GLOBAL SETC         *
.*    VARIABLE &DYNSP. A DSECT IS CREATED TO MAP THIS AREA.           *
.*    THE GLOBAL VARIABLES &DTUO (TEXT UNIT OFFSET COUNTER) AND       *
.*    &DTUPO (TEXT UNIT POINTER OFFSET ACCUMULATOR) ARE SET TO ZERO.  *
.*    THESE ACCUMULATORS ARE UPDATED AS EACH TEXT UNIT PROCESSOR      *
.*    AQUIRES STORAGE. AFTER ALL TEXT UNITS HAVE BEEN BUILT, THE      *
.*    AMOUNT OF SPACE USED IS CALCULATED, AND THE DYNSPACE MACRO IS   *
.*    THEN CALLED AGAIN TO LOG THE AMOUNT NEEDED. DYNSPACE SETS A     *
.*    GLOBAL VARIABLE &DYNSPQ TO THE HIGHEST AMOUNT ANY ALLOC OR      *
.*    FREE MACRO REQUESTED, AND WHEN CALLED WITH THE EXPAND OPTION,   *
.*    (NO OPERANDS OR NAME FIELD SUPPLIED), EXPANDS INTO A DS FOR     *
.*    THAT QUANTITY. (SEE DYNSPACE)                                   *
.*    MF=G SPECIFIES THAT THE ALLOC MACRO ENTER THE BEGIN MACRO       *
.*    WORKAREA TO ACQUIRE THE STORAGE NECESSARY. IT DOES THIS VIA     *
.*    THE RCPDS MACRO. (SEE RCPDS). HOWEVER, IF THE ALLOC MACRO IS    *
.*    CALLED SEVERAL TIMES WITH THIS OPTION, A LOT OF STORAGE WILL BE *
.*    USED UP, AS THE STORAGE WILL NOT BE SHARED. THUS, THIS FORM     *
.*    SHOULD ONLY BE USED IF THE ALLOC/FREE MACRO IS ONLY TO BE USED  *
.*    ONCE OR TWICE DURING AN ASSEMBLY.                               *
.*    MF=E CAUSES THE MACRO TO USE A USER SPECIFIED WORK AREA. THE    *
.*    SECOND PARAMETER GIVES THE NAME OF THE WORKAREA, AND AN         *
.*    OPTIONAL THIRD PARAMETER IS THE NAME OF A SYMBOL TO BE EQUATED  *
.*    TO THE LENGTH OF THE REQUIRED WORK AREA.                        *
.*                                                                    *
.*    DYNAMIC ALLOCATION FUNCTIONS ARE SIMILAR TO THOSE AVAILABLE    *
.*    WITH JCL, USING THE SAME KEYWORDS. HOWEVER, CERTAIN FORMATS    *
.*    ARE SLIGHTLY DIFFERENT. FOR INSTANCE, CERTAIN KEYWORDS CAN     *
.*    HAVE VARYING PARAMETERS, EG DATASET NAME, DDNAME, VOLSER ETC.  *
.*    PROVISION IS MADE FOR BOTH VARIABLE SPECIFICATION.             *
.*    IN THE ABSOLUTE FORM, THE PARAMETER IS ENTERED IN QUOTES,      *
.*    E.G.   ALLOC DSN='SYS1.LINKLIB',DISP=SHR                       *
.*    HOWEVER, THIS NAME REMAINS FIXED FOR THE ASSEMBLY.             *
.*    IN THE VARIABLE FORMAT, THE ADDRESS OF A LOCATOR IS SPECIFIED, *
.*    WHERE THE LOCATOR CONSISTS OF A SIX BYTE FIELD, THE FIRST 4    *
.*    BYTES OF WHICH POINT TO THE PARAMETER, WHILE THE NEXT TWO      *
.*    CONTAIN THE LENGTH.                                            *
.*    EG          ALLOC DSN=LOCATOR                                  *
.*       LOCATOR  DC    A(DSN),Y(12)                                 *
.*       DSN      DC    C'SYS1.LINKLIB'                              *
.*                                                                   *
.*       NUMERIC QUANTITIES E.G. COPIES= FOR SYSOUT, SHOULD EITHER   *
.*       SPECIFY A NUMERIC VALUE, COPIES=3,                          *
.*       A VALUE IN A REGISTER, COPIES=(R3),                         *
.*       OR THE NAME OFF A FULLWORD CONTAINING THE VALUE,            *
.*          COPIES=NUMCOPYS, WHERE NUMCOPYS IS THE NAME OF A         *
.*       FULLWORD FIELD.                                             *
.*                                                                   *
.*       OTHER KEYWORDS SUCH AS DISP= CAN ONLY HAVE THE ABSOLUTE     *
.*       FORM, AND VALUES SHOULD NOT BE ENTERED WITHIN QUOTES.       *
.*       ADDITIONAL FACILITIES NOT AVAILABLE WITH JCL ARE THE        *
.*       RETURN BY THE SYSTEM OF INFORMATION ON THE DATASET, EG      *
.*       DSORG. THIS IS DONE BY SPECIFYING DSORGRT=SYMBOL, WHERE     *
.*       SYMBOL IS A SYMBOL WHICH WILL BE EQUATED TO A TWO BYTE      *
.*       FIELD CONTAINING THE DSORG TYPE (SEE JOB MANAGEMENT,        *
.*       SUPERVISOR AND TSO).                                        *
.*       THE SYSTEM CAN ALSO GENERATE AND RETURN A DDNAME. THIS IS   *
.*       CARRIED OUT BY ENTERING DDNTO=(ADDR1,ADDR2,,...)            *
.*       WHERE ADDR1,ADDR2 ETC ARE THE NAMES OF 8 BYTE FIELDS WHICH  *
.*       ARE TO RECEIVE THE DDNAME.                                  *
.*       FOR FURTHER INFORMATION ON DYNAMIC ALLOCATION, SEE          *
.*       JOB MANAGEMENT, SUPERVISOR AND TSO.                         *
.*                                                                   *
.**********************************************************************
         GBLA  &RCPDYN            COUNTER FOR NO ENTRIES TO MACRO
         GBLA  &DTUO              OFFSET TO TEXT UNITS
         GBLA  &DTUPO             OFFSET TO TEXT UNIT POINTERS
         GBLB  &RCPS99(2)         TELL RCPDSECT NEED DSECTS
         GBLC  &DYNP              PREFIX FOR LABELS FOR THIS CALL
         GBLC  &DYNSP         NAME FOR AUTOMATIC STORAGE ALLOC
         LCLA  &DDNRTO,&DSNRTO         FOR EQUATES FOR RETURNED FLDS
         LCLA  &VOLRTO,&DSRGRTO        FOR EQUATES FOR RETURNED FIELDS
         LCLA  &I                 COUNTER
         LCLB  &DSECT             DSECT NEEDED FOR STORAGE, MF=E
         LCLC  &C,&P,&T,&PAR,&LBL
.*
.*   THE ALLOC MACRO PROVIDES A DYNAMIC ALLOCATION FUNCTION,
&RCPS99(1)     SETB           1
&RCPDYN  SETA  &RCPDYN+1          INCEREMENT COUNTER
&DYNP    SETC  'DYN&RCPDYN' SET DEFAULT PREFIX
&P       SETC  '&DYNP'
.*
.*     CHECK FOR MUTUALLY EXCLUSIVE KEYWORDS
.*
         RCPMUEXC (DSN=,&DSN),(DA=,&DA),(DSNPDE=,&DSNPDE),             X
               (DSNRET=,&DSNRET),(SYSOUT=,&SYSOUT),                    X
               (QNAME=,&QNAME)    MUTUALLY EXCLUSIVE KEYWORDS
         RCPMUEXC (DDN=,&DDN),(FILE=,&FILE),(F=,&F),                   X
               (DDNRET=,&DDNRET),(DDNTO=,&DDNTO)
.*
.*     CHECK FOR KEYWORD DEPENDENCIES
.*
         RCPMUDEP (DSN=,&DSN),(MEMBER=,&MEMBER)  MEMBER NEEDS DSN
         RCPMUDEP (SYSOUT=,&SYSOUT),(COPIES=,&COPIES),                 X
               (DEST=,&DEST),(FORMS=,&FORMS),(HOLD=,&HOLD)
.*
.*     IF ANY MUTUALLY EXCLUSIVE KEYWORDS WERE SPECIFIED,
.*     MNOTES WOULD HAVE BEEN GENERATED. THE REST OF THE MACRO
.*     CODE WILL IGNORE THE SUPERFLUOUS KEYWORDS.
.*     I.E. IF DSN= AND SYSOUT= WERE SPECIFIED, SYSOUT=WOULD BE IGNORED
.*
         AIF   ('&NAME' EQ '').NONAME  SKIP IF NO NAME
&NAME    DS    0H
.NONAME  ANOP
         AIF   ('&PREFIX' EQ '').TMF
         AIF   (K'&PREFIX LT 4).POK
         MNOTE 4,'PREFIX TOO LONG, 1ST 4 CHARS USED'
&DYNP    SETC  '&PREFIX'(1,4)
&P       SETC  '&DYNP'
         AGO   .TMF
.POK     ANOP
&DYNP    SETC  '&PREFIX'
&P       SETC  '&DYNP'
.TMF     AIF   ('&MF(1)' EQ 'G').GEN
         AIF   ('&MF' NE 'AUTO').TMFE
NAME     DYNSPACE             GET NAME FOR SPACE
         LA    R1,&DYNSP               LOAD ADDRESS OF PARAM LIST
         USING &P.DS,R1                USE GENERATED DSECT
&T       SETC  'A'
&PAR     SETC  '&DYNSP+4'
&DSECT   SETB  1
         AGO   .START
.TMFE    AIF   ('&MF(2)' NE '').E2OK
         MNOTE 4,'PLIST ADDRESS OMITTED, MF=G USED'
         AGO   .GEN
.E2OK    ANOP
&DSECT   SETB  1
         AIF   ('&MF(2)' EQ '(').RMFE
         LA    R1,&MF(2)               LOAD PARAM LIST ADDRESS
         USING &P.DS,R1                USE GENERATED DSECT
         AGO   .START
.RMFE    AIF   ('&MF(2)' EQ '(R1)' OR '&MF(2)' EQ '(1)').START
         LR    R1,&PAR                 LOAD S99 PARAM LIST ADDRESS
         AGO   .START
.GEN     LA    R1,&P.RBP               LOAD ADDRESS OF S99 RBP
.START   LA    R15,&P.RB               LOAD ADDRESS OF S99 RB
         USING S99RB,R15
         XC    0(&P.LEN,R1),0(R1)      ZERO PARAMETER LIST
         ST    R15,0(R1)               AND STORE IN RB POINTER
         MVI   0(R1),X'80'             SET HIGH ORDER BIT ON RB PTR
         MVI   S99RBLN,20              MOVE IN LIST LENGTH
         MVI   S99VERB,&VERB           MOVE IN VERB CODE
         AIF   ('&FLAG1' EQ '').NOFLAG1
         MVI   S99FLAG1,&FLAG1         MOVE IN FLAG BYTE
.NOFLAG1 ANOP
         LA    R14,&P.TUP              LOAD ADDRESS OF TU POINTERS
         ST    R14,S99TXTPP            STORE ADDRESS IN S99 RB
         LA    R15,&P.TU               POINT TO SPACE FOR TEXT UNITS
         USING S99TUNIT,R15
&DTUO    SETA  0
&DTUPO   SETA  0
         AIF   ('&SSREQ' EQ 'YES').SSREQ
.TDSN    AIF   ('&DSN&DA' NE '').DSN
         AIF   ('&DSNPDE' NE '').DSNPDE
         AIF   ('&DSNRET' NE '').DSNRT
         AIF   ('&SYSOUT' NE '').SYSOUT
         AIF   ('&DUMMY' EQ 'DUMMY').DUMMY
         AIF   ('&PERM' EQ 'DUMMY').DUMMY
         AIF   ('&QNAME' NE '').QNAME
.TDDN    AIF   ('&DDN&FILE&F' NE '').DDN
         AIF   ('&DDNRET&DDNTO' NE '').DDNRT
.TFREEC  AIF   ('&FREE' NE '').FREEC
.TUNIT   AIF   ('&UNIT&VOL' NE '').UNIT
.TVOLRET AIF   ('&VOLRET' NE '').VOLRET
.TDSRGO  AIF   ('&DSORGRT' NE '').DSORGRT
.TLABEL  AIF   ('&LABEL' NE '').LABEL
.TPSWD   AIF   ('&PASWORD' NE '').PASWORD
.TFORUSE AIF   ('&FORUSER' NE '').FORUSER
.TTU     AIF   ('&TU' NE '').TU
.TDISP   AIF   ('&DISP' NE '').DISP
.TSPACE  AIF   ('&SPACE' NE '').SPACE
.TLRECL  AIF   ('&LRECL' NE '').DCB
         AIF   ('&DEN' NE '').DCB
         AIF   ('&RECFM' NE '').DCB
         AIF   ('&BLKSIZE' NE '').DCB
         AIF   ('&DSORG' NE '').DCB
         AIF   ('&KEYLEN' NE '').DCB
.TPERM   AIF   ('&PERM' EQ 'PERM' OR '&PERM' EQ 'PERMANENT').PERM
         AIF   ('&DUMMY' EQ 'PERM' OR '&DUMMY' EQ 'PERMANENT').PERM
.TSPECI  AIF   ('&SPECIAL' NE '').SPECIAL
         AGO   .SVC99
.SSREQ   RCPSSREQ
         AGO   .TDSN
.DSN     RCPDSN &DSN&DA,&MEMBER
         AGO   .TDDN
.DSNPDE  RCPDSNPD &DSNPDE
         AGO   .TDDN
.DSNRT   RCPDSNRT &DSNRET
&DSNRTO  SETA  &DTUO-44
         AGO   .TDDN
.SYSOUT  RCPSYSOU &SYSOUT,COPIES=&COPIES,DEST=&DEST,                   X
               FORMS=&FORMS,HOLD=&HOLD
         AGO   .TDDN
.DUMMY   RCPDUMMY &DUMMY
         AGO   .TDDN
.QNAME   RCPQNAME &QNAME
         AGO   .TDDN
.DDN     RCPDDN &DDN&F&FILE
         AGO   .TFREEC
.DDNRT   RCPDDNRT &DDNRET
&DDNRTO  SETA  &DTUO-8
         AGO   .TFREEC
.FREEC   RCPSYSOU FREE=&FREE
         AGO   .TUNIT
.UNIT    RCPUNIT &UNIT,&VOL
         AGO   .TVOLRET
.VOLRET  RCPVOLRT &VOLRET
&VOLRTO  SETA  &DTUO-6
         AGO   .TDSRGO
.DSORGRT RCPDSRGR &DSORGRT
&DSRGRTO SETA  &DTUO-2
         AGO   .TLABEL
.LABEL   RCPLABEL &LABEL
         AGO   .TPSWD
.PASWORD RCPPSWD &PASWORD
         AGO   .TFORUSE
.FORUSER RCPFORUS &FORUSER
         AGO   .TTU
.TU      RCPTU &TU
         AGO   .TDISP
.DISP    RCPDISP &DISP
         AGO   .TSPACE
.SPACE   RCPSPACE &SPACE
         AGO   .TLRECL
.DCB     RCPDDCB LRECL=&LRECL,DEN=&DEN,RECFM=&RECFM,BLKSIZE=&BLKSIZE,  X
               DSORG=&DSORG,KEYLEN=&KEYLEN
         AGO   .TPERM
.PERM    RCPPERM
         AGO   .TSPECI
.SPECIAL RCPSPEC &SPECIAL
.SVC99   ANOP
&DTUPO   SETA  &DTUPO-4
         SPACE
         MVI   &P.TUP+&DTUPO,X'80'     SET HIGH ORDER BIT ON TEXT PTRS
         RCPSR2 UNSAVE
&DTUPO   SETA  &DTUPO+4
         AIF   (NOT &DSECT).DYNA
         DROP  R1,R15                  DEACTIVATE ADDRESSABILITY
         LA    R14,4(R1)               POINT TO REQUEST BLOCK
.DYNA    ANOP
*        DYNALLOC                      CALL DYNAMIC ALLOCATION
         DYNALLOC
         AIF   (NOT &DSECT).LTR
         USING &P.RB,R14               SET UP ADDRESSABILITY
**       NOTE  R14 HAS RB ADDRESS, R15 HAS SVC 99 RETURN CODE        **
.LTR     AIF   ('&ERROR' EQ '' AND '&OK' EQ '').TDDTO
         LTR   R15,R15                 TEST ALLOCATION RETURN CODE
         AIF   ('&ERROR' EQ '').TOK
         AIF   ('&ERROR'(1,1) EQ '(').TERRR
         AIF   ('&ERROR'(1,1) EQ '''').TERRM
         BNZ   &ERROR                  BRANCH IF NON ZERO
         AGO   .TOK
.TERRM   ANOP
&C       SETC  '&ERROR'(2,K'&ERROR-2)
&LBL     SETC  '&P&SYSNDX'
         BZ    &LBL                    BRANCH AROUND ERROR MACRO
         &C
&LBL     DS    0H
         AGO   .TOK
.TERRR   ANOP
&C       SETC  '&ERROR'(2,K'&ERROR-2)
         BNZR  &C                      BRANCH IF NON ZERO
.TOK     AIF   ('&OK' EQ '').TDDTO
         AIF   ('&OK'(1,1) EQ '(').TOKR
         BZ    &OK                     BRANCH IF ZERO
         AGO   .TDDTO
.TOKR    ANOP
&C       SETC  '&OK'(2,K'&OK-2)
         BZR   &C                      BRANCH IF ZERO
.TDDTO   AIF   ('&DDNTO' EQ '').RESERVE
&I       SETA  0
.DDNTOL  ANOP
&I       SETA  &I+1
         AIF   ('&DDNTO(&I)' EQ '').RESERVE
         AIF   ('&DDNTO(&I)'(1,1) EQ '(').DDNTOR
         MVC   &DDNTO(&I).(8),&P.TU+&DDNRTO
         AGO   .DDNTOL
.DDNTOR  ANOP
&C       SETC  '&DDNTO(&I)'(2,K'&DDNTO(&I)-2)
         MVC   0(8,&C),&P.TU+&DDNRTO
         AGO   .DDNTOL
.RESERVE AIF   (&DSECT).RESDS
         SPACE 1
***********************************************************************
**       RESERVE SPACE FOR DYNALLOC PARAMETER LIST                   **
***********************************************************************
         RCPDS
.SSP     ANOP
&P.RBP   DS    F                       SVC 99 REQ BLOCK POINTER
&P.RB    DS    5F                      SVC 99 REQUEST BLOCK
&P.TUP   DS    CL&DTUPO                SPACE FOR TEXT POINTERS
         AIF   (&DTUO EQ 0).DTU21
&P.TU    DS    CL&DTUO                 SPACE FOR TEXT UNITS
         AIF   (&DSNRTO EQ 0).TDDNRTO
&DSNRET  EQU   &P.TU+&DSNRTO           OFFSET TO RETURNED DSN
.TDDNRTO AIF   ('&DDNRET' EQ '').DTU11
&DDNRET  EQU   &P.TU+&DDNRTO           OFFSET TO RETURNED DDNAME
.DTU11   AIF   (&VOLRTO EQ 0).DTU12
&VOLRET  EQU   &P.TU+&VOLRTO           OFFSET TO RETURNED VOLSER
.DTU12   AIF   (&DSRGRTO EQ 0).DTU10
&DSORGRT EQU   &P.TU+&DSRGRTO          OFFSET TO RETURNED DSORG
         AGO   .DTU10
.DTU21   ANOP
&P.TU    DS    0C                      NO SPACE NEEDED FOR TEXT UNITS
.DTU10   ANOP
&P.LEN   EQU   *-&P.RBP                LENGTH OF SPACE USED
         AIF   (&DSECT).DSP
         RCPDS
         SPACE 3
         AGO   .EXIT
.RESDS   ANOP
         AIF   ('&DYNSP' EQ '').SP3
         DYNSPACE ADD
.SP3     SPACE
&P.DS    DSECT ,                       DSECT TO MAP SVC 99 DATA
         AGO   .SSP
.DSP     AIF   ('&MF(3)' EQ '').END1
&MF(3)   EQU   &P.LEN                  LENGTH OF AREA
.END1    ANOP
&SYSECT  CSECT ,
         SPACE 3
.EXIT    MEND
         EJECT
TALLOC   BEGIN WKDSECT=WORKAREA
A        ALLOC DSN='SYS1.LINKLIB',DISP=SHR,ERROR=S99FAIL,              X
               DDNAME='DD1'
         EJECT
B        ALLOC DSN='SYS1.LINKLIB',SYSOUT=A,DISP=OLD,                   X
               ERROR=S99FAIL,FREE=CLOSE
         EJECT
C        ALLOC DSN=DSN/(R6)/,DISP=(NEW,DELETE),                        X
               SPACE=(TRK,((R7),1)),RLSE,CONTIG),                      X
               DDNTO=DDN,ERROR=S99FAIL
         EJECT
D        ALLOC DSNPDE=A,DISP=SHR,ERROR=S99FAIL,COPIES=3
         EJECT
E        ALLOC DSN=(R5)/(R6)/,MEMBER='ABCDEF',DDN=DDN/8/,              X
               QNAME='FRED',MF=(E,ALLOCPL,#ALLOCPL)
         EJECT
S99FAIL  S99FAIL
         EJECT
         BEGINWKA
DDN      DS    CL8
DSN      DS    CL44
ALLOCPL  DS    CL(#ALLOCPL)
         EXITWKA
         END
./ ADD NAME=BEGIN    0100-00038-00038-1647-00373-00373-00000-MACRO
         MACRO ,
&NAME    BEGIN &ID=YES,&WKDSECT=,&WKCSECT=,&REG0=,&REG1=,&PREFIX=,     X
               &NOPARM=,&SP=1,&PARSEP=,&PARSWKA=,&REGS=YES,&PARSERR=,  X
               &CHECKID=,&BASE=R12,&PDLREG=R11,&PDLNAME=IKJPARMD,      X
               &PCL=,&ZEROIZE=,&INITRTN=,&SAVESUF=,&SAVEPRE=,          X
               &CPPLPTR=,&USING=,&ISA=,&CELL=,&ESDPRFX=,&LOAD=
.*
         GBLB  &STBEG                   START/BEGIN PRESENT
         GBLB  &RCPRCP,&RCPIOPL(2),&RCPCP,&RCPRENT,&RCPPPL(2)
         GBLB  &RCPDFPL(2),&RCPDFPB(2)  DEFAULT PARM LIST/BLOCK
         GBLA  &#COPYSZ                 COPYRIGHT NOTICE SIZE
         GBLA  &RCPSWS(10)              ENVIRONMENT SWITCHES
         GBLA  &RCPBGN#                 COUNTER OF TIMES BEGIN ISSUED
         GBLB  &RCPECT(2),&RCPUPT(2),&RCPPSCB(2),&RCPS99(2),&RCPCPPL(2)
         GBLB  &RCPSTPB(2),&RCPPTPB(2),&RCPGTPB(2),&RCPPGPB(2)
         GBLB  &RCPLSD(2)
         GBLB  &RCPBRGS
         GBLC  &RCPSPN,&RCPPRE,&RCPWKDS,&RCPWKCS
         LCLA  &I,&J,&L
         LCLB  &ESDDATE
         LCLC  &P,&CHARVAR,&C
         LCLC  &R2
         #COPY SET                      COPYRIGHT NOTICE
&STBEG   SETB  1                        START/BEGIN PRESENT
&J       SETA  N'&SYSLIST
&R2      SETC  'R2'
&RCPBGN# SETA  &RCPBGN#+1               INCREMENT BEGIN MACRO COUNT
         AIF   ('&REG1' EQ '').TRCP
&R2      SETC  '&REG1'
.TRCP    AIF   (NOT &RCPRCP).TESTOPT TEST FOR 2ND ENTRY TO MACRO
&RCPIOPL(1) SETB 0
&RCPCP   SETB  0
&RCPRENT SETB  0
&RCPPPL(1) SETB 0
&RCPECT(1) SETB 0
&RCPUPT(1) SETB 0
&RCPPSCB(1) SETB 0
&RCPSTPB(1) SETB 0
&RCPPTPB(1) SETB 0
&RCPPGPB(1) SETB 0
&RCPGTPB(1) SETB 0
&RCPDFPL(1) SETB 0
&RCPSWS(1) SETA 0
&RCPSWS(2) SETA 0
&RCPSWS(3) SETA 0
&RCPSWS(4) SETA 0
&RCPSWS(5) SETA 0
&RCPSWS(6) SETA 0
&RCPSWS(7) SETA 0
&RCPSWS(8) SETA 0
&RCPSWS(9) SETA 0
&RCPWKDS SETC  ''
&RCPWKCS SETC  ''
&RCPPRE  SETC  ''
.TESTOPT ANOP  ,
&RCPRCP  SETB  1
.NEXTOPT AIF  (&I GE &J).ENDOPT
&I       SETA  &I+1
&C       SETC  '&SYSLIST(&I)'
         AIF   ('&C' NE 'CP').T1
&RCPCP   SETB  1
         AGO   .NEXTOPT
.T1      AIF   ('&C' NE 'TERMIO').T2
&RCPIOPL(1) SETB 1
         AGO   .NEXTOPT
.T2      AIF   ('&C' NE 'PARSE' AND '&C' NE 'PARS').T3
&RCPPPL(1) SETB 1
         AGO   .NEXTOPT
.T3      AIF   ('&C' NE 'RENT').T4
&RCPRENT SETB  1
         AGO   .NEXTOPT
.T4      AIF   ('&C' NE 'DYNALOC').T5
&RCPS99(1) SETB 1
         AGO   .NEXTOPT
.T5      AIF   ('&C' NE 'PUTL' AND '&C' NE 'PUTLINE').T6
&RCPPTPB(1) SETB 1
&RCPIOPL(1) SETB 1
         AGO   .NEXTOPT
.T6      AIF   ('&C' NE 'GETL' AND '&C' NE 'GETLINE').T7
&RCPIOPL(1) SETB 1
&RCPGTPB(1) SETB 1
         AGO   .NEXTOPT
.T7      AIF   ('&C' NE 'STACK' AND '&C' NE 'FLUSH').T8
&RCPIOPL(1) SETB 1
&RCPSTPB(1) SETB 1
         AGO   .NEXTOPT
.T8      AIF   ('&C' NE 'PUTGET').T9
&RCPIOPL(1) SETB 1
&RCPPGPB(1) SETB 1
         AGO   .NEXTOPT
.T9      AIF   ('&C' NE 'ECT').T10
&RCPECT(1) SETB 1
ECTSWS   DCLSW GENERIC=ECT
         AGO   .NEXTOPT
.T10     AIF   ('&C' NE 'UPT').T11
&RCPUPT(1) SETB 1
UPTSWS   DCLSW GENERIC=UPT
         AGO   .NEXTOPT
.T11     AIF   ('&C' NE 'PSCB').T12
&RCPPSCB(1) SETB 1
PSCBATR1 DCLSW GENERIC=PSCB
         AGO   .NEXTOPT
.T12     AIF   ('&C' NE 'LSD').T13
&RCPLSD(1) SETB 1
         AGO   .NEXTOPT
.T13     AIF   ('&C' NE 'ESDDATE').T14
&ESDDATE SETB  1
         AGO   .NEXTOPT
.T14     AIF   ('&C' NE 'NOSAVEAREA').T15
&RCPSWS(1) SETA 1                       INDICATE NO SAVEAREA
         AGO   .NEXTOPT
.T15     AIF   ('&C' NE 'NOSAVE').T16
&RCPSWS(1) SETA 2                       INDICATE NOSAVE
         AGO   .NEXTOPT
.T16     AIF   ('&C' NE 'DFLT' AND '&C' NE 'DEFAULT').T17
&RCPDFPL(1) SETB 1
         AGO   .NEXTOPT
.T17     AIF   ('&C' NE 'PROC').T18
&RCPSWS(2) SETA 1
         AGO   .NEXTOPT
.T18     AIF   ('&C' NE 'PROC(MAIN)').T19
&RCPSWS(2) SETA 2
         AGO   .NEXTOPT
.T19     AIF   ('&C' NE 'LIFO' AND '&ISA' EQ '').T20
&RCPSWS(3) SETA 1
         AGO   .NEXTOPT
.T20     ANOP  ,
         AIF   ('&C' EQ '').NEXTOPT    IGNORE NULL OPERANDS
.INVOPT  MNOTE 4,'''&C'' OPERAND INVALID. IGNORED'
         AGO   .NEXTOPT
.ENDOPT  ANOP  ,
.TESTPRE AIF   (K'&PREFIX GT 0).TPRELEN
&P       SETC  'RCP'
         AIF   (&RCPBGN# EQ 1).SETPRE
&P       SETC  'XX&RCPBGN#'(K'&RCPBGN#,3)
         AGO   .SETPRE
.TPRELEN AIF   (K'&PREFIX LE 3).PREFOK
         MNOTE 1,'PREFIX MUST BE 1 TO 3 CHARACTERS LONG. FIRST 3 USED'
&P       SETC  '&PREFIX'(1,3)
         AGO   .SETPRE
.PREFOK  ANOP  ,
&P       SETC  '&PREFIX'
.SETPRE  ANOP  ,
&RCPPRE  SETC  '&P'                     SET GLOBAL BEGIN PREFIX
.TESTNM  AIF   ('&NAME' NE '').NAMEOK
         MNOTE 8,'NAME OPERAND REQUIRED'
         MEXIT ,
.NAMEOK  ANOP  ,
&NAME    CSECT ,
         AIF   ('&REGS' NE 'YES' OR &RCPBRGS).NOREGS
         SPACE 5
&RCPBRGS SETB  1
         #REGS ,
.NOREGS  ANOP  ,
         EJECT ,
         AIF   (NOT &ESDDATE).TPRFX
&C       SETC  '@'
         AIF   ('&ESDPRFX' EQ '').ESDOK  IF ESDPRFX= NOT OVERRIDDEN
.TPRFX   AIF    ('&ESDPRFX' EQ '').ENDESD  IF ESDPRFX NOT SPEC, SKIP
&C       SETC  '&ESDPRFX'               GET ESD DATE PREFIX
         AIF    (K'&C LT 3).ESDOK          CHECK LENGTH (MUST BE < 3)
         MNOTE 4,'FIRST TWO CHARS OF ESD DATE PREFIX USED'
&C       SETC  '&ESDPRFX'(1,2)          GET 1ST 2 CHARS
.ESDOK   ANOP  ,
&C       SETC  '&C'.'&SYSDATE'(1,2).'&SYSDATE'(4,2).'&SYSDATE'(7,2)
&C       EQU   &NAME                    PROVIDE EXTERNAL SYMBOL
         ENTRY &C                       CONTAINING ASSEMBLY DATE
         SPACE 1
.ENDESD  ANOP  ,
&RCPPRE  SETC  '&P'
.TESTID  AIF   ('&ID' EQ '' OR '&ID' EQ 'NO').STM
         AIF   ('&ID' EQ 'YES' OR '&ID' EQ '*').STANDID
         AIF   ('&ID'(1,1) EQ '''').QID
&L       SETA  K'&ID+21
         AIF   (&L/2 EQ (&L+1)/2).L1EVEN
&L       SETA  &L+1+&#COPYSZ
.L1EVEN  B     &L.(,R15)                BRANCH AROUND ID
&L       SETA  K'&ID+16+&#COPYSZ
         DC    AL1(&L)                  LENGTH OF ID
         DC    C'&ID'                   MODULE ID
         AGO   .DATE
.QID     ANOP  ,
&L       SETA  K'&ID+19
         AIF   (&L/2 EQ (&L+1)/2).L2EVEN
&L       SETA  &L+1+&#COPYSZ
.L2EVEN  B     &L.(0,R15)               BRANCH AROUND ID
&L       SETA  K'&ID+14+&#COPYSZ
         DC    AL1(&L)                  LENGTH OF ID
         DC    C&ID                     MODULE ID
.DATE    DC    CL8' &SYSTIME'           TIME OF ASSEMBLY
         DC    CL8'&SYSDATE'            DATE OF ASSEMBLY
         #COPY GEN                      COPYRIGHT NOTICE
         AGO   .STM
.STANDID ANOP  ,
&L       SETA  30+&#COPYSZ
         B     &L.(0,R15)               BRANCH AROUND ID
&L       SETA  &L-5
         DC    AL1(&L)                  LENGTH OF ID
         DC    CL8'&NAME'               MODULE NAME
         DC    CL8' &SYSTIME'           TIME OF ASSEMBLY
         DC    CL9'&SYSDATE'            DATE OF ASSEMBLY
         #COPY GEN                      COPYRIGHT NOTICE
*
.STM     STM   R14,R12,12(R13)          SAVE CALLER'S REGISTERS
         AIF   ('BASE(1)' NE '').BASEOK
         LA    R12,0(0,R15)             LOAD BASE REGISTER WITH EP
         USING &NAME,R12                ESTABLISH ADDRESSABLITY
         AGO   .BASEEND
.BASEOK  LA    &BASE(1),0(0,R15)        LOAD BASE REGISTER WITH EP
         USING &NAME,&BASE(1)           ESTABLISH ADDRESSABILITY
         AIF   ('&BASE(2)' EQ '').BASEEND
         LA    &BASE(2),2048(0,&BASE(1))
         LA    &BASE(2),2048(0,&BASE(2))
         USING &NAME+4096,&BASE(2)
         AIF   ('&BASE(3)' EQ '').BASEEND
         LA    &BASE(3),2048(0,&BASE(2))
         LA    &BASE(3),2048(0,&BASE(3))
         USING &NAME+8192,&BASE(3)
.BASEEND AIF   (&RCPSWS(1) GT 0).NOSAVER  TEST FOR NOSAVEAREA OPT
         AIF   (&RCPSWS(2) GT 0).PROC  TEST FOR PROC OPTION
         AIF   ('&WKDSECT' NE '').RENTOPT
         AIF   ('&WKCSECT' NE '').CSOPT
         AIF   (NOT &RCPCP AND NOT &RCPRENT).INLINE
&RCPWKDS SETC  '&P.DSECT'
         AGO   .DSGET
.NOSAVER AIF   ('&WKCSECT&WKDSECT' NE '').NSWK
.NSTCP   AIF   (&RCPCP).NSCP
.NSCONT  AGO   .CONTINU
.NSWK    MNOTE 8,'WKCSECT= AND WKDSECT= NOT COMPATIBLE WITH NOSAVEAREA X
               OPTION'
         AGO   .NSTCP
.NSCP    MNOTE 8,'CP OPTION NOT COMPATIBLE WITH NOSAVEAREA OPTION'
         AGO   .NSCONT
.PROC    RCPPROC WKCSECT=&WKCSECT,WKDSECT=&WKDSECT,                    X
               REG1=&REG1,REG0=&REG0,ISA=&ISA,SAVEPRE=&SAVEPRE,        X
               SAVESUF=&SAVESUF,SP=&SP
         AGO   .SETRC0
.INLINE  LR    R15,R13                  SAVE CALLERS SAVE AREA ADDRESS
         CNOP  0,4
         LA    R13,*+8
         B     *+76                     BRANCH AROUND
         DC    18F'0'                   SAVE AREA
         ST    R15,4(0,R13)             CHAIN SAVE
         ST    R13,8(0,R15)             AREAS TOGETHER
         AGO   .USING
.RENTOPT ANOP  ,
&RCPWKDS SETC  '&WKDSECT'
&RCPWKCS SETC  ''
.DSGET   SPACE 4
         AIF   ('&SAVEPRE' NE '' OR '&SAVESUF' NE '').RCPSAVE
         RCPDS ,
         DS    9D                       RESERVE SPACE FOR SAVE AREA
&P.RCODE DS    F                        RETURN CODE
         RCPDS ,
         SPACE 3
         AGO   .DSGET2
.RCPSAVE RCPSAVE &SAVEPRE,&SAVESUF
.DSGET2  AIF   ('&REG1' EQ '').TESTR0
&R2      SETC  '&REG1'
.TESTR0  AIF   ('&REG0' EQ '').GETMAIN
         LR    &REG0,R0                 SAVE REGISTER 0 CONTENTS
.GETMAIN LR    &R2,R1                   SAVE REGISTER 1 CONTENTS
         GETMAIN RU,LV=&P.WKLEN,SP=&SP,LOC=BELOW
&RCPSPN  SETC  '&SP'
&RCPRCP  SETB  1
         AIF   ('&ZEROIZE' NE 'YES').NZERO
         LR    R14,R1                   SAVE WORK AREA POINTER
         LR    R0,R1                    R0 POINTS TO WORK AREA
         L     R1,=A(&P.WKLEN)          R1 HAS LENGTH OF WORK AREA
         SR    R15,R15                  R15 HAS PAD BYTE & ZERO LENGTH
         MVCL  R0,R14                   CLEAR WORK AREA
         LR    R1,R14                   RESTORE W/A POINTER
.NZERO   ST    R13,4(0,R1)              CHAIN SAVE
         ST    R1,8(0,R13)              AREAS TOGETHER
         LR    R13,R1                   LOAD SAVE AREA ADDRESS
         USING &RCPWKDS,R13             ESTABLISH ADDRESSABILITY TO IT
         AGO   .SETRC0
.CSOPT   SPACE 4
&RCPRCP  SETB  1
&RCPWKDS SETC  ''
&RCPWKCS SETC  '&WKCSECT'
         RCPDS ,
         DS    9D                       RESERVE SPACE FOR SAVE AREA
&P.RCODE DC    F'0'                     RETURN CODE
         RCPDS ,
         SPACE 3
         LR    R15,R13                  SAVE CALLER'S SAVE AREA ADRRESS
         L     R13,=A(&WKCSECT)         AND PICK UP ADDRESS OF NEW ONE
         USING &WKCSECT,R13             ESTABLISH ADDRESSABILITY TO IT
         ST    R15,4(0,R13)             CHAIN SAVE
         ST    R13,8(0,R15)             AREAS TOGETHER
.SETRC0  XC    &P.RCODE,&P.RCODE        SET RETURN CODE TO ZERO
         AIF   ('&INITRTN' EQ '').BUILD
         AIF   ('&INITRTN(2)' EQ '').INITBAL
         AIF   ('&INITRTN(2)'(1,1) EQ '(').INITREG
         B     &INITRTN(1)             BRANCH TO INITIALIZATION ROUTINE
&CHARVAR SETC  '&INITRTN(2)'
&CHARVAR DS    0H                       PROVIDE RETURN ADDRESS
         AGO   .BUILD
.INITREG ANOP  ,
&C       SETC  '&INITRTN(2)'(2,K'&INITRTN(2)-2)
         BAL   &C,&INITRTN(1)           BAL TO INITIALIZATION RTN
         AGO   .BUILD
.INITBAL BAL   R14,&INITRTN(1)          BAL TO INITIALIZATION ROUTINE
.BUILD   AIF   ('&LOAD' EQ '').NOLOAD
         EJECT ,
***********************************************************************
**       LOAD SOME MODULES NEEDED BY THIS ROUTINE                    **
***********************************************************************
         SPACE 1
         LR    R14,R1                   PRESERVE REGISTER 1
&I       SETA  0
.LOADLOP ANOP  ,
&I       SETA  &I+1
         AIF   (&I GT N'&LOAD).ENDLOAD
         AIF   (&I EQ 1 OR &I EQ &I/2*2).DOLOAD
         SPACE 1
.DOLOAD  MNOTE '         RCPLOAD &LOAD(&I)'
         RCPLOAD &LOAD(&I)
         SPACE 1
         AGO   .LOADLOP
.ENDLOAD LR    R1,R14                   RESTORE REGISTER 1
.NOLOAD  ANOP  ,
         AIF   (NOT &RCPCP).USING
         AIF   (&RCPCPPL(2)).BPCPPL
         EJECT ,
&RCPCPPL(2) SETB 1
         IKJCPPL
&NAME    CSECT ,
.BPCPPL  SPACE 4
         RCPDS ,
&P.CPPL  DS    A                        SAVE ADDRESS OF CPPL HERE
&P.ECB   DS    F                        I/O SERVICE ROUTINE ECB
         RCPDS ,
         SPACE 4
         AIF   ('&RCPWKDS' NE '').TCPPLP
         LR    &R2,R1                   LOAD PARM ADDRESS
.TCPPLP  AIF   ('&CPPLPTR' EQ '').STCPPL
         AIF   (N'&CPPLPTR EQ 2).OKCPPLP
         MNOTE 8,'INVALID CPPLPTR OPTIONS'
         AGO   .STCPPL
.OKCPPLP L     &CPPLPTR(1),&CPPLPTR(2)(&R2) LOAD CPPL ADDRESS
         ST    &CPPLPTR(1),&P.CPPL      SAVE CPPL ADDRESS
         USING CPPL,&CPPLPTR(1)         ADDRESS CPPL DSECT
         AGO   .XCECB
.STCPPL  ST    &R2,&P.CPPL              SAVE CPPL ADDRESS
         USING CPPL,&R2                 ADDRESS CPPL
.XCECB   XC    &P.ECB,&P.ECB            ZERO ATTENTION ECB
         AIF   ('&CHECKID(1)' EQ '').BIOPL
         RCPCKID &CHECKID
.BIOPL   AIF   (NOT &RCPIOPL(1)).BDFPL
         RCPIOPL ,
.BDFPL   AIF   (NOT &RCPDFPL(1)).BPARS
         RCPDFPL ,
.BPARS   AIF   (NOT &RCPPPL(1)).CONTINU
         RCPPPL PCL=&PCL,NOPARM=&NOPARM,PARSEP=&PARSEP,                X
               PARSWKA=&PARSWKA,PARSERR=&PARSERR,PDLREG=&PDLREG,       X
               PDLNAME=&PDLNAME
.CONTINU ANOP  ,
.USING   AIF   ('&USING' EQ '').EXIT
         SPACE 2
&L       SETA  1
&I       SETA  N'&USING
.USING2  AIF   (&L GT &I).EXIT
         AIF   ('&USING(&L)' EQ '' OR '&USING(&L+1)' EQ '').USINGE
         USING &USING(&L),&USING(&L+1)
&L       SETA  &L+2
         AGO   .USING2
.USINGE  MNOTE 4,'REQUIRED OPERAND(S) MISSING ON USING KEYWORD'
&L       SETA  &L+2
         AGO   .USING2
.EXIT    EJECT ,
         MEND  ,
./ ADD NAME=BEGINWKA 0100-00038-00038-1647-00040-00040-00000-MACRO
         MACRO ,
         BEGINWKA &LTORG=YES
         GBLA  &EXECUTN,&RCPSWS(10)
         GBLB  &RCPS99(2)
         GBLC  &RCPPRE,&RCPWKDS,&RCPWKCS
         LCLC  &P,&QNAME
         AIF   ('&LTORG' NE 'YES').RCPDS
         AIF   (&EXECUTN EQ 0).LIT
***********************************************************************
**       E X E C U T E D   I N S T R U C T I O N   P O O L           **
***********************************************************************
         SPACE 1
         #EXEC ,
         SPACE 2
.LIT     ANOP  ,
***********************************************************************
**             L I T E R A L      P O O L                            **
***********************************************************************
         SPACE 1
         LTORG ,
.EJECT   EJECT ,
.RCPDS   AIF   (&RCPSWS(1) GT 0).EXIT
         AIF   (&RCPSWS(2) EQ 0).RCPDS2
         AIF   (&RCPSWS(2) EQ 1 AND &RCPSWS(3) EQ 1).RCPDS2
.*      IF PROC AND LIFO, NO QCON OR CXD
&P       SETC  '&RCPPRE'
         AIF   (&RCPSWS(2) EQ 1).QCON
&P.CXD   CXD   ,                        CUMULATIVE WORK AREA LENGTH
.QCON    ANOP  ,
&QNAME   SETC  '&RCPWKDS'
         AIF   ('&RCPWKDS&RCPWKCS' EQ '&RCPWKDS').QCGEN
&QNAME   SETC  '&P.DSEC'
&P.DSEC  DSECT ,                        PRIOR DEFINITION FOR QCON
&SYSECT  CSECT ,
.QCGEN   ANOP  ,
&P.QCON  DC    Q(&QNAME)                EXTERNAL DUMMY SECTION OFFSET
.RCPDS2  RCPDS ,
         AIF   (NOT &RCPS99(1)).EXIT
         DYNSPACE ,
.EXIT    MEND  ,
./ ADD NAME=CICB     0100-00038-00038-1647-00045-00045-00000-MACRO
         MACRO
         CICB ,
***********************************************************************
*                                                                     *
*  MACRO NAME = CICB                                                  *
*                                                                     *
*  DESCRIPTIVE NAME = CATALOG INTEGRITY CONTROL BLOCK                 *
*                                                                     *
*  FUNCTION = THE CICB IS USED BY VSAM CATALOG MANAGEMENT WHEN        *
*             MOVING THE NONAUTHORIZED USER'S INTERFACE CONTROL       *
*             BLOCK TO KEY 0, FETCH-PROTECTED STORAGE.                *
*                                                                     *
***********************************************************************
CICB     DSECT
CICBID   DS    CL4                CICB ID = C"CICB"
CICFLAGS DS    XL1                CONTROL FLAGS
CICCOUNT EQU   B'10000000'        COUNT MODE
CICPTRSW EQU   B'01000000'        WORK AREA POINTER IS SWITCHED
CICFPLOP EQU   B'00100000'        TEST FPL LOOP ERROR
CICPASWD EQU   B'00010000'        PASSWORD IS TO BE MOVED
*              B'00001111'        RESERVED
CICUSKEY DS    XL1                USER KEY
         DS    XL2                RESERVED
CICGEOPR DS    XL4                GEOMETRIC PROGRESSION COUNTER
CICINCRM DS    XL4                INCREMENTAL COUNTER
CICFVTCN DS    XL4                FVT INCREMENTAL COUNTER
CICFVTDX DS    XL4                FVT INDEX
CICSVADR DS    A                  SAVED FPL ADDRESS
CICFPLDI DS    XL4                FPL DATA INDEX
CICFPLLP DS    A                  FPL ADDRESS FOR LOOP CHECK
CICFVTPR DS    A                  FVT ADDRESS
CICBKPTR DS    A                  POINTER TO BLOCK TO MOVE
CICBKLNG DS    XL4                LENGTH OF BLOCK TO MOVE
CICNXTBK DS    A                  POINTER TO NEXT AVAILABLE AREA
CICRMBYT DS    XL4                REMAINING BYTES IN CISA
CICGMCNT DS    XL4                COUNT FOR GETMAIN
CICRAREA DS    A                  POINTER TO USER RETURN AREA
CICCISAP DS    A                  POINTER TO BEGINNING OF CISA
CICCISSP DS    A                  POINTER TO SECONDARY CISA
CICSABYT DS    XL4                BYTES IN SECONDARY CISA
CICCICAB DS    XL4                BYTES IN PRIMARY CISA
CICPRFPL DS    A                  PRELMINARY FPL ADDRESS
CICREGSV DS    F                  REGISTER SAVE AREA
CICMRGSV DS    F                  MULTIPLE REGISTER SAVE AREA
         MEND
./ ADD NAME=DEFAULT  0100-00038-00038-1647-00096-00096-00000-MACRO
         MACRO
&NAME    DEFAULT &DSN=,&BUFFER=,&ERROR=,&NOTCAT=,&QUAL=
         GBLB  &RCPDFPL(2)
         GBLC  &EXECNAM,&RCPPRE,&RCPDFEP,&RCPDFER
         LCLA  &I,&J
         LCLC  &R,&DFPB,&ENDLAB,&LABEL,&P1,&P2,&C
         AIF   (NOT &RCPDFPL(1)).ERROR1
&LABEL   SETC  '&NAME'
&DFPB    SETC  '&RCPPRE.DFPB+DFPB'
&ENDLAB  SETC  '&RCPPRE&SYSNDX'
         AIF  (N'&SYSLIST EQ 0 AND '&DSN' EQ '' AND '&BUFFER' EQ '').GO
         AIF   ('&BUFFER' NE '').BF1
         AIF   ('&DSN' EQ '').ENDDSN
&LABEL   LA    R1,&RCPPRE.DSNB          LOAD DSNAME BUFFER ADDRESS
         AGO   .STR1
.BF1     AIF   ('&BUFFER'(1,1) EQ '(').RB
&LABEL   LA    R1,&BUFFER               LOAD ADDRESS OF DSNAME BUFFER
         AGO   .STR1
.RB      ANOP  ,
&LABEL   LA    R1,&BUFFER(1)            LOAD ADDRESS OF DSNAME BUFFER
.STR1    STCM  R1,7,&DFPB.DSN-DFPB+1    STORE IT IN DFPB
&LABEL   SETC  ''
.DSN     AIF   ('&DSN' EQ '').ENDDSN
         AIF   ('&DSN'(1,1) EQ '(').DSNR
         TM    &DSN+6,64                WAS DSNAME ENTERED IN QUOTES?
         BO    &ENDLAB                  IF SO, BYPASS DEFAULT ROUTINE
         L     R14,&DSN                 LOAD DSNAME ADDRESS
         LH    R15,&DSN+4                AND LENGTH
         AGO   .STR15
.DSNR    TM    6(&DSN(1)),64            WAS DSNAME ENTERED IN QUOTES?
         BO    &ENDLAB                  IF SO, BYPASS DEFAULT ROUTINE
         L     R14,0(,&DSN(1))          LOAD DSNAME ADDRESS
         LH    R15,4(,&DSN(1))          AND LENGTH
.STR15   STH   R15,0(,R1)               STORE LENGTH INTO DSN BUFFER
         LA    R0,2(,R1)                POINT PAST 2 BYTE HEADER
         LA    R1,44                    LOAD MOVE LENGTH
         ICM   R15,8,=C' '              INSERT PADDING CHARACTER
         MVCL  R0,R14                   MOVE DSNAME TO BUFFER, AND PAD
.ENDDSN  ANOP  ,
.LOOP1   ANOP  ,
&I       SETA  &I+1
         AIF   (&I GT N'&SYSLIST).EXITL1
&C       SETC  '&SYSLIST(&I)'
         AIF   ('&C' NE 'USERID' AND '&C' NE 'USID').T2
&P2      SETC  '&P2+DFPBUID'
         AGO   .LOOP1
.T2      AIF   ('&C' NE 'MSG' AND '&C' NE 'MESSAGE').T3
&P2      SETC  '&P2+DFPBMSG'
         AGO   .LOOP1
.T3      AIF   ('&C' NE 'RET' AND '&C' NE 'RETQUAL').T4
&P2      SETC  '&P2+DFPBRET'
         AGO   .LOOP1
.T4      ANOP  ,
         MNOTE 4,'INVALID OPTION ''&C'', IGNORED'
         AGO   .LOOP1
.EXITL1  AIF   ('&QUAL' NE '').NQUAL
.*
.NQUAL   ANOP  ,
         AIF   ('&P2' EQ '').GO
&P2      SETC  '&P2'(2,K'&P2-1)
&LABEL   MVI   &DFPB.CNTL-DFPB,&P2
&LABEL   SETC  ''
.GO      ANOP  ,
&LABEL   LA    R1,&RCPPRE.DFPL          LOAD PARM LIST ADDRESS
         AIF   ('&RCPDFEP' EQ '').LINK
         L     R15,&RCPDFEP             LOAD DEFAULT ROUTINE EP ADDR
         BALR  R14,R15                  AND INVOKE IT
         AGO   .ENDLINK
.LINK    ANOP  ,
*        INVOKE DEFAULT SERVICE ROUTINE
         CALLTSSR EP=IKJEHDEF
.ENDLINK ANOP  ,
         AIF   ('&ERROR' EQ 'NO').NERR
         AIF   ('&ERROR' EQ '').TDFER
&RCPDFER SETC  '&ERROR'
         AGO   .DFER
.TDFER   AIF   ('&RCPDFER' EQ '').NERR
.DFER    CL    R15,=A(4)                DID DEFAULT SUCCEED?
         BNH   *+12                     YES, OK
         CL    R15,=A(20)               WAS DATASET NOT IN CATALOG?
         BNE   &ERROR                   IF NOT, GO TO ERROR ROUTINE
         AIF   ('&DSN' EQ '').ENDLAB
.NERR    L     R15,&DFPB.DSN-DFPB       LOAD DSN BUFFER ADDR
         AIF   ('&DSN'(1,1) EQ '(').DSNR2
         MVC   &DSN+4(2),0(R15)         UPDATE PDE LENGTH FIELD
         LA    R15,2(,R15)               POINT PAST HEADER
         ST    R15,&DSN                  AND UPDATE PDE POINTER
         AGO   .ENDLAB
.DSNR2   MVC   4(2,&DSN(1)),0(R15)      UPDATE PDE LENGTH FIELD
         LA    R15,2(,R15)               POINT PAST HEADER
         ST    R15,0(,&DSN(1))           AND UPDATE PDE POINTER
.ENDLAB  ANOP  ,
&ENDLAB  DS    0H
.EXIT    MEXIT ,
.ERROR1  MNOTE 8,'DEFAULT OPTION NOT SPECIFIED ON BEGIN MACRO'
         MEND
./ ADD NAME=DYNSPACE 0100-00038-00038-1647-00052-00052-00000-MACRO
         MACRO
&NAME    DYNSPACE &TYPE
.*
.*    THIS IS AN INNER MACRO TO ALLOC/FREE.
.*    IT IS CALLED TO   A) NAME AN AREA FOR THE PARMLIST
.*                      B) LOG THE VARIOUS AMOUNTS NEEDED BY
.*                         EACH, REMEMBERING THE LARGEST.
.*                      C) GENERATING A DS FOR THE LARGEST AMOUNT.
.*    THE FIRST TWO FUNCTIONS ARE INVOKED BY ALLOC/FREE MACROS ONLY,
.*    AND THE THIRD IS USED BY THE PROGRAMMER, EITHER EXPLICITLY,
.*    OR BY BEGINWKA, IF THE LATTER IS USED.
.*
.*     TO INVOKE THE NAMING FUNCTION, ALLOC/FREE GENERATE
.*     NAME DYNSPACE
.*     NOTE. THE NAMING OPERATION ONLY GENERATES A NAME ON THE
.*     FIRST CALL IN THE ASSEMBLY. THE NAME REMAINS THE SAME UNTIL
.*     DYNSPACE IS CALLED TO EXPAND INTO A DS.
.*
.*     THE SECOND FUNCTION IS INVOKED BY THE MACRO CALL
.*          DYNSPACE ADD
.*     (NO NAME FIELD AND ONE OPERAND)
.*     IT USES THE GLOBAL VARIABLES &DTUO AND &DTUPO TO CALCULATE
.*     THE SPACE FOR THIS REQUEST, AND UPDATES &DYNSPQ ONLY IF THE
.*     CURRENT REQUEST IS FOR A GREATER AMOUNT
.*
.*     THE THIRD FUNCTION IS INVOKED BY CALLING DYNSPACE WITH NO
.*     NAME OR OPERAND FIELD.
.*     THIS EXPANDS INTO A DEFINE STORAGE, CLEARS THE DYNSPACE NAME
.*     GLOBAL SETC, AND THE &DYNSPQ GLOBAL SETA.
.*     THUS, THE MACRO IS SERIALLY REUSABLE IN ALL FUNCTIONS.
.*
         GBLA  &DYNSPQ,&DTUO,&DTUPO,&RCPDYN
         GBLC  &DYNP,&DYNSP
         LCLA  &I
         AIF   ('&NAME' NE '').NAME
         AIF   ('&TYPE' EQ '').ALLOC
.*   THE ACCUMULATE FUNCTION IS REQUIRED
&I       SETA  24+&DTUO+&DTUPO         GET AMOUNT FOR THIS REQUEST
         AIF   (&I LE &DYNSPQ).EXIT    IF CURRENT < MAX, EXIT
&DYNSPQ  SETA  &I                      ELSE UPDATE CURRENT MAXIMUM
         MEXIT
.NAME    AIF   ('&DYNSP' NE '').EXIT   IF NAME ALREADY EXISTS, EXIT
&DYNSP   SETC  'DYNSP&RCPDYN'           ELSE GENERATE A NAME
.EXIT    MEXIT
.ALLOC   AIF   ('&DYNSP' EQ '').EXIT
*
**     RESERVE SPACE FOR ALLOC/FREE MACRO WORK AREA
*
&DYNSP   DS    0F,CL&DYNSPQ            RESERVE SPACE
&DYNSP   SETC  ''                      SET MAX QUANTITY TO 0
&DYNSPQ  SETA 0
         MEND
./ ADD NAME=EXIT     0100-00038-00038-1647-00072-00072-00000-MACRO
         MACRO ,
&NAME    EXIT  &RC=,&IKJRLSA=YES,&R14=
         GBLA  &RCPSWS(10)              ENVIRONMENT SWITCHES
         GBLB  &RCPPPL(2)
         GBLC  &RCPPRE,&RCPWKCS,&RCPWKDS,&RCPSPN
         GBLC  &RCPCLNP
         LCLC  &P
&P       SETC  '&RCPPRE'
         AIF   ('&NAME' EQ '').NONAME
&NAME    DS    0H
.NONAME  AIF   ('&P' EQ '').TRLSA
&P.EXIT  DS    0H
.TRLSA   AIF   (NOT &RCPPPL(1) OR '&IKJRLSA' EQ 'NO').NRLSA
***********************************************************************
**       FREE THE PARSE PDL WORKAREA                                 **
***********************************************************************
         IKJRLSA &P.PDLP
.NRLSA   AIF   ('&RCPWKCS&RCPWKDS' NE '').WAOPT  TEST FOR WORKAREA OPT
         AIF   ('&RC' EQ '(R15)' OR '&RC' EQ '(15)').RET1
         AIF   ('&RC' EQ '0' OR '&RC' EQ '').ZEROREG
         AIF   ('&RC'(1,1) EQ '(').REGRC
         LA    R15,&RC                  LOAD RETURN CODE
         AGO   .RET1
.REGRC   LR    R15,&RC(1)               LOAD RETURN CODE
         AGO   .RET1
.ZEROREG SLR   R15,R15                  RETURN CODE = 0
.RET1    AIF   (&RCPSWS(1) GT 0).RET2 NOSAVE/NOSAVEAREA OPT
         L     R13,4(0,R13)             RESTORE CALLERS SAVE AREA
.RET2    AIF   (&RCPSWS(1) EQ 2).RET3  NOSAVE OPTION
         AIF   ('&R14' NE '').LMR012
         L     R14,12(0,R13)            RESTORE REGISTER  14
.LMR012  LM    R0,R12,20(R13)           RESTORE REGISTERS 0-12
.RET3    AIF   ('&R14' EQ '').RET4
         AIF   ('&R14'(1,1) EQ '(').R14R
         L     R14,&R14                 RESTORE REGISTER  14
         AGO   .RET4
.R14R    LR    R14,&R14(1)              RESTORE REGISTER  14
.RET4    BR    R14                      RETURN TO CALLER
         MEXIT ,
.WAOPT   AIF   ('&RC' EQ '').RCOK
         MNOTE 4,'RC= OPTION INVALID WITH CURRENT BEGIN OPTIONS,'
         MNOTE *,'    USE SETRC MACRO TO SET THE RETURN CODE'
.RCOK    AIF   ('&RCPWKCS' NE '').CSOPT WORK CSECT OPTION
         AIF   (&RCPSWS(2) EQ 1 AND &RCPSWS(3) EQ 0).CSOPT
         L     R15,&P.RCODE             LOAD RETURN CODE
         AIF   (&RCPSWS(2) EQ 2).PROCM   PROC(MAIN) OPT
         LR    R1,R13                   SAVE WORK AREA ADDRESS
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         ST    R15,16(0,R13)            STORE RETURN CODE
         AIF   (&RCPSWS(3) EQ 1).LIFOF      LIFO OPTION
         AGO   .FREE                    WORKAREA TO BE FREED
.CSOPT   L     R15,&P.RCODE             LOAD RETURN CODE
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         L     R14,12(0,R13)            RESTORE REGISTER  14
         LM    R0,R12,20(R13)           RESTORE REGISTERS 0-12
         BR    R14                      RETURN TO CALLER
         MEXIT ,
.FREE    FREEMAIN RU,LV=&P.WKLEN,A=(1),SP=&RCPSPN
         AGO   .LM
.LIFOF   ANOP  ,
*        #FREE A=(R1)                  RETURN WORKAREA TO STACK
         #FREE A=(R1)
         AGO   .LM
.PROCM   L     R1,0(0,R13)              GET MCA ADDRESS
         L     R1,&P.XDS-&P.MCA(,R1)    LOAD DUMMY SECTION ADDR
         L     R13,4(0,R13)             RESTORE CALLER'S SAVE AREA
         ST    R15,16(0,R13)            STORE RETURN CODE
         L     R0,&P.CXD                LOAD WORK AREA LENGTH
         FREEMAIN RU,LV=(0),A=(1),SP=&RCPSPN
.LM      LM    R14,R12,12(R13)          RESTORE THE REGISTERS
         BR    R14                      RETURN TO CALLER
         MEND  ,
./ ADD NAME=EXITWKA  0100-00038-00038-1647-00075-00075-00000-MACRO
         MACRO ,
         EXITWKA
.*
.*   THIS MACRO TERMINATES THE WORKAREA CSECT/DSECT STARTED BY
.*   THE BEGIN MACRO, AND CONTINUED BY THE BEGINWKA MACRO.
.*   IF THE WORK AREA IS GETMAINED BY BEGIN, IT SUPPLIES A
.*   SYMBOLIC EQUATE FOR THE WORKAREA LENGTH, SO BEGIN MACRO KNOWS
.*   HOW BIG AN AREA TO GET.
.*   THE WORKAREA CSECT/DSECT IS ENTERED AND EXITED BY CALLING THE
.*   RCPDS MACRO, WHICH SETS THE GLOBAL SETC VARIABLE &RCPDS TO
.*   THE NAME OF THE PROGRAM CSECT. WITHIN THE PROGRAM CSECT ITSELF,
.*   &RCPDS CONTAINS A NULL VALUE, AND A TEST FOR THIS IS MADE HERE.
.*   IF IT IS NULL, THIS MEANS THAT THE USER DID NOT CODE BEGINWKA,
.*   AND SO BEGINWKA IS INVOKED FOR HIM, BEFORE NORMAL PROCESSING
.*   CONTINUES.
.*   A SECONDARY FUNCTION OF THIS PROGRAM IS TO INVOKE MAPPING MACROS.
.*   EACH MAPPING MACRO HAS A TWO MEMBER GLOBAL BIT ARRAY, BOTH
.*   INITIALLY SET TO ZERO, EG FOR THE ECT, THE GLOBAL VARIABLE IS
.*   &RCPECT(2), FOR DYNALLOC &RCPS99(2), FOR IOPL &RCPIOPL(2).
.*   IF THE FIRST BIT OF THE GLOBAL SETB VARIABLE IS 1, AND THE 2ND
.*   IS ZERO, THE MAPPING MACRO IS INVOKED. THE 2ND BIT IS THEN SET
.*   TO ONE TO PREVENT A FURTHER EXPANSION OF THE MAPPING MACRO WITHIN
.*   THE SAME ASSEMBLY.
.*  A SECOND CALL TO BEGIN WILL CAUSE THE FIRST BIT TO BE SET TO
.*  ZERO, HOWEVER THE SECOND BIT WILL BE LEFT UNALTERED.
.*
.*  GLOBAL SWITCHES FOR THE ECT, UPT, PSCB, DYNALLOC DSECTS, AND LSD
         GBLB  &RCPECT(2),&RCPUPT(2),&RCPPSCB(2),&RCPS99(2)
         GBLB  &RCPLSD(2)
         GBLA  &RCPSWS(10)              ENVIRONMENT SWITCHES
.*   GLOBAL VARIABLES FOR THE CURRENT BEGIN PREFIX, WORKAREA DSECT
.*   NAME, AND PROGRAM CSECT NAME.
         GBLC  &RCPPRE,&RCPWKDS,&RCPDS,&RCPWKCS
         LCLC  &P,&CS
         AIF   ('&RCPDS' NE '').START
         BEGINWKA ,
.START   AIF   (&RCPSWS(1) GT 0).NOWK
&CS      SETC  '&RCPDS'                 PROGRAM CSECT
         AIF   ('&RCPWKDS&RCPWKCS' EQ '').RCPDS
         DS    0D                       ALIGN TO DOUBLEWORD
&P       SETC  '&RCPPRE'
&P.WKLEN EQU   *-&RCPWKDS&RCPWKCS       LENGTH OF WORK AREA
         AIF   ('&RCPWKDS&RCPWKCS' NE '&RCPWKCS').RCPDS
&P.DSEC  DSECT ,
         DS    CL(&P.WKLEN)             GEN LENGTH FOR QCON
.RCPDS   RCPDS ,
         EJECT ,
.NOWK    AIF   (NOT &RCPECT(1) OR &RCPECT(2)).TRYUPT
         IKJECT ,
L#ECT    EQU   *-ECT                    LENGTH OF ECT
&CS      CSECT ,                        REENTER MAIN CSECT
         EJECT ,
&RCPECT(2) SETB 1
.TRYUPT  AIF   (NOT &RCPUPT(1) OR &RCPUPT(2)).TRYPSCB
         #IKJUPT ,
L#UPT    EQU   *-UPT                    LENGTH OF USER PROFILE TABLE
&CS      CSECT ,                        REENTER MAIN CSECT
         EJECT ,
&RCPUPT(2) SETB 1
.TRYPSCB AIF   (NOT &RCPPSCB(1) OR &RCPPSCB(2)).TRYS99
         #IKJPSCB ,
L#PSCB   EQU   *-PSCB                   LENGTH OF PSCB
&CS      CSECT ,                        REENTER MAIN CSECT
         EJECT ,
&RCPPSCB(2) SETB 1
.TRYS99  AIF   (NOT &RCPS99(1) OR &RCPS99(2)).TRYLSD
         #DSECTS ALLOC,TYPE=DEFER
&RCPS99(2) SETB 1
.TRYLSD  AIF   (NOT &RCPLSD(1) OR &RCPLSD(2)).TRYREST
         IKJLSD ,
L#LSD    EQU   *-LSD                    LENGTH OF LSD
&CS      CSECT ,                        REENTER MAIN CSECT
         EJECT ,
&RCPLSD(2) SETB 1
.TRYREST MEND  ,
./ ADD NAME=FREE     0100-00038-00038-1647-00134-00134-00000-MACRO
         MACRO
&NAME    FREE  &UNALC,&DSN=,&DDN=,&MEMBER=,&DISP=,                     X
               &ERROR=,&MF=AUTO,&PREFIX=,&FILE=,&F=,&DA=,&HOLD=
         GBLA  &RCPDYN            COUNTER FOR NO ENTRIES TO MACRO
         GBLA  &DTUO              OFFSET TO TEXT UNITS
         GBLA  &DTUPO             OFFSET TO TEXT UNIT POINTERS
         GBLB  &RCPS99(2)         TELL RCPDSECT NEED DSECTS
         GBLC  &DYNP              PREFIX FOR LABELS FOR THIS CALL
         GBLC  &DYNSP         NAME FOR AUTOMATIC STORAGE ALLOC
         LCLB  &DSECT             DSECT NEEDED FOR STORAGE, MF=E
         LCLC  &C,&T,&PAR
&RCPS99(1)     SETB           1
&RCPDYN  SETA  &RCPDYN+1          INCEREMENT COUNTER
&DYNP    SETC  'DYN&RCPDYN' SET DEFAULT PREFIX
         AIF   ('&NAME' EQ '').NONAME  SKIP IF NO NAME
&NAME    DS    0H
.NONAME  ANOP  ,
         AIF   ('&PREFIX' EQ '').TMF
         AIF   (K'&PREFIX LT 4).POK
         MNOTE 4,'PREFIX TOO LONG, 1ST 4 CHARS USED'
&DYNP    SETC  '&PREFIX'(1,4)
         AGO   .TMF
.POK     ANOP
&DYNP    SETC  '&PREFIX'
.TMF     AIF   ('&MF(1)' EQ 'G').GEN
         AIF   ('&MF' NE 'AUTO').TMFE
NAME     DYNSPACE             GET NAME FOR SPACE
         LA    R1,&DYNSP               LOAD ADDRESS OF PARAM LIST
         USING &DYNP.DS,R1             USE GENERATED DSECT
&T       SETC  'A'
&PAR     SETC  '&DYNSP+4'
&DSECT   SETB  1
         AGO   .START
.TMFE    AIF   ('&MF(2)' NE '').E2OK
         MNOTE 4,'PLIST ADDRESS OMITTED, MF=G USED'
         AGO   .GEN
.E2OK    ANOP
&DSECT   SETB  1
         AIF   ('&MF(2)' EQ '(').RMFE
         LA    R1,&MF(2)               LOAD PARAM LIST ADDRESS
&T       SETC  'A'
&PAR     SETC  '&MF(2)+4'
         USING &DYNP.DS,R1             USE GENERATED DSECT
         AGO   .START
.RMFE    AIF   ('&MF(2)' EQ '(R1)' OR '&MF(2)' EQ '(1)').START
&PAR     SETC  '&MF(2)'(2,K'&MF(2)-2)
&T       SETC  'R'
         LR    R1,&PAR                 LOAD S99 PARAM LIST ADDRESS
&PAR     SETC  '4&MF(2)'
         USING &DYNP.DS,R1             USE GENERATED DSECT
         AGO   .START
.GEN     LA    R1,&DYNP.RBP            LOAD ADDRESS OF S99 RBP
&T       SETC  'A'
&PAR     SETC  '&DYNP.RB'
.START   LA    R15,&DYNP.RB            LOAD ADDRESS OF S99 RB
         USING S99RB,R15
         ST    R15,0(R1)               AND STORE IN RB POINTER
         XC    4(&DYNP.LEN-4,R1),4(R1) ZERO PARAMETER LIST
         MVI   S99RBLN,20              MOVE IN LIST LENGTH
         MVI   S99VERB,S99VRBUN        MOVE IN VERB CODE
         LA    R14,&DYNP.TUP           LOAD ADDRESS OF TU POINTERS
         ST    R14,S99TXTPP            STORE ADDRESS IN S99 RB
         LA    R15,&DYNP.TU            POINT TO SPACE FOR TEXT UNITS
         USING S99TUNIT,R15
&DTUO    SETA  0
&DTUPO   SETA  0
         AIF   ('&DSN&DA' NE '').DSN
.TDDN    AIF   ('&DDN&FILE&F' NE '').DDN
.TDISP   AIF   ('&DISP' NE '').DISP
.TUNALC  AIF   ('&UNALC' NE '').PERM
.THOLD   AIF   ('&HOLD' NE '').HOLD
         AGO   .SVC99
.DSN     RCPFDSN &DSN&DA,&MEMBER
         AGO   .TDDN
.DDN     RCPFDDN &DDN&F&FILE
         AGO   .TDISP
.DISP    RCPFDISP &DISP
         AGO   .TUNALC
.PERM    RCPUNALC
         AGO   .THOLD
.HOLD    RCPFHOLD &HOLD
.SVC99   ANOP
&DTUPO   SETA  &DTUPO-4
         SPACE
         MVI   &DYNP.TUP+&DTUPO,X'80'  SET HIGH ORDER BIT ON TEXT PTRS
         MVI   &DYNP.RBP,X'80'         SET HIGH ORDER BIT ON RB PTR
         RCPSR2 UNSAVE
&DTUPO   SETA  &DTUPO+4
         AIF   (NOT &DSECT).DYNA
         DROP  R1,R15                  DEACTIVATE ADDRESSABILITY
.DYNA    ANOP
*        DYNALLOC                      CALL DYNAMIC ALLOCATION
         DYNALLOC
         AIF   ('&ERROR' EQ '').RESERVE
         AIF   ('&PAR' EQ '').LTR
         L&T   R14,&PAR                 LOAD REG 14 WITH ADDRESS OF RB
         AIF   (NOT &DSECT).LTR
         USING &DYNP.RB,R14            SET UP ADDRESSABILITY
.LTR     LTR   R15,R15                 TEST RETURN CODE
         BNZ   &ERROR                  BRANCH IF NON ZERO
**       NOTE.  R14 POINTS TO REQUEST BLOCK, R15 HAS RETURN CODE     **
.RESERVE AIF   (&DSECT).RESDS
         SPACE
***********************************************************************
**       RESERVE SPACE FOR DYNALLOC DATA                             **
***********************************************************************
         RCPDS
.SSP     ANOP
&DYNP.RBP DS   F                       SVC 99 REQ BLOCK POINTER
&DYNP.RB  DS   5F                      SVC 99 REQUEST BLOCK
&DYNP.TUP DS   CL&DTUPO                SPACE FOR TEXT POINTERS
         AIF   (&DTUO EQ 0).DTU11
&DYNP.TU  DS   CL&DTUO                 SPACE FOR TEXT UNITS
         AGO   .DTU10
.DTU11   ANOP
&DYNP.TU  DS   0C                      NO SPACE NEEDED FOR TEXT UNITS
.DTU10   ANOP
&DYNP.LEN EQU  *-&DYNP.RBP             LENGTH OF SPACE USED
         AIF   (&DSECT).DSP
         RCPDS
         SPACE 3
         AGO   .EXIT
.RESDS   ANOP
         AIF   ('&DYNSP' EQ '').SP3
         DYNSPACE ADD
.SP3     SPACE
&DYNP.DS DSECT                         DSECT TO MAP SVC 99 DATA
         AGO   .SSP
.DSP     AIF   ('&MF(3)' EQ '').END1
&MF(3)   EQU   &DYNP.LEN               LENGTH OF AREA
.END1    ANOP
&SYSECT  CSECT
         SPACE 3
.EXIT    MEND
./ ADD NAME=IDAAMDSB 0100-00038-00038-1647-00085-00085-00000-MACRO
         MACRO ,
         IDAAMDSB
*---------------------------------------------------------------------*
* THE AMDSB CONTAINS STATISTICAL INFORMATION ABOUT RECORD PROCESSING  *
* IN THE DATASET.  IT ALSO CONTAINS SOME OF THE DATASET'S ATTRIBUTES  *
* AND SPECIFICATIONS.  THE AMDSB IS BUILT USING THE DATASET OR INDEX  *
* CATALOG RECORD'S AMDSB SET OF FIELDS, WHEN THE CLUSTER IS OPENED.   *
* A COPY OF THE AMDSB IS CONTAINED IN THE DATASET'S DATA CATALOG      *
* RECORD AND, IF THE DATASET IS KEY-SEQUENCED, IN THE INDEX CATALOG   *
* RECORD.  THE DATA OR INDEX AMB (AMBDSB) POINTS TO ITS ASSOCIATED    *
* AMDSB.                                                              *
*---------------------------------------------------------------------*
IDAAMDSB DSECT ,
AMDSB    EQU   *
AMDSBID  DS    X            AMDSB IDENTIFIER, X'60'.
AMDATTR  DS    X            ATTRIBUTES OF THE DATASET:
AMDDST   EQU   B'10000000'  KEY SEQUENCED DATASET.
AMDWCK   EQU   B'01000000'  CHECK EACH RECORD WHEN IT IS WRITTEN.
AMDSDT   EQU   B'00100000'  SEQUENCE SET IS STORED WITH THE DATA AND IS
*                           REPLICATED - DUPLICATED AS MANY TIMES AS
*                           POSSIBLE AROUND THE TRACK.
AMDREPL  EQU   B'00010000'  ALL INDEX RECORDS ARE REPLICATED -
*                           DUPLICATED AS MANY TIMES AS POSSIBLE AROUND
*                           THE TRACK.
AMDORDER EQU   B'00001000'  USE THE VOLUMES IN THE SAME ORDER AS IN THE
*                           VOLUME LIST.
AMDRANGE EQU   B'00000100'  THE DATASET IS DIVIDED INTO KEY RANGES.
AMDRRDS  EQU   B'00000010'  RELATIVE RECORD DATASET.
AMDSPAN  EQU   B'00000001'  DATASET CONTAINS SPANNED RECORDS.
AMDLEN   DS    H            LENGTH OF AMDSB.
AMDNEST  DS    0H           NO OF ENTRIES IN THE INDEX SECTION.
AMDAKRKP DS    H            RELATIVE KEY POSITION OF THE ALTERNATE KEY.
AMDRKP   DS    H            RELATIVE KEY POSITION.
AMDKEYLN DS    H            KEY LENGTH.
AMDPCTCA DS    X            PERCENT OF FREE CONTROL INTERVALS IN THE
*                           CONTROL AREA.
AMDPCTCI DS    X            PERCENT OF FREE BYTES IN THE CONTROL
*                           INTERVAL.
AMDCIPCA DS    H            NUMBER OF CONTROL INTERVALS IN A CONTROL
*                           AREA.
AMDFSCA  DS    H            NUMBER OF FREE CONTROL INTERVALS IN A
*                           CONTROL AREA.
AMDFSCI  DS    XL4          NUMBER OF FREE BYTES PER CONTROL INTERVAL.
AMDCINV  DS    F            CONTROL INTERVAL SIZE.
AMDLRECL DS    F            MAXIMUM RECORD SIZE.
AMDHLRBA DS    0F           RELATIVE BYTE ADDRESS (RBA) OF THE HIGH-
*                           LEVEL INDEX RECORD (KSDS).
AMDNSLOT DS    F            NUMBER OF RECORD SLOTS PER CONTROL INTERVAL
*                           (RRDS).
AMDSSRBA DS    0F           RELATIVE BYTE ADDRESS (RBA) OF THE FIRST
*                           SEQUENCE-SET RECORD (KSDS).
AMDMAXRR DS    F            MAXIMUM VALID RELATIVE RECORD NUMBER(RRDS).
AMDPARDB DS    F            ADDRESS OF THE TO FIRST ARDB
AMDATTR3 DS    X            ATTRIBUTES:
AMDUNQ   EQU   B'10000000'  THE DATASET HAS NONUNIQUE KEYS.
AMDFAULT EQU   B'01000000'  THE DATASET IS STAGED BY CYLINDER FAULT.
AMDBIND  EQU   B'00100000'  THE DATASET IS STAGED AND BOUND.
AMDWAIT  EQU   B'00010000'  THE DATASET DESTAGING IS COMPLETED BEFORE
*                           CONTROL IS RETURNED TO THE PROGRAM THAT
*                           CLOSES THE DATASET.
AMDLM    EQU   B'00001000'  THE DATASET IS LOADED.
AMDLDS   EQU   B'00000100'  LINEAR DATASET                         @LCA
*        EQU   B'00000011'  RESERVED                               @LCC
AMDSTRNO DS    X            NUMBER OF CONCURRENT REQUESTS.
AMDDUI   DS    CL4          RESERVEIMS DBRC USAGE INDICATOR
AMDBFNO  DS    XL2          NUMBER OF DATA OR INDEX BUFFERS.
AMDSTAT  DS    0XL48        DATASET STATISTICS:
AMDSTSP  DS    XL8          OS/VS SYSTEM TIME STAMP.
AMDNIL   DS    H            NUMBER OF INDEX LEVELS
AMDNEXT  DS    H            NUMBER OF EXTENTS IN THE DATASET.
AMDNLR   DS    F            NUMBER OF USER-SUPPLIED RECORDS IN THE
*                           DATASET.
AMDDELR  DS    F            NUMBER OF DELETED RECORDS.
AMDIREC  DS    F            NUMBER OF INSERTED RECORDS.
AMDUPR   DS    F            NUMBER OF UPDATED RECORDS.
AMDRETR  DS    F            NUMBER OF RETRIEVED RECORDS.
AMDASPA  DS    F            NUMBER OF BYTES OF FREE SPACE IN THE
*                           DATASET.
AMDNCIS  DS    F            NUMBER OF TIMES A CONTROL INTERVAL WAS
*                           SPLIT.
AMDNCAS  DS    F            NUMBER OF TIMES A CONTROL AREA WAS SPLIT.
AMDEXCP  DS    F            NUMBER OF TIMES EXCP WAS ISSUED BY VSAM I/O
*                           ROUTINES.
AMDSBLEN EQU   *-AMDSB
         MEND  ,
./ ADD NAME=IEFZB4D5 0100-00038-00038-1647-00015-00015-00000-MACRO
         MACRO
&N       IEFZB4D5
DSABQDB  DSECT
DSQDBID  DS    CL4'DSAB'                ID
DSQATTRS DS    XL2                      QUEUING ATTRIBUTES
DSQDBLN  DS    AL2                      QDB LENGTH
DSQNELMS DS    F                        NUMBER OF ELEMENTS ON QUEUE
DSQFRSTP DS    F                        PTR TO 1ST DSAB
DSQBADBC EQU   128                      BACKWARD CHAIN IS INCORRECT
DSQLASTP DS    F                        PTR TO LAST DSAB
DSQBADFC EQU   128                      FORWARD CHAIN IS INCORRECT
DSQFDSP  DS    AL2                      DISP OF FWD PTR INTO DSAB
DSQBDSP  DS    AL2                      DISP OF BACK PTR INTO DSAB
         DS    F                        NOT USED
         MEND
./ ADD NAME=IEFZB421 0100-00038-00038-1647-00111-00111-00000-MACRO
         MACRO
         IEFZB421
*/********************************************************************/
*/*                                                                  */
*/*                                                                  */
*/* NAME -  IEFZB421                                                 */
*/*                                                                  */
*/* DESCRIPTIVE NAME - ELIGIBLE DEVICES TABLE MAPPING MACRO          */
*/*                                                                  */
*/* COPYRIGHT - 5740-XC6 COPYRIGHT IBM CORP. 1981            @G860P2P*/
*/*             LICENSED MATERIAL - PROGRAM,                 @G860P2P*/
*/*             PROPERTY OF IBM, REFER TO COPYRIGHT          @G860P2P*/
*/*             INSTRUCTIONS FORM G120-2083                  @G860P2P*/
*/*                                                                  */
*/* STATUS  -  OS/VS2 HBB2102                                @G860P2P*/
*/*                                                                  */
*/* FUNCTION -                                                       */
*/*   THE ELIGIBLE DEVICES TABLE (EDT) IS USED BY DEVICE ALLOCATION  */
*/*   TO ASSOCIATE UNIT DESCRIPTION INFORMATION WITH DEVICE TYPES    */
*/*   AND DEVICES. IT IS ALSO USED TO DETERMINE THE GROUPS OF DEVICES*/
*/*   FOR WHICH A PARTICULAR REQUEST IS ELIGIBLE.                    */
*/*                                                                  */
*/*   THE TABLE IS CREATED AT SYSGEN AND THE INFORMATION IS PLACED IN*/
*/*   THE SETS OF SUBTABLES WHICH MAKE UP THE EDT. A HEADER PORTION  */
*/*   OF THE EDT CONTAINS A POINTER TO THE HEADERS OF EACH SET       */
*/*   OF SUBTABLES.                                                  */
*/*                                                                  */
*/* CHANGE ACTIVITY - Y02670, G64QPSJ, G860P2P               @G860P2P*/
*/*                                                                  */
*/* NOTE -                                                           */
*/*    THE ELIGIBLE DEVICE TABLE IS A CSECT IN THE LOAD MODULE       */
*/*    IEFEDTTB IN SYS1.LPALIB.  THE ADDRESS OF THE EDT MAY BE FOUND */
*/*    AT ANY TIME IN FIELD JESEDT OF THE JESCT VIA THE CVT .        */
*/*    THE EDT MAY ALSO BE FOUND VIA LOAD EP=IEFEDTTB                */
*/*                                  ST   R0,@EDTTAB                 */
*/********************************************************************/
*
EDTHDR   DSECT ,JESEDT       ***** HEADER SECTION
EDTLUVSP DS    A                   PTR TO LOOK-UP-VALUE SECTION
EDTGENSP DS    A                   PTR TO GENERIC SECTION
EDTGRPSP DS    A                   PTR TO GROUP SECTION
EDTUCBSP DS    A                   PTR TO DEVICE NBR SECTION @G860P2P
EDTMSKTP DS    A                   PTR TO GROUP MASK TABLE
         DS    A                   RESERVED                  @G64QPSJ
EDTPREFP DS    A                   PTR TO PREFERENCE TABLE   @G64QPSJ
EDTID    DS    CL8                 EDT ID                    @G64QPSJ
EDTDATE  DS    CL8                 EDT CREATE DATE           @G64QPSJ
EDTTIME  DS    CL5                 EDT CREATE TIME           @G64QPSJ
         DS    CL3                 RESERVED                  @G64QPSJ
EDTNAME  DS    C'EDT'              'EDT' IDENTIFIER          @G860P2P
EDTLEVEL DS    C'1'                EDT LEVEL                 @G860P2P
*
LUVSECT  DSECT ,EDTLUVSP     ***** LOOK-UP-VALUE SECTION
LUVHDR   DS    0D
LUVENTNO DS    F                   NO. OF ENTRIES
LUVENTLN DS    F                   SIZE OF EACH ENTRY
LUVENTRY DSECT , 1ST AT LUVHDR+8
UNITNAME DS    CL8                 UNIT NAME - IN EBCDIC
LUVALUE  DS    XL4                 LOOK-UP-VALUE FOR UNITNAME
LUVGMTP  DS    A                   PTR TO GROUP MASK TABLE ENTRY
LUVGENNO DS    F                   NO. OF GENERICS IN THIS UNITNAME
LUVGENP  DS    A                   PTR TO FIRST GENERIC FOR THIS L-U-V
LUVFLAGS DS    B                   FLAGS
LUVVAM   EQU   128                 ELIGIBLE FOR VIO DATASETS
LUVAGMSK EQU   64                  AN ALTERNATE GROUP MASK POINTER     X
                                   EXISTS IN THIS ENTRY
LUVMGENS EQU   32                  ALLOCATION OF MULITIPLE GENERICS    X
                                   WITHIN THIS L-U-V IS VALID
LUVGENR  EQU   16                  NAME IS A GENERIC           @G860P2P
LUVESOTR EQU   16                  NAME IS AN ESOTERIC         @G860P2P
LUVGGENR EQU   16                  NAME IS A GENERATED GENERIC @G860P2P
         DS    BL3
LUVAGMTP DS    A                   ADDR OF ALTERNATE GROUP MASK
*
GENSECT  DSECT ,EDTGENSP     ***** GENERIC SECTION
GENHDR   DS    0D
GENENTNO DS    F                   NO. OF ENTRIES
GENENTLN DS    F                   SIZE OF AN ENTRY
GENENTRY DSECT ,
GENDEVT  DS    XL4                 GENERIC DEVICE TYPE
GENGRPNO DS    F                   NO. OF GROUPS FOR DEVICE TYPE
GENGRPTR DS    A                   PTR TO GROUP ENTRY PTR IN GROUP PTR
*
GRPTRTAB DSECT ,             ***** GROUP POINTER TABLE
GRPTR    DS    F                   PTR TO GROUP SECTION ENTRY
*
GRPSECT  DSECT ,EDTGRPSP     ***** GROUP SECTION
GRPHDR   DS    0D
GRPENTNO DS    F                   NO. OF ENTRIES (NO. OF GROUPS)
GRPENTLN DS    F                   SIZE OF AN ENTRY
GRPENTRY DSECT ,
GRPID    DS    H                   GROUP IDENTIFIER            @G860P2P
GRPUCBNO DS    H                   NO. OF DEVICES IN GROUP     @G860P2P
GRPUCBI  DS    H                   INDEX INTO DEVICE NUMBER    @G860P2PX
                                   SECTION FOR EACH ENTRY FOR  @G860P2PX
                                   THIS GROUP
*
EUCBSECT DSECT ,EDTUCBSP     ***** DEVICE NUMBER SECTION       @G860P2P
EUCBHDR  DS    0D
EUCBENNO DS    F                   NO. OF ENTRIES
EUCBENLN DS    F                   SIZE OF AN ENTRY
EUCBENTY DSECT ,GRPUCBP
EUCBTPOS DS    CL3                 LIST OF DEVICE NUMBERS      @G860P2P
*
GRMSKTAB DSECT ,EDTMSKTP     ***** GROUP MASK TABLE
GMTHDR   DS    0D
GMTENTNO DS    F                   NO. OF ENTRIES
GMTENTLN DS    F                   SIZE OF AN ENTRY
GMTENTRY DSECT ,LUVGMTP
GRPMASK  DS    B                   BIT MASK
         MEND
./ ADD NAME=IEFZB461 0100-00038-00038-1647-00043-00043-00000-MACRO
         MACRO
         IEFZB461
*/********************************************************************/
*/*                                                                  */
*/*                                                                  */
*/* NAME -  IEFZB461                                                 */
*/*                                                                  */
*/* DESCRIPTIVE NAME - UCB POINTER LIST                              */
*/*                                                                  */
*/* COPYRIGHT - 5740-XC6 COPYRIGHT IBM CORP. 1981                    */
*/*             LICENSED MATERIAL - PROGRAM,                         */
*/*             PROPERTY OF IBM, REFER TO COPYRIGHT                  */
*/*             INSTRUCTIONS FORM G120-2083                          */
*/*                                                                  */
*/* STATUS  -  OS/VS2 HBB2102                                        */
*/*                                                                  */
*/* FUNCTION -                                                       */
*/*   THIS MACRO MAPS THE ADDRESSES OF THE DEVICES WHICH CORRESPOND  */
*/*   TO THE DEVICE ADDRESSES IN THE ELIGIBLE DEVICE TABLE (EDT).    */
*/*   THE GROUP SECTION OF THE EDT CONTAINS THE INDEX TO THE FIRST   */
*/*   DEVICE ASSOCIATED WITH THE DEVICE GROUP AND THE NUMBER OF      */
*/*   CONSECUTIVE DEVICES IN THAT GROUP.                             */
*/*   THE TABLE IS CREATED AT SYSGEN AND THE INFORMATION IS PLACED IN*/
*/*   THE SETS OF SUBTABLES WHICH MAKE UP THE EDT. A HEADER PORTION  */
*/*   OF THE EDT CONTAINS A POINTER TO THE HEADERS OF EACH SET       */
*/*   OF SUBTABLES.                                                  */
*/*                                                                  */
*/* CHANGE ACTIVITY - G860P2P                                        */
*/*                                                                  */
*/* INVOCATION - BAL - SPECIFY IEFZB461 MACRO                        */
*/*                                                                  */
*/********************************************************************/
*
         SPACE 2
UPL      DSECT ,                 UCB POINTER LIST MAPPING
UPLHDR   EQU   UPL               HEADER SECTION FIRST
UPLID    DS    CL4               CHAR('UPL ')
UPLNO    DS    F                 NUMBER OF ENTRIES
UPLRSV01 DS    F                 * RESERVED
UPLRSV02 DS    F                 * RESERVED
UPLUCBL  EQU   *                 START OF UCB POINTER ENTRIES
UPLUCBA  DS    F                 UCB POINTER ENTRY
         MEND  ,
./ ADD NAME=IEZCAML  0100-00038-00038-1647-00052-00052-00000-MACRO
         MACRO ,
         IEZCAML
CAMLSTD  DSECT ,
CAMOPTN1 DS    B                   FIRST OPTION BYTE
CAMCVOL  EQU   B'10000000'         - CVOL SPECIFIED
CAMNUCAM EQU   B'01000100'         - CAMLST MACRO GENERATED-NOT USED
CAMCAT   EQU   B'00100000'         - CATALOG OR CATBX SPECIFIED
CAMRECAT EQU   B'00010000'         - RECAT (RE-CATALOG SPECIFIED)
CAMUNCAT EQU   B'00001000'         - UNCAT OR UCATDX SPECIFIED
CAMLOCAT EQU   B'00000010'         - LOCATE BY TTR SPECIFIED
CAMBLOCK EQU   B'00000010'         - LOCATE BY BLOCK SPECIFIED
*              B'00000001'         - RESERVED
*
CAMOPTN2 DS    B                   SECOND OPTION BYTE
CAMNOALC EQU   B'10000000'         - DO NOT ALLOCATE CVOL
CAMBLDX  EQU   B'01000000'         - BLDX / CATBX SPECIFIED
CAMBLDG  EQU   B'00100000'         - BLDG SPECIFIED
CAMBLDA  EQU   B'00010000'         - BLDA SPECIFIED
CAMLNKX  EQU   B'00001000'         - LNKX SPECIFIED
CAMDLTX  EQU   B'00000100'         - DLTX / UCATDX SPECIFIED
CAMDSCB  EQU   B'00000010'         - DSCB TTR SPECIFIED
CAMDSCBT EQU   B'00000010'         - DSCB TTR SPECIFIED
CAMDLTA  EQU   B'00000001'         - DLTA SPECIFIED
*
CAMOPTN3 DS    B                   THIRD OPTION BYTE
CAMDRPX  EQU   B'10000000'         - DRPX SPECIFIED
CAMDELET EQU   B'01000000'         - INDICATE DELETE OPTION
CAMRENAM EQU   B'00100000'         - RENAME SPECIFIED
CAMTIOT  EQU   B'00010000'         - SYSZTIOT IS ENQUEUED EXCLUSIVELY
CAMEMPTY EQU   B'00001000'         - INDICATE THE EMPTY OPTION
CAMSLOCB EQU   B'00000100'         - SUPERLOCATE WITH BASE SUPPLIED
CAMSLOC  EQU   B'00000010'         - SUPERLOCATE
*              B'.......0'         - THE CALLER SUPPLIED A CAMLST
CAMAM0   EQU   B'00000001'         - THE CALLER SUPPLIED A CTGPL
*
CAMGEN   DS    X                   MAXIMUM GENERATION COUNT FOR GDG
*
CAMPTR1  DS    A                   ADDRESS OF NAME OR TTR IF LOCATE
*
CAMPTR2  DS    0A                  ADDRESS OF CVOL VOLSER
CAMCVOLP DS    A                   CVOL VOLUME SERIAL ADDRESS
*
CAMPTR3  DS    A                   A) CATLG VOLUME LIST
*                                  B) ALIAS/HIGH LEVEL INDEX
*                                  C) LNKX DEVTYPE/VOLSER
*                                  D) LOCATE WORK AREA
*
CAMPTR4  DS    0A                  ADDRESS OF DSCB TTR FOR CATLG
CAMDSCBP DS    A                   DSCB TTR ADDRESS
*
CAMLEN   EQU   *-CAMLSTD           DATA LENGTH
         MEND  ,
./ ADD NAME=IEZCTGFL 0100-00038-00038-1647-00124-00124-00000-MACRO
*  %GO TO CTGFLX01;
*  /*
         MACRO
         IEZCTGFL ,
CTGFL    DSECT ,                        */
*%CTGFLX01:;
*/********************************************************************/
*/*                                                                  */
*/*   MACRO NAME = IEZCTGFL                                          */
*/*                                                                  */
*/*   DESCRIPTIVE NAME = CATALOG FIELD PARAMETER LIST                */
*/*                                                                  */
*/*   FUNCTION = THE FIELD PARAMETER LIST (CTGFL) DEFINES ONE OF     */
*/*              THE CATALOG RECORD'S FIELDS OR A GROUP OF           */
*/*              LOGICALLY RELATED FIELDS.  THE CTGFL IS BUILT       */
*/*              BEFORE AN OS/VS COMPONENT ISSUES THE CATLG          */
*/*              MACRO INSTRUCTION (SVC 26) TO PROCESS A             */
*/*              CATALOG RECORD.  THE CTGFL IS USED IN TWO           */
*/*              SITUATIONS:                                         */
*/*                (1)  IT IDENTIFIES CATALOG RECORD INFORMATION     */
*/*                     TO RETRIEVE OR UPDATE.  THE CTGPL CONTAINS   */
*/*                     THE ADDRESS OF EACH CTGFL USED IN THIS WAY.  */
*/*                (2)  IT IDENTIFIES CATALOG RECORD INFORMATION     */
*/*                     TO COMPARE AGAINST CALLER-SUPPLIED DATA.     */
*/*                     THIS IS A "TEST" CTGFL AND IS ADDRESSED BY   */
*/*                     ANOTHER CTGFL.                               */
*/*                                                                  */
*/*   CONTROL BLOCK STRUCTURE = THE CTGFL IS POINTED TO BY THE       */
*/*                             CCA ('CCAFLPT' OR 'CCATEST').        */
*/*                                                                  */
*/*   INCLUDED MACROS = NONE                                         */
*/*                                                                  */
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */
*/*                                                                  */
*/*   STATUS = VS/2 RELEASE 3   (CHANGE FLAG @Y30SSXX)               */
*/*                                                                  */
*/*   DATE OF LAST CHANGE = 17 JUL 74                                */
*/*                                                                  */
*/********************************************************************/
         AGO   .CTGFL01                 */
*%DECLARE (CTGFLLEN, CTGFL999, CTGFLLVL) CHAR;
*%CTGFLLEN = 'LENGTH(CTGFL)';       /* LENGTH OF CTGFL               */
*%GOTO CTGFLX03;
* /*
*%CTGFLX03:;
*%IF CTGFL999 ^= ','                /* IF BLOCK NOT CONTINUED,       */
*  %THEN %CTGFL999 = ';';           /*   THEN CLOSE DECLARE STMNT    */
*%IF CTGFLLVL  = ''                 /* IF BLOCK NOT CONCATENATED,    */
*  %THEN %GOTO CTGFL001;            /*   THEN GENERATE DECLARE       */
*%CTGFLDUM = CTGFLLVL' CTGFL';    /* SET MINOR LEVEL NUMBER        */
*   CTGFLDUM                        /* CTGFL CONCATENATED LEVEL      */
*%GOTO CTGFL002;                    /* SKIP DECLARE                  */
*%CTGFL001:;                        /* DECLARE                       */
    DECLARE
*     1 CTGFL BASED(CTGFLPTR)       /* DECLARE CTGFL LEVEL ONE       */
*%CTGFL002:;                        /* SKIP DECLARE                  */
*        BDY(WORD),                 /* WORD BOUNDARY                 */
*       5 CTGFLDNO PTR(8),          /* NO. PAIRS DATA LENGTH/ADDR    */
*       5 CTGFLDCD BIT(8),          /* TEST CONDITION                */
*       5 CTGFLDGC PTR(8),          /* GROUP CODE NUMBER             */
*       5 CTGFLDRE BIT(8),          /* TEST RESULT                   */
*         10 *        BIT(7),       /* RESERVED                      */
*         10 CTGFLDTS BIT(1),       /* 0 = SUCCESSFUL TEST,          */
*                                   /* 1 = TEST FAILED               */
*       5 CTGFLDWA BIT(32),         /* CATALOG WORK AREA             */
*       5 CTGFLDNM PTR(31),         /* FIELD NAME ADDRESS            */
*       5 CTGFLCHN PTR(31),         /* ADDR OF NEXT FIELD MACRO      */
*                                   /* OR ZERO                       */
*       5 CTGFLDAT(*),              /* PAIRS OF DATA LENGTH/ADDR     */
*         10 CTGFLNG FIXED(31),     /* DATA LENGTH                   */
*         10 CTGFLPT  PTR(31) CTGFL999 /* DATA ADDRESS               */
*/********************************************************************/
*/*     CONSTANTS USED TO SET AND/OR TEST FIELDS DECLARED ABOVE      */
*/********************************************************************/
    DECLARE                         /* TEST CONDITION - CTGFLDCD     */
      CTGFLDEQ BIT(8) CONSTANT('80'X), /* EQUAL                      */
      CTGFLDNE BIT(8) CONSTANT('60'X), /* NOT EQUAL                  */
      CTGFLDGT BIT(8) CONSTANT('20'X), /* GREATER THAN               */
      CTGFLDLT BIT(8) CONSTANT('40'X), /* LESS THAN                  */
      CTGFLDGE BIT(8) CONSTANT('A0'X), /* GREATER THAN OR EQUAL      */
      CTGFLDLE BIT(8) CONSTANT('C0'X), /* LESS THAN OR EQUAL         */
      CTGFLDZ  BIT(8) CONSTANT('80'X), /* TEST UNDER MASK FOR ZEROES */
      CTGFLDON BIT(8) CONSTANT('10'X), /* TEST UNDER MASK FOR ONES   */
      CTGFLDMX BIT(8) CONSTANT('40'X); /* TEST UNDER MASK FOR MIXED  */
* %GO TO CTGFLX02;
*/*
.CTGFL01 ANOP
*
CTGFLDNO DS    XL1                      NUMBER PAIRS DATA LNG/ADDR
*
CTGFLDCD DS    XL1                      TEST CONDITION
CTGFLDEQ EQU   X'80'                    EQUAL
CTGFLDNE EQU   X'60'                    NOT EQUAL
CTGFLDGT EQU   X'20'                    GREATER THAN
CTGFLDLT EQU   X'40'                    LESS THAN
CTGFLDGE EQU   X'A0'                    GREATER THAN OR EQUAL
CTGFLDLE EQU   X'C0'                    LESS THAN OR EQUAL
CTGFLDZ  EQU   X'80'                    TEST UNDER MASK FOR ZEROES
CTGFLDON EQU   X'10'                    TEST UNDER MASK FOR ONES
CTGFLDMX EQU   X'40'                    TEST UNDER MASK FOR MIXED
CTGFLDGF EQU   X'FF'                    GENERIC FILTER TEST        @SCA
*
CTGFLDGC DS    XL1                      GROUP CODE NUMBER
*
CTGFLDRE DS    XL1                      TEST RESULT
CTGFLDTS EQU   X'01'                    TEST MASK - CTGFLDRE
*                                       = 0 - SUCCESSFUL TEST,
*                                       = 1 - TEST FAILED
*
CTGFLDWA DS    F                        CATALOG WORK AREA
*
CTGFLDNM DS    A                        FIELD NAME ADDRESS
*
CTGFLCHN DS    A                        ADDRESS OF NEXT FIELD
*
*
CTGFLDAT DS    0CL8                     PAIRS OF DATA LENGTH/ADDRESS
CTGFLNG  DS    F                        DATA LENGTH
CTGFLPT  DS    A                        DATA ADDRESS
*
*
CTGFLLEN EQU   *-CTGFL                  LENGTH OF CTGFL
         MEND  ,                        */
* %CTGFLX02:;
./ ADD NAME=IEZCTGFV 0100-00038-00038-1647-00110-00110-00000-MACRO
         MACRO ,
         IEZCTGFV &P=CTG
&P.FV    DSECT ,
*/********************************************************************/
*/*                                                                  */
*/*   MACRO NAME = IEZCTGFV                                          */
*/*                                                                  */
*/*   DESCRIPTIVE NAME = FIELD VECTOR TABLE                          */
*/*                                                                  */
*/*   FUNCTION = THE "CTGFV" IS BUILT BY THE ACCESS METHOD SERVICES  */
*/*              UTILITY PROGRAMS AND CONTAINS ADDRESSES OF USER-    */
*/*              SUPPLIED INFORMATION FIELDS AND LISTS.  THE "CTGFV" */
*/*              IS BUILT WHEN THE USER ISSUES A "DEFINE" OR "ALTER" */
*/*              COMMAND.  IF THE USER IS CREATING A CLUSTER, A      */
*/*              "CTGFV" IS BUILT FOR EACH CATALOG RECORD THAT WILL  */
*/*              BE BUILT TO DESCRIBE THE CLUSTER: THAT IS, ACCESS   */
*/*              METHOD SERVICES "DEFINE" PROCESSING BUILDS A        */
*/*              "CLUSTER" CTGFV, A "DATA" CTGFV", AND, IF THE       */
*/*              CLUSTER IS KEY-SEQUENCED, AN "INDEX" CTGFV.  THE    */
*/*              "CTGFV" IS POINTED TO BY THE "CTGPL(CTGFVT).  IF    */
*/*              ACCESS METHOD SERVICES BUILDS MORE THAN ONE "CTGFV" */
*/*              THE "CLUSTER" CTGFV IS POINTED TO BY THE "CTGPL"    */
*/*              (CTGFVT) AND THE "DATA" AND "INDEX" CTGFVS ARE      */
*/*              POINTED TO BY THE "CLUSTER" CTGFV.                  */
*/*                                                                  */
*/********************************************************************/
&P.FVTYP DS    C                  THE CTGFV CONTAINS INFORMATION USED
*                                 BY THE DEFINE ROUTINES TO BUILD A
*                                 CATALOG RECORD OF TYPE:
&P.FVALN EQU   C'A'               NON-VSAM DATA SET
&P.FVGBS EQU   C'B'               GENERATION DATA GROUP (GDG) BASE
&P.FVCL  EQU   C'C'               CLUSTER
&P.FVDTA EQU   C'D'               DATA SET
&P.FVAIX EQU   C'G'               ALTERNATE INDEX
&P.FVIDX EQU   C'I'               INDEX
&P.FVPTH EQU   C'R'               PATH
&P.FVVOL EQU   C'V'               VOLUME
&P.FVANM EQU   C'X'               ALIAS NAME
&P.FVPRO DS    B                  CATALOG MANAGEMENT SERVICES
*                                 PROCESSING OPTION FLAGS:
&P.FVAVL EQU   B'10000000'        ALTER: ADD VOLUMES
&P.FVRVL EQU   B'01000000'        ALTER: REMOVE VOLUMES
&P.FVNDC EQU   B'00100000'        NO DEVICE-TYPE CONVERSION
&P.FVDRC EQU   B'00010000'        DEFINE A RECOVERABLE CATALOG
&P.FVRON EQU   B'00001000'        TURN RACF INDICATOR ON
&P.FVROF EQU   B'00000100'        TURN RACF INDICATOR OFF
&P.FVBOF EQU   B'00000010'        TURN BUSY INDICATOR OFF          @CSO
*        EQU   B'00000001'        RESERVED
&P.FVELM DS    X                  ELEMENT NUMBER OF CMSPCATR
&P.FVFL2 DS    B                  ICF PROCESSING FLAGS
&P.FVSRC EQU   B'10000000'        SOURCE CATALOG NAME CHANGE
&P.FVNAL EQU   B'01000000'        DEFINE WITH NO-ALLOCATION
&P.FVICF EQU   B'00100000'        0=VSAM CATALOG, 1=ICF CATALOG
&P.FVRCT EQU   B'00010000'        DEFINE WITH RECATALOG
&P.FVNSD EQU   B'00001000'        NO CATALOG SELF DESCRIBING RECORDS
&P.FVABS EQU   B'00000100'        SUBALLOCATED DATASET FOR ICF
*                                 CONVERTCAT
*        EQU   B'00000011'        RESERVED
&P.FVDCH DS    A                  ADDRESS OF CLUSTER'S DATA CTGFV
&P.FVICH DS    A                  ADDRESS OF CLUSTER'S INDEX CTGFV
&P.FVVCH DS    A                  ADDRESS OF SPACE CTGFV
&P.FVIND DS    A                  ADDRESS OF ASSOCIATED JCL DD
*                                 STATEMENT
&P.FVENT DS    A                  ADDRESS OF ENTRY NAME
&P.FVSTY DS    A                  ADDRESS OF THE SECURITY INFORMATION
*                                 CTGFL (PASSWORDS, CODEWORD, AND
*                                 NUMBER OF TRIES)
&P.FVOWN DS    A                  ADDRESS OF OWNER IDENTIFICATION CTGFL
&P.FVEXP DS    A                  ADDRESS OF EXPIRY DATE CTGFL
&P.FVCRE DS    A                  ADDRESS OF CREATION DATE CTGFL
&P.FVVLT DS    A                  ADDRESS OF VOLUME SERIAL NUMBER LIST
&P.FVRNG DS    A                  ADDRESS OF THE KEY RANGE LIST
&P.FVDVT DS    A                  ADDRESS OF THE DEVTYPE CTGFL (FOR
*                                 DEFINE NONVSAM ONLY)
&P.FVSPC DS    0A                 ADDRESS OF THE SPACE ALLOCATION
*                                 INFORMATION CTGFL
&P.FVTTR DS    A                  ADDRESS OF THE DSCB'S TTR (FOR DEFINE
*                                 NONVSAM ONLY)
&P.FVAMD DS    0A                 ADDRESS OF THE AMDSB CTGFL (FOR
*                                 DEFINE CATALOG AND DEFINE CLUSTER
*                                 ONLY)
&P.FVFSN DS    A                  ADDRESS OF THE FILE SEQUENCE NUMBER
*                                 CTGFL (FOR DEFINE NONVSAM ONLY)
&P.FVATR DS    A                  ADDRESS OF DATA SET ATTRIBUTES CTGFL
&P.FVBUF DS    A                  ADDRESS OF THE BUFFER SIZE CTGFL
&P.FVLRS DS    A                  ADDRESS OF THE AVERAGE RECORD SIZE
*                                 CTGFL
&P.FVLMT DS    0A                 ADDRESS OF THE GDG LIMIT (FOR DEFINE
*                                 GDG BASE ONLY)
&P.FVEXT DS    A                  ADDRESS OF EXCEPTION EXIT PARAMETER
*                                 LIST
&P.FVGAT DS    0A                 ADDRESS OF THE GDG ATTRIBUTES (FOR
*                                 DEFINE GDG BASE ONLY)
&P.FVUPG DS    A                  ADDRESS OF RGATTR PARAMETER LIST
&P.FVNAM DS    A                  ADDRESS OF THE TRUE NAME CTGFL (FOR
*                                 DEFINE ALIAS ONLY)
&P.FVPWD DS    0A                 ADDRESS OF THE RELATED OBJECTS
*                                 PASSWORD
&P.FVCPP DS    A                  ADDRESS OF TSO COMMAND PROCESSOR
*                                 PARAMETER LIST (CPPL TSO COMMAND
*                                 CALLERS ONLY). IF ZERO, DAIRFAIL
*                                 MESSAGES WILL BE WTP'S.
&P.FVWKA DS    0A                 ADDRESS OF THE CRA FEEDBACK AREA
&P.FVCAT DS    A                  ADDRESS OF SOURCE CATALOG ACB
&P.FVELT DS    A                  ADDRESS OF EXTENT INFORMATION LIST
&P.FVRBA DS    A                  ADDRESS OF FPL OF HURBA AND HARBA FOR
*                                 DATA OR INDEX COMPONENT DURING
*                                 CONVERTCAT
&P.FVLEN EQU   *-&P.FV            LENGTH OF FIELD VECTOR TABLE
         MEND  ,
./ ADD NAME=IEZCTGPL 0100-00038-00038-1647-00389-00389-00000-MACRO
* %GOTO CTGPLX01; /*
         MACRO
         IEZCTGPL ,
CTGPL    DSECT ,                        */
* %CTGPLX01:;
*/********************************************************************/
*/*                                                                  */
*/*   $MAC(IEZCTGPL):                                                */
*/*                                                                  */
*/*  5665-XA2                                                        */
*/*  CONTAINS RESTRICTED MATERIALS OF IBM                            */
*/*  (C) COPYRIGHT IBM CORP. 1980, 1985                              */
*/*  LICENSED MATERIALS - PROPERTY OF IBM                            */
*/*  REFER TO COPYRIGHT INSTRUCTIONS                                 */
*/*  FORM NUMBER G120-2083.                                          */
*/*                                                                  */
*/*   DESCRIPTIVE NAME = CATALOG PARAMETER LIST                      */
*/*                                                                  */
*/*   FUNCTION = THE CATALOG PARAMETER LIST (CTGPL) DEFINES THE      */
*/*              CATALOG MANAGEMENT REQUEST AND ITS OPTIONS, THE     */
*/*              CATALOG RECORD TO BE PROCESSED, AND THE VSAM        */
*/*              CATALOG THAT CONTAINES THE RECORD.  THE CTGPL IS    */
*/*              BUILT BEFORE AN OS/VS COMPONENT ISSUES THE CATLG    */
*/*              MACRO INSTRUCTION (SVC 26) TO PROCESS A CATALOG     */
*/*              RECORD.  WHEN THE CATALOG MANAGEMENT ROUTINES       */
*/*              BUILD A CCA TO SUPPORT THE REQUEST, THE ADDRESS     */
*/*              OF THE CTGPL IS PUT INTO THE CCA (CCACPL).          */
*/*                                                                  */
*/*   CONTROL BLOCK STRUCTURE = THE CTGPL IS POINTED TO BY           */
*/*                             REGISTER 1.                          */
*/*                                                                  */
*/*   INCLUDED MACROS = NONE                                         */
*/*                                                                  */
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */
*/*                                                                  */
*/*   STATUS = MVS/XA DFP RELEASE 1.1                                */
*/*   A 343000 A 346000                                      @ZA18274*/
*/*                                                                  */
*/*   DATE OF LAST CHANGE = 12 MARCH 84                              */
*/*   JES3 SUPPORT - I 850084,892500,895500                          */
*/*   &L5=ICFCAT,JDM1113,T790078,STLPCJ: DF/EF CATALOG SUPPORT   @L5A*/
*/*   &L6=DFP,HDP1102,,STLPRB: DFP                               @L6A*/
*/*                                                          @ZA58903*/
*/*                                                          @ZA76423*/
*/*   $PAS=DFP,HDP2102,,STLLEE: MVS/XA DFP V2R1M0                @PAS*/
*/*   $LM=DFP,JDP1110,,STLLLL: MVS/XA DFP RELEASE 1.1                */
*/*   $SC=GFL,JDP2110,,STLSSC: DPF/XA 2.1.1 GENERIC FILTER LOCATE@SCA*/
*/*   $L9=ALIAS,HDP2230,STLJSC:   EXPORT OF ALIAS                @L9A*/
*/*                                                              @HES*/
*/********************************************************************/
*%GOTO CTGPLX03;
*/*
         AGO   .CTGPL01                 */
*%CTGPLX03:;
*%DECLARE (CTGPLLEN, CTGPL999, CTGPLLVL) CHAR;
*%CTGPLLEN = 'LENGTH(CTGPL)';       /* LENGTH OF CTGPL               */
*%IF CTGPL999 ^= ','                /* IF BLOCK NOT CONTINUED,       */
*   %THEN %CTGPL999 = ';';          /*   THEN CLOSE DCL STATEMENT    */
*%IF CTGPLLVL  = ''                 /* IF BLOCK NOT CONCATENATED,    */
*   %THEN %GOTO CTGPL001;           /*   THEN GENERATE DCL           */
*%CTGPLDUM = CTGPLLVL' CTGPL';    /* SET MINOR LEVEL NUMBER        */
*        CTGPLDUM                   /* CTGPL CONCATENATED LEVEL      */
*%GOTO CTGPL002;                    /* SKIP DECLARE                  */
*%CTGPL001:;                        /* DECLARE                       */
*   DECLARE
*     1 CTGPL BASED(CTGPLPTR)       /* DECLARE CTGPL LEVEL ONE       */
*%CTGPL002:;                        /* SKIP DECLARE                  */
*        BDY(WORD),                 /* WORD BOUNDARY                 */
*       5 CTGOPTN1 BIT(8),          /* FIRST OPTION INDICATOR        */
*         10 CTGBYPSS BIT(1),       /* BYPASS                        */
*         10 CTGMAST  BIT(1),       /* VERIFY MASTER PASSWORD        */
*         10 CTGCI    BIT(1),       /* VERIFY CONTROL INTERVAL       */
*         10 CTGUPD   BIT(1),       /* VERIFY UPDATE                 */
*         10 CTGREAD  BIT(1),       /* VERIFY READ                   */
*         10 CTGNAME  BIT(1),       /* 1 = 44-BYTE NAME OR VOL SER,  */
*                                   /* 0 = ENTRY ID NUMBER           */
*         10 CTGCNAME BIT(1),       /* 1 = 44-BYTE NAME,             */
*                                   /* 0 = ACB ADDRESS               */
*         10 CTGGENLD BIT(1),       /* GENERIC LOCATE REQUEST  Y02020*/
*       5 CTGOPTN2 BIT(8),          /* SECOND OPTION INDICATOR       */
*         10 CTGEXT   BIT(1),       /* EXTEND       (UPDATE)         */
*            15 CTGNSVS BIT(1),     /* CATLG CLEANUP REQUEST @ZA00605*/
*         10 CTGERASE BIT(1),       /* ERASE        (DELETE)         */
*            15 CTGSMF   BIT(1),    /* WRITE SMF    (LSPACE)         */
*               20 CTGREL   BIT(1), /* RELEASE      (UPDATE)         */
*                  25 CTGGTALL BIT(1),/* CONCAT SEARCH  FOR    Y02020*/
*                                   /* (LISTCAT)               Y02020*/
*         10 CTGPURG  BIT(1),       /* PURGE        (DELETE)         */
*           15 CTGVMNT BIT(1),      /* VOLUME MOUNT CALLER           */
*              20 CTGRCATN BIT(1),  /* RTN CATLG NAME(GLOC)    Y02020*/
*                 25 CTGSWAP BIT(1),/* SWAPSPACE (DEFINE)    @Z40WSSG*/
*         10 CTGGTNXT BIT(1),       /* GET NEXT     (LIST CATALOG)   */
*           15 CTGUCRAX BIT(1),     /* UCRA EXTEND OPTION    @ZA18274*/
*             20 CTGDELRC BIT(1),   /* DELETE RECOVER            @L5A*/
*                                   /* (WITH UPDATE)                 */
*         10 CTGDISC BIT(1),        /* DISCONNECT   (DELETE)         */
*         10 CTGOVRID BIT(1),       /* ERASE OVERRIDE (DELETE)       */
*            15 CTGCNVTC BIT(1),    /* CONVERT CAT (DELETE SPACE)
*                                                                @L6C*/
*         10 CTGSCR   BIT(1),       /* SCRATCH SPACE (DELETE)        */
*         10 CTGBOTH  BIT(1),       /* CALLER CAN ACCEPT ICF CATALOG
*                                      ARCHITECTURE              @L6C*/
*       5 CTGOPTN3 BIT(8),          /* THIRD OPTION INDICATOR        */
*         10 CTGFUNC  BIT(3),       /* CATALOG FUNCTION              */
*         10 CTGSUPLT BIT(1),       /* SUPER LOCATE                  */
*         10 CTGGDGL  BIT(1),       /* GDG LOCATE REQUEST      Y02020*/
*                                   /* WITH BASE LEVEL GIVEN   Y02020*/
*                                   /* (CTGWAGB IN CTGWA)      Y02020*/
*         10 CTGSRH   BIT(1),       /* 0 = SEARCH MASTER CATLG Y02020*/
*                                   /*     ONLY                Y02020*/
*                                   /* 1 = SEARCH OS CATALOG FIRST   */
*         10 CTGNUM   BIT(1),       /* 0 = SEARCH BOTH CATALOGS,     */
*                                   /* 1 = SEARCH ONE CATALOG        */
*         10 CTGAM0   BIT(1),       /* VSAM REQ VERSUS NONVSAM       */
*       5 CTGOPTN4 BIT(8),          /* GDG FLAGS                     */
*         10 CTGLBASE BIT(1),       /* LOCATE GDG BASE ONLY Y02020   */
*         10 CTGDOCAT BIT(1),       /* DO NOT OPEN NEEDED CATALOG    */
*         10 CTGNPROF BIT(1),       /* NO (RAC) PROFILE SHOULD BE
*                                      DEFINED OR DELETED    @Z40RSRC*/
*         10 CTGCOIN  BIT(1),       /* CONTROLLER INTERCEPT REQUESTED
*                                                            @ZA20773*/
*         10 CTGBYPMT BIT(1),       /* BYPASS SECURITY PROMPTING
*                                       TO SYSTEM OPERATOR   @ZA07531*/
*         10 CTGTIOT  BIT(1),       /* CALLER OWNS SYSZTIOT EXCLUSIVE
*                                                            @ZA20773*/
*         10 CTGICFC  BIT(1),       /* REQUEST ORIENTED TO ICF CATALOG
*                                                                @L5A*/
*         10 CTGICFOR BIT(1),       /* ICF ONLY REQUEST          @L5A*/
*       5 CTGENT   PTR(31),         /* USER ENTRY ADDR OR PTR TO VOLUME
*                                        SERIAL NUMBER (LSPACE)      */
*         10 CTGFVT   PTR(31),      /* FVT ADDRESS (DEFINE, ALTER)   */
*       5 CTGCAT   PTR(31),         /* CATALOG POINTER               */
*         10 CTGCVOL PTR(31),       /* CVOL PTR (SUPER LOCATE)       */
*       5 CTGWKA  PTR(31),          /* WORKAREA ADDR                 */
*       5 CTGDSORG CHAR(2),         /* DATA SET ORG - SUPERLOCATE    */
*         10 CTGOPTNS BIT(5),       /* CMS OPTIONS                   */
*         10 CTGF2WKA BIT(1),       /* FORMAT 2 WORK AREA        @L5A*/
*         10 CTGVVRUP BIT(1),       /* VVDS UPDATE ONLY          @L5A*/
*         10 CTGF2SEN BIT(1),       /* CAN HANDLE 40-2 RC    @ZA58903*/
*         10 CTGFVFY  BIT(1),       /* FORCE PASSWORD VERIFICATION -
*                                      DO NOT CHECK FOR AUTHORIZED
*                                      CALLER.                   @LMA*/
*         10 CTGHDLET BIT(1),       /* HSM HAS DELETED A MIGRATED
*                                      DATA SET                  @PAS*/
*         10 CTGHALTL BIT(1),       /* LOCATE FROM ALTER         @PAS*/
*         10 CTGHDLTL BIT(1),       /* LISTCAT FROM DELETE       @PAS*/
*         10 CTGBRCAT BIT(1),       /* BRANCH ENTRY TO IGG0CLHA -
*                                      RESTRICTED TO KEY ZERO USE AND
*                                      CMS FUNCTIONS CTGOPEN,
*                                      CTGCLOSE, AND CTGVVDS.        */
*         10 *        BIT(3),       /* RESERVED              @ZA58903*/
*       5 CTGTYPE  CHAR(1),         /* ENTRY TYPE - LISTCAT, DELETE  */
*       5 CTGNOFLD PTR(8),          /* NUMBER OF FIELD POINTERS      */
*       5 CTGDDNM PTR(31),          /* DD NAME ADDR                  */
*         10 CTGNEWNM PTR(31),      /* NEWNAME ADDRESS - ALTER       */
*            15 CTGFDBK  PTR(16),   /* SUPER LOCATE FEEDBACK         */
*            15 CTGFBFLG BIT(16),   /* SUPER LOCATE FLAGS            */
*               20 CTGPAR   BIT(1), /* PARALLEL MOUNT -SUPERLOCATE   */
*               20 CTGKEEP  BIT(1), /* FORCED KEEP - SUPERLOCATE     */
*               20 CTGGDGB  BIT(1), /* GDG BASE LOCATE         Y02020*/
*               20 CTGNGDSN BIT(1), /* GDG NAME GENERATED      Y02020*/
*               20 CTGCLV   BIT(1), /* CANDIDATE VOLUME LIST @ZA76423*/
*               20 *        BIT(11), /* RESERVED             @ZA76423*/
*       5 CTGJSCB  PTR(31),         /* JSCB ADDR                     */
*         10 CTGPSWD  PTR(31),      /* PASSWORD ADDR                 */
*       5 CTGFIELD(*) PTR(31) CTGPL999 /* FIELD POINTERS             */
*/********************************************************************/
*/*     CONSTANTS USED TO SET AND/OR TEST FIELDS DECLARED ABOVE      */
*/********************************************************************/
*   DECLARE                         /* CATALOG FUNCTION - CTGFUNC    */
*     CTGLOC   BIT(3) CONSTANT('001'B), /* LOCATE                    */
*     CTGLSP   BIT(3) CONSTANT('010'B), /* LSPACE                    */
*     CTGUPDAT BIT(3) CONSTANT('011'B), /* UPDATE                    */
*     CTGCMS   BIT(3) CONSTANT('100'B); /* CMS FUNCTION              */
*   DECLARE                         /* CMS OPTIONS - CTGOPTNS        */
*     CTGDEFIN BIT(5) CONSTANT('00001'B), /* DEFINE                  */
*     CTGALTER BIT(5) CONSTANT('00010'B), /* ALTER                   */
*     CTGDELET BIT(5) CONSTANT('00011'B), /* DELETE                  */
*     CTGLTCAT BIT(5) CONSTANT('00100'B), /* LIST CATALOG            */
*     CTGCNVTV BIT(5) CONSTANT('00110'B), /* CONVERTV        @Y30LSPS*/
*     CTGOPEN  BIT(5) CONSTANT('00111'B), /* CAS CAT OPEN    @PAS    */
*     CTGCLOSE BIT(5) CONSTANT('01000'B), /* CAS CAT CLOSE   @PAS    */
*     CTGVVDS  BIT(5) CONSTANT('01001'B); /* CAS CAT VVDS    @PAS    */
*   DECLARE                           /* RECORD ENTRY TYPE - CTGTYPE */
*     CTGTDATA CHAR(1) CONSTANT('D'), /* DATA                        */
*     CTGTINDX CHAR(1) CONSTANT('I'), /* INDEX                       */
*     CTGTALIN CHAR(1) CONSTANT('A'), /* ALIEN                       */
*     CTGTUCAT CHAR(1) CONSTANT('U'), /* USER CATALOG                */
*     CTGTVOL  CHAR(1) CONSTANT('V'), /* VOLUME                      */
*     CTGTCL   CHAR(1) CONSTANT('C'), /* CLUSTER                     */
*     CTGTAIX  CHAR(1) CONSTANT('G'), /* ALTERNATE INDEX     @Y30SSPJ*/
*     CTGTPATH CHAR(1) CONSTANT('R'), /* PATH                @Y30SSPJ*/
*     CTGTTNAM CHAR(1) CONSTANT('T'), /* TRUE NAME               @L5A*/
*     CTGTVVR  CHAR(1) CONSTANT('K'), /* VSAM VOLUME RECORD      @L5A*/
*     CTGTFREE CHAR(1) CONSTANT('F'), /* FREE                @Y30SSPJ*/
*     CTGTPTH  CHAR(1) CONSTANT('R'), /* PATH                @Y30SSSB*/
*     CTGTUPG  CHAR(1) CONSTANT('Y'), /* UPGRADE             @Y30SSSB*/
*     CTGTGBS  CHAR(1) CONSTANT('B'), /* GDG BASE              Y02020*/
*     CTGTANM  CHAR(1) CONSTANT('X'), /* ALIAS NAME            Y02020*/
*     CTGTPGSP CHAR(1) CONSTANT('P'), /* PAGE SPACE            Y02020*/
*     CTGTMCAT CHAR(1) CONSTANT('M'), /* MASTER CATALOG              */
*     CTGTJES3 BIT(8) CONSTANT('01'X);/* JES3 ORIGINATED, SUPERLOCATE
*                                        REQUEST                     */
*/********************************************************************/
*/*                 PROBLEM  DETERMINATION  FIELDS                   */
*/********************************************************************/
*   DECLARE
*     1 * DEF(CTGDDNM),             /* PROBLEM DETERMINATION @Y30SSJG*/
*       2 CTGPROB CHAR(4),          /* PROBLEM DETERMINATION @Y30SSJG*/
*         3 CTGMODID CHAR(2),       /* MODULE IDENTIFICATION @Y30SSJG*/
*         3 CTGREASN CHAR(2),       /* REASON CODE           @Y30SSJG*/
*           4 CTGREAS1 CHAR(1),     /* HIGH ORDER BYTE ZERO  @Y30SSJG*/
*           4 CTGREAS2 CHAR(1);     /* REASON CODE LOW BYTE  @Y30SSJG*/
* %GOTO CTGPLX02;                                                   /*
.CTGPL01 ANOP
*
*     COPYRIGHT = 5665-284 (C) COPYRIGHT IBM CORP. 1983
*                 LICENSED MATERIAL - PROGRAM PROPERTY OF IBM
*
CTGOPTN1 DS    XL1                      FIRST OPTION INDICATOR
CTGBYPSS EQU   X'80'                    BYPASS
CTGMAST  EQU   X'40'                    VERIFY MASTER PASSWORD
CTGCI    EQU   X'20'                    VERIFY CONTROL INDICATOR
CTGUPD   EQU   X'10'                    VERIFY UPDATE
CTGREAD  EQU   X'08'                    VERIFY READ
CTGNAME  EQU   X'04'                    1 - 44-BYTE NAME OR VOLSER
*                                       0 - ENTRY ID NUMBER
CTGCNAME EQU   X'02'                    1 - 44-BYTE NAME
*                                       0 - ACB ADDRESS
CTGGENLD EQU   X'01'                    GENERIC LOCATE REQUEST
*
CTGOPTN2 DS    XL1                      SECOND OPTION INDICATOR
CTGEXT   EQU   X'80'                    EXTEND(UPDATE)
CTGNSVS  EQU   X'80'                    CATLG CLEANUP REQUEST  @ZA00605
CTGERASE EQU   X'40'                    ERASE(DELETE)
CTGSMF   EQU   X'40'                    WRITE SMF(LSPACE)
CTGREL   EQU   X'40'                    RELEASE(UPDATE)
CTGGTALL EQU   X'40'                    CONCAT SEARCH (LISTCAT) Y02020
CTGGFLIC EQU   X'40'                    SRCH ONLY 1 CAT(GFL)      @SCA
CTGPURG  EQU   X'20'                    PURGE (DELETE)
CTGVMNT  EQU   X'20'                    VOLUME MOUNT CALLER
CTGRCATN EQU   X'20'                    RTN CAT NAME(GLOC)      Y02020
CTGSWAP  EQU   X'20'                    SWAPSPACE (DEFINE)     @Z40WSSG
CTGGTNXT EQU   X'10'                    GET NEXT (LIST CTLG)
CTGUCRAX EQU   X'10'                    UCRA EXTEND OPTION     @ZA18274
CTGDELRC EQU   X'10'                    DELETE RECOVER             @L5A
CTGDISC  EQU   X'08'                    DISCONNECT (DELETE)
CTGRESM  EQU   X'08'                    GFL RESUME FUNCTION        @SCA
CTGOVRID EQU   X'04'                    ERASE OVERRIDE (DELETE)
CTGCNVTC EQU   X'04'                    CONVERT CAT (DELETE SPACE)
*                                                                  @L5A
CTGSCR   EQU   X'02'                    SCRATCH SPACE (DELETE)
CTGCDI   EQU   X'02'                    DATA INDEX ARE MATCHES IF ITS
*                                       CLUSTER/AIX MATCHES FILTER KEY
*                                                                  @SCA
CTGBOTH  EQU   X'01'                    CALLER CAN ACCEPT ICF CATALOG
*                                       ARCHITECTURE               @L5A
CTGOPTN3 DS    XL1                      THIRD OPTION INDICATOR
CTGFUNC  EQU   X'E0'                    HIGH ORDER THREE BITS DEFINE
*                                       FUNCTION
*   LOCATE     -   001* ****
CTGLOC   EQU   X'20'                    LOCATE - BITS ON
*   LSPACE     -   010* ****
CTGLSP   EQU   X'40'                    LSPACE - BITS ON
*   UPDATE     -   011* ****
CTGUPDAT EQU   X'60'                    UPDATE - BITS ON
*   CMS FUNCTION - 100* ****
CTGCMS   EQU   X'80'                    CMS FUNCTION - BITS ON
*   GFL FUNCTION - 101* ****                                       @SCA
CTGGFL   EQU   X'A0'                    GFL FUNCTION - BITS ON     @SCA
*
CTGSUPLT EQU   X'10'                    SUPER LOCATE
CTGGDGL  EQU   X'08'                    GDG LOCATE FUNCTION (CTGWAGB IN
*                                       CTGWA)
CTGSRH   EQU   X'04'                    0 - SEARCH MASTER CAT ONLY
*                                       1 - SEARCH OS CAT FIRST
CTGNUM   EQU   X'02'                    0 - SEARCH BOTH CATALOGS
*                                       1 - SEARCH ONE CATALOG
CTGAM0   EQU   X'01'                    VSAM REQ VERSUS NONVSAM
*
CTGOPTN4 DS    XL1                      FOURTH OPTION INDICATOR  Y02020
CTGLBASE EQU   X'80'                    LOCATE GDG BASE ONLY
CTGNDISC EQU   X'80'                    DELETE CATALOG NO DISCONNECT
*                                                                  @L9A
CTGNOCON EQU   X'80'                    DEFINE CATALOG NO CONNECT  @L9A
CTGDOCAT EQU   X'40'                    DO NOT OPEN NEEDED CATLG
CTGNPROF EQU   X'20'                    NO (RAC) PROFILE SHOULD BE
*                                       DEFINED OR DELETED     @Z40RSRC
CTGCOIN  EQU   X'10'                    CONTROLLER INTERCEPT REQUESTED
*                                                              @ZA20773
CTGBYPMT EQU   X'08'                    BYPASS SECURITY PROMPTING TO
*                                       SYSTEM OPERATOR        @ZA07531
CTGTIOT  EQU   X'04'                    CALLER OWNS SYSZTIOT EXCLUSIVE
CTGICFC  EQU   X'02'                    REQUEST ORIENTED TO ICF CATALOG
*                                                                  @L5A
CTGICFOR EQU   X'01'                    ICF ONLY REQUEST           @L5A
CTGENT   DS    0A                       USER ENTRY ADDRESS OR POINTER
*                                       TO VOLUME SERIAL NUMBER(LSPACE)
CTGFVT   DS    A                        FVT ADDRESS (DEFINE, ALTER)
CTGCAT   DS    0A                       CATALOG POINTER
*
CTGCVOL  DS    A                        CVOL PTR (SUPER LOCATE)
*
CTGWKA   DS    A                        WORKAREA ADDRESS
*
CTGDSORG DS    CL2                      DATA SET ORG (SUPER LOCATE)
*   BITS 0-4 DEFINE ORGANIZATION
CTGOPTNS EQU   X'F8'                    TOP 5 BITS
*   DEFINE          - 0000 1*** **** ****
CTGDEFIN EQU   X'08'                    DEFINE
*   ALTER           - 0001 0*** **** ****
CTGALTER EQU   X'10'                    ALTER
*   DELETE          - 0001 1*** **** ****
CTGDELET EQU   X'18'                    DELETE
*   LIST CATALOG    - 0010 0*** **** ****
CTGLTCAT EQU   X'20'                    LIST CATALOG
*   CONVERTV        - 0011 0*** **** ****
CTGCNVTV EQU   X'30'                    CONVERTV
*   CAS CAT OPEN    - 0011 1*** **** ****                         @PAS
CTGOPEN  EQU   X'38'                    CAS CAT OPEN              @PAS
*   CAS CAT CLOSE   - 0100 0*** **** ****                         @PAS
CTGCLOSE EQU   X'40'                    CAS CAT CLOSE             @PAS
*   CAS CAT VVDS    - 0100 1*** **** ****                         @PAS
CTGVVDS  EQU   X'48'                    CAS CAT VVDS              @PAS
CTGF2WKA EQU   X'04'                    FORMAT 2 WORK AREA        @L5A
CTGVVRUP EQU   X'02'                    VVDS UPDATE ONLY          @L5A
CTGF2SEN EQU   X'01'                    CAN HANDLE 40-2 RC    @ZA58903
CTGFVFY  EQU   X'80'                    FORCE PASSWORD VERIFICATION -
*                                       DO NOT CHECK FOR AUTHORIZED
*                                       CALLER                    @LMA
CTGHDLET EQU   X'40'                    HSM HAS DELETED A MIGRATED
*                                       DATA SET                  @PAS
CTGHALTL EQU   X'20'                    LOCATE FROM ALTER         @PAS
CTGHDLTL EQU   X'10'                    LISTCAT FROM DELETE       @PAS
CTGBRCAT EQU   X'08'                    BRANCH ENTRY TO IGGOCLAH -
*                                       RESTRICTED TO KEY ZERO USE AND
*                                       CMS FUNCTIONS CTGOPEN,
*                                       CTGCLOSE, AND CTGVVDS.
*
*   BITS 13-15 RESERVED                                           @L5A
*
CTGTYPE  DS    CL1                      ENTRY TYPE-LISTCAT,DELETE
CTGTALIN EQU   C'A'                     ALIEN - A
CTGTGBS  EQU   C'B'                     GDG BASE - B
CTGTCL   EQU   C'C'                     CLUSTER - C
CTGTDATA EQU   C'D'                     DATA - D
CTGTFREE EQU   C'F'                     FREE - F
CTGTAIX  EQU   C'G'                     ALTERNATE INDEX - G
CTGTGDS  EQU   C'H'                     GDS - H                    @SCA
CTGTINDX EQU   C'I'                     INDEX - I
CTGTVVR  EQU   C'K'                     VSAM VOLUME RECORD         @L5A
CTGTMCAT EQU   C'M'                     MASTER CATALOG - M
CTGTPGSP EQU   C'P'                     PAGE SPACE - P
CTGTPATH EQU   C'R'                     PATH - R
CTGTPTH  EQU   C'R'                     PATH - R
CTGTTNAM EQU   C'T'                     ICF TRUE NAME              @L5A
CTGTUCAT EQU   C'U'                     USER CATALOG - U
CTGTVOL  EQU   C'V'                     VOLUME - V
CTGTANM  EQU   C'X'                     ALIAS BASE -X
CTGTUPG  EQU   C'Y'                     UPGRADE - Y
CTGTJES3 EQU   X'01'                    JES3 SUPERLOCATE REQUEST
CTGMULTY EQU   X'FF'                    MULTIPLE TYPES             @SCA
*
CTGNOFLD DS    XL1                      NUMBER FIELD POINTERS
CTGDDNM  DS    0A                       DD NAME ADDRESS
CTGNEWNM DS    0A                       NEWNAME ADDRESS - ALTER
CTGFILTR DS    0A                       GFL FILTER KEY ADDRESS     @SCA
CTGPROB  DS    0XL4                     PROBLEM DETERMINATION  @Y30SSJG
CTGMODID DS    0CL2                     MODULE IDENTIFICATION  @Y30SSJG
CTGFDBK  DS    XL2                      SUPER LOCATE FEEDBACK
CTGFBFLG DS    0XL2                     SUPER LOCATE FLAGS
CTGREASN DS    0XL2                     ERROR REASON CODE      @Y30SSJG
CTGREAS1 DS    XL1                      HIGH ORDER BYTE ZERO
CTGPAR   EQU   X'80'                    PARALLEL MOUNT - SUPER LOC
CTGKEEP  EQU   X'40'                    FORCED KEEP = SUPER LOCATE
CTGGDGB  EQU   X'20'                    GDG BASE LOCATED
CTGNGDSN EQU   X'10'                    GDG NAME GENERATED
CTGCLV   EQU   X'08'                    CANDIDATE VOLUME LIST  @ZA76423
*        6-8  RESERVED                                         @ZA76423
CTGREAS2 DS    XL1                      REASON CODE LOW BYTE
*
CTGJSCB  DS    0A                       JSCB ADDRESS
CTGPSWD  DS    A                        PASSWORD ADDRESS
CTGFIELD DS    A                        FIELD POINTERS - MAY BE MORE
*                                       THAN ONE
CTGPLLEN EQU   *-CTGPL                  LENGTH OF CTG WITH ONE FIELD
*                                       POINTER
         MEND
* */ %CTGPLX02:;
./ ADD NAME=IEZCTGVL 0100-00038-00038-1647-00030-00030-00000-MACRO
         MACRO ,
         IEZCTGVL &P=CTG
***********************************************************************
*                                                                     *
*  MACRO NAME = IEZCTGVL                                              *
*                                                                     *
*  DESCRIPTIVE NAME = CATALOG VOLUME LIST                             *
*                                                                     *
*  FUNCTION = THE CTGVL IS BUILT BY THE ISSUER OF A LOCATE REQUEST    *
*             FOR A DATA-SET NAME.  CATALOG MANAGEMENT USES THE CTGVL *
*             TO RETURN TO THE CALLER THE VOLUME SERIAL NUMBERS OF    *
*             THE VOLUMES ON WHICH SPACE IS ALLOCATED TO THE DATA     *
*             SET.  FOR SUPERLOCATE REQUESTS, THE CTGWA POINTS TO THE *
*             CTGVL.                                                  *
*                                                                     *
*  DATE OF LAST CHANGE = 21 FEB 83                                    *
*                                                                     *
***********************************************************************
&P.VL    DSECT ,
&P.VLVOL DS    CL6                VOLUME SERIAL NUMBER
&P.VLDEV DS    XL4                DEVICE TYPE
&P.VLSEQ DS    XL2                FILE SEQUENCE NUMBER
&P.VLLX  DS    0X                 VOLUME LIST EXTENSION
&P.VLTTR DS    0XL3               FOR A SINGLE VOL DSN, THE TTR OF ITS
*                                 DSCB
&P.VLNXT DS    0X                 FOR A MULTI-VOLUME DATASET, A
*                                 REPETITION OF CTGVLVOL, CTGVLDEV, AND
*                                 CTGVLSEQ FOR THE REST OF THE VOLUMES
&P.VLLEN EQU   *-&P.VL
         MEND  ,
./ ADD NAME=IEZCTGWA 0100-00038-00038-1647-00031-00031-00000-MACRO
         MACRO ,
         IEZCTGWA &P=CTG
***********************************************************************
*                                                                     *
*  MACRO NAME = IEZCTGWA                                              *
*                                                                     *
*  DESCRIPTIVE NAME = CATALOG WORK AREA                               *
*                                                                     *
*  FUNCTION = THE CTGWA IS BUILT BY THE CALLER OF CATALOG MANAGEMENT  *
*             FOR MOST REQUESTS.  THE CTGPL POINTS TO THE CTGWA.      *
*             THE WORK AREA HAS ONE FORMAT FOR A SUPERLOCATE          *
*             REQUEST AND ANOTHER FORMAT FOR ALL OTHER REQUESTS.      *
*                                                                     *
*  DATE OF LAST CHANGE = 21 FEB 83                                    *
*                                                                     *
***********************************************************************
&P.WA    DSECT ,
&P.WALNG DS    XL2                      LENGTH OF THE WORK AREA
* FORMAT FOR A SUPERLOCATE REQUEST
         ORG   &P.WALNG
&P.WAVL  DS    A                  ADDRESS OF THE CTGVL (VOLUME LIST)
&P.WALV  DS    XL2                LENGTH OF THE VOLUME LIST
&P.WAVCT DS    XL2                NO OF VOLSERS RETURNED IN VSL MINIMUM
&P.WAUCT DS    XL2                NO OF VOLUMES THAT MUST BE MOUNTED
* THE FOLLOWING TWO FIELDS ARE FOR A GDG BASE ONLY:
&P.WAGCT DS    XL2                NO OF GENERATIONS CATALOGED
*                                 CTGGDGB IN CTGPL IS SET ON (FOR GDGS)
&P.WAGB  DS    A                  ADDRESS OF 4 BYTE FIELD
*                                CONTAINING GENERATION LEVEL TO BE USED
&P.WALEN EQU   *-&P.WA
         MEND  ,
./ ADD NAME=IGGCAXWA 0100-00038-00038-1647-00140-00140-00000-MACRO
         MACRO ,
         IGGCAXWA
***********************************************************************
*                                                                     *
*  MACRO NAME = IGGCAXWA                                              *
*                                                                     *
*  DESCRIPTIVE NAME = CATALOG AUXILIARY WORKAREA                      *
*                                                                     *
*  FUNCTION = THE CAXWA IS BUILT WHEN AN OS/VS2 MASTER OR USER        *
*             CATALOG IS OPENED OR IS BEING CREATED.  THE CAXWA IS    *
*             USED TO CONTAIN THE ADDRESS OF THE CONTROL BLOCKS AND   *
*             WORK AREAS NEEDED WHEN A CATALOG SUCH AS THE ALTERNATE  *
*             TIOT, THE DRWA, AND THE UCB ARE BEING OPENED OR         *
*             CREATED.  THE CAXWA ALSO CONTAINS FLAGS THAT INDICATE   *
*             THE TYPE OF PROCESSING BEING PERFORMED ON THE CATALOG   *
*             AND THE OS/VS COMPONENT THAT INVOKED THE PROCESSING.    *
*             EACH CAXWA POINTS TO A CATALOG'S ACB.  THE ACB          *
*             DESCRIBES THE CATALOG AS A KEY-SEQUENCED VSAM DATA SET. *
*             ALL CAXWAS THAT DESCRIB THE CATALOGS AVAILABLE TO THE   *
*             USER'S PROGRAM ARE CHAINED TOGETHER.  THE AMCBS         *
*             (CBSCAXCN) CONTAINS THE ADDRESS OF THE CAXWA CHAIN.     *
*                                                                     *
*                                                                     *
*  CONTROL BLOCK STRUCTURE = THE CAXWA IS POINTED TO BY THE ACB       *
*             (ACBUAPTR).                                             *
*                                                                     *
*  CREATED BY: VSAM CATALOG MANAGEMENT DURING BUILD OR OPEN OF        *
*              A MASTER OR USER CATALOG.                              *
*                                                                     *
*  DATE OF LAST CHANGE = 20 MAY 75                                    *
*  DATE OF LAST CHANGE = 11 NOV 74                                    *
*  DATE OF LAST CHANGE = 21 FEB 83                                    *
*                                                                     *
***********************************************************************
IGGCAXWA DSECT
CAXID    DS    XL1                CONTROL BLOCK IDENTIFIER X"CA"
CAXFLG4  DS    XL1                FLAGS
CAXF4CSO EQU   B'10000000'        CA SPLIT OCCURRED
CAXF4CRO EQU   B'01000000'        CONTROL BLOCK REFRESH OCCURED
CAXF4VFY EQU   B'00100000'        BCS VERIFY (CLAE)
CAXF4PUT EQU   B'00010000'        BCS PUT (CLEG)
CAXF4DSC EQU   B'00001000'        CATALOG DISCONNECT
*        EQU   B'00000111'        RESERVED
         DS    CL2                RESERVED
CAXCHN   DS    A                  ADDRESS OF NEXT CAXWA IN THE CHAIN
CAXFLGS  DS    XL1                FLAGS:
CAXBLD   EQU   B'10000000'        BUILD REQUEST
CAXOPN   EQU   B'01000000'        THE CATALOG IS BEING OPENED
CAXCLS   EQU   B'00100000'        THE CATALOG IS BEING CLOSED
CAXEOV   EQU   B'00010000'        AN END OF VOLUME IS IN CONTROL
CAXCMP   EQU   B'00001000'        OPEN/CLOSE/EOF PROCESSING IS COMPLETE
CAXMCT   EQU   B'00000100'        1-IDENTIFIES AN OS/VS2 MASTER CATALOG
*                                 0-IDENTIFIES AN OS/VS2 USER CATALOG
CAXCMR   EQU   B'00000010'        CATALOG MANAGEMENT HAS BEEN CALLED BY
*                                 ANOTHER CATALOG MANAGEMENT ROUTINE
CAXSCR   EQU   B'00000001'        1-CATALOG MANAGEMENT (SVC 26) HAS
*                                 BEEN CALLED BY THE OS/VS SCHEDULER
*                                 0-CATALOG MANAGEMENT (SVC 26) HAS
*                                 BEEN CALLED BY AN ACCESS METHOD
*                                 SERVICES PROCEDURE
CAXFLG2  DS    XL1                FLAGS:
CAXF2DT  EQU   B'10000000'        THE CATALOG HAS BEEN DELETED THE
*                                 FOLLOWING FLAGS ARE SET BY IFG0191X
*                                 AND IFG0200N:
CAXF2NDD EQU   B'01000000'        NO DDNAME FOUND
CAXF2NCR EQU   B'00100000'        UNABLE TO OBTAIN VIRTUAL STORAGE WITH
*                                 A GETMAIN REQUEST
CAXF2IOE EQU   B'00010000'        I/O ERROR
CAXF2CLR EQU   B'00001000'        RPL CLEANUP REQUEST
CAXF2CA  EQU   B'00000100'        IF AN ERROR OCCURS FREE THE CAXWA
CAXF2REC EQU   B'00000010'        RECOVERABLE CATALOG
CAXF2VTU EQU   B'00000001'        VOLUME TIME STAMP UPDATED
CAXFLG3  DS    XL1                FLAGS:
CAXF3AT  EQU   B'1000000'         CRA ALTERNATE TIOT EXISTS
CAXF3ANE EQU   B'0100000'         CRA DOES NOT EXIST
CAXF3ICF EQU   B'0010000'         ICF TYPE CATALOG
CAXRAC   EQU   B'0001000'         CATALOG IS RACF-DEFINED
CAXF3B5  EQU   B'0000110'         NO PASSWORDS
*              B'....00.'         PASSWORD NOT READ
CAXF3B6  EQU   B'0000010'         MASTER PASSWORD; NO UPDATE PASSWORD
*              B'0000100'         MASTER AND UPDATE PASSWORDS
CAXF3SO4 EQU   B'0000010'         ICF SHARE OPTION 3,4
CAXF3SHD EQU   B'0000001'         ICF CATALOG ON SHARED DASD
         DS    CL1                RESERVED (OLD - CAXACT)
CAXATIOT DS    A                  ADDRESS OF THE ALTERNATE TIOT
CAXCHWA  DS    A                  ADDRESS OF THE SCHEDULER WORK AREA
CAXDRWP  DS    0A                 ADDRESS OF THE CATALOG'S DRWA
CAXVDSPM DS    A                  VVDS PARAMETER LIST FOR CATALOG
CAXACB   DS    A                  ADDRESS OF THE CATALOG'S ACB
CAXUCB   DS    A                  ADDRESS OF THE UCB
CAXCCR   DS    0CL12              CATALOG CONTROL RECORD INFORMATION
CAXHACI  DS    XL3                CONTROL INTERVAL NUMBER OF THE
*                                 HIGHEST ALLOCATED CONTROL INTERVAL
*                                 IN THE CATALOG
CAXNFCI  DS    XL3                CONTROL INTERVAL NUMBER OF THE NEXT
*                                 FREE  CONTROL INTERVAL IN THE CATALOG
CAXCDCI  DS    XL3                NUMBER OF DELETED CONTROL INTERVALS
CAXFDCI  DS    XL3                CONTROL INTERVAL NUMBER OF THE FIRST
*                                 DELETED CONTROL INTERVAL IN THE
*                                 CATALOG
CAXASID  DS    H                  ASID FOR UCRA ACCESS
CAXRPLCT DS    H                  NUMBER OF RPLS ASSOCIATED WITH THE
*                                 CAXWA
CAXRPL   DS    A                  ADDRESS OF THE FIRST RPL IN THE
*                                 CAXWA'S RPL CHAIN
CAXCNAM  DS    0CL44              CATALOG'S DSNAME
CAXVOLID DS    CL6                CRA VOLUME SERIAL
CAXRACTS DS    XL4                CRA CREATION TIME STAMP
CAXRATEP DS    XL4                CRA'S TIOT ENTRY ADDRESS
CAXRADDN DS    CL8                CRA'S DDNAME
         DS    CL22               RESERVED FOR CRA
CAXOPLST DS    0F                 OPEN/CLOSE PARAMETER LIST:
COPTS    DS    X                  OPTION FLAGS:
CENLST   EQU   B'10000000'        END OF LIST INDICATOR
*        EQU   B'01111111'        RESERVED
COPACB   DS    AL3                ADDRESS OF THE CATALOG'S ACB
CAXOPEWA DS    A                  ADDRESS OF THE OPEN/CLOSE/EOV WORK
*                                 AREA
CAXCCA   DS    0A                 ADDRESS OF THE CCA
CAXPLOCK DS    A                  REPL POST LOCK
CAXJDE   DS    A                  ADDRESS OF THE JDE
CAXCRACB DS    A                  ADDRESS OF CRA'S ACB
CAXRACP  DS    A                  ADDRESS OF RAC PROFILE
CAXECB   DS    0F                 RPL WAIT ECB
CAXECBHB DS    B                  RPL WAIT ECB BYTE 1
CAXECBWB EQU   B'10000000'        WAIT BIT
CAXECBPB EQU   B'01000000'        POST BIT
*        EQU   B'00111111'        RESERVED
         DS    XL3                RESERVED
CAXASCBP DS    A                  ADDRESS OF THE ASCB
CAXHRPLW DS    0A                 HUNG RPL WORD
CAXHRPLC DS    H                  HUNG-UP RPL COUNT
CAXWNQID DS    H                  RPL WAIT ENQ ID
CAXLRECL DS    0A                 MAXIMUM ICF CATALOG RECORD SIZE
CAXSRATS DS    0XL8               ICF TIMESTAMP
CAXTMSTP DS    XL8                CATALOG CREATION TIMESTAMP
CAXACT   DS    XL2                CATALOG ACTIVITY COUNT
         DS    CL14               RESERVED
CAXLEN   EQU   *-IGGCAXWA         LENGTH OF CAXWA CONTROL BLOCK
         MEND
./ ADD NAME=IGGCCA   0100-00038-00038-1647-01050-01050-00000-MACRO
         MACRO ,
         IGGCCA
*/********************************************************************/
*/*                                                                  */
*/*   MACRO NAME = IGGCCA                                            */
*/*                                                                  */
*/*  5665-XA2                                                        */
*/*  CONTAINS RESTRICTED MATERIALS OF IBM                            */
*/*  (C) COPYRIGHT IBM CORP. 1980, 1986                              */
*/*  LICENSED MATERIALS - PROPERTY OF IBM                            */
*/*  REFER TO COPYRIGHT INSTRUCTIONS                                 */
*/*  FORM NUMBER G120-2083.                                          */
*/*                                                                  */
*/*   DESCRIPTIVE NAME = CATALOG COMMUNICATIONS AREA                 */
*/*                                                                  */
*/*   FUNCTION = THE CCA IS USED BY CATALOG MANAGEMENT TO PASS       */
*/*              INFORMATION BETWEEN ITS PROCEDURES.  THE CCA IS     */
*/*              BUILT EACH TIME AN OS/VS COMPONENT ISSUES THE CATLG */
*/*              MACRO INSTRUCTION (SVC 26) TO PROCESS A CATALOG     */
*/*              RECORD.  THE CCA CONTAINS INFORMATION ABOUT THE     */
*/*              CATALOG BEING PROCESSED, AND ABOUT THE CATALOG      */
*/*              RECORD AND ITS EXTENSIONS CONTAINED IN EACH OF      */
*/*              THE SIX BUFFERS AVAILABLE TO PROCESS THE USER'S     */
*/*              REQUEST.                                            */
*/*                                                                  */
*/*   CONTROL BLOCK STRUCTURE = THE CCA IS POINTED TO BY REGISTER 11 */
*/*                                                                  */
*/*   INCLUDED MACROS = NONE                                         */
*/*                                                                  */
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */
*/*                                                                  */
*/*   CREATED BY: CSECT IGG0CLXA                                     */
*/*                                                                  */
*/*   STATUS = SEE CHANGE ACTIVITY                               @LDC*/
*/*                                                                 */
*/*   DATE OF LAST CHANGE = 18 NOV 86                            @LDC*/
*/*   C 572000                                               @ZA24944*/
*/*   I 692260-692268, 692929                                @ZA27024*/
*/*   I 691305-330                                           @ZA30975*/
*/*   C 514000,690826,693355                                 @ZA29164*/
*/*   I 514300-515600,690827-690828,693256                   @ZA29164*/
*/*   A 029500                                               @ZA32179*/
*/*   A 692268                                               @ZA32362*/
*/*   A 691301                                               @ZA35467*/
*/*   A 691326                                               @ZA35552*/
*/*   A 691328                                               @ZA37804*/
*/*   &L5=ICFCAT,JDM1113,T790080,STLPCJ: DF/EF CATALOG SUPPORT   @L5A*/
*/*   &L5=ICFCAT,JDM1113,T790080,STLSMR: DF/EF CATALOG SUPPORT   @L5B*/
*/*   &L5=ICFCAT,JDM1113,T790080,STLRML: DF/EF CATALOG SUPPORT   @L5C*/
*/*                                                          @ZA56100*/
*/*                                                          @ZA59976*/
*/*                                                          @ZA66330*/
*/*                                                          @ZA68551*/
*/*                                                          @ZA66330*/
*/*   &LX=DFP,JDP1111,,STLBFY:  S/XA DFP RELEASE 1 VERSION 2     @LXA*/
*/*                                                          @ZA69530*/
*/*                                                          @ZA72135*/
*/*   &PA=DFP,HDP2210,,STLHES:MVS/XA DFP V2R1M0                  @PAS*/
*/*   &SC=GFL,JDP2110,,STLSSC: DFP/XA 2.1.1 GENERIC FILTER LOCATE@SCA*/
*/*                                                          @ZA77401*/
*/*  $LD=DEVSUP,JDP2223,,STLSSG: GREATER THAN 32K TRACKS         @LDA*/
*/*                                                          @ZA91958*/
*/********************************************************************/
         SPACE 1
IGGCCA   DSECT ,                    /* SET BASE TO CCA               */
CCAID    DS    XL2                  /* CCA  ID = 'ACCA'X     @Y30SSPJ*/
CCASZ    DS    XL2                  /* SIZE OF CCA           @Y30SSPJ*/
CCAPROB  DS    0XL4                 /* PROBLEM DETERMINATION WORD
*                                                            @Y30SSPJ*/
CCAMODID DS    CL2                  /* ERROR MODULE ID       @Y30SSPJ*/
CCAERRCD DS    0XL2                 /* ERROR CODES           @Y30SSPJ*/
CCAREASN DS    0XL1                 /* SET REASON CODE       @Y30SSPJ*/
CCACDR   DS    XL1                  /* REFER REASON CODE     @Y30SSPJ*/
CCARETRN DS    0XL1                 /* SET RETURN CODE       @Y30SSPJ*/
CCACD1   DS    XL1                  /* REFER REASON CODE     @Y30SSPJ*/
CCAID2   DS    CL3                  /* ID=CCA                    @PAS*/
CCARACP  DS    XL1                  /* RAC CHECKED FIELD     @ZA77401*/
*        DS    XL1                     RESERVED                  @SCD*/
CCAFLG0  DS    XL1                  /* FLAGS                     @SCA*/
CCAF0SEQ EQU   B'10000000'          /* SEQUENTIAL I/O            @SCA*/
CCAF0NSP EQU   B'01000000'          /* NOTE STRING POSITION      @SCA*/
*        EQU   B'00111111'          /* RESERVED                  @SCA*/
CCACD2   DS    XL1                  /* RETURN CODE 2                 */
CCAFLG1  DS    XL1                  /* FLAGS                         */
CCAF1LPS EQU   B'10000000'          /* STOP LOOP IF ON               */
CCAF1CNS EQU   B'01000000'          /* CATALOG NAME SEARCH     Y02020*/
CCAF1LRD EQU   B'00100000'          /* CCR READ INTO CORE            */
CCAF1KEY EQU   B'00010000'          /* GET BY TRUE NAME              */
CCAF1KGE EQU   B'00001000'          /* GET NEXT                      */
CCAF1CR  EQU   B'00000100'          /* CHKPT CCR REQ                 */
CCAF1UP  EQU   B'00000010'          /* GET FOR UPDATE                */
CCAF1DK  EQU   B'00000001'          /* DELETE, KEEP CI               */
CCAFLG2  DS    XL1                  /* FLAGS                         */
CCAF2SYS EQU   B'10000000'          /* SYSTEM CALLER                 */
CCAF2NVC EQU   B'01000000'          /* NO VALIDITY CHECK             */
CCAF2CCT EQU   B'00100000'          /* 0 = CONCAT CTLG SEARCH        */
*                                   /* 1 = SINGLE CTLG SEARCH        */
CCAF2XEQ EQU   B'00010000'          /* 0 = SHARED ENQ,               */
*                                   /* 1 = EXCLUSIVE ENQ             */
CCAF2RHS EQU   B'00001000'          /* RECURSIVE CALL TO CATLG       */
CCAF2COB EQU   B'00000110'          /* COMB. OF CATLG OPEN/BUILD     */
CCAF2CO  EQU   B'00000100'          /* CATLG BEING OPENED            */
CCAF2CB  EQU   B'00000010'          /* CATLG OPEN DURING BUILD       */
CCAF2SMO EQU   B'00000001'          /* SEARCH MASTER CATLG ONLY      */
CCAFLG3  DS    XL1                  /* FLAGS                         */
CCAEXGR1 EQU   B'10000000'          /* EXIT INDICATOR                */
CCAGC4   EQU   B'01000000'          /* GROUP CODE 4 IN SCNC          */
CCAGDSP  EQU   B'00100000'          /* GENDSP                        */
CCAEXGR2 EQU   B'00010000'          /* EXIT INDICATOR                */
CCANF    EQU   B'00001000'          /* NOT FOUND CONDITION           */
CCAELC2  EQU   B'00000100'          /* EXIT INDICATOR                */
CCALFT   EQU   B'00000010'          /* FIRST TIME                    */
CCAEGREC EQU   B'00000001'          /* EXIT INDICATOR                */
CCAFLG4  DS    XL1                  /* FLAGS                         */
CCAF4DRQ EQU   B'10000000'          /* DEQ REQD                      */
CCAF4BYS EQU   B'01000000'          /* BYPASS SECURITY               */
CCAGVNC  EQU   B'00100000'          /* NOT COMPLETE                  */
CCAGVNF  EQU   B'00010000'          /* RELREPNO NOT FOUND            */
CCAFVNBS EQU   B'00001000'          /* NO BUFFER SPACE               */
CCAGVEX  EQU   B'00000100'          /* EXIT BIT                      */
CCAGVNE  EQU   B'00000010'          /* NON-EXISTENT FIELD            */
CCATCOMP EQU   B'00000001'          /* TEST COMPLETE                 */
CCAFLG5  DS    XL1                  /* FLAGS                         */
CCAMEX2  EQU   B'10000000'          /* EXIT INDICATOR                */
CCAMEX   EQU   B'01000000'          /* EXIT BIT                      */
CCAMEX1  EQU   B'00100000'          /* EXIT BIT                      */
CCAMODPA EQU   B'00010000'          /* PUT-ADD                       */
CCATHIT  EQU   B'00001000'          /* SUCCESSFUL TEST               */
CCATEX   EQU   B'00000100'          /* EXIT INDICATOR                */
CCATEX1  EQU   B'00000010'          /* EXIT INDICATOR                */
CCATEX2  EQU   B'00000001'          /* EXIT INDICATOR                */
CCAFLG6  DS    XL1                  /* FLAGS                         */
CCAMCODR EQU   B'10000000'          /* DEQ REQ SW                    */
CCADELP  EQU   B'01000000'          /* DELETED GOP                   */
CCAMNOSP EQU   B'00100000'          /* NO SPACE IN MOVE OCCUR        */
CCAINIT  EQU   B'00010000'          /* INSERT INIT SW FOR VAR FIELD  */
CCASUPFD EQU   B'00001000'          /* SUPPRESS FIELD INFO           */
CCAREUSE EQU   B'00000100'          /* RE-USE RECORD AREAS           */
CCAEXT   EQU   B'00000010'          /* EXTRACT IN PROCESS            */
CCAMOD   EQU   B'00000001'          /* MODIFY IN PROCESS             */
CCATCB   DS    0A                   /* PTR TO TCB                    */
CCALBCYL DS    A                    /* LABEL CYLINDER DATA PTR       */
CCARB    DS    0A                   /* PTR TO RB                     */
CCADPL   DS    A                    /* DADSM PARAMETER LIST PTR      */
CCACPL   DS    A                    /* PTR TO CPL                    */
CCAACB   DS    A                    /* PTR TO CATALOG ACB            */
CCANPCCB DS    A                    /* PTR TO NEXT PCCB IN CHAIN     */
CCAURAB  DS    A                    /* PTR TO RAB IN USE             */
CCASRCH2 DS    0CL45                /* ICF SEARCH ARGUMENT       @L5A*/
CCASRCH  DS    0CL44                /* SEARCH ARGUMENT           @L5A*/
CCASRCHM DS    0CL44                /* SIGNIFICANT KEY           @L5A*/
CCASRVVD DS    0CL11                /* "SYS1.VVDS.V" NAME PART   @L5A*/
CCASRID  DS    0XL3                 /* CI NUMBER                 @L5A*/
CCASRID2 DS    0XL3                 /* TOKEN CI NUMBER           @L5A*/
CCASRCIN DS    0XL3                 /* CI NUMBER                 @L5A*/
CCASRCI2 DS    XL3                  /* TOKEN CI                  @L5A*/
         DS    XL8                  /* RESERVED                  @L5A*/
CCASRVVV DS    XL6                  /* VVDS VOLUME SERIAL        @L5A*/
CCASRVVP DS    XL27                 /* REMAINDER OF VVDS KEY     @L5A*/
CCASRCHP DS    XL1                  /* PAD CHARACTER             @L5A*/
CCAFLG13 DS    XL1                  /* FLAG 13 BYTE              @L5A*/
CCAUDVVR EQU   B'10000000'          /* UPDATE CATALOG DATA VVR
*                                                                @L5A*/
CCAUIVVR EQU   B'01000000'          /* UPDATA CATALOG INDEX VVR
*                                                                @L5A*/
CCAUSVVR EQU   B'00100000'          /* UPDATE CATALOG SEQUENCE SET VVR
*                                                                @L5A*/
CCADQCAT EQU   B'00010000'          /* REMEMBER SYSIGGV2 ENQ @ZA38467*/
CCAGDGDL EQU   B'00001000'          /* DELETE NONVSAM GDG    @ZA41725*/
CCASVTNE EQU   B'00000100'          /* SAVE TRUE NAME BIT        @L5A*/
CCADLNVS EQU   B'00000010'          /* NONVSAM SCRATCH ERR   @ZA38467*/
CCANODMP EQU   B'00000001'          /* PREVENT DUMP          @ZA38467*/
         DS    XL2                  /* RESERVED                  @L5A*/
CCARAB0  DS    0CL20                /* RECORD AREA BLOCK 0           */
CCAR0FLG DS    XL1                  /* CCARAB0 FLAGS                 */
CCAR0UR  EQU   B'10000000'          /* RAB IN-USE EXT, MOD           */
CCAR0U1  EQU   B'01000000'          /* RAB IN-USE TESTS              */
CCAR0U2  EQU   B'00100000'          /* RAM IN-USE TESTS              */
CCAR0WR  EQU   B'00010000'          /* WRITE IT BEFORE READ          */
CCAR0PA  EQU   B'00001000'          /* PUT-ADD WRITE                 */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR0UPD EQU   B'00000001'          /* UPDATE BUFFER NOT REUSED      */
CCAR0RPL DS    XL1                  /* LAST ASSIGN, RPL INDEX        */
         DS    XL2                  /* RESERVED                      */
CCAR0REC DS    A                    /* PTR TO RECORD AREA            */
CCAR0SEG DS    0CL12                /* SEGMENT PTRS                  */
CCACPE20 DS    A                    /* PTR REPEATING CONTROL INFO    */
CCACPE30 DS    A                    /* PTR TO FIRST OCCURRENCE       */
CCACPE40 DS    A                    /* PTR TO END OF RECORD          */
CCARAB1  DS    0CL20                /* RECORD AREA BLOCK 1           */
CCAR1FLG DS    XL1                  /* FLAGS                         */
CCAR1UR  EQU   B'10000000'          /* SAME AS CCAR0UR               */
CCAR1U1  EQU   B'01000000'          /* SAME AS CCAR0U1               */
CCAR1U2  EQU   B'00100000'          /* SAME AS CCAR0U2               */
CCAR1WR  EQU   B'00010000'          /* SAME AS CCAR0WR               */
CCAR1PA  EQU   B'00001000'          /* SAME AS CCAR0PA               */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR1UPD EQU   B'00000001'          /* SAME AS CCAR0UPD              */
CCAR1RPL DS    XL1                  /* SAME AS CCAR0RPL              */
         DS    XL2                  /* RESERVED                      */
CCAR1REC DS    A                    /* SAME AS CCAR0REC              */
CCAR1SEG DS    0CL12                /* SAME AS CCAR0SEG              */
CCACPE21 DS    A                    /* SAME AS CCACPE20              */
CCACPE31 DS    A                    /* SAME AS CCACPE30              */
CCACPE41 DS    A                    /* SAME AS CCACPE40              */
CCARAB2  DS    0CL20                /* RECORD AREA BLOCK 2           */
CCAR2FLG DS    XL1                  /* FLAGS                         */
CCAR2UR  EQU   B'10000000'          /* SAME AS CCAR0UR               */
CCAR2U1  EQU   B'01000000'          /* SAME AS CCAR0U1               */
CCAR2U2  EQU   B'00100000'          /* SAME AS CCAR0U2               */
CCAR2WR  EQU   B'00010000'          /* SAME AS CCAR0WR               */
CCAR2PA  EQU   B'00001000'          /* SAME AS CCAR0PA               */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR2UPD EQU   B'00000001'          /* SAME AS CCAR0UPD              */
CCAR2RPL DS    XL1                  /* SAME AS CCAR0RPL              */
         DS    XL2                  /* RESERVED                      */
CCAR2REC DS    A                    /* SAME AS CCAR0REC              */
CCAR2SEG DS    0CL12                /* SAME AS CCAR0SEG              */
CCACPE22 DS    A                    /* SAME AS CCACPE20              */
CCACPE32 DS    A                    /* SAME AS CCACPE30              */
CCACPE42 DS    A                    /* SAME AS CCACPE40              */
CCARAB3  DS    0CL20                /* RECORD AREA BLOCK 3           */
CCAR3FLG DS    XL1                  /* FLAGS                         */
CCAR3UR  EQU   B'10000000'          /* SAME AS CCAR0UR               */
CCAR3U1  EQU   B'01000000'          /* SAME AS CCAR0U1               */
CCAR3U2  EQU   B'00100000'          /* SAME AS CCAR0U2               */
CCAR3WR  EQU   B'00010000'          /* SAME AS CCAR0WR               */
CCAR3PA  EQU   B'00001000'          /* SAME AS CCAR0PA               */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR3UPD EQU   B'00000001'          /* SAME AS CCAR0UPD              */
CCAR3RPL DS    XL1                  /* SAME AS CCAR0RPL              */
         DS    XL2                  /* RESERVED                      */
CCAR3REC DS    A                    /* SAME AS CCAR0REC              */
CCAR3SEG DS    0CL12                /* SAME AS CCAR0SEG              */
CCACPE23 DS    A                    /* SAME AS CCACPE20              */
CCACPE33 DS    A                    /* SAME AS CCACPE30              */
CCACPE43 DS    A                    /* SAME AS CCACPE40              */
CCARAB4  DS    0CL20                /* RECORD AREA BLOCK 4           */
CCAR4FLG DS    XL1                  /* FLAGS                         */
CCAR4UR  EQU   B'10000000'          /* SAME AS CCAR0UR               */
CCAR4U1  EQU   B'01000000'          /* SAME AS CCAR0U1               */
CCAR4U2  EQU   B'00100000'          /* SAME AS CCAR0U2               */
CCAR4WR  EQU   B'00010000'          /* SAME AS CCAR0WR               */
CCAR4PA  EQU   B'00001000'          /* SAME AS CCAR0PA               */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR4UPD EQU   B'00000001'          /* SAME AS CCAR0UPD              */
CCAR4RPL DS    XL1                  /* SAME AS CCAR0RPL              */
         DS    XL2                  /* RESERVED                      */
CCAR4REC DS    A                    /* SAME AS CCAR0REC              */
CCAR4SEG DS    0CL12                /* SAME AS CCAR0SEG              */
CCACPE24 DS    A                    /* SAME AS CCACPE20              */
CCACPE34 DS    A                    /* SAME AS CCACPE30              */
CCACPE44 DS    A                    /* SAME AS CCACPE40              */
CCARAB5  DS    0CL20                /* RECORD AREA BLOCK 5           */
CCAR5FLG DS    XL1                  /* FLAGS                         */
CCAR5UR  EQU   B'10000000'          /* SAME AS CCAR0UR               */
CCAR5U1  EQU   B'01000000'          /* SAME AS CCAR0U1               */
CCAR5U2  EQU   B'00100000'          /* SAME AS CCAR0U2               */
CCAR5WR  EQU   B'00010000'          /* SAME AS CCAR0WR               */
CCAR5PA  EQU   B'00001000'          /* SAME AS CCAR0PA               */
*        EQU   B'00000110'          /* RESERVED                      */
CCAR5UPD EQU   B'00000001'          /* SAME AS CCAR0UPD              */
CCAR5RPL DS    XL1                  /* SAME AS CCAR0RPL              */
         DS    XL2                  /* RESERVED                      */
CCAR5REC DS    A                    /* SAME AS CCAR0REC              */
CCAR5SEG DS    0CL12                /* SAME AS CCAR0SEG              */
CCACPE25 DS    A                    /* SAME AS CCACPE20              */
CCACPE35 DS    A                    /* SAME AS CCACPE30              */
CCACPE45 DS    A                    /* SAME AS CCACPE40              */
CCARPLK  DS    XL1                  /* ASSIGNED RPL COUNT            */
CCARPLF  DS    XL1                  /* INDEX TO FOUND RPL            */
CCARPLX  DS    XL1                  /* WORK BYTE FOR SUBFUNCTION     */
*                                   /* IGGPRPLM                      */
CCARPLT  DS    XL1                  /* WORK BYTE FOR SUBFUNCTION     */
*                                   /* IGGPRPLM                      */
CCATIQRN DS    0XL6                 /* TIOT ENQ MINOR NAME   @Y30SSPJ*/
CCATASID DS    XL2                  /* ASID                  @Y30SSPJ*/
CCATQDB  DS    XL4                  /* QDB ADDRESS           @Y30SSPJ*/
CCASC    DS    XL1                  /* SEARCH CODE             Y02020*/
CCAQLEN  DS    XL1                  /* QUALIFIER LENGTH  0    Y02020*/
CCARPL1  DS    A                    /* PTR TO RPL IN USE             */
CCADESA  DS    0CL44                /* DADSM EXTENTS SAVEAREA        */
CCANDEXT DS    XL1                  /* COUNT OF EXTENTS              */
CCAIXEXT DS    XL1                  /* EXTENT INDEX VALUE            */
CCASSVOL DS    XL2                  /* DATA SET DIR SEQ NO.          */
CCAEXTDE DS    0CL40                /* EXTENTS DESCRIPTORS           */
CCAEXTSS DS    XL2                  /* DESCRIPTOR SPACE SEQ. NO.     */
CCAEXTAD DS    0XL4                 /* EXTENT STARTING CCHH          */
CCAEXTCC DS    XL2                  /* STARTING CYLINDER             */
CCAEXTHH DS    XL2                  /* STARTING TRACK                */
CCAEXTTH DS    XL2                  /* # TRACKS IN EXT           @LDA*/
         DS    XL32                 /*                               */
CCAASCIK DS    XL1                  /* COUNT OF CI'S REQD            */
CCACRRP  DS    XL1                  /* RPL USED TO READ CCR          */
CCAASCIX DS    XL1                  /* ASSIGNED CI ARRAY INDEX       */
CCAASCI  DS    XL9                  /* ASSIGNED CI NUMBERS           */
CCAEQDQ  DS    0CL16                /* ENQ/DEQ PARAMETER LIST        */
CCAEDXFF DS    XL1                  /* END OF PL IND BYTE            */
CCAEDRLN DS    XL1                  /* LENGTH OF MINOR NAME          */
CCAEDOPT DS    XL1                  /* ENQ-DEQ OPTIONS               */
CCAEDSHR EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE         */
*              B'01111111'          /* OTHER OPT. (SET BY MACRO)     */
CCAEDRCD DS    XL1                  /* ENQ/DEQ RETURN CODE           */
CCAEDQNM DS    A                    /* MAJOR NAME PTR                */
CCAEDRNM DS    A                    /* MINOR NAME PTR                */
CCAEDUCB DS    A                    /* UCB PTR                       */
CCAMLRET DS    A                    /* MAIN LINE RTN SAVE AREA PTR   */
CCAMSSPL DS    0CL12                /* STORAGE MGMT WORKAREA         */
CCAMNLLP DS    XL4                  /* LENGTH OF LIST POINTER  Y02020*/
CCAMNPTR DS    A                    /* ADDRESS OF THE RETURN ADDRESS */
         DS    XL1                  /* STORAGE MANAGEMENT BYTE       */
CCAMNSPL DS    XL1                  /* REQUIRED SUBPOOL              */
         DS    XL2                  /* STORAGE MANAGEMENT AREA       */
CCARPRM  DS    A                    /* RETURN PARMS                  */
CCACMS   DS    0CL8                 /* CMS AREA                      */
CCACMSWA DS    A                    /* PTR TO CMS WORK AREA          */
CCAEXCMS DS    A                    /* SECONDARY CMS WORK AREA ADDR  */
CCALUME  EQU   *                    /* START OF FIELD MGMT WORK AREA */
*                                   /* AND INTERFACE VARIABLES FOR   */
*                                   /* LOCATE, UPDATE, MODIFY, AND   */
*                                   /* EXTRACT ROUTINES              */
CCACPE5  DS    A                    /* ADDR OF OCCURRENCE PTR        */
CCACPE51 DS    A                    /* ALTERNATE PTR TO GOP          */
CCACPE52 DS    A                    /* ALT GOP PTR                   */
CCACPE53 DS    A                    /* ALT GOP PTR                   */
CCACPE6  DS    A                    /* ADDR OF OCCURRENCE            */
CCACPE61 DS    0A                   /* ALT PTR TO OCCURRENCE         */
CCARABSE DS    A                    /* SAVE EXTRACT CALLER URAB      */
CCACPE7  DS    0A                   /* ADDR OF FIELD VALUE           */
CCAIDPT  DS    A                    /* INSERT DATA ADDR              */
CCACPE71 DS    A                    /* ALT PTR TO FIELD VALUE        */
CCAGOPLN DS    XL2                  /* GROUP OCCURRENCE PTR LENGTH   */
CCASL    DS    XL2                  /* SEQUENCE NUMBER LENGTH        */
CCAILNG  DS    XL4                  /* INSERT LENGTH                 */
CCAFLPT  DS    0A                   /* FIELD LIST POINTER            */
CCATFLPT DS    A                    /* FIELD LIST PTR FOR TESTS      */
CCARABPT DS    A                    /* RAB PTR                       */
CCADICT  DS    CL4                  /* DICTIONARY INFO               */
CCAXCPL  DS    0A                   /* EXTRACT CPL PTR               */
CCAMCPL  DS    A                    /* MODIFY CPL PTR                */
CCARABB  DS    A                    /* BASE RAB PTR                  */
CCARABF  DS    A                    /* FIRST RAB PTR                 */
CCARABL  DS    A                    /* LAST RAB PTR                  */
CCACBASE DS    XL3                  /* BASE CI NUMBER                */
CCAGC    DS    XL1                  /* GROUP CODE                    */
CCALREL  DS    0XL2                 /* LOGICAL RELREPNO              */
CCALREL1 DS    XL2                  /* LOGICAL RELREPNO              */
CCASN    DS    0XL2                 /* SEQUENCE NO.                  */
CCASN1   DS    XL2                  /* SEQUENCE NO.                  */
CCAUSKEY DS    XL1                  /* USER KEY              @ZA29164*/
CCAMSFLG DS    XL1                  /* MISC. FLAGS           @ZA29164*/
CCACICIN EQU   B'10000000'          /* INTEGRITY CHECK       @ZA29164*/
*                                   /* INCOMPLETE            @ZA29164*/
CCACPLOK EQU   B'01000000'          /* CPL IS VALID          @ZA29164*/
CCASKYSS EQU   B'00100000'          /* CALLER HAS SYSTEM KEY @ZA29164*/
*                                   /* OR IS IN SUPERVISOR   @ZA29164*/
*                                   /* SUPERVISOR STATE      @ZA29164*/
CCAGDGUY EQU   B'00010000'          /* AUTHORIZED CALLER     @ZA29164*/
CCANCIPT EQU   B'00001000'          /* NEW CIPT BUILT            @L5A*/
CCACISOP EQU   B'00000100'          /* CIS OPTION.               @L5A*/
*                                   /*   0 - GET TOKEN NAME      @L5A*/
*                                   /*   1 - GET CI TOKEN        @L5A*/
CCACIABK EQU   B'00000010'          /* CIS ABREVIATED KEY        @L5A*/
CCACIGVN EQU   B'00000001'          /* CI NAME GIVEN             @L5A*/
CCAIXFPL DS    XL2                  /* FIELD ARAY INDEX              */
CCAIXREL DS    XL2                  /* INDEX RELREPNO                */
CCATNREL DS    XL2                  /* NEXT RELREPNO                 */
CCATNUM  DS    XL2                  /* NO. OF SUCCESSFUL RELREPNOS   */
CCATREL  DS    CL32                 /* SUCCESSFUL REL REPNOS         */
CCATNO   DS    XL2                  /* TOTAL NO. SUCCESSFUL RELREPNOS*/
CCATEST  DS    A                    /* TEST FIELD PTR                */
CCARBA   DS    0CL20                /* EXTENT HOLDER FIELD           */
CCACRAVL DS    0CL6                 /* CRA VOLSER            @Y30SSRS*/
CCASS    DS    XL2                  /* SPACE DESCRIPTOR      @Y30SSRS*/
*                                   /* SEQUENCE NO.          @Y30SSRS*/
CCACCHH1 DS    XL4                  /* CCHH-LOW              @Y30SSRS*/
CCACRADT DS    0XL4                 /* CRA DEVICE TYPE       @Y30SSRS*/
CCACCHH2 DS    XL4                  /* CCHH-HIGH             @Y30SSRS*/
CCATT    DS    XL2                  /* TT-NO. TRACKS             @LDA*/
CCARBA1  DS    XL4                  /* RBA-LOW                       */
CCARBA2  DS    XL4                  /* RBA-HIGH                      */
CCATLNG  DS    0XL2                 /* TESTED EXTENT LENGTH          */
CCATLEN  DS    XL2                  /* MODIFIED VAR LENGTH           */
CCARBAL  DS    XL2                  /* RBA EXTENT BALANCE            */
CCACNIX  DS    XL2                  /* COMBINATION NAME INDEX        */
CCASMFIX DS    XL2                  /* DEFINE CATALOG SMF INDEX      */
CCAIDPT2 DS    A                    /* AVAILABLE SPACE IN WORK AREA  */
CCAIDPT3 DS    0A                   /* INCOMPLETE VAR FIELDS         */
CCARABSM DS    A                    /* SAVE MODIFY CALLER URAB       */
CCAGVCT  DS    XL2                  /* COUNTER                       */
CCANEVV  DS    XL2                  /* NON-EXISTENT VARIABLE         */
*                                   /* VALUE LENGTH                  */
CCAGVEXT DS    XL3                  /* EXTENSION RCD POINTER         */
CCANEFV  DS    XL1                  /* NON-EXISTENT FIXED FALUE      */
CCASAVID DS    XL1                  /* SAVE RECORD ID        @ZA24944*/
CCAGRGC  DS    0XL1                 /* GROUP CODE                    */
CCARCDID DS    XL1                  /* RECORD ID             @Y30SSRS*/
CCAGRHI  DS    0XL2                 /* HIGH RELREPNO         @Y30SSRS*/
CCASSEQ  DS    0XL2                 /* SAVE SEQ. NO.         @Y30SSRS*/
CCAGRHI1 DS    XL2                  /* HIGH RELREPNO         @Y30SSRS*/
CCAIXTPL DS    XL2                  /* INDEX TO TEST FPL             */
CCADLEN  DS    XL2                  /* MODIFY DELETE LENGTH          */
CCADIFF  DS    XL2                  /* SPACE DIFFERENCE              */
CCAREPCT DS    XL2                  /* RELREPNO COUNT                */
CCADISP  DS    XL2                  /* DISPLACEMENT INTO VAR FIELD   */
CCASVCI  DS    XL3                  /* SAVE CI OF BASE               */
CCASVCI1 DS    XL3                  /* SAVE SPACE CI                 */
CCADTA   DS    A                    /* DICTIONARY PTR                */
CCACDTA  DS    A                    /* INDEX COMBO TABLE PTR         */
CCADTCT  DS    XL2                  /* COUNT DICT ENTRIES            */
CCACDTCT DS    XL2                  /* COUNT INDEX COMB TABLE        */
CCACWAP  DS    A                    /* CONTROLLER WORK AREA          */
CCASDWAP DS    A                    /* POINTER TO SDWA         Y02020*/
CCAILNG3 DS    A                    /* MODIFY LENGTH                 */
CCAILNG2 DS    A                    /* MODIFY LENGTH                 */
CCAALPTR DS    A                    /* SPACE MNGMT SUB-FUNCTION WA   */
CCASMFPT DS    A                    /* SMF DATA PTR                  */
CCALCPL  DS    A                    /* LSPACE CPL PTR - INTERNAL CALL*/
CCAFLG7  DS    XL1                  /* FLAGS                         */
CCALSP   EQU   B'10000000'          /* LSPACE INTERNAL CALL          */
CCASMFEX EQU   B'01000000'          /* SMF EXIT INDICATOR            */
CCASMFA  EQU   B'00100000'          /* DO SMF IN MODIFY              */
CCASMFBR EQU   B'00010000'          /* DO GET FOR BASE RECORD        */
CCAONCE  EQU   B'00001000'          /* MOVE ONLY ONE OCCURRENCE      */
CCAROREQ EQU   B'00000100'          /* READ-ONLY REQUEST             */
CCAFEOV  EQU   B'00000010'          /* FORCE EOV                     */
CCACRABU EQU   B'00000001'          /* CRA BEING BUILT        @Y30SSPJ/
CCAFLG8  DS    XL1                  /* FLAGS                  @Y30SSPJ/
CCADSRCL EQU   B'10000000'          /* DEFINE SPACE           @Y30SSPJ/
*                                   /*   RECURSIVE CALL       @Y30SSPJ/
CCAVBUFI EQU   B'01000000'          /* VOL RECORDS BUFFERED   @Y30SSPJ/
CCASCRA  EQU   B'00100000'          /* SUPRESS CRA UPDATES    @Y30SSPJ/
CCASCICK EQU   B'00010000'          /* SUPPRESS CRA CI CHECK @Y30SSSB*/
CCALPIND EQU   B'00001000'          /* LOOP CONTROL IN BUFFER        */
*                                   /*   SCAN FOR GETS       @Y30SSSB*/
CCAVRIND EQU   B'00000100'          /* VOLUME RECORD BUFFER CHAIN    */
*                                   /*   TO BE CHECKED       @Y30SSSB*/
CCALEOD  EQU   B'00000010'          /* EOF ON LOW KEYS       @Y30SSSB*/
CCAAUCAT EQU   B'00000001'          /* VOLUME HAS UCAT       @Y30LSPS*/
CCAFLG9  DS    XL1                  /* FLAGS                 @Y30SSSB*/
CCARABYC EQU   B'10000000'          /* BYPASS CAT I/O        @Y30SSSB*/
CCARAEOV EQU   B'01000000'          /* CRA EOV               @Y30SSSB*/
CCARALRD EQU   B'00100000'          /* CRA CCR HAS BEEN READ @Y30SSSB*/
CCARACR  EQU   B'00010000'          /* CRA CCR CHK PT REQD   @Y30SSSB*/
CCAUCRA  EQU   B'00001000'          /* USE UCRA TRANS TAB    @Y30SSSB*/
CCARAACT EQU   B'00000100'          /* CRA ACTIVE            @Y30SSSB*/
CCARAICI EQU   B'00000010'          /* INHIBIT CAT I/O       @Y30SSSB*/
CCARESUM EQU   B'00000001'          /* ON = REPLACE SUM,ELSE @Y30SSSB*/
*                                   /* OFF = INCREMENT SUM   @Y30SSSB*/
CCANORBA DS    XL1                  /* NO. OF RBA'S THAT ARE         */
*                                   /* NEEDED IN CB STRT     @Y30SSSB*/
CCASMFRD DS    A                    /* SMF RECORD POINTER            */
CCASMFCT DS    XL2                  /* COUNT OF SMF RECORDS          */
CCASMFLG DS    0XL2                 /* SMF RECORD FLAGS              */
CCASMFG1 DS    XL1                  /* SMF FLAGS                     */
CCASMFUC EQU   B'10000000'          /* UNCATALOG - SMF RCD 67        */
*                                   /* (ALWAYS SET ON)               */
CCASMFDF EQU   B'10000000'          /* DEFINE - SMF RCD 63           */
CCASMFSR EQU   B'01000000'          /* SCRATCH - SMF RCD 67. SET ON  */
*                                   /* ONLY IF RECORD ID IS D, I OR A*/
CCASMFAL EQU   B'01000000'          /* ALTER - SMF RCD 63            */
*              B'00111111'          /* RESERVED                      */
CCASMFG2 DS    XL1                  /* SMF FLAGS FOR ICF             */
CCASMFVV EQU   B'10000000'          /* SMF CALLED BY VVDS MANAGER    */
CCASMFIN EQU   B'01000000'          /* VVR INSERTED                  */
CCASMFDE EQU   B'00100000'          /* VVR DELETED                   */
CCASMFUP EQU   B'00010000'          /* VVR UPDATED                   */
CCASMFBY EQU   B'00001000'          /* BYPASS SMF WRITE IF SHARED    */
*                                   /* CATALOG VVRCFVFY CHANGE ONLY  */
*              B'00000111'          /* RESERVED                      */
CCASMFLN DS    XL2                  /* SMF RECORD LENGTH             */
CCACHAIN DS    XL3                  /* CHAIN CI NO. - START OF VOLUME*/
*                                   /* ENTRY TRANSLATION WORKAREA    */
CCACI1   DS    XL3                  /* SAVE CI AREA                  */
CCACI2   DS    XL3                  /* SAVE CI AREA                  */
CCACI3   DS    XL3                  /* SAVE CI AREA                  */
CCAVARLN DS    XL2                  /* INSERT LENGTH                 */
CCARRAB  DS    A                    /* RELATIVE BASE RAB ADDR        */
CCARBASE DS    A                    /* RELATIVE BASE RAB ADDR        */
CCAVARPT DS    A                    /* POINTER TO INSERT INFO        */
CCADELN  DS    XL2                  /* DELETE LENGTH                 */
CCAVAR   DS    CL20                 /* INSERT INFO SAVE AREA         */
CCAVAR1  DS    CL20                 /* INSERT INFO SAVE AREA         */
CCADEL1  DS    XL3                  /* START DELETE CI               */
CCADEL2  DS    XL3                  /* END DELETE CI                 */
CCAXLATE DS    CL40                 /* TRANSLATION WORK AREA         */
CCAR14S  DS    XL4                  /* CLC9 REG 14 SAVE AREA         */
CCABMINP DS    0CL8                 /* INPUT PARAMETERS              */
CCABMTRK DS    XL2                  /* STARTING TRACK            @LDA*/
CCABMLIM DS    XL2                  /* CHECK LIMIT, NN FOR       @LDA*/
CCABMMIN DS    XL2                  /* COND CHECK MINIMUM        @LDA*/
CCABMFLG DS    XL1                  /* STATE AND FUNCTION CODE       */
CCABMST  EQU   B'10000000'          /* STATE TO SET/COND. CHECK      */
CCABMCHK EQU   B'01000000'          /* ON = PERFORM CHECK            */
CCABMSET EQU   B'00100000'          /* ON = PERFORM SET              */
CCABMCCK EQU   B'00010000'          /* ON = PERFORM COND. CHECK      */
CCABMLST EQU   B'00001000'          /* ON = LAST SET REQ (WRITE)     */
*              B'00000111'          /* RESERVED                      */
         DS    XL1                  /* RESERVED                      */
CCABMOUT DS    0CL5                 /* OUTPUT PARAMETERS             */
CCABMONN DS    XL2                  /* TRK NUMBER (CK/COND)      @LDA*/
CCABMOTR DS    XL2                  /* STARTING TRK(CONDCHK.)    @LDA*/
CCABMOFG DS    XL1                  /* OUTPUT FLAGS                  */
CCABMOST EQU   B'10000000'          /* STATE OF BITS (CHECK)         */
*              B'01111111'          /* RESERVED                      */
CCASMFS2 DS    XL1                  /* SMFG2 SAVE FOR VVR WRITE      */
         DS    CL1                  /* RESRVED               @Z40WSPJ*/
CCABMPAD DS    CL1                  /* PADDING CHARACTER             */
CCABMGOP DS    A                    /* CURRENT BIT MASK GOP          */
CCABMPTR DS    A                    /* CURRENT BIT MASK BYTE         */
CCABMEND DS    A                    /* END OF CURRENT BIT MASK       */
CCABMBT1 DS    XL2                  /* BIT COUNT FIRST BYTE          */
CCABMBTL DS    XL2                  /* BIT COUNT LAST BYTE           */
CCABMBYT DS    XL2                  /* NUMBER OF FULL BYTES          */
CCABMSTR DS    XL2                  /* BIT MASK START. TRACK     @LDA*/
CCABMWK1 DS    A                    /* WORK FIELD                    */
CCABMWK2 DS    A                    /* WORK FIELD                    */
CCABMWK3 DS    A                    /* WORK FIELD                    */
CCABMWK4 DS    A                    /* WORK FIELD                    */
CCABMRB1 DS    A                    /* FIRST BIT MAP RAB PTR         */
CCABMRB2 DS    A                    /* SECOND RAB POINTER            */
CCATEMPS DS    CL40                 /* PL/S TEMP AREA                */
CCAMNCAT DS    0CL256               /* CONTIGUOUS AREA FOR           */
*                                   /* TRACKING                Y02020*/
CCAMNAT  DS    0CL248               /* TRACKING BUFFER         Y02020*/
MNATTOP  DS    XL1                  /* TOP ENTRY 1ST BYTE      Y02020*/
MNATFULL EQU   B'10000000'          /* BUFFER FULL             Y02020*/
*              B'01111111'          /* RESERVED                Y02020*/
         DS    CL239                /* BODY OF BUFFER          Y02020*/
MNATFLGS DS    XL1                  /* MOST RECENT ENTRY-1ST BYTE
*                                                              Y02020*/
MNATVAL  EQU   B'10000000'          /* VALID ENTRY BIT         Y02020*/
*              B'01100000'          /* RESERVED              @ZA29164*/
MNATFCLS EQU   B'00010000'          /* CLASS 'F' CORE IF OFF @ZA29164*/
*              B'00001110'          /* RESERVED              @ZA29164*/
MNATSCLS EQU   B'00000001'          /* CLASS 'S' CORE          Y02020*/
MNATARG1 DS    XL3                  /* REMAINDER OF 1ST WD
*                                                              Y02020*/
MNATARG2 DS    A                    /* MOST RECENT ENTRY-2ND WD
*                                                              Y02020*/
CCAMNLL  DS    XL1                  /* G/F MAIN LEN LIST-EOL BYTE
*                                                              Y02020*/
CCAMNLEN DS    XL3                  /* G/F MAIN LENGTH         Y02020*/
CCAMNADR DS    A                    /* G/F MAIN ADDRESS        Y02020*/
CCAARFWA DS    0CL16                /* SPILL RTN WORK AREA     Y02020*/
ARFGMLEN DS    0XL4                 /* LEN LIST FOR GETMAIN    Y02020*/
ARFGMLP  DS    XL1                  /* END-OF-LIST BYTE        Y02020*/
ARFLEN   DS    XL3                  /* LENGTH                  Y02020*/
ARFGMADR DS    A                    /* ADDRESS FOR GETMAIN     Y02020*/
ARFSBSCH DS    A                    /* PTR TO 1ST SPILL BLOCK  Y02020*/
ARFSBECH DS    A                    /* PTR TO LAST SPILL BLOCK Y02020*/
CCARVFG1 DS    XL1                  /* RECOVERY FLAGS          Y02020*/
RVCCAV   EQU   B'10000000'          /* CCA VALID               Y02020*/
RVARFI   EQU   B'01000000'          /* TRACKING DATA INCOMPLETE
*                                                              Y02020*/
RVCMSFG  EQU   B'00100000'          /* CMS FUNCTION CATE       Y02020*/
RVESBO   EQU   B'00010000'          /* ESTAE BACKOUT IN CONTROL
*                                                              Y02020*/
RVESBOR  EQU   B'00001000'          /* ESTAE BACKOUT REGISTER  Y02020*/
RVRPLMFG EQU   B'00000100'          /*RPL MGMT FUNCTION GATE @Z40WSPJ*/
RVWG     EQU   B'00000010'          /* RECOVERY WAIT GATE    @Z40WSPJ*/
WTOROUT  EQU   B'00000001'          /* WTOR OUTSTANDING      @ZA35467*/
CCAFLG12 DS    XL1                  /* CCA FLAG 12 BYTE          @L5A*/
CCANOPRC EQU   B'10000000'          /* NO PASSED RECORD          @L5A*/
CCARVVR  EQU   B'01000000'          /* READ VVR INDICATER        @L5A*/
CCAVDSBE EQU   B'00100000'          /* VVR BUFFER TOO SMALL      @L5A*/
CCACSLPS EQU   B'00010000'          /* CIS LOOP STOPPED          @L5A*/
CCAVVRSS EQU   B'00010000'          /* VVR SEARCH STOPPED        @L5A*/
CCAFCIST EQU   B'00001000'          /* BUILD FIRST CIST          @L5A*/
CCAFCIPT EQU   B'00000100'          /* BUILD FIRST CIPT          @L5A*/
CCACISNQ EQU   B'00000010'          /* CI SUB ISSUED ENQ         @L5A*/
CCASVKGE EQU   B'00000001'          /* SAVE GET NEXT IND         @L5A*/
CCAGDSLN DS    XL1                  /* GDS NAME LENGTH           @L5A*/
CCAFLG11 DS    XL1                  /*                       @ZA30975*/
CCATNE   EQU   B'10000000'          /* TRUE NAME ENTRY           @L5A*/
CCATKNRQ EQU   B'01000000'          /* TOKEN REQUESTED           @L5A*/
CCAGDGBS EQU   B'00100000'          /* ICF GENERATION DAT SET
*                                                                @L5A*/
CCAUPGIR EQU   B'00010000'          /* UPGRADE ICF RECORD        @L5A*/
CCAF11B5 EQU   B'00001000'          /* B5 AND B6 ON - NO CATLG PASSWORD
*                                                            @ZA30975*/
CCAF11B6 EQU   B'00000100'          /* B5 AND B6 EQUAL TO 01, NO UPDATE
*                PASSWORD, EQUAL TO 10, THERE IS UPDATE PW   @ZA30975*/
GOTCORE  EQU   B'00000010'          /* CORE GOTTEN FOR CRA ACB, CAXWA
*                                      AND TIOT IN CLAD      @ZA35552*/
CCADSMF  EQU   B'00000001'          /* OBTAIN/SCRATCH FAILED @ZA37804*/
CCAREGS  DS    0CL348               /* REGISTER SAVE AREA      Y02020*/
         DS    XL4                  /* USER SAVE AREA ADDR     Y02020*/
CCAMODNM DS    CL8                  /* LOAD MODULE NAME      @Y30SSSB*/
         DS    CL336                /*                               */
CCABZSAV DS    0A                   /* SAVE AREA FOR CLBZ    @Y30SSSB*/
CCADSPWA DS    A                    /* DEFINE SPACE W/A/ PTR @Y30SSDW*/
CCACUMPL DS    A                    /* CATLG UPGRADE MGMNT   @Y30SSPJ*/
*                                   /* PARM LIST PTR         @Y30SSPJ*/
CCATNQCT DS    XL1                  /* TIOT ENQ COUNT        @Y30SSPJ*/
CCASBASE DS    XL3                  /* SAVE BASE CI          @Y30SSPJ*/
*                                   /* FOR UPGD PROCESS      @Y30SSSB*/
CCACRACI DS    A                    /* CRA REC PTR ARRAY AD  @Y30SSSB*/
CCARAACB DS    A                    /* CRA ACB ADDRESS       @Y30SSSB*/
CCARARPL DS    A                    /* CRA RPL ADDRESS       @Y30SSSB*/
CCARARBA DS    A                    /* CRA RBA               @Y30SSSB*/
CCARAREC DS    A                    /* RECORD POINTER        @Y30SSSB*/
CCARALSA DS    0A                   /* CRA LOCAL SAVE AREA   @Y30SSSB*/
CCACRABT DS    XL2                  /* BLOCKS/TRACK FOR CRA RECORD
*                                      CONSTRUCTION (CLB4)   @Y30SSDW*/
         DS    XL2                  /* RESERVED              @Y30SSDW*/
CCAFLG10 DS    XL1                  /* FLAG BYTE             @Y30SSSB*/
CCAINCPL EQU   B'10000000'          /* INVALID CPL, VAL CK   @Y30SSSB*/
CCAPDMW  EQU   B'01000000'          /* PROB DET MSG PUT      @Y30SSSB*/
CCACATAC EQU   B'00100000'          /* CAT ACTIVE, CRA       @Y30SSSB*/
CCARAFEV EQU   B'00010000'          /* CRA FORCED EOV CH     @Y30SSSB*/
CCARARTC EQU   B'00001000'          /* RECOVERY EXIT, RETURN TO      */
*                                   /*   CALLER              @Y30SSSB*/
CCAPRANX EQU   B'00000100'          /* PRIME CRA GONE        @Y30SSRG*/
CCADEFUN EQU   B'00000010'          /* DEFINE UNIQUE SAVE    @ZA27024*/
ENQPCCB  EQU   B'00000001'          /* PCCB ENQUED ON        @ZA32362*/
CCASUMTT DS    XL3                  /* CRA SUM TT VALUE      @Y30SSSB*/
CCADICTS DS    XL4                  /* DATA/INDEX ID TS      @Y30SSSB*/
CCARANCA DS    CL8                  /* NORMAL RECORD BUFFER CHAIN    */
*                                   /*  START, END ADDRS     @Y30SSSB*/
CCARAVCA DS    CL8                  /* VOLUME RECORD BUFFER CHAIN    */
*                                   /*  START, END ADDRS     @Y30SSSB*/
CCAVTS   DS    CL8                  /* VOLUME TIMESTAMP      @Y30SSSB*/
CCAREWKA DS    A                    /* REUSE WORKAREA ADDR   @Y30SSSB*/
CCASMFP  DS    0XL4                 /* SMF SAVE AREA FOR     @Y30SSSB*/
*                                   /* FOR PROB DETER        @Y30SSSB*/
CCASMFMD DS    CL2                  /* MODULE ID             @Y30SSSB*/
CCASMFRC DS    XL1                  /* REASON CODE           @Y30SSSB*/
CCASMFCD DS    XL1                  /* RETURN CODE           @Y30SSSB*/
CCAPROBX DS    0XL4                 /* AUXILLARY SAVE AREA   @Y30SSSB*/
*                                   /* FOR CCAPROB           @Y30SSSB*/
CCAMODDX DS    CL2                  /* ERROR MODULE ID       @Y30SSSB*/
CCAERCDX DS    0XL2                 /* ERROR CODES           @Y30SSSB*/
CCARESNX DS    XL1                  /* REASON CODE           @Y30SSSB*/
CCARETRX DS    XL1                  /* RETURN CODE           @Y30SSSB*/
CCADGDGA DS    0A                   /* DEL FULL GDG WA       @Y30SSSB*/
CCASAVMN DS    A                    /* SAVE GOTTEN CORE ADDR @Y30SSSB*/
CCAREQDQ DS    0CL16                /* MULTI FUNCTION PARM LIST.     */
*                                   /* RPL RESOURCE SYSZRPLW         */
*                                   /* USED AS A POST PARM LIST      */
*                                   /* BY IGGPRPLF.                  */
*                                   /* USED BY CAS ESTAE ROUTINE     */
*                                   /* IGG0CLA9 FOR ENQ/DEQ ACB      */
*                                   /* RESTART RESOUTCE SYSZACBR.    */
*                                   /*                       @ZA91958*/
CCAREDFF DS    XL1                  /* END OF PL IND BYTE - X'FF'
*                                                            @Z40WSPJ*/
CCAREDLN DS    XL1                  /* LENGTH OF MINOR NAME  @Z40WSPJ*/
CCAREDOP DS    XL1                  /* ENQ-DEQ OPTIONS       @Z40WSPJ*/
CCAREDSH EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE @Z40WSPJ*/
*              B'01111111'             OTHER OPT. (SET BY MACRO)
*                                                            @Z40WSPJ*/
CCAREDRC DS    XL1                  /* ENQ/DEQ RETURN CODE   @Z40WSPJ*/
CCARMAJN DS    A                    /* MAJOR NAME PTR        @Z40WSPJ*/
CCARMINN DS    A                    /* MINOR NAME PTR        @Z40WSPJ*/
CCAREUCB DS    A                    /* UCB PTR               @ZA38467*/
CCACNAME DS    A                    /* RECORD NAME POINTER       @L5A*/
CCAXTYPE DS    A                    /* RECORD TYPE POINTER       @L5A*/
CCAPASRC DS    A                    /* PTR TO PASSREC FPL        @L5A*/
CCARETRC DS    A                    /* PTR TO RETVREC FPL        @L5A*/
CCAG00V0 DS    CL8                  /* G0000V00 QUALIFIER        @L5A*/
CCADTT   DS    A                    /* DEFINE TRACKING TABLE     @L5B*/
CCAFVT   DS    A                    /* ADDR OF CURRENT FVT       @L5B*/
CCAURCAP DS    A                    /* USER RECORD AREA PTR      @L5A*/
CCARAPSV DS    A                    /* USER RAP SAVE AREA        @L5A*/
CCAR2SAV DS    A                    /* REGISTER SAVE AREA        @L5A*/
CCAVDSPT DS    A                    /* VDS PARM LIST             @L5A*/
CCATREC  DS    A                    /* TARGET RECORD ADDRESS     @L5A*/
CCAWPTR  DS    A                    /* WORK POINTER              @L5A*/
CCAREC   DS    A                    /* INPUT RECORD POINTER      @L5A*/
CCARCEND DS    A                    /* END OF INPUT RECORD       @L5A*/
CCACLEND DS    A                    /*ENDING ADDRESS FOR SEARCH  @L5C*/
CCACELL  DS    A                    /* CELL POINTER              @L5A*/
CCACOMP  DS    A                    /* COMPONENT POINTER         @L5A*/
CCASUB   DS    A                    /* SUB-RECORD POINTER        @L5A*/
CCASUBED DS    A                    /* SUB-RECORD END PTR        @L5C*/
CCASEND  DS    A                    /* SUB-RECORD WORK PTR       @L5C*/
CCASTART DS    A                    /* START OF SEARCH ADDR      @L5C*/
CCAENDAD DS    A                    /* END OF SEARCH ADDR        @L5C*/
CCASPTR  DS    A                    /* AN ADDRESS INSIDE A SUB-RECORD
*                                                                @L5C*/
CCAPEND  DS    A                    /* ENDING ADDRESS FOR GENERAL
*                                      PURPOSE SEARCH            @L5C*/
CCASREND DS    A                    /* ENDING ADDRESS FOR A SEARCH
*                                                                @L5C*/
CCASAVPT DS    A                    /* GENERAL PURPOSE SAVE      @L5C*/
CCAVDSPM DS    A                    /* PTR TO VVDS PARM LIST     @L5C*/
CCAVDSEN DS    A                    /* PTR TO VVDS RBA ENTRY     @L5C*/
CCAVVR   DS    A                    /* POINTER TO VVR            @L5A*/
CCAFMPTR DS    0XL24                /* FIELD INFORMATION POINTERS
*                                                                @L5C*/
CCAMDSB  DS    A                    /* POINTER TO AMDSB          @L5C*/
CCADSIF  DS    A                    /* PTR TO DATASET INFO       @L5C*/
CCASECUR DS    A                    /* PTR TO SECURITY INFO      @L5C*/
CCAVOLPT DS    A                    /* PTR TO VOLUME CELL        @L5C*/
CCAVVRVL DS    A                    /* PTR TO VVR VOLUME INF     @L5C*/
CCASSCPT DS    A                    /* PTR TO ASSOCIATION        @L5C*/
CCAFMTAB DS    0XL12                /* FIELD MANAGEMENT IN CORE TABLES/
*                                      POINTERS                  @L5C*/
CCAVVRTB DS    A                    /* PTR TO VVR TABLE          @L5C*/
CCASCTAB DS    A                    /* PTR TO CLUSTER ASSOCIATION
*                                      TABLE                     @L5C*/
CCAUPTAB DS    A                    /* PTR TO UPGRADE ASSOCIATION
*                                      TABLE                     @L5C*/
CCAINRAP DS    A                    /* INPUT RECORD AREA         @L5C*/
CCAWKRAP DS    A                    /* INPUT RECORD AREA FOR FSUB AND
*                                      FGDS                      @L5C*/
CCAADPTR DS    A                    /* POINT OF INSERT FOR FSUB AND
*                                      FGDS                      @L5C*/
CCAEXRCD DS    A                    /* EXTENSION RECORD          @L5C*/
CCAINDEX DS    XL2                  /* GENERAL INDEX             @L5C*/
CCAIDX   DS    XL2                  /* GENERAL INDEX             @L5C*/
CCAMAXRC DS    XL2                  /* MAX RECORD SIZE           @L5C*/
CCACNTV  DS    XL2                  /* NO. OF VOLUME CELLS       @L5C*/
CCACOUNT DS    XL2                  /* NO. OF VVR RETRIEVED      @L5C*/
CCASCNO  DS    XL2                  /* SEQUENCE NO. OF ASSOCIATION IN
*                                      ASSOCIATION CELL          @L5C*/
CCAGFST  DS    XL2                  /* FIRST AIX RELREPNO        @L5C*/
CCAGLST  DS    XL2                  /* LAST AIX RELREPNO         @L5C*/
CCARFST  DS    XL2                  /* FIRST PATH RELREPNO       @L5C*/
CCARLST  DS    XL2                  /* LAST PATH RELREPNO        @L5C*/
CCASUM1  DS    XL2                  /* GENERAL SUM OF LENGTH     @L5C*/
CCASUM2  DS    XL2                  /* GENERAL SUM OF LENGTH     @L5C*/
CCAFNFLG DS    XL1                  /* ICF FIELD MGMT FLAG       @L5A*/
CCATREP  EQU   B'10000000'          /* REPEATING FIELD           @L5A*/
CCAVARFD EQU   B'01000000'          /* VARIABLE FIELD            @L5A*/
CCAFLGFD EQU   B'00100000'          /* FLAG FIELD                @L5A*/
CCACOMB  EQU   B'00010000'          /* COMBINATION NAME          @L5A*/
CCAEXTYP EQU   B'00001000'          /* EXTENSION RECORD TYPE
*                                      0 = VSAM, 1 = GDG         @L5A*/
CCAUPGRD EQU   B'00000100'          /* UPGRADE REQUEST           @L5C*/
CCAFMLOC EQU   B'00000010'          /* LOCATE INDICATOR          @L5C*/
CCAFMUPD EQU   B'00000001'          /* UPDATE INDICATOR          @L5C*/
CCAGRPCD DS    XL1                  /* GROUP CODE                @L5A*/
CCACCNT  DS    XL1                  /*COMBINATION NAME COUNT     @L5A*/
CCACNT   DS    XL1                  /* GENERAL COUNTER           @L5C*/
CCASAVCD DS    XL1                  /* ERROR CODE SAVE AREA      @L5C*/
         DS    XL1                  /* NOT USED                  @L5C*/
CCAFLG14 DS    XL1                  /* FLAG BYTE 14              @L5C*/
CCARECMV EQU   B'10000000'          /* PASSED RECORD MOVED       @L5A*/
CCAPRPLM EQU   B'01000000'          /* CATALOG OBTAINED SYSIGGV2
*                                      RESOURCE FOR THIS REQUEST
*                                                            @ZA59976*/
CCATCBFX EQU   B'00100000'          /* RPLM SET TCBFX TO PREVENT IRB
*                                      SCHEDULING            @ZA68551*/
CCANQSPH EQU   B'00010000'          /* ENQ ON SPHERE         @ZA77401*/
CCAMCSRH EQU   B'00001000'          /* MASTER CATALOG SEARCH @ZA72135*/
CCADRSPH EQU   B'00000100'          /* SPHERE DEQ REQUIRED   @ZA77401*/
CCADQSPH EQU   B'00000010'          /* DEQ SPHERE ENQ        @ZA77401*/
CCAENQEX EQU   B'00000001'          /* FORCE EXCLUSIVE ENQ   @ZA77401*/
CCAEXCNT DS    XL1                  /* NO. OF EXTENSION RECORDS  @L5A*/
CCAEXNO  DS    XL1                  /* EXTENSION RECORD NO.      @L5A*/
CCAITOKN DS    XL3                  /* INPUT TOKEN               @L5A*/
         DS    XL2                  /* NOT USED                  @L5C*/
CCASUBLN DS    XL2                  /* SUB-RECORD LENGTH         @L5A*/
CCADIFFL DS    XL2                  /* A DELTA LENGTH CHANGE     @L5A*/
CCATLENX DS    XL2                  /* LENGTH FOR IGGPFITT ROUTINE.
*                                      (IT IS THE SUB-RECORD LENGTH
*                                      PLUS DELTA LENGTH CHANGES)
*                                                                @L5A*/
CCASUM   DS    XL2                  /* SUM OF LENGTH             @L5C*/
CCATYPE  DS    CL1                  /* CELL TYPE                 @L5A*/
CCAPADNO DS    CL1                  /* PAD CHARACTER IN EXTENSION@L5A*/
CCAVER   DS    XL1                  /* BINARY GDG VERSION NO     @L5C*/
CCAFLAG  DS    XL1                  /* FLAG BYTE                 @L5A*/
CCASW1   EQU   B'10000000'          /* SWITCH 1                  @L5C*/
CCASW2   EQU   B'01000000'          /* SWITCH 2                  @L5C*/
CCASW3   EQU   B'00100000'          /* SWITCH 3                  @L5C*/
CCAEXSW1 EQU   B'00010000'          /* EXIT SWITCH               @L5C*/
CCABOTH  EQU   B'00001000'          /* NEED BOTH VOLUME CELL AND VVR
*                                      VOLUME INFORMATION        @L5A*/
CCAVVRPM EQU   B'00000100'          /* NEED PRIMARY VVR          @L5C*/
CCAEXFND EQU   B'00000010'          /* EXTENSION RECORD FIT
*                                      1=YES, 0=NO               @L5A*/
CCAUPDSP EQU   B'00000001'          /* SPHERE RECORD HAS TO BE UPDATED
*                                                                @L5C*/
CCACNTER DS    XL2                  /* COUNTER                   @L5A*/
CCAEXLEN DS    XL2                  /* EXTENSION RECORD LENGTH TO
*                                      CREATE                    @L5A*/
CCAGEN   DS    XL2                  /* BINARY GDG GENERATION NUMBER
*                                                                @L5C*/
CCASTYPE DS    CL1                  /* SUB-RECORD TYPE           @L5C*/
CCACLASS DS    XL1                  /* SUBPOOL OF GETMAIN        @L5C*/
CCAGDSGN DS    CL4                  /* EBCDIC GENERATION NO.     @L5C*/
CCAGDSVR DS    CL2                  /* EBCDIC VERSION NO.        @L5C*/
CCAVEQDQ DS    0XL16                /* VVDS ENQ/DEQ PARAMETER LIST   */
CCAVEDXF DS    XL1                  /* END OF PL IND BYTE - X'FF'    */
CCAVEDRL DS    XL1                  /* LENGTH OF MINOR NAME          */
CCAVEDOP DS    XL1                  /* ENQ-DEQ OPTIONS               */
CCAVEDSH EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE         */
*              B'01111111'          /* OTHER OPT. (SET BY MACRO)     */
CCAVEDRC DS    XL1                  /* ENQ/DEQ RETURN CODE           */
CCAVEDQN DS    A                    /* MAJOR NAME PTR                */
CCAVEDRN DS    A                    /* MINOR NAME PTR                */
CCAVEDUC DS    A                    /* UCB PTR                       */
CCAPDOSV DS    CL16                 /* ESTAE PUSH DOWN LIST      @L5A*/
CCAF2WKA DS    A                    /* ADDRESS FORMAT 2 WKA      @L5A*/
CCAIQLT  DS    XL2                  /* CI SUBSTITION ENQ/DEQ LST @L5A*/
         DS    CL10                 /* RESERVED                      */
CCASPSAV DS    XL1                  /* SAVE SUBPOOL          @ZA66330*/
         DS    CL3                  /* NOT USED                  @LXC*/
CCASAFPL DS    A                    /* SAF WA/PARM LIST ADDRESS  @LXC*/
CCACISRT DS    A                    /* CIS R13 SAVE AREA         @L5A*/
CCAVDS13 DS    A                    /* VVDS MGR R13 SAVEAREA     @L5A*/
CCAOCPL  DS    A                    /* ORIGINAL CPL ADDRESS      @L5A*/
CCAARDBP DS    A                    /* CATALOG ARDB ADDRESS      @L5A*/
CCAVVRLP DS    A                    /* VVR LOOP CONTROL          @L5A*/
CCACTVVR DS    A                    /* CATALOG VVR ADDRESS       @L5A*/
CCARCAP0 DS    0XL12                /* RECORD AREA POINTER 0     @L5A*/
CCARCAR0 DS    A                    /* RECORD AREA 0 ADDRESS     @L5A*/
CCALCBP0 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN0 DS    XL2                  /* RECORD AREA 0 LENGTH      @L5A*/
CCARCFG0 DS    XL1                  /* RECORD AREA 0 FLAGS       @L5A*/
CCARCDE0 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP0 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU0 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP0 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP0 DS    XL1                  /* RECORD AREA 0 SUBPOOL     @L5A*/
CCARCAP1 DS    0XL12                /* RECORD AREA POINTER 1     @L5A*/
CCARCAR1 DS    A                    /* RECORD AREA 1 ADDRESS     @L5A*/
CCALCBP1 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN1 DS    XL2                  /* RECORD AREA 1 LENGTH      @L5A*/
CCARCFG1 DS    XL1                  /* RECORD AREA 1 FLAGS       @L5A*/
CCARCDE1 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP1 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU1 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP1 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP1 DS    XL1                  /* RECORD AREA 1 SUBPOOL     @L5A*/
CCARCAP2 DS    0XL12                /* RECORD AREA POINTER 2     @L5A*/
CCARCAR2 DS    A                    /* RECORD AREA 2 ADDRESS     @L5A*/
CCALCBP2 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN2 DS    XL2                  /* RECORD AREA 2 LENGTH      @L5A*/
CCARCFG2 DS    XL1                  /* RECORD AREA 2 FLAGS       @L5A*/
CCARCDE2 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP2 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU2 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP2 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP2 DS    XL1                  /* RECORD AREA 2 SUBPOOL     @L5A*/
CCARCAP3 DS    0XL12                /* RECORD AREA POINTER 3     @L5A*/
CCARCAR3 DS    A                    /* RECORD AREA 3 ADDRESS     @L5A*/
CCALCBP3 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN3 DS    XL2                  /* RECORD AREA 3 LENGTH      @L5A*/
CCARCFG3 DS    XL1                  /* RECORD AREA 3 FLAGS       @L5A*/
CCARCDE3 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP3 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU3 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP3 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP3 DS    XL1                  /* RECORD AREA 3 SUBPOOL     @L5A*/
CCARCAP4 DS    0XL12                /* RECORD AREA POINTER 4     @L5A*/
CCARCAR4 DS    A                    /* RECORD AREA 4 ADDRESS     @L5A*/
CCALCBP4 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN4 DS    XL2                  /* RECORD AREA 4 LENGTH      @L5A*/
CCARCFG4 DS    XL1                  /* RECORD AREA 4 FLAGS       @L5A*/
CCARCDE4 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP4 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU4 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP4 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP4 DS    XL1                  /* RECORD AREA 4 SUBPOOL     @L5A*/
CCARCAP5 DS    0XL12                /* RECORD AREA POINTER 5     @L5A*/
CCARCAR5 DS    A                    /* RECORD AREA 5 ADDRESS     @L5A*/
CCALCBP5 DS    A                    /* LOCATE BUFFER POINTER     @L5A*/
CCARCLN5 DS    XL2                  /* RECORD AREA 5 LENGTH      @L5A*/
CCARCFG5 DS    XL1                  /* RECORD AREA 5 FLAGS       @L5A*/
CCARCDE5 EQU   B'10000000'          /* RECORD DELETED            @L5A*/
CCARCUP5 EQU   B'01000000'          /* UPDATE STATUS             @L5A*/
CCARCFU5 EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRP5 EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSP5 DS    XL1                  /* RECORD AREA 5 SUBPOOL     @L5A*/
CCAFMRAP DS    0XL72                /* FIELD MANAGEMENT RAP'S, TO BE
*                                      USED BY FIELD MANAGEMENT ONLY
*                                                                @L5C*/
CCARCAPU DS    0XL12                /* RECORD AREA POINTER U     @L5C*/
CCARCARU DS    A                    /* RECORD AREA U ADDRESS     @L5C*/
CCALCBPU DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNU DS    XL2                  /* RECORD AREA U LENGTH      @L5C*/
CCARCFGU DS    XL1                  /* RECORD AREA U FLAGS       @L5C*/
CCARCDEU EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPU EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUU EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPU EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPU DS    XL1                  /* RECORD AREA U SUBPOOL     @L5C*/
CCARCAPV DS    0XL12                /* RECORD AREA POINTER V     @L5C*/
CCARCARV DS    A                    /* RECORD AREA V ADDRESS     @L5C*/
CCALCBPV DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNV DS    XL2                  /* RECORD AREA V LENGTH      @L5C*/
CCARCFGV DS    XL1                  /* RECORD AREA V FLAGS       @L5C*/
CCARCDEV EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPV EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUV EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPV EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPV DS    XL1                     RECORD AREA V SUBPOOL
CCARCAPW DS    0XL12                /* RECORD AREA POINTER W     @L5C*/
CCARCARW DS    A                    /* RECORD AREA X ADDRESS     @L5C*/
CCALCBPW DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNW DS    XL2                  /* RECORD AREA X LENGTH      @L5C*/
CCARCFGW DS    XL1                  /* RECORD AREA X FLAGS       @L5C*/
CCARCDEW EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPW EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUW EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPW EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPW DS    XL1                  /* RECORD AREA X SUBPOOL     @L5C*/
CCARCAPX DS    0XL12                /* RECORD AREA POINTER X     @L5C*/
CCARCARX DS    A                    /* RECORD AREA X ADDRESS     @L5C*/
CCALCBPX DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNX DS    XL2                  /* RECORD AREA X LENGTH      @L5C*/
CCARCFGX DS    XL1                  /* RECORD AREA X FLAGS       @L5C*/
CCARCDEX EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPX EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUX EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPX EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPX DS    XL1                  /* RECORD AREA X SUBPOOL     @L5C*/
CCARCAPY DS    0XL12                /* RECORD AREA POINTER Y     @L5C*/
CCARCARY DS    A                    /* RECORD AREA Y ADDRESS     @L5C*/
CCALCBPY DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNY DS    XL2                  /* RECORD AREA Y LENGTH      @L5C*/
CCARCFGY DS    XL1                  /* RECORD AREA Y FLAGS       @L5C*/
CCARCDEY EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPY EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUY EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPY EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPY DS    XL1                  /* RECORD AREA Y SUBPOOL     @L5C*/
CCARCAPZ DS    0XL12                /* RECORD AREA POINTER Z     @L5C*/
CCARCARZ DS    A                    /* RECORD AREA Z ADDRESS     @L5C*/
CCALCBPZ DS    A                    /* LOCATE BUFFER POINTER     @L5C*/
CCARCLNZ DS    XL2                  /* RECORD AREA Z LENGTH      @L5C*/
CCARCFGZ DS    XL1                  /* RECORD AREA Z FLAGS       @L5C*/
CCARCDEZ EQU   B'10000000'          /* RECORD DELETED            @L5C*/
CCARCUPZ EQU   B'01000000'          /* UPDATE STATUS             @L5C*/
CCARCFUZ EQU   B'00100000'          /* FIELD MANAGEMENT UPDATE   @L5C*/
CCARCRPZ EQU   B'00010000'          /* BUFFER FROM CELL POOL         */
*              B'00001111'          /* RESERVED                  @L5A*/
CCARCSPZ DS    XL1                  /* RECORD AREA Z SUBPOOL     @L5C*/
CCACITKN DS    0XL3                 /* CI TOKEN                  @L5A*/
CCACISTN DS    XL1                  /* CIST TABLE NUMBER         @L5A*/
CCACISOF DS    XL2                  /* CIST TABLE OFFSET         @L5A*/
CCAENTNM DS    CL45                 /* ENTRY NAME                @L5A*/
CCACSNAM DS    0XL46                /* CIS LENGTH AND NAME       @L5A*/
CCACISLN DS    XL1                  /* LENGTH OF NAME            @L5A*/
CCACISNM DS    CL45                 /* CIS NAME                  @L5A*/
CCAINAME DS    CL44                 /* INTERMEDIATE NAME         @L5C*/
CCAKEY   DS    0CL45                /* KEY MAP                   @L5A*/
CCANAME  DS    CL44                 /* 44-BYTE NAME              @L5A*/
CCAPAD   DS    CL1                  /* 1-BYTE PAD CHARACTER      @L5A*/
CCADUMMY DS    0XL52                /* DUMMY ASSOCIATION INFO    @L5A*/
         DS    XL2                  /* RESERVED                  @L5A*/
CCADUMTP DS    CL1                  /* TYPE                      @L5A*/
         DS    CL3                  /* RESERVED                  @L5A*/
CCADUMKL DS    XL1                  /* KEY LENGTH                @L5A*/
CCADUMKY DS    0CL45                /* KEY                       @L5A*/
CCADUMNM DS    CL44                 /* NAME PART OF KEY          @L5A*/
CCADUMPD DS    CL1                  /* PAD CHARACTER             @L5A*/
CCAPACK1 DS    CL8                  /* WORK AREA FOR PACKING     @L5C*/
CCAPACK2 DS    CL8                  /* WORK AREA FOR PACKING     @L5C*/
CCAGDSNM DS    CL9                  /* PART OF GDS NAME          @L5C*/
CCASCHWA DS    0XL512               /* SEARCH CAT/SCHED WA       @L5A*/
SCHWA    DS    0XL512
         DS    XL48
SCHEN    DS    CL44
SCHQN    DS    CL44
SCHACPL  DS    XL48
SCHLKPL  DS    XL16
SCHXTBL  DS    XL256
SCHQPL   DS    0XL56
SCHNQPL  DS    XL56
CCADIAG  DS    0XL80                /* DIAGNOSTIC AREA       @ZA77401*/
         DS    XL72                 /*                           @PAS*/
CCALSTID DS    XL4                  /*                           @PAS*/
CCALSTCL DS    XL4                  /* LAST PROCEDURE CALLED     @PAS*/
CCAPROBY DS    0XL4                 /* READ ONLY USE         @ZA77401*/
CCACISPT DS    XL4                  /* CI SPLIT COUNT USED BY
*                                      IGG0CLEG PUT LOGIC        @PAS*/
CCASPHQN DS    0CL16                /* ENQ/DEQ PARAM         @ZA77401*/
CCASPXFF DS    XL1                  /* END OF LIST           @ZA77401*/
CCASPRLN DS    XL1                  /* LENGTH OF MINOR NAME  @ZA77401*/
CCASPOPT DS    XL1                  /* ENQ-DEQ OPTIONS       @ZA77401*/
CCASPSHR EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE @ZA77401*/
*              B'01111111'          /* OTHER OPT.            @ZA77401*/
CCASPRCD DS    XL1                  /* ENQ/DEQ RETURN CODE   @ZA77401*/
CCASPQNM DS    A                    /* MAJOR NAME POINTER    @ZA77401*/
CCASPRNM DS    A                    /* MINOR NAME POINTER    @ZA77401*/
CCASPUCB DS    A                    /* UCB POINTER           @ZA77401*/
CCASPMIN DS    0CL88                /* SHPERE ENQ MINOR NAME @ZA77401*/
CCASPHER DS    CL44                 /* SPHERE NAME           @ZA77401*/
CCACATAL DS    CL44                 /* CATALOG NAME          @ZA77401*/
CCAVVRR  DS    0CL16                /* READ VVR WORKAREA     @ZA77401*/
SAVSRATS DS    XL8                  /* SAVED CAXWA TMSTP     @ZA77401*/
SAVVVRTS DS    XL8                  /* SAVED VVR TIMESTAMP   @ZA77401*/
CCASYNC  DS    XL4                  /* IGGPSYNC WORKAREA     @ZA77401*/
CCAVVRNQ DS    0CL16                /* CAXVDSPM SYNC ENQ     @ZA77401*/
CCAVVRFF DS    XL1                  /* END OF PL IND BYTE    @ZA77401*/
CCAVVRLN DS    XL1                  /* LENGTH OF MINOR NAME  @ZA77401*/
CCAVVROP DS    XL1                  /* ENQ-DEQ OPTIONS       @ZA77401*/
CCAVVRSH EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE @ZA77401*/
*              B'01111111'          /* OTHER OPT.            @ZA77401*/
CCAVVRRC DS    XL1                  /* ENQ/DEQ RETURN CODE   @ZA77401*/
CCAVMAJN DS    A                    /* MAJOR NAME POINTER    @ZA77401*/
CCAVMINN DS    A                    /* MINOR NAME POINTER    @ZA77401*/
CCAVVUCB DS    A                    /* UCB POINTER           @ZA77401*/
CCACCX   DS    A                    /* CCX POINTER               @PAS*/
CCAVVRPT DS    A                    /* VVR CELL POINTER          @PAS*/
CCACVOLA DS    CL88                 /* CVOL NAMES                @PAS*/
CCACASF1 DS    XL1                  /* CAS FLAGS BYTE ONE        @PAS*/
CCARECMS EQU   B'10000000'          /* SAVED RECORD MOVED        @PAS*/
CCAALISF EQU   B'01000000'          /* ALIAS FOUND IN TABLE      @PAS*/
CCASRISC EQU   B'00100000'          /* SEARCH ISC FOR RECORD     @PAS*/
CCACASNQ EQU   B'00010000'          /* CAS-ENQ GOT SYSIGGV2      @PAS*/
CCARLGDS EQU   B'00001000'          /* RELATIVE GDS NAME         @PAS*/
CCAVSMRM EQU   B'00000100'          /* IN VSAM RECD MANAGEMNT@ZA91958*/
CCANQOLY EQU   B'00000010'          /* RPLM RESERVE/ENQ ONLY @ZA91958*/
CCADQOLY EQU   B'00000001'          /* RPLF RELEASE/DEQ ONLY @ZA91958*/
CCACASF2 DS    XL1                  /* CAS FLAGS BYTE TWO RSVD   @PAS*/
CCACASF3 DS    XL1                  /* CAS FLAGS BYTE THREE RSVD @PAS*/
CCACASF4 DS    XL1                  /* CAS FLAGS BYTE FOUR RSVD  @PAS*/
CCACASID DS    A                    /* CAS ENQ/DEQ ASCB POINTER  @PAS*/
CCACATCB DS    A                    /* CAS ENQ/DEQ TCB POINTER   @PAS*/
CCAR8CAX DS    A                    /* CAXWA POINTER RPLF        @PAS*/
CCATEMP2 DS    CL164                /*                           @PAS*/
CCANQPFX DS    0CL20                /* CAS ENQ PREFIX            @PAS*/
CCANQTCB DS    A                    /* TCB ADDRESS               @PAS*/
CCANQECB DS    A                    /* ECB ADDRESS               @PAS*/
CCANMASI DS    XL4                  /* MASID VALUE               @PAS*/
CCANMTCB DS    XL4                  /* MTCB VALUE                @PAS*/
CCANPRFX DS    XL4                  /* PREFIX FORMAT-WORD        @PAS*/
CCACAS38 DS    0CL16                /* ENQ/DEQ PARAMETER LIST    @PAS*/
CCACAXFF DS    XL1                  /* END OF PL IND BYTE -      @PAS*/
CCACARLN DS    XL1                  /* LENGTH OF MINOR NAME      @PAS*/
CCACAOPT DS    XL1                  /* ENQ/DEQ OPTIONS           @PAS*/
CCACASHR EQU   B'10000000'          /* 1=SHARED, 0=EXCLUSIVE     @PAS*/
*              B'01111111'          /* OTHER OPT. (SET BY MACRO) @PAS*/
CCACARCD DS    XL1                  /* ENQ/DEQ RETURN CODE       @PAS*/
CCACAQNM DS    A                    /* MAJOR NAME POINTER        @PAS*/
CCACARNM DS    A                    /* MINOR NAME POINTER        @PAS*/
CCACAUCB DS    A                    /* UCB POINTER               @PAS*/
CCAGFL   DS    0CL8                 /* GFL POINTERS              @SCA*/
CCACFSPT DS    A                    /* GFL CFS PARM LIST PTR     @SCA*/
CCAGFLPT DS    A                    /* GFL WORK AREA PTR         @SCA*/
CCAEND   EQU   *                    /* END OF IBM CCA            @L5A*/
CCAUSER  DS    A               RESERVED - DATACROWN CATLG ASSIST BUFFER
         MEND  ,
./ ADD NAME=IGGCCX   0100-00038-00038-1647-00229-00229-00000-MACRO
         MACRO ,
         IGGCCX
*/********************************************************************/
*/*                                                                  */
*/*   MACRO NAME = IGGCCX                                            */
*/*                                                                  */
*/*   DESCRIPTIVE NAME = CATALOG COMMUNICATIONS AREA EXTENSION       */
*/*                                                                  */
*/*   FUNCTION = THE CCX IS BUILT AND INITIALIZED IN CSA BY THE      */
*/*              CAS INTERFACE MODULE.  IT IS USED TO IDENTIFY A     */
*/*              CAS REQUEST AND CONTAINS THE REQUESTOR'S ASID,      */
*/*              TCB, ASCB, CCA, AND OTHER REQUIRED INFORMATION.     */
*/*              THE CCX IS POINTED TO BY THE CRT (CRTCCXPT).        */
*/*                                                                  */
*/********************************************************************/
         SPACE 1
IGGCCX   DSECT ,
CCXID    DS    CL3             CCX IDENTIFIER = 'CCX'
         DS    XL1             RESERVED
CCXSZ    DS    XL2             SIZE OF THE CCX
         DS    XL2             RESERVED
CCXCCX   DS    XL4             CCX INDEX IN CRTTABLE
CCXTCB   DS    A               CALLER'S TCB
CCXRB    DS    A               CALLER'S RB
CCXASID  DS    A               CALLER'S ASID
CCXSRB   DS    A               IGG0CLHC SRB
CCXPSSRB DS    A               SRB ROUTINE ENTRY POINT
CCXPRMTR DS    A               RMTR ROUTINE
CCXOASCB DS    A               CALLER'S ASCB
CCXNPCCB DS    A               CAS PCCB
CCXOPCCB DS    A               CALLER'S PCCB
CCXCWAP  DS    A               CALLER'S WORK AREA
CCXCIFP  DS    A               RECALL PARAMETER ADDRESS
CCXPCTOK DS    A               PCLINK TOKEN
CCXCLX13 DS    A               IGG0CLAH REGISTER 13
CCXR11S  DS    A               SAVE REGISTER 11
CCXR14S  DS    A               SAVE REGISTER 14
CCXECB   DS    A               SERVICE TASK ECB WHICH CONTAINS RETURN
*                              OR COMPLETION CODE WHEN TASK TERMINATES
CCXNCPL  DS    A               CAS CPL
CCXOCPL  DS    A               CALLER'S CPL
CCXNOFLD DS    A               CALLER'S CTGNOFLD VALUE
CCXNCCA  DS    A               CAS CCA
CCXOCCA  DS    A               CALLER'S CCA
CCXFLG   DS    XL1             CCX FLAGS:
CCXBCISA EQU   B'10000000'     BIG CISA NEEDED FOR LISTCAT
CCXSKYSS EQU   B'01000000'     SYSTEM KEY OR SUPERVISOR STATE REQUIRED
CCXGDGUY EQU   B'00100000'     GOOD GUY
CCXRESUM EQU   B'00010000'     CCX CAN BE RESUMED
CCXCASRQ EQU   B'00001000'     CCX IS ON REQUEST QUEUE
CCXCASPQ EQU   B'00000100'     CCX IS ON PROCESS QUEUE
CCXCASAQ EQU   B'00000010'     CCX IS ON AVAILABLE QUEUE
CCXCASAP EQU   B'00000001'     CCX IS ACTIVE
CCXUSKEY DS    XL1             USER KEY
CCXERR   DS    XL1             ERROR INDICATOR
CCXBUKEY DS    XL1             SAVE USER KEY
CCXRCLWK DS    0XL80           RECALL WORK AREA
CCXRECAL DS    XL1             RECALL FUNCTION:
*                              X'01'  DEQ TOPT
*                              X'02'  DYNAMIC CATALOG OPEN
*                              X'03'  DYNAMIC ALLOCATION
*                              X'04'  SECURITY VERIFICATION
*                              X'05'  FIND CI TOKEN
*                              X'06'  FIND CI NAME
*                              X'07'  ENQ
*                              X'08'  DEQ
*                              X'09'  RESERVE
*                              X'0A'  UCRA EXCP
*                              X'0B'  RENAME
*                              X'0C'  ERASE
*                              X'0D'  VSAM CRA DYNAMIC ALLOCATION
*                              X'0E'  ALLOCATE SVC
*                              X'0F'  EXTENDED DADSM CALL
CCXMVFLG DS    XL1             DATA MOVE FLAG:
CCXMPFLG EQU   B'10000000'     MOVE TO CAS:  0=NO MOVE  1=MOVE DATA
CCXMSFLG EQU   B'01000000'     MOVE TO USER: 0=NO MOVE  1=MOVE DATA
*              B'00111111'     RESERVED
CCXSECFG DS    XL1             SECURITY PROCESSING FLAG
         DS    XL1             RESERVED
CCXMSLEN DS    XL2             MVCS LENGTH
         DS    XL2             RESERVED
CCXMSTO  DS    A               MVCS TO ADDR
CCXMSFRM DS    A               MVCS FROM ADDR
CCXMPLEN DS    XL2             MVCP LENGTH
         DS    XL2             RESERVED
CCXMPFRM DS    A               MVCP FROM ADDR
CCXMPTO  DS    A               MVCP TO ADDR
CCXMDATA DS    0XL52           MORE PARAMETER DATA
CCXNOPTR DS    XL1             NUMBER OF POINTERS IN THE PARAMTER LIST
         DS    XL3             RESERVED
CCXPMOVE DS    0XL36           MOVED PARAMETERS
CCXPMPTR DS    A               POINTER IN PARAMETER LIST
CCXPMLEN DS    XL2             LENGTH OF DATA
         DS    XL30
CCXREGLT DS    0XL12           REGISTERS FOR RECALL
CCXPMREG DS    XL4             REGISTER
         DS    XL8
CCXWORK  DS    0XL48           CAS WORK AREA
CCXNXTBK DS    A               SAVE NEXT BLOCK
CCXRMBYT DS    A               SAVE NEXT BLOCK
CCXPROB  DS    A               PROBLEM DETERMINATION AND RECALL
CCXPROB2 DS    XL4             RECALL RETURN CODE
CCXTQDB  DS    A               COPIED DSABS QDB POINTER
CCXDDNM  DS    A               DDNAME POINTER
CCXWPTR  DS    0A              JFCB WORK AREA POINTER
         DS    XL1             SWA TYPE
CCXWTTR  DS    AL3             JFCB POINTER
CCXEFLG  DS    XL4             EXTRA FLAG:
CCXF1EQ  EQU   B'10000000'     0=DEQ,  1=FLAG2
CCXF2EQ  EQU   B'01000000'     0=ENQ,  1=RSV
CCXTDEQ  EQU   B'00100000'     TIOT DEQUEUE INDICATOR: 0=NO,  1=YES
CCXDCLU  EQU   B'00010000'     DEQUEUE CLEANUP INDICATOR SET BY ETX1 IF
*                              DEQ RECALL COULD NOT BE PERFORMED
CCXPURGE EQU   B'00001000'     SRB SCHEDULE IS NOT ALLOWED
CCXTERM  EQU   B'00000100'     TERMINATE SERVICE TASK
CCXWAIT  EQU   B'00000010'     PUT CCX ON THE WAIT QUEUE
CCXREST  EQU   B'00000001'     RESTART FLAG
CCXEQDQ1 DS    A               PARAMETER LIST WORD 1
CCXEQDQ2 DS    A               PARAMETER LIST WORD 2
CCXEQDQ3 DS    A               PARAMETER LIST WORD 3
CCXEQDQ4 DS    A               PARAMETER LIST WORD 4
CCXREGS  DS    XL72            SAVE AREA
CCXEDR6  DS    A               EQDQ PARAMETER LIST POINTER
CCXEDR8  DS    A               EQDQ REGISTER 8 SAVE
CCXEDR11 DS    A               EQDQ CCA POINTER
CCXUCB   DS    A               UCB ADDRESS
CCXTSOPW DS    A               TSO PASSWORD POINTER
CCXUSVRD DS    A               USVR DATA POINTER
CCXUSVRN DS    A               USVR NAME POINTER
CCXUSVRL DS    XL4             USVR LENGTH
CCXLCICB DS    XL4             CICB LENGTH
CCXOCICB DS    A               CICB POINTER
CCXQNAME DS    CL8             QNAME
CCXRNAME DS    CL44            RNAME
CCXCAS1  DS    0XL72           SRB SAVE AREA, ATTACH PARAMTER LIST, AND
*                              RMF PARAMETERS
CCXSTIME DS    XL8             SYSEVENT START TIME
CCXSSID  DS    XL8             SYSEVENT SUBSYSTEM ID
CCXSTID  DS    XL8             SYSEVENT TRANSACTION ID
CCXSUID  DS    XL8             SYSEVENT USER ID
CCXSTCL  DS    XL8             SYSEVENT CLASS
CCXSTCB  DS    XL32            SYSEVENT EXTRA
CCXCAS2  DS    XL24            SAVE AREA2
CCXCAS3  DS    XL24            SAVE AREA3
CCXCAS4  DS    XL24            SAVE AREA4
CCXNTIO  DS    A               CAS TIOT COPY POINTER
CCXOTIO  DS    A               CALLER'S TIOT POINTER
CCXLTIO  DS    XL4             LENGTH OF TIOT
CCXOCVOL DS    A               REQUEST CVOL
CCXNCVOL DS    A               CAS CVOL POINTER
CCXOSCWA DS    A               REQUEST SCHWA POINTER
CCXNSCWA DS    A               CAS SEARCH CATALOG WORK AREA POINTER
CCXTPTR  DS    A               CAS TEMPORARY POINTER
CCXACB   DS    A               CATALOG ACB
CCXRETWA DS    0XL12           DYNAMIC ALLOCATION RETURN AREA
CCXDDNAM DS    CL8             DDNAME RETURNED
CCXR15   DS    XL4             RETURN CODE IN REGISTER 15
CCXCAST  DS    A               CAS SERVICE TASK TCB ADDRESS
CCXJSCB  DS    A               POINTER TO SERVICE TASK COPIED JSCB
CCXQDB   DS    XL32            USER QDB
CCXWKA   DS    0XL8            TEMPORARY WORK AREA
CCXWKFLG DS    XL1             TEMPORARY FLAG:
CCXF1LPS EQU   B'10000000'     LOOP FLAG IN CROSS-MEMORY
*              B'01111111'     RESERVED
         DS    XL7             RESERVED
CCXTIME  DS    XL8             STCLK TIME VALUE
CCXCASID DS    A               CAS ASID
CCXCASCB DS    A               CAS ASCB POINTER
CCXWTOR  DS    0XL4            WTOR FLAGS AND ID
CCXWTORF DS    XL1             WTOR FLAGS:
CCXWTORP EQU   B'10000000'     WTOR IN-PROGRESS FLAG
*              B'01111111'     RESERVED
CCXWTORI DS    XL3             WTOR ID NUMBER
CCXCITKN DS    0XL3            CI TOKEN
CCXCISTN DS    XL1             CIST TABLE NUMBER
CCXCIOF  DS    XL2             CIST OFFSET
CCXSNAM  DS    0XL46           CIS NAME
CCXCISLN DS    XL1             CIS LENGTH
CCXCISNM DS    XL45            KEY MAP
         DS    XL3             RESERVED
CCXLCCX  DS    A               SRR LOCK CHAIN
CCXLASCB DS    A               SRR LOCK ASCB
CCXLTCB  DS    A               SRR LOCK TCB
CCXLASID DS    A               SRR LOCK ASID
CCXLOCK  DS    A               SRR LOCK HEADER ADDRESS
CCXEMR1  DS    A               EMSG REGISTER 1 SAVE
CCXEMR2  DS    A               EMSG REGISTER 2 SAVE
CCXFLAGS DS    0XL4            CCX FLAGS
CCXFLAG3 DS    XL1             FLAG BYTE 3:
CCXRBTCB EQU   B'10000000'     ON = CALLER RB POINTS TO XRBLNK (TCB)
CCXNWTCB EQU   B'01000000'     NEWLY ATTACHED TCB
CCXLKTCB EQU   B'00100000'     RESUME FROM LOCK ROUTINE
CCXRECUR EQU   B'00010000'     RECURSIVE SVC 26 IN CAS MEMORY
CCXADSP  EQU   B'00001000'     ADSP ATTRIBUTE
CCXBPASS EQU   B'00000100'     SECURITY BYPASS
*              B'00000011'     RESERVED
         DS    XL3             RESERVED
CCXLOCKX DS    XL2             LOCK HELD FLAGS:
CCXLOCK1 EQU   B'10000000'     CAS LOCK 1 HELD
CCXLOCK2 EQU   B'01000000'     CAS LOCK 2 HELD
CCXLOCK3 EQU   B'00100000'     CAS LOCK 3 HELD
CCXLOCK4 EQU   B'00010000'     CAS LOCK 4 HELD
CCXLOCK5 EQU   B'00001000'     CAS LOCK 5 HELD
CCXLOCK6 EQU   B'00000100'     CAS LOCK 6 HELD
CCXLOCK7 EQU   B'00000010'     CAS LOCK 7 HELD
CCXLOCK8 EQU   B'00000001'     CAS LOCK 8 HELD
CCXLOCK9 EQU   B'10000000'     CAS LOCK 9 HELD
CCXLOCKA EQU   B'01000000'     CAS LOCK A HELD
CCXLOCKB EQU   B'00100000'     CAS LOCK B HELD
CCXLOCKC EQU   B'00010000'     CAS LOCK C HELD
CCXLOCKD EQU   B'00001000'     CAS LOCK D HELD
CCXLOCKE EQU   B'00000100'     CAS LOCK E HELD
CCXLOCKF EQU   B'00000010'     CAS LOCK F HELD
*              B'00000001'     RESERVED
         DS    XL2             RESERVED
CCXDDND  DS    A               DATA DDNAME
CCXDDNI  DS    A               INDEX DDNAME
CCXCAS2A DS    XL24            SAVE AREA2A IGG0CLHB
CCXCAS2B DS    XL4             SAVE INTERNAL CCX   IGG0CLX0
CCXCAS3B DS    XL4             CCXTPTR2  IGG0CLX0
CCXCAS2C DS    XL24            SAVE AREA2C IGG0CLXA
CCXCAS2D DS    XL24            SAVE AREA2D IGG0CLXA
CCXCAS2E DS    XL24            SAVE AREA2E IGG0CLXA
CCXCAS2F DS    XL24            SAVE AREA2F IGG0CLXE
CCXCAS2G DS    XL72            SAVE AREA2G IGG0CLHB
CCXCAS2H DS    XL72            SAVE AREA2H IGG0CLXA
CCXTOKEN DS    XL4             PC TOKEN IGG0CLXA
CCXEND   EQU   *               END OF CCX
         MEND  ,
./ ADD NAME=IHAQDB   0100-00063-00063-1613-00059-00059-00000-MACRO
*/  ADD  SSI=22702193,NAME=IHAQDB
*
*        %GOTO QDBL1;  /*
         MACRO
         IHAQDB &DSECT=YES    */
*%QDBL1 : ;
*
*/* **************************************************************** */
*/*                                                                  */
*/*                         QUEUE DESCRIPTOR BLOCK                   */
*/*                                                                  */
*/*  OS/VS2 RELEASE 2, 08/02/72, LEVEL=1                             */
*/*                                                                  */
*/*  METHOD OF ACCESS                                                */
*/*      BAL   - DSECT IS PRODUCED UNLESS DSECT=NO IS SPECIFIED.     */
*/*              USING ON QDB GIVES ADDRESSABILITY FOR ALL SYMBOLS.  */
*/*      PL/S  - DCL QDBPTR PTR                                      */
*/*                                                                  */
*/* **************************************************************** */
*%GOTO QDBL2;  /*
         SPACE 1
         AIF ('DSECT' EQ 'NO').QDB10
QDB      DSECT
         AGO   .QDB20
.QDB10    ANOP
         DS    0D
QDB      EQU   *
.QDB20   ANOP
QDBQDB   DS    CL4 -          ACRONYM IN EBCDIC -QDB-
QDBATTR  DS    BL2 -          QUEUE ATTRIBUTES
QDBRV001 DS    H -            RESERVED
QDBNELMS DS    F -            NUMBER OF ELEMENTS ON QUEUE
QDBFELMP DS    A -            POINTER TO FIRST ELEMENT
QDBLELMP DS    A -            POINTER TO LAST ELEMENT
QDBFPTDS DS    H -            FORWARD POINTER DISPLACEMENT
QDBBPTDS DS    H -            BACKWARD POINTER DISPLACEMENT
QDBPRSZ  DS    H -            PRIORITY FIELD SIZE
QDBPRDS  DS    H -            PRIORITY FIELD DISPLACEMENT
QDBRV002 DS    A -            RESERVED
         MEND  , -  */
*%QDBL2 : ;
*
*DECLARE
*  1 QDB     BASED(QDBPTR)  BDY(WORD),
*   2 QDBQDB      CHAR(4) BDY(WORD),     /* ACRONYM IN EBCIDIC -QDB- */
*   2 QDBATTR     CHAR(2),               /* QUEUE ATTRIBUTES         */
*   2 QDBRV001    FIXED(15),             /* RESERVED                 */
*   2 QDBNELMS    FIXED(31),             /* NUMBER OF ELEMENTS ON
*                                           QUEUE                    */
*   2 QDBFELMP    PTR(31),               /* POINTER TO FIRST ELEMENT */
*   2 QDBLELMP    PTR(31),               /* POINTER TO LAST ELEMENT  */
*   2 QDBFPTDS    FIXED(15),             /* FORWARD POINTER
*                                           DISPLACEMENT             */
*   2 QDBBPTDS    FIXED(15),             /* BACKWARD POINTER
*                                           DISPLACEMENT             */
*   2 QDBPRSZ     FIXED(15),             /* PRIORITY FIELD SIZE      */
*   2 QDBPRDS     FIXED(15),             /* PRIORITY FIELD
*                                           DISPLACEMENT             */
*   2 QDBRV002    PTR(31);               /* RESERVED                 */
./ ADD NAME=ISPLINK  0100-00038-00038-1647-00185-00185-00000-MACRO
         MACRO ,
&NAME    ISPLINK &VERB,&SAVE=,&LIST=,&ERROR=,&OK=
.**********************************************************************
         LCLA  &I,&N
         LCLC  &LABEL              CURRENT INDEXED MACRO LABEL
         LCLC  &SERVICE            CURRENT SPF SERVICE
         GBLC  &SPFADDR            ISPLINK SUBROUTINE ADDRESS
         GBLC  &SPFCALL            ISPLINK PARAMETER LIST ADDRESS
         GBLA  &SPFCNT             ISPLINK VERB COUNT
         GBLC  &SPFVRB(255)        ISPLINK VERB NAME
&LABEL   SETC  'ISPL&SYSNDX'       DEFINE A LABEL INCASE NEEDED
.**********************************************************************
         AIF   ('&NAME' EQ '').NONAME
&NAME    DS    0H
.NONAME  ANOP  ,
.**********************************************************************
         AIF   (N'&SYSLIST EQ 0).EXPAND
         AIF   ('&VERB' EQ '').EXPAND
         AIF   ('&VERB' EQ 'LOAD').LOAD010
         AIF   ('&VERB' EQ 'RELOAD').RELO010
         AIF   ('&VERB' EQ 'UNLOAD').UNLO010
         AGO   .SERVICE
.**********************************************************************
.LOAD010 ANOP  ,
         AIF   ('&SAVE' NE '').LOAD020
         MNOTE 8,'SAVE= NOT SUPPLIED'
         AGO   .MEND
.LOAD020 ANOP  ,
         AIF   ('&LIST' NE '').LOAD030
         MNOTE 8,'LIST= NOT SUPPLIED'
         AGO   .MEND
.LOAD030 ANOP  ,
&SPFADDR SETC  '&SAVE'
&SPFCALL SETC  '&LIST'
         AIF   ('&ERROR' NE '').LOAD040
*        LOAD  EP=ISPLINK          LOAD ISPLINK ROUTINE
         LOAD  EP=ISPLINK
         AGO   .LOAD060
.LOAD040 ANOP  ,
         AIF   ('&ERROR' EQ '*').LOAD050
*        LOAD  EP=ISPLINK,ERRET=&ERROR
         LOAD  EP=ISPLINK,ERRET=&ERROR
         AGO   .LOAD060
.LOAD050 ANOP  ,
*        LOAD  EP=ISPLINK,ERRET=&LABEL
         LOAD  EP=ISPLINK,ERRET=&LABEL
         ST    R0,&SPFADDR         SAVE ISPLINK ROUTINE ADDRESS
         B     *+8                 BRANCH AROUND ABEND
&LABEL   DS    0H
         EX    0,*                 ABEND S0C3
         AGO   .MEND
.LOAD060 ANOP  ,
         ST    R0,&SPFADDR         SAVE ISPLINK ROUTINE ADDRESS
         AGO   .MEND
.**********************************************************************
.RELO010 ANOP  ,
         AIF   ('&SAVE' NE '').RELO020
         MNOTE 8,'SAVE= NOT SUPPLIED'
         AGO   .MEND
.RELO020 ANOP  ,
         AIF   ('&LIST' NE '').RELO030
         MNOTE 8,'LIST= NOT SUPPLIED'
         AGO   .MEND
.RELO030 ANOP  ,
&SPFADDR SETC  '&SAVE'
&SPFCALL SETC  '&LIST'
         AGO   .MEND
.**********************************************************************
.UNLO010 ANOP  ,
         AIF   ('&SPFADDR' NE  '').UNLO020
         MNOTE 8,'ISPLINK WAS NOT PREVIOUSLY LOADED'
         AGO   .MEND
.UNLO020 ANOP  ,
         ICM   R0,15,&SPFADDR      CHECK IF ISPLINK HAS BEEN LOADED
         BZ    &LABEL              B. IF NOT
*        DELETE EP=ISPLINK         DELETE ISPLINK ROUTINE
         DELETE EP=ISPLINK         DELETE ISPLINK ROUTINE
         XC    &SPFADDR,&SPFADDR   CLEAR ISPLINK ROUTINE ADDRESS
&LABEL   DS    0H
         AGO   .MEND
.**********************************************************************
.SERVICE ANOP  ,
         AIF   ('&SPFADDR' EQ  '').NOTLOAD
         AIF   ('&SPFCALL' NE  '').LOOP010
.NOTLOAD ANOP  ,
         MNOTE 8,'ISPLINK WAS NOT PREVIOUSLY LOADED'
         AGO   .MEND
.*------
.*       CHECK IF SPECIFIED DIALOG SERVICE IS IN CURRENT TABLE
.*------
.LOOP010 ANOP  ,
&SERVICE SETC  '&SYSLIST(1)'
         AIF   ('&SYSLIST(1)'(1,1) EQ '''').LOOP050
         AIF   ('&SERVICE' EQ '*').LOOP050
&I       SETA  0                   INITIALIZE LOOP FACTOR
.LOOP020 ANOP  ,
&I       SETA  &I+1                ADD 1 TO COUNTER
         AIF   (&I LE 255).LOOP030
         MNOTE 8,'MORE THAN 255 ISPLINK FUNCTIONS USED'
         AGO   .MEND
.LOOP030 ANOP  ,
         AIF   (&I GT &SPFCNT).LOOP040
         AIF   ('&SPFVRB(&I)' EQ '&SERVICE').LOOP050
         AGO   .LOOP020
.LOOP040 ANOP  ,
&SPFCNT  SETA  &I
&SPFVRB(&I) SETC '&SERVICE'
.LOOP050 ANOP  ,
&I       SETA  0                   INITIALIZE LOOP FACTOR
.*------
.*       CONSTRUCT ISPF DIALOG SERVICES PARAMETER LIST
.*------
.NEXTPRM ANOP  ,
         AIF   (&I GE N'&SYSLIST).ENDLP
&I       SETA  &I+1
&N       SETA  4*(&I-1)
         AIF   (&I EQ 1).VERB
         AIF   ('&SYSLIST(&I)' EQ '*').NEXTPRM
         AIF   ('&SYSLIST(&I)' EQ '&SYSLIST(&I-1)').STPARM
         AIF   ('&SYSLIST(&I)' EQ '').BLANK
         AIF   ('&SYSLIST(&I)'(1,1) EQ '+').NUMBER
         AIF   ('&SYSLIST(&I)'(1,1) EQ '-').NUMBER
         AIF   ('&SYSLIST(&I)'(1,1) EQ '(').REG
         AIF   ('&SYSLIST(&I)'(1,1) EQ '''').LITERAL
         AIF   (T'&SYSLIST(&I) EQ 'N').NUMBER
         AIF   ('&SYSLIST(&I)'(2,1) EQ '(').ADCON
         AIF   ('&SYSLIST(&I)'(2,1) EQ '''').NUMBER
         IHBSETR &SYSLIST(&I),R0
         AGO   .STPARM
.VERB    ANOP  ,
         AIF   ('&SYSLIST(&I)'(1,1) EQ '''').LITERAL
         LA    R0,&VERB            LOAD VERB ADDRESS
         AGO   .STPARM
.LITERAL LA    R0,=C&SYSLIST(&I)   LOAD PARAMETER ADDRESS
         AGO   .STPARM
.BLANK   LA    R0,0                NULL PARAMETER ADDRESS
         AGO   .STPARM
.REG     LR    R0,&SYSLIST(&I)     LOAD PARAMETER ADDRESS
         AGO   .STPARM
.ADCON   LA    R0,=&SYSLIST(&I)    LOAD PARAMETER ADDRESS
         AGO   .STPARM
.NUMBER  LA    R0,=A(&SYSLIST(&I)) LOAD PARAMETER ADDRESS
.STPARM  ST    R0,&SPFCALL+&N
         AGO   .NEXTPRM
.ENDLP   AIF   (&I GT N'&SYSLIST).CALL
         AIF   ('&SYSLIST(&I)' EQ '').CALL
         OI    &SPFCALL+&N,128     SET END OF PARAMETER LIST
.*------
.*       CALL THE DIALOG SERVICE ROUTINE
.*------
.CALL    ANOP  ,
         LA    R1,&SPFCALL         LOAD ISPLINK PARAMETER LIST ADDRESS
         L     R15,&SPFADDR        LOAD ISPLINK ROUTINE ADDRESS
         BALR  R14,R15             CALL ISPF DIALOG MANAGER SERVICES
.*------
.*       PROCESS THE RETURN CODE
.*------
         AIF ('&ERROR' EQ '' AND '&OK' EQ '').MEND
         LTR   R15,R15             CHECK ISPLINK RETURN CODE
         AIF   ('&OK' EQ '').AFTER1
         BZ    &OK                 B. IF SUCCESSFUL
.AFTER1  ANOP  ,
         AIF   ('&ERROR' EQ '').MEND
         AIF   ('&ERROR' EQ '*').AFTER2
         BNZ   &ERROR              B. IF ERROR
         AGO   .MEND
.AFTER2  ANOP  ,
         AIF   ('&OK' NE '').AFTER3
         BZ    *+8                 B. IF SUCCESSFUL
.AFTER3  ANOP  ,
         EX    0,*                 ELSE. ABEND S0C3
         AGO   .MEND
.**********************************************************************
.EXPAND  ANOP  ,
&I       SETA  0
.EXLOOP  ANOP  ,
&I       SETA  &I+1
         AIF   (&I GT &SPFCNT).RESET
&SERVICE SETC  '&SPFVRB(&I)'
&SERVICE DC    CL8'&SPFVRB(&I)'  . *** ISPF CONSTANT ***
         AGO   .EXLOOP
.RESET   ANOP  ,
&SPFCNT  SETA  0
         AGO   .MEND
.MEND    MEND  ,
./ ADD NAME=MASK     0100-00038-00038-1647-00122-00122-00000-MACRO
         MACRO ,
&NAME    MASK  &MASKADR,                SYMBOLIC ADDRESS OF MASK       X
               &DATAADR,                SYMBOLIC ADDRESS OF DATA       X
               &MASKLEN,                MAX. LENGTH OF MASK            X
               &DATALEN                 MAX. LENGTH OF DATA
         LCLC  &X
&X       SETC  '&SYSNDX'
&NAME    STM   0,14,SAVE&X              SAVE REGISTERS
         SR    15,15                    INITIALIZE R15 TO 0
         SR    6,6                      INITIALIZE MASK PTR. TO 0
         SR    7,7                      INITIALIZE DATA PTR. TO 0
         SR    8,8                      CLEAR REG 8
         SR    9,9                      CLEAR REG 9
         MVI   BWFL&X,0
         IC    8,&MASKADR.(6)           PUT FIRST MASK CHAR IN REG 8
         IC    9,&DATAADR.(7)           PUT FIRST DATA CHAR IN REG 9
.AIF1    AIF   (T'&MASKLEN EQ 'N').LA1
         L     4,&MASKLEN               PUT MAX LENGTH OF MASK IN REG 4
         AGO   .AIF2
.LA1     LA    4,&MASKLEN               PUT MAX LENGTH OF MASK IN REG 4
.AIF2    AIF   (T'&DATALEN EQ 'N').LA2
         L     5,&DATALEN               PUT MAX LENGTH OF DATA IN REG 5
         AGO   .AIF3
.LA2     LA    5,&DATALEN               PUT MAX LENGTH OF DATA IN REG 5
.AIF3    ANOP  ,
         CLM   8,1,=C' '                DOES MASK HAVE LEADING BLANKS?
         BE    SKIP&X                   YES..SKIP LEADING MASK BLANKS
         SPACE 2
FTST&X   CLM   8,1,=C'?'                IS CURRENT MASK CHAR. A '?' ?
         BE    BKWD&X               YES..GO HANDLE BACKWARD PROCESSING
         CLM   8,1,=C'*'                IS CURRENT MASK CHAR. AN '*'?
         BE    ASTR&X                   YES..GO DO * PROCESSING
         CLR   8,9                      IS MASK CHAR EQUAL TO DATA
*                                       CHAR?
         BE    ADJP&X                   YES..GO ADJUST PTRS TO NEXT
*                                       MASK CHAR AND DATA CHAR
         LA    15,4                     NO..SET RETURN CODE
         B     EXIT&X                   GO EXIT
         SPACE 2
***********************************************************************
*              SKIP ANY LEADING BLANKS IN MASK                        *
***********************************************************************
         SPACE 1
SKIP&X   IC    8,&MASKADR.(6)           PUT MASK CHAR IN REG 8
         CLM   8,1,=C' '                IS MASK CHAR BLANK?
         BNE   FTST&X                   NO..GO CONTINUE PROCESSING
         LA    6,1(,6)                  YES..POINT TO NEXT CHAR
         CR    6,4                      IS THIS THE END OF THE MASK?
         BNE   SKIP&X                   NO..CONTINUE
         LA    15,16                    YES..MASK IS ALL BLANK..SET RET
         B     EXIT&X                   CODE AND GO EXIT
         SPACE 2
***********************************************************************
*   ? FOUND IN MASK..ELIMINATE TRAILING BLANKS IN MASK AND DATA,      *
*   AND BEGIN PROCESSING FROM END OF BOTH FIELDS. WHEN ? ENCOUNTERED  *
*   AGAIN..PROCESSING COMPLETE.                                       *
***********************************************************************
         SPACE 1
BKWD&X   TM    BWFL&X,X'80'             ARE WE GOING BACKWARDS ALREADY?
         BZ    STBK&X                NO..INITIATE BACKWARD PROCESSING
         CR    3,6                      YES..IS IT THE SAME '?'  ?
         BE    EXIT&X                   YES..OK..EXIT
         LA    15,16                NO..MORE THAN ONE ? IN MASK..ERROR
         B     EXIT&X                   GO EXIT
STBK&X   OI    BWFL&X,X'80'             SET BACKWARD INDICATOR
         LR    3,6                      STORE PTR TO ? IN MASK
***********************************************************************
*            ELIMINATE TRAILING BLANKS IN MASK AND DATA               *
***********************************************************************
         LR    6,4                      LOAD MAXIMUM LENGTH OF MASK
         LR    7,5                      LOAD MAXIMUM LENGTH OF DATA
MASK&X   BCTR  6,0                      DECREASE MAXIMUM LENGTH OF MASK
         IC    8,&MASKADR.(6)           PUT MASK CHAR IN REG 8
         CLM   8,1,=C' '                IS MASK CHAR. BLANK?
         BE    MASK&X                   YES..GO CHECK NEXT ONE
MEMB&X   BCTR  7,0                      DECREASE MAXIMUM LENGTH OF DATA
         IC    9,&DATAADR.(7)           PUT DATA CHAR IN REG 9
         CLM   9,1,=C' '                IS DATA CHAR. BLANK?
         BNE   FTST&X                   NO..GO CONTINUE PROCESSING..ALL
*                                       TRAILING BLANKS ELIMINATED
         LTR   7,7                      ARE WE AT BEGINNING OF DATA?
         BNZ   MEMB&X                   NO..GO CHECK NEXT CHAR
         LA    15,4                 YES..DATA IS ALL BLANKS..SET RET
         B     EXIT&X                   CODE AND EXIT
         SPACE 2
***********************************************************************
*                      * FOUND IN MASK                                *
***********************************************************************
         SPACE 1
ASTR&X   CLM   9,1,=C' '                IS DATA CHAR BLANK?
         BNE   ADJP&X                NO..MATCH OK..GO ADJUST PTRS
         LA    15,4                     YES..NO MATCH..SET RETURN CODE
         B     EXIT&X                   AND GO EXIT
         SPACE 2
***********************************************************************
*   INCREASE OR DECREASE PTRS DEPENDING ON WHETHER PROCESSING         *
*   BACKWARDS OR FORWARDS                                             *
***********************************************************************
         SPACE 1
ADJP&X   TM    BWFL&X,X'80'             PROCESSING BACKWARDS?
         BZ    INCR&X                   NO..GO INCREASE PTRS
         BCTR  6,0                      YES..DECREASE PTRS
         BCTR  7,0
         IC    8,&MASKADR.(6)           PUT MASK CHAR IN REG 8
         IC    9,&DATAADR.(7)           PUT DATA CHAR IN REG 9
         B     FTST&X                   CONTINUE PROCESSING
         SPACE 1
INCR&X   LA    6,1(,6)                  INCREASE MASK PTR
         CR    6,4                      END OF MASK?
         BE    EXIT&X                   YES..FINISHED..GO EXIT
         IC    8,&MASKADR.(6)           PUT MASK CHAR IN REG 8
         CLM   8,1,=C' '                IS MASK CHAR BLANK?
         BE    EXIT&X                   YES..FINISHED..GO EXIT
         LA    7,1(,7)                  NO..INCREASE DATA PTR
         IC    9,&DATAADR.(7)           PUT DATA CHAR IN REG 9
         B     FTST&X                   GO CONTINUE PROCESSING
         SPACE 3
BWFL&X   DC    X'00'
SAVE&X   DS    15F
         SPACE 3
EXIT&X   LM    0,14,SAVE&X              RESTORE REGISTERS
         MEND  ,
./ ADD NAME=MSG      0100-00038-00038-1647-00071-00071-00000-MACRO
         MACRO
&NAME    MSG   &OFFSET=0,&TYPE=ABSOLUTE,&ALIGN=
         GBLA  &RCPTXTL
         LCLA  &L,&I
         LCLC  &A,&C
&L       SETA  4                       START WITH HEADER LENGTH
&I       SETA  1
         AIF   (N'&SYSLIST EQ 0).EXIT
&A       SETC  'AL2'
         AIF   ('&ALIGN' NE 'YES').NOALIGN
&A       SETC  'Y'
.NOALIGN ANOP
         AIF   (N'&SYSLIST GT 1).TTYPE
         AIF   ('&SYSLIST(1)'(1,1) NE '''').ERROR
         RCPTXTL &SYSLIST(1)
&L       SETA  &RCPTXTL+4
&NAME    DC    &A.(&L,&OFFSET)
         DC    C&SYSLIST(1)
         SPACE
         MEXIT
.TTYPE   AIF   ('&TYPE' EQ 'SYMBOLIC'(1,K'&TYPE)).SYM
         AIF   ('&TYPE' EQ 'ABSOLUTE'(1,K'&TYPE)).LOOP1
         MNOTE 4,'TYPE=&TYPE INVALID, TYPE=ABSOLUTE USED'
.LOOP1   ANOP
         AIF   ('&SYSLIST(&I)'(1,1) NE '''').ERROR
         RCPTXTL &SYSLIST(&I)
&L       SETA  &L+&RCPTXTL             INCREMENT LENGTH
&I       SETA  &I+2                    INCREMENT INDEX
         AIF   (&I LE N'&SYSLIST).LOOP1
&NAME    DC    Y(&L,&OFFSET)           SEGMENT LENGTH AND OFFSET
&I       SETA  0
&L       SETA  0
.LOOP2   ANOP
&I       SETA  &I+1
         AIF   (&I GT N'&SYSLIST).EXIT
&L       SETA  &L+K'&SYSLIST(&I)-2
         DC    C&SYSLIST(&I)
&I       SETA  &I+1
         AIF   ('&SYSLIST(&I)' EQ '').LOOP2
&C       SETC  '&SYSLIST(&I)'
&C       EQU   &L
         AGO   .LOOP2
.EXIT    SPACE
         MEXIT
.SYM     AIF   ('&NAME' EQ '').NONAME
         AIF   (K'&NAME GT 7).LENGT7
&NAME    DC    &A.(&L,&OFFSET)
&I       SETA  0
.LOOP3   ANOP
&I       SETA  &I+1
         AIF   (&I GT N'&SYSLIST).SETL
         AIF   ('&SYSLIST(&I)'(1,1) NE '''').ERROR2
         DC    C&SYSLIST(&I)
&I       SETA  &I+1
         AIF   ('&SYSLIST(&I)' EQ '').LOOP3
&C       SETC  '&SYSLIST(&I)'
&C       EQU   *-&NAME-4
         AGO   .LOOP3
.SETL    ANOP
&NAME.L  EQU   *-&NAME                 TOTAL SEGMENT LENGTH
         SPACE
         MEXIT
.NONAME  MNOTE 8,'NAME OPERAND REQUIRED WITH TYPE=SYMBOLIC'
         MEXIT
.LENGT7  MNOTE 8,'NAME MUST BE 1-7 CHARS WITH TYPE=SYMBOLIC'
         MEXIT
.ERROR   MNOTE 8,'MESSAGE SEGMENTS SHOULD BE ENTERED IN QUOTES'
         MEXIT
.ERROR2  MNOTE 8,'MESSAGE SEGMENTS SHOULD BE ENTERED IN QUOTES'
&NAME.L  EQU   *-&NAME                 TOTAL SEGMENT LENGTH
         MEND
./ ADD NAME=RCPBFRGS 0100-00038-00038-1647-00019-00019-00000-MACRO
         MACRO
         RCPBFRGS &BUFPTR,&WKREGS
         GBLC  &RCPBFRP,&RCPBFR1,&RCPBFR2
         AIF   ('&BUFPTR' EQ '').TGP
&RCPBFRP SETC  '&BUFPTR'
         AGO   .TWK1
.TGP     AIF   ('&RCPBFRP' NE '').TWK1
&RCPBFRP SETC  'R1'
.TWK1    AIF   ('&WKREGS(1)' EQ '').TG1
&RCPBFR1 SETC  '&WKREGS(1)'
         AGO   .TWK2
.TG1     AIF   ('&RCPBFR1' NE '').TWK2
&RCPBFR1 SETC  'R14'
.TWK2    AIF   ('&WKREGS(2)' EQ '').TG2
&RCPBFR2 SETC  '&WKREGS(2)'
         MEXIT
.TG2     AIF   ('&RCPBFR2' NE '').EXIT
&RCPBFR2 SETC  'R15'
.EXIT    MEND
./ ADD NAME=RCPBFSP  0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPBFSP
         GBLC  &RCPBFSP
         AIF   ('&RCPBFSP' EQ '0').MEND
         AIF   ('&RCPBFSP' EQ '').NULL
         SPACE &RCPBFSP
         MEXIT
.NULL    SPACE
.MEND    MEND
./ ADD NAME=RCPBTU   0100-00038-00038-1647-00016-00016-00000-MACRO
         MACRO
         RCPBTU &KEY,&NUM,&PAR
         LCLA  &L
.*
.*  INNER MACRO FOR ALLOC, TO GENERATE TEXT UNITS ENTERED IN QUOTES
.*
&L       SETA  K'&PAR-2                GET LENGTH OF TEXT UNIT
         MVI   S99TUKEY+1,&KEY         SET TEXT UNIT KEY
         MVI   S99TUNUM+1,&NUM         SET NUMBER FIELD
         MVI   S99TULNG+1,&L           MOVE IN LENGTH
         MVC   S99TUPAR(&L.),=C&PAR    MOVE IN TEXT UNIT
&L       SETA  &L+6
         AIF   (&L/2 EQ (&L+1)/2).LOK
&L       SETA  &L+1
.LOK     RCPDINC &L
         MEND
./ ADD NAME=RCPCKID  0100-00038-00038-1647-00045-00045-00000-MACRO
         MACRO
&NAME    RCPCKID              &CHECKID
         GBLB  &RCPECT(2),&RCPPSCB(2)
         GBLC  &RCPPRE
         LCLC  &CHARVAR,&P
         LCLA  &COUNTR,&L
&P       SETC  '&RCPPRE'
&RCPPSCB(1) SETB  1
&RCPECT(1)  SETB  1
         EJECT
         SPACE 4
***********************************************************************
***  THE USERID OF THE USER IS CHECKED. IF IT IS NOT VALID, THE    ****
***   COMMAND PRETENDS IT DOES NOT EXIST BY LINKING TO EXEC IN     ****
***   THE SAME WAY THE TMP DOES IF IT CANNOT FIND THE COMMAND.     ****
***********************************************************************
         SPACE 3
         L     R1,CPPLPSCB             LOAD ADDRESS OF PSCB
         USING PSCB,R1                 PSCB ADDRESSABILITY
.NID     ANOP
&COUNTR  SETA  &COUNTR+1
         AIF   ('&CHECKID(&COUNTR)' EQ '').ENDID
&CHARVAR SETC  '&CHECKID(&COUNTR)'
&L       SETA  K'&CHARVAR
         AIF   ('&CHARVAR'(1,1) EQ '''').QCID
         CLC   PSCBUSER(&L),=C'&CHARVAR'  IS THE USERID VALID?
         BE    &P.IDOK                     YES, BRANCH OUT
         AGO   .NID
.QCID    ANOP
&L       SETA  &L-2
         CLC   PSCBUSER(&L),=C&CHARVAR    IS THE USERID VALID?
         BE    &P.IDOK                     YES, BRANCH OUT
         AGO   .NID
.ENDID   L     R1,CPPLECT              LOAD ECT ADDRESS
         SPACE 2
         USING ECT,R1
         MVC   ECTPCMD,&P.EXECN        MOVE IN COMMAND NAME
         DROP  R1                      KILL ECT ADDRESSABILITY
         L     R1,CPPLCBUF             LOAD CBUF ADDRESS
         XC    2(2,R1),2(R1)           ZERO OFFSET FIELD
         L     R1,&P.CPPL              RELOAD CPPL ADDRESS
         XCTL  EPLOC=&P.EXECN
&P.EXECN DC    CL8'EXEC'               NAME OF EXEC PROCESSOR
&P.IDOK  DS    0H
         MEND
./ ADD NAME=RCPDDCB  0100-00038-00038-1647-00152-00152-00000-MACRO
         MACRO
         RCPDDCB &LRECL=,&DEN=,&RECFM=,&BLKSIZE=,&DSORG=,&KEYLEN=
         GBLC  &DYNP
         LCLC  &C
         LCLA  &CTR,&K
         AIF   ('&LRECL' EQ '').BLK
***********************************************************************
**   DCB LRECL TEXT UNIT                                             **
***********************************************************************
         MVI   S99TUKEY+1,DALLRECL      SET LRECL KEY
         MVI   S99TUNUM+1,1             SET NUMBER FIELD
         MVI   S99TULNG+1,2             SET LENGTH FIELD
         AIF   (T'&LRECL NE 'N').LA
         MVC   S99TUPAR(2),=AL2(&LRECL.)    MOVE LRECL TO TEXT UNIT
         AGO   .LD
.LA      MVC   S99TUPAR(2),&LRECL       MOVE LRECL TO TEXT UNIT
.LD      RCPDINC 8
         SPACE
.BLK     AIF   ('&BLKSIZE' EQ '').KEY
***********************************************************************
**   DCB BLKSIZE TEXT UNIT                                           **
***********************************************************************
         MVI   S99TUKEY+1,DALBLKSZ      SET BLKSIZE KEY
         MVI   S99TUNUM+1,1             SET NUMBER FIELD
         MVI   S99TULNG+1,2             SET LENGTH FIELD
         AIF   (T'&BLKSIZE NE 'N').BA
         MVC   S99TUPAR(2),=AL2(&BLKSIZE)    MOVE BLKSIZE TO TEXT UNIT
         AGO   .BD
.BA      MVC   S99TUPAR(2),&BLKSIZE     MOVE BLKSIZE TO TEXT UNIT
.BD      RCPDINC 8
         SPACE
.KEY     AIF   ('&KEYLEN' EQ '').DEN
***********************************************************************
**   DCB KEYLEN TEXT UNIT                                            **
***********************************************************************
         MVI   S99TUKEY+1,DALKYLEN      SET KEYNEN KEY
         MVI   S99TUNUM+1,1             SET NUMBER FIELD
         MVI   S99TULNG+1,1             SET LENGTH FIELD
         AIF   (T'&KEYLEN NE 'N').KA
         MVC   S99TUPAR(1),=AL1(&KEYLEN)   MOVE KEYLEN TO TEXT UNIT
         AGO   .KD
.KA      MVC   S99TUPAR(1),&KEYLEN      MOVE KEYLEN TO TEXT UNIT
.KD      RCPDINC 8
         SPACE
.DEN     AIF   ('&DEN' EQ '').DSO
***********************************************************************
**   DCB   DEN  TEXT UNIT                                            **
***********************************************************************
         MVI   S99TUKEY+1,DALDEN        SET  DEN  KEY
         MVI   S99TUNUM+1,1             SET NUMBER KEY
         MVI   S99TULNG+1,1             SET LENGTH KEY
         AIF   (T'&DEN NE 'N').DA
         AIF   ('&DEN' EQ '0').D1
&DYNP.DEN EQU   X'03'
         AGO   .DM
.D1      AIF   ('&DEN' GT '1').D2
&DYNP.DEN EQU   X'43'
         AGO   .DM
.D2      AIF   ('&DEN' GT '2').D3
&DYNP.DEN EQU   X'83'
         AGO   .DM
.D3      AIF   ('&DEN' GT '3').D4
&DYNP.DEN EQU   X'C3'
         AGO   .DM
.D4      AIF   ('&DEN' NE '4').DE
&DYNP.DEN EQU   X'D3'
.DM      MVI   S99TUPAR,&DYNP.DEN       MOVE DENSITY TO TEXT UNIT
         AGO   .DD
.DE      MNOTE 8,'&DEN IS INVALID DENSITY,IT IS IGNORED'
         AGO   .DSO
.DA      MVC   S99TUPAR(1),&DEN         MOVE DENSITY TO TEXT UNIT
.DD      RCPDINC 8
         SPACE
.DSO     AIF   ('&DSORG' EQ '').REC
***********************************************************************
**   DCB DSORG TEXT UNIT                                             **
***********************************************************************
         MVI   S99TUKEY+1,DALDSORG      SET DSORG KEY
         MVI   S99TUNUM+1,1             SET NUMBER FIELD
         MVI   S99TULNG+1,2             SET LENGTH FIELD
         AIF   (T'&DSORG NE 'U').DSA
         AIF   ('&DSORG' NE 'PS').DS2
&C       SETC  '=X''4000'''
         AGO   .DSM
.DS2     AIF   ('&DSORG' NE 'PSU').DS3
&C       SETC  '=X''4100'''
         AGO   .DSM
.DS3     AIF   ('&DSORG' NE 'DA').DS4
&C       SETC  '=X''2000'''
         AGO   .DSM
.DS4     AIF   ('&DSORG' NE 'DAU').DS5
&C       SETC  '=X''2100'''
         AGO   .DSM
.DS5     AIF   ('&DSORG' NE 'PO').DS6
&C       SETC  '2X''0200'''
         AGO   .DSM
.DS6     AIF   ('&DSORG' NE 'POU').DSE
&C       SETC  '=X''0300'''
.DSM     MVC   S99TUPAR(2),&C           MOVE DSORG TEXT UNIT
         AGO   .DSD
.DSE     MNOTE 8,'&DSORG INVALID,IT IS IGNORED'
         AGO   .REC
.DSA     MVC   S99TUPAR(2),&DSORG       MOVE DSORG TEXT UNIT
.DSD     RCPDINC 8
         SPACE
.REC     AIF   ('&RECFM' EQ '').EXIT
**********************************************************************
**   DCB RECFM TEXT UNIT                                             **
***********************************************************************
         MVI   S99TUKEY+1,DALRECFM      SET RECFM KEY
         MVI   S99TUNUM+1,1             SET NUMBER FIELD
         MVI   S99TULNG+1,1             SET LENGTH FIELD
         AIF   (T'&RECFM NE 'U').RA
&K       SETA  1
.LOOP    ANOP
&C       SETC  '&RECFM'(&K,1)
         AIF   ('&C' NE 'M' AND '&C' NE 'R').R2
&CTR     SETA  &CTR+2
         AGO   .ELOOP
.R2      AIF   ('&C' NE 'A' AND '&C' NE 'G').R3
&CTR     SETA  &CTR+4
         AGO   .ELOOP
.R3      AIF   ('&C' NE 'S').R4
&CTR     SETA  &CTR+8
         AGO   .ELOOP
.R4      AIF   ('&C' NE 'B').R5
&CTR     SETA  &CTR+16
         AGO   .ELOOP
.R5      AIF   ('&C' NE 'D' AND '&C' NE 'T').R6
&CTR     SETA  &CTR+32
         AGO   .ELOOP
.R6      AIF   ('&C' NE 'V').R7
&CTR     SETA  &CTR+64
         AGO   .ELOOP
.R7      AIF   ('&C' NE 'F').R8
&CTR     SETA  &CTR+128
         AGO   .ELOOP
.R8      AIF   ('&C' NE 'U').RE
&CTR     SETA  &CTR+192
.ELOOP   AIF (&K EQ K'&RECFM).RX
&K       SETA  &K+1
         AGO   .LOOP
.RX      ANOP
&DYNP.RECF EQU   &CTR
         MVI   S99TUPAR,&DYNP.RECF MOVE RECFM TO TEXT UNIT
         AGO   .RD
.RE      MNOTE 8,'&RECFM INVALID,IT IS IGNORED'
         AGO   .EXIT
.RA      MVC   S99TUPAR(1),&RECFM       MOVE RECFM TO TEXT UNIT
.RD      RCPDINC 8
         SPACE
.EXIT    MEND
./ ADD NAME=RCPDDN   0100-00038-00038-1647-00027-00027-00000-MACRO
         MACRO
         RCPDDN &DDN
         GBLC  &DYNP
         SPACE 1
***********************************************************************
**   BUILD THE DDNAME TEXT UNIT                                      **
***********************************************************************
         AIF   ('&DDN'(K'&DDN,1) EQ '/').BTU
         AIF   ('&DDN'(1,1) EQ '''').Q
         RCPSR2
         AIF   ('&DDN'(1,1) EQ '(').R
         L     R14,&DDN                LOAD ADDRESS OF DDNAME
         LH    R2,&DDN+4               LOAD LENGTH OF DDNAME
         AGO   .STH
.R       L     R14,0&DDN               LOAD ADDRESS OF DDNAME
         LH    R2,4&DDN                LOAD LENGTH OF DDNAME
.STH     STH   R2,S99TULNG             STORE DDNAME LENGTH
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE DDNAME
         MVI   S99TUKEY+1,DALDDNAM     MOVE IN DDNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 14
         MEXIT
.Q       RCPBTU DALDDNAM,1,&DDN
         MEXIT
.BTU     RCPTUBFR DALDDNAM,14,&DDN
         MEND
./ ADD NAME=RCPDDNRT 0100-00038-00038-1647-00012-00012-00000-MACRO
         MACRO
         RCPDDNRT
         SPACE 1
***********************************************************************
**    DDNAME RETURN TEXT UNIT                                        **
***********************************************************************
         MVI   S99TUKEY+1,DALRTDDN     SET RETURN DDNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,8            SET LENGTH FIELD
         MVC   S99TUPAR(8),=CL8' '     INITIALIZE FIELD TO BLANKS
         RCPDINC 14
         MEND
./ ADD NAME=RCPDEBUG 0100-00038-00038-1647-00019-00019-00000-MACRO
         MACRO
         RCPDEBUG &ON
         GBLA  &RCPBGN#,&RCPSWS(10)
         GBLB  &RCPDBUG
         GBLC  &RCPPRE,&RCPWKDS,&RCPWKCS
         AIF   ('&ON' EQ '').TSW
&RCPDBUG SETB 1
.TSW     AIF   (&RCPDBUG).DEBUG
         MEXIT
.DEBUG   MNOTE *,'RCPBGN# IS &RCPBGN#'
         MNOTE *,'RCPSWS(1) IS &RCPSWS(1)'
         MNOTE *,'RCPSWS(2) IS &RCPSWS(2)'
         MNOTE *,'RCPSWS(3) IS &RCPSWS(3)'
         MNOTE *,'RCPSWS(4) IS &RCPSWS(4)'
         MNOTE *,'RCPSWS(5) IS &RCPSWS(5)'
         MNOTE *,'RCPWKCS IS ''&RCPWKCS'''
         MNOTE *,'RCPWKDS IS ''&RCPWKDS'''
         MNOTE *,'RCPPRE IS ''&RCPPRE'''
         MEND
./ ADD NAME=RCPDEFER 0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPDEFER
         SPACE
***********************************************************************
**     DEFER VOLUME MOUNT TEXT ATTRIBUTE UNIT                        **
***********************************************************************
         MVI   S99TUKEY+1,DALDEFER     SET TEXT UNIT KEY
         RCPDINC  4
         MEND
./ ADD NAME=RCPDFPL  0100-00038-00038-1647-00048-00048-00000-MACRO
         MACRO
         RCPDFPL
         GBLC  &RCPPRE
         GBLC  &STPREF
         GBLB  &RCPDFPL(2)
         GBLB  &RCPDFPB(2)
         LCLC  &P,&L,&L1
         EJECT
         AIF   ('&RCPPRE' NE '').BYPPREF
&RCPPRE  SETC  '&STPREF'               SET TO #START PREFIX
.BYPPREF AIF   (&RCPDFPL(2)).BYPDFPL
&RCPDFPL(1) SETB 1
&RCPDFPL(2) SETB 1
&P       SETC  '&RCPPRE'
         IKJDFPL
L#DFPL   EQU   *-DFPL                  LENGTH OF DEFAULT PARAM LIST
         IKJDFPB
L#DFPB   EQU   *-DFPB                  LENGTH OF DEFAULT PARAM BLOCK
&SYSECT  CSECT                         RESUME PROGRAM CSECT
         SPACE 3
.BYPDFPL RCPDS
&P.DFPL  DS    CL(L#DFPL)              RESERVE SPACE FOR DFPL
&P.DFPB  DS    CL(L#DFPB)              RESERVE SPACE FOR DFPB
&P.DSNB  DS    CL48                    RESERVE SPACE FOR DSNAME BUFFER
         RCPDS
         EJECT
.**********************************************************************
.**   THIS CODE GENERATES AN DEFAULT SERVICE ROUTINE PARAMETER LIST ***
.**       AND PARAMETER BLOCK                                       ***
.**********************************************************************
         LA    R1,&P.DFPL              LOAD DFPL ADDRESS
         USING DFPL,R1                 DFPL ADDRESSABLE
         MVC   DFPLUPT,CPPLUPT         MOVE IN ADDRESS OF UPT
         MVC   DFPLECT,CPPLECT         MOVE IN ADDRESS OF ECT
         LA    R15,&P.ECB              LOAD ADDRESS OF ATTN ECB
         ST    R15,DFPLECB             AND STORE IN DFPL
         LA    R15,&P.DFPB             LOAD DFBP ADDRESS
         ST    R15,DFPLDFPB             AND STORE IT IN DFPB
         DROP  R1
         USING DFPB,R15                ADDRESS DFPB DSECT
         XC    DFPB(L#DFPB),DFPB       CLEAR DEFAULT PARAMETER BLOCK
         MVC   DFPBPSCB,CPPLPSCB       MOVE IN ADDRESS OF PSCB
         LA    R1,&P.DSNB              LOAD DSNAME BUFFER ADDRESS
         ST    R1,DFPBDSN               AND STORE IT INTO DFPB
         MVI   DFPBCODE,DFPB04          SET ENTRY CODE
         DROP  R15                     DFPB NO LONGER ADDRESSABLE
         EJECT
         MEND
./ ADD NAME=RCPDINC  0100-00038-00038-1647-00013-00013-00000-MACRO
         MACRO
         RCPDINC &L1
         GBLA  &DTUO,&DTUPO
         GBLC  &DYNP
         AIF   ('&L1' EQ '').T2
         ST    R15,&DYNP.TUP+&DTUPO    STORE TEXT UNIT ADDRESS
         LA    R15,&L1.(R15)           BUMP TEXT UNIT PTR TO NEXT SLOT
&DTUPO   SETA  &DTUPO+4
&DTUO    SETA  &DTUO+&L1
         MEXIT
.T2      ST    R14,&DYNP.TUP+&DTUPO    STORE TEXT UNIT ADDRESS
&DTUPO   SETA  &DTUPO+4
         MEND
./ ADD NAME=RCPDISP  0100-00038-00038-1647-00053-00053-00000-MACRO
         MACRO
         RCPDISP &DISP
         LCLA  &I
         LCLB  &B(4)
         AIF   ('&DISP(1)' EQ '').TD2
         SPACE
***********************************************************************
**     DATA SET INITIAL STATUS                                       **
***********************************************************************
&B(1)    SETB  ('&DISP(1)' EQ 'SHR')
&B(2)    SETB  ('&DISP(1)' EQ 'NEW')
&B(3)    SETB  ('&DISP(1)' EQ 'MOD')
&B(4)    SETB  ('&DISP(1)' EQ 'OLD')
         AIF   (&B(1) OR &B(2) OR &B(3) OR &B(4)).OK1
         MNOTE 8,'&DISP(1) IS INVALID, DISP=SHR USED'
&B(1)    SETB  1
.OK1     ANOP
&I       SETA  8*&B(1)+4*&B(2)+2*&B(3)+&B(4)
         MVC   S99TUKEY(8),=Y(DALSTATS,1,1,X'0&I.00')
         RCPDINC 8
.TD2     AIF   ('&DISP(2)' EQ '').TD3
         SPACE
***********************************************************************
**    DATA SET NORMAL DISPOSITION                                    **
***********************************************************************
&B(1)    SETB  ('&DISP(2)' EQ 'KEEP')
&B(2)    SETB  ('&DISP(2)' EQ 'DELETE')
&B(3)    SETB  ('&DISP(2)' EQ 'CATLG')
&B(4)    SETB  ('&DISP(2)' EQ 'UNCATLG')
         AIF   (&B(1) OR &B(2) OR &B(3) OR &B(4)).OK2
         MNOTE 8,'&DISP(2) IS INVALID, DISP=(,KEEP) USED'
&B(1)    SETB  1
.OK2     ANOP
&I       SETA  8*&B(1)+4*&B(2)+2*&B(3)+&B(4)
         MVC   S99TUKEY(8),=Y(DALNDISP,1,1,X'0&I.00')
         RCPDINC 8
.TD3     AIF   ('&DISP(3)' EQ '').EXIT
         SPACE
***********************************************************************
**   DATASET CONDITIONAL DISPOSITION                                 **
***********************************************************************
&B(1)    SETB  ('&DISP(3)' EQ 'KEEP')
&B(2)    SETB  ('&DISP(3)' EQ 'DELETE')
&B(3)    SETB  ('&DISP(3)' EQ 'CATLG')
&B(4)    SETB  ('&DISP(3)' EQ 'UNCATLG')
         AIF   (&B(1) OR &B(2) OR &B(3) OR &B(4)).OK3
         MNOTE 8,'&DISP(3) IS INVALID, DISP=(,,KEEP) USED'
&B(1)    SETB  1
.OK3     ANOP
&I       SETA  8*&B(1)+4*&B(2)+2*&B(3)+&B(4)
         MVI   S99TUKEY(8),=Y(DALCDISP,1,1,X'0&I.00')
         RCPDINC 8
.EXIT    MEND
./ ADD NAME=RCPDS    0100-00038-00038-1647-00026-00026-00000-MACRO
         MACRO
         RCPDS
         GBLB  &RCPDSBR
         GBLC  &RCPWKDS,&RCPWKCS,&RCPDS
         AIF   ('&RCPDS' NE '').RESUME
&RCPDS   SETC  '&SYSECT'
         AIF   ('&RCPWKDS' EQ '').CSECT
&RCPWKDS DSECT ,                        ENTER WORKAREA DSECT
         MEXIT ,
.CSECT   AIF   ('&RCPWKCS' EQ '').BRANCH
&RCPWKCS CSECT ,                        ENTER WORKAREA CSECT
         MEXIT ,
.RESUME  AIF   (&RCPDSBR).BRTO
&RCPDS   CSECT ,                        RESUME PROGRAM CSECT
&RCPDS   SETC  ''
         MEXIT ,
.BRANCH  ANOP  ,
&RCPDS   SETC  'RCP&SYSNDX'
&RCPDSBR SETB  1
         B     &RCPDS                   BRANCH AROUND CONSTANTS
         MEXIT ,
.BRTO    ANOP  ,
&RCPDS   DS    0H
&RCPDSBR SETB  0
&RCPDS   SETC  ''
         MEND
./ ADD NAME=RCPDSECT 0100-00038-00038-1647-00011-00011-00000-MACRO
         MACRO
&NAME    RCPDSECT &LTORG=YES
         AIF   ('&LTORG' NE 'YES').RCPDS
***********************************************************************
****                  LITERALS                                     ****
***********************************************************************
         SPACE 3
         LTORG
         EJECT
.RCPDS   RCPDS
         MEND
./ ADD NAME=RCPDSN   0100-00038-00038-1647-00068-00068-00000-MACRO
         MACRO
         RCPDSN &DSN,&MEM
         LCLC  &MEMBER
         GBLC  &DYNP
         SPACE
***********************************************************************
**   BUILD THE DSNAME TEXT UNIT                                      **
***********************************************************************
         AIF   ('&DSN'(1,1) EQ '''').Q
         AIF   ('&DSN'(K'&DSN,1) EQ '/').BD
         AIF   ('&DSN'(1,1) EQ '(').REG
         AIF   ('&DSN'  EQ '*').TERM
         RCPSR2
         L     R14,&DSN                LOAD ADDRESS OF DSNAME
         LH    R2,&DSN+4               LOAD LENGTH OF DSNAME
.STH     STH   R2,S99TULNG             STORE DSNAME LENGTH
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE DSNAME
         MVI   S99TUKEY+1,DALDSNAM     MOVE IN DSNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 50
         AGO   .TMEMBER
.REG     L     R14,0&DSN               LOAD ADDRESS OF DSNAME
         RCPSR2
         LH    R2,4&DSN                LOAD LENGTH OF DSNAME
         AGO   .STH
.TERM    MVI   S99TUKEY+1,DALTERM
         RCPDINC 4
         MEXIT
.BD      RCPTUBFR DALDSNAM,50,&DSN
         AGO   .TMEMBER
.Q       RCPBTU DALDSNAM,1,&DSN
.TMEMBER AIF   ('&MEM' EQ '').EXIT
         SPACE
***********************************************************************
**   BUILD THE MEMBER NAME TEXT UNIT                                 **
***********************************************************************
&MEMBER  SETC  '&MEM'
         AIF   ('&MEM' NE '*').MOK
         AIF   ('&DSN'(1,1) NE '''').MAST
         MNOTE 8,'MEMBER=* INVALID WITH QUOTED DSNAME'
         MEXIT
.MAST    ANOP
&MEMBER  SETC  '8+&DSN'
.MOK     AIF   ('&MEMBER'(1,1) EQ '''').QM
         AIF   ('&MEMBER'(K'&MEMBER,1) EQ '/').BM
         RCPSR2
         AIF   ('&MEMBER'(1,1) EQ '(').RM
         LH    R2,4+&MEMBER            LOAD LENGTH OF MEMBER NAME
         LTR   R2,R2                   TEST FOR ZERO
         BZ    *+30                    IF NO MEMBER, SKIP
         L     R14,&MEMBER             LOAD ADDRESS OF MEMBER
         AGO   .STHM
.RM      LH    R2,4&MEMBER             LOAD LENGTH OF MEMBER
         LTR   R2,R2                   AND TEST FOR ZERO
         BZ    *+30                    IF NO MEMBER, SKIP
         L     R14,0&MEMBER            LOAD ADDRESS OF MEMBER
.STHM    STH   R2,S99TULNG             STORE LENGTH OF MEMBER
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE IN MEMBER NAME
         MVI   S99TUKEY+1,DALMEMBR     MOVE IN MEMBER KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 14
         MEXIT
.BM      RCPTUBFR DALMEMBR,14,&MEMBER
         MEXIT
.QM      RCPBTU DALMEMBR,1,&MEMBER
.EXIT    MEND
./ ADD NAME=RCPDSNPD 0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPDSNPD &PDE
         AIF   ('&PDE'(1,1) EQ '(').RPDE
         RCPDSN &PDE,8+&PDE
         RCPPSWD 16+&PDE
         MEXIT
.RPDE    RCPDSN &PDE,8&PDE
         RCPPSWD 16(&PDE)
         MEND
./ ADD NAME=RCPDSNRT 0100-00038-00038-1647-00011-00011-00000-MACRO
         MACRO
         RCPDSNRT
         SPACE
***********************************************************************
**    DSNAME RETURN TEXT UNIT                                        **
***********************************************************************
         MVI   S99TUKEY+1,DALRTDSN     SET RETURN DSNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,44           SET LENGTH FIELD
         RCPDINC 50
         MEND
./ ADD NAME=RCPDSRGR 0100-00038-00038-1647-00012-00012-00000-MACRO
         MACRO
         RCPDSRGR
         SPACE
***********************************************************************
**    DSORG RETURN TEXT UNIT                                         **
***********************************************************************
         MVI   S99TUKEY+1,DALRTORG     SET RETURN DSORG KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,2            SET LENGTH FIELD
         XC    S99TUPAR(2),S99TUPAR    INITIALIZE FIELD TO ZERO
         RCPDINC 8
         MEND
./ ADD NAME=RCPDUMMY 0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPDUMMY &DUMMY
         SPACE
***********************************************************************
**      DUMMY DATASET TEXT UNIT                                      **
***********************************************************************
         MVI   S99TUPAR+1,DALDUMMY     MOVE IN DUMMY DS TEXT UNIT KEY
         RCPDINC 4
         MEND
./ ADD NAME=RCPEDIT  0100-00038-00038-1647-00011-00011-00000-MACRO
         MACRO - RESERVE SPACE FOR EDIT WORK AREA ONCE ONLY
         RCPEDIT
         GBLC  &RCPPRE,&RCPEDIT
         AIF   ('&RCPEDIT' NE '').MEND
&RCPEDIT SETC  '&RCPPRE.EDIT'
         AIF   ('&RCPPRE' NE '').DS
&RCPEDIT SETC  'RCPEDIT'
.DS      RCPDS
&RCPEDIT DS    3D             EDIT MACRO WORK AREA
         RCPDS
.MEND    MEND
./ ADD NAME=RCPENDD  0100-00038-00038-1647-00037-00037-00000-MACRO
         MACRO
&NAME    RCPENDD
         GBLB  &RCPECT(2),&RCPUPT(2),&RCPPSCB(2),&RCPS99(2)
         GBLC  &RCPPRE,&RCPWKDS,&RCPDS
         LCLC  &P,&CS
&CS      SETC  '&RCPDS'                PROGRAM CSECT
         AIF   (NOT &RCPS99(1)).TDS
         DYNSPACE
.TDS     AIF   ('&RCPWKDS' EQ '').RCPDS
         DS    0D                      ALIGN TO DOUBLEWORD
&P       SETC  '&RCPPRE'
&P.WKLEN EQU   *-&RCPWKDS              LENGTH OF WORK AREA
.RCPDS   RCPDS
         EJECT
         AIF   (NOT &RCPECT(1) OR &RCPECT(2)).TRYUPT
         IKJECT
&CS      CSECT                         REENTER MAIN CSECT
         EJECT
&RCPECT(2)     SETB           1
.TRYUPT  AIF   (NOT &RCPUPT(1) OR &RCPUPT(2)).TRYPSCB
         IKJUPT
&CS      CSECT                         REENTER MAIN CSECT
         EJECT
&RCPUPT(2) SETB  1
.TRYPSCB AIF   (NOT &RCPPSCB(1) OR &RCPPSCB(2)).TRYS99
         IKJPSCB
&CS      CSECT                         REENTER MAIN CSECT
         EJECT
&RCPPSCB(2) SETB  1
.TRYS99  AIF   (NOT &RCPS99(1) OR &RCPS99(2)).TRYREST
         IEFZB4D0
         EJECT
         IEFZB4D2
&CS      CSECT                         REENTER MAIN CSECT
         EJECT
&RCPS99(2) SETB  1
.TRYREST MEND
./ ADD NAME=RCPFDDN  0100-00038-00038-1647-00027-00027-00000-MACRO
         MACRO
         RCPFDDN &DDN
         GBLC &DYNP
         SPACE
***********************************************************************
**        FREE DDNAME TEXT UNIT                                      **
***********************************************************************
         AIF   ('&DDN'(1,1) EQ '''').Q
         AIF   ('&DDN'(K'&DDN,1) EQ '/').B
         RCPSR2
         AIF   ('&DDN'(1,1) EQ '(').R
         L     R14,&DDN                LOAD ADDRESS OF DDNAME
         LH    R2,&DDN+4               LOAD LENGTH OF DDNAME
         AGO   .STH
.R       L     R14,0&DDN               LOAD ADDRESS OF DDNAME
         LH    R2,4&DDN                LOAD LENGTH OF DDNAME
.STH     STH   R2,S99TULNG             STORE DDNAME LENGTH
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE DDNAME
         MVI   S99TUKEY+1,DUNDDNAM     MOVE IN DDNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 14
         MEXIT
.Q       RCPBTU DUNDDNAM,1,&DDN
         MEXIT
.B       RCPTUBFR DUNDDNAM,14,&DDN
         MEND
./ ADD NAME=RCPFDISP 0100-00038-00038-1647-00020-00020-00000-MACRO
         MACRO
         RCPFDISP &DISP
         LCLB  &B(4)
         LCLA  &I
         SPACE
***********************************************************************
**       OVERRIDING DISPOSITION                                      **
***********************************************************************
&B(1)    SETB  ('&DISP' EQ 'KEEP')
&B(2)    SETB  ('&DISP' EQ 'DELETE')
&B(3)    SETB  ('&DISP' EQ 'CATLG')
&B(4)    SETB  ('&DISP' EQ 'UNCATLG')
         AIF   (&B(1) OR &B(2) OR &B(3) OR &B(4)).OK3
         MNOTE 8,'&DISP IS INVALID, DISP=KEEP USED'
&B(1)    SETB  1
.OK3     ANOP
&I       SETA  8*&B(1)+4*&B(2)+2*&B(3)+&B(4)
         MVC   S99TUKEY(8),=Y(DUNOVDSP,1,1,X'0&I.00')
         RCPDINC 8
.EXIT    MEND
./ ADD NAME=RCPFDSN  0100-00038-00038-1647-00064-00064-00000-MACRO
         MACRO
         RCPFDSN &DSN,&MEM
         LCLC  &MEMBER
         GBLC  &DYNP
         SPACE
***********************************************************************
**      FREE DATA SET TEXT UNIT                                      **
***********************************************************************
         AIF   ('&DSN'(1,1) EQ '''').Q
         AIF   ('&DSN'(K'&DSN,1) EQ '/').BD
         AIF   ('&DSN'(1,1) EQ '(').REG
         RCPSR2
         L     R14,&DSN                LOAD ADDRESS OF DSNAME
         LH    R2,&DSN+4               LOAD LENGTH OF DSNAME
.STH     STH   R2,S99TULNG             STORE DSNAME LENGTH
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE DSNAME
         MVI   S99TUKEY+1,DUNDSNAM     MOVE IN DSNAME KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 50
         AGO   .TMEMBER
.REG     L     R14,0&DSN               LOAD ADDRESS OF DSNAME
         RCPSR2
         LH    R2,4&DSN                LOAD LENGTH OF DSNAME
         AGO   .STH
.BD      RCPTUBFR DUNDSNAM,50,&DSN
         AGO   .TMEMBER
.Q       RCPBTU DUNDSNAM,1,&DSN
.TMEMBER AIF   ('&MEM' EQ '').EXIT
         SPACE
***********************************************************************
**       FREE MEMBER NAME TEXT UNIT                                  **
***********************************************************************
&MEMBER  SETC  '&MEM'
         AIF   ('&MEM' NE '*').MOK
         AIF   ('&DSN'(1,1) NE '''').MAST
         MNOTE 8,'MEMBER=* INVALID WITH QUOTED DSNAME'
         MEXIT
.MAST    ANOP
&MEMBER  SETC  '8+&DSN'
.MOK     ANOP
         AIF   ('&MEMBER'(K'&MEMBER,1) EQ '/').BM
         RCPSR2
         AIF   ('&MEMBER'(1,1) EQ '(').RM
         LH    R2,4+&MEMBER            LOAD LENGTH OF MEMBER NAME
         LTR   R2,R2                   TEST FOR ZERO
         BZ    *+30                    IF NO MEMBER, SKIP
         L     R14,&MEMBER             LOAD ADDRESS OF MEMBER
         AGO   .STHM
.RM      LH    R2,4&MEMBER             LOAD LENGTH OF MEMBER
         LTR   R2,R2                   AND TEST FOR ZERO
         BZ    *+30                    IF NO MEMBER, SKIP
         L     R14,0&MEMBER            LOAD ADDRESS OF MEMBER
.STHM    STH   R2,S99TULNG             STORE LENGTH OF MEMBER
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE IN MEMBER NAME
         MVI   S99TUKEY+1,DUNMEMBR     MOVE IN MEMBER KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 14
         MEXIT
.BM      RCPTUBFR DUNMEMBR,14,&MEMBER
         MEXIT
.QM      RCPBTU DUNMEMBR,1,&MEMBER
.EXIT    MEND
./ ADD NAME=RCPFHOLD 0100-00038-00038-1647-00024-00024-00000-MACRO
         MACRO
         RCPFHOLD &H
         AIF   ('&H' EQ 'YES').YES
         AIF   ('&H' EQ 'NO').NO
         MNOTE 4,'HOLD PARMETER VALUE INCORRECT - IGNORED'
         MEXIT
.YES     ANOP
         SPACE 1
***********************************************************************
**       OVERIDING SYSOUT HOLD TEXT UNIT                             **
***********************************************************************
         SPACE 1
         MVI   S99TUKEY+1,DUNOVSHQ MOVE IN TEXT UNIT KEY
         RCPDINC 4
         MEXIT
.NO      ANOP
         SPACE 1
***********************************************************************
**       OVERIDING SYSOUT NO HOLD TEXT UNIT                          **
***********************************************************************
         SPACE 1
         MVI   S99TUKEY+1,DUNOVSNH MOVE IN TEXT UNIT KEY
         RCPDINC 4
         MEND
./ ADD NAME=RCPFORUS 0100-00038-00038-1647-00008-00008-00000-MACRO
         MACRO - TO SET UP SVC 99 TEXT UNIT 'FOR USER'
         RCPFORUS &T
         SPACE 1
***********************************************************************
**       'FOR USER' TEXT UNIT                                        **
***********************************************************************
         RCPVCHAR 0,5,&T,N=X'7701'
         MEND
./ ADD NAME=RCPFREE  0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPFREE &FREE
         SPACE
***********************************************************************
**      UNALLOC AT CLOSE TEXT UNIT                                   **
***********************************************************************
         MVI   S99TUPAR+1,DALCLOSE     MOVE IN CLOSE TEXT UNIT KEY
         RCPDINC 4
         MEND
./ ADD NAME=RCPIOPL  0100-00038-00038-1647-00071-00071-00000-MACRO
         MACRO ,
&NAME    RCPIOPL
         GBLC  &RCPPRE
         GBLB  &RCPIOPL(2)
         GBLB  &RCPSTPB(2),&RCPPTPB(2),&RCPPGPB(2),&RCPGTPB(2)
         LCLC  &P,&L,&L1
&P       SETC  '&RCPPRE'
         EJECT ,
         AIF   (&RCPIOPL(2)).BYPIOPL
&RCPIOPL(2) SETB 1
         IKJIOPL ,
L#IOPL   EQU   *-IOPL                   LENGTH OF IO PARAM LIST
&SYSECT  CSECT ,                        RESUME PROGRAM CSECT
         SPACE 3
.BYPIOPL RCPDS ,
&P.IOPL  DS    CL(L#IOPL)               RESERVE SPACE FOR IOPL
         RCPDS ,
         SPACE 5
***********************************************************************
***   THIS CODE GENERATES AN I/O SERVICE ROUTINE PARAMETER LIST     ***
***********************************************************************
         LA    R1,&P.IOPL               LOAD IOPL ADDRESS
         USING IOPL,R1                  IOPL ADDRESSABLE
         MVC   IOPLUPT,CPPLUPT          MOVE IN ADDRESS OF UPT
         MVC   IOPLECT,CPPLECT          MOVE IN ADDRESS OF ECT
         LA    R15,&P.ECB               LOAD ADDRESS OF ATTN ECB
         ST    R15,IOPLECB              AND STORE IN IOPL
         DROP  R1
  AIF (&RCPSTPB(1) OR &RCPGTPB(1) OR &RCPPGPB(1) OR &RCPPTPB(1)).I
         MEXIT ,
.I       EJECT ,
         AIF   (NOT &RCPSTPB(1) OR &RCPSTPB(2)).TPT
         IKJSTPB ,
&RCPSTPB(2) SETB 1
L#STPB   EQU   *-STPB                   LENGTH OF STPB
&SYSECT  CSECT ,
.TPT     AIF   (NOT &RCPPTPB(1) OR &RCPPTPB(2)).TGT
         IKJPTPB
&RCPPTPB(2) SETB 1
L#PTPB   EQU   *-PTPB                   LENGTH OF PTPB
&SYSECT  CSECT ,
.TGT     AIF   (NOT &RCPGTPB(1) OR &RCPGTPB(2)).TPG
         IKJGTPB ,
&RCPGTPB(2) SETB 1
L#GTPB   EQU   *-GTPB                   LENGTH OF GTPB
&SYSECT  CSECT ,
.TPG     AIF   (NOT &RCPPGPB(1) OR &RCPPGPB(2)).STO
         IKJPGPB ,
&RCPPGPB(2) SETB 1
L#PGPB   EQU   *-PGPB                   LENGTH OF PGPB
&SYSECT  CSECT ,
.STO     SPACE 3
&L       SETC  ''
         RCPDS ,
         AIF   (NOT &RCPSTPB(1)).XPT
&P.STPB  DS    CL(L#STPB)               RESERVE SPACE FOR STPB
&L       SETC  '&L.+L#STPB'
.XPT     AIF   (NOT &RCPPTPB(1)).XGT
&P.PTPB  DS    CL(L#PTPB)               RESERVE SPACE FOR PTPB
&L       SETC  '&L.+L#PTPB'
.XGT     AIF   (NOT &RCPGTPB(1)).XPG
&P.GTPB  DS    CL(L#GTPB)               RESERVE SPACE FOR GTPB
&L       SETC  '&L.+L#GTPB'
.XPG     AIF   (NOT &RCPPGPB(1)).XC
&P.PGPB  DS    CL(L#PGPB)               RESERVE SPACE FOR PGPB
&L       SETC  '&L.+L#PGPB'
.XC      RCPDS ,
&L1      SETC  '&L'(2,K'&L-1)
&L       SETC  '&P'.'&L1'(3,4)
         XC    &L.(&L1.),&L
         MEND  ,
./ ADD NAME=RCPLABEL 0100-00038-00038-1647-00012-00012-00000-MACRO
         MACRO
         RCPLABEL &L
         GBLC  &DYNP
         SPACE 1
***********************************************************************
**       EXPIRY DATE TEXT UNIT                                       **
***********************************************************************
         AIF   ('&L' NE '').EXPIRY
         MNOTE 4,'INVALID EXPIRY DATE OPERAND.'
         MEXIT
.EXPIRY  RCPVCHAR DALEXPDT,14,&L
.EXIT    MEND
./ ADD NAME=RCPLINK  0100-00038-00038-1647-00053-00053-00000-MACRO
         MACRO
&NAME    RCPLINK &MODULE
         LCLC  &OFFSET,&C
         AIF   ('&MODULE' EQ '').ERROR
         AIF   ('&MODULE' NE 'IKJPARS').T1
&OFFSET  SETC  '524'
         AGO   .START
.T1      AIF   ('&MODULE' NE 'IKJDAIR').T2
&OFFSET  SETC  '732'
         AGO   .START
.T2      AIF   ('&MODULE' NE 'IKJEHDEF').T3
&OFFSET  SETC  '736'
         AGO   .START
.T3      AIF   ('&MODULE' NE 'IKJEHCIR').T4
&OFFSET  SETC  '740'
         AGO   .START
.T4      AIF   ('&MODULE' NE 'IKJPUTL').T5
&OFFSET  SETC  '444'
         AGO   .START
.T5      AIF   ('&MODULE' NE 'IKJGETL').T6
&OFFSET  SETC  '348'
         AGO   .START
.T6      AIF   ('&MODULE' NE 'IKJSCAN').T7
&OFFSET  SETC  '480'
         AGO   .START
.T7      AIF   ('&MODULE' NE 'IKJPTGT').T8
&OFFSET  SETC  '464'
         AGO   .START
.T8      AIF   ('&MODULE' NE 'IKJSTCK').T9
&OFFSET  SETC  '472'
         AGO   .START
.T9      ANOP
&NAME    DS    0H
*
 MNOTE *,' EP OF &MODULE. NOT IN CVT. STANDARD LINK USED'
*
         AGO   .LINK
.START   ANOP
&NAME    L     R15,16                  LOAD CVT ADDRESS
         L     R15,&OFFSET.(R15)       LOAD MODULE ADDRESS
         LTR   R15,R15                 IS MODULE ADDRESS THERE?
&C       SETC  'RCP&SYSNDX'
         BNM   &C.L                     IF NOT, BRANCH TO LINK
         BALR  R14,R15                  ELSE BALR TO IT
         B     &C.B                      AND BYPASS LINK
&C.L     LINK  EP=&MODULE
&C.B     DS    0H                      BRANCHED TO IF LINK BYPASSED
         MEXIT
.LINK    ANOP
&NAME    LINK  EP=&MODULE
         MEXIT
.ERROR   MNOTE 4,'NO MODULE NAME SPECIFIED'
         MEND
./ ADD NAME=RCPLOAD  0100-00038-00038-1647-00118-00118-00000-MACRO
         MACRO ,
&NAME    RCPLOAD &MOD,&EP1
         GBLC  &RCPPTEP,&RCPGTEP,&RCPPGEP
         GBLC  &RCPDFEP,&RCPSTEP,&RCPPREP
         GBLC  &RCPPRE
         LCLA  &I,&J
         LCLB  &EPXISTS
         LCLC  &OFFSET,&C,&EP,&MODULE
&EP      SETC  '&EP1'
&MODULE  SETC  '&MOD'
         AIF   ('&MODULE' EQ '').ERROR
         AIF   ('&MODULE'(K'&MOD,1) NE ')').NOBR
&I       SETA  K'&MOD
.LOOP    ANOP  ,
&I       SETA  &I-1
         AIF   (&I LT 2).NOLB
         AIF   ('&MOD'(&I,1) NE '(').LOOP
&MODULE  SETC  '&MOD'(1,&I-1)
&J       SETA  K'&MOD-1-&I
&EP      SETC  '&MOD'(&I+1,&J)
         RCPDS ,
&EP      DS    A                        TO STORE MODULE ADDRESS
         RCPDS ,
.NOBR    ANOP  ,
&EPXISTS SETB  ('&EP' NE '')
         AIF   ('&MODULE' NE 'IKJPARS').T1
&OFFSET  SETC  '524'
&RCPPREP SETC  '&EP'
         AIF   (&EPXISTS).START
         RCPDS ,
&RCPPREP SETC  '&RCPPRE.PREP'
&EP      SETC  '&RCPPREP'
&RCPPREP DS    A                        TO HOLD ADDRESS OF IKJPARS
         RCPDS ,
         AGO   .START
.T1      AIF   ('&MODULE' NE 'IKJDAIR').T2
&OFFSET  SETC  '732'
         AGO   .START
.T2      AIF   ('&MODULE' NE 'IKJEHDEF').T3
&RCPDFEP SETC  '&EP'
&OFFSET  SETC  '736'
         AIF   (&EPXISTS).START
&RCPDFEP SETC  '&RCPPRE.DFEP'
         RCPDS ,
&RCPDFEP DS    A                        ADDR OF DEFAULT SERVICE ROUTINE
         RCPDS ,
&EP      SETC  '&RCPDFEP'
         AGO   .START
.T3      AIF   ('&MODULE' NE 'IKJEHCIR').T4
&OFFSET  SETC  '740'
         AGO   .START
.T4      AIF   ('&MODULE' NE 'IKJPUTL').T5
&RCPPTEP SETC  '&EP'
&OFFSET  SETC  '444'
         AIF   (&EPXISTS).START
&RCPPTEP SETC  '&RCPPRE.PTEP'
&EP      SETC  '&RCPPTEP'
         RCPDS ,
&RCPPTEP DS    A                        ADDR OF PUTLINE ROUTINE
         RCPDS ,
         AGO   .START
.T5      AIF   ('&MODULE' NE 'IKJGETL').T6
&RCPGTEP SETC  '&EP'
&OFFSET  SETC  '348'
         AIF   (&EPXISTS).START
&RCPGTEP SETC  '&RCPPRE.GTEP'
&EP      SETC  '&RCPGTEP'
         RCPDS ,
&RCPGTEP DS    A                        ADDR OF GETLINE ROUTINE
         RCPDS ,
         AGO   .START
.T6      AIF   ('&MODULE' NE 'IKJSCAN').T7
&OFFSET  SETC  '480'
         AGO   .START
.T7      AIF   ('&MODULE' NE 'IKJPTGT').T8
&RCPPGEP SETC  '&EP'
&OFFSET  SETC  '464'
         AIF   (&EPXISTS).START
&RCPPGEP SETC  '&RCPPRE.PGEP'
&EP      SETC  '&RCPPGEP'
         RCPDS ,
&RCPPGEP DS    A                        ADDR OF PUTGET ROUTINE
         RCPDS ,
         AGO   .START
.T8      AIF   ('&MODULE' NE 'IKJSTCK').T9
&RCPSTEP SETC  '&EP'
&OFFSET  SETC  '472'
         AIF   (&EPXISTS).START
&RCPSTEP SETC  '&RCPPRE.STEP'
&EP      SETC  '&RCPSTEP'
         RCPDS ,
&RCPSTEP DS    A                        ADDR OF STACK ROUTINE
         RCPDS ,
         AGO   .START
.T9      ANOP  ,
         AIF   ('&NAME' EQ '').NONAME
&NAME    DS    0H
.NONAME  ANOP  ,
*
         MNOTE *,' EP OF &MODULE NOT IN CVT, STANDARD LOAD USED'
*
         AGO   .LOAD
.START   ANOP  ,
&NAME    L     R15,16                   LOAD CVT ADDRESS
         L     R0,&OFFSET.(0,R15)       LOAD MODULE ADDRESS
         LTR   R0,R0                    IS MODULE LOADED ?
&C       SETC  'RCP&SYSNDX'
         BM    &C                       IF SO, BYPASS LOAD MACRO
.LOAD    LOAD  EP=&MODULE
         AIF   ('&EP' EQ '').EPERR
&C       ST    R0,&EP                   STORE ENTRY POINT ADDRESS
         MEXIT ,
.EPERR   MNOTE 4,'EP RETURN FIELD NOT SPECIFIED'
         MEXIT ,
.ERROR   MNOTE 4,'NO MODULE NAME SPECIFIED'
         MEXIT ,
.NOLB    MNOTE 4,'INVALID MODULE NAME ''&MOD'''
         MEND  ,
./ ADD NAME=RCPLOCSW 0100-00038-00038-1647-00091-00091-00000-MACRO
*23456789*12345*78921234567893123456789*
         MACRO
         RCPLOCSW &SW
.********************************************************************
.*                                                                  *
.*       INNER MACRO USED BY GOIF, SET, RESET AND FLIP.             *
.*       THE PARM PASSED IS THE SWITCH OR LIST OF SWITCHES.         *
.*       RCPLOCSW SCANS THE ARRAYS SET UP BY DCLSW TO SEE IF THE    *
.*       SWITCH BIT NAMES WERE DECLARED, AND IF A LIST WAS PASSED,  *
.*       WHETHER ALL THE SWITCH BITS BELONG TO THE SAME BYTE.       *
.*       RCPLOCSW PASSES BACH THE SWITCH BYTE NAME IN GLOBAL SETC   *
.*       VARIABLE &RCPDSW1 AND THE SWITCH BIT NAME IN GLOBAL SETC   *
.*       &RCPDSW2. IF A LIST OF SWITCHES WAS PASSED, &RCPDSW2       *
.*       CONTAINS THE SWITCH NAMES SEPARATED BY PLUS SIGNS.         *
.*       IF THE FIRST OR ONLY SWITCH WAS NOT FOUND, &RCPDSW1 IS SET *
.*       TO NULL. IF A LIST OF SWITCHES IS PASSED AND ANY SWITCH IS *
.*       NOT DECLARED IN THE SAME SWITCH BYTE AS THE FIRST, AN MNOTE*
.*       IS ISSUED WARNING OF POSSIBLE ERROR, BUT &RCPDSW1 IS SET   *
.*       TO THE NAME OF THE SWITCH BYTE CONTAINING THE FIRST SWITCH *
.*       BIT IN THE LIST.                                           *
.*                                                                  *
.********************************************************************
         GBLA  &RCPDSW#,&RCPGSW#       COUNTER FOR DECLARED SWITCHES
         GBLA  &RCPDSW0                NO OF SWS FOUND BY RCPLOCSW
         GBLB  &RCPDSWD(99)            DEFER DECLARE INDICATORS
         GBLB  &RCPDSW3(20)   INVERT INDICATOR
         GBLC  &RCPDSWN(99)            SWITCH BYTE NAMES
         GBLC  &RCPDSWB(800)           SWITCH BIT NAMES
         GBLC  &RCPGSWN(99)            GENERIC SWITCH BYTE NAMES
         GBLC  &RCPGSWB(99)            GENERIC SWITCH BIT PREFIXES
         GBLC  &RCPDSW1(20)            SWITCH BYTE NAMES
         GBLC  &RCPDSW2(20)            SWITCH BIT NAME(S)
         LCLA  &I,&J,&K,&L,&M,&N
         LCLB  &NOT
         LCLC  &C,&SW1,&SW2
&RCPDSW0 SETA  0                       INITIALIZE
&N       SETA  N'&SW                   NO OF SWITCHES ENTERED
&J       SETA  &RCPDSW#*8+8            INDEX TO LAST DECLARED SW BIT
.LOOP1   AIF   (&M GE &N).EXIT        LOOP FOR EACH SW
&M       SETA  &M+1
&SW2     SETC  '&SW(&M)'               SWITCH TO SEARCH FOR
         AIF   ('&SW2' EQ '').LOOP1    SKIP IF NULL
&I       SETA  8                       INDEX TO FIRST DECLARED SW - 1
&NOT     SETB  0
         AIF   ('&SW2'(1,1) NE '^' AND '&SW2'(1,1) NE '-').TNOT2
&SW2     SETC  '&SW2'(2,K'&SW2-1)       REMOVE NOT SIGN
&NOT     SETB  1                       INDICATE INVERT FUNCTION
         AGO   .LOOP1A                 CONTINUE
.TNOT2   AIF   (K'&SW2 LT 5).LOOP1A    CHECK LENGTH
         AIF   ('&SW2'(1,4) NE 'NOT-').LOOP1A  WAS SWITCH INVERTED?
&SW2     SETC  '&SW2'(5,K'&SW2-4)      STRIP OFF 'NOT-'
&NOT     SETB  1                       INDICATE INVERTED
.LOOP1A  AIF   (&I GE &J).TGEN         SEARCH NAME ARRAY
&I       SETA  &I+1
         AIF   ('&RCPDSWB(&I)' NE '&SW2').LOOP1A
.*
.*   WE FOUND IT
.*
&L       SETA  (&I-1)/8                INDEX TO BYTE NAME
&SW1     SETC  '&RCPDSWN(&L)'          GET BYTE NAME
.FOUNDSW ANOP                          HAVE WE HAD IT BEFORE?
&K       SETA  0
.SWL1    AIF   (&K GE &RCPDSW0).NEWSW1
&K       SETA  &K+1
         AIF   ('&RCPDSW1(&K)' NE '&SW1').SWL1
         AIF   (&RCPDSW3(&K) NE &NOT).SWL1  ENSURE INVERT BIT THE SAME
.*
.* WE FOUND IT
.*
&RCPDSW2(&K) SETC '&RCPDSW2(&K)+&SW2'  CONCATENATE CURRENT SW
         AGO   .LOOP1                  GO DO NEXT
.NEWSW1  ANOP
&RCPDSW0 SETA  &K+1                    NEXT SW BYTE INDEX
&RCPDSW1(&RCPDSW0) SETC '&SW1'         BYTE NAME
&RCPDSW2(&RCPDSW0) SETC '&SW2'         BIT NAME
&RCPDSW3(&RCPDSW0) SETB (&NOT)         SET INVERT INDICATOR
         AGO   .LOOP1                  GO DO NEXT
.TGEN    ANOP  SEARCH GENERIC NAME ARRAY
&I       SETA  0
&L       SETA  K'&SW2
.LOOP2   ANOP
&I       SETA  &I+1
         AIF   (&I GT &RCPGSW#).NOTFND
&C       SETC  '&RCPGSWB(&I)'
         AIF   (&L LT K'&C).LOOP2
         AIF   ('&SW2'(1,K'&C) NE '&C').LOOP2
&SW1     SETC  '&RCPGSWN(&I)'
         AGO   .FOUNDSW                EUREKA
.NOTFND  MNOTE 8,'SWITCH ''&SW2'' NOT DECLARED'
         AGO   .LOOP1
.EXIT    MEND
./ ADD NAME=RCPMCA   0100-00038-00038-1647-00023-00023-00000-MACRO
         MACRO ,
         RCPMCA &DSECT=YES
         GBLC  &RCPPRE
         GBLA  &RCPSWS(10)
         LCLC  &P
         RCPDEBUG
&P       SETC  '&RCPPRE'
         AIF   (&RCPSWS(2) NE 2).DSECT
&P.MCA   DS    0F                       MODULE COMMUNICATIONS AREA
         AGO   .MCA2
.DSECT   ANOP  ,
&P.MCA   DSECT ,                        MODULE COMMUNICATIONS AREA
.MCA2    ANOP  ,
&P.XDS   DS    A                        ADDR OF EXTERNAL DUMMY SECTION
         AIF   (&RCPSWS(3) LT 1).EXIT
&P.A#GET DS    A                        ADDRESS OF LIFO GET ROUTINE
&P.A#FRE DS    A                        ADDRESS OF LIFO FREE ROUTINE
&P.#S    DS    A                        ADDRESS OF CURRENT LIFO STACK
&P.#E    DS    A                        ADDRESS OF END OF LIFO STACK
&P.#N    DS    A                        ADDRESS OF NEXT FREE AREA
&P.#C    DS    A                        ADDRESS OF NEXT LIFO STACK
&P.#L    DS    F                        LENGTH OF CURRENT LIFO STACK
.EXIT    MEND  ,
./ ADD NAME=RCPMSVGP 0100-00038-00038-1647-00027-00027-00000-MACRO
         MACRO
         RCPMSVGP &MSVGP
         GBLC  &DYNP
         SPACE 1
***********************************************************************
**   BUILD THE MSVGP TEXT UNIT                                       **
***********************************************************************
         AIF   ('&MSVGP'(K'&MSVGP,1) EQ '/').BTU
         AIF   ('&MSVGP'(1,1) EQ '''').Q
         RCPSR2
         AIF   ('&MSVGP'(1,1) EQ '(').R
         L     R14,&MSVGP              LOAD ADDRESS OF MSVGP
         LH    R2,&MSVGP+4             LOAD LENGTH OF MSVGP
         AGO   .STH
.R       L     R14,0&MSVGP             LOAD ADDRESS OF MSVGP
         LH    R2,4&MSVGP              LOAD LENGTH OF MSVGP
.STH     STH   R2,S99TULNG             STORE MSVGP LENGTH
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE MSVGP
         MVI   S99TUKEY+1,DALMSVGP     MOVE IN MSVGP KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         RCPDINC 14
         MEXIT
.Q       RCPBTU DALMSVGP,1,&MSVGP
         MEXIT
.BTU     RCPTUBFR DALMSVGP,14,&MSVGP
         MEND
./ ADD NAME=RCPMUDEP 0100-00038-00038-1647-00039-00039-00000-MACRO
         MACRO -      TO CHECK FOR MUTUALLY DEPENDENT KEYWORDS
         RCPMUDEP &A,&RC=4        MNOTE ERROR CODE
         LCLA  &I,&J
.*
.*     THIS IS AN INNER MACRO THAT CAN BE USED TO CHECK
.*     FOR KEYWORDS THAT ARE DEPENDENT ON OTHER KEYWORDS.
.*     FOR EXAMPLE IN THE FOLLOWING MACRO:
.*
.*     MACRO
.*     #FRED  &A=,&B=,&C=
.*     ....
.*     ....
.*     MEND
.*
.*     IF C=XXX IS ONLY VALID WHEN &B IS SPECIFIED, I.E. IF
.*     SPECIFICATION OF &C IS ONLY VALID WHEN &B IS SPECIFIED,
.*     #FRED SHOULD INCLUDE THE FOLLOWING.
.*
.*     RCPMUDEP (B=,&B),(C=,&C),RC=NN
.*
.*     WHERE NN IS AN MNOTE ERROR CODE.
.*     IF &B IS NULL, AN MNOTE WILL BE GENERATED FOR
.*     &C IF &C IS SPECIFIED. IF &B IS SPECIFIED OR &C IS
.*     NULL, NO MNOTE WILL BE GENERATED.
.*     ANY NUMBER OF KEYWORDS CAN BE SPECIFIED.
.*     THE FIRST OPERAND OF A SUBLIST IS THE KEYWORD NAME,
.*     AND THE SECOND OPERAND IS THE KEYWORD VALUE.
.*
         AIF   ('&A(2)' NE '').EXIT    OK IF FIRST KW ENTERED
&I       SETA  1
&J       SETA  N'&SYSLIST
.LOOP    ANOP
&I       SETA  &I+1                    GET NEXT POSITIONAL
         AIF   (&I GT &J).EXIT         EXIT IF ALL DONE
         AIF   ('&SYSLIST(&I,2)' EQ '').LOOP   SKIP IF KEYWORD IS NULL
         MNOTE &RC,'**** &SYSLIST(&I,1) CAN ONLY BE SPECIFIED WITH &A(1X
               ), IT IS IGNORED'
         AGO   .LOOP
.EXIT    MEND
./ ADD NAME=RCPMUEXC 0100-00038-00038-1647-00033-00033-00000-MACRO
         MACRO -   TO CHECK FOR MUTUALLY EXCLUSIVE KEYWORDS
         RCPMUEXC &RC=4       ERROR CODE FOR MNOTE
         LCLA  &I,&J
         LCLC  &C
.*
.*   THIS IS AN INNER MACRO WHICH CAN BE USED TO CHECK
.*   FOR MUTUALLY EXCLUSIVE KEYWORDS.
.*   FOR INSTANCE, IF A MACRO CALLED 'M' HAS 3 KEYWORDS,
.*   'A','B','C', EACH OF WHICH IS MUTUALLY EXCLUSIVE,
.*   THAT MACRO COULD CODE
.*
.*   RCPMUEXC (A=,&A),(B=,&B),(C=,&C),RC=N
.*
.*   WHERE N IS THE ERROR CODE FOR AN MNOTE (DEFAULT=4).
.*   THE KEYWORDS ARE SPECIFIED IN HEIRARCHICAL ORDER.
.*   I.E., IF A=XXXX, THE KEYWORDS B= & C= MUST BE NULL.
.*   B=XXX IS ONLY VALID IF A=''  AND C=XXXX IS ONLY VALID IF
.*   B=''. AN MNOTE IS GENERATED FOR EVERY MUTUALLY EXCLUSIVE
.*   KEYWORD FOUND.
&J       SETA  N'&SYSLIST     COUNT OF ENTRIES
.LOOP    ANOP
&I       SETA  &I+1                    GET NEXT POSIT PARAMETER
         AIF   (&I GT &J).EXIT         EXIT IF NO MORE POSITIONALS
         AIF   ('&SYSLIST(&I,2)' EQ '').LOOP IGNORE IF NULL OP
&C       SETC  '&SYSLIST(&I,1)'        SAVE KEYWORD NAME
.LOOP2   ANOP
&I       SETA  &I+1                    GET NEXT POSIT PARAMETER
         AIF   (&I GT &J).EXIT         EXIT IF ALL DONE
         AIF   ('&SYSLIST(&I,2)' EQ '').LOOP2 IGNORE IF NULL OP
         MNOTE &RC,'&SYSLIST(&I,1) MUTUALLY EXCLUSIVE WITH &C, IT IS IGX
               NORED'
         AGO   .LOOP2
.EXIT    MEND
./ ADD NAME=RCPNTU   0100-00038-00038-1647-00047-00047-00000-MACRO
         MACRO
         RCPNTU &KEY,&LEN,&PAR
.*
.*     THIS IS AN ALLOC/FREE MACRO TEXT UNIT PROCESSOR SUBROUTINE
.*     MACRO. IT BUILDS NUMERIC TYPE TEXT UNITS.
.*
         LCLA  &L,&R
         LCLC  &C
         GBLC  &RCPTYPE
.*  ALLOC/FREE INNER MACRO TO SET UP NUMERIC TEXT UNITS
&L       SETA  1                       DEFAULT LENGTH
         AIF   ('&LEN' EQ '').NL
&L       SETA  &LEN
.NL      MVI   S99TUKEY+1,&KEY         SET KEY FIELD
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,&L           SET LENGTH FIELD
         AIF   ('&PAR'(1,1) EQ '(').REG
         RCPTYPE &PAR                  ANALYSE PARAMETER
         AIF   ('&RCPTYPE' EQ 'N').NUMERIC
&R       SETA  4-&L
         MVC   S99TUPAR(&L),&R+&PAR    MOVE IN QUANTITY
         RCPDINC 10
         MEXIT
.NUMERIC AIF   (&L EQ 1).NL1
         MVC   S99TUPAR(&L.),=AL&L.(&PAR) MOVE IN QUANTITY
&R       SETA  &L+6
         AIF   (&R/2 EQ (&R+1)/2).LOK ENSURE LENGTH EVEN
&R       SETA  &R+1
.LOK     RCPDINC &R
         MEXIT
.NL1     MVI   S99TUPAR,&PAR           MOVE IN QUANTITY
         RCPDINC 8
         MEXIT
.REG     ANOP
&C       SETC  '&PAR'(2,K'&PAR-2)
         AIF   (&L EQ 3).STCM
         AIF   (&L EQ 2).STH
         AIF   (&L EQ 1).STC
         ST    &C,S99TUPAR             STORE TEXT UNIT QUANTITY
         AGO   .RCPDINC
.STH     STH   &C,S99TUPAR             STORE TEXT UNIT QUANTITY
         AGO   .RCPDINC
.STC     STC   &C,S99TUPAR             STORE TEXT UNIT QUANTITY
         AGO   .RCPDINC
.STCM    STCM  &C,7,S99TUPAR           STORE TEXT UNIT QUANTITY
.RCPDINC RCPDINC 10
         MEND
./ ADD NAME=RCPPERM  0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPPERM
         SPACE
***********************************************************************
**     PERMANENTLY ALLOCATED ATTRIBUTE TEXT UNIT                     **
***********************************************************************
         MVI   S99TUKEY+1,DALPERMA     SET TEXT UNIT KEY
         RCPDINC  4
         MEND
./ ADD NAME=RCPPPL   0100-00038-00038-1647-00090-00090-00000-MACRO
         MACRO ,
&NAME    RCPPPL &PCL=,&NOPARM=,&PARSERR=,&PDLREG=R11,                  X
               &PDLNAME=,&PARSEP=,&PARSWKA=
         GBLB  &RCPPPL(2),&RCPECT(2)
         GBLC  &RCPPRE,&RCPPREP
         LCLC  &P
&P       SETC  '&RCPPRE'
         AIF   (&RCPPPL(2)).BPPL
         EJECT ,
         IKJPPL ,
L#PPL    EQU   *-PPL                    LENGTH OF PPL
&SYSECT  CSECT ,
         SPACE 1
&RCPPPL(2) SETB 1
.BPPL    RCPDS ,
&P.PPL   DS    CL(L#PPL)                RESERVE SPACE FOR PPL
&P.PDLP  DS    F                        POINTER TO PDL
         RCPDS ,
         SPACE 6
***********************************************************************
***   THIS CODE GENERATES A PARSE PARAMETER LIST                    ***
***********************************************************************
         XC    &P.PDLP,&P.PDLP          ZERO PDL POINTER
         AIF   ('&NOPARM(1)' EQ '' OR '&NOPARM(2)' NE '').PB2
         L     R1,CPPLECT               LOAD ECT ADDRESS
&RCPECT(1) SETB 1
         USING ECT,R1                   ECT ADDRESSABLE
         TM    ECTSWS,ECTNOPD           WERE ANY OPERANDS SUPPLIED ?
         BO    &NOPARM(1)               NO, BRANCH OUT
         SPACE 1
.PB2     LA    R1,&P.PPL                LOAD PPL ADDRESS
         USING PPL,R1
         MVC   PPLUPT,CPPLUPT           MOVE IN UPT ADDRESS
         MVC   PPLECT,CPPLECT           MOVE IN ECT ADDRESS
         MVC   PPLCBUF,CPPLCBUF         MOVE IN CBUF ADDRESS
         LA    R15,&P.ECB               LOAD ATTN ECB ADDRESS
         ST    R15,PPLECB                AND STORE IN PPL
         LA    R15,&P.PDLP              LOAD PDL POINTER ADDRESS
         ST    R15,PPLANS                AND STORE IN PPL
         AIF   ('&PARSWKA' EQ '').PB3
         AIF   ('&PARSWKA'(1,1) EQ '').PB4
         LA    R15,&PARSWKA             LOAD ADDRESS OF WORK AREA
         ST    R15,PPLUWA                AND STORE IN PPL
         AGO   .PB3
.PB4     ST    &PARSWKA(1),PPLUWA       STORE ADDRESS OF WORKAREA
.PB3     AIF   ('&PCL' EQ '').EXIT
         L     R15,=A(&PCL)             LOAD PCL ADDRESS
         ST    R15,PPLPCL                AND STORE IN PPL
         SPACE 2
         AIF   ('&NOPARM(1)' EQ '' OR '&NOPARM(2)' EQ '').PB5
         L     R1,CPPLECT               LOAD ECT ADDRESS
&RCPECT(1) SETB 1
         USING ECT,R1
         TM    ECTSWS,ECTNOPD           WERE ANY OPERANDS SUPPLIED ?
         BO    &NOPARM(1)               NO, BRANCH OUT
         SPACE 1
.PB5     AIF   ('&RCPPREP' EQ '').NOPREP
         L     R15,&RCPPREP             LOAD EP OF IKJPARS
         BALR  R14,R15                  AND ENTER IT
         AGO   .PRET
.NOPREP  ANOP  ,
         L     R15,16                   LOAD CVT ADDRESS
         TM    524(R15),128             IS IKJPARS LOADED ?
         AIF   ('&PARSEP' EQ '').PBL1
         BZ    &P.LOAD                  NO, BRANCH TO LOAD SVC
         L     R15,524(R15)             LOAD EP OF IKJPARS
         ST    R15,&PARSEP              SAVE ITS ADDRESS
         BALR  R14,R15                  THEN BALR TO IT
         B     &P.PLNKB                 BYPASS LOAD SVC
&P.LOAD  LOAD  EP=IKJPARS
         LR    R15,R0                   LOAD EP OF IKJPARS
         ST    R15,&PARSEP              SAVE IT
         BALR  R14,R15                  THEN BALR TO IT
&P.PLNKB DS    0H
         AGO   .PRET
.PBL1    BZ    &P.PLINK                 NO, BRANCH TO LINK SVC
         L     R15,524(R15)             ELSE LOAD ITS ADDRESS
         BALR  R14,R15                  AND BALR TO IT
         B     &P.PLNKB                 BYPASS LINK SVC
&P.PLINK LINK  EP=IKJPARS
&P.PLNKB DS    0H
.PRET    AIF   ('&PARSERR' EQ '').EXIT
         SPACE 1
         LTR   R15,R15                  TEST RETURN CODE
         BNZ   &PARSERR                  AND BRANCH ON NON-ZERO
         SPACE 1
         AIF   ('&PDLREG' EQ '' OR '&PDLNAME' EQ '').EXIT
         L     &PDLREG,&P.PDLP          LOAD PDL ADDRESS
         USING &PDLNAME,&PDLREG         PDL DSECT ADDRESSABLE
.EXIT    MEND  ,
./ ADD NAME=RCPPROC  0100-00038-00038-1647-00158-00158-00000-MACRO
         MACRO ,
         RCPPROC &WKCSECT=,&WKDSECT=,                                  X
               &REG1=,&REG0=,&ISA=,&SAVEPRE=,                          X
               &SAVESUF=,&SP=
         GBLA  &RCPSWS(10)
         GBLC  &RCPPRE,&RCPWKCS,&RCPWKDS
         GBLC  &RCPSPN
         LCLC  &P,&C
         RCPDEBUG
&P       SETC  '&RCPPRE'
         AIF   ('&WKCSECT' EQ '').TDS
&RCPWKCS SETC  '&WKCSECT'
         AGO   .SETCS2
.TDS     AIF   ('&WKDSECT' EQ '').SYSECT
&RCPWKDS SETC  '&WKDSECT'
         AGO   .SETCS
.SYSECT  ANOP  ,
&RCPWKDS SETC  '&SYSECT'
.SET1    AIF   (K'&RCPWKDS LT 8).LOK
&RCPWKDS SETC  '&RCPWKDS'(1,4)'&RCPWKDS'(6,3)'1'
         AGO   .SETCS
.LOK     ANOP  ,
&RCPWKDS SETC  '&RCPWKDS.1'
.SETCS   ANOP  ,
&RCPWKCS SETC  ''
.SETCS2  ANOP  ,
&RCPSWS(4) SETA &RCPSWS(2)-1 SET W/A TO BE FREED OPT IF PROC(MAIN)
         AIF   ('&ISA' EQ '').NISA
&RCPSWS(3) SETA 1                       SET LIFO FLAG IF ISA SPEC
.NISA    ANOP  ,
         SPACE 2
         RCPDS ,
         DS    9D                       SAVE AREA
&P.RCODE DS    F                        RETURN CODE
         RCPMCA ,
         RCPDS ,
         SPACE 2
         AIF   ('&REG1' EQ '').TR0
         LR    &REG1,R1                 SAVE CONTENTS OF REG 1
.TR0     AIF   ('&REG0' EQ '').TP
         LR    &REG0,R0                 SAVE CONTENTS OF REG 0
.TP      AIF   (&RCPSWS(2) EQ 2).PROCMN   PROCMAIN OPTION
         AIF   (&RCPSWS(3) EQ 1).PL     LIFO OPTION
         L     R15,0(0,R13)             R15 -> MODULE COMM AREA
         L     R15,&P.XDS-&P.MCA(0,R15) LOAD EXTERNAL DUMMY SECT ADDR
         A     R15,&P.QCON              GET OFFSET TO WORK AREA
         ST    R15,8(0,R13)             CHAIN SAVE
         ST    R13,4(0,R15)              AREAS TOGETHER
         MVC   0(4,R15),0(R13)          COPY POINTER TO COMM AREA
         LR    R13,R15                  LOAD WORK AREA ADDRESS
         USING &RCPWKCS&RCPWKDS,R13
         MEXIT ,
.PL      ANOP  ,
***********************************************************************
*        GET WORKAREA FROM LIFO STACK                                 *
***********************************************************************
         #GET  LV=&P.WKLEN
         ST    R1,8(0,R13)              CHAIN SAVE
         ST    R13,4(0,R1)               AREAS TOGETHER
         MVC   0(4,R1),0(R13)           PROPAGATE MODULE COMM AREA ADDR
         LR    R13,R1                   LOAD WORK AREA ADDRESS
         USING &RCPWKCS&RCPWKDS,R13
         MEXIT ,
.PROCMN  L     R0,&P.CXD                LOAD WORK AREA LENGTH
 MNOTE *,'       GETMAIN RU,LV=(0),SP=&SP,BNDRY=PAGE'
         GETMAIN RU,LV=(0),SP=&SP,BNDRY=PAGE
         SR    R15,R15                  FROM LENGTH IS ZERO
         LR    R14,R1                   SAVE WORK AREA ADDRESS
         L     R1,&P.CXD                LOAD WORK AREA LENGTH
         LR    R0,R14                   TO ADDRESS
         MVCL  R0,R14                   CLEAR THE WORK AREA
         LR    R1,R14                   RESTORE WORK AREA POINTER
&RCPSPN  SETC  '&SP'
         LR    R15,R13                  SAVE CALLER'S SAVE AREA ADDR
         LR    R13,R1                   LOAD EXT DUMMY SECTION ADDR
         AL    R13,&P.QCON              ADD OFFSET TO WORK AREA
         ST    R13,8(0,R15)             CHAIN SAVE
         ST    R15,4(0,R13)              AREAS TOGETHER
         USING &RCPWKCS&RCPWKDS,R13
         ST    R1,&P.XDS                STORE DUMMY SECTION ADDR IN    X
                                         MODULE COMMUNICATIONS AREA
         LA    R15,&P.MCA               STORE COMMUNICATIONS AREA ADDR
         ST    R15,0(0,R13)              IN WORD 1 OF SAVE AREA
         AIF   (&RCPSWS(3) EQ 0 AND '&ISA' EQ '').EXIT
&RCPSWS(3) SETA 1                       SET LIFO IN CASE ONLY ISA SPEC
&C       SETC  '&ISA'
         AIF   ('&ISA' NE '').TK
&C       SETC  '8192'
         AGO   .NK
.TK      AIF   ('&C'(K'&C,1) NE 'K').NK
&C       SETC  '&C'(1,K'&C-1)'*1024'
.NK      EJECT ,
***********************************************************************
**       INITIALIZE MODULE COMMUNICATIONS AREA WITH POINTERS         **
**       TO LIFO STACK AND LIFO GET/FREE ROUTINES                    **
***********************************************************************
         SPACE 1
         MVC   &P.A#GET,=A(#####GET)   MOVE LIFO GET AND FREE
         MVC   &P.A#FRE,=A(####FREE)    ROUTINE ADDRESSES TO MCA
         L     R15,=Q(#####ISA)        COMPUTE LIFO STACK
         AL    R15,&P.XDS               PSEUDO REGISTER OFFSET
         ST    R15,&P.#S                 AND INITIALIZE POINTERS
         ST    R15,&P.#N                  IN MODULE COMMUNICATIONS AREA
         L     R14,=A(&C)              LOAD SIZE OF INITIAL STACK AREA
         ST    R14,&P.#L               STORE THIS IN MCA
         ALR   R15,R14                  THEN COMPUTE STACK END ADDRESS
         ST    R15,&P.#E                 AND STORE THIS INTO MCA
         EJECT ,
***********************************************************************
**       LIFO STACK GET/FREE ROUTINES                                **
***********************************************************************
         SPACE 1
#####ISA DXD   CL(&C)                   DEFINE PSEUDO REGISTER FOR ISA
         SPACE 1
         PUSH  USING
         DROP  ,
         USING &P.MCA,R1                R1 POINTS TO MCA
#####GET RSECT ,                        LIFO GET ROUTINE
#####GET AMODE ANY
#####GET RMODE ANY
         USING #####GET,R15             R0 CONTAINS LENGTH NEEDED
         A     R0,&P.F7                 ROUND REQUEST UP TO
         N     R0,&P.F8                 A DOUBLEWORD BOUNDARY
         A     R0,&P.#N                 PT TO NEXT FREE LIFO SLOT
         CL    R0,&P.#E                 IF WE'VE GONE PAST THE END OF
         BH    &P.GA                    THE STACK, GIVE UP AND ABEND
         L     R15,&P.#N                PT TO ALLOCATED SLOT
         ST    R0,&P.#N                 SAVE ADDRESS OF NEXT SLOT
         LR    R1,R15                   MOVE SLOT POINTER
         BR    R14                      RETURN TO CALLER, R1 @ SLOT
*        ABEND 1000,DUMP                STACK TOO SMALL, USE ISA=
&P.GA    LA    R1,1000                  LOAD ABEND CODE
         O     R1,&P.X8                 TURN ON DUMP FLAG
         SVC   13                       ISSUE ABEND SVC
         SPACE 1
         ENTRY ####FREE                 LIFO FREE ROUTINE
         USING ####FREE,R15             R0 CONTAINS ADDRESS
####FREE CL    R0,&P.#S                 ENSURE THE ADDRESS
         BL    &P.FA                    TO BE FREE'ED
         CL    R0,&P.#E                 IS WITHIN THE BOUNDARIES
         BH    &P.FA                    OF THE CURRENT STACK ELEMENT
         A     R0,&P.F7                 FORCE AREA TO BE FREE'ED TO
         N     R0,&P.F8                 DOUBLEWORD BNDRY FOR NEXT GUY
         ST    R0,&P.#N                 SAVE @ NEXT FREE LIFO SLOT
         BR    R14                      RETURN TO CALLER
*        ABEND 1001,DUMP                INVALID AREA ADDRESS
&P.FA    LA    R1,1001                  LOAD ABEND CODE
         O     R1,&P.X8                 TURN ON DUMP FLAG
         SVC   13                       ISSUE ABEND SVC
         SPACE 1
         CNOP  0,4                      GET FULLWORD BOUNDARY
&P.F7    DC    F'7'                     CONSTANTS TO ROUND REQUEST UP
&P.F8    DC    F'-8'                    TO A DOUBLEWORD BOUNDARY
&P.X8    DC    X'80000000'              DUMP FLAG FOR ABEND
         POP   USING                    KILL ADDRESSABILITY
         SPACE 1
&SYSECT  CSECT ,                        RESUME MAIN PROGRAM CSECT
.EXIT    MEND  ,
./ ADD NAME=RCPPSWD  0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPPSWD &PASSW
         GBLC  &DYNP
         SPACE
***********************************************************************
**   BUILD THE PASSWORD TEXT UNIT                                    **
***********************************************************************
         RCPVCHAR DALPASSW,14,&PASSW
         MEND
./ ADD NAME=RCPQNAME 0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPQNAME &QNAME
         GBLC  &DYNP
         SPACE
***********************************************************************
**   BUILD THE QNAME TEXT UNIT                                       **
***********************************************************************
         RCPVCHAR DALQNAME,14,&QNAME
         MEND
./ ADD NAME=RCPRNGE  0100-00038-00038-1647-00017-00017-00000-MACRO
         MACRO - BREAK A RANGE PARAMETER INTO TWO
         RCPRNGE &P
         GBLC  &RCPRNGE(2)
         LCLA  &I,&J,&K
&K       SETA  K'&P
&RCPRNGE(1) SETC ''
&RCPRNGE(2) SETC ''
.LOOP    ANOP
&I       SETA  &I+1
         AIF   (&I GT &K).NR
         AIF   ('&P'(&I,1) NE '-' AND '&P'(&I,1) NE ':').LOOP
&RCPRNGE(1) SETC '&P'(1,&I-1)
&RCPRNGE(2) SETC '&P'(&I+1,&K-&I)
         MEXIT
.NR      ANOP
&RCPRNGE(1) SETC '&P'
         MEND
./ ADD NAME=RCPSPACE 0100-00038-00038-1647-00095-00095-00000-MACRO
         MACRO
         RCPSPACE &SPACE
         GBLA  &RCPSUB#                NO OF SUBLIST ELEMENTS
         GBLC  &RCPSUBL(100)           SUBLIST ELEMENTS
.**********************************************************************
.*    THIS IS AN ALLOC INNER MACRO TO BUILD THE ALLOCATION SPACE
.*    QUANTITY TEXT UNIT. IT SHOULD BE SPECIFIED AS:-
.*     SPACE=(TYPE,(PRIMARY,SECONDARY,DIRECTORY),RLSE,CONTIG,ROUND)
.*   WHERE TYPE IS 'TRK', 'CYL', 'ABSTR' OR A BLOCK QUANTITY
.*     'CYL' OR 'TRK' SHOULD NOT BE ENTERED IN QUOTES. THE BLOCK
.*     QUANTITY CAN BE A NUMBER, A REGISTER (IN BRACKETS), OR THE
.*     NAME OF A FULLWORD CONTAINING THE BLOCK SIZE.
.**********************************************************************
         AIF   ('&SPACE(1)' EQ '' OR '&SPACE(1)' EQ 'TRK').TRK
         AIF   ('&SPACE(1)' EQ 'CYL').CYL
***********************************************************************
**        SPACE UNIT IN BLOCKS                                       **
***********************************************************************
         RCPNTU DALBLKLN,3,&SPACE(1)  GENERATE BLOCK UNIT TU
         AGO   .TPRIME        GO TEST PRIME QUANTITY
.TRK     ANOP  TRACK SPEC REQ OR DEFAULTED
         SPACE
***********************************************************************
**       SPACE QUANTITY IN TRACKS                                    **
***********************************************************************
         MVI   S99TUKEY+1,DALTRK       SET TEXT UNIT KEY
         RCPDINC 4
         AGO   .TPRIME
.CYL     ANOP  CYL QUANTITY
         SPACE 1
***********************************************************************
**      SPACE UNIT IN CYLINDERS                                      **
***********************************************************************
         MVI   S99TUKEY+1,DALCYL       SET TEXT UNIT KEY
         RCPDINC 4                     STORE TEXT UNIT ADDR
.TPRIME  RCPSUBL &SPACE(2)             BREAK UP SUBLIST
         AIF   (&RCPSUB# EQ 0).TCONTIG
         AIF   ('&RCPSUBL(1)' EQ '').TSP2
         SPACE
***********************************************************************
**       PRIMARY SPACE QUANTITY                                      **
***********************************************************************
         RCPNTU DALPRIME,3,&RCPSUBL(1)
.TSP2    AIF   (&RCPSUB# LT 2).TCONTIG
         AIF   ('&RCPSUBL(2)' EQ '').TSP3
         SPACE
***********************************************************************
**       SECONDARY SPACE QUANTITY                                    **
***********************************************************************
         RCPNTU DALSECND,3,&RCPSUBL(2)
.TSP3    AIF   (&RCPSUB# LT 3).TCONTIG
         AIF   ('&RCPSUBL(3)' EQ '').TCONTIG
         SPACE
***********************************************************************
**       DIRECTORY BLOCK QUANTITY                                    **
***********************************************************************
         RCPNTU DALDIR,3,&RCPSUBL(3)
.TCONTIG AIF  ('&SPACE(3)' EQ 'CONTIG' OR '&SPACE(4)' EQ 'CONTIG').CON
         AIF   ('&SPACE(3)' EQ 'MXIG' OR '&SPACE(4)' EQ 'MXIG').MXIG
         AIF   ('&SPACE(3)' EQ 'ALX' OR '&SPACE(4)' EQ 'ALX').ALX
.TRLSE   AIF   ('&SPACE(3)' EQ 'RLSE' OR '&SPACE(4)' EQ 'RLSE').RLSE
.TROUND  AIF   ('&SPACE(4)'EQ'ROUND'OR'&SPACE(5)'EQ'ROUND').ROUND
         MEXIT
.CON     ANOP
***********************************************************************
**      CONTIGUOUS SPACE TEXT UNIT                                   **
***********************************************************************
         RCPNTU DALSPFRM,1,8
         AGO   .TRLSE
.MXIG    ANOP
***********************************************************************
**       MAXIMUM CONTIGUOUS SPACE TEXT UNIT                          **
***********************************************************************
         RCPNTU DALSPFRM,1,4
         AGO   .TRLSE
.ALX     ANOP
***********************************************************************
**       'ALX' SPACE TEXT UNIT                                       **
***********************************************************************
         RCPNTU DALSPFRM,1,2
         AGO   .TRLSE
.RLSE    ANOP
***********************************************************************
**      RELEASE UNUSED SPACE TEXT UNIT                               **
***********************************************************************
         MVI   S99TUKEY+1,DALRLSE      SET TEXT UNIT KEY
         RCPDINC 4
         AGO   .TROUND
.ROUND   ANOP
***********************************************************************
**      RELEASE UNUSED SPACE TEXT UNIT                               **
***********************************************************************
         MVI   S99TUKEY+1,DALROUND     MOVE IN TEXT UNIT KEY
         RCPDINC 4
         MEND
./ ADD NAME=RCPSPEC  0100-00038-00038-1647-00013-00013-00000-MACRO
         MACRO - SET UP USER DEFINED TEXT UNIT
         RCPSPEC &T
         LCLA  &I,&J
&I       SETA  1
&J       SETA  K'&T
         SPACE
***********************************************************************
**       PROCESS SPECIAL TEXT UNITS                                  **
***********************************************************************
.LOOP    RCPVCHAR &T(&I),&T(&I+2),&T(&I+3),N=&T(&I+1)
&I       SETA  &I+4
         AIF   (&I LE &J).LOOP
         MEND
./ ADD NAME=RCPSR2   0100-00038-00038-1647-00020-00020-00000-MACRO
         MACRO
         RCPSR2 &A
         GBLB  &RCPSR2
         GBLC  &DYNP
         LCLC  &C
.*   TO SAVE REG 2 IN REG 0 FOR ALLOC INNER MACROS FIRST TIME ONLY
.*    IF OPERAND SUPPLIED AND SAVE DONE, RESTORES REG 2 AND
.*    GENERATES MOVE INSTRUCTION FOR EXECUTE
         AIF   ('&A' NE '').UNSAVE
         AIF   (&RCPSR2).EXIT
&RCPSR2  SETB  1
         LR    R0,R2                   SAVE CONTENTS OF REGISTER 2
         MEXIT
.UNSAVE  AIF   (NOT &RCPSR2).EXIT
         B     *+10                    SKIP NEXT INSTRUCTION
&C       SETC  '&DYNP.MVC'
&C       MVC   S99TUPAR(0),0(R14)      EXECUTED MOVE
         LR    R2,R0                   RESTORE CONTENTS OF REGISTER 2
&RCPSR2  SETB  0
.EXIT    MEND
./ ADD NAME=RCPSSREQ 0100-00038-00038-1647-00010-00010-00000-MACRO
         MACRO
         RCPSSREQ
         SPACE 1
***********************************************************************
**       SUBSYSTEM REQUEST TEXT UNIT                                 **
***********************************************************************
         SPACE 1
         MVI   S99TUKEY+1,DALSSREQ MOVE IN TEXT UNIT KEY
         RCPDINC                   4
         MEND
./ ADD NAME=RCPSUBL  0100-00038-00038-1647-00036-00036-00000-MACRO
         MACRO - BREAK DOWN A SUBLIST
         RCPSUBL &L
         GBLA  &RCPSUB#                NO OF ELEMENTS FOUND
         GBLC  &RCPSUBL(100)           ELEMENTS
         LCLA  &I,&J,&K
&RCPSUB# SETA  0                       INITIALIZE
         AIF   ('&L' EQ '').EXIT       EXIT IF NULL STRING
         AIF   ('&L'(1,1) NE '(').NOSUB
&K       SETA  K'&L-1
&I       SETA  2
&J       SETA  1
.LOOP    ANOP
&J       SETA  &J+1
         AIF   (&J  GT &K).LAST
         AIF   ('&L'(&J,1) NE ',').LOOP
&RCPSUB# SETA &RCPSUB#+1
         AIF   (&J EQ &I).NULL
&RCPSUBL(&RCPSUB#) SETC '&L'(&I,&J-&I)
&I       SETA  &J+1
         AGO   .LOOP
.NULL    ANOP
&RCPSUBL(&RCPSUB#) SETC ''
&I       SETA  &J+1
         AGO   .LOOP
.LAST    AIF   (&J EQ &I).LASTNUL
&RCPSUB# SETA  &RCPSUB#+1
&RCPSUBL(&RCPSUB#) SETC '&L'(&I,&J-&I)
         AGO   .EXIT
.LASTNUL ANOP
&RCPSUB# SETA  &RCPSUB#+1
&RCPSUBL(&RCPSUB#) SETC ''
         AGO   .EXIT
.NOSUB   ANOP
&RCPSUBL(1) SETC '&L'
&RCPSUB# SETA 1
.EXIT    MEND
./ ADD NAME=RCPSYSOU 0100-00038-00038-1647-00072-00072-00000-MACRO
         MACRO
         RCPSYSOU &CLASS,&COPIES=,&FREE=,&DEST=,&FORMS=,&HOLD=
         GBLC  &DYNP
         LCLC  &C
         AIF   ('&CLASS(1)' EQ '').TPGN
&C       SETC  '&CLASS(1)'
         SPACE
***********************************************************************
**       SYSOUT CLASS TEXT UNIT                                      **
***********************************************************************
         AIF   ('&C'(1,1) EQ '''').Q
         AIF   ('&C'(K'&C,1) EQ '/').BS
         AIF   ('&C'(1,1) EQ '(').REG
         L     R14,&C                  LOAD ADDRESS OF SYSOUT CLASS
         MVC   S99TUPAR(1),0(R14)       AND MOVE IT TO TEXT UNIT
         AGO   .SKEY
.REG     MVC   S99TUPAR(1),0&C         MOVE SYSOUT CLASS TO TEXT UNIT
.SKEY    MVI   S99TUKEY+1,DALSYSOU     SET SYSOUT KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,1            SET LENGTH FIELD
         RCPDINC 8
         AGO   .TPGN
.BS      RCPTUBFR DALSYSOU,14,&C
         AGO   .TPGN
.Q       RCPBTU DALSYSOU,1,&C
.TPGN    AIF   ('&CLASS(2)' EQ '').TCOP
         SPACE
***********************************************************************
**   SYSOUT PROGRAM NAME TEXT UNIT                                   **
***********************************************************************
&C       SETC  '&CLASS(2)'
         RCPVCHAR DALSPGNM,14,&C
.TCOP    AIF   ('&COPIES' EQ '').TFREE
         SPACE
***********************************************************************
**    SYSOUT COPIES TEXT UNIT                                        **
***********************************************************************
         RCPNTU DALCOPYS,1,&COPIES
.TFREE   AIF   ('&FREE' EQ '').TDEST
         SPACE
***********************************************************************
**     FREE = CLOSE TEXT UNIT                                        **
***********************************************************************
         AIF   ('&FREE' EQ 'CLOSE').CLOSEOK
         MNOTE 4,' **** FREE=&FREE INVALID, FREE=CLOSE USED'
.CLOSEOK MVI   S99TUKEY+1,DALCLOSE     MOVE IN TEXT UNIT KEY
         RCPDINC 4
.TDEST   AIF   ('&DEST' EQ '').TFORMS
         SPACE
***********************************************************************
**       SYSOUT DESTINATION TEXT UNIT                                **
***********************************************************************
         RCPVCHAR DALSUSER,14,&DEST
.TFORMS  AIF   ('&FORMS' EQ '').THOLD
         SPACE
***********************************************************************
**     SYSOUT FORMS NUMBER TEXT UNIT                                 **
***********************************************************************
         RCPVCHAR DALSFMNO,14,&FORMS
.THOLD   AIF   ('&HOLD' EQ '').EXIT
         SPACE
***********************************************************************
**       HOLD SYSOUT TEXT UNIT                                       **
***********************************************************************
         SPACE 1
         AIF   ('&HOLD' EQ 'YES').HOLD
         AIF   ('&HOLD' EQ 'NO').EXIT
         MNOTE 4,' **** HOLD=&HOLD INVALID, HOLD=YES USED'
.HOLD    ANOP
         MVI   S99TUKEY+1,DALSHOLD MOVE IN TEXT UNIT KEY
         RCPDINC 4
.EXIT    MEND
./ ADD NAME=RCPTERM  0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPTERM
         SPACE
***********************************************************************
**      TERM  DATASET TEXT UNIT                                      **
***********************************************************************
         MVI   S99TUKEY+1,DALTERM      MOVE IN TERM DS TEXT UNIT KEY
         RCPDINC 4
         MEND
./ ADD NAME=RCPTU    0100-00038-00038-1647-00025-00025-00000-MACRO
         MACRO
         RCPTU &TU            TEXT UNIT LIST
         GBLA  &DTUPO         TEXT UNIT POINTER OFFSET
         GBLC  &DYNP          ALLOC SYMBOL PREFIX
         LCLA  &I,&J
         LCLC  &C
         SPACE 1
***********************************************************************
**       ADD SPECIAL TEXT UNITS                                      **
***********************************************************************
&J       SETA  N'&TU
.LOOP    ANOP
&I       SETA  &I+1
         AIF   (&I GT &J).EXIT
         AIF   ('&TU(&I)'(1,1) EQ '(').R
         LA    R14,&TU(&I)             LOAD TEXT UNIT ADDRESS
         ST    R14,&DYNP.TUP+&DTUPO     AND STORE IT IN POINTER LIST
&DTUPO   SETA  &DTUPO+4
         AGO   .LOOP
.R       ANOP
&C       SETC  '&TU(&I)'(2,K'&TU(&I)-2)
         ST    &C,&DYNP.TUP+&DTUPO     STORE TEXT UNIT ADDR IN PTR LIST
&DTUPO   SETA  &DTUPO+4
         AGO   .LOOP
.EXIT    MEND
./ ADD NAME=RCPTUBFR 0100-00038-00038-1647-00060-00060-00000-MACRO
         MACRO  - BUILD TEXT UNIT FROM BUFFER
         RCPTUBFR &KEY,                TEXT UNIT KEY                   X
               &L,                     MAXIMUM LENGTH VALUE            X
               &C,                     TEXT UNIT                       X
               &N=1                    TEXT UNIT NUMBER
         GBLC  &EXECNAM
         LCLC  &C1,&C2
         LCLA  &I,&K
         MVI   S99TUKEY+1,&KEY         SET TEXT UNIT KEY
         AIF   ('&N' EQ '' OR '&N' EQ '1').N1
         LA    R14,&N                  LOAD TEXT UNIT NUMBER
         STH   R14,S99TUNUM             AND STORE INTO TEXT UNIT
         AGO   .ENDN
.N1      MVI   S99TUNUM+1,1            SET TEXT UNIT NUMBER
.ENDN    ANOP
&K       SETA  K'&C
&I       SETA  &K-1
.LOOP1   ANOP
&K       SETA  &K-1
         AIF   (&K LE 0).STD
         AIF   ('&C'(&K,1) NE '/').LOOP1
&C2      SETC  '&C'(&K+1,&I-&K)
&C1      SETC  '&C'(1,&K-1)
         AIF   ('&C1'(1,1) NE '(').TC2
&C1      SETC  '0&C1'
.TC2     AIF   ('&C2' EQ '0000').V2B
         AIF   ('&C2' EQ '00').V1B
         AIF   ('&C2' EQ '0').V0B
         AIF   ('&C2'(1,1) EQ '(').RL
         MVI   S99TULNG+1,&C2          SET LENGTH FIELD
         MVC   S99TUPAR(&C2.),&C1      MOVE IN TEXT UNIT
         RCPDINC &L
         MEXIT
.STD     ANOP
&K       SETA  &L-6
         MVI   S99TULNG+1,&K           SET TEXT UNIT LENGTH
&C1      SETC  '&C'(1,&I)              REMOVE TRAILING SLASH
         MVC   S99TUPAR(&K),&C1        MOVE IN TEXT UNIT
         RCPDINC &L
         MEXIT
.V2B     LH    R14,&C1                 LOAD TEXT UNIT LENGTH
         S     R14,=A(4)               EXCLUDE LENGTH OF HEADER
&C1      SETC  '4+&C1'
         AGO   .MOVE
.V1B     LH    R14,&C1                 LOAD TEXT UNIT LENGTH
&C1      SETC  '2+&C1'
         AGO   .MOVE
.V0B     SLR   R14,R14                 CLEAR FOR IC
         IC    R14,&C1                 INSERT TEXT UNIT LENGTH
&C1      SETC  '1+&C1'
         AGO   .MOVE
.RL      ANOP
&C2      SETC  '&C2'(2,K'&C2-2)
         LR    R14,&C2                 LOAD TEXT UNIT LENGTH
.MOVE    STH   R14,S99TULNG             AND STORE INTO LENGTH FIELD
         BCTR  R14,0                   GET MACHINE LENGTH
         #EXEC ,MVC,S99TUPAR-S99TUNIT(0,R15),&C1
         EX    R14,&EXECNAM            MOVE IN TEXT UNIT
         RCPDINC &L
         MEND
./ ADD NAME=RCPTXTL  0100-00038-00038-1647-00017-00017-00000-MACRO
         MACRO - TO COUNT CHARACTERS IN A STRING
         RCPTXTL &S
         GBLA  &RCPTXTL
         LCLA  &I,&L
         LCLB  &PAIR
&RCPTXTL SETA  K'&S-2
         AIF   (&RCPTXTL LT 2).MEND
&L       SETA  &RCPTXTL
&I       SETA  1
&PAIR    SETB  0
.LOOP    ANOP  ,
&I       SETA  &I+1+&PAIR
         AIF   (&I GT &L).MEND
&PAIR    SETB  ('&S'(&I,2) EQ '''''' OR '&S'(&I,2) EQ '&&')
&RCPTXTL SETA  &RCPTXTL-&PAIR
         AGO   .LOOP
.MEND    MEND  ,
./ ADD NAME=RCPTYPE  0100-00038-00038-1647-00014-00014-00000-MACRO
         MACRO
         RCPTYPE &T
         GBLC  &RCPTYPE
         LCLA  &I,&K
&K       SETA  K'&T
&RCPTYPE SETC  ''
         AIF   (&K EQ 0).EXIT
&RCPTYPE SETC  'C'
.LOOP    ANOP
&I       SETA  &I+1
         AIF   ('&T'(&I,1) LT '0' OR '&T'(&I,1) GT '9').EXIT
         AIF   (&I LT &K).LOOP
&RCPTYPE SETC  'N'
.EXIT    MEND
./ ADD NAME=RCPUNALC 0100-00038-00038-1647-00009-00009-00000-MACRO
         MACRO
         RCPUNALC
         SPACE 1
***********************************************************************
**     FREE EVEN IF PERMANENTLY ALLOCATED                            **
***********************************************************************
         MVI   S99TUKEY+1,DUNUNALC     SET TEXT UNIT KEY
         RCPDINC  4
         MEND
./ ADD NAME=RCPUNIT  0100-00038-00038-1647-00032-00032-00000-MACRO
         MACRO
         RCPUNIT &U,&V
         GBLC  &DYNP
         LCLC  &X
&X       SETC  '&SYSNDX'
.TPARM1  ANOP
         AIF   ('&U' EQ '').TPARM2
         SPACE ,
***********************************************************************
**       UNIT NAME TEXT UNIT                                         **
***********************************************************************
         AIF   ('&U'(1,1) EQ '''').TUNIT
         L     R2,&U                   >>---> UNIT NAME
         CLI   0(R2),C' '              CHECK IF UNIT NAME IS BLANK
         BE    ALUN&X                  YES. SKIP TEXT UNIT CONSTRUCTION
.TUNIT   ANOP
         RCPVCHAR DALUNIT,14,&U
ALUN&X   DS    0H
.TPARM2  ANOP
         AIF   ('&V' EQ '').EXIT
         SPACE ,
***********************************************************************
**       VOLUME SERIAL TEXT UNIT                                     **
***********************************************************************
         AIF   ('&V'(1,1) EQ '''').TVOL
         L     R2,&V                   >>---> VOLUME SERIAL NUMBER
         CLI   0(R2),C' '              CHECK IF VOLUME SERIAL IS BLANK
         BE    ALVO&X                  YES. SKIP TEXT UNIT CONSTRUCTION
.TVOL    ANOP
         RCPVCHAR DALVLSER,14,&V
ALVO&X   DS    0H
.EXIT    MEND
./ ADD NAME=RCPUNITC 0100-00038-00038-1647-00008-00008-00000-MACRO
         MACRO
         RCPUNITC &CNT
         SPACE
***********************************************************************
**     UNIT ALLOCATION COUNT TEXT UNIT                               **
***********************************************************************
         RCPNTU DALUNCNT,1,&CNT
         MEND
./ ADD NAME=RCPVCHAR 0100-00038-00038-1647-00038-00038-00000-MACRO
         MACRO
         RCPVCHAR &KEY,&LEN,&C,&N=1
         GBLC  &DYNP
         AIF   ('&C'(K'&C,1) EQ '/').BM
         AIF   ('&C'(1,1) EQ '''').QM
         RCPSR2
         AIF   ('&C'(1,1) EQ '(').RM
         AIF   ('&C'(2,1) EQ '(').SM
         AIF   ('&C'(3,1) EQ '(').SM
         LH    R2,&C+4                 LOAD LENGTH OF TEXT UNIT
         LTR   R2,R2                   TEST FOR ZERO
         BZ    *+30                    IF NO TEXT UNIT, SKIP
         L     R14,&C                  LOAD ADDRESS OF TEXT UNIT
         AGO   .STHM
.RM      LH    R2,4&C                  LOAD LENGTH OF TEXT UNIT
         LTR   R2,R2                   AND TEST FOR ZERO
         BZ    *+30                    IF NO TEXT UNIT, SKIP
         L     R14,0&C                 LOAD ADDRESS OF TEXT UNIT
         AGO   .STHM
.SM      LH    R2,4+&C                 LOAD LENGTH OF TEXT UNIT
         LTR   R2,R2                   TEST FOR ZERO
         BZ    *+30                    IF NO TEXT UNIT, SKIP
         L     R14,&C                  LOAD ADDRESS OF TEXT UNIT
.STHM    STH   R2,S99TULNG             STORE LENGTH OF TEXT UNIT
         BCTR  R2,0                    DECREMENT FOR EXECUTE
         EX    R2,&DYNP.MVC            MOVE IN TEXT UNIT
         MVI   S99TUKEY+1,&KEY         MOVE IN TEXT UNIT KEY
         AIF   ('&N' EQ '1' OR '&N' EQ '').N1
         LA    R14,&N                  LOAD TEXT UNIT NUMBER
         STH   R14,S99TUNUM             AND STORE IT IN TEXT UNIT
         AGO   .ENDN
.N1      MVI   S99TUNUM+1,1            SET NUMBER FIELD
.ENDN    RCPDINC &LEN
         MEXIT
.BM      RCPTUBFR &KEY,&LEN,&C
         MEXIT
.QM      RCPBTU &KEY,&N,&C
         MEND
./ ADD NAME=RCPVOLRT 0100-00038-00038-1647-00012-00012-00000-MACRO
         MACRO
         RCPVOLRT
         SPACE 1
***********************************************************************
**    VOLUME SERIAL RETURN TEXT UNIT                                 **
***********************************************************************
         MVI   S99TUKEY+1,DALRTVOL     SET RETURN VOLUME SERIAL KEY
         MVI   S99TUNUM+1,1            SET NUMBER FIELD
         MVI   S99TULNG+1,6            SET LENGTH FIELD
         MVC   S99TUPAR(6),=CL6' '     INITIALIZE FIELD TO BLANKS
         RCPDINC 12
         MEND
./ ADD NAME=S99FAIL  0100-00038-00038-1647-00066-00066-00000-MACRO
         MACRO
&NAME    S99FAIL &RB=(R14),&RC=(R15),&CPPL=,&MF=G,&CP=
         GBLB  &RCPCPPL(2)             CP INDICATOR
         GBLC  &RCPPRE
         LCLB  &GEN
         LCLC  &C
&NAME    DS    0H
         AIF   ('&MF(1)' EQ 'G').GEN
         AIF   ('&MF(1)' EQ 'E').EXEC
         MNOTE 4,'&MF(1) IS AN INVALID MF, MF=G USED'
.GEN     LA    R1,FAIL&SYSNDX     LOAD PLIST ADDRESS
&GEN     SETB  1
         AGO   .L
.EXEC    AIF   ('&MF(2)' NE '').LISTOK
         MNOTE 8,'LIST ADDRESS NOT SPECIFIED'
         MEXIT
.LISTOK  AIF   ('&MF(3)' EQ '').TMF2
&MF(3)   EQU   24                      LENGTH OF PARAMETER LIST
.TMF2    AIF   ('&MF(2)' EQ '(R1)' OR '&MF(2)' EQ '(1)').L
         AIF   ('&MF(2)'(1,1) EQ '(').REG
         LA    R1,&MF(2)          LOAD DAIRFAIL PARAM LIST ADDRESS
         AGO   .L
.REG     ANOP
&C       SETC  '&MF(2)'(2,K'&MF(2)-2)
         LR    R1,&C              LOAD DAIRFAIL PARAM LIST ADDR
.L       AIF   ('&RB'(1,1) EQ '(').RBR
         AIF   ('&RB' NE '').RBA
         MNOTE 8,'REQ BLOCK ADDRESS NOT SPECIFIED'
         MEXIT
.RBR     ST    &RB(1),0(0,R1)     STORE S99 RB ADDRESS
         AGO   .RC
.RBA     LA    R14,&RB            LOAD ADDRESS OF REQ BLOCK
         ST    R14,0(0,R1)        AND STORE IN PLIST
.RC      AIF   ('&RC'(1,1) EQ '(').RCR
         LA    R14,&RC            LOAD ADDRESS OF RET CODE
         ST    R14,4(0,R1)        AND STORE IN PLIST
         AGO   .EFF02
.RCR     ANOP
.GRC     LA    R14,20(0,R1)       LOAD ADDR RET CODE FLD
         ST    &RC(1),0(0,R14)    STORE RET CODE
         ST    R14,4(0,R1)        AND STORE ITS ADDRESS
.EFF02   LA    R14,=A(0)          LOAD ADDR OF FULLWORD OF 0
         ST    R14,8(0,R1)        STORE IT.
         AIF   ('&CP' EQ 'YES' OR &RCPCPPL(1)).CPID
         LA    R14,=X'8032'       LOAD ADDRESS OF CALLERID
         ST    R14,12(0,R1)        AND STORE IT
         XC    16(4,R1),16(R1)    CLEAR CPPL POINTER
         AGO   .GO
.CPID    LA    R14,=Y(50)         LOAD ADDRESS OF CALLERID
         ST    R14,12(0,R1)        AND STORE IT
         AIF   ('&CPPL' EQ '').DCPPL
         AIF   ('&CPPL'(1,1) EQ '(').RCPPL
         LA    R14,&CPPL          LOAD CPPL ADDRESS
         ST    R14,16(0,R1)        AND STORE IT
         AGO   .GO
.DCPPL   MVC   16(4,R1),&RCPPRE.CPPL MOVE IN CPPL ADDRESS
         AGO   .GO
.RCPPL   ST    &CPPL(1),16(0,R1)  STORE ADDRESS OF CPPL
.GO      LINK  EP=IKJEFF18
         AIF   (NOT &GEN).EXIT
         SPACE 1
         RCPDS
&C       SETC  'FAIL&SYSNDX'
&C       DS    6F             RESERVE SPACE FOR PARAM LIST
         RCPDS
.EXIT    MEND
./ ADD NAME=TERMIO   0100-00038-00038-1647-00151-00151-00000-MACRO
         MACRO ,
&NAME    TERMIO &X,&Y,&Z,&OUTPUT=,&INPUT=,&ENTRY=,&ERROR=,             X
               &TERMPUT=,&TERMGET=,&DELETE=,&DATASET=,&STORAGE=
         GBLB &RCPPTPB(2),&RCPGTPB(2),&RCPPGPB(2),&RCPSTPB(2)
         GBLC &RCPPRE,&RCPPTEP,&RCPGTEP,&RCPPGEP,&RCPSTEP
         GBLC &RCPSTER,&RCPPTER,&RCPGTER,&RCPPGER
         LCLA  &L,&I,&J
         LCLB  &FLUSH
         LCLC  &C,&R
         AIF   ('&NAME' EQ '').TX
&NAME    DS    0H
.TX      AIF   ('&X' EQ '').E1
&L       SETA  K'&X
         AIF   (&L GT 7).E2
         AIF   ('&X' EQ 'FREEBUF'(1,&L)).FREEBUF
         AIF   ('&X' EQ 'PUTLINE'(1,&L)).PUTLINE
         AIF   ('&X' EQ 'GETLINE'(1,&L)).GETLINE
         AIF   ('&X' EQ 'PUTGET '(1,&L)).PUTGET
         AIF   ('&X' EQ 'STACK  '(1,&L)).STACK
&FLUSH   SETB  1
         AIF   ('&X' EQ 'FLUSH  '(1,&L)).STACK
.E2      MNOTE 8,'&X IS AN INVALID FUNCTION'
         MEXIT ,
.E1      MNOTE 8,'NO OPERATION SPECIFIED'
         MEXIT ,
.FREEBUF ANOP  ,
&R       SETC  'R1'
         AIF   ('&Y' EQ '' OR '&Y' EQ '(1)' OR '&Y' EQ '(R1)').FLR0
         AIF   ('&Y' EQ 'PUTGET').FPG
         AIF   ('&Y' EQ 'GETLINE').FGT
         AIF   ('&Y'(1,1) NE '(').FLR1
&R       SETC  '&Y(1)'
         AGO   .FLR0
.FPG     AIF   (&RCPPGPB(1)).FPG1
      MNOTE 4,'PUTGET NOT SPECIFIED ON BEGIN MACRO, ERRORS MAY OCCUR'
.FPG1    L     R1,&RCPPRE.PGPB+PGPBIBUF-PGPB  LOAD INPUT LINE ADDRESS
         AGO   .FLR0
.FGT     AIF   (&RCPGTPB(1)).FGT1
         MNOTE 4,'GETL NOT SPECIFIED ON BEGIN MACRO, ERRORS MAY OCCUR'
.FGT1    L     R1,&RCPPRE.GTPB+GTPBIBUF-GTPB  LOAD INPUT LINE ADDRESS
         AGO   .FLR0
.FLR1    L     R1,&Y                   LOAD INPUT LINE ADDRESS
.FLR0    LH    R0,0(0,&R)              LOAD LINE LENGTH
         FREEMAIN RU,LV=(0),A=(&R),SP=1
         MEXIT ,
.PUTLINE AIF   (&RCPPTPB(1)).PUTL1
         MNOTE 4,'PUTL NOT SPECIFIED ON BEGIN MACRO, ERROR MAY OCCUR'
.PUTL1   AIF   ('&ENTRY' EQ '').TPTEP
         AIF   ('&ENTRY' EQ 'NO').PUTL2
&R       SETC  '(15)'
         AIF   ('&ENTRY' EQ '(15)').PUTL2
&RCPPTEP SETC  '&ENTRY'
         L     R15,&ENTRY              LOAD PUTLINE ENTRY POINT
         AGO   .PUTL2
.TPTEP   AIF   ('&RCPPTEP' EQ '').PUTL2
&R       SETC  '(15)'
         L     R15,&RCPPTEP            LOAD PUTLINE EP ADDRESS
.PUTL2   PUTLINE PARM=&RCPPRE.PTPB,MF=(E,&RCPPRE.IOPL),ENTRY=&R,       X
               OUTPUT=&OUTPUT,TERMPUT=&TERMPUT
         AIF   ('&ERROR' EQ '').TPTER
         AIF   ('&ERROR' EQ 'NO').EXIT
&RCPPTER SETC  '&ERROR'
.PTER    LTR   R15,R15                 TEST RETURN CODE
         BNZ   &RCPPTER                 AND BRANCH IF NON ZERO
         MEXIT ,
.TPTER   AIF   ('&RCPPTER' NE '').PTER
.EXIT    MEXIT ,
.STACK   AIF   (&RCPSTPB(1)).STACK1
         MNOTE 4,'FLUSH OR STACK NOT SPECIFIED ON BEGIN MACRO, ERRORS MX
               AY OCCUR'
.STACK1  AIF   ('&ENTRY' EQ '').TSTEP
         AIF   ('&ENTRY' EQ '').STACK2
&R       SETC  '(15)'
         AIF   ('&ENTRY' EQ '(15)' OR '&ENTRY' EQ '(R15)').STACK2
&RCPSTEP SETC  '&ENTRY'
         L     R15,&RCPSTEP            LOAD STACK ENTRY POINT ADDRESS
&R       SETC  '(15)'
         AGO   .STACK2
.TSTEP   AIF   ('&RCPSTEP' EQ '').STACK2
&R       SETC  '(15)'
         L     R15,&RCPSTEP            LOAD STACK ENTRY POINT ADDRESS
.STACK2  AIF   (&FLUSH).FLUSH
         STACK DELETE=&DELETE,STORAGE=&STORAGE,DATASET=&DATASET,       X
               MF=(E,&RCPPRE.IOPL),PARM=&RCPPRE.STPB,ENTRY=&R
         AGO   .STER
.FLUSH   STACK DELETE=ALL,                                             X
               MF=(E,&RCPPRE.IOPL),PARM=&RCPPRE.STPB,ENTRY=&R
.STER    AIF   ('&ERROR' EQ '').TSTER
         AIF   ('&ERROR' EQ 'NO').EXIT
&RCPSTER SETC  '&ERROR'
.STLTR   LTR   R15,R15                 TEST RETURN CODE
         BNZ   &RCPSTER                 AND BRANCH IF NON ZERO
         MEXIT ,
.TSTER   AIF   ('&RCPSTER' NE '').STLTR
         MEXIT ,
.GETLINE AIF   (&RCPGTPB(1)).GETL1
         MNOTE 4,'GETL NOT SPECIFIED ON BEGIN MACRO, ERROR MAY OCCUR'
.GETL1   AIF   ('&ENTRY' EQ '').TGTEP
         AIF   ('&ENTRY' EQ 'NO').GETL2
&R       SETC  '(15)'
         AIF   ('&ENTRY' EQ '(15)').GETL2
&RCPGTEP SETC  '&ENTRY'
         L     R15,&ENTRY              LOAD GETLINE ENTRY POINT
         AGO   .GETL2
.TGTEP   AIF   ('&RCPGTEP' EQ '').GETL2
&R       SETC  '(15)'
         L     R15,&RCPGTEP            LOAD GETLINE EP ADDRESS
.GETL2   MVI   &RCPPRE.GTPB+2,128     SET TGET FLAG
         GETLINE PARM=&RCPPRE.GTPB,MF=(E,&RCPPRE.IOPL),ENTRY=&R,       X
               INPUT=&INPUT,TERMGET=&TERMGET
         AIF   ('&ERROR' EQ '').TGTER
         AIF   ('&ERROR' EQ 'NO').GTLR
&RCPGTER SETC  '&ERROR'
.GTER    CL    R15,=F'4'               TEST RETURN CODE
         BH    &RCPGTER                 AND BRANCH IF ERROR
         AGO   .GTLR
.TGTER   AIF   ('&RCPGTER' NE '').GTER
.GTLR    ANOP  ,
&R       SETC  'R1'
         AIF   ('&Y' EQ '').GTLR2
&R       SETC  '&Y'
.GTLR2   L     &R,&RCPPRE.GTPB+GTPBIBUF-GTPB  LOAD INPUT LINE ADDRESS
         MEXIT ,
.PUTGET  AIF   (&RCPPGPB(1)).PGTL1
         MNOTE 4,'PUTGET NOT SPECIFIED ON BEGIN MACRO, ERROR MAY OCCUR'
.PGTL1   AIF   ('&ENTRY' EQ '').TPGEP
         AIF   ('&ENTRY' EQ 'NO').PGTL2
&R       SETC  '(15)'
         AIF   ('&ENTRY' EQ '(15)').PGTL2
         L     R15,&ENTRY              LOAD GETLINE ENTRY POINT
&RCPPGEP SETC '&ENTRY'
         AGO   .PGTL2
.TPGEP   AIF   ('&RCPPGEP' EQ '').PGTL2
&R       SETC  '(15)'
         L     R15,&RCPPGEP            LOAD PUTGET EP ADDRESS
.PGTL2   MVI   &RCPPRE.PGPB+10,128     SET TGET FLAG
         PUTGET PARM=&RCPPRE.PGPB,MF=(E,&RCPPRE.IOPL),ENTRY=&R,        X
               OUTPUT=&OUTPUT,TERMGET=&TERMGET,TERMPUT=&TERMPUT
         AIF   ('&ERROR' EQ '').TPGER
         AIF   ('&ERROR' EQ 'NO').PGLR
&RCPPGER SETC  '&ERROR'
.PGER    CL    R15,=F'4'               TEST RETURN CODE
         BH    &RCPPGER                 AND BRANCH IF ERROR
         AGO   .PGLR
.TPGER   AIF   ('&RCPPGER' NE '').PGER
.PGLR    ANOP  ,
&R       SETC  'R1'
         AIF   ('&Y' EQ '').PGLR2
&R       SETC  '&Y'
.PGLR2   L     &R,&RCPPRE.PGPB+PGPBIBUF-PGPB  LOAD INPUT LINE ADDRES
         MEND  ,
./ ADD NAME=TIOTSCAN 0100-00038-00038-1647-00107-00107-00000-MACRO
         MACRO ,
&NAME    TIOTSCAN &REG,&WKREG=R0,&NEXT=,&LAST=,&DDN=,&OK=,&NOK=
         LCLC  &R1,&R2
         LCLC  &LBL1,&LBL2,&LBL3,&LBL4
&LBL1    SETC  'TIO&SYSNDX.A'
&LBL2    SETC  'TIO&SYSNDX.B'
&LBL3    SETC  'TIO&SYSNDX.C'
&LBL4    SETC  'TIO&SYSNDX.D'
&R1      SETC  'R1'                     DEFAULT TO REGISTER 1
         AIF   ('&REG' EQ '').START     CHECK IF REG= SPECIFIED
&R1      SETC  '&REG'                   SET TO SPECIFIED REGISTER
.START   ANOP  ,
.*--------------------------------------------------------------------*
.*       LOCATE FIRST TIOT ENTRY                                      *
.*--------------------------------------------------------------------*
&NAME    L     &R1,16                   POINT TO CVT
         L     &R1,0(0,&R1)             POINT TO TCB WORDS
         L     &R1,4(0,&R1)             POINT TO OLD TCB
         L     &R1,12(0,&R1)            POINT TO TIOT
         LA    &R1,24(0,&R1)            PT TO FIRST TIOT ENTRY
         AIF   ('&DDN' NE '').DDN
.*--------------------------------------------------------------------*
.*       SCAN THROUGH THE TIOT SERIALLY                               *
.*--------------------------------------------------------------------*
         AIF   ('&NEXT' EQ '').E1       MUST SPECIFY NEXT=
         AIF   ('LAST' EQ '').E2        MUST SPECIFY LAST=
         B     &LBL1                    PROCESS THE FIRST ENTRY
&NEXT    SR    &WKREG,&WKREG
         IC    &WKREG,0(0,&R1)          LOAD TIOT ENTRY LENGTH
         AR    &R1,&WKREG               PT TO NEXT TIOT ENTRY
&LBL1    CLI   0(&R1),0                 CHECK FOR END OF TIOT
         AIF   ('&LAST'(1,1) EQ '(').LASTR
         BE    &LAST                    YES, TIOT SCAN EXHAUSTED
         AGO   .MEXIT
.LASTR   ANOP  ,
&R2      SETC  '&LAST'(2,K'&LAST-2)
         BER   &R2                      YES, TIOT SCAN EXHAUSTED
         AGO   .MEXIT
.*--------------------------------------------------------------------*
.*       SCAN THROUGH THE TIOT SEARCHING FOR A SPECIFIC DDNAME        *
.*--------------------------------------------------------------------*
.DDN     ANOP  ,
         AIF   ('&OK&NOK' EQ '').E3     CHECK IF OK=/NOK= SPECIFIED
         AIF   ('&OK' NE '').OK
.*--------------------------------------------------------------------*
.*       SPECIFIC SEARCH AND NOK= WAS SPECIFIED AND OK= NOT SPECIFIED *
.*--------------------------------------------------------------------*
.NOK     ANOP  ,
         AIF   ('&DDN'(1,1) EQ '(').NOK1
&LBL2    CLC   =CL8'&DDN',4(&R1)        CHECK FOR MATCHING DDNAME
         AGO   .NOK2
.NOK1    ANOP  ,
&R2      SETC  '&DDN'(2,K'&DDN-2)
&LBL2    CLC   0(8,&R2),4(&R1)          CHECK FOR MATCHING DDNAME
.NOK2    ANOP  ,
         BE    &LBL3
         SR    &WKREG,&WKREG
         IC    &WKREG,0(0,&R1)          GET CURRENT ENTRY LENGTH
         AR    &R1,&WKREG               PT TO NEXT TIOT ENTRY
         CLI   0(&R1),0                 CHECK FOR END OF TIOT
         BNE   &LBL2                    IF NOT - KEEP SEARCHING
         AIF   ('&NOK'(1,1) EQ '(').NOK3
         B     &NOK                     OTHERWISE - ENTRY NOT FOUND
         AGO   .NOK4
.NOK3    ANOP  ,
&R2      SETC  '&NOK'(2,K'&NOK-2)
         BR    &R2                      OTHERWISE - ENTRY NOT FOUND
.NOK4    ANOP  ,
&LBL3    DS    0H
         AGO   .MEXIT
.*--------------------------------------------------------------------*
.*       SPECIFIC SEARCH AND OK= WAS SPECIFIED                        *
.*--------------------------------------------------------------------*
.OK      ANOP  ,
         AIF   ('&DDN'(1,1) EQ '(').OK1
&LBL4    CLC   =CL8'&DDN',4(&R1)        CHECK FOR MATCHING DDNAME
         AGO   .OK2
.OK1     ANOP  ,
&R2      SETC  '&DDN'(2,K'&DDN-2)
&LBL4    CLC   0(8,&R2),4(&R1)          CHECK FOR MATCHING DDNAME
.OK2     ANOP  ,
         AIF   ('&OK'(1,1) EQ '(').OK3
         BE    &OK                      IF SO  - SCAN IS COMPLETE
         AGO   .OK4
.OK3     ANOP  ,
&R2      SETC  '&OK'(2,K'&OK-2)
         BER   &R2                      IF SO - SCAN IS COMPLETE
.OK4     ANOP  ,
         SR    &WKREG,&WKREG
         IC    &WKREG,0(0,&R1)          GET CURRENT ENTRY LENGTH
         AR    &R1,&WKREG               PT TO NEXT TIOT ENTRY
         CLI   0(&R1),0                 CHECK FOR END OF TIOT
         BNE   &LBL4                    IF NOT - KEEP SEARCHING
         AIF   ('&NOK' EQ '').MEXIT
         AIF   ('&NOK'(1,1) EQ '(').OK5
         B     &NOK                     OTHERWISE - ENTRY NOT FOUND
         AGO   .MEXIT
.OK5     ANOP  ,
&R2      SETC  '&NOK'(2,K'&NOK-2)
         BR    &R2                      OTHERWISE - ENTRY NOT FOUND
         AGO   .MEXIT
.E1      MNOTE 8,'NEXT= OPTION NOT SPECIFIED'
         AGO   .MEXIT
.E2      MNOTE 8,'LAST= OPTION NOT SPECIFIED'
         AGO   .MEXIT
.E3      MNOTE 8,'OK= OR NOK= KEYWORDS NOT SPECIFIED'
.MEXIT   MEND  ,

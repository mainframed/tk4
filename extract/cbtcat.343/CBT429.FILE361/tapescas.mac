//CAJ7083D JOB (UMVESWSP,CAJ7083),'JOHNSTON',
//         CLASS=A,MSGCLASS=X,NOTIFY=CAJ7083
//SEL     EXEC PGM=AFOLIBR,REGION=256K,PARM='NJTA,NRJS'
//OSJOB    DD  UNIT=VIO,DISP=(,PASS),SPACE=(CYL,(2,1)),
//             DCB=BLKSIZE=800,DSN=&&TEMP
//MASTER   DD  DISP=SHR,DSN=UMV42.LIB.SOURCE
//LIST     DD  SYSOUT=*
//INDEX    DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*,DCB=(RECFM=FBA,BLKSIZE=133)
//SYSIN    DD  *
-SEL TAPESC50,HHJC,EXEC,TEMP
-REP 4610,4620
*        TM    JFCLTSV,X'31'      NO-OP INST. FOR NOVOLSER BUG
*        BNZ   SRCHPARM           NO-OP INST. FOR NOVOLSER BUG
-REP 6320
*        MVI   SVOUTFLG,C'N'      NO-OP INST. FOR NOVOLSER BUG
-INS 9270
         MVI   HDREOFSW,C'N'      HDR2/EOF2 SW OFF
-INS 9950
LRECLHLD DC    F'0'               LRECL IN BINARY FOR SL F OR FB FILES
-INS 10420
HDREOFSW DC    C'N'
RECFMSW  DC    C'N'
-INS 11400
         MVI   HDREOFSW,C'N'      HDR2/EOF2 SW OFF
-INS 14500
         MVI   HDREOFSW,C'Y'      HDR2/EOF2 SW ON
-INS 14520
         CLI   RECBUF+4,C'F'      IS RECFM F OR FB
         BE    *+12               YES
         MVI   RECFMSW,C'N'       NO - TURN OFF SWITCH
         B     *+22
         PACK  BADLNGTH,RECBUF+10(5)   CONVERT LOGICAL
         CVB   R1,BADLNGTH               RECORD LENGTH TO
         ST    R1,LRECLHLD                 BINARY AND SAVE TO
         MVI   RECFMSW,C'Y'                  DETERMINE # OF RECS
-INS 15870
         L     R5,FILEBYTS        PICK UP NO. OF BYTES IN FILE
-INS 16000
         CVD   R5,BADLNGTH        PUT NO. OF BYTES
         OI    BADLNGTH+7,X'0F'     IN FILE OUT TO THE
         UNPK  BYTESMSG,BADLNGTH      TAPEMARK MSG. LINE
         CLI   RECFMSW,C'Y'       IS THIS SL F OR FB FILE
         BNE   NORECCNT           NO
         SR    R0,R0              DIVIDE NUMBER
         LR    R1,R5                OF BYTES IN THE
         D     R0,LRECLHLD            FILE BY LRECL.
         LTR   R0,R0             ANY REMAINDER
         BNZ   NORECCNT          YES - ERROR
         CVD   R1,BADLNGTH        PUT NO. OF RECORDS
         OI    BADLNGTH+7,X'0F'     IN FILE OUT TO THE
         UNPK  RECSMSG,BADLNGTH       TAPEMARK MSG. LINE
         B     *+10
NORECCNT EQU  *
         MVC   RECSMSG,=C'**N/A*'     SHOW FOR NOT F/FB OR ERROR
-INS 16080
         MVC   VTOCBYTE,BYTESMSG
         MVC   VTOCRECS,RECSMSG
-INS 16100
         CLI   HDREOFSW,C'Y'      IS IT HDR2 OR EOF2
         BE    *+12               YES
-INS 16110
         BE    *+8                YES
         MVI   EOVM+1,CNTSENDS-TPMKMSG-1 SET LENGTH FOR SHORT MVC.
-INS 16150
         CLI   HDREOFSW,C'Y'      IS IT HDR2 OR EOF2
         BE    *+14               YES
-INS 16160
         BE    *+10               YES
         MVC   MSGBUF+18(CNTSENDS-EOVNUM-3),EOVNUM+3  SHORT TM MSG
-REP 18060
         MVC   MSGBUF+6(17),VTOCDSN    DATA SET NAME.
-REP 18080,18110
         MVC   MSGBUF+31(5),VTOCLREC   LRECL.
         MVC   MSGBUF+37(5),VTOCBLKS   BLKSIZE.
         MVC   MSGBUF+43(4),VTOCDEN    DENSITY.
         MVC   MSGBUF+48(2),VTOCTRTC   TRTCH.
-REP 18140,18220
         MVC   MSGBUF+48(3),=C'STD'    INDICATE STD TRTCH
         MVC   MSGBUF+52(5),VTOCMINB   MINIMUM BLOCK SIZE.
         MVC   MSGBUF+58(5),VTOCMAXB   MAXIMUM BLOCK SIZE.
         MVC   MSGBUF+64(5),VTOCAVGB   AVERAGE BLOCK SIZE.
         MVC   MSGBUF+70(6),VTOCOUNT   NUMBER OF BLOCKS.
         MVC   MSGBUF+77(11),VTOCBYTE  BYTES IN FILE.
         MVC   MSGBUF+89(6),VTOCRECS   LOGICAL RECS IN FILE.
         MVC   MSGBUF+96(8),VTOCCREA   CREATION DATE.
         MVC   MSGBUF+105(8),VTOCJOBN  JOB NAME.
         MVC   MSGBUF+114(8),VTOCSTEP  STEP NAME.
         MVC   MSGBUF+123(8),VTOCEXPR  EXPIRATION DATE.
-REP 18650,18720
         DC    C'  BLK LENS-TM  MIN='
MINMSG   DC    C'00000'
         DC    C' MAX='
MAXMSG   DC    C'00000'
         DC    C' AVG='
AVGMSG   DC    C'00000'
         DC    C'  BLKS-TM='
COUNTMSG DC    C'000000'
         DC    C'  BYTES-TM='
BYTESMSG DC    C'00000000000'
CNTSENDS EQU   *
         DC    C'  LOGICAL RECORDS-TM(F/FB)='
RECSMSG  DC    C'000000'
-REP 19150,19170
VTOCHED2 DC    C'-SEQ. DATA SET NAME      RECFM LRECL BLKSZ  DEN TRT MI*
               NBK MAXBK AVGBK BLKCNT  BYTES/FILE RECRDS  CREATED JOB N*
               AME STEPNAME  EXPIRES'
-INS 20310
VTOCBYTE DS    CL11               BYTES IN FILE.
VTOCRECS DS    CL6                LOGICAL RECORDS IN FILE.
-END
/*
//ASM      EXEC PGM=ASMA90,PARM='OBJECT,NODECK',REGION=1000K
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS2.MC99.OS390.V120.AMODGEN
//SYSLIN   DD  DSN=&&OBJ,SPACE=(3040,(40,40),,,ROUND),UNIT=VIO,
//             DISP=(MOD,PASS),
//             DCB=(BLKSIZE=3040,LRECL=80,RECFM=FBS,BUFNO=1)
//SYSUT1   DD  DSN=&&SYSUT1,SPACE=(4096,(120,120),,,ROUND),UNIT=VIO,
//             DCB=BUFNO=1
//SYSPUNCH DD  DUMMY
//SYSIN    DD  DSN=&&TEMP,DISP=(OLD,DELETE)
//LKED     EXEC PGM=IEWL,
//          PARM=(XREF,LET,LIST,MAP,'AC=1')
//SYSPRINT DD  SYSOUT=*
//SYSLIN   DD  DSN=&&OBJ,DISP=(OLD,DELETE)
//SYSUT1   DD  UNIT=(SYSDA,SEP=(SYSLIN,SYSLMOD)),SPACE=(1024,(200,20))
//*YSLMOD  DD  DSN=&&LOADSET(TAPESCAN),DISP=(,PASS),
//*            DCB=(RECFM=U,BLKSIZE=23200),
//*            SPACE=(CYL,(1,,1)),UNIT=SYSDA
//SYSLMOD  DD  DISP=SHR,DSN=UMV42.CAJ7083.LOAD(TAPESCAN)

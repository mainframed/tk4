//E0115DMS JOB EDPCSBS1,'SASD',MSGCLASS=X,CLASS=1,NOTIFY=ED115DM
//*
//SAS     EXEC SAS,OPTIONS=NODATE
//SMFTAPE DD DSN=SYS1.MAN1,DISP=SHR
//SYSIN   DD *
TITLE ----- SELECTING MULTIPLE RECORDS --------;
  DATA STEPS (
  KEEP= TIMEOUT TIMEIN CCODE PROGNAME CPUTIME ELAPSED
        JOBNAME JOBSTART)
  DATA JOBS  (
  KEEP=TERMTIME JOBNAME JOBSTART NSTEPS STTIME JOBCC JOBPRTY JOBCLASS
       RDETIME JOBTERM JOBCPUS PGMRNAME JOBCPUT READTIME WAITTIME
       RUNTIME);
  INFILE SMFTAPE;
  INPUT @1 SMFXXLEN PIB2. SMFXXSEG PIB2.
           SMFXXFLG PIB1. TYPE PIB1.
                         @;

*-----TYPE 4 RECORDS ------;
  IF TYPE = 4 THEN DO;
  INPUT TIMEOUT SMFSTAMP8.
        SMFXXSID $CHAR4.
        JOBNAME  $CHAR8.     JOBSTART  SMFSTAMP8.   SMF04UIF $CHAR8.
        SMF04STN PIB1.
        TIMEIN   SMFSTAMP8.  SMF04NCI  PIB4.        CCODE    PIB2.
        SMF4PRTY PIB1.       PROGNAME  $CHAR8.      SMF4STMN $CHAR8.
        SMF4RSH0 PIB2.       SMF4SYST  PIB2.        SMF4HOST PIB2.
        SMF4RV1  PIB6.       SMF4SPK   PIB1.        SMF4STI  PIB1.
        SMF4RV2  PIB2.       SMF4AST   PIB4.        SMF4PPST PIB4.
        SMF4RV3  PIB1.       SMF4SRBT  PIB3.        SMF4RIN  PIB2.
        COLREL   PIB2.       DEVLEN    PIB2. @;
        INPUT  @107+DEVLEN SMF4LNTH PIB1.  @;
   IF SMF4LNTH > 0 THEN DO;
        INPUT      CPUTIME  PIB3.2 SMF4NAF PIB1.  @;
   END;
        OFF = COLREL   +5 ;
INPUT @OFF PAGEIN   PIB4.    PAGEOUT  PIB4. @ ;
ELAPSED = TIMEOUT - TIMEIN;
FORMAT JOBSTART TIMEOUT TIMEIN DATETIME. ELAPSED TIME. ;
FORMAT CCODE HEX4. ;
 OUTPUT STEPS;
END;

*-----TYPE 5 RECORDS ------;
  IF TYPE = 5 THEN DO;
  INPUT TERMTIME SMFSTAMP8.
        SMFXXSID $CHAR4.
        JOBNAME  $CHAR8.     JOBSTART  SMFSTAMP8.   SMF05UIF $CHAR8.
        NSTEPS   PIB1.       STTIME    SMFSTAMP8.   SMF05NCI PIB4.
        JOBCC    PIB2.       JOBPRTY   PIB1.        RDETIME  SMFSTAMP8.
        JOBTERM  PIB1.       SMF5SMCI  PIB1.        SMF5TRAN PIB4.
        SMF5CKRE PIB1.       SMF5RDCL  PIB1.        SMF5RUTY PIB1.
        JOBCLASS $CHAR1.     SMF5SPK   PIB1.        JOBCPUS  PIB3.2
        SMF5TJS  PIB4.       SMF5TTAT  PIB4.        SMF5RV2  PIB4.
        SMF5PGNO PIB2.       SMF5RV3   PIB2.        SMF5TLEN PIB1.
        PGMRNAME $CHAR20.    JOBCPUT   PIB3.2       SMF5ACTF PIB1.
                 @;
 READTIME = RDETIME - JOBSTART;
 WAITTIME =  STTIME - RDETIME ;
  RUNTIME = TERMTIME- STTIME ;
 OUTPUT JOBS;
END;

FORMAT TERMTIME JOBSTART STTIME RDETIME DATETIME.
       READTIME WAITTIME RUNTIME TIME. ;

PROC PRINT DATA=JOBS(OBS=100);
           TITLE3 TYPE 5 DATA --- JOB TERMINATION;
PROC CHART DATA=JOBS;
           HBAR JOBCLASS;
           HBAR JOBPRTY /DISCRETE;
PROC PRINT DATA=STEPS(OBS=100);
           TITLE3 TYPE 4 DATA --- STEP TERMINATION;
PROC SORT DATA=JOBS; BY JOBNAME JOBSTART;
PROC SORT DATA=STEPS; BY JOBNAME JOBSTART;
DATA JOBSTEP;
     MERGE JOBS STEPS; BY JOBNAME JOBSTART;
PROC PRINT DATA=JOBSTEP(OBS=200);
           TITLE3 MERGED TYPE TYPE 4 DATA AND TYPE 5 DATA;

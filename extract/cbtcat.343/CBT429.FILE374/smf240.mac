//C4SYSDMT JOB C4ADM000,MSGCLASS=X,CLASS=Q,NOTIFY=C4ADMDM
//*
//SAS     EXEC SAS609
//DATLIB  DD DSN=SYS1.MAN1,DISP=SHR
//*ATLIB  DD DSN=SYS1.MAN1,DISP=SHR
//SYSIN   DD *
TITLE SMF 240;
  DATA CMF01CPU (KEEP = C4DATE C4TIME
    CMF01USE
    CMF01NST
    CMF01NSX
    CMF01NSM
    CMF01ABS
    CMF01TSN
    CMF01TSM
    CMF01TST
    CMF01IDL
    CMF01CST
    CMF01B00
    CMF01B01
    CMF01B02
    CMF01B03
    CMF01B04
    CMF01B05
    CMF01B06
    CMF01B07
    CMF01B08
    CMF01B09
    CMF01B10
    CMF01B11
    CMF01B12
    CMF01B13
    CMF01B14
    CMF01B15
    CMF01B16
  )
  DATA CMF01CHN (KEEP = C4DATE C4TIME
    CMF01ID
    CMF01SER
    CMF01DIE
    CMF01SIG
    CMF01BSY
    CMF01VR
    CMF01MLS
    CMF01MGS
    CMF01MTC
    CMF01SUP
    CMF01ESU
    CMF01DSU
    CMF01ESR
    CMF01DSR
    CMF01ESG
    CMF01DSG
    CMF01BCH
    CMF01TSO
    CMF01STA
    CMF01KE0
    CMF01K0P
    CMF01KE1
    CMF01K1P
    CMF01KE2
    CMF01K2P
    CMF01KE3
    CMF01K3P
    CMF01KE4
    CMF01K4P
    CMF01KE5
    CMF01K5P
    CMF01KE6
    CMF01K6P
    CMF01KE7
    CMF01K7P
    CMF01KE8
    CMF01K8P
    CMF01KE9
    CMF01K9P
    CMF01KEA
    CMF01KAP
    CMF01KEB
    CMF01KBP
    CMF01KEC
    CMF01KCP
    CMF01KED
    CMF01KDP
    CMF01KEE
    CMF01KEP
    CMF01KEF
    CMF01KFP
    CMF01DCT
    CMF01SCT
    CMF01NCH
    CMF01ACH
    CMF01ACB
    CMF01RV1
    CMF01WCH
  )
  ;
  RETAIN CMF01 0;
  RETAIN V;
  INFILE DATLIB JFCB=JF;
  IF _N_ = 1 THEN DO;
                  INPUT @;
                  IF INDEX(JF,'SYS1.MAN') ^=0 THEN V=4  ; ELSE V=0  ;
                  END;
  IF V= 4  THEN
      INPUT    SMFXXLEN PIB2. SMFXXSEG PIB2. @ ;
  INPUT    SMFXXFLG PIB1. SMFXXRTY PIB1.
                       @;
  IF SMFXXRTY = 212 THEN DO;
                        *PUT '212 DETECTED - SKIPPING';
                         DELETE;
                         END;
  INPUT TIMEOUT SMFSTAMP8.
      SYSTEM $CHAR4. @;
  C4DATE = DATEPART(TIMEOUT);
  C4TIME = TIMEPART(TIMEOUT);
  INFILE DATLIB;
  IF SMFXXRTY = 240;
  INPUT @V+25
        CMFPRS PIB4. CMFPRL PIB2. CMFPRN PIB2. @;

   POFFSET = CMFPRS + V - 3;
  INPUT
    @POFFSET     CMF01MFV PD2.
    @POFFSET+2   CMF01PRD $8.
    @POFFSET+10  CMF01IST PD4.
    @POFFSET+14  CMF01DAT PD4.
    @POFFSET+18  CMF01INT PD4.
    @POFFSET+28  CMF01SUB PIB1.
    @POFFSET+29  CMF01CFL PIB1.
    @POFFSET+40  CMF01MVS $8.
  @;
*;
** FILTER RECORDS FOR SUBTYPE 01;
*;
  IF CMF01SUB NE 01 THEN DELETE;

   CMF01 = CMF01 + 1;        /* COUNT CMF01 RECORDS */

   INPUT @V+25   +8    /* THE FIRST NON-PRODUCT-SECTION TRIPLET */
    CMF01QSS  PIB4.     /* AL4(CMF01#DO) OFFSET TO CPU QUEUE SECTION  */
    CMF01QSL  PIB2.     /* AL2(CMF01QLN) LENGTH OF CPU QUEUE SECTION  */
    CMF01QSN  PIB2.     /* H'1' NUMBER OF CPU QUEUE SECTIONS          */
    CMF01CSS  PIB4.     /* AL4(CMF01#CO) OFFSET TO CPU/CHANNEL SECTION*/
    CMF01CSL  PIB2.     /* AL2(CMF01CCL) LENGTH OF CPU/CHANNEL SECTION*/
    CMF01CSN  PIB2.     /* H'0' NUMBER OF CPU/CHANNEL SECTIONS        */
 /* CMF01#PO  EQU *-CMF01HDR (00034) OFFSET TO PRODUCT SECTION        */
   @;                                  /* TRIPLETS ARE INPUT */
       ******************************;
       *  CPU QUEUE COUNTS SECTION.  ;
       ******************************;
          /* CHANGE FROM REL 0 IN REC TO REL 1 IN DATA */
   CMF01QSS = CMF01QSS - 4 + 1;
   DO WHILE ( CMF01QSN > 0 );         /* BEGIN SECTION */
    INPUT @CMF01QSS+V
 /* CMF01Q    DS 0F                                                   */
    CMF01USE  PIB4.     /* F'0' NUMBER OF MILLI SECS USED BY CMF      */
    CMF01NST  PIB4.     /* F'0' IN AND NONSWAPPABLE - TOTAL           */
    CMF01NSX  PIB4.     /* F'0' IN AND NONSWAPPABLE - MIN             */
    CMF01NSM  PIB4.     /* F'0' IN AND NONSWAPPABLE - MAX             */
    CMF01ABS  PIB4.     /* F'0' COUNT OF TIMES ALL CPUS BUSY          */
    CMF01TSN  PIB4.     /* F'0' COUNT OF READY TCB'S MIN              */
    CMF01TSM  PIB4.     /* F'0' COUNT OF READY TCB'S MAX              */
    CMF01TST  PIB4.     /* F'0' COUNT OF READY TCB'S TOT              */
    CMF01IDL  PIB4.     /* F'0' COUNT OF TIMES ALL CPUS IDLE          */
    CMF01CST  PIB4.     /* F'0' COUNT OF TIMES A CPU QUEUE EXSIST     */
    CMF01B00  PIB4.     /* F'0' NUMBER SAMPLES WITH  0 CPUS BUSY      */
    CMF01B01  PIB4.     /* F'0' NUMBER SAMPLES WITH  1 CPU  BUSY      */
    CMF01B02  PIB4.     /* F'0' NUMBER SAMPLES WITH  2 CPUS BUSY      */
    CMF01B03  PIB4.     /* F'0' NUMBER SAMPLES WITH  3 CPUS BUSY      */
    CMF01B04  PIB4.     /* F'0' NUMBER SAMPLES WITH  4 CPUS BUSY      */
    CMF01B05  PIB4.     /* F'0' NUMBER SAMPLES WITH  5 CPUS BUSY      */
    CMF01B06  PIB4.     /* F'0' NUMBER SAMPLES WITH  6 CPUS BUSY      */
    CMF01B07  PIB4.     /* F'0' NUMBER SAMPLES WITH  7 CPUS BUSY      */
    CMF01B08  PIB4.     /* F'0' NUMBER SAMPLES WITH  8 CPUS BUSY      */
    CMF01B09  PIB4.     /* F'0' NUMBER SAMPLES WITH  9 CPUS BUSY      */
    CMF01B10  PIB4.     /* F'0' NUMBER SAMPLES WITH 10 CPUS BUSY      */
    CMF01B11  PIB4.     /* F'0' NUMBER SAMPLES WITH 11 CPUS BUSY      */
    CMF01B12  PIB4.     /* F'0' NUMBER SAMPLES WITH 12 CPUS BUSY      */
    CMF01B13  PIB4.     /* F'0' NUMBER SAMPLES WITH 13 CPUS BUSY      */
    CMF01B14  PIB4.     /* F'0' NUMBER SAMPLES WITH 14 CPUS BUSY      */
    CMF01B15  PIB4.     /* F'0' NUMBER SAMPLES WITH 15 CPUS BUSY      */
    CMF01B16  PIB4.     /* F'0' NUMBER SAMPLES WITH 16 CPUS BUSY      */
 /* CMF01QLN  EQU *-CMF01Q (0006C) LENTH OF CPU QUEUE COUNTERS        */
       @;                        /* END INPUT CMF01QSS */
       OUTPUT CMF01CPU;
       CMF01QSS = CMF01QSS + CMF01QSL;
       CMF01QSN = CMF01QSN - 1;
   END;                       /* END SECTION CMF01QSN  */
         *******************************;
         * CPU AND CHANNEL SAMPLE DATA  ;
         *******************************;
          /* CHANGE FROM REL 0 IN REC TO REL 1 IN DATA */
   CMF01CSS = CMF01CSS - 4 + 1;
   DO WHILE ( CMF01CSN > 0 );         /* BEGIN SECTION */
    INPUT @CMF01CSS+V
 /* CMF01#CO  EQU *-CMF01HDR (000D4) OFFSET TO THIS SECTION           */
 /* CMF01C    DS 0F                                                   */
    CMF01ID   $CHAR2.   /* XL2'0' CPU ID FROM CSD                     */
    CMF01SER  $CHAR6.   /* CL6'40' CPU SERIAL NUMBER                  */
    CMF01DIE  PIB4.     /* F'0' NUMBER OF MIRCO SECS DIE DELAYED      */
    CMF01SIG  PIB4.     /* F'0' TOTAL SIG DELAY LOW BIT=1 MIRCO       */
    CMF01BSY  PIB4.     /* F'0' COUNT OF TIMES CPU BUSY               */
    CMF01VR   PIB4.     /* F'0' COUNT OF TIMES CPU IN V=R ADDRESS     */
    CMF01MLS  PIB4.     /* F'0' COUNT OF TIMES MODE IS LOCAL SRB      */
    CMF01MGS  PIB4.     /* F'0' COUNT OF TIMES MODE IS GLOBAL SRB     */
    CMF01MTC  PIB4.     /* F'0' COUNT OF TIMES MODE IS TCB            */
    CMF01SUP  PIB4.     /* F'0' COUNT OF SUPERVISOR STATE OBSERVAT    */
    CMF01ESU  PIB4.     /* F'0' COUNT OF TIMES ENABLED SUPERV(TCB)    */
    CMF01DSU  PIB4.     /* F'0' COUNT OF TIMES DISABLED SUPERV(TCB)   */
    CMF01ESR  PIB4.     /* F'0' COUNT OF TIMES ENABLED L/SRB          */
    CMF01DSR  PIB4.     /* F'0' COUNT OF TIMES DISABLED L/SRB         */
    CMF01ESG  PIB4.     /* F'0' COUNT OF TIMES ENABLED G/SRB          */
    CMF01DSG  PIB4.     /* F'0' COUNT OF TIMES DISABLED G/SRB         */
    CMF01BCH  PIB4.     /* F'0' COUNT OF TIMES BATCH USER IN CONTR    */
    CMF01TSO  PIB4.     /* F'0' COUNT OF TIMES TSO USER IN CONTROL    */
    CMF01STA  PIB4.     /* F'0' COUNT OF TIMES STARTED TASK IN CON    */
    CMF01KE0  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 0      */
    CMF01K0P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K0 - PRB   */
    CMF01KE1  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 1      */
    CMF01K1P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K1 - PRB   */
    CMF01KE2  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 2      */
    CMF01K2P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K2 - PRB   */
    CMF01KE3  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 3      */
    CMF01K3P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K3 - PRB   */
    CMF01KE4  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 4      */
    CMF01K4P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K4 - PRB   */
    CMF01KE5  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 5      */
    CMF01K5P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K5 - PRB   */
    CMF01KE6  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 6      */
    CMF01K6P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K6 - PRB   */
    CMF01KE7  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 7      */
    CMF01K7P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K7 - PRB   */
    CMF01KE8  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 8      */
    CMF01K8P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K8 - PRB   */
    CMF01KE9  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY 9      */
    CMF01K9P  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN K9 - PRB   */
    CMF01KEA  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY A      */
    CMF01KAP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KA - PRB   */
    CMF01KEB  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY B      */
    CMF01KBP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KB - PRB   */
    CMF01KEC  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY C      */
    CMF01KCP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KC - PRB   */
    CMF01KED  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY D      */
    CMF01KDP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KD - PRB   */
    CMF01KEE  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY E      */
    CMF01KEP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KE - PRB   */
    CMF01KEF  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KEY F      */
    CMF01KFP  PIB4.     /* F'0' COUNT OF TIMES OBSERVED IN KF - PRB   */
    CMF01DCT  PIB4.     /* F'0' NUM OF TIMES CPU HAD A DIE DELAY      */
    CMF01SCT  PIB4.     /* F'0' NUM OF TIMES CPU HAD A SIG DELAY      */
    CMF01NCH  PIB4.     /* F'0' COUNT OF TIMES NO CHAN BUSY & CPU BSY */
    CMF01ACH  PIB4.     /* F'0' COUNT OF TIMES ANY CHAN BUSY & CPU WAI*/
    CMF01ACB  PIB4.     /* F'0' COUNT OF TIMES ANY CHAN BUSY & CPU BSY*/
    CMF01RV1  PIB4.     /* F'0' RESERVED FIELD                        */
    CMF01WCH  PIB4.     /* F'0' COUNT OF TIMES CPU IN WAIT & CHAN'S IN*/
 /* CMF01CLN  EQU *-CMF01NCH (00014) LENGTH OF CHAN DATA SEC.         */
 /* CMF01CCL  EQU *-CMF01C (000E8) LENGTH OF CPU AND CHAN DATA SEC.   */
       @;                        /* END INPUT CMF01CSS */
       OUTPUT CMF01CHN;
       CMF01CSS = CMF01CSS + CMF01CSL;
       CMF01CSN = CMF01CSN - 1;
   END;                       /* END SECTION CMF01CSN  */
      FORMAT CMF01ID HEX4.;
RETURN;
*ROC PRINT;
PROC PRINT DATA=CMF01CPU;
FORMAT C4DATE DATE.;
FORMAT C4TIME TIME.;
PROC PRINT DATA=CMF01CHN;
FORMAT C4DATE DATE.;
FORMAT C4TIME TIME.;

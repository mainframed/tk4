//C4SYSDMS JOB EDPCSBS1,'SASD',MSGCLASS=X,CLASS=1,NOTIFY=ED115DM
//*
//SAS     EXEC SAS,OPTIONS=NODATE
//SMFTAPE DD DSN=SYS1.MAN1,DISP=SHR
//SYSIN   DD *
TITLE SASMF4;
  DATA STEPS;
  KEEP TYPE TIMEOUT JOBNAME JOBSTART TIMEIN CCODE PROGNAME CPUTIME
       PAGEIN PAGEOUT ELAPSED HOUR;
  INFILE SMFTAPE;
  INPUT @1 SMFXXLEN PIB2. SMFXXSEG PIB2.
           SMFXXFLG PIB1. TYPE PIB1. TIMEOUT SMFSTAMP8.
        SMFXXSID $CHAR4. @;
  IF TYPE = 4;
  INPUT JOBNAME  $CHAR8.     JOBSTART  SMFSTAMP8.   SMF04UIF $CHAR8.
        SMF04STN PIB1.
        TIMEIN   SMFSTAMP8.  SMF04NCI  PIB4.        CCODE    PIB2.
        SMF4PRTY PIB1.       PROGNAME  $CHAR8.      SMF4STMN $CHAR8.
        SMF4RSH0 PIB2.       SMF4SYST  PIB2.        SMF4HOST PIB2.
        SMF4RV1  PIB6.       SMF4SPK   PIB1.        SMF4STI  PIB1.
        SMF4RV2  PIB2.       SMF4AST   PIB4.        SMF4PPST PIB4.
        SMF4RV3  PIB1.       SMF4SRBT  PIB3.        SMF4RIN  PIB2.
        COLREL   PIB2.       DEVLEN    PIB2. @;
 N = (DEVLEN -2)/8;
        INPUT @107+DEVLEN SMF4LNTH PIB1.  @;
   IF SMF4LNTH > 0 THEN DO;
        INPUT      CPUTIME  PIB3.2 SMF4NAF PIB1.  @;
   END;
        OFF = COLREL   +5 ;
INPUT @OFF PAGEIN   PIB4.    PAGEOUT  PIB4. @ ;
ELAPSED = TIMEOUT - TIMEIN;
HOUR = MOD(INT(TIMEOUT/3600),24);
FORMAT JOBSTART TIMEOUT TIMEIN DATETIME. ELAPSED TIME. ;
FORMAT CCODE HEX4.;

PROC PRINT DATA=STEPS;
PROC CHART;
      HBAR PROGNAME;
      HBAR PROGNAME / SUMVAR=CPUTIME;
      HBAR CCODE / DISCRETE;
      VBAR ELAPSED;
      VBAR HOUR/SUMVAR=CPUTIME DISCRETE;

//C4SYSDMP JOB EDPCSBS1,'PDS2',MSGCLASS=X,CLASS=L,NOTIFY=ED115DM
//*
//        EXEC EDSAS607,OPTIONS='NODATE LINESIZE=80)'
//PDS1    DD DSN=EDS1.PROD.MXG99.USERMOD.SOURCLIB,DISP=SHR,DCB=DSORG=PS
//PDS2    DD DSN=EDS1.PROD.MXG99.SOURCLIB,DISP=SHR,DCB=DSORG=PS
//T1      DD DSN=&&TEMP,UNIT=3380,SPACE=(CYL,(2,2,9)),DISP=(NEW,PASS),
//           DCB=(DSORG=PO,RECFM=FB,LRECL=80,BLKSIZE=9040)
//SYSIN   DD *
DATA DIR1 (KEEP = MEMBER SIZE ALIAS N1);
LENGTH N1 $ 44;
LENGTH Y1 $ 44;
   INFILE PDS1 RECFM=U  BLKSIZE=256 LRECL=256 FILENAME=Y1; COL=3;
   N1=Y1;
   INPUT COUNT PIB2. @;  IF COUNT < 14 THEN STOP;

   DO WHILE (COL < COUNT);
      INPUT @COL MEMBER $8. TT PIB2. R PIB1. IND PIB1. @;
      IF MEMBER>'99999999' THEN STOP;
      ALIAS=' '; IF IND > 128 THEN ALIAS='*';
      SSICOL=COL+34; SSI='     ';
      ATTRIB=.; SIZE=.;
      COL = COL +12 + 2*MOD(IND,32);
      IF MOD(INT(IND/32),4) NE 0 THEN DO;
         INPUT +8 ATTRIB PIB2. SIZE PIB3. @;
         IF MOD(INT(ATTRIB/977 ),2) THEN SSICOL=SSICOL+8;
         IF ALIAS='*' × INT(ATTRIB/16384) THEN SSICOL=SSICOL+11;
         IF SSICOL<COL-2 THEN INPUT @SSICOL SSI $CHAR4. @;
      END;
    HSIZ = SIZE;
    OUTPUT;
   END;
DROP COUNT IND COL SSICOL;
RETURN;
DATA DIR2 (KEEP = MEMBER SIZE ALIAS N2);
LENGTH N2 $ 44;
LENGTH Y2 $ 44;
   INFILE PDS2 RECFM=U  BLKSIZE=256 LRECL=256 FILENAME=Y2; COL=3;
   N2=Y2;
   INPUT COUNT PIB2. @;  IF COUNT < 14 THEN STOP;

   DO WHILE (COL < COUNT);
      INPUT @COL MEMBER $8. TT PIB2. R PIB1. IND PIB1. @;
      IF MEMBER>'99999999' THEN STOP;
      ALIAS=' '; IF IND > 128 THEN ALIAS='*';
      SSICOL=COL+34; SSI='     ';
      ATTRIB=.; SIZE=.;
      COL = COL +12 + 2*MOD(IND,32);
      IF MOD(INT(IND/32),4) NE 0 THEN DO;
         INPUT +8 ATTRIB PIB2. SIZE PIB3. @;
         IF MOD(INT(ATTRIB/977 ),2) THEN SSICOL=SSICOL+8;
         IF ALIAS='*' × INT(ATTRIB/16384) THEN SSICOL=SSICOL+11;
         IF SSICOL<COL-2 THEN INPUT @SSICOL SSI $CHAR4. @;
      END;
    HSIZ = SIZE;
    OUTPUT;
   END;
DROP COUNT IND COL SSICOL;
RETURN;
*ORMAT ATTRIB HEX4. SSI $HEX8.;
*ROC PRINT; *ITLE MEMBERS IN LIBRARY IN ALPABETICAL ORDER;
PROC SORT DATA=DIR1; BY MEMBER;
PROC SORT DATA=DIR2; BY MEMBER;
DATA A (KEEP=MEMBER ALIAS) B (KEEP=MEMBER ALIAS)
     C (KEEP=MEMBER ALIAS N1 N2);
MERGE DIR1(IN=S1) DIR2(IN=S2); BY MEMBER;
IF S1 AND NOT S2 THEN OUTPUT A;
IF S2 AND NOT S1 THEN OUTPUT B;
IF S1 AND S2 THEN OUTPUT C;
RETURN;
PROC PRINT DATA=A;
TITLE 'NEW MEMBERS';
PROC PRINT DATA=B;
TITLE 'DELETED MEMBERS';
*ROC PRINT DATA=C;
*ITLE 'SAME MEMBERS';
DATA;
SET C;
IF ALIAS = '*' THEN DELETE;
FILE T1(WRK);
PUT +2 'IEBCOM' +1 MEMBER $CHAR8. ' ,';
PUT +2  N1 ' ,';
PUT +2  N2;
RETURN;
//*
//   EXEC PGM=IEBGENER
//SYSPRINT DD SYSOUT=*
//SYSUT2   DD SYSOUT=*
//SYSUT1   DD DISP=SHR,DSN=&&TEMP(WRK)
//SYSIN DD *
//*
//TSO      EXEC  PGM=IKJEFT01,DYNAMNBR=40,PARM='WRK'
//SYSTSPRT DD SYSOUT=*
//SYSEXEC  DD DISP=(OLD,DELETE),DSN=&&TEMP
//         DD DISP=SHR,DSN=ED115DM.PROD.REXX
//SYSTSIN  DD DUMMY
//*

./       ADD   NAME=$$$$$$$$
BOB:

THIS IS THE LATEST VERSION OF QUEUE THAT INLUDES SOME MODS THAT
JOHN KINN WORKED UP.  SEE HIS NOTES IN $CLDOC, AND ALSO $LOG
TO SEE HOW THIS MATCHES WITH WHAT YOU ARE RUNNING.

GOOD LUCK.

JACK
./       ADD   NAME=$$JESUPD
//DORJES   JOB (6000A,4,,9999),'QUEUE - JES2 V136',CLASS=A,
// MSGCLASS=M,NOTIFY=DOR
//*
/*ROUTE PRINT RMT55
//*
/*JOBPARM F=STD.
//*
//********************** C O M M E N T S ******************************
//* DAVID RIKER   - C O M P U T E R   D A T A   S Y S T E M S , I N C.*
//* DATE: 01/28/86                                                    *
//*********12**16******************************************************
//* COMMENTS:                                                         *
//*     THIS JOB STREAM APPLIES ALL OF THE JES MODS TO THE SYSTEM     *
//*     THE STEPS TO DO THIS:                                         *
//*     1. COPY SYS1.HASPSRC TO TEMPORARY HASPSRC                     *
//*     2. APPLY MODS(IEBUPTE) TO AFFECTED JES MODULES(SEVERAL STEPS) *
//* NOTE:                                                             *
//*     THE JES SOURCE AND OBJECT ARE AVAILABLE ONLY DURING           *
//*     THE EXECUTION OF THIS JOB STREAM(SOURCE IS IN A               *
//*     TEMPORARY DATA SET).   IF THE JES SOURCE IS NEEDED            *
//*     A SPECIAL RUN OF THIS JOB STREAM IS REQUIRED.                 *
//*********12**16******************************************************
//DEALLOC  EXEC PGM=IEFBR14
//DDSN   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,VOL=SER=8DBP02,UNIT=3380,
//             DISP=(OLD,DELETE,UNCATLG),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//ALLOC    EXEC PGM=IEFBR14
//DDSN   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,VOL=SER=8DBP02,UNIT=3380,
//             SPACE=(TRK,(200,100,80)),DISP=(,CATLG),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)
//STEP1    EXEC PGM=IEBCOPY
//SYSPRINT DD  SYSOUT=*
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(3))
//SYSUT4   DD  UNIT=VIO,SPACE=(CYL,(3))
//INDD     DD  DSN=SYS1.HASPSRC,DISP=SHR,
//             UNIT=3350,VOL=SER=MIPO1P
//OUTDD    DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//             VOL=SER=8DBP02,UNIT=3380
//SYSIN    DD  *
  COPY INDD=INDD,OUTDD=OUTDD,LIST=NO
//*
//STEP2    EXEC PGM=IEBUPDTE
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//             VOL=SER=8DBP02,UNIT=3380
//SYSUT2   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//             VOL=SER=8DBP02,UNIT=3380
//SYSIN    DD  DSN=SYS1.JES2.V136.MODLIB(#MELLON),DISP=SHR, MELLON
//             VOL=SER=DLIB0B,UNIT=SYSDA
//*
//*STEP4    EXEC PGM=IEBUPDTE
//*SYSPRINT DD  SYSOUT=*
//*SYSUT1   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//*             VOL=SER=8DBP02,UNIT=3380
//*SYSUT2   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//*             VOL=SER=8DBP02,UNIT=3380
//*SYSIN    DD  DSN=SYS1.JES2.V136.MODLIB(#CL),DISP=SHR, CALIFORNIA
//*             VOL=SER=DLIB0B,UNIT=SYSDA                LOCKHEED
//*
//STEP5    EXEC PGM=IEBUPDTE
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//             VOL=SER=8DBP02,UNIT=3380
//SYSUT2   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//             VOL=SER=8DBP02,UNIT=3380
//SYSIN    DD  DSN=SYS1.JES2.V136.MODLIB(#NERDC),DISP=SHR, NERDC
//             VOL=SER=DLIB0B,UNIT=SYSDA
//
./       ADD   NAME=$$QIDOC
THE SP13  VERSION OF THE QUEUE COMMAND IS MODIFIED FOR CDSI NEEDS.
WORKS ON MVS 3.8J  & ANY ISPF VERSIONS (RELINK WITH ISPLINK OF EACH
ISPF VERSION )
 -------------------------------------------------------------------
NOTE FROM DOR/CDSI 09/28/87. ispf queue test with sp136 as good
    except further using of queue was terminated on aug 87 as
    replacement of IBM SDSF v2.  No futher assistance to maintain
    nor upgrade to xa or higher release than sp136. sorry.
    WHEN WE HAVE XA, I CAN MAKE ISPF QUEUE FOR XA.
    I do continue using queue command to keep up with ispf changes.
 -------------------------------------------------------------------
NOTE FROM DOR/CDSI 05/4/87. ISPF V2+ DOES SUPPORT THIS.
    USE SAME SP134 FOR SP136 PLEASE SEE ASM EXEC PARM SPECIFICATION.
 -------------------------------------------------------------------
KNOWN PROBLEM/FIXED: 5/4/87
  1.ISPF V2 IS OK WITH THIS QUEUE EXCEPT RFIND OR RCHANGE PKEYS.
    PROBLEM:  When use queue repeat find pf key, got
              "RFIND IS NOT ACTIVE" on first line of queue screen.
    SOLUTION: 6/18/87 DOR-
         1. COPY QI@CMDS AND QI@PROF TO YOUR PROFILE (ispprof ddn).
         2. Upgrade ISR@PRIM panel with:
           a.change/add like the following selection:
                QI,'PGM(QI@S1342) NOCHECK NEWAPPL(QI@)'
           b. add before "&ZTRAIL = .TRAIL" with the following coding:
                IF (&ZCMD ='QI')
                   &ZSEL ='PGM(QI@S1342) NOCHECK NEWAPPL(QI@)'
         note: This newappl will force ispf/pdf to use IFIND instead
               of RFIND VERB for supporting QUEUE.

  2.WE ARE IN FULL SP136 OPERATION NOW. THE SP136 QUEUE WAS
    TESTED AT THIS TIME. WE ARE USING IBM SDSF IN LEIU OF OUR
    OWN ISPF QUEUE. I BELIEVED THAT SP136 QUEUE IS SUFFICENT
    OPERATIONAL AS TESTED AS WELL AS SYSTEM PROGRAMMER UTILITY.

  3.THERE ARE TUTORIAL SYSTEM ON QUEUE AS TESTED AND VERIFIED. NEW
    HELP, ISPFQI, AND PARSE PROGRAMS WERE MODIFIED TO SUPPORT
    USING TUTORIAL PANELS ON ISFP V2. I DID NOT TEST ON ISPF V1.
    PLEASE COPY ALL MEMBERS PREFIXED TQ TO YOUR ISPPLIB FILE.

  4.NEW QUEUE COMMAND CALLED SJOB AS EQUIVALENT TO IBM ISPF 3.8 OPTION
    IS DEVELOPED AND AVAILABLE FOR YOUR USE. FOR MORE INFORMATION,
    SEE TUTORIAL OF SJOB.
 -------------------------------------------------------------------
 NOTICE: ALL SOURCES ARE MODIFIED FOR BOTH SP134 AND SP136. PLEASE
         DISCARD OLD SP134 QUEUE SOURCES FROM YOUR LIBRARY.
         and also support standalone tso command, ispf v1 and v2.
         Please read assembler parameters to specify standalone,
         ispf v1 or v2.
 -------------------------------------------------------------------
USING ISPF QI, MY PRODUCTIVITY INCREASES MUCH THAN USING TSO Q BECAUSE
I USE ISPF SPILTING WHEN CHECKING WITH JES2 SPOOL WHEN WORK WITH ISPF
EDITING AND OTHER FUNCTIONS.  ISPF QI  SAVES QUEUE RE-INITIALITION
OVERHEAD.  WE ARE USING IBM SDSF NOW.  USE YOUR MAINTAINANCE ON
ISPF QUEUE AT YOUR OWN RISK. I USE ISPF QUEUE AS SYSTEM PROGRAMMER
TOOLS  WHEN WE HAVE SDSF.
 -------------------------------------------------------------------
 WARNING BEFORE YOU SUBMIT ASM/LKED JOBS:
 TO CHANGE HASPCKPT VOLUME NAME, USE CKPT IN SYSPARM OF ASM PARM.
  I.E. SYSPARM=(CKPT=XXXXXX) WHERE XXXXXX IS HASPCKPT VOLUME NAME.
     SEE $CDSIDOC FOR JCL SAMPLES.  (DEFAULT CKPT IS MVSDL1)
     SEE $CDSPARM FOR SYSPARM CODE.
 -------------------------------------------------------------------
 TO INSTALL ISPF QUEUE FOR SP134
    1. SEE $CDSPARM TO SET SYSPARM IN ISPSP134 JCL OR QSTART.
    2. ALLOCATE QUEISPF OBJLIB AND LOADLIB (AUTHORIZED LIB).
    3. CODE DSN NAME OF ISPLINK MODULE RESIDED IN LKED STEP.
    4. USE ISPSP134 TO ASM AND LKED ALL Q ROUTINES AND ISPF DRIVER.
       SYSPARM=SYSP TO ADD MORE COMMANDS.
    5. COPY QI@A PANEL MEMBER TO YOUR ISPPLIB DSN
        OR  QI@V2 PANEL MEMBER FOR ISPF V2.2
    6. ADD 'QI' COMMAND ENTRY IN ISR@PRIM (SEE ISR@PRIM).
    7. IF YOU USE ISPF V2 , COPY QI@PROF AND QI@CMDS TO YOUR PROFILE
       UNDER ISPPROF DDN. THIS WILL ACCEPT REPEAT FIND VERB FOR QUEUE
       ISPF INTERFACE (USE IFIND INSTEAD OF RFIND).
    8. READY TO GO AND HAVE FUN!!!
 NOTE: (NO LOAD MODULES AVAILABLE DUE TO YOUR DIFFERENT ISPF VERSION.
     YOU MUST RELINK QI WITH ISPLINK MODULE FROM IBM (ISRLOAD/ISPLOAD).
     LOAD MODULE MUST BE IN AUTHORIZED LIBRARY.
 -------------------------------------------------------------------
 TO INSTALL ISPF QUEUE FOR SP136
    1. SEE $CDSPARM TO SET SYSPARM IN ISPSP136 JCL OR QSTART.
    2. ALLOCATE QUEISPF OBJLIB AND LOADLIB (AUTHORIZED LIB).
    3. CODE DSN NAME OF ISPLINK MODULE RESIDED IN LKED STEP.
    4. USE ISPSP136 TO ASM AND LKED ALL Q ROUTINES AND ISPF DRIVER.
       SYSPARM=SYSP TO ADD MORE COMMANDS.
    5. COPY QI@A PANEL MEMBER TO YOUR ISPPLIB DSN
        OR  QI@V2 PANEL MEMBER FOR ISPF V2.2
    6. ADD 'QI' COMMAND ENTRY IN ISR@PRIM (SEE ISR@PRIM).
    7. IF YOU USE ISPF V2 , COPY QI@PROF AND QI@CMDS TO YOUR PROFILE
       UNDER ISPPROF DDN. THIS WILL ACCEPT REPEAT FIND VERB FOR QUEUE
       ISPF INTERFACE (USE IFIND INSTEAD OF RFIND).
    8. COPY ALL TUTORIAL MEMBERS PREFIXED WITH TQ TO YOUR ISPPLIB FILE.
    9. READY TO GO AND HAVE FUN!!!
 NOTE: (NO LOAD MODULES AVAILABLE DUE TO YOUR DIFFERENT ISPF VERSION.
     YOU MUST RELINK QI WITH ISPLINK MODULE FROM IBM (ISRLOAD/ISPLOAD).
     LOAD MODULE MUST BE IN AUTHORIZED LIBRARY.
 -------------------------------------------------------------------
 TO INSTALL TSO QUEUE WITHOUT ISPF FOR SP134
    1. FOLLOW ISPF QUEUE STEPS 1 AND 2 BEFORE ASM AND LKED FOR
       TSO WITHOUT ISPF. YOU CAN ALLOCATE SEPERATE OBJLIB FOR TSO.
    2. USE JCLSP134 TO ASM AND LKED ALL Q ROUTINES.
       or jclsp136 for jes2 sp136.
    3. ADD 'Q' COMMAND ENTRY IN ISR@PRIM (SEE ISR@PRIM).
    4. READY TO GO AND HAVE FUN!!!
 -------------------------------------------------------------------
  SEE $CDSPARM FOR MORE DETAIL TO INCLUDE ASM SYSPARM CODING.
  ADD ISPF DIALOG MANAGEMENT INTERFACE. SET  1 TO QISPF.
  QCOMMON IS EXPANDED TO SUPPORT ISPF. AND SO Q5
 -------------------------------------------------------------------
 EXTRA QUEUE FEATURES:
1.JOBNAME CAN BE REPEATED WITH BLANKED OR ( DD USE "-"). SEE Q6.
2.QCOMMON IS EXPANDED.
3.NEW MASTER CONSOLE COMMAND (CSYS) TO ISSUE SYSTEM CMDS BY QUEUE.
4.ROUTE JOBNAME TO LOCAL OR REMOTE.
5.DISPLAY BY FORMS/FBC/UBC/COPIES UNDER JOB/DDN.
6.DISPLAY CARRIAGE CONTROL LINES OF JOB/DDN.
7.DISPLAY ALL SPOOL DATASET OF A JOB. (SJOB COMMAND).
___ ONLY ISPF QUEUE FEATURES -----
1.SRM COMMAND TO DISPLAY SRM INFORMATION (CAME FROM #I /FILE 266).
2.ALLOC COMMAND TO DISPLAY ALLOC INFORMATION (CAME FROM #R /FILE 266).
3.ASID COMMAND TO DISPLAY ASID INFORMATION.
4.COREZAP COMMAND TO DISPLAY/ZAP  MEMORY CONTENTS. 7/10/85 STILL DEBUG
    OK TO DISPLAY  BUT NOT WORK ON ZAP. WILL BE DONE.
5.VSM COMMAND TO DISPLAY VIRTUAL STORAGE MANAGEMENT
6.MPL COMMAND TO DISPLAY MULTIPLE PROGRAMMING LISTING
 -------------------------------------------------------------------
 -------------------------------------------------------------------
I WOULD APPRECIATE HEARING FROM ANYONE WHO COMES UP WITH EITHER
ADDITIONAL BUGS OR FIXES TO THE KNOWN ONES.  ALSO, I WILL TRY TO
PASS ON ANY FIXES TO THOSE USERS THAT I AM AWARE OF, SO PLEASE DROP
ME A NOTE IF YOU GET THIS OFF OF ONE OF THE MODS TAPES.

DAVE RIKER
COMPUTER DATA SYSTEMS INC
ONE CURIE COURT
ROCKVILLE, MARYLAND 20850
(202) 362-1160

./       ADD   NAME=$CDSAUTH
                   ++++++++ CONFIDENTIAL ++++++++++
QUEUE FOR MVS JES2 SP134:

   AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:

     (1) ORDINARY USERS
     (2) USERS WITH THE TSO OPERATOR PRIVILEGE
     (3) JES2 SYSTEM PROGRAMMERS

   THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:

     AUTHORIZATION    ----GROUP----    DESCRIPTION
     -------------    (1)  (2)  (3)    -------------------------
       QAFXACTV             X    X     DISPLAY ACTIVE LISTS
       QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
       QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
       QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG 8/8/85
       QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
       QAFXOPER             X    X     OPERATOR AUTHORITY
       QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
---------------------------------------------------------------------
   A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
   IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
   CONTAINED IN A TABLE BELOW (SEE SYMBOL SYSPTABL).

SYSPTABL                           USERIDS OF JES2 SYSTEM PGMRS
       DOR DRC TES CLJ ETA AEN DET
-----------------------------------------------------------------------
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
AUTH  FLAG TYPE         COMMANDS (FOR CMD DESCRIPTION SEE BELOW)
---------------         -------------------------------------
  NONE                  STANDARD QUEUE COMMAND
                        STATUS   (DEFAULT AT QUEUE INITIALIZED)
                        DD      ONLY JOBS  BY USERID
                        LIST    ONLY JOBS  BY USERID
                        DJ      ONLY JOBS  BY USERID
                        JCL     ONLY JOBS  BY USERID
                        JLOG    ONLY JOBS  BY USERID
                        JMSG    ONLY JOBS  BY USERID
                        JHIS    ONLY JOBS  BY USERID
                        PDDB    ONLY JOBS  BY USERID
                        PFK
                        FIND
                        FTIM
                        COL
                        @
                        D
                        PF
                        HF
                        -
                        UP
                        PB
                        HB
                        TOP
                        BOT
                        MODE
                        SAVE
                        SPIN
-----------------------------------------------------------------------
  NONE                  TSO OPERATOR AUTHORITY/PRIVILEGE
                        DD      CAN SCAN JOBS OF ANOTHER USERID
                        LIST    CAN SCAN JOBS OF ANOTHER USERID
                        DJ      CAN SCAN JOBS OF ANOTHER USERID
                        JCL     CAN SCAN JOBS OF ANOTHER USERID
                        JLOG    CAN SCAN JOBS OF ANOTHER USERID
                        JMSG    CAN SCAN JOBS OF ANOTHER USERID
                        JHIS    CAN SCAN JOBS OF ANOTHER USERID
                        PDDB    CAN SCAN JOBS OF ANOTHER USERID
-----------------------------------------------------------------------
  QAFXACTV              DISPLAY ACTIVE LISTS
                        DA
                        DC
                        DT
                        DS    MOVE TO QAFXSLOG 8/8/85  DOR
-----------------------------------------------------------------------
  QAFXBLOG              DISPLAY BACKLOG LISTS
                        DI
                        DO
                        WO
                        AI
                        AO
                        HI
                        HO
                        DQ
                        DF
-----------------------------------------------------------------------
  QAFXSSSM              MAY USE CAN/DEL/REQ
                        CAN
                        DEL
                        REQ
-----------------------------------------------------------------------
  QAFXSLOG              MAY LOOK AT SYSLOG
                        SLOG
                        DS                     8/8/85  DOR
-----------------------------------------------------------------------
  QAFXEXEC              MAY ISSUE TSO CMDS IN QUE
                        TSO (NEW ISPF GET IT FIRST BEFORE Q SCAN IT)
                        EX
-----------------------------------------------------------------------
  QAFXOPER              OPERATOR AUTHORITY
                        XP
-----------------------------------------------------------------------
  QAFXSYSP              JES2 SYSTEM PROGRAMMER
                        XI
                        XB
                        XJ
                        XD
                        JQE
                        JCT
                        IOT
                        HCT
                        JOE
                        TGPS
                        DIE
                        CS
                        ALLO
                        SRM
                        ASID
                        CZAP
 -------------------------------------------------------------------
 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
COMMANDS            DESCRIPTION
------------------  ------------------------------------------------
END               - EXIT QUEUE COMMAND
STAT LEVEL        - DISPLAY ALL JOBS BEGINNING WITH LEVEL
DJ   JOBNAME      - DISPLAY JOB BY JOBNAME
JCL  JOBNAME      - LIST JCL FOR A JOB
JLOG JOBNAME      - LIST JOBLOG FOR A JOB
JMSG JOBNAME      - LIST SYSTEM MESSAGES FOR A JOB
JHIS JOBNAME      - LIST JOB HISTORY INFORMATION
DD   JOBNAME      - LIST SYSIN/SYSOUT DATASETS FOR A JOB
PDDB JOBNAME      - LIST PDDB    S FOR A JOB
LIST JOBNAME DSID - LIST A SYSIN OR SYSOUT DATASET
LIST * +/-N         LIST NEXT OR PREVIOUS N    TH DATASET
SAVE DSNAME       - CREATE A COPY OF THE CURRENT DATASET
SPIN              - SEND COPY OF CURRENT DATASET TO SYSOUT
PRINT ON CLASS DEST  - OPEN SCREEN LOG
PRINT             - PRINT CURRENT SCREEN
PRINT OFF         - CLOSE SCREEN LOG
MODEL #           - SET 3270 MODEL 2, 3, 4, OR 5
NOTES:  (1) DEFAULT FOR LEVEL IS LOGON ID
(2) JOBNAME CAN BE JOBNAME, NUMBER, OR "*" FOR CURRENT JOB
(3) DSID CAN BE DETERMINED BY USING SUBCOMMAND DD OR PDDB
(4) DSNAME WILL BE EXPANDED TO USERID.DSNAME.DATA
 ----------------------------------------------------------------
PFK               - LIST PROGRAM FUNCTION KEYS
PFK  NN  TEXT     - REDEFINE PROGRAM FUNCTION KEYS
FIND     STRING     COL(SS,EE) - FIND CHARACTER STRING
FALL     STRING     COL(SS,EE) - FIND ALL OCCURRENCES OF
                              STRING (COL DEFAULTS TO ALL)
COL  #       - REPOSITION HORIZONTALLY TO COLUMN NUMBER
@/MD #       - REPOSITION TO SPECIFIC RECORD NUMBER
+/D  #       - REPOSITION FORWARD IN DATASET # RECORDS
-/UP #       - REPOSITION BACKWARD IN DATASET # RECORDS
T/TOP        - REPOSITION TO TOP OF DATASET
B/BOTTOM     - REPOSITION TO BOTTOM OF DATASET
HF/HB #      - FORWARD/BACKWARD # HALF PAGES
PF/PB #      - FORWARD/BACKWARD # PAGES

NOTES:  (1) STRING SPECIFICATION FOR FIND MAY BE DELIMITED
    WITH BLANKS, SINGLE QUOTES, OR DOUBLE QUOTES.
    WITH BLANKS, SINGLE QUOTES, DOUBLE QUOTES, OR WITH A
    SLASH ("/").
 ----------------------------------------------------------------
DA           - DISPLAY ALL JOBS IN EXECUTION
DT           - DISPLAY TSO USERS
DS           - DISPLAY SYSTEM TASKS
DC TYPE      - DISPLAY CPU BATCH/STC/TSO  (BLANK,B/J/S/T)
DQ           - DISPLAY INPUT QUEUES
DI CLASS     - DISPLAY ALL JOBS IN INPUT CLASS
AI CLASS     - DISPLAY JOBS AVAILABLE FOR PROCESSING
HI CLASS     - DISPLAY HELD JOBS IN INPUT CLASS
DF           - DISPLAY OUTPUT QUEUES
DO CLASS     - DISPLAY ALL JOBS IN OUTPUT CLASS
WO           - DISPLAY ONLY OUTPUT JOBS WITH WRITER NAME SP+
   ECIFIED
AO CLASS     - DISPLAY AVAILABLE OUTPUT
HO CLASS     - DISPLAY HELD OUTPUT

DEFAULT FOR CLASS IS ALL CLASSES

 ----------------------------------------------------------------
CAN JOBNAME <P>        - CANCEL JOB ("P" OPTION FOR PURGE)
DEL JOBNAME            - DELETE JOB
REQ JOBNAME <NEWCLASS> - RELEASE JOB    S HELD OUTPUT
 ----------------------------------------------------------------
SLOG  ID  <SEQ>   - LIST THE SYSTEM LOG DATASET
FTIME HH.MM.SS    - REPOSITION SYSTEM LOG TO GIVEN TIME

ID MAY BE A JOB# DETERMINED BY STATUS SYSLOG,
  OR IT MAY SPECIFY THE SYSTEM ID OF THE DESIRED SYSTEM
  (A NULL FIELD WILL LIST THE ACTIVE SYSTEM    S LOG)
DEFAULT FOR SEQ IS 0 (THE CURRENT SYSLOG DATASET)
  (USE A VALUE OF 1, 2, ... TO OBTAIN PREVIOUS DATASETS)
 ----------------------------------------------------------------
TSO CMD PRMS      - ISSUE ANY TSO COMMAND W/OPTIONAL PARMS
XB  MTTR          - DISPLAY BLOCK FROM SYS1.HASPACE
                      USE "*" TO RE-SHOW AND "+" TO CHAIN
XD  JOBNAME DSID  - UNRESTRICTED DISPLAY OF DATASETS
XI                - DISPLAY ACTIVE INITIATORS
XJ  JOBNAME       - DISPLAY UNINTERPRETED JQES AND JOES
JQE JOBNAME       - DISPLAY JQE IN HEX/EBCDIC
JCT JOBNAME <OFFSET>  - DISPLAY JCT IN HEX/EBCDIC
IOT JOBNAME       - DISPLAY IOTS IN HEX/EBCDIC
JOE JOBNAME       - DISPLAY JOES IN HEX/EBCDIC
HCT               - DISPLAY HCT $SAVE AREA
TGPS              - LIST HIGH TRACK GROUP USERS
TGPS              - LIST HIGH TRACK GROUP USERS (A VERY SLOW COMMAND)
 ----------------------------------------------------------------
./       ADD   NAME=$CDSIDOC
COMMENTS BY DOR/CDSI........FIXES FOR QUEUE
2/6/87 DOR MODIFY SAVEPGM BY ADDING DEFAULT DA08SER AND DA08UNIT FOR
   DYNAMIC ALLOCATION TO SYSDA ON 3380 INSTEAD OF 3350. INITIALLY
   THESE FIELDS ARE ALLOCATED TO HASPCKPT BY INIT PROGRAM AT ONE TIME.
   THEN SAVEPGM WILL CHANGE THE FIELDS TO DEFAULT. PLEASE CHANGE
   DEFAULT ACCORDING YOUR SHOP.

COMMENTS BY DOR/CDSI........QUEUE FOR JES2 134
      ------------- PRODUCTION -------
 1.THE TWO JOBS WILL ASM ALL MODULES AND LINK  ALL MODULES INTO ONE
 LOAD MODULE: (CKPT=MVSDL1 DEFAULT HASPCKPT VOLUME NAME)

    JCLSP134   FOR TSO QUEUE      CMD= Q4  PGM=QUESP134
    ISPSP134   FOR ISPF QUEUE     CMD= QI4 PGM=ISPQ134

 2.  TO CHANGE HASPCKPT VOLUME NAME, CHANGE PARM CKPT=VOLSER
        (DEFAULT=MVSDL1) AND REASM Q0 AND RELINK LOAD
        MODULE. USE THE JOBS BELOWS: THESE JOBS MUST HAVE
        CURRENT LOAD MODULES AND OBJECT MODULES AS DONE BY
        #1 JOBS.

    JCLCH134   FOR TSO QUEUE      CMD= Q4  PGM=QUESP134
    ISPCH134   FOR ISPF QUEUE     CMD= QI4 PGM=ISPQ134
    ISTCH134   FOR ISPF QUEUE (TEST & VERIFY) CMD= QI4T PGM=ISPQ134T

*-*-*-*-*-*-*-*-*-*-------------------------------------------------
      ------------- TESTING    -------
THE BELOW JOBS ARE FOR TESTING AND DEVELOPING NEW MODULE.
    JCTSP134   FOR TSO QUEUE      CMD= Q4T  PGM=QUEJESA
    ISTSP134   FOR ISPF QUEUE     CMD= QI4T PGM=ISPQUTA
    JCLSP130   FOR TSO QUEUE
    JCLSP133   FOR TSO QUEUE
----------- RELINK FOR PRODUCTION AFTER TESTING -----------
JCTRL134   FOR TSO QUEUE      CMD= Q   PGM=QUEJESA
ISPRL134   FOR ISPF QUEUE     CMD= QI   PGM=ISPQUEA
----------- ISPF SUPPORT QUEUE ----BY DOR/CDSI 12/02/86 ---
1. ISPF V1R1M0  SUPPORT THIS. MUST HAVE "TLD" TABLE FROM ISPF.
2. ISPF V2R1M0+ DOESNT SUPPORT THIS. I TESTED USING ISPF V2 ON MY
   SYSTEM.  ISPF V2 DOESNT USE TLD TABLES AND DO USE VARIABLE
   TABLE WHEN YOU VGET. I REMODIFIED   AN ALGORITHM TO INTERFACE
   ISPF V2 WHEN I USE NEW ISPF V2.
3. OLD SPF CAN SUPPORT THIS. ANYWAY I THINK IF "TLD" COULD BE WITH
   ISPF V1.
*-*-*-*-*-*-*-*-*-*-------------------------------------------------
      -PROBLEM SOLUTION/FIXED  -------
DOR 7/23/87 - INIT AND SEARCH FIXED FOR 0C4 ABEND REASON QUEUE VALUES
              INITILAZATION WAS ERRORLY LOADED IN INIT PROGRAM.
DOR 11/5/87 - THE RFIND COMMAND PFKEY-5 CAN BE WORKED. CHANGED ISPFQI
              TO SUPPORT RFIND WITH NEW PANEL CALLED QI@V2. SEE $$QIDOC
              FOR HOW TO INSTALL QUEUE ON ISPF V2 ISR@PRIM.
DOR 11/5/87 - THE ISPF JUMP FUNCTION MUST BE ENTERED TWICE FOR IT TO
              WORK (E.G. =X). IT WAS FIXED WITH NEW ISPFQI PROGRAM.
DOR 11/5/87 - USER WANT ISPF QUEUE EQUIVALENT TO IBM ISPF 3.8 OPTION.
              IT WAS IMPLEMENTATED WITH NEW SYSJOB AND LISTDSR
              PROGRAMS. SEE SJOB TUTORIALS.
DOR 11/5/87 - ISPF V2 TUTORIALS ARE AVAILABALE FOR ISPF QUEUE.
              IT WAS REMODIFIED WITH NEW ISPFQI, HELP, AND PARSE
              PROGRAMS. ALL MEMBERS PREFIXED TQ ARE ISPF QUEUE
              TUTORIAL PANELS. QI@V2 PANEL IS REQUIRED TO USE
              THE TUTORIALS FOR ISPF V2 AS CONJUNCT TO NEW PROGRAM.
./       ADD   NAME=$CDSPARM
TO ASSEMBLE MODULES WITH ASM PARM ARE DEFINED AS FOLLOWING:
1. UNIT NAME FOR CHECKPOINT (HASPCKPT) DSN RESIDES
    SYSPARM=(UNIT=U3350) UNIT 3350
    SYSPARM=(UNIT=U3380) UNIT=3380
    SYSPARM=(UNIT=UNNNN) WHERE NNNN IS UNIT NAME.
2. HASPCKPT VOLUME NAME
    SYSPARM=(CKPT=VVVVVV)
            WHERE VVVVVV IS VOLUME NAME THAT HAVE HASPCKPT
3. RACF OR ACF2 OR TSS (TOP SECRET SYSTEM) INSTALLATION
   SYSPARM=(TSS)    TOP SECRET SYSTEM INTERFACE INSTALLED
   SYSPARM=(NOTSS)  OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
   SYSPARM=(ACF2)   ACF2 INTERFACE INSTALLED
   SYSPARM=(NOACF2) OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
   SYSPARM=(RACF)   IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
   SYSPARM=(NORACF) OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
4. PRE SP 1.3.0 OR NOT
   SYSPARM=(CDSI)   USE DEFAULT PARM SET  YOU SET IN QSTART
   SYSPARM=(NOCDSI) DEFAULT
5. ISPF VERSION TYPE OR TSO  WITHOUT ISPF
   SYSPARM=(ISPF)   ISPF V1R1M0+ SUPPORT
   SYSPARM=(ISPF,ISPF2)  ISPF V2R1M0+ SUPPORT
   SYSPARM=(NOISPF) TSO WITHOUT ISPF INTERFACE
   NOTICE: ENTER ISPF IF YOU USE ISPF INTERFACE NO MATTER ISPF V1 OR V2.
6. EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
    THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED FOR SYS. PGMER.
    TO REMOVE THEM FOR OTHER USERS CAN BE BENEFIT FOR LESS STORAGE.
   SYSPARM=(SYSP)   INCLUDE EXTRA COMMANDS ONLY
   SYSPARM=(NOSYSP) REMOVE EXTRA COMMANDS
7. TO DISPLAY THE USERID AND NAME OF COMMAND ON SYSLOG.
   SYSPARM=(WTO)   TURN ON SYSLOG DISPLAY
   SYSPARM=(NOWTO) TURN OFF SYSLOG DISPLAY
8. PF-KEY OPTIONAL
   SYSPARM=(PFK)     TURN ON PF-KEYS
   SYSPARM=(NOPFK)   TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
9. SP LEVEL OF JES2
   SYSPARM=(SP133)    REQUIRED JES2 BASE FROM SP133 AND UP
   SYSPARM=(NOSP133)  DO NOT REQUIRED SP133 AND UP
   SYSPARM=(SP)       REQUIRE SP MACROS
   SYSPARM=(NOSP)     REQUIRE NON-SP MACROS (OLD MVS/JES2)
10. DO YOU WANT MACRO GENNED AS PRINTED ON ASM SYSOUT?
   SYSPARM=(GEN)      TURN ON ASM MACRO GENNED PRINTING.
   SYSPARM=(NOGEN)    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
11. DO YOU WANT DSECT GENNED AS PRINTED ON ASM SYSOUT?
   SYSPARM=(BGEN)      TURN ON ASM DSECT GENNED PRINTING.
   SYSPARM=(NOBGEN)    TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
12. OTHER OPTIONS (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
   SYSPARM=(JTIP) JTIP PRODUCT INSTALLED
   SYSPARM=(DBC)  DBC PRODUCT INSTALLED
   SYSPARM=(RNB)  ENABLES RNB-SPECIFIED CODE
   SYSPARM=(ONL)  ENABLES ONL-SPECIFIED CODE
   SYSPARM=(NERDC) ENABLES NERDC-SPECIFIED CODE
13. OTHER THAN USING SYSPARM, CODE IN QSTART FOR
   A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
   B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
   C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
   D. ENABLE LOCKHEED SPECIFIC CODE (LOCK)
   E. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
      (Q1CMD DEFAULT IS "STATUS".)
   F. DEFAULT PK DEFINITIONS  (QPF(24)) YOU DEFINE 24 OF THEM IN QSTART.
./       ADD   NAME=$CDSP134
TO ASM AND LINK ISPF QUEUE FOR JES2 1.3.4,
   USE ISPSP134 FOR JCL LISTING

NOTE: TO INDICATE ISPF VERSION SPECIFY ISPF=
   ISPF2 FOR VERSION 2 AND UP
   ISPF1 FOR VERSION 1

TO ASM AND LINK TSO QUEUE FOR JES2 1.3.4,
   USE JCLSP134 FOR JCL LISTING
./       ADD   NAME=$CDSP136
TO ASM AND LINK ISPF QUEUE FOR JES2 1.3.6,
   USE ISPSP136 FOR JCL LISTING

NOTE: TO INDICATE ISPF VERSION SPECIFY ISPF='ISPF,ISPF2' OR 'ISPF,ISPF1'
   ISPF2 FOR VERSION 2 AND UP
   ISPF1 FOR VERSION 1

TO ASM AND LINK STANDALONE TSO QUEUE FOR JES2 1.3.6,
   USE JCLSP136 FOR JCL LISTING
./       ADD   NAME=$CKPTCHG
TO CHANGE SYS1.HASPCKPT VOLUME NAME IN QUEUE SOURCE USE
  JOB  NAMES. IN QASM PROC LINE WHERE YOU SEE CKPT=, MAKE CHANGE
  VOLUME NAME IN IT. (QSTART AND QCOMMON ARE THE SOURCE EFFECTED
    CHANGES OF CKPT AND SYS1.HASPCKPT)

1. ISTCH134   CHANGE CKPT= AND SUBMIT THE JOB FOR QI4T  TESTING
   (ISTCH134 WILL REASM  Q0 (QCOMMON) AND RELINK IT WITH CURRENT OLD
               MODULES. PLEASE TEST QI4T OR ISPF 7.1 PGM=ISPQ134X.)

2. IF QI4T WORKED, THEN DO FOR PRODUCTION
   A. CHANGE CKPT= IN ISPCH134 AND SUBMIT  FOR QI4 CHANGES
   B. CHANGE CKPT= IN JCLCH134 AND SUBMIT  FOR Q4  CHANGES

./       ADD   NAME=$CLDOC
THIS MEMBER ($CLDOC) DOCUMENTS THE CHANGES MADE TO THE QUEUE COMMAND
ON THE SHARE JES2 MODS TAPE.  THE CHANGES WERE MADE BY:

     JOHN KINN
     LOCKHEED, CALIFORNIA COMPANY
     PLANT A-1, BUILDING 67, DEPARTMENT 8321
     P.O. BOX 551
     BURBANK, CALIFORNIA 91520

     PHONE: (818) 847-7492

     SHARE INSTALLATION CODE = CL


CL001 -- USE THE NUMBER OF AVAILABLE TRACK GROUPS FOR ACTIVE SPOOL
         EXTENTS RATHER THAN THE MAXIMUM POSSIBLE IN USE FOR
         PERCENTAGE COMPUTATIONS IN MODULE CTGPS.

CL002 -- MODIFY THE FIND COMMAND TO ALLOW UNQUOTED STRINGS

CL003 -- ALTER THE FTIM COMMAND TO SUPPORT MVS/XA SYSLOG

CL004 -- ADD THE COMMAND JHIS TO THE HELP LIST.

CL005 -- FORMAT THE INFORMATION FOR A JQE IN THE SETUP QUEUE

CL006 -- WHEN QUEUE IS INVOKED, THE DATA SET NAME PREFIX FOR
         THE HASPCKPT AND HASPACE DATA SETS CAN BE SPECIFIED
         VIA THE KEYWORD PREFIX(XXXX).  THE UNIT AND VOLUME SERIAL
         CAN ALSO BE SPECIFIED BY GIVING THE UNIT AND VOL KEYWORDS
         RESPECTIVELY.  THUS THE SYNTAX OF THE INITIAL QUEUE COMMAND
         IS AS FOLLOWS:
           (1) QUEUE
           (2) QUEUE CMD
           (3) QUEUE * PREFIX(XYZ)
           (4) QUEUE CMD PREFIX(XYZ)
           (5) QUEUE * VOL(ABCDEF)
           (6) QUEUE CMD VOL(ABCDEF)
            ETC
         IN (1) THE DEFAULT PREFIX, UNIT, AND VOL (I.E. THE ONES
         ASSEMBLED IN QCOMMON) ARE USED AS WELL AS THE DEFAULT
         INITIAL COMMAND (ASSEMBLED AS HELP).
         IN (2) THE INITIAL COMMAND IS 'CMD' RATHER THAN 'HELP'
         IN (3) THE INITIAL COMMAND IS 'HELP' BUT THE JES2 DATA
         SET PREFIXES ARE CHANGED TO XYZ.
         IN (4) THE INITIAL COMMAND IS 'CMD' AND THE JES2 PREFIX
         IS XYZ.
         IN (5) THE INITIAL COMMAND IS 'HELP' BUT THE VOLUME SERIAL
         FOR THE CHECKPOINT IS CHANGED TO ABCDEF.
         IN (6) THE INITIAL COMMAND IS 'CMD' AND THE CHECKPOINT
         VOLUME SERIAL IS CHANGED TO ABCDEF.

CL007 -- DO NOT DISPLAY PDDB (IN 'ALL' MODE) IF IT IS A
         PLACEHOLDER

CL    -- 1) IOT COMMAND
         2) ALL FUNCTIONS ARE NOW SUPPORTED FOR SYSTEM JQES
               LIST, DJ, SPIN, SAVE, ETC.
         3) NON-CONTIGUOUS SPOOL EXTENTS NOW WORK
./       ADD   NAME=$CLJCL
//J2SP34  JOB  (X3600,42),C.J.KINN,CLASS=I,MSGCLASS=G,
//             NOTIFY=@478939,TYPRUN=XCAN,RESTART=RESTART
//*
/*JOBPARM      ROOM=JES2
//*
//QASM   PROC  M=
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='DECK,RENT,NOLOAD,SYSPARM=(NOACF2,SP133,LOCKHEED)'
//SYSLIB   DD  DSN=JES2.QUEUE.ASM,DISP=SHR        QUEUE MACRO LIBRARY
//         DD  DSN=JES2.SP34.MTS,DISP=SHR         LOCAL MACRO CHANGES
//         DD  DSN=JES2.SP34.SOURCE,DISP=SHR      JES2 MACRO LIB
//         DD  DSN=SYS1.MACLIB,DISP=SHR           SYSTEM MACRO LIBRARY
//         DD  DSN=SYS1.AMODGEN,DISP=SHR          SYSTEM MACRO LIBRARY
//         DD  DSN=JES2.ACF314.MACROS,DISP=SHR    ACF2 MACRO LIBRARY
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSTERM  DD  SYSOUT=A,HOLD=YES
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  DISP=SHR,DSN=JES2.QUEUE.ASM(&M)
//SYSPUNCH DD  DSN=JES2.SP34.PUNCH(&M),DISP=OLD
//*
//PEND   PEND
//*
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0
//ACTIVE   EXEC QASM,M=ACTIVE
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH     EXEC QASM,M=AUTH
//CDIE     EXEC QASM,M=CDIE
//CHCT     EXEC QASM,M=CHCT
//CIOT     EXEC QASM,M=CIOT
//CJCT     EXEC QASM,M=CJCT
//CJHIST   EXEC QASM,M=CJHIST
//CJOE     EXEC QASM,M=CJOE
//CJQE     EXEC QASM,M=CJQE
//CKPT     EXEC QASM,M=CKPT
//CPDDB    EXEC QASM,M=CPDDB
//CPFK     EXEC QASM,M=CPFK
//CSPIN    EXEC QASM,M=CSPIN
//CTGPS    EXEC QASM,M=CTGPS
//CTSO     EXEC QASM,M=CTSO
//DDNAME   EXEC QASM,M=DDNAME
//DISPLAY  EXEC QASM,M=DISPLAY
//FINDJOB  EXEC QASM,M=FINDJOB
//FINDPDDB EXEC QASM,M=FINDPDDB
//FORMAT   EXEC QASM,M=FORMAT
//HELP     EXEC QASM,M=HELP
//HEXBLK   EXEC QASM,M=HEXBLK
//HEXDUMP  EXEC QASM,M=HEXDUMP
//INIT     EXEC QASM,M=INIT
//INITS    EXEC QASM,M=INITS
//JCL      EXEC QASM,M=JCL
//JLOG     EXEC QASM,M=JLOG
//JMSG     EXEC QASM,M=JMSG
//LIST     EXEC QASM,M=LIST
//LISTDS   EXEC QASM,M=LISTDS
//PARSE    EXEC QASM,M=PARSE
//PRINT    EXEC QASM,M=PRINT
//QUEUE    EXEC QASM,M=QUEUE
//READSPC  EXEC QASM,M=READSPC
//REPOS    EXEC QASM,M=REPOS
//SAVE     EXEC QASM,M=SAVE
//SEARCH   EXEC QASM,M=SEARCH
//SYSLOG   EXEC QASM,M=SYSLOG
//SYSOUT   EXEC QASM,M=SYSOUT
//XDS      EXEC QASM,M=XDS
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',
//             COND=(7,LT)
//*YSLMOD  DD  DSN=SYS1.LOCKLIB,DISP=SHR                       CJKAUG84
//SYSLMOD  DD  DSN=JES2.SP34.LINKLIBT,DISP=SHR
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=A,HOLD=YES
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DISP=SHR,DSN=JES2.SP34.PUNCH
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 ENTRY QUEUE
 SETCODE AC(1)
 NAME QUEUE(R)
./       ADD   NAME=$JQT
         MACRO -- JQT -- PHONY DSECT TO DESCRIBE FIRST CKPT REC
         $JQT
JQTDSECT DSECT
         GBLB  &QSP                                               UF020
         GBLB  &QSP136                                            DOR
         AIF   (&QSP).QSP1                                        UF020
JQTOUT   DS    H              HEADER FOR OUTPUT JQES
         DS    7H
JQTSTC   DS    H
JQTTSU   DS    H              HEADER FOR TSO USER JQES
JQTCLSA  DS    H              HEADER FOR CLASS A JQES
JQTQMAX  EQU   46             MAXIMUM NUMBER OF QUEUES
         MEXIT                                                    UF020
.QSP1    ANOP                                                     UF020
JQTOUT   DS    F              HEADER FOR PRINT/PUNCH JQES         RNB19
JQTAWOUT DS    F              HEADER FOR OUTPUT JQES (AWAITING)   RNB19
         AIF (&QSP136).DSP136
JQTDUMP  DS    F              HEADER FOR DUMP JQE'S               RNB19
.DSP136  ANOP
         DS    1A                                                 CL005
JQTSETUP DS    A                   HEADER FOR SETUP JQES          CL005
         DS    2A                                                 CL005
JQTXEQ   DS    F              HEADER FOR XEQ (CONVERSION) JQE'S   RNB19
JQTSTC   DS    F                                                  UF020
JQTTSU   DS    F              HEADER FOR TSO USER JQES            UF020
JQTCLSA  DS    F              HEADER FOR CLASS A JQES             UF020
         AIF (&QSP136).HSP136
JQTQMAX  EQU   48             MAXIMUM NUMBER OF QUEUES            UF020
         MEXIT
.HSP136  ANOP
JQTQMAX  EQU   46             MAXIMUM NUMBER OF QUEUES  SP136 DOR
         MEND
./       ADD   NAME=$LOG

LOG OF MODIFICATIONS AND DISTRIBUTION VERSIONS.


15 NOV 81  CURRENT QUEUE LEVEL - SP
           PLACED ON CBT MODS TAPE VER 182

30 DEC 81  PDDB COMMAND AND FIXES FOR SYSLOG

09 FEB 82  FIX FOR DO/HO COMMAND

10 MAR 82  FIX FOR $MAXNODE
           PLACED ON CBT MODS TAPE VER 190

07 MAY 82  PLACED ON JES2 MODS TAPE VER SP-001

02 JUN 82  2ND PANEL OF HELP GENERATED BLANK SCREEN AT END (Q8)
           CHANGE XI COMMAND TO USE $SVMAXCL (Q23)
           FIX X0C4 IN DC COMMAND (Q24)
           ADD CONDITIONAL ASSEMBLY SWITCH FOR DBC (Q10)

01 JUL 82  CHANGES TO ALLOW ASSEMBLY UNDER ASM FX.

03 JUL 82  PLACED ON JES2 TAPE VER 003.

27 JUL 82  FIX JOEBUSY ERROR IN Q7 (FORMAT).

10 AUG 82  SET &QSP=1 TO GENERATE SP VERSION BY DEFAULT.

11 AUG 82  INCORPORATE RAINIER NATIONAL BANK MODIFICATIONS.
           (SEE MEMBER $RNBDOC).

11 AUG 82  PLACED ON JES2 MODS TAPE SP-004.

22 AUG 82  PLACED ON CBT MODS TAPE V???.

01 SEP 82  ADD Q35 JOB HISTORY COMMAND FROM INTEL.

02 SEP 82  UF031 - CHANGE DISPLAY (Q5) TO NOT SEND X'FF' TO THE TUBE.

08 SEP 82  CHANGE Q35 FOR PROPER REMOTE DEFINITIONS WITH SP2.
           UF032 - ADD NERDC GLOBAL TO ALLOW FOR LOCAL SUPPORT.
           UF033 - CHANGE HELP (Q8) TO PROPERLY GENERATE PLUS SIGNS.

10 SEP 82  PLACED ON JES2 MODS TAPE SP-005.

22 SEP 82  UF034 - CHANGE FINDJOB TO ISSUE ERROR MESSAGE IF USER
                   ATTEMPTS TO USE "*" AND HAS NEVER SET A JOBID.

27 SEP 82  UF035 - CHANGE FINDJOB FOR SYSLOG COMMAND.
                   THE SYSLOG COMMAND MAY NOW HAVE AN OPERAND OF
                       "SYSLOG", OR NULL - EITHER WILL GIVE SYSLOG OF
                       ACTIVE SYSTEM.
                   THE OPERAND MAY ALSO BE THE SMFID OF THE DESIRED
                       SYSTEM.
                   HELP HAS BEEN CHANGED TO INDICATE THIS.
           UF024 - CHANGE Q10 INIT TO HANDLE THE ESTAE CREATION IN A
                   RENT FASHION.

27 SEP 82  PLACED ON JES2 MODS TAPE SP-007.

08 OCT 82  FIXES FROM WALT FARRELL TO CORRECT PROBLEM WITH LINE COUNTS
               FOR JOBS ACTIVE ON REMOTES. (Q7 - RNB28).
           FIX TO Q20 (REALLY PART OF RNB16) TO DELETE LINE ABOVE
               LABEL PRTJOE THAT WAS SETTING JOEJQE TO ZEROS.
               (THE HIGH BYTE IS FLAGS THAT INDICATE IF THE JOB
               IS ACTIVE).

11 OCT 82  PLACED ON JES2 MODS TAPE SP-008.

11 OCT 82  UF036 - SPIN COMMAND PROCESSOR ADDED TO SPIN A COPY OF THE
                   CURRENT DATASET TO SYSOUT.

13 OCT 82  UF037 - SUPPORT FOR 3380.

25 OCT 82  UF038 - ADD TGPS COMMAND TO LIST THE 20 JOBS WITH THE LARGEST
                   NUMBER OF ALLOCATED TRACK GROUPS.
           RENAME MEMBERS OF PDS TO BE THE CSECT NAME INSTEAD OF THOSE
                   SILLY Q NUMBERS.  (IT WAS GETTING TO BE A REAL PAIN).

27 OCT 82  FIX ERROR IN UF035 FINDJOB FOR SYSLOG TESTS.
           UF039 - CHANGE CKPT READ TO USE MULTIPLE DECB'S FOR SPEED.
                   (COMPLETED 11 NOV 82)

11 NOV 82  CHANGE DOCUMENTATION TO REFLECT THE FACT THAT THE MODULES
                   HAVE BEEN RENAMED.
           UF039 - COMPLETED CHANGES FOR CHECKPOINT READ SPEEDUP.
           UF041 - CHANGE TSO COMMAND PROCESSOR FOR TCAM SCREEN CLEAR.

15 NOV 82  CHANGE LISTDS TO PRINT JOBNAME AND DSID PROPERLY IF
                   "L * +" COMMAND IS ISSUED.
           UF043 - ADD PFK COMMAND TO LIST AND CHANGE DEFINITIONS.

06 DEC 82  UF044 - CHANGE READSPC TO ADD ADDITIONAL VALIDITY CHECKS
                   FOR THE PASSED IN VALUE OF MTTR.

16 DEC 82  UF043 - CHANGE HELP FOR PFK COMMAND.

21 DEC 82  NOTE -  IT IS POSSIBLE FOR THE SYSTEM TO GENERATE S0C1
                   OR S0C9 ABENDS DURING THE DD COMMAND.  IF THIS
                   HAPPENS, CHECK THE LINKEDIT TO SEE IF THE LENGTH
                   OF THE FINDPDDB ROUTINE (OR ANY OTHER MODULE) IS
                   ZERO.  IF IT IS, RELINK QUEUE WITH AN EXPLICIT
                   INCLUDE CARD FOR THE MODULE.
                   THE PROBLEM IS THAT SOMEWHERE THERE IS A CSECT CARD
                   WITH THE WRONG NAME ON IT.  IN THIS CASE, MODULE
                   CPDDB HAD A FINDPDDB CSECT CARD IN IT INSTEAD OF THE
                   PROPER ONE (CPDDB).  IT HAS BEEN FIXED AS OF
                   23 DEC 82, BUT THERE ARE PROBABLY OLD VERSIONS OUT
                   THAT STILL HAVE THE PROBLEM.

24 JAN 83  PLACED ON JES2 MODS TAPE SP-009.

15 FEB 83  UF083 - CHANGE TGPS COMMAND TO ALSO LIST THE NUMBER OF JOBS
                   THAT HAVE CERTAIN NUMBERS OF TRACK GROUPS ASSIGNED
                   TO MAKE IT POSSIBLE TO SEE IF THE NUMBER OF BUFFERS
                   IN A TRACK GROUP IS REASONABLE.

20 MAR 83  NOTE -  FOR THE QUEUE COMMAND TO SET QXAUTH BASED UPON
                   THE USER HAVING THE TSO OPER FLAG SET, IT IS
                   NECESSARY FOR THE COMMAND TO BE INVOKED AS A TSO
                   COMMAND, NOT VIA CALL.
                   THIS IS BECAUSE THE CODE ASSUMES THAT UPON ENTRY
                   R1 IS POINTING TO THE CPPL, AND THE CALL ENVIRONMENT
                   DOES NOT SET THINGS UP IN THIS WAY.  NO CHECKING IS
                   DONE TO VERIFY THE ENVIRONMENT UPON ENTRY, OR EVEN
                   IF THE FIELDS POINTED TO BY R1 ARE EVEN IN THE
                   ADDRESSABLE REGION.

29 APR 83  PLACED ON JES2 MODS TAPE SP-011.

09 SEP 83  OAK RIDGE NATIONAL LAB (OR) QAUTH CHECKING MODS ADDED.

09 SEP 83  UF045 - IF MODEL COMMAND IS ISSUED WITHOUT AN OPERAND, AN
                   ABEND S0C7 WILL OCCUR.
                   CODE IS ADDED IN LISTDS TO PREVENT THE ABEND.

18 OCT 83  UF046 - SUPPORT FOR THE SP 1.3.3 LEVEL OF JES2 (HJE2329).

28 MAR 84  OAK RIDGE NATIONAL LAB (OR) FIX FOR DD COMMAND UNDER 1.3.3.

11 APR 84  CHANGE DDNAME COMMAND FOR SP 1.3.0 TO PROPERLY LOCATE THE
           PDDBS IN THE IOT.

20 JUN 84  CHANGES TO ALLOW PRINTING OUTPUT FROM DUMMY JOBS (RMT...)
           AFFECTS FINDJOB AND LISTDS.

29 JUN 84  CHANGE INIT TO INCREASE THE SIZE OF THE TABLE OF LINE
           NUMBERS TO MTTR'S FROM 64K TO 256K TO ALLOW LOOKING AT
           DUMPS WITH MORE THAN 500,000 RECORDS.

31 AUG 84  SUPPORT FOR SP 1.3.4.
           THE ONLY PROBLEM WAS THAT THE $HCT EXPANSION GOT AN
           UNDEFINED SYMBOL FOR $DRAINED, WHICH WAS ADDED TO THE
           3 MODULES THAT NEEDED THE HCT (INIT, CHCT, CTGPS).

10 SEP 84  CHANGE INIT TO FIX A TYPO TO CHANGE 4059 TO 4095.

17 SEP 84  ADD CL MODS TO SUPPORT "SYSTEM" JOBS, THE IOT COMMAND,
           AND REMOVED SPOOL VOLUMES.

09 OCT 84  ADD ADDITIONAL CL MODS AS DESCRIBED IN MEMBER $CLDOC.

25 OCT 84  ADD ADDITIONAL OR MODS AS DESCRIBED IN MEMBER $ONLDOC.

26 OCT 84  PLACED ON JES2 MODS TAPE SP-

./       ADD   NAME=$NERJCL3
//Q3      JOB  ,JACK,CLASS=Z,
//  REGION=2048K,
//  COND=(4,LT),
//  MSGCLASS=T
/*JOBPARM      Q=F,I
//QASM   PROC  M=
//ASM    EXEC  PGM=IEV90,                        (IBM ASSEMBLER H)
// PARM='DECK,RENT,NOLOAD,NODISK,TEST,SYSPARM((SP133,NERDC,))'
//STEPLIB  DD  DISP=SHR,DSN=NER.S685.ASMH.LINKLIB
//SYSLIB   DD  DSN=NER.S685.NEW.QUEUE,DISP=SHR    QUEUE MACRO LIBRARY
//         DD  DSN=JES2.C29.MODMAC,DISP=SHR       LOCAL MACRO CHANGES
//         DD  DSN=JES2.C29.PUT8401.HASPSRC,DISP=SHR JES2 MACRO LIB
//         DD  DSN=SYS1.MACLIB,DISP=SHR           SYSTEM MACRO LIBRARY
//         DD  DSN=MVS.MODGEN,DISP=SHR            SYSTEM MACRO LIBRARY
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSTERM  DD  SYSOUT=T
//SYSPRINT DD  SYSOUT=A
//SYSIN    DD  DISP=SHR,DSN=NER.S685.NEW.QUEUE(&M)
//SYSPUNCH DD  UNIT=VIO3350,SPACE=(CYL,(1,1)),DISP=(,PASS),
//             DCB=(LRECL=80,RECFM=FB,BLKSIZE=3120)
//*
//* IF THE DBCSYMED PROGRAM DOES NOT EXIST ON YOUR SYSTEM, JUST DELETE
//* THE STEP AND CHANGE THE ASSEMBLER SYSPUNCH CARD TO POINT TO THE
//* DATASET REFERENCED BY THE DBCSYMED SYSPUNCH CARD.
//*
//SYMED  EXEC  PGM=DBCSYMED
//STEPLIB  DD  DSN=NER.S685.PGMLIB,DISP=SHR
//SYSPRINT DD  DUMMY
//SYSIN    DD  DSN=*.ASM.SYSPUNCH,DISP=(OLD,DELETE)
//SYSPUNCH DD  DISP=SHR,DSN=NER.S685.QUEUE.OBJECT(&M)
//*
//PEND   PEND
//*
//QCOMMON  EXEC QASM,M=Q0
//ACTIVE   EXEC QASM,M=ACTIVE
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH     EXEC QASM,M=AUTH
//CDIE     EXEC QASM,M=CDIE
//CHCT     EXEC QASM,M=CHCT
//CIOT     EXEC QASM,M=CIOT
//CJCT     EXEC QASM,M=CJCT
//CJHIST   EXEC QASM,M=CJHIST
//CJOE     EXEC QASM,M=CJOE
//CJQE     EXEC QASM,M=CJQE
//CKPT     EXEC QASM,M=CKPT
//CPDDB    EXEC QASM,M=CPDDB
//CPFK     EXEC QASM,M=CPFK
//CSPIN    EXEC QASM,M=CSPIN
//CTGPS    EXEC QASM,M=CTGPS
//CTSO     EXEC QASM,M=CTSO
//DISPLAY  EXEC QASM,M=DISPLAY
//DDNAME   EXEC QASM,M=DDNAME
//FINDJOB  EXEC QASM,M=FINDJOB
//FINDPDDB EXEC QASM,M=FINDPDDB
//FORMAT   EXEC QASM,M=FORMAT
//HELP     EXEC QASM,M=HELP
//HEXBLK   EXEC QASM,M=HEXBLK
//HEXDUMP  EXEC QASM,M=HEXDUMP
//INIT     EXEC QASM,M=INIT
//INITS    EXEC QASM,M=INITS
//JCL      EXEC QASM,M=JCL
//JLOG     EXEC QASM,M=JLOG
//JMSG     EXEC QASM,M=JMSG
//LIST     EXEC QASM,M=LIST
//LISTDS   EXEC QASM,M=LISTDS
//PARSE    EXEC QASM,M=PARSE
//PRINT    EXEC QASM,M=PRINT
//QUEUE    EXEC QASM,M=QUEUE
//READSPC  EXEC QASM,M=READSPC
//REPOS    EXEC QASM,M=REPOS
//SAVE     EXEC QASM,M=SAVE
//SEARCH   EXEC QASM,M=SEARCH
//SYSLOG   EXEC QASM,M=SYSLOG
//SYSOUT   EXEC QASM,M=SYSOUT
//XDS      EXEC QASM,M=XDS
//*
//RESTART  EXEC PGM=IEFBR14
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',
//             COND=(7,LT)
//SYSLMOD  DD  DSN=NER.S685.PGMLIB,DISP=SHR
//SYSUT1   DD  UNIT=VIO3350,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=T
//SYSPRINT DD  SYSOUT=A
//SYSLIB   DD  DISP=SHR,DSN=NER.S685.QUEUE.OBJECT
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 ENTRY QUEUE
 NAME Q3(R)
/*
/*EOF
./       ADD   NAME=$NERJCL4
//Q4      JOB  ,JACK,CLASS=Z,
//  REGION=2048K,
//  COND=(4,LT),
//  MSGCLASS=T
/*JOBPARM      Q=F,I
//QASM   PROC  M=
//ASM    EXEC  PGM=IEV90,                        (IBM ASSEMBLER H)
// PARM='DECK,RENT,NOLOAD,NODISK,TEST,SYSPARM((SP133,NERDC,))'
//STEPLIB  DD  DISP=SHR,DSN=NER.S685.ASMH.LINKLIB
//SYSLIB   DD  DSN=NER.S685.NEW.QUEUE,DISP=SHR    QUEUE MACRO LIBRARY
//         DD  DSN=JES2.C30.MODMAC,DISP=SHR       LOCAL MACRO CHANGES
//         DD  DSN=JES2.C30.SMP.HASPSRC,DISP=SHR  JES2 MACRO LIB
//         DD  DSN=SYS1.MACLIB,DISP=SHR           SYSTEM MACRO LIBRARY
//         DD  DSN=MVS.MODGEN,DISP=SHR            SYSTEM MACRO LIBRARY
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSTERM  DD  SYSOUT=T
//SYSPRINT DD  SYSOUT=A
//SYSIN    DD  DISP=SHR,DSN=NER.S685.NEW.QUEUE(&M)
//SYSPUNCH DD  UNIT=VIO3350,SPACE=(CYL,(1,1)),DISP=(,PASS),
//             DCB=(LRECL=80,RECFM=FB,BLKSIZE=3120)
//*
//* IF THE DBCSYMED PROGRAM DOES NOT EXIST ON YOUR SYSTEM, JUST DELETE
//* THE STEP AND CHANGE THE ASSEMBLER SYSPUNCH CARD TO POINT TO THE
//* DATASET REFERENCED BY THE DBCSYMED SYSPUNCH CARD.
//*
//SYMED  EXEC  PGM=DBCSYMED
//STEPLIB  DD  DSN=NER.S685.PGMLIB,DISP=SHR
//SYSPRINT DD  DUMMY
//SYSIN    DD  DSN=*.ASM.SYSPUNCH,DISP=(OLD,DELETE)
//SYSPUNCH DD  DISP=SHR,DSN=NER.S685.QUEUE.OBJECT(&M)
//*
//PEND   PEND
//*
//QCOMMON  EXEC QASM,M=Q0
//ACTIVE   EXEC QASM,M=ACTIVE
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH     EXEC QASM,M=AUTH
//CDIE     EXEC QASM,M=CDIE
//CHCT     EXEC QASM,M=CHCT
//CIOT     EXEC QASM,M=CIOT
//CJCT     EXEC QASM,M=CJCT
//CJHIST   EXEC QASM,M=CJHIST
//CJOE     EXEC QASM,M=CJOE
//CJQE     EXEC QASM,M=CJQE
//CKPT     EXEC QASM,M=CKPT
//CPDDB    EXEC QASM,M=CPDDB
//CPFK     EXEC QASM,M=CPFK
//CSPIN    EXEC QASM,M=CSPIN
//CTGPS    EXEC QASM,M=CTGPS
//CTSO     EXEC QASM,M=CTSO
//DISPLAY  EXEC QASM,M=DISPLAY
//DDNAME   EXEC QASM,M=DDNAME
//FINDJOB  EXEC QASM,M=FINDJOB
//FINDPDDB EXEC QASM,M=FINDPDDB
//FORMAT   EXEC QASM,M=FORMAT
//HELP     EXEC QASM,M=HELP
//HEXBLK   EXEC QASM,M=HEXBLK
//HEXDUMP  EXEC QASM,M=HEXDUMP
//INIT     EXEC QASM,M=INIT
//INITS    EXEC QASM,M=INITS
//JCL      EXEC QASM,M=JCL
//JLOG     EXEC QASM,M=JLOG
//JMSG     EXEC QASM,M=JMSG
//LIST     EXEC QASM,M=LIST
//LISTDS   EXEC QASM,M=LISTDS
//PARSE    EXEC QASM,M=PARSE
//PRINT    EXEC QASM,M=PRINT
//QUEUE    EXEC QASM,M=QUEUE
//READSPC  EXEC QASM,M=READSPC
//REPOS    EXEC QASM,M=REPOS
//SAVE     EXEC QASM,M=SAVE
//SEARCH   EXEC QASM,M=SEARCH
//SYSLOG   EXEC QASM,M=SYSLOG
//SYSOUT   EXEC QASM,M=SYSOUT
//XDS      EXEC QASM,M=XDS
//*
//RESTART  EXEC PGM=IEFBR14
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',
//             COND=(7,LT)
//SYSLMOD  DD  DSN=NER.S685.PGMLIB,DISP=SHR
//SYSUT1   DD  UNIT=VIO3350,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=T
//SYSPRINT DD  SYSOUT=A
//SYSLIB   DD  DISP=SHR,DSN=NER.S685.QUEUE.OBJECT
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 ENTRY QUEUE
 NAME Q4(R)
/*
/*EOF
./       ADD   NAME=$ONLDOC
THIS MEMBER ($ONLDOC) DOCUMENTS CHANGES MADE TO THE QUEUE COMMAND BY:

     ROBERT M. JINKINS
     OAK RIDGE NATIONAL LABORATORY
     BLDG. 4500-N  MS-259
     P.O. BOX X
     OAK RIDGE, TENNESSEE  37830

     PHONE: (615) 574-7208/5300
             FTS  624-7208/5300

     SHARE INSTALLATION CODE = OR

     LAST UPDATE = MAR 84


ONL01 -- CREATED THE &QBGEN GOBAL SET SYMBOL TO CONTROL THE EXPANSION
         OF JES2 AND SYSTEM CONTROL BLOCK DSECTS SEPARATELY FROM THE
         EXPANSIONS OF MACROS WITHIN THE CODE CONTROLED BY &QGEN.  THE
         QPRBGEN MACRO WAS ALSO CREATED FOR THIS PURPOSE.

ONL02 -- CREATED A COMMAND FUNCTION AUTHORIZATION CSECT (MEMBER AUTH)
         AND A MACRO USED TO REQUEST AUTHORIZATION CHECKING (QAUTHCK).
         ALL CODE CONCERNED WITH WHO USES WHICH QUEUE SUBCOMMAND, AND
         ON WHICH JOBS, HAS BEEN MOVED TO THE AUTH CSECT.  SEE THE
         COMMENTS AT THE BEGINNING OF THE AUTH CSECT FOR ADDITIONAL
         INFORMATION.

         THE HELP CSECT WAS REWRITTEN TO ALLOW CONTROL OVER WHO CAN
         LOOK AT HELP INFORMATION FOR WHICH SUB-COMMANDS.  SEE THE
         COMMENTS AT THE BEGINNING OF THE HELP CSECT FOR ADDITIONAL
         INFORMATION.

         CODE WAS ALSO ADDED TO THE INIT CSECT TO VERIFY A TSO
         ENVIRONMENT AND TO VERIFY SOME FIELDS IN THE COMMAND PROCESSER
         PARAMETER LIST (CPPL).  THIS CODE SUPERCEEDS THE UF010 CHANGE.

         THE FOLLOWING MODS WERE RELOCATED:

              FCI01 (CODE FOR MVS/SP JES2 WAS ALSO ADDED)
              RNB03
              RNB05
              RNB08

              NOTES:
               (1) SOME CHANGES WERE MADE TO THE ABOVE RELOCATED
                   CODE.  HOWEVER, THE OLD PARSE TEXT WAS USED TO
                   AID IN THE IDENTIFICATION OF ALL CODE PERTAINNING
                   TO A GIVEN FUNCTION.
               (2) AS OF JUNE 1983, THE ABOVE RELOCATED CODE HAS
                   NOT BEEN TESTED BY FCI OR RNB.

         THE FOLLOWING MODS WERE SUPERCEEDED:

              RNB02
              UF033

ONL03 -- ENSURED THAT JCT'S AND IOT'S READ FROM THE SPOOL BELONG TO
         THE JOB FOR WHICH THEY WERE READ.

ONL04 -- CHANGED THE LISTDS CSECT TO DISTINGUISH BETWEEN EMPTY AND
         NONEXISTENT DSID'S.  ALSO, SINCE THE DSID FIELD IS OFTEN
         CLEARED BY AUTHORIZATION CHECKING CODE, A SEPERATE FIELD IN
         THE QCOMMON CSECT IS USED TO KEEP TRACK OF THE LAST DSID FOR
         THE "L * +/-" COMMAND.  THE FINDJOB, LIST, AND LISTDS CSECT'S
         USE THE NEW FIELD.

ONL05 -- CHANGED THE JLOG COMMAND TO BETTER DETERMINE IF THERE IS
         A VALID JOB LOG.  THIS SUPERCEEDS THE RNB04 CHANGE.

ONL06 -- USES THE &QONL GOBAL SET SYMBOL TO ALLOW THE GENERATION
         OF ONL'S OWN BRAND OF CONTROL IN THE AUTH CSECT.

ONL07 -- ADDED THE THE FOLLOWING COMMAND ABBREVIATIONS:

            DELE FOR DEL
            CANC FOR CAN

ONL08 -- USES THE &QONL GOBAL SET SYMBOL TO SKIP TESTING A V-TYPE
         ADDRESS CONSTANT BEFORE LOADING QUEUECMN TO PREVENT GETING
         CONDITION CODES ON THE LINK-EDIT.

ONL09 -- ADDED THE &QDSPRFX GOBAL SET SYMBOL TO DEFINE THE FIRST LEVEL
         QUALIFIERS FOR THE HASPCKPT AND HASPACE DATA SET NAMES.  THE
         DEFAULT IS 'SYS1'.  A VALUE OF 'JES2' IS USED IF &QONL IS SET
         TO ONE.

ONL10 -- CHANGED THE "DC" COMMAND TO SUPPORT AN OPERAND OF "J" (JOB)
         IN ADDITION TO "B", "S", AND "T" (BATCH, STC, AND TSU).

ONL11 -- ADDED SP V1.3.3 SUPPORT FOR THE DD COMMAND.

ONL12 -- USES THE &QONL GOBAL SET SYMBOL IN CSECT REPOS TO DO AN
         'OLD TIME' FIND IF THE STRING BEGINS WITH A SLASH ("/").

ONL13 -- QUOTED STRING SPECIFICATIONS FOR THE FIND COMMAND MAY BE
         DELIMITED WITH DOUBLE QUOTES AS WELL AS SINGLE QUOTES.
         THE FIND COMMAND HELP INFORMATION HAS ALSO BEEN UPDATED.

ONL14 -- DEFINED THE QFLG1SDS BIT TO INDICATE WHEN THE CURRENT JOB
         IS A SYSTEM DATA SET JOB AND DOES NOT HAVE A JCT.  THE
         FLAG IS DEFINED IN QCOMMON, SET IN FINDJOB, AND IS TESTED
         BY VARIOUS MODULES.

ONL15 -- ADDED ACF2 SP 1.3.3 SUPPORT TO THE JHIST COMMAND.

ONL16 -- ADJUSTED ALL JCT ADDRESSABILITY BY BUFSTART-BUFDSECT.

ONL17 -- USES THE &QONL GOBAL SET SYMBOL IN CSECT CJHIST TO FORMAT
         INSTALLATION SPECIFIC INFORMATION.

./       ADD   NAME=$QINDEX
         MACRO
         $QINDEX
         TITLE 'HASP JOB QUEUE INDEX TABLE'
***********************************************************************
*                                                                     *
*        $QINDEX IS USED BY THE HASP JOB QUEUE MANAGEMNENT ROUTINES   *
*        TO LOCATE THE OFFSET OF THE JOB QUEUE HEADER (RELATIVE TO    *
*        $JQHEADS-$JQHEADL) BASED UPON THE JQETYPE FIELD.  AN         *
*        OFFSET OF ZERO IS INTERPRETED TO MEAN THAT NO SUCH QUEUE     *
*        HEADER EXISTS.                                               *
*                                                                     *
***********************************************************************
         SPACE 3
QUSTCCL  EQU   X'D0'                 SYSTEM TASK CLASS
QUTSUCL  EQU   X'E0'                 FOREGROUND TIME SHARING CLASS
         SPACE 2
$QUINDEX DC    AL1(4)                                     $PURGE   SPR2
         DC    AL1(8)                                     $HARDCPY SPR2
         DC    AL1(12)                                    $OUTPUT  SPR2
         DC    AL1(16)                                    $DUMPQ   SPR2
         DC    AL1(20,0,0,0)                              $RECEIVE SPR2
         DC    AL1(24),7AL1(0)                            $SETUP   SPR2
         DC    AL1(28),15AL1(0)                           $XMIT    SPR2
         DC    AL1(32),31AL1(0)                           $INPUT   SPR2
         DC    AL1(36)                                    $XEQ     SPR2
         DC    AL1(48,52,56,60,64,68,72,76,80),6AL1(0)    CLASS A-ISPR2
         DC    AL1(40)                                    STC CLASSSPR2
         DC    AL1(84,88,92,96,100,104,108)               CLASS J-PSPR2
         DC    AL1(112,116),6AL1(0)                       CLASS Q-RSPR2
         DC    AL1(44,0)                                  TSU CLASSSPR2
         DC    AL1(120,124,128,132,136,140,144,148)       CLASS S-ZSPR2
         DC    6AL1(0)                                             SPR2
         DC    AL1(152,156,160,164,168,172,176,180,184,188) CLS 0-9SPR2
         DC    6AL1(0)                                             SPR2
         DC    AL1(192),127AL1(0)                       $DUMMY   @133RH
         SPACE 1                                                   SPR2
QUINXJOB EQU   C'A'-(FF-QUECLASS)  OFFSET TO THE BEGINNING $QINDEX SPR2C
                                     ENTRY FOR THE XEQ CLASS QUES  SPR2
QUINXSTC EQU   QUSTCCL-(FF-QUECLASS)   OFFSET TO THE $QINDEX ENTRY SPR2C
                                         FOR THE STC XEQ CLASS QUE SPR2
QUINXTSU EQU   QUTSUCL-(FF-QUECLASS)   OFFSET TO THE $QINDEX ENTRY SPR2C
                                         FOR THE TSU XEQ CLASS QUE SPR2
         MEND
./       ADD   NAME=$RELINK
//RELINK JOB ,JACK,CLASS=9,MSGCLASS=A
/*JOBPARM Q=F,I
//LINK   EXEC  PGM=IEWL,PARM='TEST,LIST,LET,NCAL,XREF,MAP'
//SYSPRINT DD  SYSOUT=A
//SYSUT1   DD  UNIT=VIO3350,SPACE=(CYL,(3,3))
//SYSLMOD  DD  DSN=JES2.C29.LINKLIB,DISP=SHR
//SYSLIB   DD  DSN=NER.S685.PGMLIB,DISP=SHR
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q3)
 ENTRY   QUEUE
 NAME    QUEUE(R)
/*
./       ADD   NAME=$RNBDOC
THIS DATASET WAS OBTAINED FROM FILE 322 ON VER193 OF THE CBT TAPE, AND
WAS THEN MODIFIED AT RAINIER NATIONAL BANK.

RNB00 -                - MOVED DSECTS AROUND FOR IFOX ASSEMBLER
        Q4  (DDNAME)
        Q10 (INIT)
        Q12 (JLOG)
        Q15 (LISTDS)
        Q20 (SEARCH)
        Q25 (FINDPDDB)
        Q26 (SYSOUT)
        Q33 (CPPDB)
RNB01 - Q1  (QUEUE)    - FIX TO FINAL TPUT MESSAGE TO ALLOW TO WORK WITH
                           BOTH TCAM AND VTAM
RNB02 - Q10 (INIT)     - REMOVE PART OF UF010: DON'T USE OPER AUTHORITY
                           TO SET QXAUTH. ALSO UF024: DON'T USE DBC.
RNB03 - Q10 (INIT)     - FOR RACF: IF &QRACF = 1, AND IF &QNEWUSR ISN'T
                           NULL, THEN IF APF-AUTHORIZED CHANGE THE
                           USERID IN THE ACEE SO THE USER CAN ACCESS A
                           RACF-PROTECTED SPOOL/CHECKPOINT DATA SET.
      - Q16 (PARSE)    - IF &QRACF = 1 THEN USE RACF TO CHECK AUTHORITY
                           TO USE THE XP COMMAND.
      - Q17 (READSPC)  - IF &QRACF = 1 THEN WHEN A JCT IS READ FROM THE
                           SPOOL BLANK THE PASSWORD AND NEWPASSWORD.
      - Q22 (XDS)      - IF &QRACF = 1 THEN DO A SPECIAL CHECK TO SEE IF
                           THE USER IF ALLOWED TO DO THE XDS COMMAND.
RNB04 - Q12 (JLOG)     - FIX TO ALLOW JLOG TO WORK FOR JOBS THAT ARE IN
                           EXECUTION BUT THAT HAVEN'T FINISHED THE FIRST
                           STEP. THIS WILL SHOW ONLY THE 'JOB STARTED'
                           MESSAGE.
RNB05 - Q14 (LIST)     - IF &QRNB = 1 THEN DO THE FOLLOWING:
                           (1) REMOVE THE PART OF UF005 THAT ALLOWS L TO
                               PROCESS DSID'S < 101 AND THAT ALLOWS AUTH
                               USERS TO LIST ANY JOB.  THIS REQUIRES THE
                               XD COMMAND TO BE USED TO LIST STRANGE
                               THINGS.
                           (2) ALLOW TSO USERS TO ACCESS ANY JOB THAT
                               STARTS WITH THEIR USERID OR THAT HAS A
                               NOTIFY FOR THEIR USERID. THIS WILL NOT
                               BE ALLOWED FOR USERID'S STARTING WITH
                               'PJS' DUE TO LOCAL RESTRICTIONS.
                           (3) ALLOW TSO USERS WHOSE USERID'S START WITH
                               'TEC' TO PROCESS ANY 'TEC...' JOB OR ANY
                               JOB WITH A NOTIFY FOR A TEC USER. ALSO
                               ALLOW THEM TO PROCESS OUTPUT FROM STARTED
                               TASKS.
RNB06 - Q16 (PARSE)    - ADDED THE FOLLOWING COMMAND ABBREVIATIONS FOR
                           CONSISTENCY WITH PREVIOUS VERSIONS:
                                 JC  FOR JCL
                                 JL  FOR JLOG
                                 JM  FOR JMSG
                                 SL  FOR SLOG
                                 FT  FOR FTIM
                                 DE  FOR DEL
                                 RE  FOR REQ
                         ALSO, IF &QRNB = 1, DELETE COMMANDS TSO, EXEC,
                           AND MODEL.
RNB07 - Q24 (ACTIVE)   - WHEN LISTING BATCH JOBS SAY THEY
                           ARE ON THE XEQ QUEUE INSTEAD OF THE INPUT
                           QUEUE TO BE MORE CONSISTENT WITH WHAT THE
                           OPERATORS USUALLY SEE.
RNB08 - Q26 (SYSOUT)   - IF &QRNB = 1, ALLOW USERS TO MANIPULATE JOBS
                           THAT START WITH THEIR USERID'S OR THAT HAVE
                           A NOTIFY FOR THEIR USERID, UNLESS THE USERID
                           STARTS WITH 'PJS'.
                         IF &QRNB = 1, ALLOW 'TEC' USERS TO MANIPULATE
                           ANY TEC JOB OR STARTED TASK OUTPUT.
RNB09 - Q26 (SYSOUT)   - IF &QRNB = 1, FOR A REQ OPERATION, IF A NEW
                           CLASS IS NOT GIVEN, USE CLASS C AS THE
                           DEFAULT NEW CLASS.
RNB10 - Q27 (PRINT)    - IF &QRNB = 1, USE C AS THE DEFAULT SYSOUT
                           CLASS.
RNB11 - Q4  (DDNAME)   - ALLOW DDNAME COMMAND TO BE
                           ISSUED AS   DDNAME JOBID S
                           WHERE THE S INDICATES THAT THE SPIN DATA
                           SETS SHOULD ALSO BE LISTED. THIS WAS ADDED
                           BECAUSE WE HAVE SOME LONG RUNNING BATCH JOBS
                           (IMS) THAT SPIN THINGS AND THE STANDARD Q
                           COMMAND DOESN'T SEARCH THE SPIN Q FOR BATCH
                           JOBS.
RNB12 - Q4  (DDNAME)   - IF &QSP = 1, DON'T FORMAT THE MESSAGE 'ALREADY
                           PRINTED', AS IT APPEARS THAT THE FLAG BIT
                           IN THE PDDB IS NOT USED ANY MORE, CAUSING
                           ALL SPIN DATA SETS TO APPEAR PRINTED, EVEN
                           WHEN THEY'RE NOT.
RNB13 - Q5  (DISPLAY)  - FIX SOME PROBLEMS WITH TCAM
                           AND THE PROCESSING OF THE TEST-REQUEST,
                           SYSTEM-REQUEST, AND THE PA2/PA3 KEYS.
RNB14 - Q5  (DISPLAY)  - BUG FIX FOR FULL-SCREEN PROCESSING. WITH THIS
                           FIX THE USER CAN ENTER A COMMAND IN EITHER
                           INPUT FIELD, NOT JUST THE BOTTOM ONE.
RNB15 - Q5  (DISPLAY)  - RESTORE THE PFK DEFINITIONS FOR
                           PF7/8 TO '- 27' AND '+ 27' AS ORIGINALLY
                           SUPPLIED BY THE ICBC MOD. WE DON'T HAVE
                           THE OTHER 3278 MODELS, AND SCROLLING IS
                           EASIER THIS WAY. WITH NERDC'S CHANGES TO
                           MAKE THE KEYS 'PB' AND 'PF' IT IS DIFFICULT
                           TO SCROLL UP OR DOWN A FEW LINES.
RNB16 - Q20 (SEARCH)   - PROCESS BOTH THE LOCAL AND REMOTE QUEUES FOR
                           JOBS AWAITING PRINT/PUNCH.
                         ALSO FIX A BUG IN UF020 THAT WAS CLEARING THE
                           JOEFLAG  WHEN JUST THE JOEJQE POINTER SHOULD
                           BE CLEARED.
RNB17 - Q7  (FORMAT)   - WHEN FORMATTING JOES:
                           (1) IF THE JOE IS BEING PROCESSED BY PSO,
                               INDICATE EXT-WTR FOR A DEVICE TYPE.
                           (2) USE $JOEBUSY FLAG TO INDICATE WHETHER JOB
                               IS REALLY PRINTING/PUNCHING. OTHERWISE,
                               AN INTERRUPTED JOB STILL SHOWS AS ON THE
                               PRINTER/PUNCH.
                           (3) FOR SP2, FIX A BUG IN GETTING TO THE
                               CHECKPOINT JOE AND IN COMPUTING THE LINES
                               LEFT TO PRINT/PUNCH.
                           (4) FOR SP2, IF THE JOE IS NOT ACTIVE, BUT
                               THE CHECKPOINT JOE IS VALID, SHOW THE
                               LINES LEFT, NOT THE ORIGINAL LINE COUNT.
RNB18 - Q7  (FORMAT)   - DISTINGUISH BETWEEN JOES WITH REMOTE ROUTING
                           AND THOSE WITH SPECIAL LOCAL ROUTING (DESTID
                           INITIALIZATION STATEMENT IN JES PARMS).
RNB19 - Q20 (SEARCH)   - FOR STATUS OR DJ COMMANDS IN THE SP2 VERSION,
                           ALSO SEARCH THE DUMP Q, THE CONVERSION Q,
                           AND THE OUTPUT Q. THIS ALLOWS THE USER TO
                           FIND HIS JOB IF IT'S AWAITING DUMP, AWAITING
                           CONVERSION, OR AWAITING OUTPUT PROCESSING.
      - Q7  (FORMAT)   - WHEN LISTING JQE'S, DON'T ASSUME INPUT QUEUE
                           BUT USE JQETYPE INSTEAD. ALSO, SPECIAL
                           HANDLING FOR AWAITING CONVERSION, AWAITING
                           DUMP, AND AWAITING OUTPUT.
RNB20 - Q7  (FORMAT)   - DISTINGUISH BETWEEN NORMAL HOLD, HELD VIA $HA,
                           AND DUPLICATE HOLD. ALSO, FOR JOES, IF THE
                           SELECT=NO FLAG IS ON, FLAG WITH S=N TO SHOW
                           WHY THE OUTPUT WON'T PRINT.
RNB21 - Q7  (FORMAT)   - FIX THE SETDEVIC ROUTINE FOR SP2 SO THE PROPER
                           DEVICE NAMES SHOW UP FOR JOBS ON PRINTERS,
                           ETC.
RNB22 - Q6  (FINDJOB)  - IF JOBNAME = *, AFTER READING THE JCT, ENSURE
                           THAT JQEJNAME = JCTJNAME AND THAT QPJOBID =
                           JCTJBKEY IN CASE THE JOB HAS PURGED AND THE
                           JCT HAS BEEN REUSED SINCE WE LAST READ THE
                           CHECKPOINT. THIS IS UNLIKELY, BUT SEEMS TO BE
                           POSSIBLE.
RNB23 - Q8  (HELP)     - MISCELLANEOUS CHANGES TO THE NERDC HELP INFO.
                           THE ORIGINAL NERDC VERSION IS MEMBER $Q8, AND
                           THE OLD RNB MEMBER IS #Q8.
RNB24 - Q23 (INITS)    - BUG FIX, AS SUGGESTED BY JACK SHUDEL
RNB25 - Q7  (FORMAT)   - ADD 'COUNT' OPTION TO THE HO COMMAND TO HELP
                           FIND WHICH JOBS ARE TIEING UP SPOOL SPACE.
                           WHEN THE COUNT OPTION IS USED, THE JCT FOR
                           EACH JQE WITH HELD OUTPUT WILL BE READ AND
                           THE JCT TOTAL LINE COUNT WILL BE DISPLAYED.
RNB26 - Q24 (ACTIVE)   - BUG FIX (SORT OF): THE DC COMMAND WAS SHOWING
                           A LOT OF STRANGE JOBS. THIS FIX MAKES IT MORE
                           REASONABLE, BUT IT'S STILL NOT QUITE RIGHT.
                           ALL OF THE STARTED TASKS, E.G. TCAM, DON'T
                           SHOW UP.

========================================================================
KNOWN PROBLEMS:
  (1) DC S DOESN'T SHOW ALL OF THE STARTED TASKS.
  (2) JOE PRIORITIES ARE (PROBABLY) INCORRECT, AS THE CALCULATIONS
      CHANGED FOR SP2 AND Q HASN'T BEEN UPDATED TO REFLECT THAT.
  (3) IT APPEARS THAT THE LINE COUNTS FOR JOBS ON A REMOTE PRINTER ARE
      MAINTAINED DIFFERENTLY THAT FOR JOBS ON A LOCAL PRINTER. THIS HAS
      NOT BEEN FULLY RESEARCHED YET, BUT IT SEEMS THAT THE LINE COUNT
      REPORTED BY Q FOR A JOB ON A REMOTE PRINTER IS APPROXIMATELY THE
      NUMBER OF LINES PRINTED, NOT THE NUMBER THAT REMAIN TO BE PRINTED.
  (4) ONLY 2 (POSSIBLY 3) CHARACTER REMOTE NUMBERS CAN BE USED.
  (5) NJE NODE NUMBERS ARE IGNORED.
  (6) THE NJE JOB/SYSOUT TRANSMITTERS AND RECEIVERS ARE IGNORED AS
      DEVICES AND AS QUEUES.
./       ADD   NAME=$SP
THE SP VERSION OF THE QUEUE COMMAND IS OBTAINED BY SPECIFYING
"SYSPARM=((SP))" FOR THE ASSEMBLIES (SEE MEMBER $NERJCL2).
MEMBER QSTART CAN ALSO BE UPDATED TO CHANGE THE DEFAULT FLAG SETTING
TO ELIMINATE THE NEED TO SPECIFY ANY SYSPARM AT ALL.

SEE MEMBER $UFDOC FOR A DESCRIPTION OF THE OTHER MODIFICATIONS.

THIS VERSION OF QUEUE WAS DEVELOPED AS IN INTERNAL AID FOR THE DEBUGGING
OF THE NEW JES2 SYSTEM, WHICH NORMALLY RUNS AS A SECONDARY SUBSYSTEM.

THIS VERSION WILL NOT WORK IF ANY OF THE DEFINED SPOOL VOLUMES
ARE NOT AVAILABLE, INCLUDING A SPOOL VOLUME THAT WAS ADDED AND
THEN PURGED AT A LATER TIME.

THERE WAS ONE PROBLEM WITH THE SYSLOG COMMAND CAUSED BY A CHANGE IN
THE WAS THAT SPUN OUTPUT PDDB'S ARE GENERATED.  IT APPEARS THAT A
SPUN SYSOUT WILL NOW HAVE TWO SEPARATE PDDB'S; A NULL ONE IN THE
NORMAL IOT, AND THE TRUE ONE IN A SPIN IOT.  BECAUSE BOTH OF THE
PDDB'S HAVE THE SAME NUMBER, NORMAL QUEUE PROCESSING WOULD LOCATE
THE FIRST ONE, SEE THAT IT WAS NULL, AND INDICATE THAT THE FILE WAS
EMPTY.  CODE HAS BEEN CHANGED IN LISTDS TO CHECK IF THE MTTR FIELD
IS ZERO BEFORE TESTING FOR THE PROPER DATASET ID NUMBER.  ANY PDDB
WITH A ZERO MTTR FIELD WILL BE IGNORED.  THE ONLY POSSIBLE CHANGE
THAT THE USER WILL NOTICE IS THAT THERE WILL BE TIMES WHEN THE OLD
VERSION WOULD INDICATE "DATASET IS EMPTY" WHILE THE NEW VERSION
WILL INDICATE "DATASET ID NOT FOUND".

AT THIS TIME THE FINDPDDB ROUTINE HAS NOT BEEN CHANGED, SO THE
DD COMMAND WILL PROBABLY GIVE SOME INCORRECT INDICATIONS ABOUT
THE STATUS OF SOME SYSOUTS.

A PDDB COMMAND HAS BEEN ADDED THAT WILL DUMP OUT SOME OF THE MORE
RELEVANT INFORMATION ABOUT THE PDDB'S IN GENERAL, OR DUMP OUT
SELECTED ONES IN HEX, TO ASSIST IN FIGURING OUT WHAT IS REALLY
GOING ON.

I WOULD APPRECIATE HEARING FROM ANYONE WHO COMES UP WITH EITHER
ADDITIONAL BUGS OR FIXES TO THE KNOWN ONES.  ALSO, I WILL TRY TO
PASS ON ANY FIXES TO THOSE USERS THAT I AM AWARE OF, SO PLEASE DROP
ME A NOTE IF YOU GET THIS OFF OF ONE OF THE MODS TAPES.

JACK SCHUDEL
NORTHEAST REGIONAL DATA CENTER
233 SSRB, UNIVERSITY OF FLORIDA
GAINESVILLE, FLORIDA  32611
(904) 392-4601
SHARE CODE - UF

./       ADD   NAME=$UFDOC

UF MODIFICATION DESCRIPTIONS


FOR FURTHER INFORMATION ON THESE MODIFICATIONS PLEASE CONTACT:

JACK SCHUDEL
NORTHEAST REGIONAL DATA CENTER
233 SSRB, UNIVERSITY OF FLORIDA
GAINESVILLE, FLORIDA  32611
(904) 392-4601
SHARE CODE - UF


THIS VERSION OF QUEUE WAS DERIVED FROM FILE 278 OF THE CBT MODS TAPE,
WHICH HAD BEEN OBTAINED FROM VERSION 18 OF THE SHARE JES2 PROJECT TAPE.
IT HAS BEEN RUN ON THE FOLLOWING VERSIONS OF JES2 (ASSUMING THAT THE
APPROPRIATE SYSPARM OPTIONS HAVE BEEN SET):
       JES2 4.1
       JES2 NJE 3.1
       MVS/SP-JES2 RELEASE 3

IN THE NERDC ENVIRONMENT, USE OF THE QUEUE COMMAND IS RESTRICTED TO
SYSTEMS PROGRAMMING PERSONNEL INVOLVED IN JES2 MAINTENANCE, AND THERE
HAVE BEEN SEVERAL COMMANDS ADDED FOR THIS USAGE.  AN ATTEMPT HAS BEEN
MADE TO REQUIRE THAT THE COMMANDS THAT ALLOW THE UNRESTRICTED ACCESS
TO SPOOL DATA AND CONTROL BLOCKS BE AVAILABLE TO ONLY AUTHORIZED USERS,
BUT THERE WERE ALSO CHANGES MADE TO ALLOW THOSE AUTHORIZED USERS FULL
ACCESS TO THE SYSTEM WITHOUT HAVING ANY NAMING CONVENTION RESTRICTIONS
IMPOSED UPON THEM.  IT IS THEREFORE NORMAL FOR AN AUTHORIZED USER
TO BE ABLE TO USE THE LIST COMMAND AGAINST ANY JOB IN THE SYSTEM
INSTEAD OF HAVING TO USE THE XD COMMAND.

THE COMMAND ONLY NEEDS TO RUN AUTHORIZED FOR THE FOLLOWING COMMANDS
CANCEL, REQUEUE, AND PURGE. IF YOU DO NOT MARK THE CODE AC=1, THESE
THREE COMMANDS WILL NOT FUNCTION.

INSTALLATION PROCEDURE FOR QUEUE:

     1. Q0 IS THE COMMON AREA.
        QCOMMON, QSTART, QSTOP, QTILT, AND $JQT ARE MACROS.
        OTHER MEMBERS NOT STARTING WITH $ OR # ARE RENT SOURCE MODULES
        (SEE MEMBER $NERJCL FOR A COMPLETE LIST).
        (USERS OF THE OLD QUEUE COMMAND WILL NOTICE THAT ALL OF THE
         Q1 - QNN MODULES HAVE BEEN RENAMED TO MAKE LIFE EASIER ON ME.)
        #HELP IS THE TSO HELP MEMBER.
        $NERJCL IS THE JCL TO ASSEMBLE AND LINK QUEUE.
        TABLE IS A SAMPLE SMP JOB TO AUTHORIZE THE QUEUE COMMAND.

     2. EDIT MEMBER QCOMMON CHANGING THE FOLLOWING PARAMETERS:

        UNIT=XXXX THE DEVICE TYPE FOR SYS1.HASPCKPT.
        VOLSER=YYYYYY THE VOLUME SERIAL FOR SYS1.HASPCKPT.
        SID1-SID7=ZZZZ THE SMF IDS FOR EACH CPU IN THE COMPLEX. THE
        IDS MUST BE IN THE SAME ORDER AS IN THE INITIALIZATION DECK.

        AT PRESENT THERE IS SUPPORT IN THE INITIALIZATION MODULE TO
        DYNAMICALLY ALLOCATE THE CHECKPOINT ON EITHER 3330, 3330-1,
        3350, OR 3380. IF YOU ARE FORTUNATE ENOUGH TO HAVE A DRUM OR
        SOMETHING ELSE YOU WILL HAVE TO MODIFY INIT TO ADD SUPPORT.

        EDIT THE MACRO QSTART TO INDICATE THE OPTIONS DESIRED,
        OR SPECIFY THEM AS SYSPARM INPUT TO THE ASSEMBLER.
        IT WILL BE NECESSARY TO LOOK AT THE MACRO FOR A DESCRIPTION
        OF THE OPTIONS AVAILABLE.

     3. EDIT MEMBER $NERJCL TO CHANGE THE JCL TO FIT YOUR STANDARDS.
        DO NOT ALTER THE ORDER OF THE ASSEMBLY SYSLIBS AS THERE IS A
        CONFLICT ON THE MACRO QSTART.  THE DBCSYMED PROGRAM THAT IS USED
        AFTER THE ASSEMBLIES IS A PART OF THE YALE DBC PROGRAM PRODUCT
        AVAILABLE FROM CSR.  IT EDITS THE GENERATED SYM CARDS IN THE
        OBJECT DECK TO REMOVE NULL ENTRIES AND MOST OF THE DUPLICATE
        ONES.  IF THE PROGRAM IS NOT AVAILABLE, SIMPLY DELETE THE STEP
        AND CHANGE THE ASSEMBLER SYSPUNCH REFERENCE.

        THE SUPPLIED JCL GENERATES A SINGLE LOAD MODULE WHICH IS NOT
        REENTRANT.  THIS IS IDEAL FOR TESTING, BUT MAY NOT BE DESIRED IN
        A PRODUCTION ENVIRONMENT.  TO GENERATE A REENTRANT VERSION OF
        THE COMMAND, LINK ALL MODULES EXCEPT Q0 AS A SINGLE PROGRAM
        NAMED QUEUE (ALIAS Q) INTO SYS1.LPALIB.  IT WILL NEED AN
        AUTHORIZATION CODE OF 1 IF YOU DESIRE TO USE THE CANCEL,
        REQUEUE, AND PURGE COMMANDS.  THE LINKEDIT OF MODULE QUEUE WILL
        GENERATE AN UNRESOLVED EXTERNAL REFERENCE FOR MODULE QUEUECMN,
        WHICH IS NORMAL AND SHOULD BE IGNORED.  MODULE Q0 SHOULD THEN BE
        ASSEMBLED AND LINKED INTO SYS1.LINKLIB OR SYS1.CMDLIB WITH A
        NAME OF QUEUECMN.  IF YOU WANT TO CHANGE THE NAME OF QUEUECMN,
        THE ONLY REFERENCE TO IT IS IN MEMBER INIT WHERE THE LINK IS
        ISSUED.

     4. IF THE CANCEL, REQUEUE, AND PURGE COMMANDS ARE DESIRED, ADD
        QUEUE (ALIAS Q) TO THE IKJEFTE2 MODULE WHICH IS THE TSO LIST
        OF AUTHORIZED COMMANDS. A SAMPLE SMP JOB IS PROVIDED IN THE
        MEMBER TABLE. QUEUE CAN BE RUN UNDER SPF BUT THE SUBCOMMANDS
        USING THE SUBSYSTEM INTERFACE (CANCEL, REQUEUE, AND DELETE)
        WILL BE INOPERABLE, ALL OTHER COMMANDS WILL FUNCTION NORMALLY.
        IF YOU DON'T MIND THE INTEGRITY PROBLEM YOU CAN ADD CODE TO
        QUEUE TO USE A SPECIAL SVC TO GET INTO SUPERVISOR STATE AND
        HAVE FULL FACILITY UNDER SPF.

USERS THAT DO NOT HAVE THE UICC JTIP PACKAGE INSTALLED WILL NEED TO
EITHER CHANGE THE QSTART MACRO OR SPECIFY NOJTIP IN THE ASSEMBLER
SYSPARM OPTIONS.

USERS THAT DO NOT HAVE THE YALE DBC PACKAGE INSTALLED SHOULD
EITHER CHANGE THE QSTART MACRO OR SPECIFY NODBC IN THE ASSEMBLER
SYSPARM OPTIONS.  IF DBC IS SPECIFIED BUT THE PACKAGE DOES NOT
EXIST, ALL THAT WILL HAPPEN IS THAT A MESSAGE WILL FLASH ON THE
USER'S TERMINAL INDICATING THAT THE LOAD FOR MODULE DBC FAILED.
THIS MESSAGE CAN BE IGNORED.

SOME OF THE CODE MAY BE DEPENDENT ON ASSEMBLER H, BUT ALL THAT SHOULD
BE NEEDED IS TO MOVE SOME OF THE DSECTS AROUND TO GET THEM IN THE
PROPER ORDER FOR THE OTHER ASSEMBLERS.

FOR FURTHER INFORMATION ON THE SUPPORT FOR MVS/SP-JES2 RELEASE 2 AND
ABOVE, SEE MEMBER $SP.

TO MAKE IT EASIER TO ENTER CERTAIN COMMANDS, COMMAND NAMES MAY NOW
BE UP TO FOUR CHARACTERS.

MEMBER $LOG IS A CHRONOLOGICAL LIST OF THE CHANGES THAT HAVE BEEN MADE
TO THIS PROGRAM, AND SHOULD BE CONSULTED BY USERS WHO HAVE A PREVIOUS
VERSION AND WANT TO KNOW WHAT HAS BEEN CHANGED.

FOLLOWING IS A LIST OF THE INDIVIDUAL MODIFICATIONS:

UF001  ALLOW QUEUE COMMAND TO ASSEMBLE USING NJE3.1 SOURCE CODE.
       A FEW EQUATES AND ADDITIONAL DSECTS WERE INCLUDED, WHICH SHOULD
       BE OK FOR NON-NJE SOURCE AS WELL.

UF002  ALLOW QCOMMON TO BE LINKED IN FOR TESTING.
       WE RUN WITH SEVERAL DIFFERENT SPOOL PACK FORMATS DURING TEST,
       AND IT IS CONVENIENT TO HAVE MULTIPLE VERSIONS OF QUEUE TO
       SUPPORT THESE DIFFERENT TEST VERSIONS.
       IT IS ALSO MUCH SIMPLER TO RUN UNDER TSO TEST.

UF003  SUPPORT FOR 3278 MODELS 2, 3, 4, AND 5.
       WE HAVE A WIDE ASSORTMENT OF TERMINALS IN-HOUSE, SO QUEUE WAS
       MODIFIED TO SUPPORT ALL TERMINAL TYPES AS BASIC MODEL 2, AND
       TO ALLOW THE USER TO SWITCH TO THE LARGER SCREEN FORMAT AT ANY
       TIME DURING HIS SESSION.
       THIS CODE IS CURRENTLY RUNNING UNDER ACF/VTAM REL 2, BUT WAS
       DEVELOPED UNDER ACF/VTAM REL 1, AND HAS ALSO RUN WITH TCAM AT
       THE 8011 LEVEL.

UF004  ADD A TITLE CARD FOR Q0 (QCOMMON).

UF005  DO NOT CHECK FOR JOBNAME MATCHING TSO LOGON ID IF QXAUTH=1.
       ALSO ALLOW READING DSID'S LESS THAN 101 IF QXAUTH=1.
       DSID'S LESS THAN 101 ARE SOMETIMES USEFUL TO LOOK AT;  THE
       INTERNAL TEXT FILE MAKES IT EASIER TO LOCATE THE PROPER DSID
       IN A SYSGEN WHERE ALL STEPNAMES ARE "ASM", AND IN A VM NETWORK
       ENVIRONMENT IT IS COMMON TO HAVE OUTPUT DSID'S OF 1.

UF006  ONLY READ THE CHECKPOINT IF THE INFORMATION IS NEEDED.
       THE READ OF THE CHECKPOINT IS REMOVED FROM THE MAIN EXECUTION
       LOOP, SINCE IT IS REALLY SILLY TO READ A LARGE CHECKPOINT DATASET
       WHEN THE USER COMMAND IS TO JUST REPOSTITION WITHIN THE CURRENT
       FILE.

UF007  CHANGE COMMANDS "DD *" AND "L * DSID" TO USE THE LAST JOBNAME
       IF A "*" IS SPECIFIED.  THIS MAKES IT EASIER TO TYPE, AND CODE
       IS ADDED TO SKIP THE CHECKPOINT READ FOR PERFORMANCE REASONS.
       IT IS STRONGLY RECOMMENDED THAT THE "*" BE USED INSTEAD OF THE
       JOB NAME/NUMBER SINCE THE RESPONCE TIME IS SO MUCH BETTER.

UF008  HAVE THE FINDPDDB ROUTINE START AT THE FIRST IOT IF PDDB IS NOT
       FOUND.  A MIXTURE OF SPIN AND REGULAR PDDB'S USED TO CAUSE
       THE ROUTINE TO SCAN TO THE END OF THE IOT'S AND STAY THERE WHILE
       TRYING TO LOCATE THE FIRST REGULAR PDDB AFTER A SPUN ONE.

UF009  ADD SYNAD ROUTINE AND ADDITIONAL CHECKING TO READSPC ROUTINE SO
       THAT THE SYSTEM WILL NOT FAIL DURING XB PROCESSING.

UF010  IF USER HAS TSO OPERATOR AUTHORITY, SET FLAG BIT IN QFLAG1,
       AND FORCE QXAUTH ON.

UF011  ADD MODULE HEXDUMP (Q28) WHICH WILL GENERATE AN ABEND FORMAT
       DUMP OF THE DATA PASSED TO IT.

UF012  CHANGE HEXBLK (Q9) TO USE HEXDUMP FOR FORMATTING THE READ
       BUFFER.

UF013  CHANGE HEXBLK (Q9) TO ALLOW ADDITIONAL INPUT PARAMETERS FOR
       DUMPING CURRENT BLOCK, AND OFFSETS INTO THE REQUESTED BLOCK.
       IF THE BLOCK ADDRESS PARAMETER IS "+", THE BUFFER CHAINED FROM
       THE CURRENT BUFFER WILL BE DUMPED.

UF014  CHANGE PARSE (Q16) TO USE 4 CHARACTER COMMAND NAMES, AND
       CHANGE LOGIC FOR DETERMINING IF A COMMAND IN PRIVILEGED.

UF015  ADD MODULE CJQE (Q29) TO DUMP JQE IN HEX.

UF016  ADD MODULE CJCT (Q30) TO DUMP JCT IN HEX WITH OPTIONAL
       OFFSET SPECIFIED.

UF017  ADD MODULE CTSO (Q31) TO ALLOW ANY TSO COMMAND TO BE ISSUED
       WHILE IN QUEUE.

UF018  CHANGE DEFAULT STARTUP COMMAND TO "HELP" SO GET STARTED FASTER.

UF019  ALLOW SYSPARM TO CHANGE &QXXX DEFAULTS.

UF020  SUPPORT FOR SP2 LEVEL OF JES2.
       NOTE: THERE ARE PROBABLY SOME BUGS IN THE DISPLAY COMMANDS AT
             THIS LEVEL.  THEY ARE BEING FIXED AS THEY ARE DISCOVERED,
             BUT SINCE THE NERDC DOES NOT NORMALLY USE THESE COMMANDS,
             IT MAY TAKE SOME TIME TO DISCOVER THE ERRORS.

UF021  SUPPORT FOR SP2 PTF UZ52546 (8110 LEVEL SET).

UF022  ADD MODULE CHCT (Q32) TO DUMP HCT CHECKPOINTED AREA.

UF023  ADD SYMDEL/SYMNODEL STATEMENTS AROUND DSECTS TO REDUCE
       NUMBER OF SYM ENTRIES IN FINAL LOAD MODULE.
       (THE DBCSYMED PROGRAM READS IN THE GENERATED OBJECT
       DECKS AND REMOVES SYM ENTRIES THAT APPEAR BETWEEN
       SYMDEL/SYMNODEL DSECT DEFINITIONS.  THIS CAN CUT THE
       SIZE OF THE FINAL LOAD MODULE BY MORE THAN HALF.)

UF024  ADD DIE COMMAND TO FORCE AN ABEND SO CAN GET BACK INTO THE
       DEBUGGING ENVIRONMENT, AND ESTABLISH ESTAE DURING INIT.

UF025  ADD PDDB COMMAND TO LIST PDDB'S FOR A JOB.  THIS IS USEFUL WHEN
       THE DD COMMAND FAILS FOR SUCH THINGS AS SYSOUT RECEIVED FROM
       OTHER NODES AS WELL AS DURING DEBUGGING OF MISC PROBLEMS.
       IF &QJTIP IS ON, THE PROC, STEP, AND DDNAMES WILL BE FORMATTED.

UF026  ADD JOE COMMAND TO DUMP JOES FOR A JOB.

UF027  FIX XI COMMAND TO PROPERLY LIST ALL INITIATOR CLASSES.

UF028  CHANGE SAVE COMMAND TO ALLOW QPARM3 TO SPECIFY THE VOLSER
       THAT THE DATASET IS TO BE ALLOCATED TO.
       (QPARM2 IS USED TO SPECIFY THE DATASET TYPE.  IT WASN'T
       DOCUMENTED, EITHER.)
       NOW THE COMMAND IS:
         SAVE DSN <DSTYPE> <VOLSER>

UF029  CHANGE Q7 FORMAT TO FIX ERROR IN TESTING FOR JOB ACTIVE ON A
       PRINTER.

UF030  ADD JOB HISTORY COMMAND (Q35).
       THE MODEL FOR THIS COMMAND WAS PROVIDED BY KEN TRUE OF INTEL.

UF031  CHANGE TRANSLATE IN THE DISPLAY (Q5) MODULE TO CHANGE X'FF'
       TO A BLANK.  THIS IS REQUIRED FOR REMOTE 3278'S.

UF032  ADD &QNERDC GLOBAL TO ALLOW FOR LOCAL DEPENDENCIES.
       SO FAR ONLY Q35 JOB HISTORY USES THIS FLAG.

UF033  CHANGE Q8 HELP TO PRINT BLANK LINES TO FORCE THE PLUS SIGN TO
       BE GENERATED AT THE BOTTOM OF EACH PAGE TO INDICATE TO THE USER
       THAT MORE DATA FOLLOWS.  THIS CODE FROM KEN TRUE AT INTEL.

UF034  CHANGE Q6 FINDJOB TO GENERATE ERROR MESSAGE IF A "*" WAS USED
       AS THE JOBID, BUT THE JQE FIELD HAS NOT YET BEEN INITIALIZED.
       THIS IS A PROBLEM FOR USERS WHO DO A STATUS COMMAND, SEE ONLY
       ONE JOB LISTED, AND THEN THINK THAT THEY CAN USE THE "*" TO
       DISPLAY THAT JOB.

UF035  CHANGE Q6 FINDJOB SO THAT IF THE COMMAND WAS SYSLOG THEN
       IF QPARM1 IS NULL OR "SYSLOG" THEN LOCATE THE SYSLOG
          FOR THE ACTIVE SYSTEM.
       IF QPARM1 IS NOT NUMERIC, AND NOT "SYSLOG" THEN IT IS ASSUMED
          TO BE THE SMFID OF THE SYSTEM WHOSE LOG IS DESIRED.
          FOR THIS TO WORK IT IS NECESSARY FOR THE SYSTEM ID'S
          TO BE PROPERLY DEFINED IN QSTART.

UF036  ADD Q36 (SPIN) COMMAND PROCESSOR.
       A NEW COMMAND 'SPIN' WILL CAUSE A COPY OF THE CURRENT DATASET
          TO BE SPUN TO SYSOUT.
       AT THIS TIME, THERE ARE NO OPTIONS FOR THE COMMAND, BUT IT
          WOULD BE NICE TO ADD OPTIONS FOR DEST, SYSOUT CLASS, FORMS,
          AND RANGE OF LINE NUMBERS.
       THIS REQUIRED CHANGES TO ALLOCATE AND QSTART, AS WELL.

UF037  CHANGE Q10 TO ADD SUPPORT FOR 3380.

UF038  ADD TGPS COMMAND TO LIST THE TOP 20 USERS OF SPOOL SPACE.
       THIS IS A VERY USEFUL COMMAND TO USE WHEN YOUR SPOOL VOLUMES
       ARE NEARLY FULL AND YOU WOULD REALLY LIKE TO KNOW WHO HAS ALL
       OF THE SPACE.  OUR EXPERIENCE HAS SHOWN THAT WHEN THE SPOOLS
       GET FULL, THE TOP 20 JOBS (OUT OF OVER 1000) WILL HAVE ABOUT
       30% OF THE TRACK GROUPS.  THIS COMMAND ACTUALLY COUNTS THE TRACK
       GROUPS ASSIGNED TO EACH JOB, BY READING ALL OF THE ALLOCATION
       IOT'S.  BY DOING IT THIS WAY YOU GET THE ACTUAL SPACE USED, AND
       DO NOT GET THROWN OFF BY JOBS THAT WRITE ONE LINE TO EACH OF
       THOUSANDS OF SPUN SYSOUTS.
       *** NOTE ***:  THIS COMMAND DOES AN INCREADIBLE AMOUNT OF I/O AND
       TAKES A LONG TIME TO COMPLETE.  IN OUR ENVIRONMENT, RUNNING ON A
       TEST CPU WHICH FREQUENTLY GETS LOCKED OUT FROM THE SHARED SPOOLS
       BY THE FASTER PRODUCTION MACHINES, IT CAN TAKE AS LONG AS FIVE
       MINUTES FOR THE RESPONCE TO COME BACK, BUT SOMETIMES IT IS THE
       ONLY WAY.
       *** NOTE ***:  THE PERCENT COLUMN INDICATES THE PERCENT OF TRACK
       GROUPS USED OUT OF THE DEFINED NUMBER OF TRACK GROUPS FOR THE
       SYSTEM.  IF YOU HAVE ALLOWED FOR EXTRA SPOOLS, THE NUMBERS WILL
       DISPLAYED WILL BE LOWER THAN ACTUAL.

UF039  CHANGE CHECKPOINT READ TO MULTIPLE DECB'S BASED ON NCP.
       THE IDEA FOR THIS CODE CAME FROM THE UCLA/UOC VERSION OF THE
       QUEUE COMMAND.

UF040  ALLOW +/-NNN TO BE SPECIFIED ON THE LIST * COMMAND.

UF041  CHANGE TSO COMMAND PROCESSOR TO PROPERLY CLEAR SCREEN FOR TCAM.

UF042  ALLOW QCOMMON PARAMETERS TO BE SPECIFIED IN QSTART.
       THIS WILL CAUSE ALL OF THE COMMONLY CHANGED OPTIONS TO BE
       SPECIFIED IN ONLY ONE PLACE.

UF043  MOVE PFK DEFINITIONS TO QCOMMON, AND SET VIA QSTART.
       BY MOVING THE DEFINITIONS TO QCOMMON, IT WILL BE POSSIBLE
       FOR THE MODEL COMMAND TO SET THE PROPER VALUES FOR PFK 7/8,
       THE SCROLL COMMANDS, FOR THE DISPLAY SIZE.

UF044  CHANGE READSPC TO DO FURTHER VALIDITY CHECKING ON THE VALUE
       OF MTTR THAT IS PASSED TO IT.  THIS SHOULD ELIMINATE OCCASIONAL
       S0C4 AND S0C1 ABENDS FROM OCCURRING.

UF046  SUPPORT FOR JES2 AT THE SP 1.3.3 LEVEL (HJE2329).
       THIS SUPPORT IS ENABLED BY SPECIFYING SYSPARM(SP133), OR
       CHANGING THE QSTART MACRO TO DEFAULT &QSP133 TO 1.

UF047  ADD WRITER NAME TO JOE DISPLAY IN FORMAT ROUTINE.

UF048  SUPPORT FOR SP 1.3.4.  (ADD $DRAINED EQUATE FOR HCT EXPANSION).

./       ADD   NAME=$WARN
//*                                                                 *
//*            *******************************************          *
//*            *                                          *         *
//*            * SOME INSTALLATIONS HAVE HAD THE          *         *
//*            * FOLLOWING PROBLEM WITH QUE. IT ASSEMBLES *         *
//*            * FINE BUT IT NEVER PUTS ANYTHING OUT TO   *         *
//*            * THE SCREEN. THE CIRCUMVENTION IS TO GET  *         *
//*            * THE TPUT AND TGET MACROS FROM PUT TAPE   *         *
//*            * 8007. I DO NOT KNOW WHAT THE PTF NUMBERS *         *
//*            * ARE, WHEN I FIND OUT I WILL ADD THEM     *         *
//*            * HERE.                                    *         *
//*            *                                          *         *
//*            ********************************************         *
./       ADD   NAME=$WISHLST

WISH LIST FOR FUTURE WORK.

------------------------------------------------------------------------

FILE FORWARD / FILE BACKWARD COMMANDS.
  L * +/- IS ALMOST IT, BUT WOULD BE EASIER WITH FF/FB

COMMAND TO PRINT CURRENT DATASET WITH OPTIONS FOR DEST/CLASS/FORMS.
  ALSO OPTION TO LIMIT TO RANGE OF LINES.
  SPIN COMMAND COVERS MOST OF IT - JUST NEED TO ADD OPTIONS.

CHANGE PF-KEY DEFINITIONS TO ALLOW FOR 24 KEYS.
  RIGHT NOW THE SYSTEM MAPS 13-24 INTO 1-12, BUT IT MIGHT BE NICE TO
  ALLOW UNIQUE DEFINITIONS FOR 13-24.

PICK UP SYSTEM ID'S FROM QSE'S IF THE FIELDS IN QCOMMON ARE BLANKS.
  THIS WILL ALLOW USERS TO CONTINUE TO SPECIFY "USER FRIENDLY"
  SYSTEM NAMES IF THEY SO DESIRE, BUT THE REST OF US WILL BE ABLE TO
  JUST LET IT RUN WITH THE SMFID'S.  (ONE FEWER THING TO HAVE TO
  MODIFY TO GET THE SYSTEM RUNNING.)

JCLERROR COMMAND THAT LOOKS AT JOB MESSAGES AND LISTS LINES THAT
  START WITH IEF BUT ARE NOT THE IEF MESSAGE FOR SUBSTITUTION JCL.

NOTE:  USERS WITH ACF2 RELEASE 3.1.3 AND JES2 SP1.3 WILL HAVE PROBLEMS
  WITH THE ASSEMBLY FAILING DUE TO MOVED AND DELETED FIELDS IN CONTROL
  BLOCKS.  FOR THE TIME BEING, YOU ARE ON YOUR OWN.  IF YOU GET IT
  TO WORK, PLEASE SEND ME A COPY.

ADD HELPS FOR SYSOUT CANCEL REQUEUE DELETE COMMANDS KEYED OFF OF THE
  AUTHORIZED FLAG FOR THOSE USERS THAT MAY WANT TO USE THEM.

POSSIBLE PERFORMANCE IMPROVEMENT TO USE ACB INTERFACE FOR SPUN OUTPUT
  RATHER THAN DCB.

HAVE INIT CHECK TO SEE IF RUNNING THE RIGHT LEVEL OF THE CODE FOR THE
  VERSION OF JES2 RATHER THAN ABENDING WITH AN 0C4 AT SOME LATER TIME.

PROBLEMS WITH MORE THAN 7 (9) SPOOL VOLUMES?????

TSO COMMAND CAN NOT FIND COMMANDS THAT RESIDE ONLY IN LPA.
  PROBABLY SHOULD USE PLPA SEARCH ROUTINE THEN TRY IDENTIFY WITH ENTRY
  ADDRESS OF ZERO AND NAME OF COMMAND NAME.  RETURN CODE SHOULD BE
  DIFFERENT. IF INVALID ADDRESS, TRY THE BLDL.  IF OTHER RETURN CODE
  IS IN EITHER PLPA OR MLPA, THEN DO ATTACH WITHOUT DE=.
./       ADD   NAME=#FILE53
************************************************************************
*
*         F I L E   5 3   U P D A T E D   Q U E U E
*
************************************************************************

THIS FILE IS IN IEBCOPY UNLOAD FORMAT (80 X 32720).
     THIS VERSION OF THE COMMAND HAS A NUMBER OF ENHANCEMENTS AND
CLEANUP FIXES INSTALLED. THE SUPPORT FOR JES2 PRIOR TO 79/09 WAS REMOVED
AND THE CODE STANDARDIZED ON THE DUPLEX CHECKPOINT LEVEL. A SCREEN PRINT
FACILITY WAS ADDED. THE COMMAND RUNS AUTHORIZED AND NOW HAS SUPPORT FOR
CANCEL, REQUEUE, AND PURGE. THE PDDB SYSOUT COUNTS ARE LISTED ON THE DD
SUBCOMMAND. SUPPORT WAS ADDED TO FIND AND LIST TSO DYNAMICALLY SPUN
SYSOUT.
     THE COMMAND ONLY NEEDS TO RUN AUTHORIZED FOR THE FOLLOWING COMMANDS
CANCEL, REQUEUE, AND PURGE. IF YOU DO NOT MARK THE CODE AC=1, THE
PREVIOUS THREE COMMANDS WILL NOT FUNCTION.

 --- QUEUE COMMAND -----------------------------------------------------

  QUEUE SUBCOMMAND OPERAND        DEFAULT Q STATUS *
  Q                               CAN USE Q CKPT(DEVTYPE,VOLSER) TO GET
                                  NONSTANDARD CHECKPOINT.

 --- SYSTEM DISPLAYS ---------------------------------------------------

DA                  JOBS IN EXECUTION
DT                  DISPLAY TSO USERS
DS                  DISPLAY STARTED TASKS
DC (B/S/T)          DISPLAY CPU BATCH/STC/TSO
STATUS (LEVEL)      JOB STATUS. DEFAULT FOR STATUS IS * (TSO ID).

 --- INPUT QUEUE DISPLAYS ----------------------------------------------

DQ                  DISPLAY INPUT QUEUES
DI (CLASS)          DISPLAY ALL INPUT JOBS
AI (CLASS)          DISPLAY AVAILABLE JOBS
HI (CLASS)          DISPLAY HELD JOBS

 --- OUTPUT QUEUE DISPLAYS----------------------------------------------

DF                  DISPLAY OUTPUT QUEUES
DO (CLASS)          DISPLAY ALL OUTPUT JOBS
AO (CLASS)          DISPLAY AVAILABLE OUTPUT
HO (CLASS)          DISPLAY HELD OUTPUT

 --- JOB MODIFICATION SUBCOMMANDS --------------------------------------

CAN JOBNAME (PURGE) CANCEL FROM INPUT OR EXECUTION. DELETE OUTPUT IF
                     PURGE IS SPECIFIED.
REQ JOBNAME CLASS   CHANGE SYSOUT CLASS
DEL JOBNAME         DELETE HELD OUTPUT

 --- MISC SUBCOMMANDS --------------------------------------------------

SLOG STC# SEQ       LIST SYSTEM LOG.  ST SYSLOG WILL GET STC#. IF SEQ
                     IS NOT SPECIFED ZERO IS ASSUMED (CURRENT).
FTIME HH.MM.SS      POSITION SYSLOG TO TIME
H/HELP              HELP
E/END               EXIT

 --- JOB RELATED SUBCOMMANDS -------------------------------------------

DJ JOBNAME          DISPLAY JOB
JCL JOBNAME         LIST JOB JCL
JLOG JOBNAME        LIST JOB LOG
JMSG JOBNAME        LIST JOB MESSAGES
DD JOBNAME          JES2 DD SUMMARY
LIST JOBNAME DSID   LIST JES2 DATASET. OBTAIN DSID VALUES BY USING THE
                     DD SUBCOMMAND.

 --- LIST RELATED SUBCOMMANDS ---------

FIND 'STRING' COL(SS,EE)  FIND NEXT OCCURANCE OF 'STRING' IN THE DATA.
FALL 'STRING' COL(SS,EE)  FIND ALL OCCURANCES OF 'STRING' IN THE DATA.
                          STRING MUST BE IN QUOTES. COL DEFAULT IS ALL.

COL  #              POSITION TO COLUMN #
@    #              POSITION TO RECORD #
D/+  #              MOVE FORWARD # LINES
UP/- #              MOVE BACKWARD # LINES
TOP                 TOP OF CURRENT DATASET
BOTTOM              BOTTOM OF CURRENT DATASET
HF/HB #             FORWARD/BACKWARD # HALF PAGES
PF/PB #             FORWARD/BACKWARD # PAGES

                    DEFAULT VALUE FOR # IS 1.
                    SYNONYMS L-LIST F-FIND C-COLUMN T-TOP B-BOTTOM

 --------- LOGGING SUBCOMMANDS---------------

SAVE DSNAME TYPE    COPY DATASET
PRINT ON CLASS DEST OPEN SCREEN LOG
                    DEFAULT PRINT CLASS IS SYSOUT=A.
PRINT               PRINT SCREEN
PRINT OFF           CLOSE SCREEN LOG

 -------------------------------
  PF1      PF2      PF3     
    HELP     DA       END      PROGRAM FUNCTION KEY DEFINITIONS
 -------------------------------
  PF4      PF5      PF6        TO SPECIFY OPERANDS FOR PF 5 OR
    PRINT    FIND     DI       OPTIONALLY FOR PF 6,9,12 OR
 -------------------------------   TO OVERRIDE DEFAULTS FOR PF 4,7,8,10,
  PF7      PF8      PF9        KEY IN THE VALUE AND PRESS THE KEY
    - 21     + 21     DO    
 -------------------------------
  PF10     PF11     PF12    
   COL 1    COL 41    ST    
 -------------------------------

 -------------------------- RESTRICTED SUBCOMMANDS ---------------------

XB MTTR             DISPLAY DISK RECORD
XD JOBNAME DSID     LIST ANY DATASET
XI                  DISPLAY ACTIVE INITIATORS
XJ JOBNAME          DISPLAY JQE AND JOES
XP PASSWORD         REQUEST FOR PASSWORD PROMPT. PROMPT IS A BLANK SCREE
                     THE PASSWARD AND IF SUCCESSFUL A MESSAGE WILL BE IS

INSTALLATION PROCEDURE FOR QUEUE:

     1. THERE ARE 36 MEMBERS IN THE DATASET.
        Q0 IS THE COMMON AREA.
        Q1 - Q27 ARE REENTRANT CODE.
        QCOMMON, QSTART, QSTOP, QTILT, AND $JQT ARE MACROS.
        HELP IS A TSO HELP MEMBER.
        ASSEMBLE IS THE JCL TO ASSEMBLE AND LINK QUEUE.
        TABLE IS A SAMPLE SMP JOB TO AUTHORIZE THE QUEUE COMMAND.

     2. EDIT MEMBER QCOMMON CHANGING THE FOLLOWING PARAMETERS:

        UNIT=XXXX THE DEVICE TYPE FOR SYS1.HASPCKPT.
        VOLSER=YYYYYY THE VOLUME SERIAL FOR SYS1.HASPCKPT.
        SID1-SID7=ZZZZ THE SMF IDS FOR EACH CPU IN THE COMPLEX. THE
        IDS MUST BE IN THE SAME ORDER AS IN THE INITIALIZATION DECK.

        AT PRESENT THERE IS SUPPORT IN THE INITIALIZATION MODULE TO
        DYNAMICALLY ALLOCATE THE CHECKPOINT ON EITHER 3330, 3330-1,
        OR 3350. IF YOU ARE FORTUNATE ENOUGH TO HAVE A DRUM YOU
        WILL HAVE TO MODIFY Q10 TO ADD SUPPORT.

        EDIT THE MACRO QSTART TO INDICATE THE OPTIONS DESIRED.

        QPFK SETB 0      NO PFK SUPPORT.
        QPFK SETB 1      PFK SUPPORT (DEFAULT).

        THE PFK SUPPORT IS FROM VILKO MACEK - INSURANCE CORPORATION
        OF BRITISH COLUMBIA. PFK SUPPORT CAN BE IDENTIFIED BY SOURCE
        MARKED WITH ICBC IN MODULES Q5, Q8, AND THE MACRO QCOMMON. TO
        CHANGE THE DEFINITIONS OF THE PFKS SEE THE END OF MODULE Q5.

        QACF2 SETB 0     NO ACF2 SUPPORT (DEFAULT).
        QACF2 SETB 1     ACF2 SUPPORT.

        THE ACF2 SUPPORT IS FROM KEN TRUE - FAIRCHILD CAMERA. KEN ALSO
        SUPPLIED THE ORIGINAL PRINT SUPPORT.

     3. EDIT MEMBER ASSEMBLE TO CHANGE THE JCL TO FIT YOUR STANDARDS.
        DO NOT ALTER THE ORDER OF THE ASSEMBLY SYSLIBS AS THERE IS A
        CONFLICT ON THE MACRO QSTART. THE ASSEMBLIES AND LINKS CREATE
        2 LOAD MODULES.

        QUEUE (ALIAS Q) - IS THE REENTRANT CODE OF THE COMMAND. IT MAY
        BE PLACED IN SYS1.LPALIB OR ANY OTHER AUTHORIZED LIBRARY WITH
        AN AUTHORIZATION CODE OF 1.

        QUEUECMN - THE MODIFIABLE COMMON AREA. CAN BE PLACED IN SYS1.
        LINKLIB OR SYS1.CMDLIB. IF YOU WANT TO CHANGE THE NAME OF
        QUEUECMN LOOK IN MEMBER Q10 WHERE THE LINK IS ISSUED.

     4. ADD QUEUE ALIAS Q TO THE IKJEFTE2 MODULE WHICH IS THE TSO LIST
        OF AUTHORIZED COMMANDS. A SAMPLE SMP JOB IS PROVIDED IN THE
        MEMBER TABLE. QUEUE CAN BE RUN UNDER SPF BUT THE SUBCOMMANDS
        USING THE SUBSYSTEM INTERFACE (CANCEL, REQUEUE, AND DELETE)
        WILL BE INOPERABLE, ALL OTHER COMMANDS WILL FUNCTION NORMALLY.
        IF YOU DON'T MIND THE INTEGRITY PROBLEM YOU CAN ADD CODE TO
        QUEUE TO USE A SPECIAL SVC TO GET INTO SUPERVISOR STATE AND
        HAVE FULL FACILITY UNDER SPF.

NOTE:  THE QUEUE COMMAND WAS WRITTEN FOR JES2 4.1 AT PUT TAPE 79/09
LEVEL WITH THE DUPLEX CHECKPOINT FACILITY (AZ27300). THERE IS NO REASON
THAT THE CONCEPT OF ACCESSING THE CHECKPOINT AND SPOOL WOULD NOT WORK
WITH EARLIER VERSIONS OF JES2 OR WITH NJE. THE LOCATION OF CHECKPOINT
VARIABLES AND CHECKPOINT AND SPOOL STRUCTURE MAY BE DIFFERENT AND THE
USER WILL HAVE TO MAKE APPROPRIATE CHANGES TO SUPPORT OTHER VERSIONS
OF JES2.

./       ADD   NAME=#HELP
)F FUNCTION -
  THE QUEUE COMMAND IS USED TO INTERROGATE THE SYSTEM QUEUES IN ORDER
  TO DETERMINE THE STATUS OF A JOB OR GROUP OF JOBS. IT ALSO PROVIDES
  ACCESS TO ALL PARTS OF A JOB WHILE IT IS ON THE QUEUE.

  FOR MORE INFORMATION, TYPE IN - QUEUE HELP.
)X SYNTAX -
         QUEUE  OPERAND    DEFAULT OPERAND IS STATUS. AN OPERAND OF
         Q                 CKPT(UNIT,VOLSER) CAN BE USED TO SPECIFY
                           A JES2 CHECKPOINT DATASET OTHER THAN THE
                           STANDARD DATASET.

./       ADD   NAME=#TABLE
//COMMANDS EXEC ASMFCL,PARM.LKED='LET,LIST,RENT,REUS'
//ASM.SYSIN DD *
         ENTRY APFCTABL
IKJEFTE2 CSECT
         DC    CL8'IKJEFTE2'
         DC    CL8'06.01.80'
APFCTABL DC    CL8'QUEUE   '       QUEUE COMMAND
         DC    CL8'Q       '       ALIAS
         DC    CL8'CMD1    '       SPARE TABLE ENTRIES
         DC    CL8'CMD2    '       SPARE TABLE ENTRIES
         DC    CL8'CMD3    '       SPARE TABLE ENTRIES
         DC    CL8'        '       8 BLANKS TABLE TERMINATOR
         END
/*
//LKED.SYSLMOD DD DSN=T90000.IPO38.GENLIB(IKJEFTE2),DISP=SHR
//*
//* CHANGE SYSLMOD TO WHATEVER LIBRARY YOU USE TO HOLD SYSTEM MODULES
//*
//TSOCMDS EXEC IPOSMP4
//SMP.SMPCNTL DD *
  RECEIVE S(TR00003).
  APPLY S(TR00003) DIS(WRITE).
/*
//*
//* THE VERIFY CARD BELOW IS SET UP FOR A MVS 3.8 SYSTEM WITH THE
//* TSO COMMAND PACKAGE INSTALLED. IF YOU DON'T HAVE THE COMMAND
//* PACKAGE YOU WILL NEED TO MODIFY THE VERIFY TO MATCH YOUR
//* SYSTEM ENVIRONMENT.
//*
//SMP.SMPPTFIN DD *
++ USERMOD(TR00003) /* TSO AUTHORIZED COMMANDS */.
++ VER(Z038) FMID(EBB1102) PRE(JBB1112).
++ MOD(IKJEFTE2) DISTLIB(AOST4) LKLIB(GENLIB).
/*
//GENLIB DD DSN=T90000.IPO38.GENLIB,DISP=SHR
//*
//* CHANGE GENLIB TO WHATEVER LIBRARY YOU USE TO HOLD SYSTEM MODULES
//*
./       ADD   NAME=@
         MACRO
         @     &LETTERS
.* THIS MACRO IS USEFUL FOR INSERTING INTERESTING BLOCK-LETTER
.* COMMENTS INTO YOUR ASSEMBLY PROGRAM.  TRY IT--YOU'LL LIKE IT.
.**********************************************************************
.*
.* AIR FORCE DATA SERVICES CENTER--SYSTEMS SUPPORT DIRECTORATE
.* ROOM 1D987, THE PENTAGON, WASHINGTON, DC 20330
.* TELEPHONE: (AUTOVON) 225-1274/2478/1889
.*     COMMERCIAL (703) 695-1274/2478/1889
.*
.**********************************************************************
.* DATE INSTALLED: 790523
.**********************************************************
.** => CHANGE LOG: ENTER AUTHOR, DATE, SUMMARY OF CHANGE **
.**********************************************************
.* DATE OF LAST CHANGE:
.*
.**********************************************************************
         LCLC  &A(50)
         LCLC  &B(62),&C(62),&D(62),&E(62),&F(62),&G(62)
         LCLA  &I,&J,&K
&B(01)   SETC  'A'
&B(02)   SETC  'B'
&B(03)   SETC  'C'
&B(04)   SETC  'D'
&B(05)   SETC  'E'
&B(06)   SETC  'F'
&B(07)   SETC  'G'
&B(08)   SETC  'H'
&B(09)   SETC  'I'
&B(10)   SETC  'J'
&B(11)   SETC  'K'
&B(12)   SETC  'L'
&B(13)   SETC  'M'
&B(14)   SETC  'N'
&B(15)   SETC  'O'
&B(16)   SETC  'P'
&B(17)   SETC  'Q'
&B(18)   SETC  'R'
&B(19)   SETC  'S'
&B(20)   SETC  'T'
&B(21)   SETC  'U'
&B(22)   SETC  'V'
&B(23)   SETC  'W'
&B(24)   SETC  'X'
&B(25)   SETC  'Y'
&B(26)   SETC  'Z'
&B(27)   SETC  '#'
&B(28)   SETC  ','
&B(29)   SETC  '$'
&B(30)   SETC  '0'
&B(31)   SETC  '1'
&B(32)   SETC  '2'
&B(33)   SETC  '3'
&B(34)   SETC  '4'
&B(35)   SETC  '5'
&B(36)   SETC  '6'
&B(37)   SETC  '7'
&B(38)   SETC  '8'
&B(39)   SETC  '9'
&B(40)   SETC  '@'
&B(41)   SETC  '%'
&B(42)   SETC  '*'
&B(43)   SETC  '/'
&B(44)   SETC  '-'
&B(45)   SETC  '('
&B(46)   SETC  ')'
&B(47)   SETC  '&&'
&B(48)   SETC  '+'
&B(49)   SETC  '_'
&B(50)   SETC  ''
&B(51)   SETC  ''
&B(52)   SETC  '>'
&B(53)   SETC  ':'
&B(54)   SETC  ';'
&B(55)   SETC  '.'
&B(56)   SETC  '?'
&B(57)   SETC  '"'
&B(58)   SETC  '='
&B(59)   SETC  '!'
&B(60)   SETC  '<'
&B(61)   SETC  '^'
&B(62)   SETC  ' '
&C(01)   SETC  '  A  '
&D(01)   SETC  ' A A '
&E(01)   SETC  'A   A'
&F(01)   SETC  'AAAAA'
&G(01)   SETC  'A   A'
&C(02)   SETC  'BBBB '
&D(02)   SETC  'B   B'
&E(02)   SETC  'BBBB '
&F(02)   SETC  'B   B'
&G(02)   SETC  'BBBB '
&C(03)   SETC  ' CCCC'
&D(03)   SETC  'C    '
&E(03)   SETC  'C    '
&F(03)   SETC  'C    '
&G(03)   SETC  ' CCCC'
&C(04)   SETC  'DDDD '
&D(04)   SETC  'D   D'
&E(04)   SETC  'D   D'
&F(04)   SETC  'D   D'
&G(04)   SETC  'DDDD '
&C(05)   SETC  'EEEEE'
&D(05)   SETC  'E    '
&E(05)   SETC  'EEEE '
&F(05)   SETC  'E    '
&G(05)   SETC  'EEEEE'
&C(06)   SETC  'FFFFF'
&D(06)   SETC  'F    '
&E(06)   SETC  'FFFF '
&F(06)   SETC  'F    '
&G(06)   SETC  'F    '
&C(07)   SETC  ' GGGG'
&D(07)   SETC  'G    '
&E(07)   SETC  'G  GG'
&F(07)   SETC  'G   G'
&G(07)   SETC  ' GGGG'
&C(08)   SETC  'H   H'
&D(08)   SETC  'H   H'
&E(08)   SETC  'HHHHH'
&F(08)   SETC  'H   H'
&G(08)   SETC  'H   H'
&C(09)   SETC  ' III '
&D(09)   SETC  '  I  '
&E(09)   SETC  '  I  '
&F(09)   SETC  '  I  '
&G(09)   SETC  ' III '
&C(10)   SETC  '  JJJ'
&D(10)   SETC  '   J '
&E(10)   SETC  '   J '
&F(10)   SETC  'J  J '
&G(10)   SETC  ' JJ  '
&C(11)   SETC  'K  K '
&D(11)   SETC  'K K  '
&E(11)   SETC  'KK   '
&F(11)   SETC  'K K  '
&G(11)   SETC  'K  K '
&C(12)   SETC  'L    '
&D(12)   SETC  'L    '
&E(12)   SETC  'L    '
&F(12)   SETC  'L    '
&G(12)   SETC  'LLLLL'
&C(13)   SETC  'M   M'
&D(13)   SETC  'MM MM'
&E(13)   SETC  'M M M'
&F(13)   SETC  'M   M'
&G(13)   SETC  'M   M'
&C(14)   SETC  'N   N'
&D(14)   SETC  'NN  N'
&E(14)   SETC  'N N N'
&F(14)   SETC  'N  NN'
&G(14)   SETC  'N   N'
&C(15)   SETC  'OOOOO'
&D(15)   SETC  'O   O'
&E(15)   SETC  'O   O'
&F(15)   SETC  'O   O'
&G(15)   SETC  'OOOOO'
&C(16)   SETC  'PPPP '
&D(16)   SETC  'P   P'
&E(16)   SETC  'PPPP '
&F(16)   SETC  'P    '
&G(16)   SETC  'P    '
&C(17)   SETC  ' QQQ '
&D(17)   SETC  'Q   Q'
&E(17)   SETC  'Q Q Q'
&F(17)   SETC  'Q  Q '
&G(17)   SETC  ' QQ Q'
&C(18)   SETC  'RRRR '
&D(18)   SETC  'R   R'
&E(18)   SETC  'RRRR '
&F(18)   SETC  'R  R '
&G(18)   SETC  'R   R'
&C(19)   SETC  ' SSSS'
&D(19)   SETC  'S    '
&E(19)   SETC  ' SSS '
&F(19)   SETC  '    S'
&G(19)   SETC  'SSSS '
&C(20)   SETC  'TTTTT'
&D(20)   SETC  '  T  '
&E(20)   SETC  '  T  '
&F(20)   SETC  '  T  '
&G(20)   SETC  '  T  '
&C(21)   SETC  'U   U'
&D(21)   SETC  'U   U'
&E(21)   SETC  'U   U'
&F(21)   SETC  'U   U'
&G(21)   SETC  ' UUU '
&C(22)   SETC  'V   V'
&D(22)   SETC  'V   V'
&E(22)   SETC  'V   V'
&F(22)   SETC  ' V V '
&G(22)   SETC  '  V  '
&C(23)   SETC  'W   W'
&D(23)   SETC  'W   W'
&E(23)   SETC  'W W W'
&F(23)   SETC  'WW WW'
&G(23)   SETC  'W   W'
&C(24)   SETC  'X   X'
&D(24)   SETC  ' X X '
&E(24)   SETC  '  X  '
&F(24)   SETC  ' X X '
&G(24)   SETC  'X   X'
&C(25)   SETC  'Y   Y'
&D(25)   SETC  ' Y Y '
&E(25)   SETC  '  Y  '
&F(25)   SETC  '  Y  '
&G(25)   SETC  '  Y  '
&C(26)   SETC  'ZZZZZ'
&D(26)   SETC  '   Z '
&E(26)   SETC  '  Z  '
&F(26)   SETC  ' Z   '
&G(26)   SETC  'ZZZZZ'
&C(27)   SETC  ' # # '
&D(27)   SETC  '#####'
&E(27)   SETC  ' # # '
&F(27)   SETC  '#####'
&G(27)   SETC  ' # # '
&C(28)   SETC  '     '
&D(28)   SETC  '     '
&E(28)   SETC  '     '
&F(28)   SETC  ' ,,  '
&G(28)   SETC  '  ,  '
&C(29)   SETC  ' $$$$'
&D(29)   SETC  '$ $  '
&E(29)   SETC  ' $$$ '
&F(29)   SETC  '  $ $'
&G(29)   SETC  '$$$$ '
&C(30)   SETC  ' 000 '
&D(30)   SETC  '0   0'
&E(30)   SETC  '0   0'
&F(30)   SETC  '0   0'
&G(30)   SETC  ' 000 '
&C(31)   SETC  '  1  '
&D(31)   SETC  ' 11  '
&E(31)   SETC  '  1  '
&F(31)   SETC  '  1  '
&G(31)   SETC  ' 111 '
&C(32)   SETC  '2222 '
&D(32)   SETC  '    2'
&E(32)   SETC  '   2 '
&F(32)   SETC  '  2  '
&G(32)   SETC  '22222'
&C(33)   SETC  '3333 '
&D(33)   SETC  '    3'
&E(33)   SETC  ' 333 '
&F(33)   SETC  '    3'
&G(33)   SETC  '3333 '
&C(34)   SETC  '4  4 '
&D(34)   SETC  '4  4 '
&E(34)   SETC  '44444'
&F(34)   SETC  '   4 '
&G(34)   SETC  '   4 '
&C(35)   SETC  '55555'
&D(35)   SETC  '5    '
&E(35)   SETC  '5555 '
&F(35)   SETC  '    5'
&G(35)   SETC  '5555 '
&C(36)   SETC  ' 666 '
&D(36)   SETC  '6    '
&E(36)   SETC  '6666 '
&F(36)   SETC  '6   6'
&G(36)   SETC  ' 666 '
&C(37)   SETC  '77777'
&D(37)   SETC  '   7 '
&E(37)   SETC  '  7  '
&F(37)   SETC  '  7  '
&G(37)   SETC  '  7  '
&C(38)   SETC  ' 888 '
&D(38)   SETC  '8   8'
&E(38)   SETC  ' 888 '
&F(38)   SETC  '8   8'
&G(38)   SETC  ' 888 '
&C(39)   SETC  ' 999 '
&D(39)   SETC  '9   9'
&E(39)   SETC  ' 9999'
&F(39)   SETC  '    9'
&G(39)   SETC  ' 999 '
&C(40)   SETC  '@@@@ '
&D(40)   SETC  '    @'
&E(40)   SETC  '@@@ @'
&F(40)   SETC  '@ @ @'
&G(40)   SETC  '@@@@ '
&C(41)   SETC  '%%  %'
&D(41)   SETC  '   % '
&E(41)   SETC  '  %  '
&F(41)   SETC  ' %   '
&G(41)   SETC  '%  %%'
&C(42)   SETC  '* * *'
&D(42)   SETC  ' *** '
&E(42)   SETC  '*****'
&F(42)   SETC  ' *** '
&G(42)   SETC  '* * *'
&C(43)   SETC  '    /'
&D(43)   SETC  '   / '
&E(43)   SETC  '  /  '
&F(43)   SETC  ' /   '
&G(43)   SETC  '/    '
&C(44)   SETC  '     '
&D(44)   SETC  '     '
&E(44)   SETC  '-----'
&F(44)   SETC  '     '
&G(44)   SETC  '     '
&C(45)   SETC  '   ( '
&D(45)   SETC  '  (  '
&E(45)   SETC  '  (  '
&F(45)   SETC  '  (  '
&G(45)   SETC  '   ( '
&C(46)   SETC  ' )   '
&D(46)   SETC  '  )  '
&E(46)   SETC  '  )  '
&F(46)   SETC  '  )  '
&G(46)   SETC  ' )   '
&C(47)   SETC  ' &&&&&& '
&D(47)   SETC  '&&    '
&E(47)   SETC  ' &&&&  '
&F(47)   SETC  '&&   &&'
&G(47)   SETC  ' &&&&&&&&'
&C(48)   SETC  '  +  '
&D(48)   SETC  '  +  '
&E(48)   SETC  '+++++'
&F(48)   SETC  '  +  '
&G(48)   SETC  '  +  '
&C(49)   SETC  '     '
&D(49)   SETC  '     '
&E(49)   SETC  '     '
&F(49)   SETC  '     '
&G(49)   SETC  '_____'
&C(50)   SETC  '  *  '
&D(50)   SETC  ' C*C '
&E(50)   SETC  'C *  '
&F(50)   SETC  ' C*C '
&G(50)   SETC  '  *  '
&C(51)   SETC  '    '
&D(51)   SETC  '    '
&E(51)   SETC  '    '
&F(51)   SETC  '    '
&G(51)   SETC  '    '
&C(52)   SETC  ' >   '
&D(52)   SETC  '  >  '
&E(52)   SETC  '   > '
&F(52)   SETC  '  >  '
&G(52)   SETC  ' >   '
&C(53)   SETC  ' ..  '
&D(53)   SETC  ' ..  '
&E(53)   SETC  '     '
&F(53)   SETC  ' ..  '
&G(53)   SETC  ' ..  '
&C(54)   SETC  ' ..  '
&D(54)   SETC  ' ..  '
&E(54)   SETC  '     '
&F(54)   SETC  ' ,,  '
&G(54)   SETC  '  ,  '
&C(55)   SETC  '     '
&D(55)   SETC  '     '
&E(55)   SETC  '     '
&F(55)   SETC  ' ..  '
&G(55)   SETC  ' ..  '
&C(56)   SETC  ' ??? '
&D(56)   SETC  '?   ?'
&E(56)   SETC  '   ? '
&F(56)   SETC  '  ?  '
&G(56)   SETC  '  ?  '
&C(57)   SETC  ' '' '' '
&D(57)   SETC  '     '
&E(57)   SETC  '     '
&F(57)   SETC  '     '
&G(57)   SETC  '     '
&C(58)   SETC  '     '
&D(58)   SETC  '====='
&E(58)   SETC  '     '
&F(58)   SETC  '====='
&G(58)   SETC  '     '
&C(59)   SETC  '   '
&D(59)   SETC  '   '
&E(59)   SETC  '   '
&F(59)   SETC  '     '
&G(59)   SETC  ' ..  '
&C(60)   SETC  '   < '
&D(60)   SETC  '  <  '
&E(60)   SETC  ' <   '
&F(60)   SETC  '  <  '
&G(60)   SETC  '   < '
&C(61)   SETC  '     '
&D(61)   SETC  '     '
&E(61)   SETC  '^^^^^'
&F(61)   SETC  '    ^'
&G(61)   SETC  '     '
&C(62)   SETC  '     '
&D(62)   SETC  '     '
&E(62)   SETC  '     '
&F(62)   SETC  '     '
&G(62)   SETC  '     '
&J       SETA  1
&K       SETA  1
         AIF   ('&LETTERS'(1,1) NE '''').JLOOP
.LLOOP   ANOP
&J       SETA  &J+1
.JLOOP   AIF   (K'&LETTERS LT &J).END
         AIF   (K'&LETTERS EQ &J AND '&LETTERS'(&J,1) EQ '''').END
&I       SETA  1
.COMP    AIF   ('&B(&I)' EQ '&LETTERS'(&J,1)).FND
&I       SETA  &I+1
         AIF   (&I LT 62).COMP
.FND     ANOP
&A(&K)   SETC  '&C(&I)'
&A(&K+1) SETC  '&D(&I)'
&A(&K+2) SETC  '&E(&I)'
&A(&K+3) SETC  '&F(&I)'
&A(&K+4) SETC  '&G(&I)'
&K       SETA  &K+5
         AIF   (&K LT 51).LLOOP
.END     ANOP
         SPACE 2
         MNOTE *,'******************************************************
               ****************'
         MNOTE *,' '
&I       SETA  1
.REDO    MNOTE *,' &A(&I)  &A(&I+5)  &A(&I+10)  &A(&I+15)  &A(&I+20)  &*
               A(&I+25)  &A(&I+30)  &A(&I+35)  &A(&I+40)  &A(&I+45)'
&I       SETA  &I+1
         AIF   (&I LT 6).REDO
         MNOTE *,' '
         MNOTE *,'******************************************************
               ****************'
         MEXIT
         SPACE 4
         MEND
./       ADD   NAME=@COMPLIB
//SICQ    JOB ,JACK,CLASS=Z
/*JOBPARM Q=F,I,CARDS=9999999
/*ROUTE  PUNCH X10 SIC
//COMP   PROC  PRE='NER.S685.',D=
//COMP   EXEC  PGM=COMPLIB
//SYSPRINT DD  SYSOUT=A
//SYSLIB   DD  DSN=&PRE.&D,DISP=SHR
//SYSUT2   DD  SYSOUT=B,HOLD=YES
//SYSIN    DD  DSN=*.SYSIN.SYSUT2,DISP=(OLD,PASS)
//PEND   PEND
//SYSIN  EXEC  PGM=IEBGENER
//SYSPRINT DD  DUMMY
//SYSIN    DD  DUMMY
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,1),DISP=(,PASS),
//             DCB=(LRECL=80,RECFM=FB,BLKSIZE=800)
//SYSUT1   DD  *
++SETLIB FLAGS=IEBUPDTE
++INCLUDE LIBRARY=ALL
/*
//QUEUE  EXEC  COMP,D='NEW.QUEUE'
./       ADD   NAME=ACTIVE
ACTIVE   QSTART HASPEQU=YES,       START ACTIVE CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - LIST ACTIVE JOB STATUS'
******************************************************************
* RNB CHANGES:                                                   *
*       (1) RNB07 - WHEN LISTING BATCH JOBS, SAY THEY            *
*                   ARE ON THE XEQ QUEUE INSTEAD OF INPUT QUEUE. *
*       (1) RNB26 - BUG FIX TO STOP LISTING A LOT OF STRANGE JOBS*
******************************************************************
         GBLB  &QSP           MVS/SP OPTION                       UF020
         GBLB  &QSP133        MVS/SP 1.3.3 OPTION                 UF046
         GBLB  &QSP136        MVS/SP 1.3.6 OPTION                 UF046
         USING QCKPT,R9       BASE REG FOR CHECKPOINT AREA
         L     R9,QVCKPT      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
******************************************************************UF006
*                                                                 UF006
*   CALL - READ JES2 CHECKPOINT ROUTINE                           UF006
*                                                                 UF006
******************************************************************UF006
CALLCKPT L     R15,=V(CKPT)   ADDR OF CKPT ROUTINE                UF006
         BALR  R14,R15        GO TO IT                            UF006
         L     R8,16          POINT TO CVT
         USING CVTDSECT,R8
***********************************************************************
*                                                                     *
*        FIND THE ACTIVE MAIN SUBSYSTEM SSVT                          *
*                                                                     *
***********************************************************************
         L     R7,CVTASVT     POINT TO ASVT
         L     R2,CVTMSER     POINT TO ASVT
         USING ASVT,R7
         L     R7,ASVTMAXU    LOAD THE MAX ASCBS
         DROP  R7
         L     R8,CVTJESCT    POINT TO JESCT
         DROP  R8
         USING JESCT,R8
         L     R8,JESSSCT     POINT TO SSCT
         DROP  R8
         USING SSCT,R8
         L     R8,SSCTSSVT    POINT TO SSVT
         DROP  R8
         USING SSVT,R8
***********************************************************************
*                                                                     *
*        FIND THE ACTIVE MAIN SUBSYSTEM'S HAVT                        *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A
         L     R6,SVTHAVT     POINT TO HAVT
         AGO   .X136A
.NO136A  ANOP
         L     R6,$SVHAVT     POINT TO HAVT
.X136A   ANOP
         LTR   R6,R6          TEST IF ANY PITS
         BZ    NOHAVT         NO, IGNORE COMMAND
         LA    R6,4(,R6)      POINT TO FIRST SJB POINTER
         AIF   (NOT &QSP136).NO136B
         USING SJB,R5
         AGO   .X136B
.NO136B  ANOP
         USING SJBDSECT,R5
.X136B   ANOP
         MVC   QDHLINE,INITHD MOVE IN THE HEADING
***********************************************************************
*                                                                     *
*        BUILD THE MESSAGE(S) DESCRIBING THE JOBS                     *
*                                                                     *
***********************************************************************
BLDMSG   MVC   QDMSG,QBLANK   BLANK THE AREA
         L     R5,0(,R6)      POINT TO SJB
         LTR   R5,R5          TEST FOR ANY
         BZ    NEXTSJB
         L     R4,SJBSJB      TEST FOR BATCH JOB
         LTR   R4,R4          IS IT
         BNZ   BATCHCHK
         L     R3,SJBJQOFF    LOAD JQE OFFSET
         LTR   R3,R3          ANY JQE?                            RNB26
         BZ    NEXTSJB        /NO  - TRY NEXT SJB                 RNB26
         AL    R3,QCJQTA      ADD TO JQE ORIGIN
         AIF   (NOT &QSP136).NO136                                UF046
         USING JQE,R3    BASE REG FOR JQE
         AGO   .X136
.NO136   ANOP
         USING JQEDSECT,R3    BASE REG FOR JQE
.X136    ANOP
         AIF   (&QSP).QSP1                                        UF020
         LH    R0,JQEJOBNO    GET JOB NO.
         CH    R0,=H'20000'   TSO USER?
         BNL   TSOCHK         YES. GO PROCESS
         B     STCCHK         NO. GO PROCESS AS STC
         AGO   .QSP2                                              UF020
.QSP1    ANOP                                                     UF020
         AIF   (NOT &QSP136).NO136C DOR
         TM    JQEFLAG3,JQE3JOB BATCH JOB?  (SHOULDN'T BE)        DOR
         BO    UNK              /YES - SAY UNKNOWN                DOR
         TM    JQEFLAG3,JQE3TSU TSO USER?                         DOR
         BO    TSOCHK         YES, GO PROCESS                     DOR
         TM    JQEFLAG3,JQE3STC STARTED TASK?                     DOR
         BO    STCCHK         YES, GO PROCESS                     DOR
         AGO   .X136C DOR
.NO136C  ANOP DOR
         TM    JQEFLAG3,QUEJOB  BATCH JOB?  (SHOULDN'T BE)        RNB26
         BO    UNK              /YES - SAY UNKNOWN                RNB26
         TM    JQEFLAG3,QUETSU  TSO USER?                         UF020
         BO    TSOCHK         YES, GO PROCESS                     UF020
         TM    JQEFLAG3,QUESTC  STARTED TASK?                     UF020
         BO    STCCHK         YES, GO PROCESS                     UF020
.X136C   ANOP DOR
UNK      MVC   QUEUE,=CL8'UNKNOWN'                                UF020
         B     NOTTSO         PRINT WHATEVER WE CAN FIND          UF020
.QSP2    ANOP                                                     UF020
BATCHCHK CLI   QPARM1,C'B'    BATCH DISPLAY ONLY ?
         BE    BATCHMSG       YES. GO PROCESS
         CLI   QPARM1,C'J'    BATCH DISPLAY ONLY ?                ONL10
         BE    BATCHMSG       YES. GO PROCESS                     ONL10
         CLI   QPARM1,C' '    DISPLAY EVERYTHING ?
         BNE   NEXTSJB        NO. GET NEXT SJB
BATCHMSG LR    R5,R4          COPY THE SJB ADDRESS
         L     R3,SJBJQOFF    POINT TO JQE OFFSET
         LTR   R3,R3          ANY JQE?                            RNB26
         BZ    NEXTSJB        /NO  - TRY NEXT SJB                 RNB26
         AL    R3,QCJQTA      POINT TO THE JQE
         IC    R0,JQETYPE     GET THE JOB TYPE
         MVC   QUEUE,=CL8'   XEQ'                                 RNB07
         STC   R0,QUEUE+7     SET THE QUEUE TYPE
         OI    QUEUE+7,X'80'  SET THE PRINTABLE QUEUE TYPE
         B     NOTTSO         GO TO COMMON ROUTINE
TSOCHK   CLI   QPARM1,C'T'    TSO DISPLAY ONLY ?
         BE    TSOMSG         YES. GO PROCESS
         CLI   QPARM1,C' '    DISPLAY EVERYTHING ?
         BNE   NEXTSJB        NO. GET NEXT SJB ?
TSOMSG   MVC   QUEUE,=CL8'TSO USER'
         B     NOTTSO
STCCHK   CLI   QPARM1,C'S'    STC DISPLAY ONLY ?
         BE    STCMSG         YES. GO PROCESS.
         CLI   QPARM1,C' '    DISPLAY EVERYTHING ?
         BNE   NEXTSJB        NO. GET NEXT SJB.
STCMSG   MVC   QUEUE,=CL8'SYSTEM Q'
NOTTSO   L     R1,SJBASCBP    POINT TO ASCB
         USING ASCB,R1
         LM    R14,R15,ASCBEJST GET THE CPU TIME
         SRDL  R14,12         SKIP THE GARBAGE
         D     R14,=F'10000'  GET THE VALUE IN .01 SECS
         CVD   R15,CONVERT    GET THE DECIMAL VALUE
         MVC   TCBTIME,EDCPU  MOVE EDIT MASK
         ED    TCBTIME,CONVERT+4 EDIT THE NUMBER
         MVI   TCBTIME+L'TCBTIME-1,C'S' SET SECONDS
         LM    R14,R15,ASCBSRBT GET THE CPU TIME
         SRDL  R14,12         SKIP THE GARBAGE
         D     R14,=F'10000'  GET THE VALUE IN .01 SECS
         CVD   R15,CONVERT    GET THE DECIMAL VALUE
         MVC   SRBTIME,EDCPU  MOVE EDIT MASK
         ED    SRBTIME,CONVERT+4 EDIT THE NUMBER
         MVI   SRBTIME+L'SRBTIME-1,C'S' SET SECONDS
         MVC   JOBNAME,SJBJOBNM MOVE IN JOBNAME
         LH    R14,JQEJOBNO   LOAD JOB NUMBER
         CVD   R14,CONVERT    GET THE DECIMAL VALUE
         MVC   JOBNUM,ED5     GET THE CHARACTER VALUE
         ED    JOBNUM,CONVERT+5 GET THE CHARACTER VALUE
         LR    R4,R2          COPY THE ADDRESS
FINDCSCB ICM   R4,15,0(R4)    POINT TO THE NEXT CSCB
         BZ    NEXTSJB
         USING CSCDSECT,R4
         CLC   CHKEY,JQEJNAME TEST FOR RIGHT JOB
         BNE   FINDCSCB       NOPE
         MVC   STEPNAME,CHSTEP MOVE IN STEPNAME
         MVC   PROCSTEP,CHPROCSN MOVE IN THE PROCSTEP NAME
         DROP  R4
NOCSCB   LH    R0,ASCBFMCT    GET NUMBER OF SLOTS
         SLL   R0,2           GET NUMBER OF K
         CVD   R0,CONVERT     GET THE DECIMAL VALUE
         MVC   SLOTS,ED5      MOVE EDIT MASK
         ED    SLOTS,CONVERT+5 GET THE K
         MVI   SLOTS+L'SLOTS-1,C'K' SET THE 'K'
         MVC   QDMLNG,=H'80'  SET THE LENGTH
         LA    R0,QDMSG       GET THE ADDRESS
         ST    R0,QDMSGA      SET THE ADDRESS
         L     R15,=V(DISPLAY) POINT TO THE ROUTINE
         BALR  R14,R15        CALL THE ROUTINE
***********************************************************************
*                                                                     *
*        SEND THE MESSAGE DESCRIBING THE PIT                          *
*                                                                     *
***********************************************************************
NEXTSJB  LA    R6,4(,R6)      POINT TO NEXT HAVT POINTER
         DROP  R1,R5
         BCT   R7,BLDMSG      TEST FOR NEXT HAVT POINTER
***********************************************************************
*                                                                     *
*        END IT ALL                                                   *
*                                                                     *
***********************************************************************
END      QSTOP
NOHAVT   QTILT '***** NO JOBS TO DISPLAY *****'
INITHD   DC    CL80'  QUEUE  JOBNAME   JOB#  STEPNAME PROCSTEP   SLOTS *
                  TCB-TIME    SRB-TIME'
ED5      DC    X'402020202120'
EDCPU    DC    X'4020206B2021204B2020'
         LTORG
***********************************************************************
*                                                                     *
*        DESCRIBE ALL THE DSECTS NEEDED BY THIS MODULE                *
*                                                                     *
***********************************************************************
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
ACTIVE   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         CVT   PREFIX=NO,DSECT=YES                                UF046
CVTDSECT EQU   CVT                                                UF046
         IEFJESCT TYPE=DSECT                                      UF046
         IEFJSCVT ,                                               UF046
         IHAASVT DSECT=YES                                        UF046
         IHAASCB DSECT=YES                                        UF046
CSCDSECT DSECT ,                                                  UF046
         IEECHAIN ,                                               UF046
         IEZDEB ,                                                 UF046
         AIF   (NOT &QSP133).NO133                                UF046
         $XECB ,                                                  UF046
.NO133   ANOP  ,                                                  UF046
ACTIVE   CSECT                                                    UF046
         $TQE                                                    DOR
         $SCAT                                                   UF046
         $SVT
         $SJB
         $JQE
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
QUEUE    DS    CL8
         DS    C
JOBNAME  DS    CL8
         DS    C
JOBNUM   DS    CL6
         DS    C
STEPNAME DS    CL8
         DS    C
PROCSTEP DS    CL8
         DS    C
SLOTS    DS    CL7
         DS    C
TCBTIME  DS    CL11
         DS    C
SRBTIME  DS    CL11
         DS    C
WORK     DSECT
         DS    CL72
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=ACTMON
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/02/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
ACTMON  TITLE 'QUEUE COMMAND - ACTIVITY MONITOR'
ACTMON  QSTART ,                  START ACTMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   - OUXB
*    R3   -
*    R4   - ASCB
*    R5   - ASCB
*    R6   - CSCB
*    R7   - OUCB
*    R8   -  JOBTABLE
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       IEEZA03D -       ##A  ACTIVITY MONITOR                    ***
***       VERSION -        1.0                                      ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***       UPDATED -        12/01/79                                 ***
***********************************************************************
*        CLI   TRACESWT,X'FF'
*        BE    TRACEOK
*        CALL TRACE
*        MVI   TRACESWT,X'FF'
TRACEOK  EQU    *
         MVI   TSOSW,C' '
         XC    JOBTOT1(48),JOBTOT1
         XC    DMNTAB(200),DMNTAB
         MVC   DMNTAB+200(200),DMNTAB
         MVC   DMNTAB+400(200),DMNTAB
         MVC   DMNTAB+600(200),DMNTAB
         MVC   DMNTAB+800(200),DMNTAB
         MVC   DMNTAB+1000(200),DMNTAB
*        MVC   DMNTAB+1200(200),DMNTAB CUT TO 4096 MAXIMUM
*        MVC   DMNTAB+1400(200),DMNTAB
*        MVC   DMNTAB+1600(200),DMNTAB
*        MVC   DMNTAB+1800(200),DMNTAB
*        MVC   DMNTAB+2000(200),DMNTAB
*        MVC   DMNTAB+2200(200),DMNTAB
*        MVC   HDRIA(26),=CL26'ASID DSP DMN PGN SWC FLAGS'
*        MVC   HDROA(26),=CL26'ASID DSP DMN PGN SWC FLAGS'
         LA    R1,XTIME            LOAD WAITTIME ADDR
* REMOVED AS WORKAREA OVERLAPPED FROM PREVIOUS COMMAND R13
*        L     R15,8(0,R1)         LOAD HEX WAITTIME
*        LTR   R15,R15             TIME NOT SPECIFIED
*        BNZ   *+10                NO
         MVC   0(8,R1),=CL8'00003000'   30 SECONDS DEFAULT
         LA    R3,QPARM1           PARM LIST ADDR
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'S'          STC DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'I'          INIT DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'J'          JOB DISPLAY
         BE    PARM1               YES, CONTINUE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'X'
         B     PARM2
         SPACE 1
PARM1    MVI   TSOSW,C' '
         SPACE 1
PARM2    MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(80),=CL80' ACTIVITY MONITOR - 10 SEC. INTERVAL'
         MVI   SCANRET,C' '        SET FOUND
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
         EJECT
SETINIT  L     R4,16               CVT
         L     R4,556(0,R4)        ASVT
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         LA    R8,WORKEND
         ST    R8,JOBEND
         LA    R8,JOBTABLE         ASCB/OUCB INFO STORAGE
         SPACE 1
SETINIT1 XC    0(60,R8),0(R8)
         SPACE 1
SETINIT2 LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    SETINIT4            YES, EXIT
         TM    0(R4),X'80'         AVAILABLE SLOT
         BO    SETINIT2            YES
         L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R7,144(0,R5)        OUCB ADDR
         ST    R5,0(0,R8)          ENTRY ID
         LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R15,R1
         ST    R15,4(0,R8)         SAVE PREVIOUS CPU TIME
         SR    R15,R15
         ICM   R15,3,40(R5)        EXCP COUNT
         A     R15,108(0,R7)       OUCB EXCP COUNT
         ST    R15,16(0,R8)        SAVE TOTAL EXCPS
         L     R1,148(0,R5)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BZ    SETINIT3            NO
         L     R14,16(0,R1)        CURR PAGEIN
         ST    R14,28(0,R8)        SAVE CURR PAGEIN
         L     R14,20(0,R1)        CURR PAGEOUT
         ST    R14,32(0,R8)        SAVE CURR PAGEOUT
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         ST    R14,36(0,R8)        SAVE CURR PAGE RECLAIM
         L     R14,28(0,R1)        CURR VIO PAGEIN
         ST    R14,40(0,R8)        SAVE CURR VIO PAGEIN
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         ST    R14,44(0,R8)        SAVE CURR VIO PAGEOUT
         L     R14,36(0,R1)        CURR VIO RECLAIM
         ST    R14,48(0,R8)        SAVE CURR VIO RECLAIM
         SPACE 1
SETINIT3 TIME  BIN
         ST    R0,52(0,R8)
         LA    R8,56(0,R8)         NEXT ENTRY
         C     R8,JOBEND
         BNL   NOTENUF
         B     SETINIT1
         SPACE 1
SETINIT4 LA    R3,XTIME            LOAD WAITTIME ADDR
         STIMER WAIT,DINTVL=(R3)
         LA    R1,HDRI             IN QUEUE HDR
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R9,MSGRTN1
         EJECT
JOBOUT   L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         B     JOBOUT4
         SPACE 1
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   41(R7),X'00'        SRC PRESENT
         BNE   JOBOUT6             YES, GO CHECK DET WAIT
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT4             YES, OUT
         B     JOBOUT3             CONTINUE
         SPACE 1
JOBOUT2  CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT3             YES, OUT QUEUE
         CLI   41(R7),X'00'        SWAP REASON
         BE    JOBOUT4             NO, IN QUEUE
         CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT3             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT4             NO, IGNORE SRC
         SPACE 1
JOBOUT3  EQU   *
         MVC   JOBMSG(80),QBLANK
         BAL   R9,ASCBFORM        GO FORMAT ASCB INFO
         ST    R5,ASCBADDR
         L     R6,144(0,R5)        OUCB ADDR
         L     R3,60(0,R5)         TSB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R9,CSCBFORM        GO FORMAT CSCB INFO
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT4             YES, CONTINUE
         LA    R1,JOBMSG           MSG AREA
         BAL   R9,MSGRTN          GO PRINT MSG
         SPACE 1
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    JOBOUT5             YES, RETURN
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         SPACE 1
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    DMNCHK              YES, EXIT
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R9,JOBTOTL         TOTAL INPUT QUEUE
         LA    R1,JOBMSG           MSG AREA
         BAL   R9,MSGRTN          GO PRINT MSG
*---------------------------------------------------
         LA    R1,HDRO             OUT QUEUE HDR
         BAL   R9,MSGRTN1
         B     JOBOUT              NEXT PASS
         SPACE 1
JOBOUT6  CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT4             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT3             NO, IGNORE SRC
         B     JOBOUT4
         EJECT
ASCBFORM LA    R8,JOBTABLE         JOBTABLE ADDR
         UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SAVE ASID
         CLI   HDRIA,C' '          TSO OR STANDALONE EXEC
         BE    ASCBFRM1            NO, SHORTEN CONSOLE MESSAGE
         L     R7,144(0,R5)        OUCB ADDR
         UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASIDOUT(4),DOUBLE   ASID
         SR    R1,R1
         IC    R1,43(0,R5)         DPRTY TO MSG
         CVD   R1,DOUBLE
         UNPK  DSP(3),DOUBLE+6(2)
         OI    DSP+2,X'F0'
         LH    R1,42(0,R7)         SWAP COUNT          MVS/SE      WJB
         CVD   R1,DOUBLE
         MVC   SWC-1(4),=X'40202120'
         ED    SWC-1(4),DOUBLE+6
         SR    R1,R1
         IC    R1,40(0,R7)         DOMAIN NUMBER       MVS/SE      WJB
         CVD   R1,DOUBLE
         MVC   DMN-1(4),=X'40202120'
         ED    DMN-1(4),DOUBLE+6
         SR    R1,R1
         IC    R1,24(0,R7)         PERF GROUP NUMBER   MVS/SE      WJB
         CVD   R1,DOUBLE
         MVC   PGN-1(4),=X'40202120'
         ED    PGN-1(4),DOUBLE+6
         CLI   SCANTYPE,C'I'       IN QUEUE PASS
         BNE   ASCBFRM0            NO
         LH    R1,38(0,R5)         DISP POSITION
         CVD   R1,DOUBLE
         MVC   FLAGS(5),=CL5'NS-'
         TM    17(R7),X'80'        NON-SWAPPABLE
         BO    *+10                YES
         MVC   FLAGS(5),=CL5'IN-'
         UNPK  FLAGS+3(2),DOUBLE+6(2)
         OI    FLAGS+4,X'F0'
         B     ASCBFRM1
         SPACE 1
ASCBFRM0 MVC   FLAGS(5),=CL5'OU-'
         UNPK  FLAGS+3(3),41(2,R7)
         NC    FLAGS+3(2),=2X'0F'
         TR    FLAGS+3(2),=C'0123456789ABCDEF'
         MVI   FLAGS+5,C' '
         CLI   41(R7),X'00'        SRC = 0
         BNE   ASCBFRM1            NO
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BNE   ASCBFRM1            NO
         MVC   FLAGS+3(2),=C'LG'
         SPACE 1
ASCBFRM1 CLC   0(4,R8),=F'0'       JOBTABLE END
         BE    ASCBFRM2            YES
         C     R5,0(0,R8)          ASCB MATCH
         BE    ASCBFRM2            YES
         LA    R8,56(0,R8)         NEXT ENTRY
         C     R8,JOBEND
         BNL   NOTENUF
         B     ASCBFRM1
         EJECT
ASCBFRM2 LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         L     R7,144(0,R5)        OUCB ADDR
         SRDL  R14,22
         AR    R1,R15
         L     R15,4(0,R8)         LOAD PREVIOUS CPU TIME
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+6                 NO
         LR    R15,R1              PREVIOUS = CURRENT
         ST    R15,8(0,R8)         SAVE PREVIOUS CPU TIME
         ST    R1,4(0,R8)          SAVE TOTAL CPU TIME
         S     R1,8(0,R8)          SUB PREVIOUS CPU TIME
         ST    R1,12(0,R8)         SAVE DIFFERENCE
         SR    R1,R1
         ICM   R1,3,40(R5)         EXCP COUNT
         A     R1,108(0,R7)        OUCB EXCP COUNT
         L     R15,16(0,R8)        LOAD PREVIOUS EXCP COUNT
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+6                 NO
         LR    R15,R1              PREVIOUS = CURRENT
         ST    R15,20(0,R8)        SAVE PREVIOUS CPU TIME
         ST    R1,16(0,R8)         SAVE TOTAL CPU TIME
         S     R1,20(0,R8)         SUB PREVIOUS CPU TIME
         ST    R1,24(0,R8)         SAVE DIFFERENCE
         TIME  BIN
         L     R1,52(0,R8)         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,52(0,R8)         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,52(0,R8)         INTERVAL TIME
         ST    R0,52(0,R8)         NEW TIME BEGIN
         ST    R1,TIMEDIFF
         LTR   R1,R1               TIME EQUAL 0
         BZ    ASCBFRMY            YES, NO DIVIDE
         L     R15,24(0,R8)        LOAD EXCP DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRMX            YES
         L     R15,12(0,R8)        LOAD CPU DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRMX            YES
         SR    R14,R14
         M     R14,=F'10'          PERCENT
         SR    R14,R14
         DR    R14,R1              PERCENT UTIL
         ST    R15,JOBTOT1+4       SAVE JOB TOTAL PCT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1              PERCENT UTIL  (HUNDREDTHS)
         ST    R15,JOBTOT1         SAVE JOB TOTAL HUNDREDTHS
         CVD   R15,DOUBLE          PERCENT TO PRINT  (HUNDREDTHS)
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         EJECT
         L     R15,24(0,R8)        LOAD EXCP DIFFERENCE
         SR    R14,R14
         M     R14,=F'100'         SET FOR DIVIDE
         SR    R14,R14
         DR    R14,R1              EXCP PER SEC
         ST    R15,JOBTOT1+12      SAVE JOB TOTAL EXCP
         CVD   R15,DOUBLE
         MVC   SIO(9),=X'4020202020204B2020'
         ED    SIO(6),DOUBLE+5
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1              SIO PER SEC  (HUNDREDTHS)
         ST    R15,JOBTOT1+8       SAVE JOB TOTAL HUNDREDTHS
         CVD   R15,DOUBLE
         UNPK  SIO+7(2),DOUBLE+6(2)
         OI    SIO+8,X'F0'
         EJECT
         L     R1,148(0,R5)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BCR   8,R9                NO
         L     R14,16(0,R1)        CURR PAGEIN
         S     R14,28(0,R8)        SUB PREV PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         LR    R15,R14             ACCUMULATE
         L     R14,20(0,R1)        CURR PAGEOUT
         S     R14,32(0,R8)        SUB PREV PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         S     R14,36(0,R8)        SUB PREV PAGE RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         SR    R15,R14             ACCUMULATE
         L     R14,28(0,R1)        CURR VIO PAGEIN
         S     R14,40(0,R8)        SUB PREV VIO PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         S     R14,44(0,R8)        SUB PREV VIO PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,36(0,R1)        CURR VIO RECLAIM
         S     R14,48(0,R8)        SUB PREV VIO RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         SR    R15,R14             ACCUMULATE
         SR    R14,R14
         M     R14,=F'100'
         D     R14,TIMEDIFF        PAGES PER SEC
         ST    R15,JOBTOT1+20
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   PAG(7),=X'402020214B2020'
         ED    PAG(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         D     R14,TIMEDIFF        HUNDREDTHS
         ST    R15,JOBTOT1+16
         CVD   R15,DOUBLE
         UNPK  PAG+5(2),DOUBLE+6(2)
         OI    PAG+6,X'F0'
CHKFRMX  ST    R9,SAVER9
         BAL   R9,CHKFRM
         L     R9,SAVER9
         BR    R9
         SPACE 1
ASCBFRM3 MVC   PAG(7),=CL7'**OVF**'
         B     CHKFRMX
         SPACE 1
ASCBFRMX MVC   PCT(7),=C'**CHG**'
         B     CHKFRMX
         SPACE 1
ASCBFRMY MVC   PCT(7),=C'**ERR**'
         B     CHKFRMX
         EJECT
CHKFRM   L     R1,16              LOAD CVT ADDR
         L     R1,356(0,R1)       LOAD PVT ADDR
         L     R15,12(0,R1)       PFT APPARENT ADDR
         AH    R15,16(0,R1)       PFT ACTUAL ADDR
         SR    R14,R14             INDEX
         ICM   R14,3,18(R1)        TO END OF PFT
         SH    R14,16(0,R1)
         SRL   R14,4               DIVIDE BY 16
         SR    R1,R1               CLEAR FRAME COUNT
         SPACE 1
CHKFRM1  CLC   0(2,R15),36(R5)     ASID MATCH
         BNE   CHKFRM2             NO
         LA    R1,1(0,R1)          ADD 1 TO FRAME COUNT
         SPACE 1
CHKFRM2  LA    R15,16(0,R15)       NEXT PFT
         BCT   R14,CHKFRM1         PROCESS NEXT
         SLL   R1,2                CALC  'K'
         CVD   R1,DOUBLE
         MVC   FRAME(7),=X'402020202120D2'
         ED    FRAME(6),DOUBLE+5
         BR    R9
         EJECT
JOBTOTL  MVC   JOBMSG(80),QBLANK
         MVC   JOBMSG+4(18),=CL18'## IN Q TOTL ##'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+8
         D     R14,=F'100'
         A     R15,JOBTOT2+12      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   SIO(9),=X'4020202020204B2020'
         ED    SIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  SIO+7(2),DOUBLE+6(2)
         OI    SIO+8,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+16
         D     R14,=F'100'
         A     R15,JOBTOT2+20      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PAG(7),=X'402020204B2020'
         ED    PAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  PAG+5(2),DOUBLE+6(2)
         OI    PAG+6,X'F0'
         MVC   FRAME(35),=CL35' '
         BR    R9
         EJECT
DMNCHK   MVC   DMNLIST(80),QBLANK
         CLI   TSOSW,C'D'          DOMAIN LIST
         BNE   RETURN              NO
         LA    R1,HDRD             OUT QUEUE HDR
         BAL   R9,MSGRTN1
         LA    R4,DMNTAB-24
         SR    R5,R5
         SPACE 1
DMNCHK1  CVD   R5,DOUBLE           DOMAIN NUMBER
         MVC   DMNLIST+4(80),=CL80'DOMAIN XX'
         UNPK  DMNNBR(2),DOUBLE+6(2)
         OI    DMNNBR+1,X'F0'
         LA    R5,1(0,R5)          NEXT DOMAIN
         LA    R4,24(0,R4)         NEXT TABLE ENTRY
         C     R5,=F'51'           END OF DOMAINS
         BE    DMNCHK2             YES, TOTAL
         CLC   0(24,R4),=6F'0'     ANY TIME IN THIS DOMAIN
         BE    DMNCHK1             NO
         SR    R14,R14
         L     R15,0(0,R4)
         D     R14,=F'100'
         A     R15,4(0,R4)         TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         SR    R14,R14
         L     R15,8(0,R4)
         D     R14,=F'100'
         A     R15,12(0,R4)         TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNSIO(9),=X'4020202020204B2020'
         ED    DMNSIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  DMNSIO+7(2),DOUBLE+6(2)
         OI    DMNSIO+8,X'F0'
         SR    R14,R14
         L     R15,16(0,R4)
         D     R14,=F'100'
         A     R15,20(0,R4)         TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPAG(7),=X'402020204B2020'
         ED    DMNPAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPAG+5(2),DOUBLE+6(2)
         OI    DMNPAG+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R9,MSGRTN          GO PRINT MSG
         B     DMNCHK1
         EJECT
DMNCHK2  MVC   DMNLIST+4(80),=CL80'TOTAL PCT'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+8
         D     R14,=F'100'
         A     R15,JOBTOT2+12      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNSIO(9),=X'4020202020204B2020'
         ED    DMNSIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  DMNSIO+7(2),DOUBLE+6(2)
         OI    DMNSIO+8,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+16
         D     R14,=F'100'
         A     R15,JOBTOT2+20      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPAG(7),=X'402020204B2020'
         ED    DMNPAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPAG+5(2),DOUBLE+6(2)
         OI    DMNPAG+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R9,MSGRTN          GO PRINT MSG
         B     RETURN
         EJECT
CSCBFORM EQU   *
         STM   R0,R15,SAVEREGS
         CLI   TSOSW,C'S'          STC USER DISPLAY
         BNE   CSCBFRMT            NO
         CLI   28(R5),X'04'        STC USER
         BNE   JOBOUT4X            NO, BYPASS
         B     CSCBFRM6
CSCBFRMT CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRMJ            NO
         CLI   28(R5),X'01'        TSO USER
         BNE   JOBOUT4X            NO, BYPASS
         B     CSCBFRM6
CSCBFRMJ CLI   TSOSW,C'J'          TSO USER DISPLAY
         BNE   CSCBFRMI            NO
         CLI   28(R5),X'02'        JOB
         BNE   JOBOUT4X            NO, BYPASS
         L     R4,ASCBADDR
         L     R4,172(0,R4)
         LTR   R4,R4 THIS ASID IS NO JOB
         BZ    JOBOUT4X
         B     CSCBFRM6
CSCBFRMI CLI   TSOSW,C'I'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   28(R5),X'03'        INIT
         BNE   JOBOUT4X            NO, BYPASS
         B     CSCBFRM6
         SPACE 1
CSCBFRM0 CLI   TSOSW,C'D'          DOMAIN LIST
         BE    *+12                YES, CONTINUE
         CLI   28(R5),X'01'        TSO USER
         BE    JOBOUT4X            YES, DONT PROCESS
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R7,0(0,R5)          SAVE CSCB ADDR
         SR    R8,R8             INSERT
         ICM   R8,3,30(R5)        ASID
         SPACE 1
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R7               LOAD CSCB ADDR
         B     JOBOUT4X            NO GOOD
         CR    R5,R7               SAME CSCB
         BE    JOBOUT4X            YES, NO GOOD
         CH    R8,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
         SPACE 1
CSCBFRM2 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),64(R5)
         B     CSCBFRM4
JOBOUT4X EQU   *
         STM   R0,R15,SAVEREGS
         B     JOBOUT4
         SPACE 1
CSCBFRM3 MVC   JOBNAME(8),16(R5)
         MVC   STEPNAME(8),8(R5)
         SPACE 1
CSCBFRM4 CLI   TSOSW,C'X'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),40(R6)    DOMAIN MATCH
         BNE   JOBOUT4X
         SPACE 1
CSCBFRM5 LM    R14,R15,JOBTOT1
         A     R14,JOBTOT2
         A     R15,JOBTOT2+4
         STM   R14,R15,JOBTOT2
         LM    R14,R15,JOBTOT1+8
         A     R14,JOBTOT2+8
         A     R15,JOBTOT2+12
         STM   R14,R15,JOBTOT2+8
         LM    R14,R15,JOBTOT1+16
         A     R14,JOBTOT2+16
         A     R15,JOBTOT2+20
         STM   R14,R15,JOBTOT2+16
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    CSCBFRM7            YES
         CLC   ASID(4),=C'0001'
         BC    7,CSCBEXIT
         MVC   JOBNAME(20),=CL20'MASTER'
CSCBEXIT STM   R0,R15,SAVEREGS
         BR    R9
         SPACE 1
CSCBFRM6 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),16(R5)
         B     CSCBFRM5
         SPACE 1
CSCBFRM7 SR    R1,R1
         IC    R1,40(0,R6)         DOMAIN NUMBER
         MH    R1,=H'24'
         LA    R1,DMNTAB(R1)       DOMAIN TABLE SLOT
         LM    R14,R15,JOBTOT1
         A     R14,0(0,R1)
         A     R15,4(0,R1)
         STM   R14,R15,0(R1)       SAVE DOMAIN TOTALS
         LM    R14,R15,JOBTOT1+8
         A     R14,8(0,R1)
         A     R15,12(0,R1)
         STM   R14,R15,8(R1)       SAVE DOMAIN TOTALS
         LM    R14,R15,JOBTOT1+16
         A     R14,16(0,R1)
         A     R15,20(0,R1)
         STM   R14,R15,16(R1)       SAVE DOMAIN TOTALS
         B     JOBOUT4X
         EJECT
MSGRTN   MVI   SCANRET,C'P'
         SPACE 1
MSGRTN1  EQU   *
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LR    R0,R1          GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   QSTOP
NOTENUF  QTILT  'JOBTABLE TOO SMALL'
         EJECT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 1
         DS    0F
NFNDMSG  DC    CL80'NO JOBS ON OUT QUEUE'
         SPACE 1
HDRD     EQU   *
         DC    CL18'**  DOMAINS  **'
         DC    CL62'CPU PCT  SIO/SEC  PAG/SEC'
         SPACE 1
HDRI     EQU   *
         DC    CL18'** IN  QUEUE **'
         DC    CL36'CPU PCT  SIO/SEC  PAG/SEC  WORKSET'
HDRIA    DC    CL26'ASID DSP DMN PGN SWC FLAGS'
         SPACE 1
HDRO     EQU   *
         DC    CL18'** OUT QUEUE **'
         DC    CL36'CPU PCT  SIO/SEC  PAG/SEC  WORKSET'
HDROA    DC    CL26'ASID DSP DMN PGN SWC FLAGS'
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
JOBEND   DS    F
ASCBADDR DS    F
XTIME    DS    2F
*        JOBTOT1+0
*        JOBTOT1+4
*        JOBTOT1+8
*        JOBTOT1+C
*        JOBTOT1+10
*        JOBTOT1+14
JOBTOT1  DS    6F
*        JOBTOT1+0
*        JOBTOT1+4
*        JOBTOT1+8
*        JOBTOT1+C
*        JOBTOT1+10
*        JOBTOT1+14
JOBTOT2  DS    6F
SAVER9   DS    F
ASID     DS    F
TIMEDIFF DS    F
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    C
DOMAIN   DS    C
         SPACE 5
         DS    0F
JOBMSG   DS    0CL80
JOBNAME  DS    CL8
         DS    CL1
STEPNAME DS    CL8
         DS    CL1
PCT      DS    CL7
SIO      DS    CL9
         DS    CL2
PAG      DS    CL7
         DS    CL2
FRAME    DS    CL7
         DS    CL2
ASIDOUT  DS    CL4
         DS    CL1
DSP      DS    CL3
         DS    CL1
DMN      DS    CL3
         DS    CL1
PGN      DS    CL3
         DS    CL1
SWC      DS    CL3
         DS    CL1
FLAGS    DS    CL5
         DS    CL1
         SPACE 5
         DS    0F
DMNLIST  DS    F
DMNMSG   DS    0CL80
         DS    CL7
DMNNBR   DS    CL2
         DS    CL4
DMNPCT   DS    CL7
DMNSIO   DS    CL9
         DS    CL2
DMNPAG   DS    CL7
         DS    CL42
         SPACE 2
DMNTAB   DS    50CL24
         SPACE 5
JOBTABLE DS    0D
JOBTAB   DS    50CL48
WORKEND  DS    0F
         EJECT
         END
./       ADD   NAME=AIF
         AIF   (NOT &QSP136).NO136A                                 DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
.X136A   ANOP                                                       DOR
./       ADD   NAME=ALLOCATE
ALLOCATE TITLE 'QUEUE COMMAND - DATASET ALLOCATION ROUTINES'      ONL01
ALLOCATE QSTART ,                  START ALLOCATE CSECT ASSEMBLY  ONL01
         USING QDAIR,R10      BASE REG FOR DAIR WORK
         L     R10,QVDAIR     LOAD ADDR OF DAIR WORK
         USING QCKPT,R9       BASE REG FOR CKPT WORK ARES
         L     R9,QVCKPT      LOAD ADDR
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR ALLOCATION                    ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAALLOC           VALIDATE ALLOCATION REQUEST    ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   DETERMINE FUNCTION                                                *
*                                                                     *
***********************************************************************
         CLI   DAIRFLAG,X'08' IS THE FUNCTION ALLOCATE?
         BE    ALLOC          YES. DO IT.
         CLI   DAIRFLAG,X'18' IS THE FUNCTION FREE?
         BE    FREE           YES. DO IT.
         CLI   DAIRFLAG,X'30' IS THE FUNCTION ALLOCATE SYSOUT?
         BE    SYSALLOC       YES. DO IT.
         B     ABEND99        INVALID FUNCTION. ABANDON SHIP.
***********************************************************************
*                                                                     *
*   FREE DDNAME(XXXXXXXX)                                             *
*                                                                     *
***********************************************************************
FREE     LA    R1,DA18CD      LOAD ADDR OF FREE PARM LIST
         ST    R1,DAPLDAPB    STORE IN DAIR CALL LIST
         BAL   R2,CALLDAIR    CALL DAIR
         B     STOP           RETURN TO CALLER
***********************************************************************
*                                                                     *
*   ALLOC DDNAME(XXXXXXXX) DSNAME(YYYYYYYY) SHR                       *
*                                                                     *
***********************************************************************
ALLOC    MVC   DA18DDN,DA08DDN MOVE DDNAME TO FREE LIST
         LA    R1,DA18CD      LOAD ADDR OF FREE PARM LIST
         ST    R1,DAPLDAPB    STORE IN DAIR CALL LIST
         BAL   R2,CALLDAIR    CALL DAIR - FREE THE DDNAME
         LA    R1,DA08CD      LOAD ADDR OF ALLOC PARM LIST
         ST    R1,DAPLDAPB    STORE IN DAIR CALL LIST
         BAL   R2,CALLDAIR    CALL DAIR - ALLOCATE THE DATASET
         B     STOP           RETURN TO CALLER
***********************************************************************
*                                                                     *
*   ALLOC DDNAME(XXXXXXXX) SYSOUT(X)                                  *
*                                                                     *
***********************************************************************
SYSALLOC MVC   DA18DDN,DA30DDN MOVE DDNAME TO FREE LIST
         LA    R1,DA18CD      LOAD ADDR OF FREE PARM LIST
         ST    R1,DAPLDAPB    STORE IN DAIR CALL LIST
         BAL   R2,CALLDAIR    CALL DAIR - FREE THE DDNAME
         LA    R1,DA30CD      LOAD ADDR OF ALLOC PARM LIST
         ST    R1,DAPLDAPB    STORE IN DAIR CALL LIST
         BAL   R2,CALLDAIR    CALL DAIR - ALLOCATE THE DATASET
         B     STOP           RETURN TO CALLER
***********************************************************************
*                                                                     *
*   RETURN TO CALLING ROUTINE                                         *
*                                                                     *
***********************************************************************
STOP     QSTOP
***********************************************************************
*                                                                     *
*   CALL DYNAMIC ALLOCATION INTERFACE ROUTINE (DAIR)                  *
*                                                                     *
***********************************************************************
CALLDAIR XC    DAIRECB,DAIRECB CLEAR ECB
         LA    R1,DAPLUPT     LOAD ADDR OF DAIR CALL LIST
         LINK  EP=IKJEFD00    CALL DAIR
         LTR   R15,R15        IS RETURN CODE ZERO?
         BZR   R2             YES. RETURN.
         CH    R15,=H'28'     IS DATASET ALREADY FREE?
         BER   R2             YES. RETURN.
         CLC   DA08DDN,=C'HASPSAVE' IS THIS A SAVE?
         BNE   ABEND99        NO. ABEND.
         QTILT '*** UNABLE TO ALLOCATE DATASET ***'
***********************************************************************
*                                                                     *
*   DAIR HAS FAILED. TAKE A PICTURE AND GO HOME.                      *
*                                                                     *
***********************************************************************
ABEND99  TPUT  MESSAGE,L'MESSAGE,EDIT,MF=(E,QTPUT) TELL SAD STORY  PWF*
         ABEND 99,DUMP        ABEND THE JOB. USER CODE 0099.
***********************************************************************
*                                                                     *
*   CONSTANTS AND ASSORTED GARBAGE                                    *
*                                                                     *
***********************************************************************
         LTORG
MESSAGE  DC    C'A MAJOR DISASTER HAS OCCURRED IN DAIR PROCESSING.'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=ASID
ASID TITLE 'QUEUE COMMAND  - DISPLAY ACTIVE ADDRESS SPACES'
 SPACE 4
*
*   ASID WAS WRITTEN BY
*                             R P WENZEL
*                             OPTIMUM SYSTEMS INCORPORATED
*                             5615 FISHERS LANE
*                             ROCKVILLE, MARYLAND 20852
*                             (301) 468-1000 X232
*                             JUNE 2, 1976.
*
*   WITH MODIFICATIONS BY
*                             J R PASEUR
*                             OPTIMUM SYSTEMS INCORPORATED
*
*   MORE MODIFICATIONS BY
*                             R P WENZEL
*                             U S POSTAL SERVICE
*                             850 CHERRY AVE.
*                             SAN BRUNO, CALIFORNIA 94097
*                             (415) 876-9142
*                             FEBRUARY 1977.
*  QUEUE MODIFICATIONS BY
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*  FIX 1.ON FLAGS POSITION ON DISPLAY
*      2.PEFORMANCE GROUP FIXED DOR 7/24/86 FROM ONE BYTE TO TWO BYTES
 EJECT
*)F FUNCTION -
*  THE ASID COMMAND DISPLAYS INFORMATION ON THE ADDRESS SPACES.
*)X SYNTAX -
*         ASID    'ASID#'/*  STC/JOBS/TS/ALL
*  REQUIRED - NONE
*  DEFAULTS - ASID ALL
*  NOTE     - ASID OUTPUT HAS THE FOLLOWING FORMAT :
*ID DP JOB  STEP  FLAGS CPU-TIME REAL WORK  G/P/D  SRC SC SERV TRC SERV
*WHERE
*        ID - ASID NUMBER
*        DP - DISPATCHING PRIORITY
*       JOB - JOBNAME
*      STEP - STEPNAME
*     FLAGS - XXXYY
*       XXX - IN  - IN CORE, SWAPPED IN (DEFAULT IF NONE OF THE BELOW)
*             NSW - NON-SWAPPABLE
*             PVL - PRIVILEDGED (NON-SWAPPABLE EXCEPT FOR LONG WAIT)
*             AXS - AUX SHORTAGE FORCED SWAP
*             OUT - SWAPPED OUT
*             GOO - IN PROCESS OF BEING SWAPPED OUT
*             GOI - IN PROCESS OF BEING SWAPPED IN
*             GOB - CURRENTLY CHANGING STATUS
*             ENQ - TEMPORARILY NON-SWAPPABLE DUE TO ENQ
*             APG - AUTOMATIC-PRIORITY-GROUP APPLIES
*             RMA - RMA ALGORITHM APPLIES (RTB=0)
*        YY - TW  - TERMINAL WAIT
*             MW  - LONG WAIT STATUS DETECTED BY MSO (MS6)
*             LW  - EXPLICIT LONG WAIT
*             NW  - NON-SWAPPABLE WAIT
*             OW  - OUTPUT TERMINAL WAIT
*             CP  - SIGINIFICANT CPU USER (SET BY IRARMCPM)
*  CPU TIME - STEP CPU TIME IN HOURS:MINUTES:SECONDS
*      REAL - AMOUNT OF REAL CORE AT LAST PAGE-IN
*      WORK - WORKING SET SIZE AT LAST SWAPIN
*     G/P/D - PERFORMANCE GROUP/PERFORMANCE GROUP PERIOD/DOMAIN
*       SRC - SWAP OUT REASON CODES
*             OTW - OUTPUT TERMINAL WAIT
*             ITW - INPUT TERMINAL WAIT
*              LW - LONGWAIT
*             ASS - AUXILIARY STORAGE SHORTAGE
*             RSS - REAL PAGEABLE STORAGE SHORTAGE
*              DT - DETECTED WAIT
*              RS - REQUESTED SWAP
*              EE - ENQ EXCHANGE
*             ERV - EXCHANGE OF RECOMMENDATION VALUE
*               U - UNILATERAL
*       SWC - NUMBER OF SWAPS FOR CURRENT TRANSACTION
*      SERV - SERVICE UNITS ACCUMALATED FOR CURRENT TRANSACTION
*       TRC - NUMBER OF TRANSACTIONS DURING SESSION
*      SERV - SERVICE UNITS ACCUMALATED DURING SESSION
*)O OPERANDS -
*  'ASID#'   - ADDRESS SPACE IDENTIFICATION NUMBER.  AN ASTERISK (*)
*              INDICATES CURRENT TSO USER.
*))STC       - DISPLAY STARTED OR SYSTEM TASKS.
*))JOBS      - DISPLAY JOBS ON JES INITIATORS.
*))TS        - DISPLAY TSO USERS.
*))ALL       - PERFORM SYSTEM, INITIATOR AND TSO FUNCTIONS.
 EJECT
ASID     QSTART ,                  START CJHIST CSECT ASSEMBLY    ONL01
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
         USING ASCB,R5
*
         BAL   R14,BEGIN
*
         B     PRSE
*
RETURN   QSTOP
 EJECT
*  SUBROUTINE TO GET READY SET AND GO
*
BEGIN    EQU   *             SAVE R1
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         MVI   ASIDFLAG,OFF   BLANK FLAG
         L     R2,16          CVT ->
         L     R2,556(R2)     ASVT ->
         LA    R2,516(R2)     ADDR OF ASVTMAXU
         L     R3,0(R2)       ASVTMAXU
         ST    R3,ASCBMAX     SAVE MAX ASCB'S
         LA    R2,8(R2)       ADDR OF ASVTENTY
         ST    R2,ASCBONE     FIRST ASCB
         BR    R14
 EJECT
*  SUBROUTINE TO FORMAT ASID NUMBER
*             DISPATCHING PRIORITY
*             OUCB STATUS FLAGS
*             STEP TIME
*             AMOUNT OF REAL STORAGE
*             CORE AT LAST SWAP IN
*             PERFORMANCE GROUP AND PERIOD
*
COMN     CVD   R3,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4    EDIT TO EBCDIC
         MVC   LINEASID,CHAR+6 MOVE TWO CHARS TO LINE
COMNFRST SR    R7,R7          CLEAR R7
         IC    R7,ASCBDP      DPRTY
         SRL   R7,4           LEFT CHAR
         AH    R7,=H'240'     ADD X'F0'
         CH    R7,=H'249'     LESS THAN X'F9'
         BH    COMNFST1       NO
         STC   R7,LINEDPRT    SAVE CHAR
         B     COMNSCND       RETURN
COMNFST1 SH    R7,=H'57'      SUB X'39'
         STC   R7,LINEDPRT    SAVE CHAR
COMNSCND SR    R7,R7          CLEAR R7
         IC    R7,ASCBDP      DPRTY
         LA    R8,240         X'F0'
         OR    R7,R8          AND REGS.
         CH    R7,=H'249'     LESS THAN X'F9'
         BH    COMSCND1       NO
         STC   R7,LINEDPRT+1  SAVE CHAR
         B     COMN1          CONTINUE
COMSCND1 SH    R7,=H'57'      SUB X'39'
         STC   R7,LINEDPRT+1  SAVE CHAR
 EJECT
COMN1    MVC   LINESTAT,=CL6'FAIL '  DEFAULT STATUS - FAILED
         TM    ASCBDSP1,ASCBFAIL   TEST FOR FAILED ADDRSPC
         BO    COMN3               BR IF ADDRESS SPACE DEAD
         MVC   LINESTAT,=CL6'IN   '  DEFAULT - WLM ALGORITHM IN EFFECT
         USING OUCB,R7
         L     R7,ASCBOUCB
         LA    R8,COMNMVE1    MOVE STATEMENT
TESTOUT  LA    R9,=CL3'OUT'          SWAPPED OUT
         TM    ASCBRCTF,ASCBOUT    TEST ASCB FOR THIS
         BOR   R8
         LA    R9,=CL3'ENQ'          NONSWAPPABLE DUE TO ENQ
         TM    OUCBSFL,OUCBENQ
         BOR   R8
         LA    R9,=CL3'NSW'          NON-SWAPPABLE
         TM    OUCBSFL,OUCBNSW
         BOR   R8
         LA    R9,=CL3'PVL'          PRIVELEGED STATUS
         TM    OUCBSFL,OUCBPVL
         BOR   R8
         LA    R9,=CL3'AXS'          AUX SHORTAGE FORCED SWAP
         TM    OUCBYFL,OUCBAXS
         BOR   R8
         LA    R9,=CL3'GOO'          GOING OUT
         TM    OUCBQFL,OUCBGOO
         BOR   R8
         LA    R9,=CL3'GOI'          GOING IN
         TM    OUCBQFL,OUCBGOI
         BOR   R8
         LA    R9,=CL3'GOB'          CHANGING STATUS
         TM    OUCBQFL,OUCBGOB
         BOR   R8
         LA    R9,=CL3'APG'          APG ALGORITM APPLICABLE
         TM    OUCBAFL,OUCBAPG
         BOR   R8
         LA    R9,=CL3'RPT'          RMA ALGORITHM APPLICABLE DOR
         TM    OUCBAFL,OUCBREPT     OLD OUCBRMA DOR
         BOR   R8
         B     COMN2               ACCEPT DEFAULT STATUS
COMNMVE1 MVC   LINESTA1,0(R9) MOVE COMN1
         SPACE 3
COMN2    LA    R8,COMNMVE2    MOVE COMMENT
         LA    R9,=CL2'TW'           TERMINAL WAIT
         TM    OUCBEFL,OUCBTRM
         BOR   R8
         LA    R9,=CL2'MW'           MSO-DETECTED WAIT
         TM    OUCBEFL,OUCBMWT
         BOR   R8
         LA    R9,=CL2'LW'           LONG WAIT
         TM    OUCBEFL,OUCBLWT
         BOR   R8
         LA    R9,=CL2'OW'           OUTPUT WAIT
         TM    OUCBEFL,OUCBOWT
         BOR   R8
         LA    R9,=CL2'NW'           NON-SWAPPABLE WAIT
         TM    OUCBAFL,OUCBNWT
         BOR   R8
         LA    R9,=CL2'CP'           SIGNIFICANT CPU USER
         TM    OUCBAFL,OUCBCPL
         BOR   R8
         B     COMN3
COMNMVE2 MVI   LINESTAX,C'-'
         MVC   LINESTA2,0(R9) MOVE COMN2
 EJECT
COMN3    LM    R8,R9,ASCBEJST           PICK UP CPU TIME
         SRDL  R8,24                    MOVE TO ODD REG
         M     R8,=A(1048576)           COMPUTE IN SECONDS
         D     R8,=A(1000000*256)
         BAL   R7,TIMECNVT    CHANGE SEC. TO HH:MM:SS
         SPACE 3
         LH    R8,ASCBFMCT    ALLOCATED PAGE FRAME COUNT
         SLL   R8,2           MULT. BY 4
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4    EDIT TO EBCDIC
         MVC   LINEFMCT,CHAR+4 MOVE FOUR CHARS TO LINE
         MVI   LINEFMCT+4,C'K' MOVE C'K' TO PRINT LINE
         SPACE 3
         L     R7,ASCBOUCB
         USING OUCB,R7
         LH    R8,OUCBWSS     WORKING SET SIZE AT SWAP-IN
         SLL   R8,2           MULT. BY 4
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINEWSS,CHAR+4 MOVE FOUR CHARS TO LINE
         MVI   LINEWSS+4,C'K' MOVE C'K' TO PRINT LINE
         SPACE 3
         SR    R8,R8          CLEAR REG. 8
         ICM   R8,3,OUCBNPG     NEW PERFORMANCE GROUP NUMBER   DOR
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINENPG,CHAR+6 MOVE TWO CHARS TO LINE
         MVI   LINENPG+2,C'/' MOVE IN SLASH
         SPACE 3
         IC    R8,OUCBPGP     WMPGP OFFSET
         SH    R8,=H'4'       SUBTRACT 4 FROM OFFSET
         SRL   R8,3           DIVIDE BY 8
         STC   R8,LINEPGP     PERFORMANCE GROUP PERIOD
         OI    LINEPGP,X'F0'  OR TO GET PRINTABLE CHAR
         MVI   LINEPGP+1,C'/' MOVE IN SLASH
         SPACE 3
         SR    R8,R8          CLEAR REG. 8
         IC    R8,OUCBDMN     DOMAIN NUMBER
         CH    R8,=H'9'       DOMAIN NUMBER GREATER THAN 9
         BH    COMN4          YES THERE ARE TWO CHARS
         STC   R8,LINEDMN     STORE CHARACTER
         OI    LINEDMN,X'F0'  MAKE NUMBER
         B     COMN5          SKIP MOVING TWO CHARACTERS
COMN4    CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK2    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINEDMN,CHAR+6 MOVE TWO CHARS TO LINE
         SPACE 3
COMN5    SR    R8,R8          CLEAR REGISTER 8
         IC    R8,OUCBSRC     SWAP REASON CODE
         LTR   R8,R8          EQUAL TO ZERO?
         BZ    COMN6          GO TO COMN6 AND FIND SWAP COUNT
         SLL   R8,2           MULT. BY 4 FOR TABLE OFFSET
         LA    R9,COMNTBLE    TABLE OF SWAP REASON CODES
         AR    R9,R8          ADD OFFSET
         MVC   LINESRC(3),0(R9) MOVE SWAP REASON CODE TO LINE
         B     COMN6          SKIP COMNTBLE
*                 0   1   2   3   4   5   6  7   8   9  10
COMNTBLE DC    C'    OTW/ITW/ LW/ASS/RSS/ DT/ RS/ EE/ERV/  U/'
         SPACE 3
COMN6    LH    R8,OUCBSWC     SWAP COUNT FOR CURRENT TRANSACTION
         LTR   R8,R8          EQUAL TO ZERO?
         BZ    COMNRTN        GO TO RETURN
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINESWC,CHAR+5 MOVE TWO CHARS TO LINE
         SPACE 3
COMNRTN  BR    R15
         DROP  R7
 EJECT
*  SUBROUTINE TO FIND JOBS ON JES INITIATORS
*
INIT     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,INITLINE MOVE INITLINE TO HEADER
         MVC   QDHLINE(80),HEADER  HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    INITLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
INITLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    INITINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BZ    INITINCR       YES
INITOUT  MVC   LINEJOBN,0(R6) MOVE JOBNAME
         MVC   LINESTEP,56(R6) MOVE STEPNAME
         BAL   R15,COMN       COMMON INFO
         BAL   R15,TSOOUXB
         BAL   R7,DISPLAY
INITINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,INITLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
*  SUBROUTINE TO PARSE INPUT AND TO PERFORM THE REQUESTS
*
PRSE     EQU   *
         USING QCKPT,R9
         L     R9,QVCKPT
         LA    R3,QDREPLY
         AH    R3,QOFF1
PRSE1    EQU   *
         LH    R2,QDRLNG         CHANGE IN PARM STRING (NON BLANK)
         LTR   R2,R2
         BNZ   PRSEWHAT         CHECK FOR  PARM STRING
*  CURRENT REQUEST IS SAVED....
         TM    ASIDFLG2,X'01'   CURRENT REQUEST WAS ASID *
         BO    PRSE3
         TM    ASIDFLG2,X'02'   CURRENT REQUEST  WAS ASID #/STC/TS/JOBS
         BO    PRSEASID
*  NEW REQUEST IS ENTERED..
PRSEWHAT CLI   0(R3),C'*'
         BE    PRSE3
         CLC   0(3,R3),=CL3'ALL'
         BE    PRNODEFA
         CLC   0(3,R3),=CL3'STC'
         BE    PRNOSTC
         CLC   0(4,R3),=CL4'JOBS'
         BE    PRNOJOBS
         CLC   0(2,R3),=CL2'TS'
         BE    PRNOTSO
         CLC   0(2,R3),=CL2'AS' QUEUE GIVE NO PARM STRING BUT COMMAND
         BE    PRNODEFA
         CLI   0(R3),C' '
         BE    PRNODEFA
* CHECK ASID NUMERICAL STRING
PRSENUM  EQU   *
         LA    R5,12             GET REPLY LENGTH
         LA    R4,0              RESET TO ZERO
PRSECHK  CLI   0(R3),X'00'       LOOK FOR BLANK OR NULL
         BE    PRSEEND           YES, FOUND
         CLI   0(R3),X'40'       LOOK FOR BLANK OR NULL
         BE    PRSEEND           YES, FOUND
         LA    R4,1(R4)
PRSENEXT LA    R3,1(R3)
         BCT   R5,PRSECHK
         B     PRNODEFA           ERROR - GO TO ASID ALL AS DEFAULT
PRSEEND  LTR   R4,R4              EMPTY?
         BZ    PRSENEXT           NEXT CHAR
         LR    R2,R4
         LA    R3,QDREPLY
         AH    R3,QOFF1
         STH   R2,ASIDNO+4
         BCTR  R2,0
         EX    R2,MVC
         LA    R3,ASIDNO
         MVC   QFZONES,QFZONE
         EX    R2,MVZ
         CLC   QFZONES,QFZONE
         BNE   PRSERM
         MVC   TYPE(2),=H'1' DEFAULT FOR ALL
         B     PRSEASID
*        EX    R2,PACK2
*        CVB   R2,DWORD
*        MVC   ASIDNO(4),DWORD+4
PRSE2    LA    R3,ASIDNO      ADDR OF ASIDNO
         CLI   0(R3),C'*'     WANT ONLY CURRENT USER?
         BNE   PRSEASID       NO
PRSE3    L     R3,16          CVT ->
         L     R3,0(R3)       TCB CURRENT - OLD POINTER
         L     R3,8(R3)       ASCB CURRENT - OLD POINTER
         LH    R3,36(R3)      ASCBASID
         STH   R3,ASIDNMBR    SAVE ASID NUMBER
         LA    R3,4           TSO TYPE NUMBER
         STH   R3,TYPE        SAVE TYPE
         MVI   ASIDFLG2,X'01'
         B     PSRESTFL
PRNODEFA MVC   TYPE(2),=H'1' DEFAULT FOR ALL
         B     PRNOASID
PRNOSTC  MVC   TYPE(2),=H'2'
         B     PRNOASID
PRNOJOBS MVC   TYPE(2),=H'3'
         B     PRNOASID
PRNOTSO  MVC   TYPE(2),=H'4'
PRNOASID MVC   ASIDNO(4),=CL4'   0'
         MVC   ASIDNO+4(2),=H'4'
         B     PRSEASID
PRSTASID MVC   ASIDNO(4),=CL1'*'
         MVC   ASIDNO+4(2),=H'1'
         B     PRSE2
MVC      MVC   ASIDNO(*-*),0(R3)
MVZ      MVZ   QFZONES(*-*),0(R3)
PACK2    PACK  DWORD(8),0(0,R3)
         SPACE 1
PRSEASID LH    R3,ASIDNO+4    LENGTH OF ASIDNO
         BCTR  R3,0           DECREMENT BY 1
         LA    R4,X'70'       LENGTH OF WORK - 1
         OR    R3,R4          LENGTHS FOR PACK INSTR.
         LA    R4,ASIDNO      ADDR OF ASIDNO
         EX    R3,PACK        PACK ASIDNO
         CVB   R3,WORKX       CONVERT ASID TO BINARY
         C     R3,ASCBMAX     DOES ASIDNO EXISTS?
         BH    PRSEMXER       NO SAY SO AND QUIT
         STH   R3,ASIDNMBR    SAVE ASID NUMBER
         MVI   ASIDFLG2,X'02'
         LTR   R3,R3          ASIDNO = 0 ?
         BZ    PRSEBRTB       YES GO TO PARSE BRANCH TABLE
PSRESTFL MVI   ASIDFLAG,ON    NO TURN ASID FLAG ON
PRSEBRTB LH    R3,TYPE        PICK UP TYPE
         SLL   R3,2           MULT. BY 4
         B     *+0(R3)        BRANCH TABLE
         B     PRSEALL        TYPE = 1
         B     PRSESTRT       TYPE = 2
         B     PRSEINIT       TYPE = 3
         B     PRSETSO        TYPE = 4
PRSEALL  BAL   R14,STRT
         BAL   R14,INIT
         BAL   R14,TSOJ
         B     RETURN
PRSETSO  BAL   R14,TSOJ
         B     RETURN
PRSEINIT BAL   R14,INIT
         B     RETURN
PRSESTRT BAL   R14,STRT
         B     RETURN
 EJECT
PRSERM   QTILT '***** ASID: INVALID PARSE STRING *****'
         SPACE 3
PRSEMXER L     R3,ASCBMAX     MAX ASCB
         MVC   LINE,PRSEMXTP
         CVD   R3,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINE+27(4),CHAR+4 MOVE FOUR CHARS TO LINE
         BAL   R7,DISPLAY     SET UP FOR TPUT
         B     RETURN
         DROP  R9
         SPACE 3
PACK     PACK  WORKX,0(0,R4)
*
PRSEMXTP DC    CL80'MAXIMUM NUMBER OF ASCBS IS'
 EJECT
*  SUBROUTINE TO TEST IF APPROPRIATE HEADER HAS BEEN PRINTED
*             AND THEN PRINT CURRENT LINE
*
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
 EJECT
*  SUBROUTINE TO FIND STARTED TASKS
*
STRT     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,STRTLINE MOVE STRTLINE TO HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         MVC   QDHLINE(80),HEADER  HEADER
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    STRTLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
STRTLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    STRTINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BNZ   STRTINCR       NO
         L     R6,ASCBCSCB    ASCBCSCB ->
         USING CSCB,R6
         LTR   R6,R6          ZERO?
         BZ    STRTOUT        YES SYSTEM TASK
         TM    CHPKE,CHTSID   TSO JOB?
         DROP  R6
         BO    STRTINCR       YES
STRTOUT  L     R6,ASCBJBNS    JOB NAME FOR STARTED TASK
         MVC   LINEJOBN,0(R6) MOVE JOBNAME
         BAL   R15,COMN
         BAL   R7,DISPLAY
STRTINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,STRTLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
*  SUBROUTINE TO CONVERT TIME IN SEC TO HH:MM:SS.
*        INPUT - R9=TIME IN SEC.
*        OUTPUT - TIME IN 'LINEEJST'.
*
TIMECNVT MVC   LINEEJST,TIMECNST   SET DEFAULT LINEEJST
         LTR   R9,R9          ANY SECONDS
         BCR   8,R7           RETURN IF NO TIME
         SR    R8,R8          ZERO FOR DIVIDE
         D     R8,=F'3600'    GET HOURS IN R9
         CVD   R9,WORKX
         UNPK  LINEEJST(2),WORKX
         OI    LINEEJST+1,X'F0'
         LTR   R8,R8          ANY REMAINING SECONDS
         BCR   8,R7           RETURN IF NO
         LR    R9,R8          GET READY FOR DIVIDE
         SR    R8,R8
         D     R8,=F'60'      GET MINUTES IN R9
         CVD   R9,WORKX
         UNPK  LINEEJST+3(2),WORKX
         OI    LINEEJST+4,X'F0'
         CVD   R8,WORKX       GET REMAINING SECONDS
         UNPK  LINEEJST+6(2),WORKX
         OI    LINEEJST+7,X'F0'
         BR    R7             RETURN TO CALLER
*
TIMECNST DC    CL8'00:00:00'  DEFAULT TIME VALUE
 EJECT
*  SUBROUTINE TO FIND TSO USERS
*
TSOJ     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,TSOJLINE MOVE TSOJLINE TO HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         MVC   QDHLINE(80),HEADER  HEADER
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    TSOJLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
TSOJLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    TSOJINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BNZ   TSOJINCR       NO
         L     R6,ASCBCSCB    ASCBCSCB ->
         USING CSCB,R6
         LTR   R6,R6          ZERO?
         BZ    TSOJINCR       YES SYSTEM TASK
         TM    CHPKE,CHINITID INTIT?
         BO    TSOJINCR       YES
         TM    CHPKE,CHTSID   TSO JOB?
         BNO   TSOJINCR       NO
TSOJOUT  MVC   LINEJOBN,CHKEY MOVE JOBNAME
         MVC   LINESTEP,CHCLS MOVE STEPNAME
         DROP  R6
         BAL   R15,COMN
         BAL   R15,TSOOUXB
         BAL   R7,DISPLAY
TSOJINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,TSOJLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
*  SUBROUTINE TO EXTRACT CURRENT TRANSACTION SERVICE UNITS
*             TO EXTRACT CURRENT TRANSACTION COUNT
*         AND TO EXTRACT SESSION SERVICE UNITS
*
TSOOUXB  L     R7,ASCBOUXB
         USING OUXB,R7
         L     R8,OUXBTRS     SERVICE UNITS
         LTR   R8,R8          EQUAL TO 0?
         BZ    TSOOUXB2       SKIP TO TRANSACTION COUNT
         C     R8,=F'1048576'  GREATER THAN 1MK
         BH    TSOOUXBX       YES CHANGE TO M  (PRINT UP TO 999K)
         C     R8,=F'9999'    GREATER THAN 9,999
         BH    TSOOUXB1       YES CHANGE TO K
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINETRS,CHAR+4 MOVE FOUR CHARS TO LINE
         B     TSOOUXB2       CONTINUE
TSOOUXBX AH    R8,=H'512'     ADD .5K FOR ROUND OFF
         SRL   R8,20          DIVIDE BY 1048576
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINETRS(2),CHAR+6 MOVE THREE CHARS TO LINE
         MVC   LINETRS+2(2),=CL2'MK' MOVE MK TO LINE
         B     TSOOUXB2
TSOOUXB1 AH    R8,=H'512'     ADD .5K FOR ROUND OFF
         SRL   R8,10          DIVIDE BY1024
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINETRS(3),CHAR+5 MOVE THREE CHARS TO LINE
         MVI   LINETRS+3,C'K' MOVE K TO LINE
TSOOUXB2 L     R8,OUXBTRC     TRANSACTION COUNT
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         BZR   R15            RETURN
         MVC   LINETRC,CHAR+5 MOVE THREE CHARS TO LINE
         L     R8,OUXBJBS     SERVICE UNITS
         LTR   R8,R8          EQUAL TO 0?
         BZR   R15            YES, RETURN
         C     R8,=F'99999'   GREATER THAN 99,999
         BH    TSOOUXB3       YES, CHANGE TO K
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINEJBS,CHAR+3 MOVE FIVE CHARS TO LINE
         BR    R15            RETURN
TSOOUXB3 AH    R8,=H'512'     ADD .5K FOR ROUND OFF
         SRL   R8,10          DIVIDE BY 1024
         CVD   R8,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINEJBS+1(3),CHAR+5 MOVE THREE CHARS TO LINE
         MVI   LINEJBS+4,C'K' MOVE K TO LINE
         BR    R15            RETURN
 EJECT
STRTLINE DC    CL80' '
         ORG   STRTLINE            RESET ADDRESSABILITY
         DC    C'ID DP ****** STC ****** FLAGS  CPU-TIME'
         DC    C' REAL WORK  G/P/D  SRC/SWC'
         ORG
INITLINE DC    CL80' '
         ORG   INITLINE            RESET ADDRESSABILITY
         DC    C'ID DP ****** JOB ****** FLAGS  CPU-TIME'
         DC    C' REAL WORK  G/P/D  SRC SWC SERV TRC  SERV'
         ORG
TSOJLINE DC    CL80' '
         ORG   TSOJLINE            RESET ADDRESSABILITY
         DC    C'ID DP ****** TSU ****** FLAGS  CPU-TIME'
         DC    C' REAL WORK  G/P/D  SRC SWC SERV TRC  SERV'
         ORG
EDMSK1   DC    XL8'4020202020202120'
EDMSK2   DC    XL8'4020202020212020'
OFF      EQU   X'00'
ON       EQU   X'01'
LINE     EQU   QDMSG+00,80
LINEASID EQU   QDMSG+00,2
LINEDPRT EQU   QDMSG+03,2
LINEJOBN EQU   QDMSG+06,8
LINESTEP EQU   QDMSG+15,8
LINESTAT EQU   QDMSG+24,6
LINESTA1 EQU   QDMSG+24,3
LINESTAX EQU   QDMSG+27,1
LINESTA2 EQU   QDMSG+28,2
LINEEJST EQU   QDMSG+31,8
LINEFMCT EQU   QDMSG+39,4
LINEWSS  EQU   QDMSG+44,4
LINENPG  EQU   QDMSG+50,2
LINEPGP  EQU   QDMSG+53,1
LINEDMN  EQU   QDMSG+55,2
LINESRC  EQU   QDMSG+58,3
LINESWC  EQU   QDMSG+62,3
LINETRS  EQU   QDMSG+66,4
LINETRC  EQU   QDMSG+71,3
LINEJBS  EQU   QDMSG+75,5
         LTORG
 EJECT
*   CSCB
         PRINT NOGEN
CSCB     DSECT
         IEECHAIN
 EJECT
*   ASCB
         IHAASCB
 EJECT
*   OUCB
         IRAOUCB
 EJECT
*   OUXB
         IHAOUXB
 EJECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
DWORD    DS    D
CHAR     DS    D
SAVER14  DS    F
ASCBONE  DS    F
ASCBMAX  DS    F
ECB      DS    F
ASIDNO   DS    2F
ASIDNMBR DS    H
TYPE     DS    H
HEADERSW DS    C
ASIDFLAG DS    X
ASIDFLG2 DS    X
HEADER   DS    CL80
         END
./       ADD   NAME=ASIDCSA
ASIDCSA TITLE 'QUEUE COMMAND  - DISPLAY COMMON STORAGE AREA BY ASID'
 SPACE 4
*
*   ASIDCSA WAS WRITTEN BY
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*            4/21/87
 EJECT
ASIDCSA  QSTART ,                  START CJHIST CSECT ASSEMBLY    ONL01
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
         USING ASCB,R5
*
         BAL   R14,BEGIN
*
         B     PRSE
*
RETURN   QSTOP
 EJECT
*  SUBROUTINE TO GET READY SET AND GO
*
BEGIN    EQU   *             SAVE R1
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         MVI   ASIDFLAG,OFF   BLANK FLAG
         L     R2,16          CVT ->
         L     R2,556(R2)     ASVT ->
         LA    R2,516(R2)     ADDR OF ASVTMAXU
         L     R3,0(R2)       ASVTMAXU
         ST    R3,ASCBMAX     SAVE MAX ASCB'S
         LA    R2,8(R2)       ADDR OF ASVTENTY
         ST    R2,ASCBONE     FIRST ASCB
         BR    R14
 EJECT
*  SUBROUTINE TO FORMAT ASID NUMBER
*             STC NAME
*             KEY NUMBER
*             SPOOL NUMBER
*             AMOUNT OF ALLOCATED CSA
*             AMOUNT OF FREE      CSA
*
* INPUT  R2 = ASCB
*        R5 = BEGINNING OF ASCB STRING
*        R3,R4 = RESERVED
*        R7,R8,R9 = WORK REGISTERS
*
CSA     EQU   *
         ST    R15,SAVER15
         STM   R2,R5,SAVEASCB
         CVD   R3,WORKX
         MVC   CHAR,EDMSK1
         ED    CHAR,WORKX+4
         MVC   LINEASID,CHAR+6
         LR    R3,R5         ASCB
TCB0     L     R3,X'6C'(,R3)       POINT TO ASXB.
         L     R3,4(,R3)           POINT TO FIRST TCB.
TCBLOOP  LTR   R3,R3               END OF TCB CHAIN?
         BNZ   TCB1                B IF NOT.
         B     CSARTN
TCB1     LR    R1,R3               HEXIFY ...
         BAL   R14,LINEHEX         ... TCB ADDRESS.
         MVC   LNE4ADDR(6),WORKX+2   MOVE TCB ADDRESS.
         L     R1,0(,R3)           POINT TO RB.
         L     R1,12(,R1)          POINT TO CDE.
         MVC   LNE4NAME(8),8(R1)     MOVE PROGRAM NAME FROM CDE.
*        MVC   LNE4NAME,X'60'(R1) MOVE NAME FROM RB (XA).
*        BAL   R7,DISPLYD
SPQE0    L     R4,X'18'(,R3)       POINT TO FIRST SPQE.
SPQELOOP LTR   R4,R4               END OF SPQE CHAIN?
         BNZ   SPQE1               B IF NOT.
         L     R3,X'74'(,R3)       POINT TO NEXT TCB.
         B     TCBLOOP             LOOP.
SPQE1    SR    R1,R1               CLEAR INSERT REG.
         IC    R1,X'A'(,R4)        LOAD SUBPOOL.
         CVD   R1,WORKX            DECIMALIZE SUBPOOL.
         UNPK  LINESPOL(3),WORKX+6(2) UNPACK SUBPOOL.
         OI    LINESPOL+2,C'0'     FIX SIGN.
         IC    R1,X'B'(,R4)        LOAD KEY.
         BAL   R14,LINEHEX         HEXIFY KEY.
         MVC   LINEKEY(1),WORKX+6     MOVE KEY.
*        BAL   R7,DISPLYD
         L     R5,4(,R4)           POINT TO FIRST DQE FOR THIS SP.
DQELOOP  LTR   R5,R5               END OF DQE CHAIN?
         BNZ   DQE1                B IF NOT.
         L     R4,0(,R4)           POINT TO SPQE FOR NEXT SUBPOOL.
         B     SPQELOOP            LOOP.
DQE1     L     R1,12(,R5)          LOAD LENGTH OF BLOCK IN SUBPOOL.
         LTR   R1,R1               0 LENGTH?
         BZ    DQEBUMP             B IF YES.  NULL ENTRY.
*        A     R1,SPOLLNGH         ACCUMULATE SUBPOOL LENGTH
*        ST    R1,SPOLLNGH         ACCUMULATE SUBPOOL LENGTH
         BAL   R14,LINEHEX         HEXIFY LENGTH.
         MVC   LINEALLO(6),WORKX+2    MOVE LENGTH TO LINEPUT LINE.
         SRL   R1,10               DIVIDE BY 1024 (2**10).
*        A     R1,SPOKLNGH         ACCUMULATE SUBPOOL LENGTH  IN K
*        ST    R1,SPOKLNGH         ACCUMULATE SUBPOOL LENGTH  IN K
         CVD   R1,WORKX            DECIMALIZE LENGTH/1024.
         UNPK  LINEALLK(5),WORKX+5(3)   UNPACK LENGTH.
         OI    LINEALLK+4,C'0'       FIX SIGN.
         MVI   LINEALLK+5,C'K'
         L     R1,8(,R5)           LOAD ADDRESS OF STORAGE BLOCK.
         BAL   R14,LINEHEX         HEXIFY ADDRESS.
         MVC   LINEALLA(6),WORKX+2   MOVE ADDRESS TO LINEPUT LINE.
         BAL   R7,DISPLYD
FQE0     L     R6,0(,R5)           POINT TO FIRST FQE.
FQELOOP  LA    R6,0(,R6)           CLEAR HIGH BYTE.
         LTR   R6,R6               ANY MORE FREE AREAS IN BLOCK?
         BNZ   FQE1                B IF YES.
DQEBUMP  L     R5,4(,R5)           POINT TO NEXT DQE.
         B     DQELOOP             LOOP.
FQE1     L     R1,8(,R6)           LOAD HIGH ADDRESS PLUS 1.
         BCTR  R1,*-*              MAKE IT REAL HIGH ADDRESS.
*        BAL   R14,LINEHEX         HEXIFY HIGH ADDRESS.
*        MVC   LNE3TOP(6),WORKX+2    MOVE TO LINEPUT AREA.
         S     R1,4(,R6)           SUBTRACT LENGTH FROM HIGH ADDR.
         LA    R1,1(,R1)           ADD ONE TO GEN. LOW ADDRESS.
         BAL   R14,LINEHEX         HEXIFY LOW ADDRESS.
*        MVC   LNE3BOT(6),WORKX+2    MOVE TO LINEPUT AREA.
         MVC   LINEFREA(6),WORKX+2    MOVE TO LINEPUT AREA.
         L     R1,4(,R6)           LOAD LENGTH.
         BAL   R14,LINEHEX         HEXIFY LENGTH.
         MVC   LINEFREE(6),WORKX+2    MOVE TO LINEPUT AREA.
         SRL   R1,10               DIVIDE BY 1024.
         CVD   R1,WORKX            DECIMALIZE LENGTH/1024.
         UNPK  LINEFREK(5),WORKX+5(3)   UNPACK TO LINEPUT AREA.
         OI    LINEFREK+4,C'0'       FIX SIGN.
         MVI   LINEFREK+5,C'K'
         BAL   R7,DISPLYD
         L     R6,0(,R6)           POINT TO NEXT FQE.
         B     FQELOOP             LOOP.
         SPACE 2
         TITLE 'SMAP - HEX LINEPUT RLINEINE.'
LINEHEX  ST    R1,WORKX
         MVO   WORKX1,WORKX(4)     MOVE OVER TO ALLOW FOR SIGN.
         UNPK  WORKX,WORKX1+3(5)   SEPARATE NIBBLES.
         NC    WORKX,=8X'0F'       KILL ZONES.
         TR    WORKX,=C'0123456789ABCDEF' TRANSLATE TO HEX GRAPHICS.
         BR    14                  RETURN
         SPACE 3
CSARTN   EQU   *
         LM    R2,R5,SAVEASCB
         L     R15,SAVER15
         BR    R15
 EJECT
*  SUBROUTINE TO FIND JOBS ON JES INITIATORS
*
INIT     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,CSALINE MOVE CSALINE TO HEADER
         MVC   QDHLINE(80),HEADER  HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    INITLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
INITLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    INITINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BZ    INITINCR       YES
INITLINE MVC   LINEJOBN,0(R6) MOVE JOBNAME
         BAL   R15,CSA        COMMON INFO
         BAL   R7,DISPLAY
INITINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,INITLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
*  SUBROUTINE TO PARSE INPUT AND TO PERFORM THE REQUESTS
*
PRSE     EQU   *
         USING QCKPT,R9
         L     R9,QVCKPT
         LA    R3,QDREPLY
         AH    R3,QOFF1
PRSE1    EQU   *
         LH    R2,QDRLNG         CHANGE IN PARM STRING (NON BLANK)
         LTR   R2,R2
         BNZ   PRSEWHAT         CHECK FOR  PARM STRING
*  CURRENT REQUEST IS SAVED....
         TM    ASIDFLG2,X'01'   CURRENT REQUEST WAS ASID *
         BO    PRSE3
         TM    ASIDFLG2,X'02'   CURRENT REQUEST  WAS ASID #/STC/TS/JOBS
         BO    PRSEASID
*  NEW REQUEST IS ENTERED..
PRSEWHAT CLI   0(R3),C'*'
         BE    PRSE3
         CLC   0(3,R3),=CL3'ALL'
         BE    PRNODEFA
         CLC   0(3,R3),=CL3'STC'
         BE    PRNOSTC
         CLC   0(4,R3),=CL4'JOBS'
         BE    PRNOJOBS
         CLC   0(2,R3),=CL2'TS'
         BE    PRNOTSO
         CLC   0(2,R3),=CL2'AS' QUEUE GIVE NO PARM STRING BUT COMMAND
         BE    PRNODEFA
         CLI   0(R3),C' '
         BE    PRNODEFA
* CHECK ASID NUMERICAL STRING
PRSENUM  EQU   *
         LA    R5,12             GET REPLY LENGTH
         LA    R4,0              RESET TO ZERO
PRSECHK  CLI   0(R3),X'00'       LOOK FOR BLANK OR NULL
         BE    PRSEEND           YES, FOUND
         CLI   0(R3),X'40'       LOOK FOR BLANK OR NULL
         BE    PRSEEND           YES, FOUND
         LA    R4,1(R4)
PRSENEXT LA    R3,1(R3)
         BCT   R5,PRSECHK
         B     PRNODEFA           ERROR - GO TO ASID ALL AS DEFAULT
PRSEEND  LTR   R4,R4              EMPTY?
         BZ    PRSENEXT           NEXT CHAR
         LR    R2,R4
         LA    R3,QDREPLY
         AH    R3,QOFF1
         STH   R2,ASIDNO+4
         BCTR  R2,0
         EX    R2,MVC
         LA    R3,ASIDNO
         MVC   QFZONES,QFZONE
         EX    R2,MVZ
         CLC   QFZONES,QFZONE
         BNE   PRSERM
         MVC   TYPE(2),=H'1' DEFAULT FOR ALL
         B     PRSEASID
*        EX    R2,PACK2
*        CVB   R2,DWORD
*        MVC   ASIDNO(4),DWORD+4
PRSE2    LA    R3,ASIDNO      ADDR OF ASIDNO
         CLI   0(R3),C'*'     WANT ONLY CURRENT USER?
         BNE   PRSEASID       NO
PRSE3    L     R3,16          CVT ->
         L     R3,0(R3)       TCB CURRENT - OLD POINTER
         L     R3,8(R3)       ASCB CURRENT - OLD POINTER
         LH    R3,36(R3)      ASCBASID
         STH   R3,ASIDNMBR    SAVE ASID NUMBER
         LA    R3,4           TSO TYPE NUMBER
         STH   R3,TYPE        SAVE TYPE
         MVI   ASIDFLG2,X'01'
         B     PSRESTFL
PRNODEFA MVC   TYPE(2),=H'1' DEFAULT FOR ALL
         B     PRNOASID
PRNOSTC  MVC   TYPE(2),=H'2'
         B     PRNOASID
PRNOJOBS MVC   TYPE(2),=H'3'
         B     PRNOASID
PRNOTSO  MVC   TYPE(2),=H'4'
PRNOASID MVC   ASIDNO(4),=CL4'   0'
         MVC   ASIDNO+4(2),=H'4'
         B     PRSEASID
PRSTASID MVC   ASIDNO(4),=CL1'*'
         MVC   ASIDNO+4(2),=H'1'
         B     PRSE2
MVC      MVC   ASIDNO(*-*),0(R3)
MVZ      MVZ   QFZONES(*-*),0(R3)
PACK2    PACK  DWORD(8),0(0,R3)
         SPACE 1
PRSEASID LH    R3,ASIDNO+4    LENGTH OF ASIDNO
         BCTR  R3,0           DECREMENT BY 1
         LA    R4,X'70'       LENGTH OF WORKX - 1
         OR    R3,R4          LENGTHS FOR PACK INSTR.
         LA    R4,ASIDNO      ADDR OF ASIDNO
         EX    R3,PACK        PACK ASIDNO
         CVB   R3,WORKX       CONVERT ASID TO BINARY
         C     R3,ASCBMAX     DOES ASIDNO EXISTS?
         BH    PRSEMXER       NO SAY SO AND QUIT
         STH   R3,ASIDNMBR    SAVE ASID NUMBER
         MVI   ASIDFLG2,X'02'
         LTR   R3,R3          ASIDNO = 0 ?
         BZ    PRSEBRTB       YES GO TO PARSE BRANCH TABLE
PSRESTFL MVI   ASIDFLAG,ON    NO TURN ASID FLAG ON
PRSEBRTB LH    R3,TYPE        PICK UP TYPE
         SLL   R3,2           MULT. BY 4
         B     *+0(R3)        BRANCH TABLE
         B     PRSEALL        TYPE = 1
         B     PRSESTRT       TYPE = 2
         B     PRSEINIT       TYPE = 3
         B     PRSETSO        TYPE = 4
PRSEALL  BAL   R14,STRT
         BAL   R14,INIT
         BAL   R14,TSOJ
         B     RETURN
PRSETSO  BAL   R14,TSOJ
         B     RETURN
PRSEINIT BAL   R14,INIT
         B     RETURN
PRSESTRT BAL   R14,STRT
         B     RETURN
 EJECT
PRSERM   QTILT '***** ASID: INVALID PARSE STRING *****'
         SPACE 3
PRSEMXER L     R3,ASCBMAX     MAX ASCB
         MVC   LINE,PRSEMXTP
         CVD   R3,WORKX       CONVERT TO DECIMAL
         MVC   CHAR,EDMSK1    MOVE EDIT MASK TO CHAR
         ED    CHAR,WORKX+4   EDIT TO EBCDIC
         MVC   LINE+27(4),CHAR+4 MOVE FOUR CHARS TO LINE
         BAL   R7,DISPLAY     SET UP FOR TPUT
         B     RETURN
         DROP  R9
         SPACE 3
PACK     PACK  WORKX,0(0,R4)
*
PRSEMXTP DC    CL80'MAXIMUM NUMBER OF ASCBS IS'
 EJECT
*  SUBROUTINE TO TEST IF APPROPRIATE HEADER HAS BEEN PRINTED
*             AND THEN PRINT CURRENT LINE
*
***********************************************************************
*   LOCAL SUBROUTINE TO PUT LINE LINE VIA Q DISPLAY                 NTL
***********************************************************************
DISPLYD  MVC   QDMSG(80),LDMSG
         B     DISPLAY
DISPBLNK MVC   QDMSG,QBLANK   CLEAR LINE MESSAGE                    NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
 EJECT
*  SUBROUTINE TO FIND STARTED TASKS
*
STRT     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,CSALINE MOVE CSALINE TO HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         MVC   QDHLINE(80),HEADER  HEADER
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    STRTLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
STRTLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    STRTINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BNZ   STRTINCR       NO
         L     R6,ASCBCSCB    ASCBCSCB ->
         USING CSCB,R6
         LTR   R6,R6          ZERO?
         BZ    STRTLINE       YES SYSTEM TASK
         TM    CHPKE,CHTSID   TSO JOB?
         DROP  R6
         BO    STRTINCR       YES
STRTLINE L     R6,ASCBJBNS    JOB NAME FOR STARTED TASK
         MVC   LINEJOBN,0(R6) MOVE JOBNAME
         BAL   R15,CSA
         BAL   R7,DISPLAY
STRTINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,STRTLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
*  SUBROUTINE TO FIND TSO USERS
*
TSOJ     EQU   *
         ST    R14,SAVER14
         MVC   HEADER,CSALINE MOVE CSALINE TO HEADER
         MVI   HEADERSW,OFF   SET HEADERSW TO OFF
         MVC   QDHLINE(80),HEADER  HEADER
         L     R2,ASCBONE     FIRST ASCB ->
         LA    R3,0           SET R3 = 0
         L     R4,ASCBMAX     MAX NO. OF ASCB
         TM    ASIDFLAG,ON    WAS ASID=0
         BZ    TSOJLOOP       YES
         LH    R2,ASIDNMBR    NO, PICK UP ASID NUMBER
         SLL   R2,2           MULT. BY 4
         A     R2,ASCBONE     FIND CORRECT ASCB
         LH    R3,ASIDNMBR    PICK UP ASID NUMBER
         LA    R4,1           NULLIFY LOOP
TSOJLOOP TM    0(R2),X'80'    ASID IN USE?
         BO    TSOJINCR       NO
         L     R5,0(R2)       BEGINNING OF ASCB
         L     R6,ASCBJBNI    JOB NAME FOR INIT PGMS
         LTR   R6,R6          ZERO?
         BNZ   TSOJINCR       NO
         L     R6,ASCBCSCB    ASCBCSCB ->
         USING CSCB,R6
         LTR   R6,R6          ZERO?
         BZ    TSOJINCR       YES SYSTEM TASK
         TM    CHPKE,CHINITID INTIT?
         BO    TSOJINCR       YES
         TM    CHPKE,CHTSID   TSO JOB?
         BNO   TSOJINCR       NO
TSOJLINE MVC   LINEJOBN,CHKEY MOVE JOBNAME
         DROP  R6
         BAL   R15,CSA
         BAL   R7,DISPLAY
TSOJINCR LA    R3,1(R3)       ADD ONE TO R3
         LA    R2,4(R2)       NEXT ASCB ENTRY
         BCT   R4,TSOJLOOP
         L     R14,SAVER14
         BR    R14            RETURN
 EJECT
CSALINE  DC    CL80' '
         ORG   CSALINE            RESET ADDRESSABILITY
         DC    C'ID NAME     KEY SPOOL ALLOCATION   '
*                12 12345678 1   123   123456 12345K
         DC    C'FREE  '
*                123456 12345K
         ORG
EDMSK1   DC    XL8'4020202020202120'
EDMSK2   DC    XL8'4020202020212020'
OFF      EQU   X'00'
ON       EQU   X'01'
LINE     EQU   LDMSG+00,80
LINEASID EQU   LDMSG+00,2
LINEJOBN EQU   LDMSG+03,8
LINEKEY  EQU   LDMSG+12,1
LINESPOL EQU   LDMSG+16,3
LINEALLA EQU   LDMSG+22,6
LINEALLO EQU   LDMSG+29,6
LINEALLK EQU   LDMSG+36,5
LINEFREA EQU   LDMSG+43,6
LINEFREE EQU   LDMSG+50,6
LINEFREK EQU   LDMSG+57,5
*        ------------------------------
LINE1    EQU   LNE1ADDR
LNE1ADDR EQU   LDMSG+60,6
LNE1LEN  EQU   LDMSG+67,6
LNE1K    EQU   LDMSG+74,5
LNE1L    EQU   *-LINE1
*        ------------------------------
LINE2    EQU   LNE2ADDR
LNE2ADDR EQU   LDMSG+60,6
LNE2LEN  EQU   LDMSG+67,6
LNE2K    EQU   LDMSG+74,5
LNE2L    EQU   *-LINE2
*        ------------------------------
LINE3    EQU   LNE3BOT
LNE3BOT  EQU   LDMSG+50,6
LNE3TOP  EQU   LDMSG+57,6
LNE3LEN  EQU   LDMSG+64,6
LNE3K    EQU   LDMSG+71,5
LNE3L    EQU   *-LINE3
*        ------------------------------
LINE4    EQU   LNE4ADDR
LNE4ADDR EQU   LDMSG+60,6
LNE4NAME EQU   LDMSG+67,8
LNE4L    EQU   *-LINE4
*        ------------------------------
         LTORG
 EJECT
*   CSCB
         PRINT NOGEN
CSCB     DSECT
         IEECHAIN
 EJECT
*   ASCB
         IHAASCB
 EJECT
*   OUCB
         IRAOUCB
 EJECT
*   OUXB
         IHAOUXB
 EJECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
WORKX1   DS    D
DWORD    DS    D
CHAR     DS    D
SAVER14  DS    F
SAVER15  DS    F
SAVEASCB DS    4F R2,R3,R4,R5
ASCBONE  DS    F
ASCBMAX  DS    F
ECB      DS    F
ASIDNO   DS    2F
ASIDNMBR DS    H
TYPE     DS    H
HEADERSW DS    C
ASIDFLAG DS    X
ASIDFLG2 DS    X
HEADER   DS    CL80
LDMSG    DS    CL80
         END
./       ADD   NAME=AUTH
AUTH     TITLE 'AUTHORIZATION MODULE FOR THE QUEUE COMMAND'       ONL02
******************************************************************ONL02
*                                                                 ONL02
* MODULE NAME = AUTH                                              ONL02
*                                                                 ONL02
* DESCRIPTIVE NAME = AUTHORIZATION MODULE FOR THE QUEUE COMMAND   ONL02
*                                                                 ONL02
* AUTHOR = ROBERT M. JINKINS                                      ONL02
*          OAK RIDGE NATIONAL LABORATORY                          ONL02
*          BLDG. 4500-N  MS-259                                   ONL02
*          P.O. BOX X                                             ONL02
*          OAK RIDGE, TENNESSEE  37830                            ONL02
*                                                                 ONL02
*          PHONE: (615) 574-7208/5300                             ONL02
*                  FTS  624-7208/5300                             ONL02
*                                                                 ONL02
*          SHARE INSTALLATION CODE = OR                           ONL02
*                                                                 ONL02
* DATE WRITTEN = JUNE 83                                          ONL02
*                                                                 ONL02
* FUNCTION = TO PROVIDE A SECURITY FUNCTION WHICH CONTROLS THE    ONL02
*    USE THE TSO QUEUE COMMAND, ITS SUB-COMMANDS, AND THE JOBS    ONL02
*    OR DATASETS A USER MAY ACCESS, CHANGE, OR DELETE.  THE AUTH  ONL02
*    CSECT IS INVOKED AT VARIOUS POINTS DURING QUEUE COMMAND      ONL02
*    PROCESSING VIA A QAUTHCK MACRO.                              ONL02
*                                                                 ONL02
* DEFAULT OPERATION = THE DEFAULT AUTHORITY CHECKING FOR THE      ONL02
*    QUEUE COMMAND IS AS FOLLOWS:                                 ONL02
*                                                                 ONL02
*    (1) THE START-UP ENTRY FROM THE INIT CSECT GIVES JES2        ONL02
*        SYSTEM PROGRAMMER AUTHORITY TO ANYONE HAS OPERATOR       ONL02
*        AUTHORITY.  SINCE JES2 SYSTEM PROGRAMMER AUTHORITY HAS   ONL02
*        GREAT POWER, MANY USERS WILL PROBABLY WANT TO CHANGE     ONL02
*        THIS TO SUIT THE REQUIREMENTS OF THEIR INSTALLATION.     ONL02
*        THE SAME CONSIDERATIONS APPLY TO EXEC AUTHORITY (THE     ONL02
*        ABILITY TO ISSUE TSO COMMANDS WHILE IN QUEUE) BECAUSE    ONL02
*        THE QUEUECMN AREA COULD BE ALTERED BY USER PROGRAMS      ONL02
*        EXECUTING IN THAT ENVIRONMENT.                           ONL02
*                                                                 ONL02
*    (2) THE START-UP ENTRY FROM THE INIT CSECT ALSO ISSUES A     ONL02
*        TESTAUTH MACRO.  IF THE QUEUE COMMAND IS NOT APF         ONL02
*        AUTHORIZED, THEN THE AUTHORITY FOR USING THE SUB-SYSTEM  ONL02
*        INTERFACE COMMANDS IS TURNED OFF.                        ONL02
*                                                                 ONL02
*    (3) THE START-UP ENTRY FROM THE INIT CSECT ALSO SETS THE     ONL02
*        HELP CONTROL FLAGS FROM THE AUTHORIZATION FLAGS.  SEE    ONL02
*        THE HELP CSECT FOR MORE INFORMATION ON THE HELP CONTROL  ONL02
*        FLAGS.                                                   ONL02
*                                                                 ONL02
*    (4) THE ENTRY FROM THE PARSE ROUTINE IS USED TO DETERMINE    ONL02
*        WHO MAY USE A GIVEN QUEUE SUB-COMMAND.  A SUB-COMMAND    ONL02
*        IS ALLOWED TO PROCEED IF ALL SUB-COMMAND TYPE            ONL02
*        RESTRICTIONS ('TYPE=' CODED IN THE QSCE MACRO) HAVE      ONL02
*        CORRESPONDING AUTHORIZATION BITS SET ON IN THE           ONL02
*        AUTHORIZATION FLAGS (QAFLAGS).                           ONL02
*                                                                 ONL02
*    (5) THE ENTRY FROM THE FINDJOB ROUTINE IS ENTERED FOR ANY    ONL02
*        JOB WHOSE INPUT/OUTPUT IS TO BE ACCESSED BY A QUEUE      ONL02
*        COMMAND FUNCTION.  THE FUNCTION IS ALLOWED TO PROCEED    ONL02
*        IF THE JOBNAME BEGINS WITH THE USER'S USERID OR IF THE   ONL02
*        USER HAS OPERATOR OR JES2 SYSTEM PROGRAMMER AUTHORITY.   ONL02
*        ALTHOUGH THE ENTRY FROM THE FINDJOB ROUTINE MAY ALLOW    ONL02
*        THE FUNCTION TO PROCEED, OTHER ENTRIES MAY FUTHER        ONL02
*        RESTRICT THE ACCESS GRANTED BY THIS ENTRY.               ONL02
*                                                                 ONL02
*    (6) THE LIST COMMAND MAY NOT LIST DATASET ID'S LESS THAN     ONL02
*        101 UNLESS THE USER HAS JES2 SYSTEM PROGRAMMER           ONL02
*        AUTHORITY.                                               ONL02
*                                                                 ONL02
*    (7) THE DEL, REQ, AND CAN COMMANDS MAY NOT ACCESS A JOB      ONL02
*        WHOSE JOBNAME DOES NOT BEGIN WITH THE USER'S USERID      ONL02
*        UNLESS THEY HAVE JES2 SYSTEM PROGRAMMER AUTHORITY.       ONL02
*                                                                 ONL02
* OPTIONAL OPERATION = CONDITIONAL ASSEMBLY OPTIONS ALTER THE     ONL02
*    DEFAULT OPERATION OF THE QUEUE COMMAND AS SHOWN BELOW:       ONL02
*                                                                 ONL02
*    FCI01  --  IF THE &QACF2 OPTION IS SET, THEN THE ENTRY FROM  FCI01
*               FINDJOB ALLOWS THE FOLLOWING:                     FCI01
*                                                                 FCI01
*                (1) USER WITH OPER AUTH MAY LOOK AT ANY JOB.     FCI01
*                (2) USER MAY LOOK AT OWN JOBS (USERID MATCHES    FCI01
*                    LOGONID IN JOB'S JCT).                       FCI01
*                (3) ACFSVC ISSUED TO CHECK ALL OTHER ACCESSES.   FCI01
*                                                                 FCI01
*    RNB03  --  IF THE &QRACF OPTION IS SET, THEN:                RNB03
*                                                                 RNB03
*                (1) THE CHECKPOINT/SPOOL PRE-OPEN ENTRY CHANGES  RNB03
*                    THE USERID IN THE ACEE TO ALLOW THE DATASETS RNB03
*                    TO BE OPENED IF WE ARE APF AUTHORIZED, RACF  RNB03
*                    IS UP, AND &QRACUSR IS NOT NULL.  THE POST-- RNB03
*                    OPEN ENTRY FROM INIT RESTORES THE ORIGINAL   RNB03
*                    USERID.  ATTENTION INTERRUPTS ARE INHIBITED  RNB03
*                    DURING THIS INTERVAL.                        RNB03
*                                                                 RNB03
*                (2) THE ENTRY FROM READSPC ZEROS THE OLD AND     RNB03
*                    NEW PASSWORDS FIELDS WHEN JCT'S ARE READ     RNB03
*                    FROM SPOOL.                                  RNB03
*                                                                 RNB03
*                (3) THE ENTRY FROM PARSE IS USED TO PROCESSE     RNB03
*                    THE XP COMMAND.  A RACHECK MACRO IS ISSUED   RNB03
*                    TO DETERMINE IF THE USER SHOULD BE GIVEN     RNB03
*                    JES2 SYSTEM PROGRAMMER AUTHORITY.            RNB03
*                                                                 RNB03
*                (4) THE ENTRY FROM FINDJOB ONLY CHECKS FOR       RNB03
*                    ACCESSES MADE BY THE XD COMMAND AND USES A   RNB03
*                    RACHECK MACRO TO CONTROL AND LOG ITS USE.    RNB03
*                                                                 RNB03
*    RNB05  --  IF THE &QRNB OPTION IS SET, THEN:                 RNB05
*                                                                 RNB05
*                (1) THE START-UP ENTRY SETS THE AUTHORITY AND    RNB05
*                    HELP DISPLAY CONTROL FLAGS FOR THE RNB       RNB05
*                    ENVIRONMENT.                                 RNB05
*                                                                 RNB05
*                (2) THE LIST COMMAND CAN NEVER BE USED FOR       RNB05
*                    DSID'S LESS THAN 101.  THE XD COMMAND        RNB05
*                    MUST BE USED INSTEAD.                        RNB05
*                                                                 RNB05
*                (3) SPECIAL USERID/JOBNAME/NOTIFY CHECKING IS    RNB05
*                    USED TO CONTROL DATASET ACCRESS BY THE LIST  RNB05
*                    COMMAND (SEE COMMENTS IN THE CODE).          RNB05
*                                                                 RNB05
*    RNB06  --  IF THE &QRNB OPTION IS SET, THEN THE ENTRY FROM   RNB06
*               PARSE INHIBITS THE MODEL, TSO, AND EXEC COMMANDS. RNB06
*                                                                 RNB06
*    RNB08  --  IF THE &QRNB OPTION IS SET, THEN THE ENTRY FROM   RNB08
*               SYSOUT (THE DEL, REQ, AND CAN COMMANDS) IS USED   RNB08
*               TO PERFORM SPECIAL USERID/JOBNAME/NOTIFY/USER=    RNB08
*               CHECKING (SEE COMMENTS IN THE CODE).              RNB03
*                                                                 RNB08
*    ONL06  --  IF THE &QONL OPTION IS SET, JES2 SYSTEM           ONL06
*               PROGRAMMER AUTHORITY IS ONL GRANTED ONLY IF THE   ONL06
*               USER HAS OPERATOR AUTHORITY AND THEIR USERID      ONL06
*               IS CONTAINED IN A TABLE IN THIS ASSEMBLY.         ONL06
*                                                                 ONL06
*    DOR    --  IF THE &QTSS OPTION IS SET, JES2 SYSTEM
*               PROGRAMMER AUTHORITY IS  GRANTED ONLY IF THE
*               USER HAS OPERATOR AUTHORITY AND THEIR USERID
*               IS CONTAINED IN A TABLE IN THIS ASSEMBLY.
*               TSS DOES NOT SUPPORT TESTAUTH.
*
*                                                                 ONL06
* CHANGE ACTIVITY = NONE                                          ONL02
*                                                                 ONL02
******************************************************************ONL02
         EJECT ,                                                  ONL02
         GBLB  &QSP                MVS/SP LEVEL OF JES2           ONL02
         GBLB  &QACF2              ACF2 OPTION                    FCI01
         GBLB  &QRACF              RACF OPTION                    RNB03
         GBLB  &QRNB               RNB OPTION                     RNB05
         GBLB  &QONL               ONL OPTION                     ONL06
         GBLB  &QTSS              TSS OPTION                      DOR
         GBLB  &QSP136            SP 1.3.6 OPTION                 DOR
         SPACE 1                                                  FCI01
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET                 FCI01
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  DO ENTRY POINT HOUSEKEEPING FOR THE AUTH CSECT                 ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
AUTH     QSTART HASPEQU=YES,       START AUTH CSECT ASSEMBLY      DOR XX
               XTITLE='AUTHORIZATION MODULE FOR THE QUEUE COMMAND'
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  SETUP ADDRESSABILITY FOR COMMON SUB-AREAS AND SAVE/WORK AREA   ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         USING WORK,R13            NOTE SAVE/WORK ADDRESSABILITY  ONL02
         SPACE 1                                                  ONL02
         L     R10,QVDAIR          ADDR OF DAIR WORK AREA         ONL02
         USING QDAIR,R10           NOTE DAIR WORK ADDRESSABILITY  ONL02
         SPACE 1                                                  ONL02
         L     R9,QVCKPT           ADDR OF CKPT WORK AREA         ONL02
         USING QCKPT,R9            NOTE CKPT WORK ADDRESSABILITY  ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  VALIDATE AUTHORIZATION REQUEST CODE AND ENTER PROCESSING RTN   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         CLI   QACODE,MAXCODE      IS REQUEST CODE WITHIN RANGE ? ONL02
         BH    BOMB                ERROR IF NO                    ONL02
         SPACE 1                                                  ONL02
         SLR   R15,R15             ENTER                          ONL02
         IC    R15,QACODE           PROCESSING ROUTINE            ONL02
         SLL   R15,2                 PER                          ONL02
         B     VECTOR(R15)            AUTHORIZATION REQUEST CODE  ONL02
         SPACE 1                                                  ONL02
VECTOR   DS    0H                  AUTH REQUEST CODE VECTOR       ONL02
         B     Q#NULL           0  NULL REQUEST                   ONL02
         B     Q#START          1  QUEUE COMMAND START-UP         ONL02
         B     Q#END            2  QUEUE COMMAND TERMINATION      ONL02
         B     Q#ALLOC          3  DATASET ALLOCATION/UNALLOCATIONONL02
         B     Q#BEFOPN         4  BEFORE CKPT/SPOOL OPEN         ONL02
         B     Q#AFTOPN         5  AFTER CKPT/SPOOL OPEN          ONL02
         B     Q#SPOOL          6  READSPC RTN (AFTER SPOOL I/O)  ONL02
         B     Q#PARSE          7  QUEUE SUBCOMMAND AUTHORIZATION ONL02
         B     Q#FINDJ          8  FINDJOB RTN FOR JOB            ONL02
         B     Q#JCL            9  JCL CMD FOR JOB                ONL02
         B     Q#JLOG          10  JLOG CMD FOR JOB               ONL02
         B     Q#JMSG          11  JMSG CMD FOR JOB               ONL02
         B     Q#LIST          12  LIST CMD FOR JOB/DSID          ONL02
         B     Q#JHIST         13  JHIST CMD FOR JOB              ONL02
         B     Q#DD            14  DD CMD FOR JOB                 ONL02
         B     Q#PDDB          15  PDDB CMD FOR JOB               ONL02
         B     Q#SYSOUT        16  DEL/REQ/CAN CMDS FOR JOB       ONL02
         B     Q#SYSLOG        17  AUTHORIZATION TO LOOK AT SYSLOGONL02
         SPACE 1                                                  ONL02
MAXCODE  EQU   (*-4-VECTOR)/4      MAX SUPPORTED REQUEST CODE     ONL02
         SPACE 1                                                  ONL02
BOMB     DS    0H                  INVALID AUTH REQUEST CODE      ONL02
         WTO   'QUEUE COMMAND INTERNAL LOGIC ERROR IN AUTH RTN',  ONL02X
               ROUTCDE=11                                         ONL02
         SPACE 1                                                  ONL02
         ABEND 913                 ABEND U0913                    ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = NULL REQUEST                            ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#NULL   DS    0H                  NULL REQUEST                   ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE COMMAND START-UP                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#START  DS    0H                  QUEUE COMMAND START-UP         ONL02
         SPACE 1                                                  ONL02
         AIF   (&QTSS).ONL06S1 DOR
*        AIF   (&QONL).ONL06S1                                    ONL06
         AIF   (&QRNB).RNB05S1                                    RNB05
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY GIVES JES2 SYSTEM PROGRAMMER   ONL02
*  AUTHORITY AND THE ABILITY TO ISSUE TSO COMMANDS FROM QUEUE     ONL02
*  TO ANYONE WHO HAS OPERATOR AUTHORITY.                          ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXOPER    DOES USER HAVE OPER AUTHORITY? ONL02
         BZ    QSNOOPER            SKIP IF NO                     ONL02
         OI    QAFLAGS,QAFXSYSP+QAFXEXEC  GIVE USER UNLIMITED AUTHONL02
QSNOOPER DS    0H                                                 ONL02
         SPACE 2                                                  ONL02
         AGO   .ONL06S2                                           ONL06
.ONL06S1 ANOP  ,                                                  ONL06
*                                                                 ONL06
*  AT ONL, USERS ARE DIVIDED INTO THREE GROUPS:                   ONL06
*  AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
*                                                                 ONL06
*    (1) ORDINARY USERS                                           ONL06
*    (2) USERS WITH THE TSO OPERATOR PRIVILEGE                    ONL06
*    (3) JES2 SYSTEM PROGRAMMERS                                  ONL06
*                                                                 ONL06
*  THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:     ONL06
*                                                                 ONL06
*    AUTHORIZATION    ----GROUP----    DESCRIPTION                ONL06
*    -------------    (1)  (2)  (3)    -------------------------  ONL06
*      QAFXACTV             X    X     DISPLAY ACTIVE LISTS       ONL06
*      QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS      ONL06
*      QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ        ONL06
*      QAFXSLOG             X    X     MAY LOOK AT SYSLOG         ONL06
*      QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE  ONL06
*      QAFXOPER             X    X     OPERATOR AUTHORITY         ONL06
*      QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER     ONL06
*                                                                 ONL06
*  A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY        ONL06
*  IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO       ONL06
*  CONTAINED IN A TABLE BELOW (SEE SYMBOL SYSPTABL).              ONL06
*                                                                 ONL06
         SPACE 1                                                  ONL06
         NI    QAFLAGS,QAFXOPER    CLEAR ALL BUT OPER AUTHORITY   ONL06
         OI    QAFLAGS,QAFXSSSM+QAFXBLOG          GRP 1 AUTH      DOR
         SPACE 1                                                  ONL06
         TM    QAFLAGS,QAFXOPER    DOES USER HAVE OPER AUTHORITY? ONL06
         BZ    QSNOOPER            SKIP IF NO                     ONL06
         SPACE 1                                                  ONL06
         OI    QAFLAGS,QAFXACTV+QAFXBLOG+QAFXSLOG ADD GROUP 2 AUTHONL06
         SPACE 1                                                  ONL06
         LA    R2,SYSPTABL         ADDR OF JES2 SYSTEM PGMR TABLE ONL06
         SPACE 1                                                  ONL06
QSNEXTSP DS    0H                  CHECK NEXT SYSTEM PGMR ENTRY   ONL06
         CLI   0(R2),X'FF'         END OF TABLE ?                 ONL06
         BE    QSNOSYSP            SKIP IF YES                    ONL06
         CLC   QLOGON,0(R2)        DOES USERID MATCH TABLE ENTRY? ONL06
         BE    QSSPHIT             SKIP IF YES                    ONL06
         LA    R2,8(,R2)           BUMP ADDR TO NEXT ENTRY        ONL06
         B     QSNEXTSP            LOOP TO CHECK NEXT ENTRY       ONL06
         SPACE 1                                                  ONL06
SYSPTABL DS    0CL8                USERID'S OF JES2 SYSTEM PGMR'S ONL06
         DC    CL8'DOR'                                           ONL06
         DC    CL8'DRC'                                           ONL06
         DC    CL8'EAG'                                           ONL06
         DC    CL8'IWL'                                           ONL06
         DC    CL8'ETA'                                           ONL06
         DC    CL8'BLR'                                           ONL06
         DC    CL8'RON'                                           ONL06
         DC    CL8'SPW'                                           ONL06
         DC    CL8'TLD'                                           ONL06
         DC    CL8'DET'                                           ONL06
         DC    X'FF'               FLAG END OF TABLE              ONL06
         SPACE 1                                                  ONL06
QSSPHIT  DS    0H                  USER ID FOUND IN SYS PGMR TABLEONL06
         OI    QAFLAGS,QAFXSYSP+QAFXEXEC  SET JES2 SYS-PGMR & EXECONL06
         OI    QAFLAGS,QAFXSSSM    ASSUME GROUP 1 AUTHORITY       ONL06
QSNOSYSP DS    0H                  CONT HERE IF NOT JES2 SYS PGMR ONL06
QSNOOPER DS    0H                  CONT HERE IF NO OPER AUTHORITY ONL06
         SPACE 1                                                  ONL06
.RNB05S1 AIF   (NOT &QRNB).RNB05S2                                RNB05
         SPACE 1                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE AUTHORIZATION FLAGS ARE SET AS FOLLOWS:            RNB05
*                                                                 RNB05
         MVI   QAFLAGS,QAFXACTV+QAFXBLOG+QAFXSSSM+QAFXSLOG        RNB05
         SPACE 1                                                  RNB05
.RNB05S2 ANOP  ,                                                  RNB05
.ONL06S2 ANOP  ,                                                  ONL06
         AIF   (&QTSS).CDS06S1 DOR
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY TURNS OF AUTHORITY FOR THE     ONL02
*  SUB-SYSTEM INTERFACE COMMANDS IF THE QUEUE COMMAND IS NOT      ONL02
*  APF AUTHORIZED.                                                ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TESTAUTH FCTN=1           TEST FOR APF AUTHORIZATION     ONL02
         SPACE 1                                                  ONL02
         LTR   R15,R15             ARE WE APF AUTHORIZED?         ONL02
         BZ    QSNOTAPF            SKIP IF YES                    ONL02
         NI    QAFLAGS,255-QAFXSSSM  ELSE, TURN OFF SSSM AUTHORITYONL02
.CDS06S1 ANOP
QSNOTAPF DS    0H                                                 ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY SETS THE HELP CONTROL FLAGS    ONL02
*  FROM THE AUTHORITY FLAGS.                                      ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         MVC   QAHELP,QAFLAGS      SET HELP FLAGS PER AUTHORITY   ONL02
         SPACE 1                                                  ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE COMMAND TERMINATION               ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#END    DS    0H                  QUEUE COMMAND TERMINATION      ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DATASET ALLOCATION/UNALLOCATION         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#ALLOC  DS    0H                  DATASET ALLOCATION/UNALLOCATIONONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = PRE-OPEN FOR CHECKPOINT/SPOOL DATASETS  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#BEFOPN DS    0H                  BEFORE CKPT/SPOOL OPEN         ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03BO                               RNB03
         SPACE 1                                                  RNB03
         TESTAUTH FCTN=1           APF-AUTHORIZED?                RNB03
         LTR   R15,R15                                            RNB03
         BNZ   RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES -                         RNB03
         RACSTAT ,                 IS RACF UP?                    RNB03
         LTR   R15,R15                                            RNB03
         BNZ   RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES -                         RNB03
         CLI   QNEWUSR,0           IS THERE A NEW USERID TO USE?  RNB03
         BE    RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES - CHANGE ACEEUSER TO      RNB03
*                                         ALLOW ACCESS TO THE     RNB03
*                                         SPOOL/CKPT DATA SETS    RNB03
         L     R2,CVTPTR           CVT                            RNB03
         USING CVT,R2              #####                          RNB03
         L     R2,CVTTCBP          TCB WORDS                      RNB03
         L     R2,12(,R2)          CURRENT ASCB                   RNB03
         USING ASCB,R2             #####                          RNB03
         L     R2,ASCBASXB         ASXB                           RNB03
         USING ASXB,R2             #####                          RNB03
         ICM   R2,15,ASXBSENV      ACEE                           RNB03
         BZ    RNB03BO             FORGET IT IF NO ACEE           RNB03
         USING ACEE,R2             #####                          RNB03
         CLC   =C'ACEE',ACEEACEE   REALLY AN ACEE?                RNB03
         BNE   RNB03BO             /NO  - FORGET IT               RNB03
         MVC   QUSRSAV,ACEEUSER    /YES - SAVE CURRENT USERID     RNB03
         STAX  DEFER=YES           DON'T ALLOW ATTENTION'S        RNB03
         MODESET KEY=ZERO          GET KEY ZERO TO UPDATE ACEE    RNB03
         MVC   ACEEUSER,QNEWUSR    SET NEW USERID                 RNB03
         MODESET KEY=NZERO         BACK TO USER KEY               RNB03
RNB03BO  DS    0H                                                 RNB03
         DROP  R2                  #####                          RNB03
         SPACE 1                                                  RNB03
.RNB03BO ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = POST-OPEN FOR CHECKPOINT/SPOOL DATASETS ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#AFTOPN DS    0H                  AFTER CKPT/SPOOL OPEN          ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03AO                               RNB03
         SPACE 1                                                  RNB03
         CLI   QUSRSAV,0           DID WE CHANGE ACEEUSER?        RNB03
         BE    RNB03AO             /NO  - SKIP THIS CODE          RNB03
*                                  /YES - PUT USERID BACK         RNB03
         L     R2,CVTPTR           CVT                            RNB03
         USING CVT,R2              #####                          RNB03
         L     R2,CVTTCBP          TCB WORDS                      RNB03
         L     R2,12(,R2)          CURRENT ASCB                   RNB03
         USING ASCB,R2             #####                          RNB03
         L     R2,ASCBASXB         ASXB                           RNB03
         USING ASXB,R2             #####                          RNB03
         ICM   R2,15,ASXBSENV      ACEE                           RNB03
         USING ACEE,R2             #####                          RNB03
         MODESET KEY=ZERO          GET KEY ZERO TO UPDATE ACEE    RNB03
         MVC   ACEEUSER,QUSRSAV    SET OLD USERID                 RNB03
         MODESET KEY=NZERO         BACK TO USER KEY               RNB03
         STAX  DEFER=NO            ALLOW ATTENTION INTERRUPTS     RNB03
RNB03AO  DS    0H                                                 RNB03
         DROP  R2                  #####                          RNB03
         SPACE 1                                                  RNB03
.RNB03AO ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = READSPC ROUTINE (AFTER SPOOL I/O)       ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SPOOL  DS    0H                  READSPC RTN (AFTER SPOOL I/O)  ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03SR                               RNB03
*                                                                 RNB03
*  WIPE OUT THE OLD AND NEW PASSWORDS WHEN A JCT IS READ FROM     RNB03
*  THE SPOOL.                                                     RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         LR    R8,R1               COPY ADDR OF SPOOL BUFFER      RNB03
         AIF   (NOT &QSP136).NO136A DOR
         SL    R8,=A(JCTSTART-JCT)  ADJUST FOR BUFFER PREFIX DOR
         USING JCT,R8         NOTE JCT ADDRESSABILITY        DOR
         AGO   .X136A DOR
.NO136A  ANOP DOR
         SL    R8,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
.X136A   ANOP DOR
         SPACE 1                                                  RNB03
         CLC   JCTID,=CL4'JCT'     DID WE READ A JCT?             RNB03
         BNE   RNB03SRO            /NO  - FORGET IT               RNB03
         CLC   JCTJNAME,JCTJMRJN   JOB NAME IN BOTH PLACES?       RNB03
         BNE   RNB03SRO            /NO  - FORGET IT               RNB03
         CLC   =C'JOB ',JCTJOBID   IS IT AN STC, A JOB, OR A TSU? RNB03
         BE    RNB03SRJ            IF SO, ASSUME THIS IS A JCT    RNB03
         CLC   =C'TSU ',JCTJOBID                                  RNB03
         BE    RNB03SRJ                                           RNB03
         CLC   =C'STC ',JCTJOBID                                  RNB03
         BNE   RNB03SRO                                           RNB03
         SPACE 1                                                  RNB03
RNB03SRJ DS    0H                  THIS MUST BE A JCT             RNB03
         XC    JCTPASS,JCTPASS     WIPE OUT THE OLD AND           RNB03
         XC    JCTNUPAS,JCTNUPAS    NEW PASSWORDS                 RNB03
RNB03SRO DS    0H                  CONT. HERE IF NOT A GOOD JCT   RNB03
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB03
         SPACE 1                                                  RNB03
.RNB03SR ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE SUBCOMMAND AUTHORIZATION          ONL02
*                                                                 ONL02
*   THIS ENTRY IS USED TO CONTROL WHO CAN USE WHICH QUEUE         ONL02
*   SUB-COMMAND.  OTHER ENTRIES MAY FUTHER RESTRICT THE FUNCTION  ONL02
*   OF SOME SUB-COMMANDS.  INSTALLATIONS MAY TAYLOR THE FUNCTION  ONL02
*   OF THIS ENTRY BY ASSIGNING USER FLAGS IN THE PARSE TABLE      ONL02
*   (QSCE MACROS) AND BY INSERTING THEIR OWN CODE BELOW.          ONL02
*                                                                 ONL02
*   A SUB-COMMAND IS ALLOWED TO PROCEED IF ALL SUB-COMMAND TYPE   ONL02
*   RESTRICTIONS ('TYPE=' CODED IN THE QSCE MACRO) HAVE           ONL02
*   CORRESPONDING AUTHORIZATION BITS SET ON IN THE AUTHORIZATION  ONL02
*   FLAGS (QAFLAGS).                                              ONL02
*                                                                 ONL02
*   THE USER WILL GET THE HELP SCREEN IF THEY ENTER A COMMAND     ONL02
*   WHICH IS NOT ALLOWED.                                         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#PARSE  DS    0H                  QUEUE SUBCOMMAND AUTHORIZATION ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO SUPERCEDE STANDARD CHECKING                ONL02
         SPACE 1                                                  ONL02
         ICM   R2,1,QASCFLGS       PICKUP SUB-COMMAND AUTH FLAGS  ONL02
         BZ    QPOK                SKIP IF NO RESTRICTIONS        ONL02
         EX    R2,QPTM             DOES USER HAVE THE AUTHORITY?  ONL02
         BO    QPOK                SKIP IF COMMAND IS ALLOWED     ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO ALLOW RESTRICTED SUB-COMMANDS TO PROCEED   ONL02
         SPACE 1                                                  ONL02
QPNOK    DS    0H                  COMMAND IS NOT ALLOWED         ONL02
         XC    QCODEH,QCODEH       CLEAR FUNCTION CODE            ONL02
         MVC   QSUBCMD,=V(HELP)    REDIRECT TO THE HELP ROUTINE   ONL02
         B     AUTHOK              PROCEED AS IF HELP WERE ENTEREDONL02
         SPACE 2                                                  ONL02
QPOK     DS    0H                  COMMAND IS ALLOWED             ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO IMPOSE ADDTIONAL RESTRICTIONS              ONL02
         AIF   (NOT &QRACF).RNB03P1                               RNB03
*                                                                 RNB03
*  ISSUE RACHECK MACRO AND SET JES2 SYSTEM PROGRAMMER AUTHORITY   RNB03
*  IF USER IS AUTHORIZED                                          RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         CLC   =C'XP',QSUBNAME     IS THIS THE XP COMMAND?        RNB03
         BNE   QPNOTXP             SKIP IF NO                     RNB03
         SPACE 1                                                  RNB03
         RACHECK ENTITY=QRACNMXP,MF=(E,QRACHECK)                  RNB03
         SPACE 1                                                  RNB03
         LTR   R15,R15             IS USER AUTHORIZED?            RNB03
         BNZ   QPNOK               IF NOT, DON'T ALLOW COMMAND    RNB03
         OI    QAFLAGS,QAFXSYSP    GIVE USER JES2 SYS PGMR AUTH   RNB03
         OI    QAHELP,QAHXSYSP     UPDATE HELP DISPLAY CNTL FLAGS RNB03
QPNOTXP  DS    0H                                                 RNB03
         SPACE 1                                                  RNB03
.RNB03P1 ANOP  ,                                                  RNB03
         AIF   (NOT &QRNB).RNB06P2                                RNB06
*                                                                 RNB06
*  AT RNB, CERTAIN COMMANDS ARE NOT ALLOWED                       RNB06
*                                                                 RNB06
         SPACE 1                                                  RNB06
         CLC   =C'MO',QSUBNAME     DO NOT                         RNB06
         BE    QPNOK                ALLOW                         RNB06
         CLC   =C'M ',QSUBNAME       THE MODEL,                   RNB06
         BE    QPNOK                  TSO, OR                     RNB06
         CLC   QSUBCMD,=V(CTSO)        EXEC                       RNB06
         BE    QPNOK                    COMMANDS                  RNB06
.RNB06P2 ANOP  ,                                                  RNB06
         SPACE 1                                                  ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
QPTM     TM    QAFLAGS,*-*         (EXECUTED) MATCH AUTH FLAGS    ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = FINDJOB ROUTINE FOR JOB AUTHORIZATION   ONL02
*                                                                 ONL02
*   THIS ENTRY IS THE FIRST LINE OF DEFENSE AT THE JOB LEVEL.  IT ONL02
*   IS ENTERED BEFORE A USER CAN LOOK AT A JOB'S INPUT/OUTPUT OR  ONL02
*   DO ANYTHING WITH A JOB.  OTHER ENTRIES IN THIS AUTHORIZATION  ONL02
*   MODULE MAY FUTHER REFINE A JOB LEVEL AUTHORITY GRANTED BY     ONL02
*   THIS ENTRY.                                                   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#FINDJ  DS    0H                  FINDJOB RTN FOR JOB            ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRACF).RNB03F1                                   RNB03
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY IS TO ALLOW THE USER ACCESS    ONL02
*  TO ANY JOB WHOSE JOBNAME BEGINS WITH THEIR USERID.  USERS      ONL02
*  WITH OPERATOR AUTHORITY OR JES2 SYSTEM PROGRAMMER AUTHORITY    ONL02
*  HAVE ACCESS TO ALL JOBS IN THE SYSTEM.  THE ACCESS MAY BE      ONL02
*  RESTRICTED BY OTHER ENTRIES IN THIS MODULE.                    ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXOPSP    USER HAS OPER OR SYS PGMR AUTH?ONL02
         BNZ   AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         TM    QAFLAGS,QAFXSLOG    USER HAS ENTERED SLOG          ONL02
         BZ    NOSLOG              DIDNT ENTER SLOG               ONL02
         CLC   QSUBNAME(2),=CL2'SL'
         BE    AUTHOK
         SPACE 1                                                  ONL02
NOSLOG   L     R8,QCJCTA           ADDR OF JCT                    ONL02
         AIF   (NOT &QSP136).NO1361 DOR
         USING JCT,R8              NOTE JCT ADDRESSABILITY        DOR
         AGO   .X1361 DOR
.NO1361  ANOP DOR
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
.X1361  ANOP DOR
         SPACE 1                                                  ONL02
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           ONL02
         BNP   FINDJNOK            ERROR IF NO LENGTH             ONL02
         BCTR  R1,0                LESS ONE FOR EXECUTE           ONL02
         EX    R1,FINDJCLC         JOBNAME BEGINS WITH USERID ?   ONL02
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         B     FINDJNOK            ELSE, GO TELL USER             ONL02
         SPACE 1                                                  ONL02
FINDJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     ONL02
         SPACE 1                                                  ONL02
FINDJNOK DS    0H                  JOBNAME DOESN'T MATCH USERID   ONL02
         SPACE 1                                                  FCI01
         AIF   (NOT &QACF2).FCI01F1                               FCI01
*                                                                 FCI01
*  THIS CODE USES THE ACF2 SVC TO SEE IF THE USER MAY ACCESS A    FCI01
*  FICTITIOUS DSNAME OF THE FORM 'SYSOUT.LOGONID.JOBNAME'.  IF    FCI01
*  ACF2 WILL ALLOW THIS ACCESS, THEN THE QUEUE FUNCTION WILL      FCI01
*  PROCEED.                                                       FCI01
*                                                                 FCI01
         SPACE 1                                                  FCI01
         AIF   (NOT &QSP).FCI01F2                                 FCI01
         SPACE 1                                                  FCI01
         #ACFJES2 ,                SET ACF2 MVS/SP JES2 SPECS.    FCI01
         SPACE 1                                                  FCI01
         ICM   R7,15,&ACF2JCT      ACF2 AREA OFFSET IN JCT        FCI01
         BZ    ADSNNOK             DENY ACCESS IF NO ACF2 AREA    FCI01
         AIF   (NOT &QSP136).NO136B DOR
         LA    R7,JCT(R7)          ADDR OF ACF2 AREA              DOR
         AGO   .X136B DOR
.NO136B  ANOP DOR
         LA    R7,JCTDSECT(R7)     ADDR OF ACF2 AREA              ONL16
.X136B   ANOP DOR
         USING #ACFJCTX,R7         NOTE ACF AREA 2ADDRESSABILITY  FCI01
         SPACE 1                                                  FCI01
         CLC   JCTACFJ,=C'ACFJ'    IS IT THE ACF2 AREA ?          FCI01
         BZ    ADSNNOK             IF NOT, DENY ACCESS            FCI01
         SPACE 1                                                  FCI01
.FCI01F2 ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         CLC   QLOGON,LIDLID       USERS LOGONID=JOBS ACF LOGONID?FCI01
         BE    AUTHOK              YES..CONTINUE FORTHWITH        FCI01
         SPACE 1                                                  FCI01
         ACFGACVT R6,NONE=ADSNNOK  GET THE ACF2 CVT               FCI01
         SPACE 1                                                  FCI01
         USING ACCVT,R6            NOTE ACF2 CVT ADDRESSABILITY   FCI01
         SPACE 1                                                  FCI01
         MVC   ADSNAME,=CL44'SYSOUT. '  INITIALIZE DSNAME TO USE  FCI01
         XC    ACFSPARM(ACFSPRML),ACFSPARM   CLEAR REQUEST BLOCK  FCI01
         MVI   ACFSPREQ,ACFSPRDS   DSNAME ACCESS ONLY             FCI01
         MVI   ACFSPID1,ACFSPIUR   DIS AM DE USER TALKING....     FCI01
         LA    R5,ADSNAME          GET DSNAME ADDRESS             FCI01
         ST    R5,ACFSPDSN         AND GIVE IT TO ACF PARM LIST   FCI01
         SPACE 1                                                  FCI01
*  GENERATE A DSN OF THE FORM 'SYSOUT.LOGONID.JOBNAME'            FCI01
         SPACE 1                                                  FCI01
         MVC   ADSNAME+7(8),LIDLID MOVE LID TO DSNAME             FCI01
         CLI   ADSNAME+7,C' '      IS THE LID BLANK?              FCI01
         BNE   ADSNCHK0            NO..NORMAL PROCESS             FCI01
         SPACE 1                                                  FCI01
*  GOT HERE BECAUSE LID IS ' ' (BLANK)..SUBSTITUTE 'SYSTEM'       FCI01
         MVC   ADSNAME+7(8),=CL8'SYSTEM'                          FCI01
         SPACE 1                                                  FCI01
ADSNCHK0 LA    R1,ADSNAME+7        GET ADDRESS                    FCI01
         LA    R5,8                LOAD COUNT                     FCI01
ADSNCHK  CLI   0(R1),C' '          LOOK FOR BLANK                 FCI01
         BE    ADSNCHK1            GOTIT..                        FCI01
         LA    R1,1(R1)            BUMP AND                       FCI01
         BCT   R5,ADSNCHK            GRIND                        FCI01
ADSNCHK1 MVI   0(R1),C'.'          MOVE IN PERIOD..               FCI01
         MVC   1(8,R1),JCTJNAME    MOVE IN JOBNAME                FCI01
         SPACE 1                                                  FCI01
         LA    R1,ACFSPARM         GET ADDRESS OF PARM FIELD      FCI01
         ACFSVC (1),TYPE=S,NONE=ADSNNOK,CVT=HAVE  INVOKE A C F 2  FCI01
         SPACE 1                                                  FCI01
         LTR   R15,R15             HOW DID YOU LIKE THEM APPLES?  FCI01
         BC    8,AUTHOK            ..OK BY YOU...CONTINUE..       FCI01
         SPACE 1                                                  FCI01
ADSNNOK  DS    0H                  ACF2 DOWN OR ACCESS NOT ALLOWEDFCI01
         QTILT '*** SORRY..NO ACF2 AUTHORITY TO LOOK AT THIS JOB' FCI01
         SPACE 1                                                  FCI01
         DROP  R6                  KILL ACF2 CVT ADDRESSABILITY   FCI01
         SPACE 1                                                  FCI01
         AIF   (NOT &QSP).FCI01F1                                 FCI01
         SPACE 1                                                  FCI01
         DROP  R7                  KILL ACF AREA 2ADDRESSABILITY  FCI01
         SPACE 1                                                  FCI01
.FCI01F1 ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           ONL02
         SPACE 1                                                  ONL02
         DROP  R8                  KILL JCT ADDRESSABILITY        ONL02
         SPACE 1                                                  RNB03
         AGO   .RNB03F2                                           RNB03
.RNB03F1 ANOP  ,                                                  RNB03
*                                                                 RNB03
*  AT RNB, CHECKING FOR THE ENTRY FROM FINDJOB IS DONE ONLY FOR   RNB03
*  THE XD SUB-COMMAND:  RACHECK FOR APPL-QUEUEXDS AND PASS THE    RNB03
*  JOBNAME AS THE APPL FOR LOGGING                                RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         CLC   =C'XD',QSUBNAME     IS THIS AN XD COMMAND?         RNB03
         BNE   AUTHOK              DONE IF NO                     RNB03
         SPACE 1                                                  RNB03
         L     R2,QCJCTA           ADDR OF JCT                    RNB03
         AIF   (NOT &QSP136).NO136C
         USING JCT,R2              NOTE JCT ADDRESSABILITY        DOR
         AGO   .X136C
.NO136C  ANOP
         USING JCTDSECT,R2         NOTE JCT ADDRESSABILITY        RNB03
.X136C   ANOP
         SPACE 1                                                  RNB03
         RACHECK ENTITY=QRACNMXD,APPL=JCTJNAME,MF=(E,QRACHECK)    RNB03
         SPACE 1                                                  RNB03
         LTR   R15,R15             IS ACCESS ALLOWED?             RNB03
         BZ    AUTHOK              DONE IF YES                    RNB03
         SPACE 1                                                  RNB03
         QTILT '*** XDS COMMAND NOT ALLOWED ***'                  RNB03
         SPACE 1                                                  RNB03
         DROP  R2                  KILL JCT ADDRESSABILITY        RNB03
         SPACE 1                                                  RNB03
.RNB03F2 ANOP  ,                                                  RNB03
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JCL COMMAND FOR JOB AUTHORIZATION       ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JCL    DS    0H                  JCL COMMAND FOR JOB            ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JLOG COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JLOG   DS    0H                  JLOG COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JMSG COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JMSG   DS    0H                  JMSG COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = LIST COMMAND FOR JOB/DSID AUTHORIZATION ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#LIST   DS    0H                  LIST CMD FOR JOB AND DSID      ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRNB).RNB05L1                                    RNB05
*                                                                 ONL02
*  THE DEFAULT CODE DOES NOT ALLOW THE LIST COMMAND TO BE USED    ONL02
*  FOR A DATASET ID (DSID) LESS THAN 101 UNLESS THE USER HAS JES2 ONL02
*  SYSTEM PROGRAMMER AUTHORITY.                                   ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXSYSP    DOES USER HAVE SYS PGMR AUTH ? ONL02
         BO    DSIDOK              SKIP IF YES, ALLOW ANY DSID    ONL02
         CLC   QPDSID,=H'101'      IS THE DSID ID LESS THAN 101?  ONL02
         BNL   DSIDOK              SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
         XC    QPDSID,QPDSID       INVALIDATE DSID                ONL02
         SPACE 1                                                  ONL02
         QTILT '*** DATASET ID INVALID ***'                       ONL02
         SPACE 1                                                  ONL02
DSIDOK   DS    0H                  THE DSID IS OK                 ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 1                                                  RNB05
         AGO   .RNB05L2                                           RNB05
.RNB05L1 ANOP  ,                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE LIST COMMAND MAY NOT BE USED FOR A DATASET ID      RNB05
*  (DSID) LESS THAN 101.                                          RNB05
*                                                                 RNB05
         SPACE 1                                                  RNB05
         CLC   QPDSID,=H'101'      IS THE DSID ID LESS THAN 101?  RNB05
         BNL   DSIDOK              SKIP IF YES                    RNB05
         XC    QPDSID,QPDSID       INVALIDATE DSID                RNB05
         QTILT '*** DATASET ID INVALID ***'                       RNB05
         SPACE 1                                                  RNB05
DSIDOK   DS    0H                  THE DSID IS OK                 RNB05
         SPACE 2                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE JOBNAME MUST BEGIN WITH THE USER'S USERID.         RNB05
*  OTHERWISE:                                                     RNB05
*                                                                 RNB05
*   (1) "PJS" USERS CAN'T LIST ANYTHING.                          RNB05
*   (2) OTHERS CAN LIST IF THEIR USERID IS SPECIFIED IN A NOTIFY  RNB05
*       PARAMETER ON THE JOB STATEMENT.                           RNB05
*   (3) "TEC" USERS CAN LIST FROM ANY "TEC" JOBS OR JOBS WITH A   RNB05
*       NOTIFY FOR A "TEC" USERID.                                RNB05
*   (4) "TEC" USERS CAN LIST FROM ANY STARTED TASK.               RNB05
*                                                                 RNB05
         SPACE 1                                                  RNB05
         L     R8,QCJCTA           ADDR OF JCT                    RNB05
         AIF   (NOT &QSP136).NO136D
         USING JCT,R8              NOTE JCT ADDRESSABILITY        DOR
         AGO   .X136D
.NO136D  ANOP
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
.X136D   ANOP
         SPACE 1                                                  RNB05
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB05
         BNP   LISTNOK             ERROR IF NO LENGTH             RNB05
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB05
         EX    R1,LISTJCLC         JOBNAME BEGINS WITH USERID ?   RNB05
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      RNB05
         SPACE 1                                                  RNB05
         CLC   =C'PJS',QLOGON      IS THIS A PJS USER?            RNB05
         BE    LISTNOK             INVALID JOB IF SO              RNB05
         EX    R1,LISTNCLC         NOTIFY ID BEGINS WITH USERID ? RNB05
         BE    AUTHOK              GOOD JOB IF SO                 RNB05
         CLC   =C'TEC',QLOGON      IS THIS A TEC USERID?          RNB05
         BNE   LISTNOK             INVALID JOB IF NOT             RNB05
         CLC   =C'TEC',JCTJNAME    FOR A TEC USER, ALLOW LIST     RNB05
         BE    AUTHOK              FOR ANY TEC JOB OR ANY JOB     RNB05
         CLC   =C'TEC',JCTTSUID    WITH A TEC NOTIFY              RNB05
         BE    AUTHOK                                             RNB05
         TM    JCTJOBFL,JCTSTCJB   ALSO ALLOW IF AN STC           RNB05
         BNZ   AUTHOK                                             RNB05
         SPACE 1                                                  RNB05
LISTNOK  DS    0H                  USER MAY NOT LIST THIS DATASET RNB05
         XC    QPDSID,QPDSID       INVALIDATE DSID                RNB05
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           RNB05
         SPACE 1                                                  RNB05
LISTJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     RNB05
LISTNCLC CLC   QLOGON(*-*),JCTTSUID  EXECUTED - MATCH NOTIFY ID   RNB05
         SPACE 1                                                  RNB05
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB05
         SPACE 1                                                  RNB05
.RNB05L2 ANOP  ,                                                  RNB05
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JHIST COMMAND FOR JOB AUTHORIZATION     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JHIST  DS    0H                  JHIST COMMAND FOR JOB          ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DD COMMAND FOR JOB AUTHORIZATION        ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#DD     DS    0H                  DD COMMAND FOR JOB             ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = PDDB COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#PDDB   DS    0H                  PDDB COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DEL, REQ, AND CAN COMMANDS FOR JOB AUTH ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SYSOUT DS    0H                  DEL/REQ/CAN CMDS FOR JOB       ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRNB).RNB08S1                                    RNB08
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY IS TO ALLOW THE DEL, REQ, AND  ONL02
*  CAN COMMANDS TO BE USED ONLY ON JOBS WHOSE JOBNAME BEGINS WITH ONL02
*  THE USER'S USERID.  USERS WHO HAVE JES2 SYSTEM PROGRAMMER      ONL02
*  AUTHORITY MAY USE ANY JOBNAME.                                 ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXSYSP    USER HAS JES2 SYSTEM PGMR AUTH?ONL02
         BO    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         SPACE 1                                                  ONL02
         L     R8,QCJCTA           ADDR OF JCT                    ONL02
         AIF   (NOT &QSP136).NO136E  DOR
         USING JCT,R8              NOTE JCT ADDRESSABILITY        DOR
         AGO   .X136E
.NO136E  ANOP DOR
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
.X136E   ANOP DOR
         SPACE 1                                                  ONL02
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           ONL02
         BNP   SYSONOK             ERROR IF NO LENGTH             ONL02
         BCTR  R1,0                LESS ONE FOR EXECUTE           ONL02
         EX    R1,SYSOCLC          JOBNAME BEGINS WITH USERID ?   ONL02
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         B     SYSONOK             ELSE, GO TELL USER             ONL02
         SPACE 1                                                  ONL02
SYSOCLC  CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     ONL02
         SPACE 1                                                  ONL02
SYSONOK  DS    0H                  JOBNAME DOESN'T MATCH USERID   ONL02
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           ONL02
         SPACE 1                                                  ONL02
         DROP  R8                  KILL JCT ADDRESSABILITY        ONL02
         SPACE 1                                                  RNB08
         AGO   .RNB08S2                                           RNB08
.RNB08S1 ANOP  ,                                                  RNB08
*                                                                 RNB08
*  AT RNB, ALLOW DEL/REQ/CAN IF JOBNAME STARTS WITH USERID OR     RNB08
*  NOTIFY IS FOR USERID, UNLESS JOB SUBMITTED FROM PJS.  ALLOW    RNB08
*  TEC USERS TO MANIPULATE OTHER TEC USER'S JOBS AND ALSO STC'S.  RNB08
*                                                                 RNB08
         SPACE 1                                                  RNB08
         L     R8,QCJCTA           ADDR OF JCT                    RNB08
         AIF   (NOT &QSP136).NO136F  DOR
         USING JCT,R8              NOTE JCT ADDRESSABILITY        DOR
         AGO   .X136F
.NO136F  ANOP DOR
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
.X136F   ANOP DOR
         SPACE 1                                                  RNB08
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB08
         BNP   SYSONOK             ERROR IF NO LENGTH             RNB08
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB08
         EX    R1,SYSOJCLC         JOBNAME BEGINS WITH USERID ?   RNB08
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      RNB08
         SPACE 1                                                  RNB08
         CLC   =C'PJS',QLOGON      IS THIS A PJS USER?            RNB08
         BE    SYSONOK             YES - INVALID                  RNB08
         BAL   R6,SYSPJSCK         ENSURE NOT PJS JOB FOR CAN/DEL RNB08
         SPACE 1                                                  RNB08
         L     R8,QCJCTA           RESTORE JCT ADDRESSABILITY     RNB08
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB08
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB08
         EX    R1,SYSONCLC         NOTIFY ID BEGINS WITH USERID ? RNB08
         BE    AUTHOK              YES - OK                       RNB08
         CLC   =C'TEC',QLOGON      IS THIS A TEC USER?            RNB08
         BNE   SYSONOK             NO  - INVALID                  RNB08
         TM    JCTJOBFL,JCTSTCJB   IS IT AN STC?                  RNB08
         BO    AUTHOK              /YES - OK FOR TEC USER         RNB08
         CLC   =C'TEC',JCTJNAME    IS JOBNAME FOR A TEC USER?     RNB08
         BE    AUTHOK              YES - OK                       RNB08
         CLC   =C'TEC',JCTTSUID    IS NOTIFY FOR A TEC USER?      RNB08
         BE    AUTHOK              YES - OK                       RNB08
         SPACE 1                                                  RNB08
SYSONOK  QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           RNB08
         SPACE 1                                                  RNB08
SYSOJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     RNB08
SYSONCLC CLC   QLOGON(*-*),JCTTSUID  EXECUTED - MATCH NOTIFY ID   RNB08
         SPACE 1                                                  RNB08
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB08
         SPACE 2                                                  RNB08
*                                                                 RNB08
*  SUBROUTINE TO TILT IF PJS JOB (ONLY FOR CANCEL OR DELETE)      RNB08
*                                                                 RNB08
         SPACE 1                                                  RNB08
         USING PDBDSECT,R1         NOTE PDDB ADDRESSABILITY       RNB08
         USING IOTDSECT,R3         NOTE IOT ADDRESSABILITY        RNB08
         SPACE 1                                                  RNB08
SYSPJSCK CLI   QCODEH+1,4          IS THIS A REQUEUE?             RNB08
         BER   R6                  /YES - OK FOR NOW              RNB08
*                                  /NO  - ENSURE NOT A PJS JOB    RNB08
         L     R3,QCIOTA           LOAD BASE REG                  RNB08
         SH    R3,=Y(IOTSTART-IOTDSECT) ADJUST FOR HEADER            CL
         LR    R5,R3               BASE OF IOT                    RNB08
         A     R5,IOTPDDBP         OFFSET BEYOND LAST PDDB        RNB08
         LR    R1,R3               BASE OF IOT                    RNB08
         AIF   (&QSP136).XSP136
         A     R1,QCPDDB1          OFFSET TO FIRST PDDB IN IOT    RNB08
         AGO   .NOSP136            DOR
.XSP136  ANOP                      DOR
         A     R1,IOTPDDB          DOR
.NPSP136 ANOP                      DOR
SYSPFDDS DS    0H                  SEARCH IOT FOR DSID = 5        RNB08
         CLC   IOTID,=CL4'IOT'     WAS AN IOT READ FROM SPOOL ?   RNB08
         BNE   SOBADIOT            ERROR IF NO                    RNB08
         CLC   QPJOBID,IOTJBKEY    IS THE IOT'S JOB KEY VALID ?   RNB08
         BNE   SOBADIOT            ERROR IF NO                    RNB08
         CLC   =H'5',PDBDSKEY      IS THIS THE DATASET?           RNB08
         BE    SYSPID5             YES. CONTINUE.                 RNB08
         LA    R1,PDBLENG(R1)      NO. LOOK AT NEXT PDDB.         RNB08
         CR    R1,R5               HAVE WE GONE PAST LAST PDDB?   RNB08
         BL    SYSPFDDS            NO. TRY AGAIN.                 RNB08
         B     SOBADTXR            ELSE BAD DD TABLE (INTERP. JCL)RNB08
SYSPID5  L     R5,PDBMTTR          DISK ADDR OF FIRST BLOCK       RNB08
         DROP  R1                  KILL PDDB ADDRESSABILITY       RNB08
         L     R7,QCBLKA           ADDR OF DATASET BLOCK IOAREA   RNB08
         MVC   QDMSG,QBLANK        BLANK OUT THE MESSAGE AREA     RNB08
         ST    R5,QCTRAK           STORE DISK ADDR                RNB08
         LR    R1,R7               IOAREA ADDRESS                 RNB08
         L     R15,=V(READSPC)     ADDR OF ROUTINE TO READ SPOOL  RNB08
         BALR  R14,R15             GO TO IT                       RNB08
         CLC   QPJOBID,4(R7)       IS RECORD'S JOB JEY VALID?     RNB08
         BNE   SOBADTXR            ERROR IF NO                    RNB08
         CLC   8(2,R7),=H'5'       IS RECORD'S DSID VALID?        RNB08
         BNE   SOBADTXR            ERROR IF NO                    RNB08
         LA    R5,10(R7)           ADDR OF FIRST RECORD IN BLOCK  RNB08
         SR    R7,R7               ZERO OUT REG                   RNB08
         IC    R7,0(R5)            INSERT LENGTH                  RNB08
         CLI   5(R5),1             IS THIS A JOB RECORD?          RNB08
         BNE   SOBADJTX            /NO  - INVALID INTERNAL TEXT   RNB08
         LA    R5,9(R5)            ADDR OF FIRST KEY              RNB08
         LR    R8,R7               REMAINING LENGTH OF RECORD     RNB08
         SR    R15,15              ZERO OUT R15                   RNB08
         SR    R14,R14             ZERO OUT R14                   RNB08
         SR    R1,R1               ZERO OUT R1                    RNB08
SYSPCKEY CLI   0(R5),X'A5'         IS THIS THE USER= PARM?        RNB08
         BE    SYSPGOTU            YES. PROCESS IT.               RNB08
         IC    R1,1(R5)            NUMBER OF SUBFIELDS            RNB08
         LA    R5,2(R5)            UPDATE LOCATION                RNB08
         SH    R8,=H'2'            REMAINING COUNT                RNB08
         SR    R8,R1               REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
         LTR   R1,R1               ARE THERE ANY SUBFIELDS?       RNB08
         BZ    SYSPCKEY            NO. TRY NEXT FIELD.            RNB08
SYSPNXSF TM    0(R5),X'80'         IS THIS A SUB-SUB-FIELD        RNB08
         BZ    SYSPNOSS            NO. CONTINUE.                  RNB08
         NI    0(R5),X'7F'         CLEAR THE HEX 80 BIT           RNB08
         IC    R14,0(R5)           NUMBER OF SUB-SUB-FIELDS       RNB08
         LA    R5,1(R5)            UPDATE LOCATION                RNB08
         SH    R8,=H'1'            REMAINING COUNT                RNB08
         SR    R8,R14              REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
         AR    R1,R14              INCREASE NUMBER OF SUBFIELDS   RNB08
         B     SYSPYESS            DECREMENT AND TRY AGAIN        RNB08
SYSPNOSS IC    R15,0(R5)           SUBFIELD LENGTH                RNB08
         LA    R5,1(R15,R5)        ADD TO LOCATION                RNB08
         SR    R8,R15              REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
SYSPYESS BCT   R1,SYSPNXSF         DO NEXT SUBFIELD               RNB08
         B     SYSPCKEY            TRY NEXT FIELD                 RNB08
SYSPGOTU CLI   2(R5),7             IS USER ID LENGTH = 7?         RNB08
         BNER  R6                  /NO - NOT PJS JOB, PROCESS     RNB08
         CLI   2(R5),0             IS THE LENGTH ZERO?            RNB08
         BER   R6                  YES. SKIP THE FIELD.           RNB08
         CLC   =C'PROD',6(R5)      PJS JOB? (USER = ???PROD)      RNB08
         BE    SOPJSMSG            /YES - BAD                     RNB08
         BR    R6                  /NO  - GO PROCESS              RNB08
         SPACE 2                                                  RNB08
SOBADIOT QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       RNB08
SOBADTXR QTILT '*** JOB HAS PURGED (OR DSID 5 SPOOL ERROR) ***'   RNB08
SOBADJTX QTILT '*** CANNOT PROCESS JOB - INVALID JOB STMT TEXT'   RNB08
SOPJSMSG QTILT '*** CANNOT CAN/DEL JOB SUBMITTED VIA PJS ***'     RNB08
         SPACE 1                                                  RNB08
         DROP  R3                  KILL IOT ADDRESSABILITY        RNB08
         SPACE 1                                                  RNB08
.RNB08S2 ANOP  ,                                                  RNB08
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = AUTHORIZATION TO LOOK AT SYSLOG         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SYSLOG DS    0H                  AUTHORIZATION TO LOOK AT SYSLOGONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  RETURN TO CALLER, REQUESTED FUNCTION MAY PROCEED               ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
AUTHOK   DS    0H                  REQUESTED FUNCTION MAY PROCEED ONL02
         QSTOP ,                   RETURN TO CALLER               ONL02
         SPACE 3                                                  ONL02
         LTORG ,                   DEFINE LITERAL ORIGIN          ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  GENERATE CONTROL BLOCK DSECTS                                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       ONL02
AUTH     CSECT ,                   RESUME CSECT                   ONL02
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL02
         SPACE 1                                                  ONL02
JCTX     EQU   0                                                  ONL02
         SPACE 1                                                  ONL02
         AIF   (NOT &QSP136).NO136G  DOR
         IFGRPL   DSECT=YES,AM=VTAM   DOR
.NO136G  ANOP
         $BUFFER ,                                                ONL16
         $JQE  ,                                                  ONL02
         $JCT  ,                                                  ONL02
         $PDDB ,                                                  ONL02
         $TAB  ,                                                  ONL02
         $IOT  ,                                                  ONL02
         AIF   (NOT &QSP136).NO136H  DOR
         $TQE ,     DOR
.NO136H  ANOP
         SPACE 1                                                  ONL02
WORK     DSECT ,                   SAVE AREA WORK DSECT           ONL02
         DS    18F                 OS SAVE AREA                   ONL02
WORKAREA DS    0D                  START OF DATA                  ONL02
         SPACE 1                                                  ONL02
         AIF   (NOT &QRACF).RNB03CB                               RNB03
         CVT   DSECT=YES                                          RNB03
         IHAASCB ,                                                RNB03
         IHAASXB ,                                                RNB03
         IHAACEE ,                                                RNB03
.RNB03CB ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         AIF   (NOT &QACF2).FCI01CB                               FCI01
WORK     DSECT ,                   CONTINUE SAVE AREA WORK DSECT  FCI01
         ORG   WORKAREA            ORG PAST OS SAVE AREA          FCI01
         ACDSV DSECT=NO            PARAMETER LIST FOR THE ACF2 SVCFCI01
ADSNAME  DS    CL44                DSNAME USED WITH THE ACF2 SVC  FCI01
AUTH     CSECT ,                   RESUME CSECT                   FCI01
         SPACE 1                                                  FCI01
         ACCVT ,                                                  FCI01
         ACUCB ,                                                  FCI01
         IHAPSA ,                                                 FCI01
         AIF   (NOT &QSP).FCI01CB                                 FCI01
         #ACFJCTX ,                GEN ACF2 JCT EXTENSION DSECT   FCI01
.FCI01CB ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         QCOMMON ,                 GENERATE QCOMMON DSECT         ONL02
         SPACE 1                                                  ONL02
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL02
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    ONL02
         END   ,                                                  ONL02
./       ADD   NAME=AUTHTEST
AUTH     TITLE 'AUTHORIZATION MODULE FOR THE QUEUE COMMAND'       ONL02
******************************************************************ONL02
*                                                                 ONL02
* MODULE NAME = AUTH                                              ONL02
*                                                                 ONL02
* DESCRIPTIVE NAME = AUTHORIZATION MODULE FOR THE QUEUE COMMAND   ONL02
*                                                                 ONL02
* AUTHOR = ROBERT M. JINKINS                                      ONL02
*          OAK RIDGE NATIONAL LABORATORY                          ONL02
*          BLDG. 4500-N  MS-259                                   ONL02
*          P.O. BOX X                                             ONL02
*          OAK RIDGE, TENNESSEE  37830                            ONL02
*                                                                 ONL02
*          PHONE: (615) 574-7208/5300                             ONL02
*                  FTS  624-7208/5300                             ONL02
*                                                                 ONL02
*          SHARE INSTALLATION CODE = OR                           ONL02
*                                                                 ONL02
* DATE WRITTEN = JUNE 83                                          ONL02
*                                                                 ONL02
* FUNCTION = TO PROVIDE A SECURITY FUNCTION WHICH CONTROLS THE    ONL02
*    USE THE TSO QUEUE COMMAND, ITS SUB-COMMANDS, AND THE JOBS    ONL02
*    OR DATASETS A USER MAY ACCESS, CHANGE, OR DELETE.  THE AUTH  ONL02
*    CSECT IS INVOKED AT VARIOUS POINTS DURING QUEUE COMMAND      ONL02
*    PROCESSING VIA A QAUTHCK MACRO.                              ONL02
*                                                                 ONL02
* DEFAULT OPERATION = THE DEFAULT AUTHORITY CHECKING FOR THE      ONL02
*    QUEUE COMMAND IS AS FOLLOWS:                                 ONL02
*                                                                 ONL02
*    (1) THE START-UP ENTRY FROM THE INIT CSECT GIVES JES2        ONL02
*        SYSTEM PROGRAMMER AUTHORITY TO ANYONE HAS OPERATOR       ONL02
*        AUTHORITY.  SINCE JES2 SYSTEM PROGRAMMER AUTHORITY HAS   ONL02
*        GREAT POWER, MANY USERS WILL PROBABLY WANT TO CHANGE     ONL02
*        THIS TO SUIT THE REQUIREMENTS OF THEIR INSTALLATION.     ONL02
*        THE SAME CONSIDERATIONS APPLY TO EXEC AUTHORITY (THE     ONL02
*        ABILITY TO ISSUE TSO COMMANDS WHILE IN QUEUE) BECAUSE    ONL02
*        THE QUEUECMN AREA COULD BE ALTERED BY USER PROGRAMS      ONL02
*        EXECUTING IN THAT ENVIRONMENT.                           ONL02
*                                                                 ONL02
*    (2) THE START-UP ENTRY FROM THE INIT CSECT ALSO ISSUES A     ONL02
*        TESTAUTH MACRO.  IF THE QUEUE COMMAND IS NOT APF         ONL02
*        AUTHORIZED, THEN THE AUTHORITY FOR USING THE SUB-SYSTEM  ONL02
*        INTERFACE COMMANDS IS TURNED OFF.                        ONL02
*                                                                 ONL02
*    (3) THE START-UP ENTRY FROM THE INIT CSECT ALSO SETS THE     ONL02
*        HELP CONTROL FLAGS FROM THE AUTHORIZATION FLAGS.  SEE    ONL02
*        THE HELP CSECT FOR MORE INFORMATION ON THE HELP CONTROL  ONL02
*        FLAGS.                                                   ONL02
*                                                                 ONL02
*    (4) THE ENTRY FROM THE PARSE ROUTINE IS USED TO DETERMINE    ONL02
*        WHO MAY USE A GIVEN QUEUE SUB-COMMAND.  A SUB-COMMAND    ONL02
*        IS ALLOWED TO PROCEED IF ALL SUB-COMMAND TYPE            ONL02
*        RESTRICTIONS ('TYPE=' CODED IN THE QSCE MACRO) HAVE      ONL02
*        CORRESPONDING AUTHORIZATION BITS SET ON IN THE           ONL02
*        AUTHORIZATION FLAGS (QAFLAGS).                           ONL02
*                                                                 ONL02
*    (5) THE ENTRY FROM THE FINDJOB ROUTINE IS ENTERED FOR ANY    ONL02
*        JOB WHOSE INPUT/OUTPUT IS TO BE ACCESSED BY A QUEUE      ONL02
*        COMMAND FUNCTION.  THE FUNCTION IS ALLOWED TO PROCEED    ONL02
*        IF THE JOBNAME BEGINS WITH THE USER'S USERID OR IF THE   ONL02
*        USER HAS OPERATOR OR JES2 SYSTEM PROGRAMMER AUTHORITY.   ONL02
*        ALTHOUGH THE ENTRY FROM THE FINDJOB ROUTINE MAY ALLOW    ONL02
*        THE FUNCTION TO PROCEED, OTHER ENTRIES MAY FUTHER        ONL02
*        RESTRICT THE ACCESS GRANTED BY THIS ENTRY.               ONL02
*                                                                 ONL02
*    (6) THE LIST COMMAND MAY NOT LIST DATASET ID'S LESS THAN     ONL02
*        101 UNLESS THE USER HAS JES2 SYSTEM PROGRAMMER           ONL02
*        AUTHORITY.                                               ONL02
*                                                                 ONL02
*    (7) THE DEL, REQ, AND CAN COMMANDS MAY NOT ACCESS A JOB      ONL02
*        WHOSE JOBNAME DOES NOT BEGIN WITH THE USER'S USERID      ONL02
*        UNLESS THEY HAVE JES2 SYSTEM PROGRAMMER AUTHORITY.       ONL02
*                                                                 ONL02
* OPTIONAL OPERATION = CONDITIONAL ASSEMBLY OPTIONS ALTER THE     ONL02
*    DEFAULT OPERATION OF THE QUEUE COMMAND AS SHOWN BELOW:       ONL02
*                                                                 ONL02
*    FCI01  --  IF THE &QACF2 OPTION IS SET, THEN THE ENTRY FROM  FCI01
*               FINDJOB ALLOWS THE FOLLOWING:                     FCI01
*                                                                 FCI01
*                (1) USER WITH OPER AUTH MAY LOOK AT ANY JOB.     FCI01
*                (2) USER MAY LOOK AT OWN JOBS (USERID MATCHES    FCI01
*                    LOGONID IN JOB'S JCT).                       FCI01
*                (3) ACFSVC ISSUED TO CHECK ALL OTHER ACCESSES.   FCI01
*                                                                 FCI01
*    RNB03  --  IF THE &QRACF OPTION IS SET, THEN:                RNB03
*                                                                 RNB03
*                (1) THE CHECKPOINT/SPOOL PRE-OPEN ENTRY CHANGES  RNB03
*                    THE USERID IN THE ACEE TO ALLOW THE DATASETS RNB03
*                    TO BE OPENED IF WE ARE APF AUTHORIZED, RACF  RNB03
*                    IS UP, AND &QRACUSR IS NOT NULL.  THE POST-- RNB03
*                    OPEN ENTRY FROM INIT RESTORES THE ORIGINAL   RNB03
*                    USERID.  ATTENTION INTERRUPTS ARE INHIBITED  RNB03
*                    DURING THIS INTERVAL.                        RNB03
*                                                                 RNB03
*                (2) THE ENTRY FROM READSPC ZEROS THE OLD AND     RNB03
*                    NEW PASSWORDS FIELDS WHEN JCT'S ARE READ     RNB03
*                    FROM SPOOL.                                  RNB03
*                                                                 RNB03
*                (3) THE ENTRY FROM PARSE IS USED TO PROCESSE     RNB03
*                    THE XP COMMAND.  A RACHECK MACRO IS ISSUED   RNB03
*                    TO DETERMINE IF THE USER SHOULD BE GIVEN     RNB03
*                    JES2 SYSTEM PROGRAMMER AUTHORITY.            RNB03
*                                                                 RNB03
*                (4) THE ENTRY FROM FINDJOB ONLY CHECKS FOR       RNB03
*                    ACCESSES MADE BY THE XD COMMAND AND USES A   RNB03
*                    RACHECK MACRO TO CONTROL AND LOG ITS USE.    RNB03
*                                                                 RNB03
*    RNB05  --  IF THE &QRNB OPTION IS SET, THEN:                 RNB05
*                                                                 RNB05
*                (1) THE START-UP ENTRY SETS THE AUTHORITY AND    RNB05
*                    HELP DISPLAY CONTROL FLAGS FOR THE RNB       RNB05
*                    ENVIRONMENT.                                 RNB05
*                                                                 RNB05
*                (2) THE LIST COMMAND CAN NEVER BE USED FOR       RNB05
*                    DSID'S LESS THAN 101.  THE XD COMMAND        RNB05
*                    MUST BE USED INSTEAD.                        RNB05
*                                                                 RNB05
*                (3) SPECIAL USERID/JOBNAME/NOTIFY CHECKING IS    RNB05
*                    USED TO CONTROL DATASET ACCRESS BY THE LIST  RNB05
*                    COMMAND (SEE COMMENTS IN THE CODE).          RNB05
*                                                                 RNB05
*    RNB06  --  IF THE &QRNB OPTION IS SET, THEN THE ENTRY FROM   RNB06
*               PARSE INHIBITS THE MODEL, TSO, AND EXEC COMMANDS. RNB06
*                                                                 RNB06
*    RNB08  --  IF THE &QRNB OPTION IS SET, THEN THE ENTRY FROM   RNB08
*               SYSOUT (THE DEL, REQ, AND CAN COMMANDS) IS USED   RNB08
*               TO PERFORM SPECIAL USERID/JOBNAME/NOTIFY/USER=    RNB08
*               CHECKING (SEE COMMENTS IN THE CODE).              RNB03
*                                                                 RNB08
*    ONL06  --  IF THE &QONL OPTION IS SET, JES2 SYSTEM           ONL06
*               PROGRAMMER AUTHORITY IS ONL GRANTED ONLY IF THE   ONL06
*               USER HAS OPERATOR AUTHORITY AND THEIR USERID      ONL06
*               IS CONTAINED IN A TABLE IN THIS ASSEMBLY.         ONL06
*                                                                 ONL06
*    DOR    --  IF THE &QTSS OPTION IS SET, JES2 SYSTEM
*               PROGRAMMER AUTHORITY IS  GRANTED ONLY IF THE
*               USER HAS OPERATOR AUTHORITY AND THEIR USERID
*               IS CONTAINED IN A TABLE IN THIS ASSEMBLY.
*               TSS DOES NOT SUPPORT TESTAUTH.
*
*                                                                 ONL06
* CHANGE ACTIVITY = NONE                                          ONL02
*                                                                 ONL02
******************************************************************ONL02
         EJECT ,                                                  ONL02
         GBLB  &QSP                MVS/SP LEVEL OF JES2           ONL02
         GBLB  &QACF2              ACF2 OPTION                    FCI01
         GBLB  &QRACF              RACF OPTION                    RNB03
         GBLB  &QRNB               RNB OPTION                     RNB05
         GBLB  &QONL               ONL OPTION                     ONL06
         GBLB  &QTSS              TSS OPTION                      DOR
         SPACE 1                                                  FCI01
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET                 FCI01
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  DO ENTRY POINT HOUSEKEEPING FOR THE AUTH CSECT                 ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
AUTH     QSTART ,                  START AUTH CSECT ASSEMBLY      ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  SETUP ADDRESSABILITY FOR COMMON SUB-AREAS AND SAVE/WORK AREA   ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         USING WORK,R13            NOTE SAVE/WORK ADDRESSABILITY  ONL02
         SPACE 1                                                  ONL02
         L     R10,QVDAIR          ADDR OF DAIR WORK AREA         ONL02
         USING QDAIR,R10           NOTE DAIR WORK ADDRESSABILITY  ONL02
         SPACE 1                                                  ONL02
         L     R9,QVCKPT           ADDR OF CKPT WORK AREA         ONL02
         USING QCKPT,R9            NOTE CKPT WORK ADDRESSABILITY  ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  VALIDATE AUTHORIZATION REQUEST CODE AND ENTER PROCESSING RTN   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         CLI   QACODE,MAXCODE      IS REQUEST CODE WITHIN RANGE ? ONL02
         BH    BOMB                ERROR IF NO                    ONL02
         SPACE 1                                                  ONL02
         SLR   R15,R15             ENTER                          ONL02
         IC    R15,QACODE           PROCESSING ROUTINE            ONL02
         SLL   R15,2                 PER                          ONL02
         B     VECTOR(R15)            AUTHORIZATION REQUEST CODE  ONL02
         SPACE 1                                                  ONL02
VECTOR   DS    0H                  AUTH REQUEST CODE VECTOR       ONL02
         B     Q#NULL           0  NULL REQUEST                   ONL02
         B     Q#START          1  QUEUE COMMAND START-UP         ONL02
         B     Q#END            2  QUEUE COMMAND TERMINATION      ONL02
         B     Q#ALLOC          3  DATASET ALLOCATION/UNALLOCATIONONL02
         B     Q#BEFOPN         4  BEFORE CKPT/SPOOL OPEN         ONL02
         B     Q#AFTOPN         5  AFTER CKPT/SPOOL OPEN          ONL02
         B     Q#SPOOL          6  READSPC RTN (AFTER SPOOL I/O)  ONL02
         B     Q#PARSE          7  QUEUE SUBCOMMAND AUTHORIZATION ONL02
         B     Q#FINDJ          8  FINDJOB RTN FOR JOB            ONL02
         B     Q#JCL            9  JCL CMD FOR JOB                ONL02
         B     Q#JLOG          10  JLOG CMD FOR JOB               ONL02
         B     Q#JMSG          11  JMSG CMD FOR JOB               ONL02
         B     Q#LIST          12  LIST CMD FOR JOB/DSID          ONL02
         B     Q#JHIST         13  JHIST CMD FOR JOB              ONL02
         B     Q#DD            14  DD CMD FOR JOB                 ONL02
         B     Q#PDDB          15  PDDB CMD FOR JOB               ONL02
         B     Q#SYSOUT        16  DEL/REQ/CAN CMDS FOR JOB       ONL02
         B     Q#SYSLOG        17  AUTHORIZATION TO LOOK AT SYSLOGONL02
         SPACE 1                                                  ONL02
MAXCODE  EQU   (*-4-VECTOR)/4      MAX SUPPORTED REQUEST CODE     ONL02
         SPACE 1                                                  ONL02
BOMB     DS    0H                  INVALID AUTH REQUEST CODE      ONL02
         WTO   'QUEUE COMMAND INTERNAL LOGIC ERROR IN AUTH RTN',  ONL02X
               ROUTCDE=11                                         ONL02
         SPACE 1                                                  ONL02
         ABEND 913                 ABEND U0913                    ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = NULL REQUEST                            ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#NULL   DS    0H                  NULL REQUEST                   ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE COMMAND START-UP                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#START  DS    0H                  QUEUE COMMAND START-UP         ONL02
         SPACE 1                                                  ONL02
         AIF   (&QTSS).ONL06S1 DOR
*        AIF   (&QONL).ONL06S1                                    ONL06
         AIF   (&QRNB).RNB05S1                                    RNB05
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY GIVES JES2 SYSTEM PROGRAMMER   ONL02
*  AUTHORITY AND THE ABILITY TO ISSUE TSO COMMANDS FROM QUEUE     ONL02
*  TO ANYONE WHO HAS OPERATOR AUTHORITY.                          ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXOPER    DOES USER HAVE OPER AUTHORITY? ONL02
         BZ    QSNOOPER            SKIP IF NO                     ONL02
         OI    QAFLAGS,QAFXSYSP+QAFXEXEC  GIVE USER UNLIMITED AUTHONL02
QSNOOPER DS    0H                                                 ONL02
         SPACE 2                                                  ONL02
         AGO   .ONL06S2                                           ONL06
.ONL06S1 ANOP  ,                                                  ONL06
*                                                                 ONL06
*  AT ONL, USERS ARE DIVIDED INTO THREE GROUPS:                   ONL06
*  AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
*                                                                 ONL06
*    (1) ORDINARY USERS                                           ONL06
*    (2) USERS WITH THE TSO OPERATOR PRIVILEGE                    ONL06
*    (3) JES2 SYSTEM PROGRAMMERS                                  ONL06
*                                                                 ONL06
*  THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:     ONL06
*                                                                 ONL06
*    AUTHORIZATION    ----GROUP----    DESCRIPTION                ONL06
*    -------------    (1)  (2)  (3)    -------------------------  ONL06
*      QAFXACTV             X    X     DISPLAY ACTIVE LISTS       ONL06
*      QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS      ONL06
*      QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ        ONL06
*      QAFXSLOG             X    X     MAY LOOK AT SYSLOG         ONL06
*      QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE  ONL06
*      QAFXOPER             X    X     OPERATOR AUTHORITY         ONL06
*      QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER     ONL06
*                                                                 ONL06
*  A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY        ONL06
*  IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO       ONL06
*  CONTAINED IN A TABLE BELOW (SEE SYMBOL SYSPTABL).              ONL06
*                                                                 ONL06
         SPACE 1                                                  ONL06
         NI    QAFLAGS,QAFXOPER    CLEAR ALL BUT OPER AUTHORITY   ONL06
         OI    QAFLAGS,QAFXSSSM+QAFXBLOG  GROUP 1 AUTHORITY       ONL06
         SPACE 1                                                  ONL06
         TM    QAFLAGS,QAFXOPER    DOES USER HAVE OPER AUTHORITY? ONL06
         BZ    QSNOOPER            SKIP IF NO                     ONL06
         SPACE 1                                                  ONL06
         OI    QAFLAGS,QAFXACTV+QAFXBLOG+QAFXSLOG ADD GROUP 2 AUTHONL06
         SPACE 1                                                  ONL06
         LA    R2,SYSPTABL         ADDR OF JES2 SYSTEM PGMR TABLE ONL06
         SPACE 1                                                  ONL06
QSNEXTSP DS    0H                  CHECK NEXT SYSTEM PGMR ENTRY   ONL06
         CLI   0(R2),X'FF'         END OF TABLE ?                 ONL06
         BE    QSNOSYSP            SKIP IF YES                    ONL06
         CLC   QLOGON,0(R2)        DOES USERID MATCH TABLE ENTRY? ONL06
         BE    QSSPHIT             SKIP IF YES                    ONL06
         LA    R2,8(,R2)           BUMP ADDR TO NEXT ENTRY        ONL06
         B     QSNEXTSP            LOOP TO CHECK NEXT ENTRY       ONL06
         SPACE 1                                                  ONL06
SYSPTABL DS    0CL8                USERID'S OF JES2 SYSTEM PGMR'S ONL06
         DC    CL8'DRC'                                           ONL06
         DC    CL8'TES'                                           ONL06
         DC    CL8'CLJ'                                           ONL06
         DC    CL8'ETA'                                           ONL06
         DC    CL8'AEN'                                           ONL06
         DC    CL8'DET'                                           ONL06
         DC    X'FF'               FLAG END OF TABLE              ONL06
         SPACE 1                                                  ONL06
QSSPHIT  DS    0H                  USER ID FOUND IN SYS PGMR TABLEONL06
         OI    QAFLAGS,QAFXSYSP+QAFXEXEC  SET JES2 SYS-PGMR & EXECONL06
         OI    QAFLAGS,QAFXSSSM    ASSUME GROUP 1 AUTHORITY       ONL06
QSNOSYSP DS    0H                  CONT HERE IF NOT JES2 SYS PGMR ONL06
QSNOOPER DS    0H                  CONT HERE IF NO OPER AUTHORITY ONL06
         SPACE 1                                                  ONL06
.RNB05S1 AIF   (NOT &QRNB).RNB05S2                                RNB05
         SPACE 1                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE AUTHORIZATION FLAGS ARE SET AS FOLLOWS:            RNB05
*                                                                 RNB05
         MVI   QAFLAGS,QAFXACTV+QAFXBLOG+QAFXSSSM+QAFXSLOG        RNB05
         SPACE 1                                                  RNB05
.RNB05S2 ANOP  ,                                                  RNB05
.ONL06S2 ANOP  ,                                                  ONL06
         AIF   (&QTSS).CDS06S1 DOR
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY TURNS OF AUTHORITY FOR THE     ONL02
*  SUB-SYSTEM INTERFACE COMMANDS IF THE QUEUE COMMAND IS NOT      ONL02
*  APF AUTHORIZED.                                                ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TESTAUTH FCTN=1           TEST FOR APF AUTHORIZATION     ONL02
         SPACE 1                                                  ONL02
         LTR   R15,R15             ARE WE APF AUTHORIZED?         ONL02
         BZ    QSNOTAPF            SKIP IF YES                    ONL02
         NI    QAFLAGS,255-QAFXSSSM  ELSE, TURN OFF SSSM AUTHORITYONL02
.CDS06S1 ANOP
QSNOTAPF DS    0H                                                 ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY SETS THE HELP CONTROL FLAGS    ONL02
*  FROM THE AUTHORITY FLAGS.                                      ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         MVC   QAHELP,QAFLAGS      SET HELP FLAGS PER AUTHORITY   ONL02
         SPACE 1                                                  ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE COMMAND TERMINATION               ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#END    DS    0H                  QUEUE COMMAND TERMINATION      ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DATASET ALLOCATION/UNALLOCATION         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#ALLOC  DS    0H                  DATASET ALLOCATION/UNALLOCATIONONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = PRE-OPEN FOR CHECKPOINT/SPOOL DATASETS  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#BEFOPN DS    0H                  BEFORE CKPT/SPOOL OPEN         ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03BO                               RNB03
         SPACE 1                                                  RNB03
         TESTAUTH FCTN=1           APF-AUTHORIZED?                RNB03
         LTR   R15,R15                                            RNB03
         BNZ   RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES -                         RNB03
         RACSTAT ,                 IS RACF UP?                    RNB03
         LTR   R15,R15                                            RNB03
         BNZ   RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES -                         RNB03
         CLI   QNEWUSR,0           IS THERE A NEW USERID TO USE?  RNB03
         BE    RNB03BO             /NO  - CAN'T CHG ACEEUSER      RNB03
*                                  /YES - CHANGE ACEEUSER TO      RNB03
*                                         ALLOW ACCESS TO THE     RNB03
*                                         SPOOL/CKPT DATA SETS    RNB03
         L     R2,CVTPTR           CVT                            RNB03
         USING CVT,R2              #####                          RNB03
         L     R2,CVTTCBP          TCB WORDS                      RNB03
         L     R2,12(,R2)          CURRENT ASCB                   RNB03
         USING ASCB,R2             #####                          RNB03
         L     R2,ASCBASXB         ASXB                           RNB03
         USING ASXB,R2             #####                          RNB03
         ICM   R2,15,ASXBSENV      ACEE                           RNB03
         BZ    RNB03BO             FORGET IT IF NO ACEE           RNB03
         USING ACEE,R2             #####                          RNB03
         CLC   =C'ACEE',ACEEACEE   REALLY AN ACEE?                RNB03
         BNE   RNB03BO             /NO  - FORGET IT               RNB03
         MVC   QUSRSAV,ACEEUSER    /YES - SAVE CURRENT USERID     RNB03
         STAX  DEFER=YES           DON'T ALLOW ATTENTION'S        RNB03
         MODESET KEY=ZERO          GET KEY ZERO TO UPDATE ACEE    RNB03
         MVC   ACEEUSER,QNEWUSR    SET NEW USERID                 RNB03
         MODESET KEY=NZERO         BACK TO USER KEY               RNB03
RNB03BO  DS    0H                                                 RNB03
         DROP  R2                  #####                          RNB03
         SPACE 1                                                  RNB03
.RNB03BO ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = POST-OPEN FOR CHECKPOINT/SPOOL DATASETS ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#AFTOPN DS    0H                  AFTER CKPT/SPOOL OPEN          ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03AO                               RNB03
         SPACE 1                                                  RNB03
         CLI   QUSRSAV,0           DID WE CHANGE ACEEUSER?        RNB03
         BE    RNB03AO             /NO  - SKIP THIS CODE          RNB03
*                                  /YES - PUT USERID BACK         RNB03
         L     R2,CVTPTR           CVT                            RNB03
         USING CVT,R2              #####                          RNB03
         L     R2,CVTTCBP          TCB WORDS                      RNB03
         L     R2,12(,R2)          CURRENT ASCB                   RNB03
         USING ASCB,R2             #####                          RNB03
         L     R2,ASCBASXB         ASXB                           RNB03
         USING ASXB,R2             #####                          RNB03
         ICM   R2,15,ASXBSENV      ACEE                           RNB03
         USING ACEE,R2             #####                          RNB03
         MODESET KEY=ZERO          GET KEY ZERO TO UPDATE ACEE    RNB03
         MVC   ACEEUSER,QUSRSAV    SET OLD USERID                 RNB03
         MODESET KEY=NZERO         BACK TO USER KEY               RNB03
         STAX  DEFER=NO            ALLOW ATTENTION INTERRUPTS     RNB03
RNB03AO  DS    0H                                                 RNB03
         DROP  R2                  #####                          RNB03
         SPACE 1                                                  RNB03
.RNB03AO ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = READSPC ROUTINE (AFTER SPOOL I/O)       ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SPOOL  DS    0H                  READSPC RTN (AFTER SPOOL I/O)  ONL02
         SPACE 1                                                  RNB03
         AIF   (NOT &QRACF).RNB03SR                               RNB03
*                                                                 RNB03
*  WIPE OUT THE OLD AND NEW PASSWORDS WHEN A JCT IS READ FROM     RNB03
*  THE SPOOL.                                                     RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         LR    R8,R1               COPY ADDR OF SPOOL BUFFER      RNB03
         SL    R8,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
         SPACE 1                                                  RNB03
         CLC   JCTID,=CL4'JCT'     DID WE READ A JCT?             RNB03
         BNE   RNB03SRO            /NO  - FORGET IT               RNB03
         CLC   JCTJNAME,JCTJMRJN   JOB NAME IN BOTH PLACES?       RNB03
         BNE   RNB03SRO            /NO  - FORGET IT               RNB03
         CLC   =C'JOB ',JCTJOBID   IS IT AN STC, A JOB, OR A TSU? RNB03
         BE    RNB03SRJ            IF SO, ASSUME THIS IS A JCT    RNB03
         CLC   =C'TSU ',JCTJOBID                                  RNB03
         BE    RNB03SRJ                                           RNB03
         CLC   =C'STC ',JCTJOBID                                  RNB03
         BNE   RNB03SRO                                           RNB03
         SPACE 1                                                  RNB03
RNB03SRJ DS    0H                  THIS MUST BE A JCT             RNB03
         XC    JCTPASS,JCTPASS     WIPE OUT THE OLD AND           RNB03
         XC    JCTNUPAS,JCTNUPAS    NEW PASSWORDS                 RNB03
RNB03SRO DS    0H                  CONT. HERE IF NOT A GOOD JCT   RNB03
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB03
         SPACE 1                                                  RNB03
.RNB03SR ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = QUEUE SUBCOMMAND AUTHORIZATION          ONL02
*                                                                 ONL02
*   THIS ENTRY IS USED TO CONTROL WHO CAN USE WHICH QUEUE         ONL02
*   SUB-COMMAND.  OTHER ENTRIES MAY FUTHER RESTRICT THE FUNCTION  ONL02
*   OF SOME SUB-COMMANDS.  INSTALLATIONS MAY TAYLOR THE FUNCTION  ONL02
*   OF THIS ENTRY BY ASSIGNING USER FLAGS IN THE PARSE TABLE      ONL02
*   (QSCE MACROS) AND BY INSERTING THEIR OWN CODE BELOW.          ONL02
*                                                                 ONL02
*   A SUB-COMMAND IS ALLOWED TO PROCEED IF ALL SUB-COMMAND TYPE   ONL02
*   RESTRICTIONS ('TYPE=' CODED IN THE QSCE MACRO) HAVE           ONL02
*   CORRESPONDING AUTHORIZATION BITS SET ON IN THE AUTHORIZATION  ONL02
*   FLAGS (QAFLAGS).                                              ONL02
*                                                                 ONL02
*   THE USER WILL GET THE HELP SCREEN IF THEY ENTER A COMMAND     ONL02
*   WHICH IS NOT ALLOWED.                                         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#PARSE  DS    0H                  QUEUE SUBCOMMAND AUTHORIZATION ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO SUPERCEDE STANDARD CHECKING                ONL02
         SPACE 1                                                  ONL02
         ICM   R2,1,QASCFLGS       PICKUP SUB-COMMAND AUTH FLAGS  ONL02
         BZ    QPOK                SKIP IF NO RESTRICTIONS        ONL02
         EX    R2,QPTM             DOES USER HAVE THE AUTHORITY?  ONL02
         BO    QPOK                SKIP IF COMMAND IS ALLOWED     ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO ALLOW RESTRICTED SUB-COMMANDS TO PROCEED   ONL02
         SPACE 1                                                  ONL02
QPNOK    DS    0H                  COMMAND IS NOT ALLOWED         ONL02
         XC    QCODEH,QCODEH       CLEAR FUNCTION CODE            ONL02
         MVC   QSUBCMD,=V(HELP)    REDIRECT TO THE HELP ROUTINE   ONL02
         B     AUTHOK              PROCEED AS IF HELP WERE ENTEREDONL02
         SPACE 2                                                  ONL02
QPOK     DS    0H                  COMMAND IS ALLOWED             ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE TO IMPOSE ADDTIONAL RESTRICTIONS              ONL02
         AIF   (NOT &QRACF).RNB03P1                               RNB03
*                                                                 RNB03
*  ISSUE RACHECK MACRO AND SET JES2 SYSTEM PROGRAMMER AUTHORITY   RNB03
*  IF USER IS AUTHORIZED                                          RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         CLC   =C'XP',QSUBNAME     IS THIS THE XP COMMAND?        RNB03
         BNE   QPNOTXP             SKIP IF NO                     RNB03
         SPACE 1                                                  RNB03
         RACHECK ENTITY=QRACNMXP,MF=(E,QRACHECK)                  RNB03
         SPACE 1                                                  RNB03
         LTR   R15,R15             IS USER AUTHORIZED?            RNB03
         BNZ   QPNOK               IF NOT, DON'T ALLOW COMMAND    RNB03
         OI    QAFLAGS,QAFXSYSP    GIVE USER JES2 SYS PGMR AUTH   RNB03
         OI    QAHELP,QAHXSYSP     UPDATE HELP DISPLAY CNTL FLAGS RNB03
QPNOTXP  DS    0H                                                 RNB03
         SPACE 1                                                  RNB03
.RNB03P1 ANOP  ,                                                  RNB03
         AIF   (NOT &QRNB).RNB06P2                                RNB06
*                                                                 RNB06
*  AT RNB, CERTAIN COMMANDS ARE NOT ALLOWED                       RNB06
*                                                                 RNB06
         SPACE 1                                                  RNB06
         CLC   =C'MO',QSUBNAME     DO NOT                         RNB06
         BE    QPNOK                ALLOW                         RNB06
         CLC   =C'M ',QSUBNAME       THE MODEL,                   RNB06
         BE    QPNOK                  TSO, OR                     RNB06
         CLC   QSUBCMD,=V(CTSO)        EXEC                       RNB06
         BE    QPNOK                    COMMANDS                  RNB06
.RNB06P2 ANOP  ,                                                  RNB06
         SPACE 1                                                  ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
QPTM     TM    QAFLAGS,*-*         (EXECUTED) MATCH AUTH FLAGS    ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = FINDJOB ROUTINE FOR JOB AUTHORIZATION   ONL02
*                                                                 ONL02
*   THIS ENTRY IS THE FIRST LINE OF DEFENSE AT THE JOB LEVEL.  IT ONL02
*   IS ENTERED BEFORE A USER CAN LOOK AT A JOB'S INPUT/OUTPUT OR  ONL02
*   DO ANYTHING WITH A JOB.  OTHER ENTRIES IN THIS AUTHORIZATION  ONL02
*   MODULE MAY FUTHER REFINE A JOB LEVEL AUTHORITY GRANTED BY     ONL02
*   THIS ENTRY.                                                   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#FINDJ  DS    0H                  FINDJOB RTN FOR JOB            ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRACF).RNB03F1                                   RNB03
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY IS TO ALLOW THE USER ACCESS    ONL02
*  TO ANY JOB WHOSE JOBNAME BEGINS WITH THEIR USERID.  USERS      ONL02
*  WITH OPERATOR AUTHORITY OR JES2 SYSTEM PROGRAMMER AUTHORITY    ONL02
*  HAVE ACCESS TO ALL JOBS IN THE SYSTEM.  THE ACCESS MAY BE      ONL02
*  RESTRICTED BY OTHER ENTRIES IN THIS MODULE.                    ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXOPSP    USER HAS OPER OR SYS PGMR AUTH?ONL02
         BNZ   AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         SPACE 1                                                  ONL02
         L     R8,QCJCTA           ADDR OF JCT                    ONL02
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
         SPACE 1                                                  ONL02
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           ONL02
         BNP   FINDJNOK            ERROR IF NO LENGTH             ONL02
         BCTR  R1,0                LESS ONE FOR EXECUTE           ONL02
         EX    R1,FINDJCLC         JOBNAME BEGINS WITH USERID ?   ONL02
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         B     FINDJNOK            ELSE, GO TELL USER             ONL02
         SPACE 1                                                  ONL02
FINDJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     ONL02
         SPACE 1                                                  ONL02
FINDJNOK DS    0H                  JOBNAME DOESN'T MATCH USERID   ONL02
         SPACE 1                                                  FCI01
         AIF   (NOT &QACF2).FCI01F1                               FCI01
*                                                                 FCI01
*  THIS CODE USES THE ACF2 SVC TO SEE IF THE USER MAY ACCESS A    FCI01
*  FICTITIOUS DSNAME OF THE FORM 'SYSOUT.LOGONID.JOBNAME'.  IF    FCI01
*  ACF2 WILL ALLOW THIS ACCESS, THEN THE QUEUE FUNCTION WILL      FCI01
*  PROCEED.                                                       FCI01
*                                                                 FCI01
         SPACE 1                                                  FCI01
         AIF   (NOT &QSP).FCI01F2                                 FCI01
         SPACE 1                                                  FCI01
         #ACFJES2 ,                SET ACF2 MVS/SP JES2 SPECS.    FCI01
         SPACE 1                                                  FCI01
         ICM   R7,15,&ACF2JCT      ACF2 AREA OFFSET IN JCT        FCI01
         BZ    ADSNNOK             DENY ACCESS IF NO ACF2 AREA    FCI01
         LA    R7,JCTDSECT(R7)     ADDR OF ACF2 AREA              ONL16
         USING #ACFJCTX,R7         NOTE ACF AREA 2ADDRESSABILITY  FCI01
         SPACE 1                                                  FCI01
         CLC   JCTACFJ,=C'ACFJ'    IS IT THE ACF2 AREA ?          FCI01
         BZ    ADSNNOK             IF NOT, DENY ACCESS            FCI01
         SPACE 1                                                  FCI01
.FCI01F2 ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         CLC   QLOGON,LIDLID       USERS LOGONID=JOBS ACF LOGONID?FCI01
         BE    AUTHOK              YES..CONTINUE FORTHWITH        FCI01
         SPACE 1                                                  FCI01
         ACFGACVT R6,NONE=ADSNNOK  GET THE ACF2 CVT               FCI01
         SPACE 1                                                  FCI01
         USING ACCVT,R6            NOTE ACF2 CVT ADDRESSABILITY   FCI01
         SPACE 1                                                  FCI01
         MVC   ADSNAME,=CL44'SYSOUT. '  INITIALIZE DSNAME TO USE  FCI01
         XC    ACFSPARM(ACFSPRML),ACFSPARM   CLEAR REQUEST BLOCK  FCI01
         MVI   ACFSPREQ,ACFSPRDS   DSNAME ACCESS ONLY             FCI01
         MVI   ACFSPID1,ACFSPIUR   DIS AM DE USER TALKING....     FCI01
         LA    R5,ADSNAME          GET DSNAME ADDRESS             FCI01
         ST    R5,ACFSPDSN         AND GIVE IT TO ACF PARM LIST   FCI01
         SPACE 1                                                  FCI01
*  GENERATE A DSN OF THE FORM 'SYSOUT.LOGONID.JOBNAME'            FCI01
         SPACE 1                                                  FCI01
         MVC   ADSNAME+7(8),LIDLID MOVE LID TO DSNAME             FCI01
         CLI   ADSNAME+7,C' '      IS THE LID BLANK?              FCI01
         BNE   ADSNCHK0            NO..NORMAL PROCESS             FCI01
         SPACE 1                                                  FCI01
*  GOT HERE BECAUSE LID IS ' ' (BLANK)..SUBSTITUTE 'SYSTEM'       FCI01
         MVC   ADSNAME+7(8),=CL8'SYSTEM'                          FCI01
         SPACE 1                                                  FCI01
ADSNCHK0 LA    R1,ADSNAME+7        GET ADDRESS                    FCI01
         LA    R5,8                LOAD COUNT                     FCI01
ADSNCHK  CLI   0(R1),C' '          LOOK FOR BLANK                 FCI01
         BE    ADSNCHK1            GOTIT..                        FCI01
         LA    R1,1(R1)            BUMP AND                       FCI01
         BCT   R5,ADSNCHK            GRIND                        FCI01
ADSNCHK1 MVI   0(R1),C'.'          MOVE IN PERIOD..               FCI01
         MVC   1(8,R1),JCTJNAME    MOVE IN JOBNAME                FCI01
         SPACE 1                                                  FCI01
         LA    R1,ACFSPARM         GET ADDRESS OF PARM FIELD      FCI01
         ACFSVC (1),TYPE=S,NONE=ADSNNOK,CVT=HAVE  INVOKE A C F 2  FCI01
         SPACE 1                                                  FCI01
         LTR   R15,R15             HOW DID YOU LIKE THEM APPLES?  FCI01
         BC    8,AUTHOK            ..OK BY YOU...CONTINUE..       FCI01
         SPACE 1                                                  FCI01
ADSNNOK  DS    0H                  ACF2 DOWN OR ACCESS NOT ALLOWEDFCI01
         QTILT '*** SORRY..NO ACF2 AUTHORITY TO LOOK AT THIS JOB' FCI01
         SPACE 1                                                  FCI01
         DROP  R6                  KILL ACF2 CVT ADDRESSABILITY   FCI01
         SPACE 1                                                  FCI01
         AIF   (NOT &QSP).FCI01F1                                 FCI01
         SPACE 1                                                  FCI01
         DROP  R7                  KILL ACF AREA 2ADDRESSABILITY  FCI01
         SPACE 1                                                  FCI01
.FCI01F1 ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           ONL02
         SPACE 1                                                  ONL02
         DROP  R8                  KILL JCT ADDRESSABILITY        ONL02
         SPACE 1                                                  RNB03
         AGO   .RNB03F2                                           RNB03
.RNB03F1 ANOP  ,                                                  RNB03
*                                                                 RNB03
*  AT RNB, CHECKING FOR THE ENTRY FROM FINDJOB IS DONE ONLY FOR   RNB03
*  THE XD SUB-COMMAND:  RACHECK FOR APPL-QUEUEXDS AND PASS THE    RNB03
*  JOBNAME AS THE APPL FOR LOGGING                                RNB03
*                                                                 RNB03
         SPACE 1                                                  RNB03
         CLC   =C'XD',QSUBNAME     IS THIS AN XD COMMAND?         RNB03
         BNE   AUTHOK              DONE IF NO                     RNB03
         SPACE 1                                                  RNB03
         L     R2,QCJCTA           ADDR OF JCT                    RNB03
         USING JCTDSECT,R2         NOTE JCT ADDRESSABILITY        RNB03
         SPACE 1                                                  RNB03
         RACHECK ENTITY=QRACNMXD,APPL=JCTJNAME,MF=(E,QRACHECK)    RNB03
         SPACE 1                                                  RNB03
         LTR   R15,R15             IS ACCESS ALLOWED?             RNB03
         BZ    AUTHOK              DONE IF YES                    RNB03
         SPACE 1                                                  RNB03
         QTILT '*** XDS COMMAND NOT ALLOWED ***'                  RNB03
         SPACE 1                                                  RNB03
         DROP  R2                  KILL JCT ADDRESSABILITY        RNB03
         SPACE 1                                                  RNB03
.RNB03F2 ANOP  ,                                                  RNB03
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JCL COMMAND FOR JOB AUTHORIZATION       ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JCL    DS    0H                  JCL COMMAND FOR JOB            ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JLOG COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JLOG   DS    0H                  JLOG COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JMSG COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JMSG   DS    0H                  JMSG COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = LIST COMMAND FOR JOB/DSID AUTHORIZATION ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#LIST   DS    0H                  LIST CMD FOR JOB AND DSID      ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRNB).RNB05L1                                    RNB05
*                                                                 ONL02
*  THE DEFAULT CODE DOES NOT ALLOW THE LIST COMMAND TO BE USED    ONL02
*  FOR A DATASET ID (DSID) LESS THAN 101 UNLESS THE USER HAS JES2 ONL02
*  SYSTEM PROGRAMMER AUTHORITY.                                   ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXSYSP    DOES USER HAVE SYS PGMR AUTH ? ONL02
         BO    DSIDOK              SKIP IF YES, ALLOW ANY DSID    ONL02
         CLC   QPDSID,=H'101'      IS THE DSID ID LESS THAN 101?  ONL02
         BNL   DSIDOK              SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
         XC    QPDSID,QPDSID       INVALIDATE DSID                ONL02
         SPACE 1                                                  ONL02
         QTILT '*** DATASET ID INVALID ***'                       ONL02
         SPACE 1                                                  ONL02
DSIDOK   DS    0H                  THE DSID IS OK                 ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 1                                                  RNB05
         AGO   .RNB05L2                                           RNB05
.RNB05L1 ANOP  ,                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE LIST COMMAND MAY NOT BE USED FOR A DATASET ID      RNB05
*  (DSID) LESS THAN 101.                                          RNB05
*                                                                 RNB05
         SPACE 1                                                  RNB05
         CLC   QPDSID,=H'101'      IS THE DSID ID LESS THAN 101?  RNB05
         BNL   DSIDOK              SKIP IF YES                    RNB05
         XC    QPDSID,QPDSID       INVALIDATE DSID                RNB05
         QTILT '*** DATASET ID INVALID ***'                       RNB05
         SPACE 1                                                  RNB05
DSIDOK   DS    0H                  THE DSID IS OK                 RNB05
         SPACE 2                                                  RNB05
*                                                                 RNB05
*  AT RNB, THE JOBNAME MUST BEGIN WITH THE USER'S USERID.         RNB05
*  OTHERWISE:                                                     RNB05
*                                                                 RNB05
*   (1) "PJS" USERS CAN'T LIST ANYTHING.                          RNB05
*   (2) OTHERS CAN LIST IF THEIR USERID IS SPECIFIED IN A NOTIFY  RNB05
*       PARAMETER ON THE JOB STATEMENT.                           RNB05
*   (3) "TEC" USERS CAN LIST FROM ANY "TEC" JOBS OR JOBS WITH A   RNB05
*       NOTIFY FOR A "TEC" USERID.                                RNB05
*   (4) "TEC" USERS CAN LIST FROM ANY STARTED TASK.               RNB05
*                                                                 RNB05
         SPACE 1                                                  RNB05
         L     R8,QCJCTA           ADDR OF JCT                    RNB05
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
         SPACE 1                                                  RNB05
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB05
         BNP   LISTNOK             ERROR IF NO LENGTH             RNB05
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB05
         EX    R1,LISTJCLC         JOBNAME BEGINS WITH USERID ?   RNB05
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      RNB05
         SPACE 1                                                  RNB05
         CLC   =C'PJS',QLOGON      IS THIS A PJS USER?            RNB05
         BE    LISTNOK             INVALID JOB IF SO              RNB05
         EX    R1,LISTNCLC         NOTIFY ID BEGINS WITH USERID ? RNB05
         BE    AUTHOK              GOOD JOB IF SO                 RNB05
         CLC   =C'TEC',QLOGON      IS THIS A TEC USERID?          RNB05
         BNE   LISTNOK             INVALID JOB IF NOT             RNB05
         CLC   =C'TEC',JCTJNAME    FOR A TEC USER, ALLOW LIST     RNB05
         BE    AUTHOK              FOR ANY TEC JOB OR ANY JOB     RNB05
         CLC   =C'TEC',JCTTSUID    WITH A TEC NOTIFY              RNB05
         BE    AUTHOK                                             RNB05
         TM    JCTJOBFL,JCTSTCJB   ALSO ALLOW IF AN STC           RNB05
         BNZ   AUTHOK                                             RNB05
         SPACE 1                                                  RNB05
LISTNOK  DS    0H                  USER MAY NOT LIST THIS DATASET RNB05
         XC    QPDSID,QPDSID       INVALIDATE DSID                RNB05
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           RNB05
         SPACE 1                                                  RNB05
LISTJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     RNB05
LISTNCLC CLC   QLOGON(*-*),JCTTSUID  EXECUTED - MATCH NOTIFY ID   RNB05
         SPACE 1                                                  RNB05
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB05
         SPACE 1                                                  RNB05
.RNB05L2 ANOP  ,                                                  RNB05
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = JHIST COMMAND FOR JOB AUTHORIZATION     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#JHIST  DS    0H                  JHIST COMMAND FOR JOB          ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DD COMMAND FOR JOB AUTHORIZATION        ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#DD     DS    0H                  DD COMMAND FOR JOB             ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = PDDB COMMAND FOR JOB AUTHORIZATION      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#PDDB   DS    0H                  PDDB COMMAND FOR JOB           ONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = DEL, REQ, AND CAN COMMANDS FOR JOB AUTH ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SYSOUT DS    0H                  DEL/REQ/CAN CMDS FOR JOB       ONL02
         SPACE 1                                                  ONL02
         AIF   (&QRNB).RNB08S1                                    RNB08
*                                                                 ONL02
*  THE DEFAULT CODE FOR THIS ENTRY IS TO ALLOW THE DEL, REQ, AND  ONL02
*  CAN COMMANDS TO BE USED ONLY ON JOBS WHOSE JOBNAME BEGINS WITH ONL02
*  THE USER'S USERID.  USERS WHO HAVE JES2 SYSTEM PROGRAMMER      ONL02
*  AUTHORITY MAY USE ANY JOBNAME.                                 ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXSYSP    USER HAS JES2 SYSTEM PGMR AUTH?ONL02
         BO    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         SPACE 1                                                  ONL02
         L     R8,QCJCTA           ADDR OF JCT                    ONL02
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
         SPACE 1                                                  ONL02
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           ONL02
         BNP   SYSONOK             ERROR IF NO LENGTH             ONL02
         BCTR  R1,0                LESS ONE FOR EXECUTE           ONL02
         EX    R1,SYSOCLC          JOBNAME BEGINS WITH USERID ?   ONL02
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      ONL02
         B     SYSONOK             ELSE, GO TELL USER             ONL02
         SPACE 1                                                  ONL02
SYSOCLC  CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     ONL02
         SPACE 1                                                  ONL02
SYSONOK  DS    0H                  JOBNAME DOESN'T MATCH USERID   ONL02
         QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           ONL02
         SPACE 1                                                  ONL02
         DROP  R8                  KILL JCT ADDRESSABILITY        ONL02
         SPACE 1                                                  RNB08
         AGO   .RNB08S2                                           RNB08
.RNB08S1 ANOP  ,                                                  RNB08
*                                                                 RNB08
*  AT RNB, ALLOW DEL/REQ/CAN IF JOBNAME STARTS WITH USERID OR     RNB08
*  NOTIFY IS FOR USERID, UNLESS JOB SUBMITTED FROM PJS.  ALLOW    RNB08
*  TEC USERS TO MANIPULATE OTHER TEC USER'S JOBS AND ALSO STC'S.  RNB08
*                                                                 RNB08
         SPACE 1                                                  RNB08
         L     R8,QCJCTA           ADDR OF JCT                    RNB08
         USING JCTDSECT,R8         NOTE JCT ADDRESSABILITY        ONL16
         SPACE 1                                                  RNB08
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB08
         BNP   SYSONOK             ERROR IF NO LENGTH             RNB08
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB08
         EX    R1,SYSOJCLC         JOBNAME BEGINS WITH USERID ?   RNB08
         BE    AUTHOK              DONE IF YES, ALLOW ACCESS      RNB08
         SPACE 1                                                  RNB08
         CLC   =C'PJS',QLOGON      IS THIS A PJS USER?            RNB08
         BE    SYSONOK             YES - INVALID                  RNB08
         BAL   R6,SYSPJSCK         ENSURE NOT PJS JOB FOR CAN/DEL RNB08
         SPACE 1                                                  RNB08
         L     R8,QCJCTA           RESTORE JCT ADDRESSABILITY     RNB08
         ICM   R1,15,QLOGONLN      GET LENGTH OF USERID           RNB08
         BCTR  R1,0                LESS ONE FOR EXECUTE           RNB08
         EX    R1,SYSONCLC         NOTIFY ID BEGINS WITH USERID ? RNB08
         BE    AUTHOK              YES - OK                       RNB08
         CLC   =C'TEC',QLOGON      IS THIS A TEC USER?            RNB08
         BNE   SYSONOK             NO  - INVALID                  RNB08
         TM    JCTJOBFL,JCTSTCJB   IS IT AN STC?                  RNB08
         BO    AUTHOK              /YES - OK FOR TEC USER         RNB08
         CLC   =C'TEC',JCTJNAME    IS JOBNAME FOR A TEC USER?     RNB08
         BE    AUTHOK              YES - OK                       RNB08
         CLC   =C'TEC',JCTTSUID    IS NOTIFY FOR A TEC USER?      RNB08
         BE    AUTHOK              YES - OK                       RNB08
         SPACE 1                                                  RNB08
SYSONOK  QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'           RNB08
         SPACE 1                                                  RNB08
SYSOJCLC CLC   JCTJNAME(*-*),QLOGON  EXECUTED - MATCH JOBNAME     RNB08
SYSONCLC CLC   QLOGON(*-*),JCTTSUID  EXECUTED - MATCH NOTIFY ID   RNB08
         SPACE 1                                                  RNB08
         DROP  R8                  KILL JCT ADDRESSABILITY        RNB08
         SPACE 2                                                  RNB08
*                                                                 RNB08
*  SUBROUTINE TO TILT IF PJS JOB (ONLY FOR CANCEL OR DELETE)      RNB08
*                                                                 RNB08
         SPACE 1                                                  RNB08
         USING PDBDSECT,R1         NOTE PDDB ADDRESSABILITY       RNB08
         USING IOTDSECT,R3         NOTE IOT ADDRESSABILITY        RNB08
         SPACE 1                                                  RNB08
SYSPJSCK CLI   QCODEH+1,4          IS THIS A REQUEUE?             RNB08
         BER   R6                  /YES - OK FOR NOW              RNB08
*                                  /NO  - ENSURE NOT A PJS JOB    RNB08
         L     R3,QCIOTA           LOAD BASE REG                  RNB08
         SH    R3,=Y(IOTSTART-IOTDSECT) ADJUST FOR HEADER            CL
         LR    R5,R3               BASE OF IOT                    RNB08
         A     R5,IOTPDDBP         OFFSET BEYOND LAST PDDB        RNB08
         LR    R1,R3               BASE OF IOT                    RNB08
         A     R1,QCPDDB1          OFFSET TO FIRST PDDB IN IOT    RNB08
SYSPFDDS DS    0H                  SEARCH IOT FOR DSID = 5        RNB08
         CLC   IOTID,=CL4'IOT'     WAS AN IOT READ FROM SPOOL ?   RNB08
         BNE   SOBADIOT            ERROR IF NO                    RNB08
         CLC   QPJOBID,IOTJBKEY    IS THE IOT'S JOB KEY VALID ?   RNB08
         BNE   SOBADIOT            ERROR IF NO                    RNB08
         CLC   =H'5',PDBDSKEY      IS THIS THE DATASET?           RNB08
         BE    SYSPID5             YES. CONTINUE.                 RNB08
         LA    R1,PDBLENG(R1)      NO. LOOK AT NEXT PDDB.         RNB08
         CR    R1,R5               HAVE WE GONE PAST LAST PDDB?   RNB08
         BL    SYSPFDDS            NO. TRY AGAIN.                 RNB08
         B     SOBADTXR            ELSE BAD DD TABLE (INTERP. JCL)RNB08
SYSPID5  L     R5,PDBMTTR          DISK ADDR OF FIRST BLOCK       RNB08
         DROP  R1                  KILL PDDB ADDRESSABILITY       RNB08
         L     R7,QCBLKA           ADDR OF DATASET BLOCK IOAREA   RNB08
         MVC   QDMSG,QBLANK        BLANK OUT THE MESSAGE AREA     RNB08
         ST    R5,QCTRAK           STORE DISK ADDR                RNB08
         LR    R1,R7               IOAREA ADDRESS                 RNB08
         L     R15,=V(READSPC)     ADDR OF ROUTINE TO READ SPOOL  RNB08
         BALR  R14,R15             GO TO IT                       RNB08
         CLC   QPJOBID,4(R7)       IS RECORD'S JOB JEY VALID?     RNB08
         BNE   SOBADTXR            ERROR IF NO                    RNB08
         CLC   8(2,R7),=H'5'       IS RECORD'S DSID VALID?        RNB08
         BNE   SOBADTXR            ERROR IF NO                    RNB08
         LA    R5,10(R7)           ADDR OF FIRST RECORD IN BLOCK  RNB08
         SR    R7,R7               ZERO OUT REG                   RNB08
         IC    R7,0(R5)            INSERT LENGTH                  RNB08
         CLI   5(R5),1             IS THIS A JOB RECORD?          RNB08
         BNE   SOBADJTX            /NO  - INVALID INTERNAL TEXT   RNB08
         LA    R5,9(R5)            ADDR OF FIRST KEY              RNB08
         LR    R8,R7               REMAINING LENGTH OF RECORD     RNB08
         SR    R15,15              ZERO OUT R15                   RNB08
         SR    R14,R14             ZERO OUT R14                   RNB08
         SR    R1,R1               ZERO OUT R1                    RNB08
SYSPCKEY CLI   0(R5),X'A5'         IS THIS THE USER= PARM?        RNB08
         BE    SYSPGOTU            YES. PROCESS IT.               RNB08
         IC    R1,1(R5)            NUMBER OF SUBFIELDS            RNB08
         LA    R5,2(R5)            UPDATE LOCATION                RNB08
         SH    R8,=H'2'            REMAINING COUNT                RNB08
         SR    R8,R1               REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
         LTR   R1,R1               ARE THERE ANY SUBFIELDS?       RNB08
         BZ    SYSPCKEY            NO. TRY NEXT FIELD.            RNB08
SYSPNXSF TM    0(R5),X'80'         IS THIS A SUB-SUB-FIELD        RNB08
         BZ    SYSPNOSS            NO. CONTINUE.                  RNB08
         NI    0(R5),X'7F'         CLEAR THE HEX 80 BIT           RNB08
         IC    R14,0(R5)           NUMBER OF SUB-SUB-FIELDS       RNB08
         LA    R5,1(R5)            UPDATE LOCATION                RNB08
         SH    R8,=H'1'            REMAINING COUNT                RNB08
         SR    R8,R14              REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
         AR    R1,R14              INCREASE NUMBER OF SUBFIELDS   RNB08
         B     SYSPYESS            DECREMENT AND TRY AGAIN        RNB08
SYSPNOSS IC    R15,0(R5)           SUBFIELD LENGTH                RNB08
         LA    R5,1(R15,R5)        ADD TO LOCATION                RNB08
         SR    R8,R15              REMAINING COUNT                RNB08
         BNP   SOBADJTX            RECORD IS EXHAUSTED            RNB08
SYSPYESS BCT   R1,SYSPNXSF         DO NEXT SUBFIELD               RNB08
         B     SYSPCKEY            TRY NEXT FIELD                 RNB08
SYSPGOTU CLI   2(R5),7             IS USER ID LENGTH = 7?         RNB08
         BNER  R6                  /NO - NOT PJS JOB, PROCESS     RNB08
         CLI   2(R5),0             IS THE LENGTH ZERO?            RNB08
         BER   R6                  YES. SKIP THE FIELD.           RNB08
         CLC   =C'PROD',6(R5)      PJS JOB? (USER = ???PROD)      RNB08
         BE    SOPJSMSG            /YES - BAD                     RNB08
         BR    R6                  /NO  - GO PROCESS              RNB08
         SPACE 2                                                  RNB08
SOBADIOT QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       RNB08
SOBADTXR QTILT '*** JOB HAS PURGED (OR DSID 5 SPOOL ERROR) ***'   RNB08
SOBADJTX QTILT '*** CANNOT PROCESS JOB - INVALID JOB STMT TEXT'   RNB08
SOPJSMSG QTILT '*** CANNOT CAN/DEL JOB SUBMITTED VIA PJS ***'     RNB08
         SPACE 1                                                  RNB08
         DROP  R3                  KILL IOT ADDRESSABILITY        RNB08
         SPACE 1                                                  RNB08
.RNB08S2 ANOP  ,                                                  RNB08
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  PROCESS REQUEST TYPE = AUTHORIZATION TO LOOK AT SYSLOG         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
Q#SYSLOG DS    0H                  AUTHORIZATION TO LOOK AT SYSLOGONL02
         B     AUTHOK              ALLOW FUNCTION TO PROCEED      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  RETURN TO CALLER, REQUESTED FUNCTION MAY PROCEED               ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
AUTHOK   DS    0H                  REQUESTED FUNCTION MAY PROCEED ONL02
         QSTOP ,                   RETURN TO CALLER               ONL02
         SPACE 3                                                  ONL02
         LTORG ,                   DEFINE LITERAL ORIGIN          ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  GENERATE CONTROL BLOCK DSECTS                                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       ONL02
AUTH     CSECT ,                   RESUME CSECT                   ONL02
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL02
         SPACE 1                                                  ONL02
JCT      EQU   0                                                  ONL02
         SPACE 1                                                  ONL02
         $BUFFER ,                                                ONL16
         $JQE  ,                                                  ONL02
         $JCT  ,                                                  ONL02
         $PDDB ,                                                  ONL02
         $TAB  ,                                                  ONL02
         $IOT  ,                                                  ONL02
         SPACE 1                                                  ONL02
WORK     DSECT ,                   SAVE AREA WORK DSECT           ONL02
         DS    18F                 OS SAVE AREA                   ONL02
WORKAREA DS    0D                  START OF DATA                  ONL02
         SPACE 1                                                  ONL02
         AIF   (NOT &QRACF).RNB03CB                               RNB03
         CVT   DSECT=YES                                          RNB03
         IHAASCB ,                                                RNB03
         IHAASXB ,                                                RNB03
         IHAACEE ,                                                RNB03
.RNB03CB ANOP  ,                                                  RNB03
         SPACE 1                                                  RNB03
         AIF   (NOT &QACF2).FCI01CB                               FCI01
WORK     DSECT ,                   CONTINUE SAVE AREA WORK DSECT  FCI01
         ORG   WORKAREA            ORG PAST OS SAVE AREA          FCI01
         ACDSV DSECT=NO            PARAMETER LIST FOR THE ACF2 SVCFCI01
ADSNAME  DS    CL44                DSNAME USED WITH THE ACF2 SVC  FCI01
AUTH     CSECT ,                   RESUME CSECT                   FCI01
         SPACE 1                                                  FCI01
         ACCVT ,                                                  FCI01
         ACUCB ,                                                  FCI01
         IHAPSA ,                                                 FCI01
         AIF   (NOT &QSP).FCI01CB                                 FCI01
         #ACFJCTX ,                GEN ACF2 JCT EXTENSION DSECT   FCI01
.FCI01CB ANOP  ,                                                  FCI01
         SPACE 1                                                  FCI01
         QCOMMON ,                 GENERATE QCOMMON DSECT         ONL02
         SPACE 1                                                  ONL02
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL02
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    ONL02
         END   ,                                                  ONL02
./       ADD   NAME=CDIE
CDIE     TITLE 'QUEUE COMMAND - GENERATE S0C1 FOR DEBUGGING'      ONL01
CDIE     QSTART ,
         SPACE 1
         DC    X'00DEAD'                                          UF024
         DC    AL1(L'CDIEMSG)                                     UF024
CDIEMSG  DC    C'DIE COMMAND ENTERRED'                            UF024
         SPACE 1                                                  UF024
CDIEDONE DS    0H
         QTILT 'QUEUE OPERATION RESUMED'
         SPACE 1
SYMDEL   DSECT ,
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN
         QCOMMON ,
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS
SYMNODEL DSECT ,
         END
./       ADD   NAME=CHANMON
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/07/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
CHANMON  TITLE 'QUEUE COMMAND - CHANNEL BUSY MONITOR'
CHANMON  QSTART ,                  START CHANMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -  JOBTABLE
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***********************************************************************
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       IEEZC03D -       ##C  CHANNEL BUSY MONITOR                ***
***       VERSION -        2.2                                      ***
***       MVS LEVEL -      MVS/SE  3.8.  TO MVS/SP1.3               ***
***       UPDATED -        11/01/79                                 ***
***********************************************************************
         EJECT
*       CLI   TRACESWT,X'FF'
*        BE    TRACEOK
*        CALL TRACE
*        MVI   TRACESWT,X'FF'
TRACEOK  EQU    *
         SETAUTH ON
         MODESET KEY=ZERO,MODE=SUP
         L     R0,SIZEUCB          LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         ST    R1,EXTRAREA
         XC    CHNTAB(64),CHNTAB
         MVI   CHANNEL,X'00'
         LA    R3,QPARM1           PARM LIST ADDR
         CLC   0(R3),=CL3'   '
         BE    PARM1               NO PARM
         MVC   DSPSW(1),3(R3)      SAVE PARM
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),0(R3)
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),0(2,R3)
         CVB   R1,DOUBLE
         STC   R1,CHANNEL          SAVE CHANNEL
         CLI   DSPSW,C'D'          DEVICE BUSY
         BE    PARM2               YES, CONTINUE
         CLI   DSPSW,C'J'          DEVICE BUSY BY JOB
         BE    PARM2               YES, CONTINUE
         SPACE 1
PARM1    MVI   DSPSW,C' '
         SPACE 1
PARM2    MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(80),=CL80'   CHANNEL BUSY MONITOR '
         LA    R1,XTIME            WAITTIME ADDR
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
         SPACE 1
BYPASS   L     R3,8(0,R1)          LOAD MONITOR TIME
         MH    R3,=H'5'            TIMES 5
         LR    R5,R3
         B     CHNLOOP1
         EJECT
CHNLOOP  STIMER WAIT,DINTVL=INTERVL
         SPACE 1
CHNLOOP1 SR    R4,R4
         LA    R9,CHNTAB
         TCH   CHAN1               TEST CHANNEL 01 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN2               TEST CHANNEL 02 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN3               TEST CHANNEL 03 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN4               TEST CHANNEL 04 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN5               TEST CHANNEL 05 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN6               TEST CHANNEL 06 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN7               TEST CHANNEL 07 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN8               TEST CHANNEL 08 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         EJECT
         TCH   CHAN9               TEST CHANNEL 09 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN10              TEST CHANNEL 10 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN11              TEST CHANNEL 11 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN12              TEST CHANNEL 12 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN13              TEST CHANNEL 13 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN14              TEST CHANNEL 14 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         LA    R9,4(0,R9)          NEXT COUNT
         TCH   CHAN15              TEST CHANNEL 15 BUSY
         L     R1,0(0,R9)          LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R9)          SAVE BUSY COUNT
         SPACE 1
CHNEND   CLI   DSPSW,C' '          DEVICE DISPLAY
         BE    CHNEND1             NO
         BAL   R7,UCBLOOP
         SPACE 1
CHNEND1  BCT   R3,CHNLOOP
         B     BUSYCHK
         EJECT
UCBLOOP  STM   R0,R15,SAVEREGS
         XC    UCBDMSAV(24),UCBDMSAV
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         SPACE 1
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB5             YES, EXIT
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    CHKUCB1A            NO
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1A            NO
         MVI   CHANTEST,X'00'
         SR    R0,R0
         IC    R0,13(0,R1)
         SLL   R0,28
         SRL   R0,28
         TM    13(R1),X'F0'        CHAN 0 - 9
         BO    *+8                 YES
         A     R0,=F'9'
         STC   R0,CHANTEST         SAVE PRIMARY CHANNEL
         CLC   CHANTEST(1),CHANNEL CHANNEL MATCH
         BE    *+14                YES
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         L     R15,EXTRAREA
         USING  JOBTABS,R15
         LA    R6,UCBTABS
         DROP   R15
         LR    R14,R1             UCB ADDR
         S     R14,=F'4'          DECR ADDR -4
         L     R14,0(0,R14)       IOQ ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            ANY IOQ
         BZ    CHKUCB1A           NO
         L     R14,8(0,R14)       IOSB ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            EXIST
         BZ    CHKUCB1A           NO
         SR    R15,R15
         ICM   R15,3,6(R14)       ASID
         LA    R14,=CL8'*MASTER*'
         CH    R15,=H'1'          MASTER
         BE    CHKUCB2
         SLL   R15,2              X 4
         L     R14,16             CVT
         L     R14,556(0,R14)     ASVT
         L     R15,524(R15,R14)   ASCB
         L     R14,172(0,R15)      JOBNAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         L     R14,176(0,R15)      STC/TSU NAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         LA    R14,=CL8'*UNKNWN*'
         EJECT
CHKUCB2  LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLI   0(R6),X'FF'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLC   0(3,R6),13(R1)      UCB ADDR MATCH
         BNE   CHKUCB2             NO
         CLI   DSPSW,C'D'          DEVICE ONLY
         BE    CHKUCB4             YES
         CLC   10(8,R6),0(R14)     JOBNAME MATCH
         BNE   CHKUCB2             NO
         B     CHKUCB4
         SPACE 1
CHKUCB3  XC    18(4,R6),18(R6)
         MVC   0(3,R6),13(R1)      UNIT ADDR
         MVC   4(6,R6),28(R1)      VOLSER
         MVC   10(8,R6),0(R14)     JOBNAME
         SPACE 1
CHKUCB4  LH    R14,18(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,18(0,R6)
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         LH    R14,20(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,20(0,R6)
         B     CHKUCB1A
         SPACE 1
CHKUCB5  EQU    *
         L     R15,EXTRAREA
         USING  JOBTABS,R15
         LA    R6,UCBTABS
         DROP   R15
         SPACE 1
CHKUCB5A LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BNE   CHKUCB5A            NO
         MVI   0(R6),X'FF'         SET END OF TABLE
         SPACE 1
CHKUCB5B LM    R0,R15,SAVEREGS
         BR    R7
         EJECT
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 CLC   0(2,R9),=X'FFFF'    .END OF TABLE
         BE    UCBDMOUT            .YES, GO PROCESS
         SR    R1,R1
         ICM   R1,3,0(R9)          .LOAD UCB ADDR
         LTR   R1,R1               .ZERO ADDR
         BNZ   UCBDML#4            .NO, CONTINUE
         SPACE 1
UCBDML#3 LA    R9,2(0,R9)          .NEXT UCB LOOKUP TABLE ENTRY
         B     UCBDML#2
         SPACE 1
UCBDML#4 CLI   18(R1),X'10'        GRAPHICS
         BE    UCBDML#3            YES, NEXT UCB
         CLI   18(R1),X'40'        COMM
         BE    UCBDML#3            YES, NEXT UCB
         TM    6(R1),X'8A'         BUSY AND/OR CHANNEL PROGRAM ACTIVE
         BZ    UCBDML#3            NO, NEXT UCB
         BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#3            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         MVC   UCBDMCUR+2(2),0(R9) .SET NEXT LEAST HIGH UCB ADDR
         B     UCBDMOUT            .GO PROCESS
         EJECT
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         BR    R7
         EJECT
BUSYCHK  LA    R4,CHNTAB-4         CHANNEL TABLE ADDR
         LA    R3,15
         SR    R6,R6
         SPACE 1
BUSYCHK1 LA    R4,4(0,R4)          CHAN TABLE SLOT
         L     R15,0(0,R4)         CHAN BUSY
         LA    R6,1(0,R6)          CHAN NUMBER
         CLI   CHANNEL,X'00'       SINGLE CHANNEL REQUEST
         BE    *+12                NO
         CLM   R6,1,CHANNEL        CHANNEL MATCH
         BNE   BUSYCHK2
         SR    R14,R14
         CVD   R6,DOUBLE
         MVC   QDMSG(80),OVERLAY
         UNPK  CHAN(2),DOUBLE+6(2)
         OI    CHAN+1,X'F0'
         M     R14,=F'100'
         SR    R14,R14
         DR    R14,R5
         LR    R7,R15
         SRDL  R14,32
         LR    R1,R5
         SRL   R1,1
         DR    R14,R1
         AR    R15,R7
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         BAL   R9,DISPLAY
         SPACE 1
BUSYCHK2 BCT   R3,BUSYCHK1
         B     UCBBUSY
         SPACE 3
PCTMVE   MVC   PCTGRAPH(0),PCTLINE
         EJECT
UCBBUSY  CLI   DSPSW,C' '          DEVICE DISPLAY
         BE    RETURN              NO
         L     R15,EXTRAREA
         USING  JOBTABS,R15
         LA    R6,UCBTABS
         DROP   R15
         MVC   CURRUNIT(3),=X'FFFFFF'
         XC    CURRCNT(4),CURRCNT
         SPACE 1
UCBBUSY1 LA    R6,22(0,R6)
         MVC   QDMSG(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY1            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY3            YES
         CLC   CURRUNIT(2),0(R6)   CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         SR    R14,R14
         IC    R14,CURRUNIT+2
         SR    R15,R15
         IC    R15,2(0,R6)
         SLL   R14,28
         SRL   R14,28
         SLL   R15,28
         SRL   R15,28
         TM    CURRUNIT+2,X'F0'    NUMERIC
         BO    *+8                 NO
         LA    R14,9(0,R14)
         TM    2(R6),X'F0'         NUMERIC
         BO    *+8                 NO
         LA    R15,9(0,R15)
         CR    R14,R15             CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         LH    R1,CURRCNT
         AH    R1,18(0,R6)
         STH   R1,CURRCNT
         LH    R1,CURRCNT+2
         AH    R1,20(0,R6)
         STH   R1,CURRCNT+2
         B     UCBBUSY1
         SPACE 1
UCBBUSY2 MVC   CURRUNIT(3),0(R6)
         MVC   CURRVOL(6),4(R6)
         MVC   CURRCNT(4),18(R6)
         B     UCBBUSY1
         SPACE 1
UCBBUSY3 CLC   CURRUNIT(3),=X'FFFFFF'   END OF LIST
         BE    RETURN
         MVC   DEVSTRT(3),CURRUNIT UNIT ADDR
         MVI   DEVSTRT+3,C' '
         MVC   DEVSTRT+4(6),CURRVOL VOLSER
         SR    R14,R14
         LH    R15,CURRCNT         UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,CURRCNT+2       UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LR    R15,R1
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         BAL   R9,DISPLAY
         L     R15,EXTRAREA
         USING  JOBTABS,R15
         LA    R6,UCBTABS
         DROP   R15
         SPACE 1
UCBBUSY4 LA    R6,22(0,R6)
         MVC   QDMSG(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY4            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY             YES
         CLC   CURRUNIT(3),0(R6)   CURRENT UNIT CHECK
         BNE   UCBBUSY4            NO MATCH
         CLI   DSPSW,C'J'          JOB DISPLAY
         BNE   UCBBUSY5            NO
         MVC   DEVSTRT+3(8),10(R6)   JOBNAME
         MVC   DEVSTRT(3),=C'-- '
         MVC   DEVSTRT+11(4),=CL4' '
         SR    R14,R14
         LH    R15,18(0,R6)        UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,20(0,R6)        UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         BAL   R9,DISPLAY
         MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY4
         SPACE 1
UCBBUSY5 MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY
         EJECT
MSGRTN   EQU   *
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   EQU   *
EXIT     EQU   *
         L     R0,SIZEUCB          LOAD GETMAIN SIZE AND SUBPOOL
         L     R1,EXTRAREA         LOAD GETMAIN AREA ADDR
         FREEMAIN R,LV=(0),A=(1)
         MODESET KEY=NZERO,MODE=PROB
         SETAUTH OFF
         QSTOP
         EJECT
         LTORG
         DS    0D
INTERVL  DC    CL8'00000020'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
SIZEUCB  DC    X'00',AL3(JOBTABE-JOBTABS)
         SPACE 3
OVERLAY  DC    CL80'CHANNEL XX BUSY     NNN%'
DEVOVLY  DC    CL80'UUU VVVVVV BUSY NNN/NNN%'
         SPACE 3
PCTLINE  DC    CL51'0====1====2====3====4====5====6====7====8====9===='
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
EXTRAREA DS    F
XTIME    DS    2F
DSPSW    DS    C
CHANNEL  DS    C
CHANTEST DS    C
CURRUNIT DS    CL3
CURRVOL  DS    CL6
         DS    0F
CURRCNT  DS    F
TEMPLINE DS    CL84
         SPACE 3
         DS    0F
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 5
DEVSTRT  EQU   QDMSG,8
CHAN     EQU   QDMSG+8,2
BUSY     EQU   QDMSG+15,8
PCTGRAPH EQU   QDMSG+25,51
         SPACE 3
         DS    0F
CHNTAB   DS    16F
         SPACE 3
WORKEND  DS    0F
JOBTABS  DSECT
         DS    0F
UCBTABS  DS    CL22
UCBTAB   DS    500CL22
JOBTABE  DS    0F
         EJECT
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
         END
./       ADD   NAME=CHCT
CHCT     TITLE 'QUEUE COMMAND - DUMP A HCT IN HEX'                ONL01
CHCT     QSTART HASPEQU=YES,       START CHCT CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE COMMAND - DUMP A HCT IN HEX'
         GBLB   &QSP136            SP 1.3.6 OPTION  DOR
***********************************************************************
* HCT                                                                 *
***********************************************************************
*                                                                     *
*   CALL - READ JES2 CHECKPOINT ROUTINE                               *
*                                                                     *
***********************************************************************
         L     R15,=V(CKPT)        ADDR OF CKPT ROUTINE
         BALR  R14,R15             GO TO IT
***********************************************************************
*                                                                     *
*   CALL HEXDUMP TO DUMP THE HCT CHECKPOINT AREA                      *
*                                                                     *
***********************************************************************
         L     R10,QVCKPT     BASE FOR CKPT WORK AREA
         USING QCKPT,R10      ADDRESSING FOR IT
         L     R1,QCJQTL      ADDRESS OF HCT SAVEAREA
         AIF   (NOT &QSP136).NO1361
         LA    R0,$SAVEBEG-HCT       OFFSET TO START OF AREA DOR
         AGO   .X1361
.NO1361  ANOP
         LA    R0,$SAVEBEG-HCTDSECT  OFFSET TO START OF AREA
.X1361   ANOP
         LA    R15,$SAVELEN   LENGTH OF $SAVEAREA
         SLL   R0,16          MOVE OFFSET TO PROPER POSITION
         OR    R0,R15         INSERT INTO LENGTH REG
         L     R15,=V(HEXDUMP) ADDRESS OF DUMP ROUTINE
         BALR  R14,R15        LINK TO IT
STOP     QSTOP
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QCOMMON
CHCT     CSECT
         DROP
BASE1    EQU   11
SAVE     EQU   13
          GBLC  &VERSION
          GBLC  &MACSPLV
&VERSION SETC  '0'
&MACSPLV SETC  '0'
$RPS     EQU   0
$MSGID   EQU   0
$DUPVOLT EQU   0
         AIF   (&QSP136).X136A                                 DOR
$PRIOOPT EQU   0
JCT      EQU   10
$PRTBOPT EQU   0
$PRTRANS EQU   0
$QSONDA  EQU   0
$DRAINED EQU   0                                               UF048
$CMBDEF  EQU   0
$JQEDEF  EQU   0
$MAXDA   EQU   32
$MAXJBNO EQU   0
$SMFDEF  EQU   0
$TGDEF   EQU   0
FF       EQU   255
$MAXNODE EQU   1000                                            UF046
$MAXPRDV EQU   4                                               UF046
$OPTSTD  EQU   0                                               UF046
$USERSET EQU   X'02'                                           ONL11
.X136A   ANOP                                                       DOR
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
        AIF   (NOT &QSP136).NO136A
        IFGRPL  DSECT=YES,AM=VTAM
.NO136A ANOP
        $BUFFER
        $JCT
        $CAT
        $JQE
        $PCE
        $MIT   ,                                                  ONL11
        $HCT
        AIF   (NOT &QSP136).NO136B
        $TQE   DOR
.NO136B ANOP
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CIOT
CIOT     TITLE 'QUEUE COMMAND - DUMP AN IOT IN HEX'                  CL
CIOT     QSTART HASPEQU=YES,       START CIOT CSECT ASSEMBLY        DORX
               XTITLE='QUEUE COMMAND - DUMP AN IOT IN HEX'
         GBLB   &QSP136            SP 1.3.6  OPTION  DOR
***********************************************************************
* IOT JOBNAME                                                         *
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JCT                                    *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CALL HEXDUMP TO DUMP THE IOT                                      *
*                                                                     *
***********************************************************************
         L     R10,QVCKPT     BASE FOR CKPT WORK AREA
         SPACE 1                                                     CL
         USING QCKPT,R10      ADDRESSING FOR IT
         AIF   (NOT &QSP136).NO1361
         USING JCT,R6             JCT ADDRESSABILITY             DOR
         AGO   .X1361
.NO1361  ANOP
         USING JCTDSECT,R6         JCT ADDRESSABILITY             ONL16
.X1361   ANOP
         USING WORK,R13            WORK AREA ADDRESSABILITY          CL
         AIF   (NOT &QSP136).NO136A
         USING IOT,R3         JQE ADDRESSABILITY                DOR
         AGO   .X136A
.NO136A  ANOP
         USING IOTDSECT,R3         IOT ADDRESSABILITY                CL
.X136A   ANOP
         USING QDISPLAY,R9         DISPLAY WORK ADDRESABILITY        CL
         L     R9,QVDSPL           ADDR OF DISPLAY WORK AREA         CL
         SPACE 1                                                     CL
         MVI   SWITCH,0            CLEAR FLAG BYTE                   CL
         L     R6,QCJCTA      ADDRESS OF JCT
         LH    R5,HASPACE+62 MAX LEN INCLUDING NETWORK HEADERS
         AIF   (NOT &QSP136).NO136B
         LA    R5,IOTSTART-IOT(R5)    + LEN OF PREFIX DOR
         LA    R4,IOTSTART-IOT OFFSET TO START OF IOT         DOR
         AGO   .X136B
.NO136B  ANOP
         LA    R5,IOTSTART-IOTDSECT(R5)    + LEN OF PREFIX
         LA    R4,IOTSTART-IOTDSECT OFFSET TO START OF IOT           CL
.X136B   ANOP
         SR    R5,R4          TOTAL LENGTH - OFFSET = LENGTH TO DUMP
         SLL   R4,16          MOVE OFFSET TO PROPER POSITION
         OR    R4,R5          INSERT INTO LENGTH REG
         L     R1,QCJQEA           ADDR OF JQE                       CL
         AIF   (NOT &QSP136).NO136C
         USING JQE,R1         JQE ADDRESSABILITY                DOR
         TM    JQEFLAG3,JQE3SYSD   SKIP IF THIS IS NOT               CL
         AGO   .X136C
.NO136C  ANOP
         USING JQEDSECT,R1         JQE ADDRESSABILITY                CL
         TM    JQEFLAG3,QUESYSDS   SKIP IF THIS IS NOT               CL
.X136C   ANOP
         BNO   *+8                  SYSTEM JQE                       CL
         OI    SWITCH,NOSPIN       DO NOT READ SPIN IOTS             CL
         L     R3,QCIOTA           IOT BASE                          CL
         LR    R7,R3               IOAREA FOR READING IOTS           CL
         AIF   (NOT &QSP136).NO136D
         SH    R3,=Y(IOTSTART-IOT) ADJUST FOR HEADER            DOR
         AGO   .X136D
.NO136D  ANOP
         SH    R3,=Y(IOTSTART-IOTDSECT) ADJUST FOR HEADER            CL
.X136D   ANOP
         B     IOTREAD             FIRST IOT HAS BEEN READ           CL
         SPACE 1                                                     CL
READIOT  ICM   R14,15,IOTIOTTR     MTTR OF NEXT IOT                  CL
         BNZ   READISK             GO READ IT IF AVAILABLE           CL
         TM    SWITCH,NOSPIN       ALL THRU IF SPIN IOTS             CL
         BO    STOP                 HAVE BEEN READ                   CL
         OI    SWITCH,NOSPIN       REMEMBER SPIN IOT READ            CL
         ICM   R14,15,JCTSPIOT     MTTR OF FIRST SPIN IOT            CL
         BZ    STOP                EXIT IF NONE                      CL
         SPACE 1                                                     CL
READISK  ST    R14,QCTRAK          SET MTTR                          CL
         MVC   QDMSG,QBLANK        BLANK LINE                        CL
         MVC   QDMLNG,=H'80'       LENGTH OF LINE                    CL
         LA    R0,QDMSG            SET ADDRESS                       CL
         ST    R0,QDMSGA            OF MESSAGE LINE                  CL
         L     R15,=V(DISPLAY)     ADDR OF SCREEN DISPLAY RTN        CL
         BALR  R14,R15             GO OUTPUT ONE BLANK LINE          CL
         BALR  R14,R15             OUTPUT SECOND BLANK LINE          CL
         LR    R1,R7               ADDR OF IO AREA                   CL
         L     R15,=V(READSPC)     ADDR OF RTN TO READ HASPACE       CL
         BALR  R14,R15             GO TO IT                          CL
         SPACE 1                                                     CL
IOTREAD  CLC   IOTID,=CL4'IOT'     BR IF NOT                         CL
         BNE   BADIOT               GOOD IOT                         CL
         CLC   QPJOBID,IOTJBKEY    BR IF JOB                         CL
         BNE   BADIOT               KEYS DO NOT MATCH                CL
         LR    R1,R7               ADDR OF IO AREA                   CL
         LR    R0,R4               OFFSET AND LENGTH OF DATA         CL
         L     R15,=V(HEXDUMP) ADDRESS OF DUMP ROUTINE
         BALR  R14,R15        LINK TO IT
         B     READIOT             GO READ NEXT IOT                  CL
STOP     QSTOP
***********************************************************************
*                                                                     *
*   EXCEPTIONS AND RETURN                                             *
*                                                                     *
***********************************************************************
BADIOT   QTILT '*** INVALID IOT READ ***'
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CIOT     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN      CL
         AIF  (NOT &QSP136).NO136E
         IFGRPL  DSECT=YES,AM=VTAM
.NO136E  ANOP
        $BUFFER
        $JQE
JCTX     EQU   0
        $TAB                                                         CL
        $JCT
        $IOT
        AIF  (NOT &QSP136).NO136F
        $TQE
.NO136F  ANOP
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS       CL
WORK     DSECT                                                       CL
         DS    18A                 REG SAVE AREA                     CL
SWITCH   DS    X                   SWITCHES HERE                     CL
NOSPIN   EQU   X'80'               READ NO SPIN IOTS                 CL
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CJCT
CJCT     TITLE 'QUEUE COMMAND - DUMP A JCT IN HEX'                ONL01
CJCT     QSTART HASPEQU=YES,       START CJCT CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE COMMAND - DUMP A JCT IN HEX'
         GBLB   &QSP136           SP 1.3.6   OPTION       DOR
***********************************************************************
* JCT JOBNAME <OFFSET>                                                *
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JCT                                    *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CALL HEXDUMP TO DUMP THE JCT                                      *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL14
         L     R10,QVCKPT          ADDR OF CKPT WORK AREA         ONL14
         USING QCKPT,R10           NOTE CKPT WORK ADDRESSABILITY  ONL14
         SPACE 1                                                  ONL14
         TM    QFLAG1,QFLG1SDS     IS THIS A SYSTEM DATA SET JOB? ONL14
         BO    TILTSYSD            TILT IF YES                    ONL14
         SPACE 1                                                  ONL14
         L     R1,QCJCTA      ADDRESS OF JCT
         AIF   (NOT &QSP136).NO136A
         LA    R0,JCTSTART-JCT       OFFSET TO START OF JCT DOR
         AGO   .X136A
.NO136A  ANOP
         LA    R0,JCTSTART-JCTDSECT  OFFSET TO START OF JCT
.X136A   ANOP
         LH    R15,QLNG2      LENGTH OF USER OFFSET INTO JCT
         LTR   R15,R15        IS THE LENGTH ZERO?
         BNP   DUMP0          YES. NONE SPECIFIED
         CH    R15,=H'8'      IS THE LENGTH TOO BIG?
         BH    TILTO          YES, GIVE UP
         EX    R15,OFFTR      CONVERT TO HEX
         EX    R15,OFFPACK    PACK INTO QDWORD
         LH    R15,QDWORD     PICK UP OFFSET
         CR    R0,R15         COMPARE TO BASE OFFSET
         BNL   DUMP0          USE R0 FOR OFFSET
         LR    R0,R15         GET OTHER OFFSET
DUMP0    AR    R1,R0          ADD TO BASE ADDRESS
         LH    R15,HASPACE+62 MAX LEN INCLUDING NETWORK HEADERS
         AIF   (NOT &QSP136).NO136B
         LA    R15,JCTSTART-JCT(R15)  + LEN OF PREFIX   DOR
         AGO   .X136B
.NO136B  ANOP
         LA    R15,JCTSTART-JCTDSECT(R15)  + LEN OF PREFIX
.X136B   ANOP
         SR    R15,R0         TOTAL LENGTH - OFFSET = LENGTH TO DUMP
         SLL   R0,16          MOVE OFFSET TO PROPER POSITION
         OR    R0,R15         INSERT INTO LENGTH REG
         L     R15,=V(HEXDUMP) ADDRESS OF DUMP ROUTINE
         BALR  R14,R15        LINK TO IT
STOP     QSTOP
***********************************************************************
*                                                                     *
*   EXCEPTIONS AND RETURN                                             *
*                                                                     *
***********************************************************************
TILTO    QTILT '*** INVALID OFFSET SPECIFIED ***'
TILTSYSD QTILT '*** COMMAND INVALID FOR SYSDS TYPE JOBS ***'      ONL14
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
OFFTR    TR    QPARM2,TABLEH       CONVERT TO HEX
OFFPACK  PACK  QDWORD(3),QPARM2(1) PACK TO WORK AREA
         LTORG
* TABLE FOR HEX CONVERT
TABLEH   DC    CL193' '
         DC    X'0A0B0C0D0E0F',CL41' ',C'01234567890',CL6' '
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CJCT     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136C
         IFGRPL  DSECT=YES,AM=VTAM
.NO136C  ANOP
        $BUFFER
        $JQE
JCTX     EQU   0
        $JCT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CJHIST
CJHIST   TITLE 'QUEUE COMMAND - PRINT JOB HISTORY/SOURCE'         ONL01
CJHIST   QSTART HASPEQU=YES,       START CJHIST CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - PRINT JOB HISTORY/SOURCE'
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QSP136        SP1.3.6 FLAG                        DOR
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         AIF   (NOT &QACF2).$SKP1                                 ONL15
         AIF   (NOT &QSP133).$SKP1                                ONL15
         #ACFJES2 ,                SET ACF2 OPTIONS FOR JES2      ONL15
.$SKP1   ANOP  ,                                                  ONL15
         SPACE 2                                                  ONL15
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
***********************************************************************
*                                                                   NTL
*   PROCESS THE HISTORY COMMAND                                     NTL
*                                                                   NTL
***********************************************************************
         SPACE 1                                                  ONL14
         L     R15,=V(FINDJOB) GO FIND JOB/JCT/JQE
         BALR  R14,R15                                              NTL
         L     R9,QCJCTA      GET ADDRESS OF JCT                    NTL
         AIF   (NOT &QSP136).NO136A
         USING JCT,R9         ADDRESSABILITY                        DOR
         AGO   .X136A
.NO136A  ANOP
         USING JCTDSECT,R9    ADDRESSABILITY                        NTL
.X136A   ANOP
         SPACE 1                                                  ONL14
         TM    QFLAG1,QFLG1SDS     IS THIS A SYSTEM DATA SET JOB? ONL14
         BO    TILTSYSD            TILT IF YES                    ONL14
         SPACE 2                                                    NTL
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAJHIST           PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
FORMATIT MVC   QDHLINE,HEADER                                       NTL
         MVC   QDMSG,QBLANK   BLANK OUT LINE                        NTL
         BAL   R7,DISPLAY     GO DO THE DISPLAY                     NTL
*                                                                   NTL
LINE3    MVC   QDMSG,HEAD3    MOVE IN LINE MASK                     NTL
         MVC   JOBNUMB,JCTJOBID     JOB ID                          NTL
         MVC   JOBNAME,JCTJNAME     JOBNAME                         NTL
         MVC   JOBSCE,JCTINDEV      INPUT DEVICE                    NTL
         MVC   BIN#,JCTROOMN        BIN NUMBER                      NTL
         MVC   JOBCLASS,JCTJCLAS    JOB CLASS FROM JOBCARD          NTL
         MVC   MSGCLASS,JCTMCLAS    MESSAGE CLASS                   NTL
         MVC   NOTIFY,JCTTSUID      WHO TO CONTACT                  NTL
         BAL   R7,DISPLAY           PUT OUT LINE3                   NTL
*                                                                   NTL
LINE4    BAL   R7,DISPBLNK       GO PUT OUT A BLANK LINE            NTL
*                                                                   NTL
LINE5    MVC   QDMSG,HEAD5        MOVE IN HEADING                   NTL
         MVC   PROCDDN,JCTPROCN   PROCLIB DDNAME                    NTL
         LA    R15,PRTDEST                                          NTL
         LA    R1,JCTPROUT                                          NTL
         BAL   R7,RMTORLCL       CONVERT PRT= FIELD                 NTL
         LA    R15,PUNDEST                                          NTL
         LA    R1,JCTPUOUT                                          NTL
         BAL   R7,RMTORLCL       CONVERT PUN= FIELD                 NTL
         LM    R0,R1,JCTRDRON    GET READER TIME/DATE               NTL
         LTR   R1,R1             ANYBODY (DATE) HOME                NTL
         BZ    NODATE5                                              NTL
         BAL   R7,TIMECONV       FORMAT IT PRETTY                   NTL
         MVC   TIMESTMP,CDAYN    MOVE IN TO RECORD                  NTL
NODATE5  BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
*                                                                   NTL
LINE6    MVC   QDMSG,HEAD6        MOVE IN HEADING                   NTL
         MVC   PROGAMER,JCTPNAME  PROGRAMMER NAME                   NTL
         LM    R0,R1,JCTXEQON    GET XEQ START TIME/DATE            NTL
         LTR   R1,R1             ANYBODY (DATE) HOME                NTL
         BZ    NODATE6                                              NTL
         BAL   R7,TIMECONV       FORMAT IT PRETTY                   NTL
         MVC   TIMESTMP,CDAYN    MOVE IN TO RECORD                  NTL
NODATE6  BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
*                                                                   NTL
LINE7    MVC   QDMSG,HEAD7        MOVE IN HEADING                   NTL
         LA    R15,CARDSIN       POINT TO POSITION                  NTL
         L     R1,JCTCARDS       GET VALUE                          NTL
         BAL   R7,FITINUM        AND PUT IT AWAY                    NTL
         LM    R0,R1,JCTXEQOF    GET XEQ STOP TIME/DATE             NTL
         LTR   R1,R1             ANYBODY (DATE) HOME                NTL
         BZ    NODATE7                                              NTL
         BAL   R7,TIMECONV       FORMAT IT PRETTY                   NTL
         MVC   TIMESTMP,CDAYN    MOVE IN TO RECORD                  NTL
NODATE7  BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
*                                                                   NTL
LINE8    MVC   QDMSG,HEAD8        MOVE IN HEADING                   NTL
         LA    R15,LINESOUT      POINT TO POSITION                  NTL
         L     R1,JCTLINES       GET VALUE                          NTL
         BAL   R7,FITINUM        AND PUT IT AWAY                    NTL
         LA    R15,CARDSOUT      POINT TO POSITION                  NTL
         L     R1,JCTPUNCH       GET VALUE                          NTL
         BAL   R7,FITINUM        AND PUT IT AWAY                    NTL
         LM    R0,R1,JCTOUTON    GET PRT/PUN START TIME/DATE        NTL
         LTR   R1,R1             ANYBODY (DATE) HOME                NTL
         BZ    NODATE8                                              NTL
         BAL   R7,TIMECONV       FORMAT IT PRETTY                   NTL
         MVC   TIMESTMP,CDAYN    MOVE IN TO RECORD                  NTL
NODATE8  BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
         SPACE 1                                                  ONL15
         AIF   (NOT &QACF2).$SKP2                                 ONL15
         AIF   (NOT &QSP133).$SKP3                                ONL15
         SPACE 1                                                  ONL15
         ICM   R6,B'1111',&ACF2JCT ACF2 AREA OFFSET IN JCT        ONL15
         BZ    SKIPACF2            FORGET IT IF NO ACF2 AREA      ONL15
         SPACE 1                                                  ONL15
         AIF   (NOT &QSP136).NO136B
         LA    R6,JCT(R6)         ADDR OF ACF2 AREA              DOR
         AGO   .X136B
.NO136B  ANOP
         LA    R6,JCTDSECT(R6)     ADDR OF ACF2 AREA              ONL15
.X136B   ANOP
         USING #ACFJCTX,R6         NOTE #ACFJCTX ADDRESSABILITY   ONL15
         SPACE 1                                                  ONL15
         CLC   JCTACFJ,=C'ACFJ'    IS IT THE ACF2 AREA ?          ONL15
         BNE   SKIPACF2            IF NO, FORGET IT               ONL15
.$SKP3   ANOP  ,                                                  ONL15
         SPACE 1                                                  ONL15
LINE911  MVC   QDMSG,QBLANK     BLANK IT OUT                        NTL
         LA    R2,4             SAY DO IT 4 TIMES                   NTL
BLNKS    BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
         BCT   R2,BLNKS                                             NTL
*                                                                   NTL
LINE12   MVC   QDMSG,HEAD12       MOVE IN HEADING                   NTL
         BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
*                                                                   NTL
LINE13   BAL   R7,DISPBLNK       GO PUT OUT A BLANK LINE            NTL
*                                                                   NTL
*        AIF   (&QONL).ONL17A                                     ONL17
         AIF   (&QTSS).ONL17A
LINE14   MVC   QDMSG,HEAD14       MOVE IN HEADING                   NTL
         MVC   LOGONID,LIDLID    ACF2 LOGON ID                      NTL
         MVC   GROUP,LIDOPER     ACF2 GROUP (NTL FIELD)            NTL1
         MVC   NAME,LIDNAME      ACF2 USER NAME/DESCRIPT            NTL
         MVC   PHONE,LIDPHONE    ACF2 PHONE NUMBER FOR USER         NTL
         BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
*                                                                   NTL
LINE15   BAL   R7,DISPBLNK       GO PUT OUT A BLANK LINE            NTL
*                                                                   NTL
LINE16   MVC   QDMSG,HEAD16       MOVE IN HEADING                   NTL
         MVC   SOURCE,ACVSRCE    ACF2 LOGICAL SOURCE                NTL
         MVC   SUBLID,ACVSLID    ACF2 SUBMITTING LID                NTL
         MVC   SUBPROG,ACVAPROG  ACF2 SUBMITTING PROGRAM            NTL
         MVC   SUBPATH,ACVPATH   ACF2 SUBMITTING PATH               NTL
         BAL   R7,DISPLAY        GO SHOW IT OFF                     NTL
         AGO   .ONL17B                                            ONL17
.ONL17A  ANOP  ,                                                  ONL17
         SPACE 1                                                  ONL17
LINE14   MVC   QDMSG,HEAD14        MOVE IN HEADING                ONL17
         MVC   LOGONID,LIDLID      ACF2 LOGON ID                  ONL17
         MVC   NAME,LIDNAME        ACF2 USER NAME/DESCRIPT        ONL17
         MVC   PHONE,LIDPHONE      ACF2 PHONE NUMBER FOR USER     ONL17
         BAL   R7,DISPLAY          GO SHOW IT OFF                 ONL17
         SPACE  1                                                 ONL17
LINE15   MVC   QDMSG,HEAD15        MOVE IN HEADING                ONL17
         MVC   UIDSTR,JCTAUIDB     ACF2 UID STRING                ONL17
         MVC   MAILADDR,LIDADDR    ACF2 LOCAL PLANT MAIL ADDR     ONL17
         BAL   R7,DISPLAY          GO SHOW IT OFF                 ONL17
         SPACE  1                                                 ONL17
LINE16   MVC   QDMSG,HEAD16        MOVE IN HEADING                ONL17
         MVC   SOURCE,ACVSRCE      ACF2 LOGICAL SOURCE            ONL17
         MVC   SUBLID,ACVSLID      ACF2 SUBMITTING LID            ONL17
         MVC   SUBPROG,ACVAPROG    ACF2 SUBMITTING PROGRAM        ONL17
         MVC   SUBPATH,ACVPATH     ACF2 SUBMITTING PATH           ONL17
         BAL   R7,DISPLAY          GO SHOW IT OFF                 ONL17
         SPACE 1                                                  ONL17
.ONL17B  ANOP  ,                                                  ONL17
         SPACE 1                                                  ONL15
SKIPACF2 DS    0H                  CONTINUE HERE IF NO ACF2 INFO  ONL15
         SPACE 1                                                  ONL15
         AIF   (NOT &QSP133).$SKP2                                ONL15
         SPACE 1                                                  ONL15
         DROP  R6                  KILL #ACFJCTX ADDRESSABILITY   ONL15
         SPACE 1                                                  ONL15
.$SKP2   ANOP  ,                                                  ONL15
         AIF   (NOT &QNERDC).QNONER                               UF030
         AIF   (&QSP133).QNER133                                  UF046
         SPACE 1
         MVC   QDMSG,QBLANK     BLANK IT OUT                      UF030
         LA    R2,4             SAY DO IT 4 TIMES                 UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
         BCT   R2,*-4                                             UF030
*                                                                 UF030
         MVC   QDMSG,HEAD21       MOVE IN HEADING                 UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
*                                                                 UF030
         BAL   R7,DISPBLNK       GO PUT OUT A BLANK LINE          UF030
*                                                                 UF030
         MVC   QDMSG,HEAD22       MOVE IN HEADING                 UF030
         MVC   HNERLID,JCTNELID  ACF2 LOGON ID                    UF030
         L     R1,JCTNEACC       GET ACCESS NUMBER                UF030
         LA    R15,HNERACC#      POINT TO TARGET AREA             UF030
         BAL   R7,FITINUM        CONVERT INTO AREA                UF030
         LH    R1,JCTNESEQ       GET SEQUENCE NUMBER              UF030
         LA    R15,HNERSEQ#      POINT TO TARGET AREA             UF030
         BAL   R7,FITINUM        CONVERT INTO AREA                UF030
         MVC   HNERHEAD,JCTOUTHD OUTPUT HEADER                    UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
*                                                                 UF030
         MVC   QDMSG,HEAD23       MOVE IN HEADING                 UF030
         MVC   HNERPROC,JCTPROC   MOVE PROCLIB DSN                UF030
         MVC   HNERPROV,JCTPROCV  MOVE PROCLIB VOLUME             UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
         AGO   .QNONER                                            UF046
.QNER133 ANOP                                                     UF046
         LA    R8,JCTNJHDR         POINT TO START OF HEADER       UF046
         USING NJHDSECT,R8         TEMP ADDRESSING                UF046
         LH    R1,NJHLEN           POINT R1 PAST END OF           UF046
         ALR   R1,R8                 JOB HEADER RECORD            UF046
         LA    R8,NJHG             POINT BASE REG TO GENERAL SECT UF046
         USING NJHU,R8             SECTION ADDRESSING             UF046
NHBFUSR  LH    R0,NJHULEN          SECTION LENGTH                 UF046
         LTR   R0,R0               TEST VALIDITY                  UF046
         BNP   RETURN              NONE, NO LOCAL SECTIONS        UF046
         ALR   R8,R0               POINT TO NEXT SECTION          UF046
         CR    R8,R1               SEE IF PAST END OF RECORD      UF046
         BH    RETURN              PAST END, ERROR                UF046
         CLI   NJHUTYPE,NTYPUSER   CHECK FOR USER SECTION         UF046
         BNE   NHBFUSR             TRY NEXT SECTION IF NOT        UF046
         CLI   NJHUMOD,C'E'        NERDC USER SECTION?            UF046
         BNE   NHBFUSR             TRY NEXT SECTION IF NOT        UF046
         CLC   NJHUCODE,=CL4'UF'   NERDC USER SECTION?            UF046
         BNE   NHBFUSR             TRY NEXT SECTION IF NOT
         SPACE 1
         MVC   QDMSG,QBLANK     BLANK IT OUT                      UF030
         LA    R2,4             SAY DO IT 4 TIMES                 UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
         BCT   R2,*-4                                             UF030
*                                                                 UF030
         MVC   QDMSG,HEAD21       MOVE IN HEADING                 UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
*                                                                 UF030
         BAL   R7,DISPBLNK       GO PUT OUT A BLANK LINE          UF030
*                                                                 UF030
         MVC   QDMSG,HEAD22       MOVE IN HEADING                 UF030
         MVC   HNERLID,NJHULID   ACF2 LOGON ID                    UF030
         L     R1,NJHUACC#       GET ACCESS NUMBER                UF030
         LA    R15,HNERACC#      POINT TO TARGET AREA             UF030
         BAL   R7,FITINUM        CONVERT INTO AREA                UF030
         LH    R1,NJHUSEQ#       GET SEQUENCE NUMBER              UF030
         LA    R15,HNERSEQ#      POINT TO TARGET AREA             UF030
         BAL   R7,FITINUM        CONVERT INTO AREA                UF030
         MVC   HNERHEAD,NJHUOUTH OUTPUT HEADER                    UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
*                                                                 UF030
         MVC   QDMSG,HEAD23       MOVE IN HEADING                 UF030
         MVC   HNERPROC,JCTPROC   MOVE PROCLIB DSN                UF030
         MVC   HNERPROV,JCTPROCV  MOVE PROCLIB VOLUME             UF030
         BAL   R7,DISPLAY        GO SHOW IT OFF                   UF030
.QNONER  ANOP                                                     UF030
         SPACE 2                                                    NTL
RETURN   QSTOP                                                      NTL
         SPACE 2                                                    NTL
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     NTL
*                                                                   NTL
DISPLAY  MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         BR    R7             RETURN TO MAINLINE...                 NTL
         EJECT ,                                                    NTL
***********************************************************************
*                                                                   NTL
* FORMAT DATE TIME  HEADING   ENTER WITH BAL R7,TIMECONV            NTL
*   R0=TIME IN 100THS OF SECOND SINCE MIDNIGHT                      NTL
*   R1=DATE IN 00YYDDDS FORMAT                                      NTL
*                                                                   NTL
* RETURNS WITH CDAYN(LEN) = DDMONYY (DDD) DAY HH:MM:SS.TH           NTL
*                E.G.       07JUL80 (189) MON 13:45:24.56           NTL
*                           123456789.123456789.123456789           NTL
*                                                                   NTL
***********************************************************************
TIMECONV MVC   MONMSK(MVCLEN),XMONMSK  INIT DATE/TIME WORK AREA     NTL
         ST    R1,DATE                 SAVE DATE FOR LATER          NTL
         CVD   R0,DOUBLEWD            GET TIME IN DEC 100TH/SEC     NTL
         DP    DOUBLEWD(8),DEC6000(3) /6000 : REM IS SS.TH          NTL
         DP    DOUBLEWD(5),DEC60(2)   /60   : REM IS MM             NTL
         MVC   EDITWORK(L'HHMASK),HHMASK   SETUP MULT EDIT MASK     NTL
         ED    EDITWORK(L'HHMASK),DOUBLEWD EDIT HH,MM,SS            NTL
FINTIME  MVC   CHH(2),EDITWORK+4      MOVE IN HOURS                 NTL
         MVC   CMM(2),EDITWORK+8      MOVE IN MM                    NTL
         MVC   CSS(5),EDITWORK+12     MOVE IN SS.TH                 NTL
*                                                                   NTL
***FORMAT THE DATE INTO THE OUTPUT MSG                              NTL
*                                                                   NTL
         MVC   WORKWORD(4),DATE        MOVE DATE TO WORK AREA.      NTL
         MVO   WORKWORD+1(3),WORKWORD(2)   MAKE 00YYDDDS INTO 00000YYS.
         UNPK  CYR(2),WORKWORD+2(2)    FORMAT YEAR.                 NTL
         XC    DOUBLEWD,DOUBLEWD                                    NTL
         MVC   DOUBLEWD+4(4),WORKWORD  CNVT YEAR TO BIN             NTL
         CVB   R0,DOUBLEWD                                          NTL
         ST    R0,BINYEAR              AND SAVE                     NTL
         TM    BINYEAR+3,X'03'         LEAP YEAR?                   NTL
         BNZ   MON1                    NO.                          NTL
         MVI   MONMSK+10,29            YES, CORRECT                 NTL
MON1     XC    DOUBLEWD,DOUBLEWD       CNVT DAYS TO BIN             NTL
         MVC   DOUBLEWD+6(2),DATE+2                                 NTL
         CVB   R2,DOUBLEWD                                          NTL
         ST    R2,BINDAYS              SAVE FOR LATER               NTL
         XR    R1,R1                                                NTL
         LA    R15,11                                               NTL
MON2     IC    R1,MONMSK(R15)          COMPUTE MON & DAY            NTL
         SR    R2,R1                                                NTL
         BNP   MONOVR                                               NTL
         BCT   R15,MON2                                             NTL
         B     *+6                                                  NTL
MONOVR   AR    R2,R1                   CORRECT OVERDRAW             NTL
         CVD   R2,DOUBLEWD             FORMAT DAY                   NTL
         UNPK  CDAYN(2),DOUBLEWD+6(2)                               NTL
         OI    CDAYN+1,X'F0'           FIX UP SIGN                  NTL
         MH    R15,=H'3'               GET TABLE OFFSET             NTL
         LA    R15,MONTAB(R15)         AND POINT AT MONTH           NTL
         MVC   CMON(3),0(R15)          MOVE IT TO THE MSG           NTL
         EJECT ,                                                    NTL
***DAY OF WEEK                                                      NTL
         L     R15,BINYEAR                                          NTL
         SH    R15,=H'69'                                           NTL
         BNP   OUTT                    MUST BE GREATER OR BAD       NTL
         XR    R14,R14                 CLEAR DAY REG                NTL
         D     R14,=F'4'                                            NTL
         MH    R15,=H'5'                                            NTL
         AR    R14,R15                                              NTL
         A     R14,BINDAYS                                          NTL
         SRDA  R14,32                                               NTL
         D     R14,=F'7'               MODULO 7 FOR WEEK            NTL
         MH    R14,=H'3'                                            NTL
         LA    R14,DAYTAB(R14)         POINT AT TODAY               NTL
         MVC   CDAY(3),0(R14)          INSERT IN MSG                NTL
***                                                                 NTL
MOVEJD   MVC   JDATE-1(7),=X'4020204B202020'                        NTL
         ED    JDATE-1(7),DATE+1                                    NTL
         MVC   CJDAY(3),JDATE+3         MOVE DAY TO MESSAGE         NTL
*                                                                   NTL
*                                                                   NTL
DATERTN  BR    R7                      RETURN TO MAINLINE           NTL
*                                                                   NTL
OUTT     MVC   CDAY(3),=CL3'???'                                    NTL
         B     MOVEJD                                               NTL
         SPACE 2                                                    NTL
         EJECT
***********************************************************************
*                                                                   NTL
*       CONSTANTS FOR DATE ROUTINE USAGE                            NTL
*                                                                   NTL
***********************************************************************
         SPACE ,
HHMASK   DC    X'40202021202022212020222120204B2020'                NTL
DEC60    DC    X'060C'                                              NTL
DEC6000  DC    X'06000C'                                            NTL
DEC50    DC    X'050C'                                              NTL
***********************************************************************
* LEAVE FIELDS TOGETHER.. INITIALIZED BY ONE MVC WITH VALUES        NTL
*                                                                   NTL
XMONMSK  DC    AL1(31,30,31,30,31,31,30,31,30,31,28,31)        )    NTL
         DC    CL1' '                                          )    NTL
         DC    C'XX.XXX'                           L           )    NTL
*                                                  E  F        )    NTL
         DC    CL2' '                              A  I  T     )    NTL
         DC    CL3' '                              V  E  O  F  )    NTL
         DC    CL2' ',C' ('                        E  L  G  O  )    NTL
         DC    CL3' ',C') '                           D  E  R  )    NTL
         DC    CL3' ',C' '                            S  T     )    NTL
         DC    CL2' ',C':'                               H  I  )    NTL
         DC    CL2' ',C':'                               E  N  )    NTL
         DC    CL5'SS.TH'                                R  I  )    NTL
*                                                           T  )    NTL
MVCLEN   EQU   *-XMONMSK                                            NTL
*                                                                   NTL
***********************************************************************
DAYTAB   DC    C'TUEWEDTHRFRISATSUNMON'                             NTL
MONTAB   DC    C'DECNOVOCTSEPAUGJULJUNMAYAPRMARFEBJAN'              NTL
         EJECT
***********************************************************************
*RMTORLCL SUBROUTINE - DETERMINE REMOTE OR LOCAL DESTINATION        NTL
* R1 POINTS TO PRTRT/PUNRT, R15 TO ASSEMBLY POINTER                 NTL
***********************************************************************
         AIF   (&QSP).QSP1                                        UF030
RMTORLCL CLI   1(R1),0        IS IT FOR REMOTE 00=LOCAL             NTL
         AGO   .QSP2                                              UF030
.QSP1    ANOP                                                     UF030
RMTORLCL CLC   2(2,R1),=X'0000'    IS IT FOR REMOTE00 (LOCAL)     UF030
.QSP2    ANOP                                                     UF030
         BNE   RMTRMT         NO LUCK .. HAVE TO WORK FOR IT        NTL
*                                                                   NTL
         MVC   0(L'LOCAL,R15),LOCAL   MOVE IN LOCAL                 NTL
         LA    R15,L'LOCAL(R15)       BUMP POINTER AND              NTL
         BR    R7                       RETURN                      NTL
*                                                                   NTL
RMTRMT   MVC   0(L'RMT,R15),RMT       MOVE IN 'RMT'                 NTL
         CLC   0(2,R1),=X'0000'    BR IF NOT                         CL
         BNE   *+10                 SPECIAL LOCAL                    CL
         MVC   0(L'LCL,R15),LCL    MOVE IN 'LCL'                     CL
         LA    R15,L'RMT(R15)  BUMP POINTER                         NTL
         SR    R14,R14        LOAD RMT FLAGS                        NTL
         AIF   (&QSP).QSP3A                                       UF030
         IC    R14,1(R1)      FROM PRT/PUN                          NTL
         AGO   .QSP3B                                             UF030
.QSP3A   ANOP                                                     UF030
         ICM   R14,3,2(R1)         FROM PRT/PUN                   UF030
.QSP3B   ANOP                                                     UF030
         CVD   R14,DOUBLEWD   RMT NUMBER TO DECIMAL                 NTL
         B     FITINUM1       FIT THE NUMBER IN RMT MESSAGE         NTL
         SPACE 2
***********************************************************************
* FITINUM SUBROUTINE - CONVERT BIN NUMBER TO NICE FORMAT            NTL
*                                                                   NTL
***********************************************************************
FITINUM  CVD   R1,DOUBLEWD    CONVERT TO PACKED DECIMAL             NTL
FITINUM1 MVC   EDITWORK(L'NORMAL),NORMAL INIT THE EDIT FORMAT       NTL
         LA    R1,EDITWORK+SIGNORM IN CASE OF ZEROES                NTL
         EDMK  EDITWORK(L'NORMAL),DOUBLEWD+2 CONVERT TO EBCDIC      NTL
         LA    R14,EDITWORK+L'NORMAL-1 A(END OF CONVERTED NUMBER)   NTL
         SLR   R14,R1         LENGTH OF THE CONVERTED NUMBER - 1    NTL
         EX    R14,MVNUMBER   PUT THE NUMBER IN THE MSG             NTL
         LA    R15,1(R14,R15) A(NEXT SPOT IN MSG)                   NTL
         BR    R7             RETURN TO OUR CALLER                  NTL
         SPACE 3                                                    NTL
MVNUMBER MVC   0(0,R15),0(R1) TO BE EXECUTED                        NTL
         SPACE 1                                                  ONL14
TILTSYSD QTILT '*** COMMAND INVALID FOR SYSDS TYPE JOBS ***'      ONL14
         SPACE 2                                                    NTL
NORMAL   DC    X'402020202020202020202120' EDIT MASK                NTL
SIGNORM  EQU   11             OFFSET TO LAST DIGIT                  NTL
RMT      DC    C'RMT'                                               NTL
LCL      DC    C'LCL'                                                CL
LOCAL    DC    C'LOCAL'                                             NTL
         EJECT ,                                                    NTL
         LTORG                                                      NTL
         EJECT ,                                                    NTL
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CJHIST   CSECT ,                                                  UF023
         PUSH  PRINT
         PRINT NOGEN
         AIF   (NOT &QACF2).$SKP4                                 ONL15
         AIF   (NOT &QSP133).$SKP4                                ONL15
         #ACFJCTX ,                GEN ACF2 JCT EXTENSION DSECT   ONL15
.$SKP4   ANOP  ,                                                  ONL15
         QCOMMON                   MOVE QCOMMON BEFORE EQUATES      NTL
         POP   PRINT
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
CJHIST   CSECT ,                                                  UF023
***********************************************************************
*                                                                   NTL
* LINE MAPPINGS                                                     NTL
*                                                                   NTL
***********************************************************************
*                   0123456789.123456789.123456789.123456789.123456789.
*              123456789.123456789.123456789.
HEADER   DC    CL80'                           JOB HISTORY INFORMATION'
HEAD3    DC    CL80'XXXXXXXX  XXXXXXXX VIA=XXXXXXXX BIN=XXXX  CLASS=X M*
               SGCLASS=X  NOTIFY=XXXXXXX'                           NTL
*              123456789.123456789.123456789
HEAD5    DC    CL80'PROCDDN=XXXXXXXX PRT=       PUN=        RDR TIME'
HEAD6    DC    CL80'PROGRAMMER=XXXXXXXXXXXXXXXXXXXX         XEQ START'
HEAD7    DC    CL80'CARDS  IN=                              XEQ STOP'
HEAD8    DC    CL80'LINES OUT=             CARDS OUT=       OUT START'
*
         AIF   (NOT &QACF2).$SKP5                                 ONL15
*        AIF   (&QONL).ONL17C                                     ONL17
         AIF   (&QTSS).ONL17C    DOR
         SPACE 1                                                  ONL15
HEAD12   DC    CL80'                              ACF2 INFORMATION'
HEAD14   DC    CL80'LOGONID=XXXXXXXX GROUP=XXXXXXXX NAME=XXXXXXXXXXXXXX*
               XXXXXX PHONE=XXXXXXXXXXXX'                           NTL
HEAD16   DC    CL80'SOURCE=XXXXXXXX SUBMITTED BY XXXXXXXX XXXXXXXX XXXX*
               XXXX'                                                NTL
         AGO   .ONL17D                                            ONL17
.ONL17C  ANOP  ,                                                  ONL17
         SPACE 1                                                  ONL17
HEAD12   DC    CL80'                            ACF2 INFORMATION' ONL17
HEAD14   DC    CL80'LOGONID=XXXXXXXX                NAME=XXXXXXXXXXXXXXX
               XXXXXX PHONE=XXXXXXXXXXXX'                         ONL17
HEAD15   DC    CL80'UID=XXXXXXXXXXXXXXXXXXXXXXXX    ADDR=XXXXXXXXXXXXXXX
               XXXXXXXXXX'                                        ONL17
HEAD16   DC    CL80'SOURCE=XXXXXXXX SUBMITTED BY XXXXXXXX XXXXXXXX XXXXX
               XXXX'                                              ONL17
.ONL17D  ANOP  ,                                                  ONL17
.$SKP5   ANOP  ,                                                  ONL15
         AIF   (NOT &QNERDC).NONERDC                              UF030
HEAD21   DC    CL80'                             NERDC INFORMATION'
HEAD22   DC    CL80'LOGONID=         ACCESS#=         SEQ#=    HEADER= +
                      '                                           UF030
HNERLID  EQU   QDMSG+08,8          SPACE FOR LOGON ID             UF030
HNERACC# EQU   QDMSG+25,8          SPACE FOR ACCESS NUMBER        UF030
HNERSEQ# EQU   QDMSG+39,3          SPACE FOR SEQUENCE NUMBER      UF030
HNERHEAD EQU   QDMSG+50,8          SPACE FOR OUTPUT HEADER        UF030
         SPACE 1                                                  UF030
HEAD23   DC    CL80'PROCLIB=                                           +
                 PROCVOL=      '                                  UF030
HNERPROC EQU   QDMSG+8,44          SPACE FOR PROCLIB DSN          UF030
HNERPROV EQU   QDMSG+61,6          SPACE FOR PROCLIB VOLSER       UF030
         SPACE 1                                                  UF030
.NONERDC ANOP  ,                                                  UF030
         EJECT ,                                                    NTL
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CJHIST   CSECT ,                                                  UF023
         DROP  ,                                                  UF023
         AIF  (&QSP136).NO136DC
JCT      EQU   0                                                    NTL
.NO136DC ANOP
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF  (NOT &QSP136).NO136DD
         IFGRPL  DSECT=YES,AM=VTAM
.NO136DD ANOP
        $BUFFER ,                                                 ONL16
        $JCT   ,                                                  ONL16
         AIF  (NOT &QSP136).NO136DE
         $TQE
.NO136DE ANOP
         AIF   (NOT &QSP133).NOC29A                               UF046
         AIF   (NOT &QNERDC).NOC29A                               UF046
         $NHD                                                     UF046
.NOC29A  ANOP                                                     UF046
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         EJECT  ,                                                   NTL
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         SPACE 2                                                    NTL
*                            OVERLAY FOR HEAD3                      NTL
JOBNAME  EQU   QDMSG+00,8                                           NTL
JOBNUMB  EQU   QDMSG+10,8                                           NTL
JOBSCE   EQU   QDMSG+23,8                                           NTL
BIN#     EQU   QDMSG+36,4                                           NTL
JOBCLASS EQU   QDMSG+48,1                                           NTL
MSGCLASS EQU   QDMSG+59,1                                           NTL
NOTIFY   EQU   QDMSG+69,7                                           NTL
*                                                                   NTL
*                            OVERLAY FOR HEAD5                      NTL
PROCDDN  EQU   QDMSG+08,8                                           NTL
PRTDEST  EQU   QDMSG+21,6                                           NTL
PUNDEST  EQU   QDMSG+32,6                                           NTL
TIMESTMP EQU   QDMSG+50,29     COMMON FOR READER/XEQ/PRT            NTL
*                                                                   NTL
*                            OVERLAY FOR HEAD6                      NTL
PROGAMER EQU   QDMSG+11,20                                          NTL
*                            OVERLAY FOR HEAD7                      NTL
CARDSIN  EQU   QDMSG+10,8                                           NTL
*                            OVERLAY FOR HEAD8                      NTL
LINESOUT EQU   QDMSG+10,8                                           NTL
CARDSOUT EQU   QDMSG+33,8                                           NTL
         SPACE 1                                                  ONL15
         AIF   (NOT &QACF2).$SKP6                                 ONL15
         AIF   (&QTSS).ONL17E DOR
*        AIF   (&QONL).ONL17E                                     ONL17
         SPACE 1                                                  ONL15
*                            OVERLAY FOR HEAD14                     NTL
LOGONID  EQU   QDMSG+08,8                                           NTL
GROUP    EQU   QDMSG+23,8                                           NTL
NAME     EQU   QDMSG+37,20                                          NTL
PHONE    EQU   QDMSG+64,12                                          NTL
*                            OVERLAY FOR HEAD16                     NTL
SOURCE   EQU   QDMSG+07,8                                           NTL
SUBLID   EQU   QDMSG+29,8                                           NTL
SUBPROG  EQU   QDMSG+38,8                                           NTL
SUBPATH  EQU   QDMSG+47,8                                           NTL
         SPACE 1                                                  ONL15
         AGO   .ONL17F                                            ONL17
.ONL17E  ANOP  ,                                                  ONL17
         SPACE 1                                                  ONL17
*                            OVERLAY FOR HEAD14                   ONL17
LOGONID  EQU   QDMSG+08,8                                         ONL17
NAME     EQU   QDMSG+37,20                                        ONL17
PHONE    EQU   QDMSG+64,12                                        ONL17
*                            OVERLAY FOR HEAD15                   ONL17
UIDSTR   EQU   QDMSG+04,24                                        ONL17
MAILADDR EQU   QDMSG+37,24                                        ONL17
*                            OVERLAY FOR HEAD16                   ONL17
SOURCE   EQU   QDMSG+07,8                                         ONL17
SUBLID   EQU   QDMSG+29,8                                         ONL17
SUBPROG  EQU   QDMSG+38,8                                         ONL17
SUBPATH  EQU   QDMSG+47,8                                         ONL17
         SPACE 1                                                  ONL17
.ONL17F  ANOP  ,                                                  ONL17
.$SKP6   ANOP  ,                                                  ONL15
         EJECT ,                                                    NTL
***********************************************************************
*                                                                   NTL
* WORK AREA DSECT                                                   NTL
*                                                                   NTL
***********************************************************************
WORK     DSECT                                                      NTL
         DS    CL72                                                 NTL
DOUBLEWD DC    D'0'                                                 NTL
BINYEAR  DC    F'0'                                                 NTL
BINDAYS  DC    F'0'                                                 NTL
DATE     DC    F'0'                                                 NTL
WORKWORD DC    2F'0'                                                NTL
EDITWORK DC    12H'0'
***********************************************************************
* LEAVE FIELDS TOGETHER.. INITIALIZED BY ONE MVC WITH VALUES        NTL
*                                                                   NTL
MONMSK   DC    AL1(31,30,31,30,31,31,30,31,30,31,28,31)        )    NTL
         DC    CL1' '                                          )    NTL
*        0123456789.123456789.123456789.                       )    NTL
*        DDMONYY (DDD) DAY HH:MM:SS.TH                         )    NTL
*                                                              )    NTL
JDATE    DC    C'XX.XXX'                           L           )    NTL
*                                                  E  F        )    NTL
CDAYN    DC    CL2' '                              A  I  T     )    NTL
CMON     DC    CL3' '                              V  E  O  F  )    NTL
CYR      DC    CL2' ',C' ('                        E  L  G  O  )    NTL
CJDAY    DC    CL3' ',C') '                           D  E  R  )    NTL
CDAY     DC    CL3' ',C' '                            S  T     )    NTL
CHH      DC    CL2' ',C':'                               H  I  )    NTL
CMM      DC    CL2' ',C':'                               E  N  )    NTL
CSS      DC    CL5'SS.TH'                                R  I  )    NTL
*                                                           T  )    NTL
***********************************************************************
LEN      EQU   *-CDAYN                                              NTL
         END  ,                                                     NTL
./       ADD   NAME=CJOE
CJOE     TITLE 'QUEUE COMMAND - DUMP A JOE IN HEX'                ONL01
CJOE     QSTART HASPEQU=YES,       START CJOE CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE COMMAND - DUMP A JOE IN HEX'
         GBLB  &QSP           MVS/SP OPTION
         GBLB  &QSP133        MVS/SP 1.3.3 OPTION                 UF046
         GBLB  &QSP136        MVS/SP 1.3.6 OPTION                 DOR
         AIF   (&QSP).SPOK
         QTILT 'JOE COMMAND ONLY SUPPORT UNDER SP VERSION OF QUEUE'
.SPOK    ANOP
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE                                    *
*                                                                     *
***********************************************************************
FINDJQE  L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CALL HEXDUMP TO DUMP THE JOES                                     *
*                                                                     *
***********************************************************************
         L     R10,QVCKPT     BASE FOR CKPT WORK AREA
         USING QCKPT,R10      ADDRESSING FOR IT
         L     R1,QCJQEA      ADDRESS OF JQE
         AIF   (NOT &QSP136).NO136A
         USING JQE,R1    ADDRESSING FOR JQE                     DOR
         AGO    .X136A
.NO136A  ANOP
         USING JQEDSECT,R1    ADDRESSING FOR JQE
.X136A   ANOP
         SR    R2,R2          CLEAR WORK REG
         ICM   R2,7,JQEJOEB   OFFSET TO FIRST WORK JOE
         BNZ   JOELOOP        CONTINUE IF ANY
         QTILT 'JOB HAS NO JOES'
         DROP  R1             DROP JQE ADDRESSING
         AIF   (NOT &QSP136).NO136B
         USING JOE,R2    ADDRESSING FOR JOE                     DOR
         AGO    .X136B
.NO136B  ANOP
         USING JOEDSECT,R2    ADDRESSING FOR JOE
.X136B   ANOP
         SPACE 1
JOELOOP  A     R2,QCJOTA      ADD TO GET ACTUAL ADDRESS
         LA    R1,MSGJWORK    WORK JOE MESSAGE
         ST    R1,QDMSGA      SAVE MESSAGE ADDRESS
         LA    R1,L'MSGJWORK  LENGTH OF MESSAGE
         STH   R1,QDMLNG      SAVE FOR DISPLAY ROUTINE
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY ROUTINE
         BALR  R14,R15        LINK TO IT
         LR    R1,R2          POINTER TO JOE TO DUMP
         AIF   (NOT &QSP136).NO136C
         LA    R0,JOE1END-JOE      ACTUAL LENGTH OF WORK JOE   DOR
         AGO    .X136C
.NO136C  ANOP
         LA    R0,JOE1END-JOEDSECT ACTUAL LENGTH OF WORK JOE
.X136C   ANOP
         L     R15,=V(HEXDUMP) ADDR OF HEXDUMP MODULE
         BALR  R14,R15        GO TO IT
         SPACE 1
         LA    R1,MSGJCHAR    CHAR JOE MESSAGE
         ST    R1,QDMSGA      SAVE MESSAGE ADDRESS
         LA    R1,L'MSGJCHAR  LENGTH OF MESSAGE
         STH   R1,QDMLNG      SAVE FOR DISPLAY ROUTINE
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY ROUTINE
         BALR  R14,R15        LINK TO IT
         ICM   R1,7,JOECHARB  POINTER TO CHARACTERISTICS JOE
         A     R1,QCJOTA      ADD TO GET ACTUAL ADDRESS
         AIF   (NOT &QSP136).NO136D
         LA    R0,JOE2END-JOE      ACTUAL LENGTH OF WORK JOE   DOR
         AGO    .X136D
.NO136D  ANOP
         LA    R0,JOE2END-JOEDSECT ACTUAL LENGTH OF CHAR JOE
.X136D   ANOP
         L     R15,=V(HEXDUMP) ADDR OF HEXDUMP MODULE
         BALR  R14,R15        GO TO IT
         SPACE 1
         AIF   (&QSP133).SP133A                                   UF046
         LA    R1,MSGJCKPT    CKPT JOE MESSAGE
         ST    R1,QDMSGA      SAVE MESSAGE ADDRESS
         LA    R1,L'MSGJCKPT  LENGTH OF MESSAGE
         STH   R1,QDMLNG      SAVE FOR DISPLAY ROUTINE
         ICM   R1,7,JOECKPTB  POINTER TO CKPT JOE
         BZ    NEXTWORK       NONE, GET NEXT WORK JOB FOR THIS JOB
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY ROUTINE
         BALR  R14,R15        LINK TO IT
         A     R1,QCJOTA      ADD TO GET ACTUAL ADDRESS
         AIF   (NOT &QSP136).NO136E
         LA    R0,JOE3END-JOE      ACTUAL LENGTH OF WORK JOE   DOR
         AGO    .X136E
.NO136E  ANOP
         LA    R0,JOE3END-JOEDSECT ACTUAL LENGTH OF CHAR JOE
.X136E   ANOP
         L     R15,=V(HEXDUMP) ADDR OF HEXDUMP MODULE
         BALR  R14,R15        GO TO IT
.SP133A  ANOP  ,                                                  UF046
         SPACE 1
NEXTWORK ICM   R2,7,JOEJQNXB  GET NEXT WORK JOE FOR THIS JOB
         BNZ   JOELOOP          AND DUMP IT
         QSTOP
MSGJWORK DC    C'*** WORK JOE ***'
MSGJCHAR DC    C'*** CHAR JOE ***'
MSGJCKPT DC    C'*** CKPT JOE ***'
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CJOE     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
        $JOE
        $JQE
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CJQE
CJQE     TITLE 'QUEUE COMMAND - DUMP A JQE IN HEX'                ONL01
CJQE     QSTART HASPEQU=YES,       START CJQE CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE COMMAND - DUMP A JQE IN HEX'
         GBLB   &QSP136            SP 1.3.6 OPTION   DOR
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE                                    *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CALL HEXDUMP TO DUMP THE JQE                                      *
*                                                                     *
***********************************************************************
         L     R10,QVCKPT     BASE FOR CKPT WORK AREA
         USING QCKPT,R10      ADDRESSING FOR IT
         L     R1,QCJQEA      ADDRESS OF JQE
         AIF   (NOT &QSP136).NO136A
         LA    R0,JQEBLEN+4   GET ACTUAL LENGTH OF JQE DOR
         AGO   .X136A
.NO136A  ANOP
         LA    R0,JQELNGTH    GET ACTUAL LENGTH OF JQE
.X136A   ANOP
         L     R15,=V(HEXDUMP) ADDR OF HEXDUMP MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CJQE     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
        $JQE
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CKPT
CKPT     TITLE 'QUEUE COMMAND - READ JES2 CKPT RECORDS'           ONL01
CKPT     QSTART ,                  START CKPT CSECT ASSEMBLY      ONL01
         GBLB  &QSP136        OPTION FLAG FOR SP 1.3.6 JES2       DOR
         USING QCKPT,R10      BASE REG FOR HASP WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
***********************************************************************
*                                                                     *
*   REPOSITION DATASET                                                *
*                                                                     *
***********************************************************************
         POINT HASPCKPT,TIR3  POINT PAST SYNC RECORDS
***********************************************************************
*                                                                     *
*   READ FIRST CHECKPOINT RECORD                                      *
*                                                                     *
***********************************************************************
         L     R2,QCJQTL      ADDR OF IOAREA FOR CKPT HEADER REC
         READ  HDECB1,SF,,(R2),MF=E                               UF039
         CHECK HDECB1
         AIF   (NOT &QSP136).NO136A
         AH    R2,=H'4096'        FOR SP136 USE                   DOR
         AGO   .X136A
.NO136A  ANOP
         AH    R2,HDECB1+6    INCREMENT PAST HEADER RECORD
.X136A   ANOP
***********************************************************************
*                                                                     *
*   READ REMAINDER OF CHECKPOINT RECORDS                              *
*                                                                     *
***********************************************************************
         L     R3,QCJOTL      NUMBER OF RECORDS IN CKPT DATASET   UF039
         BCTR  R3,0           DROP FOR PREVIOUSLY READ HEADER REC UF039
***********************************************************************
*LOOP    READ  HDECB1,SF,,(R2),MF=E                               UF039
*        CHECK HDECB1                                             UF039
*        AH    R2,=H'4096'    INCREMENT TO NEXT BUFFER            UF039
*        BCT   R3,LOOP        READ NEXT RECORD.                   UF039
***********************************************************************
LOOP1    LR    R6,R3          ASSUME CAN READ ALL BLOCKS AT ONCE  UF039
         SR    R0,R0          CLEAR FOR IC                        UF039
         IC    R0,DCBNCP-IHADCB+HASPCKPT  GET NCP ALLOWED         UF039
         CR    R6,R0                                              UF039
         BNH   *+6                                                UF039
         LR    R6,R0          LIMIT READS TO NCP MAX              UF039
         LR    R4,R6          SAVE NUMBER OF READS TO DO          UF039
         L     R7,QCDECBPT    POINTER TO DECB WORK AREA           UF039
LOOP2    MVC   0(HDECB1L,R7),HDECB1  PRIME THE DECB               UF039
         READ  (R7),SF,,(R2),MF=E  START A READ                   UF039
         AH    R2,=H'4096'    BUMP TO NEXT BUFFER AREA            UF039
         LA    R7,HDECB1L(,R7) BUMP TO NEXT DECB ADDR             UF039
         BCT   R4,LOOP2       LOOP FOR MAX READS                  UF039
         SPACE 1                                                  UF039
         LR    R4,R6          NUMBER OF CHECKS TO DO              UF039
         L     R7,QCDECBPT    POINT TO DECBS                      UF039
LOOP3    CHECK (R7)           CHECK A READ                        UF039
         LA    R7,HDECB1L(,R7) BUMP TO NEXT DECB                  UF039
         BCT   R4,LOOP3       CHECK ALL READS                     UF039
         SPACE 1                                                  UF039
         SR    R3,R6          TOTAL TO READ - JUST READ           UF039
         BP    LOOP1          CONTINUE IF MORE TO READ            UF039
***********************************************************************
*                                                                     *
*   RETURN TO CALLER                                                  *
*                                                                     *
***********************************************************************
         QSTOP
         LTORG
         DS    0F
TIR3     DC    X'00000300'    POINT PAST SYNC RECORDS
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         IHADCB DSORG=PS                                          UF039
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CORESE
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
*        TITLE 'IEESD03D -   #D  DISPLAY/ZAP CORE'
COREZAP  TITLE 'QUEUE COMMAND - COREZAP DISPLAY/ZAP CORE'
COREZAP  QSTART ,                  START COREZAP DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA    DOR
         L     R10,QVDSPL     LOAD BASE REG                     DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA      DOR
***********************************************************************
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESD03D -       #D DISPLAY/ZAP CORE                      ***
***                                                                 ***
***       VERSION -        2.1                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                                  AXC-CBT FIX LOOP WITH #DXX,00  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
*    R1
*    R2   -  BASE REG FOR XSA AREA
*    R3
*    R4   -
*    R5   -
*    R6   -
*    R7
*    R8   -
*    R9   -
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
***********************************************************************
         EJECT
***********************************************************************
*
*        THIS MODULE ATTEMPTS TO PERFORM THE BASIC FUNCTION OF
*        DISPLAYING AND MODIFYING CORE IN ANY ADDRESS SPACE EXCEPT FOR
*        LPA MODULES.
*        THE SYNTAX ACCEPTED IS AS FOLLOWS.
*
*
*              #DEXIT,AAAA        TERMINATE MEMORY FOR ASID AAAA
*
*              #DCHAP,AAAA,DDD    SET ASID AAAA TO DPRTY=DDD
*
*              #DNOCANC,AAAA      SET ASID AAAA NON-CANCELLABLE
*
*              #DOKCANC,AAAA      SET ASID AAAA CANCELABLE
*
*              #DNOSWAP,AAAA      SET ASID AAAA NON-SWAPABLE
*
*              #DOKSWAP,AAAA      SET ASID AAAA SWAPABLE
*
*              #DUNNN
*
*              #DSSSSSS,LL
*
*              #DSSSSSS/VVVVVVVV/RRRRRRRR
*
*              #D>AAAA,SSSSSS,LL
*
*              #D>AAAA,SSSSSS/VVVVVVVV/RRRRRRRR
*
*        WHERE THE FOLLOWING MEANINGS HOLD
*              NNN      THE CUU OF THE DESIRED DEVICE. 64 BYTES ARE
*                       DUMPPED.
*              LL       NUMBER OF LINES OF 16 BYTES TO DUMP.
*                       LIMIT IS 16.
*              SSSSSS   THE ADDRESS OF THE AFFECTED AREA
*              VVVVVVVV THE VALUE EXPECTED TO BE FOUND AT XXXXXX
*              RRRRRRRR THE VALUE TO PLACE AT XXXXXX
*              AAAA     THE ASID OF THE ADDRESS SPACE TO WORK IN
*
*  THE DEFAULTS ARE:
*      - IF >AAAA IS NOT SPECIFIED THEN THE MASTER SCHEDULAR
*        ADDRESS SPACE IS USED.
*      - IF LL IS NOT SPECIFIED THEN 64 BYTES ARE DUMPPED.
*
*  NOTE:
*      - VVVVVVVV AND RRRRRRRR MUST BE 8 CHARACTERS LONG.  ALL
*        OTHER VARIABLES CAN BE SHORTER THAN SHOWN.
*
*
*
***********************************************************************
         MVC   PLINES(4),=F'4'     DEFAULT PRINT LINES
         USING  QCKPT,R9
         L     R9,QVCKPT
         LH    R3,QDRLNG
         LTR   R3,R3               ANY PARM SPECIFIED
         BZ    NOPARM              NO, USE DEFAULT
         LA    R3,QDREPLY
         AH    R3,QOFF1
         DROP  R9
         LR    R7,R3               SAVE PARM START
         CLC   0(2,R3),=CL2'CZ'    COMMAND WITH NO PARM
         BE    NOPARM
         CLI   0(R3),C'U'     IS THIS A UCB REQUEST
         BE    UCBLOOP        YES SO PROCESS
         CLI   0(R3),C'S'     IS THIS A SPECIAL REQUEST
         BE    SVCLOOP        YES SO PROCESS
         CLC   0(5,R3),=CL5'EXIT,' EXIT REQUEST
         BE    MEMTERM        YES SO PROCESS
         CLC   0(5,R3),=CL5'CHAP,' CHAP REQUEST
         BE    CHAP           YES SO PROCESS
         CLC   0(6,R3),=CL6'OKSWAP'  SET SWAPABLE
         BE    SETSWAP        YES SO PROCESS
         CLC   0(6,R3),=CL6'NOSWAP'  SET NON-SWAPABLE
         BE    SETSWAP1       YES SO PROCESS
         CLC   0(6,R3),=CL6'OKCANC'  SET CANCELABLE
         BE    SETCANC        YES SO PROCESS
         CLC   0(6,R3),=CL6'NOCANC'  SET NON-CANCELABLE
         BE    SETCANC1       YES SO PROCESS
         CLI   0(R3),C'>'     IS IT AN ASID
         BNE   NOTASID        NOPE SO USE THIS ASID
         LA    R3,1(R3)       POINT AT ASID NUMBER
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         CLI   0(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR          GIVE ERROR IF NOT
         LA    R3,1(R3)       SKIP OVER THE COMMA
NOTASID  LA    R4,6           SET MAXLEN FOR ADDRESS
         BAL   R8,PARMCVT     CONVERT THE ADDRESS
         ST    R1,ADDR        SAVE ADDRESS TO DUMP OF REP AT
         CLI   0(R3),C','     IS IT DUMP FORMAT
         MVI   FLAG1,FG1DUMP  SET DUMP FLAG
         BE    DUMPPREP       GO SETUP DUMP PARMS
         CLI   0(R3),C' '     IF NEXT IS BLANK USE DEFAULT TO DUMP
         BE    DOFUNC
         MVI   FLAG1,FG1REP   SET REP FLAG
         CLI   0(R3),C'/'     IS THE SYNTAX CORRECT
         BNE   ERROR          BAD SYNTAX
         TITLE 'COREZAP  COMMAND  --  PREPARE FOR THE REP FUNCTION'
         CLI   9(R3),C'/'     CHECK REST OF SYNTAX
         BNE   ERROR
         LA    R3,1(R3)       SKIP OVER THE '/'
         LA    R4,8           SET MAX LENGTH TO 8 A FULL WORD
         BAL   R8,PARMCVT     CONVERT THE VER VALUE
         ST    R1,ALTVER      SAVE EXPECTED VALUE
         LA    R3,1(R3)       SKIP OVER '/'
         LA    R4,8           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT THE REP VALUE
         ST    R1,ALTREP      AND SAVE IT
         B     DOFUNC         GO SETUP TO DO FUNCTION
         TITLE 'COREZAP  COMMAND  --  SETUP FOR THE DUMP FUNCTION'
DUMPPREP DS    0H
         TM    1(R3),X'F0'         NUMERIC
         BNO   ERROR               NO
         TM    2(R3),X'F0'         NUMERIC
         BNO   ERROR               NO
         CLC   1(2,R3),=CL2'00'    LOOP POSSIBLE         AXC-CBT
         BE    MAX                 GIVE HIS THE MAX      AXC-CBT
         PACK  DOUBLE(8),1(2,R3)
         CVB   R1,DOUBLE
         CH    R1,=H'16'      MAX IS 256 BYTES
         BNH   *+8
MAX      LA    R1,16          SET MAX
         ST    R1,PLINES      SAVE NUMBER OF LINES
         TITLE 'COREZAP  COMMAND  --  PERFORM THE DESIRED FUNCTION'
*
*        CHECK FOR CROSS MEMORY FUNCTION AND IF SO VALIDATE
*        ASCB.
*
DOFUNC   L     R1,PLINES      COMPUTE THE LENGTH OF INFO TO DISPLAY
         SLL   R1,4           AS LINES*16
         ST    R1,LENGTH
         LH    R1,ASID        GET THE ASID
         LTR   R1,R1          IS IT ZERO
         BZ    DOSUBR         IF SO USE THIS ADDR SPACE  MS
         L     R3,CVTPTR      POINT TO CVT
         USING CVTMAP,R3
         L     R2,CVTTCBP     GO GET MY ASCB ADDR
         MVC   MYASCB,8(R2)   SAVE ADDR OF ASCB FOR POST
         MVC   MYTCB,0(R2)    SAVE THE TCB ADDRESS FOR STIMER
         L     R2,CVTASVT     POINT AT ASVT
         USING ASVT,R2
         C     R1,ASVTMAXU    IS ASID TOO BIG
         BH    ERROR          YES
         SLL   R1,2           ASID*4
         LA    R1,ASVTENTY-4(R1)  POINT AT DESIRED ENTRY
         MVC   TOASCB,0(R1)   MOVE THE ASCB ADDR IF ANY
         TM    TOASCB,ASVTAVAL IS THIS ASCB ADDR OR AVAILABLE
         BO    ERROR          ASID DOES NOT EXIST
         DROP  R2,R3
         L     R2,TOASCB      POINT AT ASCB
         USING ASCB,R2
         TM    ASCBRCTF,ASCBOUT   IS ASCB SWAPPED OUT
         BO    SWAPOUT
         CLC   MYASCB,TOASCB  IS THE ASCB THE MS
         BE    DOSUBR         IF SO THEN USE SUBROUTINE
*
*        NOW INITIALIZE THE SRB
*
         LA    R3,SRBAREA     POINT AT THE SRB
         USING SRBSECT,R3
         XC    SRBAREA,SRBAREA  CLEAR THE SRB
         MVC   SRBID,=C'SRB '  SET EBCDIC ID
         MVC   SRBASCB,TOASCB SET ASCB ADDR TO RUN IN
         LA    R1,D#SRBCD     POINT AT SRB CODE
         ST    R1,SRBEP       SAVE ENTRY POINT
         ST    R13,SRBPARM    SAVE PARM ADDR AS WORK AREA
         LA    R1,D#RMTR      SET ADDR OF RESOURCE MGR TERMINATION
         ST    R1,SRBRMTR     AND SAVE IT
         MVC   SRBPASID,ASID  SET ASID OF DESIRED ASCB
         DROP  R3
         EJECT
*
*        SCHEDULE SRB AND AWAIT COMPLETION
*
         XC    ECB,ECB        CLEAR DONE ECB
         XC    ECB2,ECB2      CLEAR STIMER ECB
         LA    R1,ECB         NOW SETUP THE ECBLIST
         ST    R1,ECBLIST
         LA    R1,ECB2
         ST    R1,ECBLIST+4
         MVI   ECBLIST+4,X'80'                         AXC
         L     R2,MYTCB       POINT AT TCB
         L     R2,0(0,R2)     POINT AT RB
         USING RBBASIC,R2
         ST    R1,RBEXSAVE+16 SAVE ECB2 ADDR IN RBXSA
         DROP  R2
         STIMER  REAL,D#STX,BINTVL==A(60*100) WAIT 1 MINUTE
         SCHEDULE  SRB=(R3),SCOPE=GLOBAL
         WAIT  ECBLIST=ECBLIST
         TTIMER CANCEL        CANCEL THE TIMER IF STILL EXISTS
         B     GOTBACK        GO AND CHECK COMPLETION
         SPACE 5
*
*        USE THE SRB CODE AS A SUBROUTINE
*
DOSUBR   OI    FLAG1,FG1SUBR  SET FLAG FOR SUBROUTINE
         LA    R1,DMYPRMS     SETUP DUMMY FRR PARMS
         ST    R1,FRRPRMS
         XC    DMYPRMS,DMYPRMS
         LR    R1,R13         SET UP PARM REGISTER
         LA    R15,D#SRBCD    SET ENTRY POINT ADDR
         LA    R14,GOTBACK    SET RETURN ADDRESS
         BR    R15            GO DO IT
         SPACE 5
*
*        THIS IS THE STIMER EXIT.  ITS PURPOSE IS TO POST THE
*        ECB AT ECB2 AND WAKE UP COMM TASK IF THE SRB FAILS
*        TO DO THIS WE MUST FIND THE ADDRESS OF THE ECB WHICH IS
*        SAVED IN THE XSA AREA OF THE SVRB IN COMM TASK
*
         USING *,R12
D#STX    SAVE  (14,12)
         LR    R12,R15        SET BAE REGISTER
         L     R3,CVTPTR
         L     R3,0(R3)       POINT AT TCB WORDS
         L     R3,0(R3)       POINT AT MY TCB
         L     R3,0(R3)       POINT AT MY RB
         USING RBBASIC-4,R3
D#STX1   SL    R3,=F'4'       POINT BACK TO LOOK AT INTC
         CLI   3(R3),X'01'    LOOK FOR WAIT SVC
         BE    D#STX2         IF FOUND THEN EXIT
         TM    XSTAB2,RBTCBNXT     TEST TCB FLAG
         BO    D#STX3         IF NOT FOUND PROPER RB
         L     R3,RBLINK      POINT AT PREVIOUS RB
         B     D#STX1         TRY AGAIN
D#STX2   L     R2,RBEXSAVE+16 GET ADDR OF ECB
         POST  (R2)         POST THE TIMER ECB
         RETURN (14,12)
         DROP  R12,R3
*
*        IF WE CAN NOT FIND THE RB THEN DUMP
*
D#STX3   DC    H'0'
         USING COREZAP,R12
         TITLE 'COREZAP  COMMAND  --  PERFORM THE DUMP FUNCTION'
*
*        WE HAVE RETURNED FOR THE SRB FUNCTION NOW CHECK THE RESULTS
*        AND IF GOOD THEN DUMP THE PROPER PART OF MEMORY
*
GOTBACK  TM    FLAG1,FG1SUBR  ARE WE IN SUBROUTINE MOVE
         BO    GOTBK2         IF SO THEN SKIP SOME TESTS
         TM    FLAG1,FG1SRDN  HAS THE SRB COMPLETED
         BZ    SRBFAIL        IF NOT THEN TIMER CAUGHT IT
         TM    FLAG2,FG2PSTR  DID XMPOST HAVE ERROR
         BO    XMPTERR        IF SO THEN MESSGAE
         TM    FLAG2,FG2PURG  WAS SRB PURGED
         BO    SRBPGERR       IF SO THEN TELL ABOUT IT
         TM    FLAG2,FG2ERRR  TEST FOR BAD ERROR
         BO    DISTERR        GIVE MESSAGE
GOTBK2   TM    FLAG2,FG2NVER  DID VER FAIL
         BO    NOTVER         IF SO THEN ISSUE MESSAGE
         TM    FLAG2,FG2IVLD  WAS ADDR INVALID
         BO    STAEMSG
         SPACE 5
*
*        NOW DUMP THE CORE SAVED IN ALTVER FOR 'LENGTH'
*        WHICH WAS FROM 'ADDR'
*
FORMAT   L     R4,PLINES           LOAD PRINT LINES
         LA    R5,ALTVER      POINT AT DATA TO DUMP
         SPACE
FORMAT1  LA    R6,QDMSG            PRINT AREA ADDR
         UNPK  0(7,R6),ADDR+1(4)  UNPACK ADDR
         MVC   6(4,R6),=CL4' '     BLANK 4 BYTES
         NC    0(6,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(6,R6),=C'0123456789ABCDEF'
         LA    R6,10(0,R6)         INCR INTO PRINT AREA
         LA    R7,4                NO. OF FULLWORDS PER LINE
         SPACE
FORMAT2  UNPK  0(9,R6),0(5,R5) UNPACK DATA
         MVC   8(2,R6),=CL4' '     BLANK 2 BYTES
         NC    0(8,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(8,R6),=C'0123456789ABCDEF'
         LA    R6,10(0,R6)         INCR INTO PRINT AREA
         LA    R5,4(0,R5)          INCR INTO DATA
         BCT   R7,FORMAT2          GO FORMAT
         BAL   R7,DISPLAY
         L     R1,ADDR        UPDATE ADDRESS OF DATA
         LA    R1,16(R1)
         ST    R1,ADDR
         BCT   R4,FORMAT1          NEXT LINE
         B     RETURN              EXIT
         TITLE 'COREZAP  COMMAND  --  SVC CHANGE FUNCTION'
SVCLOOP  L     R4,16               CVT ADDR
         L     R4,200(0,R4)        SCVT ADDR
         L     R4,132(0,R4)        SVCTABLE ADDR
         LA    R4,860(0,R4)        SVC 107 FLAGS
         CLI   1(R3),C'A'          SET AUTH
         BNE   SVCLOOP1            NO, SET NOT AUTH
         OI    0(R4),X'08'         SET NOT APF AUTH
         B     SVCMSG1
         SPACE 1
SVCLOOP1 NI    0(R4),X'F7'         SET NOT APF AUTH
         B     SVCMSG2
         TITLE 'COREZAP  COMMAND  --  UCB LOCATE FUNCTION'
UCBLOOP  L     R4,CVTPTR           CVT ADDR
         L     R4,CVTILK2-CVTMAP(R4)   LOOKUP TABLE ADDR
UCBLOOP1 SR    R5,R5               CLEAR ADDR
         ICM   R5,3,0(R4)          INSERT THE UCB ADDR
         BZ    UCBNEXT             NO, GET NEXT
         C     R5,=X'0000FFFF'     END OF TABLE
         BE    UCBNFND             YES, UCB NOT FOUND
         CLC   1(3,R3),13(R5)      UNIT MATCH
         BE    UCBFND              YES, UCB FOUND
UCBNEXT  LA    R4,2(0,R4)          LOAD NEXT SLOT ADDR
         B     UCBLOOP1            GO CHECK NEXT UCB
UCBFND   ST    R5,ADDR             SAVE ADDR TO DUMP AT
         OI    FLAG1,FG1DUMP  SET TO DUMP CORE
         B     DOFUNC              DUMP CORE USING SUBROUTINE
*                             BECAUSE ASID IS ZERO
         TITLE 'COREZAP  COMMAND  --  CHARACTER TO HEX CONVERTOR'
PARMCVT  XR    R0,R0
         LR    R1,R0          CLEAR SOME REGISTERS
         LR    R5,R4          SAVE DESIRED LENGTH IN R5
         SPACE 2
PARMCVT0 CLI   0(R3),C','     CHECK FOR DELIMITERS
         BE    PARMCVTD       IF ANY DELIMITER IS FOUND
         CLI   0(R3),C' '     THEN WE AREA DONE
         BE    PARMCVTD
         CLI   0(R3),C'/'
         BE    PARMCVTD
         CLI   0(R3),C'A'     NOW CHECK FOR HEX CHARACTERS
         BL    ERROR          AND IF INVALID THEN FLAG AS ERROR
         CLI   0(R3),C'F'
         BH    PARMCVT1       NOW TRY NUMBERICS
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET THE CHARACTER
         AH    R0,=H'9'       AND ADJUST TO PROPER VALUE
         B     PARMCVT2
PARMCVT1 CLI   0(R3),C'0'     NOW SEE IF NUMERIC
         BL    ERROR          IF NOT THEN ERROR
         CLI   0(R3),C'9'     AND TRY HIGH VALUE
         BH    ERROR
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET DIGIT
PARMCVT2 SLL   R1,4           CLEAR AREA
         OR    R1,R0          PUT IN NEW DIGIT
         LA    R3,1(R3)       POINT PAST
         BCT   R4,PARMCVT0    TRY AGAIN TILL EMPTY
         BR    R8             ALL DONE AND HAD EXPECTED NUMBER OF CHARS
         SPACE 3
PARMCVTD DS    0H             THE HEX NUMBER TERMINATED BEFORE FULL
         CH    R5,=H'8'       WAS A FULL WORD DESIRED
         BNER  R8             OUT IF NOT
         B     ERROR          FORCE FULLWORD TO BE PRESENT
         TITLE 'COREZAP  COMMAND  --  SET SWAP ROUTINE'
SETSWAP  SR    R9,R9          SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(13),=CL13'SWAPPABLE'
         B     SETSWAP2
         SPACE 1
SETSWAP1 LA    R9,128         SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(13),=CL13'NON-SWAPPABLE'
         SPACE 1
SETSWAP2 CLI   6(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR          GIVE ERROR IF NOT
         LA    R3,7(0,R3)     POINT TO ASID
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         L     R5,144(0,R5)        LOAD OUCB ADDR
         NI    17(R5),X'7F'        SET SWAPPABLE
         EX    R9,SETSWAPX         SET NON-SWAPPABLE OR LEAVE SWAPPABLE
         BAL   R7,DISPLAY
         B     EXIT
         SPACE 1
SETSWAPX OI    17(R5),X'00'        EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'COREZAP  COMMAND  --  SET CANC ROUTINE'
SETCANC  LA    R9,8           SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(14),=CL14'CANCELABLE'
         B     SETCANC2
         SPACE 1
SETCANC1 SR    R9,R9          SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(14),=CL14'NON-CANCELABLE'
         SPACE 1
SETCANC2 CLI   6(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR          GIVE ERROR IF NOT
         LA    R3,7(0,R3)     POINT TO ASID
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         L     R5,56(0,R5)         LOAD CSCB ADDR
         NI    7(R5),X'F7'         SET NON-CANCELABLE
         EX    R9,SETCANCX         SET CANCELABLE OR LEAVE NON-CANC
         BAL   R7,DISPLAY
         B     EXIT
         SPACE 1
SETCANCX OI    7(R5),X'00'         EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'COREZAP  COMMAND  --  EXIT ROUTINE'
MEMTERM  LA    R3,5(0,R3)     POINT TO ASID
         MVC   QDMSG+4(44),EXITMSG
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LH    R8,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         CALLRTM TYPE=MEMTERM,COMPCOD=3549,ASID=(R8)
         BAL   R7,DISPLAY
         B     EXIT
         TITLE 'COREZAP  COMMAND  --  CHAP ROUTINE'
CHAP     LA    R3,5(0,R3)     POINT TO ASID
         MVC   QDMSG+4(44),CHAPMSG
         MVC   QDMSG+42(3),5(R3) DPRTY
         MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),5(R3)
         CLC   DOUBLE(3),=C'000'
         BNE   ERROR               NOT NUMERIC
         PACK  DOUBLE(8),5(3,R3)
         CVB   R8,DOUBLE
         ST    R8,SAVER8  DOR
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         L     R8,SAVER8 DOR
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         CH    R8,=H'255'          MAX DPRTY
         BH    ERROR               OVER, ERROR
         STC   R8,43(0,R5)         SET NEW DPRTY IN ASCB
         L     R5,144(0,R5)        OUCB ADDR
         STC   R8,26(0,R5)         SET NEW DPRTY IN OUCB
         BAL   R7,DISPLAY
         B     EXIT
         TITLE 'COREZAP  COMMAND  --  ERROR ROUTINES'
         EJECT
         SPACE 3
SRBFAIL  DS    0H             SRB FAILED TO POST SO DUMP
         DC    H'0'
RETURN   EQU   *
EXIT     EQU   *
         QSTOP
STAEMSG  QTILT 'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
NOTVER   QTILT 'DATA NOT VERIFIED'
SVCMSG1  QTILT 'REQUEST COMPLETE -   SET APFAUTH'
SVCMSG2  QTILT 'REQUEST COMPLETE -   SET NOAUTH'
ERROR    QTILT 'PARAMETER ERROR'
NOPARM   QTILT 'I AM THE ALL-POWERFUL WIZARD OF MVS, YOUR MASTER '
UCBNFND  QTILT 'UNIT SPECIFIED NOT FOUND'
SWAPOUT  QTILT 'ADDRESS SPACE REQUESTED IS SWAPPED OUT'
DISTERR  QTILT 'DISASTEROUS ERROR OCCURED IN SRB MODE'
XMPTERR  QTILT 'CROSS-MEMORY POST FAILED'
SRBPGERR QTILT 'ADDRESS SPACE PURGING SRBS'
         EJECT
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  DOR
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     DOR
*                                                                   DOR
DISPLAY  EQU   *                                                    DOR
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVI   QDMSG,C' '      BLANK LINE
         MVC   QDMSG+1(79),QDMSG
         BR    R7             RETURN TO MAINLINE...                 DOR
         LTORG
         DS    0F
SIZE     DC    AL1(241),AL3(WORKEND-WORKSTRT)
         SPACE 3
EXITMSG  DC    CL44'JOB  XXXXXXXX  TERMINATED BY CMD SUB-SYSTEM'
         SPACE 3
         DS    0F
CHAPMSG  DC    CL44'JOB  XXXXXXXX  HAS BEEN SET TO DPRTY= NNN'
         SPACE 3
         DS    0F
SWAPRMSG DC    CL44'JOB  XXXXXXXX  HAS BEEN SET '
         SPACE 3
         DS    0F
         DROP  R12,R13
         TITLE 'COREZAP  COMMAND  --  SRB MODE CODE'
D#SRBCD  DS    0D
*
*        THIS CODE PERFORMS THE FOLLOWING FUNCTIONS
*              1 ESTABLISHES AN FRR FOR ERROR RECOVERY
*              2 VERIFIES THAT THE ADDRESSES THAT ARE NEEDED DO
*                EXIST.
*              3 PERFORM THE MODIFICATION IF ALLOW AND NECESSARY
*              4 SAVE THE PROPER CORE FOR DUMPING.
*              5 CROSS-MEMORY POST THE MAIN COMMAND PROCESSOR
*
         USING WORK,R8
         USING D#SRBCD,R7
         LR    R8,R1          SET THE MAIN PARM DSECT
         LR    R7,R15         SET THE BASE REGISTER
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         TM    FLAG1,FG1SUBR  IS THIS A SUBROUTINE CALL
         BO    D#SRB1         YES SO SKIP FRR
         LA    R5,D#FRRCD     POINT AT FRR CODE
         SETFRR  A,FRRAD=(R5),WRKREGS=(2,3),PARMAD=(R4)
         ST    R4,FRRPRMS     SAVE ADDR OF FRRPRMS
*
*        NOW INIT THE FRR PARM AREA AND VALIDATE THE INPUT ADDR
*
D#SRB1   L     R2,FRRPRMS     ACCESS THE 6 WORK PARM AREA
         STM   R7,R8,0(R2)    SAVE BASE AND WORK REGS
         MVI   0(R2),X'80'    SET VERIFICATION IN PROGRESS
         L     R1,ADDR        POINT AT CORE TO TROUBLE
         CLI   0(R1),0        ACCESS START OF AREA
         L     R3,LENGTH
         ALR   R3,R1          SUM THEN UP
         BCTR  R3,0           AND BACK DOWN ONE
         CLI   0(R3),0        DOES END EXIST ALSO
         MVI   0(R2),0        SET VERIFICATION FLAG OFF
         TM    FLAG1,FG1DUMP  IS IT DUMP REQUEST
         BO    D#SRB3         GO SETUP DUMP
         CLC   0(4,R1),ALTVER DOES THE INPUT VERIFY
         BE    D#SRB2         B IF YES
         MVI   FLAG2,FG2NVER  SET NOT VERIFY
         B     D#SRB3         GO AND DUMP IT
D#SRB2   MVC   0(4,R1),ALTREP DO MODIFICATION
*
*        NOW ADJSUST THE ADDR OF DUMP
*
D#SRB3   SRL   R1,4
         SLL   R1,4           ADJUST ADDR SO IT IS ON BOUNDARY
         ST    R1,ADDR        SAVE IT FOR PRINTING
         L     R2,LENGTH      GET LENGTH TO DUMP
         BCTR  R2,0
         EX    R2,D#SRBMVC    MOVE THE DATA INTO WORK
*
*        NOW WE TERMINATE PROCESSING BY DOING A CORSS
*        MEMORY POST IF NOT IN SUBROUTINE MODE
*
FRRRTY   TM    FLAG1,FG1SUBR  IS THIS SUBROUTINE MODE
         BO    D#EXIT         IF SO THEN EXIT
         SETFRR  D,WRKREGS=(2,3)
FRRPOST  L     R10,=A(X'40000000') SET CODE FOR POST
         LR    R9,R8          SAVE WORK POINTER IN SAFE REG
         LA    R11,ECB         ADDR OF ECB TO POST
         ICM   R11,8,=X'80'   FLAG AS XMPOST
         LA    R12,D#POSTR    SET POST ERROR RETURN
         L     R13,MYASCB     ASCB TO POST
         L     R15,CVTPTR     POINT AT CVT
         L     R15,CVT0PT01-CVTMAP(R15)    GET POST ENTRY POINTR
         BALR  R14,R15        GO DO POST
         DROP  R7             KILL MAIN ADDRESS
         USING *,R14          SET TEMP BASE
D#PRTN   LR    R8,R9          RESET BASE OF WORK
         SL    R14,=A(D#PRTN-D#SRBCD)  NOW HAVE CORRECTED BASE
         LR    R7,R14         SET TO PROPER REG
         DROP  R14
         USING D#SRBCD,R7     RESET MAIN BASE
         OI    FLAG1,FG1SRDN  FLAG SRB AS COMPLETED
D#EXIT   L     R14,ASRBRTN    RESTORE RETURN ADDR
         BR    R14            EXIT
D#SRBMVC MVC   ALTVER(0),0(R1)  MOVE IN THE DATA TO DUMP
         SPACE 5
*
*        POST ERROR ROUTINE  .. FLAG ERROR AND LET TIMER
*        WAKE UP COMM TASK
*
D#POSTR  LR    R8,R9          RESET WORK BASE
         OI    FLAG2,FG2PSTR  FLAG POST ERROR
         BR    R14            RETURN TO D#PRTN
         TITLE 'COREZAP  COMMAND  --  FRR FOR THE SRB MODE'
D#FRRCD  DS    0D
         L     R2,0(R1)       POINT AT PARM AREA
         LM    R7,R8,0(R2)    SET BASE REGS
         TM    0(R2),X'80'    ARE WE IN VALIDATION
         BZ    D#FRR1         NOPE
*
*        VALIDATION ERROR
*
         OI    FLAG2,FG2IVLD  SET FLAG FOR MESSAGE
         SETRP RECORD=NO,RC=4,RETADDR=FRRRTY,REGS,DUMP=NO,             X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         SPACE 5
*
*        ALL OTHER ERRORS
*
D#FRR1   OI    FLAG2,FG2ERRR  SET FLAG FOR MESSAGES
         SETRP RECORD=YES,RC=4,RETADDR=FRRRTY,REGS,DUMP=YES,           X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         TITLE 'COREZAP  COMMAND  --  RESOURCE MANAGER CLEANUP'
*
*        THIS ROUTINE RECEIVES CONTROL IF THE SRB MUST BE
*        PURGED.
*
D#RMTR   DS    0H
         USING *,R15
         LR    R7,R15         SET BASE REGISTER
         SL    R7,=A(D#RMTR-D#SRBCD)   BY COMPUTATION
         DROP  R15
         USING D#SRBCD,R7
         LR    R8,R2          SET UP POINTER TO WORK
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         OI    FLAG2,FG2PURG  SET PURGED
         B     FRRPOST        GO AND POST TO CLEAN UP
         LTORG
         TITLE 'COREZAP  COMMAND  --  DSECTS'
         PRINT GEN
         EJECT
         CVT
         EJECT
         IHAASVT
         EJECT
         IHAASCB
         EJECT
         IHAFRRS
         EJECT
         IHAPSA
         EJECT
         IHASDWA
         EJECT
         IHASRB
         EJECT
         IHARB
         EJECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKSTRT DS    0D
SAVRET   DS    18F
         DS    0D
DOUBLE   DS    2F
PLINES   DS    F
SAVER8   DS    F
PST      STAE  PST,CT,MF=L
DMYPRMS  DS    6F             DUMMY AREA FOR FRR PARMS FOR SUBR MODE
FRRPRMS  DS    F              ADDRESS OF 6 WORD FRR PARM
ASRBRTN  DS    F              RETURN ADDR FOR SRB CODE
MYASCB   DS    F              ASCB ADDR OF MAIN ROUTINE
MYTCB    DS    F              TCB ADDRESS FOR MAIN ROUTINE
TOASCB   DS    F              ASCB ADDR OF SRB ROUTINE
ECB      DS    F              ECB FOR MAIN ROUTINE TO WAIT ON
ECB2     DS    F              ECB FOR STIMER TO POST
ECBLIST  DS    2F
LENGTH   DS    F              LENGTH OF STORAGE TO DUMP
SRBAREA  DS    ((SRBSIZE+3)/4)F  THE SRB ITSELF
ADDR     DS    F              ADDRESS TO PROCESS AT
ALTREP   DS    F              REPLACEMENT VALUE
ALTVER   DS    F,252C         SPACE FOR VER DATA AND DUMP DATA
ASID     DS    H              ASID OF TOASCB
FLAG1    DS    X
FG1DUMP  EQU   X'80'
FG1REP   EQU   X'40'
FG1SRDN  EQU   X'02'          IF ON SRB HAS TERMINATED
FG1SUBR  EQU   X'01'
FLAG2    DS    X
FG2NVER  EQU   X'01'          VERIFICATION FAILED
FG2IVLD  EQU   X'02'          VALIDATION FAILED
FG2ERRR  EQU   X'04'          DISASTER OCCURED IN SRB
FG2PURG  EQU   X'08'          SRB WAS PURGED
FG2PSTR  EQU   X'10'          IF ON THEN SRB POST HAD ERROR
WORKEND  DS    0F
         END
./       ADD   NAME=COREZAP
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
*        TITLE 'SE2SD03D -   #D  DISPLAY/ZAP CORE'
COREZAP  TITLE 'QUEUE COMMAND - COREZAP DISPLAY/ZAP CORE'
COREZAP  QSTART ,                  START COREZAP DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA    DOR
         L     R10,QVDSPL     LOAD BASE REG                     DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA      DOR
***********************************************************************
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SD03D -       #D DISPLAY/ZAP CORE                      ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      TO MVS/SP1.1 ALSO MVS/SP1.3              ***
***                                                                 ***
***       WARNING   -      BE SURE TO CHANGE THE CONSTANT AT THE    ***
***                        LABEL CALLED SWAPPG TO YOUR OWN          ***
***                        PERFORMANCE SWAP OUT NUMBER (MAX AND     ***
***                        MIN OF 0 ON A DOMAIN)                    ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                                  FIX LOOP IN #D,XX,00           ***
***                        08/10 81  JGS - ADD EBCDIC DISPLAY     NERDC
***                        08/20/81  JCC-BCB ADD FUNCTION DOSWAP    ***
***                                          FOR PERMANENT SWAP OUT ***
***                        08/30/81  AXC-CBT CHANGED PERFORMANCE GP ***
***                                  FROM 20 TO 05 FOR USE AT CBT   ***
***                                  LABEL IS CALLED SWAPPG         ***
***                                                                 ***
***                        11/23/82  LMB-CBT UPDATED CAN-NOCAN      LMB
***                                  CODE TO POINT TO CORRECT CSCB  LMB
***                                 -INCREASED ESTAE AREA TO 5F     LMB
***                         7/3/85  - REMODIFY FOR ISPF QUEUE       DOR
***********************************************************************
***********************************************************************
         EJECT
***********************************************************************
*
*        THIS MODULE ATTEMPTS TO PERFORM THE BASIC FUNCTION OF
*        DISPLAYING AND MODIFYING CORE IN ANY ADDRESS SPACE EXCEPT FOR
*        LPA MODULES.
*        THE SYNTAX ACCEPTED IS AS FOLLOWS.
*
*
*              #DEXIT,AAAA        TERMINATE MEMORY FOR ASID AAAA
*
*              #DCHAP,AAAA,DDD    SET ASID AAAA TO DPRTY=DDD
*
*              #DNOCANC,AAAA      SET ASID AAAA NON-CANCELLABLE
*
*              #DOKCANC,AAAA      SET ASID AAAA CANCELABLE
*
*              #DNOSWAP,AAAA      SET ASID AAAA NON-SWAPABLE
*
*              #DOKSWAP,AAAA      SET ASID AAAA SWAPABLE
*
*              #DDOSWAP,AAAA      SWAP ASID AAAA IN/OUT           JCC
*
*              #DUNNN
*
*              #DSSSSSS,LL
*
*              #DSSSSSS/VVVVVVVV/RRRRRRRR
*
*              #D>AAAA,SSSSSS,LL
*
*              #D>AAAA,SSSSSS/VVVVVVVV/RRRRRRRR
*
*        WHERE THE FOLLOWING MEANINGS HOLD
*              NNN      THE CUU OF THE DESIRED DEVICE. 64 BYTES ARE
*                       DUMPPED.
*              LL       NUMBER OF LINES OF 16 BYTES TO DUMP.
*                       LIMIT IS 16.
*              SSSSSS   THE ADDRESS OF THE AFFECTED AREA
*              VVVVVVVV THE VALUE EXPECTED TO BE FOUND AT XXXXXX
*              RRRRRRRR THE VALUE TO PLACE AT XXXXXX
*              AAAA     THE ASID OF THE ADDRESS SPACE TO WORK IN
*
*  THE DEFAULTS ARE:
*      - IF >AAAA IS NOT SPECIFIED THEN THE MASTER SCHEDULAR
*        ADDRESS SPACE IS USED.
*      - IF LL IS NOT SPECIFIED THEN 64 BYTES ARE DUMPPED.
*
*  NOTE:
*      - VVVVVVVV AND RRRRRRRR MUST BE 8 CHARACTERS LONG.  ALL
*        OTHER VARIABLES CAN BE SHORTER THAN SHOWN.
*
*
*
***********************************************************************
         USING  QCKPT,R9
         L     R9,QVCKPT
         LH    R3,QDRLNG
         LTR   R3,R3               ANY PARM SPECIFIED
         BZ    NOPARMX          NO, REPEAT ENTER (NEXT 64 BYTES CORE)
         MVC   PLINES(4),=F'4'    DEFAULT PRINT LINES
         LA    R3,QDREPLY
         AH    R3,QOFF1
         DROP  R9
         LR    R7,R3               SAVE PARM START
         CLC   0(2,R3),=CL2'CZ'    COMMAND WITH NO PARM
         LA    R1,NOPARM
         BE    QUIT
         MVC   QDHLINE(80),QBLANK
         MVI   CZAPFLAG,X'00'
         CLI   0(R3),C'U'     IS THIS A UCB REQUEST
         BE    UCBLOOP        YES SO PROCESS
         CLI   0(R3),C'S'     IS THIS A SPECIAL REQUEST
         BE    SVCLOOP        YES SO PROCESS
         CLC   0(5,R3),=CL5'EXIT,' EXIT REQUEST
         BE    MEMTERM        YES SO PROCESS
         CLC   0(5,R3),=CL5'CHAP,' CHAP REQUEST
         BE    CHAP           YES SO PROCESS
         CLC   0(6,R3),=CL6'OKSWAP'  SET SWAPABLE
         BE    SETSWAP        YES SO PROCESS
         CLC   0(6,R3),=CL6'NOSWAP'  SET NON-SWAPABLE
         BE    SETSWAP1       YES SO PROCESS
         CLC   0(6,R3),=CL6'DOSWAP'  SWAP IN/OUT                  JCC
         BE    SETSWAP6       YES SO PROCESS                      JCC
         CLC   0(6,R3),=CL6'OKCANC'  SET CANCELABLE
         BE    SETCANC        YES SO PROCESS
         CLC   0(6,R3),=CL6'NOCANC'  SET NON-CANCELABLE
         BE    SETCANC1       YES SO PROCESS
         MVI   CZAPFLAG,X'01'
         CLI   0(R3),C'>'     IS IT AN ASID
         BNE   NOTASID        NOPE SO USE THIS ASID
*        CALL  TRACE
         LA    R3,1(R3)       POINT AT ASID NUMBER
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT    CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         CLI   0(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR
         LA    R3,1(R3)       SKIP OVER THE COMMA
NOTASID  LA    R4,6           SET MAXLEN FOR ADDRESS
         BAL   R8,PARMCVT    CONVERT THE ADDRESS
         ST    R1,ADDR        SAVE ADDRESS TO DUMP OF REP AT
         CLI   0(R3),C','     IS IT DUMP FORMAT
         MVI   FLAG1,FG1DUMP  SET DUMP FLAG
         BE    DUMPPREP       GO SETUP DUMP PARMS
         CLI   0(R3),C' '     IF NEXT IS BLANK USE DEFAULT TO DUMP
         BE    DOFUNC
         MVI   FLAG1,FG1REP   SET REP FLAG
         CLI   0(R3),C'/'     IS THE SYNTAX CORRECT
         BNE   ERROR
         TITLE 'COREZAP  COMMAND  --  PREPARE FOR THE REP FUNCTION'
         CLI   9(R3),C'/'     CHECK REST OF SYNTAX
         BNE   ERROR
         LA    R3,1(R3)       SKIP OVER THE '/'
         LA    R4,8           SET MAX LENGTH TO 8 A FULL WORD
         BAL   R8,PARMCVT     CONVERT THE VER VALUE
         ST    R1,ALTVER      SAVE EXPECTED VALUE
         LA    R3,1(R3)       SKIP OVER '/'
         LA    R4,8           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT THE REP VALUE
         ST    R1,ALTREP      AND SAVE IT
         B     DOFUNC         GO SETUP TO DO FUNCTION
NOPARMX  TM    CZAPFLAG,X'01'
         LA    R1,NOPARM
         BZ    QUIT
*        L     R1,ADDR
*        A     R1,=F'64'
*        ST    R1,ADDR
         MVI   FLAG1,FG1DUMP
         B     DOFUNC
         TITLE 'COREZAP  COMMAND  --  SETUP FOR THE DUMP FUNCTION'
DUMPPREP DS    0H
         TM    1(R3),X'F0'         NUMERIC
         BNO   ERROR
         TM    2(R3),X'F0'         NUMERIC
         BNO   ERROR
         CLC   1(2,R3),=CL2'00'    AXC-CBT POSSIBLE LOOP
         BE    MAX                 AXC-CBT YES
         PACK  DOUBLE(8),1(2,R3)
         CVB   R1,DOUBLE
         CH    R1,=H'16'      MAX IS 256 BYTES
         BNH   *+8
MAX      LA    R1,16          SET MAX
         ST    R1,PLINES      SAVE NUMBER OF LINES
         TITLE 'COREZAP  COMMAND  --  PERFORM THE DESIRED FUNCTION'
*
*        CHECK FOR CROSS MEMORY FUNCTION AND IF SO VALIDATE
*        ASCB.
*
DOFUNC   L     R1,PLINES      COMPUTE THE LENGTH OF INFO TO DISPLAY
         SLL   R1,4           AS LINES*16
         ST    R1,LENGTH
         LH    R1,ASID        GET THE ASID
         LTR   R1,R1          IS IT ZERO
         BZ    DOSUBR         IF SO USE THIS ADDR SPACE  MS
         L     R3,CVTPTR      POINT TO CVT
         USING CVTMAP,R3
         L     R2,CVTTCBP     GO GET MY ASCB ADDR
         MVC   MYASCB,8(R2)   SAVE ADDR OF ASCB FOR POST
         MVC   MYTCB,0(R2)    SAVE THE TCB ADDRESS FOR STIMER
         L     R2,CVTASVT     POINT AT ASVT
         USING ASVT,R2
         C     R1,ASVTMAXU    IS ASID TOO BIG
         BH    ERROR
         SLL   R1,2           ASID*4
         LA    R1,ASVTENTY-4(R1)  POINT AT DESIRED ENTRY
         MVC   TOASCB,0(R1)   MOVE THE ASCB ADDR IF ANY
         TM    TOASCB,ASVTAVAL IS THIS ASCB ADDR OR AVAILABLE
         BO    ERROR
         DROP  R2,R3
         L     R2,TOASCB      POINT AT ASCB
         USING ASCB,R2
         TM    ASCBRCTF,ASCBOUT   IS ASCB SWAPPED OUT
         LA    R1,SWAPOUT
         BO    QUIT
         CLC   MYASCB,TOASCB  IS THE ASCB THE MS
         BE    DOSUBR         IF SO THEN USE SUBROUTINE
*
*        NOW INITIALIZE THE SRB
*
         LA    R3,SRBAREA     POINT AT THE SRB
         USING SRBSECT,R3
         XC    SRBAREA,SRBAREA  CLEAR THE SRB
         MVC   SRBID,=C'SRB '  SET EBCDIC ID
         MVC   SRBASCB,TOASCB SET ASCB ADDR TO RUN IN
         LA    R1,D#SRBCD     POINT AT SRB CODE
         ST    R1,SRBEP       SAVE ENTRY POINT
         ST    R13,SRBPARM    SAVE PARM ADDR AS WORK AREA
         LA    R1,D#RMTR      SET ADDR OF RESOURCE MGR TERMINATION
         ST    R1,SRBRMTR     AND SAVE IT
         MVC   SRBPASID,ASID  SET ASID OF DESIRED ASCB
         DROP  R3
         EJECT
*
*        SCHEDULE SRB AND AWAIT COMPLETION
*
         XC    ECB,ECB        CLEAR DONE ECB
         XC    ECB2,ECB2      CLEAR STIMER ECB
         LA    R1,ECB         NOW SETUP THE ECBLIST
         ST    R1,ECBLIST
         LA    R1,ECB2
         ST    R1,ECBLIST+4
         MVI   ECBLIST+4,X'80'                         AXC
         L     R2,MYTCB       POINT AT TCB
         L     R2,0(0,R2)     POINT AT RB
         USING RBBASIC,R2
         ST    R1,RBEXSAVE+16 SAVE ECB2 ADDR IN RBXSA
         DROP  R2
         STIMER  REAL,D#STX,BINTVL==A(60*100) WAIT 1 MINUTE
         SCHEDULE  SRB=(R3),SCOPE=GLOBAL
         WAIT  ECBLIST=ECBLIST
         TTIMER CANCEL        CANCEL THE TIMER IF STILL EXISTS
         B     GOTBACK        GO AND CHECK COMPLETION
         SPACE 5
*
*        USE THE SRB CODE AS A SUBROUTINE
*
DOSUBR   OI    FLAG1,FG1SUBR  SET FLAG FOR SUBROUTINE
         LA    R1,DMYPRMS     SETUP DUMMY FRR PARMS
         ST    R1,FRRPRMS
         XC    DMYPRMS,DMYPRMS
         LR    R1,R13         SET UP PARM REGISTER
         LA    R15,D#SRBCD    SET ENTRY POINT ADDR
         LA    R14,GOTBACK    SET RETURN ADDRESS
         BR    R15            GO DO IT
         SPACE 5
*
*        THIS IS THE STIMER EXIT.  ITS PURPOSE IS TO POST THE
*        ECB AT ECB2 AND WAKE UP COMM TASK IF THE SRB FAILS
*        TO DO THIS WE MUST FIND THE ADDRESS OF THE ECB WHICH IS
*        SAVED IN THE XSA AREA OF THE SVRB IN COMM TASK
*
         USING *,R12
D#STX    SAVE  (14,12)
         LR    R12,R15        SET BAE REGISTER
         L     R3,CVTPTR
         L     R3,0(R3)       POINT AT TCB WORDS
         L     R3,0(R3)       POINT AT MY TCB
         L     R3,0(R3)       POINT AT MY RB
         USING RBBASIC-4,R3
D#STX1   SL    R3,=F'4'       POINT BACK TO LOOK AT INTC
         CLI   3(R3),X'01'    LOOK FOR WAIT SVC
         BE    D#STX2         IF FOUND THEN EXIT
         TM    XSTAB2,RBTCBNXT     TEST TCB FLAG
         BO    D#STX3         IF NOT FOUND PROPER RB
         L     R3,RBLINK      POINT AT PREVIOUS RB
         B     D#STX1         TRY AGAIN
D#STX2   L     R2,RBEXSAVE+16 GET ADDR OF ECB
         POST  (R2)         POST THE TIMER ECB
         RETURN (14,12)
         DROP  R12,R3
*
*        IF WE CAN NOT FIND THE RB THEN DUMP
*
D#STX3   DC    H'0'
         USING COREZAP,R12
         TITLE 'COREZAP  COMMAND  --  PERFORM THE DUMP FUNCTION'
*
*        WE HAVE RETURNED FOR THE SRB FUNCTION NOW CHECK THE RESULTS
*        AND IF GOOD THEN DUMP THE PROPER PART OF MEMORY
*
GOTBACK  TM    FLAG1,FG1SUBR  ARE WE IN SUBROUTINE MOVE
         BO    GOTBK2         IF SO THEN SKIP SOME TESTS
         TM    FLAG1,FG1SRDN  HAS THE SRB COMPLETED
         BZ    SRBFAIL        IF NOT THEN TIMER CAUGHT IT
         TM    FLAG2,FG2PSTR  DID XMPOST HAVE ERROR
         TM    FLAG2,FG2PURG  WAS SRB PURGED
         LA    R1,SRBPGERR
         BO    QUIT
         TM    FLAG2,FG2ERRR  TEST FOR BAD ERROR
         LA    R1,DISTERR
         BO    QUIT
GOTBK2   TM    FLAG2,FG2NVER  DID VER FAIL
         LA    R1,NOTVER
         BO    QUIT
         TM    FLAG2,FG2IVLD  WAS ADDR INVALID
         LA    R1,STAEMSG
         BO    QUIT
         SPACE 5
*
*        NOW DUMP THE CORE SAVED IN ALTVER FOR 'LENGTH'
*        WHICH WAS FROM 'ADDR'
*
FORMAT   L     R4,PLINES           LOAD PRINT LINES
         LA    R5,ALTVER      POINT AT DATA TO DUMP
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE(30),=CL30'MEMORY CORE DISPLAY CONTENTS '
         SPACE
FORMAT1  LA    R6,QDMSG            PRINT AREA ADDR
         UNPK  0(7,R6),ADDR+1(4)  UNPACK ADDR
         MVC   6(1,R6),=CL4' '     BLANK 1 BYTE                   NERDC
         NC    0(6,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(6,R6),=C'0123456789ABCDEF'
         MVI   43(R6),C'*'         START OF EBCDIC DATA           NERDC
         MVC   44(16,R6),0(R5)     EBCDIC DATA                    NERDC
         TR    44(16,R6),EBCDICTB  TRANSLATE OUT UNPRINTABLES     NERDC
         MVI   44+16(R6),C'*'      END OF EBCDIC DATA             NERDC
         LA    R6,7(0,R6)          INCR INTO PRINT AREA           NERDC
         LA    R7,4                NO. OF FULLWORDS PER LINE
         SPACE
FORMAT2  UNPK  0(9,R6),0(5,R5) UNPACK DATA
         MVC   8(1,R6),=CL4' '     BLANK 1 BYTE                   NERDC
         NC    0(8,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(8,R6),=C'0123456789ABCDEF'
         LA    R6,9(0,R6)          INCR INTO PRINT AREA           NERDC
         LA    R5,4(0,R5)          INCR INTO DATA
         BCT   R7,FORMAT2          GO FORMAT
         BAL   R7,DISPLAY QUEUE DISPLAY OUTPUT
         L     R1,ADDR        UPDATE ADDRESS OF DATA
         LA    R1,16(R1)
         ST    R1,ADDR
         BCT   R4,FORMAT1          NEXT LINE
         B     RETURN              EXIT
         SPACE 1                                                  NERDC
EBCDICTB DC    C'                                '  TRANSLATE     NERDC
         DC    C'                                '  TABLE         NERDC
         DC    C'           .<(+&&          $*);^' USED TO       NERDC
         DC    C'-/         ,%_>?          :#@''="' TRANSLATE     NERDC
         DC    C' ABCDEFGHI       JKLMNOPQR      '  ALL           NERDC
         DC    C'  STUVWXYZ      0123456789      '  ILLEGAL       NERDC
         DC    C' ABCDEFGHI       JKLMNOPQR      '  CHARACTERS    NERDC
         DC    C'  STUVWXYZ      0123456789      '  TO BLANKS     NERDC
         TITLE 'COREZAP  COMMAND  --  SVC CHANGE FUNCTION'
SVCLOOP  L     R4,16               CVT ADDR
         L     R4,200(0,R4)        SCVT ADDR
         L     R4,132(0,R4)        SVCTABLE ADDR
         LA    R4,860(0,R4)        SVC 107 FLAGS
         CLI   1(R3),C'A'          SET AUTH
         BNE   SVCLOOP1            NO, SET NOT AUTH
         OI    0(R4),X'08'         SET NOT APF AUTH
         LA    R1,SVCMSG1
         B     QUIT
         SPACE 1
SVCLOOP1 NI    0(R4),X'F7'         SET NOT APF AUTH
         LA    R1,SVCMSG2
         B     QUIT
         TITLE 'COREZAP  COMMAND  --  UCB LOCATE FUNCTION'
UCBLOOP  L     R4,CVTPTR           CVT ADDR
         L     R4,CVTILK2-CVTMAP(R4)   LOOKUP TABLE ADDR
UCBLOOP1 SR    R5,R5               CLEAR ADDR
         ICM   R5,3,0(R4)          INSERT THE UCB ADDR
         BZ    UCBNEXT             NO, GET NEXT
         C     R5,=X'0000FFFF'     END OF TABLE
         LA    R1,UCBNFND
         BE    QUIT
         CLC   1(3,R3),13(R5)      UNIT MATCH
         BE    UCBFND              YES, UCB FOUND
UCBNEXT  LA    R4,2(0,R4)          LOAD NEXT SLOT ADDR
         B     UCBLOOP1            GO CHECK NEXT UCB
UCBFND   ST    R5,ADDR             SAVE ADDR TO DUMP AT
         OI    FLAG1,FG1DUMP  SET TO DUMP CORE
         B     DOFUNC              DUMP CORE USING SUBROUTINE
*                             BECAUSE ASID IS ZERO
         TITLE 'COREZAP  COMMAND  --  CHARACTER TO HEX CONVERTOR'
PARMCVT  XR    R0,R0
         LR    R1,R0          CLEAR SOME REGISTERS
         LR    R5,R4          SAVE DESIRED LENGTH IN R5
         SPACE 2
PARMCVT0 CLI   0(R3),C','     CHECK FOR DELIMITERS
         BE    PARMCVTD       IF ANY DELIMITER IS FOUND
         CLI   0(R3),C' '     THEN WE AREA DONE
         BE    PARMCVTD
         CLI   0(R3),C'/'
         BE    PARMCVTD
         CLI   0(R3),C'A'     NOW CHECK FOR HEX CHARACTERS
         BL    ERROR
         CLI   0(R3),C'F'
         BH    PARMCVT1       NOW TRY NUMBERICS
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET THE CHARACTER
         AH    R0,=H'9'       AND ADJUST TO PROPER VALUE
         B     PARMCVT2
PARMCVT1 CLI   0(R3),C'0'     NOW SEE IF NUMERIC
         BL    ERROR          IF NOT THEN ERROR
         CLI   0(R3),C'9'     AND TRY HIGH VALUE
         BH    ERROR
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET DIGIT
PARMCVT2 SLL   R1,4           CLEAR AREA
         OR    R1,R0          PUT IN NEW DIGIT
         LA    R3,1(R3)       POINT PAST
         BCT   R4,PARMCVT0    TRY AGAIN TILL EMPTY
         BR    R8             ALL DONE AND HAD EXPECTED NUMBER OF CHARS
         SPACE 3
PARMCVTD DS    0H             THE HEX NUMBER TERMINATED BEFORE FULL
         CH    R5,=H'8'       WAS A FULL WORD DESIRED
         BNER  R8             OUT IF NOT
ERROR    LA    R1,ERRORM
         B     QUIT
         TITLE 'COREZAP  COMMAND  --  SET SWAP ROUTINE'
SETSWAP  SR    R9,R9          SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(13),=CL13'SWAPPABLE'
         B     SETSWAP2
         SPACE 1
SETSWAP1 LA    R9,128         SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(13),=CL13'NON-SWAPPABLE'
         SPACE 1
SETSWAP2 CLI   6(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR          GIVE ERROR IF NOT
         LA    R3,7(0,R3)     POINT TO ASID
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         L     R5,144(0,R5)        LOAD OUCB ADDR
         C     R9,=F'256'          IS SWAP SWITCH ON?             JCC
         BE    SETSWAP7            YES, GO SWAP IT                JCC
         NI    17(R5),X'7F'        SET SWAPPABLE
         EX    R9,SETSWAPX         SET NON-SWAPPABLE OR LEAVE SWAPPABLE
SETSWAP4 DS    0H                                                 JCC
         B     PUTOUT
SETSWAP6 DS    0H                                                 JCC
         LA    R9,256              SET SWAP IN/OUT SWITCH ON      JCC
         MVC   QDMSG+4(44),SWAPRMSG                               JCC
         B     SETSWAP2            GO BACK TO COMMON RTN          JCC
SETSWAP7 DS    0H                                                 JCC
*        MODESET KEY=ZERO              PREPARE FOR SYSEVENT       JCC
         USING OUCB,R5                                            JCC
         TM    OUCBSFL,OUCBNSW         IS THIS GUY SWAPPABLE?     JCC
         BNO   SETSWAP8                YES,CONTINUE               JCC
         MVC   QDMSG+19(29),DOSWAP1    NO, SAY SO                 JCC
         B     SETSWAPA                GET OUT AFTER RESET        JCC
SETSWAP8 DS    0H                                                 JCC
         CLC   OUCBNPG,SWAPPG          IS THIS GUY ALREADY OUT?   JCC
         BE    SETSWAP9                YES, BRING HIM IN          JCC
         SLR   R1,R1                   NO, CLEAR REG 1            JCC
         ICM   R1,B'0011',SWAPPG       SET PG TO PERM SWAP OUT    JCC
         SYSEVENT RESETPG,ASIDL=ASID                              JCC
         N     R1,=X'0000FF00'         IF THE SYSEVENT FAILED     JCC
         BNZ   SETSWAPE                TELL THE OPERATOR          JCC
         MVC   QDMSG+19(29),DOSWAP2    OTHERWISE TELL HIM WHAT    JCC
         B     SETSWAPA                YOU DID AND GET OUT        JCC
SETSWAP9 DS    0H                                                 JCC
         SLR   R1,R1                   NO, CLEAR REG 1            JCC
         ICM   R1,B'0011',OUCBSPG      SET PG TO PERM SWAP OUT    JCC
         SYSEVENT RESETPG,ASIDL=ASID                              JCC
         N     R1,=X'0000FF00'         IF THE SYSEVENT FAILED     JCC
         BNZ   SETSWAPE                TELL THE OPERATOR          JCC
         MVC   QDMSG+19(29),DOSWAP3    OTHERWISE TELL HIM WHAT    JCC
SETSWAPA DS    0H                                                 JCC
*        MODESET KEY=NZERO             RESET TO OLD KEY           JCC
         B     SETSWAP4                YOU DID AND GET OUT        JCC
SETSWAPE DS    0H                                                 JCC
         MVC   QDMSG+19(29),DOSWAP4    TELL THE OPERATOR THE SWAP JCC
         B     SETSWAPA                FAILED, AND GET OUT        JCC
         DROP  R5                                                 JCC
SETSWAPX OI    17(R5),X'00'        EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'COREZAP  COMMAND  --  SET CANC ROUTINE'
SETCANC  LA    R9,8           SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(14),=CL14'CANCELABLE'
         B     SETCANC2
         SPACE 1
SETCANC1 SR    R9,R9          SET UP FOR EXECUTE
         MVC   QDMSG+4(44),SWAPRMSG
         MVC   QDMSG+32(14),=CL14'NON-CANCELABLE'
         SPACE 1
SETCANC2 CLI   6(R3),C','     IS SYNTAX CORRECT
         BNE   ERROR          GIVE ERROR IF NOT
         LA    R3,7(0,R3)     POINT TO ASID
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
********************************************************************LMB
* THE CSCB ADDR IN THE ASCB POINTS TO THE INITIATOR CSCB FOR BATCH  LMB
* JOBS.  THE JOBNAME POINTERS IN THE ASCB (ASCBJBNI X'AC') AND      LMB
* (ASCBJBNS X'B0') POINT TO THE APPROPRIATE JOB STEP TASK AT        LMB
* CSCB+8 OR CSCB+X'10'.  IF POSSIBLE WE WILL USE THE JOBNAME        LMB
* POINTER TO GET TO THE CORRECT CSCB.                               LMB
********************************************************************LMB
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO                             LMB
********************************************************************LMB
* IF NON ZERO THEN THIS IS A BATCH JOB.  THE ASCB+AC POINTS TO      LMB
* CSCB+8 FOR THE JOBNAME                                            LMB
********************************************************************LMB
         BZ    JOBNM2              GET 2ND JOBNAME POSITION         LMB
         LA    R5,0(0,R4)          LOAD CSCB ADDR OF JOB (NOT INIT) LMB
         AH    R5,=H'-8'           BACK UP 8 BYTES TO START OF CSCB LMB
         B     SETCANMS            GO DO WTO                        LMB
JOBNM2   L     R4,176(0,R5)        JOBNAME POINTER                  LMB
         LTR   R4,R4               ZERO                             LMB
         BZ    OTHRCSCB            GET CSCB DIRECTLY FORM THE ASCB  LMB
         CLC   60(4,R5),=X'00000000' IS THERE A TSB IN THE ASCB?    LMB
         BNZ   JOBTSO              THERE'S A TSB, IT IS A TSO ASID  LMB
********************************************************************LMB
* NO TSB, SO IT IS A STARTED TASK.  THE ASCB+B0 POINTS TO           LMB
* CSCB+X'10' FOR THE JOBNAME.                                       LMB
********************************************************************LMB
         LA    R5,0(0,R4)          LOAD CSCB ADDR OF TASK (NOT INIT)LMB
         AH    R5,=H'-16'          BACK UP 16 BYTES TO START OF CSCBLMB
         B     SETCANMS            GO DO WTO                        LMB
********************************************************************LMB
* A TSB, SO THIS IS A TSO ASID.  THE ASCB+B0 POINTS TO              LMB
* CSCB+8 FOR THE JOBNAME.                                           LMB
********************************************************************LMB
JOBTSO   LA    R5,0(0,R4)          LOAD CSCB ADDR OF TASK           LMB
         AH    R5,=H'-8'           BACK UP 8 BYTES TO START OF CSCB LMB
         B     SETCANMS            GO DO WTO                        LMB
SETCANMS MVC   QDMSG+9(8),0(R4)    JOBNAME
         B     SETCANBT            GO SET BITS
OTHRCSCB L     R5,56(0,R5)         ASCB-CSCB ADDR (MAY BE INITIATOR)LMB
SETCANBT NI    7(R5),X'F7'         SET NON-CANCELABLE
         EX    R9,SETCANCX         SET CANCELABLE OR LEAVE NON-CANC
         B     PUTOUT
         SPACE 1
SETCANCX OI    7(R5),X'00'         EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'COREZAP  COMMAND  --  EXIT ROUTINE'
MEMTERM  LA    R3,5(0,R3)     POINT TO ASID
         MVC   QDMSG+4(44),EXITMSG
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LH    R8,ASID        SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         CALLRTM TYPE=MEMTERM,COMPCOD=3549,ASID=(R8)
         B     PUTOUT
         TITLE 'COREZAP  COMMAND  --  CHAP ROUTINE'
CHAP     LA    R3,5(0,R3)     POINT TO ASID
         MVC   QDMSG+4(44),CHAPMSG
         MVC   QDMSG+42(3),5(R3) DPRTY
         MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),5(R3)
         CLC   DOUBLE(3),=C'000'
         BNE   ERROR               NOT NUMERIC
         PACK  DOUBLE(8),5(3,R3)
         CVB   R8,DOUBLE
         ST    R8,SAVER8
         LA    R4,4           SET MAX LENGTH
         BAL   R8,PARMCVT     CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         L     R8,SAVER8
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   QDMSG+9(8),0(R4)    JOBNAME
         CH    R8,=H'255'          MAX DPRTY
         BH    ERROR               OVER, ERROR
         STC   R8,43(0,R5)         SET NEW DPRTY IN ASCB
         L     R5,144(0,R5)        OUCB ADDR
         STC   R8,26(0,R5)         SET NEW DPRTY IN OUCB
         B     PUTOUT
         TITLE 'COREZAP  COMMAND  --  ERROR ROUTINES'
         EJECT
SRBFAIL  DS    0H             SRB FAILED TO POST SO DUMP
         DC    H'0'
PUTOUT   BAL  R7,DISPLAY
RETURN   QSTOP
QUIT     QTILTR  1 REGISTER 1
         EJECT
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  DOR
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     DOR
*                                                                   DOR
DISPLAY  EQU   *                                                    DOR
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVI   QDMSG,C' '      BLANK LINE
         MVC   QDMSG+1(79),QDMSG
         BR    R7             RETURN TO MAINLINE...                 DOR
         SPACE 3
         EJECT
         LTORG
         DS    0F
SIZE     DC    AL1(241),AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
SWAPPG   DC    XL2'0005'                AXC-CBT                   JCC
         SPACE 3                                                  JCC
EXITMSG  DC    CL44'JOB  XXXXXXXX  TERMINATED BY CMD SUB-SYSTEM'
         SPACE 3
         DS    0F
CHAPMSG  DC    CL44'JOB  XXXXXXXX  HAS BEEN SET TO DPRTY= NNN'
         SPACE 3
         DS    0F
SWAPRMSG DC    CL44'JOB  XXXXXXXX  HAS BEEN SET '
         SPACE 3
DOSWAP1  DC    CL29'IS A NON-SWAPPABLE JOB       '                JCC
         SPACE 1                                                  JCC
DOSWAP2  DC    CL29'RESET TO PERMANENT SWAP OUT  '                JCC
         SPACE 1                                                  JCC
DOSWAP3  DC    CL29'RESET TO PREVIOUS VALUE      '                JCC
         SPACE 1                                                  JCC
DOSWAP4  DC    CL29'SWAP FAILED, RETRY COMMAND   '                JCC
STAEMSG  DC H'50'
         DC  CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
*                  12345678901234567890123456789012345678901234567890
*                           1         2         3         4         5
NOTVER   DC   H'17',CL17'DATA NOT VERIFIED'
SVCMSG1  DC   H'30',CL30'REQUEST COMPLETE - SET APFAUTH'
SVCMSG2  DC   H'29',CL29'REQUEST COMPLETE - SET NOAUTH'
ERRORM   DC   H'15',CL15'PARAMETER ERROR'
NOPARM   DC   H'20',CL20'REQUIRED PARM STRING'
UCBNFND  DC   H'24',CL24'UNIT SPECIFIED NOT FOUND'
SWAPOUT  DC   H'38',CL38'ADDRESS SPACE REQUESTED IS SWAPPED OUT'
DISTERR  DC   H'37',CL37'DISASTEROUS ERROR OCCURED IN SRB MODE'
XMPTERR  DC   H'24',CL24'CROSS-MEMORY POST FAILED'
SRBPGERR DC   H'26',CL26'ADDRESS SPACE PURGING SRBS'
         SPACE 3                                                  JCC
         DROP  R12,R13
         TITLE 'COREZAP  COMMAND  --  SRB MODE CODE'
D#SRBCD  DS    0D
*
*        THIS CODE PERFORMS THE FOLLOWING FUNCTIONS
*              1 ESTABLISHES AN FRR FOR ERROR RECOVERY
*              2 VERIFIES THAT THE ADDRESSES THAT ARE NEEDED DO
*                EXIST.
*              3 PERFORM THE MODIFICATION IF ALLOW AND NECESSARY
*              4 SAVE THE PROPER CORE FOR DUMPING.
*              5 CROSS-MEMORY POST THE MAIN COMMAND PROCESSOR
*
         USING WORK,R8
         USING D#SRBCD,R7
         LR    R8,R1          SET THE MAIN PARM DSECT
         LR    R7,R15         SET THE BASE REGISTER
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         TM    FLAG1,FG1SUBR  IS THIS A SUBROUTINE CALL
         BO    D#SRB1         YES SO SKIP FRR
         LA    R5,D#FRRCD     POINT AT FRR CODE
         SETFRR  A,FRRAD=(R5),WRKREGS=(2,3),PARMAD=(R4)
         ST    R4,FRRPRMS     SAVE ADDR OF FRRPRMS
*
*        NOW INIT THE FRR PARM AREA AND VALIDATE THE INPUT ADDR
*
D#SRB1   L     R2,FRRPRMS     ACCESS THE 6 WORK PARM AREA
         STM   R7,R8,0(R2)    SAVE BASE AND WORK REGS
         MVI   0(R2),X'80'    SET VERIFICATION IN PROGRESS
         L     R1,ADDR        POINT AT CORE TO TROUBLE
         CLI   0(R1),0        ACCESS START OF AREA
         L     R3,LENGTH
         ALR   R3,R1          SUM THEN UP
         BCTR  R3,0           AND BACK DOWN ONE
         CLI   0(R3),0        DOES END EXIST ALSO
         MVI   0(R2),0        SET VERIFICATION FLAG OFF
         TM    FLAG1,FG1DUMP  IS IT DUMP REQUEST
         BO    D#SRB3         GO SETUP DUMP
         CLC   0(4,R1),ALTVER DOES THE INPUT VERIFY
         BE    D#SRB2         B IF YES
         MVI   FLAG2,FG2NVER  SET NOT VERIFY
         B     D#SRB3         GO AND DUMP IT
D#SRB2   MVC   0(4,R1),ALTREP DO MODIFICATION
*
*        NOW ADJSUST THE ADDR OF DUMP
*
D#SRB3   SRL   R1,4
         SLL   R1,4           ADJUST ADDR SO IT IS ON BOUNDARY
         ST    R1,ADDR        SAVE IT FOR PRINTING
         L     R2,LENGTH      GET LENGTH TO DUMP
         BCTR  R2,0
         EX    R2,D#SRBMVC    MOVE THE DATA INTO WORK
*
*        NOW WE TERMINATE PROCESSING BY DOING A CORSS
*        MEMORY POST IF NOT IN SUBROUTINE MODE
*
FRRRTY   TM    FLAG1,FG1SUBR  IS THIS SUBROUTINE MODE
         BO    D#EXIT         IF SO THEN EXIT
         SETFRR  D,WRKREGS=(2,3)
FRRPOST  L     R10,=A(X'40000000') SET CODE FOR POST
         LR    R9,R8          SAVE WORK POINTER IN SAFE REG
         LA    R11,ECB        ADDR OF ECB TO POST
         ICM   R11,8,=X'80'   FLAG AS XMPOST
         LA    R12,D#POSTR    SET POST ERROR RETURN
         L     R13,MYASCB     ASCB TO POST
         L     R15,CVTPTR     POINT AT CVT
         L     R15,CVT0PT01-CVTMAP(R15)    GET POST ENTRY POINTR
         BALR  R14,R15        GO DO POST
         DROP  R7             KILL MAIN ADDRESS
         USING *,R14          SET TEMP BASE
D#PRTN   LR    R8,R9          RESET BASE OF WORK
         SL    R14,=A(D#PRTN-D#SRBCD)  NOW HAVE CORRECTED BASE
         LR    R7,R14         SET TO PROPER REG
         DROP  R14
         USING D#SRBCD,R7     RESET MAIN BASE
         OI    FLAG1,FG1SRDN  FLAG SRB AS COMPLETED
D#EXIT   L     R14,ASRBRTN    RESTORE RETURN ADDR
         BR    R14            EXIT
D#SRBMVC MVC   ALTVER(0),0(R1)  MOVE IN THE DATA TO DUMP
         SPACE 5
*
*        POST ERROR ROUTINE  .. FLAG ERROR AND LET TIMER
*        WAKE UP COMM TASK
*
D#POSTR  LR    R8,R9          RESET WORK BASE
         OI    FLAG2,FG2PSTR  FLAG POST ERROR
         BR    R14            RETURN TO D#PRTN
         TITLE 'COREZAP  COMMAND  --  FRR FOR THE SRB MODE'
D#FRRCD  DS    0D
         L     R2,0(R1)       POINT AT PARM AREA
         LM    R7,R8,0(R2)    SET BASE REGS
         TM    0(R2),X'80'    ARE WE IN VALIDATION
         BZ    D#FRR1         NOPE
*
*        VALIDATION ERROR
*
         OI    FLAG2,FG2IVLD  SET FLAG FOR MESSAGE
         SETRP RECORD=NO,RC=4,RETADDR=FRRRTY,REGS,DUMP=NO,             X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         SPACE 5
*
*        ALL OTHER ERRORS
*
D#FRR1   OI    FLAG2,FG2ERRR  SET FLAG FOR MESSAGES
         SETRP RECORD=YES,RC=4,RETADDR=FRRRTY,REGS,DUMP=YES,           X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         TITLE 'COREZAP  COMMAND  --  RESOURCE MANAGER CLEANUP'
*
*        THIS ROUTINE RECEIVES CONTROL IF THE SRB MUST BE
*        PURGED.
*
D#RMTR   DS    0H
         USING *,R15
         LR    R7,R15         SET BASE REGISTER
         SL    R7,=A(D#RMTR-D#SRBCD)   BY COMPUTATION
         DROP  R15
         USING D#SRBCD,R7
         LR    R8,R2          SET UP POINTER TO WORK
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         OI    FLAG2,FG2PURG  SET PURGED
         B     FRRPOST        GO AND POST TO CLEAN UP
         LTORG
         TITLE 'COREZAP  COMMAND  --  DSECTS'
         PRINT GEN
         CVT DSECT=YES
         EJECT
         IHAASVT
         EJECT
         IHAASCB
         EJECT
         IHAFRRS
         EJECT
         IHAPSA
         EJECT
         IHASDWA
         EJECT
         IHASRB
         EJECT
         IHARB
         EJECT
         IRAOUCB                                                  JCC
         EJECT                                                    JCC
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKSTRT DS    0D
SAVRET   DS    18F
         DS    0D
DOUBLE   DS    2F
PLINES   DS    F
SAVER8   DS    F
PST      STAE  PST,CT,MF=L
DMYPRMS  DS    6F             DUMMY AREA FOR FRR PARMS FOR SUBR MODE
FRRPRMS  DS    F              ADDRESS OF 6 WORD FRR PARM
ASRBRTN  DS    F              RETURN ADDR FOR SRB CODE
MYASCB   DS    F              ASCB ADDR OF MAIN ROUTINE
MYTCB    DS    F              TCB ADDRESS FOR MAIN ROUTINE
TOASCB   DS    F              ASCB ADDR OF SRB ROUTINE
ECB      DS    F              ECB FOR MAIN ROUTINE TO WAIT ON
ECB2     DS    F              ECB FOR STIMER TO POST
ECBLIST  DS    2F
LENGTH   DS    F              LENGTH OF STORAGE TO DUMP
SRBAREA  DS    ((SRBSIZE+3)/4)F  THE SRB ITSELF
ADDR     DS    F              ADDRESS TO PROCESS AT
ALTREP   DS    F              REPLACEMENT VALUE
ALTVER   DS    F,252C         SPACE FOR VER DATA AND DUMP DATA
ASID     DS    H              ASID OF TOASCB
CZAPFLAG DS    X
FLAG1    DS    X
FG1DUMP  EQU   X'80'
FG1REP   EQU   X'40'
FG1SRDN  EQU   X'02'          IF ON SRB HAS TERMINATED
FG1SUBR  EQU   X'01'
FLAG2    DS    X
FG2NVER  EQU   X'01'          VERIFICATION FAILED
FG2IVLD  EQU   X'02'          VALIDATION FAILED
FG2ERRR  EQU   X'04'          DISASTER OCCURED IN SRB
FG2PURG  EQU   X'08'          SRB WAS PURGED
FG2PSTR  EQU   X'10'          IF ON THEN SRB POST HAD ERROR
WORKEND  DS    0F
         END
./       ADD   NAME=CPDDB
CPDDB    TITLE 'QUEUE COMMAND - LIST PDDBS FOR A JOB'             ONL01
CPDDB    QSTART HASPEQU=YES,       START CPDDB ASSEMBLY           DOR **
               XTITLE='QUEUE COMMAND - LIST PDDBS FOR A JOB'
***********************************************************************
*                                                                     *
*        PDDB JOBNAME <PDDB#>                                         *
*                                                                     *
* DISPLAY LIMITED INFORMATION ABOUT ALL OF THE PDDB'S FOR A JOB       *
*                                                                     *
* IF THE OPTIONAL PDDB NUMBER IS SPECIFIED, ONLY THAT PDDB WILL       *
* BE DUMPED IN HEX.                                                   *
*                                                                     *
***********************************************************************
         GBLB  &QJTIP             JTIP OPTION, DEFINED BY QSTART
         GBLB  &QSP133             SP 1.3.3 OPTION                UF046
         GBLB  &QSP136             SP 1.3.6 OPTION                DOR
         GBLB  &QSP                SP 1.3.X OPTION                CL007
         USING QCKPT,R10          BASE REG FOR CHECKPONT WORK AREA
         L     R10,QVCKPT         LOAD BASE REG
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13           BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JCT                                    *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB)    ADDR OF MODULE TO FIND JOB
         BALR  R14,R15            GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAPDDB            PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   FIND ALL PDDBS FOR THIS JOB                                       *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A
         USING PDB,R2            BASE REG FOR PDDB DOR
         AGO   .X136A
.NO136A  ANOP
         USING PDBDSECT,R2        BASE REG FOR PDDB
.X136A   ANOP
         MVC   QDHLINE,HEADING    SET HEADING LINE
         MVI   SWITCH,0           CLEAR FLAG BYTE
         L     R3,QCIOTA          LOAD BASE REG
         LR    R5,R3              IOAREA FOR READ IOT BLOCK
         AIF   (NOT &QSP136).NO136B
         SH    R3,=AL2(IOTSTART-IOT)      ADJUST FOR HEADER       DOR
         USING IOT,R3             BASE REG FOR IOT                DOR
         AGO   .X136B
.NO136B  ANOP
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
         USING IOTDSECT,R3        BASE REG FOR IOT                UF046
.X136B   ANOP
         AIF   (NOT &QSP133).C29A1                                UF046
         L     R1,QCJQEA          ADDRESS OF JQE                  UF046
         AIF   (NOT &QSP136).NO136C
         USING JQE,R1             SET TEMP ADDRESSING             DOR
         TM    JQEFLAG3,JQE3SYSD  JQETRAK POINT TO IOT?           DOR
         AGO   .X136C
.NO136C  ANOP
         USING JQEDSECT,R1        SET TEMP ADDRESSING             UF046
         TM    JQEFLAG3,QUESYSDS  JQETRAK POINT TO IOT?           UF046
.X136C   ANOP
         BZ    READJCT            NO, SKIP THIS CODE              UF046
         OI    SWITCH,1            SKIP SPIN IOT'S                UF046
         L     R4,JQETRAK          ADDRESS OF FIRST IOT           UF046
         B     READIOT             READ FIRST IOT                 UF046
READJCT  DS    0H                                                 UF046
.C29A1   ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136D
         USING JCT,R1            SET TEMP ADDRESSING             DOR
         AGO   .X136D
.NO136D  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             ONL16
.X136D   ANOP
         L     R1,QCJCTA          POINT TO JCT
         L     R4,JCTIOT          FIRST IOT ADDRESS
         DROP  R1                 DROP TEMP ADDRESSING
READIOT  DS    0H                                                 UF046
         BAL   R8,READ            READ THE IOT
         SPACE 1
         LH    R6,QLNG2           WAS A PDDB SPECIFIED?
         LTR   R6,R6
         BZ    NEXTIOT            NO, PROCEED NORMALLY
         BCTR  R6,0               DROP FOR EXECUTES
         MVC   QFZONES,QFZONE     PREPARE FOR NUMERIC TEST
         EX    R6,MVZ             MOVE ZONES FOR TEST
         CLC   QFZONES,QFZONE     ALL NUMERIC?
         BNE   TILT               NO, SKIP IT
         EX    R6,PACK            PACK TO DWORD
         CVB   R6,CONVERT         GET PDDB NUMBER
         OI    SWITCH,X'02'       AND INDICATE FOR LATER
         SPACE 1
NEXTIOT  LR    R4,R3              BASE OF IOT
         CLC   IOTID,=CL4'IOT'    WAS AN IOT READ FROM SPOOL ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         CLC   QPJOBID,IOTJBKEY   IS THE IOT'S JOB KEY VALID ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         LR    R2,R3              BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB            ADD OFFSET TO FIRST PDDB     UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1         OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
PDDBLOOP LH    R0,PDBDSKEY        GET THE DSID
         AIF   (NOT &QSP).CL007A                                  CL007
         TM    PDBFLAG3,PDB3PLHD   IGNORE PDDB IF                 CL007
         BO    NEXTPDDB             IT IS A PLACE HOLDER          CL007
.CL007A  ANOP  ,                                                  CL007
         TM    SWITCH,X'02'       ONLY WANT ONE PDDB?
         BZ    PDDBLP1            NO, SKIP SPECIAL TEST
         CR    R0,R6              FOUND RIGHT PDDB?
         BNE   NEXTPDDB           NO, TRY NEXT ONE
         LR    R1,R2              POINT TO PDDB
         LA    R0,PDBLENG         LENGTH OF PDDB
         L     R15,=V(HEXDUMP)    POINT TO DISPLAY ROUTINE
         BALR  R14,R15            AND LINK TO IT
         B     NEXTPDDB           JUST INCASE MULTIPLE PDDBS (SYSLOG)
         SPACE 1
PDDBLP1  MVC   QDMSG,QBLANK       BLANK WORK LINE AREA
         LTR   R0,R0              TEST FOR NULL PDDB#
         BZ    NEXTPDDB           SKIP IF SO
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSID-4(8),ED8      MOVE EDIT PATTERN TO DISPLAY
         ED    DSID-4(8),CONVERT+4  EDIT THE DSID
         UNPK  DSFLAG1(3),PDBFLAG1(2)  HEX OF FLAG BYTE
         TR    DSFLAG1,HEXTAB     MAKE PRINTABLE
         MVI   DSFLAG1+2,C' '     CLEAR TRASH BYTE
         L     R0,PDBRECCT        GET THE RECORD COUNT
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSRECCT,ED8        MOVE EDIT PATTERN TO DISPLAY
         ED    DSRECCT,CONVERT+4  EDIT THE RECORD COUNT
         MVC   DSCLASS,PDBCLASS   MOVE PDBCLASS TO DISPLAY
         UNPK  DSMTTR(9),PDBMTTR(5)  UNPACK MTTR TO DISPLAY
         TR    DSMTTR,HEXTAB      MAKE PRINTABLE
         MVI   DSMTTR+9,C' '      CLEAR JUNK BYTE
         AIF   (NOT &QSP133).C29C                                 UF046
         MVC   DS#PROC,PDBPNAME   SET PDDB PROC NAME              UF046
         MVC   DS#STEP,PDBSNAME   SET PDDB STEP NAME              UF046
         MVC   DS#DDNM,PDBDDNAM   SET PDDB DD NAME                UF046
         AGO   .JTIP1              SKIP JTIP CODE                 UF046
.C29C    ANOP                                                     UF046
         AIF   (NOT &QJTIP).JTIP1
         MVC   DS#PROC,PDB#PROC   SET JTIP PROC NAME
         MVC   DS#STEP,PDB#STEP   SET JTIP STEP NAME
         MVC   DS#DDNM,PDB#DDN    SET JTIP DD NAME
.JTIP1   ANOP
         MVC   QDMLNG,=H'80'      SET THE LENGTH
         LA    R0,QDMSG           POINT TO MESSAGE
         ST    R0,QDMSGA          SET IN AREA
         L     R15,=V(DISPLAY)    POINT TO DISPLAY ROUTINE
         BALR  R14,R15            LINK TO IT
NEXTPDDB LA    R2,PDBLENG(R2)     POINT TO NEXT PDDB
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB
         BL    PDDBLOOP           NO. KEEP TRYING
         L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    SPINIOT            NO. TRY THE SPIN IOT.
         BAL   R8,READ            READ THE IOT
         B     NEXTIOT            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136E
         USING JCT,R1            SET TEMP ADDRESSING             DOR
         AGO   .X136E
.NO136E  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             ONL16
.X136E   ANOP
SPINIOT  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY
         BO    STOP               YES, DONE
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         B     SPIN               SEARCH THE SPIN IOT CHAIN
         DROP  R1
STOP     QSTOP                    GO BACK TO CALLER
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK          STORE DISK ADDR
         LR    R1,R5              IOAREA ADDRESS
         L     R15,=V(READSPC)    ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15            GO TO IT
         BR    R8                 RETURN TO CALLER
ED8      DC    X'4020202020202120'
MVZ      MVZ   QFZONES(1),QPARM2
PACK     PACK  CONVERT,QPARM2(1)
HEXTAB   EQU   *-X'F0'
         DC    C'0123456789ABCDEF'
TILT     QTILT 'INVALID PDDB# SPECIFIED'
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
HEADING  DC    CL80' '
         ORG   HEADING            POINT TO START OF AREA
         DC    C'    DSID'
         DC    C' F1'             FLAG BYTE 1
         DC    C'  RECORDS'
         DC    C' C'              CLASS
         DC    C'   MTTR  '       MTTR
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP2                    UF046
         DC    C' PROCNAME'
         DC    C' STEPNAME'
         DC    C' DDNAME  '
.JTIP2   ANOP
         ORG   ,                  BACK TO NORMAL ADDRESSING
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
CPDDB    CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136F
         IFGRPL  DSECT=YES,AM=VTAM
         AGO   .X136F
.NO136F  ANOP
JCT      EQU   0
.X136F   ANOP
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $JQE                                                     UF046
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    CL4
DSID     DS    CL4
         DS    CL1
DSFLAG1  DS    CL2
         DS    CL1
DSRECCT  DS    CL8
         DS    CL1
DSCLASS  DS    CL1
         DS    CL1
DSMTTR   DS    CL8
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP3                    UF046
         DS    CL1
DS#PROC  DS    CL8
         DS    CL1
DS#STEP  DS    CL8
         DS    CL1
DS#DDNM  DS    CL8
.JTIP3   ANOP
WORK     DSECT
         DS    CL72
SWITCH   DS    C
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CPFK
CPFK     TITLE 'QUEUE COMMAND - LIST / CHANGE PFK DEFINITIONS'    ONL01
CPFK     QSTART ,                  START CPFK CSECT ASSEMBLY      ONL01
         USING QDISPLAY,R9
         L     R9,QVDSPL           LOAD BASE REG FOR DISPLAY AREA
         USING WORK,R13            BASE FOR SAVE / WORK AREA
         LH    R1,QLNG1            WAS A PARM PASSED?
         LTR   R1,R1
         BZ    PFKDISP             NO, GO DISPLAY CURRENT DEFNS
         SPACE 1
*        CHANGE THE CURRENT SETTING FOR THE PFK DEFINED BY QPARM1
         SPACE 1
         LH    R2,QLNG1            LENGTH OF DATASET ID FIELD
         SH    R2,=H'1'            IS THE DATASET ID FIELD ZERO LENGTH?
         BM    TILT                YES. QUIT.
         MVC   QFZONES,QFZONE      INITIALIZE NUMERIC TEST
         EX    R2,MVZ              MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE      IS THE FIELD NUMERIC?
         BNE   TILT                NO. QUIT.
         EX    R2,PACK             PACK THE FIELD
         CVB   R2,DWORD            CONVERT TO BINARY
         LA    R15,QDREPLY         POINT TO REPLY AREA
         AH    R15,QOFF2           ADD OFFSET PAST PFK NUMBER
         BCTR  R2,0                RELATIVE PFK NUMBER
         SLL   R2,3                TIME LENGTH OF AN ENTRY
         LA    R1,QDPFKTAB(R2)     POINT TO TABLE ENTRY
         MVC   0(8,R1),0(R15)      SET NEW DEFINITION
         SPACE 1
*        DISPLAY THE CURRENT PFK DEFINITIONS
PFKDISP  MVC   QDHLINE,HEADING     SET HEADING
         LA    R2,QDPFKTAB         POINT TO TABLE
         LA    R3,1                FIRST ENTRY
         LA    R4,12               NUMBER OF ENTRIES
DISPLOOP MVC   QDMSG,QBLANK        BLANK THE OUTPUT LINE
         MVC   QDMSG+1(4),=X'40202120' SET MASK
         CVD   R3,DWORD            PFK NUMBER TO DECIMAL
         ED    QDMSG+1(4),DWORD+6  SET IN MESSAGE
         LR    R15,R3              GET PFK NUMBER
         BCTR  R15,0               DROP BY ONE
         SLL   R15,3               TIMES 8
         AR    R15,R2              POINT TO PFK TEXT
         MVC   QDMSG+8(8),0(R15)   COPY TEXT
         LA    R0,QDMSG            POINT TO MESSAGE
         ST    R0,QDMSGA           SAVE MSG POINTER
         MVC   QDMLNG,=H'80'       SET MESSAGE LENGTH
         L     R15,=V(DISPLAY)     WRITE THE
         BALR  R14,R15               MESSAGE
         LA    R3,1(,R3)           BUMP TO NEXT VALUE
         BCT   R4,DISPLOOP         LOOP FOR ALL PFK'S
         SPACE 1
PUTHELP  MVC   QDMLNG,=H'80'   SET MSG LENGTH
         LA    R2,PFKHMN       NUMBER OF LINES
         LA    R3,PFKHM        START OF TEXT AREA
PUTHELP1 ST    R3,QDMSGA       SET MESSAGE ADDRESS
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY ROUTINE
         BALR  R14,R15         LINK TO ROUTINE
         LA    R3,80(,R3)      POINT TO NEXT LINE
         BCT   R2,PUTHELP1     LOOP TILL DONE
         SPACE 1
         QSTOP
TILT     QTILT '*** PFK NUMBER IS INVALID ***'
MVZ      MVZ   QFZONES(*-*),QPARM1 CHECK FOR NUMERIC
PACK     PACK  DWORD,QPARM1(*-*)   CONVERT TO BINARY
HEADING  DC    CL80' PFK CURRENT DEFINITIONS'
PFKHM    EQU   *
 DC CL84' '
 DC CL80'TO SPECIFY OPERANDS (FOR PF5, AND OPTIONALLY FOR PF6, 9, 12),'
 DC CL80'OR TO TEMPORARILY OVERRIDE THE DEFAULTS (FOR PF7, 8, 10, 11),'
 DC CL80'KEY IN THE VALUE AND PRESS THE APPROPRIATE PF KEY.'
 DC CL80' '
 DC CL80'TO REDEFINE A PFK, ENTER "PFK # TEXT"'
 DC CL80'  WHERE # IS THE PFK NUMBER AND TEXT IS THE DESIRED STRING'
 DC CL4' '
PFKHMN   EQU   (*-PFKHM)/80    NUMBER OF MESSAGES
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    18F
DWORD    DS    D                   SCRATCH DOUBLE WORD
         END
./       ADD   NAME=CSPIN
CSPIN    TITLE 'QUEUE COMMAND - SPIN A COPY OF CURRENT DATASET'   ONL01
CSPIN    QSTART HASPEQU=YES,       START CSPIN CSECT ASSEMBLY     DOR XX
               XTITLE='QUEUE COMMAND - SPIN A COPY OF CURRENT DATASET'
         GBLB   &QSP136       SP 1.3.6 OPTION                     DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   ALLOCATE OUTPUT DATASET                                           *
*                                                                     *
***********************************************************************
         CLC   QPDSID,=H'0'   IS THERE A VALID DATASET?
         BE    TILT1          NO. TELL THE USER.
         MVC   DA30DDN,=CL8'HASPSAVE'  SET DDNAME
         MVI   DA30OCLS,C'A'  SYSOUT=A
DSALLOC  MVI   DAIRFLAG,X'30' INDICATE ALLOC FUNCTION
         L     R15,=V(ALLOCATE) ADDR OF DAIR MODULE
         BALR  R14,R15        GO TO IT
         MVC   QCOUT+36(1),QCRECFM MOVE IN RECORD FORMAT
         NI    QCOUT+36,X'06' TURN OFF EVERTHING BUT CCTL
         OI    QCOUT+36,X'90' SPECIFY FIXED BLOCKED RECORDS
         LH    R1,QCLRECL     RECORD LENGTH
         LTR   R1,R1          IS THE LRECL ZERO?
         BNZ   RECOK          NO. SKIP.
         LA    R1,133         YES. USE LRECL 133.
RECOK    STH   R1,QCOUT+82    STORE LRECL
         STH   R1,QCOUT+62    AND BLKSIZE
         OPEN  MF=(E,QCOPEN)
***********************************************************************
*                                                                     *
*   REPOSITION DATASET TO TOP                                         *
*                                                                     *
***********************************************************************
         L     R4,QCSTART     TOP OF DATASET POINTER
         L     R4,0(R4)       DISK ADDR TOP OF DATASET
         L     R5,QCBLKA      IOAREA ADDRESS
         B     FIRST          GO DO IT
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID(6),4(R5) DOES THE JOBID MATCH?
         BE    IDISOK              BR IF SO                          CL
         L     R4,QCJQEA           ADDR OF JQE                       CL
         AIF   (NOT &QSP136).NO136A
         USING JQE,R4                                               DOR
         TM    JQEFLAG3-JQE(R4),JQE3SYSD ALL THRU IF THIS    DOR
         AGO   .X136A
.NO136A  ANOP
         TM    QUEFLAG3(R4),QUESYSDS ALL THRU IF THIS                CL
.X136A   ANOP
         BNO   END                    IS NOT SYSTEM JQE              CL
         CLC   QPJOBID,4(R5)           ELSE COMPARE JOB KEY ONLY     CL
         BNE   END            NO. END OF DATASET.
IDISOK   LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK          CL
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         TM    1(R4),X'80'    IS CCTL SPECIFIED?
         BZ    NOCCTL         NO. SKIP.
         LA    R6,1(R6)       INCREMENT LENGTH FOR CCTL
NOCCTL   TM    1(R4),X'08'    IS THIS RECORD TO BE IGNORED?
         BO    SKIPREC        YES. SKIP IT.
         MVI   BUFFER,C' '    BLANK FIRST BYTE OF BUFFER
         MVC   BUFFER+1(255),BUFFER BLANK THE BUFFER
         LR    R7,R6          DO NOT DESTROY R6
         SH    R7,=H'1'       IS LENGTH ZERO?
         BM    SKIPREC        YES. SKIP RECORD.
         EX    R7,MVCREC      MOVE RECORD TO BUFFER
         PUT   QCOUT,BUFFER
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       SEGMENT LENGTH
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE LARGER HEADER SIZE.
         LA    R4,4(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
***********************************************************************
*                                                                     *
*   CLOSE UP SHOP AND GO HOME                                         *
*                                                                     *
***********************************************************************
END      CLOSE MF=(E,QCOPEN)
         MVC   DA18SCLS,DA30OCLS  COPY SYSOUT CLASS FOR FREE
         MVI   DAIRFLAG,X'18' INDICATE FREE FUNCTION
         L     R15,=V(ALLOCATE) ADDR OF DAIR MODULE
         BALR  R14,R15        GO TO IT
         L     R15,=V(LISTDS) GO BACK TO LISTDS
         BALR  R14,R15        GO TO IT
         QSTOP
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
TILT1    QTILT '*** YOU ARE NOT PROCESSING A VALID DATASET ***'
         LTORG
         AIF  (&QSP136).XSP136
MVCREC   MVC   BUFFER+1(1),3(R4)  KILL ASA
         AGO   .NOSP136
.XSP136  ANOP
MVCREC   MVC   BUFFER(1),3(R4)  KILL ASA
.NOSP136 ANOP
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         $JQE                                                        CL
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    CL80
BUFFER   DS    CL256
         END
./       ADD   NAME=CSYS
CSYS     QSTART 'QUEUE COMMAND - SYSTEM COMMANDS'
         GBLB   &QISPF
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         SPACE 1                                                  UF003
         LA    R8,4095(R11)
         LA    R8,1(,R8)
         USING QCOMMON+4096,R8
GO       LH    R1,QCODEH      LOAD FUNCTION CODE
         CH    R1,=H'8'       IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     TILT           0 OFFSET
         B     CSYS1          4
         B     TILT           8      FUTURE COMMANDS
         B     TILT           12
         B     TILT           16
         B     TILT           20
         B     TILT           24
         B     TILT           28
         B     TILT           32
TILT     QTILT '*** PARAMETER IS INVALID OR OMITTED ***'
***********************************************************************
*                                                                     *
*   CREATE OPERATOR COMMAND STRING FROM QUEUE                         *
*                                                                     *
***********************************************************************
CSYS1    EQU   *
         CLI   QPARM1,C' '    IS THERE A PARAMETER?
         BE    CSERR          NO. CNO PARM ITS ERROR
         MVI   QPOPRD,C' '
         MVC   QPOPRD+1(79),QPOPRD
         LA    R3,61          MAXIMUM LENGTH OF PARM
         LA    R2,QDREPLY     ADDR OF REPLY + 1
         AH    R2,QOFF1       ADDR OF FIRST BYTE OF PARM
         EX    R3,MVC         MOVE PARM TO QPFIND
         STH   R3,QPLNG       SAVE LENGTH-1 OF PARM
         STH   R3,QPOPRL      SAVE LENGTH-1 OF PARM
         LA    R3,0
         CLC   QPOPRD(1),=C'$'
         BE    CSYS$
         L     R3,=F'1'
CSYS$    ST    R3,QPOPRN
         LA    R3,QPOPRN
         ST    R3,QPOPR2
         OI    QPOPR2,X'80'
         LA    R3,QPOPRL
         ST    R3,QPOPRA
         B     CSSVC34        TEST IF COLUMN KEYWORD IS PRESENT
MVC      MVC   QPOPRD(1),0(R2) MOVE PARM TO QPOPRD
* -----------------------------------------------------------
CSSVC34  EQU   *
         SETAUTH  ON
         LA    R1,QPOPRA      LOAD OPER PARM LIST POINTER
         LINK  EP=COMMAND TREAT BOTH AS SVC34 AND WTO
         SETAUTH  OFF
         QTILT '*** SYSTEM CONSOLE COMMAND WAS ISSUED ***'
CSERR    QTILT '*** STRING IS INVALID OR OMITTED ***'
STOP     QSTOP
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    CL72
COUNT    DS    D
         END
./       ADD   NAME=CTGPS
CTGPS    TITLE 'QUEUE COMMAND - LIST JOB WITH MOST TRACK GROUPS'  ONL01
CTGPS    QSTART HASPEQU=YES,       START CTGPS CSECT ASSEMBLY      DORXX
               XTITLE='QUEUE CMD - LIST JOB WITH MOST TRACK GROUPS'
         GBLB  &QSP                MVS/SP OPTION
         GBLB  &LOCK               LOCKHEED OPTIONS                  CL
         GBLB  &QSP133             JES2 SP 1.3.3 SWITCH           CL001
         GBLB  &QSP136             JES2 SP 1.3.6 OPTION FLAG        DOR
         AIF   (&QSP).SPOK
         QTILT 'TGPS COMMAND ONLY SUPPORTED UNDER SP VERSION OF QUEUE'
.SPOK    ANOP
         USING QCKPT,R10           BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT          LOAD BASE REG
         USING QDISPLAY,R9
         L     R9,QVDSPL           ADDRESSING FOR DISPLAY AREA
         USING WORK,R13            LOCAL WORK AREA
*        READ IN THE CHECKPOINT
         L     R15,=V(CKPT)        ADDR OF CKPT ROUTINE
         BALR  R14,R15             GO TO IT
*
         XC    JQEAREA(L'JQEAREA),JQEAREA CLEAR JQE AREA
         MVC   TGPSAREA,TGPSFMT    PRIME TRACK GROUPS ACCUMULATORS
         XC    TOTTGPS,TOTTGPS     CLEAR ACCUMULATOR
         XC    TOTJOBS,TOTJOBS     CLEAR ACCUMULATOR
         L     R1,QCJQTL           POINT TO HCT SAVEAREA
         USING $SAVEBEG,R1         SET ADDRESSING
         AIF   (NOT &QSP136).NO136A                                 DOR
         LA    R3,$JQHEADS-(JQENEXT-JQE) POINT TO FIRST QHEAD
         LA    R4,$JQHEADL         SIZE OF EACH QHEAD
         LA    R5,$JQHEADS-(JQENEXT-JQE)+($JQTYPES*$JQHEADL)-1
         DROP  R1                  DROP HCT ADDRESSING
NXTQHD   LR    R6,R3               POINT TO NEXT QHEAD
         USING JQE,R6         ADDRESSING FOR JQE
JQELOOP  L     R6,JQENEXT          GET CHAIN FIELD
         N     R6,=X'00FFFFFF'     TEST FOR END
         BZ    STEPQHD             BRANCH IF END OF CHAIN
         LR    R2,R6               SAVE OFFSET FOR TEST
         A     R6,QCJQTA           CALCULATE FULL ADDRESS
         LH    R2,JQETGNUM         NUMBER OF TRACK GROUPS            CL
         TM    JQEFLAG5,JQE5XUSD   BR IF NOT
         BNO   TGTEST               USING JQE EXTENSION
         AL    R2,QCJQEXA          COMPUTE ADDR OF EXTENSION
         LH    R2,$JEXTTGN(,R2)    TRACK GROUPS IN EXTENSION
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         LA    R3,$JQHEADS-QUENEXT POINT TO FIRST QHEAD
         LA    R4,$JQHEADL         SIZE OF EACH QHEAD
         LA    R5,$JQHEADS-QUENEXT+($JQTYPES*$JQHEADL)-1 END OF HEADS
         DROP  R1                  DROP HCT ADDRESSING
NXTQHD   LR    R6,R3               POINT TO NEXT QHEAD
         USING JQEDSECT,R6         ADDRESSING FOR JQE
JQELOOP  L     R6,JQENEXT          GET CHAIN FIELD
         N     R6,=X'00FFFFFF'     TEST FOR END
         BZ    STEPQHD             BRANCH IF END OF CHAIN
         LR    R2,R6               SAVE OFFSET FOR TEST
         A     R6,QCJQTA           CALCULATE FULL ADDRESS
         AIF   (NOT &LOCK).NOTLOCK                                   CL
         LH    R2,JQEGROUP         NUMBER OF TRACK GROUPS            CL
         AGO   .LOCK1              SKIP UNNEEDED CODE                CL
.NOTLOCK ANOP  ,                                                     CL
         OC    JQETRAK,JQETRAK     ANY JCT/IOT?                   UF046
         BZ    JQELOOP             NO, SKIP THIS ONE              UF046
***********************************************************************
*                                                                     *
*   READ JCT AND IOT                                                  *
*                                                                     *
***********************************************************************
         ST    R6,QCJQEA           SAVE THE ADDRESS
         MVC   QCTRAK,JQETRAK      DISK ADDR OF JCT
         L     R1,QCJCTA           ADDR OF IOAREA FOR JCT
         LR    R7,R1               BASE FOR JCT
         USING JCTDSECT,R7         BASE REG FOR JCT               ONL16
         AL    R1,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
         L     R15,=V(READSPC)     ROUTINE TO READ HASPACE
         BALR  R14,R15             GO TO IT
         CLC   JCTID,=CL4'JCT'     WAS A JCT READ FROM SPOOL ?    ONL03
         BNE   JQELOOP             NO, SKIP THIS JQE              ONL03
         C     R2,JCTJQE           DOES JCT POINT TO THIS JQE?
         BNE   JQELOOP             NO, SKIP THIS JQE
         SR    R2,R2               CLEAR FOR COUNTER
         MVC   QPJOBID,JCTJBKEY    JOB IDENTIFICATION
         ICM   R15,15,JCTSPIOT     GET SPIN IOT ADDRESS
         BZ    IOTJOB              NONE, GET JOBS IOT
         USING IOTSTART,R7         ADDRESSING FOR IOT
SPIOTLP  ST    R15,QCTRAK          SET ADDRESS FOR READSPC
         BAL   R8,PROCIOT          PROCESS THE IOT
         ICM   R15,15,IOTIOTTR     POINT TO NEXT IOT
         BNZ   SPIOTLP             LOOP IF MORE IOTS
IOTJOB   L     R7,QCJCTA           RESTORE JCT ADDRESS
         USING JCTDSECT,R7         AND ADDRESSING
         ICM   R15,15,JCTIOT       GET MAIN IOT ADDRESS
         BZ    TGTEST              NONE, TEST COUNT OF TGPS
         ST    R15,QCTRAK          SET ADDRESS FOR READSPC
         BAL   R8,PROCIOT          PROCESS THE IOT
.LOCK1   ANOP                                                        CL
.X136A   ANOP                                                       DOR
TGTEST   LTR   R2,R2               TEST FOR TGPS
         BNP   JQELOOP             NONE, SKIP THIS JQE
         LR    R14,R2              NUMBER OF TRACK GROUPS
         A     R14,TOTTGPS         ADD TO ACCUMULATOR
         ST    R14,TOTTGPS         AND RESAVE
         LA    R14,1               BUMP TOTAL
         A     R14,TOTJOBS           NUMBER OF
         ST    R14,TOTJOBS             JOBS
         SPACE 1
         LA    R14,TGPSAREA+L'TGPSAREA-8 POINT TO LAST ENTRY
         LA    R15,(L'TGPSAREA/8)  NUMBER OF ENTRIES
         LA    R1,8                SIZE OF AN ENTRY
TGTST01  C     R2,0(R14)           COMPARE TRACK GROUPS WITH SLOT SIZE
         BNH   TGTST05             YES, INSERT IT HERE
         SR    R14,R1              BACK UP TO PREV ENTRY
         BCT   R15,TGTST01         LOOP THROUGH ELEMENTS
         B     TGTST99             NONE, SKIP INCREMENT
         SPACE 1
TGTST05  LA    R15,1               SET FOR INCREMENT
         A     R15,4(,R14)         INCREMENT COUNT
         ST    R15,4(,R14)         AND SAVE NEW COUNT
         SPACE 1
TGTST99  DS    0H
         LA    R14,JQEAREA+L'JQEAREA-8 POINT TO LAST ENTRY
         LA    R15,(L'JQEAREA/8)   NUMBER OF ENTRIES
         LA    R1,8                SIZE OF AN ENTRY
TGTST1   C     R2,4(R14)           SEE IF NEW IS BIGGER
         BNL   TGTINS              YES, INSERT IT HERE
         SR    R14,R1              BACK UP TO PREV ENTRY
         BCT   R15,TGTST1          LOOP THROUGH ELEMENTS
         B     JQELOOP             GO TRY NEXT JQE
         SPACE 1
TGTINS   BCTR  R15,0               DROP BY ONE
         SLL   R15,3               TIMES 8 (LENGTH OF ENTRY)
         BCTR  R15,0               DROP FOR EXECUTE
         LTR   R15,R15             TEST FOR VALID
         BNP   TGTNOMV             NO, JUST DO THE INSERT
         EX    R15,TGTMVC          MOVE ENTRIES DOWN
TGTNOMV  ST    R6,0(,R14)          SAVE JQE ADDRESS
         ST    R2,4(,R14)          SAVE # OF TRACK GROUPS
         B     JQELOOP             TRY NEXT JQE
         SPACE 1
TGTMVC   MVC   JQEAREA(*-*),JQEAREA+8    SLIDE ENTRIES DOWN
         SPACE 1
STEPQHD  BXLE  R3,R4,NXTQHD        STEP TO NEXT QHEAD
         DROP  R6                  DROP OLD JQE REG
         SPACE 1
         LA    R2,JQEAREA+L'JQEAREA-8 POINT TO LAST ENTRY
         LA    R3,(L'JQEAREA/8)    NUMBER OF ENTRIES
         LA    R4,8                SIZE OF EACH ENTRY
         MVC   QDHLINE,HEADING     SET HEADER LINE
         SPACE 1
PRNTJQE  L     R5,0(,R2)           JQE ADDRESS
         AIF   (NOT &QSP136).NO136B                                 DOR
         USING JQE,R5         ADDRESSING
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         USING JQEDSECT,R5         ADDRESSING
.X136B   ANOP                                                       DOR
         MVC   QDMSG,QBLANK        BLANK THE TEXT AREA
         LTR   R5,R5               ANY ADDRESS?                   UF046
         BZ    PRNTJQEN            NO, SKIP TRASH                 UF046
         LH    R0,JQEJOBNO         GET JOB NUMBER
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSGJOBID,ED         SET EDIT PATTERN
         ED    MSGJOBID,DWORD+4    SET JOB ID IN MESSAGE TEXT
         MVC   MSGJNAME,JQEJNAME   MOVE JOB NAME TO MESSAGE
         AIF   (NOT &QSP136).NO136C                                 DOR
         TM    JQEFLAG1,JQE1BUSY   SKIP IF JOB                    CL009
         BZ    PRNTJQEN             NOT BUSY                      CL009
         IC    R1,JQEFLAG1         SYSTEM BUSY                    CL009
         N     R1,=A(JQE1BUSY)      INDICATOR                     CL009
         SLL   R1,3                COMPUTE OFFSET INTO QSE TABLE  CL009
         LA    R1,QSYSID(R1)       ADDR OF SYSTEM BUSY            CL009
         MVC   MSGACT,0(R1)        INSERT INTO MESSAGE            CL009
         SPACE 1                                                  CL009
.NO136C  ANOP                                                       DOR
PRNTJQEN DS    0H                                                 UF046
         L     R0,4(,R2)           NUMBER OF TRACK GROUPS
         LR    R1,R0               SAVE FOR DIVIDE
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSG#TGPS,ED         SET EDIT PATTERN
         ED    MSG#TGPS,DWORD+4    SET IN MESSAGE
         AIF   (NOT &QSP133).CLNSP33                              CL001
         L     R15,QCTNUMTG        NUMBER OF ACTIVE TRACK GROUPS  CL001
         AGO   .CLSP33                                            CL001
.CLNSP33 ANOP                                                     CL001
         L     R15,QCJQTL          POINT TO HCT SAVE AREA
         USING $SAVEBEG,R15
         LH    R15,$NUMTG          NUMBER OF TRACK GROUPS
         DROP  R15
.CLSP33  ANOP                                                     CL001
         SR    R0,R0               CLEAR FOR DIVIDE
         MH    R1,=H'1000'
         DR    R0,R15              DIVIDE TO GET PERCENT OF TOTAL
         CVD   R1,DWORD            TO DECIMAL
         MVC   MSGTGPCT,EDPCT      SET EDIT MASK
         ED    MSGTGPCT,DWORD+6    SET PCT TO MESSAGE
         L     R0,TGPSAREA-JQEAREA(,R2) TRACK GROUP ACCUMULATOR
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSG$TGPS,ED         SET EDIT PATTERN
         ED    MSG$TGPS,DWORD+4    SET IN MESSAGE TEXT
         C     R0,TGPSFMT          IS THIS THE MAX VALUE?
         BNE   *+4+6               NO SKIP NEXT
         MVC   MSG$TGPS,=C'     MAX'  SET MORE REASONABLE VALUE
         L     R0,TGPSAREA-JQEAREA+4(,R2) NUMBER OF JOBS
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSG$JOBS,ED         SET EDIT PATTERN
         ED    MSG$JOBS,DWORD+4    SET IN MESSAGE TEXT
         LR    R1,R0               SAVE FOR DIVIDE
         SR    R0,R0               CLEAR FOR DIVIDE
         MH    R1,=H'1000'
         L     R15,TOTJOBS         GET TOTAL NUMBER OF JOBS
         DR    R0,R15              DIVIDE TO GET PERCENT OF TOTAL
         CVD   R1,DWORD            TO DECIMAL
         MVC   MSG$PCT,EDPCT       SET EDIT MASK
         ED    MSG$PCT,DWORD+6     SET PCT TO MESSAGE
         MVC   QDMLNG,=H'80'       SET MESSAGE LENGTH
         LA    R0,QDMSG            POINT TO MESSAGE AREA
         ST    R0,QDMSGA           SET IN AREA
         L     R15,=V(DISPLAY)     POINT TO OUTPUT ROUTINE
         BALR  R14,R15             LINK TO IT
         SPACE 1
         SR    R2,R4               MOVE TO NEXT ENTRY
         BCT   R3,PRNTJQE          PRINT ALL ENTRIES
         SPACE 1
         MVC   QDMSG,QBLANK        BLANK THE TEXT AREA
         MVC   MSGJNAME,=CL8'*TOTAL*'
         L     R0,TOTTGPS          TOTAL NUMBER OF TRACK GROUPS
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSG#TGPS,ED         SET EDIT PATTERN
         ED    MSG#TGPS,DWORD+4    SET IN MESSAGE
         L     R0,TOTJOBS          TOTAL NUMBER OF JOBS
         CVD   R0,DWORD            TO DECIMAL
         MVC   MSG$JOBS,ED         SET EDIT PATTERN
         ED    MSG$JOBS,DWORD+4    SET IN MESSAGE
         MVC   QDMLNG,=H'80'       SET MESSAGE LENGTH
         LA    R0,QDMSG            POINT TO MESSAGE AREA
         ST    R0,QDMSGA           SET IN AREA
         L     R15,=V(DISPLAY)     POINT TO OUTPUT ROUTINE
         BALR  R14,R15             LINK TO IT
         SPACE 1
STOP     QSTOP
         SPACE 1
         AIF   (&QSP136).X136X                                      DOR
         AIF   (&LOCK).LOCK2                                         CL
PROCIOT  L     R1,QCIOTA           ADDR OF IOAREA FOR IOT
         LR    R7,R1               POINT TO IOT AREA
         USING IOTSTART,R7         ADDRESSING FOR AREA
         L     R15,=V(READSPC)     ROUTINE TO READ HASPACE
         BALR  R14,R15             GO TO IT
         CLC   IOTID,=CL4'IOT'     WAS AN IOT READ FROM SPOOL ?   ONL03
         BNER  R8                  NO, SKIP THIS IOT              ONL03
         CLC   QPJOBID,IOTJBKEY    DOES JOB ID MATCH?
         BNER  R8                  NO, SKIP THIS IOT
         TM    IOTFLAG1,IOT1ALOC   IS THIS AN ALLOCATION IOT?
         BNOR  R8                  NO, SKIP PROCESSING IT
         LA    R1,IOTTGMAP         POINT TO ALLOCATION MAP
         LA    R1,TGMAP-TGMDSECT(,R1) POINT TO TRACK GROUP MAP
         L     R15,QCJQTL          POINT TO HCT SAVE AREA
         USING $SAVEBEG,R15        SET TEMP ADDRESSING
         LH    R15,$NUMTG          GET NUMBER OF TRACK GROUPS
         DROP  R15                 DROP ADDRESSING
         LA    R15,7(,R15)         ROUND TO MULTIPLE OF 8
         SRL   R15,3               DIVIDE BY 8
         LR    R0,R15              TO R0 FOR OUR USE
         SRL   R0,2                WORDS / MAP
TGIOTC1  ICM   R15,15,0(R1)        TEST FOR ANY ALLOCATED
         BNZ   TGIOTC3             YES, SEE HOW MANY
TGIOTC2  LA    R1,4(,R1)           TO NEXT WORD
         BCT   R0,TGIOTC1          LOOP FOR ALL WORDS
         BR    R8                  RETURN TO CALLER
TGIOTC3  LA    R14,32              BITS / WORD
TGIOTC4  LTR   R15,R15             TEST SIGN BIT
         BNM   *+8                 OFF, SKIP IT
         LA    R2,1(,R2)           BUMP ACCUMULATOR
         SLL   R15,1               TRY NEXT BIT
         BCT   R14,TGIOTC4         LOOP FOR ALL BITS
         B     TGIOTC2             TRY NEXT WORD
         DROP  R7
.LOCK2   ANOP                                                        CL
.X136X   ANOP                                                       DOR
         SPACE 1
ED       DC    X'4020202020202120' EDIT PATTERN
EDPCT    DC    X'4020214B21'       EDIT PATTERN FOR % SPOOL
*                   123456789 123456789 123456789 123456789 123456789 1
*              23456789 123456789 123456789.
*
*                   12345678 12345678 2345678 2345
*                       2345678 2345678 2345'
*
HEADING  DC    CL80'   JOBID JOBNAME     TGPS  PCT                     +
                           TGPS    JOBS  PCT'
         SPACE 1
         LTORG ,
         SPACE 1
TGPSFMT  DC    X'7FFFFFFF',F'0'
         DC    F'150',F'0'
         DC    F'100',F'0'
         DC    F'080',F'0'
         DC    F'060',F'0'
         DC    F'050',F'0'
         DC    F'040',F'0'
         DC    F'030',F'0'
         DC    F'020',F'0'
         DC    F'015',F'0'
         DC    F'010',F'0'
         DC    F'009',F'0'
         DC    F'008',F'0'
         DC    F'007',F'0'
         DC    F'006',F'0'
         DC    F'005',F'0'
         DC    F'004',F'0'
         DC    F'003',F'0'
         DC    F'002',F'0'
         DC    F'001',F'0'
         SPACE 1
WORK     DSECT
         DS    18F                 SAVE AREA
         DS    18F                 SCRATCH SPACE
DWORD    DS    D                   SCRATCH DOUBLE WORD
TOTTGPS  DS    F                   TOTAL TRACK GROUPS ALLOCATED
TOTJOBS  DS    F                   TOTAL NUMBER OF JOBS PROCESSED
JQEAREA  DS    XL(20*8)            20 ENTRIES (JQEADDR, #TGPS)
TGPSAREA DS    XL(20*8)            20 ENTRIES (# TGPS, # JOBS)
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG               BACK UP TO MESSAGE AREA
MSGJOBID DS    CL8,X               SPACE FOR JOBID
MSGJNAME DS    CL8                 SPACE FOR JOBNAME
MSG#TGPS DS    CL(L'ED)            SPACE FOR NUMBER OF TRACK GROUPS
MSGTGPCT DS    CL(L'EDPCT)         SPACE FOR % OF TOTAL TRACK GROUPS
         AIF   (NOT &QSP136).NO136D                                 DOR
         DS    C                   FILLER                         CL009
MSGACT   DS    CL4                 ACTIVE SYSTEM NAME             CL009
         DS    CL24                FILLER                         CL009
         AGO   .X136D                                               DOR
.NO136D  ANOP                                                       DOR
         DS    CL29                FILLER
.X136D   ANOP                                                       DOR
MSG$TGPS DS    CL(L'ED)            SPACE FOR NUMBER OF TRACK GROUPS
MSG$JOBS DS    CL(L'ED)            SPACE FOR NUMBER OF JOBS W/ TGPS
MSG$PCT  DS    CL(L'EDPCT)         SPACE FOR % OF JOBS
CTGPS    CSECT
         DROP
         AIF   (NOT &QSP136).NO136E                                 DOR
         COPY  $HASPGBL
&VERSION SETC  'SP 2.1.2'
&MACSPLV SETC  '2'
&SYSSPLV SETC  '2'
&FMID    SETC  'HJE2215'
         AGO   .X136E                                               DOR
.NO136E  ANOP                                                       DOR
JCT      EQU   10
BASE1    EQU   11
SAVE     EQU   13
         GBLC  &VERSION
&VERSION SETC  '0'
$RPS     EQU   0
$MSGID   EQU   0
$PRTBOPT EQU   0
$PRIOOPT EQU   0
$PRTRANS EQU   0
$QSONDA  EQU   0
$DRAINED EQU   0                                                  UF048
$CMBDEF  EQU   0
$JQEDEF  EQU   0
$MAXDA   EQU   32
$MAXJBNO EQU   0
$SMFDEF  EQU   0
$TGDEF   EQU   0
FF       EQU   255
$MAXNODE EQU   1000                                               UF046
$MAXPRDV EQU   4                                                  UF046
$OPTSTD  EQU   0                                                  UF046
$USERSET EQU   X'02'               SPECIFY USER SETUP OPTION      ONL11
.X136E   ANOP                                                       DOR
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136F                                 DOR
         IFGRPL
.NO136F  ANOP                                                       DOR
        $BUFFER
        $PCE
        $JQE
        $JCT
        $CAT
        $MIT   ,                                                  ONL11
        $HCT
        $TAB
        $PDDB
        $IOT
         AIF   (&QSP136).X136G                                      DOR
        $TGM
.X136G   ANOP                                                       DOR
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         DROP
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=CTSO
CTSO     TITLE 'ISSUE TSO COMMANDS WHILE IN QUEUE COMMAND'        ONL01
CTSO     QSTART ,                  START CTSO CSECT ASSEMBLY      ONL01
         USING WORK,R13       BASE FOR WORK AREA
         L     R10,QVCKPT     BASE FOR CKTP AREA
         USING QCKPT,R10      ADDRESSING FOR AREA
         L     R9,QVDSPL      BASE FOR DISPLAY AREA
         USING QDISPLAY,R9    ADDRESSING FOR AREA
         LA    R8,WCPPL       BASE FOR CPPL AREA
         USING CPPL,R8        ADDRESSING FOR AREA
         OC    QLNG1,QLNG1    TEST LENGTH OF COMMAND
         BZ    NOCMD          NONE, ABORT
         MVC   QDHLINE,QBLANK BLANK HEADING LINE
         TPUT  CLEAR,L'CLEAR,FULLSCR,MF=(E,QTPUT)  CLEAR THE SCREEN
*        STLINENO LINE=1,MODE=OFF  TURN OFF FULL SCREEN MODE
         MVC   WMODEL(WMODELEN),MODEL  COPY MODEL AREA TO DSECT AREA
         MVC   WBLDLFF,=AL2(1)  1 ENTRY IN LIST
         MVC   WBLDLLL,=AL2(12) 12 BYTES TO BE RETURNED
         L     R1,DAPLECT     POINT TO ECT
         USING ECT,R1         SET TEMP ADDRESSING
         MVC   QDWORD,ECTPCMD SAVE PRIMARY COMMAND NAME
         MVC   QDWORK,ECTSCMD  AND SECONDARY COMMAND NAME
         DROP  R1             DROP TEMP ADDRESSING
         SPACE 1
         MVC   CPPLUPT,DAPLUPT   COPY UPT POINTER
         MVC   CPPLPSCB,DAPLPSCB COPY PSCB POINTER
         MVC   CPPLECT,DAPLECT   COPY ECT POINTER
         SPACE 1
         LA    R15,QDREPLY    POINT TO COMMAND LINE
         AH    R15,QOFF1      POINT TO 1ST PARM (AFTER "TSO")
         SH    R15,=H'4'      BACK UP FOR BUFFER HEADER
         USING CMDBUF,R15     TEMP ADDRESSING FOR BUFFER
         LH    R14,QDRLNG     LENGTH OF REPLY
         SH    R14,QOFF1      - OFFSET TO OPERAND = TEXT LENGTH
         LA    R14,4(,R14)    + HEADER
         STH   R14,CMDLEN     SAVE AS LENGTH IN BUFFER
SCAN     ST    R15,CPPLCBUF   SET BUFFER CB POINTER
         XC    CMDOFF,CMDOFF  CLEAR OFFSET TO SECOND OPERAND
         DROP  R15            DROP TEMP ADDRESSING
         LA    R1,WCSPL       POINT TO IKJSCAN PARM LIST
         USING CSPL,R1        SET TEMP ADDRESSING
         L     R2,DAPLUPT     POINT TO UPT
         ST    R2,CSPLUPT
         L     R2,DAPLECT     POINT TO ECT
         ST    R2,CSPLECT
         LA    R2,WTCBECB     POINT TO ECB
         MVI   0(R2),0          CLEAR ECB
         ST    R2,CSPLECB
         LA    R2,WTCBADDR    WORD FOR FLAGS
         MVI   0(R2),0          CLEAR FLAGS
         ST    R2,CSPLFLG
         LA    R2,WCSOA       POINT TO OUTPUT AREA
         ST    R2,CSPLOA
         ST    R15,CSPLCBUF   COMMAND BUFFER ADDRESS TO CSPL
         DROP  R1             DROP TEMP ADDRESSING
         CALLTSSR EP=IKJSCAN  SCAN INPUT BUFFER
         LA    R1,WCSOA       POINT TO OUTPUT AREA
         USING CSOA,R1        SET TEMP ADDRESSING
         L     R14,CSOACNM    POINTER TO COMMAND NAME
         ICM   R15,3,CSOALNM  LENGTH OF NAME
         BZ    NOCMD2         NONE, SKIP REST
         BCTR  R15,0          DROP FOR EXECUTE
         DROP  R1             DROP TEMP ADDRESSING
         MVC   WBLDLNAM,QBLANK FILL WITH BLANKS
         EX    R15,MVCCMD      MOVE COMMAND TO WBLDLNAM
         CLC   =C'EX',QSUBNAME   IMPLICIT EXEC OF CLIST?
         BNE   NOTEXEC           NO, SKIP THIS
SETEXEC  NI    QSUBNAME,255-X'40'  DROP TO LOWER CASE
         MVC   WBLDLNAM,=CL8'EXEC' SET MODULE NAME TO ATTACH
         L     R1,CPPLCBUF       POINT TO BUFFER
         USING CMDBUF,R1         TEMP ADDRESSING
         XC    CMDOFF,CMDOFF     CLEAR OFFSET FOR EXEC
         B     OKATTACH       AND GO DO IT
         DROP  R1                DROP TEMP ADDRESSING
NOTEXEC  DS    0H
         BLDL  0,WBLDLPRM     CHECK FOR MODULE PRESENT
         LTR   R15,R15        CHECK RETURN CODE
         BNZ   SETEXEC        NONE, MUST BE CLIST
         SPACE 1
OKATTACH L     R1,DAPLECT     POINT TO ECT
         USING ECT,R1         SET TEMP ADDRESSING
         MVC   ECTPCMD,WBLDLNAM FAKE PRIMARY COMMAND NAME
         MVC   ECTSCMD,QBLANK AND SECONDARY COMMAND NAME
         DROP  R1             DROP TEMP ADDRESSING
         SPACE 1
         MVI   WTCBECB,0      CLEAR ECB
         LA    R1,WCPPL       CPPL PTR FOR COMMAND
ATTACH   DS    0H
         ATTACH EPLOC=WBLDLNAM,ECB=WTCBECB,                            +
               MF=(1,(1)),SF=(E,WATTL)
         ST    R1,WTCBADDR    SAVE TCB ADDR
WAIT     DS    0H
         WAIT  ECB=WTCBECB    WAIT
DETACH   DS    0H
         DETACH WTCBADDR
         SPACE 1
NOCMD2   DS    0H
         ICM   R1,15,WGTPB+4  ADDRESS OF GETLINE BUFFER
         BZ    NOFREE         NONO, SKIP FREEMAIN
         LH    R0,0(R1)       LENGTH OF BUFFER
         ICM   R0,B'1000',=X'01'  SUBPOOL 1
         FREEMAIN R,LV=(0),A=(1)  FREE THE BUFFER
         SPACE 1
NOFREE   L     R1,DAPLECT     POINT TO ECT
         USING ECT,R1         TEMP ADDRESSING
         L     R1,ECTIOWA     --> I/O WORK AREA
         DROP  R1             DROP TEMP ADDRESSING
         L     R1,0(R1)       --> TO ELEMENT ON STACK
         TM    0(R1),X'40'    FROM STORAGE (CLIST)?
         BZ    DONE           NO, DONE WITH PROCESSING
         LA    R1,WIOPL       ADDRESS OF IO PARM LIST
         L     R2,CPPLUPT     ADDRESS OF UPT
         L     R3,CPPLECT     ADDRESS OF ECT
         LA    R4,WTCBECB     ADDRESS OF ECB
         MVI   WTCBECB,0      CLEAR ECB
         GETLINE PARM=WGTPB,UPT=(R2),ECT=(R3),ECB=(R4),MF=(E,(1))
         CH    R15,=H'16'     END OF INPUT?
         BE    DONE           YES, CLEAN UP AND RETURN
         LA    R1,WGTPB       POINT TO GETLINE PARM LIST
         USING GTPB,R1        TEMP ADDRESSING
         L     R15,GTPBIBUF   POINT TO INPUT BUFFER
         DROP  R1             DROP TEMP ADDRESSING
         B     SCAN           AND GO TO SCAN PROCESSING
         SPACE 1
DONE     L     R1,DAPLECT     POINT TO ECT
         USING ECT,R1         SET TEMP ADDRESSING
         MVC   ECTPCMD,QDWORD RESTORE PRIMARY COMMAND NAME
         MVC   ECTSCMD,QDWORK  AND SECONDARY COMMAND NAME
         DROP  R1             DROP TEMP ADDRESSING
TPUT     DS    0H
*        TPUT  DONEMSG,L'DONEMSG  ASK FOR ENTER WHEN DONE
TGET     DS    0H
*        TGET  QDWORD,L'QDWORD,EDIT,MF=(E,QTGET)  READ RESPONCE
*        STFSMODE ON          RESTORE FULL SCREEN MODE
QSTOP    DS    0H
         QSTOP
         SPACE 1
NOCMD    QTILT '*** NO COMMAND SPECIFIED ***'
         SPACE 1
MVCCMD   MVC   WBLDLNAM(*-*),0(R14) MOVE COMMAND TO WBLDLNAM
         SPACE 1
DONEMSG  DC    C'*** PRESS ENTER TO RETURN TO QUEUE COMMAND ***'
CLEAR1   EQU   *
*        DC    X'27F5C1
         DC    X'C1'               FOR SPF/TCAM                   UF041
         DC    X'115D7E'
         DC    X'114040'
         DC    X'3C404000'
         DC    X'1DC8'
         DC    X'13'
CLEAR    EQU   CLEAR1,*-CLEAR1
         SPACE 1
MODEL    DS    0D
MGTPB    GETLINE MF=L
MATTL    ATTACH SHSPV=78,     NEEDED TO PREVENT S305 ABENDS            +
               SF=L
MODELEN  EQU   *-MODEL        LENGTH OF MODEL AREA
         SPACE 1
         LTORG
         SPACE  1
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
WORK     DSECT ,              .
         DS    18F            SAVE AREA
         DS    0D
WMODEL   DS    0D             START OF MODEL AREA
WGTPB    GETLINE MF=L
WATTL    ATTACH  SF=L
WMODELEN EQU   *-WMODEL       CHECK FOR SAME LENGTH.
         SPACE 1
WTCBADDR DC    A(0)           ADDRESS OF CREATED TASK
WTCBECB  DC    A(0)           COMPLETION CONTROL BLOCK.
WCPPL    DS    4F             SPACE FOR CPPL TO BE PASSED TO CMD
WPARML   DS    12F            SPACE FOR PARM LISTS
WIOPL    EQU   WPARML,16      IO PARM LIST FOR GETLINE
WCSPL    EQU   WPARML,24      PARM LIST FOR IKJSCAN
WCSOA    EQU   WPARML+24,8    OUTPUT AREA FROM IKJSCAN
         SPACE 1
         DS    0F
WBLDLPRM DS    XL16           WORK AREA FOR BLDL
WBLDLFF  EQU   WBLDLPRM,2     NUMBER OF ENTRIES IN LIST
WBLDLLL  EQU   WBLDLPRM+2,2   LENGTH OF EACH ENTRY
WBLDLNAM EQU   WBLDLPRM+4,8   MEMBER NAME
WBLDLTTR EQU   WBLDLPRM+12,3  TTR OF START
WBLDLK   EQU   WBLDLPRM+15,1  CONCATENATION NUMBER
         SPACE 1
WORKLEN  EQU   *-WORK         LENGTH OF WORK AREA
         SPACE 1
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         IKJCPPL  ,
         IKJCSOA  ,
         IKJCSPL  ,
         IKJECT   ,
         IKJGTPB  ,
         CVT   DSECT=YES
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         SPACE 1
CMDBUF   DSECT
CMDLEN   DC    H'0'           LENGTH, INCLUDES HEADER (+4)
CMDOFF   DC    H'0'           OFFSET TO NONBLANK PAST COMMAND.
CMDTEXT  DC    C' '           FIRST TEXT BYTE.
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=DDNAME
DDNAME   TITLE 'QUEUE COMMAND - LIST DDNAMES AND DSIDS FOR A JOB' ONL01
DDNAME   QSTART HASPEQU=YES,       START DDNAME CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE CMD - LIST DDNAMES AND DSIDS FOR A JOB'
         GBLB  &QSP                SP V1.3.X OPTION               RNB12
         GBLB  &QSP133             SP V1.3.3 OPTION               ONL11
         GBLB  &QSP136             SP V1.3.6 OPTION               DOR
         GBLB  &QJTIP              JTIP OPTION                    UF046
         SPACE 2                                                  ONL11
******************************************************************ONL11
*                                                                 ONL11
*   LIST DDNAME'S AND DSID'S FOR A JOB                            ONL11
*                                                                 ONL11
*   SYNTAX:  DD <JOBNAME>                                         ONL11
*                                                                 ONL11
*   NOTE:  THE SP 1.3.3 VERSION OF THE DD COMMAND IS JUST A       ONL11
*          SUBSET OF THE PDDB COMMAND.                            ONL11
*                                                                 ONL11
******************************************************************ONL11
         SPACE 1                                                  ONL11
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ROUTINE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QADD              PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
         AIF   (&QSP133).C29DD                                    ONL11
***********************************************************************
*                                                                     *
*   DETERMINE JOB TYPE (BATCH OR TSO)                                 *
*                                                                     *
***********************************************************************
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
         USING PDBDSECT,R2    BASE REG FOR PDDB
         L     R1,QCJCTA      A(JCT)
         CLI   QPARM2,C'S'                                        RNB11
         BE    DDTSO                                              RNB11
         CLC   JCTJOBID(3),=CL3'TSU' ?/TSO USER
         BE    DDTSO          YES. GO PROCESS
         CLC   JCTJOBID(3),=CL3'STC' ?/STARTED TASK
         BE    DDTSO          YES. GO PROCESS
***********************************************************************
*                                                                     *
*   LOCATE PDDB NUMBER 5                                              *
*                                                                     *
***********************************************************************
DDJOB    L     R3,QCIOTA      LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP THE POINTER     UF046
         USING IOTDSECT,R3    BASE REG FOR IOT                    UF046
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
FINDDS   CLC   =H'5',PDBDSKEY IS THIS THE DATASET?
         BE    FOUNDDS        YES. CONTINUE.
         LA    R2,PDBLENG(R2) NO. LOOK AT NEXT PDDB.
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         QTILT '*** JOB DOES NOT HAVE DD TABLE ***'
FOUNDDS  L     R4,PDBMTTR     DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         MVC   QDMSG,QBLANK   BLANK OUT THE MESSAGE AREA
         B     FIRST          PROCESS DATASET
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID,4(R5)  DOES THE JOBID MATCH?
         BNE   END            NO. END OF DATASET.
         CLC   =H'5',8(R5)    IS THE DSID 5?
         BNE   END            NO. END OF DATASET.
         LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         TM    5(R4),2        IS THIS AN EXEC RECORD?
         BO    EXEC           YES. PROCESS IT.
         TM    5(R4),4        IS THIS A DD RECORD?
         BO    DD             YES. PROCESS IT.
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       LENGTH OF SEGMENT
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
END      QSTOP
***********************************************************************
*                                                                     *
*   PROCESS AN EXEC RECORD                                            *
*                                                                     *
***********************************************************************
EXEC     MVC   STEPNAME,QBLANK BLANK OUT THE STEPNAME
         CLI   7(R4),X'94'    IS THERE A STEPNAME?
         BNE   SKIPREC        NO. SKIP THE REST.
         SR    R1,R1          ZERO OUT R1
         IC    R1,9(R4)       LENGTH OF STEPNAME
         SH    R1,=H'1'       DECREMENT BY 1
         BM    SKIPREC        STEPNAME WAS ZERO LENGTH.
         EX    R1,MVCSTEP     MOVE THE STEPNAME
         B     SKIPREC        CONTINUE PROCESSING
***********************************************************************
*                                                                     *
*   PROCESS DD RECORDS                                                *
*                                                                     *
***********************************************************************
DD       TM    6(R4),X'30'    IS THIS A SYSIN OR SYSOUT DD?
         BZ    SKIPREC        NO. SKIP THE RECORD.
         MVC   DDN,QBLANK     BLANK OUT THE DDNAME
         MVC   DSID,QBLANK    BLANK OUT THE DSID
         MVC   DSRECCT,QBLANK BLANK OUT THE DS RECORD COUNT
         MVC   DSCLASS,QBLANK BLANK OUT THE DS CLASS
         LA    R7,7(R4)       ADDR OF FIRST KEY
         LR    R8,R6          REMAINING LENGTH OF RECORD
         SR    R15,15         ZERO OUT R15
         SR    R14,R14        ZERO OUT R14
         SR    R1,R1          ZERO OUT R1
TRYFLD   CLI   0(R7),X'6E'    IS THIS THE DDNAME?
         BE    DDKEY          YES. PROCESS IT.
         CLI   0(R7),X'4A'    IS THIS THE DSNAME?
         BNE   NEXTFLD        NO. GET NEXT FIELD
         CLC   3(3,R7),=C'JES' YES. IS THIS TRULY A JES2 SYSIN/OUT DS?
         BE    DSKEY          YES. PROCESS IT.
NEXTFLD  IC    R1,1(R7)       NUMBER OF SUBFIELDS
         LA    R7,2(R7)       UPDATE LOCATION
         SH    R8,=H'2'       REMAINING COUNT
         SR    R8,R1          REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         LTR   R1,R1          ARE THERE ANY SUBFIELDS?
         BZ    TRYFLD         NO. TRY NEXT FIELD.
LOOPFLD  TM    0(R7),X'80'    IS THIS A SUB-SUB-FIELD
         BZ    NOSUB          NO. CONTINUE.
         NI    0(R7),X'7F'    CLEAR THE HEX 80 BIT
         IC    R14,0(R7)      NUMBER OF SUB-SUB-FIELDS
         LA    R7,1(R7)       UPDATE LOCATION
         SH    R8,=H'1'       REMAINING COUNT
         SR    R8,R14         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         AR    R1,R14         INCREASE NUMBER OF SUBFIELDS
         B     YESSUB         DECREMENT AND TRY AGAIN
NOSUB    IC    R15,0(R7)      SUBFIELD LENGTH
         LA    R7,1(R15,R7)   ADD TO LOCATION
         SR    R8,R15         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
YESSUB   BCT   R1,LOOPFLD     DO NEXT SUBFIELD
         B     TRYFLD         TRY NEXT FIELD
DDKEY    IC    R1,2(R7)       LENGTH OF DDNAME
         LTR   R1,R1          IS THE LENGTH ZERO?
         BZ    NEXTFLD        YES. SKIP THE FIELD.
         BCTR  R1,0           DECREMENT BY 1
         EX    R1,MVCDDN      MOVE THE DDNAME
         B     NEXTFLD        PROCESS NEXT FIELD
DSKEY    MVC   DSID+1(3),20(R7)  MOVE THE DSID
         L     R15,=V(FINDPDDB) ADDR OF FINDPDDB MODULE
         BALR  R14,R15        GO TO IT
         MVC   QDHLINE,HEADING MOVE IN HEADING
         LA    R1,QDMSG       ADDR OF MESSAGE LINE
         ST    R1,QDMSGA      STORE IN MESSAGE ADDR
         MVC   QDMLNG,=H'80'  MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         B     SKIPREC        PROCESS NEXT RECORD
***********************************************************************
*                                                                     *
*   PROCESS DD TSU                                                    *
*                                                                     *
***********************************************************************
DDTSO    L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         LR    R3,R5          BASE OF IOAREA
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP THE POINTER     UF046
         L     R4,JCTSPIOT    ADDR OF FIRST SPIN IOT
TSO010   LTR   R4,R4          IS IOT ADDR ZERO?
         BZ    DDJOB          YES, GO READ REGULAR IOT'S
         BAL   R8,READ        READ IOT
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
TSO020   CLI   PDBFLAG1,X'00' IS THIS PDDB VALID
         BE    TSO040         NO, GET NEXT IOT
         MVC   QDMSG,QBLANK   BLANK MESSAGE LINE
         MVC   DDN,=CL8'SPIN-DS'      MOVE IN DDNAME
         SR    R0,R0          CLEAR REG 0
         LH    R0,PDBDSKEY    CONVERT
         CVD   R0,CONVERT        DATA SET
         MVC   DSID,ED4               ID  TO
         ED    DSID,CONVERT+6             ZERO
         L     R0,PDBRECCT    CONVERT
         CVD   R0,CONVERT        RECORD
         MVC   DSRECCT,ED8          COUNT TO
         ED    DSRECCT,CONVERT+4        CHARACTER
         MVC   DSCLASS,PDBCLASS  MOVE IN SYSOUT CLASS
         AIF   (&QSP).RNB12A                                      RNB12
         TM    PDBFLAG1,PDB1PSO  HAS DATA SET BEEN PRINTED
         BO    TSO030         NO
         MVC   MESSAGE,PRTMSG INDICATE DATA SET PRINTED
.RNB12A  ANOP
TSO030   MVC   QDHLINE,HEADING MOVE IN HEADING
         LA    R1,QDMSG       ADDR OF MESSAGE LINE
         ST    R1,QDMSGA      STORE IN MESSAGE ADDR
         MVC   QDMLNG,=H'80'  MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         LA    R2,PDBLENG(R2) LOOK AT NEXT PDDB
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB
         BL    TSO020         NO, TRY AGAIN
TSO040   L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
         B     TSO010         GO SEARCH THE NEXT IOT
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
         SPACE 3                                                  ONL03
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
         SPACE 2                                                  ONL03
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
MVCSTEP  MVC   STEPNAME(1),10(R4)
MVCDDN   MVC   DDN(1),3(R7)
HEADING  DC    CL80'STEPNAME    DDNAME      DSID      LINES   CLASS'
ED4      DC    X'40202120'
ED5      DC    X'4020202120'
ED8      DC    X'4020202020202120'
PRTMSG   DC    CL15'ALREADY PRINTED'
         DROP  ,                   DROP ALL ADDRESSINGS           NERDC
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
DDNAME   CSECT ,                                                  UF023
JCT      EQU   0
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
STEPNAME DS    CL8
         DS    CL4
DDN      DS    CL8 END OF DATA. LAST REC #'
         DS    CL4
DSID     DS    CL4
         DS    CL4
DSRECCT  DS    CL8
         DS    CL4
DSCLASS  DS    CL1
         DS    CL6
MESSAGE  DS    CL15
WORK     DSECT
         DS    CL72
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         AGO   .END                                               ONL11
.C29DD   ANOP  ,                                                  ONL11
***********************************************************************
*                                                                     *
*   FIND ALL PDDBS FOR THIS JOB WITH A DSID OF 101 OR GRATER          *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A
         USING PDB,R2        BASE REG FOR PDDB  DOR
         AGO   .X136A
.NO136A  ANOP
         USING PDBDSECT,R2        BASE REG FOR PDDB
.X136A   ANOP
         MVC   QDHLINE,HEADING    SET HEADING LINE
         MVI   SWITCH,0           CLEAR FLAG BYTE
         L     R3,QCIOTA          LOAD BASE REG
         LR    R5,R3              IOAREA FOR READ IOT BLOCK
         AIF   (NOT &QSP136).NO136B
         SH    R3,=AL2(IOTSTART-IOT) ADJUST FOR HEADER       DOR
         USING IOT,R3        BASE REG FOR IOT                DOR
         AGO   .X136B
.NO136B  ANOP
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
         USING IOTDSECT,R3        BASE REG FOR IOT                UF046
.X136B   ANOP
         AIF   (NOT &QSP133).C29A1                                UF046
         L     R1,QCJQEA          ADDRESS OF JQE                  UF046
         AIF   (NOT &QSP136).NO136C
         USING JQE,R1             SET TEMP ADDRESSING             DOR
         TM    JQEFLAG3,JQE3SYSD  JQETRAK POINT TO IOT?           DOR
         AGO   .X136C
.NO136C  ANOP
         USING JQEDSECT,R1        SET TEMP ADDRESSING             UF046
         TM    JQEFLAG3,QUESYSDS  JQETRAK POINT TO IOT?           UF046
.X136C   ANOP
         BZ    READJCT            NO, SKIP THIS CODE              UF046
         OI    SWITCH,1            SKIP SPIN IOT'S                UF046
         L     R4,JQETRAK          ADDRESS OF FIRST IOT           UF046
         B     READIOT             READ FIRST IOT                 UF046
READJCT  DS    0H                                                 UF046
.C29A1   ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136D
         USING JCT,R1             SET TEMP ADDRESSING             DOR
         AGO   .X136D
.NO136D  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136D   ANOP
         L     R1,QCJCTA          POINT TO JCT
         L     R4,JCTIOT          FIRST IOT ADDRESS
         DROP  R1                 DROP TEMP ADDRESSING
READIOT  DS    0H                                                 UF046
         BAL   R8,READ            READ THE IOT
         SPACE 1
NEXTIOT  LR    R4,R3              BASE OF IOT
         CLC   IOTID,=CL4'IOT'    WAS AN IOT READ FROM SPOOL ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         CLC   QPJOBID,IOTJBKEY   IS THE IOT'S JOB KEY VALID ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         LR    R2,R3              BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB            ADD OFFSET TO FIRST PDDB     UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1         OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
         SPACE 1                                                  ONL11
PDDBLOOP LH    R0,PDBDSKEY        GET THE DSID
         C     R0,=F'101'         IS DSID .GE. 101?               ONL11
         BL    NEXTPDDB           IF NOT, IGNORE THIS PDDB        ONL11
         SPACE 1                                                  ONL11
         MVC   QDMSG,QBLANK       BLANK WORK LINE AREA            ONL11
         LTR   R0,R0              TEST FOR NULL PDDB#
         BZ    NEXTPDDB           SKIP IF SO
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSID-4(8),ED8      MOVE EDIT PATTERN TO DISPLAY
         ED    DSID-4(8),CONVERT+4  EDIT THE DSID
         L     R0,PDBRECCT        GET THE RECORD COUNT
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSRECCT,ED8        MOVE EDIT PATTERN TO DISPLAY
         ED    DSRECCT,CONVERT+4  EDIT THE RECORD COUNT
         MVC   DSCLASS,PDBCLASS   MOVE PDBCLASS TO DISPLAY
         AIF   (NOT &QSP133).C29C                                 UF046
         MVC   DS#PROC,PDBPNAME   SET PDDB PROC NAME              UF046
         MVC   DS#STEP,PDBSNAME   SET PDDB STEP NAME              UF046
         MVC   DS#DDNM,PDBDDNAM   SET PDDB DD NAME                UF046
         AGO   .JTIP1              SKIP JTIP CODE                 UF046
.C29C    ANOP                                                     UF046
         AIF   (NOT &QJTIP).JTIP1
         MVC   DS#PROC,PDB#PROC   SET JTIP PROC NAME
         MVC   DS#STEP,PDB#STEP   SET JTIP STEP NAME
         MVC   DS#DDNM,PDB#DDN    SET JTIP DD NAME
.JTIP1   ANOP
         MVC   QDMLNG,=H'80'      SET THE LENGTH
         LA    R0,QDMSG           POINT TO MESSAGE
         ST    R0,QDMSGA          SET IN AREA
         L     R15,=V(DISPLAY)    POINT TO DISPLAY ROUTINE
         BALR  R14,R15            LINK TO IT
NEXTPDDB LA    R2,PDBLENG(R2)     POINT TO NEXT PDDB
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB
         BL    PDDBLOOP           NO. KEEP TRYING
         L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    SPINIOT            NO. TRY THE SPIN IOT.
         BAL   R8,READ            READ THE IOT
         B     NEXTIOT            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136E
         USING JCT,R1             SET TEMP ADDRESSING             DOR
         AGO   .X136E
.NO136E  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136E   ANOP
SPINIOT  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY
         BO    STOP               YES, DONE
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         B     SPIN               SEARCH THE SPIN IOT CHAIN
         DROP  R1
STOP     QSTOP                    GO BACK TO CALLER
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK          STORE DISK ADDR
         LR    R1,R5              IOAREA ADDRESS
         L     R15,=V(READSPC)    ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15            GO TO IT
         BR    R8                 RETURN TO CALLER
ED8      DC    X'4020202020202120'
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
HEADING  DC    CL80' '
         ORG   HEADING            POINT TO START OF AREA
         DC    CL4' '                                             ONL11
         DC    C'DSID'                                            ONL11
         DC    CL2' '                                             ONL11
         DC    C'RECORDS'                                         ONL11
         DC    CL2' '                                             ONL11
         DC    C'CLASS'                                           ONL11
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP2                    ONL11
         DC    CL2' '                                             ONL11
         DC    C'PROCNAME'                                        ONL11
         DC    CL2' '                                             ONL11
         DC    C'STEPNAME'                                        ONL11
         DC    CL2' '                                             ONL11
         DC    C'DDNAME'                                          ONL11
.JTIP2   ANOP                                                     ONL11
         ORG   ,                  BACK TO NORMAL ADDRESSING
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
DDNAME   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136F
         IFGRPL  DSECT=YES,AM=VTAM                                DOR
         AGO   .X136F
.NO136F  ANOP
JCT      EQU   0
.X136F   ANOP
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $JQE                                                     UF046
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    CL4                                                ONL11
DSID     DS    CL4                                                ONL11
         DS    CL1                                                ONL11
DSRECCT  DS    CL8                                                ONL11
         DS    CL4                                                ONL11
DSCLASS  DS    CL1                                                ONL11
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP3                    ONL11
         DS    CL4                                                ONL11
DS#PROC  DS    CL8                                                ONL11
         DS    CL2                                                ONL11
DS#STEP  DS    CL8                                                ONL11
         DS    CL2                                                ONL11
DS#DDNM  DS    CL8                                                ONL11
.JTIP3   ANOP                                                     ONL11
WORK     DSECT
         DS    CL72
SWITCH   DS    C
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
.END     ANOP  ,                                                  ONL11
         END   ,                                                  ONL11
./       ADD   NAME=DDNAME2
DDNAME2  TITLE 'QUEUE COMMAND - LIST DDNAMES AND DSIDS FOR A JOB' ONL01
DDNAME2  QSTART HASPEQU=YES,       START DDNAME CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE CMD - LIST DDNAMES AND DSIDS FOR A JOB'
         GBLB  &QSP                SP V1.3.X OPTION               RNB12
         GBLB  &QSP133             SP V1.3.3 OPTION               ONL11
         GBLB  &QSP136             SP V1.3.6 OPTION               DOR
         GBLB  &QJTIP              JTIP OPTION                    UF046
         SPACE 2                                                  ONL11
******************************************************************ONL11
*                                                                 ONL11
*   LIST DDNAME'S AND DSID'S FOR A JOB                            ONL11
*                                                                 ONL11
*   SYNTAX:  DD <JOBNAME>                                         ONL11
*                                                                 ONL11
*   NOTE:  THE SP 1.3.3 VERSION OF THE DD COMMAND IS JUST A       ONL11
*          SUBSET OF THE PDDB COMMAND.                            ONL11
*                                                                 ONL11
******************************************************************ONL11
         SPACE 1                                                  ONL11
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ROUTINE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QADD              PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
         AIF   (&QSP133).C29DD                                    ONL11
***********************************************************************
*                                                                     *
*   DETERMINE JOB TYPE (BATCH OR TSO)                                 *
*                                                                     *
***********************************************************************
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
         USING PDBDSECT,R2    BASE REG FOR PDDB
         L     R1,QCJCTA      A(JCT)
         CLI   QPARM2,C'S'                                        RNB11
         BE    DDTSO                                              RNB11
         CLC   JCTJOBID(3),=CL3'TSU' ?/TSO USER
         BE    DDTSO          YES. GO PROCESS
         CLC   JCTJOBID(3),=CL3'STC' ?/STARTED TASK
         BE    DDTSO          YES. GO PROCESS
***********************************************************************
*                                                                     *
*   LOCATE PDDB NUMBER 5                                              *
*                                                                     *
***********************************************************************
DDJOB    L     R3,QCIOTA      LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP THE POINTER     UF046
         USING IOTDSECT,R3    BASE REG FOR IOT                    UF046
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
FINDDS   CLC   =H'5',PDBDSKEY IS THIS THE DATASET?
         BE    FOUNDDS        YES. CONTINUE.
         LA    R2,PDBLENG(R2) NO. LOOK AT NEXT PDDB.
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         QTILT '*** JOB DOES NOT HAVE DD TABLE ***'
FOUNDDS  L     R4,PDBMTTR     DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         MVC   QDMSG,QBLANK   BLANK OUT THE MESSAGE AREA
         B     FIRST          PROCESS DATASET
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID,4(R5)  DOES THE JOBID MATCH?
         BNE   END            NO. END OF DATASET.
         CLC   =H'5',8(R5)    IS THE DSID 5?
         BNE   END            NO. END OF DATASET.
         LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         TM    5(R4),2        IS THIS AN EXEC RECORD?
         BO    EXEC           YES. PROCESS IT.
         TM    5(R4),4        IS THIS A DD RECORD?
         BO    DD             YES. PROCESS IT.
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       LENGTH OF SEGMENT
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
END      QSTOP
***********************************************************************
*                                                                     *
*   PROCESS AN EXEC RECORD                                            *
*                                                                     *
***********************************************************************
EXEC     MVC   STEPNAME,QBLANK BLANK OUT THE STEPNAME
         CLI   7(R4),X'94'    IS THERE A STEPNAME?
         BNE   SKIPREC        NO. SKIP THE REST.
         SR    R1,R1          ZERO OUT R1
         IC    R1,9(R4)       LENGTH OF STEPNAME
         SH    R1,=H'1'       DECREMENT BY 1
         BM    SKIPREC        STEPNAME WAS ZERO LENGTH.
         EX    R1,MVCSTEP     MOVE THE STEPNAME
         B     SKIPREC        CONTINUE PROCESSING
***********************************************************************
*                                                                     *
*   PROCESS DD RECORDS                                                *
*                                                                     *
***********************************************************************
DD       TM    6(R4),X'30'    IS THIS A SYSIN OR SYSOUT DD?
         BZ    SKIPREC        NO. SKIP THE RECORD.
         MVC   DDN,QBLANK     BLANK OUT THE DDNAME
         MVC   DSID,QBLANK    BLANK OUT THE DSID
         MVC   DSRECCT,QBLANK BLANK OUT THE DS RECORD COUNT
         MVC   DSCLASS,QBLANK BLANK OUT THE DS CLASS
         LA    R7,7(R4)       ADDR OF FIRST KEY
         LR    R8,R6          REMAINING LENGTH OF RECORD
         SR    R15,15         ZERO OUT R15
         SR    R14,R14        ZERO OUT R14
         SR    R1,R1          ZERO OUT R1
TRYFLD   CLI   0(R7),X'6E'    IS THIS THE DDNAME?
         BE    DDKEY          YES. PROCESS IT.
         CLI   0(R7),X'4A'    IS THIS THE DSNAME?
         BNE   NEXTFLD        NO. GET NEXT FIELD
         CLC   3(3,R7),=C'JES' YES. IS THIS TRULY A JES2 SYSIN/OUT DS?
         BE    DSKEY          YES. PROCESS IT.
NEXTFLD  IC    R1,1(R7)       NUMBER OF SUBFIELDS
         LA    R7,2(R7)       UPDATE LOCATION
         SH    R8,=H'2'       REMAINING COUNT
         SR    R8,R1          REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         LTR   R1,R1          ARE THERE ANY SUBFIELDS?
         BZ    TRYFLD         NO. TRY NEXT FIELD.
LOOPFLD  TM    0(R7),X'80'    IS THIS A SUB-SUB-FIELD
         BZ    NOSUB          NO. CONTINUE.
         NI    0(R7),X'7F'    CLEAR THE HEX 80 BIT
         IC    R14,0(R7)      NUMBER OF SUB-SUB-FIELDS
         LA    R7,1(R7)       UPDATE LOCATION
         SH    R8,=H'1'       REMAINING COUNT
         SR    R8,R14         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         AR    R1,R14         INCREASE NUMBER OF SUBFIELDS
         B     YESSUB         DECREMENT AND TRY AGAIN
NOSUB    IC    R15,0(R7)      SUBFIELD LENGTH
         LA    R7,1(R15,R7)   ADD TO LOCATION
         SR    R8,R15         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
YESSUB   BCT   R1,LOOPFLD     DO NEXT SUBFIELD
         B     TRYFLD         TRY NEXT FIELD
DDKEY    IC    R1,2(R7)       LENGTH OF DDNAME
         LTR   R1,R1          IS THE LENGTH ZERO?
         BZ    NEXTFLD        YES. SKIP THE FIELD.
         BCTR  R1,0           DECREMENT BY 1
         EX    R1,MVCDDN      MOVE THE DDNAME
         B     NEXTFLD        PROCESS NEXT FIELD
DSKEY    MVC   DSID+1(3),20(R7)  MOVE THE DSID
         L     R15,=V(FINDPDDB) ADDR OF FINDPDDB MODULE
         BALR  R14,R15        GO TO IT
         MVC   QDHLINE,HEADING MOVE IN HEADING
         LA    R1,QDMSG       ADDR OF MESSAGE LINE
         ST    R1,QDMSGA      STORE IN MESSAGE ADDR
         MVC   QDMLNG,=H'80'  MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         B     SKIPREC        PROCESS NEXT RECORD
***********************************************************************
*                                                                     *
*   PROCESS DD TSU                                                    *
*                                                                     *
***********************************************************************
DDTSO    L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         LR    R3,R5          BASE OF IOAREA
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP POINTER         UF046
         L     R4,JCTSPIOT    ADDR OF FIRST SPIN IOT
TSO010   LTR   R4,R4          IS IOT ADDR ZERO?
         BZ    DDJOB          YES, GO READ REGULAR IOT'S
         BAL   R8,READ        READ IOT
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
TSO020   CLI   PDBFLAG1,X'00' IS THIS PDDB VALID
         BE    TSO040         NO, GET NEXT IOT
         MVC   QDMSG,QBLANK   BLANK MESSAGE LINE
         MVC   DDN,=CL8'SPIN-DS'      MOVE IN DDNAME
         SR    R0,R0          CLEAR REG 0
         LH    R0,PDBDSKEY    CONVERT
         CVD   R0,CONVERT        DATA SET
         MVC   DSID,ED4               ID  TO
         ED    DSID,CONVERT+6             ZERO
         L     R0,PDBRECCT    CONVERT
         CVD   R0,CONVERT        RECORD
         MVC   DSRECCT,ED8          COUNT TO
         ED    DSRECCT,CONVERT+4        CHARACTER
         MVC   DSCLASS,PDBCLASS  MOVE IN SYSOUT CLASS
         AIF   (&QSP).RNB12A                                      RNB12
         TM    PDBFLAG1,PDB1PSO  HAS DATA SET BEEN PRINTED
         BO    TSO030         NO
         MVC   MESSAGE,PRTMSG INDICATE DATA SET PRINTED
.RNB12A  ANOP
TSO030   MVC   QDHLINE,HEADING MOVE IN HEADING
         LA    R1,QDMSG       ADDR OF MESSAGE LINE
         ST    R1,QDMSGA      STORE IN MESSAGE ADDR
         MVC   QDMLNG,=H'80'  MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         LA    R2,PDBLENG(R2) LOOK AT NEXT PDDB
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB
         BL    TSO020         NO, TRY AGAIN
TSO040   L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
         B     TSO010         GO SEARCH THE NEXT IOT
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
         SPACE 3                                                  ONL03
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
         SPACE 2                                                  ONL03
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
MVCSTEP  MVC   STEPNAME(1),10(R4)
MVCDDN   MVC   DDN(1),3(R7)
HEADING  DC    CL80'STEPNAME    DDNAME      DSID      LINES   CLASS'
ED4      DC    X'40202120'
ED5      DC    X'4020202120'
ED8      DC    X'4020202020202120'
PRTMSG   DC    CL15'ALREADY PRINTED'
         DROP  ,                   DROP ALL ADDRESSINGS           NERDC
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
DDNAME   CSECT ,                                                  UF023
JCT      EQU   0
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
STEPNAME DS    CL8
         DS    CL4
DDN      DS    CL8 END OF DATA. LAST REC #'
         DS    CL4
DSID     DS    CL4
         DS    CL4
DSRECCT  DS    CL8
         DS    CL4
DSCLASS  DS    CL1
         DS    CL6
MESSAGE  DS    CL15
WORK     DSECT
         DS    CL72
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         AGO   .END                                               ONL11
.C29DD   ANOP  ,                                                  ONL11
***********************************************************************
*                                                                     *
*   FIND ALL PDDBS FOR THIS JOB WITH A DSID OF 101 OR GRATER          *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A
         USING PDB,R2        BASE REG FOR PDDB                DOR
         AGO   .X136A
.NO136A  ANOP
         USING PDBDSECT,R2        BASE REG FOR PDDB
.X136A   ANOP
         MVC   QDHLINE,HEADING    SET HEADING LINE
         MVI   SWITCH,0           CLEAR FLAG BYTE
         L     R3,QCIOTA          LOAD BASE REG
         LR    R5,R3              IOAREA FOR READ IOT BLOCK
         AIF   (NOT &QSP136).NO136B
         SH    R3,=AL2(IOTSTART-IOT) ADJUST FOR HEADER       DOR
         USING IOT,R3        BASE REG FOR IOT                DOR
         AGO   .X136B
.NO136B  ANOP
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
         USING IOTDSECT,R3        BASE REG FOR IOT                UF046
.X136B   ANOP
         AIF   (NOT &QSP133).C29A1                                UF046
         L     R1,QCJQEA          ADDRESS OF JQE                  UF046
         AIF   (NOT &QSP136).NO136C
         USING JQE,R1        SET TEMP ADDRESSING             DOR
         TM    JQEFLAG3,JQE3SYSD  JQETRAK POINT TO IOT?           DOR
         AGO   .X136C
.NO136C  ANOP
         USING JQEDSECT,R1        SET TEMP ADDRESSING             UF046
         TM    JQEFLAG3,QUESYSDS  JQETRAK POINT TO IOT?           UF046
.X136C   ANOP
         BZ    READJCT            NO, SKIP THIS CODE              UF046
         OI    SWITCH,1            SKIP SPIN IOT'S                UF046
         L     R4,JQETRAK          ADDRESS OF FIRST IOT           UF046
         B     READIOT             READ FIRST IOT                 UF046
READJCT  DS    0H                                                 UF046
.C29A1   ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136D
         USING JCT,R1        SET TEMP ADDRESSING             DOR
         AGO   .X136D
.NO136D  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136D   ANOP
         L     R1,QCJCTA          POINT TO JCT
         L     R4,JCTIOT          FIRST IOT ADDRESS
         DROP  R1                 DROP TEMP ADDRESSING
READIOT  DS    0H                                                 UF046
         BAL   R8,READ            READ THE IOT
         SPACE 1
NEXTIOT  LR    R4,R3              BASE OF IOT
         CLC   IOTID,=CL4'IOT'    WAS AN IOT READ FROM SPOOL ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         CLC   QPJOBID,IOTJBKEY   IS THE IOT'S JOB KEY VALID ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         LR    R2,R3              BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB            ADD OFFSET TO FIRST PDDB     UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1         OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
         SPACE 1                                                  ONL11
PDDBLOOP LH    R0,PDBDSKEY        GET THE DSID
         C     R0,=F'101'         IS DSID .GE. 101?               ONL11
         BL    NEXTPDDB           IF NOT, IGNORE THIS PDDB        ONL11
         SPACE 1                                                  ONL11
         MVC   QDMSG,QBLANK       BLANK WORK LINE AREA            ONL11
         LTR   R0,R0              TEST FOR NULL PDDB#
         BZ    NEXTPDDB           SKIP IF SO
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSID-4(8),ED8      MOVE EDIT PATTERN TO DISPLAY
         ED    DSID-4(8),CONVERT+4  EDIT THE DSID
         L     R0,PDBRECCT        GET THE RECORD COUNT
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSRECCT,ED8        MOVE EDIT PATTERN TO DISPLAY
         ED    DSRECCT,CONVERT+4  EDIT THE RECORD COUNT
         MVC   DSCLASS,PDBCLASS   MOVE PDBCLASS TO DISPLAY
         AIF   (NOT &QSP133).C29C                                 UF046
         MVC   DS#PROC,PDBPNAME   SET PDDB PROC NAME              UF046
         MVC   DS#STEP,PDBSNAME   SET PDDB STEP NAME              UF046
         MVC   DS#DDNM,PDBDDNAM   SET PDDB DD NAME                UF046
         MVC   DSFORMS,PDBFORMS        MOVE IN FORMS        *DOR 07/85*
         MVC   DSFCB,PDBFCB            MOVE IN FCB ID       *DOR 06/85*
         MVC   DSUCS,PDBUCS            MOVE IN UCS ID       *DOR 06/85*
         SR    R0,R0                   CLEAR FOR DEST       *DOR 06/85*
         IC    R0,PDBCOPYS             NUMBER OF COPIES     *DOR 06/85*
         CVD   R0,CONVERT              CONVERT TO DECIMAL   *DOR 06/85*
         MVC   DSCOPIES,ED3            MOVE IN EDIT PATTERN *DOR 06/85*
         ED    DSCOPIES,CONVERT+6      FORMAT NO. OF COPIES *DOR 06/85*
         SR    R0,R0                   CLEAR R7             *DOR 06/85*
         ICM   R0,3,PDBDRMT            GET PDDB RMT  CODE   *DOR 06/85*
         BZ    PDB05                   MUST BE A LOCAL JOB  *DOR 06/85*
         MVC   DSDEST(3),=CL3'RMT'     INDICATE REMOTE ROUTE*DOR 06/85*
         B     PDB04                   BRANCH AROUND INST.  *DOR 06/85*
PDB03    MVI   DSDEST+1,C'U'           MOVE IN LOCAL DEST   *DOR 06/85*
PDB04    CVD   R0,CONVERT              CONVERT DEST NUMBER  *DOR 06/85*
         MVC   NUMBER(L'NORMAL),NORMAL   EDIT FORMAT        *DOR 06/85*
         LA    R1,NUMBER+11                                 *DOR 06/85*
         EDMK  NUMBER(L'NORMAL),CONVERT+2 CONVERT TO EBDCIC *DOR 06/85*
         LA    R14,NUMBER+L'NORMAL-1                        *DOR 06/85*
         SLR   R14,R1              LENGTH OF ONVERT         *DOR 06/85*
         EX    R14,MVRMTNO                                  *DOR 06/85*
         B     PDB06                   BRANCH AROUND LOCAL  *DOR 06/85*
MVRMTNO  MVC   DSDEST+3(*-*),0(R1)  TO BE EXCUTED           *DOR 06/85*
PDB05    MVC   DSDEST,=C' LOCAL'       MOVE IN LOCAL IND.   *DOR 06/85*
PDB06    EQU   *                                            *DOR 06/85*
         AGO   .JTIP1              SKIP JTIP CODE                 UF046
.C29C    ANOP                                                     UF046
         AIF   (NOT &QJTIP).JTIP1
         MVC   DS#PROC,PDB#PROC   SET JTIP PROC NAME
         MVC   DS#STEP,PDB#STEP   SET JTIP STEP NAME
         MVC   DS#DDNM,PDB#DDN    SET JTIP DD NAME
.JTIP1   ANOP
         MVC   QDMLNG,=H'80'      SET THE LENGTH
         LA    R0,QDMSG           POINT TO MESSAGE
         ST    R0,QDMSGA          SET IN AREA
         L     R15,=V(DISPLAY)    POINT TO DISPLAY ROUTINE
         BALR  R14,R15            LINK TO IT
NEXTPDDB LA    R2,PDBLENG(R2)     POINT TO NEXT PDDB
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB
         BL    PDDBLOOP           NO. KEEP TRYING
         L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    SPINIOT            NO. TRY THE SPIN IOT.
         BAL   R8,READ            READ THE IOT
         B     NEXTIOT            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136E
         USING JCT,R1        SET TEMP ADDRESSING             DOR
         AGO   .X136E
.NO136E  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136E   ANOP
SPINIOT  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY
         BO    STOP               YES, DONE
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         B     SPIN               SEARCH THE SPIN IOT CHAIN
         DROP  R1
STOP     QSTOP                    GO BACK TO CALLER
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK          STORE DISK ADDR
         LR    R1,R5              IOAREA ADDRESS
         L     R15,=V(READSPC)    ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15            GO TO IT
         BR    R8                 RETURN TO CALLER
ED3      DC    X'40202120'
ED8      DC    X'4020202020202120'
NORMAL   DC    X'402020202020202020202120' EDIT MASK        *DOR 06/85*
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
HEADING  DC    CL80' '
         ORG   HEADING            POINT TO START OF AREA
         DC    C'DSID'                                            DOR
         DC    CL2' '                                             DOR
         DC    C'RECORDS'                                         DOR
         DC    CL1' '                                             DOR
         DC    C'CL'                                           DOR
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP2                    DOR
         DC    CL1' '                                             DOR
         DC    C'PROCNAME'                                        DOR
         DC    CL1' '                                             DOR
         DC    C'STEPNAME'                                        DOR
         DC    CL1' '                                             DOR
         DC    C'DDNAME'                                          DOR
         DC    CL3' '                                             DOR
         DC    C'FORM'                                            DOR
         DC    CL1' '                                             DOR
         DC    C'FCB'                                             DOR
         DC    CL2' '                                             DOR
         DC    C'UCB'                                             DOR
         DC    CL3' '                                             DOR
         DC    C'COPIES'                                          DOR
         DC    CL2' '                                             DOR
         DC    C'DEST'                                            DOR
.JTIP2   ANOP                                                     DOR
         ORG   ,                  BACK TO NORMAL ADDRESSING
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
DDNAME   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136F
         IFGRPL DSECT=YES,AM=VTAM                            DOR
         AGO   .X136F
.NO136F  ANOP
JCT      EQU   0
.X136F   ANOP
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $JQE                                                     UF046
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
DSID     DS    CL4                                                DOR
         DS    CL1                                                DOR
DSRECCT  DS    CL8                                                DOR
         DS    CL2                                                DOR
DSCLASS  DS    CL1                                                DOR
         AIF   (NOT (&QJTIP OR &QSP133)).JTIP3                    DOR
         DS    CL1                                                DOR
DS#PROC  DS    CL8                                                DOR
         DS    CL1                                                DOR
DS#STEP  DS    CL8                                                DOR
         DS    CL1                                                DOR
DS#DDNM  DS    CL8                                                DOR
         DS    CL1                                                DOR
DSFORMS  DS    CL4                                                DOR
         DS    CL1                                                DOR
DSFCB    DS    CL4                                                DOR
         DS    CL1                                                DOR
DSUCS    DS    CL4                                                DOR
         DS    CL4                                                DOR
DSCOPIES DS    CL4                                                DOR
         DS    CL1                                                DOR
DSDEST   DS    CL6                                                DOR
.JTIP3   ANOP                                                     DOR
WORK     DSECT
         DS    CL72
SWITCH   DS    C
CONVERT  DS    D
NUMBER   DS    CL16                                         *DOR 06/85*
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
.END     ANOP  ,                                                  ONL11
         END   ,                                                  ONL11
./       ADD   NAME=DEVIREQ
*          DATA SET TEC128402  AT LEVEL 005 AS OF 11/09/82
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
*  FORMER      'SE2SG03D -   #R  DISPLAY DEVICE INTERVENTION REQUIRED'
*        TITLE 'IEESG03D -   #R  DISPLAY DEVICE INTERVENTION REQUIRED'
DEVIREQ  TITLE 'QUEUE COMMAND - #I  DISPLAY SYSTEM INDICATORS'
DEVIREQ  QSTART ,                  START DEVIREQ DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA    DOR
         L     R10,QVDSPL     LOAD BASE REG                     DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA      DOR
***********************************************************************
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESG03D -       #R  DISPLAY DEVICE INTERVENTION REQUIRED ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8    WITH SP3 SUPPORT          ***
***                                                                 ***
***       UPDATED -        07/21/81   AXC-CBT HANDLE ESTAE          ***
***                        11/09/82   CBT: ENHANCED WITH SP3        ***
***                                     SUPPORT VIA GQSCAN          ***
***                        07/01/85  CONVERT TO ISPF QUEUE CMD     DOR
***                                                                 ***
***********************************************************************
***********************************************************************
*    R1
*    R2   -  BASE REG FOR XSA AREA
*    R3
*    R4   -  UCB + CVT CNTL BLKS
*    R5   -  UCB SEARCHING
*    R6   -  UCB WORK REG + PRINTING
*    R7
*    R8   -  A TEMPORARY WORK AREA
*    R9   -  FOR RIB DSECT
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -  JOBFIND CODE + WORK2 ADDRESSING, WTO
*    R15  -  JOBFIND CODE
*****************************************************************
         EJECT
         LA    R4,0
         STH   R4,UCBPRT           COUNT
         LA    R4,UCBTAB
         LA    R5,4000
         LA    R6,=CL8' '
         L     R7,CLEAR
         MVCL  R4,R6               CLEAR UCBTAB TO BLANKS
         L     R4,16               CVT
         L     R4,40(0,R4)         UCB LOOKUP TABLE
         SR    R5,R5
         USING  QCKPT,R9
         L     R9,QVCKPT
         LH    R3,QDRLNG
         LTR   R3,R3               ANY PARM SPECIFIED
         BZ    UCBLOOP             NO, USE DEFAULT
         LA    R3,QDREPLY
         AH    R3,QOFF1
         DROP  R9
         CLI   TYPE,X'00'          TO CHECK FIRST TIME
         BE    HAVENOT             FOR PREVENTING UNKNOWN LOOPING
         CLI   TYPE,C' '
         BNE   HAVECUR
HAVENOT  MVC   TYPE(10),=CL10'D '      DEFAULT AT FIRST TIME
         MVI   ASIDSW,X'00'        CLEAR ASID SEARCH SW
HAVECUR  CLC   0(2,R3),=CL2'AL'    ONE WITH NO PARM
         BE    UCBLOOP
         MVC   TYPE(10),0(R3)      SET TYPE FROM PARM
         CLI   TYPE,C'B'           BOTH
         BE    UCBLOOP
         CLI   TYPE,C'D'           DISK
         BE    UCBLOOP
         CLI   TYPE,C'T'           TAPE
         BE    UCBLOOP
         CLI   TYPE,C'P'           UNIT RECORD
         BE    UCBLOOP
         CLI   TYPE,C'U'           UNIT=
         BE    UCBLOOP
         CLI   TYPE,C'S'           VOLSER=
         BE    UCBLOOP
         CLI   TYPE,C'V'           VARIED
         BE    UCBLOOP
         MVI   TYPE,C'M'           TAPE MOUNTS
         EJECT
UCBLOOP  ICM   R5,3,0(R4)          LOAD UCB ADDR
         LTR   R5,R5               TEST ADDR
         BNZ   UCBLOOP2            NOT ZERO, CONTINUE
         SPACE 3
UCBLOOP1 LA    R4,2(0,R4)          NEXT ADDR
         B     UCBLOOP
         SPACE 3
UCBLOOP2 CLC   0(2,R4),=X'FFFF'    END OF TABLE
         BE    PRINT               YES, GO PRINT RESUTLS
         MVI   ASIDSW,X'00'        CLEAR ASID SEARCH SW
         CLI   TYPE,C'V'
         BE    UCBLOOPV
         TM    3(R5),X'88'         ONLINE AND ALLOCATED
         BNO   UCBLOOP1            NO, GET NEXT
         CLI   TYPE,C'D'           DISK
         BE    UCBLOOPD
         CLI   TYPE,C'T'           TAPE
         BE    UCBLOOPT
         CLI   TYPE,C'P'           UNIT RECORD
         BE    UCBLOOPP
         CLI   TYPE,C'U'           UNIT=
         BE    UCBLOOPU
         CLI   TYPE,C'S'           VOLSER=
         BE    UCBLOOPS
         CLI   TYPE,C'M'           MOUNTS
         BE    UCBLOOPM
         B     UCBLOOP3            ASSUME BOTH
         EJECT
UCBLOOPD TM    18(R5),X'20'        DISK
         BZ    UCBLOOP1            NO, GET NEXT
         B     UCBLOOP3
         SPACE 3
UCBLOOPT TM    18(R5),X'80'        TAPE
         BZ    UCBLOOP1            NO, GET NEXT
         B     UCBLOOP3
         SPACE 3
UCBLOOPP TM    18(R5),X'08'        UNIT RECORD
         BZ    UCBLOOP1
         B     UCBLOOP3
         SPACE 3
UCBLOOPU MVI   ASIDSW,X'F0'        FORCE PRINT
         CLC   TYPE+2(3),13(R5)    UNIT MATCH
         BE    UCBLOOP4
         CLI   TYPE+4,C' '         UNIT COMPARE
         BNE   UCBLOOP1            YES, NO MATCH
         CLC   TYPE+2(2),13(R5)    CONTROL UNIT MATCH
         BE    UCBLOOP4
         CLI   TYPE+3,C' '         CONTROL UNIT COMPARE
         BNE   UCBLOOP1            YES, NO MATCH
         CLC   TYPE+2(1),13(R5)    CHANNEL MATCH
         BE    UCBLOOP4
         B     UCBLOOP1
         SPACE 3
UCBLOOPS MVI   ASIDSW,X'F0'        FORCE PRINT
         CLC   TYPE+2(6),28(R5)    VOLSER MATCH
         BNE   UCBLOOP1
         B     UCBLOOP4
         SPACE 3
UCBLOOPM TM    18(R5),X'80'        TAPE
         BZ    UCBLOOP1
         TM    6(R5),X'40'         NOT READY
         BZ    UCBLOOP1
         TM    34(R5),X'01'        MOUNT MSG ISSUED
         BZ    UCBLOOP1
         EJECT
UCBLOOPV TM    3(R5),X'50'         VARIED OR UNLOADED
         BZ    UCBLOOP1            NO, GO GET NEXT
         MVI   ASIDSW,X'F0'        FORCE PRINT
         B     UCBLOOP4
         SPACE 3
UCBLOOP3 MVI   ASIDSW,X'FF'        SET ASID SEARCH SW
         CLI   TYPE+1,C'='         ASID DELIMITED SEARCH
         BE    UCBLOOP4
         MVI   ASIDSW,X'00'        CLEAR ASID SEARCH SW
         CLI   6(R5),X'00'         FLAGS ZERO
         BNE   UCBLOOP4            NO, GOT ONE
         TM    18(R5),X'20'        DISK
         BZ    UCBLOOP1            NO, NO RESERVE CHECK
         CLI   40(R5),X'00'        RESERVE
         BZ    UCBLOOP1            NO, GET NEXT
         SPACE 3
UCBLOOP4 LA    R6,UCBTAB           UCB TABLE
         LA    R7,90               MAX ENTRIES
         SPACE 3
UCBLOOP5 CLI   0(R6),X'40'         EMPTY SLOT
         BE    UCBLOOP7            YES, GO FILL IT
         CLC   0(3,R6),13(R5)      UCB ALREADY IN LIST
         BE    UCBLOOP1            YES, GET NEXT
         SPACE 3
UCBLOOP6 LA    R6,40(0,R6)         NEXT SLOT
         BCT   R7,UCBLOOP5
         B     PRINT
         EJECT
UCBLOOP7 L     R1,20(0,R5)         UCB EXTENSION ADDR
         LH    R8,UCBPRT
         LA    R8,1(R8)
         STH   R8,UCBPRT
         UNPK  25(5,R6),14(3,R1)   ASID
         NC    25(4,R6),=8X'0F'
         TR    25(4,R6),=C'0123456789ABCDEF'
         MVI   29(R6),C' '
         MVC   22(3,R6),=C'AS='
         ST    R11,SAVER11
         BAL   R11,JOBFIND         GO GET JOBNAME
         L     R11,SAVER11
         MVC   0(3,R6),13(R5)      UNIT NAME
         TM    18(R5),X'A0'        TAPE OR DISK
         BZ    *+10
         MVC   5(6,R6),28(R5)      VOLSER
         CLI   5(R6),X'FF'         PRIVAT MOUNT
         BNE   *+10                NO, BYPASS MOVE
         MVC   5(6,R6),=C'PRIVAT'  SET PRIVAT IN MSG
         CLI   5(R6),X'00'         ZERO VOLSER
         BNE   *+10                NO
         MVC   5(6,R6),=CL6'*MTP*'
         MVC   13(7,R6),=CL7'INT REQ'
         TM    6(R5),X'40'         NOT READY
         BO    UCBLOOP1            YES, GET NEXT
         MVC   13(7,R6),=CL7'BUSY'
         TM    6(R5),X'80'         BUSY
         BO    UCBLOOP1
         MVC   13(7,R6),=CL7'CU BUSY'
         TM    6(R5),X'08'         CONTROL UNIT BUSY
         BO    UCBLOOP1
         TM    18(R5),X'20'        DISK
         BZ    *+12
         CLI   36(R5),X'00'        RESERVE COUNT EQUAL ZERO
         BNE   UCBLOOP8
         MVC   13(7,R6),=CL7'ALLOC'
         TM    ASIDSW,X'F0'        PRINT FORCED
         BO    UCBLOOP1            YES
         MVI   0(R6),C' '          FORCE NO PRINT
         B     UCBLOOP1
         SPACE 3
UCBLOOP8 MVC   13(7,R6),=CL7'RSVD-'
         SR    R8,R8
         IC    R8,36(0,R5)         RESERVE COUNT
         CVD   R8,DOUBLE           SAVE RESERVE COUNT
         UNPK  18(2,R6),DOUBLE+6(2)
         OI    19(R6),X'F0'
         B     UCBLOOP1
         EJECT
JOBFIND  SR    R14,R14
         ICM   R14,3,14(R1)        ASID
         SLL   R14,2               MULTIPLY ASID BY 4 FOR ASVT ADDR INC
         L     R15,16              CVT
         L     R15,556(0,R15)      ASVT
         LA    R15,524(R14,R15)    ASVT ENTRY FOR ASID SPECIFIED
         TM    0(R15),X'80'        AVAILABLE SLOT
         BO    JOBFIND3            YES, JUST USE ASID
         L     R15,0(0,R15)        ASCB
         L     R14,56(0,R15)       CSCB
         CLI   28(R14),X'03'       INIT/JOB
         BNE   JOBFIND2            NO, GO USE THIS CSCB
         LR    R15,R14             SAVE CSCB
         LA    R15,0(0,R15)
         SPACE 3
JOBFIND1 L     R14,0(0,R14)        NEXT CSCB
         LA    R14,0(0,R14)
         LTR   R14,R14             END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R14,R15             LOAD ORIG CSCB ADDR
         B     JOBFIND2
         CR    R14,R15             SAME CSCB
         BE    JOBFIND2            YES, INIT
         CLC   14(2,R1),30(R14)    ASID MATCH
         BNE   JOBFIND1            NO, GET NEXT
         SPACE 3
JOBFIND2 MVC   32(8,R6),=CL8' '
         LTR   R14,R14             CSCB ZERO
         BZ    JOBFIND3
         MVC   32(8,R6),8(R14)     JOBNAME
         SPACE 3
JOBFIND3 CLI   ASIDSW,X'FF'        ASID SEARCH
         BCR   7,R11               NO, CONTINUE
         CLC   32(8,R6),TYPE+2     JOBNAME MATCH
         BCR   8,R11               YES, CONTINUE
         CLC   25(4,R6),TYPE+2     ASID MATCH
         BCR   8,R11               YES, EXIT
         B     UCBLOOP1
         EJECT
PRINT    EQU   *
         MVC   QDHLINE(80),QBLANK
         MVC   QDMSG(80),QBLANK
         LA    R6,UCBTAB           UCB TABLE ADDR
         LH    R8,UCBPRT
         LTR   R8,R8
         BZ    NOPRINT
         CLI   0(R6),C' '          ANY TO PRINT
         BE    NOPRINT             NO, GO TELL OPERATOR
  MVC   QDHLINE(43),=CL43'  DEVICE VOLSER  STATUS   ASID      JOBNAME'
*                         1234567890123456789012345678901234567890123
         SPACE 3
PRINT1   CLI   0(R6),C' '          END OF PRINT
         BE    EXIT                YES, EXIT
         MVC   QDMSG+4(40),0(R6)    SET MSG IN AREA
         BAL   R7,DISPLAY
         LA    R6,40(0,R6)         NEXT TABLE ENTRY
         BCT   R8,PRINT1           GET NEXT
         B     EXIT
         SPACE 3
NOPRINT  EQU   *
         MVC   QDHLINE(28),=CL28'NO SELECTED DEVICES FOUND '
         CLI   TYPE,C'M'
         BNE   NOPRINT1
         MVC   QDMSG(28),=CL28'NO MOUNTS PENDING'
         SPACE 3
NOPRINT1 BAL   R7,DISPLAY
         SPACE 3
EXIT     QSTOP
         EJECT
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   QDMSG,C' '      BLANK LINE
         MVC   QDMSG+1(79),QDMSG
         BR    R7             RETURN TO MAINLINE...                 NTL
         LTORG
         SPACE 3
         DS    0F
SUB241   DC    X'F1000000'   SUBPOOL 241
         DS    0F
CLEAR    DC    X'40000001'
         SPACE 3
         DS    0F
TKN      DS    F                       GQSCAN CONTINUATION ADDR
WORKSIZ  DC    AL4(WORKEND-WORK)
         EJECT
         PRINT NOGEN
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
TYPE     DS    CL10
ASIDSW   DS    C
WORKSTRT DS    0D
DOUBLE   DS    D
SAVER11  DS    F
UCBPRT   DS    H
UCBTAB   DS    90CL40
WORKEND  EQU   *
         EJECT
         PRINT NOGEN
         IHASDWA
         EJECT
         ISGRIB
         EJECT
         IEFUCBOB
         END
./       ADD   NAME=DEVMON
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/02/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
DEVMON  TITLE 'QUEUE COMMAND - DEVICE BUSY MONITOR'
DEVMON  QSTART ,                  START DEVMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -  JOBTABLE
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       IEEZB03D -       ##B  DEVICE BUSY MONITOR                 ***
***       VERSION -        2.3                                      ***
***       MVS LEVEL -      MVS/SE  3.8.   TO MVS/SP1.3 LEVEL        ***
***********************************************************************
         EJECT
*       CLI   TRACESWT,X'FF'
*        BE    TRACEOK
*        CALL TRACE
*        MVI   TRACESWT,X'FF'
TRACEOK  EQU    *
         L     R0,SIZEJOB
         GETMAIN R,LV=(0)
         ST    R1,EXTRAREA
         A     R1,=A(SEEKTAB-JOBTABS)
         ST    R1,SEEKTABA
         L     R7,EXTRAREA
         USING JOBTABS,R7
         XC    SEEKTOT(4),SEEKTOT
         LA    R3,QPARM1           PARM LIST ADDR
         MVI   NFNDSW,X'00'        SET NOTHING FOUND
         MVC   PARM(3),0(R3)       SAVE PARM
         SR    R1,R1
         IC    R1,0(0,R3)          CHANNEL
         SLL   R1,28
         SRL   R1,28
         TM    0(R3),X'F0'         NUMERIC CHANNEL
         BO    *+8                 YES
         LA    R1,9(0,R1)
         STC   R1,CHANNEL          SAVE CHANNEL ID
         CLI   0(R3),C'X'          ALL DASD REQ
         BNE   *+8                 NO
         MVI   CHANNEL,C'X'
         MVC   DSPSW(1),4(R3)      SAVE LIST PARM
         CLI   DSPSW,C'J'          JOB LIST
         BE    PARM1               YES
         CLI   DSPSW,C'S'          SEEK ANALYSIS
         BNE   PARM0               NO
         CLI   PARM+2,C'X'         SINGLE DEVICE
         BNE   PARM1               YES
         SPACE 1
PARM0    MVI   DSPSW,C'D'          DEVICE LIST
         SPACE 1
PARM1    MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(80),=CL80' DEVICE BUSY MONITOR  '
         LA    R1,XTIME            WAITTIME ADDR
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
         SPACE 1
         L     R3,8(0,R1)          LOAD MONITOR TIME
         MH    R3,=H'5'            TIMES 5
         LR    R5,R3
         B     UCBTIME1
         EJECT
UCBTIME  STIMER WAIT,DINTVL=INTERVL
         SPACE 1
UCBTIME1 BAL   R15,UCBLOOP
         BCT   R3,UCBTIME
         B     UCBBUSY
         EJECT
UCBLOOP  STM   R0,R15,SAVEREGS
         ST    R15,UCBR15
         XC    UCBDMSAV(24),UCBDMSAV
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         SPACE 1
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB5             YES, EXIT
         CLI   CHANNEL,C'X'        ALL DASD REQ
         BE    CHKUCB1X            YES, ALL MATCH
         CLC   13(3,R1),PARM       UNIT MATCH
         BE    CHKUCB1B            YES
         CLI   PARM+2,C'X'         CONTROL UNIT REQ
         BNE   CHKUCB1A            NO, NEXT UCB
         CLC   13(2,R1),PARM       UNIT MATCH
         BNE   CHKUCB1A            NO
         B     CHKUCB1B
         SPACE 1
CHKUCB1X CLI   18(R1),X'20'        DASD
         BNE   CHKUCB1A            NO, NEXT
         SPACE 1
CHKUCB1B MVI   NFNDSW,X'FF'
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1C            NO
         LA    R6,UCBTABB
         LR    R14,R1             UCB ADDR
         S     R14,=F'4'          DECR ADDR -4
         L     R14,0(0,R14)       IOQ ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            ANY IOQ
         BZ    CHKUCB1D           NO
         L     R14,8(0,R14)       IOSB ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            EXIST
         BZ    CHKUCB1D           NO
         CLI   DSPSW,C'S'         SEEK ANALYSIS
         BNE   CHKUCB1C           NO
         SR    R15,R15
         ICM   R15,3,103(R14)     SEEK ADDR
         SLL   R15,2
         A     R15,SEEKTABA
         L     R0,0(0,R15)
         A     R0,=F'1'
         ST    R0,0(0,R15)
         L     R0,SEEKTOT
         A     R0,=F'1'
         ST    R0,SEEKTOT
         SPACE 1
CHKUCB1C SR    R15,R15
         ICM   R15,3,6(R14)       ASID
         LA    R14,=CL8'*MASTER*'
         CH    R15,=H'1'          MASTER
         BE    CHKUCB2
         SLL   R15,2              X 4
         L     R14,16             CVT
         L     R14,556(0,R14)     ASVT
         L     R15,524(R15,R14)   ASCB
         L     R14,172(0,R15)      JOBNAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         L     R14,176(0,R15)      STC/TSU NAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         LA    R14,=CL8'*UNKNWN*'
         B     CHKUCB2
         SPACE 1
CHKUCB1D SR    R14,R14
         EJECT
CHKUCB2  LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLI   0(R6),X'FF'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLC   0(3,R6),13(R1)      UCB ADDR MATCH
         BNE   CHKUCB2             NO
         LTR   R14,R14             DEVICE NOT BUSY
         BZ    CHKUCB1A            YES
         CLI   DSPSW,C'D'          DEVICE ONLY
         BE    CHKUCB4             YES
         CLC   10(8,R6),0(R14)     JOBNAME MATCH
         BNE   CHKUCB2             NO
         B     CHKUCB4
         SPACE 1
CHKUCB3  XC    18(4,R6),18(R6)
         MVC   0(3,R6),13(R1)      UNIT ADDR
         MVC   4(6,R6),=CL6' '
         MVC   10(8,R6),0(R14)     JOBNAME
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    CHKUCB3A            NO
         MVC   4(6,R6),28(R1)      VOLSER
         SPACE 1
CHKUCB3A LTR   R14,R14             DEVICE NOT BUSY
         BZ    CHKUCB1A            YES
         SPACE 1
CHKUCB4  LH    R14,18(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,18(0,R6)
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         LH    R14,20(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,20(0,R6)
         B     CHKUCB1A
         SPACE 1
CHKUCB5  LA    R6,UCBTABB
         SPACE 1
CHKUCB5A LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BNE   CHKUCB5A            NO
         MVI   0(R6),X'FF'         SET END OF TABLE
         SPACE 1
CHKUCB5B LM    R0,R15,SAVEREGS
         L     R15,UCBR15
         BR    R15
         EJECT
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 CLC   0(2,R9),=X'FFFF'    .END OF TABLE
         BE    UCBDMOUT            .YES, GO PROCESS
         SR    R1,R1
         ICM   R1,3,0(R9)          .LOAD UCB ADDR
         LTR   R1,R1               .ZERO ADDR
         BNZ   UCBDML#4            .NO, CONTINUE
         SPACE 1
UCBDML#3 LA    R9,2(0,R9)          .NEXT UCB LOOKUP TABLE ENTRY
         B     UCBDML#2
         SPACE 1
UCBDML#4 CLI   18(R1),X'10'        GRAPHICS
         BE    UCBDML#3            YES, NEXT UCB
         CLI   18(R1),X'40'        COMM
         BE    UCBDML#3            YES, NEXT UCB
         TM    6(R1),X'8A'         BUSY AND/OR CHANNEL PROGRAM ACTIVE
         BZ    UCBDML#3            NO, NEXT UCB
         BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#3            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         MVC   UCBDMCUR+2(2),0(R9) .SET NEXT LEAST HIGH UCB ADDR
         B     UCBDMOUT            .GO PROCESS
         EJECT
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         EJECT
UCBBUSY  LA    R6,UCBTABB
         MVC   CURRUNIT(3),=X'FFFFFF'
         XC    CURRCNT(4),CURRCNT
         SPACE 1
UCBBUSY1 LA    R6,22(0,R6)
         MVC   QDMSG(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY1            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY3            YES
         CLC   CURRUNIT(2),0(R6)   CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         SR    R14,R14
         IC    R14,CURRUNIT+2
         SR    R15,R15
         IC    R15,2(0,R6)
         SLL   R14,28
         SRL   R14,28
         SLL   R15,28
         SRL   R15,28
         TM    CURRUNIT+2,X'F0'    NUMERIC
         BO    *+8                 NO
         LA    R14,9(0,R14)
         TM    2(R6),X'F0'         NUMERIC
         BO    *+8                 NO
         LA    R15,9(0,R15)
         CR    R14,R15             CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         LH    R1,CURRCNT
         AH    R1,18(0,R6)
         STH   R1,CURRCNT
         LH    R1,CURRCNT+2
         AH    R1,20(0,R6)
         STH   R1,CURRCNT+2
         B     UCBBUSY1
         SPACE 1
UCBBUSY2 MVC   CURRUNIT(3),0(R6)
         MVC   CURRVOL(6),4(R6)
         MVC   CURRCNT(4),18(R6)
         B     UCBBUSY1
         SPACE 1
UCBBUSY3 CLC   CURRUNIT(3),=X'FFFFFF'   END OF LIST
         BE    RETURN
         MVC   DEVSTRT(3),CURRUNIT UNIT ADDR
         MVI   DEVSTRT+3,C' '
         MVC   DEVSTRT+4(6),CURRVOL VOLSER
         SR    R14,R14
         LH    R15,CURRCNT         UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,CURRCNT+2       UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LR    R15,R1
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         BAL   R9,DISPLAY
         CLI   DSPSW,C'S'          SEEK ANALYSIS
         BE    UCBSEEK             YES
         LA    R6,UCBTABB
         SPACE 1
UCBBUSY4 LA    R6,22(0,R6)
         MVC   QDMSG(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY4            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY             YES
         CLC   CURRUNIT(3),0(R6)   CURRENT UNIT CHECK
         BNE   UCBBUSY4            NO MATCH
         CLI   DSPSW,C'J'          JOB DISPLAY
         BNE   UCBBUSY5            NO
         MVC   DEVSTRT+3(8),10(R6)   JOBNAME
         MVC   DEVSTRT(3),=C'-- '
         MVC   DEVSTRT+11(4),=CL4' '
         SR    R14,R14
         LH    R15,18(0,R6)        UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,20(0,R6)        UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         BAL   R9,DISPLAY
         MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY4
         SPACE 1
UCBBUSY5 MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY
         SPACE 3
PCTMVE   MVC   PCTGRAPH(0),PCTLINE
         EJECT
UCBSEEK  MVC   QDHLINE(80),SEEKHDR
         BAL   R9,DISPLAY
         L     R4,SEEKTABA         SEEK TABLE ADDR
         SR    R5,R5
         LA    R6,100
         SPACE 1
UCBSEEK0 LA    R7,10               CYL PER LINE
         LA    R8,QDMSG+12
         SR    R9,R9               TOTAL
         CVD   R5,DOUBLE           CYL ADDR
         MVC   QDMSG(80),QBLANK
         UNPK  QDMSG(3),DOUBLE+6(2)
         OI    QDMSG+2,X'F0'
         SPACE 1
UCBSEEK1 SR    R14,R14
         L     R15,0(0,R4)         CYLINDER ACCESS COUNT
         A     R9,0(0,R4)          TOTAL CYLINDER ACCESS COUNT
         LTR   R15,R15             ANY ACCESS
         BNZ   UCBSEEK4            YES
         SPACE 1
UCBSEEK2 LA    R5,1(0,R5)          ADD TO CYL COUNT
         LA    R4,4(0,R4)          NEXT CYL
         LA    R8,7(0,R8)          NEXT PRINT ADDR
         BCT   R7,UCBSEEK1
         LTR   R15,R9              TOTAL FOR CYL RANGE
         BZ    UCBSEEK3
         M     R14,=F'100'
         D     R14,SEEKTOT
         CVD   R15,DOUBLE
         MVC   QDMSG+5(5),=X'402021206C'
         ED    QDMSG+5(4),DOUBLE+6
         BAL   R9,DISPLAY
         SPACE 1
UCBSEEK3 BCT   R6,UCBSEEK0
         B     RETURN
         SPACE 1
UCBSEEK4 M     R14,=F'100'
         D     R14,SEEKTOT
         CVD   R15,DOUBLE
         MVC   0(5,R8),=X'402021206C'
         ED    0(4,R8),DOUBLE+6
         B     UCBSEEK2
         EJECT
MSGRTN   EQU   *
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   CLI   NFNDSW,X'00'        ANY OUTPUT
         BNE   RETURN1             YES
         MVC   QDHLINE(44),NFNDMSG
         MVC   QDMSG(80),QBLANK
         BAL   R9,DISPLAY
         SPACE 3
RETURN1  EQU   *
         SPACE 3
EXIT     EQU   *
         L     R0,SIZEJOB          LOAD GETMAIN SIZE AND SUBPOOL
         L     R1,EXTRAREA         LOAD GETMAIN AREA ADDR
         FREEMAIN R,LV=(0),A=(1)
         QSTOP
         EJECT
         LTORG
         DS    0D
INTERVL  DC    CL8'00000020' 2/10TH  SEC
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
SIZEJOB  DC    X'00',AL3(JOBTABE-JOBTABS)
         SPACE 3
DEVOVLY  DC    CL80'UUU VVVVVV BUSY NNN/NNN%'
         SPACE 3
SEEKHDR  DC    CL80'CYL    ALL    --0    --1    --2    --3    --4    --X
               5    --6    --7    --8    --9'
         SPACE 3
PCTLINE  DC    CL51'0====1====2====3====4====5====6====7====8====9===='
         SPACE 3
         DS    0F
NFNDMSG  DC    CL44'UNIT SPECIFIED NOT FOUND OR 00% BUSY'
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
EXTRAREA DS    F
UCBR15   DS    F
CHKR15   DS    F
CHNR15   DS    F
CHDR15   DS    F
XTIME    DS    2F
SEEKTABA DS    F
SEEKTOT  DS    F
DSPSW    DS    C
NFNDSW   DS    C
CHANNEL  DS    C
CURRUNIT DS    CL3
CURRVOL  DS    CL6
CURRCNT  DS    F
PARM     DS    F
         SPACE 3
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 5
         DS    0F
DEVSTRT  EQU   QDMSG,8
BUSY     EQU   QDMSG+15,8
PCTGRAPH EQU   QDMSG+25,51
         SPACE 3
WORKEND  DS    0F
JOBTABS  DSECT
         DS    0F
UCBTABB  DS    CL22          FOR ADDRESSING OFFSET -22
UCBTAB   DS    2000CL22
         SPACE 3
SEEKTAB  DS    1000F
JOBTABE  DS    0F
         EJECT
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
         END
./       ADD   NAME=DISPLAY
DISPLAY  QSTART 'QUEUE COMMAND - 3270 DISPLAY ROUTINES'
***********************************************************************
* RNB CHANGES:                                                        *
*     (1) RNB13 - MODIFICATIONS TO FIX PROBLEMS WITH TCAM FULL-SCREEN *
*                 PROCESSING OF TEST-REQUEST, SYSTEM REQUEST, AND THE *
*                 PA2/PA3 KEYS.                                       *
*     (2) RNB14 - MODIFICATIONS TO FIX PROBLEMS FULL-SCREEN           *
*                 PROCESSING. THIS ONE ALLOWS THE USER TO TYPE IN THE *
*                 TOP COMMAND LINE WITHOUT QUEUE MISINTERPRETING WHAT *
*                 WAS ENTERED. (TRY THE DO COMMAND FROM BOTH PLACES   *
*                 WITHOUT THE MOD TO SEE THE EFFECT.)                 *
*     (3) RNB15 - RESTORE PFK DEFINITIONS FOR PF7 AND PF8 TO ORIGINAL *
*                 ICBC VALUES OF -27 AND +27. WE DON'T HAVE THE OTHER *
*                 3278 MODELS, AND PARTIAL SCROLLING IS EASIER AND    *
*                 MORE SPF CONSISTENT WITH THE ORIGINAL VALUES. ONLY  *
*                 IF QRNB=1.                                          *
* EAM CHANGES:                                                        *
*  1.  MODIFICATIONS TO SUPPORT QUEUE ON TTY CRT DEVICE               *
*  2.  ALTERNATE NUMBER OF LINES TO BE DISPLAYED                      *
*  3.  ALTERNATE LINE WIDTH SUPPORTED                                 *
* DOR CHANGES:                                                        *
*  1. MODIFICATIONS TO SUPPORT ISPF INTERFACE                         *
*  2. SPLIT SCREEN ALTERNATED NUMBER OF LINES                         *
*  3. INSTALLATION WITH QISPF=1                                       *
* DOR CHANGES: 6/2/87                                                 *
*  1. ADD  SYSTEM ID ON FIRST LINE OF QUEUE SCREEN                    *
***********************************************************************
         GBLB  &QPFK          PF-KEY OPTION. DEFINED BY QSTART     ICBC
         GBLB  &QISPF          DIAGLOG MANAGEMENT INTERFACE        DOR
         GBLB  &QRNB                                              RNB13
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL     ADDR OF DISPLAY WORK AREA
         USING QCPRINT,R9     BASE REG FOR PRINT   WORK AREA       FCI*
         L     R9,QVPRINT     ADDR OF PRINT   WORK AREA            FCI*
         USING QDQTTY,R8
         L     R8,QVDQTTY
***********************************************************************
*                                                                     *
*   CHECK FOR ROOM ON SCREEN                                          *
*                                                                     *
***********************************************************************
         MVI   QDOVER,0       ZERO OUT THE PAGE OVERFLOW INDICATOR
         MVI   QDPLUS,C' '    BLANK THE OVERFLOW INDICATOR
         LH    R4,QDMLNG      LOAD MSG LENGTH
         MVC   QPRSAVE,QDTLINE        SAVE SUBTITLE LINE ON ENTRY  FCI*
         LTR   R4,R4          IS MSG LENGTH ZERO?
         BZ    WRTSCR
NOTMSG   DS    0H
         MVI   QDPLUS,C'+'    INDICATE SCREEN OVERFLOW
         LH    R1,QDNEXT      GET NUMBER OF LINES.                EAM
         LA    R1,1(R1)       CURRENT LINE NUMBER ON SCREEN       EAM
         ZAP   QDWORK,QDLNES  GET NUMBER OF LINES                 EAM
         CVB   R2,QDWORK      FIX IT SO WE CAN WORK WITH IT.      EAM
         CR    R1,R2          IS THERE ROOM ON THE SCREEN?        EAM
         BH    WRTSCR         NO. WRITE SCREEN.
***********************************************************************
*                                                                     *
*   MOVE THE MESSAGE TO THE SCREEN                                    *
*                                                                     *
***********************************************************************
DSP2     LH    R7,QDMLNG      LOAD MESSAGE LENGTH
         LTR   R7,R7          IS MESSAGE LENGTH ZERO?
         BZ    RETURN         YES. RETURN.
         BCTR  R7,0           SUB FOR EX.                         EAM
         LH    R4,QDNEXT      LOAD CURRENT SCREEN LINE NUMBER     EAM
         LR    R1,R4          SAVE LINE NUMBER                    EAM
         MH    R4,=H'80'      MULT. BY BUFFER LENGTH.             EAM
         LA    R5,QDLINE1     LOAD ADDRESS                        EAM
         AR    R4,R5                      OF NEXT LINE.           EAM
         L     R6,QDMSGA      LOAD ADDR OF MESSAGE                EAM
DSP4     LA    R1,1(R1)       UPDATE LINE NUMBER                  EAM
         STH   R1,QDNEXT      STORE LINE NUMBER                   EAM
MVCMSG   MVC   0(1,R4),0(R6)  MOVE THE MESSAGE TO THE SCREEN      EAM
         EX    R7,MVCMSG                                          EAM
***********************************************************************
*                                                                     *
*   RETURN TO CALLER                                                  *
*                                                                     *
***********************************************************************
RETURN   QSTOP
***********************************************************************
*                                                                     *
*   WRITE A FULL SCREEN, WAIT FOR REPLY                               *
*                                                                     *
***********************************************************************
WRTSCRTR TR    0(*-*,R1),TABLE  FIX UNPRINTABLES                  UF003
WRTSCR   DS    0H                                                 EAM
         LA    R1,QDLINE1                                         EAM
         ZAP   QDWORK,QDLNES  GET NUMBER OF LINES                 EAM
         CVB   R2,QDWORK      FIX IT SO WE CAN WORK WITH IT.      EAM
         LH    R14,QDLNELEN                                       EAM
         BCTR  R14,0                                              EAM
WRTSCR1  DS    0H                                                 EAM
         EX    R14,WRTSCRTR                                       EAM
         LA    R1,80(R1)                                          EAM
         BCT   R2,WRTSCR1                                         EAM
TPUTSCRN DS    0H                                                 UF003
           AIF (NOT &QISPF).NOISPF                                DOR
PHASE2  EQU   * THIS SECTION IS FOR INTERFACE WITH ISPF DIALOG MGMTDOR
         L     R15,=V(QDISP)                                       DOR
         BALR  R8,R15                                              DOR
         MVC  QISP#,=CL8' '                                        DOR
         LH   R1,QDRLNG        STORE LENGTH OF REPLY              DOR
PHASE    CH   R1,=H'12'                                            DOR
         BNE  NOCLEAR                                              DOR
         TCLEARQ INPUT                                             DOR
NOCLEAR  EQU *                                                     DOR
           AGO .ISPF                                               DOR
.NOISPF    ANOP                                                    DOR
         CLI   QTTY,X'01'
         BNE   TPUTFULL
         MVC   QPLINE,QBLANK                   RECONSTRUCT IMAGE   FCI*
         MVC   QPLINE(15),=C'QUEUE COMMAND -'    OF HEADER LINE    FCI*
         MVC   QPLINE+16(L'QPRSAVE),QPRSAVE        WITHOUT 3270    FCI*
         PUT   SYSPRINT,QPDETAIL                      CONTROL CHARS
         EJECT ,                                                   FCI*
*******************************************************************FCI*
*  PUT OUT ENTIRE SCREEN OF DETAIL LINES (BLANK OR NOT)            FCI*
*******************************************************************FCI*
         ZAP   QDWORK,QDLNES
         CVB   R3,QDWORK         GET NUMBER OF LINES              EAM
         LH    R7,QDLNELEN       LINE LENGTH                      UF003
         BCTR  R7,0
         MVI   QPDETAIL,X'40'    BLANK
         MVC   QPLINE,QPDETAIL         PUTLINE.
MVCHEAD  MVC   QPLINE(1),QDHLINE MOVE HEADING LINE TO BUFFER      UF003
         EX    R7,MVCHEAD                                         EAM
         PUT   SYSPRINT,QPDETAIL PRINT THE LINE                   UF003
         LH    R1,QDNEXT                                          EAM
         LTR   R1,R1                                              EAM
         BZ    REPLNE                                             EAM
         LA    R2,QDLINE1        LOAD ADDRESS OF FIRST LINE       UF003
PUTLOOP  DS    0H                                                 EAM
         EX    R7,CLCMVC         COMPARE FOR BLANKS.              EAM
         BE    BYPASS                                             EAM
         EX    R7,PUTMVC         MOVE LINE TO BUFFER              UF003
         PUT   SYSPRINT,QPDETAIL PUT DETAIL LINE OUT               FCI*
BYPASS   DS    0H                                                 EAM
         LA    R2,80(R2)         POINT TO NEXT LINE               EAM
         BCT   R3,PUTLOOP        AND GRIND THE SCREEN THROUGH      FCI*
REPLNE   DS    0H                                                  FCI*
         MVC   QPLINE,QBLANK                   RECONSTRUCT IMAGE   FCI*
         MVC   QPLINE(07),=C'REPLY -'            OF COMMAND LINE   FCI*
         MVC   QPLINE+08(L'QDREPLY),QDREPLY        WITHOUT 3270    FCI*
         MVC   QPLINE+72(1),QDPLUS                   CONTROL CHARS FCI*
         PUT   SYSPRINT,QPDETAIL                       AND PRINT IT
         GET   SYSIN,QDREPLY
         LA    R1,QDREPLY+62
COMBLK   CLC   0(,R1),=C' '
         BE    REPLOOP
         LA    R3,QDREPLY-1
         SR    R1,R3
         B     NOTXT2
REPLOOP  BCT   R1,COMBLK
         SR    R1,R1
         B     NOTXT2
PUTMVC   MVC   QPLINE(1),0(R2)  EXECUTED MOVE                     UF003
CLCMVC   CLC   0(1,R2),QBLANK                                     EAM
TPUTFULL LH    R0,QDSCRPLN    LOAD LENGTH FOR TPUT                UF003
         TPUT  QDSCREEN,(0),FULLSCR,MF=(E,QTPUT)                  UF003
         MVC   QDTLINE,QPRSAVE        RESTORE SUBTITLE INFO        FCI*
         AIF  (&QPFK).PFK1    SKIP NON-PFK CODE                    ICBC
         TGET  QDREPLY,63,EDIT,MF=(E,QTGET)
         CH    R15,=H'12'     IS INPUT LONGER THAN BUFFER?
         BNE   NOCLEAR        NO. CONTINUE.
         TCLEARQ INPUT        CLEAR THE QUEUE
NOCLEAR  STH   R1,QDRLNG      STORE LENGTH OF REPLY
         AGO   .PFK2                                               ICBC
.PFK1    ANOP                                                      ICBC
         LA    R6,QDREPLY                                          ICBC
         XC    PFREPLY,PFREPLY                                     ICBC
         XC    QDREPLY,QDREPLY                                     ICBC
         TGET  PFREPLY,69,ASIS,MF=(E,QTGET)
         CH    R15,=H'12'     IS INPUT LONGER THAN BUFFER?         ICBC
         BNE   NOCLEAR        NO. CONTINUE.                        ICBC
         TCLEARQ INPUT        CLEAR THE QUEUE                      ICBC
NOCLEAR  IC    R4,PFCODE                                           ICBC
         XR    R5,R5                                               ICBC
         CLI   PFCODE,X'F0'      TEST-REQ/SYS-REQ?                RNB13
         BE    ENTKEY            /YES - TREAT AS ENTER            RNB13
         CLI   PFCODE,X'01'      OTHER KIND OF SYS-REQ?           RNB13
         BE    ENTKEY            /YES - TREAT AS ENTER            RNB13
         CLI   PFCODE,X'6E'      PA2?                             RNB13
         BE    TPUTSCRN          /YES - GO RESHOW SCREEN          RNB13
         CLI   PFCODE,X'6B'      PA3?  (TCAM GENERATED)           RNB13
         BE    TPUTSCRN          /YES - GO RESHOW SCREEN          RNB13
         N     R4,=X'0000000F'   EXTRACT PF-KEY NUMBER             ICBC
         CH    R4,=H'12'                                           ICBC
         BH    ENTKEY           "ENTER" KEY                        ICBC
         BCTR  R4,0                                                ICBC
         SLL   R4,3              TIMES SIZE OF AN ENTRY           UF043
         LA    R5,QDPFKTAB                                        UF043
         LA    R5,0(R4,R5)                                         ICBC
         LA    R5,0(R4,R5)                                         ICBC
         MVC   QDREPLY(5),0(R5)  MOVE PF-KEY VALUE                 ICBC
         LA    R5,5                                                ICBC
         LA    R6,3(,R6)                                           ICBC
         SH    R1,=H'3'          ALLOW USER TO INPUT ON EITHER    RNB14
         BZ    NOTXT             THE TOP OR BOTTOM COMMAND LINE   RNB14
         MVC   0(60,R6),PFTXT                                     RNB14
         LA    R5,3                                               RNB14
         SH    R1,=H'3'                                           RNB14
         B     NOTXT                                              RNB14
ENTKEY   EQU   *                                                   ICBC
         SH    R1,=H'3'                                            ICBC
         BZ    NOTXT                                               ICBC
         MVC   0(63,R6),PFTXT                                     RNB14
         SH    R1,=H'3'                                            ICBC
NOTXT    LA    R1,0(R5,R1)                                         ICBC
NOTXT2   STH   R1,QDRLNG      STORE LENGTH OF REPLY                ICBC
.PFK2    ANOP                                                      ICBC
.ISPF    ANOP                                                      DOR
         OC    QDREPLY,QBLANK     UPPERCASE THE COMMAND            FCI*
         CLC   QDREPLY(2),=CL2'PR' POSSIBLE PRINT COMMAND      PWF FCI*
         BNE   CLSCRN             NOPE..SPLIT NORMALLY             FCI*
*                                                                  FCI*
         L     R15,=V(PRINT)  FETCH PRINT ENTRY ADDRESS            FCI*
         BALR  R14,R15        AND CALL HIM                         FCI*
         LTR   R15,R15        HOW IS HIS RETURN CODE               FCI*
         BNZ   CLSCRN         NOTHING TO REPORT                    FCI*
*                                                                  FCI*
         B     TPUTSCRN       GO REPOST SCREEN                     FCI*
CLSCRN   LA    R4,QDLINE1     LOAD ADDRESS OF FIRST LINE           FCI*
         LA    R5,21          LOAD LENGTH OF SCREEN               UF003
         SR    R6,R6          NO SENDING FIELD NEEDED              FCI*
         STH   R6,QDNEXT      STORE ZERO IN LINE NUMBER            FCI*
         SR    R7,R7          FILL SCREEN WITH NULLS               FCI*
         MVCL  R4,R6          CLEAR THE SCREEN                     FCI*
         LH    R5,QDSCRLEN    LOAD LENGTH OF SCREEN               UF003
*
         LH    R1,QDRLNG      STORE LENGTH OF REPLY
         LTR   R1,R1          WAS THERE A RESPONSE FROM USER?
         BNZ   INTER          YES. INTERRUPT PROCESSING.
         MVI   QDOVER,1       INDICATE PAGE OVERFLOW
         B     DSP2           CONTINUE PROCESSING
INTER    L     R13,QFRSTSA    GO BACK TO MAIN MODULE
         LM    R14,R12,12(R13) RESTORE REGISTERS FROM FIRST SAVEAREA
         BR    R10            ADDRESS OF INTERRUPT HANDLER IN QUEUE
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
* TABLE OF PRINTABLE CHARACTERS
TABLE    DC    CL64' '
         DC    191AL1(*-TABLE)  REST OF TABLE IS OK               UF003
         DC    C' '              EXCEPT FOR X'FF'                 UF031
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=DISPLOLD
DISPLAY  TITLE 'QUEUE COMMAND - 3270 DISPLAY ROUTINES'            ONL01
DISPLAY  QSTART ,                  START DISPLAY CSECT ASSEMBLY   ONL01
***********************************************************************
* RNB CHANGES:                                                        *
*     (1) RNB13 - MODIFICATIONS TO FIX PROBLEMS WITH TCAM FULL-SCREEN *
*                 PROCESSING OF TEST-REQUEST, SYSTEM REQUEST, AND THE *
*                 PA2/PA3 KEYS.                                       *
*     (2) RNB14 - MODIFICATIONS TO FIX PROBLEMS FULL-SCREEN           *
*                 PROCESSING. THIS ONE ALLOWS THE USER TO TYPE IN THE *
*                 TOP COMMAND LINE WITHOUT QUEUE MISINTERPRETING WHAT *
*                 WAS ENTERED. (TRY THE DO COMMAND FROM BOTH PLACES   *
*                 WITHOUT THE MOD TO SEE THE EFFECT.)                 *
***********************************************************************
         GBLB  &QPFK          PF-KEY OPTION. DEFINED BY QSTART     ICBC
         GBLB  &QNERDC                                            UF040
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL     ADDR OF DISPLAY WORK AREA
         USING QCPRINT,R9     BASE REG FOR PRINT   WORK AREA       FCI*
         L     R9,QVPRINT     ADDR OF PRINT   WORK AREA            FCI*
***********************************************************************
*                                                                     *
*   CHECK FOR ROOM ON SCREEN                                          *
*                                                                     *
***********************************************************************
         MVI   QDOVER,0       ZERO OUT THE PAGE OVERFLOW INDICATOR
         MVI   QDPLUS,C' '    BLANK THE OVERFLOW INDICATOR
         LH    R4,QDMLNG      LOAD MSG LENGTH
         CH    R4,QDSCRLEN    IS THE MSG LENGTH > SCRSIZE?        UF003
         BH    RETURN         YES. GO AWAY.
         MVC   QPRSAVE,QDTLINE        SAVE SUBTITLE LINE ON ENTRY  FCI*
         LTR   R4,R4          IS MSG LENGTH ZERO?
         BZ    WRTSCR         YES. WRITE SCREEN.
         MVI   QDPLUS,C'+'    INDICATE SCREEN OVERFLOW
         AH    R4,QDNEXT      ADD CURRENT LOCATION ON SCREEN
         CH    R4,QDSCRLEN    IS THERE ROOM ON THE SCREEN?        UF003
         BH    WRTSCR         NO. WRITE SCREEN.
***********************************************************************
*                                                                     *
*   MOVE THE MESSAGE TO THE SCREEN                                    *
*                                                                     *
***********************************************************************
DSP2     LH    R7,QDMLNG      LOAD MESSAGE LENGTH
         LTR   R7,R7          IS MESSAGE LENGTH ZERO?
         BZ    RETURN         YES. RETURN.
         LH    R4,QDNEXT      LOAD CURRENT SCREEN LINE NUMBER
         LR    R1,R4          SAVE LINE NUMBER
         LA    R4,QDLINE1(R4) LOAD ADDRESS OF NEXT LINE
         L     R6,QDMSGA      LOAD ADDR OF MESSAGE
         LH    R5,QDLNELEN    LENGTH MUST BE MULTIPLE OF LINESIZE UF003
DSP3     CR    R5,R7          IS 5 NOT LESS THAN 7?
         BNL   DSP4           YES. GO DO IT.
         AH    R5,QDLNELEN    INCR BY LINE LENGTH                 UF003
         B     DSP3           TRY AGAIN
DSP4     AR    R1,R5          UPDATE LINE NUMBER
         STH   R1,QDNEXT      STORE LINE NUMBER
         MVCL  R4,R6          MOVE THE MESSAGE TO THE SCREEN
***********************************************************************
*                                                                     *
*   RETURN TO CALLER                                                  *
*                                                                     *
***********************************************************************
RETURN   QSTOP
***********************************************************************
*                                                                     *
*   WRITE A FULL SCREEN, WAIT FOR REPLY                               *
*                                                                     *
***********************************************************************
WRTSCR   LA    R1,QDLINE1     ENSURE PRINTABILITY                 UF003
         LH    R15,QDSCRLEN   LENGTH TO XLATE                     UF003
         LA    R14,255        SET FOR EXECUTE                     UF003
WRTSCR1  CR    R15,R14        SEE IF ONLY ONE NEEDED              UF003
         BNH   WRTSCRN        YES, DO IT                          UF003
         EX    R14,WRTSCRTR   TRANSLATE PART OF BUFFER            UF003
         LA    R1,1(R1,R14)   POINT TO NEXT SLOT                  UF003
         SR    R15,R14        DROP FOR LENGTH DONE                UF003
         BCTR  R15,0          END FOR EXECUTE FIX                 UF003
         B     WRTSCR1        LOOP TILL DONE                      UF003
         SPACE 1                                                  UF003
WRTSCRTR TR    0(*-*,R1),TABLE  FIX UNPRINTABLES                  UF003
         SPACE 1                                                  UF003
WRTSCRN  BCTR  R15,0          DROP FOR EXECUTE                    UF003
         LTR   R15,R15        TEST FOR NULL                       UF003
         BM    *+8            SKIP IF NULL                        UF003
         EX    R15,WRTSCRTR   TRANSLATE END OF BUFFER             UF003
         SPACE 1                                                  UF003
TPUTSCRN DS    0H                                                 UF003
         LH    R0,QDSCRPLN    LOAD LENGTH FOR TPUT                UF003
         TPUT  QDSCREEN,(0),FULLSCR,MF=(E,QTPUT)                  UF003
         MVC   QDTLINE,QPRSAVE        RESTORE SUBTITLE INFO        FCI*
         AIF  (&QPFK).PFK1    SKIP NON-PFK CODE                    ICBC
         TGET  QDREPLY,63,EDIT,MF=(E,QTGET)
         CH    R15,=H'12'     IS INPUT LONGER THAN BUFFER?
         BNE   NOCLEAR        NO. CONTINUE.
         TCLEARQ INPUT        CLEAR THE QUEUE
NOCLEAR  STH   R1,QDRLNG      STORE LENGTH OF REPLY
         AGO   .PFK2                                               ICBC
.PFK1    ANOP                                                      ICBC
         LA    R6,QDREPLY                                          ICBC
         XC    PFREPLY,PFREPLY                                     ICBC
         XC    QDREPLY,QDREPLY                                     ICBC
         TGET  PFREPLY,69,ASIS,MF=(E,QTGET)
         CH    R15,=H'12'     IS INPUT LONGER THAN BUFFER?         ICBC
         BNE   NOCLEAR        NO. CONTINUE.                        ICBC
         TCLEARQ INPUT        CLEAR THE QUEUE                      ICBC
NOCLEAR  IC    R4,PFCODE                                           ICBC
         XR    R5,R5                                               ICBC
         CLI   PFCODE,X'F0'      TEST-REQ/SYS-REQ?                RNB13
         BE    ENTKEY            /YES - TREAT AS ENTER            RNB13
         CLI   PFCODE,X'01'      OTHER KIND OF SYS-REQ?           RNB13
         BE    ENTKEY            /YES - TREAT AS ENTER            RNB13
         CLI   PFCODE,X'6E'      PA2?                             RNB13
         BE    TPUTSCRN          /YES - GO RESHOW SCREEN          RNB13
         CLI   PFCODE,X'6B'      PA3?  (TCAM GENERATED)           RNB13
         BE    TPUTSCRN          /YES - GO RESHOW SCREEN          RNB13
         N     R4,=X'0000000F'   EXTRACT PF-KEY NUMBER             ICBC
         CH    R4,=H'12'                                           ICBC
         BH    ENTKEY           "ENTER" KEY                        ICBC
         BCTR  R4,0                                                ICBC
         SLL   R4,3              TIMES SIZE OF AN ENTRY           UF043
         LA    R5,QDPFKTAB                                        UF043
         LA    R5,0(R4,R5)                                         ICBC
         MVC   QDREPLY(8),0(R5)  MOVE PF-KEY VALUE                UF043
         LA    R5,8                                               UF043
         LA    R6,6(,R6)                                          UF043
         SH    R1,=H'3'          ALLOW USER TO INPUT ON EITHER    UF043
         BZ    NOTXT             THE TOP OR BOTTOM COMMAND LINE   RNB14
         MVC   0(57,R6),PFTXT                                     UF043
         LA    R5,6                                               UF043
         SH    R1,=H'3'                                           UF043
         B     NOTXT                                              RNB14
ENTKEY   EQU   *                                                   ICBC
         SH    R1,=H'3'                                            ICBC
         BZ    NOTXT                                               ICBC
         MVC   0(63,R6),PFTXT                                     RNB14
         SH    R1,=H'3'                                            ICBC
NOTXT    LA    R1,0(R5,R1)                                         ICBC
         STH   R1,QDRLNG      STORE LENGTH OF REPLY                ICBC
.PFK2    ANOP                                                      ICBC
         OC    QDREPLY,QBLANK     UPPERCASE THE COMMAND            FCI*
         CLC   QDREPLY(2),=CL2'PR' POSSIBLE PRINT COMMAND      PWF FCI*
         BNE   CLSCRN             NOPE..SPLIT NORMALLY             FCI*
*                                                                  FCI*
         L     R15,=V(PRINT)  FETCH PRINT ENTRY ADDRESS            FCI*
         BALR  R14,R15        AND CALL HIM                         FCI*
         LTR   R15,R15        HOW IS HIS RETURN CODE               FCI*
         BNZ   CLSCRN         NOTHING TO REPORT                    FCI*
*                                                                  FCI*
         B     TPUTSCRN       GO REPOST SCREEN                     FCI*
CLSCRN   LA    R4,QDLINE1     LOAD ADDRESS OF FIRST LINE           FCI*
         LH    R5,QDSCRLEN    LOAD LENGTH OF SCREEN               UF003
         SR    R6,R6          NO SENDING FIELD NEEDED              FCI*
         STH   R6,QDNEXT      STORE ZERO IN LINE NUMBER            FCI*
         SR    R7,R7          FILL SCREEN WITH NULLS               FCI*
         MVCL  R4,R6          CLEAR THE SCREEN                     FCI*
*
         LH    R1,QDRLNG      STORE LENGTH OF REPLY
         LTR   R1,R1          WAS THERE A RESPONSE FROM USER?
         BNZ   INTER          YES. INTERRUPT PROCESSING.
         MVI   QDOVER,1       INDICATE PAGE OVERFLOW
         B     DSP2           CONTINUE PROCESSING
INTER    L     R13,QFRSTSA    GO BACK TO MAIN MODULE
         LM    R14,R12,12(R13) RESTORE REGISTERS FROM FIRST SAVEAREA
         BR    R10            ADDRESS OF INTERRUPT HANDLER IN QUEUE
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
* TABLE OF PRINTABLE CHARACTERS
TABLE    DC    CL64' '
         DC    191AL1(*-TABLE)  REST OF TABLE IS OK               UF003
         DC    C' '              EXCEPT FOR X'FF'                 UF031
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=DOMAIN
*   DEVELOPED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/11/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
DOMAIN  TITLE 'QUEUE COMMAND - DISPLAY DOMAIN'
DOMAIN  QSTART ,                  START DOMAIN DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   - DMDT
*    R5   - FIELD EXTRACTED FROM DMDT
*    R6   - OUTPUT POINTER
*    R7   -
*    R8   -
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***********************************************************************
         CLC   QSUBNAME(8),OLDNAME
         BE    SAMECMD
         MVI   COPYDSWT,X'00'
         MVC   OLDNAME(8),QSUBNAME
SAMECMD  CLI   COPYDSWT,X'FF'
         BE    HAVEDMNT
         SETAUTH ON
         MODESET  KEY=ZERO,MODE=SUP
         LA    R1,COPYDMNT
         OI    0(R1),X'40'    SET DATAAREA SIZE
         LA    R0,40          COPYDMNT SYSEVENTCODE
         L     R15,16         CVT ADDRESS
         L     R15,536(,R15)  SYSEVENT ROUTINE
         BALR  R14,R15        BRANCH TO SYSEVENT
         MODESET  KEY=NZERO,MODE=PROB
         SETAUTH OFF
         MVI   COPYDSWT,X'FF' SET TO SYSEVENT AT A TIME
HAVEDMNT EQU   *
         MVI   TSOSW,C' '
         LA    R3,QPARM1           PARM LIST ADDR
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'T'          TSO RTO
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'P'          PERFORM GROUP DESCRIPTION DISPLAY
         BE    PARM2               YES, CONTINUE
*        CHECK IF DOMAIN NUMBER ENTERED ONE OR TWO DIGITS.
         CLI   QPARM1,C' '
         BE    PARM1
         LA    R1,2                MAX TWO  DIGITS
         SR    R5,R5
         LH    R5,QLNG1            LOAD NO OF DIGITS
         CR    R5,R1
         BE    DMND3               TWO   IS THE SAME
         BH    PARM1               AMBIGIOUS LENGTH DEFAULT ALL
         SR    R1,R5               LESS OFFSET
         LA    R14,TSOSW
         MVC   0(2,R14),=CL3'000'
         AR    R14,R1
         EX    R5,DMNMVC
         B     DMND3
DMNMVC   MVC   0(*-*,R14),QPARM1
DMND3    MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STH   R1,DOMNUM           SAVE DOMAIN
         MVI   TSOSW,C'X'
         B     PARM2
         SPACE 1
PARM1    MVI   TSOSW,C' '
         SPACE 1
PARM2    MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(80),LINE1
         MVC   QDHLINE+12(8),COPYIPS
         MVC   QDHLINE+26(8),COPYOPT
         MVC   QDHLINE+40(8),COPYICS
         MVI   SCANRET,C' '        SET FOUND
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
         CLI   TSOSW,C'P'
         BE    SHOWPGD
         EJECT
         L     R4,16               CVT
         USING CVTDSECT,R4         ADDRESSING                     DOR
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         DOR
         USING RMCT,R4             ADDRESSING                     DOR
         L     R4,RMCTDMDT         POINT TO SRM DMDT              DOR
         ST    R4,DMNTADDR
         L     R15,RMCTDMDE
         ST    R15,DMNTEND
         SR    R15,15
         ICM   R15,3,RMCTDMNC
         ST    R15,DMNTNUM
         USING DMNDSECT,R4         ADDRESSING FOR DMDT (FINALLY)   DOR
         EJECT
         CLI   TSOSW,C'T'
         BNE   NOTSOX
         MVC   QDMSG(80),HDRDT1
         BAL   R9,DISPLAY
         MVC   QDMSG(80),HDRDT2
         B     SHOWHDR
NOTSOX   MVC   QDMSG(80),HDRD1
         BAL   R9,DISPLAY
         MVC   QDMSG(80),HDRD2
SHOWHDR  BAL   R9,DISPLAY
         LA    R8,1
DMNCHK1  EQU   *
         LA    R6,DMNLIST-2
         CLC   0(24,R4),=6F'0'     ANY TIME IN THIS DOMAIN
         BE    DMNCHKX             NO
         CLI   TSOSW,C'T'
         BNE   NOTSO
         TM    DMDTFLGS,X'80'      LOOK FOR RTO DOMAIN
         BNO   DMNCHKM
NOTSO    EQU   *
* ---------------------------------------------------------------
         SR    R5,R5
         SPACE 1
         IC    R5,DMDTNO         DOMAIN NUMBER
         CLI   TSOSW,C'X'
         BNE   NODOMSEL
         CH    R5,DOMNUM
         BNE   DMNCHKM
NODOMSEL BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         IC    R5,DMDTLO         MIN MPL LEVEL
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         IC    R5,DMDTHI         MAX MPL LEVEL
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTMPLT       CURRENT MPL TARGET
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTCMPL       CURRENT MPL
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTRUA        AVG OF # READY USERS
         A     R5,=F'8'
         SRL   R5,4                DIVIDE BY 16
         CVD   R5,DOUBLE
         MVC   ARUA(5),=X'4020212020'
         ED    ARUA(4),DOUBLE+6
         SR    R5,R5
         ICM   R5,3,DMDTRUMX       MAX OF # READY USERS
         CVD   R5,DOUBLE
         MVC   MRUA(5),=X'4020212020'
         ED    MRUA(4),DOUBLE+6
         MVC   0(2,R6),ARUA+2
         MVI   2(R6),X'7A'
         CLI   MRUA+2,X'F0'
         BH    MRUAHI
         MVC   3(1,R6),MRUA+3
         B     MRUALO
MRUAHI   MVC   3(2,R6),MRUA+2
MRUALO   LA    R6,5(R6)
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTGOOU       CURRENT # OF USERS GOING OUT
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTOUTU       CURRENT # USERS ON OUT QUEUE
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTINCU       CURRENT # SWAPPABBLE IN CORE USERS
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         ICM   R5,3,DMDTNSW        CURRENT # NONSWAPPABLE IN USERS
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         L     R5,DMDTTWSR       WEIGHTED INTERVAL DMN SERVICE
         C     R5,=F'4096'      OVER 1K?
         BNE   TWSRLOW
         SR    R5,R5
         ICM   R5,7,DMDTTWSR     PICK FIRST THREE BYTES IN 1K'S
         BAL   R14,DMNCONVK
         B     TWSRHI
TWSRLOW  BAL   R14,DMNCONV         DISPLAY IT
TWSRHI   EQU   *
* ---------------------------------------------------------------
         SR    R5,R5
         IC    R5,DMDTWT         WEIGHTING FACTOR
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         CLI   TSOSW,C'T'
         BE    TRTOBJ
         SR    R5,R5
         ICM   R5,3,DMDTAOBJ       USER PERFORMANCE OBJECTIVE NO
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         IC    R5,DMDTDOBJ       DOMAIN PERFORMANCE OBJECTIVE NO
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         SR    R5,R5
         IC    R5,DMDTFWKL       DOMAIN FIXED WORKLOAD LEVEL
*                                  DROP DECIMAL PLACED (1 BYTES)
         BAL   R14,DMNCONV         DISPLAY IT
         B     SHOWCID
* ---------------------------------------------------------------
TRTOBJ   EQU   *
         L     R5,DMDTTRNC       XACTN COUNT FOR RTO
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
         L     R5,DMDTTRNT
         C     R5,=F'4096'
         BL    TRNTLOW
         SR    R5,R5
         ICM   R5,7,DMDTTRNT       ELAPSED TIME ACCUM FOR RTO
         BAL   R14,DMNCONVK
         B     TRNTHI
TRNTLOW  BAL   R14,DMNCONV         DISPLAY IT
TRNTHI   EQU   *
* ---------------------------------------------------------------
         L     R5,DMDTTWET       ELAPSED TIME AVG FOR RTO
         BAL   R14,DMNCONV         DISPLAY IT
* ---------------------------------------------------------------
SHOWCID  EQU   *
         SR    R5,R5
         ICM   R5,3,DMDTCIDX       CONTENTION INDEX
         CVD   R5,DOUBLE
         CLI   DMDTWT,X'00'
         BNE   NOTWT
         MP    DOUBLE(8),=PL3'1000'
         DP    DOUBLE(8),=PL2'256'
         CP    DOUBLE+5(1),=PL2'5'
         BL    NOROUND
         AP    DOUBLE(6),=PL2'10'
NOROUND  EQU   *
         UNPK  CIDX(7),DOUBLE(6)
         LA    R2,3
         BAL   R14,C0SUPRES
         MVC   0(3,R6),CIDX+1
         MVI   3(R6),X'4B'            DECIMAL POINT
         MVC   4(3,R6),CIDX+4
         B     TWTCALL
NOTWT    EQU   *
         UNPK  CIDX(5),DOUBLE+5(3)
         LA    R2,4
         BAL   R14,C0SUPRES
         MVC   0(5,R6),CIDX+1
TWTCALL  EQU   *
         BAL   R9,DISPLAY         GO PRINT MSG
DMNCHKM  LA    R8,1(R8)
DMNCHKX  LA    R4,DMDTLEN(R4)         NEXT TABLE ENTRY
         CH    R8,COPYNDMT        MAX OF DOMAINS
         BH    DMNCHK2             YES, TOTAL
         B     DMNCHK1
         EJECT
DMNCHK2 EQU   *
         B     RETURN
         EJECT
DMNCONV  EQU   *
         CVD   R5,DOUBLE
         MVC   CHAR,EDMSK
         ED    CHAR,DOUBLE+4
         MVC   0(5,R6),CHAR+3
         LA    R6,5(R6)
         BR    R14
         EJECT
DMNCONVK EQU   * DISPLAY 999K WHERE K=4096
         CVD   R5,DOUBLE
         MVC   CHAR,EDMSK
         ED    CHAR,DOUBLE+4
         MVC   0(4,R6),CHAR+4
         MVI   4(R6),C'K'
         LA    R6,5(R6)
         BR    R14
         EJECT
C0SUPRES EQU   * SUPRESS ZEROS DIGITS OF CIDX FIELDS
         LA    R1,CIDX
C0LOOP   CLI   0(R1),X'F0'
         BNER  R14
         MVI   0(R1),X'40'
         LA    R1,1(R1)
         BCT   R2,C0LOOP
         BR    R14
         EJECT
PGNCONVK ST    R14,SAVER14
         C     R5,=F'9999'
         BNH   PGNLOWK
         STM   R2,R3,SAVER2
         LR    R3,R5
         SR    R2,R2
         D     R2,=F'1000'
         LR    R5,R3
         LM    R2,R3,SAVER2
         CVD   R5,DOUBLE
         MVC   CHAR,EDMSK
         ED    CHAR,DOUBLE+4
         MVC   0(4,R6),CHAR+4
         MVI   4(R6),C'K'
         LA    R6,5(R6)
         BR    R14     NEED TO BUMP QDMSG POSITION
PGNLOWK  BAL   R14,DMNCONV
         L     R14,SAVER14
         BR    R14
         EJECT
PGNCONV  EQU   *
         CVD   R5,DOUBLE
         MVC   CHAR,EDMSK
         ED    CHAR,DOUBLE+4
         MVC   0(3,R6),CHAR+5
         LA    R6,3(R6)
         BR    R14
         EJECT
SHOWPGD  EQU   * DISPLAY PERFORMANCE GROUP DESCRIPTION
         MVI   PGNSWT,X'00'
         CLI   QPARM2,C' '
         BE    SHOWPG3
         LA    R1,3        MAX THREE DIGITS
         SR    R5,R5
         LH    R5,QLNG2    LOAD NO OF DIGITS
         CR    R5,R1
         BE    SHOWPGD3    THREE IS THE SAME
         BH    SHOWPG3     AMBIGIOUS LENGTH DEFAULT ALL
         SR    R1,R5       LESS OFFSET
         LA    R14,PGNNO
         MVC   0(3,R14),=CL3'000'
         AR    R14,R1
         EX    R5,PGNNMVC
         B     SHOWPGD4
PGNNMVC  MVC   0(*-*,R14),QPARM2
SHOWPGD3 MVC   PGNNO(3),QPARM2
SHOWPGD4 MVC   DOUBLE(3),=CL3'000'
         MVZ   DOUBLE(3),PGNNO
         CLC   DOUBLE(3),=CL3'000'    PGN NUMBER
         BNE   SHOWPG3
         PACK  DOUBLE(8),PGNNO(3)
         CVB   R1,DOUBLE
         STH   R1,PGNNUM           SAVE DOMAIN
         MVI   PGNSWT,X'FF'
SHOWPG3  MVC   QDMSG(80),HDRD3
         BAL   R9,DISPLAY
         MVC   QDMSG(80),HDRDT3
         BAL   R9,DISPLAY
         L     R4,16               CVT
         USING CVTDSECT,R4         ADDRESSING                     DOR
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         DOR
         USING RMCT,R4             ADDRESSING                     DOR
         L     R4,RMCTWMST         POINT TO SRM WMST              DOR
         ST    R4,WMSTADDR
         USING WMST,R4
         L     R8,WMSTPGVT         VECTOR TABLE
         LR    R7,R8
         LA    R7,0(R7)            CLEAN HIGH ORDER BYTE
         A     R7,WMSTPGVS         VECTOR SIZE
         ST    R7,WMSTEADR         END OF VECTOR TABLE
SHOWPGD1 L     R1,WMSTPGDT         1ST PERF GRP DESCRIPTION ADDRESS
         L     R7,0(R8)            PICK OFFSET
         AR    R1,R7                OFFSET TO PGD
         LA    R6,QDMSG
         USING WPGD,R1
         SR    R5,R5
         ICM   R5,3,WPGDPGN
         STH   R5,PGNNUMW
         LTR   R5,R5
         BZ    OBJFIN
         CLI   PGNSWT,X'FF'
         BNE   SHOWPGF
         CH    R5,PGNNUM
         BNE   OBJFIN
SHOWPGF  BAL   R14,PGNCONV
* ----------------------------------------------------------------
         LA    R2,12(R1)     OFFSET TO PGD
         USING WPGP,R2
         LA    R5,1
         STH   R5,PERIOD
SHOWOBJ  EQU   *
         SR    R5,R5
         LH    R5,PERIOD  PERIOD OF THE PERF. GRP
         BAL   R14,PGNCONV
* ----------------------------------------------------------------
         LA    R6,1(R6) MOVE QDMSG POSITION
         SR    R5,R5
         IC    R5,WPGPOBJN  OBJECTIVE NUMBER
         BAL   R14,PGNCONV
* ----------------------------------------------------------------
         LA    R6,1(R6) MOVE QDMSG POSITION
         SR    R5,R5
         IC    R5,WPGPDMN      DOMAIN NUMBER
         BAL   R14,PGNCONV
* ----------------------------------------------------------------
         SR    R5,R5
         IC    R5,WPGPIODP     I/O DISPATCHING PRIORITY
         BAL   R14,DMNCONV
* ----------------------------------------------------------------
         SR    R5,R5
         IC    R5,WPGPNDP      DISPATCHING PRIORITY
         BAL   R14,DMNCONV
* ----------------------------------------------------------------
         SR    R5,R5
         IC    R5,WPGPTNDP     TS DISPATCHING PRIORITY
         BAL   R14,DMNCONV
* ----------------------------------------------------------------
         SR    R5,R5
         IC    R5,WPGPNTSG     TS GROUP #
         BAL   R14,DMNCONV
* ----------------------------------------------------------------
         CLI   WPGPRTOF,X'00'   ANY OFFSET ?
         BE    NORTOVAL         NO BYPASS
         SR    R3,R3
         ICM   R3,1,WPGPRTOF    PICK WORD OFFSET
         SLL   R3,2             MULTIPLES BY 4 BYTES AS FULL WORD
         AR    R3,R1            OFFSET FROM WPGD
         SR    R5,R5
         L     R5,0(R3)         RTO VALUES  IN MILLISECONDS
         BAL   R14,DMNCONV
         B     SIWS
* ----------------------------------------------------------------
NORTOVAL EQU   *
         LA    R6,5(R6)
SIWS     TM    WPGPINDS,WPGPSIWS SEE IF BIT ON FOR WORKSET LIMITS
         BNO   NOSIWOV
         SR    R3,R3
         ICM   R3,1,WPGPSIWO    PICK WORD OFFSET
         SLL   R3,2             MULTIPLES BY 4 BYTES AS FULL WORD
         AR    R3,R1            OFFSET FROM WPGD
         SR    R5,R5
         ICM   R5,3,0(R3)         WORK SET LOW LIMIT VALUES
         BAL   R14,PGNCONVK
         SR    R5,R5
         ICM   R5,3,2(R3)         WORK SET HIGH LIMIT VALUES
         BAL   R14,PGNCONVK
         B     SIPI
* ----------------------------------------------------------------
NOSIWOV  EQU   *
         LA    R6,10(R6)
SIPI     TM    WPGPINDS,WPGPSIPI SEE IF BIT ON FOR PAGE RATE LIMITS
         BNO   NOSIPIV
         SR    R3,R3
         ICM   R3,1,WPGPSIPO    PICK WORD OFFSET
         SLL   R3,2             MULTIPLES BY 4 BYTES AS FULL WORD
         AR    R3,R1            OFFSET FROM WPGD
         SR    R5,R5
         ICM   R5,3,0(R3)         PAGE RATE LOW LIMIT VALUES
         BAL   R14,PGNCONVK
         SR    R5,R5
         ICM   R5,3,2(R3)         PAGE RATE HIGH LIMIT VALUES
         BAL   R14,PGNCONVK
         B     ISVP
* ----------------------------------------------------------------
NOSIPIV  EQU   *
         LA    R6,10(R6)
ISVP     CLI   WPGPISVP,X'00'    ISV INDICATED ?
         BE    NOISV
         SR    R3,R3
         ICM   R3,1,WPGPISVP    PICK WORD OFFSET
         SLL   R3,2             MULTIPLES BY 4 BYTES AS FULL WORD
         AR    R3,R1            OFFSET FROM WPGD
         SR    R5,R5
         L     R5,0(R3)         PICK ISV
         BAL   R14,PGNCONVK
         B     DURP
* ----------------------------------------------------------------
NOISV    EQU   *
         LA    R6,5(R6)
DURP     CLI   WPGPDURP,X'00'    DUR INDICATED ?
         BE    NODURP
         SR    R3,R3
         ICM   R3,1,WPGPDURP    PICK WORD OFFSET
         SLL   R3,2             MULTIPLES BY 4 BYTES AS FULL WORD
         AR    R3,R1            OFFSET FROM WPGD
         SR    R5,R5
         L     R5,0(R3)         PICK DUR
         BAL   R14,PGNCONVK
         B     DPFLAGS
* ----------------------------------------------------------------
NODURP   EQU   *
         LA    R6,5(R6)
DPFLAGS  MVC   0(3,R6),=CL3'VPG'
         TM    WPGDDFL,X'80'    VALID PERF GROUP SPECIFICATION
         BO    WHATFLAG
* ----------------------------------------------------------------
         MVC   0(3,R6),=CL3'WKS'
         TM    WPGDDFL,X'40'    WORKSET LIMIT SPECIFICATION
         BO    WHATFLAG
* ----------------------------------------------------------------
         MVC   0(3,R6),=CL3'PAG'
         TM    WPGDDFL,X'20'    PAGE RATE LIMIT SPECIFICATION
         BO    WHATFLAG
         MVC   0(3,R6),QBLANK
WHATFLAG EQU   *
         LA    R6,3(R6)         BUMP QDMSG POSITION
* ----------------------------------------------------------------
         MVC   0(3,R6),=CL3'WLM'
         TM    WPGPDSPN,X'80'    CONTROLLED BY WLM (SRM ROUTINE)
         BO    WHATINDS
* ----------------------------------------------------------------
         MVC   0(3,R6),=CL3'ROT'
         TM    WPGPDSPN,X'40'    CONTROLLED BY ROTATE
         BO    WHATINDS
* ----------------------------------------------------------------
         MVC   0(3,R6),=CL3'TSO'
         TM    WPGPDSPN,X'20'    CONTROLLED BY TIME SLICE
         BO    WHATINDS
         MVC   0(3,R6),QBLANK
* ----------------------------------------------------------------
WHATINDS EQU   *
         LA    R6,3(R6)         BUMP QDMSG POSITION
         MVC   0(4,R6),=CL4'-UNT'
         TM    WPGPINDS,X'40'    DURATION IN REAL TIME ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-LIM'
         TM    WPGPINDS,X'30'    WORKSET/PAGE RATE INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-WKS'
         TM    WPGPINDS,X'20'    WORKSET LIMIT INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-PAG'
         TM    WPGPINDS,X'10'    PAGE RATE LIMIT INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-RTB'
         TM    WPGPINDS,X'07'    RTB INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-CPU'
         TM    WPGPINDS,X'04'    CPU INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-I/O'
         TM    WPGPINDS,X'02'    I/O INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),=CL4'-STO'
         TM    WPGPINDS,X'01'    STORAGE INDICATED ?
         BO    NEXTOBJ
* ----------------------------------------------------------------
         MVC   0(4,R6),QBLANK
NEXTOBJ  EQU   *
         BAL   R9,DISPLAY
         TM    WPGPINDS,WPGPFIN
         BO    OBJFIN
         LH    R5,PERIOD
         LA    R5,1(R5)
         STH   R5,PERIOD
         LA    R2,16(R2)         NEXT OBJ 16 CHARS
         LA    R6,QDMSG+3
         B     SHOWOBJ
OBJFIN   EQU   *
         LA    R5,1
         STH   R5,PERIOD
         LA    R8,4(R8)    NEXT VECTOR WORD
         C     R8,WMSTEADR
         BNL   RETURN
         B     SHOWPGD1
         EJECT
SHOWOBJD EQU   * DISPLAY PERFORMANCE OBJECT DESCRIPTION
         MVI   PGNSWT,X'00'
         CLI   QPARM2,C' '
         BE    SHOWPG3
         LA    R1,2        MAX THREE DIGITS
         SR    R5,R5
         LH    R5,QLNG2    LOAD NO OF DIGITS
         CR    R5,R1
         BE    SHOWPGD3    THREE IS THE SAME
         BH    SHOWPG3     AMBIGIOUS LENGTH DEFAULT ALL
         SR    R1,R5       LESS OFFSET
         LA    R14,PGNNO
         MVC   0(2,R14),=CL3'000'
         AR    R14,R1
         EX    R5,PGNNMVC
         B     SHOWPGD4
SHOWOBJ3 MVC   PGNNO(3),QPARM2
SHOWOBJ4 MVC   DOUBLE(3),=CL3'000'
         MVZ   DOUBLE(3),PGNNO
         CLC   DOUBLE(3),=CL3'000'    PGN NUMBER
         BNE   SHOWOB3
         PACK  DOUBLE(8),PGNNO(3)
         CVB   R1,DOUBLE
*NEDFIX  STH   R1,OBJNUM           SAVE DOMAIN
         MVI   PGNSWT,X'FF'
SHOWOB3  EQU   *
* NEED   MVC   QDMSG(80),HDRD4
* FIX    BAL   R9,DISPLAY
*        MVC   QDMSG(80),HDRDT4
*        BAL   R9,DISPLAY
         L     R4,16               CVT
         USING CVTDSECT,R4         ADDRESSING                     DOR
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         DOR
         USING RMCT,R4             ADDRESSING                     DOR
         L     R4,RMCTWMST         POINT TO SRM WMST              DOR
         ST    R4,WMSTADDR
         USING WMST,R4
         L     R8,WMSTPOVT         VECTOR TABLE
         LR    R7,R8
         LA    R7,0(R7)            CLEAN HIGH ORDER BYTE
         A     R7,WMSTPOVS         VECTOR SIZE
         ST    R7,WMSTEADR         END OF VECTOR TABLE
SHOWOBJ1 L     R1,WMSTPODT         1ST PERF OBJ DESCRIPTION ADDRESS
         L     R7,0(R8)            PICK OFFSET
         AR    R1,R7                OFFSET TO PGD
         LA    R6,QDMSG
         USING WPGD,R1
         SR    R5,R5
         ICM   R5,3,WPGDPGN
         STH   R5,PGNNUMW
         LTR   R5,R5
         BZ    OBJFIN
         CLI   PGNSWT,X'FF'
         BNE   SHOWPGF
         CH    R5,PGNNUM
         BNE   OBJFIN
SHOWOBF  BAL   R14,PGNCONV
* ----------------------------------------------------------------
         LA    R2,12(R1)     OFFSET TO PGD
         USING WPGP,R2
         LA    R5,1
         STH   R5,PERIOD
SHOWWKL  EQU   *
         SR    R5,R5
         LH    R5,PERIOD  PERIOD OF THE PERF. GRP
         BAL   R14,PGNCONV
* ----------------------------------------------------------------
         LA    R6,1(R6) MOVE QDMSG POSITION
         SR    R5,R5
         IC    R5,WPGPOBJN  OBJECTIVE NUMBER
         BAL   R14,PGNCONV
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   QSTOP
         EJECT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
EDMSK    DC    XL8'4020202020202120'
EDMSK2   DC    XL6'402020202120'
         SPACE 1
         SPACE 3
LINE1    DC    CL80'CURRENT IPS=IEAIPSXX  OPT=IEAOPTXX  ICS=IEAICSXX'
HDRD1    EQU   *
       DC    CL47'    <----- MPL ------>  A:M <- STATUS OF USER->'
       DC    CL33'<-WEIGHT-> <MPL TGT CNTL>     '
HDRD2    EQU   *
       DC    CL47'DMN MIN  MAX  TGT CURR  RUA GOOU OUTU  INC  NSW'
       DC    CL33' TWSR  TWT AOBJ DOBJ FWKL CIDX'
HDRD3    EQU   *
       DC    CL49' PG PD OBJ DMN IODP DISP <-TIME SLICE-> <WORKSET>'
*                  1234 1234 1234 1234 1234 1234 1234 1234 1234 1234
*                  123123123 123  1234 1234 1234 1234 1234 1234 1234
       DC    CL33'<PAGERATE>          <--FLAGS->'
*                  1234 1234 1234 1234123123-123
HDRDT1   EQU   *
       DC    CL47'    <----- MPL ------>  A:M <- STATUS OF USER->'
       DC    CL33'<-WEIGHT-> <--TSO RTO -->     '
HDRDT2   EQU   *
       DC    CL47'DMN MIN  MAX  TGT CURR  RUA GOOU OUTU  INC  NSW'
       DC    CL33' TWSR  TWT XCNT ELAP  AVG CIDX'
HDRDT3   EQU   *
       DC    CL49'  #  #   #   # PRTY PRTY   DP  GRP  RTO  LOW HIGH'
*                 123123 123 123  1234 1234 1234 1234 1234 1234 1234
       DC    CL33' LOW  HIGH  ISV  DUR PG CTL IND'
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
OLDNAME  DS    CL8
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
CHAR     DS    CL8
TRACESW  DS    F
DMNTADDR DS    F
WMSTADDR DS    F
WMSTEADR DS    F
DMNTEND  DS    F
DMNTNUM  DS    F
SAVER2   DS    F
SAVER3   DS    F
SAVER9   DS    F
SAVER14  DS    F
DOMNUM   DS    H
PGNNUM   DS    H
PGNNUMW  DS    H
PERIOD   DS    H
PGNSWT   DS    C
PGNNO    DS    CL4
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    CL4
CIDX     DS    CL8 EDITED CONTENTION INDEX
ARUA     DS    CL5 EDITED AVERAGE # OF READY USER AVERAGE
MRUA     DS    CL5 EDITED MAXIMUM # OF READY USER AVERAGE
         SPACE 5
DMNLIST  EQU   QDMSG,80
DMNMSG   EQU   QDMSG,80
DMNNBR   EQU   QDMSG,5
DMNTLO   EQU   QDMSG+5,5
DMNTHI   EQU   QDMSG+10,5
DMNTWT   EQU   QDMSG+15,5
DMNMPLT  EQU   QDMSG+20,5
DMNRUA   EQU   QDMSG+25,5
DMNGOOU  EQU   QDMSG+30,5
DMNCMPL  EQU   QDMSG+35,5
DMNOUTU  EQU   QDMSG+40,5
DMNINCU  EQU   QDMSG+45,5
DMNTWSR  EQU   QDMSG+50,5
DMNAOBJ  EQU   QDMSG+55,5
DMNDOBJ  EQU   QDMSG+60,5
DMNFWKL  EQU   QDMSG+65,5
DMNNSW   EQU   QDMSG+70,5
DMNCIDX  EQU   QDMSG+75,5
         SPACE 2
         DS    0F
COPYDSWT DS    F      INDICATED IF THE SYSEVENT REQUEST IS AT ONCE
COPYDMNT DS    CL40
         ORG   COPYDMNT+16
COPYIPS  DS    CL8
COPYOPT  DS    CL8
COPYICS  DS    CL8
COPYNDMT DS    H
         ORG   COPYDMNT+40
         DS    F
WORKEND  DS    0F
RMCT     DSECT ,                                                  DOR
         ORG   RMCT+24                                            DOR
RMCTWMST DS    F                   POINTER TO WLM SPEC TABLE      DOR
         ORG   RMCT+180                                           DOR
RMCTDMDT DS    F                   POINTER TO DMDT                DOR
RMCTDMDE DS    F                   POINTER TO DMDT END            DOR
RMCTDMNC DS    H                   POINTER TO # OF DOMAINS        DOR
         ORG   ,                                                  DOR
         EJECT
WMST     DSECT        IRAWMST EBB1102/JBB1326 PVTMACS  DOR
WMSTNAME DS    C'WMST' -           TABLE IDENTIFICATION
WMSTID   DS    CL2 -               PERF. SPECIFICATION IDENTIFIER
WMSTWLLO DS    H -                 LOWEST WORKLOAD LEVEL SPECIFIED
WMSTPGVT DS    A -                 PERF GROUP VECTOR TABLE ADDRESS
WMSTPGVS DS    F -                 PERF GROUP VECTOR TABLE SIZE
WMSTPGDT DS    A -                 FIRST PERF GROUP DESCRIPTOR ADDRESS
WMSTPGDS DS    F -                 TOTAL PERF GROUP DESCRIPTOR SIZE
WMSTPOVT DS    A -                 PERF OBJECTIVE VECTOR TABLE ADDRESS
WMSTPOVS DS    F -                 PERF OBJECTIVE VECTOR TABLE SIZE
WMSTPODT DS    A -                 1ST PERF OBJECTIVE DESCRIPT ADDRESS
WMSTPODS DS    F -                 TOT PERF OBJECTIVE DESCRIPT SIZE
WMSTDMDT DS    A -                 FIRST DOMAIN DESCRIPTR ADDR @Z40BPCH
WMSTDMDS DS    F -                 TOT DOMAIN DESCRIPTOR SIZE  @Z40BPCH
WMSTDMVT DS    A -                 DOMAIN VECTOR TABLE ADDR    @Z40BPCH
WMSTDMVS DS    F -                 DOMAIN VECTOR TABLE SIZE    @Z40BPCH
WMSTDMDE DS    A -                 DMN TABLE LAST ENTRY ADDR   @Z40BPCH
WMSTWLHI DS    H -                 HIGHEST WORKLOAD LEVEL SPEC @Z40BPCH
WMSTPGHI DS    H -                 HIGHEST PERF GROUP NUMBER
WMSTPGPC DS    H -                 TOTAL COUNT OF PERF GROUP PERIODS
WMSTDMNC DS    H -                 TOTAL DOMAIN COUNT          @Z40BPCH
WMSTCPU  DS    F -                 CPU SERVICE COEFFICIENT
WMSTIOC  DS    F -                 IOC SERVICE COEFFICIENT
WMSTMSO  DS    F -                 MSO SERVICE COEFFICIENT
WMSTREAL DS    CL1                 REAL TIME INDICATOR        @ZM43084
WMSTRSVD DS    CL3                 RESERVED                   @ZM43084
WMSTSET  DS    A -                 SET IPS PROCESSOR ROUTINE ADDRESS
WMSTSTCB DS    A -                 SET IPS PROCESSOR TASK ADDRESS
WMSTNWST DS    A -                 SET IPS PROCESSOR NXT WMST ADDRESS
WMSTSECB DS    F -                 ECB FOR SET IPS PROCESSOR
WMSTIPC  DS    CL4 -               CPU SERVICE COEFICIENT      @Z40BPCH
WMSTIPI  DS    CL4 -               I/O SERVICE COEFFICIENT
WMSTIPM  DS    CL4 -               MSO SERVICE COEFFICIENT
WMSTEND  DS    0D -                END OF WMST
WMSTLEN  EQU   WMSTEND-WMST -      LENGTH OF WMST
WPGD     DSECT IRAWPGDT  JBB1326 PVTMACS  DOR
WPGDPGN  DS    AL2 -               PERFORMANCE GROUP NUMBER
WPGDR02  DS    CL1 -               RESERVED
WPGDDFL  DS    CL1 -               PERFORMANCE GROUP DESCRIPTIVE FLAGS
WPGDVLD  EQU   128    1... ....    VALID PERFORMANCE GROUP IN NEW IPS
WPGDSIW  EQU    64    .1.. ....    WORK SWT LIMITS SPECIFICATION
WPGDSIP  EQU    32    ..1. ....    PAGE RATE LIMITS SPECIFICATION
WPGDRD1  EQU    31  - ...1 1111    RESERVED
WPGDATM  DS    F -                 AVG TIME TO ABSORB ISV SERVICE AMT
WPGDISV  DS    F -                 PERFM GRP INTERVAL SERVICE VALUE
WPGDPGP  DS    0F -                1ST PERIOD ENTRY FOR PERFM GROUP
WPGDOBJN DS    AL1 -               PG PERIOD PERFORMANCE OBJECTIVE NO.
WPGDDMN  DS    AL1 -               PG PERIOD DOMAIN NO.
WPGDIODP DS    AL1 -               I/O PRIORITY
WPGDDSPN DS    CL1 -               DISPATCHING CONTROL FLAG
WPGDNMTW EQU   128    1... ....    CONTROLLED BY MTW
WPGDNROT EQU    64    .1.. ....    CONTROLLED BY ROTATE
WPGDNTS  EQU    32    ..1. ....    CONTROLLED BY TS
WPGDNRSV EQU    31    ...1 1111    RESERVED
WPGDINDS DS    CL1 -               PG PERIOD DESCRIPTIVE INDICATORS
WPGDFIN  EQU   128  - 1... ....    FINAL PERFORMANCE GROUP PERIOD
WPGDUNT  EQU    64  - .1.. ....    PG PERIOD DURATION IS IN REAL TIME
WPGDSIWS EQU    32  - ..1. ....    WORK SET LIMIT SPEC
WPGDSIPI EQU    16  - ...1 ....    PAGE RATE LIMIT SPEC
WPGDRBZ  EQU     8  - .... 1...    RESERVED
WPGDCTB  EQU     4  - .... .1..    CPU LOAD APPLIED
WPGDITB  EQU     2  - .... ..1.    I/O LOAD APPLIED
WPGDSTB  EQU     1  - .... ...1    STORAGE LOAD APPLIED
WPGDNDP  DS    AL1  -              PERIOD DISPATCHING PRIORITY
WPGDTNDP DS    AL1  -              PERIOD TS DISPATCHING PRIORITY
WPGDNTSP DS    AL1  -              PERIOD TS GROUP #
WPGDRTOF DS    AL1  -              PERIOD TS REPONSE TIME OFFSET
WPGDRSVO DS    AL1  -              RESERVED
WPGDSIWO DS    AL1  -              WORK SET WORD OFFSET
WPGDSIPO DS    AL1  -              PAGE RATE WORD OFFSET
WPGDISVP DS    AL1 -               INTERVAL SERVICE VALUE WORD OFFSET
WPGDDURP DS    AL1 -               DURATION VALUE WORD OFFSET
WPGDPGL  DS    0F -                START OF POSSIBLE WPGD EXTENSION
WPGDEND  DS    0F -                END OF WPGD
WPGDLEN  EQU   WPGDEND-WPGD -      LENGTH OF WPGD
         EJECT
WPGP     DSECT    IRAWPGDT  JBB1326 PVTMACS DOR
WPGPOBJN DS    AL1 -               PERFORMANCE OBJECTIVE NUMBER
WPGPDMN  DS    AL1 -               DOMAIN NUMBER               @Z40BPCH
WPGPIODP DS    AL1 -               I/O PRIORITY
WPGPDSPN DS    CL1 -               DISPATCHING CONTROL FLAG
WPGPNMTW EQU   128    1... ....    CONTROLLED BY MTW
WPGPNROT EQU    64    .1.. ....    CONTROLLED BY ROTATE
WPGPNTS  EQU    32    ..1. ....    CONTROLLED BY TS
WPGPNRSV EQU    31    ...1 1111    RESERVED
WPGPINDS DS    CL1 -               PERIOD DESCRIPTIVE INDICATORS
WPGPFIN  EQU   128  - 1... ....    FINAL PERFORMANCE GROUP PERIOD
WPGPUNT  EQU    64  - .1.. ....    PG PERIOD DURATION IS IN REAL TIME
WPGPSIWS EQU    32  - ..1. ....    WORK SET LIMIT SPEC
WPGPSIPI EQU    16  - ...1 ....    PAGE RATE LIMIT SPEC
WPGPRBZ  EQU     8  - .... 1...    RESERVED
WPGPCTB  EQU     4  - .... .1..    CPU LOAD APPLIED
WPGPITB  EQU     2  - .... ..1.    I/O LOAD APPLIED
WPGPSTB  EQU     1  - .... ...1    STORAGE LOAD APPLIED
WPGPNDP  DS    AL1  -              PERIOD DISPATCHING PRIORITY
WPGPTNDP DS    AL1  -              PERIOD TS DISPATCHING PRIORITY
WPGPNTSG DS    AL1  -              PERIOD TS GROUP #
WPGPRTOF DS    AL1  -              PERIOD TS REPONSE TIME OFFSET
WPGPRSVO DS    CL3  -              RESERVED
WPGPSIWO DS    AL1  -              WORK SET WORD OFFSET
WPGPSIPO DS    AL1  -              PAGE RATE WORD OFFSET
WPGPISVP DS    AL1 -               INTERVAL SERVICE VALUE OFFSET
WPGPDURP DS    AL1 -               PERIOD DURATION VALUE OFFSET
WPGPEND  DS    0F -                END OF WPGP
WPGPLEN  EQU   WPGPEND-WPGP -      LENGTH OF WPGP
         EJECT
WPGL     DSECT    IRAWPGDT  JBB1326 PVTMACS  DOR
WPGLISV  DS    0F -                INTERVAL SERVICE VALUE FOR A PERIOD
WPGLDUR  DS    0F -                PERIOD DURATION VALUE FOR A PERIOD
WPGLRTO  DS    0F -                REPONSE TIME OBJ VALUE
WPGLSIW  DS    0F -                WORKING SET LIMIT SPEC VALUE
WPGLSIP  DS    0F -                PAGE RATE LIMIT SPEC VALUE
         DS    F -                 SPECIFIED VALUE STORAGE AREA
         ORG    WPGL
         DS     0F
WPGLSIWL DS     H -                WORKING SET LOW LIMIT SPEC VALUE
WPGLSIPL DS     H -                PAGE RATE LOW LIMIT SPEC VALUE
         ORG    WPGL
         DS     0F
WPGLSIWH DS     H -                WORKING SET HIGH LIMIT SPEC VALUE
WPGLSIPH DS     H -                PAGE RATE HIGH LIMIT SPEC VALUE
WPGLEND  DS    0F -                END OF WPGL
WPGLLEN  EQU   WPGLEND-WPGL -      LENGTH OF WPGL
         EJECT
WPOD     DSECT                     IRAWPODT  DOR JBB1326 PVTMACS
WPOP     DS    0CL4 -              PREV PERFORMANCE OBJECTIVE SEGMENT
WPOPSRV  DS    H -                 SERVICE RATE AT PREVIOUS POINT
WPOPWKL  DS    H -                 WORKLOD LEVL AT PREVIOUS POINT
WPOS     DS    0CL4 -              CURR PERFORMANCE OBJECTIVE SEGMENT
WPOSSRV  DS    H -                 SERVICE RATE AT CURR PT IN OBJCTV
WPOSWKL  DS    H -                 WORKLOD LEVL AT CURR PT IN OBJCTV
WPODEND  DS    0H -                END OF WPOD
WPODLEN  EQU   WPODEND-WPOS -      LENGTH OF WPOD
         EJECT
DMNDSECT DSECT
DMDTNO   DS   AL1                  DOMAIN NUMBER
DMDTLO   DS   AL1                  MIN MPL LEVEL
DMDTHI   DS   AL1                  MAX MPL LEVEL
DMDTWT   DS   AL1                  WEIGHTING FACTOR
DMDTMPLT DS   H                    CURRENT MPL TARGET
DMDTRUA  DS   H                    AVE # OF READY USERS
DMDTGOOU DS   H                    CURRENT # OF USERS GOING OUT
DMDTCMPL DS   H                    CURRENT MPL
DMDTOUTU DS   H                    CURRENT # USERS ON OUT Q
DMDTINCU DS   H                    CURRENT # SWAPPABLE INCORE USERS
DMDTRUC  DS   F                    ACCUMULATOR FOR READY USER COUNT
DMDTWMS  DS   F                    INTERVAL DMN SERVICE ACCUM
DMDTTWSR DS   F                    WEIGHTED INTERVAL DMN SERVICE
DMDTAOBJ DS   AL1                  USER PERFORMANCE OBJECTIVE NUMBER
DMDTDOBJ DS   AL1                  DOMAIN PERFORMANCE OBJECTIVE NUMBER
DMDTFWKL DS   H                    DOMAIN FIXED WORKLOAD LEVEL
DMDTCIDX DS   H                    CONTENTION INDEX
DMDTNSW  DS   H                    CURRENT # NONSWAPPABLE IN USERS
DMDTRUMX DS   H                    MAX # READY USERS IN INTERVAL
DMDTFLGS DS   AL1                  FLAG BYTE
DMDTRTO  EQU  128                  RTO PERIOD IN THIS OWN DMN
DMDTRSV1 DS   AL1                  RESERVED
DMDTTRNC DS   F                    XACTN COUNT FOR RTO
DMDTTRNT DS   F                    ELAPSED TIME ACCUM FOR RTO
DMDTTWET DS   F                    ELAPSED TIME AVG FOR RTO
DMDTRSV2 DS   F                    RESERVED
DMDTEND  DS   0F                   END OF DMDT
DMDTLEN  EQU  DMDTEND-DMNDSECT    LENGTH OF DMDT
         EJECT
         PRINT NOGEN                                              DOR
CVTDSECT CVT   ,                                                  DOR
         END
./       ADD   NAME=DOPTION
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
DOPTION  TITLE 'QUEUE COMMAND - #CHANGE CURRENT DISPLAY OPTIONS'
DOPTION  QSTART ,                  START DEVIREQ DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
***********************************************************************
*                                                                     *
*   DETERMINE FUNCTION REQUESTED                                      *
*                                                                     *
***********************************************************************
         MVC   QDHLINE,=CL80'**** CC CMD: OPTION CHANGE LIST ****'
         LA    R2,QPARM1          ADDR 1ST PARM                   LBDMC
         LA    R3,4               4 PARM FIELDS                   LBDMC
OPTLOOP  DS    0H                                                 LBDMC
         BAL   R4,CHGOPT          CHANGE OPTION                   LBDMC
         LA    R2,12(R2)          POINT NEXT PARM                 LBDMC
         BCT   R3,OPTLOOP         AND CONTINUE                    LBDMC
         TM    QFLAG1,QDSPBLK        ANY OPTIONS IN EFFECT        LBDMC
         BZ    NOOPTS              NO.                            LBDMC
         QWTO  'CC CMD: OPTION CHANGES ARE IN EFFECT'             LBDMC
         BAL   R4,DISPOPT         DISPLAY OPTIONS                 LBDMC
         B     RETURN             RETURN                          LBDMC
NOOPTS   QWTO  'DEFAULT DISPLAY OPTIONS ARE IN EFFECT'            LBDMC
         BAL   R4,DISPOPT         DISPLAY OPTIONS                 LBDMC
RETURN   QSTOP ,                  RETURN TO CALLER                LBDMC
***********************************************************************
*                                                                     *
*   CHANGE OPTIONS                                                    *
*                                                                     *
***********************************************************************
CHGOPT   DS    0H                                                 LBDMC
         CLC   =C'NOBL',0(R2)     DON'T SHOW BLANK LINES?         LBDMC
         BNE   OPT2                NO, CHECK OPTION 2             LBDMC
         OI    QFLAG1,QDSPBLK     DON'T SHOW BLANK LINES          LBDMC
         BR    R4                 ONLY 1 OPTION PER PARM          LBDMC
OPT2     DS    0H                                                 LBDMC
         CLC   =C'BL',0(R2)       SHOW BLANK LINES?               LBDMC
         BNE   OPT3                NO, CHECK OPTION 3             LBDMC
         NI    QFLAG1,255-QDSPBLK SHOW BLANK LINES                LBDMC
         BR    R4                 ONLY 1 OPTION PER PARM          LBDMC
OPT3     DS    0H                                                 LBDMC
         OI    QFLAG1,QDSPCC      SHOW CARRIAGE CONTROL           ANRPC
         BR    R4                 ONLY 1 OPTION PER PARM          LBDMC
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
DISPOPT  DS    0H                                                 LBDMC
         TM    QFLAG1,QDSPBLK     DON'T SHOW BLANK LINES?         LBDMC
         BNO   DISPOPT2            NO, CHECK OPTION 2             LBDMC
         QWTO  '2 OR MORE BLANK LINES WILL BE EDITED TO 1 BLANK LINE'
         B     DISPOPT3                                           LBDMC
DISPOPT2 QWTO  'BLANK LINES IN SYSOUT DATASETS WILL BE DISPLAYED'
DISPOPT3 TM    QFLAG1,QDSPCC      SHOW OVERFLOW DATA?             ANRPC
         BNO   DISPOPT4            NO, CHECK OPTION 4             LBDMC
         QWTO  'CARRAIGE CONTROL CHARACTERS WILL BE DISPLAYED'
         BR    R4                                                 LBDMC
DISPOPT4 QWTO  'CARRIAGE CONTROL CHARACTERS WILL NOT BE DISPLAYED'
         BR    R4                                                 LBDMC
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
         QCOMMON
         END
./       ADD   NAME=DTAPE
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
DTAPE    TITLE 'QUEUE COMMAND - TAPE DISPLAY TAPE  '
DTAPE    QSTART ,                  START DEVIREQ DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13
*
* THIS IS THE DTAPES COMMAND FOR TSO    OS/VS2 R3.
*
* THE COMMAND WILL DISPLAY THE STATUS AND VOLSERS OF ALL TAPE UNITS.
* THE COMMAND SYNTAX IS:
*
*   DTAPES
*
*
* ADAPTED FROM MICHIGAN MODS 'USPACE' COMMAND FROM UNITED AIR LINES
*       TSO MODS 3-75  BY KEN TRUE  MAY76
*
*  ALSO BAGGED OBTAIN CODE FROM U.C.L.A  URLISTVO COMMAND FROM THE
*       SAME MISHMODS TAPE.  KT JUNE76.
*
*  BAGGED SORT UCB ADDRESS CODE FROM MISHMODS DDASD COMMAND
*                            KT 13JULY76
*
*  INSTALLED SEARCH OF DEVNAMET FOR UNIT DESCRIPTION.. KT 26APR77
*
*  MODIFIED TO RUN AS TSO COMMAND OR OPER STARTED TASK KT  27MAY77
*
*
*
LINKREG  EQU   6                   LINK REGISTER
*
         LOAD  EP=DEVNAMET        LOAD DEVICE NAME TABLE
         ST    R0,DEVADDR         ...AND SAVE ITS ADDRESS
         MVC   EXTRACT1(EXTRACTL),EXTRACT MOVE IN EXTRACT LIST FORM
         LA    R1,ANSWER          LOAD ADDR OF ANSWER
         ST    R1,EXTRACT1          AND SAVE IT IN THE MACRO
         EXTRACT MF=(E,EXTRACT1)
         L     R1,ANSWER            (R1)=ADDR OF TSO FLAG FROM EXTRACT
         MVC   TSOFLAG,0(R1)        MOVE IN THE ANSWER TO OUR FLAG
         SPACE
LISTALL  MVI   SW1,X'00'                INIT PRINT HDR SWITCH
*
         L     R7,CVTPTR                CVT ADDR.
         USING CVT,R7                   CVT ADDRESSABILITY
         L     R7,CVTILK2               UCB LOOKUP TABLE ADDR.
         DROP  R7                       KILL CVT ADDRESSABILITY
         USING UCBSECT,R8               SET ADDRESSAB TO UCB.
         EJECT
         XC    LCT,LCT                  CLEAR COUNT
         MVC   LMAX(2),=H'1000'         SAY ROOM FOR 500 ENTRIES
CYCLE    LH    R8,D0(R7)                UCB ADDR.
         LTR   R8,R8                    TEST UCB STATUS
         BM    RLSE                     END OF TABLE
         BZ    INDEX                    PAD ENTRY
         CLI   UCBID,UCBSTND            IS UCB STANDARD?
         BNE   INDEX                    NO, ERROR
         CLI   UCBTBYT3,UCB3TAPE        IS IT A TAPE?
         BNE   INDEX                    NO
         SR    R4,R4
COMPLIST CH    R4,LCT                   SEE IF WEVE SEEN THIS ONE ?
         BNL   ADDLIST                  NOPE-> GO ADDIT
         CH    R8,LIST(R4)
         BE    INDEX
         LA    R4,2(R4)
         B     COMPLIST
ADDLIST  LH    R4,LCT
         CH    R4,LMAX
         BNL   FULL
         STH   R8,LIST(R4)
         LA    R4,2(R4)
         STH   R4,LCT
FULL     EQU   *
DISPCHK  TM    SW1,HEADING              HAVE WE WRITTEN THE HEADER?
         BNO   WRTFMT                   ->NO..GO WRITE IT
         SPACE
DISPLAY  MVC   BUFFER(80),QBLANK  REINIT WTO MESSAGE
         MVC   QDMSG,QBLANK
         MVC   MSGUNIT,UCBNAME          COPY UNIT ADDRESS
         CLI   UCBVOLI,X'00'            ANY VOLSER IN UCBVOLI ?
         BE    NOVOLSER                 NO-> SKIP MOVE OF VOLSER
         MVC   MSGVOL,UCBVOLI           COPY VOLUME SERIAL NUMBER
*
NOVOLSER TM    UCBSTAT,UCBONLI          IS DRIVE ONLINE?
         BNO   NOTON                    ->NO..MARK MSG AS OFFLINE
         MVC   MSGSTAT,ONLINE           ->YES..SAY SO.
         B     CHKVARY
NOTON    MVC   MSGSTAT,OFFLINE
*
CHKVARY  TM    UCBSTAT,UCBCHGS          IS IT CHANGING ON/OFF?
         BNO   CHKDEN                   ->NO GO CHECK DENSITY..
         MVC   MSGVARY,VARY             ->YES..SAY SO.
*
CHKDEN   TM    UCBTBYT2,UCBDUDN1        IS IT 800/1600?
         BNO   CHKDEN1                  ->NO ..KEEP LOOKING
         MVC   MSGDENS,DDEN1
         B     CHKMODL
CHKDEN1  TM    UCBTBYT2,UCBDUDN2        IS IT 1600/6250?
         BNO   CHKDEN2                  -> NO
         MVC   MSGDENS,DDEN2
         B     CHKMODL
CHKDEN2  TM    UCBTBYT1,UCBD1600         HOW ABOUT JUST 1600?
         BNO   CHKDEN3                   -> NO..ONCE MORE WITH FEELING
         MVC   MSGDENS,DEN1600
         B     CHKMODL
CHKDEN3  TM    UCBTBYT1,UCBD6250         LAST CHANCE..IS IT JUST 6250?
         BNO   CHKMODL                   -> NO..DONT KNOW DENSITY..
         MVC   MSGDENS,DEN6250
         SPACE
***
***   USE SYSTEM DEVICE NAME TABLE
***
***
CHKMODL  L     R1,DEVADDR         ADDRESS OF DEVICE NAME TABLE
         L     R10,0(R1)          NUMBER OF ENTRIES
         LA    R1,4(R1)           ADDRESS OF FIRST ENTRY
DEVLP    CLC   UCBTYP(4),8(R1)    IS THIS THE DEVICE TYPE
         BE    DEVFND             YES... BR TO SAVE DEVICE TYPE
         LA    R1,12(R1)          NO... INCR TO NEXT TABLE ENTRY
         BCT   R10,DEVLP          LOOP UNTIL END OF TABLE
         MVC   MSGMODL,=C'????'   SAY WE DONT KNOW DEVICE TYPE
         B     GETWHO
*
DEVFND   MVC   MSGMODL,0(R1)           MOVE UNIT TYPE TO PRINT LINE
*
GETWHO   XR    R10,R10
         L     R10,UCBEXTPT             GET EXTENTION TO UCB
         LTR   R10,R10                  ANYTHING THERE?
         BZ    PUTIT                    NO->SPLIT
         LA    R10,14(R10)              GET UCBASID ADDRESS
         LH    R10,0(R10)               AND GET THE ASID
         N     R10,=X'0000FFFF'          PLUS MASK OFF RESIDUE..
         LTR   R10,R10                  ANY BODY THERE?
         BZ    PUTIT                    NO->SIGH,ALL THAT FOR NAUGHT..
*
GOTASID  L     R4,CVTPTR                GET ADDR OF CVT
         USING CVT,R4                    AND ADDRESS YOURSELF TO IT..
         L     R4,CVTASVT               GET ADDR OF ASVT..
         DROP  R4
         USING ASVT,R4                  AND ESTAB ADDRESSABILITY
         SLL   R10,2                    ADJUST ASID..TO USE AS INDEX
         L     R10,ASVTFRST(R10)        R10=ADDR(ASCB) FOR ASID
         DROP  R4
         USING ASCB,R10                 GOTCHA
         L     R4,ASCBJBNI              IS IT A JOB
         LTR   R4,R4
         BZ    ITSTSO
         MVC   MSGUSER,0(R4)            MOVIN JOBNAME
         B     PUTIT
ITSTSO   L     R4,ASCBJBNS              ITS START/MOUNT/LOGON
         LTR   R4,R4
         BZ    PUTIT
         MVC   MSGUSER,0(R4)            MOVEIN USERID
PUTIT    DS    0H
*        LA    R1,BUFFER                MESSAGE ADDR.
         MVC   QDMSG(80),BUFFER MOVE DATA TO DISPLAY LINE
*        BAL   LINKREG,PUTMSG           ISSUE MESSAGE
         OI    SW1,FOUND                SAY WE FOUND A VOL...
         LA    R1,QDMSG           SAVE ADDRESS
         ST    R1,QDMSGA              OF THE MESSAGE
         MVC   QDMLNG,QDLNELEN    SET THE LENGTH
         L     R15,=V(DISPLAY)    BRANCH TO
         BALR  R14,R15              DISPLAY MODULE
         SPACE
INDEX    LA    R7,D2(R7)                NEXT ENTRY ADDR.
         B     CYCLE                    CONTINUE
         EJECT
WRTFMT   EQU   *
*        LA    R1,FMTMSG1               WRITE HEADERS....
         MVC   QDHLINE+4(76),FMTMSG1 MOVE DATA TO DISPLAY LINE
         OI    SW1,HEADING              SAY WE WROTE THE HEADERS
         B     DISPLAY
         SPACE 2
RLSE     LR    R1,R11                   CORE ADDR.
THEEND   QSTOP
         EJECT
*.....................................................................*
*        LOCAL SUBROUTINE FOR IO TO OPER/USER                         *
*.....................................................................*
         SPACE
*
* ENTER WITH WTO,WTOR LIST FORM POINTED TO BY R1
*
*    BAL  LINKREG,PUTMSG    OR
*    BAL  LINKREG,PUTGET
*
*  USES R14 FOR WORK
*
*
PUTMSG   DS    0H
         TM    TSOFLAG,X'80'       IS IT TSO?
         BO    TPUTIT              YES-> GO DO TPUT
         SVC   35                  NO-> USE WTO
         BR    LINKREG
TPUTIT   DS    0H
         LH    R0,0(,R1)           GET LENGTH OF WTO MESSAGE
         S     R0,=F'4'            SUBTRACT OFF HEADER
         LA    R1,4(,R1)           BUMP MSG ADDRESS PAST HDR
         TPUT  (1),(0),R           DO THE TPUT
         BR    LINKREG
         SPACE 2
PUTGET   DS    0H
         TM    TSOFLAG,X'80'       IS IT TSO?
         BO    TSOIT               YES-> GO USE TGET
         LR    R14,R1              NO-> USE WTOR .. SAVE MSG ADDRESS
         SVC   35                  DO THE WTOR...
         L     R1,4(,R14)          GET ADDR OF ECB
         XC    0(4,R1),0(R1)       CLEAN OUT THE ECB....
         LA    R0,1
         SVC   1                   WAIT FOR WTOR TO COMPLETE
         B     PUTRET              RETURN
TSOIT    DS    0H
         LR    R14,R1              SAVE
         LH    R0,8(,R1)           PUT LENGTH
         S     R0,=F'4'
         LA    R1,12(,R1)          PAST HDR
         TPUT  (1),(0),R
         SR    R0,R0
         IC    R0,0(,R14)          GET REPLY LENGTH
         L     R1,0(,R14)          GET REPLY ADRS
         LA    R1,0(,R1)
         ICM   R1,B'1000',=X'80'   INDICATE TGET...
         TGET  (1),(0),R
PUTRET   DS    0H
         L     R1,0(,R14)          GET REPLY ADRS
         XR    R0,R0
         IC    R0,0(,R14)          GET REPLY LENGTH
UPPER    DS    0H
         OI    0(R1),C' '          UPPER CASE
         LA    R1,1(,R1)           NXT
         BCT   R0,UPPER
         BR    LINKREG
         SPACE 2
         EJECT
*.....................................................................*
*        LIST FORMS OF MACROS                                         *
*.....................................................................*
         SPACE 2
EXTRACT  EXTRACT *-*,'S',FIELDS=(TSO),MF=L
EXTRACTL EQU   *-EXTRACT
         SPACE 2
FMTMSG1  DC CL80'UNIT VOLUME STATUS  USER          DENSITY   MODEL '
         SPACE 2
         EJECT
*.....................................................................*
*        PROGRAM CONSTANTS/LITERALS                                   *
*.....................................................................*
         SPACE 2
ONLINE   DC    CL7'ONLINE'
OFFLINE  DC    CL7'OFFLINE'
VARY     DC    CL4'VARY'
DDEN1    DC    CL9'800/1600'
DDEN2    DC    CL9'1600/6250'
DEN800   DC    CL9'800'
DEN1600  DC    CL9'1600'
DEN6250  DC    CL9'6250'
*
         EJECT
*
* PROGRAM  E Q U A T E S
*
*R0       EQU   0              MACROS-WORK
*R1       EQU   1              MACROS-WORK
*R2       EQU   2
*R3       EQU   3
*R4       EQU   4              WORK/ASVT
*R5       EQU   5
*R6       EQU   6              LINKREG FOR PUTGET
*R7       EQU   7              UCB LOOKUP TABLE
*R8       EQU   8              UCB ADDRESSABILITY
*R9       EQU   9
*R10      EQU   10             WORK/ASCB
*R11      EQU   11             CORE DSECT (WORK AREA) ADDRESSABILITY
*R12      EQU   12             PROGRAM BASE REGISTER
*R13      EQU   13             SAVE AREA POINTER
*R14      EQU   14             MACROS - WORK  RETURN ADDRESS
*R15      EQU   15             MACROS - WORK/ RETURN CODE
*
D0       EQU   0
D1       EQU   1
D2       EQU   2
D4       EQU   4
D8       EQU   8
D12      EQU   12
D16      EQU   16
*
HEADING  EQU   X'01'
FOUND    EQU   X'02'
NOTFOUND EQU   X'FD'
SKIP     EQU   X'80'
NOSKIP   EQU   X'7F'
CHARZERO EQU   C'0'
         EJECT
CVT      DSECT
         CVT       SYS=VMS,TSO=YES
         EJECT
UCBSECT  DSECT
         IEFUCBOB
         EJECT
         IHAASCB
         EJECT
         IHAASVT
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
         EJECT
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
DEVADDR  DS    F
BUFFER   DS    CL80              TO RECEIVE THE WTO LIST FORM
         ORG   BUFFER+4
         DS    CL1
MSGUNIT  DS    CL3
         DS    CL1
MSGVOL   DS    CL6
         DS    CL1
MSGSTAT  DS    CL7
         DS    CL1
MSGUSER  DS    CL8
         DS    CL1
MSGVARY  DS    CL4
         DS    CL1
MSGDENS  DS    CL9
         DS    CL1
MSGMODL  DS    CL8
*
         ORG
*
SW1      DS    1C
TSOFLAG  DS    X                   ='80' IF TSO. '00' IF NOT TSO
ANSWER   DS    F                   ADDRESS POINTER FOR EXTRACT
DBLW     DS    4D
         ORG   DBLW
EXTRACT1 DS    4D
         ORG
LCT      DS    H                        TO REMEMBER COUNT
LMAX     DS    H                        TO REMEMBER UCB MAX ADDR
LIST     DS    500H                     TO REMEMBER EACH UCB ADDR
WORKEND  EQU   *
         END
./       ADD   NAME=DUMP
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
DUMP     TITLE 'QUEUE COMMAND - XU FORMAT JES2 CONTROL BLOCKS '
DUMP     QSTART HASPEQU=YES,       START DEVIREQ DSECT ASSEMBLY DOR XXXX
               XTITLE='QUEUE COMMAND - XU FORMAT JES2 CONTROL BLOCKS '
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QSP136        SP1.3.6 OPTION FLAG               DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13
         XC    DALLREG,DALLREG       INITIALIZE
         CLC   =C'HCT ',QPARM1     DUMP THE HCT VARIABLES?
         BE    DHCT                YES. GO PROCESS
         CLC   =C'CKPT',QPARM1     DUMP THE CKPT?
         BE    DCKPT               YES. GO PROCESS
         CLC   =C'JOT ',QPARM1     DUMP THE JOT?
         BE    DJOT                YES. GO PROCESS
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE JQE,JCT, AND IOT                           *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB)    ROUTINE TO FIND JOB
         BALR  R14,R15            GO TO IT
         EJECT
***********************************************************************
*                                                                     *
*   DETERMINE THE CONTROL BLOCK TO BE FORMATTED                       *
*                                                                     *
***********************************************************************
         CLC   =C'ALL ',QPARM2       DUMP ALL CONTROL BLOCKS FOR JOB
         BE    DALL                  YES. GO PROCESS
         XC    DALLREG,DALLREG       INITIALIZE
         CLC   =C'JQE',QPARM2        DUMP THE JQE?
         BE    DJQE                  YES. GO PROCESS
         CLC   =C'JCT ',QPARM2       DUMP THE JCT?
         BE    DJCT                  YES. GO PROCESS
         CLC   =C'JOE',QPARM2        DUMP THE JOE?
         BE    DJOE                  YES. GO PROCESS
         CLC   =C'IOT',QPARM2        DUMP THE IOT?
         BE    DIOT                  YES. GO PROCESS
         CLC   =C'PDDB',QPARM2       DUMP THE PDDB?
         BE    DPDDB                 YES. GO PROCESS
         AIF   (NOT &QACF2).$SKIP1                                ANRP*
         CLC   =C'JCB ',QPARM2       DUMP THE ACF2 JCB?
         BE    DJCB                  YES. GO PROCESS
.$SKIP1  ANOP
         B     STOP
***********************************************************************
*                                                                     *
*   DUMP ALL THE CONTROL BLOCKS FOR THE JOB                           *
*                                                                     *
***********************************************************************
DALL     SR    R2,R2          CLEAR REG
         LA    R2,FIRSTCB     ADDR OF FIRST CB TO BE FORMATTED
         ST    R2,DALLREG     SAVE ADDRESS
FIRSTCB  B     DJQE           DUMP JQE
         B     DJCT           DUMP JCT
         AIF   (NOT &QACF2).$SKIP2
         B     DJCB           DUMP ACF2 JCB
.$SKIP2  ANOP
         B     DJOE           DUMP JOE
         B     DIOT           DUMP IOT
         B     DPDDB          DUMP PDDB
         B     STOP1          EXIT
***********************************************************************
*                                                                     *
*   FORMAT THE JQE                                                    *
*                                                                     *
***********************************************************************
DJQE     MVC   QDHLINE,JQEHDR MOVE IN THE HEADING
         L     R2,JQEDESCX    A(JQE DESCRIPTION)
         L     R4,QCJQEA      ADDR OF INPUT DATA
         BAL   R3,FORMAT      GO FORMAT THE JQE
         B     STOP           EXIT
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE JOE                                                    *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A
         USING JQE,R1             BASE REG FOR JQE               DOR
         AGO   .X136A
.NO136A  ANOP
         USING JQEDSECT,R1        BASE REG FOR JQE
.X136A   ANOP
DJOE     MVC   QDHLINE,JOEHDR     MOVE IN THE HEADING
         L     R1,QCJQEA          A(JQE)
         SR    R4,R4              CLEAR REG
         ICM   R4,7,JQEJOE+1      JOE OFFSET
         DROP  R1
JOELOOP  LTR   R4,R4              ?/JOE PRESENT
         BZ    STOP               NO. EXIT
         MVC   QDMSG,WJOEHDR      MOVE IN THE HEADING
         BAL   R8,DISPLAY1        GO DISPLAY THE HEADER
         L     R1,QCJOTA          A(JOT)
         AR    R4,R1              A(JOE)
         ST    R4,JOEADDR         SAVE JOE ADDR
         L     R2,WJOEDSCX        A(WORK JOE DESCRIPTION)
         BAL   R3,FORMAT          BRANCH TO FORMAT ROUTINE
         MVC   QDMSG,QBLANK       BLANK OUT THE MESSAGE AREA
         BAL   R8,DISPLAY1        GO DISPLAY THE BLANK LINE
         AIF   (NOT &QSP136).NO136B
         USING JOE,R4             BASE REG FOR JQE               DOR
         AGO   .X136B
.NO136B  ANOP
         USING JOEDSECT,R4        BASE REG FOR JOE
.X136B   ANOP
         L     R4,JOEADDR         RESTORE JOE ADDR
         SR    R5,R5              CLEAR REG
         ICM   R5,7,JOECHARB      GET ADDRESS OF CHAR JOE
         LTR   R5,R5              IS THERE ONE
         BZ    NOCHAR             NO  DONT FORMAT
         MVC   QDMSG,CJOEHDR      MOVE IN THE HEADING
         BAL   R8,DISPLAY1        GO DISPLAY THE HEADER
         A     R5,QCJOTA          ADD OFFSET
         LR    R4,R5              R4 - CHAR JOE OFFSET
         L     R2,CJOEDSCX        A(CHAR JOE DESCRIPTION)
         BAL   R3,FORMAT          BRANCH TO FORMAT ROUTINE
         MVC   QDMSG,QBLANK       BLANK OUT THE MESSAGE AREA
         BAL   R8,DISPLAY1        GO DISPLAY THE BLANK LINE
         L     R4,JOEADDR         RESTORE JOE ADDR
NOCHAR   SR    R5,R5              CLEAR REG
         ICM   R5,7,JOEJQNXB      GET NEXT JOE OFFSET
         LR    R4,R5              R4 - WORK JOE OFFSET
         B     JOELOOP            GO THRU THE CYCLE AGAIN
         DROP  R4
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE JCT                                                    *
*                                                                     *
***********************************************************************
DJCT     MVC   QDHLINE,JCTHDR  MOVE IN THE HEADING
         LA    R2,WJCTDESC     LOAD ADDRESS OF WORK DESC
         L     R3,=A(DESCL)    LOAD LENGTH  OF JCT  DESC
         L     R4,JCTDESCX     LOAD ADDRESS OF JCT  DESC
         LR    R5,R3           LOAD LENGTH AGAIN
         MVCL  R2,R4           MOVE DESC TO WORKING STORAGE
         L     R4,QCJCTA       A(INPUT DATA)
         AIF   (NOT &QSP136).NO136C
         USING JCT,R4             BASE REG FOR JQE               DOR
         AGO   .X136C
.NO136C  ANOP
         USING JCTDSECT,R4        BASE REG FOR JOE
.X136C   ANOP
         CLI   JCTJOBID,C'J'   IS THIS A JOB?
         BE    DOIT            YES  NO CHANGE NECESSARY
         LA    R2,WJCTDESC     GET ADDRESS
         MVI   PRTYD(R2),X'02' SHOW PRTY NOT CHARACTER
         DROP  R4              DROP ADDRESSABILITY
DOIT     DS    0H
         LA    R2,WJCTDESC    A(JCT DESCRIPTION)
         L     R4,QCJCTA      A(INPUT DATA)
         BAL   R3,FORMAT      GO FORMAT THE DATA
         B     STOP           EXIT
         EJECT
         AIF   (NOT &QACF2).$SKIP3
***********************************************************************
*                                                                     *
*   FORMAT THE ACF2 JCB                                               *
*                                                                     *
***********************************************************************
DJCB     MVC   QDHLINE,JCBHDR  MOVE IN THE HEADING
         L     R2,JCBDESCX     A(JCB DESCRIPTION)
         L     R4,QCJCTA       A(INPUT DATA)
         AIF   (NOT &QSP136).NO136D
         USING JCT,R4             BASE REG FOR JCT               DOR
         AGO   .X136D
.NO136D  ANOP
         USING JCTDSECT,R4        BASE REG FOR JOE
.X136D   ANOP
         ICM   R8,15,&ACF2JCB  TEST, GET ACF2 AREA OFFSET         ANRP*
         BZ    NOACF2          NOT PRESENT, SKIP AROUND           ANRP*
         CH    R8,QBUFSIZE     IS ADDRESS STILL WITHIN JCT        ANRP*
         BH    NOACF2          NO  DO NOT FORMAT                  ANRP*
         DROP  R4              DROP TEMP                          ANRP*
**********************************************                    ANRP*
****   THE FOLLOWING SUBTRACTION IS BECAUSE THE IOB IS NOT USED   ANRP*
****     IN QUEUE AND THEREFORE THE JCT ADDRESS NEEDS TO BE       ANRP*
****     REDUCED ACCORDINGLY.                                     ANRP*
         S     R8,QBUFLEN       ADJUST FOR HASP BUFFER PREFIX     ANRP*
**********************************************                    ANRP*
         LA    R8,0(R4,R8)     CALCULATE ADDRESS                  ANRP*
         LR    R4,R8           LOAD ADDRESS IN CORRECT REG        ANRP*
         BAL   R3,FORMAT       GO FORMAT THE DATA
NOACF2   DS    0H                                                 ANRP*
         B     STOP            EXIT
         EJECT
.$SKIP3  ANOP
***********************************************************************
*                                                                     *
*   FORMAT THE IOT                                                    *
*                                                                     *
***********************************************************************
DIOT     MVC   QDHLINE,IOTHDR     MOVE IN THE HEADING
         MVI   SWITCH,0
         L     R4,QCIOTA          A(INPUT DATA)
         LTR   R4,R4              ?/IOT VALID
         BZ    STOP               NO. EXIT
IOTLOOP  ST    R4,IOTADDR         YES. SAVE FOR LATER USE
         L     R2,IOTDESCX        A(IOT DESCRIPTION)
         BAL   R3,FORMAT          GO FORMAT THE DATA
         MVC   QDMSG,QBLANK       BLANK OUT THE MESSAGE AREA
         BAL   R8,DISPLAY1        GO DISPLAY THE BLANK LINE
         L     R4,IOTADDR         RESTORE IOT ADDR
         L     R4,NEXTIOT(R4)     GET ADDR OF NEXT IOT
IOT010   LTR   R4,R4              ?/NEXT IOT PRESENT
         BZ    SPINIOT            NO. CHECK SPIN IOT'S
         BAL   R8,READ            YES. READ THE IOT IN
         B     IOTLOOP
SPINIOT  TM    SWITCH,1           ?/SPIN IOT ALREADY SEARCHED
         BO    STOP               YES. EXIT
         OI    SWITCH,1           NO. INDICATE NOW BEING SEARCHED
         L     R4,QCJCTA          A(JCT)
         L     R4,12(R4)          GET ADDR OF SPIN IOT
         B     IOT010             GO VERIFY THE IOT IS VALID
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE PDDB                                                   *
*                                                                     *
***********************************************************************
DPDDB    MVC   QDHLINE,PDDBHDR    MOVE IN THE HEADING
         MVI   SWITCH,0           INITIALIZE SWITCH
         MVC   PDDBKEY,=H'0'      INITIALIZE DSID KEY
         AIF   (NOT &QSP136).NO136E
         USING PDB,R2             BASE REG FOR PDDB              DOR
         USING IOT,R3             BASE REG FOR IOT               DOR
         AGO   .X136E
.NO136E  ANOP
         USING PDBDSECT,R2        BASE REG FOR PDDB
         USING IOTDSECT,R3        BASE REG FOR IOT
.X136E   ANOP
         CLI   QPARM3,C' '        WAS A SPECIFIC PDDB REQUESTED?
         BNE   PDDBS              YES  GO GET IT
SPDDB    L     R3,QCIOTA          LOAD BASE REG
         LR    R4,R3              BASE OF IOT
PDDB010  A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         S     R4,QBUFLEN         ADJUST FOR HASP BUFFER PREFIX
         LR    R2,R3              BASE OF IOT
         A     R2,IOTPDDB         OFFSET TO FIRST PDDB IN IOT
         S     R2,QBUFLEN         ADJUST FOR HASP BUFFER PREFIX
PDDB020  ST    R2,PDDBADDR        SAVE ADDR OF PDDB
         ST    R3,IOTADDR         SAVE ADDR OF IOT
         ST    R4,LASTPDDB        SAVE ADDR OF LAST PDDB
         LH    R4,PDDBKEY         LOAD DSID KEY
         LTR   R4,R4              WAS A SPECIFIC ONE REQUESTED?
         BZ    DISPDDB            NO  SKIP TEST
         CH    R4,PDBDSKEY        IT THIS THE CORRECT ONE
         BNE   NEXTPDDB           NO  SKIP TO NEXT ONE
DISPDDB  LR    R4,R2              ADDR OF INPUT DATAET?
         L     R2,PDDBDSCX        A(PDDB DESCRIPTION)
         BAL   R3,FORMAT          GO FORMAT THE PDDB
         MVC   QDMSG,QBLANK       BLANK OUT THE MESSAGE AREA
         BAL   R8,DISPLAY1        GO DISPLAY THE BLANK LINE
NEXTPDDB L     R2,PDDBADDR        RESTORE ADDR OF PDDB
         L     R3,IOTADDR         RESTORE ADDR OF IOT
         L     R4,LASTPDDB        RESTORE ADDR OF LAST PDDB
         LA    R2,PDBLENG(R2)     NO. LOOK AT NEXT PDDB.
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB?
         BNL   PDDB025            YES. GET NEXT PDDB
         CLC   PDBDSKEY,=H'0'     ?/VALID PDDB
         BNE   PDDB020            YES. GO PROCESS
PDDB025  L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
PDDB030  LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    PDDB040            NO. TRY THE SPIN IOT?
         BAL   R8,READ            READ THE IOT
         B     PDDB010            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136F
         USING JCT,R1            BASE REG FOR JCT                  DOR
         AGO   .X136F
.NO136F  ANOP
         USING JCTDSECT,R1        BASE REG FOR JCT
.X136F   ANOP
PDDB040  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY?
         BO    STOP               YES. EXIT.
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         B     PDDB030            SEARCH THE SPIN IOT CHAIN
         EJECT
***********************************************************************
*                                                                     *
*   CHECK IF REQUESTING A SPECIFIC PDDB                               *
*                                                                     *
***********************************************************************
PDDBS    LH    R4,QLNG3           LENGTH OF DATASET ID FIELD
         SH    R4,=H'1'           IS DSID FIELD ZERO LENGTH?
         BM    PDBTILT            YES. QUIT.
         MVC   QFZONES,QFZONE     INITIALIZE NUMERIC TEST
         EX    R4,MVZ             MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE     IS THE FIELD NUMERIC?
         BNE   PDBTILT            NO. QUIT.
         EX    R4,PACK            PACK THE FIELD
         CVB   R4,CONVERT         CONVERT TO BINARY
         STH   R4,PDDBKEY         STORE REQUESTED DSID KEY
         B     SPDDB              AND RETURN TO CALLER
PDBTILT  QTILT '*** ILLEGAL PDDB NUMBER REQUESTED ***'
         DROP  R1,R2,R3
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE HCT                                                    *
*                                                                     *
***********************************************************************
DHCT     MVC   QDHLINE,HCTHDR     MOVE IN THE HEADING
         L     R2,HCTDESCX        A(HCT DESCRIPTION)
         L     R4,QCJQTL          ADDR OF INPUT DATA
         BAL   R3,FORMAT          GO FORMAT THE HCT
         B     STOP               EXIT
***********************************************************************
*                                                                     *
*   FORMAT THE JOT                                                    *
*                                                                     *
***********************************************************************
DJOT     MVC   QDHLINE,JOTHDR MOVE IN THE HEADING
         L     R2,JOTDESCX    A(JOT DESCRIPTION)
         L     R4,QCJOTA      ADDR OF INPUT DATA
         BAL   R3,FORMAT      GO FORMAT THE JOT
         B     STOP           EXIT
***********************************************************************
*                                                                     *
*   FORMAT THE CHECKPOINT                                             *
*                                                                     *
***********************************************************************
DCKPT    MVC   QDHLINE,CKPTHDR    MOVE IN THE HEADING
         LA    R2,4095            LENGTH OF CKPT RECORDS-1
         LA    R2,1(,R2)          LENGTH OF CKPT RECORDS
         L     R4,QCJQTL          A(FIRST CHECKPOINT RECORD)
         L     R6,QCJOTL          NO. OF CHECKPOINT RECORDS
         LA    R6,0(R6)           PURIFY THE REG
         B     CKPT000            GO FORMAT THE DATA
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE DATA                                                   *
*                                                                     *
***********************************************************************
FORMAT   ST    R3,RETURN          SAVE LINK ADDRESS
         SR    R5,R5              OFFSET REGISTER
FMT000   LA    R3,QDMSG           A(DISPLAY LINE)
         LH    R6,QDLNELEN        LOAD LENGTH OF LINE              MOD5
         AR    R6,R3              A(END OF DISPLAY)                MOD5
         MVC   QDMSG,QBLANK       INIT THE CURRENT LINE
         MVI   0(R3),C'+'         INDICATE RELATIVE
         XC    PLAY,PLAY
         ST    R5,PLAY            TRANSLATE
         UNPK  PLAY(9),PLAY(5)        OFFSET TO
         TR    PLAY(8),TBL-240               DECIMAL
         MVC   1(3,R3),PLAY+5
         LA    R3,5(R3)           NEXT LOCATION OF DISPLAY LINE
FMT010   CLI   0(R2),X'FF'        ?/ALL FIELDS FORMATTED
         BE    DISPLAY            GO DISPLAY THE LINE
         SR    R7,R7              CLEAR REG FOR INSERT
         IC    R7,5(R2)           GET LENGTH OF FIELD
         CLC   =C'HCT',QPARM1     ?/FORMATTING THE HCT
         BNE   NOHCT0             NO. DON'T BUMP
         IC    R7,8(R2)           GET LENGTH OF FIELD
NOHCT0   LA    R8,6(R3)           CURRENT DISPLACEMENT IN DISPLAY LINE
         CLC   =C'HCT',QPARM1     ?/FORMATTING THE HCT
         BNE   NOHCT1             NO. DON'T BUMP
         LA    R8,3(R8)           ADD THE EXTRA FOR HCT
NOHCT1   CLM   R7,1,=X'80'        ?/CHARACTER FIELD
         BC    13,DOUBLE          ** NO. DOUBLE THE LENGTH
         N     R7,=X'0000007F'    ** TURN OFF INDICATOR IN CASE
         SRL   R7,1               ** YES. CUT LENGTH IN HALF
         B     NODOUBLE           ** DON'T DOUBLE
DOUBLE   AR    R8,R7              ADD LENGTH TO DISPLACEMENT
NODOUBLE AR    R8,R7              DOUBLE IT
         CR    R8,R6              ?/ENOUGH ROOM ON DISPLAY
         BH    FMT050             NO. GO DISPLAY THIS LINE
         CLC   =C'HCT',QPARM1     ?/FORMATTING THE HCT
         BNE   NOHCT2             NO. BYPASS PROCESSING FOR HCT
         LA    R1,18(R3)          DEFAULT FOR NEXT OFFSET
         CH    R7,=H'4'           ?/FIELD LENGTH <= 4
         BNH   FMT015H            YES. CONTINUE
         LA    R1,18(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'13'          ?/FIELD LENGTH <= 13
         BNH   FMT015H            YES. CONTINUE
         LA    R1,18(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'22'          ?/FIELD LENGTH <= 22
         BNH   FMT015H            YES. CONTINUE
         LA    R1,18(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'31'          ?/FIELD LENGTH <= 31
         BNH   FMT015H            YES. CONTINUE
         QTILT '** UNABLE TO FORMAT DUE TO FIELD DESCRIPTION ERROR **'
FMT015H  ST    R1,NEXTOSET        SAVE NEXT OFFSET
         MVC   0(8,R3),0(R2)      YES. MOVE IN FIELD ID
         LA    R3,9(R3)           UPDATE DISPLACEMENT
         B     FMT020             BRANCH AROUND NON-HCT CODE
NOHCT2   LA    R1,15(R3)          DEFAULT FOR NEXT OFFSET
         CH    R7,=H'4'           ?/FIELD LENGTH <= 4
         BNH   FMT015             YES. CONTINUE
         LA    R1,15(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'11'          ?/FIELD LENGTH <= 11
         BNH   FMT015             YES. CONTINUE
         LA    R1,15(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'19'          ?/FIELD LENGTH <= 19
         BNH   FMT015             YES. CONTINUE
         LA    R1,15(R1)          BUMP FOR NEXT OFFSET
         CH    R7,=H'26'          ?/FIELD LENGTH <= 26
         BNH   FMT015             YES. CONTINUE
         QTILT '** UNABLE TO FORMAT DUE TO FIELD DESCRIPTION ERROR **'
MVECHAR  MVC   0(0,R3),0(R4)      **
FMT015   ST    R1,NEXTOSET        SAVE NEXT OFFSET
         LH    R15,QDLNELEN       LOAD LENGTH FOR COMPARE
         CH    R15,=H'80'         IS THIS A MOD 2 SCREEN
         BE    MVENAME            YES  MOVE FIELD NAME
         CLI   0(R2),C' '         IS THE FIELD NAME BLANK
         BE    FMT020             YES  DO NOT MOVE FIELD NAME
MVENAME  MVC   0(5,R3),0(R2)      YES. MOVE IN FIELD ID
         LA    R3,6(R3)           UPDATE DISPLACEMENT
FMT020   SR    R15,R15            CLEAR REG
         IC    R15,5(R2)          INSERT LENGTH AND FLAG
         CLC   =C'HCT',QPARM1     ?/DUMPING THE HCT
         BNE   NOHCT3             NO. BYPASS HCT PROCESSING
         IC    R15,8(R2)          YES. GET THE TRUE LENGTH AND FLAG
NOHCT3   ST    R15,SAVER15        SAVE CONTENTS OF REG 15
         N     R15,=X'00000080'   DESTROY LENGTH AND SAVE THE FLAG
         LTR   R15,R15            ?/CHARACTER FIELD
         BZ    FMT030             NO. GO TRANSLATE DATA TO EBCDIC
         L     R15,SAVER15        RESTORE CONTENTS OF REG 15
         N     R15,=X'0000007F'   TURN OFF THE FLAG AND SAVE LENGTH
         BCTR  R15,R0             DECREMENT LENGTH FOR EXECUTE
         EX    R15,MVECHAR        MOVE DATA TO DISPLAY LINE
         LA    R15,1(R15)         RESET LENGTH
         AR    R3,R15             ADD LENGTH TO DISPLAY LINE
         AR    R4,R15             ADD LENGTH TO INPUT DATA OFFSET
         AR    R5,R15             ADD LENGTH TO OFFSET
         B     FMT040             GO PREPARE FOR NEXT FIELD
FMT030   XC    PLAY,PLAY          CLEAR WORK AREA
         MVC   PLAY(1),0(R4)      MOVE DATA TO WORK AREA
         UNPK  PLAY+2(3),PLAY(2)  UNPACK THE DATA
         TR    PLAY+2(2),TBL-240  TRANSLATE TO PRINTABLE CHAR.
         MVC   0(2,R3),PLAY+2     MOVE INTO DISPLAY LINE
         LA    R3,2(R3)           UPDATE DISPLACEMENT
         LA    R4,1(R4)           POINT TO NEXT BYTE OF DATA
         LA    R5,1(R5)           RELATIVE OFSSET
         BCT   R7,FMT030          DO IT AGAIN.
FMT040   L     R3,NEXTOSET        GET NEXT OFFSET
         LA    R2,6(R2)           GET NEXT FIELD ID
         CLC   =C'HCT',QPARM1     ?/DUMPING THE HCT
         BNE   FMT010             NO. GO TO LOOP
         LA    R2,3(R2)           YES. POINT TO THE REAL NEXT FIELD
         B     FMT010
FMT050   BAL   R8,DISPLAY1        GO DISPLAY THIS LINE
         B     FMT000
DISPLAY  BAL   R8,DISPLAY1        GO DISPLAY THE LAST LINE
         L     R3,RETURN          RESTORE LINK ADDRESS
         BR    R3                 RETURN TO CALLER
DISPLAY1 DS    0H
         CLC   =C'CKPT',QPARM1    ?/CHECKPOINT BEING DUMPED
         BNE   DISPLAY2           NO. KEEP ON TRUCKING
         L     R1,STARTADR        STARTING ADDR OF DATA FOR THIS LINE
         LR    R15,R4             ENDING ADDR OF DATA FOR THIS LINE
         SR    R15,R1             LENGTH OF DATA
         BCTR  R15,R0             DECREMENT BY 1 FOR EXECUTE.
         EX    R15,MOVE0          MOVE THE DATA TO THE WORK AREA
         EX    R15,TRANSLTE       TRANSLATE THE DATA
         EX    R15,MOVE1          MOVE THE DATA TO THE DISPLAY LINE
         MVI   QDMSG+52,C'*'      FILL IN THE REST
         MVI   QDMSG+73,C'*'           OF THE DATA
DISPLAY2 LA    R1,QDMSG           SAVE ADDRESS
         ST    R1,QDMSGA              OF THE MESSAGE
         MVC   QDMLNG,QDLNELEN    SET THE LENGTH
         L     R15,=V(DISPLAY)    BRANCH TO
         BALR  R14,R15              DISPLAY MODULE
         BR    R8
MOVE0    MVC   PLAY1(0),0(R1)     MOVE DATA TO WORK AREA
MOVE1    MVC   QDMSG+53(0),PLAY1  MOVE DATA TO DISPLAY LINE
TRANSLTE TR    PLAY1(0),TBL1      CHANGE THE DATA TO SPECIAL FORMAT
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT THE CHECKPOINT DATA                                        *
*                                                                     *
***********************************************************************
CKPT000  SR    R5,R5                CLEAR OFFSET REGISTER
CKPT010  ST    R4,STARTADR          SAVE START ADDR OF DATA FOR LINE
         LA    R3,QDMSG             A(DISPLAY LINE)
         MVC   QDMSG,QBLANK         BLANK THE CURRENT LINE
         MVI   0(R3),C'+'           INDICATE RELATIVE
         XC    PLAY,PLAY            CLEAR THE WORK AREA
         ST    R5,PLAY              MOVE OFFSET TO WORK AREA
         UNPK  PLAY(9),PLAY(5)
         TR    PLAY(8),TBL-240      TRANSLATE TO EBCDIC
         MVC   1(4,R3),PLAY+4       MOVE OFFSET TO DISPLAY LINE
         LA    R3,6(R3)             POINT TO NEXT AREA IN DISPLAY LINE
         LA    R7,5                 NO. OF FIELDS PER DISPLAY LINE
CKPT020  XC    PLAY,PLAY            CLEAR THE WORK AREA
         MVC   PLAY(4),0(R4)        MOVE DATA TO WORK AREA
         UNPK  PLAY(9),PLAY(5)
         TR    PLAY(8),TBL-240      TRANSLATE TO EBCDIC
         MVC   0(8,R3),PLAY         AND MOVE TO DISPLAY LINE
         LA    R5,4(R5)             UPDATE THE OFFSET
         LA    R3,9(R3)             UPDATE DISPLAY LINE LOCATION
         LA    R4,4(R4)             POINT AT NEXT 4 BYTES OF DATA
         SH    R2,=H'4'             DECREMENT LENGTH BY 4
         C     R2,=F'0'             ?/ANY DATA LEFT
         BNH   CKPT030              NO. GO DISPLAY THE LINE
         BCT   R7,CKPT020           YES, DO ANOTHER FIELD IF ROOM
         BAL   R8,DISPLAY1          NO ROOM. DISPLAY THIS LINE
         B     CKPT010              GO GET ANOTHER LINE
CKPT030  BAL   R8,DISPLAY1          GO DISPLAY THE LINE
         LA    R2,4095              LENGTH OF CKPT RECORDS-1
         LA    R2,1(,R2)            LENGTH OF CKPT RECORDS
         BCT   R6,CKPT010           GO FORMAT THIS BUFFER
         B     STOP                 NO MORE BUFFERS. GO HOME
         EJECT
***********************************************************************
*                                                                     *
*   PREPARE TO READ THE SPOOL PACK                                    *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK
         L     R1,QCIOTA
         L     R15,=V(READSPC)
         BALR  R14,R15
         L     R4,QCIOTA          A(IOT)
         BR    R8
         SPACE 4
***********************************************************************
*                                                                     *
*   RETURN TO THE CALLER                                              *
*                                                                     *
***********************************************************************
STOP     L     R2,DALLREG     RESTORE REG TO DETERMINE NEXT CB
         LTR   R2,R2          ?/IS IT VALID
         BZ    STOP1          NO. EXIT
         LA    R2,4(R2)       YES. UPDATE THE POINTER
         ST    R2,DALLREG     SAVE THE POINTER
         MVC   QDMLNG,=H'0'   INDICATE DISPLAY NOW
         L     R15,=V(DISPLAY) ADDR OF DISPLAY ROUTINE
         BALR  R14,R15        LINK TO IT
         BR    R2             GO TO IT
STOP1    QSTOP
         EJECT
***********************************************************************
*                                                                     *
*   MISCELLANEOUS NUTS, BOLTS, ETC                                    *
*                                                                     *
***********************************************************************
         DS    0F
JQEDESCX DC    A(JQEDESC)
WJOEDSCX DC    A(WJOEDSC)
CJOEDSCX DC    A(CJOEDSC)
JCTDESCX DC    A(JCTDESC)
JCBDESCX DC    A(JCBDESC)
IOTDESCX DC    A(IOTDESC)
PDDBDSCX DC    A(PDDBDESC)
JOTDESCX DC    A(JOTDESC)
HCTDESCX DC    A(HCTDESC)
TBL1     DC    64C'.',C' ',9C'.',C'.<(+',X'50',9C'.',C'!$*);^-/'
         DC    9C'.',C',%_>?',10C'.',C':#@',X'7D',C'="'
         DC    65C'.',C'ABCDEFGHI',7C'.',C'JKLMNOPQR'
         DC    8C'.',C'STUVWXYZ'
         DC    6C'.',C'0123456789',6C'.'
TBL      DC    C'0123456789ABCDEF'
JQEHDR   DC    CL80'***  J Q E  ***'
JOEHDR   DC    CL80'***  J O E S  ***'
JCTHDR   DC    CL80'***  J C T  ***'
JCBHDR   DC    CL80'***  J C B  ***'
IOTHDR   DC    CL80'***  I O T  ***'
PDDBHDR  DC    CL80'***  P D D B  ***'
JOTHDR   DC    CL80'***  JOB OUTPUT TABLE ****'
HCTHDR   DC    CL80'***  HCT CHECKPOINTED VARIABLES  ***'
CKPTHDR  DC    CL80'***  CHECKPOINT  RECORD  ***'
WJOEHDR  DC    CL132'***  WORK J O E ****'
CJOEHDR  DC    CL132'***  CHAR J O E ****'
NEXTIOT  EQU   16
MVZ      MVZ   QFZONES(1),QPARM3     CHECK FOR NUMERIC
PACK     PACK  CONVERT,QPARM3(1)     CONVERT TO BINARY
         LTORG
***********************************************************************
*                                                                     *
*   FORMAT OF TABLES FOR JQE, JOE, IOT, PDDB, JCT, JOT, JCB.          *
*                                                                     *
*        OFFSET    LENGTH         DESCRIPTION                         *
*          0         5              FIELD ID TAG.                     *
*          5         1              X... ....  IF ON INDICATES THE    *
*                                              FIELD IS ALREADY IN    *
*                                              EBCDIC FORMAT.         *
*                                   ...X XXXX  LENGTH OF FIELD.       *
*                                              MAXIMUM LENGTH IS X'1A'*
*                                                                     *
***********************************************************************
***********************************************************************
*                                                                     *
*   DESCRIPTION OF JQE FIELDS                                         *
*                                                                     *
***********************************************************************
JQEDESC  DS    0F
         DC    CL5'PRIO ',X'01'
         DC    CL5'TYPE ',X'01'
         DC    CL5'JOBNO',X'02'
         DC    CL5'FLAGS',X'01'
         DC    CL5'NEXTB',X'03'
         DC    CL5'FLAG2',X'01'
         DC    CL5'JOEB ',X'03'
         DC    CL5'FLAG3',X'01'
         DC    CL5'JCLAS',X'81'
         DC    CL5'IJBNO',X'02'
         DC    CL5'TRAK ',X'04'
         DC    CL5'SPOLS',X'04'
         DC    CL5'INNDE',X'02'
         DC    CL5'EXNDE',X'02'
         DC    CL5'PRNOD',X'02'
         DC    CL5'PRREM',X'02'
         DC    CL5'PUNOD',X'02'
         DC    CL5'PUREM',X'02'
         DC    CL5'HLDCT',X'01'
         DC    CL5'JBLOK',X'01'
         DC    CL5'JNAME',X'88'
         DC    CL5'JOEID',X'02'
         DC    CL5'FLAG4',X'01'
         DC    CL5'RESV ',X'03'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF WORK JOE FIELDS                                    *
*                                                                     *
***********************************************************************
WJOEDSC  DS    0F
         DC    CL5'TYPE ',X'01'
         DC    CL5'NEXTB',X'03'
         DC    CL5'CURCL',X'01'
         DC    CL5'PREVB',X'03'
         DC    CL5'FLAG ',X'01'
         DC    CL5'JQEB ',X'03'
         DC    CL5'FLAG2',X'01'
         DC    CL5'JQNXB',X'03'
         DC    CL5'SEC  ',X'01'
         DC    CL5'CHARB',X'03'
         DC    CL5'CPU  ',X'01'
         DC    CL5'CHNXB',X'03'
         DC    CL5'FSID ',X'04'
         DC    CL5'PRIO ',X'02'
         DC    CL5'JNEWS',X'02'
         DC    CL5'CPADR',X'04'
         DC    CL5'RECCT',X'04'
         DC    CL5'PGCT ',X'04'
         DC    CL5'WRECN',X'04'
         DC    CL5'WPAGN',X'04'
         DC    CL5'IOTTR',X'04'
         DC    CL5'DEVID',X'03'
         DC    CL5'TFLAG',X'01'
         DC    CL5'RNODE',X'02'
         DC    CL5'REMOT',X'02'
         DC    CL5'PDBND',X'02'
         DC    CL5'PDBRT',X'02'
         DC    CL5'NAME ',X'84'
         DC    CL5'ID1  ',X'02'
         DC    CL5'ID2  ',X'02'
         DC    CL5'FLAG3',X'01'
         DC    CL5'RESV ',X'03'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF CHARACTERISTIC JOE FIELDS                          *
*                                                                     *
***********************************************************************
CJOEDSC  DS    0F
         DC    CL5'TYPE ',X'01'
         DC    CL5'NEXTC',X'03'
         DC    CL5'RESV1',X'01'
         DC    CL5'PREVC',X'03'
         DC    CL5'RESV2',X'01'
         DC    CL5'WKPTB',X'03'
         DC    CL5'FORM ',X'88'
         DC    CL5'FCB  ',X'84'
         DC    CL5'UCS  ',X'84'
         DC    CL5'WTRID',X'88'
         DC    CL5'FLASH',X'84'
         DC    CL5'PRMD ',X'88'
         DC    CL5'CFLAG',X'01'
         DC    CL5'DFLAG',X'01'
         DC    CL5'USE  ',X'02'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF JCT FIELDS                                         *
*                                                                     *
***********************************************************************
JCTDESC  DS    0H
         DC    CL5'ID   ',X'84'
         DC    CL5'LENG ',X'02'
         DC    CL5'FLAG1',X'01'
         DC    CL5'JTFLG',X'01'
         DC    CL5'JBKEY',X'04'
         DC    CL5'JDVT ',X'88'
         DC    CL5'SPIOT',X'04'
         DC    CL5'IOT  ',X'04'
         DC    CL5'OCTTR',X'04'
         DC    CL5'XTRK ',X'04'
         DC    CL5'XBUFO',X'04'
         DC    CL5'JQE  ',X'04'
         DC    CL5'SAMSK',X'04'
         DC    CL5'PDDBK',X'02'
         DC    CL5'PDDBO',X'02'
         DC    CL5'CNVRC',X'04'
         DC    CL5'USER0',X'04'
         DC    CL5'USER1',X'04'
         DC    CL5'USER2',X'04'
         DC    CL5'USER3',X'04'
         DC    CL5'USER4',X'04'
         DC    CL5'USER5',X'04'
         DC    CL5'USER6',X'04'
         DC    CL5'USER7',X'04'
         DC    CL5'USER8',X'04'
         DC    CL5'USER9',X'04'
         DC    CL5'USERA',X'04'
         DC    CL5'USERB',X'04'
         DC    CL5'USERC',X'04'
         DC    CL5'USERD',X'04'
         DC    CL5'USERE',X'04'
         DC    CL5'USERF',X'04'
PRTY     DC    CL5'PRTY ',X'82'
         DC    CL5'JSSTP',X'02'
         DC    CL5'HDSCT',X'02'
         DC    CL5'JSFLG',X'01'
         DC    CL5'SMFLG',X'01'
         DC    CL5'JOBFL',X'01'
         DC    CL5'JBOPT',X'01'
         DC    CL5'RESV1',X'02'
         DC    CL5'JOBID',X'88'
         DC    CL5'JNAME',X'88'
         DC    CL5'PNAME',X'94'
         DC    CL5'MCLAS',X'81'
         DC    CL5'JCLAS',X'81'
         DC    CL5'IPRIO',X'01'
         DC    CL5'PRIO ',X'01'
         DC    CL5'IOPRI',X'01'
         DC    CL5'OPRIO',X'01'
         DC    CL5'RESV2',X'02'
         DC    CL5'RNODE',X'02'
         DC    CL5'RRMT ',X'02'
         DC    CL5'INDEV',X'88'
         DC    CL5'ACCTN',X'84'
         DC    CL5'ROOMN',X'84'
         DC    CL5'ETIME',X'04'
         DC    CL5'ESTLN',X'04'
         DC    CL5'ESTPU',X'04'
         DC    CL5'FORMS',X'88'
         DC    CL5'RESV3',X'01'
         DC    CL5'CPYCT',X'01'
         DC    CL5'RESV4',X'01'
         DC    CL5'LINCT',X'01'
         DC    CL5'ESTPG',X'04'
         DC    CL5'ESTBY',X'04'
         DC    CL5'PRNOD',X'02'
         DC    CL5'PRRMT',X'02'
         DC    CL5'PUNOD',X'02'
         DC    CL5'PURMT',X'02'
         DC    CL5'PROCN',X'88'
         DC    CL5'PASS ',X'88'
         DC    CL5'NUPAS',X'88'
         DC    CL5'CNVON',X'04'
         DC    CL5'CDTON',X'04'
         DC    CL5'CNVOF',X'04'
         DC    CL5'CDTOF',X'04'
         DC    CL5'XEQON',X'04'
         DC    CL5'XDTON',X'04'
         DC    CL5'XEQOF',X'04'
         DC    CL5'XDTOF',X'04'
         DC    CL5'OUTON',X'04'
         DC    CL5'ODTON',X'04'
         DC    CL5'OUTOF',X'04'
         DC    CL5'ODTOF',X'04'
         DC    CL5'CARDS',X'04'
         DC    CL5'LINES',X'04'
         DC    CL5'PUNCH',X'04'
         DC    CL5'RDSID',X'84'
         DC    CL5'CVSID',X'84'
         DC    CL5'EXSID',X'84'
         DC    CL5'OTSID',X'84'
         DC    CL5'PAGES',X'04'
         DC    CL5'BYTES',X'04'
         DC    CL5'XEQND',X'02'
         DC    CL5'XNODE',X'02'
         DC    CL5'NJSID',X'84'
         DC    CL5'NJTON',X'04'
         DC    CL5'NDTON',X'04'
         DC    CL5'NJTOF',X'04'
         DC    CL5'NDTOF',X'04'
         DC    CL5'NACCT',X'88'
         DC    CL5'NOJID',X'88'
         DC    CL5'NNDEV',X'88'
         DC    CL5'NONDE',X'88'
         DC    CL5'NXNDE',X'88'
         DC    CL5'NNNDE',X'88'
         DC    CL5'NLNDE',X'88'
         DC    CL5'ESOUT',X'04'
         DC    CL5'XOUT ',X'04'
         DC    CL5'TSUID',X'87'
         DC    CL5'TSUAF',X'01'
         DC    CL5'PSN1 ',X'08'
         DC    CL5'PNS2 ',X'08'
         DC    CL5'WORK ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'0E'
         DC    CL5'XWRK ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'1A'
         DC    CL5'     ',X'02'
         DC    CL5'JMRJN',X'88'
         DC    CL5'RDRON',X'04'
         DC    CL5'RDTON',X'04'
         DC    CL5'CPUID',X'04'
         DC    CL5'USEID',X'88'
         DC    CL5'STEP ',X'01'
         DC    CL5'INDC ',X'01'
         DC    CL5'JTCC ',X'01'
         DC    CL5'CLASS',X'01'
         DC    CL5'UCOM ',X'04'
         DC    CL5'UJVP ',X'04'
         DC    CL5'RDROF',X'04'
         DC    CL5'RDTOF',X'04'
         DC    CL5'JOBIN',X'04'
         DC    CL5'RDR  ',X'02'
         DC    CL5'JMOPT',X'01'
         DC    CL5'RESV3',X'01'
         DC    CL5'XMASK',X'1A'
         DC    CL5'     ',X'06'
         DC    6X'FF'
DESCL    EQU   *-JCTDESC
PRTYD    EQU   (PRTY-JCTDESC)+5
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF ACF2 JOB CONTROL BLOCK  (JCT EXTENSION)            *
*                                                                     *
***********************************************************************
JCBDESC  DS    0H
         DC    CL5'ID   ',X'84'
         DC    CL5'SAVE ',X'04'
         DC    CL5'FCN  ',X'01'
         DC    CL5'SCN  ',X'01'
         DC    CL5'CNTL ',X'01'
         DC    CL5'RFLG ',X'01'
         DC    CL5'UCB  ',X'04'
         DC    CL5'MSG  ',X'04'
         DC    CL5'LID  ',X'88'
         DC    CL5'XSRCE',X'88'
         DC    CL5'RESV1',X'08'
         DC    CL5'SRCE ',X'88'
         DC    CL5'JOBN ',X'88'
         DC    CL5'SLID ',X'88'
         DC    CL5'PATH ',X'88'
         DC    CL5'PROG ',X'88'
         DC    CL5'RECB ',X'04'
         DC    CL5'RECL ',X'04'
         DC    CL5'UIDB ',X'04'
         DC    CL5'UIDL ',X'04'
         DC    CL5'QNAME',X'04'
         DC    CL5'CPUID',X'04'
         DC    CL5'LID  ',X'88'
         DC    CL5'BUNIT',X'84'
         DC    CL5'NAME ',X'94'
         DC    CL5'PHONE',X'8A'
         DC    CL5'ACFLG',X'01'
         DC    CL5'AC2F ',X'01'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF IOT FIELDS                                         *
*                                                                     *
***********************************************************************
IOTDESC  DS    0H
         DC    CL5'ID   ',X'84'
         DC    CL5'LENG ',X'02'
         DC    CL5'FLAG1',X'01'
         DC    CL5'FLAG2',X'01'
         DC    CL5'JBKEY',X'04'
         DC    CL5'TRACK',X'04'
         DC    CL5'IOTTR',X'04'
         DC    CL5'JCT  ',X'04'
         DC    CL5'IOT  ',X'04'
         DC    CL5'SJB  ',X'04'
         DC    CL5'PDDB ',X'04'
         DC    CL5'PDDBP',X'04'
         DC    CL5'MSTAB',X'1A'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF PDDB FIELDS                                        *
*                                                                     *
***********************************************************************
PDDBDESC DS    0H
         DC    CL5'FLAG1',XL1'01'
         DC    CL5'RECFM',XL1'01'
         DC    CL5'LRECL',XL1'02'
         DC    CL5'MTTR ',XL1'04'
         DC    CL5'MTTRL',XL1'04'
         DC    CL5'DSKEY',XL1'02'
         DC    CL5'CLASS',XL1'81'
         DC    CL5'COPYS',XL1'01'
         DC    CL5'DNODE',XL1'02'
         DC    CL5'DRMT ',XL1'02'
         DC    CL5'USER ',XL1'88'
         DC    CL5'CPU  ',XL1'01'
         DC    CL5'SEC  ',XL1'01'
         DC    CL5'FLAG2',XL1'01'
         DC    CL5'CPTN ',XL1'01'
         DC    CL5'RECCT',XL1'04'
         DC    CL5'PGCT ',XL1'04'
         DC    CL5'BYTCT',XL1'04'
         DC    CL5'FORMS',XL1'88'
         DC    CL5'FCB  ',XL1'84'
         DC    CL5'UCS  ',XL1'84'
         DC    CL5'DSID ',XL1'88'
         DC    CL5'RBA  ',XL1'08'
         DC    CL5'CHAR1',XL1'84'
         DC    CL5'CHAR2',XL1'84'
         DC    CL5'CHAR3',XL1'84'
         DC    CL5'CHAR4',XL1'84'
         DC    CL5'FLASH',XL1'84'
         DC    CL5'MODF ',XL1'84'
         DC    CL5'FLSHC',XL1'01'
         DC    CL5'MODFT',XL1'01'
         DC    CL5'COPYG',XL1'08'
         DC    CL5'CKPTP',XL1'02'
         DC    CL5'CKPTL',XL1'02'
         DC    CL5'FLAG3',XL1'01'
         DC    CL5'STAT ',XL1'01'
         DC    CL5'ID   ',XL1'82'
         DC    CL5'NAME ',XL1'88'
         DC    CL5'RESV ',XL1'02'
         DC    CL5'CRTME',XL1'04'
         DC    CL5'PLIOT',XL1'04'
         DC    CL5'PLOFF',XL1'04'
         DC    CL5'SSOFM',XL1'84'
         DC    CL5'PNAME',XL1'88'
         DC    CL5'SNAME',XL1'88'
         DC    CL5'DDNAM',XL1'88'
         DC    CL5'PRMD ',XL1'88'
         DC    CL5'LINCT',XL1'01'
         DC    CL5'INDEX',XL1'01'
         DC    CL5'FUNC ',XL1'01'
         DC    CL5'PRIO ',XL1'01'
         DC    CL5'FLAG4',XL1'01'
         DC    CL5'FLAG5',XL1'01'
         DC    CL5'RSVD ',XL1'02'
         DC    CL5'SWBOT',XL1'04'
         DC    CL5'OUTOK',XL1'08'
         DC    CL5'CPTNM',XL1'88'
         DC    CL5'RESV ',XL1'10'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   DESCRIPTION OF JOT FIELDS                                         *
*                                                                     *
***********************************************************************
JOTDESC  DS    0H
         DC    CL5'ID   ',X'84'
         DC    CL5'FREC ',X'02'
         DC    CL5'RESV1',X'02'
         DC    CL5'FREQ ',X'04'
         DC    CL5'CHRQ ',X'04'
         DC    CL5'DUMPQ',X'04'
         DC    CL5'NTWKQ',X'04'
         DC    CL5'LOCAQ',X'04'
         DC    CL5'RMTAQ',X'04'
         DC    CL5'LOCBQ',X'04'
         DC    CL5'RMTBQ',X'04'
         DC    CL5'LOCCQ',X'04'
         DC    CL5'RMTCQ',X'04'
         DC    CL5'LOCDQ',X'04'
         DC    CL5'RMTDQ',X'04'
         DC    CL5'LOCEQ',X'04'
         DC    CL5'RMTEQ',X'04'
         DC    CL5'LOCFQ',X'04'
         DC    CL5'RMTFQ',X'04'
         DC    CL5'LOCGQ',X'04'
         DC    CL5'RMTGQ',X'04'
         DC    CL5'LOCHQ',X'04'
         DC    CL5'RMTHQ',X'04'
         DC    CL5'LOCIQ',X'04'
         DC    CL5'RMTIQ',X'04'
         DC    CL5'LOCJQ',X'04'
         DC    CL5'RMTJQ',X'04'
         DC    CL5'LOCKQ',X'04'
         DC    CL5'RMTKQ',X'04'
         DC    CL5'LOCLQ',X'04'
         DC    CL5'RMTLQ',X'04'
         DC    CL5'LOCMQ',X'04'
         DC    CL5'RMTMQ',X'04'
         DC    CL5'LOCNQ',X'04'
         DC    CL5'RMTNQ',X'04'
         DC    CL5'LOCOQ',X'04'
         DC    CL5'RMTOQ',X'04'
         DC    CL5'LOCPQ',X'04'
         DC    CL5'RMTPQ',X'04'
         DC    CL5'LOCQQ',X'04'
         DC    CL5'RMTQQ',X'04'
         DC    CL5'LOCRQ',X'04'
         DC    CL5'RMTRQ',X'04'
         DC    CL5'LOCSQ',X'04'
         DC    CL5'RMTSQ',X'04'
         DC    CL5'LOCTQ',X'04'
         DC    CL5'RMTTQ',X'04'
         DC    CL5'LOCUQ',X'04'
         DC    CL5'RMTUQ',X'04'
         DC    CL5'LOCVQ',X'04'
         DC    CL5'RMTVQ',X'04'
         DC    CL5'LOCWQ',X'04'
         DC    CL5'RMTWQ',X'04'
         DC    CL5'LOCXQ',X'04'
         DC    CL5'RMTXQ',X'04'
         DC    CL5'LOCYQ',X'04'
         DC    CL5'RMTYQ',X'04'
         DC    CL5'LOCZQ',X'04'
         DC    CL5'RMTZQ',X'04'
         DC    CL5'LOC0Q',X'04'
         DC    CL5'RMT0Q',X'04'
         DC    CL5'LOC1Q',X'04'
         DC    CL5'RMT1Q',X'04'
         DC    CL5'LOC2Q',X'04'
         DC    CL5'RMT2Q',X'04'
         DC    CL5'LOC3Q',X'04'
         DC    CL5'RMT3Q',X'04'
         DC    CL5'LOC4Q',X'04'
         DC    CL5'RMT4Q',X'04'
         DC    CL5'LOC5Q',X'04'
         DC    CL5'RMT5Q',X'04'
         DC    CL5'LOC6Q',X'04'
         DC    CL5'RMT6Q',X'04'
         DC    CL5'LOC7Q',X'04'
         DC    CL5'RMT7Q',X'04'
         DC    CL5'LOC8Q',X'04'
         DC    CL5'RMT8Q',X'04'
         DC    CL5'LOC9Q',X'04'
         DC    CL5'RMT9Q',X'04'
         DC    6X'FF'
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT OF TABLE FOR HCT VARIABLES.                                *
*                                                                     *
*        OFFSET    LENGTH         DESCRIPTION                         *
*          0         8              FIELD ID TAG.                     *
*          8         1              X... ....  IF ON INDICATES THE    *
*                                              FIELD IS ALREADY IN    *
*                                              EBCDIC FORMAT.         *
*                                   ...X XXXX  LENGTH OF FIELD.       *
*                                              MAXIMUM LENGTH IS X'1E'*
*                                                                     *
***********************************************************************
***********************************************************************
*                                                                     *
*   DESCRIPTION OF HCT VARIABLES                                      *
*                                                                     *
***********************************************************************
HCTDESC  DS    0H
         DC    CL8'$MASTERL',XL1'04'
         DC    CL8'$CKRECN ',XL1'02'
         DC    CL8'$WCHECK ',XL1'01'
         DC    CL8'$CKPTFLG',XL1'01'
         DC    CL8'$CKPUSER',XL1'08'
         DC    CL8'$NEWSJQE',XL1'04'
         DC    CL8'$NEWSTTR',XL1'04'
         DC    CL8'$JQEFREC',XL1'02'
         DC    CL8'$RESV1  ',XL1'02'
         DC    CL8'$JQFREE ',XL1'04'
         DC    CL8'$JQHEADS',XL1'1E'
         DC    CL8'        ',XL1'1E'
         DC    CL8'        ',XL1'1E'
         DC    CL8'        ',XL1'1E'
         DC    CL8'        ',XL1'1E'
         DC    CL8'        ',XL1'1E'
         DC    CL8'        ',XL1'0C'
         DC    CL8'$SCQSPLS',XL1'1C'
         DC    CL8'$RESV2  ',XL1'1E'
         DC    CL8'        ',XL1'06'
         DC    CL8'$SCQJQE ',XL1'04'
         DC    CL8'$SPLEXST',XL1'04'
         DC    CL8'$SPLSLCT',XL1'04'
         DC    CL8'$SPLINAC',XL1'04'
         DC    CL8'$TGALLOC',XL1'04'
         DC    CL8'$TGTOTAL',XL1'04'
         DC    CL8'$KBYTS  ',XL1'04'
         DC    CL8'$DASWRKQ',XL1'04'
         DC    CL8'$DASTRKQ',XL1'04'
         DC    CL8'$DATAKEY',XL1'04'
         DC    CL8'$JOBNO  ',XL1'02'
         DC    CL8'$JOBMIN ',XL1'02'
         DC    CL8'$JOBMAX ',XL1'02'
         DC    CL8'$HASPID ',XL1'84'
         DC    CL8'$CHKPT  ',XL1'86'
         DC    CL8'$CHKPT2 ',XL1'86'
         DC    CL8'$FLAG1  ',XL1'01'
         DC    CL8'$RESV3  ',XL1'05'
         DC    CL8'$NUMNODE',XL1'02'
         DC    CL8'$NUMRJE ',XL1'02'
         DC    CL8'$SPOOL  ',XL1'86'
         DC    CL8'$BUFSIZE',XL1'02'
         DC    CL8'$MAXJOBS',XL1'02'
         DC    CL8'$NUMJBNO',XL1'02'
         DC    CL8'$NUMJOES',XL1'02'
         DC    CL8'$NUMTG  ',XL1'02'
         DC    CL8'$TGSIZE ',XL1'02'
         DC    CL8'$QSENO  ',XL1'02'
         DC    CL8'$NODEID ',XL1'02'
         DC    CL8'$RECINCR',XL1'01'
         DC    CL8'$TCELSIZ',XL1'01'
         DC    CL8'$RESV4  ',XL1'08'
         DC    6X'FF'
         EJECT
         SPACE 4
         AIF   (NOT &QSP136).NO136G
         IFGRPL DSECT=YES,AM=VTAM                                  DOR
         $BUFFER
         AGO   .X136G
.NO136G  ANOP
BUFSTART EQU   0
BUFDSECT EQU   0
.X136G   ANOP
        $JCT
        $JQE
        $PDDB
        $TAB
        $IOT
        $JOE
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
CONVERT  DS    D
PDDBKEY  DS    H
SWITCH   DS    C
JOEADDR  DS    F
IOTADDR  DS    F
PDDBADDR DS    F
LASTPDDB DS    F
RETURN   DS    F
NEXTOSET DS    F
SAVER15  DS    F
NUMOFVOL DS    F
DALLREG  DS    F
STARTADR DS    F
PLAY     DS    CL16
PLAY1    DS    CL24
WJCTDESC DS    CL(DESCL)      WORKING COPY OF JCTDESC
WORKEND  EQU   *
         END
./       ADD   NAME=ENTER
         MACRO
.*                                                      RON MURA, TPD
&LABEL   ENTER &SA=,        SAVEAREA ADDRESS                           X
               &BASE=12,    BASE REGISTER                              X
               &BASE2=,     SECOND BASE REGISTER                       X
               &BASE3=,     THIRD BASE REGISTER                        X
               &ID=,        MODULE IDENTIFIER                          X
               &TITLE=,     ASSEMBLY LISTING TITLE                     X
               &RENT=NO,    REENTERANT OR NONREENTERANT SAVEAREAS      X
               &CSECT=YES,  CSECT OR NOT                    9/3/81     X
               &WKBYTES=0,  BYTES TO BE GETMAIN'D BESIDES 72 FOR SA    X
               &GETFAIL=    BRANCH-TO ADDRESS IF GETMAIN FAILS
.*               NO PARAMETERS REQUIRED
.*               SA IGNORED IF RENT=YES SPECIFIED
.*               WKBYTES AND GETFAIL IGNORED UNLESS RENT=YES SPECIFIED
         MNOTE *,'*** ENTER - STANDARD OS LINKAGE ***'
         GBLB  &RENTSW1     1 = REENTERANT SAVEAREA
         GBLC  &WKLNTH
&RENTSW1 SETB  0            TURN OFF IN CASE MULT. MACROS PER ASSEMBLY
&WKLNTH  SETC  '&WKBYTES'   KEEP FOR FREEMAIN IN LEAVE MACRO
         LCLC  &CSECTNM,&ID2,&NDX,&SAVE,&GETTYPE
&NDX     SETC  '&SYSNDX'
         AIF   ('&TITLE' EQ '').NOTITLE
         TITLE &TITLE
.*                          TITLE MUST BE ENCLOSED BY QUOTATION MARKS
.NOTITLE AIF   ('&LABEL' EQ '').NOLABEL
&CSECTNM SETC  '&LABEL'
         AGO   .CHKID
.NOLABEL AIF   ('&CSECT' NE 'YES').CHKID                    9/3/81
&CSECTNM SETC  '$PRIVATE'
         MNOTE *,'*** NO LABEL ON ENTER MACRO, CSECT CALLED ''$PRIVATE'X
               ' ***'
.CHKID   AIF   (T'&ID EQ 'O').NOID
&ID2     SETC  '&ID'
         AGO   .CHKSA
.NOID    ANOP
&ID2     SETC  '&CSECTNM-&SYSDATE-&SYSTIME'
.CHKSA   ANOP
         AIF   ('&CSECT' EQ 'YES').CS                       9/3/81
&LABEL   SAVE  (14,12),,&ID2                                9/3/81
         AGO   .LR
.CS      ANOP                                               9/3/81
&CSECTNM CSECT
         SAVE  (14,12),,&ID2
.LR      ANOP                                               9/3/81
         LR    &BASE,15               ESTABLISH BASE
         USING &CSECTNM,&BASE         INFORM ASSEMBLER
         LR    2,13
         AIF   (T'&BASE2 EQ 'O').CHKRENT
         LA    &BASE2,2048(&BASE)
         LA    &BASE2,2048(&BASE2)    ESTABLISH SECOND BASE REG
         USING &CSECTNM+4096,&BASE2
         AIF   (T'&BASE3 EQ 'O').CHKRENT
         LA    &BASE3,2048(&BASE2)
         LA    &BASE3,2048(&BASE3)    ESTABLISH THIRD BASE REG
         USING &CSECTNM+8192,&BASE3
.CHKRENT AIF   ('&RENT' EQ 'YES').REENT
         AIF   (T'&SA EQ 'O').NOSA
&SAVE    SETC  '&SA'
         AGO   .SAOK
.NOSA    ANOP
&SAVE    SETC  'SAVE&NDX'
.SAOK    ANOP
         ST    13,&SAVE+4             CHAIN UP TO HSA
         LA    15,&SAVE
         ST    15,8(13)               CHAIN DOWN TO LSA
         LR    13,15                  POINT TO SAVEAREA
         AGO   .CHKB
.REENT   ANOP
&RENTSW1 SETB  1         INDICATE REENTERANT SAVEAREA FOR LEAVE MACRO
         LR    14,1                   SAVE PTR TO PARAM LIST
         LR    15,0                   SAVE REG 0
         AIF   (T'&GETFAIL EQ 'O').UNCOND
         MNOTE '         GETMAIN RC,LV=72+&WKBYTES  REENT. SA FMT USED'
         GETMAIN RC,LV=72+&WKBYTES    GET 72 BYTES FOR SAVEAREA
         LTR   15,15                  TEST FOR SUCCESS
         BNZ   &GETFAIL
         AGO   .CHAIN
.UNCOND  MNOTE '         GETMAIN R,LV=72+&WKBYTES  REENTERANT SAVEAREA X
               FORMAT USED'
         GETMAIN R,LV=72+&WKBYTES     GET 72 BYTES FOR SAVEAREA
.CHAIN   ANOP
         ST    13,4(1)                CHAIN UP TO HSA
         ST    1,8(13)                CHAIN DOWN TO LSA
         LR    0,15                   RESTORE REG 0
         LR    13,1                   POINT TO SAVEAREA
         LR    1,14                   RESTORE REG 1
.*    SEE IF WE NEED TO BRANCH AROUND CONSTANTS:
.CHKB    AIF   (T'&SA NE 'O' OR '&RENT' EQ 'YES').MEND
         B     SAVE&NDX.+72           BRANCH AROUND SAVEAREA
SAVE&NDX DS    18F
.MEND    MEND
./       ADD   NAME=EXCPMON
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/02/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
* 4/23/87 CHANGED GETMAIN SIZEAREA FROM SP 241 TO SP 0            DOR01
*         PROBLEM: IT CAUSE ACF/VTAM DOESNOT GET ENOUGH CSA SPACE.DOR01
EXCPMON  TITLE 'QUEUE COMMAND - EXCEPTION MONITOR'
EXCPMON  QSTART ,                  START EXCPMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   - OUXB
*    R3   -
*    R4   - ASCB
*    R5   - ASCB
*    R6   - CSCB
*    R7   - BASE REG SECOND 4096
*    R8   -  JOBTABLE
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       CSCGE03D -       E  EXCEPTION MONITOR                     ***
***       VERSION -        2.1                                      ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***       UPDATED -        11/01/79                                 ***
***********************************************************************
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*
*
*                  EXCEPTION MONITOR OUTPUT MESSAGES
*               ---------------------------------------
*
*
*
*
*   SYSTEM EXCEPTION MESSAGES
*   --------------------------------------
*
*   CHANNEL XX   XXX% BUSY  FOR XXXXX SEC
*   UUU VVVVVV   XXX% BUSY  FOR XXXXX SEC
*   UUU VVVVVV   NOT READY  FOR XXXXX SEC
*   EXCESS SYSTEM PAGING FOR    XXXXX SEC
*   LOCAL PAGE I/O DEGRADED FOR XXXXX SEC
*   WTO BUFFER SHORTAGE, WQE COUNT= XXXXX
*   SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK
*
*
*
*
*   JOB RESOURCE USAGE EXCEPTION MESSAGES
*   --------------------------------------
*
*   JJJJJJJJ POSSIBLE LOOP FOR  XXXXX SEC
*   JJJJJJJJ XXX% CPU FOR       XXXXX SEC
*   JJJJJJJJ ABEND IN PROGRESS  XXXXX SEC
*   JJJJJJJJ EXCESS SWAP COUNT = XXXXX
*   JJJJJJJJ XXXXX FRAMES FOR   XXXXX SEC
*
*
*
*
*   JOB WAIT EXCEPTION MESSAGES
*   --------------------------------------
*
*    ( NOTE -   A JOB IS CONSIDERED TO BE WAITING IF IT USES 0% CPU  )
*
*
*   JJJJJJJJ ENQ SYSDSN   WAIT  XXXXX SEC       ENQ CONFLICT
*   JJJJJJJJ I/O ON UUU   WAIT  XXXXX SEC       I/O PENDING
*   JJJJJJJJ ALLOC QUEUE  WAIT  XXXXX SEC       ALLOC QUEUE
*   JJJJJJJJ REPLY NN     WAIT  XXXXX SEC       REPLY PENDING
*   JJJJJJJJ SWAP RRRRRR  WAIT  XXXXX SEC       SWAPPED OUT
*
*      RRRRRR -     ( SWAP REASON CODES )
*                   LONGWT           LONG WAIT
*                   AUXSTOR          AUXILLARY STORAGE SHORTAGE
*                   REALSTR          REAL STORAGE SHORTAGE
*                   DETWAIT          MSO DETECTED WAIT
*                   REQUEST          REQUEST SWAP
*                   ENQEXC           ENQ EXCHANGE
*                   WORKEXC          WORKLOAD EXCHANGE
*                   UNILATR          UNILATERAL
*
*
*
*   ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND
*
*
*
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         EJECT
*        CLI   TRACESWT,X'FF'
*        BE    TRACEOK
*        CALL TRACE
*        MVI   TRACESWT,X'FF'
TRACEOK  EQU    *
         LA    R7,4095(0,R12)
         LA    R7,1(0,R7)
         USING EXCPMON,R12,R7
         SETAUTH   ON
         MODESET KEY=ZERO,MODE=SUP
         L     R0,SIZEJOB
         GETMAIN R,LV=(0)
         ST    R1,EXTRAREA
         LA    R3,QPARM1
         LA    R3,0(0,R3)
         MVI   PARM,C'A'           ALL SCANS ACTIVE
         LTR   R3,R3               ANY PARM
         BZ    *+10                NO
         MVC   PARM(1),0(R3)       SET SCAN TYPE
CSCSTART L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         MVC   QDHLINE(80),SRMOVLY
         L     R5,88(0,R4)         WAMT
         L     R1,THRTSOPG         TSO PERF GROUP NUMBER
         SLL   R1,2                TIMES 4
         L     R6,56(R1,R5)        WAMP OFFSET
         AR    R5,R6               WAMP ADDRESS
         SR    R14,R14
         L     R15,0(0,R5)         TOTAL ENDED TRANS
         LTR   R15,R15             ZERO TRANS
         BZ    NOTSO               YES, BYPASS 0C9
         L     R15,12(0,R5)        TOTAL ELAPSED TIME FOR ENDED TRANS
         D     R14,0(0,R5)         DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'
         SPACE 1
NOTSO    CVD   R15,DOUBLE          AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX
         MVC   QDHLINE+4(7),=X'402021204B2020'
         ED    QDHLINE+4(4),DOUBLE+6
         UNPK  QDHLINE+9(2),DOUBLEX+6(2)
         OI    QDHLINE+10,X'F0'
         SR    R1,R1
         IC    R1,320(0,R4)        LONG TERM CPU AVG
         CVD   R1,DOUBLE
         MVC   QDHLINE+21(4),=X'40212020'
         ED    QDHLINE+21(4),DOUBLE+6
         LH    R1,318(0,R4)        AVERAGE CPU
         CVD   R1,DOUBLE
         MVC   QDHLINE+34(4),=X'40212020'
         ED    QDHLINE+34(4),DOUBLE+6
         LH    R1,664(0,R4)        AVERAGE PAGING
         CVD   R1,DOUBLE
         MVC   QDHLINE+47(4),=X'40212020'
         ED    QDHLINE+47(4),DOUBLE+6
         LH    R1,654(0,R4)        AVERAGE UIC
         CVD   R1,DOUBLE
         MVC   QDHLINE+61(4),=X'40212020'
         ED    QDHLINE+61(4),DOUBLE+6
         LH    R1,662(0,R4)        AVERAGE ASMQ
         CVD   R1,DOUBLE
         MVC   QDHLINE+74(4),=X'40212020'
         ED    QDHLINE+74(4),DOUBLE+6
         MVC   QDMSG(80),QBLANK
         L     R8,EXTRAREA         ASCB/OUCB INFO STORAGE
         USING JOBTABLE,R8
         XC    C1BSYCNT(4),C1BSYCNT
         XC    C2BSYCNT(4),C2BSYCNT
         XC    C3BSYCNT(4),C3BSYCNT
         XC    C4BSYCNT(4),C4BSYCNT
         XC    C5BSYCNT(4),C5BSYCNT
         XC    C6BSYCNT(4),C6BSYCNT
         XC    C7BSYCNT(4),C7BSYCNT
         XC    C8BSYCNT(4),C8BSYCNT
         XC    C9BSYCNT(4),C9BSYCNT
         XC    CABSYCNT(4),CABSYCNT
         XC    CBBSYCNT(4),CBBSYCNT
         XC    CCBSYCNT(4),CCBSYCNT
         XC    CDBSYCNT(4),CDBSYCNT
         XC    CEBSYCNT(4),CEBSYCNT
         XC    CFBSYCNT(4),CFBSYCNT
         BAL   R15,CHKWQE
         BAL   R15,CHKSQA
         BAL   R15,CHKPAG
         L     R3,THRSTIMR
         CLI   PARM,C'C'           CHANNEL AND DEVICE SCAN ELIMINATE
         BE    JOBOUT              YES
         CLI   PARM,C'D'           DEVICE SCAN ELIMINATE
         BE    *+8                 YES
         BAL   R15,CHKUCB          CLEAR UCB TABLE
         BAL   R15,CHNLOOP
         EJECT
JOBOUT   L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         B     JOBOUT2
         SPACE 1
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)         CSCB ADDR
         L     R9,144(0,R5)        LOAD OUCB ADDR
         BAL   R15,ASCBFORM        GO FORMAT ASCB INFO
         SPACE 1
JOBOUT2  LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    RETURN              YES, RETURN
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT2             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         EJECT
ASCBFORM EQU   *
         ST    R15,ASCBR15     DOR
         STM   R0,R15,SAVEREGS DOR
         LH    R1,36(0,R5)         ASID
         MH    R1,=H'48'           TABLE ENTRY LENGTH
         L     R8,EXTRAREA         JOBTABLE ADDR
         AR    R8,R1               JOBTABLE ENTRY ADDR THIS ASID
         LA    R1,=CL8'*MASTER*'
         CLC   36(2,R5),=H'1'      MASTER SCHEDULER
         BE    ASCBFRM1            YES
         L     R1,172(0,R5)        JOBNAME POINTER
         LTR   R1,R1               ZERO
         BNZ   ASCBFRM1            NO
         L     R1,176(0,R5)        STC/TSU NAME POINTER
         LTR   R1,R1               ZERO
         BNZ   ASCBFRM1            NO
         LA    R1,=CL8'*UNKNWN*'
         B     ASCBFRM1            NO
         SPACE 1
ASCBFRM0 XC    JOBFLAG(38),JOBFLAG CLEAR COUNTERS
         B     ASCBFRM2+12
         SPACE 1
ASCBFRM1 CLC   JOBNAME(8),0(R1)    JOB/STC/TSU NAME MATCH
         BE    ASCBFRM2            YES
         MVC   JOBNAME(8),0(R1)    JOB/STC/TSU NAME
         MVC   JOBASID(2),36(R5)   JOB/STC/TSU ASID
         XC    JOBFLAG(38),JOBFLAG CLEAR COUNTERS
         EJECT
ASCBFRM2 BAL   R15,CHKABN          CHECK FOR JOBS ABENDING
         BAL   R15,CHKFRM          CHECK FOR JOBS WITH HIGH FRAMES
         BAL   R15,CHKSWP          CHECK FOR JOBS WITH SWAP COUNTS
         LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R1,R15
         C     R1,JOBTIME          COMPARE PREVIOUS CPU TIME
         BE    ASCBFRM4            EQUAL, JOB WAITING
         BL    ASCBFRM0            CURRENT LOWER,  STEP CHANGE
         C     R1,JOBCPUT          COMPARE PREVIOUS CPU TIME
         BL    ASCBFRM0            CURRENT LOWER,  STEP CHANGE
         L     R15,JOBCPUT         LOAD PREVIOUS CPU TIME
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+8                 YES
         ST    R1,JOBCPUT          PREVIOUS = CURRENT
         L     R15,JOBTIME         LOAD PREVIOUS CPU TIME
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+8                 YES
         ST    R1,JOBTIME          PREVIOUS = CURRENT
         LR    R15,R1
         S     R15,JOBCPUT         SUB PREVIOUS CPU TIME
         S     R1,JOBTIME          SUB PREVIOUS CPU TIME
         ST    R15,SAVETIM1        SAVE DIFFERENCE
         ST    R1,SAVETIM2         SAVE DIFFERENCE
         XC    JOBWAIT(4),JOBWAIT  CLEAR WAIT COUNTER
         TIME  BIN
         L     R1,JOBCPUL          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,JOBCPUL          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,JOBCPUL          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BE    ASCBFRMA            YES
         BM    ASCBFRM0            NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM1        LOAD DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRM0            YES
         SR    R14,R14
         M     R14,=F'10'          PERCENT
         SR    R14,R14
         DR    R14,R1              PERCENT UTIL
         BAL   R15,CHKCPU          CHECK JOB CPU UTILIZATION LIMIT
         EJECT
ASCBFRMA TIME  BIN                 POTENTIAL LOOP
         L     R1,JOBLOOP          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,JOBLOOP          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,JOBLOOP          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BC    8,ASCBEXIT          YES, NO LOOP YET
         BM    ASCBFRM0            NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM2        LOAD DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRM0            YES
         SR    R14,R14
         M     R14,=F'10'          PERCENT
         SR    R14,R14
         DR    R14,R1              PERCENT UTIL
         C     R15,THRLOOPP        OVER CPU PERCENT THRESHOLD
         BNL   *+20                YES
         XC    JOBLOOP(4),JOBLOOP
         XC    JOBTIME(4),JOBTIME
         B     ASCBEXIT
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         LOOP SECONDS
         CVD   R15,DOUBLE
         C     R15,THRLOOPT        OVER LOOP THRESHOLD
         BC    4,ASCBEXIT          NO
         CLC   36(2,R5),=H'1'      MASTER SCHEDULER
         BC    8,ASCBEXIT          YES, NO LOOP CHECK
         CLC   172(4,R5),=F'0'     JOB OR STC/TSU
         BNE   *+12                JOB
         CLI   28(R6),X'01'        TSU OR STC
         BC    7,ASCBEXIT          STC
         L     R1,108(0,R9)        EXCP COUNT
         L     R15,JOBEXCP         PREVIOUS EXCP COUNT
         ST    R1,JOBEXCP          SAVE PREVIOUS EXCP COUNT
         CR    R1,R15              COMPARE CURRENT TO PREVIOUS
         BL    ASCBFRM0            CURRENT LOWER,  STEP CHANGE
         BE    ASCBFRMC            NO EXCPS, POSSIBLE LOOP
         XC    JOBLOOP(4),JOBLOOP
         XC    JOBTIME(4),JOBTIME
         B     ASCBEXIT
         SPACE 1
ASCBFRMC CLI   WJOB1,C' '          1ST PASS
         BNE   ASCBFRM3            NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         B     ASCBEXIT
         EJECT
ASCBFRM3 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     ASCBEXIT
         SPACE 1
ASCBFRM4 TIME  BIN
         L     R1,JOBWAIT          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,JOBWAIT          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,JOBWAIT          INTERVAL TIME
         XC    JOBLOOP(4),JOBLOOP  CLEAR LOOP COUNTER
         XC    JOBCPUT(4),JOBCPUT  CLEAR CPU TIME ACCUM
         XC    JOBCPUL(4),JOBCPUL  CLEAR ELAPSED TIME ACCUM
         LTR   R1,R1               TIME EQUAL 0
         BC    8,ASCBEXIT          YES, NO WAIT YET
         BM    ASCBFRM0            NEGATIVE, CLEAR COUNTERS
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         WAIT SECONDS
         CVD   R15,DOUBLE
         ST    R15,CURRWAIT
         LA    R3,WMSG1
         CLI   WJOB1,C' '          1ST PASS
         BE    ASCBFRM5            YES
         LA    R3,WMSG2
         EJECT
ASCBFRM5 MVC   0(12,R3),=CL12' '
         BAL   R15,CHKENQ          CHECK ENQ OUTSTANDING
         CLI   0(R3),C' '          ANY ENQS FOR THIS JOB
         BNE   ASCBFRM6            YES
         BAL   R15,CHKALC          CHECK ALLOCATION QUEUE
         CLI   0(R3),C' '          ANY ALLOC PENDING FOR THIS JOB
         BNE   ASCBFRM6            YES
         BAL   R15,CHKQIO          CHECK I/O OUTSTANDING
         CLI   0(R3),C' '          ANY I/O FOR THIS JOB
         BNE   ASCBFRM6            YES
         BAL   R15,CHKREP          CHECK REPLY OUTSTANDING
         CLI   0(R3),C' '          ANY REPLIES FOR THIS JOB
         BNE   ASCBFRM6            YES
         L     R1,CURRWAIT         CURRENT WAIT TIME
         C     R1,THRSWPWT         OVER SWAP WAIT THRESHOLD
         BC    4,ASCBEXIT          NO
         CLC   172(4,R5),=F'0'     JOB OR STC/TSU
         BNE   *+12                JOB
         CLI   28(R6),X'01'        TSU OR STC
         BC    7,ASCBEXIT          STC OR INIT
         BAL   R15,CHKSRC          CHECK SWAP REASON CODE
         CLI   0(R3),C'*'          EXCLUDED SRC
         BNE   *+12                NO
         MVI   0(R3),C' '
         B     ASCBEXIT
         CLI   0(R3),C' '          ANY SRC FOR THIS JOB
         BNE   ASCBFRM6            YES
         MVC   0(12,R3),=12C'?'
         SPACE 1
ASCBFRM6 CLI   WJOB1,C' '          1ST TIME
         BNE   ASCBFRM7            NO, 2ND PASS
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         B     ASCBEXIT
         SPACE 1
ASCBFRM7 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         BAL   R9,DISPLAY
ASCBEXIT EQU   *
         LM    R0,R15,SAVEREGS
         L     R15,ASCBR15
         BR    R15
         EJECT
CHNLOOP  ST    R15,CHNR15
CHNLOOPX STIMER WAIT,DINTVL=THRINTVL
         LR    R4,R15
         CLI   PARM,C'D'           DEVICE SCAN ELIMINATE
         BE    *+8                 YES
         BAL   R15,CHKUCB1         CHECK BUSY UCBS
         LR    R15,R4
         SPACE 1
         TCH   CHAN1               TEST CHANNEL 01 BUSY
         L     R1,C1BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C1BSYCNT         SAVE BUSY COUNT
         TCH   CHAN2               TEST CHANNEL 02 BUSY
         L     R1,C2BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C2BSYCNT         SAVE BUSY COUNT
         TCH   CHAN3               TEST CHANNEL 03 BUSY
         L     R1,C3BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C3BSYCNT         SAVE BUSY COUNT
         TCH   CHAN4               TEST CHANNEL 04 BUSY
         L     R1,C4BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C4BSYCNT         SAVE BUSY COUNT
         TCH   CHAN5               TEST CHANNEL 05 BUSY
         L     R1,C5BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C5BSYCNT         SAVE BUSY COUNT
         TCH   CHAN6               TEST CHANNEL 06 BUSY
         L     R1,C6BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C6BSYCNT         SAVE BUSY COUNT
         TCH   CHAN7               TEST CHANNEL 07 BUSY
         L     R1,C7BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C7BSYCNT         SAVE BUSY COUNT
         TCH   CHAN8               TEST CHANNEL 08 BUSY
         L     R1,C8BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C8BSYCNT         SAVE BUSY COUNT
         EJECT
         TCH   CHAN9               TEST CHANNEL 09 BUSY
         L     R1,C9BSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,C9BSYCNT         SAVE BUSY COUNT
         TCH   CHAN10              TEST CHANNEL 10 BUSY
         L     R1,CABSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CABSYCNT         SAVE BUSY COUNT
         TCH   CHAN11              TEST CHANNEL 11 BUSY
         L     R1,CBBSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CBBSYCNT         SAVE BUSY COUNT
         TCH   CHAN12              TEST CHANNEL 12 BUSY
         L     R1,CCBSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CCBSYCNT         SAVE BUSY COUNT
         TCH   CHAN13              TEST CHANNEL 13 BUSY
         L     R1,CDBSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CDBSYCNT         SAVE BUSY COUNT
         TCH   CHAN14              TEST CHANNEL 14 BUSY
         L     R1,CEBSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CEBSYCNT         SAVE BUSY COUNT
         TCH   CHAN15              TEST CHANNEL 15 BUSY
         L     R1,CFBSYCNT         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,CFBSYCNT         SAVE BUSY COUNT
         EJECT
CHNEND   BCT   R3,CHNLOOPX
         LR    R4,R15
         CLI   PARM,C'D'           DEVICE SCAN ELIMINATE
         BE    *+8                 YES
         BAL   R15,CHKUCB6         CHECK BUSY UCBS
         LR    R15,R4
         SR    R14,R14
         L     R15,C1BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C1BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C1BSYPCT
         SR    R14,R14
         L     R15,C2BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C2BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C2BSYPCT
         SR    R14,R14
         L     R15,C3BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C3BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C3BSYPCT
         SR    R14,R14
         L     R15,C4BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C4BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C4BSYPCT
         SR    R14,R14
         L     R15,C5BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C5BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C5BSYPCT
         EJECT
         SR    R14,R14
         L     R15,C6BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C6BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C6BSYPCT
         SR    R14,R14
         L     R15,C7BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C7BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C7BSYPCT
         SR    R14,R14
         L     R15,C8BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C8BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C8BSYPCT
         SR    R14,R14
         L     R15,C9BSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,C9BSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,C9BSYPCT
         SR    R14,R14
         L     R15,CABSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CABSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CABSYPCT
         EJECT
         SR    R14,R14
         L     R15,CBBSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CBBSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CBBSYPCT
         SR    R14,R14
         L     R15,CCBSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CCBSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CCBSYPCT
         SR    R14,R14
         L     R15,CDBSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CDBSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CDBSYPCT
         SR    R14,R14
         L     R15,CEBSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CEBSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CEBSYPCT
         SR    R14,R14
         L     R15,CFBSYCNT
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         L     R1,CFBSYPCT         CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+8                 NO
         LA    R1,30               FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,CFBSYPCT
         EJECT
CHKCHN1  LA    R3,C1BSYPCT         CHANNEL BUSY PCT
         LA    R4,C1BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH1LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH1BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'01'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C2BSYPCT         CHANNEL BUSY PCT
         LA    R4,C2BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH2LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH2BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'02'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C3BSYPCT         CHANNEL BUSY PCT
         LA    R4,C3BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH3LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH3BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'03'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C4BSYPCT         CHANNEL BUSY PCT
         LA    R4,C4BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH4LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH4BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'04'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C5BSYPCT         CHANNEL BUSY PCT
         LA    R4,C5BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH5LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH5BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'05'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C6BSYPCT         CHANNEL BUSY PCT
         LA    R4,C6BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH6LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH6BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'06'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C7BSYPCT         CHANNEL BUSY PCT
         LA    R4,C7BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH7LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH7BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'07'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,C8BSYPCT         CHANNEL BUSY PCT
         LA    R4,C8BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH8LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH8BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'08'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         EJECT
         LA    R3,C9BSYPCT         CHANNEL BUSY PCT
         LA    R4,C9BSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCH9LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH9BS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'09'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CABSYPCT         CHANNEL BUSY PCT
         LA    R4,CABSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHALM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHABS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'10'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CBBSYPCT         CHANNEL BUSY PCT
         LA    R4,CBBSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHBLM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHBBS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'11'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CCBSYPCT         CHANNEL BUSY PCT
         LA    R4,CCBSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHCLM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHCBS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'12'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CDBSYPCT         CHANNEL BUSY PCT
         LA    R4,CDBSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHDLM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHDBS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'13'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CEBSYPCT         CHANNEL BUSY PCT
         LA    R4,CEBSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHELM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHEBS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'14'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         LA    R3,CFBSYPCT         CHANNEL BUSY PCT
         LA    R4,CFBSYTIM         CHANNEL BUSY TIME
         LA    R5,THRCHFLM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCHFBS         CHANNEL BUSY TIME THRESHOLD
         LA    R9,=C'15'           CHANNEL NUMBER
         BAL   R15,CHNDISP
         L     R15,CHNR15
         BR    R15
         EJECT
CHNDISP  ST    R15,CHDR15
         L     R1,0(0,R3)
         C     R1,0(0,R5)          THRESHOLD REACHED
         BL    CHNDISP1            NO
         TIME  BIN
         L     R1,0(0,R4)          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,0(0,R4)          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,0(0,R4)          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BC    8,CHNDISPX          YES
         BP    CHNDISP2
         SPACE 1
CHNDISP1 XC    0(4,R4),0(R4)
CHNDISPX L     R15,CHDR15
         BR    R15
         SPACE 1
CHNDISP2 LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         L     R1,0(0,R3)          PERCENT BUSY
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R6)         CHANNEL BUSY TIME THRESHOLD REACHED
         BC    4,CHNDISPX          NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHNDISP3            NO, 2ND HALF
         MVC   WJOB1(38),=CL38'CHANNEL XX   XXX% BUSY  FOR XXXXX SEC'
         MVC   WJOB1+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB1+12(4),=X'40202120'
         ED    WJOB1+12(4),DOUBLE+6
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLEX+5
         B     CHNDISPX
         SPACE 1
CHNDISP3 MVC   WJOB2(38),=CL38'CHANNEL XX   XXX% BUSY  FOR XXXXX SEC'
         MVC   WJOB2+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB2+12(4),=X'40202120'
         ED    WJOB2+12(4),DOUBLE+6
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLEX+5
         BAL   R9,DISPLAY
         B     CHNDISPX
         EJECT
CHKEXIT  L      R15,CHKR15
         BR     R15
         EJECT
CHKCPU   STM   R0,R15,SAVEREGS
         ST    R15,CHKR15
         CVD   R15,DOUBLE
         C     R15,THRCPULP        OVER CPU PERCENT THRESHOLD
         BL    CHKCPU2             NO
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         LOOP SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRCPULT        OVER CPU THRESHOLD
         BL    CHKCPU3             NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKCPU1             NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28' XXX% CPU FOR     XXXXX SEC'
         MVC   WMSG1(4),=X'40202120'
         ED    WMSG1(4),DOUBLE+6
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         B     CHKCPU3
         SPACE 1
CHKCPU1  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28' XXX% CPU FOR     XXXXX SEC'
         MVC   WMSG2(4),=X'40202120'
         ED    WMSG2(4),DOUBLE+6
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         BAL   R9,DISPLAY
         B     CHKCPU3
         SPACE 1
CHKCPU2  XC    JOBCPUL(4),JOBCPUL
         XC    JOBCPUT(4),JOBCPUT
         SPACE 1
CHKCPU3  LM    R0,R15,SAVEREGS
         B     CHKEXIT
         EJECT
CHKPAG   EQU   *
         ST    R15,CHKR15          DOR
         L     R9,16               CVT
         L     R9,604(0,R9)        RMCT
         SR    R1,R1
         LH    R1,664(0,R9)        AVERAGE PAGING
         AH    R1,662(0,R9)        AVERAGE ASMQ
         C     R1,THRPAGLM         OVER PAGING THRESHOLD
         BH    CHKPAG1             YES
         XC    PAGHITIM(4),PAGHITIM
         B     CHKPAG3             CHECK PAGE I/O
         SPACE 1
CHKPAG1  TIME  BIN
         L     R1,PAGHITIM         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,PAGHITIM         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,PAGHITIM         INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BZ    CHKPAG3             YES
         BP    CHKPAG2
         XC    PAGHITIM(4),PAGHITIM
         B     CHKPAG3             CHECK PAGE I/O
         SPACE 1
CHKPAG2  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         C     R15,THRPAGHI        PAGING HIGH TIME THRESHOLD REACHED
         BL    CHKPAG3             NO, CHECK PAGE I/O
         CVD   R15,DOUBLE
         CLI   WJOB1,C' '
         BNE   CHKPAG2A
         MVC   WJOB1(38),=CL38'EXCESS SYSTEM PAGING FOR    XXXXX SEC'
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLE+5
         B     CHKPAG3
         SPACE 1
CHKPAG2A MVC   WJOB2(38),=CL38'EXCESS SYSTEM PAGING FOR    XXXXX SEC'
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLE+5
         BAL   R9,DISPLAY
         SPACE 1
CHKPAG3  L     R1,16               CVT
         L     R1,704(0,R1)        ASMVT
         L     R1,8(0,R1)          PART
         LA    R1,80(0,R1)         PART ENTRIES
         SPACE 1
CHKPAG4  TM    8(R1),X'E0'
         BZ    CHKPAG6
         SPACE 1
CHKPAG5  LA    R1,64(0,R1)         NEXT PART ENTRY
         CLI   8(R1),X'00'         END OF PART
         BE    CHKPAG5A            YES, EXIT
         TM    9(R1),X'80'         NOT IN USE
         BO    CHKPAG5             YES, GET NEXT
         B     CHKPAG4
         SPACE 1
CHKPAG5A XC    PAGIOTIM(4),PAGIOTIM
         B     CHKEXIT
         EJECT
CHKPAG6  L     R14,56(0,R1)       PARERQTM -   BURST COMPUTATION VALUE
         SRL   R14,8              DIVIDE BY 256
         CVD   R14,DOUBLE
         C     R14,THRPAGTM       OVER PAGE I/O AVG SERV TIME THRESH
         BH    CHKPAG7            YES
         B     CHKPAG5
         SPACE 1
CHKPAG7  TIME  BIN
         L     R1,PAGIOTIM         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,PAGIOTIM         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,PAGIOTIM         INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BC    8,CHKEXIT           YES
         BP    CHKPAG8
         XC    PAGIOTIM(4),PAGIOTIM
         B     CHKEXIT
         SPACE 1
CHKPAG8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         C     R15,THRPAGIO        PAGE I/O HIGH TIME THRESHOLD REACHED
         BC    4,CHKEXIT           NO, EXIT
         CVD   R15,DOUBLE
         CLI   WJOB1,C' '
         BNE   CHKPAG8A
         MVC   WJOB1(38),=CL38'LOCAL PAGE I/O DEGRADED FOR XXXXX SEC'
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLE+5
         B     CHKEXIT
         SPACE 1
CHKPAG8A MVC   WJOB2(38),=CL38'LOCAL PAGE I/O DEGRADED FOR XXXXX SEC'
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKABN   ST    R15,CHKR15
         L     R1,16              CVT
         L     R1,640(0,R1)       FIRST VALID MAJOR QCB
         B     CHKABN1+4          1ST MAJOR PROCESS
         SPACE 1
CHKABN1  L     R1,0(0,R1)         NEXT MAJOR
         LTR   R1,R1              EXIST
         BC    8,CHKEXIT          NO, END OF QCBS
         CLC   16(8,R1),=CL8'SYSIEA01'  ABEND QCB
         BNE   CHKABN1            NO, NEXT MAJOR
         L     R14,8(0,R1)        1ST MINOR
         LTR   R14,R14            EXIST
         BC    8,CHKEXIT          NO
         B     CHKABN3
         SPACE 1
CHKABN2  L     R14,0(0,R14)       NEXT MINOR QCB
         LTR   R14,R14            EXIST
         BC    8,CHKEXIT          NO
         SPACE 1
CHKABN3  L     R15,8(0,R14)       1ST QEL
         SPACE 1
CHKABN4  LTR   R15,R15            EXIST
         BZ    CHKABN2            NO
         CLC   JOBASID(2),14(R15) ASID MATCH
         BE    CHKABN5            YES, JOB ABENDING
         L     R15,0(0,R15)       NEXT QEL
         LA    R15,0(0,R15)
         LTR   R15,R15            EXIST
         BZ    CHKABN2            NO
         B     CHKABN4
         SPACE 1
CHKABN5  TIME  BIN
         L     R1,JOBABEND         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,JOBABEND         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,JOBABEND         INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BC    8,CHKEXIT           YES
         BP    CHKABN7
         SPACE 1
CHKABN6  XC    JOBABEND(4),JOBABEND
         B     CHKEXIT
         SPACE 1
CHKABN7  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRABEND        TIME THRESHOLD REACHED
         BC    4,CHKEXIT           NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKABN8             NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'ABEND IN PROGRESS XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         B     CHKEXIT
         SPACE 1
CHKABN8  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'ABEND IN PROGRESS XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKREP   ST    R15,CHKR15
         L     R1,CURRWAIT         CURRENT WAIT TIME
         C     R1,THRREPWT         OVER REPLY WAIT THRESHOLD
         BC    4,CHKEXIT           NO
         L     R1,16              CVT
         L     R1,100(0,R1)       UCM BASE
         L     R1,28(0,R1)        1ST ORE
         LA    R1,0(0,R1)
         SPACE 1
CHKREP1  LTR   R1,R1              ANY OUTSTANDING REPLIES
         BC    8,CHKEXIT          NO
         CLC   JOBASID(2),24(R1)  ASID MATCH
         BE    CHKREP2            YES
         L     R1,0(0,R1)         NEXT ORE
         LA    R1,0(0,R1)
         B     CHKREP1
         SPACE 1
CHKREP2  MVC   0(12,R3),=CL12'REPLY '
         MVC   7(2,R3),4(R1)      REPLY ID
         B     CHKEXIT
         SPACE 5
CHKSRC   ST    R15,CHKR15
         LA    R1,SRCTAB
         SR    R15,R15
         IC    R15,41(0,R9)        SWAP REASON CODE
         CH    R15,=H'13'          MAX SWAP REASON CODE
         BC    2,CHKEXIT           OVER MAX
         MH    R15,=H'12'
         LA    R1,0(R15,R1)        SWAP REASON CODE OUTPUT
         MVC   0(12,R3),0(R1)
         B     CHKEXIT
         EJECT
CHKFRM   ST    R15,CHKR15
         CLC   36(2,R5),=H'1'      MASTER SCHEDULER
         BC    8,CHKEXIT           YES, NO FRAME CHECK
         CLC   172(4,R5),=F'0'     JOB OR STC/TSU
         BNE   *+12                JOB
         CLI   28(R6),X'01'        TSU OR STC
         BC    7,CHKEXIT           STC
         L     R1,16              LOAD CVT ADDR
         L     R1,356(0,R1)       LOAD PVT ADDR
         L     R15,12(0,R1)       PFT APPARENT ADDR
         AH    R15,16(0,R1)       PFT ACTUAL ADDR
         SR    R14,R14             INDEX
         ICM   R14,3,18(R1)        TO END OF PTF
         SH    R14,16(0,R1)
         SRL   R14,4               DIVIDE BY 16
         SR    R1,R1               CLEAR FRAME COUNT
         SPACE 1
CHKFRM1  CLC   0(2,R15),JOBASID    ASID MATCH
         BNE   CHKFRM2             NO
         LA    R1,1(0,R1)          ADD 1 TO FRAME COUNT
         SPACE 1
CHKFRM2  LA    R15,16(0,R15)       NEXT PFT
         BCT   R14,CHKFRM1         PROCESS NEXT
         L     R15,JOBFRCNT        JOB FRAME COUNT  (WEIGHTED AVG)
         XC    JOBFRCNT(4),JOBFRCNT
         C     R1,THRFRAME         THRESHOLD REACHED
         BL    CHKFRM3             NO
         LTR   R15,R15             ZERO
         BNZ   *+6                 NO
         LR    R15,R1              FAKE START
         MH    R15,=H'3'           3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         ST    R1,JOBFRCNT
         CVD   R1,DOUBLE
         TIME  BIN
         L     R1,JOBFRAME         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,JOBFRAME         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,JOBFRAME         INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BC    8,CHKEXIT           YES
         BP    CHKFRM4
         SPACE 1
CHKFRM3  XC    JOBFRAME(4),JOBFRAME
         B     CHKEXIT
         EJECT
CHKFRM4  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRFRMTM        FRAME USAGE TIME THRESHOLD REACHED
         BC    4,CHKEXIT           NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKFRM5             NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         MVC   WMSG1(6),=X'402020202120'
         ED    WMSG1(6),DOUBLE+5
         B     CHKEXIT
         SPACE 1
CHKFRM5  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         MVC   WMSG2(6),=X'402020202120'
         ED    WMSG2(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKSWP   ST    R15,CHKR15
         CLC   36(2,R5),=H'1'      MASTER SCHEDULER
         BC    8,CHKEXIT           YES, NO SWAP CHECK
         CLC   172(4,R5),=F'0'     JOB OR STC/TSU
         BC    8,CHKEXIT           STC OR TSO
         LH    R1,42(0,R9)         SWAP COUNT
         CVD   R1,DOUBLE
         C     R1,THRSWAP          THRESHOLD REACHED
         BC    4,CHKEXIT
         SPACE 1
CHKSWP1  CLI   WJOB1,C' '          1ST PASS
         BNE   CHKSWP2             NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'EXCESS SWAP COUNT = XXXXX'
         MVC   WMSG1+19(6),=X'402020202120'
         ED    WMSG1+19(6),DOUBLE+5
         B     CHKEXIT
         SPACE 1
CHKSWP2  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'EXCESS SWAP COUNT = XXXXX'
         MVC   WMSG2+19(6),=X'402020202120'
         ED    WMSG2+19(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKWQE   EQU   *
         ST    R15,CHKR15
         L     R1,16               CVT
         L     R1,100(0,R1)        UCM BASE
         SR    R14,R14
         LH    R15,58(0,R1)        CURRENT WQE COUNT
         CVD   R15,DOUBLE
         M     R14,=F'100'
         LH    R1,238(0,R1)        WQE COUNT LIMIT
         DR    R14,R1              PERCENT USED
         C     R15,THRWQELM        WQE THRESHOLD LIMIT REACHED
         BC    4,CHKEXIT           NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKWQE1             NO, 2ND HALF
         MVC   WJOB1(38),=CL38'WTO BUFFER SHORTAGE, WQE COUNT= XXXXX'
         MVC   WJOB1+31(6),=X'402020202120'
         ED    WJOB1+31(6),DOUBLE+5
         B     CHKEXIT
         SPACE 1
CHKWQE1  MVC   WJOB2(38),=CL38'WTO BUFFER SHORTAGE, WQE COUNT= XXXXX'
         MVC   WJOB2+31(6),=X'402020202120'
         ED    WJOB2+31(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKSQA   EQU   *
         ST    R15,CHKR15
         L     R1,16               CVT
         L     R3,356(0,R1)        LOAD PVT ADDR
         L     R1,560(0,R1)        GDA
         LR    R6,R1               SAVE GDA ADDR
         L     R4,8(0,R6)          CSA PQE
         L     R5,0(0,R4)          1ST FBQE FOR CSA
         SR    R9,R9
         CR    R4,R5               END OF CHAIN
         BE    CHKSQA2             YES
         SPACE 1
CHKSQA1  A     R9,8(0,R5)          ADD FREE AREA
         L     R5,0(0,R5)          NEXT FBQE
         CR    R4,R5               END OF CHAIN
         BNE   CHKSQA1             NO
         SPACE 1
CHKSQA2  LR    R1,R9               CSA AVAIL
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         L     R1,28(0,R6)         SQA AVAIL
         SR    R1,R9               SUBTRACT CSA
         BNP   CHKSQA3             IF NOT POSITIVE, SQA IN CSA
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLEX
         B     CHKSQA4             IF NOT POSITIVE, SQA IN CSA
         SPACE 1
CHKSQA3  SR    R1,R1
         SPACE 1
CHKSQA4  C     R1,THRSQALM         THRESHOLD REACHED
         BC    2,CHKEXIT
         SPACE 1
CHKSQA5  CLI   WJOB1,C' '          1ST PASS
         BNE   CHKSQA6             NO, 2ND HALF
         MVC   WJOB1(38),=CL38'SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK'
         MVC   WJOB1+10(6),=X'402020202120'
         ED    WJOB1+10(6),DOUBLEX+5
         MVC   WJOB1+29(6),=X'402020202120'
         ED    WJOB1+29(6),DOUBLE+5
         B     CHKEXIT
         SPACE 1
CHKSQA6  MVC   WJOB2(38),=CL38'SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK'
         MVC   WJOB2+10(6),=X'402020202120'
         ED    WJOB2+10(6),DOUBLEX+5
         MVC   WJOB2+29(6),=X'402020202120'
         ED    WJOB2+29(6),DOUBLE+5
         BAL   R9,DISPLAY
         B     CHKEXIT
         EJECT
CHKENQ   ST    R15,CHKR15
         L     R1,16              CVT
         L     R1,640(0,R1)       FIRST VALID MAJOR QCB
         ST    R2,SAVEREGS
         B     CHKENQ1+4          1ST MAJOR PROCESS
         SPACE 1
CHKENQ1  L     R1,0(0,R1)         NEXT MAJOR
         LTR   R1,R1              EXIST
         BZ    CHKENQ8            NO, END OF QCBS
         MVC   MAJOR(8),16(R1)    SAVE MAJOR QCB
         L     R14,8(0,R1)        1ST MINOR
         LTR   R14,R14            EXIST
         BZ    CHKENQ1            NO
         B     CHKENQ3
         SPACE 1
CHKENQ2  L     R14,0(0,R14)       NEXT MINOR QCB
         LTR   R14,R14            EXIST
         BZ    CHKENQ1            NO
         SPACE 1
CHKENQ3  L     R15,8(0,R14)       1ST QEL
         SPACE 1
CHKENQ4  LTR   R15,R15            EXIST
         BZ    CHKENQ2            NO
         TM    12(R15),X'80'      SHARED
         BZ    CHKENQ5            NO
         L     R15,0(0,R15)       NEXT QEL
         LA    R15,0(0,R15)
         B     CHKENQ4
         SPACE 1
CHKENQ5  C     R15,8(0,R14)       IS EXCL QEL THE 1ST QEL
         BNE   CHKENQ6            NO
         L     R2,0(0,R15)        NEXT QEL
         LA    R2,0(0,R2)
         LTR   R2,R2              EXIST
         BZ    CHKENQ2            NO
         SPACE 1
CHKENQ6  L     R15,0(0,R15)       NEXT QEL
         LA    R15,0(0,R15)
         LTR   R15,R15            EXIST
         BZ    CHKENQ2            NO
         CLC   JOBASID(2),14(R15) ASID MATCH
         BE    CHKENQ7            YES, ENQ CONFLICT THIS JOB
         B     CHKENQ6
         SPACE 1
CHKENQ7  MVC   0(12,R3),=CL12'ENQ'
         MVC   4(8,R3),MAJOR
         SPACE 1
CHKENQ8  L     R2,SAVEREGS
         B     CHKEXIT
         EJECT
CHKALC   ST    R15,CHKR15          CURRENT WAIT TIME
         L     R1,CURRWAIT         CURRENT WAIT TIME
         C     R1,THRALCWT         OVER ALLOCATION WAIT THRESHOLD
         BC    4,CHKEXIT           NO
         L     R1,16              CVT
         L     R1,548(0,R1)       AQTOP
         L     R14,0(0,R1)        1ST QUEUE ELEMENT
         SPACE 1
CHKALC1  CR    R1,R14             END OF CHAIN
         BC    8,CHKEXIT          YES, NOT IN ALLOCATION
         SR    R15,R15
         LH    R15,22(0,R14)      ASID
         CH    R15,JOBASID        ASID MATCH
         BE    CHKALC2
         L     R14,0(0,R14)       NEXT QUEUE ELEMENT
         B     CHKALC1
         SPACE 1
CHKALC2  MVC   0(12,R3),=CL12'ALLOC QUEUE'
         B     CHKEXIT
         EJECT
CHKUCB   ST    R15,CHKR15
         STM   R0,R15,SAVEREGS
         MVC   UCBTABND(2),=X'FFFF'
         LA    R6,UCBTAB-12
         SPACE 1
CHKUCB0  LA    R6,12(0,R6)
         CLC   0(2,R6),=X'FFFF'    END OF TABLE
         BE    CHKUCB9             YES
         CLI   2(R6),X'00'         REFERENCED LAST PASS
         BNE   *+10                YES
         XC    0(8,R6),0(R6)
         MVI   2(R6),X'00'
         XC    8(4,R6),8(R6)
         B     CHKUCB0
         SPACE 1
CHKUCB1  XC    UCBDMSAV(24),UCBDMSAV
         ST    R15,CHKR15
         STM   R0,R15,SAVEREGS
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         SPACE 1
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB9             YES, EXIT
         CLI   18(R1),X'20'        DASD
         BNE   CHKUCB1A            NO
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1A            NO
         LA    R6,UCBTAB-12
         SPACE 1
CHKUCB2  LA    R6,12(0,R6)         NEXT UCB ENTRY
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB3             YES, CHECK FOR EMPTY SLOT
         CLM   R1,3,0(R6)          UCB ADDR MATCH
         BNE   CHKUCB2             NO
         B     CHKUCB5
         SPACE 1
CHKUCB3  LA    R6,UCBTAB-12
         SPACE 1
CHKUCB4  LA    R6,12(0,R6)         NEXT UCB ENTRY
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB1A            YES, NEXT UCB
         CLC   0(2,R6),=X'0000'    EMPTY SLOT
         BNE   CHKUCB4             NO, NEXT ENTRY
         SPACE 1
CHKUCB5  STCM  R1,3,0(R6)          SAVE UCB ADDR
         MVI   2(R6),X'FF'         SLOT IN USE
         L     R1,8(0,R6)
         LA    R1,1(0,R1)
         ST    R1,8(0,R6)
         B     CHKUCB1A
         EJECT
CHKUCB6  STM   R0,R15,SAVEREGS
         ST    R15,CHKR15
         LA    R6,UCBTAB-12
         SPACE 1
CHKUCB7  LA    R6,12(0,R6)
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB9             YES, EXIT
         SR    R1,R1
         ICM   R1,3,0(R6)          UCB ADDR
         LA    R3,UCBNRDY
         LA    R4,THRUCBNR
         TM    6(R1),X'40'         NOT READY
         BO    CHKUCB7A
         LA    R3,UCBBUSY
         LA    R4,THRUCBBS
         SR    R14,R14
         L     R15,8(0,R6)         UCB BUSY COUNT
         XC    8(4,R6),8(R6)
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         SR    R1,R1
         IC    R1,3(0,R6)          CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+6                 NO
         LR    R1,R15              FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         STC   R1,3(0,R6)          NEW CUM PERCENT
         C     R1,THRUCBLM         THRESHOLD REACHED
         BL    CHKUCB7B            NO
         SPACE 1
CHKUCB7A TIME  BIN
         L     R1,4(0,R6)          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,4(0,R6)          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,4(0,R6)          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BZ    CHKUCB7             YES
         BP    CHKUCB8
         SPACE 1
CHKUCB7B XC    4(8,R6),4(R6)
         B     CHKUCB7
         EJECT
CHKUCB8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         SR    R1,R1
         IC    R1,3(0,R6)
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R4)         TIME THRESHOLD REACHED
         BL    CHKUCB7             NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKUCB8A            NO, 2ND HALF
         MVC   WJOB1(38),0(R3)
         SR    R1,R1
         ICM   R1,3,0(R6)          UCB ADDR
         MVC   WJOB1(3),13(R1)     DEVICE ADDRESS
         MVC   WJOB1+4(6),28(R1)   DEVICE VOLSER
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB7             YES, NO PERCENT
         MVC   WJOB1+12(4),=X'40202120'
         ED    WJOB1+12(4),DOUBLE+6
         B     CHKUCB7
         SPACE 1
CHKUCB8A MVC   WJOB2(38),0(R3)
         SR    R1,R1
         ICM   R1,3,0(R6)          UCB ADDR
         MVC   WJOB2(3),13(R1)     DEVICE ADDRESS
         MVC   WJOB2+4(6),28(R1)   DEVICE VOLSER
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB8B            YES, NO PERCENT
         MVC   WJOB2+12(4),=X'40202120'
         ED    WJOB2+12(4),DOUBLE+6
         SPACE 1
CHKUCB8B EQU   *
         BAL   R9,DISPLAY
         B     CHKUCB7
         SPACE 1
CHKUCB9  LM    R0,R15,SAVEREGS
         B     CHKEXIT
         EJECT
CHKQIO   ST    R15,CHKR15
         XC    UCBDMSAV(24),UCBDMSAV
         MVC   QIOASID(2),JOBASID  SAVE ASID
         STM   R0,R15,SAVEREGS
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         SPACE 1
CHKQIO1  BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKQIO3             YES, EXIT
         B     CHKQIO2
         SPACE 1
CHKQIO2  LR    R2,R1              UCB ADDR
         CLI   18(R1),X'20'       DASD
         BE    *+18               YES
         L     R4,20(0,R1)        UCB EXTENTION ADDR
         CLC   QIOASID(2),14(R4)  ASID MATCH
         BNE   CHKQIO1            NO, NEXT UCB
         LR    R4,R1              UCB ADDR
         S     R4,=F'4'           DECR ADDR -4
         L     R4,0(0,R4)         IOQ ADDR
         LA    R4,0(0,R4)
         LTR   R4,R4              ANY IOQ
         BZ    CHKQIO1            NO, NEXT UCB
         L     R5,8(0,R4)         IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5              EXIST
         BZ    CHKQIO1            NO, NEXT UCB
         B     CHKQIO9
         SPACE 1
CHKQIO3  L     R8,16              CVT ADDR
         L     R8,140(0,R8)       LCH ADDR
         SPACE 1
CHKQIO4  CLC   16(4,R8),=F'0'     END OF LCH
         BE    CHKQIO8A           YES, EXIT
         CLC   0(4,R8),=X'FFFFFFFF' IOQ ADDR EXIST
         BNE   CHKQIO6            YES
         SPACE 1
CHKQIO5  LA    R8,32(0,R8)        NEXT LCH
         B     CHKQIO4
         SPACE 1
CHKQIO6  L     R4,0(0,R8)         1ST IOQ
         L     R6,4(0,R8)         LAST IOQ
         SPACE 1
CHKQIO7  L     R5,8(0,R4)         IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5              EXIST
         BZ    CHKQIO7A           NO
         L     R2,16(0,R5)        UCB ADDR
         CLC   QIOASID(2),6(R5)   ASID MATCH
         BE    CHKQIO8            YES
         SPACE 1
CHKQIO7A CR    R4,R6              END OF IOQS
         BE    CHKQIO5            YES
         L     R4,0(0,R4)         NEXT IOQ
         B     CHKQIO7
         SPACE 1
CHKQIO8  MVC   0(12,R3),=CL12'I/O ON'
         MVC   8(3,R3),13(R2)
         SPACE 1
CHKQIO8A LM    R0,R15,SAVEREGS
         B     CHKEXIT
         SPACE 1
CHKQIO9  C     R2,16(0,R5)        UCB ADDR MATCH
         BNE   CHKQIO8A           NO, EXIT
         CLC   QIOASID(2),6(R5)   ASID MATCH
         BE    CHKQIO8            YES
         B     CHKQIO1
         EJECT
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 CLC   0(2,R9),=X'FFFF'    .END OF TABLE
         BE    UCBDMOUT            .YES, GO PROCESS
         SR    R1,R1
         ICM   R1,3,0(R9)          .LOAD UCB ADDR
         LTR   R1,R1               .ZERO ADDR
         BNZ   UCBDML#4            .NO, CONTINUE
         SPACE 1
UCBDML#3 LA    R9,2(0,R9)          .NEXT UCB LOOKUP TABLE ENTRY
         B     UCBDML#2
         SPACE 1
UCBDML#4 CLI   18(R1),X'10'        GRAPHICS
         BE    UCBDML#3            YES, NEXT UCB
         CLI   18(R1),X'40'        COMM
         BE    UCBDML#3            YES, NEXT UCB
         TM    6(R1),X'8A'         BUSY AND/OR CHANNEL PROGRAM ACTIVE
         BZ    UCBDML#3            NO, NEXT UCB
         BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#3            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         MVC   UCBDMCUR+2(2),0(R9) .SET NEXT LEAST HIGH UCB ADDR
         B     UCBDMOUT            .GO PROCESS
         EJECT
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         EJECT
MSGRTN   EQU   *
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   EQU   *
EXIT     EQU   *
         L     R0,SIZEJOB          LOAD GETMAIN SIZE AND SUBPOOL
         L     R1,EXTRAREA         LOAD GETMAIN AREA ADDR
         FREEMAIN R,LV=(0),A=(1)
         MODESET KEY=NZERO,MODE=PROB
         SETAUTH   OFF
         QSTOP
         EJECT
         LTORG
         EJECT
         DS    0F
*  DO NOT USE SUBSPOOL 241 CAN CAUSE VTAM UNABLE TO ALLOCATE CSA  DOR01
*   AREA FOR PUI BUFFER.                                          DOR01
*  COMMENT BY DAVE RIKER CDSI 4/23/87                             DOR01
*SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT) CSA SUBSPOOL 241      DOR01
*SIZEJOB  DC    X'F1',AL3(JOBTABE-JOBTABLE) CSA SUBSPOOL 241      DOR01
SIZE     DC    X'00',AL3(WORKEND-WORKSTRT)   V=R SUBSPOOL 0       DOR01
SIZEJOB  DC    X'00',AL3(JOBTABE-JOBTABLE)   V=R SUBSPOOL 0       DOR01
         SPACE 3
UCBNRDY  DC    CL38'XXX XXXXXX   NOT READY  FOR XXXXX SEC'
UCBBUSY  DC    CL38'XXX XXXXXX   XXX% BUSY  FOR XXXXX SEC'
         SPACE 3
SRMOVLY  DS    0CL80
         DC    CL5'TSO-',CL10' '
         DC    CL6'LGCP-',CL7' '
         DC    CL6'AVCP-',CL7' '
         DC    CL6'AVPG-',CL7' '
         DC    CL7'AVUIC-',CL7' '
         DC    CL6'ASMQ-',CL6' '
         SPACE 3
SRCTAB   DC    CL12' '
         DC    CL12'*'
         DC    CL12'*'
         DC    CL12'SWAP LONGWT '
         DC    CL12'SWAP AUXSTOR'
         DC    CL12'SWAP REALSTR'
         DC    CL12'SWAP DETWAIT'
         DC    CL12'SWAP REQUEST'
         DC    CL12'SWAP ENQEXC '
         DC    CL12'SWAP WORKEXC'
         DC    CL12'SWAP UNILATR'
         DC    CL12'SWAP TRANSIT'
         DC    CL12'*'
         DC    CL12'*'
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                     *
*                                                                     *
*        THRESHOLD VALUES FOR ALL DISPLAY LIMITS                      *
*                                                                     *
*                                                                     *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         SPACE 5
         DS    0D
THRINTVL DC    CL8'00000050'       1/2 SEC STIMER FOR CHANNEL BUSY
THRSTIMR DC    F'20'               CHANNEL BUSY STIMER REPETITIONS
***   THE ABOVE VALUES MULTIPLIED TOGETHER GIVE THE MINIMUM
***   REFRESH FOR THIS COMMAND
THRTSOPG DC    F'13'               TSO PERFORMANCE GROUP    AXC
THRSWAP  DC    F'30'               HIGH SWAP COUNT THRESHOLD
THRFRAME DC    F'200'              HIGH FRAME USE LIMIT
*  SET THRFRAME LOWER IF PAGING IS HIGH   = 100 ?
THRFRMTM DC    F'60'               HIGH FRAME USE TIME THRESHOLD
THRABEND DC    F'10'               JOB ABENDING TIME THRESHOLD
THRLOOPP DC    F'05'               LOOP CPU PERCENT THRESHOLD
THRLOOPT DC    F'30'               LOOP TIME THRESHOLD
THRCPULP DC    F'20'               EXCESS JOB CPU PERCENT THRESHOLD
THRCPULT DC    F'10'               EXCESS JOB CPU TIME THRESHOLD
THRSWPWT DC    F'180'              SWAP WAIT TIME THRESHOLD
THRREPWT DC    F'30'               REPLY WAIT TIME THRESHOLD
THRALCWT DC    F'30'               ALLOCATION WAIT TIME THRESHOLD
THRWQELM DC    F'60'               HIGH WQE PERCENT USE THRESHOLD
THRSQALM DC    F'64'               SQA SHORTAGE MIN 'K' THRESHOLD
THRPAGHI DC    F'60'               HIGH PAGING TIME THRESHOLD
THRPAGLM DC    F'50'               HIGH PAGING ASMQ + PAGES/SEC LIMIT
THRPAGIO DC    F'30'               PAGE I/O SLOW TIME THRESHOLD
THRPAGTM DC    F'60'               PAGE I/O SLOW BURST LIMIT
THRUCBNR DC    F'30'               DEVICE NOT READY THRESHOLD  (DASD)
THRUCBBS DC    F'30'               DEVICE BUSY THRESHOLD       (DASD)
THRUCBLM DC    F'40'               DEVICE BUSY LIMIT           (DASD)
* CHANNEL LIMITS ARE SET TO 35% FOR DISK AND 60% FOR TAPE
THRCH1BS DC    F'60'               CHANNEL 1 PERCENT BUSY THRESHOLD
THRCH1LM DC    F'35'               CHANNEL 1 PERCENT BUSY LIMIT
THRCH2BS DC    F'60'               CHANNEL 2 PERCENT BUSY THRESHOLD
THRCH2LM DC    F'35'               CHANNEL 2 PERCENT BUSY LIMIT
THRCH3BS DC    F'60'               CHANNEL 3 PERCENT BUSY THRESHOLD
THRCH3LM DC    F'35'               CHANNEL 3 PERCENT BUSY LIMIT
THRCH4BS DC    F'60'               CHANNEL 4 PERCENT BUSY THRESHOLD
THRCH4LM DC    F'35'               CHANNEL 4 PERCENT BUSY LIMIT   AXC
THRCH5BS DC    F'60'               CHANNEL 5 PERCENT BUSY THRESHOLD
THRCH5LM DC    F'35'               CHANNEL 5 PERCENT BUSY LIMIT
THRCH6BS DC    F'60'               CHANNEL 6 PERCENT BUSY THRESHOLD
THRCH6LM DC    F'35'               CHANNEL 6 PERCENT BUSY LIMIT
THRCH7BS DC    F'60'               CHANNEL 7 PERCENT BUSY THRESHOLD
THRCH7LM DC    F'35'               CHANNEL 7 PERCENT BUSY LIMIT
THRCH8BS DC    F'60'               CHANNEL 8 PERCENT BUSY THRESHOLD
THRCH8LM DC    F'35'               CHANNEL 8 PERCENT BUSY LIMIT
THRCH9BS DC    F'60'               CHANNEL 9 PERCENT BUSY THRESHOLD
THRCH9LM DC    F'35'               CHANNEL 9 PERCENT BUSY LIMIT
THRCHABS DC    F'60'               CHANNEL A PERCENT BUSY THRESHOLD
THRCHALM DC    F'35'               CHANNEL A PERCENT BUSY LIMIT
THRCHBBS DC    F'60'               CHANNEL B PERCENT BUSY THRESHOLD
THRCHBLM DC    F'35'               CHANNEL B PERCENT BUSY LIMIT
THRCHCBS DC    F'60'               CHANNEL C PERCENT BUSY THRESHOLD
THRCHCLM DC    F'35'               CHANNEL C PERCENT BUSY LIMIT
THRCHDBS DC    F'60'               CHANNEL D PERCENT BUSY THRESHOLD
THRCHDLM DC    F'35'               CHANNEL D PERCENT BUSY LIMIT
THRCHEBS DC    F'60'               CHANNEL E PERCENT BUSY THRESHOLD
THRCHELM DC    F'35'               CHANNEL E PERCENT BUSY LIMIT
THRCHFBS DC    F'60'               CHANNEL F PERCENT BUSY THRESHOLD
THRCHFLM DC    F'35'               CHANNEL F PERCENT BUSY LIMIT
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
EXTRAREA DS    F
ASCBR15  DS    F
CHKR15   DS    F
CHNR15   DS    F
CHDR15   DS    F
DOUBLEX  DS    2F
MAJOR    DS    2F
NUMCHK   DS    2F
PARM     DS    F
QIOASID  DS    F
SAVETIM1 DS    F
SAVETIM2 DS    F
SAVECPU1 DS    F
SAVECPU2 DS    F
CURRWAIT DS    F
         SPACE 3
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 3
WORKEND  DS    0F
         SPACE 5
JOBMSG   EQU   QDMSG
WJOB1    EQU   QDMSG
WMSG1    EQU   QDMSG+10
WRSN1    EQU   QDMSG+26
WJOB2    EQU   QDMSG+42
WMSG2    EQU   QDMSG+52
WRSN2    EQU   QDMSG+68
         EJECT
JOBTABLE DSECT
PAGHITIM DS    F
PAGIOTIM DS    F
C1BSYTIM DS    F
C1BSYCNT DS    F
C1BSYPCT DS    F
C2BSYTIM DS    F
C2BSYCNT DS    F
C2BSYPCT DS    F
C3BSYTIM DS    F
C3BSYCNT DS    F
C3BSYPCT DS    F
C4BSYTIM DS    F
C4BSYCNT DS    F
C4BSYPCT DS    F
C5BSYTIM DS    F
C5BSYCNT DS    F
C5BSYPCT DS    F
C6BSYTIM DS    F
C6BSYCNT DS    F
C6BSYPCT DS    F
C7BSYTIM DS    F
C7BSYCNT DS    F
C7BSYPCT DS    F
C8BSYTIM DS    F
C8BSYCNT DS    F
C8BSYPCT DS    F
C9BSYTIM DS    F
C9BSYCNT DS    F
C9BSYPCT DS    F
CABSYTIM DS    F
CABSYCNT DS    F
CABSYPCT DS    F
CBBSYTIM DS    F
CBBSYCNT DS    F
CBBSYPCT DS    F
CCBSYTIM DS    F
CCBSYCNT DS    F
CCBSYPCT DS    F
CDBSYTIM DS    F
CDBSYCNT DS    F
CDBSYPCT DS    F
CEBSYTIM DS    F
CEBSYCNT DS    F
CEBSYPCT DS    F
CFBSYTIM DS    F
CFBSYCNT DS    F
CFBSYPCT DS    F
UCBTAB   DS    100CL12
UCBTABND DS    F
JOBNAME  DS    CL8
JOBASID  DS    H
JOBFLAG  DS    H
JOBTIME  DS    F
JOBCPUT  DS    F
JOBEXCP  DS    F
JOBLOOP  DS    F
JOBCPUL  DS    F
JOBWAIT  DS    F
JOBFRAME DS    F
JOBFRCNT DS    F
JOBABEND DS    F
         DS    499CL48
JOBTABE  DS    0F
         EJECT
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
         END
./       ADD   NAME=FFORMAT
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
***********************************************************************
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
FFORMAT   TITLE  'QUEUE COMMAND - JQE AND JOE FORMAT ROUTINES FORMS'
FFORMAT   QSTART HASPEQU=YES,                                       DORX
               XTITLE='QUEUE CMD - JQE AND JOE FORMAT ROUTINES FORMS'
         GBLB     &QSP136     SP 1.3.6 OPTION FLAG            DOR
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL     LOAD BASE REG
         AIF   (NOT &QSP136).NO136A
         USING JQE,R9         BASE REG FOR JQE DSECT               DOR
         USING JOE,R8         BASE REG FOR JOE DSECT               DOR
         AGO   .X136A
.NO136A  ANOP
         USING JQEDSECT,R9    BASE REG FOR JQE DSECT
         USING JOEDSECT,R8    BASE REG FOR JOE DSECT
.X136A   ANOP
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   INPUT TO THIS MODULE -                                            *
*     R1 = 0 INDICATES PRINT JQE                                      *
*     R1 = 4 INDICATES PRINT JOE                                      *
*     R9 CONTAINS JQE ADDRESS                                         *
*     R8 CONTAINS JOE ADDRESS                                         *
*                                                                     *
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         ST    R1,JTYPE         SAVE JOE/JQE FLAG                   PWF
         STM   R8,R9,AJOEJQE    SAVE A(JOE AND JQE)                 PWF
         MVC   FCLEAR,QBLANK    CLEAR THE PRINT AREA
         MVC   FQUEUE,QCLASS    CLASS NAME
         MVC   QDHLINE,HEADING  REPORT HEADING
         CLI   QSUBNAME,C'X'    IS THE REQUEST FOR A HEX DUMP?
         BE    NOTBUSY          YES. SKIP.
         AIF   (NOT &QSP136).NO136B                                 DOR
         TM    JQEFLAG1,JQE1BUSY IS THE JOB EXECUTING?              DOR
         BZ    NOTBUSY          NO. SKIP THIS ROUTINE.              DOR
         IC    R15,JQEFLAG1     GET SYSTEM NUMBER                   DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         TM    JQEFLAGS,QUEBUSY IS THE JOB EXECUTING?
         BZ    NOTBUSY          NO. SKIP THIS ROUTINE.
         IC    R15,JQEFLAGS     GET SYSTEM NUMBER
.X136B   ANOP                                                       DOR
         N     R15,=F'7'        ZERO OUT UNWANTED BITS
         SLL   R15,3            MULTIPLY BY 8
         LA    R15,QSYSID(R15)  OBTAIN SYSTEM ID
         MVC   FSYSID,0(R15)    MOVE SYSTEM ID TO DISPLAY
NOTBUSY  CLI   QCLASS,0         IS THIS THE TSO QUEUE?
         BE    LISTTSO          YES. DO IT.
         CLI   QCLASS,4         IS THIS THE STC QUEUE?
         BE    LISTSTC          YES. DO IT.
         CLI   QCLASS,8         IS THIS THE HELD OUTPUT QUEUE?
         BE    LISTHO           YES. DO IT.
         LTR   R1,R1            IS REQUEST FOR JQE OR JOE?
         BZ    LISTJQE          JQE.
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT JOE                                                        *
*                                                                     *
***********************************************************************
LISTJOE  MVC   FQNAME,=C'OUTPUT'   MOVE IN NAME OF QUEUE
         MVC   FQUEUE,JOECURCL     MOVE IN CURRENT CLASS
         CLI   QSUBNAME,C'X'       IS THE REQUEST FOR A HEX DUMP?
         BE    HEXO                YES. DO IT.
         L     R0,JOERECCT         NUMBER OF PRINT LINES
         CVD   R0,QDWORK           QDWORK TO DECIMAL
         MVC   FLINES,ED8          PREPARE FOR EDIT
         ED    FLINES,QDWORK+4     EDIT NUMBER OF LINES
         ST    R8,SAVJOEA          SAVE WORK JOE ADDR             LBDMC
         ICM   R8,7,JOECHAR+1      GET CHAR JOE                   LBDMC
         A     R8,QCJOTA           ADD BASE TO OFFSET             LBDMC
         MVC   FFORM,JOEFORM                                      LBDMC
         MVC   FFCB,JOEFCB                                        LBDMC
         L     R8,SAVJOEA          RESTORE WORK JOE ADDR          LBDMC
         AIF   (NOT &QSP136).NO136C
         TM    JOEFLAG1,JOE1BUSY    ?/JOB ACTIVE DOR
         BZ    LOCAL               NO. SKIP. DOR
         LA    R3,JOEDEVID         A(OUTPUT DEVICE DESCRIPTOR)     DOR
         BAL   R7,SETDEVIC         SET THE OUTPUT DEVICE           DOR
         TM    JOEFLAG1,JOE1CKV     IS THE CKPT VALID               DOR
         AGO   .X136C
.NO136C  ANOP
         TM    JOEFLAG,$JOEBUSY    ?/JOB ACTIVE
         BZ    LOCAL               NO. SKIP.
         LA    R3,JOEDEVID         A(OUTPUT DEVICE DESCRIPTOR)     FCI
         BAL   R7,SETDEVIC         SET THE OUTPUT DEVICE           FCI
         TM    JOEFLAG,$JOECKV     IS THE CKPT VALID
.X136C   ANOP
         BNO   LIST                NO. SKIP
         MVC   QCTRAK,JOECPADR     STORE DISK ADDRESS
         L     R1,QCBLKA           ADDRESS OF WORK AREA
         L     R15,=V(READSPC)     ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15              AND GO TO IT
         USING CHK,R1              ESTABLISH ADDRESSABILITY
         CLC   =C'CHK ',CHKID      IS THIS REALLY THE CHK BLOCK
         BNE   LIST
         S     R0,CHKCRECN         SUBTRACT RECORDS PRINTED FROM TOTAL
         CVD   R0,QDWORK           QDWORK TO DECIMAL
         MVC   FLINES,ED8          PREPARE FOR EDIT
         ED    FLINES,QDWORK+4     PRINT UPDATED LINE COUNT
         B     LIST                FORMAT REST OF LINE
         DROP  R1                  LOSE ADDRESSABILITY
LOCAL    LA    R15,FREMOTE         ADDRESS TO PUT TEXT
         LA    R1,JOEROUT          POINT TO ROUTING INFO
         EJECT
***********************************************************************
*RMTORLCL SUBROUTINE - DETERMINE REMOTE OR LOCAL DESTINATION       FCI*
* R1 POINTS TO PRTRT/PUNRT, R15 TO ASSEMBLY POINTER                FCI*
***********************************************************************
RMTORLCL CLI   3(R1),0            IS IT FOR REMOTE 00=LOCAL
         BE    LIST               NO LUCK .. HAVE TO WORK FOR IT   FCI*
         MVC   0(L'RMT,R15),RMT   MOVE IN 'RMT'                    FCI*
         CLI   1(R1),0            IS IT FOR SPECIAL LOCAL ROUTING
         BNE   *+10               NO LUCK
         MVC   0(L'SPC,R15),SPC   MOVE IN 'SPC'
         LA    R15,L'RMT(R15)     BUMP POINTER                     FCI*
         SR    R14,R14            LOAD RMT FLAGS                   FCI*
         ICM   R14,3,2(R1)          FROM PRT/PUN DOR FOR RMT9999
         CVD   R14,QDWORD         RMT NUMBER TO DECIMAL            FCI*
         B     FITINUM1           FIT THE NUMBER IN RMT MESSAGE    FCI*
         SPACE 2
***********************************************************************
* FITINUM SUBROUTINE - QDWORK BIN NUMBER TO NICE FORMAT            FCI*
***********************************************************************
FITINUM  CVD   R1,QDWORD            QDWORK TO PACKED DECIMAL       FCI*
FITINUM1 MVC   NUMBER(L'NORMAL),NORMAL   INITIALIZE THE EDIT FORMAT
         LA    R1,NUMBER+SIGNNORM   IN CASE OF ZEROES              FCI*
         EDMK  NUMBER(L'NORMAL),QDWORD+2     QDWORK TO EBCDIC      FCI*
         LA    R14,NUMBER+L'NORMAL-1     A(END OF QDWORKED NUMBER)
         SLR   R14,R1                LENGTH OF QDWORKED NUMBER - 1
         EX    R14,MVNUMBER          PUT THE NUMBER IN THE MSG     FCI*
         LA    R15,1(R14,R15)        A(NEXT SPOT IN MSG)           FCI*
         B     LIST                  CONTINUE WITH FORMATING
         EJECT
***********************************************************************
*                                                                     *
*   FORMAT JQE                                                        *
*                                                                     *
***********************************************************************
LISTTSO  MVC   FQNAME(8),=C'TSO USER'   NAME OF QUEUE
         B     LIST                     CONTINUE
LISTSTC  MVC   FQNAME(8),=C'SYSTEM Q'   NAME OF QUEUE
         B     LIST                     CONTINUE
LISTHO   MVC   FQNAME(8),=C'HELD OUT'   NAME OF QUEUE
         B     LIST                     CONTINUE
LISTJQE  MVC   FQNAME,=C' INPUT'        NAME OF QUEUE
LIST     CLI   QSUBNAME,C'X'            IS THE REQUEST FOR A HEX DUMP
         BE    HEX                      YES. DO IT.
         MVC   FCOUNT,ED3               PREPARE FOR EDIT
         ED    FCOUNT,QCOUNT+1          EDIT THE POSITION IN QUEUE
         MVC   FNAME,JQEJNAME           MOVE IN JOBNAME
         MVC   FJOBNO,ED5               PREPARE FOR EDIT
         LH    R0,JQEJOBNO              LOAD HASP JOBNUMBER
         CVD   R0,QDWORK                QDWORK TO DECIMAL
         ED    FJOBNO,QDWORK+5          EDIT HASP JOBNUMBER
         SR    R0,R0                    ZERO OUT REGISTER
         IC    R0,JQEPRIO               LOAD JQE PRIORITY
         SRL   R0,4                     DIVIDE BY 16
         CVD   R0,QDWORK                QDWORK TO DECIMAL
         MVC   FPRIO,ED3                PREPARE FOR EDIT
         ED    FPRIO,QDWORK+6           EDIT JQE PRIORITY
****  TEST IF FOR QUEHOLDA,QUEHOLD1 AND/OR QUEHOLD2
         AIF   (NOT &QSP136).NO136D                                 DOR
         TM    JQEFLAG1,X'E0'           IS THE JOB HELD?            DOR
         AGO   .X136D                                               DOR
.NO136D  ANOP                                                       DOR
         TM    JQEFLAGS,X'E0'           IS THE JOB HELD?
.X136D   ANOP                                                       DOR
         BZ    NOHOLD                   NO.
         MVC   FHOLD,=C'HELD'           INDICATE JOB HELD
NOHOLD   DS    0H
         CLC   JQEJNAME,=CL8'SYSLOG' ?/SYSLOG JOE                   PWF
         BNE   NOHOLD1                NO. BYPASS SYSLOG PROCESSING  PWF
         LM    R8,R9,AJOEJQE          R8 - A(JOE)  R9 - A(JQE)      PWF
         CLC   JTYPE,=F'0'            ?/JOE OR JQE BEING PROCESSED  PWF
         BE    SLOGJQE                JQE. GO PROCESS               PWF
SLOGJOE  MVC   QCTRAK,JOEIOTTR        TRACK ADDR OF SPIN IOT        PWF
         L     R1,QCIOTA              IOAREA FOR SPIN IOT           PWF
         LR    R3,R1                  A(IOAREA)                     PWF
         L     R15,=V(READSPC)                                      PWF
         BALR  R14,R15                GO TO ROUTINE                 PWF
         CLC   =C'IOT ',IOTID(R3)     IS THIS AN IOT
         BNE   NOHOLD1
         A     R3,IOTPDDB(R3)         A(FIRST PDDB)                 PWF
         S     R3,QBUFLEN             ADJUST FOR HASP BUFFER PREFIX
         AIF   (NOT &QSP136).NO136E
         USING PDB,R3                PDDB ADDRESSABILITY           DOR
         AGO   .X136E
.NO136E  ANOP
         USING PDBDSECT,R3            PDDB ADDRESSABILITY           PWF
.X136E   ANOP
         MVC   QCTRAK,PDBMTTR         TRACK DS BUFFER               PWF
         LR    R3,R1                  A(DS BUFFER)                  PWF
         B     SLOGCMN                BRANCH TO COMMON PROCESSING   PWF
SLOGJQE  MVC   QCTRAK,JQETRAK         A(JCT MTTR)                   PWF
         L     R3,QCJCTA              A(IOAREA)                     PWF
         LR    R1,R3                  A(DS BUFFER)                  PWF
         L     R15,=V(READSPC)                                      PWF
         BALR  R14,R15                                              PWF
         AIF   (NOT &QSP136).NO136F
         USING JCT,R3                 JCT ADDRESSABILITY            DOR
         AGO   .X136F
.NO136F  ANOP
         USING JCTDSECT,R3            JCT ADDRESSABILITY            PWF
.X136F   ANOP
         MVC   QPDSID,JCTPDDBK        ID OF CURRENT PDDB            PWF
         MVC   QCODEH,=H'3'           TELL LISTDS CALLER IS FORMAT  PWF
         MVC   QCTRAK,JCTIOT          A(IOT)                        PWF
         L     R1,QCIOTA              IOT IOAREA                    PWF
         LR    R3,R1                  A(DS BUFFER)                  PWF
         L     R15,=V(READSPC)                                      PWF
         BALR  R14,R15                GO TO ROUTINE                 PWF
         L     R15,=V(LISTDS2)                                      PWF
         BALR  R14,R15                GO TO ROUTINE                 PWF
         XC    QCODEH,QCODEH          CLEAR THE CODE                PWF
         CLC   QCTRAK,=F'0'           WAS ZERO TTR RETURNED?
         BE    STOP                   YES BYPASS
SLOGCMN  L     R15,=V(READSPC)                                      PWF
         BALR  R14,R15                GO TO ROUTINE                 PWF
         LA    R3,10(R3)              BYPASS RECORD HEADER          PWF
NEXTREC  CLI   0(R3),X'FF'            IS LENGTH BYTE FF?            PWF
         BE    NOHOLD1                YES. END SEARCH               PWF
         TM    1(R3),X'10'            IS THIS A SPAN RECORD         PWF
         BO    SPAN                   YES. SKIP IT                  PWF
         SR    R4,R4                  ZERO OUT REG                  PWF
         IC    R4,0(R3)               INSERT LENGTH                 PWF
         LR    R5,R4                  SAVE RECORD LENGTH            PWF
         LR    R2,R3                  SAVE RECORD LOCATION          PWF
         TM    1(R3),X'80'            IS CARRIAGE CONTROL SPECIFIED PWF
         BZ    NOCCTL                 NO. CONTINUE                  PWF
         LA    R2,1(R2)               SKIP OVER CC                  PWF
NOCCTL   TM    1(R3),X'08'            IS THIS RECORD TO BE IGNORED  PWF
         LR    R3,R2                  UPDATE RECORD POINTER         PWF
         BNZ   SKIPREC                YES. SKIP IT.                 PWF
         CLI   10(R3),C'.'            IS THIS THE TIME STAMP        PWF
         BNE   SKIPREC                NO. GET NEXT RECORD           PWF
         CLI   13(R3),C'.'            YES. BUT ARE YOU SURE         PWF
         BNE   SKIPREC                NO. GET NEXT RECORD           PWF
         CLC   8(8,R3),=C'00.00.00'   IS THIS A DUMMY TIME STAMP?   PWF
         BE    SKIPREC                YES. GET NEXT RECORD          PWF
         MVC   FREMOTE(8),8(R3)       SAVE TIME STAMP IN DISPLAY    PWF
         B     NOHOLD1                CONTINUE W/NORMAL PROCESSING  PWF
SKIPREC  LA    R3,3(R4,R3)            INCREMENT TO NEXT RECORD      PWF
         B     NEXTREC                                              PWF
SPAN     LH    R4,2(R3)               LENGTH OF SEGMENT             PWF
         TM    1(R3),X'08'            IS THIS THE FIRST SEGMENT     PWF
         BO    SPANFRST               YES. USE HEADER LENGTH OF 6   PWF
         LA    R3,4(R4,R3)            UPDATE RECORD POSITION        PWF
         B     NEXTREC                PROCESS NEXT RECORD           PWF
SPANFRST LA    R3,6(R4,R3)            UPDATE RECORD POSITION        PWF
         B     NEXTREC                PROCESS NEXT RECORD           PWF
         EJECT
NOHOLD1  DS    0H
         BAL   R7,ANALFMT             ANALYZE THIS JOB            LBDMC
         LTR   R15,R15                WAS IT ACCEPTED?            LBDMC
         BNZ   STOP                   NO  SKIP IT                 LBDMC
         LA    R1,QDMSG               ADDR OF MESSAGE AREA
         ST    R1,QDMSGA              STORE MESSAGE ADDR
         MVC   QDMLNG,QDLNELEN        LENGTH OF DISPLAY LINE
         L     R15,=V(DISPLAY)        ADDR OF DISPLAY MODULE
         BALR  R14,R15                DISPLAY THE LINE
STOP     QSTOP
         SPACE 4
***********************************************************************
*                                                                     *
*   TAKE HEX DUMP OF JOE                                              *
*                                                                     *
***********************************************************************
HEXO     UNPK  FHEX1,0(8,R8)     UNPK FIRST PART OF JOE INTO HEX
         UNPK  FHEX2,7(8,R8)          SECOND
         UNPK  FHEX3,14(8,R8)         THIRD
         UNPK  FHEX4,21(8,R8)         FOURTH
         UNPK  FHEX5,28(5,R8)         FIFTH
         MVI   FHEXOC,C' '       CLEAR LAST BYTE
         TR    FHEXO,TABLE       CHANGE TO PRINTABLE HEX
         LA    R1,QDMSG          ADDR OF MESSAGE AREA
         ST    R1,QDMSGA         STORE MESSAGE ADDR
         MVC   QDMLNG,QDLNELEN   LENGTH OF DISPLAY LINE
         L     R15,=V(DISPLAY)   ADDR OF DISPLAY MODULE
         BALR  R14,R15           DISPLAY THE LINE
***********************************************************************
*                                                                     *
*   TAKE HEX DUMP OF JQE                                              *
*                                                                     *
***********************************************************************
HEX      UNPK  FHEX1,0(8,R9)     UNPK FIRST PART OF JOE INTO HEX
         UNPK  FHEX2,7(8,R9)          SECOND
         UNPK  FHEX3,14(8,R9)         THIRD
         UNPK  FHEX4,21(8,R9)         FOURTH
         MVC   FHEXC,QBLANK      CLEAR LAST BYTES
         TR    FHEX,TABLE        CHANGE TO PRINTABLE HEX
         B     NOHOLD            CALL DISPLAY
         EJECT
***********************************************************************
* SETDEVIC SUBROUTINE - GET DEVICE DATA (R3) POINTS TO DEVID       FCI*
***********************************************************************
SETDEVIC ST    R7,SETDHOLD        SAVE LINK ADDRESS                FCI*
         MVC   FPRINT(9),=CL9' '
         TM    0(R3),XWTRID       IS THIS AN XWTR
         BNO   NOTXWTR            NO. CONTINUE CHECKING
         MVC   FPRINT(4),=C'XWTR' YES.
         B     SETDRTN
NOTXWTR  CLC   JOEREMOT,=H'0'    REMOTE DEVICE?
         BNE   RMTDEV            YES => OUTPUT IT
         SR    R1,R1             FOR THE INSERT CHARACTER         FCI*
         IC    R1,0(R3)          DEVICE TYPE                      FCI*
         SRL   R1,4              RIGHT JUSTIFIED                  FCI*
         MH    R1,DEVTYPEL       TYPE * LENGTH OF A DEVICE ENTRY  FCI*
         LA    R1,DEVTABLE(R1)   A(DEVICE TYPE)                   FCI*
         MVC   FPRINT,1(R1)      PUT IN THE DEVICE TYPE           FCI*
         CLI   0(R3),0           INTERNAL READER?                 FCI*
         BE    SETDRTN           YES => GIVE THE USER THE INFO    FCI*
         SR    R15,R15           FOR THE INSERT CHARACTER         FCI*
         IC    R15,2(R3)         DEVICE NUMBER                    FCI*
         CVD   R15,QDWORD        IN PACKED DECIMAL                FCI*
         IC    R15,0(R1)         OFFSET TO WHERE THE DEV # GOES   FCI*
         LA    R15,FPRINT(R15)   A(WHERE THE DEV # GOES)          FCI*
         MVC   1(L'DIGITS3,R15),DIGITS3 SET UP THE EDIT OF 3 DIGITS
         EDMK  0(L'DIGITS3+1,R15),QDWORD+6      DEV # IN EBCDIC    FCI*
         MVC   0(L'DIGITS3+1,R15),0(R1)      ADJUST FOR BLANKS     FCI*
*                                                                  FCI*
         B     SETDRTN        GO EXIT
*                                                                  FCI*
RMTDEV   LH    R7,JOEREMOT      REMOTE NUMBER
         CVD   R7,QDWORD      IN PACKED DECIMAL                    FCI*
         MVI   FPRINT,C'R'    INDICATE A REMOTE DEVICE             FCI*
         MVC   FPRINT+2(L'THREEPT),THREEPT SET UP THE EDIT MASK    FCI*
         EDMK  FPRINT+1(L'THREEPT),QDWORD+6 QDWORK TO EBCDIC       FCI*
         MVC   FPRINT+1(L'THREEPT),0(R1) ADJUST FOR BLANKS         FCI*
         LA    R1,FPRINT+1    A(SPOT JUST BEFORE POSSIBLE SEP)     FCI*
FINDPT   LA    R1,1(R1)       A(NEXT BYTE)                         FCI*
         CLI   0(R1),C'.'     FOUND THE SEPARATOR?                 FCI*
         BNE   FINDPT         NO => KEEP LOOKING                   FCI*
         SR    R15,R15        FOR THE INSERT CHARACTER             FCI*
         IC    R15,0(R3)        DEVICE TYPE INDICATOR              FCI*
         SRL   R15,3          RIGHT JUSTIFIED                      FCI*
         LA    R15,RMTDEVS-HIGHBIT/8(R15) A(DEVICE TYPE)           FCI*
         MVC   1(2,R1),0(R15) PUT IN THE DEVICE TYPE               FCI*
         MVC   3(1,R1),0(R3) PUT IN THE DEVICE NUMBER              FCI*
         OI    3(R1),C'0'     MAKE THE DEVICE NUMBER PRINTABLE     FCI*
SETDRTN  L     R7,SETDHOLD    GET RETURN ADDRESS                   FCI*
         BR    R7             RETURN TO OUR CALLER                 FCI*
         EJECT
***********************************************************************
*                                                                     *
*   ANALYZE THE FORMATTED LINE TO SEE IF WE WANT TO INCLUDE IT        *
*                                                                     *
***********************************************************************
ANALFMT  DS    0H                                                 LBDMC
         LA    R1,QPARM1          ADDR 1ST PARM                   LBDMC
         LA    R0,5               5 PARM FIELDS                   LBDMC
         CLC   QCODEH,=H'56'      FO?                             LBDMC
         BE    ANALLOOP            YES, ANALYZE                   LBDMC
*        CLC   QCODEH,=H'08'      DI?                             LBDMC
*        BE    ANALLOOP            YES, ANALYZE                   LBDMC
*        CLC   QCODEH,=H'12'      DO?                             LBDMC
*        BE    ANALLOOP            YES, ANALYZE                   LBDMC
*        CLC   QCODEH,=H'16'      AI?                             LBDMC
*        BE    ANALLOOP            YES, ANALYZE                   LBDMC
*        CLC   QCODEH,=H'20'      AO?                             LBDMC
*        BE    ANALLOOP            YES, ANALYZE                   LBDMC
*        CLC   QCODEH,=H'24'      HI?                             LBDMC
*        BE    ANALLOOP            YES, ANALYZE                   LBDMC
         XR    R15,R15            CLEAR R15                       LBDMC
         BR    R7             RETURN                              LBDMC
ANALLOOP DS    0H                                                 LBDMC
         BAL   R2,ANALOPTS        CHECK OPTIONS                   LBDMC
         LTR   R15,R15            DISPLAY REJECTED?               LBDMC
         BNZ   ANALREJ            REJECT IT                       LBDMC
         LA    R1,12(R1)          POINT NEXT PARM FIELD           LBDMC
         BCT   R0,ANALLOOP        AND CHECK OPTIONS               LBDMC
         XR    R15,R15            ACCEPT DISPLAY LINE             LBDMC
ANALREJ  DS    0H                                                 LBDMC
         BR    R7             RETURN TO CALLER                    LBDMC
         SPACE 1                                                  LBDMC
ANALOPTS DS    0H                                                 LBDMC
         XR    R15,R15            DEFAULT IS OPTION OK            LBDMC
         CLI   0(R1),C' '         NO OPTION?                      LBDMC
         BER   R2                 RETURN FOR NEXT PARM OR EXIT    LBDMC
         SPACE 1                                                  LBDMC
OPTION1  DS    0H                                                 LBDMC
         CLI   0(R1),C'R'         CHECK IF REMOTE OPTION?         LBDMC
         BNE   OPTION2             NO, CHECK NEXT OPTION          LBDMC
         XR    R3,R3              CLEAR EQUALNOT EQUAL INDEX     LBDMC
         CLI   1(R1),C'^'         BRANCH ON NOT EQUAL?            LBDMC
         BNE   *+8                 NO, LEAVE BRANCH EQUAL INDEX   LBDMC
         LA    R3,8               SET BRANCH NOT EQUAL INDEX      LBDMC
         CLC   FREMOTE,2(R1)      COMPARE OPTION TO FIELD         LBDMC
         B     *+4(R3)            BRANCH ON EQUAL OR NOT EQUAL    LBDMC
         BE    ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         BNE   ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         SPACE 1                                                  LBDMC
OPTION2  DS    0H                                                 LBDMC
         CLI   0(R1),C'Q'         CHECK IF QUEUE OPTION?          LBDMC
         BNE   OPTION3             NO, CHECK NEXT OPTION          LBDMC
         XR    R3,R3              CLEAR EQUALNOT EQUAL INDEX     LBDMC
         CLI   1(R1),C'^'         BRANCH ON NOT EQUAL?            LBDMC
         BNE   *+8                 NO, LEAVE BRANCH EQUAL INDEX   LBDMC
         LA    R3,8               SET BRANCH NOT EQUAL INDEX      LBDMC
         CLC   FQUEUE,2(R1)       COMPARE OPTION TO FIELD         LBDMC
         B     *+4(R3)            BRANCH ON EQUAL OR NOT EQUAL    LBDMC
         BE    ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         BNE   ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         SPACE 1                                                  LBDMC
OPTION3  DS    0H                                                 LBDMC
         CLI   0(R1),C'F'         CHECK IF FORMS OPTION?          LBDMC
         BNE   OPTION4             NO, CHECK NEXT OPTION          LBDMC
         XR    R3,R3              CLEAR EQUALNOT EQUAL INDEX     LBDMC
         CLI   1(R1),C'^'         BRANCH ON NOT EQUAL?            LBDMC
         BNE   *+8                 NO, LEAVE BRANCH EQUAL INDEX   LBDMC
         LA    R3,8               SET BRANCH NOT EQUAL INDEX      LBDMC
         CLC   FFORM(6),2(R1)     COMPARE OPTION TO FIELD         LBDMC
         B     *+4(R3)            BRANCH ON EQUAL OR NOT EQUAL    LBDMC
         BE    ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         BNE   ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         SPACE 1                                                  LBDMC
OPTION4  DS    0H                                                 LBDMC
         CLI   0(R1),C'C'         CHECK IF FCB OPTION?            LBDMC
         BNE   ANALOK              NO, NO VALID OPTION            LBDMC
         XR    R3,R3              CLEAR EQUALNOT EQUAL INDEX     LBDMC
         CLI   1(R1),C'^'         BRANCH ON NOT EQUAL?            LBDMC
         BNE   *+8                 NO, LEAVE BRANCH EQUAL INDEX   LBDMC
         LA    R3,8               SET BRANCH NOT EQUAL INDEX      LBDMC
         CLC   FFCB,2(R1)         COMPARE OPTION TO FIELD         LBDMC
         B     *+4(R3)            BRANCH ON EQUAL OR NOT EQUAL    LBDMC
         BE    ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         BNE   ANALOK             OPTION DOES MATCH               LBDMC
         B     ANALNOK            OPTION DOES NOT MATCH           LBDMC
         SPACE 1                                                  LBDMC
ANALOK   DS    0H                                                 LBDMC
         XR    R15,R15            OPTION IS ACCEPTED              LBDMC
         BR    R2                 RETURN TO GET NEXT PARM         LBDMC
         SPACE 1                                                  LBDMC
ANALNOK  DS    0H                                                 LBDMC
         LA    R15,4              OPTION HAS BEEN REJECTED        LBDMC
         BR    R2                 RETURN TO RETURN TO FORMAT      LBDMC
         EJECT
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
MVNUMBER MVC   0(0,R15),0(R1)    TO BE EXECUTED
         LTORG
SIGNNORM EQU   11             OFFSET TO LAST DIGIT                 FCI*
*                                                                  FCI*
NORMAL   DC    X'402020202020202020202120' EDIT MASK               FCI*
RMT      DC    C'RMT'     CONSTANT FOR REMOTE PRINT                FCI*
SPC      DC    C'SPC'     CONSTANT FOR LOCAL SPECIAL ROUTING
*** DEVICE TABLES FOR LOCAL AND REMOTE DEVICES                      ***
DIGITS3  DC    X'202020'                                           FCI*
THREEPT  DC    X'2020204B'                                         FCI*
         DS    0H                                                  FCI*
DEVTABLE DC    AL1(0),CL8'INTRDR',AL1(6),CL8'READER'               FCI*
         DC    AL1(7),CL8'PRINTER',AL1(5),CL8'PUNCH'               FCI*
DEVTYPEL DC    AL2((*-DEVTABLE)/4)                                 FCI*
RMTDEVS  DC    C'**',C'RD',C'PR',C'PU'                             FCI*
*                                                                     *
ED8      DC    X'4020202020202120'
ED5      DC    X'402020202021'
ED3      DC    X'40202021'
HEADING  DC    C'  QUEUE   POS   JOBNAME     JOB#   PRIO   LINES'
         DC    CL40'  FORM     FCB ---STATUS---'
XWTRID   EQU   X'0F'
HIGHBIT  EQU   X'80'
TABLE    EQU   *-240
         DC    C'0123456789ABCDEF'     TRANSLATE TO PRINTABLE HEX
         AIF   (NOT &QSP136).NO136G
         IFGRPL DSECT=YES,AM=VTAM                                   DOR
         $BUFFER                                                    DOR
         AGO   .X136G
.NO136G  ANOP
BUFSTART EQU   0                                                    PWF
BUFDSECT EQU   0                                                    PWF
.X136G   ANOP
IOTID    EQU   0
IOTPDDB  EQU   32
         PRINT NOGEN
        $JCT
        $JQE
        $JOE
        $PDDB
        $CHK
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
         ORG   QDMSG
FCLEAR   DS    0CL132         FORMAT FOR QUEUE RECORDS
FQNAME   DS    CL6            NAME OF QUEUE
         DS    C
FQUEUE   DS    C              CLASS NAME
         DS    C
FCOUNT   DS    CL4            POSITION IN QUEUE
         DS    CL3
FNAME    DS    CL8            JOBNAME
         DS    CL2
FJOBNO   DS    CL6            JES2 JOB NUMBER
         DS    CL2
FPRIO    DS    CL4            JOB PRIORITY
         DS    C
FLINES   DS    CL8            NUMBER OF OUTPUT LINES
         DS    CL2
FFORM    DS    CL8            SYSOUT FORM NUMBER
         DS    C
FFCB     DS    CL4            SYSOUT FCB
         DS    C
FSYSID   DS    CL4            SYSTEM ID
         DS    C
FHOLD    DS    CL4            JOB HOLD STATUS
         DS    C
FREMOTE  DS    CL4            REMOTE
         ORG   FSYSID
FPRINT   DS    CL8            PRINTING
         ORG   FCOUNT
FHEX     DS    0CL56          LENGTH OF JQE HEX DUMP
FHEXO    DS    0CL64          LENGTH OF JOE HEX DUMP
FHEX1    DS    0CL15
         DS    CL14
FHEX2    DS    0CL15
         DS    CL14
FHEX3    DS    0CL15
         DS    CL14
FHEX4    DS    0CL15
         DS    CL14
FHEXC    DS    0CL9           CLEAR LAST BYTES FOR JQE
FHEX5    DS    0CL9
         DS    CL8
FHEXOC   DS    C              CLEAR LAST BYTE FOR JOE
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
SETDHOLD DS    F
JTYPE    DS    F
AJOEJQE  DS    2F
SAVJOEA  DS    A
NUMBER   DS    CL16
WORKEND  EQU   *
         END
./       ADD   NAME=FINDJOB
FINDJOB  TITLE 'QUEUE COMMAND - LOCATE JQE, JCT, AND IOT BY JOBNAME'
FINDJOB  QSTART HASPEQU=YES,       START FINDJOB CSECT ASSEMBLY   DOR XX
               XTITLE='QUEUE CMD - LOCATE JQE, JCT, AND IOT BY JOBNAME'
         GBLB   &QSP           MVS/SP OPTION                      UF020
         GBLB   &QSP133        MVS/SP 1.3.3 OPTION                UF046
         GBLB   &QSP136        MVS/SP 1.3.6 OPTION                DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING WORK,R13       LOCAL WORK AREA
         MVI   SLID#,0        CLEAR ID NUMBER                     UF035
         LH    R1,QLNG1       LENGTH OF PARAMETER FIELD
         SH    R1,=H'1'       IS THE LENGTH ZERO?
         BM    TILTJID        YES. TILT.
******************************************************************UF007
*                                                                 UF007
*   ALLOW JOBNAME = "*" TO SIGNIFY CURRENT JOB & SKIP CKPT READ   UF007
*                                                                 UF007
******************************************************************UF007
         CLI   QPARM1,C'-'    DEFAULT JOBID AS CURRENT        @DOR
         BE    TILTJID                                        @DOR
         CLI   QPARM1,C'*'    WANT CURRENT JOB AGAIN?             UF007
         BE    JOBAGAIN       YES, SKIP CKPT READ                 UF007
******************************************************************UF006
*                                                                 UF006
*   CALL - READ JES2 CHECKPOINT ROUTINE                           UF006
*                                                                 UF006
******************************************************************UF006
CALLCKPT L     R15,=V(CKPT)   ADDR OF CKPT ROUTINE                UF006
         BALR  R14,R15        GO TO IT                            UF006
         MVI   SLID#,0        CLEAR ID NUMBER                     UF035
******************************************************************UF035
*                                                                 UF035
*        SPECIAL PROCESSING IF THE COMMAND WAS SYSLOG.            UF035
*                                                                 UF035
******************************************************************UF035
*        CLC   =C'SL',QSUBNAME SYSLOG COMMAND?                    UF035
         CLC   QSUBNAME(2),=CL2'SL'  SYSLOG COMMAND? DOR
         BNE   SLZ            NO, BACK TO NORMAL PROCESSING       UF035
         ICM   R1,3,QLNG1     WAS A PARAMETER SPECIFIED?          UF035
         BZ    SLTHIS         NO, WANT THIS SYSTEMS SYSLOG        UF035
         CLI   QPARM1,C'0'    NUMERIC JOB NUMBER?                 UF035
         BNL   SLZ            YES, MUST BE THE NUMBER - DO NORMAL UF035
         CLC   QPARM1,=CL8'SYSLOG' WANT THIS SYSTEMS SYSLOG?      UF035
         BE    SLTHIS         YES, DO IT                          UF035
SLIDPRE  LA    R1,QSYSID      POINT TO SYSID TABLE                UF035
         LR    R14,R1         POINT TO SYSID TABLE                UF035
         LA    R15,7          MAX NUMBER OF SYSTEMS               UF035
SLTESTID LA    R1,8(,R1)      BUMP TO NEXT ENTRY                  UF035
         CLC   QPARM1(4),0(R1) DOES PARM MATCH SYSTEM ID?         UF035
         BE    SLGOTID        YES, GET OUT OF LOOP                UF035
         BCT   R15,SLTESTID   LOOP FOR ALL ID'S                   UF035
         B     SLZ            NOT FOUND - DO NORMAL PROCESSING    UF035
SLGOTID  SR    R1,R14         OFFSET TO ENTRY                     UF035
         SRL   R1,3           DIVIDE BY 8                         UF035
         STC   R1,SLID#       SAVE FOR LATER TEST                 UF035
         MVC   QPARM1,=CL8'SYSLOG' SET JOBNAME TO MATCH ON        UF035
         MVI   QLNG1+L'QLNG1-1,8   SET LENGTH OF NAME             UF035
         B     SLZ            DONE FOR NOW                        UF035
SLTHIS   DS    0H             NEED TO RETURN THIS SYSTEMS SYSLOG  UF035
         L     R1,16          POINT TO CVT                        UF035
         ICM   R1,15,CVTSMCA-CVTMAP(R1) POINT TO SMF CONTROL AREA UF035
         BZ    SLZ            NONE, DO NORMAL PROCESSING          UF035
         MVC   QPARM1(4),SMCASID-SMCABASE(R1)  MOVE SID TO AREA   UF035
         B     SLIDPRE        AND GO TO COMMON CODE               UF035
SLZ      DS    0H                                                 UF035
***********************************************************************
*                                                                     *
*   DETERMINE IF SEARCH IS BY JOBNUMBER OR JOBNAME                    *
*                                                                     *
***********************************************************************
         LH    R1,QLNG1       LENGTH OF PARAMETER FIELD
         SH    R1,=H'1'       IS THE LENGTH ZERO?
         BM    TILTJID        YES. CHECK CURRENT JOBNAME      @DOR
         CLI   QPARM1,C'-'    DEFAULT JOBID AS CURRENT        @DOR
         BE    TILTJID                                        @DOR
         CLI   QPARM1,C'0'    IS THE FIRST CHARACTER NUMERIC?
         BL    JOBNAME        NO. SEARCH BY JOBNAME
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R1,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. TILT.
         EX    R1,PACK        PACK THE FIELD
         CVB   R5,CONVERT     CONVERT TO BINARY
***********************************************************************
*                                                                     *
*   LOCATE JQE BY JOBNAME                                             *
*                                                                     *
***********************************************************************
JOBNAME  L     R2,QCJQHEAD    LOAD ADDR OF JQT
         USING JQTDSECT,R2    BASE REG FOR JQT
         LA    R2,JQTOUT      FIRST JQE QUEUE
         LA    R1,JQTQMAX     MAXIMUM NUMBER OF QUEUES
         DROP  R2
         AIF   (&QSP).QSP1                                        UF020
NEXTJQT  LH    R3,0(R2)       OFFSET TO FIRST JQE IN QUEUE
NEXTJQE  SLA   R3,2           MULTIPLY BY 4
         AGO   .QSP2                                              UF020
.QSP1    ANOP                                                     UF020
NEXTJQT  L     R3,0(R2)       OFFSET TO FIRST JQE IN QUEUE        UF020
NEXTJQE  N     R3,=A(X'00FFFFFF')  TEST FOR END OF CHAIN          UF020
.QSP2    ANOP                                                     UF020
         BZ    ENDJQE         END OF QUEUE
         A     R3,QCJQTA      ADD BASE TO OFFSET
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JQE,R3         BASE REG FOR JQE                      DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JQEDSECT,R3    BASE REG FOR JQE
.X136A   ANOP                                                       DOR
         CLI   QPARM1,C'0'    IS SEARCH BY JOBNUMBER?
         BL    CLCNAME        NO. SEARCH BY JOBNAME.
         CH    R5,JQEJOBNO    IS THIS THE RIGHT JOBNUMBER?
         BNE   NOMATCH        NO. TRY NEXT JQE.
         B     FOUND          YES. PROCESS IT.
CLCNAME  CLC   QPARM1,JQEJNAME IS THIS THE RIGHT JOBNAME?
         BE    FOUND          YES. PROCESS IT.
         AIF   (&QSP).QSP3                                        UF020
NOMATCH  LH    R3,JQECHAIN    NO. TRY NEXT ENTRY.
         B     NEXTJQE        LOOP
ENDJQE   LA    R2,2(R2)       TRY NEXT QUEUE
         AGO   .QSP4                                              UF020
.QSP3    ANOP                                                     UF020
NOMATCH  L     R3,JQENEXT     NO. TRY NEXT ENTRY.                 UF020
         B     NEXTJQE        LOOP                                UF020
ENDJQE   LA    R2,4(R2)       TRY NEXT QUEUE                      UF020
.QSP4    ANOP                                                     UF020
         BCT   R1,NEXTJQT     LOOP IF NOT LAST QUEUE
TILT     QTILT '*** JOBNAME NOT FOUND OR INVALID ***'
         SPACE 1                                                  UF007
JOBAGAIN L     R3,QCJQEA      PRIME JQE ADDRESS                   UF007
         LTR   R3,R3          ANYONE HOME?                        UF034
         BNZ   FOUND          YES, CONTINUE                       UF034
         QTILT '*** YOU MUST SPECIFY A JOBNAME OR NUMBER BEFORE USING "+
               *" ***'                                            UF034
         SPACE 1                                                  ONL03
FOUND    ST    R3,QCJQEA      SAVE THE ADDRESS
         CLI   SLID#,0        LOOKING FOR A SPECIFIC SYSLOG?      UF035
         BE    FOUND1         NO, CONTINUE                        UF035
         IC    R14,SLID#      GET DESIRED ID                      UF035
         AIF   (NOT &QSP136).NO136B                                 DOR
         IC    R15,JQEFLAG1   GET SYSTEM ID OF THIS JOB             DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         IC    R15,JQEFLAGS   GET SYSTEM ID OF THIS JOB           UF035
.X136B   ANOP                                                       DOR
         N     R14,=A(X'0000000F') MASK OFF EXTRA STUFF           UF035
         N     R15,=A(X'0000000F') MASK OFF EXTRA STUFF           UF035
         CR    R14,R15        SEE IF IT IS THE ONE WE WANTED      UF035
         BNE   NOMATCH        NOPE, TRY AGAIN                     UF035
FOUND1   DS    0H                                                 UF035
         LR    R4,R3          SAVE THE ADDRESS FOR COMPARE        RNB22
         SPACE 2                                                  ONL03
******************************************************************ONL03
*                                                                 ONL03
*   READ THE JCT                                                  ONL03
*                                                                 ONL03
******************************************************************ONL03
         SPACE 1                                                  ONL03
         OC    JQETRAK,JQETRAK     IS THERE AN ADDRESS            UF046
         BNZ   JCTOK               YES, CONTINUE                  UF046
         CLC   =C'JQE',QSUBNAME    IS IT JQE COMMAND?             UF046
         BE    STOP                YES, ALLOW TO CONTINUE         UF046
         B     TILT                NO, ABORT                      UF046
JCTOK    DS    0H                                                 UF046
         MVC   QCTRAK,JQETRAK DISK ADDR OF JCT
         L     R1,QCJCTA           ADDRESS OF JCT                 UF046
         AIF   (NOT &QSP136).NO136C                                 DOR
         AL    R1,=A(JCTSTART-JCT)       ADJUST FOR BUFFER PREFIX   DOR
         AGO   .X136C                                               DOR
.NO136C  ANOP                                                       DOR
         AL    R1,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
.X136C   ANOP                                                       DOR
         XC    0(4,R1),0(R1)       CLEAR START OF AREA            UF046
         NI    QFLAG1,255-QFLG1SDS CLEAR THE SYSTEM DS JOB FLAG   ONL14
         SPACE 1                                                  ONL14
         AIF   (NOT &QSP133).C29A                                 UF046
         AIF   (NOT &QSP136).NO136D                                 DOR
         TM    JQEFLAG3,JQE3SYSD   JQETRAK POINT TO IOT?            DOR
         AGO   .X136D                                               DOR
.NO136D  ANOP                                                       DOR
         TM    JQEFLAG3,QUESYSDS   JQETRAK POINT TO IOT?          UF046
.X136D   ANOP                                                       DOR
         BNO   READJCT             NO, GO READ JCT                   CL
         SPACE 1                                                  ONL14
         OI    QFLAG1,QFLG1SDS     SHOW IT'S A SYSTEM DS JOB      ONL14
         SPACE 1                                                  ONL14
         MVC   QPJOBID(2),=C'RM'   SET                               CL
         MVC   QPJOBID+2(2),JQEJOBNO JOB KEY                         CL
         B     CKAUTH              SKIP JCT READ                  ONL02
.C29A    ANOP  ,                                                  UF046
         DROP  R3
READJCT  L     R3,QCJCTA      ADDR OF IOAREA FOR JCT                 CL
         LR    R1,R3          PARM FOR READSPC
         AIF   (NOT &QSP136).NO136E                                 DOR
         AL    R1,=A(JCTSTART-JCT)       ADJUST FOR BUFFER PREFIX   DOR
         L     R15,=V(READSPC) ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         USING JCT,R3         BASE REG FOR JCT                      DOR
         USING JQE,R4         BASE FOR JQE                          DOR
         AGO   .X136E                                               DOR
.NO136E  ANOP                                                       DOR
         AL    R1,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
         L     R15,=V(READSPC) ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         USING JCTDSECT,R3    BASE REG FOR JCT                    ONL16
         USING JQEDSECT,R4    BASE FOR JQE                        RNB22
.X136E   ANOP                                                       DOR
         SPACE 2                                                  ONL03
******************************************************************ONL03
*                                                                 ONL03
*   ENSURE THAT THE CORRECT JCT WAS READ                          ONL03
*                                                                 ONL03
******************************************************************ONL03
         SPACE 1                                                  ONL03
         CLC   JCTID,=CL4'JCT'     DID WE READ A JCT ?            ONL03
         BNE   BADJCT              TILT IF NO                     ONL03
         CLC   JCTJNAME,JQEJNAME   DOES JOBNAME MATCH ?           ONL03
         BNE   BADJCT              TILT IF NO                     ONL03
         SPACE 1                                                  ONL03
         LA    R1,JQE              ADDR OF JQE                    ONL03
         SL    R1,QCJQTA           COMPUTE THE JQE OFFSET         ONL03
         CL    R1,JCTJQE           DOES OFFSET MATCH THE JCT'S ?  ONL03
         BNE   BADJCT              TILT IF NO                     ONL03
         SPACE 1                                                  ONL03
         CLI   QPARM1,C'*'         WAS CURRENT JOB REQUESTED ?    ONL03
         BNE   NEWJOB              SKIP IF NO                     ONL03
         CLC   QPJOBID,JCTJBKEY    DOES JOB KEY MATCH ?           ONL03
         BE    VALIDJCT            SKIP IF YES                    ONL03
         SPACE 1                                                  ONL03
BADJCT   QTILT '*** JOB HAS PURGED (OR JCT IS INVALID) ***'       ONL03
         SPACE 1                                                  ONL03
NEWJOB   DS    0H                  A NEW JOB WAS REQUESTED        ONL03
         MVC   QPJOBID,JCTJBKEY    SAVE JOB KEY FOR FUTURE CHECKS ONL03
         XC    QPDSID,QPDSID       CLEAR DATASET ID               ONL03
         XC    QOLDDSID,QOLDDSID   CLEAR PREVIOUS DSID            ONL04
         SPACE 1                                                  ONL03
VALIDJCT DS    0H                  THE CORRECT JCT WAS READ       ONL03
         SPACE 2                                                  ONL03
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
CKAUTH   DS    0H                  SEE IF USER MAY LOOK AT JOB    ONL02
         QAUTHCK QAFINDJ           PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL03
*                                                                 ONL03
*   READ JOB'S ALLOCATION IOT                                     ONL03
*                                                                 ONL03
*    NOTE:  QUEUE SUB-COMMANDS MUST VALIDATE THIS IOT BEFORE USE. ONL03
*                                                                 ONL03
******************************************************************ONL03
         SPACE 1                                                  ONL03
         AIF   (&QSP133).ONL1                                     ONL03
         MVC   QCTRAK,JCTIOT       GET MTTR FOR IOT               ONL03
         SPACE 1                                                  ONL03
         AGO   .ONL2                                              ONL03
.ONL1    ANOP  ,                                                  ONL03
         TM    QFLAG1,QFLG1SDS     IS THIS A SYSTEM DS JOB?       ONL03
         BO    GOTMTTR             SKIP IF YES                    ONL03
         MVC   QCTRAK,JCTIOT       GET MTTR FOR IOT               ONL03
GOTMTTR  DS    0H                                                 ONL03
         SPACE 1                                                  ONL03
.ONL2    ANOP  ,                                                  ONL03
         DROP  R3                  KILL JCT ADDRESSABILITY        ONL03
         SPACE 1                                                  ONL03
         L     R1,QCIOTA      ADDR OF IOAREA FOR IOT
         L     R15,=V(READSPC) ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL03
******************************************************************ONL03
*                                                                 ONL03
*   RETURN TO CALLER                                              ONL03
*                                                                 ONL03
******************************************************************ONL03
         SPACE 1                                                  ONL03
STOP     QSTOP
***********************************************************************
*                                                                     *
*   DEFAULT JOB ID OR NAME FOR REPEAT SUBCOMMAND BY DOR/CDSI          *
*                                                                     *
***********************************************************************
TILTJID  EQU   *                                          @DOR
         L     R3,QCJQEA     CURRENT JOB ID #             @DOR
         LTR   R3,R3                                      @DOR
         BNZ   FOUND         MUST BE NON ZERO VALUE       @DOR
         B     TILT                                       @DOR
         SPACE 2                                                  ONL03
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL03
MVZ      MVZ   QFZONES(1),QPARM1 CHECK FOR NUMERIC
PACK     PACK  CONVERT,QPARM1(1) CONVERT TO BINARY
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
FINDJOB  CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136F                                 DOR
         IFGRPL DSECT=YES,AM=VTAM                                   DOR
         AGO   .X136F                                               DOR
.NO136F  ANOP                                                       DOR
JCT      EQU   0
.X136F   ANOP                                                       DOR
        $BUFFER ,                                                 ONL16
         $JQE
         $JCT
         AIF   (NOT &QSP133).C29A2                                UF046
TABLNGTH EQU   0                                                  UF046
         $IOT  ,                                                  UF046
.C29A2   ANOP  ,                                                  UF046
         $JQT
         CVT   DSECT=YES                                          UF035
         IEESMCA ,                                                UF035
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
WORK     DSECT
         DS    72C
CONVERT  DS    D
SLID#    DS    X                   SYSTEM ID OF DESIRED SYSLOG    UF035
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=FINDPDDB
FINDPDDB TITLE 'QUEUE COMMAND - FIND PDDB FOR A DSID'             ONL01
FINDPDDB QSTART HASPEQU=YES,       START FINDPDDB CSECT ASSEMBLY  DOR XX
               XTITLE='QUEUE COMMAND - FIND PDDB FOR A DSID'
         GBLB  &QSP133                                            UF046
         GBLB  &QSP136            SP 1.3.6 OPTION FLAG            DOR
         USING QCKPT,R10          BASE REG FOR CHECKPONT WORK AREA
         L     R10,QVCKPT         LOAD BASE REG
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13           BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   CONVERT DATASET ID TO BINARY                                      *
*                                                                     *
***********************************************************************
         XC    CONVERT,CONVERT       CLEAR CONVERT WORK AREA
         PACK  CONVERT+5(3),DSID+1(3) PACK ASID
         CVB   R7,CONVERT         CONVERT DSID TO BINARY
***********************************************************************
*                                                                     *
*   FIND  PDDB  FOR  THIS  DATASET  ID                                *
*                                                                     *
***********************************************************************
NORMAL   MVI   SWITCH,0           INITIALIZE SWITCH
         AIF   (NOT &QSP136).NO136A                                DOR
         USING PDB,R2             BASE REG FOR PDDB                DOR
         USING IOT,R3             BASE REG FOR IOT                 DOR
         L     R5,QCIOTA          I/O AREA FOR READ IOT BLOCK     UF046
         L     R1,QCJCTA          ADDR OF JCT                     UF008
         USING JCT,R1             SET TEMP ADDRESSING               DOR
         CLC   QCTRAK,JCTIOT      AT FIRST IOT?                   UF008
         BNE   *+8                NO, SKIP FLAG SET               UF008
         OI    SWITCH,X'02'       SET FLAG                        UF008
         DROP  R1                 DROP TEMP ADDRESSING            UF008
         LR    R3,R5              IOTSTART AREA                   UF046
         SH    R3,=AL2(IOTSTART-IOT)  ADJUST FOR PROPER STRT        DOR
         AGO   .X136A                                              DOR
.NO136A  ANOP                                                      DOR
         USING PDBDSECT,R2        BASE REG FOR PDDB
         USING IOTDSECT,R3        BASE REG FOR IOT                UF046
         L     R5,QCIOTA          I/O AREA FOR READ IOT BLOCK     UF046
         L     R1,QCJCTA          ADDR OF JCT                     UF008
         USING JCTDSECT,R1        SET TEMP ADDRESSING             ONL16
         CLC   QCTRAK,JCTIOT      AT FIRST IOT?                   UF008
         BNE   *+8                NO, SKIP FLAG SET               UF008
         OI    SWITCH,X'02'       SET FLAG                        UF008
         DROP  R1                 DROP TEMP ADDRESSING            UF008
         LR    R3,R5              IOTSTART AREA                   UF046
         SH    R3,=AL2(IOTSTART-IOTDSECT)  ADJUST FOR PROPER STRT UF046
.X136A   ANOP                                                      DOR
         SPACE 1                                                  UF046
NEXTIOT  LR    R4,R3              BASE OF IOT
         CLC   IOTID,=CL4'IOT'    WAS AN IOT READ FROM SPOOL ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         CLC   QPJOBID,IOTJBKEY   IS THE IOT'S JOB KEY VALID ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         LR    R2,R3              BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB          OFFSET TO FIRST PDDB IN IOT    UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1         OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
FINDDS   CH    R7,PDBDSKEY        IS THIS THE DATASET?
         BE    FOUNDDS            YES. CONTINUE
         LA    R2,PDBLENG(R2)     NO. LOOK AT NEXT PDDB
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB
         BL    FINDDS             NO. TRY AGAIN
         L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    SPINIOT            NO. TRY THE SPIN IOT.
         BAL   R8,READ            READ THE IOT
         B     NEXTIOT            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136B                                DOR
         USING JCT,R1             BASE REG FOR JCT                 DOR
         AGO   .X136B                                              DOR
.NO136B  ANOP                                                      DOR
         USING JCTDSECT,R1        BASE REG FOR JCT                ONL16
.X136B   ANOP                                                      DOR
SPINIOT  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY
         BO    CKIOT1             YES, SEE IF WE STARTED AT FRONT UF008
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         DROP  R1
         B     SPIN               SEARCH THE SPIN IOT CHAIN
FOUNDDS  L     R0,PDBRECCT        GET THE RECORD COUNT
         CVD   R0,CONVERT         CONVERT TO DECIMAL
         MVC   DSRECCT,ED8        MOVE EDIT PATTERN TO DISPLAY
         ED    DSRECCT,CONVERT+4  EDIT THE RECORD COUNT
         MVC   DSCLASS,PDBCLASS   MOVE PDBCLASS TO DISPLAY
STOP     QSTOP                    GO BACK TO CALLER
CKIOT1   TM    SWITCH,X'02'       DID WE START AT FIRST IOT?      UF008
         BO    STOP               YES, NOT FOUND                  UF008
         AIF   (NOT &QSP136).NO136C                                DOR
         USING JCT,R1             BASE REG FOR JCT                 DOR
         AGO   .X136C                                              DOR
.NO136C  ANOP                                                      DOR
         USING JCTDSECT,R1        BASE REG FOR JCT                ONL16
.X136C   ANOP                                                      DOR
         L     R1,QCJCTA          POINT TO JCT                    UF008
         L     R4,JCTIOT          FIRST IOT ADDRESS               UF008
         DROP  R1                 DROP TEMP ADDRESSING            UF008
         BAL   R8,READ            READ THE IOT                    UF008
         OI    SWITCH,X'02'       SET STARTED AT FRONT            UF008
         B     NEXTIOT            AND TRY AGAIN                   UF008
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK          STORE DISK ADDR
         LR    R1,R5              IOAREA ADDRESS
         L     R15,=V(READSPC)    ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15            GO TO IT
         BR    R8                 RETURN TO CALLER
         SPACE 3                                                  ONL03
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
         SPACE 2                                                  ONL03
ED8      DC    X'4020202020202120'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
FINDPDDB CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136D                                DOR
         IFGRPL DSECT=YES,AM=VTAM                                  DOR
         AGO   .X136D                                              DOR
.NO136D  ANOP                                                      DOR
JCT      EQU   0
.X136D   ANOP                                                      DOR
         $BUFFER ,                                                UF046
         $TAB
         $JCT
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    CL24
DSID     DS    CL4
         DS    CL4
DSRECCT  DS    CL8
         DS    CL4
DSCLASS  DS    CL1
WORK     DSECT
         DS    CL72
SWITCH   DS    C
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=FORMAT
FORMAT   TITLE 'QUEUE COMMAND - JQE AND JOE FORMAT ROUTINES'      ONL01
FORMAT   QSTART HASPEQU=YES,       START FORMAT CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - JQE AND JOE FORMAT ROUTINES'
***********************************************************************
* RNB CHANGES:                                                        *
*      (1) RNB17 - WHEN FORMATTING JOES, CHECK FOR JOE ON PSO AND     *
*                  INDICATE 'EXT-WTR' IF SO. ALSO, DON'T INDICATE ON  *
*                  ON PRINT/PUNCH UNLESS SHOWS ACTIVE IN JOEFLAGS.    *
*                  ALSO, FIX BUG IN GETTING TO CHECKPOINT JOE FOR     *
*                  RECORDS LEFT, AND FIX RECORDS LEFT FOR SP2.        *
*                  ALSO, IF JOE NOT BUSY, BUT CHKPT JOE VALID, PRINT  *
*                  NUMBER OF RECORDS LEFT, NOT TOTAL RECORDS.         *
*                  08 OCT 82 - FIX FOR REMOTE LINECNT NOT DECREMENTING*
*      (2) RNB18 - DISTINGUISH BETWEEN JOES WITH REMOTE ROUTING AND   *
*                  THOSE WITH SPECIAL LOCAL ROUTING (DEFINED BY DESTID*
*                  STATEMENTS WITH DEST=UNNN).                        *
*      (3) RNB19 - WHEN LISTING JQE'S, DON'T ASSUME INPUT QUEUE, BUT  *
*                  USE THE JQETYPE INSTEAD. ALSO, SPECIALLY HANDLE    *
*                  CONVERSION AND DUMP QUEUES, AND AWAITING OUTPUT.   *
*      (4) RNB20 - WHEN LISTING THINGS, DISTINGUISH BETWEEN NORMAL    *
*                  HOLD, HOLD ALL, AND DUPLICATE HOLD. ALSO, FOR      *
*                  JOES, INDICATE SELECT=NO IF APPLICABLE.            *
*      (5) RNB21 - FIX SETDEVIC SUBROUTINE FOR SP2.                   *
*      (6) RNB25 - ALLOW 'COUNT' PARM TO HO TO INDICATE TOTAL LINE    *
*                  COUNT DESIRED FOR JOBS ON HELD OUTPUT QUEUE        *
*      (7) RNB28 - FIX FOR REMOTE PRINTER LINECOUNTS.                 *
***********************************************************************
         GBLB  &QSP           MVS/SP OPTION                       UF020
         GBLB  &QSP133             SP 1.3.3 OPTION                UF046
         GBLB  &QSP136             SP 1.3.6 OPTION  FLAG          DOR
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL     LOAD BASE REG
         AIF   (NOT &QSP136).NO136A
         USING JQE,R9         BASE REG FOR JQE DSECT                DOR
         USING JOE,R8         BASE REG FOR JOE DSECT                DOR
         AGO   .X136A
.NO136A  ANOP
         USING JQEDSECT,R9    BASE REG FOR JQE DSECT
         USING JOEDSECT,R8    BASE REG FOR JOE DSECT
.X136A   ANOP
         USING WORK,R13       BASE FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   INPUT TO THIS MODULE -                                            *
*     R1 = 0 INDICATES PRINT JQE                                      *
*     R1 = 4 INDICATES PRINT JOE                                      *
*     R9 CONTAINS JQE ADDRESS                                         *
*     R8 CONTAINS JOE ADDRESS                                         *
*                                                                     *
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         MVC   FCLEAR,=CL80' ' CLEAR THE PRINT AREA
         MVC   FQUEUE,QCLASS  CLASS NAME
         MVC   QDHLINE,HEADING REPORT HEADING
         CLI   QSUBNAME,C'X'  IS THE REQUEST FOR A HEX DUMP?
         BE    NOTBUSY        YES. SKIP.
*        CLC   =X'01000100',JQEPRTRT IS THE PRINT/PUNCH FOR LOCAL?
*        BE    LOCAL          YES. SKIP THIS ROUTINE.
*        MVC   FREMOTE,=C'RJE' INDICATE THIS JOB IS REMOTE
         AIF   (NOT &QSP136).NO136B
         TM    JQEFLAG1,JQE1BUSY IS THE JOB EXECUTING?             DOR
         BZ    NOTBUSY        NO. SKIP THIS ROUTINE.               DOR
         IC    R15,JQEFLAG1   GET SYSTEM NUMBER                    DOR
         AGO   .X136B
.NO136B  ANOP
         TM    JQEFLAGS,QUEBUSY IS THE JOB EXECUTING?
         BZ    NOTBUSY        NO. SKIP THIS ROUTINE.
         IC    R15,JQEFLAGS   GET SYSTEM NUMBER
.X136B   ANOP
         N     R15,=F'7'      ZERO OUT UNWANTED BITS
         SLL   R15,3          MULTIPLY BY 8
         LA    R15,QSYSID(R15) OBTAIN SYSTEM ID
         MVC   FSYSID,0(R15)  MOVE SYSTEM ID TO DISPLAY
NOTBUSY  CLI   QCLASS,24           SKIP SERVICE ROUTINE           CL005
         BH    CHEKJQE              IF UNDEFINED                  CL005
         SR    R15,R15             COMPUTE BRANCH INDEX           CL005
         IC    R15,QCLASS          QUEUE TYPE                     CL005
         B     *+4(R15)            BR BASED ON QUEUE TYPE         CL005
         B     LISTTSO             0  TSO QUEUE                   CL005
         B     LISTSTC             4  STC QUEUE                   CL005
         B     LISTHO              8  HELD OUTPUT QUEUE           CL005
         AIF   (&QSP).CL005A       SKIP IF SP SYSTEM              CL005
         B     CHEKJQE             12 DUMP QUEUE                  CL005
         B     CHEKJQE             16 CONVERSION QUEUE            CL005
         B     CHEKJQE             20 AWAITING OUTPUT QUEUE       CL005
         AGO   .CL005B                                            CL005
.CL005A  B     LISTDM              12 DUMP QUEUE                  CL005
         B     LISTCN              16 CONVERSION QUEUE            CL005
         B     LISTAOUT            20 AWAITING OUTPUT QUEUE       CL005
.CL005B  B     LISTSTUP            24 AWAITING SETUP QUEUE        CL005
CHEKJQE  LTR   R1,R1          IS REQUEST FOR JQE OR JOE?          CL005
         BZ    LISTJQE        JQE.
***********************************************************************
*                                                                     *
*   FORMAT JOE                                                        *
*                                                                     *
***********************************************************************
LISTJOE  MVC   FQNAME,=C'OUTPUT' MOVE IN NAME OF QUEUE
         CLI   QSUBNAME,C'X'  IS THE REQUEST FOR A HEX DUMP?
         BE    HEXO           YES. DO IT.
         AIF   (NOT &QSP).RNB20A                                  RNB20
         AIF   (NOT &QSP136).NO136C                               DOR
         TM    JOEFLAG2,JOE2SLEC   IS THIS JOE SELECTABLE?        DOR
         AGO   .X136C                                             DOR
.NO136C  ANOP                                                     DOR
         TM    JOEFLAG2,$JOESLEC   IS THIS JOE SELECTABLE?        RNB20
.X136C   ANOP                                                     DOR
         BZ    LSTJOEAA            /YES - DON'T FLAG IT           RNB20
         MVC   FHOLD,=C' S=N'      /NO  - SAY SO                  RNB20
LSTJOEAA EQU   *                                                  RNB20
.RNB20A  ANOP                                                     RNB20
         L     R0,JOERECCT    NUMBER OF PRINT LINES
         CVD   R0,CONVERT     CONVERT TO DECIMAL
         MVC   FLINES,ED8     PREPARE FOR EDIT
         ED    FLINES,CONVERT+4 EDIT NUMBER OF LINES
         AIF   (NOT &QSP136).NO136D                               DOR
         TM    JOEFLAG1,JOE1BUSY  IS JOE ACTIVE?                  DOR
         AGO   .X136D                                             DOR
.NO136D  ANOP                                                     DOR
         TM    JOEFLAG,$JOEBUSY  IS JOE ACTIVE?                   RNB17
.X136D   ANOP                                                     DOR
         BZ    LSTJOE$$          /NO  - DON'T SET DEVICE ID       RNB17
*                                /YES -                           RNB17
         CLI   JOEDEVID,X'0F'    IS JOB ON PSO (EXTERNAL WRITER)? RNB17
         BNE   LSTJOE$           /NO  - GO DO REAL DEVICE         RNB17
         MVC   FPRINT,=CL8'EXT-WTR'  /YES - SAY SO                RNB17
         B     LSTJOE$$                                           RNB17
         AIF   (&QSP).RNB17A                                      RNB17
         AIF   (NOT &QSP136).NO136E                               DOR
LSTJOE$  TM    JOEFLAG1,JOE1PRT+JOE1PUN  JOB PRINTING OR PUNCHING?DOR
         AGO   .X136E                                             DOR
.NO136E  ANOP                                                     DOR
LSTJOE$  TM    JOEFLAG,$JOEPRT+$JOEPUN  JOB PRINTING OR PUNCHING? RNB17
.X136E   ANOP                                                     DOR
         BZ    LOCAL                     /NO  - SKIP DEVICE ID    RNB17
         AGO   .RNB17B                                            RNB17
.RNB17A  ANOP                                                     RNB17
LSTJOE$  TM    JOEDEVID,X'40'           JOB ON NJE DEVICE?        RNB17
         BO    LOCAL                     /YES - SKIP DEVICE ID    RNB17
.RNB17B  ANOP                                                     RNB17
         LA    R3,JOEDEVID    A(OUTPUT DEVICE DESCRIPTOR            FCI
         BAL   R7,SETDEVIC    SET THE OUTPUT DEVICE                 FCI
LSTJOE$$ EQU   *                                                  RNB17
         BZ    LOCAL            IF NOT, GO DO LOCAL STUFF         RNB17
         B     LIST             IF YES, SKIP LOCAL STUFF, GO LIST RNB17
LSTJOE## EQU   *                                                  RNB17
         L     R0,JOERECCT    RESTORE R0 FOR REMOTES              RNB28
         LR    R3,R8            SAVE WORK JOE ADDRESS             RNB17
         AIF   (NOT &QSP133).NOT133                               UF046
         B     LIST                NO CKPT FOR NOW                UF046
         AGO   .QSP02B             SKIP CKPT CODE                 UF046
.NOT133  ANOP  ,                                                  UF046
         AIF   (&QSP).QSP01                                       UF020
         LH    R8,JOECKPT     OFFSET TO CHECKPOINT JOE
         SLA   R8,2           MULTIPLY BY 4
         AGO   .QSP02                                             UF020
.QSP01   ANOP                                                     UF020
         LA    R8,0(,R8)      CLEAR HIGH BYTE FOR ICM             RNB17
         ICM   R8,B'0111',JOECKPTB OFFSET TO CKPT JOE             UF020
.QSP02   ANOP                                                     UF020
         BZ    LIST           CHECKPOINT DOES NOT EXIST. SKIP.
         USING QCKPT,R1       BASE REG FOR CKPT WORK AREA
         L     R1,QVCKPT      LOAD BASE REG
         A     R8,QCJOTA      ADD BASE TO OFFSET
         DROP  R1
         AIF   (&QSP).QSP02A                                      RNB17
         S     R0,JOETLNC     SUBTRACT RECORDS PRINTED FROM TOTAL
         AGO   .QSP02B                                            RNB17
.QSP02A  ANOP
         SL    R0,JOECRECN    SUBTRACT RECORDS PRINTED FROM TOTAL RNB17
.QSP02B  ANOP
         LR    R8,R3          BACK TO WORK JOE                    RNB17
         CVD   R0,CONVERT     CONVERT TO DECIMAL
         MVC   FLINES,ED8     PREPARE FOR EDIT
         ED    FLINES,CONVERT+4 PRINT UPDATED LINE COUNT
         AIF   (NOT &QSP136).NO136G                               DOR
         TM    JOEFLAG1,JOE1BUSY IS JOE ACTIVE?                   DOR
         AGO   .X136G                                             DOR
.NO136G  ANOP                                                     DOR
         TM    JOEFLAG,$JOEBUSY IS JOE ACTIVE?                    RNB17
.X136G   ANOP                                                     DOR
         BNZ   LIST                  /YES - GO LIST IT            RNB17
         MVC   FLINES+9(4),=C'LEFT'  /NO  - SHOW IT'S LINES LEFT  RNB17
*                                    AND FORMAT ROUTING INFO      RNB17
LOCAL    DS    0H                                                 UF047
         SR    R1,R1               CLEAR REG                      UF047
         ICM   R1,B'0111',JOECHARB OFFSET TO CHAR JOE             UF047
         BZ    LOCAL1              NONE, SKIP THIS                UF047
         A     R1,QCJOTA           GET JOE ADDRESS                UF047
         PUSH  USING                                              UF047
         DROP  R8                  DROP OLD JOE ADDRESSING        UF047
         AIF   (NOT &QSP136).NO136H                               DOR
         USING JOE,R1              TEMP USING                     DOR
         AGO   .X136H                                             DOR
.NO136H  ANOP                                                     DOR
         USING JOEDSECT,R1         TEMP USING                     UF047
.X136H   ANOP                                                     DOR
         TM    JOEWTRID,X'FF'-X'40'  WAS THERE A WTRID?           UF047
         BZ    LOCAL1              NO, SKIP                       UF047
         MVC   FLINES+10(3),=C' W='  SET PREFIX                   UF047
         MVC   FLINES+13(8),JOEWTRID SET WRITER ID                UF047
         POP   USING                                              UF047
LOCAL1   DS    0H                                                 UF047
         LA    R15,FREMOTE    ADDRESS TO PUT TEXT
         LA    R1,JOEROUT     POINT TO ROUTING INFO                FCI*
***********************************************************************
*RMTORLCL SUBROUTINE - DETERMINE REMOTE OR LOCAL DESTINATION       FCI*
* R1 POINTS TO PRTRT/PUNRT, R15 TO ASSEMBLY POINTER                FCI*
***********************************************************************
         AIF   (&QSP).QSP1                                        UF020
RMTORLCL CLI   1(R1),0        IS IT FOR REMOTE 00=LOCAL            FCI*
         AGO   .QSP2                                              UF020
.QSP1    ANOP                                                     UF020
RMTORLCL CLI   3(R1),0        IS IT FOR REMOTE 00=LOCAL            FCI*
.QSP2    ANOP                                                     UF020
         BE    LIST           NO LUCK .. HAVE TO WORK FOR IT       FCI*
         AIF   (&QSP).RNB18A                                      RNB18
         CLI   0(R1),0        SPECIAL LOCAL ROUTING?              RNB18
         AGO   .RNB18B                                            RNB18
.RNB18A  ANOP                                                     RNB18
         CLC   =H'0',0(R1)    SPECIAL LOCAL ROUTING (SP2) ?       RNB18
.RNB18B  ANOP                                                     RNB18
         BNE   RMTORLC1          /NO  - GO FORMAT RMTNN           RNB18
         MVC   0(L'LCL,R15),LCL  /YES - MOVE IN LCL               RNB18
         LA    R15,L'LCL(R15)    BUMP POINTER                     RNB18
         B     RMTORLC2                                           RNB18
RMTORLC1 EQU   *                                                  RNB18
         MVC   0(L'RMT,R15),RMT       MOVE IN 'RMT'                FCI*
         LA    R15,L'RMT(R15)  BUMP POINTER                        FCI*
RMTORLC2 EQU   *                                                  RNB18
         SR    R14,R14        LOAD RMT FLAGS                       FCI*
         AIF   (&QSP).RNB18C                                      RNB18
         IC    R14,1(R1)      FROM PRT/PUN                         FCI*
         AGO   .RNB18D                                            RNB18
.RNB18C  ANOP                                                     RNB18
         ICM   R14,3,2(R1)      FROM JOEROUT  DOR FOR 9999
.RNB18D  ANOP                                                     RNB18
         CVD   R14,DOUBLEWD   RMT NUMBER TO DECIMAL                FCI*
         B     FITINUM1       FIT THE NUMBER IN RMT MESSAGE        FCI*
         SPACE 2
***********************************************************************
* FITINUM SUBROUTINE - CONVERT BIN NUMBER TO NICE FORMAT           FCI*
*                                                                  FCI*
***********************************************************************
FITINUM  CVD   R1,DOUBLEWD    CONVERT TO PACKED DECIMAL            FCI*
FITINUM1 MVC   NUMBER(L'NORMAL),NORMAL INITIALIZE THE EDIT FORMAT  FCI*
         LA    R1,NUMBER+SIGNORM IN CASE OF ZEROES                 FCI*
         EDMK  NUMBER(L'NORMAL),DOUBLEWD+2 CONVERT TO EBCDIC       FCI*
         LA    R14,NUMBER+L'NORMAL-1 A(END OF CONVERTED NUMBER)    FCI*
         SLR   R14,R1         LENGTH OF THE CONVERTED NUMBER - 1   FCI*
         EX    R14,MVNUMBER   PUT THE NUMBER IN THE MSG            FCI*
         LA    R15,1(R14,R15) A(NEXT SPOT IN MSG)                  FCI*
         B     LIST           RETURN TO OUR CALLER                 FCI*
         SPACE 3                                                   FCI*
MVNUMBER MVC   0(0,R15),0(R1) TO BE EXECUTED                       FCI*
         SPACE 2                                                   FCI*
NORMAL   DC    X'402020202020202020202120' EDIT MASK               FCI*
SIGNORM  EQU   11             OFFSET TO LAST DIGIT                 FCI*
RMT      DC    C'RMT'                                              FCI*
LCL      DC    C'LCL'                                             RNB18
***********************************************************************
*                                                                     *
*   FORMAT JQE                                                        *
*                                                                     *
***********************************************************************
LISTTSO  MVC   FQNAME(8),=C'TSO USER' NAME OF QUEUE
         B     LIST           CONTINUE
LISTSTC  MVC   FQNAME(8),=C'SYSTEM Q' NAME OF QUEUE
         B     LIST           CONTINUE
LISTHO   MVC   FQNAME(8),=C'HELD OUT' NAME OF QUEUE
         B     LIST           CONTINUE
         AIF   (NOT &QSP).RNB19B                                  RNB19
LISTDM   MVC   FQNAME(4),=C'DUMP'     NAME OF QUEUE               RNB19
         B     LIST                                               RNB19
LISTAOUT MVC   FQNAME(6),=C'AW OUT'   NAME OF QUEUE               RNB19
         B     LISTCN1                GO DO SYSAFF                RNB19
LISTSTUP MVC   FQNAME(5),=C'SETUP'    NAME OF QUEUE               CL005
         B     LIST                                               CL005
LISTCN   MVC   FQNAME(6),=C'CONVRT'   NAME OF QUEUE               RNB19
         MVC   FQUEUE,JQEJCLAS        JOB CLASS                   RNB19
         AIF   (NOT &QSP136).NO136I                               DOR
LISTCN1  TM    JQEFLAG1,JQE1BUSY      IS JOB CONVERTING?          DOR
         BNZ   LIST                   /YES - GO LIST IT           DOR
*                                     /NO  - PUT SYSAFF IN        DOR
         TM    JQEFLAG2,JQE2SAF       CHECK SYSTEM AFFINITY       DOR
         AGO   .X136I                                             DOR
.NO136I  ANOP                                                     DOR
LISTCN1  TM    JQEFLAGS,QUEBUSY       IS JOB CONVERTING?          RNB19
         BNZ   LIST                   /YES - GO LIST IT           RNB19
*                                     /NO  - PUT SYSAFF IN        RNB19
         TM    JQEFLAG2,QUESYSAF      CHECK SYSTEM AFFINITY       RNB19
.X136I   ANOP                                                     DOR
         BO    LIST                   LIST IT IF NO SPECIAL AFF   RNB19
         LA    R15,QSYSID+8           GET FIRST SID               RNB19
         TM    JQEFLAG2,X'01'         IS THIS IT?                 RNB19
         BO    LISTCN2                /YES -                      RNB19
         LA    R15,8(,R15)            /NO  - CHECK REST           RNB19
         TM    JQEFLAG2,X'02'                                     RNB19
         BO    LISTCN2                                            RNB19
         LA    R15,8(,R15)                                        RNB19
         TM    JQEFLAG2,X'04'                                     RNB19
         BO    LISTCN2                                            RNB19
         LA    R15,8(,R15)                                        RNB19
         TM    JQEFLAG2,X'08'                                     RNB19
         BO    LISTCN2                                            RNB19
         LA    R15,8(,R15)                                        RNB19
         TM    JQEFLAG2,X'10'                                     RNB19
         BO    LISTCN2                                            RNB19
         LA    R15,8(,R15)                                        RNB19
         TM    JQEFLAG2,X'20'                                     RNB19
         BO    LISTCN2                                            RNB19
         LA    R15,8(,R15)                                        RNB19
LISTCN2  MVC   FREMOTE(4),0(R15)      MOVE SYSTEM ID TO DISPLAY   RNB19
         B     LIST                                               RNB19
.RNB19B  ANOP                                                     RNB19
*LISTJQE  MVC   FQNAME,=C' INPUT' NAME OF QUEUE                   RNB19
LISTJQE  MVC   FQNAME(5),=CL5'XEQ'  ASSUME XEQ QUEUE              RNB19
         TM    JQETYPE,$XEQ         IS IT XEQ QUEUE?              RNB19
         BO    LIST                 /YES - GO LIST IT             RNB19
         MVC   FQNAME(5),=C'INPUT'  ELSE ASSUME INPUT, ETC.       RNB19
         TM    JQETYPE,$INPUT                                     RNB19
         BO    LIST                                               RNB19
         MVC   FQNAME(6),=C'OUTPUT'                               RNB19
         TM    JQETYPE,$OUTPUT+$HARDCPY                           RNB19
         BNZ   LIST                                               RNB19
         MVC   FQNAME(5),=C'PURGE'                                RNB19
         TM    JQETYPE,$PURGE                                     RNB19
         BO    LIST                                               RNB19
         MVC   FQNAME(8),=CL8'????????'                           RNB19
LIST     CLI   QSUBNAME,C'X'  IS THE REQUEST FOR A HEX DUMP?
         BE    HEX            YES. DO IT.
         MVC   FCOUNT,ED5     PREPARE FOR EDIT
         ED    FCOUNT,QCOUNT  EDIT THE POSITION IN QUEUE
         MVC   FNAME,JQEJNAME MOVE IN JOBNAME
         MVC   FJOBNO,ED5     PREPARE FOR EDIT
         LH    R0,JQEJOBNO    LOAD HASP JOBNUMBER
         CVD   R0,CONVERT     CONVERT TO DECIMAL
         ED    FJOBNO,CONVERT+5 EDIT HASP JOBNUMBER
         SR    R0,R0          ZERO OUT REGISTER
         IC    R0,JQEPRIO     LOAD JQE PRIORITY
         SRL   R0,4           DIVIDE BY 16
         CVD   R0,CONVERT     CONVERT TO DECIMAL
         MVC   FPRIO,ED3      PREPARE FOR EDIT
         ED    FPRIO,CONVERT+6 EDIT JQE PRIORITY
         AIF   (NOT &QSP136).NO136K                               DOR
         TM    JQEFLAG1,X'E0' IS THE JOB HELD?                    DOR
         BZ    NOHOLD         NO.                                 DOR
         MVC   FHOLD,=C'HELD' INDICATE JOB HELD                   DOR
         TM    JQEFLAG1,JQE1HLD1  SPECIFIC HOLD?                  DOR
         BO    NOHOLD             /YES - GO DISPLAY               DOR
         MVC   FHOLD,=C'DUP '     ASSUME DUPLICATE                DOR
         TM    JQEFLAG1,JQE1HLD2  IS IT DUPLICATE HOLD?           DOR
         AGO   .X136K                                             DOR
.NO136K  ANOP                                                     DOR
         TM    JQEFLAGS,X'E0' IS THE JOB HELD?
         BZ    NOHOLD         NO.
         MVC   FHOLD,=C'HELD' INDICATE JOB HELD
         TM    JQEFLAGS,QUEHOLD1  SPECIFIC HOLD?                  RNB20
         BO    NOHOLD             /YES - GO DISPLAY               RNB20
         MVC   FHOLD,=C'DUP '     ASSUME DUPLICATE                RNB20
         TM    JQEFLAGS,QUEHOLD2  IS IT DUPLICATE HOLD?           RNB20
.X136K   ANOP                                                     DOR
         BO    NOHOLD             /YES - GO DISPLAY               RNB20
         MVC   FHOLD,=C'$HA '     ELSE MUST BE FROM $HA           RNB20
NOHOLD   DS    0H
         CLC   QCODEH,=H'28'  IS THIS THE HO COMMAND?             RNB25
         BNE   LIST2          /NO  - DO NORMAL LISTING            RNB25
*                             /YES -                              RNB25
         CLC   =C'COUNT',QPARM1  DOES USER WANT LINE COUNTS?      RNB25
         BNE   LIST2          /NO  - DO NORMAL LISTING            RNB25
*                             /YES - GET JCT AND FORMAT LINE CNT  RNB25
         MVC   QCTRAK,JQETRAK DISK ADDR OF JCT                    RNB25
         L     R3,QCJCTA      ADDR OF IOAREA FOR JCT              RNB25
         LR    R1,R3          PARM FOR READSPC                    RNB25
         AIF   (NOT &QSP136).NO136L                               DOR
         AL    R1,=A(JCTSTART-JCT)       ADJUST FOR BUFFER PREFIX DOR
         L     R15,=V(READSPC)  ROUTINE TO READ HASPACE           RNB25
         BALR  R14,R15          GO DO IT                          RNB25
         USING JCT,R3         BASE FOR JCT                        DOR
         AGO   .X136L                                             DOR
.NO136L  ANOP                                                     DOR
         AL    R1,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
         L     R15,=V(READSPC)  ROUTINE TO READ HASPACE           RNB25
         BALR  R14,R15          GO DO IT                          RNB25
         USING JCTDSECT,R3    BASE FOR JCT                        ONL16
.X136L   ANOP                                                     DOR
         SPACE 1                                                  ONL03
         CLC   JCTID,=CL4'JCT'  WAS A JCT READ FROM SPOOL ?       ONL03
         BNE   LIST2          SKIP IF NO                          ONL03
         CLC   JCTJNAME,JQEJNAME  DOES JOBNAME MATCH ?            ONL03
         BNE   LIST2          SKIP IF NO                          ONL03
         LA    R1,JQE         ADDR OF JQE                         ONL03
         SL    R1,QCJQTA      COMPUTE THE JQE OFFSET              ONL03
         CL    R1,JCTJQE      DOES OFFSET MATCH THE JCT'S ?       ONL03
         BNE   LIST2          SKIP IF NO                          ONL03
         SPACE 1                                                  ONL03
         L     R0,JCTLINES    GET TOTAL LINES GENERATED BY JOB    RNB25
         DROP  R3                                                 RNB25
         SPACE 1                                                  ONL03
         CVD   R0,CONVERT     CONVERT TO DECIMAL                  RNB25
         MVC   FLINES,ED8     PREPARE FOR EDIT                    RNB25
         ED    FLINES,CONVERT+4  PRINT TOTAL LINE COUNT           RNB25
         C     R0,=F'9999999' IS THE LINE COUNT >= 10 MILLION?    RNB25
         BNH   LIST2          /NO  - GO LIST IT                   RNB25
         MVI   FLINES+8,C'+'  /YES - SHOW OVERFLOW                RNB25
LIST2    EQU   *                                                  RNB25
         LA    R1,QDMSG       ADDR OF MESSAGE AREA
         ST    R1,QDMSGA      STORE MESSAGE ADDR
         MVC   QDMLNG,=H'80'  LENGTH OF DISPLAY LINE
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        DISPLAY THE LINE
STOP     QSTOP
***********************************************************************
*                                                                     *
*   TAKE HEX DUMP OF JOE                                              *
*                                                                     *
***********************************************************************
HEXO     UNPK  FHEX1,0(8,R8)  UNPK FIRST PART OF JOE INTO HEX
         UNPK  FHEX2,7(8,R8)  SECOND
         UNPK  FHEX3,14(8,R8) THIRD
         UNPK  FHEX4,21(8,R8) FOURTH
         UNPK  FHEX5,28(5,R8) FIFTH
         MVI   FHEXOC,C' '    CLEAR LAST BYTE
         TR    FHEXO,TABLE    CHANGE TO PRINTABLE HEX
         LA    R1,QDMSG       ADDR OF MESSAGE AREA
         ST    R1,QDMSGA      STORE MESSAGE ADDR
         MVC   QDMLNG,=H'80'  LENGTH OF DISPLAY LINE
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        DISPLAY THE LINE
***********************************************************************
*                                                                     *
*   TAKE HEX DUMP OF JQE                                              *
*                                                                     *
***********************************************************************
HEX      UNPK  FHEX1,0(8,R9)  UNPK FIRST PART OF JOE INTO HEX
         UNPK  FHEX2,7(8,R9)  SECOND
         UNPK  FHEX3,14(8,R9) THIRD
         UNPK  FHEX4,21(8,R9) FOURTH
         MVC   FHEXC,QBLANK   CLEAR LAST BYTES
         TR    FHEX,TABLE     CHANGE TO PRINTABLE HEX
         B     NOHOLD         CALL DISPLAY
***********************************************************************
* SETDEVIC SUBROUTINE - GET DEVICE DATA (R3) POINTS TO DEVID       FCI*
*                                                                  FCI*
***********************************************************************
SETDEVIC ST    R7,SETDHOLD       SAVE LINK ADDRESS                 FCI*
         MVC   FPRINT(9),=CL9' '
         TM    0(R3),HIGHBIT REMOTE DEVICE?                        FCI*
         BO    RMTDEV         YES => OUTPUT IT                     FCI*
         SR    R1,R1          FOR THE INSERT CHARACTER             FCI*
         IC    R1,0(R3)         DEVICE TYPE                        FCI*
         SRL   R1,4           RIGHT JUSTIFIED                      FCI*
         MH    R1,DEVTYPEL    TYPE * LENGTH OF A DEVICE ENTRY      FCI*
         LA    R1,DEVTABLE(R1) A(DEVICE TYPE)                      FCI*
         MVC   FPRINT,1(R1)   PUT IN THE DEVICE TYPE
         CLI   0(R3),0          INTERNAL READER?                   FCI*
         BE    SETDRTN        YES => GIVE THE USER THE INFO        FCI*
         SR    R15,R15        FOR THE INSERT CHARACTER             FCI*
         AIF   (&QSP).RNB21A                                      RNB21
         IC    R15,1(R3)        DEVICE NUMBER                      FCI*
         AGO   .RNB21B                                            RNB21
.RNB21A  ANOP                                                     RNB21
         ICM   R15,3,1(R3)      DEVICE NUMBER  (SP2)              RNB21
.RNB21B  ANOP                                                     RNB21
         CVD   R15,DOUBLEWD   IN PACKED DECIMAL                    FCI*
         IC    R15,0(R1)      OFFSET TO WHERE THE DEV # GOES       FCI*
         LA    R15,FPRINT(R15) A(WHERE THE DEV # GOES)
         MVC   1(L'DIGITS3,R15),DIGITS3 SET UP THE EDIT OF 3 DIGITSKMT*
         EDMK  0(L'DIGITS3+1,R15),DOUBLEWD+6 DEV # IN EBCDIC       FCI*
         MVC   0(L'DIGITS3+1,R15),0(R1) ADJUST FOR BLANKS          FCI*
*                                                                  FCI*
         B     SETDRTN        GO EXIT
*                                                                  FCI*
RMTDEV   SR    R0,R0          FOR THE INSERT CHARACTER             FCI*
         AIF   (&QSP).QSP3                                        UF020
         ICM   R0,3,1(R3)         REMOTE NUMBER  DOR FOR UP TO 9999
         AGO   .QSP4                                              UF020
.QSP3    ANOP                                                     UF020
         ICM   R0,3,1(R3)         REMOTE NUMBER DOR UP TO 9999
.QSP4    ANOP                                                     UF020
         CVD   R0,DOUBLEWD    IN PACKED DECIMAL                    FCI*
         MVI   FPRINT,C'R'    INDICATE A REMOTE DEVICE             FCI*
         MVC   FPRINT+2(L'THREEPT),THREEPT SET UP THE EDIT MASK    FCI*
         EDMK  FPRINT+1(L'THREEPT),DOUBLEWD+6 CONVERT TO EBCDIC    FCI*
         MVC   FPRINT+1(L'THREEPT),0(R1) ADJUST FOR BLANKS         FCI*
         LA    R1,FPRINT+1    A(SPOT JUST BEFORE POSSIBLE SEP)     FCI*
FINDPT   LA    R1,1(R1)       A(NEXT BYTE)                         FCI*
         CLI   0(R1),C'.'     FOUND THE SEPARATOR?                 FCI*
         BNE   FINDPT         NO => KEEP LOOKING                   FCI*
         SR    R15,R15        FOR THE INSERT CHARACTER             FCI*
         IC    R15,0(R3)        DEVICE TYPE INDICATOR              FCI*
         SRL   R15,3          RIGHT JUSTIFIED                      FCI*
         LA    R15,RMTDEVS-HIGHBIT/8(R15) A(DEVICE TYPE)           FCI*
         MVC   1(2,R1),0(R15) PUT IN THE DEVICE TYPE               FCI*
         MVC   3(1,R1),0(R3) PUT IN THE DEVICE NUMBER              FCI*
         OI    3(R1),C'0'     MAKE THE DEVICE NUMBER PRINTABLE     FCI*
         B     SETDRTN
         EJECT ,                                                   FCI*
SETDRTN  L     R7,SETDHOLD    GET RETURN ADDRESS                   FCI*
         BR    R7             RETURN TO OUR CALLER                 FCI*
         SPACE 5                                                   FCI*
DIGITS3  DC    X'202020'                                           FCI*
THREEPT  DC    X'2020204B'                                         FCI*
         DS    0H                                                  FCI*
DEVTABLE DC    AL1(0),CL8'INTRDR',AL1(6),CL8'READER'               FCI*
         DC    AL1(7),CL8'PRINTER',AL1(5),CL8'PUNCH'               FCI*
DEVTYPEL DC    AL2((*-DEVTABLE)/4)                                 FCI*
RMTDEVS  DC    C'**',C'RD',C'PR',C'PU'                             FCI*
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
ED8      DC    X'4020202020202120'
ED5      DC    X'402020202021'
ED3      DC    X'40202021'
HEADING  DC    C'  QUEUE  POSITION JOBNAME    JOB#  PRIORITY  LINES'
         DC    CL40'   EXECUTING'
HIGHBIT  EQU   X'80'
TABLE    EQU   *-240
         DC    C'0123456789ABCDEF' TRANSLATE TO PRINTABLE HEX
WORK     DSECT
         DS    CL80
CONVERT  DS    D
SETDHOLD DS    F
DOUBLEWD DS    D
NUMBER   DS    CL16
FORMAT   CSECT
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
FORMAT   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136M                               DOR
         IFGRPL DSECT=YES,AM=VTAM                                 DOR
         AGO   .X136M                                             DOR
.NO136M  ANOP                                                     DOR
JCT      EQU   0                                                  RNB25
.X136M   ANOP                                                     DOR
         $JQE
         $JOE
        $BUFFER ,                                                 ONL16
        $JCT   ,                                                  RNB25
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
FCLEAR   DS    0CL80          FORMAT FOR QUEUE RECORDS
FQNAME   DS    CL6            NAME OF QUEUE
         DS    C
FQUEUE   DS    C              CLASS NAME
         DS    CL2
FCOUNT   DS    CL6            POSITION IN QUEUE
         DS    CL2
FNAME    DS    CL8            JOBNAME
         DS    CL2
FJOBNO   DS    CL6            JES2 JOB NUMBER
         DS    CL2
FPRIO    DS    CL4            JOB PRIORITY
         DS    CL2
FLINES   DS    CL8            NUMBER OF OUTPUT LINES
         DS    CL3
FSYSID   DS    CL8            SYSTEM ID
         DS    CL3
FHOLD    DS    CL4            JOB HOLD STATUS
         DS    CL1
FREMOTE  DS    CL8            REMOTE
         ORG   FSYSID
FPRINT   DS    CL8            PRINTING
         ORG   FCOUNT
FHEX     DS    0CL56          LENGTH OF JQE HEX DUMP
FHEXO    DS    0CL64          LENGTH OF JOE HEX DUMP
FHEX1    DS    0CL15
         DS    CL14
FHEX2    DS    0CL15
         DS    CL14
FHEX3    DS    0CL15
         DS    CL14
FHEX4    DS    0CL15
         DS    CL14
FHEXC    DS    0CL9           CLEAR LAST BYTES FOR JQE
FHEX5    DS    0CL9
         DS    CL8
FHEXOC   DS    C              CLEAR LAST BYTE FOR JOE
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=FORMS
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
***********************************************************************
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
FORMS    TITLE  'QUEUE COMMAND - JQE AND JOE SEARCH AND FORMAT-FORMS'
FORMS    QSTART HASPEQU=YES,                                        DORX
               XTITLE='QUEUE CMD - JQE AND JOE SEARCH AND FORMAT-FORMS'
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JQE,R9    BASE REG FOR JQE DSECT
         USING JOE,R8    BASE REG FOR JOE DSECT
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JQEDSECT,R9    BASE REG FOR JQE DSECT
         USING JOEDSECT,R8    BASE REG FOR JOE DSECT
.X136A   ANOP                                                       DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         NI    QFLAG1,255-QJOTON RESET SECOND HALF SWITCH
         LH    R1,QCODEH      LOAD FUNCTION CODE INTO R1
         CH    R1,=H'48'      IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     FO             0 OFFSET
         EJECT
***********************************************************************
*                                                                     *
*   FO - PRINT AVAILABLE JOBS IN THE OUTPUT QUEUE  BY FORMS/FCB       *
*                                                                     *
***********************************************************************
FO        DS    0H
*****
*****  SEARCH ALL QUEUES
*****
         MVI   QCLASS,192     START WITH CLASS A
FO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2B           END OF QUEUE
         BAL   R2,PRTJOE      PRINT THE RECORD
FO2B     LA    R4,4(,R4)      POINT TO SECOND HALF OF QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2            END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
         SPACE 4
***********************************************************************
*                                                                     *
*   DETERMINE LENGTH OF LEVEL                                         *
*                                                                     *
***********************************************************************
PARMLEN  LA    R3,7           MAXIMUM LENGTH OF 8
         LA    R4,QPARM1+7    END OF FIELD
PARMLEN2 CLI   0(R4),C' '     IS THIS BYTE BLANK?
         BNE   PARMLEN3       NO. THIS IS THE LENGTH
         BCTR  R4,0           TRY PREVIOUS BYTE
         BCT   R3,PARMLEN2    LOOP
PARMLEN3 STH   R3,QLNG1       STORE THE LENGTH OF LEVEL
         BR    R2             RETURN TO CALLER
         SPACE 4
***********************************************************************
*                                                                     *
*   SEARCH A JQE QUEUE                                                *
*                                                                     *
***********************************************************************
SRCHJQE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
         L     R9,0(R4)       LOAD FIRST JQE OFFSET
NEXTJQE  N     R9,=X'00FFFFFF' KILL EXTRANEOUS BITS
         BZR   R2             END OF QUEUE. RETURN.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJQE   AP    QCOUNT,=P'1'   INCREMENT COUNT
PRT2JQE  SR    R1,R1          INDICATE THIS IS A JQE
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE
         BALR  R14,R15        PRINT THE JQE IN R9
REJJQE   L     R9,JQENEXT     LOAD OFFSET TO NEXT JQE
         B     NEXTJQE        GET THE NEXT JQE
SKIPJQE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     REJJQE         CONTINUE
         EJECT
***********************************************************************
*                                                                     *
*   SEARCH A JOE QUEUE                                                *
*                                                                     *
***********************************************************************
SRCHJOE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
FIRSTJOE ICM   R8,7,1(R4)     LOAD FIRST JOE OFFSET
         BZR   R2             YES. RETURN TO CALLER.
         XC    PRIORITY(12),PRIORITY ZERO OUT HIGHEST POINTERS
NEXTJOE  A     R8,QCJOTA      ADD BASE TO OFFSET
         ICM   R9,7,JOEJQE+1  OFFSET TO JQE
         BZ    TRYJOE         THIS JOE ALREADY USED. TRY NEXT ONE.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         LA    R7,255         PRESET MAXIMUM PRIORITY
         TM    JQEPRIO,240    IS THIS JOB PRIORITY 15?
         BO    HIGHJOE        YES. PASS TO CALLER.
         LA    R1,16          PRESET PRIORITY ONE
         CLI   JQETYPE,$HARDCPY IS THE JOB EXECUTING?
         BNE   EXECJOE        YES. USE PRIORITY ONE.
         IC    R1,JQEPRIO     INSERT JQE PRIORITY
EXECJOE  IC    R7,JOEPRIO     INSERT JOE PRIORITY
         AR    R7,R1          ADD PRIORITIES
         SRL   R7,1           BECAUSE HASP DOES IT, THAT'S WHY
HIGHJOE  C     R7,PRIORITY    IS THIS LESS THAN PREVIOUS HIGH?
         BL    TRYJOE         YES. TRY NEXT ONE.
         STM   R7,R9,PRIORITY NO. REPLACE PREVIOUS HIGH.
TRYJOE   ICM   R8,7,JOENEXT+1 ADDR OF NEXT JOE
         BNZ   NEXTJOE        TRY NEXT JOE
TESTJOE  LM    R7,R9,PRIORITY LOAD ADDR OF HIGHEST JOE
         LTR   R8,R8          WAS THE QUEUE EMPTY?
         BZR   R2             YES. END OF QUEUE.
         XC    JOEJQEB,JOEJQEB   INDICATE THIS JOE USED
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJOE   LA    R1,4           INDICATE THIS IS A JOE
         AP    QCOUNT,=P'1'   INCREMENT COUNT
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE
         BALR  R14,R15        PRINT THE JOE IN R9
REJJOE   B     FIRSTJOE       GET THE NEXT JOE
SKIPJOE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     FIRSTJOE       CONTINUE
         EJECT
***********************************************************************
*                                                                     *
*   DETERMINE INPUT QUEUE                                             *
*                                                                     *
***********************************************************************
FINDJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         B     NEXTJQT2       CONTINUE
NEXTJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   NEXTJQT9       YES. GO HOME.
NEXTJQT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         SLL   R4,2           MULTIPLY BY 4
         L     R1,QCJQHEAD    LOAD ADDR OF JQT
****   THE FOLLOWING HARD-CODED CONSTANT (48) IS THE OFFSET OF
****     THE CLASS A QUEUE FROM THE BEGINNING OF THE QUEUE
****     HEADERS.  (LABEL $QHEADS).  ITS VALUE CAN BE FOUND FROM
****     $QINDEX IN THE HCT.
         LA    R4,48(R1,R4)   NEXT QUEUE
         BR    R2             RETURN TO CALLER
NEXTJQT9 B     STOP           GO HOME
***********************************************************************
*                                                                     *
*   DETERMINE OUTPUT QUEUE                                            *
*                                                                     *
***********************************************************************
FINDJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         SLL   R4,1           MULTIPLY BY 2
         B     NEXTJOT2       CONTINUE
NEXTJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   STOPJOT        YES. GO HOME.
NEXTJOT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         TM    QFLAG1,QJOTON  ARE WE WORKING ON SECOND HALF
         BNO   *+8            NO..
         AH    R4,=H'35'      POINT TO SECOND HALF
         MH    R4,=Y(JOTHEADL)   MULTIPLY BY 4
         AIF   (NOT &QSP136).NO136B                                 DOR
         USING JOT,R1    BASE REG FOR JOT
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         USING JOTDSECT,R1    BASE REG FOR JOT
.X136B   ANOP                                                       DOR
         L     R1,QCJOTA      LOAD ADDR OF JOT
         LA    R4,JOTCLSQ(R4) NEXT QUEUE
         DROP  R1
         BR    R2             RETURN TO CALLER
STOPJOT  DS    0H             STOP JOT SEARCH??
         TM    QFLAG1,QJOTON  HAS SECOND HALF BEEN SEARCHED?
         BO    STOP           YES STOP
         OI    QFLAG1,QJOTON  SHOW SECOND HALF SEARCHED
         MVI   QCLASS,192     START OVER WITH CLASS A
         B     NEXTJOT        BEGIN AGAIN
         SPACE 4
***********************************************************************
*                                                                     *
*   CALL DISPLAY ROUTINE                                              *
*                                                                     *
***********************************************************************
DISPLAY  LA    R1,QDMSG             SAVE ADDRESS
         ST    R1,QDMSGA                 OF THE MESSAGE
         MVC   QDMLNG,QDLNELEN      SET THE LENGTH                 MOD5
         L     R15,=V(DISPLAY)      BRANCH TO
         BALR  R14,R15                     DISPLAY
         BR    R2                   RETURN TO CALLER
         SPACE 2
***********************************************************************
*                                                                     *
*   GO HOME                                                           *
*                                                                     *
***********************************************************************
STOP     QSTOP
         EJECT
*****  COMPARE USED TO CHECK LEVEL
*****
STCLC    CLC   QPARM1(1),JQEJNAME    IS THE JOBNAME EQUAL TO LEVEL?
         LTORG
***********************************************************************
*                                                                     *
*   TABLES FOR CLASS DETERMINATION                                    *
*                                                                     *
***********************************************************************
NAMETBL  DC    C'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
CLASSTBL DC    192X'01'
         DC    X'00010203040506070809',7X'00'
         DC    X'0A0B0C0D0E0F101112',8X'00'
         DC    X'131415161718191A',6X'00'
         DC    X'1B1C1D1E1F2021222324',6X'00'
***********************************************************************
*                                                                     *
*   MISCELLANEOUS GARBAGE                                             *
*                                                                     *
***********************************************************************
ED5      DC    X'402020202120'
DQHEADER DC    CL132'*** INPUT QUEUES ***'
DQLINE   DC    CL132' INPUT                        EXECUTING      WAITIX
               NG      HELD'
DFHEADER DC    CL132'*** OUTPUT QUEUES ***'
DFLINE   DC    CL132' OUTPUT                       PRINTING'
         COPY  $HASPGBL
         CVT   DSECT=YES
         IEFJESCT
         IEFJSCVT
         AIF   (NOT &QSP136).NO136A                                 DOR
         IFGRPL DSECT+YES,AM+VTAM
         $BUFFER
         $TQE
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
BUFDSECT EQU   0
BUFSTART EQU   0
.X136A   ANOP                                                       DOR
        $JCT
        $JQE
        $PCE
        $PDDB
        $TAB
        $XECB
        $JOE
        $JOT
        $CAT
        $SCAT
        $SVT
        $MIT
        $HCT
FORMS    CSECT
         $QINDEX
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
         ORG   QDMSG
         DS    CL9
CLASS    DS    CL1
         DS    CL2
QTCOUNT  DS    CL6
         DS    CL7
QECOUNT  DS    CL3
         DS    CL2
DFACTION DS    CL8
         DS    CL2
QACOUNT  DS    CL3
         DS    CL10
QHCOUNT  DS    CL3
         ORG   QTCOUNT
FCOUNT   DS    CL6
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
PRIORITY DS    3F
WCLASS   DS    C
WORKEND  EQU   *
         END
./       ADD   NAME=HELP
HELP     TITLE 'QUEUE COMMAND - DISPLAY HELP'                     ONL02
         GBLB   &QISPF      DOR
         GBLB   &QISPF2     DOR
******************************************************************ONL02
*                                                                 ONL02
* MODULE NAME = HELP                                              ONL02
*                                                                 ONL02
* DESCRIPTIVE NAME = THE QUEUE COMMAND HELP FACILITY DISPLAY      ONL02
*                                                                 ONL02
* AUTHOR = ROBERT M. JINKINS                                      ONL02
*          OAK RIDGE NATIONAL LABORATORY                          ONL02
*          BLDG. 4500-N  MS-259                                   ONL02
*          P.O. BOX X                                             ONL02
*          OAK RIDGE, TENNESSEE  37830                            ONL02
*                                                                 ONL02
*          PHONE: (615) 574-7208/5300                             ONL02
*                  FTS  624-7208/5300                             ONL02
*                                                                 ONL02
*          SHARE INSTALLATION CODE = OR                           ONL02
*                                                                 ONL02
* DATE WRITTEN = JUNE 83                                          ONL02
*                                                                 ONL02
* FUNCTION = TO DISPLAY THE HELP SCREENS IN RESPONSE TO A "HELP"  ONL02
*    SUB-COMMAND OR AN UNDEFINED/UNAUTHORIZED SUB-COMMAND VERB.   ONL02
*    HELP INFORMATION IS ONLY DISPLAYED FOR SUB-COMMANDS WHICH    ONL02
*    THE USER IS AUTHORIZED TO USE.                               ONL02
*                                                                 ONL02
*    THE #H MACRO IS USED TO DEFINE THE HELP SCREENS AND IS       ONL02
*    DISCUSSED IN THE COMMENTS AT THE BEGINNING OF THE #H MACRO.  ONL02
*    AN OPERAND OF THIS MACRO DEFINES THE AUTHORITY REQUIRED      ONL02
*    BEFORE A USER MAY SEE A GIVEN MESSAGE IN THE HELP DISPLAY.   ONL02
*    THE USER'S AUTHORITY FOR HELP DISPLAYS (QAHELP) IS SET IN    ONL02
*    THE AUTH CSECT BY DEFAULT TO THE USER'S AUTHORITY (QAFLAGS). ONL02
*                                                                 ONL02
******************************************************************ONL02
         EJECT ,                                                  ONL02
         MACRO ,                                                  ONL02
&NAME    #H    &TYPE,&OFFSET,&TEXT,&USER=0                        ONL02
.*****************************************************************ONL02
.*                                                                ONL02
.* MACRO NAME = #H                                                ONL02
.*                                                                ONL02
.* MODIFICATION ID = ONL02                                        ONL02
.*                                                                ONL02
.* DESCRIPTIVE NAME = QUEUE COMMAND HELP FACILITY MESSAGE ENTRY   ONL02
.*                                                                ONL02
.* FUNCTION = THIS MACRO IS USED TO GENERATE ENTRIES IN HELP      ONL02
.*    TABLE (IN THE HELP CSECT).  THE HELP TABLE ENTRIES, MAPPED  ONL02
.*    BY THE HTEDSECT, IS UESD TO GENERATE THE HELP SCREENS.      ONL02
.*                                                                ONL02
.* SYNTAX:  NAME  #H  TYPE,OFFSET,TEXT,USER=X                     ONL02
.*                                                                ONL02
.*   WHERE:                                                       ONL02
.*     NAME    - IS AN OPTIONL LABEL.                             ONL02
.*     TYPE    - THIS REQUIRED OPERAND IS CODED AS FOLLOWS:       ONL02
.*                 NORM  - MSG LINE WITH NO RESTRICTIONS.         ONL02
.*                 ACTV  - MSG LINE, QAHFACTV AUTHORITY REQUIRED. ONL02
.*                 BLOG  - MSG LINE, QAHFBLOG AUTHORITY REQUIRED. ONL02
.*                 SSSM  - MSG LINE, QAHFSSSM AUTHORITY REQUIRED. ONL02
.*                 SLOG  - MSG LINE, QAHFSLOG AUTHORITY REQUIRED. ONL02
.*                 EXEC  - MSG LINE, QAHFEXEC AUTHORITY REQUIRED. ONL02
.*                 OPER  - MSG LINE, QAHFOPER AUTHORITY REQUIRED. ONL02
.*                 SYSP  - MSG LINE, QAHFSYSP AUTHORITY REQUIRED. ONL02
.*                 QAHX... - AN EXPRESSION BEGINNING WITH THE     ONL02
.*                           CHARACTERS "QAHX" DEFINING THE       ONL02
.*                           REQUIRED AUTHORITY BITS              ONL02
.*                           (E.G. "QAHXSSSM+QAHXOPER").          ONL02
.*                 PAGE  - INDICATES END OF THE CURRENT SCREEN.   ONL02
.*                 END   - INDICATES END OF THE LAST SCREEN.      ONL02
.*                                                                ONL02
.*               MESSAGE LINES REQUIRING AUTHORITY WILL NOT BE    ONL02
.*               DISPLAYED UNLESS THE CORRESPONDING AUTHORITY     ONL02
.*               BITS ARE ON IN QAHELP.                           ONL02
.*                                                                ONL02
.*     OFFSET  - GIVES THE NUMBER OF SPACES FROM THE RIGHT SIDE   ONL02
.*               OF THE SCREEN TO THE BEGINNING OF THE MESSAGE    ONL02
.*               TEXT.  THE OFFSET MUST BE A SELF-DEFINING TERM   ONL02
.*               WITH A VALUE IN THE RANGE OF 0 TO 79.  THIS      ONL02
.*               OPERAND IS IGNORED FOR TYPES "PAGE" AND "END".   ONL02
.*                                                                ONL02
.*               DEFAULT:  0                                      ONL02
.*                                                                ONL02
.*     TEXT    - IS THE TEXT TO BE DISPLAYED ON THE MESSAGE LINE. ONL02
.*               THE TEXT MUST BE ENCLOSED IN APOSTROPHES.  THE   ONL02
.*               OFFSET PLUS THE ASSEMBLED LENGTH OF THE TEXT     ONL02
.*               MUST NOT EXCEED 80 CHARACTERS.  THIS OPERAND IS  ONL02
.*               IGNORED FOR TYPES "PAGE" AND "END".              ONL02
.*                                                                ONL02
.*               NO DEFAULT, MUST BE CODED IF TYPE IS NOT "PAGE"  ONL02
.*               OR "END"                                         ONL02
.*                                                                ONL02
.*     USER=X  - SPECIFIES OPTIONAL USER FLAGS FOR USE BY HELP    ONL02
.*               CSECT MODS MADE BY YOUR INSTALLATION.  STANDARD  ONL02
.*               HELP FACILITY PROCESSING DOES NOT USE THE USER   ONL02
.*               FLAGS.  THIS OPERAND IS IGNORED FOR TYPES "PAGE" ONL02
.*               AND "END".                                       ONL02
.*                                                                ONL02
.*               DEFAULT:  USER=0                                 ONL02
.*                                                                ONL02
.* CHANGE ACTIVITY = NONE                                         ONL02
.*                                                                ONL02
.*****************************************************************ONL02
         GBLA  &MSGCNT             NUM HELP MSG'S ON CURRENT PAGE ONL02
         LCLA  &OFF                OFFSET FOR MSG TEXT            ONL02
         LCLA  &L                  COMPUTED TEXT LENGTH           ONL02
         LCLA  &N                  CURRENT TEXT INDEX             ONL02
         LCLB  &P                  SPECIAL CHAR PAIR INDICATOR    ONL02
         LCLA  &TLEN               LENGTH OF OFFSET PLUS TEXT     ONL02
         AIF   ('&TYPE' EQ 'NORM').LINE                           ONL02
         AIF   ('&TYPE' EQ 'ACTV').LINE                           ONL02
         AIF   ('&TYPE' EQ 'BLOG').LINE                           ONL02
         AIF   ('&TYPE' EQ 'SSSM').LINE                           ONL02
         AIF   ('&TYPE' EQ 'SLOG').LINE                           ONL02
         AIF   ('&TYPE' EQ 'EXEC').LINE                           ONL02
         AIF   ('&TYPE' EQ 'OPER').LINE                           ONL02
         AIF   ('&TYPE' EQ 'SYSP').LINE                           ONL02
         AIF   ('&TYPE'(1,4) EQ 'QAHX').LINE                      ONL02
         AIF   ('&TYPE' EQ 'PAGE').HTEPAGE                        ONL02
         AIF   ('&TYPE' EQ 'END').HTEEND                          ONL02
         MNOTE 8,'#H MACRO - INVALID "TYPE" OPERAND'              ONL02
         MEXIT ,                                                  ONL02
.LINE    ANOP  ,                   DEFINE HELP MESSAGE LINE       ONL02
         AIF   (T'&OFFSET EQ 'O').SKIPOFF                         ONL02
         AIF   (T'&OFFSET NE 'N').OFFBAD                          ONL02
&OFF     SETA  &OFFSET                                            ONL02
.SKIPOFF ANOP ,                                                   ONL02
         AIF   (&OFF LE 79).OFFOK                                 ONL02
.OFFBAD  ANOP  ,                                                  ONL02
         MNOTE 8,'#H MACRO - INVALID "OFFSET" OPERAND'            ONL02
         MEXIT ,                                                  ONL02
.OFFOK   ANOP  ,                                                  ONL02
         AIF   (K'&TEXT LE 2).BADTEXT                             ONL02
         AIF   ('&TEXT'(1,1) NE '''').BADTEXT                     ONL02
         AIF   ('&TEXT'(K'&TEXT,1) NE '''').BADTEXT               ONL02
&L       SETA  K'&TEXT-2                                          ONL02
&N       SETA  1                                                  ONL02
.CNTLOOP ANOP  ,                                                  ONL02
&N       SETA  &N+1+&P                                            ONL02
         AIF   (&N GE K'&TEXT).GOTLEN                             ONL02
&P       SETB  ('&TEXT'(&N,2) EQ '''' OR '&TEXT'(&N,2) EQ '&&')   ONL02
&L       SETA  &L-&P                                              ONL02
         AGO   .CNTLOOP                                           ONL02
.BADTEXT ANOP  ,                                                  ONL02
         MNOTE 8,'#H MACRO - INVALID "MSG-TEXT" OPERAND'          ONL02
         MEXIT ,                                                  ONL02
.GOTLEN  ANOP  ,                                                  ONL02
&TLEN    SETA  &OFF+&L                                            ONL02
         AIF   (&TLEN LE 80).TLENOK                               ONL02
         MNOTE 8,'#H MACRO - "OFFSET" + "MSG-TEXT" IS TOO LONG'   ONL02
         MEXIT ,                                                  ONL02
.TLENOK  ANOP  ,                                                  ONL02
&MSGCNT  SETA  &MSGCNT+1                                          ONL02
         AIF   ('&TYPE' NE 'NORM').USETYPE                        ONL02
&NAME    DC    AL1(0,&L,&OFF,&USER),CL&L&TEXT                     ONL02
         MEXIT ,                                                  ONL02
.USETYPE ANOP  ,                                                  ONL02
         AIF   ('&TYPE'(1,4) EQ 'QAHX').TYPEWHO                   ONL02
&NAME    DC    AL1(QAHX&TYPE,&L,&OFF,&USER),CL&L&TEXT             ONL02
         MEXIT ,                                                  ONL02
.TYPEWHO ANOP  ,                                                  ONL02
&NAME    DC    AL1(&TYPE,&L,&OFF,&USER),CL&L&TEXT                 ONL02
         MEXIT ,                                                  ONL02
.HTEPAGE ANOP  ,                   END OF PAGE ENTRY              ONL02
         MNOTE *,'    &MSGCNT MESSAGES DEFINED FOR THIS SCREEN'   ONL02
&MSGCNT  SETA  0                                                  ONL02
&NAME    DC    XL3'00FFFF'         END OF PAGE                    ONL02
         MEXIT ,                                                  ONL02
&MSGCNT  SETA  0                                                  ONL02
.HTEEND  ANOP  ,                   END OF TABLE ENTRY             ONL02
         AIF   (&MSGCNT EQ 0).DONE                                ONL02
         MNOTE *,'    &MSGCNT MESSAGES DEFINED FOR THIS SCREEN'   ONL02
&MSGCNT  SETA  0                                                  ONL02
.DONE    ANOP  ,                                                  ONL02
&NAME    DC    XL3'FFFFFF'         END OF HELP DISPLAY            ONL02
         MEND  ,                                                  ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  DO ENTRY POINT HOUSEKEEPING                                    ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
HELP     QSTART ,                  START HELP CSECT ASSEMBLY      ONL02
         SPACE 1                                                  ONL02
         GBLB  &QPFK               PF-KEY OPTION                  ONL02
         GBLB  &LOCK               LOCKHEED OPTIONS                  CL
         GBLB  &QONL               ENABLES ONL SPECIFIC CODE      ONL06
         SPACE 1                                                  ONL02
         USING WORK,R13            NOTE SAVE/WORK ADDRESSABILITY  ONL02
         SPACE 1                                                  ONL02
         L     R10,QVDSPL          ADDR OF DISPLAY WORK AREA      ONL02
         USING QDISPLAY,R10        NOTE DISPLAY ADDRESSABILITY    ONL02
         EJECT ,                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  BUILD HELP DISPLAY FROM HELP TABLE ENTRIES                     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         MVC   QDHLINE,HEADING     SET HELP DISPLAY HEADING       ONL02
         ZAP   DWORD,QDLNES        GET NUMBER OF AVAILABLE MESSAGEONL02
         CVB   R4,DWORD              LINES PER SCREEN IN BINARY   ONL02
         SLR   R5,R5               ZERO CURRENT LINE NUMBER       ONL02
         LA    R6,HELPTABL         ADDR OF FIRST HELP TABLE ENTRY ONL02
         USING HTEDSECT,R6         NOTE HTE ADDRESSABILITY        ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  PROCESS NEXT HELP TABLE ENTRY                                  ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
NEXTHTE  DS    0H                  PROCESS NEXT HELP TABLE ENTRY  ONL02
         CLC   HTEPAGE,=X'00FFFF'  IS THIS AN END OF PAGE ENTRY?  ONL02
         BE    DONEPAGE            SKIP IF YES                    ONL02
         CLC   HTEEND,=X'FFFFFF'   IS THIS AN END OF TABLE ENTRY? ONL02
         BE    DONETABL            SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
         ICM   R1,1,HTEFLAGS       GET MSG AUTHORITY REQUIREMENT  ONL02
         BZ    AUTHOK              SKIP IF MSG IS NOT RESTRICTED  ONL02
         EX    R1,AUTHTM           DOES USER HAVE AUTHORITY?      ONL02
         BO    AUTHOK              SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE IF YOU WISH TO OVERRIDE MESSAGE SUPPRESSION   ONL02
         SPACE 1                                                  ONL02
         B     MSGDONE             SKIP OVER MSG DISPLAY CODE     ONL02
         SPACE 1                                                  ONL02
AUTHTM   TM    QAHELP,*-*          EXECUTED - IS MSG AUTHORIZED?  ONL02
         SPACE 1                                                  ONL02
AUTHOK   DS    0H                  MSG IS AUTHORIZED FOR DISPLAY  ONL02
         SPACE 1                                                  ONL02
*  INSERT CODE HERE IF YOU WISH TO SUPPRESS AN AUTHORIZED MESSAGE ONL02
         SPACE 1                                                  ONL02
         MVC   QDMSG,QBLANK        BLANK OUT MSG WORK AREA        ONL02
         LA    R3,QDMSG            ADDR OF MSG WORK AREA          ONL02
         ST    R3,QDMSGA           SET MSG ADDR FOR DISPLAY RTN   ONL02
         SLR   R1,R1                                              ONL02
         IC    R1,HTEOFF           MSG OFFSET FROM COLUMN 1       ONL02
         LA    R3,0(R1,R3)         ADJUST AREA POINTER PER OFFSET ONL02
         SLR   R2,R2                                              ONL02
         ICM   R2,1,HTETLEN        LENGTH OF MSG TEXT             ONL02
         BZ    MSGLNERR            ERROR IF NO TEXT               ONL02
         LA    R1,0(R2,R1)         LENGTH OF OFFSET + TEXT        ONL02
         CL    R1,=F'80'           IS TOTAL LENGTH OK?            ONL02
         BH    MSGLNERR            ERROR IF TOO LONG              ONL02
         STH   R1,QDMLNG           SET MSG LENGTH FOR DISPLAY RTN ONL02
         BCTR  R2,0                TEXT LENGTH LESS 1 FOR EXECUTE ONL02
         EX    R2,MSGMVC           PLUG TEXT INTO MSG LINE        ONL02
         L     R15,=V(DISPLAY)     ADDR OF DISPLAY ROUTINE        ONL02
         BALR  R14,R15             LINK TO ROUTINE                ONL02
         SPACE 1                                                  ONL02
         LA    R5,1(,R5)           INCREMENT LINE COUNT           ONL02
         CLR   R5,R4               HAVE WE FILLED A SCREEN?       ONL02
         BL    MSGDONE             SKIP IF NO                     ONL02
         SLR   R5,R5               CLEAR LINE COUNT FOR NEW SCREENONL02
         SPACE 1                                                  ONL02
MSGDONE  DS    0H                  FINISHED WITH CURRENT MSG      ONL02
         SLR   R1,R1                                              ONL02
         IC    R1,HTETLEN          LENGTH OF MSG TEXT             ONL02
         LA    R6,HTETEXT(R1)      INDEX TO NEXT HELP TABLE ENTRY ONL02
         B     NEXTHTE             LOOP TO PROCESS NEXT ENTRY     ONL02
         SPACE 2                                                  ONL02
MSGMVC   MVC   0(*-*,R3),HTETEXT   EXECUTED - SET MSG TEXT        ONL02
         SPACE 1                                                  ONL02
MSGLNERR DS    0H                  MSG LENGTH ERROR               ONL02
         QTILT '*** QUEUE LOGIC ERROR - BAD HELP MSG LENGTH ***'  ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  END OF PAGE ENTRY FOUND, FILL OUT CURRENT HELP SCREEN          ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
DONEPAGE DS    0H                  COMPLETE CURRENT SCREEN        ONL02
         LA    R6,L'HTEPAGE(,R6)   POINT TO NEXT TABLE ENTRY      ONL02
         LTR   R5,R5               WAS ANYTHING DISPLAYED?        ONL02
         BNP   NEWPAGE             SKIP IF NO                     ONL02
         SPACE 1                                                  ONL02
         LR    R2,R4               COPY NUMBER OF AVAILABLE LINES ONL02
         SR    R2,R5               COMPUTE NUMBER OF UNUSED LINES ONL02
         BNP   NEWPAGE             SKIP IF SCREEN IS FULL         ONL02
         SPACE 1                                                  ONL02
         LA    R3,QDMSG            ADDR OF MSG WORK AREA          ONL02
         ST    R3,QDMSGA           SET MSG ADDR FOR DISPLAY RTN   ONL02
         MVI   QDMSG,C' '          SET A BLANK MESSAGE            ONL02
         MVC   QDMLNG,=H'1'         WITH A LENGTH OF ONE          ONL02
         SPACE 1                                                  ONL02
BLNKLOOP DS    0H                  FILL OUT CURRENT SCREEN        ONL02
         L     R15,=V(DISPLAY)     ADDR OF DISPLAY ROUTINE        ONL02
         BALR  R14,R15             LINK TO ROUTINE                ONL02
         BCT   R2,BLNKLOOP         LOOP IF MORE LINES TO BLANK    ONL02
         SPACE 1                                                  ONL02
NEWPAGE  DS    0H                  SETUP FOR NEXT SCREEN          ONL02
         SLR   R5,R5               CLEAR LINE COUNT FOR NEXT PAGE ONL02
         B     NEXTHTE             LOOP TO PROCESS NEXT HELP ENTRYONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  END OF HELP TABLE ENTRY FOUND, DONE WITH HELP DISPLAY          ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
DONETABL DS    0H                  DONE WITH HELP TABLE           ONL02
         AIF   (NOT &QISPF2).NOXTUTR
         USING  QDQTTY,R1
         L     R1,QVDQTTY
         MVC   QDHLINE,QBLANK
         CLC   QDHELP,=CL8'TQINDEX1'   INVALID COMMANDS
         BNE   TUTRCMDK
         MVC   QDHLINE,INVALID
         B     TUTRCMD
TUTRCMDK MVC   QDHELP,=CL8'TQTOPICS'  NAME OF TUTORIAL PANEL      DOR
TUTRCMD  EQU   *
         DROP  R1
.NOXTUTR ANOP
         QSTOP ,                   RETURN TO DISPLAY LAST SCREEN  ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  READ-ONLY DATA                                                 ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
HEADING  DC    CL80'THE FOLLOWING SUBCOMMANDS ARE SUPPORTED:'     ONL02
INVALID  DC    CL80'INVALID QUEUE COMMAND OR ENTER PF1 KEY  '  DOR1187
         SPACE 1                                                  ONL02
         LTORG ,                   DEFINE LITERAL ORIGIN          ONL02
         TITLE 'DEFINE HELP SCREENS'                              ONL02
******************************************************************ONL02
*                                                                 ONL02
*  DEFINE HELP SCREENS                                            ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         PUSH  PRINT               SAVE CURRENT PRINT STATUS      ONL02
         PRINT NOGEN               DON'T PRINT #H MACRO EXPANSIONSONL02
         SPACE 1                                                  ONL02
HELPTABL DS    0C                  START OF HELP TABLE            ONL02
         SPACE 1                                                  ONL02
         AIF  (&QISPF2).QITUTR
 #H NORM,4,'END               - EXIT QUEUE COMMAND'
 #H NORM,4,'STAT LEVEL        - DISPLAY ALL JOBS BEGINNING WITH LEVEL'
 #H NORM,4,'DJ   JOBNAME      - DISPLAY JOB BY JOBNAME'
 #H NORM,4,'JCL  JOBNAME      - LIST JCL FOR A JOB'
 #H NORM,4,'JLOG JOBNAME      - LIST JOBLOG FOR A JOB'
 #H NORM,4,'JMSG JOBNAME      - LIST SYSTEM MESSAGES FOR A JOB'
 #H NORM,4,'JHIS JOBNAME      - LIST JOB HISTORY INFORMATION'
 #H NORM,4,'DD   JOBNAME      - LIST SYSIN/SYSOUT DATASETS FOR A JOB'
 #H NORM,4,'PDDB JOBNAME      - LIST PDDB''S FOR A JOB'
 #H NORM,4,'LIST JOBNAME DSID - LIST A SYSIN OR SYSOUT DATASET'
 #H NORM,4,'LIST * +/-N         LIST NEXT OR PREVIOUS N''TH DATASET'
 #H NORM,4,'CC JOBNAME DSID   - LIST A SYSIN/SYSOUT DSN WITH '
 #H NORM,4,'                      CARRIAGE CONTROL '
 #H NORM,4,'OPT BL            - DISPLAY BLANK LINE (CC CMD ONLY)'
 #H NORM,4,'OPT NOBL          - DISPLAY NO BLANK LINE (SUPPRESSED)'
 #H NORM,4,'SAVE DSNAME       - CREATE A COPY OF THE CURRENT DATASET'
 #H NORM,4,'SPIN              - SEND COPY OF CURRENT DATASET TO SYSOUT'
 #H NORM,4,'PRINT ON CLASS DEST  - OPEN SCREEN LOG'
 #H NORM,4,'PRINT             - PRINT CURRENT SCREEN'
 #H NORM,4,'PRINT OFF         - CLOSE SCREEN LOG'
 #H NORM,4,'MODEL #           - SET 3270 MODEL 2, 3, 4, OR 5'
 #H NORM,0,'NOTES:  (1) DEFAULT FOR LEVEL IS LOGON ID'
 #H NORM,8,'(2) JOBNAME CAN BE JOBNAME, NUMBER, OR "*" FOR CURRENT JOB'
 #H NORM,8,'(3) DSID CAN BE DETERMINED BY USING SUBCOMMAND DD OR PDDB'
 #H NORM,8,'(4) DSNAME WILL BE EXPANDED TO USERID.DSNAME.DATA'
         SPACE 1                                                  ONL02
 #H PAGE                           INDICATE END OF PAGE           ONL02
         EJECT ,                                                  ONL02
         AIF  (NOT &QPFK).PFK1
 #H NORM,4,'PFK               - LIST PROGRAM FUNCTION KEYS'
 #H NORM,4,'PFK  NN  TEXT     - REDEFINE PROGRAM FUNCTION KEYS'
.PFK1    ANOP ,
 #H NORM,4,'FIND ''STRING'' COL(SS,EE)  - FIND CHARACTER STRING'
 #H NORM,4,'FALL ''STRING'' COL(SS,EE)  - FIND ALL OCCURRENCES OF'
 #H NORM,4,'                              STRING (COL DEFAULTS TO ALL)'
 #H NORM,4,'COL  #       - REPOSITION HORIZONTALLY TO COLUMN NUMBER'
 #H NORM,4,'@/MD #       - REPOSITION TO SPECIFIC RECORD NUMBER'
 #H NORM,4,'+/D  #       - REPOSITION FORWARD IN DATASET # RECORDS'
 #H NORM,4,'-/UP #       - REPOSITION BACKWARD IN DATASET # RECORDS'
 #H NORM,4,'T/TOP        - REPOSITION TO TOP OF DATASET'
 #H NORM,4,'B/BOTTOM     - REPOSITION TO BOTTOM OF DATASET'
 #H NORM,4,'HF/HB #      - FORWARD/BACKWARD # HALF PAGES'
 #H NORM,4,'PF/PB #      - FORWARD/BACKWARD # PAGES'
 #H NORM,4,' '                                                    ONL13
 #H NORM,0,'NOTES:  (1) STRING SPECIFICATION FOR FIND MAY BE DELIMITED'
         AIF   (&QONL).ONL1                                       ONL12
 #H NORM,8,'    WITH BLANKS, SINGLE QUOTES, OR DOUBLE QUOTES.'    ONL13
         AGO   .ONL2                                              ONL12
.ONL1    ANOP  ,                                                  ONL12
 #H NORM,8,'    WITH BLANKS, SINGLE QUOTES, DOUBLE QUOTES, OR WITH A'
 #H NORM,8,'    SLASH ("/").'                                     ONL12
.ONL2    ANOP  ,                                                  ONL12
         SPACE 1                                                  ONL02
 #H PAGE                           INDICATE END OF PAGE           ONL02
         EJECT ,                                                  ONL02
 #H ACTV,4,'DA           - DISPLAY ALL JOBS IN EXECUTION'
 #H ACTV,4,'DT           - DISPLAY TSO USERS'
 #H ACTV,4,'DS           - DISPLAY SYSTEM TASKS'
 #H ACTV,4,'DC TYPE      - DISPLAY CPU BATCH/STC/TSO  (BLANK,B/J/S/T)'
 #H BLOG,4,'DQ           - DISPLAY INPUT QUEUES'
 #H BLOG,4,'DI CLASS     - DISPLAY ALL JOBS IN INPUT CLASS'
 #H BLOG,4,'AI CLASS     - DISPLAY JOBS AVAILABLE FOR PROCESSING'
 #H BLOG,4,'HI CLASS     - DISPLAY HELD JOBS IN INPUT CLASS'
 #H BLOG,4,'DF           - DISPLAY OUTPUT QUEUES'
 #H BLOG,4,'DO CLASS     - DISPLAY ALL JOBS IN OUTPUT CLASS'
 #H BLOG,4,'WO           - DISPLAY ONLY OUTPUT JOBS WITH WRITER NAME SP+
               ECIFIED'
 #H BLOG,4,'AO CLASS     - DISPLAY AVAILABLE OUTPUT'
 #H BLOG,4,'HO CLASS     - DISPLAY HELD OUTPUT'
 #H BLOG,4,' '
 #H BLOG,8,'DEFAULT FOR CLASS IS ALL CLASSES'
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H BLOG,4,'----------------------------------------------------- '
 #H BLOG,4,'FO (NOTE2) - DISPLAY ALL JOBS IN OUTPUT CLASS BY FORMS/FCB'
 #H BLOG,4,'NOTE2    - OPERANDS FOR FO -'
 #H BLOG,4,'C=VVVV     VVVV = INCLUDE FCB IMAGE '
 #H BLOG,4,'C^VVVV     VVVV = EXCLUDE FCB IMAGE '
 #H BLOG,4,' '
 #H BLOG,4,'F=WWWWWW WWWWWW = INCLUDE FORMS '
 #H BLOG,4,'F^WWWWWW WWWWWW = EXCLUDE FORMS '
 #H BLOG,4,' '
 #H BLOG,4,'R=RMTYYYY     YYYY = INCLUDE REMOTE ID '
 #H BLOG,4,'R^RMTYYYY     YYYY = EXCLUDE REMOTE ID '
 #H BLOG,4,' '
 #H BLOG,4,'THE ABOVE OPERANDS MAY BE MIXED '
 #H BLOG,4,' AND BE ENTERED IN ANY ORDER. FOR EXAMPLE:      '
 #H BLOG,4,' FO Q=X F^STD '
 #H BLOG,4,'WOULD SHOW ALL SYSOUT=X THAT DOES NOT USE A STANDARD FORM'
 #H BLOG,4,'----------------------------------------------------- '
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SSSM,4,' '
 #H SSSM,4,'CAN JOBNAME <P>        - CANCEL JOB ("P" OPTION FOR PURGE)'
 #H SSSM,4,'DEL JOBNAME            - DELETE JOB'
 #H SSSM,4,'REQ JOBNAME <NEWCLASS> - RELEASE JOB''S HELD OUTPUT'
 #H SSSM,4,'ROUT JOBNUMBER  DEST  - REROUTE A JOB TO LOCAL/RMT'
 #H SYSP,4,'  JOBNUMBER MUST BE 4 DIGITS (ZERO FILL IF NECESSARY)'
 #H SYSP,4,'  DEST CAN BE LOCAL OR RMT1 THRU RMT9999.'
         SPACE 1                                                  ONL02
 #H PAGE                           INDICATE END OF PAGE           ONL02
         EJECT ,                                                  ONL02
 #H SLOG,4,'SLOG  ID  <SEQ>   - LIST THE SYSTEM LOG DATASET'
 #H SLOG,4,'FTIME HH.MM.SS    - REPOSITION SYSTEM LOG TO GIVEN TIME'
 #H SLOG,4,' '
 #H SLOG,8,'ID MAY BE A JOB# DETERMINED BY STATUS SYSLOG,'
 #H SLOG,8,'  OR IT MAY SPECIFY THE SYSTEM ID OF THE DESIRED SYSTEM'
 #H SLOG,8,'  (A NULL FIELD WILL LIST THE ACTIVE SYSTEM''S LOG)'
 #H SLOG,8,'DEFAULT FOR SEQ IS 0 (THE CURRENT SYSLOG DATASET)'
 #H SLOG,8,'  (USE A VALUE OF 1, 2, ... TO OBTAIN PREVIOUS DATASETS)'
 #H SLOG,4,' '
 #H EXEC,4,'TSO CMD PRMS      - ISSUE ANY TSO COMMAND W/OPTIONAL PARMS'
 #H SYSP,4,'XB  MTTR          - DISPLAY BLOCK FROM SYS1.HASPACE'
 #H SYSP,4,'                      USE "*" TO RE-SHOW AND "+" TO CHAIN'
 #H SYSP,4,'XD  JOBNAME DSID  - UNRESTRICTED DISPLAY OF DATASETS'
 #H SYSP,4,'XI                - DISPLAY ACTIVE INITIATORS'
 #H SYSP,4,'XJ  JOBNAME       - DISPLAY UNINTERPRETED JQES AND JOES'
 #H SYSP,4,'JQE JOBNAME       - DISPLAY JQE IN HEX/EBCDIC'
 #H SYSP,4,'JCT JOBNAME <OFFSET>  - DISPLAY JCT IN HEX/EBCDIC'
 #H SYSP,4,'IOT JOBNAME       - DISPLAY IOTS IN HEX/EBCDIC'          CL
 #H SYSP,4,'JOE JOBNAME       - DISPLAY JOES IN HEX/EBCDIC'
 #H SYSP,4,'HCT               - DISPLAY HCT $SAVE AREA'
 #H SYSP,4,'CS                - ISSUE SYSTEMS CONSOLE COMMAND'
         AIF   (NOT &LOCK).NOTLOCK                                   CL
 #H SYSP,4,'TGPS              - LIST HIGH TRACK GROUP USERS'         CL
         AGO   .LOCK                                                 CL
.NOTLOCK ANOP                                                        CL
 #H SYSP,4,'TGPS              - LIST HIGH TRACK GROUP USERS (A VERY SLOX
               W COMMAND)'
.LOCK    ANOP                                                        CL
         SPACE 1                                                  ONL02
 #H PAGE                           INDICATE END OF PAGE           ONL02
         AIF (NOT &QISPF).NOISPF
 #H SYSP,4,' ----- ISSUE SYSTEM CONSOLE COMMAND ------'
 #H SYSP,4,'CSYS "ANY SYSTEM/JES2 COMMAND" '
 #H SYSP,4,' ----- DUMP JES CONTROL BLOCKS      ------'
 #H SYSP,4,'XU JOBNAME CB        - DUMP CONTROL BLOCKS'
 #H SYSP,4,'   WHERE CB=JQE/IOT/JCT/JCB/PDDB/JOE/ALL'
 #H SYSP,4,'XU JOT               - DISPLAY JOT IN HEX/EBCDIC'
 #H SYSP,4,'XU HCT               - DISPLAY HCT $SAVE AREA'
 #H SYSP,4,'XU CKPT              - DISPLAY JES2 CHECKPOINT'
 #H SYSP,4,' ----- DISPLAY SYSTEM INDICATORS/RESOURCES -----'
 #H SYSP,4,'SRM  PAGE/PCCW/ASM/SWAP/PERF/RCT (DEFAULT AVG)'
 #H SYSP,4,'SRM  (NO PARM) SHOW AVERAGES  '
 #H SYSP,4,'SRM  ALL (ROTATE OF SUBCMDS) "HIT ENTER BUTTON REPEATLY" '
 #H SYSP,4,' -- DISPLAY MULTI-PROGRAMMING LEVEL (MPL) PER DOMAIN --'
 #H SYSP,4,'MPL          (DEFAULT ALL DOMAINS)'
 #H SYSP,4,'MPL T        (SHOW RTO OF TSO DOMAIN)'
 #H SYSP,4,'MPL XX       (SHOW DOMAIN WHERE XX = DOMAIN NUMBER (00-99)'
 #H SYSP,4,' ----- DISPLAY TAPE STATUS   ----'
 #H SYSP,4,'TAPE/TA              '
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,' ----- MONITOR ----'
 #H SYSP,4,'XM   EXCEPTION MONITOR'
 #H SYSP,4,'EXCEPTION MONITOR OUTPUT MESSAGES '
 #H SYSP,4,'---------------------------------------'
 #H SYSP,4,'SYSTEM EXCEPTION MESSAGES '
 #H SYSP,4,'--------------------------------------'
 #H SYSP,4,'CHANNEL XX   XXX% BUSY  FOR XXXXX SEC '
 #H SYSP,4,'UUU VVVVVV   XXX% BUSY  FOR XXXXX SEC '
 #H SYSP,4,'UUU VVVVVV   NOT READY  FOR XXXXX SEC '
 #H SYSP,4,'EXCESS SYSTEM PAGING FOR    XXXXX SEC '
 #H SYSP,4,'LOCAL PAGE I/O DEGRADED FOR XXXXX SEC '
 #H SYSP,4,'WTO BUFFER SHORTAGE, WQE COUNT= XXXXX '
 #H SYSP,4,'SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK '
 #H SYSP,4,'-++++++++++++++++++++++++++++++++++++++++++-'
 #H SYSP,4,'JOB RESOURCE USAGE EXCEPTION MESSAGES '
 #H SYSP,4,'--------------------------------------'
 #H SYSP,4,'JJJJJJJJ POSSIBLE LOOP FOR  XXXXX SEC '
 #H SYSP,4,'JJJJJJJJ XXX% CPU FOR       XXXXX SEC '
 #H SYSP,4,'JJJJJJJJ ABEND IN PROGRESS  XXXXX SEC '
 #H SYSP,4,'JJJJJJJJ EXCESS SWAP COUNT = XXXXX '
 #H SYSP,4,'JJJJJJJJ XXXXX FRAMES FOR   XXXXX SEC '
 #H SYSP,4,'-++++++++++++++++++++++++++++++++++++++++++-'
 #H SYSP,4,'JOB WAIT EXCEPTION MESSAGES '
 #H SYSP,4,'-------------------------------------- '
 #H SYSP,4,'(NOTE-A JOB IS CONSIDERED '
 #H SYSP,4,'        TO BE WAITING IF IT USES 0% CPU)'
 #H SYSP,4,'JJJJJJJJ ENQ SYSDSN   WAIT  XXXXX SEC       ENQ CONFLICT '
 #H SYSP,4,'JJJJJJJJ I/O ON UUU   WAIT  XXXXX SEC       I/O PENDING'
 #H SYSP,4,'JJJJJJJJ ALLOC QUEUE  WAIT  XXXXX SEC       ALLOC QUEUE'
 #H SYSP,4,'JJJJJJJJ REPLY NN     WAIT  XXXXX SEC       REPLY PENDING'
 #H SYSP,4,'JJJJJJJJ SWAP RRRRRR  WAIT  XXXXX SEC       SWAPPED OUT'
 #H SYSP,4,'     '
 #H SYSP,4,'   RRRRRR -     ( SWAP REASON CODES ) '
 #H SYSP,4,'   LONGWT           LONG WAIT '
 #H SYSP,4,'   AUXSTOR          AUXILLARY STORAGE SHORTAGE '
 #H SYSP,4,'   REALSTR          REAL STORAGE SHORTAGE '
 #H SYSP,4,'   DETWAIT          MSO DETECTED WAIT '
 #H SYSP,4,'   REQUEST          REQUEST SWAP '
 #H SYSP,4,'   ENQEXC           ENQ EXCHANGE '
 #H SYSP,4,'   WORKEXC          WORKLOAD EXCHANGE '
 #H SYSP,4,'   UNILATR          UNILATERAL '
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,' ----- ACTIVITY MONITOR ----'
 #H SYSP,4,'AM   J    (JOB    ACTIVITY MONITOR)'
 #H SYSP,4,'AM   I    (INIT   ACTIVITY MONITOR)'
 #H SYSP,4,'AM   S    (STC    ACTIVITY MONITOR)'
 #H SYSP,4,'AM   T    (TSO    ACTIVITY MONITOR)'
 #H SYSP,4,'AM   D    (DOMAIN ACTIVITY MONITOR)'
 #H SYSP,4,'AM        (ALL    ACTIVITY MONITOR)'
 #H SYSP,4,' ----- PAGING MONITOR ----'
 #H SYSP,4,'PM        (PAGING MONITOR)'
 #H SYSP,4,' ----- STORAGE USAGE ----'
 #H SYSP,4,'SA        (STORAGE USAGE)'
 #H SYSP,4,' ----- DEVICE BUSY MONITOR ----'
 #H SYSP,4,'DM        (DEVICE BUSY MONITOR)'
 #H SYSP,4,'DM DDD    (DDD=DEVICE UNIT #) OR DDX CATEGORY OR GROUP'
 #H SYSP,4,'DM DDD,J  (BY JOB STATISTICS)'
 #H SYSP,4,'DM DDD,S  (BY CYLINDER STATISTICS)'
 #H SYSP,4,'DM DDD,T=NNN (BY NNN PCT STATISTICS)'
 #H SYSP,4,' ----- CHANNEL BUSY MONITOR ----'
 #H SYSP,4,'CM        (CHANNEL BUSY MONITOR)'
 #H SYSP,4,'CM CC     (CC=CHANNEL UNIT #)'
 #H SYSP,4,'CM CC,J  (BY JOB STATISTICS)'
 #H SYSP,4,'CM CC,D  (BY DEVICE STATISTICS)'
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,' ----- DISPLAY ACTIVE ADDRESS SPACES ----'
 #H SYSP,4,'ASID STC/JOBS/TS/ALL '
 #H SYSP,4,'ASID "ASID#"/* '
 #H SYSP,4,'   '
 #H SYSP,4,'OUTPUT LINE  DESCRIPTIONS '
 #H SYSP,4,'      ID - ASID NUMBER '
 #H SYSP,4,'      DP - DISPATCHING PRIORITY '
 #H SYSP,4,'     JOB - JOBNAME '
 #H SYSP,4,'    STEP - STEPNAME '
 #H SYSP,4,'   FLAGS - XXXYY '
 #H SYSP,4,'     XXX - IN  - IN CORE, SWAPPED IN  '
 #H SYSP,4,'           NSW - NON-SWAPPABLE '
 #H SYSP,4,'           PVL - PRIVILEDGED (NON-SWAP EXCEPT LONG WAIT) '
 #H SYSP,4,'           AXS - AUX SHORTAGE FORCED SWAP '
 #H SYSP,4,'           OUT - SWAPPED OUT '
 #H SYSP,4,'           GOO - IN PROCESS OF BEING SWAPPED OUT '
 #H SYSP,4,'           GOI - IN PROCESS OF BEING SWAPPED IN '
 #H SYSP,4,'           GOB - CURRENTLY CHANGING STATUS '
 #H SYSP,4,'           ENQ - TEMPORARILY NON-SWAPPABLE DUE TO ENQ '
 #H SYSP,4,'           APG - AUTOMATIC-PRIORITY-GROUP APPLIES '
 #H SYSP,4,'           RMA - RMA ALGORITHM APPLIES (RTB=0) '
 #H SYSP,4,'      YY - TW  - TERMINAL WAIT '
 #H SYSP,4,'           MW  - LONG WAIT STATUS DETECTED BY MSO (MS6)'
 #H SYSP,4,'           LW  - EXPLICIT LONG WAIT '
 #H SYSP,4,'           NW  - NON-SWAPPABLE WAIT '
 #H SYSP,4,'           OW  - OUTPUT TERMINAL WAIT '
 #H SYSP,4,'           CP  - SIGINIFICANT CPU USER (SET BY IRARMCPM)'
 #H SYSP,4,'CPU TIME - STEP CPU TIME IN HOURS:MINUTES:SECONDS'
 #H SYSP,4,'    REAL - AMOUNT OF REAL CORE AT LAST PAGE-IN '
 #H SYSP,4,'    WORK - WORKING SET SIZE AT LAST SWAPIN '
 #H SYSP,4,'   G/P/D - PERFORMANCE GROUP/PERF GROUP PERIOD/DOMAIN'
 #H SYSP,4,'     SRC - SWAP OUT REASON CODES '
 #H SYSP,4,'           OTW - OUTPUT TERMINAL WAIT '
 #H SYSP,4,'           ITW - INPUT TERMINAL WAIT '
 #H SYSP,4,'            LW - LONGWAIT '
 #H SYSP,4,'           ASS - AUXILIARY STORAGE SHORTAGE '
 #H SYSP,4,'           RSS - REAL PAGEABLE STORAGE SHORTAGE '
 #H SYSP,4,'            DT - DETECTED WAIT '
 #H SYSP,4,'            RS - REQUESTED SWAP '
 #H SYSP,4,'            EE - ENQ EXCHANGE '
 #H SYSP,4,'           ERV - EXCHANGE OF RECOMMENDATION VALUE '
 #H SYSP,4,'             U - UNILATERAL '
 #H SYSP,4,'     SWC - NUMBER OF SWAPS '
 #H SYSP,4,'    SERV - SERVICE UNITS ACCUMALATED '
 #H SYSP,4,'     TRC - NUMBER OF TRANSACTIONS DURING SESSION '
 #H SYSP,4,'    SERV - SERVICE UNITS ACCUMALATED DURING SESSION '
 #H SYSP,4,' ----- DISPLAY DEVICE INTERVENTION REQUIRED ----'
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,'ALLO D/T/M/V/B (D=DISK, T=TAPE, M=MOUNTS V=VARIED B=BOTH)'
 #H SYSP,4,'ALLO S=VVVVVV (VVVVVV=FULL VOLSER NAME)'
 #H SYSP,4,'ALLO U=XXX (XXX=UNIT NUMBER)'
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,'---- DISPLAY FRAME STORAGE INFORMATION ----'
 #H SYSP,4,'FR  B           BAD FRAME REQUEST '
 #H SYSP,4,'FR  C           CSA DISPLAY REQUEST '
 #H SYSP,4,'FR  R           V=R DISPLAY REQUEST '
 #H SYSP,4,'FR  M           MEGABYTE DISPLAY REQUEST '
 #H SYSP,4,'FR  O           OFFLINE INTERCEPT REQUEST '
 #H SYSP,4,'---- DISPLAY STORAGE INFORMATION ----'
 #H SYSP,4,'SPM           DISPLAY STORAGE INFORMATION '
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,'---- STATUS OF JOBS  ----'
 #H SYSP,4,'JOBS ASID      4 LINES OF OUTPUT FOR AN ASID      '
 #H SYSP,4,'JOBS .JOBNM    4 LINES OF OUTPUT FOR AN JOBNAME   '
 #H SYSP,4,'JOBS           2 LINES FOR ALL ACTIVE TASKS       '
 #H SYSP,4,'JOBS 0000      4 LINES FOR ALL ACTIVE TASKS       '
 #H SYSP,4,'JOBS XX        2 LINES OF OUTPUT FOR SELECTED TYPE'
 #H SYSP,4,'JOBS XX,D      1 LINE OF DISPATCHABILITY OUTPUT   '
 #H SYSP,4,'JOBS XX,S      1 LINE OF OUTPUT FOR SELECTED TYPE '
 #H SYSP,4,'JOBS XX,L      4 LINES OF OUTPUT FOR SELECTED TYPE'
 #H SYSP,4,'  WHERE  XX  IS    -                            '
 #H SYSP,4,'       NN        SELECT ALL JOBS IN DOMAIN 00   '
 #H SYSP,4,'       $A        SELECT ALL JOB, TSU, AND STC   '
 #H SYSP,4,'       $J        SELECT ALL JOBS                '
 #H SYSP,4,'       $T        SELECT ALL TSO USERS           '
 #H SYSP,4,'       $S        SELECT ALL STARTED TASKS       '
 #H SYSP,4,'       $I        SELECT ALL IDLE INITIATORS     '
 #H SYSP,4,'LINE1 -   TEST00              JOBNAME           '
 #H SYSP,4,'          (000B)              ASID              '
 #H SYSP,4,'          DP(112)             ASCB DISP PRIORITY'
 #H SYSP,4,'          SWL(010/016)        SWAP LOAD (IN/OUT)'
 #H SYSP,4,'          SWC(0001)           SWAP COUNT        '
 #H SYSP,4,'LINE2 -   PERF-NRS(0B/07/0B)  PERFORMANCE GROUP '
 #H SYSP,4,'          DPRTY-NR(70/76)     OUCB DISP PRIORITY'
 #H SYSP,4,'          DMN(01)             DOMAIN NUMBER     '
 #H SYSP,4,'LINE3 -   OUCB FLAGS  (SEE FE HANDBOOK)         '
 #H SYSP,4,'LINE4 -   AS(FE2578)          ASCB ADDRESS      '
 #H SYSP,4,'          SR(06)              SWAP REASON CODE  '
 #H SYSP,4,'          QP(01)              DISP QUEUE POSITN '
 #H SYSP,4,'          OU(FE1080)          OUCB ADDRESS      '
 #H SYSP,4,'          A(0063/00000)       ADDRSPC/VIO SLOTS '
 #H SYSP,4,'** NOTE -  IF SWAP REASON CODE IS 00,  QUEUE    '
 #H SYSP,4,'           POSITION PRINTS INSTEAD              '
*#H SYSP,4,'
*#H SYSP,4,'AENQ '
*#H SYSP,4,' ----- LIST ENQUEUE (MAJOR/MINOR QCB NAMES) ----'
*#H SYSP,4,'LENQ '
 #H PAGE                           INDICATE END OF PAGE           ONL02
 #H SYSP,4,' CZAP COMMAND IS DEVELOPED AND HAVING DEBUGS-- DOR '
 #H SYSP,4,' CZAP COMMAND ATTEMPTS TO PERFORM THE BASIC FUNCTION OF '
 #H SYSP,4,' DISPLAYING AND MODIFYING CORE IN ANY ADDRESS SPACE '
 #H SYSP,4,' EXCEPT FOR LPA MODULES. '
 #H SYSP,4,' THE SYNTAX ACCEPTED IS AS FOLLOWS. '
 #H SYSP,4,'   CZAP EXIT,AAAA        TERMINATE MEMORY FOR ASID AAAA '
 #H SYSP,4,'   CZAP CHAP,AAAA,DDD    SET ASID AAAA TO DPRTY=DDD '
 #H SYSP,4,'   CZAP NOCANC,AAAA      SET ASID AAAA NON-CANCELLABLE '
 #H SYSP,4,'   CZAP OKCANC,AAAA      SET ASID AAAA CANCELABLE '
 #H SYSP,4,'   CZAP NOSWAP,AAAA      SET ASID AAAA NON-SWAPABLE '
 #H SYSP,4,'   CZAP OKSWAP,AAAA      SET ASID AAAA SWAPABLE '
 #H SYSP,4,'   CZAP UNNN              UCB'
 #H SYSP,4,'   CZAP SSSSSS,LL '
 #H SYSP,4,'   CZAP SSSSSS/VVVVVVVV/RRRRRRRR '
 #H SYSP,4,'   CZAP >AAAA,SSSSSS,LL '
 #H SYSP,4,'   CZAP >AAAA,SSSSSS/VVVVVVVV/RRRRRRRR '
 #H SYSP,4,' WHERE THE FOLLOWING MEANINGS HOLD '
 #H SYSP,4,'   NNN      THE CUU OF THE DESIRED DEVICE. 64 BYTES ARE'
 #H SYSP,4,'            DUMPPED. '
 #H SYSP,4,'   LL       NUMBER OF LINES OF 16 BYTES TO DUMP. '
 #H SYSP,4,'            LIMIT IS 16. '
 #H SYSP,4,'   SSSSSS   THE ADDRESS OF THE AFFECTED AREA '
 #H SYSP,4,'   VVVVVVVV THE VALUE EXPECTED TO BE FOUND AT XXXXXX '
 #H SYSP,4,'   RRRRRRRR THE VALUE TO PLACE AT XXXXXX '
 #H SYSP,4,'   AAAA     THE ASID OF THE ADDRESS SPACE TO WORK IN '
 #H SYSP,4,' '
 #H SYSP,4,' THE DEFAULTS ARE: '
 #H SYSP,4,' - IF >AAAA IS NOT SPECIFIED THEN THE MASTER SCHEDULAR'
 #H SYSP,4,' ADDRESS SPACE IS USED. '
 #H SYSP,4,' - IF LL IS NOT SPECIFIED THEN 64 BYTES ARE DUMPPED. '
 #H SYSP,4,' '
 #H SYSP,4,' NOTE: '
 #H SYSP,4,' - VVVVVVVV AND RRRRRRRR MUST BE 8 CHARACTERS LONG. ALL'
 #H SYSP,4,' OTHER VARIABLES CAN BE SHORTER THAN SHOWN. '
 #H PAGE                           INDICATE END OF PAGE           ONL02
.NOISPF    ANOP
           AGO  .QXISPF
*                                                               DOR1187
.QITUTR    ANOP                                                 DOR1187
 #H NORM,4,'THE FOLLOWING SUBCOMMANDS ARE SUPPORTED:'           DOR1187
 #H NORM,4,'ENTER "END" TO EXIT QUEUE COMMAND'                  DOR1187
 #H NORM,4,'OR ENTER "H" FOR GENERAL TUTORIAL PANEL AND PF1 KEY' DR1187
 #H NORM,4,'OR ENTER PF1 KEY OR "HELP" COMMAND FOR'             DOR1187
 #H NORM,4,'      WHEN YOU ENTERED ANY CURRENT COMMAND.'        DOR1187
.QXISPF    ANOP                                                 DOR1187
         SPACE 1                                                  ONL02
 #H END                            INDICATE END OF TABLE          ONL02
         SPACE 1                                                  ONL02
         POP   PRINT               RESTORE PRINT STATUS           ONL02
         SPACE 1                                                  ONL02
         TITLE 'DEFINE CONTROL BLOCK DSECT''S'                    ONL02
******************************************************************ONL02
*                                                                 ONL02
*  HELP TABLE ENTRY DSECT                                         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
HTEDSECT DSECT ,                   HELP TABLE ENTRY DSECT         ONL02
HTE      DS    0X                  ALTERNATE DSECT NAME           ONL02
HTEFLAGS DS    AL1                 SUB-COMMAND AUTHORITY FLAGS    ONL02
HTETLEN  DS    AL1                 LENGTH OF MESSAGE TEXT         ONL02
HTEOFF   DS    AL1                 SCREEN OFFSET OF MESSAGE TEXT  ONL02
HTEUSER  DS    AL1                 USER FLAG BYTE                 ONL02
HTETEXT  DS    0C                  MESSAGE TEXT                   ONL02
         SPACE 1                                                  ONL02
         ORG   HTE                 REDEFINE DSECT                 ONL02
HTEPAGE  DC    0XL3'00FFFF'        END OF PAGE ENTRY              ONL02
HTEEND   DC    0XL3'FFFFFF'        END OF TABLE ENTRY             ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  SAVE AREA/WORK AREA DSECT                                      ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
WORK     DSECT ,                   SAVE AREA/WORK AREA DSECT      ONL02
         DS    18F                 OS SAVE AREA                   ONL02
DWORD    DS    D                   SCRATCH DOUBLE WORD            ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*  GENERATE QCOMMON DSECT                                         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       ONL02
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL02
         QCOMMON                                                  ONL02
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL02
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    ONL02
         END   ,                                                  ONL02
                                                                    DOR
./       ADD   NAME=HEXBLK
HEXBLK   TITLE 'QUEUE COMMAND - HEXADECIMAL DUMP OF A BLOCK'      ONL01
HEXBLK   QSTART ,                  START HEXBLK CSECT ASSEMBLY    ONL01
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         L     R2,QCBLKA      BLOCK IOAREA ADDR                   UF013
***********************************************************************
*                                                                     *
*   VALIDATE AND CONVERT BLOCK ADDRESS                                *
*                                                                     *
***********************************************************************
         LH    R1,QLNG1       LENGTH OF USER PARM
         LTR   R1,R1          IS THE LENGTH ZERO?
         BNP   TILT           YES. TILT.
         CH    R1,=H'8'       IS THE LENGTH TOO BIG?
         BH    TILT           YES. TILT.
         CLI   QPARM1,C'*'    USE CURRENT BUFFER CONTENTS?        UF013
         BE    READOK         YES, SKIP THE READ                  UF013
         CLI   QPARM1,C'+'    CHAIN TO NEXT BLOCK?                UF013
         BNE   READ1          NO, CONTINUE WITH NORMAL CODE       UF013
         MVC   QCTRAK,0(R2)   GET NEXT BLOCK ADDRESS              UF013
         OC    QCTRAK,QCTRAK  TEST FOR END OF CHAIN               UF013
         BNZ   READ2          GO READ BLOCK IF OK                 UF013
         QTILT ' *** BLOCK CHAIN FIELD IS ZERO ***'               UF013
READ1    MVC   QDWORD,QPARM1  LEAVE THE ORIGINAL ALONE            UF013
         TR    QDWORD,TABLEH  CONVERT TO HEX                      UF013
         EX    R1,PACK        PACK INTO QCTRAK
***********************************************************************
*                                                                     *
*   READ THE BLOCK FROM HASPACE                                       *
*                                                                     *
***********************************************************************
READ2    DS    0H                                                 UF013
         LR    R1,R2          PARM FOR READSPC
         L     R15,=V(READSPC) ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
READOK   DS    0H                                                 UF013
***********************************************************************
*                                                                     *
*   PRINT THE BLOCK                                                   *
*                                                                     *
***********************************************************************
         LH    R0,HASPACE+62  LENGTH OF DATA                      UF012
         LH    R1,QLNG2       LENGTH OF USER OFFSET               UF013
         LTR   R1,R1          IS THE LENGTH ZERO?                 UF013
         BNP   DUMP1          YES. NONE SPECIFIED                 UF013
         CH    R1,=H'8'       IS THE LENGTH TOO BIG?              UF013
         BH    TILTO          YES, GIVE UP                        UF013
         EX    R1,OFFTR       CONVERT TO HEX                      UF013
         EX    R1,OFFPACK     PACK INTO QDWORD                    UF013
         LH    R1,QDWORD      PICK UP OFFSET                      UF013
         AR    R2,R1          ADD TO BASE ADDRESS                 UF013
         SR    R0,R1          SUBTRACT FROM TOTAL LENGTH          UF013
         SLL   R1,16          MOVE TO PROPER POSITION             UF013
         OR    R0,R1          INSERT INTO LENGTH REG              UF013
DUMP1    LR    R1,R2          POINT TO BUFFER READ                UF012
         L     R15,=V(HEXDUMP) ADDRESS OF DUMP ROUTINE            UF012
         BALR  R14,R15        LINK TO IT                          UF012
STOP     QSTOP
***********************************************************************
*                                                                     *
*   EXCEPTIONS AND RETURN                                             *
*                                                                     *
***********************************************************************
TILT     QTILT '*** BLOCK ADDRESS WAS OMITTED ***'
TILTO    QTILT '*** INVALID OFFSET SPRCIFIED ***'
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
PACK     PACK  QCTRAK(5),QDWORD(1) BLOCK ADDRESS                  UF013
OFFTR    TR    QPARM2,TABLEH       CONVERT TO HEX                 UF013
OFFPACK  PACK  QDWORD(3),QPARM2(1) PACK TO WORK AREA              UF013
         LTORG
* TABLE FOR HEX CONVERT
TABLEH   DC    CL193' '
         DC    X'0A0B0C0D0E0F',CL41' ',C'01234567890',CL6' '
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=HEXDUMP
HEXDUMP  TITLE 'QUEUE COMMAND - HEX DUMP OF PASSED DATA AREA'     ONL01
HEXDUMP  QSTART ,                  START HEXDUMP ASSEMBLY         ONL01
         L     R10,QVCKPT     LOAD BASE REG
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R8,QVPRINT     LOAD BASE REG
         USING QCPRINT,R8     BASE REG FOR DISPLAY WORK AREA
         LA    R8,QPLINE      LOAD BASE REG
         USING WORK,R8        BASE REG FOR PRINT LINE AREA
***********************************************************************
*                                                                     *
*   INPUT:                                                            *
*        R1    POINTER TO DATA AREA TO BE DUMPED                      *
*        R0    OFFSET AND LENGTH OF AREA TO DUMP (2 BYTES EACH)       *
*              (OFFSET IS USED FOR PRINT DISPLACEMENT FIELD ONLY)     *
*              (AS AN EXAMPLE, THE DUMP OF A JCT IS MOST USEFUL       *
*              IF THE OFFSET IS SET TO THE LENGTH OF ITS              *
*              ASSOCIATED IOB)                                        *
*                                                                     *
***********************************************************************
         LR    R6,R1          POINTER TO START OF DATA AREA
         LR    R3,R0          PRINT OFFSET FOR AREA
         SRL   R3,16          MOVE TO PROPER POSITION
         LR    R4,R0          LENGTH TO DUMP
         SLL   R4,16          THROW AWAY OFFSET
         SRL   R4,16          MOVE LENGTH TO PROPER POSITION
***********************************************************************
*                                                                     *
*   FORMAT THE AREA                                                   *
*                                                                     *
***********************************************************************
         MVC   QDHLINE,QBLANK BLANK THE TITLE LINE
         LA    R5,WORKLINE    POINT TO LINE IN WORK AREA
         ST    R5,QDMSGA      STORE ADDR OF PRINT LINE
         MVC   QDMLNG,=H'80'  LENGTH OF MESSAGE
         CLC   QDLNELEN,=H'132' LONG ENOUGH FOR DOUBLE LINE?
         BL    *+4+6          NO, SKIP RESET OF LENGTH
         MVC   QDMLNG,=H'132' LENGTH OF MESSAGE
         SPACE 1
LOOP     MVC   WORKLINE,QBLANK  BLANK THE WORK AREA
         STH   R3,QDWORD      GET OFFSET
         UNPK  OFFSET(5),QDWORD(3) CONVERT TO HEX
         MVI   OFFSET+L'OFFSET,C' ' CLEAR GARBAGE BYTE
         TR    OFFSET,TABLEP  TRANSLATE TO PRINTABLE CHARACTERS
         SPACE 1
         LR    R2,R6          POINTER TO DATA AREA
         LA    R1,4           NUMBER OF WORDS IN LINE AREA
         LA    R14,O1         POINTER TO FIRST OUTPUT AREA
         LA    R15,P1         POINTER TO EBCDIC AREA
         MVI   PS1,C'*'       SET STARS
         MVI   PS2,C'*'       SET STARS
         CLC   QDLNELEN,=H'132' SHORT LINES?
         BL    LOOP1          YES, SKIP SETTING ALTERNATE PRINT AREA
         MVI   PS1,C' '       FIX OTHER FLAG
         MVI   PS2,C' '       FIX OTHER FLAG
         LA    R15,P1A        ALTERNATE EBCDIC AREA
         MVI   PS1A,C'*'      SET STARS
         MVI   PS2A,C'*'      SET STARS
         SPACE 1
LOOP1    UNPK  0(9,R14),0(5,R2)  UNPACK DATA TO PRINT LINE
         TR    0(8,R14),TABLEP TRANSLATE TO PRINTABLE CHARACTERS
         MVI   8(R14),C' '    CLEAR WASTE BYTE
         MVC   0(4,R15),0(R2) COPY DATA TO PRINT AREA
         TR    0(4,R15),PRTAB FIX UNPRINTABLES
         LA    R2,4(,R2)      NEXT DATA AREA
         LA    R3,4(,R3)      BUMP OFFSET
         LA    R14,9(,R14)    NEXT HEX AREA
         LA    R15,4(,R15)    NEXT PRINT AREA
         SH    R4,=H'4'       DROP BY PROCESSED LENGTH
         BNP   PRINT1
         BCT   R1,LOOP1       LOOP FOR ALL FOUR WORDS
         SPACE 1
         CLC   QDLNELEN,=H'132' SHORT LINES?
         BL    PRINT1         YES, PRINT WHAT WE HAVE
         LA    R14,O5         POINT TO OUTPUT AREA
         LA    R15,P5A        POINT TO OUTPUT AREA
         LA    R1,4           NUMBER OF WORDS
         SPACE 1
LOOP2    UNPK  0(9,R14),0(5,R2)  UNPACK DATA TO PRINT LINE
         TR    0(8,R14),TABLEP TRANSLATE TO PRINTABLE CHARACTERS
         MVI   8(R14),C' '    CLEAR WASTE BYTE
         MVC   0(4,R15),0(R2) COPY DATA TO PRINT AREA
         TR    0(4,R15),PRTAB FIX UNPRINTABLES
         LA    R2,4(,R2)      NEXT DATA AREA
         LA    R3,4(,R3)      BUMP OFFSET
         LA    R14,9(,R14)    NEXT HEX AREA
         LA    R15,4(,R15)    NEXT PRINT AREA
         SH    R4,=H'4'       DROP BY PROCESSED LENGTH
         BNP   PRINT1
         BCT   R1,LOOP2       LOOP FOR ALL FOUR WORDS
         SPACE 1
PRINT1   L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         LR    R15,R6         ADDR OF DATA JUST DUMPED
         LR    R6,R2          ADDRESS OF NEXT TO DUMP
         SR    R2,R15         LENGTH JUST DUMPED
         BCTR  R2,0           DROP FOR EXECUTE
         SPACE 1
SKIP     DS    0H
         LTR   R4,R4          TEST REMAINING LENGTH
         BNP   STOP           YES. GO HOME.
         EX    R2,CLC         IS THIS RECORD THE SAME AS PREVIOUS?
         BNE   LOOP           NO, PRINT IT
         LA    R6,1(R2,R6)    BUMP TO NEXT AREA
         LA    R3,1(R2,R3)    BUMP OFFSET
         SR    R4,R2          DROP BY LENGTH DUMPED
         BCTR  R4,0           FIX FOR EXECUTE STUFF
         B     SKIP           SKIP PRINTING DUPS
         SPACE 1
CLC      CLC   0(*-*,R15),0(R6)  TEST FOR SAME DATA
***********************************************************************
*                                                                     *
*   RETURN                                                            *
*                                                                     *
***********************************************************************
STOP     QSTOP
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
* TABLE TO REMOVE UNPRINTABLES
PRTAB    DC    CL64' '
         DC    192AL1(*-PRTAB)
* TABLE FOR HEX UNCONVERT
TABLEP   EQU   *-240
         DC    C'0123456789ABCDEF'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
WORK     DSECT ,
WORKLINE DS    CL132          LINE TO PRINT
         ORG   WORKLINE       BACK UP TO WORK LINE
OFFSET   DS    CL4            OFFSET INTO AREA
         DS    XL3            SPACER
O1       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O2       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O3       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O4       DS    CL8            OUTPUT HEX AREA
         DS    XL3            SPACER
O5       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O6       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O7       DS    CL8            OUTPUT HEX AREA
         DS    X              SPACER
O8       DS    CL8            OUTPUT HEX AREA
         DS    XL2            SPACER
PS1A     DS    C              STAR FOR PRINT AREA
P1A      DS    CL4            PRINT AREA
P2A      DS    CL4            PRINT AREA
P3A      DS    CL4            PRINT AREA
P4A      DS    CL4            PRINT AREA
P5A      DS    CL4            PRINT AREA
P6A      DS    CL4            PRINT AREA
P7A      DS    CL4            PRINT AREA
P8A      DS    CL4            PRINT AREA
PS2A     DS    C              STAR FOR PRINT AREA
         ORG   O5-1           BACK UP FOR SHORT LINES
PS1      DS    C              STAR FOR PRINT AREA
P1       DS    CL4            PRINT AREA
P2       DS    CL4            PRINT AREA
P3       DS    CL4            PRINT AREA
P4       DS    CL4            PRINT AREA
PS2      DS    C              STAR FOR PRINT AREA
         ORG   ,              BACK TO NORMAL ADDRESSING
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=IEBUPDTE
//IEBUPDTE JOB ,JACK,CLASS=Z,COND=(4,LT)
/*JOBPARM Q=F,I
//UPDTE  EXEC  PGM=IEBUPDTE,PARM=NEW
//SYSPRINT DD  SYSOUT=A
//SYSUT2   DD  DSN=NER.S685.NEW.QUEUE,DISP=SHR
//SYSIN    DD  DSN=JGS.ONL.DATA,DISP=SHR
//*
//DIRC   EXEC  PGM=QIUTDIRC
//SYSPRINT DD  SYSOUT=A
//OLD      DD  DISP=SHR,DSN=JES2.SHARE.NERDC.QUEUE
//NEW      DD  DISP=SHR,DSN=NER.S685.NEW.QUEUE
//SYSIN    DD  *
 UNIQUE OPT=LIST,ADD=OLD,BDD=NEW
/*
./       ADD   NAME=INIT
INIT     QSTART 'QUEUE COMMAND - INITIALIZATION ROUTINES',        DOR XX
               HASPEQU=YES
         GBLB  &QSP           MVS/SP OPTION                       UF020
         GBLB  &QISPF         ISPF INTERFACE                      DOR
         GBLB  &QSP133        MVS/SP 1.3.3 OPTION                 UF046
         GBLB  &QSP136        MVS/SP 1.3.6 OPTION FLAG            DOR
         GBLB  &QDBC          DBC    OPTION                       UF024
         GBLB  &QONL          ONL    OPTION                       ONL08
         GBLB  &LOCK          LOCKHEED OPTION                        CL
***********************************************************************
*                                                                     *
*   LOAD QCOMMON                                                      *
*                                                                     *
***********************************************************************
*
****
*******  IF YOU WANT TO CHANGE THE NAME FOR THE COMMON AREA,
****               THIS IS THE ONLY REFERENCE TO IT.
*
         AIF   (&QONL).ONL08                                      ONL08
         L     R11,=V(QCOMMON) ADDR OF QCOMMON                    UF002
         LTR   R11,R11        SEE IF LINKED IN                    UF002
         BNZ   LOADED         YES, CONTINUE                       UF002
.ONL08   ANOP  ,                                                  ONL08
         SPACE 1                                                  UF002
         LOAD  EP=QISPFTST    QUEUE COMMON AREA
         LR    R11,R0         ADDR OF QCOMMON
         SPACE 1                                                  UF002
LOADED   DS    0H                                                 UF002
         L     R1,4(R13)      PREVIOUS SAVE AREA
         ST    R11,64(R1)     UPDATE R11 IN PREVIOUS SAVE AREA
         ST    R1,QFRSTSA     STORE ADDR OF FIRST SAVEAREA IN QCOMMON
         USING QDAIR,R10      BASE REG FOR DAIR WORK
         L     R10,QVDAIR     LOAD BASE REG
         USING QCKPT,R9       BASE REG FOR CKPT WORK
         L     R9,QVCKPT      LOAD BASE REG
         USING QDISPLAY,R8    BASE REG FOR DISPLAY WORK
         L     R8,QVDSPL      LOAD BASE REG
         AIF (NOT &QISPF).NOISPFS                                 DOR
         MVC   QISPR13(4),24(R2) SAVE ISPFQUE BASE ADDRESS        DOR
         MVC   QISPR12(4),28(R2) SAVE ISPFQUE BASE ADDRESS        DOR
*----------------------------------------------------------------
*----------------------------------------------------------------
.NOISPFS ANOP                                                     DOR
         USING WORK,R13       ADDRESSING FOR SAVE/WORK AREA       UF024
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   VERIFY A TSO ENVIRONMENT, FIND THE ADDRRESS OF THE PROTECTED  ONL02
*   STEP CONTROL BLOCK, AND VERIFY SOME FIELDS IN THE COMMAND     ONL02
*   PROCESSOR PARAMETER LIST.                                     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         LA    R3,QDWORK           ADDR FOR EXTRACT ANSWER AREA   ONL02
         LA    R4,QAEXTLST         ADDR OF EXTRACT PARAMETER LIST ONL02
         EXTRACT (R3),FIELDS=(TSO,PSB),MF=(E,(R4))  EXTRACT INFO  ONL02
         SPACE 1                                                  ONL02
         L     R1,QDWORK           PICKUP ADDR OF TSO INDICATOR   ONL02
         TM    0(R1),X'80'         IS THIS A TSO ADDRESS SPACE?   ONL02
         BZ    QAABORT             IF NOT, ABORT                  ONL02
         SPACE 1                                                  ONL02
         L     R1,QDWORK+4         PICKUP ADDR OF PSCB            ONL02
         LTR   R1,R1               IS PSCB AVAILABLE?             ONL02
         BZ    QAABORT             IF NOT, ABORT                  ONL02
         SPACE 1                                                  ONL02
         USING PSCB,R1             NOTE PSCB ADDRESSABILITY       ONL02
         USING CPPL,R2             NOTE CPPL ADDRESSABILITY       ONL02
         SPACE 1                                                  ONL02
         CLM   R1,15,CPPLPSCB      VERIFY PSCB ADDR IN CPPL       ONL02
         BNE   QAABORT             ABORT IF ADDR'S DON'T MATCH    ONL02
         CLC   PSCBUPT,CPPLUPT     VERIFY UPT ADDR IN CPPL        ONL02
         BNE   QAABORT             ABORT IF ADDR'S DON'T MATCH    ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   GET THE USERID AND ITS LENGTH AND SAVE THEM IN QCOMMON        ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         MVC   QLOGON(L'PSCBUSER),PSCBUSER  SET USERID IN QCOMMON ONL02
         SLR   R0,R0               CLEAR FOR INSERT               ONL02
         IC    R0,PSCBUSRL         PICKUP LENGTH OF USERID        ONL02
         ST    R0,QLOGONLN         SET LENGTH IN QCOMMON          ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   CHECK PSCB FOR OPERATOR AUTHORITY                             ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         TM    PSCBATR1,PSCBCTRL   DOES USER HAVE OPER AUTHORITY? ONL02
         BZ    SKIPOPER            SKIP IF NO                     ONL02
         OI    QAFLAGS,QAFXOPER    SHOW USER HAS OPER AUTHORITY   ONL02
SKIPOPER DS    0H                                                 ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   FILL IN DAIR PARAMETER LIST FROM THE CPPL                     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         MVC   DAPLUPT,CPPLUPT     USER PROFILE TABLE             ONL02
         MVC   DAPLECT,CPPLECT     ENVIRONMENT CNTL TABLE         ONL02
         MVC   DAPLPSCB,CPPLPSCB   PROTECTED STORAGE CNTL BLK     ONL02
         DROP  R1                                                 CL006
         SPACE 2                                                  ONL02
         AIF   (NOT &QDBC).NODBC1 SKIP IF DBC NOT INSTALLED       UF024
******************************************************************UF024
*                                                                 UF024
*   IF USER HAS OPER AUTHORITY, ESTABLISH ESTAE ENVIRONMENT       UF024
*                                                                 UF024
******************************************************************UF024
         SPACE 1                                                  ONL02
         TM    QAFLAGS,QAFXOPER    DOES USER HAVE OPER AUTHORITY? ONL02
         BZ    NOTOPER             SKIP IF NO                     ONL02
         SPACE 1                                                  ONL02
         LOAD  EP=DBC,ERRET=NOTOPER  LOAD ESTAE ROUTINE           UF024
         LR    R3,R0          ADDR OF ROUTINE                     UF024
         MVC   WORKAREA(DBCMFLN),DBCMFL GET ESTAE PARM LIST       UF024
         ESTAE (R3),MF=(E,WORKAREA)  CREATE THE ESTAE             UF024
         OI    QFLAG1,QFLG1DBC  INDICATE NEED TO DELETE AT TERM   UF024
         B     NOTOPER        CONTINUE PROCESSING                 UF024
DBCMFL   ESTAE ,MF=L          LIST FORM OF ESTAE                  UF024
DBCMFLN  EQU   *-DBCMFL       LENGTH OF LIST FORM ESTAE           UF024
NOTOPER  DS    0H                                                 ONL02
.NODBC1  ANOP                                                     UF024
         AIF  (NOT &QISPF).NOISPF                          DOR
***********************************************************************
*                                                                     *
*   MOVE COMMAND BUFFER TO REPLY BUFFER                    DOR        *
*                                                                     *
***********************************************************************
         L     R1,CPPLCBUF    ADDR OF COMMAND BUFFER       DOR
         LH    R3,0(R1)       LENGTH OF COMMAND BUFFER     DOR
         LH    R4,2(R1)       OFFSET TO FIRST DATA BYTE    DOR
         LA    R1,4(R1,R4)    FIRST DATA BYTE              DOR
         SR    R3,R4          SUBTRACT OFFSET FROM LENGTH  DOR
         SH    R3,=H'4'       SUBTRACT OVERHEAD            DOR
         SH    R3,=H'1'       IS LENGTH ZERO?              DOR
         BM    SKIP           YES. SKIP IT.                DOR
         EX    R3,OCBUF       TRANSLATE TO UPPER CASE      DOR
         MVC   QDREPLY,QBLANK BLANK THE REPLY LINE         DOR
         CH    R3,=H'62'      IS LENGTH OVER 63?           DOR
         BNH   OK             NO. USE IT.                  DOR
         LA    R3,62          USE MAXIMUM LENGTH           DOR
OK       EX    R3,MVCBUF      MOVE THE DATA                DOR
         LA    R3,1(R3)       INCREMENT TO TRUE LENGTH     DOR
         STH   R3,QDRLNG      STORE REPLY LENGTH           DOR
         AGO  .ISPFD                                       DOR
.NOISPF  ANOP                                              DOR
         EJECT                                                    CL006
***********************************************************************
*                                                                     *
*        SCAN COMMAND BUFFER FOR KNOWN KEYWORDS.  IF FOUND TAKE       *
*        APPROPRIATE ACTION.  IF NONE FOUND OR RECOGNIZED,            *
*        THEN PASS TO OUR PARSE ROUTINE.                              *
*                                                                     *
***********************************************************************
         SPACE 2
         MVC   PPLUPT(12),DAPLUPT  COPY UPT, ECT, ECB             CL006
         MVC   PPLPCL,=A(PCLSTART) ADDR OF POINTER CNTL LIST      CL006
         MVC   PPLCBUF,CPPLCBUF    ADDR OF COMMAND BUFFER         CL006
         SPACE 2                                                  ONL02
         CALLTSSR EP=IKJPARS,MF=(E,PPLUPT) GO PARSE BUFFER        CL006
         SPACE 2                                                  CL006
         LTR   R15,R15             CONTINUE IF PARSE              CL006
         BNZ   NOVOL                WENT AWRY                     CL006
         SPACE 1                                                  CL006
         L     R7,PARSBACK         PARSE DESCRIPTER LIST BASE     CL006
         SPACE 1                                                  CL006
         USING IKJPARMD,R7         PARSE ADDRESSABILITY           CL006
         SPACE 1                                                  CL006
         CLC   PSTRING,=F'0'       SKIP IF THERE HAS BEEN         CL006
         BE    NOSTRING             NO QUEUE SUB-COMMAND GIVEN    CL006
         MVC   QDREPLY,QBLANK      INITIALIZE REPLY AREA          CL006
         L     R6,PSTRING          ADDR OF STRING                 CL006
         LH    R1,PSTRING+4        LENGTH OF STRING               CL006
         BCTR  R1,0                MACHINE LENGTH                 CL006
         EX    R1,MVCSTRIN         COPY STRING TO REPLY AREA      CL006
         SPACE 2                                                  CL006
NOSTRING CLC   PPREFIX,=H'0'       SKIP IF PREFIX IS NOT          CL006
         BE    NOPREF               PROVIDED                      CL006
         MVC   QPREFIX,=CL8' '     BLANK ASSEMBLED VERSION        CL006
         L     R6,XPREFIX          ADDRESS OF PREFIX              CL006
         LH    R1,XPREFIX+4        LENGTH OF PREFIX               CL006
         BCTR  R1,0                MACHINE LENGTH OF PREFIX       CL006
         EX    R1,MVCPREF          COPY PREFIX TO QCOMMON         CL006
         SPACE 2                                                  CL006
NOPREF   CLC   PUNIT,=H'0'         SKIP IF NO UNIT                CL006
         BE    NOUNIT               PROVIDED                      CL006
         MVC   DA08UNIT,=CL8' '    BLANK ASSEMBLED VERSION        CL006
         L     R6,XUNIT            ADDRESS OF UNIT STRING         CL006
         LH    R1,XUNIT+4          LENGTH OF UNIT STRING          CL006
         BCTR  R1,0                MACHINE LENGTH                 CL006
         EX    R1,MVCUNIT          COPY UNIT TO QCOMMON           CL006
         SPACE 2                                                  CL006
NOUNIT   CLC   PVOL,=H'0'          SKIP IF NO VOLUME              CL006
         BE    NOVOL                SERIAL PROVIDED               CL006
         MVC   DA08SER,=CL8' '     BLANK ASSEMBLED VERSION        CL006
         L     R6,XVOL             ADDR OF VOL STRING             CL006
         LH    R1,XVOL+4           LENGTH OF VOL STRING           CL006
         BCTR  R1,0                MACHINE LENGTH                 CL006
         EX    R1,MVCVOL           COPY VOLSER TO QCOMMON         CL006
         SPACE 2                                                  CL006
NOVOL    IKJRLSA (R7)              FREE PARSE DESCRIPTOR LIST     CL006
         B     SKIP                                               CL006
         SPACE 1                                                  CL006
MVCVOL   MVC   DA08SER(*-*),0(R6)  *** EXECUTE ONLY ***           CL006
MVCUNIT  MVC   DA08UNIT(*-*),0(R6) *** EXECUTE ONLY ***           CL006
MVCPREF  MVC   QPREFIX(*-*),0(R6)  *** EXECUTE ONLY ***           CL006
MVCSTRIN MVC   QDREPLY(*-*),0(R6)  *** EXECUTE ONLY ***           CL006
         DROP  R7                                                 CL006
.ISPFD   ANOP                                                     DOR
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   OBTAIN CPU ID AND MODEL TYPE AND DISPLAY ON FIRST LINE OF PANEL   *
*   SUPPORTING MULTI-SESSIONS                                         *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         L     R3,16                    CVT POINTER
         LA    R2,256(0,0)              BACKUP TO
         SR    R3,R2                    CVT PREFIX
         USING CVTFIX,R3                CVT DSECT ADDRESSABILITY
         L     R2,CVTSMCA               POINT TO SMF WORK AREA
         LA    R2,0(R2)                 CLEAR HIGH ORDER BYTE
         LTR   R2,R2                    SMF IN USE (ADDR ^ 0) ?
         BZ    NOSMF                    BIF NO
         MVC   #CPUID,16(R2)            MOVE CPU ID TO SCREEN
         MVC   CPUMDL,CVTMDL            DETERMINE CPU MODEL
         DROP  R3                       DROP CVT DSECT ADDRESSABILITY
         SPACE
NOSMF    DS    0H
         UNPK  TENBYTE,CPUMDL           UNPACK CPU MODEL
         TR    TENBYTE+1(4),TRTABLE     TRANSLATE
         MVC   CPUMDL,TENBYTE+3         MOVE BACK
         MVC   #CPUMDL,CPUMDL           MOVE CPU MODEL TO SCREEN
         USING  QDQTTY,R1
         L     R1,QVDQTTY
         MVC   QCPUID,#CPUID            SAVE IN COMMON AREA
         MVC   QCPUMDL,#CPUMDL          SAVE IN COMMON AREA
         DROP  R1
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   OBTAIN BLOCK ADDR TABLE FOR LISTDS                                *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
*SKIP    GETMAIN R,LV=65536*4                                     CL006
SKIP     GETMAIN R,LV=65536                                       DOR
         ST    R1,QGETA1      SAVE START ADDR OF GETMAIN
         ST    R1,QCSTART     STORE STARTING ADDR OF TABLE
*        A     R1,=A(65536*4) END OF TABLE
         A     R1,=A(65536)   END OF TABLE                        DOR
         ST    R1,QCEND
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR QUEUE COMMAND START-UP        ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QASTART           PERFORM START-UP AUTHORIZATION ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   ALLOCATE HASPCKPT                                                 *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         MVC   DA08DDN,=CL8'HASPCKPT' DDNAME FOR ALLOCATE
         GETMAIN R,LV=2+44         WORK AREA                      CL006
         ST    R1,DA08PDSN         SET POINTER TO DSNAME          CL006
         LA    R1,DSNCKPT          ADDR OF CHECKPOINT DSN SUFFIX  CL006
         BAL   R14,BUILDSN         GO BUILD DATA SET NAME         CL006
         MVI   DAIRFLAG,X'08' REQUEST ALLOCATE FUNCTION
         L     R15,=V(ALLOCATE) ADDR OF ALLOCATE MODULE
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM PRE-OPEN CHECKPOINT/SPOOL AUTHORIZATION CHECK         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QABEFOPN          PRE-OPEN CKPT/SPOOL AUTH CHECK ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   OPEN HASPCKPT, READ FIRST BLOCK OF CHECKPOINT                     *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         OPEN  MF=(E,HOCKPT)  OPEN HASPCKPT
         L     R2,QCSTART     USE TABLE AREA FOR IOAREA
         POINT HASPCKPT,TIR3  POINT PAST SYNC RECORDS
         READ  HDECB1,SF,,(R2),MF=E READ FIRST RECORD
         CHECK HDECB1
*                                                                 UF039
*        GETMAIN DECB WORK AREA FOR CKPT ROUTINE                  UF039
*                                                                 UF039
         SR    R0,R0          CLEAR FOR IC                        UF039
         IC    R0,DCBNCP-IHADCB+HASPCKPT  NUMBER OF CHANNEL PGMS  UF039
         MH    R0,=Y(HDECB1L) TIMES LENGTH OF A DECB              UF039
         GETMAIN R,LV=(0)     GET ENOUGH STORAGE                  UF039
         ST    R1,QCDECBPT    SAVE ADDRESS FOR CKPT ROUTINE       UF039
***********************************************************************
*                                                                     *
*   COMPUTE OFFSET TO FIRST PDDB IN IOT                               *
*                                                                     *
***********************************************************************
         USING $SAVEBEG,R2    BASE REG FOR CHECKPOINT
         CLC   =C'JES2',$HASPID    MAKE SURE IS VALID HCT         UF046
         BE    HCTOK               YES, CONTINUE                  UF046
         TPUT  MESSAGE3,L'MESSAGE3,EDIT,MF=(E,QTPUT) TELL USER    UF046
         ABEND 90,DUMP             ABORT                          UF046
HCTOK    DS    0H                                                 UF046
         AIF   (NOT &QSP136).NO136A                                 DOR
***********************************************************************
*                                                                     *
*   INITIALIZE SYSTEM ID'S FROM CHECKPOINT SHARED Q CONTROL ELEMENTS  *
*      - JOHN GRADY SULLIVAN - LOMA LINDA UNIVERSITY MEDICAL CENTER   *
*                                                                     *
***********************************************************************
         LH    R3,$QSEMAX     GET MAX # OF DEFINED SYSTEMS    /* JGS */
         LA    R4,QSYSID+8    => QCOMMON SYSTEM ENTRY - SID(1)/* JGS */
         LA    R5,$SAVEEND    => QSE'S IN CHECKPOINT RECORD   /* JGS */
         USING QSE,R5         ADDRESSABILITY TO QSE'S         /* JGS */
SIDLOOP  DS    0H                                             /* JGS */
         MVC   0(4,R4),QSESID SYSTEM ID TO QCOMMON            /* JGS */
         MVC   4(4,R4),QBLANK BLANK NEXT 4 BYTES              /* JGS */
         LA    R4,8(,R4)      => NEXT ENTRY IN QCOMMON        /* JGS */
         TM    QSESTAT,QSELAST   IS THIS THE LAST QSE ?       /* JGS */
         BO    SIDLOOPE       BIT=1 => YES, LAST, SO BRANCH   /* JGS */
         LA    R5,QSELEN(,R5) => NEXT QSE                     /* JGS */
         BCT   R3,SIDLOOP     LOOP FOR THE NUMBER OF SYSTEMS  /* JGS */
SIDLOOPE DS    0H                                             /* JGS */
         DROP  R5                                             /* JGS */
***********************************************************************
*                                                                     *
*   COMPUTE SIZE OF DAS AREA ON CHECKPOINT                            *
*                                                                     *
***********************************************************************
         LH    R15,$SPOLNUM        NUMBER OF SPOOL VOLUMES
         MH    R15,=Y(DASSIZ)      TIME SIZE OF EACH DAS
         LA    R15,BFPLEN(,R15)    ADD BUFFER PREFIX
         LA    R15,4095(,R15)      NUMBER OF CHECKPOINT
         SRL   R15,12               RECORDS
         ST    R15,QCTDASL         SAVE NR OF BLOCKS FOR DAS
         AGO   .QSP1                                                DOR
.NO136A  ANOP                                                       DOR
         AIF   (&QSP).QSP1                                        UF020
         LH    R5,$NUMTGV     NUMBER OF TRACK GROUPS PER VOLUME
         AIF   (&QSP136).XSP136 DOR
         LA    R5,7(R5)       ROUND UP TO MULTIPLE OF 8
.XSP136  ANOP           DOR
         SRL   R5,3           DIVIDE BY 8
         SR    R0,R0          ZERO OUT R0
         IC    R0,$NUMDA      NUMBER OF SPOOL VOLUMES
         MR    R4,R0          LENGTH OF TRACK GROUP MAP IN R5
         AGO   .QSP2                                              UF020
.QSP1    ANOP                                                     UF020
         LH    R5,$NUMTG      NUMBER OF TRACK GROUPS PER VOLUME   UF020
         AIF   (&QSP136).XSP1362 DOR
         LA    R5,7(R5)       ROUND UP TO MULTIPLE OF 8           UF020
.XSP1362 ANOP           DOR
         SRL   R5,3           DIVIDE BY 8                         UF020
.QSP2    ANOP                                                     UF020
         LR    R1,R5          SAVE LENGTH OF TRACK GROUP MAP
         AIF   (&QSP136).X136B                                      DOR
         LA    R5,IOTTGMAP-IOTDSECT+TGMAP-TGMDSECT+3(R5) OFFSET   UF046
         N     R5,=F'-4'      ROUND TO FULL WORD BOUNDARY
         ST    R5,QCPDDB1     SAVE OFFSET TO FIRST PDDB IN IOT
.X136B   ANOP                                                       DOR
         AIF   (NOT &QSP133).C29A                                 UF046
***********************************************************************
*                                                                     *
*   COMPUTE NUMBER OF TRACK GROUP MAPS ON CKPT                        *
*                                                                     *
***********************************************************************
         AIF   (NOT &LOCK).NOTLOCK                                   CL
         MH    R1,=H'3'            NUMBER OF BYTES * 3               CL
         AGO   .LOCK                                                 CL
.NOTLOCK SLL   R1,1                NUMBER OF BYTES * 2            UF046
.LOCK    ANOP
         AIF   (NOT &QSP136).NO136C                                 DOR
         LA    R1,BFPLEN(,R1)      ADD BUFFER PREFIX                 CL
.NO136C  ANOP                                                       DOR
         LA    R1,4095(,R1)        PREPARE TO ROUND                  CL
         SRL   R1,12               DIVIDE BY 4K                   UF046
         STH   R1,QCTGML           NUMBER OF BLOCKS FOR TG MAPS   UF046
.C29A    ANOP                                                     UF046
         AIF   (NOT &QSP).QSP3                                    UF020
***********************************************************************
*                                                                     *
*   COMPUTE NUMBER OF JIX BLOCKS ON CKPT                              *
*                                                                     *
***********************************************************************
         LH    R5,$NUMJBNO    NUMBER OF JOB NUMBERS               UF020
         LA    R5,1(,R5)       PLUS 1 FOR HEADER                  UF020
         SLL   R5,1           TIMES LENGTH OF 2                   UF020
         AIF   (NOT &QSP136).NO136D                                 DOR
         LA    R5,BFPLEN(,R5) ADD BUFFER PREFIX                      CL
.NO136D  ANOP                                                       DOR
         LA    R5,4095(R5)    PREPARE TO ROUND                    UF020
         SRL   R5,12          DIVIDE BY 4096                      UF020
         STH   R5,QCJIXL      NUMBER OF BLOCKS FOR JIX            UF020
.QSP3    ANOP                                                     UF020
***********************************************************************
*                                                                     *
*   COMPUTE NUMBER OF JQE BLOCKS ON CKPT                              *
*                                                                     *
***********************************************************************
         LH    R6,$MAXJOBS    NUMBER OF JQES
         LA    R6,1(,R6)       PLUS 1 FOR EYE-CATCHER
         AIF   (NOT &QSP136).NO136E                                 DOR
         MH    R6,=AL2(JQEBLEN+4) MULTIPLY BY LENGTH OF JQE            *
                                   ASSUMING 1 WORD FOR SPOOLS USED MASK
         LA    R6,BFPLEN(,R6) ADD BUFFER PREFIX
         AGO   .X136E                                               DOR
.NO136E  ANOP                                                       DOR
         MH    R6,=AL2(JQELNGTH) MULTIPLY BY LENGTH OF JQE
.X136E   ANOP                                                       DOR
         LA    R6,4095(R6)    PREPARE TO ROUND
         SRL   R6,12          DIVIDE BY 4096
         STH   R6,QCJQTL      NUMBER OF BLOCKS FOR JQES
         AIF   (NOT &QSP136).NO136F                                 DOR
***********************************************************************
*                                                                     *
*   COMPUTE NUMBER OF PST BLOCKS IN CKPT                              *
*                                                                     *
***********************************************************************
         LH    R15,$NUMJOES        NUMBER OF JOES
         LA    R5,BFPLEN(,R5) ADD BUFFER PREFIX                      CL
         LA    R15,4095(,R15)      PREPARE TO ROUND
         SRL   R15,12              NUMBER OF 4K BLOCKS
         ST    R15,QCPSTL          SAVE NUMBER OF BLOCKS
         AGO   .X136F                                               DOR
.NO136F  ANOP                                                       DOR
.X136F   ANOP                                                       DOR
***********************************************************************
*                                                                     *
*   COMPUTE NUMBER OF JOT BLOCKS IN CKPT                              *
*                                                                     *
***********************************************************************
         LH    R3,$NUMJOES    NUMBER OF JOES
         LA    R3,NJOTPRFX(,R3) ADJUSTED LENGTH OF JOT PREFIX
         MH    R3,=AL2(JOESIZE) MULTIPLY BY LENGTH OF JOE
         AIF   (NOT &QSP136).NO136D1                                DOR
         LA    R3,BFPLEN(,R3) ADD BUFFER PREFIX                     DOR
.NO136D1 ANOP                                                       DOR
         LA    R3,4095(R3) PREPARE TO ROUND
         SRL   R3,12          DIVIDE BY 4096
         STH   R3,QCJOTL      NUMBER OF BLOCKS FOR JOT
***********************************************************************
*                                                                     *
*   COMPUTE TOTAL LENGTH OF QSES                                      *
*                                                                     *
***********************************************************************
         LA    R4,QSELEN      QSE LENGTH
         AIF   (NOT &QSP136).NO136G                                 DOR
         MH    R4,$QSEMAX   MULTIPLY LENGTH TIMES NO OF QSES        DOR
         AGO   .X136G                                               DOR
.NO136G  ANOP                                                       DOR
         MH    R4,$QSENO      MULTIPLY LENGTH TIMES NUMBER OF QSES
         AIF   (&QSP133).C29C                                     UF046
         AIF   (NOT &QSP).QSP5                                    UF020
         ALR   R4,R5          ADD ONE BYTE FOR EACH JIX BLOCK     UF020
******************************************************************UF020
*                                                                 UF020
*   COMPUTE NUMBER OF MSQ BLOCKS ON CKPT                          UF020
*                                                                 UF020
******************************************************************UF020
         LH    R1,$NUMRJE     NUMBER OF REMOTES                   UF020
         MH    R1,=Y(3)       TIMES LENGTH OF 3                   UF020
         LA    R1,3(,R1)       PLUS HEADER LENGTH                 UF020
         LA    R1,4095(R1)    PREPARE TO ROUND                    UF020
         SRL   R1,12          DIVIDE BY 4096                      UF020
         ALR   R4,R1          ADD 1 BYTE FOR EACH BLOCK           UF020
******************************************************************UF020
*                                                                 UF020
*   COMPUTE NUMBER OF RSO BLOCKS ON CKPT                          UF020
*                                                                 UF020
******************************************************************UF020
         LH    R1,$NUMRJE     NUMBER OF REMOTES                   UF020
         LA    R1,4095(R1)    PREPARE TO ROUND                    UF020
         SRL   R1,12          DIVIDE BY 4096                      UF020
         ALR   R4,R1          ADD 1 BYTE FOR EACH BLOCK           UF020
******************************************************************UF020
*                                                                 UF020
*   COMPUTE NUMBER OF LCK BLOCKS ON CKPT                          UF020
*                                                                 UF020
******************************************************************UF020
*        LH    R1,$NUMLCK     NUMBER OF LOAD CKPT ELEMENTS        UF020
         LA    R1,9*7         NUMBER OF LOAD CKPT ELEMENTS        UF020
         MH    R1,=Y(LCKSIZE) TIMES LENGTH OF EACH                UF020
         LA    R1,4095(R1)    PREPARE TO ROUND                    UF020
         SRL   R1,12          DIVIDE BY 4096                      UF020
         ALR   R4,R1          ADD 1 BYTE FOR EACH BLOCK           UF020
.QSP5    ANOP                                                     UF020
         ALR   R4,R6          ADD ONE BYTE FOR EACH JQE BLOCK
         ALR   R4,R3          ADD ONE BYTE FOR EACH JOT BLOCK
.C29C    ANOP  ,                                                  UF046
.X136G   ANOP                                                     DOR
***********************************************************************
*                                                                     *
*   COMPUTE HASPACE BUFFER SIZE                                       *
*                                                                     *
***********************************************************************
         LH    R5,$BUFSIZE    BLKSIZE FOR HASPACE
         STH   R5,HASPACE+62  STORE IN DCB
         STH   R5,HDECB2+6    STORE IN DECB
         LA    R5,63(R5)      PREPARE TO ROUND
         N     R5,=F'-64'     ROUND TO 64 BYTE BOUNDARY
***********************************************************************
*                                                                     *
*   OBTAIN BUFFERS FOR HASPCKPT AND HASPACE                           *
*                                                                     *
***********************************************************************
         LR    R14,R5         HASPACE BUFFER SIZE
         MH    R14,=H'3'      3 BUFFERS
         LA    R1,1(R6,R3)    NUMBER OF BLOCKS IN CKPT DS
         AIF   (NOT &QSP).QSP6                                    UF020
         AH    R1,QCJIXL      ADD NUMBER OF JIX BLOCKS            UF020
.QSP6    ANOP                                                     UF020
         AIF   (NOT &QSP133).C29D                                 UF046
         AH    R1,QCTGML           ADD NUMBER OF TGM BLOCKS       UF046
.C29D    ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136H                                 DOR
         A     R1,QCTDASL     ADD NUMBER OF DAS BLOCKS
         A     R1,QCPSTL      ADD NUMBER OF PST BLOCKS
.NO136H  ANOP                                                       DOR
         ST    R1,QCJOTL      STORE RECORD COUNT
         SLL   R1,12          MULTIPLY BY 4096
         LA    R0,256(R1,R14) ADD CKPT BUFFERS, HASPACE BUFFERS, SLOP
         ST    R0,QGETL2      SAVE LENGTH OF GETMAIN AREA
         GETMAIN R,LV=(0)     OBTAIN BUFFERS
         ST    R1,QGETA2      SAVE ADDRESS OF GETMAIN AREA
         ST    R1,QCJQTL      BUFFER FOR FIRST CKPT REC
         AIF   (NOT &QSP136).NO136I                                DOR
         LR    R14,R1              COMPUTE ADDR OF JQE EXTENSION
         LA    R14,$SAVELEN(,R14)  ACCOUNT FOR CHECKPOINTED HCT
         ALR   R14,R4              ACCOUNT FOR QSE'S
         ST    R14,QCJQEXA         SAVE ADDR OF JQE EXTENSION
.NO136I  ANOP                                                       DOR
         AH    R1,=H'4096'    INCREMENT
         AIF   (NOT &QSP136).NO136K                                 DOR
         LA    R0,BFPLEN(,R1)    ADD BUFFER PREFIX                  DOR
         ST    R0,QCTDASA          BUFFER FOR DAS BLOCKS
         L     R15,QCTDASL         NUMBER OF DAS BLOCKS
         SLL   R15,12              TIME 4096
         AR    R1,R15              INCREMENT
         LA    R0,BFPLEN(,R1) ADD BUFFER PREFIX
         ST    R0,QCTGMA           BUFFER FOR TGM BLOCKS            DOR
.NO136K  ANOP                                                       DOR
         AIF   (NOT &QSP133).C29F                                 UF046
         AIF   (&QSP136).SO136K                                    DOR
         ST    R1,QCTGMA           BUFFER FOR TGM BLOCKS          UF046
.SO136K  ANOP                                                       DOR
         LH    R15,QCTGML          NUMBER OF TGM BLOCKS           UF046
         SLL   R15,12              TIMES 4096                     UF046
         AR    R1,R15              INDREMENT                      UF046
.C29F    ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136J                                 DOR
         LA    R0,BFPLEN(,R1) ADD BUFFER PREFIX                     DOR
         ST    R0,QCJIXA      BUFFER FOR JIX BLOCKS                 DOR
.NO136J  ANOP                                                       DOR
         AIF   (NOT &QSP).QSP7                                    UF020
         AIF   (&QSP136).SO136J                                     DOR
         ST    R1,QCJIXA      BUFFER FOR JIX BLOCKS               UF020
.SO136J  ANOP                                                       DOR
         LH    R15,QCJIXL     NUMBER OF JIX BLOCKS                UF020
         SLL   R15,12         TIMES 4096                          UF020
         AR    R1,R15         INCREMENT                           UF020
.QSP7    ANOP                                                     UF020
         AIF   (NOT &QSP136).NO136L                                 DOR
         LA    R0,BFPLEN(,R1) ADD BUFFER PREFIX
         ST    R0,QCJQTA      BUFFER FOR JQE BLOCKS
         AGO   .SO136L
.NO136L  ANOP                                                       DOR
         ST    R1,QCJQTA      BUFFER FOR JQE BLOCKS
.SO136L  ANOP
         SLL   R6,12          MULTIPLY BY 4096
         AR    R1,R6          INCREMENT
         AIF   (NOT &QSP136).NO136M                                 DOR
         LA    R0,BFPLEN(,R1) ADD BUFFER PREFIX                      CL
         ST    R0,QCPSTA           BUFFER OF PST BLOCKS
         L     R15,QCPSTL          NUMBER OF PST BLOCKS
         SLL   R15,12              MULTIPLY BY 4096
         AR    R1,R15              ADDR OF JOE BLOCKS
         LA    R0,BFPLEN(,R1) ADD BUFFER PREFIX
         ST    R0,QCJOTA      BUFFER FOR JOE BLOCKS DOR
         AGO   .SO136M
.NO136M  ANOP                                                       DOR
         ST    R1,QCJOTA      BUFFER FOR JOE BLOCKS
.SO136M  ANOP                                                       DOR
         SLL   R3,12          MULTIPLY BY 4096
         AR    R1,R3          INCREMENT
         ST    R1,QCJCTA      BUFFER FOR JCT
         AR    R1,R5          INCREMENT
         ST    R1,QCIOTA      BUFFER FOR IOT
         AR    R1,R5          INCREMENT
         ST    R1,QCBLKA      BUFFER FOR DATA BLOCKS
         SPACE 1                                                  ONL16
         L     R1,QCJCTA           ADDR OF JCT BUFFER             ONL16
         AIF   (NOT &QSP136).NO136N                                 DOR
         SL    R1,=A(JCTSTART-JCT)  ADJUST FOR BUFFER PREFIX        DOR
         AGO   .X136N                                               DOR
.NO136N  ANOP                                                       DOR
         SL    R1,=A(JCTSTART-JCTDSECT)  ADJUST FOR BUFFER PREFIX ONL16
.X136N   ANOP                                                       DOR
         ST    R1,QCJCTA           SAVE ADJUSTED JCT POINTER      ONL16
         SPACE 1                                                  ONL16
         AIF   (NOT &QSP).QSP8                                    UF020
         LA    R1,$JQHEADS+$JQHEADL-$SAVEBEG OFFSET 1ST JQE HEAD  UF020
         AGO   .QSP9                                              UF020
.QSP8    ANOP                                                     UF020
         LA    R1,$JQHEADS+2-$SAVEBEG OFFSET TO FIRST JQE HEADER
.QSP9    ANOP                                                     UF020
         A     R1,QCJQTL      BASE OF FIRST CKPT REC
         ST    R1,QCJQHEAD    ADDR OF FIRST JQE HEADER
***********************************************************************
*                                                                     *
*   ALLOCATE AND OPEN HASPACE                                         *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136O                                 DOR
         L     R3,QCJQTL           ADDR OF I/O AREA FOR CKPT RCDS
         AH    R3,=H'4096'         BUMP PAST HEADER RECORD
         READ  HDECB1,SF,,(R3),MF=E READ IN DAS
         CHECK HDECB1              ASSUME ALL DAS IN ONE BLOCK
         LA    R3,BFPLEN(,R3)      BUMP PAST BUFFER ID
         USING DAS,R3              SET ADDRESSING                 UF046
         AGO   .X136O                                               DOR
.NO136O  ANOP                                                       DOR
         LA    R3,$SAVEEND(R4) ADDR OF DA CKPT INFO
         AIF   (NOT &QSP133).C29G                                 UF046
         USING DASDSECT,R3         SET ADDRESSING                 UF046
.C29G    ANOP  ,                                                  UF046
.X136O   ANOP                                                       DOR
         MVC   DA08DDN,=CL8'HASPACE' DDNAME FOR ALLOCATE
         LA    R1,DSNSPACE         ADDR OF HASPACE DSN SUFFIX     CL006
         BAL   R14,BUILDSN         GO BUILD DATA SET NAME         CL006
         LA    R4,9           MAX POSSIBLE SPOOLS FOR QUEUE       UF020
         AIF   (&QSP).QSP10                                       UF020
         IC    R4,$NUMDA      MAXIMUM NUMBER OF SPOOL VOLUMES
.QSP10   ANOP                                                     UF020
         LA    R7,QCDCBL      LENGTH OF HASPACE DCB
         MR    R6,R4          COMPUTE LENGTH OF DCB POOL
         GETMAIN R,LV=(R7)    OBTAIN DCB POOL
         ST    R7,QGETL3      SAVE LENGTH OF GETMAIN
         ST    R1,QGETA3      SAVE ADDRESS OF GETMAIN
         LR    R7,R1          SAVE ADDR OF DCB POOL
         LA    R8,QCSPOOLS-4  ADDR OF OPEN LIST
         SR    R6,R6          ACTUAL NUMBER OF SPOOL VOLUMES
         MVC   DA08SER(5),$SPOOL PATTERN FOR VOLSER
SPOOL1   LA    R5,DEVTAB      ADDR OF DEVICE CHARACTERISTICS TBL
         AIF   (NOT &QSP133).C29H                                 UF046
         TM    DASFLAG,DASEXSTS    DOES VOLUME EXIST?             UF046
         BZ    SPOOL4              NO, SKIP THIS ONE              UF046
         TM    DASFLAG2,DASINACT   IS IT INACTIVE?                UF046
         BO    SPOOL4              YES, SKIP IT                   UF046
         LH    R15,DASNOTGE        NUMBER OF TRACKS IN EXTENT     CL001
         A     R15,QCTNUMTG        ACCUMULATE ACTIVE              CL001
         ST    R15,QCTNUMTG         TRACK GROUP COUNT             CL001
         AGO   .C29I                                              UF046
.C29H    ANOP  ,                                                  UF046
         CLI   0(R3),0        IS THIS VOLUME UNUSED?
         BE    SPOOL4         YES. TRY NEXT.
.C29I    ANOP  ,                                                  UF046
SPOOL2   CLI   0(R5),X'FF'    IS THIS THE END OF TABLE?
         BE    ABORT          YES. UNSUPPORTED DEVICE TYPE.
         AIF   (NOT &QSP133).C29J                                 UF046
         CLC   0(1,R5),DASTYPE     IS IT A MATCH?                 UF046
         AGO   .C29K                                              UF046
.C29J    ANOP  ,                                                  UF046
         CLC   0(1,R5),0(R3)  IS THIS A MATCH?
.C29K    ANOP  ,                                                  UF046
         BE    SPOOL3         YES. GO WITH IT.
         LA    R5,12(R5)      NEXT TABLE ENTRY
         B     SPOOL2         TRY NEXT ENTRY
SPOOL3   MVC   QCTRKCYL-QCSPOOLS+4+2(2,R8),2(R5) SET TRK/CYL         CL
         MVC   DA08UNIT,4(R5) MOVE UNIT NAME
         AIF   (NOT &QSP133).C29L                                 UF046
         MVC   DA08SER+5(1),DASVOLID+5 LAST CHAR OF VOLSER        UF046
         AGO   .C29M                                              UF046
.C29L    ANOP  ,                                                  UF046
         MVC   DA08SER+5(1),1(R3) LAST DIGIT OF VOLSER
.C29M    ANOP  ,                                                  UF046
         LA    R6,1(R6)       INCREASE COUNT BY ONE
         STC   R6,DA08DDN+7   UPDATE DDNAME
         OI    DA08DDN+7,X'F0' MAKE IT A VALID NUMBER
         L     R15,=V(ALLOCATE) ADDR OF ALLOCATE MODULE
         BALR  R14,R15        GO TO IT
         MVC   0(QCDCBL,R7),HASPACE MOVE PATTERN DCB TO POOL
         MVC   47(1,R7),DA08DDN+7 UPDATE THE DDNAME
         ST    R7,4(R8)       STORE DCB ADDR IN OPEN LIST
         LA    R7,QCDCBL(R7)  INCREMENT TO NEXT DCB
SPOOL4   LA    R8,4(R8)       NEXT ENTRY IN OPEN LIST
         AIF   (NOT &QSP133).C29N                                 UF046
         LA    R3,DASSIZ(,R3)      NEXT VOLUME                    UF046
         AGO   .C29O                                              UF046
.C29N    ANOP  ,                                                  UF046
SPOOL4   LA    R3,6(R3)       NEXT VOLUME
.C29O    ANOP  ,                                                  UF046
         BCT   R4,SPOOL1      BRANCH IF MORE VOLUMES.
         L     R1,DA08PDSN         ADDR OF WORK AREA              CL006
         FREEMAIN R,LV=2+44,A=(1)  FREE WORK AREA                 CL006
         SPACE 2                                                     CL
***********************************************************************
*                                                                     *
*        OPEN ONE DCB FOR EACH ACTIVE EXTENT.                         *
*                                                                     *
***********************************************************************
         SPACE 2
         LA    R4,9                MAX POSSIBLE SPOOLS FOR QUEUEJKAUG84
         LA    R8,QCSPOOLS         ADDR OF FIRST DCB POINTER         CL
         SPACE 1                                                     CL
SPOOL5   OC    0(4,R8),0(R8)       SKIP IF THIS EXTENT               CL
         BZ    SPOOL6               IS NOT ACTIVE                    CL
         OI    0(R8),X'80'         SET END OF LIST INDICATOR         CL
         OPEN  MF=(E,(R8))         OPEN ONE EXTENT                   CL
         NI    0(R8),X'7F'         TURN OFF BIT JUST FOR NEATNESSKAUG84
SPOOL6   LA    R8,4(,R8)           BUMP TO NEXT EXTENT               CL
         BCT   R4,SPOOL5           CONTINUE IF ANY MORE              CL
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM POST-OPEN CHECKPOINT/SPOOL AUTHORIZATION CHECK        ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAAFTOPN          POST-OPEN CKPT/SPOOL AUTH CHECKONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   GO HOME                                                           *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         QSTOP
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   ABORT QUEUE COMMAND PROCESSING                                ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
QAABORT  DS    0H                  ABORT QUEUE COMMAND PROCESSING ONL02
         WTO   'QUEUE COMMAND ABORTED - INVALID ENVIRONMENT',     ONL02X
               ROUTCDE=(11)        TELL USER WHY                  ONL02
         SPACE 1                                                  ONL02
         ABEND 913                 ABEND U913                     ONL02
         EJECT                                                    CL006
***********************************************************************
*                                                                     *
*        CONSTRUCT DATA SET NAME FOR JES2 DISK DATA SETS.             *
*                                                                     *
*        R1 = ADDR OF DSN PREFIX                                      *
*        R14= LINK REGISTER                                           *
*                                                                     *
***********************************************************************
         SPACE 2
BUILDSN  L     R15,DA08PDSN        ADDR OF WORK AREA              CL006
         MVI   2(R15),C' '         BLANK DATA SET                 CL006
         MVC   3(43,R15),2(R15)     NAME WORK AREA                CL006
         MVC   2(8,R15),QPREFIX    SET PREFIX FROM COMMON         CL006
         LA    R15,9(R15)          ADDR OF LAST POSSIBLE CHAR     CL006
         CLI   0(R15),C' '         SKIP IF NON-BLANK              CL006
         BNE   *+8                  CHARACTER FOUND               CL006
         BCT   R15,*-8               ELSE KEEP LOOKING            CL006
         MVI   1(R15),C'.'         SET PERIOD                     CL006
         MVC   2(8,R15),0(R1)      COPY DSN SUFFIX                CL006
         LA    R15,2+7(R15)        ADDR OF LAST POSSIBLE CHAR     CL006
         CLI   0(R15),C' '         SKIP IF NON-BLANK              CL006
         BNE   *+8                  CHARACTER FOUND               CL006
         BCT   R15,*-8               ELSE KEEP LOOKING            CL006
         L     R1,DA08PDSN         ADDR OF WORK AREA              CL006
         LA    R1,1(R1)            ADDR OF FIRST BYTE OF NAME-1   CL006
         SR    R15,R1              LENGTH OF ENTIRE NAME          CL006
         L     R1,DA08PDSN         ADDR OF WORK AREA              CL006
         STH   R15,0(R1)           SET LENGTH FOR DAIR            CL006
         BR    R14                  AND RETURN                    CL006
***********************************************************************
*                                                                     *
*   UNSUPPORTED DEVICE TYPE. ABORT.                                   *
*                                                                     *
***********************************************************************
ABORT    TPUT  MESSAGE,L'MESSAGE,EDIT,MF=(E,QTPUT)   TELL THE USER
         ABEND 98,DUMP        QUIT.
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
         DS    0F
OCBUF    OC    0(1,R1),QBLANK TRANSLATE COMMAND TO UPPER CASE
MVCBUF   MVC   QDREPLY(1),0(R1) MOVE DATA TO REPLY
DEVTAB   DC    X'0900',H'19',CL8'3330' DEVTYPE,TRK/CYL,DEVNAME
         DC    X'0B00',H'30',CL8'3350'
         DC    X'0D00',H'19',CL8'3330-1'
         DC    X'0E00',H'15',CL8'3380'                            UF037
         DC    X'FFFF'
         DS    0F
TIR3     DC    X'00000300'    POINT PAST SYNC RECORDS
DSNCKPT  DC    CL8'HASPCKPT'                                      CL006
DSNSPACE DC    CL8'HASPACE'                                       CL006
MESSAGE  DC    C'UNSUPPORTED DEVICE TYPE SPECIFIED FOR SPOOL'
MESSAGE3 DC    C'INVALID HCT SAVEAREA ON CKPT'                    UF046
TRTABLE  DS    0CL256
         DC    CL240' '
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
         EJECT                                                    CL006
***********************************************************************
*                                                                     *
*        CONSTRUCT PARSE PARAMETER LISTS                              *
*                                                                     *
***********************************************************************
         SPACE 2
PCLSTART IKJPARM DSECT=IKJPARMD                                   CL006
         SPACE 2                                                  CL006
         AIF   (NOT &QSP136).NO136P                                 DOR
PSTRING  IKJIDENT 'SUB-COMMAND',ASTERISK,FIRST=ALPHA,OTHER=ANY,   CL006*
               CHAR                                               CL006
         AGO   .X136P                                               DOR
.NO136P  ANOP                                                       DOR
PSTRING  IKJIDENT 'SUB-COMMAND',ASTERISK,FIRST=ALPHA,OTHER=ANY    CL006*
               MAXLNTH=63                                         CL006
.X136P   ANOP                                                       DOR
         SPACE 1                                                  CL006
PPREFIX  IKJKEYWD ,                                               CL006
         SPACE 1                                                  CL006
         IKJNAME 'PREFIX',SUBFLD=SPREFIX                          CL006
         SPACE 1                                                  CL006
PUNIT    IKJKEYWD ,                                               CL006
         SPACE 1                                                  CL006
         IKJNAME 'UNIT',SUBFLD=SUNIT                              CL006
         SPACE 1                                                  CL006
PVOL     IKJKEYWD ,                                               CL006
         SPACE 1                                                  CL006
         IKJNAME 'VOL',SUBFLD=SVOL                                CL006
         SPACE 5                                                  CL006
SPREFIX  IKJSUBF ,                                                CL006
XPREFIX  IKJIDENT 'PREFIX',LIST,MAXLNTH=8,FIRST=ALPHA,            CL006*
               OTHER=ALPHANUM                                     CL006
         SPACE 1                                                  CL006
SUNIT    IKJSUBF ,                                                CL006
         SPACE 1                                                  CL006
XUNIT    IKJIDENT 'UNIT',LIST,MAXLNTH=8,OTHER=ALPHANUM,           CL006*
               FIRST=ALPHANUM                                     CL006
         SPACE 1                                                  CL006
SVOL     IKJSUBF ,                                                CL006
         SPACE 1                                                  CL006
XVOL     IKJIDENT 'VOLUME',LIST,MAXLNTH=6,FIRST=ALPHANUM,         CL006*
               OTHER=ALPHANUM                                     CL006
         SPACE 2                                                  CL006
         IKJENDP ,                                                CL006
         EJECT                                                    CL006
WORK     DSECT ,                                                  UF024
         DS    18F                 SAVEAREA PORTION               UF024
WORKAREA DS    D                   START OF SCRATCH WORK AREA     UF024
CPUMDL   DS    F
#CPUID   DS    CL4
#CPUMDL  DS    CL4
TENBYTE  DS    XL10
         SPACE 1                                                  UF024
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
INIT     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136Q                                 DOR
         COPY  $HASPGBL
&MACSPLV SETC  '2'
&SYSSPLV SETC  '2'
&VERSION SETC  'SP 2.1.5' MVS/SP XA
&FMID    SETC  'HJE2215'   XA
         AGO   .X136Q                                               DOR
.NO136Q  ANOP                                                       DOR
         GBLC  &VERSION
&VERSION SETC  '0'
         AIF   (NOT &QSP).QSP99A                                  UF020
$MAXNODE EQU   1000           FOR SP2 $JOT DSECT                  UF020
         AGO   .QSP99B                                            UF020
.QSP99A  ANOP                                                     UF020
$MAXNODE EQU   99             FOR NJE $JOT DSECT                  UF001
.QSP99B  ANOP                                                     UF020
SAVE     EQU   13             NEEDED FOR NJE $PCE                 UF001
$MAXPRDV EQU   4                                                  UF046
$OPTSTD  EQU   0                                                  UF046
.X136Q   ANOP                                                       DOR
         AIF   (NOT &QSP133).C29Z                                 UF046
         $DAS  ,                                                  UF046
         $MIT  ,                                                  UF046
.C29Z    ANOP  ,                                                  UF046
         $PCE  ,              NEEDED FOR NJE $HCT                 UF001
         $JOE
         $JOT
         AIF   (NOT &QSP136).NO136R                                 DOR
NJOTPRFX EQU   (JOTJOES-JOT)/JOESIZE
         $LCK  ,                                                  UF020
         IFGRPL
         AGO   .X136R                                               DOR
.NO136R  ANOP                                                       DOR
NJOTPRFX EQU   (JOTJOES-JOTDSECT)/JOESIZE
BASE1    EQU   0
$RPS     EQU   0
$MSGID   EQU   0
$DUPVOLT EQU   0
$PRIOOPT EQU   0
$PRTBOPT EQU   0
$PRTRANS EQU   0
$QSONDA  EQU   0
$USERSET EQU   0                                                  ONL11
$DRAINED EQU   0                                                     CL
         AIF   (NOT &QSP).QSP99                                   UF020
*        EQUATES REQUIRED FOR $HCT EXPANSION                      UF020
FF       EQU   X'FF'                                              UF020
$CMBDEF  EQU   15                                                 UF020
$JQEDEF  EQU   100                                                UF020
$MAXDA   EQU   32                                                 UF020
$MAXJBNO EQU   9999                                               UF020
$SMFDEF  EQU   5                                                  UF020
$TGDEF   EQU   3072                                               UF020
JCT      EQU   10                                                 UF020
         $LCK  ,                                                  UF020
.QSP99   ANOP                                                     UF020
.X136R   ANOP                                                       DOR
         $BUFFER                                                  UF020
         $JCT  ,                                                  UF020
         $CAT  ,                                                  UF020
         $TAB
         $QSE
         $PDDB                                                    UF021
         $IOT
         AIF   (&QSP136).X136S                                 DOR
         $TGM
.X136S   ANOP                                                       DOR
         $JQE
         $HCT
         IKJCPPL ,                                                ONL02
         IKJPSCB ,                                                ONL02
         IHADCB DSORG=PS                                          UF039
         CVT   DSECT=YES,PREFIX=YES
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=INITS
INITS    TITLE 'QUEUE COMMAND - LIST INITIATORS COMMAND'          ONL01
INITS    QSTART HASPEQU=YES,       START INITS CSECT ASSEMBLY     DOR XX
               XTITLE='QUEUE COMMAND - LIST INITIATORS COMMAND'
         GBLB  &QSP133                                            UF046
         GBLB  &QSP136        SP 1.3.6 OPTION FLAG                DOR
         USING QCKPT,R9       BASE REG FOR CHECKPOINT AREA
         L     R9,QVCKPT      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
******************************************************************UF006
*                                                                 UF006
*   CALL - READ JES2 CHECKPOINT ROUTINE                           UF006
*                                                                 UF006
******************************************************************UF006
CALLCKPT L     R15,=V(CKPT)   ADDR OF CKPT ROUTINE                UF006
         BALR  R14,R15        GO TO IT                            UF006
         L     R8,16          POINT TO CVT
         USING CVTDSECT,R8
***********************************************************************
*                                                                     *
*        FIND THE ACTIVE MAIN SUBSYSTEM SSVT                          *
*                                                                     *
***********************************************************************
         L     R8,CVTJESCT    POINT TO JESCT
         DROP  R8
         USING JESCT,R8
         L     R8,JESSSCT     POINT TO SSCT
         DROP  R8
         USING SSCT,R8
         L     R8,SSCTSSVT    POINT TO SSVT
         DROP  R8
         USING SSVT,R8
***********************************************************************
*                                                                     *
*        FIND THE ACTIVE MAIN SUBSYSTEM'S PITS                        *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136A                               DOR
         L     R7,SVTPIT      POINT TO PITTABLE                   DOR
         LTR   R6,R7          TEST IF ANY PITS
         BZ    NOPITS         NO, IGNORE COMMAND
*REMOVE  BCTR  R6,0           SUBTRACT ONE                        DOR
*REMOVE  BCTR  R6,0           SUBTRACT ONE                        DOR
*REMOVE  SR    R0,R0          ZERO FOR INSERT                     DOR
*REMOVE  IC    R0,0(,R6)      INSERT NUMBER OF CLASSES            DOR
*REMOVE  LR    R6,R0          COPY THE COUNT                      DOR
*REMOVE  IC    R6,SVTMAXCL    NUMBER OF CLASSES AFTER OZ35996     DOR
         LA    R6,36          NUMER OF CLASSES ALWAYS 36          DOR
         USING PIT,R7                                             DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         L     R7,$SVPIT      POINT TO PITTABLE
         LTR   R6,R7          TEST IF ANY PITS
         BZ    NOPITS         NO, IGNORE COMMAND
         BCTR  R6,0           SUBTRACT ONE
         BCTR  R6,0           SUBTRACT ONE
         SR    R0,R0          ZERO FOR INSERT
         IC    R0,0(,R6)      INSERT NUMBER OF CLASSES
         LR    R6,R0          COPY THE COUNT
         IC    R6,$SVMAXCL    NUMBER OF CLASSES AFTER OZ35996     UF027
         USING PITDSECT,R7
.X136A   ANOP                                                     DOR
         MVC   QDHLINE,INITHD MOVE IN THE HEADING
***********************************************************************
*                                                                     *
*        BUILD THE MESSAGE(S) DESCRIBING THE PITS                     *
*                                                                     *
***********************************************************************
BLDMSG   MVC   QDMSG,QBLANK   BLANK THE AREA
         MVC   INIT#(2),PITPATID MOVE IN PIT ID
         LR    R1,R6          COPY THE LENGTH
         BCTR  R1,0           SUBTRACT ONE
         EX    R1,MVCLAS      MOVE THE CLASSES
         TM    PITSTAT,PITHOLDA+PITHOLD1 TEST FOR DRAINED
         BNZ   HOLDPIT        YES
         TM    PITSTAT,PITHALTA+PITHALT1 TEST FOR HALTED
         BNZ   HALTPIT        YES
         MVC   STATUS,=CL8'ACTIVE'
         TM    PITSTAT,PITBUSY TEST FOR BUSY
         BO    ACTPIT         YES
         MVC   STATUS,=CL8'INACTIVE'
         B     NEXTPIT        END OF MESSAGE LINE.
MVCLAS   MVC   CLASSES(0),PITCLASS SET THE CLASSES
HOLDPIT  MVC   STATUS,=CL8'DRAINED' SET STATUS
         TM    PITSTAT,PITBUSY TEST FOR BUSY
         BZ    NEXTPIT        NO
         MVC   STATUS+5(3),=C'ING' SET STATUS
         B     ACTPIT         YES
HALTPIT  MVC   STATUS,=CL8'HALTED' SET STATUS
         TM    PITSTAT,PITBUSY TEST FOR BUSY
         BZ    NEXTPIT        NO
         MVC   STATUS+4(3),=C'ING' SET STATUS
ACTPIT   L     R5,PITSJB      POINT TO THE SJB
         AIF   (NOT &QSP136).NO136B                               DOR
         USING SJB,R5                                             DOR
         L     R1,SJBJQOFF    POINT TO JOB QUEUE OFFSET
         A     R1,QCJQTA      POINT TO THE JQE
         USING JQE,R1                                             DOR
         AGO   .X136B                                             DOR
.NO136B  ANOP                                                     DOR
         USING SJBDSECT,R5
         L     R1,SJBJQOFF    POINT TO JOB QUEUE OFFSET
         A     R1,QCJQTA      POINT TO THE JQE
         USING JQEDSECT,R1
.X136B   ANOP                                                     DOR
         CLC   JQEJNAME,SJBJOBNM TEST FOR RIGHT JOB
         BNE   NEXTPIT        RIGHT JOB, GOOD
         MVC   JOBNAME,SJBJOBNM MOVE IN JOBNAME
         LH    R0,JQEJOBNO    LOAD JOB NUMBER
         CVD   R0,CONVERT     GET THE DECIMAL VALUE
         MVC   JOBNUM,ED5     GET THE CHARACTER VALUE
         ED    JOBNUM,CONVERT+5 GET THE CHARACTER VALUE
***********************************************************************
*                                                                     *
*        SEND THE MESSAGE DESCRIBING THE PIT                          *
*                                                                     *
***********************************************************************
NEXTPIT  L     R7,PITNEXT     POINT TO NEXT PIT
         DROP  R1,R5
         MVC   QDMLNG,=H'80'  SET THE LENGTH
         LA    R0,QDMSG       GET THE ADDRESS
         ST    R0,QDMSGA      SET THE ADDRESS
         L     R15,=V(DISPLAY) POINT TO THE ROUTINE
         BALR  R14,R15        CALL THE ROUTINE
         LTR   R7,R7          TEST FOR NEXT PIT
         BNZ   BLDMSG         YES, GO DO IT
***********************************************************************
*                                                                     *
*        END IT ALL                                                   *
*                                                                     *
***********************************************************************
END      QSTOP
NOPITS   QTILT '***** NO PITS  TO DISPLAY *****'
INITHD   DC    CL80'INIT    STATUS   JOBNAME    NUMBER    CLASSES'
ED5      DC    X'402020202120'
         LTORG
***********************************************************************
*                                                                     *
*        DESCRIBE ALL THE DSECTS NEEDED BY THIS MODULE                *
*                                                                     *
***********************************************************************
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
INITS    CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         CVT   PREFIX=NO,DSECT=YES                                UF046
CVTDSECT EQU   CVT                                                UF046
         IEFJESCT TYPE=DSECT                                      UF046
         IEFJSCVT ,                                               UF046
INITS    CSECT ,                                                  UF046
         $PIT
         IEZDEB ,                                                 UF046
INITS    CSECT ,                                                  UF046
         AIF  (NOT &QSP136).NO136X
         IFGRPL  DSECT=YES,AM=VTAM                                DOR
         $TQE                                                     DOR
         AGO    .X136X
.NO136X  ANOP
$USERSET EQU   X'02'                                              ONL11
.X136X   ANOP
         $SJB
         $JQE
         AIF   (NOT &QSP133).NO133                                UF046
         $XECB ,                                                  UF046
         $SCAT ,                                                  UF046
.NO133   ANOP                                                     UF046
         $SVT  ,                                                  ONL11
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    C
INIT#    DS    CL2
         DS    CL4
STATUS   DS    CL8
         DS    CL2
JOBNAME  DS    CL8
         DS    CL3
JOBNUM   DS    CL6
         DS    CL4
CLASSES  DS    C
WORK     DSECT
         DS    CL72
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=ISGSP134
//DORQ134C JOB (6000A,4,,9999),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=ACCT01,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3380',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM='NOGEN',             ENTER ASSEMBLER OPTIONS
//       SP=SP134,                ENTER SP LEVEL OPTION
//       ISPF=ISPF,               ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&ISPF,&OPT,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR
//   DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='SYSP,TSS,GEN,ISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=A
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** CLEAR THE OBJECT AND LOAD LIBRARIES
//*
//*********************************************************************
//CLEAR   EXEC SAS
//OBJ      DD  DSN=SYS3.QISPF.JESP.OBJLIB,DISP=OLD OBJECT LIBRARY
//SYSIN    DD  *
  PROC PDS KILL DDNAME=OBJ   NOLIST; RUN;
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON EXEC QASM,M=Q0     ISPF MODIFIED
//ISPFQI  EXEC QASM,M=ISPFQI ISPF MODIFIED
//ACTIVE  EXEC QASM,M=ACTIVE OK
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH    EXEC QASM,M=AUTH  TSS MODIFIED OK
//CDIE    EXEC QASM,M=CDIE
//CHCT    EXEC QASM,M=CHCT OK
//CIOT    EXEC QASM,M=CIOT  OK
//CJCT    EXEC QASM,M=CJCT  OK
//CJHIST  EXEC QASM,M=CJHIST TSS MODIFIED  OK
//CJOE    EXEC QASM,M=CJOE OK
//CJQE    EXEC QASM,M=CJQE OK
//CKPT    EXEC QASM,M=CKPT OK
//CPDDB   EXEC QASM,M=CPDDB OK
//CPFK    EXEC QASM,M=CPFK
//CSPIN   EXEC QASM,M=CSPIN OK
//CSYS    EXEC QASM,M=CSYS -OK
//CTGPS   EXEC QASM,M=CTGPS
//CTSO    EXEC QASM,M=CTSO -OK
//DDNAME  EXEC QASM,M=DDNAME OK
//DISPLAY EXEC QASM,M=DISPLAY -OK    ISPF MODIFIED
//DOPTION  EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//FFORMAT  EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//FINDJOB EXEC QASM,M=FINDJOB  OK MODIFIED WITH BLANKED JOBNAME
//FINDPDDB EXEC QASM,M=FINDPDDB OK
//FORMAT  EXEC QASM,M=FORMAT OK
//HELP    EXEC QASM,M=HELP -OK
//HEXBLK  EXEC QASM,M=HEXBLK -OK
//HEXDUMP EXEC QASM,M=HEXDUMP -OK
//INIT    EXEC QASM,M=INIT   (ISPF OR TSO)
//INITS   EXEC QASM,M=INITS  OK
//JCL     EXEC QASM,M=JCL OK
//JLOG    EXEC QASM,M=JLOG -OK
//JMSG    EXEC QASM,M=JMSG -OK
//LIST    EXEC QASM,M=LIST -OK
//LISTDS  EXEC QASM,M=LISTDS OK
//LISTDS2  EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//PARSE   EXEC QASM,M=PARSE -OK CDSI MODIFIED
//PRINT   EXEC QASM,M=PRINT -OK
//QUEUE   EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//READSPC EXEC QASM,M=READSPC -OK
//REPOS   EXEC QASM,M=REPOS -OK CDSI MODIFIED
//ROUTE    EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//SAVE    EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//SEARCH  EXEC QASM,M=SEARCH OK
//SYSLOG  EXEC QASM,M=SYSLOG  OK
//SYSOUT  EXEC QASM,M=SYSOUT OK
//XDS     EXEC QASM,M=XDS -OK
//*
//* EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER  WHEN SET OPT=SYSP
//ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=A
//SYSPRINT DD  SYSOUT=A
//SYSLIB   DD  DSN=SYS3.QISPF.JESP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//* INCLUDE SYSSMOD(ASMT3NEW)
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QITT
 NAME ISPQ134T(R)
//*
./       ADD   NAME=ISLSP134
//DORQJESA JOB (6000A,004,,99),'QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=MVSSY3,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSSMOD(ASMTRTRR)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QIA
 NAME QUEISPA(R)
//*
./       ADD   NAME=ISNSP136
//DORQ136C JOB (6000A,4,,99),'QI4 QUEUE SP136',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=ACCT01,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3380',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONSE
//       ASM='NOGEN',             ENTER ASSEMBLER OPTIONS
//       SP=SP136,                ENTER SP LEVEL OPTION
//       ISPF=ISPF,               ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2'         ENTER OTHER SYSTEM OPTIONS
//* ASM/LKED PARAMETER SPECIFICATIONS:
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*        (NOTE: ASM INITNEW FOR ISPF INTERFACE OR INIT FOR TSO ONLY)
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&ISPF,&OPT,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=SIPO2P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0A
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*QCOMMON EXEC QASM,M=Q0     ISPF MODIFIED
//*ISPFQI  EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE  EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*ASID    EXEC QASM,M=ASID          CDSI MODIFIED
//*AUTH    EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE    EXEC QASM,M=CDIE
//*CHCT    EXEC QASM,M=CHCT OK
//*CIOT    EXEC QASM,M=CIOT  OK
//*CJCT    EXEC QASM,M=CJCT  OK
//*CJHIST  EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE    EXEC QASM,M=CJOE OK
//*CJQE    EXEC QASM,M=CJQE OK
//*CKPT    EXEC QASM,M=CKPT OK
//*CPDDB   EXEC QASM,M=CPDDB OK
//*CPFK    EXEC QASM,M=CPFK
//*COREZAP EXEC QASM,M=COREZAP COREZAP QASXSYSP CDSI MODIFIED
//*CSPIN   EXEC QASM,M=CSPIN OK
//*CSYS    EXEC QASM,M=CSYS -OK
//CTGPS   EXEC QASM,M=CTGPS
//*CTSO    EXEC QASM,M=CTSO -OK
//*DDNAME  EXEC QASM,M=DDNAME OK
//*DDNAME2 EXEC QASM,M=DDNAME2 OK  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ  EXEC QASM,M=DEVIREQ -OK DEVIREQ  QASXSYSP
//*DISPLAY EXEC QASM,M=DISPLAY -OK    ISPF MODIFIED
//*DOPTION  EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*DTAPE   EXEC QASM,M=DTAPE  -OK CDSI MODIFIED
//*DUMP      EXEC QASM,M=DUMP  OK   XU       QASXSYSP   DEBUG
//*FFORMAT  EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB  OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT  EXEC QASM,M=FORMAT OK
//*HELP    EXEC QASM,M=HELP -OK
//*HEXBLK  EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT    EXEC QASM,M=INIT
//*INITS   EXEC QASM,M=INITS  OK
//*JCL     EXEC QASM,M=JCL OK
//*JLOG    EXEC QASM,M=JLOG -OK
//*JMSG    EXEC QASM,M=JMSG -OK
//*LIST    EXEC QASM,M=LIST -OK
//*LISTDS  EXEC QASM,M=LISTDS OK
//*LISTDS2  EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*PAGEMON EXEC QASM,M=PAGEMON -OK CDSI MODIFIED
//*PARSE   EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT   EXEC QASM,M=PRINT -OK
//*QUEUE   EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS   EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE    EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAUGAGE  EXEC QASM,M=SAUGAGE -OK  SAGUAGE    QASXSSM
//*SAVE    EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH  EXEC QASM,M=SEARCH OK
//*SRM      EXEC QASM,M=SRM -OK  SRM      QASXSYSP CDSI MODIFIED
//*STCMAP   EXEC QASM,M=STCMAP -OK  STCMAP     QASXSYSP CDSI MODIFIED
//*STORAGE  EXEC QASM,M=STORAGE -OK  STCMAP     QASXSYSP CDSI MODIFIED
//*SUINFO   EXEC QASM,M=SUINFO -OK  STCMAP     QASXSYSP CDSI MODIFIED
//*SYSLOG  EXEC QASM,M=SYSLOG  OK
//*SYSOUT  EXEC QASM,M=SYSOUT OK
//*XDS     EXEC QASM,M=XDS -OK
./       ADD   NAME=ISPCALL
         MACRO
.*                                                      RON MURA, TPD
&LBL     ISPCALL &LIST,        CALL PARAMETERS                         X
               &EP=ISPLINK,                                            X
               &LISTLBL=,      LABEL FOR PARAMETER LIST (NON-REENT)    X
               &WKAREA=,       TO BUILD CALL LIST (REENTERANT CODE)    X
               &WKREG=,        WORK REGISTER (DEFAULT 1)               X
               &TRACE=         'OFF' OR BIT FOR TRACE MODE
.*  ONCE WKAREA, WKREG, AND TRACE ARE SPECIFIED, THEY ARE USED IN ALL
.*  SUBSEQUENT OCCURRENCES OF THIS MACRO, UNLESS THE PARAMETER IS
.*  EXPLICITLY CODED.
.*  NOTE: FIRST 4 BYTES OF WKAREA ARE USED TO STORE NUMERIC VALUES,
.*  WHICH ARE PRIMARILY LENGTH FIELDS.
         LCLA  &S,&T,&U,&TRCEMSK
         LCLB  &NUMSW
         LCLC  &NDX,&WKAR,&WKRG
         GBLC  &ISPRREG,&ISPRAR,&ISPTRC1
         GBLA  &ISPTRC2
&NDX     SETC  '&SYSNDX'
&S       SETA  1               SUBSCRIPT FOR GOING THRU &LIST
***********************************************************************
         AIF   (T'&LBL NE 'O').L1
*                  ISPCALL  -  INVOKE ISPF DIALOG SERVICES      ISPCALL
         AGO   .L2
.L1      ANOP
&LBL     DS    0H  ISPCALL  -  INVOKE ISPF DIALOG SERVICES      ISPCALL
.L2      ANOP
         AIF   (T'&LIST NE 'O').A1
         MNOTE 12,'*** ISPCALL PARAMETERS MUST BE PROVIDED ***'
         AGO   .EXIT
.A1      AIF   ('&LIST'(1,1) EQ '(').CHKTRCE
         MNOTE 12,'*** ISPCALL PARAMETERS MUST BE ENCLOSED IN PARENTHESX
               ES ***'
         AGO   .EXIT
.****************** ANALYZE "TRACE" PARAMETER *************************
.CHKTRCE AIF   (T'&TRACE EQ 'O' AND '&ISPTRC1' NE '').TRCE4
         AIF   (T'&TRACE EQ 'O' AND '&ISPTRC1' EQ '').TRCEOFF
         AIF   ('&TRACE'(1,1) EQ '(').TRCEON
         AIF   ('&TRACE' EQ 'OFF').TRCEOFF
         MNOTE 12,'*** INVALID TRACE PARAMETERS ***'
         AGO   .EXIT
.TRCEON  AIF   (T'&TRACE(2) EQ 'N').TRCE2
.TRCE8   MNOTE 12,'*** TRACE BIT (2ND PARAMETER) MUST BE 0 - 7 ***'
         AGO   .EXIT
.TRCE2   AIF   (&TRACE(2) GE 0 OR &TRACE(2) LE 7).TRCE3
         AGO   .TRCE8
.TRCE3   ANOP
&ISPTRC1 SETC  '&TRACE(1)'     SET GLOBAL VARIABLE
&ISPTRC2 SETA  &TRACE(2)       SET GLOBAL VARIABLE
.TRCE4   ANOP
&U       SETA  0
&TRCEMSK SETA  255
&T       SETA  128
.TRCE5   AIF   (&U GT 7).CHKREG
         AIF   (&ISPTRC2 NE &U).TRCE7
.TRCE6   ANOP
&U       SETA  &U+1
&T       SETA  &T/2
         AGO   .TRCE5
.TRCE7   ANOP
&TRCEMSK SETA  &TRCEMSK-&T
         AGO   .TRCE6
.TRCEOFF ANOP
&ISPTRC1 SETC  ''              SET GLOBAL VARIABLE
.****************** ANALYZE "WKREG" PARAMETER *************************
.CHKREG  AIF   (T'&WKREG EQ 'O').A2
&ISPRREG SETC  '&WKREG'        SET GLOBAL VARIABLE
.A2      AIF   ('&ISPRREG' EQ '').A3
&WKRG    SETC  '&ISPRREG'
         AGO   .CHKAREA
.A3      ANOP
&ISPRREG SETC  '1'             SET GLOBAL VARIABLE
         AGO   .A2
.****************** SEE IF USING PROVIDED WORKAREA ********************
.CHKAREA AIF   (T'&WKAREA NE 'O' OR '&ISPRAR' NE '').RENT
         AIF   (T'&LISTLBL EQ 'O').B1
&WKAR    SETC  '&LISTLBL'
         AGO   .B2
.B1      ANOP
&WKAR    SETC  'ISPC&NDX'      LABEL FOR MACRO WORKAREA
.B2      ANOP
&T       SETA  4*(N'&LIST+1)   LENGTH OF MACRO WORKAREA
         B     &WKAR.+&T             BRANCH AROUND DATA         ISPCALL
&T       SETA  N'&LIST+1
&WKAR    DC    &T.F'0'               PARAMETER LIST             ISPCALL
.******************** BUILD PARAMETER LIST ****************************
.LOOP    AIF   (&S GT N'&LIST).ENDLOOP
         AIF   ('&LIST(&S)'(1,1) EQ '''').C1 TEST FOR LITERAL
         AIF   (T'&LIST(&S) EQ 'N').NUM      TEST FOR NUMERIC
         AIF   ('&LIST(&S)'(1,1) EQ '(').REG TEST FOR REG NOTATION
         LA    &WKRG,&LIST(&S)       LOAD DATA ADDR             ISPCALL
.ST      ANOP
&T       SETA  4*&S
         ST    &WKRG,&WKAR.+&T       STORE IN PARAM LIST        ISPCALL
         AIF   ('&ISPTRC1' EQ '' OR &S GT 1).C3           TRACE
         TM    &ISPTRC1,&TRCEMSK     IS TRACE BIT ON?     TRACE ISPCALL
         BZ    ISPT&NDX                                   TRACE ISPCALL
         AIF   ('&WKRG' EQ '1' OR '&WKRG' EQ 'R1').C4     TRACE
         LR    1,&WKRG               LOAD SRVC NAME ADDR  TRACE ISPCALL
.C4      AIF   ('&LIST(&S)'(1,1) EQ '''').C5 LITERAL?     TRACE
         LA    0,8                   LOAD LENGTH          TRACE ISPCALL
         AGO   .C6                                        TRACE
.C5      ANOP                                             TRACE
&U       SETA  K'&LIST(&S)-2   LENGTH OF SERVICE NAME     TRACE
         LA    0,&U                  LOAD LENGTH          TRACE ISPCALL
.C6      ANOP                                             TRACE
         SVC   93                    ISSUE TPUT SVC       TRACE ISPCALL
ISPT&NDX EQU   *                                          TRACE ISPCALL
.C3      ANOP
&S       SETA  &S+1
         AGO   .LOOP
.C1      AIF   (&S EQ 1).C2    SPF SERVICE NAME - LENGTH IS OK
&T       SETA  K'&LIST(&S)-2
         AIF   (&T GT 7).C2    LENGTH 8 OR GREATER IS OK
&T       SETA  &T+1            ADD FOR ONE BLANK
         LA    &WKRG,=CL&T.&LIST(&S) LOAD DATA ADDR             ISPCALL
         AGO   .ST
.C2      ANOP
         LA    &WKRG,=C&LIST(&S)     LOAD DATA ADDR             ISPCALL
         AGO   .ST
.NUM     AIF   (&NUMSW).NUM2
.*  NOTE: SPF WILL MODIFY LENGTH FIELDS, SO THEY CANNOT BE IN
.*  REENTERANT CODE.
         MVC   &WKAR.(4),=F'&LIST(&S)'                                 X
                                     MOVE NUMERIC VALUE         ISPCALL
&NUMSW   SETB  1
         AGO   .LA
.NUM2    MNOTE 12,'*** ONLY ONE NUMERIC ALLOWED PER ISPCALL MACRO - LISX
               T ITEM &S --&LIST(&S)-- IS SECOND OCCURRENCE ***'
         AGO   .EXIT
.LA      ANOP
         LA    &WKRG,&WKAR           LOAD DATA ADDR             ISPCALL
         AGO   .ST
.REG     ANOP
&T       SETA  4*&S
         ST    &LIST(&S),&WKAR.+&T                              ISPCALL
         AGO   .C3
.******************** USING PROVIDED WORKAREA *************************
.RENT    AIF   (T'&WKAREA EQ 'O').RENT2
&ISPRAR  SETC  '&WKAREA'       SET GLOBAL VARIABLE
.RENT2   ANOP
&WKAR    SETC  '&ISPRAR'
         AGO   .LOOP
.****************** GENERATE STATEMENTS FOR CALL **********************
.ENDLOOP ANOP
         OI    &WKAR.+&T,X'80'       TURN ON VL BIT             ISPCALL
         LA    1,&WKAR.+4                                       ISPCALL
         L     15,=V(&EP)                                       ISPCALL
         BALR  14,15                                            ISPCALL
.EXIT    ANOP
***********************************************************************
         SPACE 2
         MEND
./       ADD   NAME=ISPCHACC
//DORQ4ACC JOB (6000A,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//QASM   PROC  M=,CKPT=ACCT01,CUN='3380',RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0     ISPF MODIFIED/ HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4
 NAME ISPQUEA(R)
//*
./       ADD   NAME=ISPCHPLP
//DORQ4PLP JOB (6000A,004,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0     ISPF MODIFIED/ HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4
 NAME ISPQUEA(R)
//*
./       ADD   NAME=ISPCH134
//DORQJESA JOB (6000A,004,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0     ISPF MODIFIED/ HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4
 NAME ISPQUEA(R)
//*
./       ADD   NAME=ISPFQI
ISPFQI   QSTART 'QISPMAIN QUEUE ISPF INTERFACE DRIVER',MAIN=GBLS
         GBLB  &QISPF ISPF INTERFACE
         GBLB  &QISPF2 ISPF V2
         GBLB  &QSP
         GBLB  &QDBC
         GBLB  &QRACF
         GBLB  &QRNB
*   REMODIFIED BY DOR/CDSI FOR USE ISF V1 OR V2   3/87
*---------------------------------------------------------------------*
*   THIS PROGRAM IS AN SPF DIALOG FUNCTION.  IT IS INVOKED VIA SPF    *
*   SELECT SERVICE AND IN TURN INVOKES OTHER SPF SERVICES.            *
*   THIS MODULE CONTROLS THE JES QUEUE PROGRAM
*                                                                     *
*   THIS MODULE MUST HAVE A NAME BEGINNING WITH "ISP," SO THAT SPF    *
*   WILL PASS THE ADDRESS OF THE TLD.  THE TLD POINTS TO THE TSI,     *
*   WHICH CONTAINS ADDRESSES NEEDED FOR THE CPPL WHEN SUBMIT IS       *
*   ATTACHED.                                                         *
*                                                                     *
*   TLD IS USED BY ISPF V1. ISPF V2 IS USED IN DIFFERENT WAY. VCOPY   *
*   ZVERB WILL DETERMINE FOR REPONSE.                                 *
*                                                                     *
*   THE FOLLOWING PANELS MUST BE PRESENT IN AN ALLOCATED PANEL        *
*   LIBRARY (ISPPLIB):                                                *
*                                                                     *
*   THE FOLLOWING MESSAGES MUST BE PRESENT IN AN ALLOCATED MESSAGE    *
*   LIBRARY (ISPMLIB):                                                *
*                                                                     *
*   THE DIALOG VARIABLE XOPT IS SET IN ISP@PRIM (SPF PRIMARY OPTION   *
*   MENU) TO THE OPTION ENTERED THAT CAUSED ISP#Q   TO BE INVOKED     *
*   (EITHER OF THE FORM "QI" OR "QI.SUBOPT").                         *
*   WOPT IS THE SUBOPTION, EITHER AS DETERMINED FROM XOPT BY THIS     *
*   PROGRAM OR AS ENTERED ON A QUEUE SELECTION MENU (QI@A/QI@B).      *
*   ISPF V1  PANEL NAME IS QI@A.  DOR 3/13/87
*   ISPF V2  PANEL NAME IS QI@V2. DOR 3/13/87
*                                                                     *
*   NOTE THAT QI@A AND QI@B ARE NOT NORMAL SPF SELECTION              *
*   MENUS (THEY ARE NOT DISPLAYED BY THE SELECT SERVICE).  THIS IS    *
*   BECAUSE WHEN THE END KEY IS PRESSED (WHICH CAUSES THE SELECT      *
*   SERVICE TO REVERT TO A HIGHER FUNCTION).      THIS PROGRAM        *
*   CONTROLS THE DISPLAYING OF QI@A/QI@B AND OF THE SUBOPTION         *
*   PANELS.  IN ORDER TO CIRCUMVENT SELECT SERVICE PROCESSING,        *
*   STATEMENTS ADDED TO ISP@PRIM STORE THE ENTERED OPTION IN THE      *
*   VARIABLE "XOPT" AND RESET THE SELECT SERVICE VARIABLE "OPT" TO    *
*   NULLS WHEN ISPQ IS TO BE INVOKED.                                 *
*   THUS, THE LINES ADDED TO ISP@PRIM LOOK LIKE:                      *
*                                                                     *
*     %  QI +QUEUE      - JES2 QUEUE USING DIALOG MGMT                *
*                                                                     *
*                     8,'PGM(ISPFQ) NOCHECK'                          *
*         &ZTRAIL = .TRAIL                                           *
*                                                                     *
*   USER PARMS (PASSED BY SELECT SERVICE) RECOGNIZED:                 *
*            NOCORE - SIMULATE GETMAIN FAILURE                        *
*            TRACE  - LIST ALL INVOKED ISPF SERVICE NAMES VIA TPUT    *
*            (ANY OTHER) - FIRST 2 CHARS REPLACE "QI" IN STANDARD     *
*                          PANEL, SKELETON, AND MEMBER NAMES          *
*                          (QI@A )                                    *
*                                                                     *
*   MACROS:                                                           *
*   ENTER                                                             *
*   LEAVE                                                             *
*   SCANLINE                                                          *
*   ISPCALL                                                           *
*   REQUS                                                             *
*   MACROS ON 'SYS1.MACLIB'                                           *
*                                                                     *
*   REGISTERS:                                                        *
*   R2  - WORK                                                        *
*   R3  - WORK                                                        *
*   R4  - WORK                                                        *
*   R5  - WORK                                                        *
*   R6  - (NOT USED)                                                  *
*   R7  - (NOT USED)                                                  *
*   R8  - ADDR OF TSI (SYSTEM INTERFACE TABLE, AN SPF CTL BLK)        *
*   R9  - (NOT USED)                                                  *
*   R10 - (NOT USED)                                                  *
*   R11 - 2ND BASE (IF NECESSARY)                                     *
*   R12 - 1ST BASE                                                    *
*   R13 - DSECT BASE (1ST 18F FOR SAVEAREA)                           *
*                                                                     *
*   THIS CODE IS REUSABLE AND REENTERANT.                             *
*                                                                     *
*---------------------------------------------------------------------*
ISPFQI    ENTER RENT=YES,WKBYTES=(ENDDSECT-DSECT),GETFAIL=NOCORE
         USING DSECT,R13
*---------------------------------------------------------------------*
*  HANDLE PARAMETERS - USE TLD TO GET ADDRESS OF TSI, WHICH CONTAINS  *
*  ADDRESSES NEEDED IN THE CPPL WHEN THE SUBMIT COMMAND PROCESSOR IS  *
*  ATTACHED.  MOVE STANDARD PANEL, SKELETON, AND MESSAGE NAMES TO     *
*  MODIFIABLE CORE.  HANDLE USER PARM, AND SEE IF IT IS "NOCORE" OR   *
*  OR "TRACE" OR SOMETHING ELSE (TO CHANGE "QI" AS THE FIRST TWO      *
*  CHARACTERS OF THE STANDARD PANEL, SKELETON, AND MESSAGE MEMBER     *
*  NAMES):                                                            *
*---------------------------------------------------------------------*
         ST    R2,ISPFR13                 SAVE R13 FOR ISPF SAVE
         LM    R2,R3,0(R1)                LOAD ADDR OF TLD AND PARM
         L     R8,56(R2)                  LOAD ADDR OF TSI
         SH    R3,=H'2'                   BACKUP TO GET PARM LENGTH
         LH    R4,0(R3)                   LOAD PARM LENGTH
OKPARM   ST    R13,DSECTR13               SAVE R13 FOR DISPLAY
         ST    R12,ISPQBASE               SAVE R12 FOR DISPLAY
*                                         MOVE TO MODIFIABLE CORE
         ST    R8,QPARMADR                SAVE PARM ADDRESS FOR QUEUE
*        L     R13,DSECTR13               SAVE R13 FOR DISPLAY
*        L     R12,ISPQBASE               SAVE R12 FOR DISPLAY
         L     R8,QPARMADR                SAVE PARM ADDRESS FOR QUEUE
         MVI   TISPF,X'02'    ISPF V2
         MVC   QI@002A(Q2ERR$-Q2@002A$+L'Q2ERR$),Q2@002A$  ISPF V2
         AIF   (&QISPF2 EQ 1).ISPFV2
         L     R1,540         TCBPTR
         L     R1,112(,R1)    TCBFSA
         L     R1,24(,R1)     R1 OF TCB
         L     R1,0(,R1)      TLD POINTER
         USING  TLD,R1
         CLC   TLDTBLID,=CL3'TLD'
         BNE   XISPFV2
         MVI   TISPF,X'01'    ISPF V1
         MVC   QI@002A(QIERR$-QI@002A$+L'QIERR$),QI@002A$ ISPF V1
         ST    R1,TLDPTR                  SAVE TLD POINTER
.ISPFV2  ANOP
XISPFV2  MVI   SWITCHES,X'00'             INITIALIZE
         LTR   R4,R4                      ANY USER PARM PROVIDED?
         BZ    INITFLDS
         MVC   USERPARM,BLANKS
         CH    R4,=H'8'
         BNH   USRPRMOK
         LH    R4,=H'8'                   MAX. ALLOWABLE PARM LNTH IS 8
USRPRMOK SH    R4,=H'1'                   SUBTRACT 1 FOR EX
         EX    R4,MVC$                    MOVE IN USER PARM
         B     CHANGEQI
MVC$     MVC   USERPARM(1),2(R3)          MOVE USER PARM (EXECUTED)
         B     INITFLDS
CHANGEQI EQU   *
*---------------------------------------------------------------------*
*  INITIALIZE FIELDS, GET LIST OF PROFILE VARIABLES NEEDED BY         *
*  QI@A, AND MAKE OTHER   VARIABLES AVAILABLE TO DIALOG:              *
*---------------------------------------------------------------------*
INITFLDS MVC   XOPT,BLANKS                INITIALIZE
         MVC   WOPT,BLANKS
*---------------------------------------------------------------------*
*  GET CONTENTS OF ZCMD (ENTERED ON ISP@PRIM TO INVOKE THIS FUNCTION) *
*  AND DETERMINE IF A SUBOPTION WAS ENTERED (E.G., "QI.ST"):          *
*  (TELL SPF NOT TO QUIT WITH DIALOG ERROR ON VCOPY IN CASE USER      *
*  ENTERS A LONG--AND INVALID--SUBOPTION ON ISP@PRIM, WHICH WOULD     *
*  CAUSE A TRUNCATION ERROR ON VCOPY SERVICE.)                        *
*---------------------------------------------------------------------*
COPYXOPT ISPCALL ('CONTROL','ERRORS','RETURN'), DON'T QUIT IF ERROR    X
               WKAREA=WKAREA
         ISPCALL ('VCOPY','ZTRAIL',60,XOPT,'MOVE')
         ISPCALL ('CONTROL','ERRORS','CANCEL')  RESTORE TO DEFAULT
         CLI   XOPT,X'40'                 'QI. ' ENTERED?
         BE    QINITST                        YES - DON'T SKIP SEL PNL
         SCANLINE ' ',RECADDR=XOPT,ENDCOL=15,NOFIND=QINITST
*---------------------------------------------------------------------*
*  A SUBOPTION WAS ENTERED, SO
*                  SET WOPT VARIABLE TO SUBOPTION VALUE:              *
*---------------------------------------------------------------------*
         OI    SWITCHES,B'00000010'       SKIP SELECTION PANEL
         LA    R3,60                      LOAD ADDR LAST ALLOWABLE CHAR
         LA    R4,1(R1)                   R4 -> SUBOPTION
         LA    R5,WOPT
WOPTLOOP MVC   0(1,R5),0(R4)              MOVE CHAR INTO WOPT
         LA    R5,1(R5)                   POINT TO NEXT CHAR IN WOPT
         LA    R4,1(R4)                   POINT TO NEXT CHAR IN XOPT
WOPTBCT  BCT   R3,WOPTLOOP                KEEP ON UNLESS END OF XOPT
WOPTDONE ISPCALL ('VREPLACE','ZCMD',60,WOPT)  MAKE WOPT AVAIL TO FUNCT
         B     QINITOPT
*---------------------------------------------------------------------*
*  NO SUBOPTION ENTERED, SO DISPLAY INITIAL  SELECTION MENU           *
*  (QI@A) TO GET SUBOPTION (WOPT) AND ALLOW USER TO CHANGE            *
*  SUBCMD  FIELDS.                                                    *
*  GET WOPT:                                                          *
*---------------------------------------------------------------------*
NOSKIP   ISPCALL ('DISPLAY',QI@A)         DISPLAY INIT SELECTION PANEL
         LR    R4,R15                     SAVE RETURN CODE
CKENDKEY CH    R4,=H'8'                   END KEY PRESSED?
         BE    FINISH
         ISPCALL ('VCOPY','ZCMD',60,WOPT,'MOVE')
         CLI   WOPT,C'E'                  END ENTERED?
         BE    FINISH
         B     QINITOPT
*---------------------------------------------------------------------*
*  SERIOUS DISPLAY ERROR ENCOUNTERED - CONVERT RETURN CODE TO DISPLAY *
*  FORMAT AND MAKE AVAILABLE TO SPF, THEN DISPLAY QUEUE ERROR PANEL   *
*  (QI@E) AND THEN QUIT:                                              *
*---------------------------------------------------------------------*
DISPLERR CVD   R4,WKAREA                  CONVERT RET CODE TO DECIMAL
         UNPK  ISPCC,WKAREA+6(2)          UNPACK RETURN CODE
         OI    ISPCC+1,X'F0'              FIX SIGN
         ISPCALL ('VREPLACE','ISPCC',2,ISPCC) GIVE DIALOG RET CODE
         ISPCALL ('DISPLAY',QI@E,QI@002A)   DISPLAY ERROR PANEL
         MVI   WOPT,X'40'                 NO EDIT ON 8.E
         B     FINNOSUB
*---------------------------------------------------------------------*
*  BRANCH TO QUEUE TO PROCESSING JES2 QUEUE.. WHEN A DISPLAY IS NEED,
*  QUEUE WILL BRANCH TO HERE FOR DIALOG INTERFACE
*---------------------------------------------------------------------*
QINITST  EQU   *
         MVC  WOPT(7),=CL7'STATUS ' DEFAULT COMMAND
QINITOPT EQU   *
         L    R8,QPARMADR            POINTER TO TSI
         MVC  CMDBUFF+4(60),BLANKS
         MVC  CMDBUFF+2(2),=X'0000' STORE DISPL PARM IN CPPL
         MVC  CMDBUFF+4(60),WOPT SUBCOMMAND ENTRY
         LA   R1,20                 GET LENGTH OF WOPT
         STH  R1,CMDBUFF             STORE CMDBUFF IN H 1
         LA   R15,CMDBUFF
         ST   R15,WKAREA
         L    R15,188(R8)            LOAD ADDR OF UPT
         ST   R15,WKAREA+4           IN CPPL AREA
         L    R15,192(R8)            LOAD ADDR OF PSCB
         ST   R15,WKAREA+8           IN CPPL AREA
         L    R15,196(R8)            LOAD ADDR OF ECT
         ST   R15,WKAREA+12          IN CPPL AREA
QINIT    EQU   *
*        MVC   TLDPTR(4),=F'0'      CLEAR TLD PTR AT BEGIN
         LA   R2,WKAREA              GIVE CPPL ADDR TO QUEUE
         L    R15,=V(QUEUE)
         BALR R14,R15
*---------------------------------------------------------------------*
*   END OF QUEUE
*---------------------------------------------------------------------*
         ENTRY ISP#QE
ISP#QE   LR    R15,R13
         LR    R4,R12
         USING QCOMMON,R11
         USING QDISPLAY,R10
         L     R10,QVDSPL
         L     R12,QISPR12
         L     R13,QISPR13 GO TO FIRST SAVEAREA AS FROM ISPF
         L     R2,ISPFR13
*---------------------------------------------------------------------*
*   END OF PROGRAM
*---------------------------------------------------------------------*
FINISH   EQU   *
         LEAVE RC=0,LABEL2=FINISH2
*---------------------------------------------------------------------*
*  QUIT                        - CLOSE THE TEMPORARY FILE (OTHERWISE  *
*  THE NEXT INVOCATION WILL ADD TO DATASET INSTEAD OF STARTING CLEAN),*
*  THEN WE CAN QUIT:                                                  *
*---------------------------------------------------------------------*
FINNOSUB CLI   WOPT,C'E'                  END ENTERED?
         BNE   FINISH                        NO - JUST LEAVE
         QSTOP
*---------------------------------------------------------------------*
*  TELL USER WE CAN'T GET ENOUGH CORE:                                *
*---------------------------------------------------------------------*
NOCORE   ISPCALL ('DISPLAY',BLANKS,QI@002B)
         CLC   USERPARM(6),=C'NOCORE'
         BE    FINISH                     SIMULATION ONLY
         B     FINISH2                    REAL GETMAIN FAILURE
*---------------------------------------------------------------------*
*  RECIEVE A REQUEST FROM DISPLAY ROUTINE TO SHOOT A SCREEN HERE      *
*  AFTER THE REPLY ENTRY IS RECEIVED AND SEND TO DISPLAY BACK         *
*---------------------------------------------------------------------*
* THIS ROUTINE IS INTENTED TO SAVE ISPF OVERHEAD WHEN THE QUEUE CMD
* IS RUNNING TO BUILD THE SCREEN BEFORE GIVE TO THIS ROUTINE FOR
* ISPF. THE ISPF QUEUE INTERFACE WILL NOT BE USED UNTIL THE QUEUE
* DISPLAY WILL DETERMINE THAT THE SCREEN IS GOING TO BE FULLED OR
* THE QUEUE COMMAND IS TERMINATED WITH QSTOP  OR QTILT MACRO. THE
* DISPLAY COMMAND WILL FOLLOW THE ISPF NUMBER OF LINES PER SCREEN
* WHEN THE SCREEN IS AT SPLITED.
* HOWEVER, THE ISPF DRIVER IS DEVELOPED TO SAVE OVERHEAD OF FREQUENCY
* USE OF ISPF (10,000 TO 50,000 INSTRUCTIONS OF EACH DISPLAY LINE)
* VERSUS ONE ISPF SCREEN PER QDISP CALL FROM THE QUEUE DISPLAY COMMAND.
* COMMENT FROM DOR/CDSI  07/15/86
QDISP    EQU  *
         ENTRY  QDISP
         LR    R15,R13
         LR    R4,R12
         USING QCOMMON,R11
         USING QDISPLAY,R10
         L     R10,QVDSPL
         L     R12,QISPR12
         L     R13,QISPR13
         ST    R4,SAVER12
         ST    R8,SAVER8
         ST    R15,SAVER13
         AIF   (&QISPF2).V2VDEF                                DOR1187
         ISPCALL ('VREPLACE','QSCRT0',63,QDTLINE)
         ISPCALL ('VREPLACE','QSCRH0',80,QDHLINE)
.V2VDEF  ANOP
         AIF   (NOT &QISPF2).NOTUTR                             DOR1187
         USING   QDQTTY,R5                                      DOR1187
         L     R5,QVDQTTY                                       DOR1187
         CLI   TUTRSWT,X'FF'                                    DOR1187
         BE    VDEFDONE                                         DOR1187
         MVI   TUTRSWT,X'FF'                                    DOR1187
         ISPCALL ('VDEFINE','QI@HELP',QDHELP,'CHAR',8)          DOR1187
         ISPCALL ('VDEFINE','QSCRT0',QDTLINE,'CHAR',63)
         ISPCALL ('VDEFINE','QSCRH0',QDHLINE,'CHAR',80)
VDEFDONE EQU   *                                                DOR1187
         DROP  R5                                               DOR1187
.NOTUTR  ANOP                                                   DOR1187
         LA    R1,QDLINE1         R1 = ADDR OF OUTPUT STREAM
         L     R0,=F'1680'    21*80  R0 = LENGTH OF TPUT
         LA    R6,80
         ST    R1,ISPBUFA
         ST    R0,ISPLENG
         LA    R1,ISCBTAB          BEGIN ADDRESS OF VARIABLE NAME
         ST    R1,ISCTPTR
         AIF   (&QISPF2 EQ 1).ISPFV2A
         CLI   TISPF,X'01'
         BE    SISPFV1
.ISPFV2A  ANOP
         ISPCALL ('VCOPY','ZSCREEND',4,WSCRN,'MOVE')
         ICM   R15,15,WSCRN
         BZ    ABEND210
         PACK  QDWORK(8),WSCRN(4)
         CVB   R5,QDWORK
         ST    R5,DISSIZE
         L     R9,ISPBUFA          FIRST CHAR OF SCREEN
         L     R7,ISPLENG
         ISPCALL ('VREPLACE','QSBUF1',ISPLENG,QDLINE1)
         B     ISPCDONE
TESTXX   LA    R1,=CL8'QSBUF1 '
         ST    R1,WKAREA+8         ISPF SERVICE VARIABLE NAME FIELD
         ST    R9,WKAREA+16        POINTER ADDR OF FIRST CHAR
         LR    R1,R7
         ST    R1,WKAREA           ISPF SERVICE LENGTH FIELD
         LA    R1,=C'VREPLACE'
         ST    R1,WKAREA+4         ISPF SERVICE NAME FIELD
         LA    R1,WKAREA
         ST    R1,WKAREA+12        ISPF SERVICE LENGTH FIELD ADDR
         OI    WKAREA+16,X'80'      END OF ISP SERVICE INDICATOR
         LA    R1,WKAREA+4
         L     R15,=V(ISPLINK)
         BALR  R14,R15
         AIF   (&QISPF2 EQ 1).ISPFV2Y
         B     DYNAMIC
SISPFV1  L     R1,TLDPTR         GET TLD PTR
         L     R5,204(R1)  SCREEN LINES  FROM TLD
SLENGTHD ST    R5,ISCSIZE
         ST    R5,DISSIZE
         LA    R5,0                CONSOLE LINES
         L     R9,ISPBUFA          FIRST CHAR OF SCREEN
         L     R7,ISPLENG
ISPCLOOP L     R1,ISCTPTR
         CLC   0(8,R1),=CL8'XXXX '  END OF ISCTAB
         BE    ISPCDONE
         LA    R5,1(,R5)           ADD ONE LINE
         C     R5,DISSIZE          LIMITED TO SCREEN LINES
         BNL   ISPCREST            FINISH NO MORE LINES...
         C     R5,ISCSIZE          LIMITED TO SPLITED SCREEN?
         BNE   SCRLOPA             GO ON PUT THAT LINE TO ISPF
         B     ISPCREST
SCRLOPA  ST    R1,WKAREA+8         ISPF SERVICE VARIABLE NAME FIELD
         B     ISPCLINE
ISPCREST LA    R9,BLANKS           FILL IN BLANKS
         LA    R6,80
         C     R5,=F'23'           STOP BY 23RD LINE
         BE    ISPCDONE
ISPCLINE ST    R9,WKAREA+16        POINTER ADDR OF FIRST CHAR
         AR    R9,R6               ADD LENGTH OF LINE
         LR    R1,R6
         ST    R1,WKAREA           ISPF SERVICE LENGTH FIELD
         LA    R1,=C'VREPLACE'
         ST    R1,WKAREA+4         ISPF SERVICE NAME FIELD
         LA    R1,WKAREA
         ST    R1,WKAREA+12        ISPF SERVICE LENGTH FIELD ADDR
         OI    WKAREA+16,X'80'      END OF ISP SERVICE INDICATOR
         L     R1,ISCTPTR
         LA    R1,8(,R1)           NEXT VARIABLE NAME
         ST    R1,ISCTPTR
         ST    R9,SAVEPTR9
         ST    R7,SAVECTR7
         LA    R1,WKAREA+4
         L     R15,=V(ISPLINK)
         BALR  R14,R15
         L     R9,SAVEPTR9
         L     R7,SAVECTR7
         C     R7,=F'0'
         BNL   ISPCLOOP
DYNAMIC  EQU   *
.ISPFV2Y ANOP
ISPCDONE EQU   *
         MVC    QIERROR,QISP# MOVE ERROR ID
         MVC    QISPANEL,VQPANEL MOVE PANEL ID
         AIF   (&QISPF2 EQ 1).ISPFV2B
         CLI   TISPF,X'02' IS THIS ISPF V2?
         BE    QIISPFV2
         L     R1,540         TCBPTR
         L     R1,112(,R1)    TCBFSA
         L     R1,24(,R1)     R1 OF TCB
         L     R1,0(,R1)      TLD POINTER
         USING  TLD,R1
         CLC   TLDTBLID,=CL3'TLD'
         BNE   QIISPFV2
         CLC   TLDTCBP(4),540  MATCH TO PSA TCB
         BNE   NOTLD1
         ST    R1,QAREA
         ST    R1,TLDPTR
         L     R1,TLDPTR
         L     R5,TLDTSVP
         MVC   TLDENBL(8),124(R5) DEFAULT ENABLE VALUES
         OI    TLDSCRE,X'FC' ENABLE SCROLL AND FIND, CHANGE
         OI    TLDENBL2,X'40' ENABLE PRIMARY COMMAND
         ISPCALL ('DISPLAY',QISPANEL,QIERROR)
         L     R1,TLDPTR
         L     R15,TLDRC       RETURNCODE
         LTR   R15,R15
         BNZ   WELDONE
         L     R1,QAREA
         A     R1,=F'1000'    AREA LENGTH
         ST    R1,SNAP2
         OI    SNAP2,X'80'  END OF SNAP LIST
         LA    R9,SNAPX
         LA    R2,QAREA
*        SNAP  ID=123,DCB=(9),LIST=(2)
         L     R1,TLDPTR
         MVC   QIAID(1),TLDAID2
         B     QIISPFV1
.ISPFV2B ANOP
QIISPFV2 EQU   *
         ISPCALL ('DISPLAY',QISPANEL,QIERROR)
         ISPCALL ('VCOPY','ZVERB',8,WVERB,'MOVE')
         ISPCALL ('VCOPY','QILVLN',4,WLVLNE,'MOVE')
         LTR   R15,R15
         BZ    KLVLNE
         ST    R15,CLVLNE
         LA    R5,24      DEFAULT
         B     NLVLNE
KLVLNE   EQU   *
         ICM   R15,15,WLVLNE
         BZ    ABEND220
         PACK  QDWORK(8),WLVLNE(4)
         CVB   R5,QDWORK
         AH    R5,=H'3'       ADD FIRST THREE LINES
NLVLNE   EQU   *
         ST    R5,DISSIZE
         MVC   WFIND(4),=CL4' '     DEFAULT
*        ISPCALL ('VCOPY','QIFIND',8,WFIND,'MOVE')
         ST    R15,XFIND
         MVC   WCHNG(4),=CL4' '     DEFAULT
*        ISPCALL ('VCOPY','QICHNG',8,WCHNG,'MOVE')
         ST    R15,XCHNG
         LA    R1,SAVEAREA
         ST    R1,SNAP1
         A     R1,DSECTLEN    AREA LENGTH
         ST    R1,SNAP2
         OI    SNAP2,X'80'  END OF SNAP LIST
         LA    R9,SNAPX
         LA    R2,SNAP1
*        SNAP  ID=123,DCB=(9),LIST=(2)
         CLI   WFIND,C' '
         BE    NRFIND
         MVC   QIAID,X'05'
         B     FPFK
NRFIND   CLI   WCHNG,C' '
         BE    NRCHNG
         MVC   QIAID,X'06'
         B     FPFK
NRCHNG   LA    R1,11
         LA    R2,WZVERB
LZVERB   CLC   WVERB(8),0(R2)
         BE    FZVERB
         LA    R2,9(R2)
         BCT   R1,LZVERB
         LA    R7,200
         B     ABEND
         MVI   QIAID,X'1C'   TREAT DEFAULT AS ENTER
         B     QIISPFV1
ABEND210 LA    R7,210
         B     ABEND
ABEND220 LA    R7,220
ABEND    ABEND (7),DUMP
FZVERB   MVC   QIAID,8(R2)
FPFK     EQU   *
* --------
QIISPFV1 EQU   *
         MVI   WOPT,X'40'
         MVC   WOPT+1(50),WOPT
         CLI   QIAID,X'1C'     ENTER PRESSED
         BE    WELDONE
         CLI   QIAID,X'03'     PFK3 PRESSED OR RETURN VERB
         BE    QFINISH
NXAIDX1  CLI   QIAID,X'05'     PFK5 PRESSED
         BNE   NXAID1
         MVC   WOPT(2),=C'F '  FIND COMMAND FOR QUEUE
         B     WELENTRY
NXAID1   CLI   QIAID,X'06'     PFK6 PRESSED
         BNE   NXAID2
         MVC   WOPT(3),=C'DI ' DI   COMMAND FOR QUEUE
         B     WELENTRY
NXAID2   CLI   QIAID,X'07'     PKF7 PRESSED
         BNE   NXAID3
         MVC   WOPT(3),=C'PB ' PB   COMMAND FOR QUEUE
         B     WELENTRY
NXAID3   CLI   QIAID,X'08'     PKF8 PRESSED
         BNE   NXAID5
         MVC   WOPT(3),=C'PF ' PF   COMMAND FOR QUEUE
         B     WELENTRY
NXAID5   CLI   QIAID,X'0A'     PKF10 PRESSED
         BNE   NXAID6
         MVC   WOPT(6),=C'COL 1 '  COL 1 COMMAND FOR QUEUE
         B     WELENTRY
NXAID6   CLI   QIAID,X'0B'     PKF11 PRESSED
         BNE   NXAID7
         MVC   WOPT(7),=C'COL 50 '  COL 50 COMMAND FOR QUEUE
         B     WELENTRY
NXAID7   CLI   QIAID,X'1C'     ENTER PRESSED
         BE    WELDONE
NOTLD1   EQU   *
         ISPCALL ('DISPLAY',QISPANEL,QIERROR)
         AIF   (&QISPF2 EQ 1).ISPFV2C
         CLI   TISPF,X'02'  IS IT ISPF V2?
         BE    WELDONE
         L     R1,540         TCBPTR
         L     R1,112(,R1)    TCBFSA
         L     R1,24(,R1)     R1 OF TCB
         L     R1,0(,R1)      TLD POINTER
         USING  TLD,R1
         CLC   TLDTBLID,=CL3'TLD'
         BNE   NOTLD
         CLC   TLDTCBP(4),540  MATCH TO PSA TCB
         BNE   NOTLD
         ST    R1,TLDPTR
.ISPFV2C ANOP
WELDONE  LR    R4,R15                     SAVE RETURN CODE
         ISPCALL ('VCOPY','ZCMD',60,WOPT,'MOVE')
         CH    R4,=H'8'                   END KEY PRESSED?
         BE    QFINISH
WELENTRY CLI   WOPT,C'E'                  END ENTERED?
         BE    QFINISH
*********************************************************************
*        NUMBER OF LINES PER SCREEN
*********************************************************************
         AIF   (&QISPF2 EQ 1).ISPFV2D
         CLI   TISPF,X'02'   IS THIS ISPF V2?
         BNE   LISPFV1
         L     R5,DISSIZE
         B     LISPFV
LISPFV1  L     R1,TLDPTR         GET TLD PTR
         L     R5,TLDMPSLN      SCREEN LINES  FROM TLD
         AGO   .ISPFV1D
.ISPFV2D ANOP
*        ISPF V2 ONLY
*        CLEAR SCREEN IN PANEL FOR EACH SPLIT REQUEST OR BEFORE
*               NEXT PANEL REINITIALIZED.
*
CLSCRN   LA    R4,QDLINE1     LOAD ADDRESS OF FIRST LINE           DOR
         L     R5,ISPLENG     LOAD LENGTH OF SCREEN                DOR
*ERROR   LA    R5,21          LOAD LENGTH OF SCREEN   ERROR        DOR
         SR    R6,R6          NO SENDING FIELD NEEDED              DOR
         SR    R7,R7          FILL SCREEN WITH NULLS               DOR
         MVCL  R4,R6          CLEAR THE SCREEN                     DOR
         ISPCALL ('VREPLACE','QSBUF1',ISPLENG,QDLINE1)
         L     R5,DISSIZE       ZSCREEND PROVIDE  SCREEN LINES
.ISPFV1D ANOP
LISPFV   S     R5,=F'3'         LESS FIRST THREE HEADINGS
         ST    R5,SCRSIZE
         CVD   R5,QDWORK        CONVERT BINARY TO DECIMAL
         CP    QDWORK+6(2),QDLNES
         BE    NOTLD            NO SCREEN CHANGE
         ZAP   QDLNES,QDWORK+6(2)   SAVE NUMBER OF LINES.
         LH    R7,=H'80'      MAX CHAR PER LINE. 327X ALWAYS
         STH   R7,QDLNELEN    STORE IT.
*********************************************************************
*        COMPUTE NEW SCREEN SIZE.
*********************************************************************
COMPUTE  DS    0H
         ZAP   QDWORK,QDLNES
         CVB   R5,QDWORK
         MH    R5,QDLNELEN    MUTLIPLY BY LINE LENGTH.
         STH   R5,QDSCRLEN    STORE IT
         MVC   QDSCRPLN,=AL2(QDLINE1-QDSCREEN)
         AH    R5,QDSCRPLN
         STH   R5,QDSCRPLN
         AIF   (&QISPF2 EQ 1).ISPFV2E
         CLI   TISPF,X'02'
         BE    NOTLD
         L     R1,TLDPTR
         LR    R5,R1
.ISPFV2E ANOP
NOTLD    CLI   WOPT,C'='                  RETURN TO ISPF
         BE    IFINISH
*   ISPF/PDF TO MAKE THIRD OR FOURTH SCREEN                   DOR2/86
         CLC   WOPT,=CL3'TSO'    TSO COMMAND?                 DOR2/86
         BNE   NOTSO                                          DOR2/86
         MVC   XOPT,BLANKS                                    DOR2/86
         MVC   XOPT(4),=CL4'CMD('                             DOR2/86
         MVC   XOPT+4(50),WOPT                                DOR2/86
         MVI   XOPT+55,C')'
         ISPCALL ('SELECT',60,XOPT)  MAKE TSO OPT AVAIL TO FUNCTR2/86
         B     NOTLD1                                         DOR2/86
NOTSO    CLC   WOPT(16),=XL16'00'                 NULL ENTERED?
         BE    NUENTRY
         CLC   WOPT(16),=CL16' '                  BLANK ENTERED?
         BNE   ENTRY
NUENTRY  LA    R15,0
         B     NOENTRY
IFINISH  EQU   *
         ISPCALL ('VREPLACE','ZCMD',60,WOPT)  MAKE OPT AVAIL TO FUNCT
         CH   R15,=H'20'   SEVERVE ERROR
         BE   NUENTRY
         CH   R15,=H'16'
         BE   NUENTRY
         B    FINISH
QFINISH  EQU   *
*        CALL TRACE
         CLC   WOPT,=CL1'=' HIT WHEN ITS A RETURN PF12
         BE    IFINISH
         MVC   WOPT,=CL6'END '
ENTRY    XC    PFREPLY,PFREPLY           CLEAR REPLY
         XC    QDREPLY,QDREPLY
         LA    R15,60
NOENTRY  MVC   PFREPLY(60),WOPT
         MVC   QDREPLY(60),WOPT
         STH   R15,QDRLNG
         L     R8,SAVER8 EXIT
         L     R12,SAVER12 RETURN R12 TO DISPLAY
         L     R13,SAVER13 RETURN R13 TO DISPLAY
         BR    R8
*---------------------------------------------------------------------*
*  DATA AREAS:                                                        *
*---------------------------------------------------------------------*
         DS    0F
TRTBL    EQU   *                          TO INCREMENT JOB CHARACTER:
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   X'00' - X'1F'
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   X'20' - X'3F'
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@$@@@@'   X'40' - X'5F'
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@#@@@@'   X'60' - X'7F'
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   X'80' - X'9F'
         DC    C'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   X'A0' - X'BF'
         DC    C'@BCDEFGHIJ@@@@@@@KLMNOPQRS@@@@@@'   X'C0' - X'DF'
         DC    C'@@TUVWXYZA@@@@@@1234567890@@@@@@'   X'E0' - X'FF'
*               +0123456789ABCDEF0123456789ABCDEF
BLANKS   DC    CL80' '
         EJECT
***********************************************************************
         DS    0F
ISCBTAB  EQU   *
         AIF  (&QISPF2 EQ 1).ISPFV2T
         DC   CL8'QSCR01'
         DC   CL8'QSCR02'
         DC   CL8'QSCR03'
         DC   CL8'QSCR04'
         DC   CL8'QSCR05'
         DC   CL8'QSCR06'
         DC   CL8'QSCR07'
         DC   CL8'QSCR08'
         DC   CL8'QSCR09'
         DC   CL8'QSCR10'
         DC   CL8'QSCR11'
         DC   CL8'QSCR12'
         DC   CL8'QSCR13'
         DC   CL8'QSCR14'
         DC   CL8'QSCR15'
         DC   CL8'QSCR16'
         DC   CL8'QSCR17'
         DC   CL8'QSCR18'
         DC   CL8'QSCR19'
         DC   CL8'QSCR20'
         DC   CL8'QSCR21'
         DC   CL8'QSCR22'
         DC   CL8'QSCR23'
         DC   CL8'XXXX'
* ISPF V1 THESE ARE THE DEFAULT NAMES (ALL 9 MOVED AS ONE BLOCK):
QI@002A$ DC    C'QI@002A '
QI@002B$ DC    C'QI@002B '
QI@002C$ DC    C'QI@002C '
QI@002D$ DC    C'QI@002D '
QI@E$    DC    C'QI@E '
QI@A$    DC    C'QI@A  '
QIPANEL$ DC    CL8'QI@A  '
QIERR$   DC    CL8' '
.ISPFV2T ANOP
* ISPF V2 THESE ARE THE DEFAULT NAMES (ALL 9 MOVED AS ONE BLOCK):
Q2@002A$ DC    C'QI@002A '
Q2@002B$ DC    C'QI@002B '
Q2@002C$ DC    C'QI@002C '
Q2@002D$ DC    C'QI@002D '
Q2@E$    DC    C'QI@E '
Q2@A$    DC    C'QI@V2 '
Q2PANEL$ DC    CL8'QI@V2 '
Q2ERR$   DC    CL8' '
*     END OF THE DEFAULT NAMES
DSECTLEN DC    A(ENDDSECT-DSECT)
*        ZVERB INTERPRETER FOR PROPER PFKEY (ISPF V2)
WZVERB   DS    0F
         DC    CL8'        ',XL1'1C'    ENTER
         DC    CL8'HELP    ',XL1'01'    HELP
         DC    CL8'RETURN  ',XL1'03'    RETURN
         DC    CL8'END     ',XL1'03'    END
         DC    CL8'RFIND   ',XL1'05'    REPEAT FIND
         DC    CL8'IFIND   ',XL1'05'    REPEAT FIND
         DC    CL8'RCHANGE ',XL1'06'    REPEAT CHANGE
         DC    CL8'UP      ',XL1'07'    UP
         DC    CL8'DOWN    ',XL1'08'    DOWN
         DC    CL8'LEFT    ',XL1'0A'    LEFT
         DC    CL8'RIGHT   ',XL1'0B'    RIGHT
WZVERBE  EQU   *
         LTORG
DSECT    DSECT
SAVEAREA DS    18F
QPARMADR DS    F
SAVER8   DS    F
SAVER12  DS    F
SAVER13  DS    F
SAVECTR7 DS    F
SAVEPTR9 DS    F
ISPFR13  DS    F
TLDPTR   DS    F
SCRSIZE  DS    F
ISPBUFA  DS    F
ISPLENG  DS    F
ISCTPTR  DS    F
ISCSIZE  DS    F
DISSIZE  DS    F
QIAID    DS    F
WKAREA   DS    3D                         1ST F FOR NUMERICS IN ISPCALL
DSECTR13 DS    F WKAREA+24
ISPQBASE DS    F WKAREA+28
USERPARM DS    CL8
SWITCHES DS    XL1       .... ...1 = BYPASS SELECTION PANEL
TISPF    DS    XL1                 = 01 USE ISPF V1  02 USE ISPF V2
TUTRSWT  DS    XL1       TUTURIAL VDEFINE SWITCH 00=FIRST TIME FF=DONE
TRASWT   DS    XL1       TRACE SWITCH
*                        .... ..1. = JCL FOR A SUBOPTION HAS BEEN GEN'D
*                        .... .1.. = EDIT INSTEAD OF SUB ("/E")
*                        .... 1... = VAR "XJPARMS" NOT DEFINED
*                        ...1 .... = NO REMEMBERED PARAMS FOR THIS OPT
*                        ..1. .... = TRACE CALLS TO ISPLINK
*                        .1.. .... = CANCEL INSTEAD OF SUB ("/C")
*                        1... .... = ISPF V2
ISPCC    DS    CL2                        FOR RET CODE ON DISPLAY ERROR
CMDBUFF  DS    H,H,CL60                   LENGTH AND "SUBCOMMAND" FIELD
BPANEL   DS    CL8                        SUBOPT PANEL NAME
XOPT     DS    CL60                       ENTERED ON ISP@PRIM
WOPT     DS    CL60                       SUBOPTION
         DS    CL60                       SUBOPTION
         DS    0F
WVERB    DS    CL8
WSCRN    DS    CL4
WDAMLN   DS    CL4
XDAMLN   DS    CL4
CDAMLN   DS    CL4
WLINES   DS    CL4
XLINES   DS    CL4
CLINES   DS    CL4
WLVLNE   DS    CL4
XLVLNE   DS    CL4
CLVLNE   DS    CL4
WSCRNW   DS    CL4
XSCRNW   DS    CL4
WFIND    DS    CL8
WCHNG    DS    CL8
XFIND    DS    F
XCHNG    DS    F
         AIF   (&QISPF2 EQ 1).ISPFV2Q
QI@002A  DS    (L'QI@002A$)C
QI@002B  DS    (L'QI@002B$)C
QI@002C  DS    (L'QI@002C$)C
QI@002D  DS    (L'QI@002D$)C
QI@E     DS    (L'QI@E$)C
QI@A     DS    (L'QI@A$)C
QISPANEL DS    (L'QIPANEL$)C
QIERROR  DS    (L'QIERR$)C
         AGO   .ISPFV1Q
.ISPFV2Q ANOP
QI@002A  DS    (L'Q2@002A$)C
QI@002B  DS    (L'Q2@002B$)C
QI@002C  DS    (L'Q2@002C$)C
QI@002D  DS    (L'Q2@002D$)C
QI@E     DS    (L'Q2@E$)C
QI@A     DS    (L'Q2@A$)C
QISPANEL DS    (L'Q2PANEL$)C
QIERROR  DS    (L'Q2ERR$)C
.ISPFV1Q ANOP
ECB      DS    F
TCBADDR  DS    F
ENDDSECT EQU   *
         REQUS
         AIF   (&QISPF2 EQ 1).ISPFV2F
         DS    0F
TLD      DSECT LOGICAL DISPLAY  MAIN MEMORY TABLE
TLDTBLID DS    CL3             TABLE ID "TLD"
TLDID    DS    CL1             TLD  ID ( 0 1,2)
TLDNEXTP DS    CL4             NEXT TLD PTR
TLDSEWD1 DS    CL4             SERVICE CALL SEQ WORDS
TLDSEWD2 DS    CL4
TLDRC    DS    CL4             RETURN CODE
TLDTLDP  DS    F               THIS TLD PTR
         DS    CL8             RESERVED
TLDSYSP  DS    CL40            CONTROLLER TABLE PTRS
         ORG   TLD+32
TLDTCTP  DS    F               TCT PTR (TRANS TABLES)
TLDTDSP  DS    F               TDS PTR (SYS DATASETS)
TLDTKVP  DS    F               TKV PTR (KEY/VALUE TBL)
TLDTKWP  DS    F               TKW PTR (KEYWORD TBLS)
TLDTPLP  DS    F               TPL PTR (PANEL DEF LST)
TLDTSCP  DS    F               TSC PTR (COMMON SUBS)
TLDTSIP  DS    F               TSI PTR (SYS INTERFACE)
TLDTSVP  DS    F               TSV PTR (SYS INTERFACE)
         DS    2F              RESERVED
TLDPROTB DS    18F             PROCESSOR TABLE PTRS
         ORG   TLD+72
TLDMSGEP DS    F               MSG EXTENSION PTR
TLDDTAPT DS    F               DATA TABLE PTR
TLDVCBP  DS    F               VARIABLE CNTL BLK PTR
TLDFTLRP DS    F               FILE TAILORING PTR
TLDTFDEP DS    F               EDIT BACKUP TFD PTR
TLDTFKP  DS    F               TFK PTR (FUNCT/KEY)
TLDTLSP  DS    F               TLS PTR (LOGIC SCREEN)
TLDTPXP  DS    F               TPX PTR (PANEL DEF EXT)
TLDTRT0P DS    F               TRT ZEROS TABLE PTR
TLDTRT1P DS    F               TRT IDENTIFY TABLE PTR
TLDTUTLP DS    F               TUTORIAL/PANEL LIST PTR
TLDPOPTP DS    F               PRIM OPT (EXT) PTR
TLDPARMP DS    F               SYS ERROR (EXT) PTR
TLDDINFP DS    F               DIALOG INFOR (EXT) PTR
TLDDSERV EQU   16              TLDDINFP+16
TLDDSTYP EQU   30              TLDDINFP+30
         DS    F               RESERVED
TLDUSER1 DS    F               USER FIELD 1
TLDUSER2 DS    F               USER FIELD 2
TLDUSER3 DS    F               USER FIELD 3
TLDDISCR DS    23F             DISPLAY/SCREEN INTERFACE
         ORG    TLD+144
TLDFUNC  DS    CL1             KEY FUNCTION BITS
TLDNOPK  EQU   X'80'           NOP
TLDREDK  EQU   X'40'           REDISPLAY
TLDSPLK  EQU   X'20'           SPLIT
TLDSWPK  EQU   X'10'           SWAP
TLDCSRK  EQU   X'08'           CURSOR
TLDPRTHK EQU   X'04'           PRINT HIGH
TLDPRTLK EQU   X'02'           PRINT LOW
TLDNOPRK EQU   X'01'           NOP AND REDISPLAY
TLDFUNC2 DS    CL1             KEY FUNCTION BITS TWO
TLDLNEK  EQU   X'80'           LINE COMMAND
TLDCMDK  EQU   X'40'           PRIMARY COMMAND
TLDNOPMK EQU   X'20'           NOP WITH MESSAGE
TLDHLPK  EQU   X'10'           HELP
TLDRETK  EQU   X'08'           RETURN
TLDRESV2 EQU   X'07'           RESERVED
TLDFUNC3 DS    CL1             KEY FUNCTION BITS THREE
TLDENDK  EQU   X'80'           LINE COMMAND
TLDENTK  EQU   X'40'           PRIMARY COMMAND
TLDSMMK  EQU   X'20'           NOP WITH MESSAGE
TLDRESV3 EQU   X'1F'           RESERVED
TLDSCRK  DS    CL1             SCROLL KEYS
TLDSCRUK EQU   X'80'           SCROLL UP
TLDSCRDK EQU   X'40'           SCROLL DOWN
TLDSCRLK EQU   X'20'           SCROLL LEFT
TLDSCRRK EQU   X'10'           SCROLL RIGHT
TLDFNDK  EQU   X'08'           REPEAT FIND
TLDCHGK  EQU   X'04'           REPEAT CHANGE
TLDSCRSV EQU   X'03'           RESERVED
         DS    CL4             RESERVED
         ORG   TLD+152
TLDENBL  DS    CL1             ENABLED KEY FUNCTION BITS
TLDNOPE  EQU   X'80'           NOP
TLDREDE  EQU   X'40'           REDISPLAY
TLDSPLE  EQU   X'20'           SPLIT
TLDSWPE  EQU   X'10'           SWAP
TLDCSRE  EQU   X'08'           CURSOR
TLDPRTHE EQU   X'04'           PRINT HIGH
TLDPRTLE EQU   X'02'           PRINT LOW
TLDNOPRE EQU   X'01'           NOP AND REDISPLAY
TLDENBL2 DS    CL1             KEY FUNCTION BITS TWO
TLDLNEE  EQU   X'80'           LINE COMMAND
TLDCMDE  EQU   X'40'           PRIMARY COMMAND
TLDNOPME EQU   X'20'           NOP WITH MESSAGE
TLDHLPE  EQU   X'10'           HELP
TLDRETE  EQU   X'08'           RETURN
TLDRESE2 EQU   X'07'           RESERVED
TLDENBL3 DS    CL1             KEY FUNCTION BITS THREE
TLDENDE  EQU   X'80'           LINE COMMAND
TLDENTE  EQU   X'40'           PRIMARY COMMAND
TLDSMME  EQU   X'20'           NOP WITH MESSAGE
TLDRESE3 EQU   X'1F'           RESERVED
TLDSCRE  DS    CL1             SCROLL KEYS
TLDSCRUE EQU   X'80'           SCROLL UP
TLDSCRDE EQU   X'40'           SCROLL DOWN
TLDSCRLE EQU   X'20'           SCROLL LEFT
TLDSCRRE EQU   X'10'           SCROLL RIGHT
TLDFNDE  EQU   X'08'           REPEAT FIND
TLDCHGE  EQU   X'04'           REPEAT CHANGE
TLDSERSV EQU   X'03'           RESERVED
         DS    CL4             RESERVED
         ORG   TLD+160
TLDAID   DS    CL1             LOGICAL ATTENTION AID
TLDAID2  DS    CL1             LOGICAL ATTENTION AID  PDF ONLY
         DS    CL2             RESERVED
TLDTLSX  DS    CL32            LOGICAL SCREEN (TLS)
         ORG   TLD+164
TLDCSR   DS    F               CURSOR OFFSET
TLDMDTCT DS    F               MODIFIED DATA TAG CNT
         DS    F               RESERVED
TLDTLSSZ DS    F               MAX SIZE
TLDTLSLN DS    F               MAX LINES
TLDTLSWD DS    F               MAX LINE WIDTH
TLDCLSLN DS    F               CURRENT LINES
TLDCLSWD DS    F               CURRENT LINE WIDTH
TLDPTPS  DS    8F              PHYSICAL SCREEN (TPS)
         ORG   TLD+196
TLDCPSLN DS    F               TLS IN TPS LINES
TLDCPSWD DS    F               TLS IN TPS LNE WIDTH
TLDMPSLN DS    F               MAX LINES
TLDMPSWD DS    F               MAX LINE WDTH
TLDTPSRW DS    F               TLS IN TPS LINE NUM
TLDTPSCL DS    F               TLS IN TPS COLUMN
         DS    4F              RESERVED
TLDMISC  DS    24F             MISCELLANEOUS INTERFACE
TLDBITS  DS    CL1             MISC FUNCTION BITS
TLDTUT   EQU   X'80'           TUTORIAL FLAG (TUT)
TLDNODSP EQU   X'40'           NO DISPLAY REQUESTED
TLDTFKLK EQU   X'20'           TFK LOCK BIT
TLDPRIOP EQU   X'10'           PRIM OPT FLAG (PMD)
TLDNOPDE EQU   X'08'           NO ERROR PANEL DISPLAY
TLDCPNLD EQU   X'04'           TLDCMENU IS A PANEL
TLDNEWAP EQU   X'02'           NEW APPL (DIR/DIP)
TLDIVOPT EQU   X'01'           INVALID OPT (DIP)
TLDBITS2 DS    CL1             MISC FUNCTION BITS
TLDOMENU EQU   X'80'           OLD MENU (DPR/TUT)
TLDCSERL DS    CL1             CSE RECURSION LEVEL
TLDSIMKY DS    CL1             SIM FUNCT KEY CODE
TLDPMDCD DS    F               PMD ENTRY PARAMETER
         ORG   TLD+240
TLDPMDTC DS    CL1             TYPE OF INVOKATION
TLDPMDIC DS    CL3             INPUT CODE
TLDPIFBP DS    F               PRIM INPUT FLS ATTR BYTE
TLDPIFSZ DS    F               PTR AND DATA LEN
TLDSC    DS    14F             SCROLL INTERFACE
         DS    F               RESERVED
TLDEBUID DS    CL1             EDIT BACKUP TFD ID
TLDTFKID DS    CL1             TFK ID (A B C)
         DS    CL2             RESERVED
TLDTEST  DS    CL4             TEST BITS
         DS    3F              RESERVED
TLDOMM   DS    CL48            OLD MENU/MSG FIELDS
         DS    2F              RESERVED
TLDPCODE DS    CL6             PROLOG CODE INTERFACE
TLDECODE DS    CL6             EPILOG CODE INTERFACE
TLDSA    DS    CL40            SAVEAREA INTERFACE
         DS    2F              RESERVED
TLDEXT   DS    CL160           OS DEPENDENT EXTENSION
         DS    CL40            RESERVED
         ORG   TLD+332         OLD MENU/MSG FIELDS
TLDOMMB  DS    CL1             MISC FUNCTION BITS
TLDALARM EQU   X'80'           ALARM BIT
TLDMERRC EQU   X'40'           MERR CALLING MHA
         DS    CL3             RESERVED
TLDMHABP DS    F               MENU HANDLER BUFFER PTR
         DS    F               RESERVED
TLDCMENU DS    CL8             CURRESNT MENU/PANEL
TLDPMENU DS    CL8             PREV MENU FROM CDISPL
TLDHELP  DS    CL8             CURR HELP (MEMEBR) NAME
TLDPMSG  DS    CL8             PREVIOUS MSG FROM CMSG
         DS    CL4             RESERVED
TLDEXTY  DS    CL160           OS DEPENDENT EXTENSIONS
         ORG   TLD+448
         DS    CL36            CONTROL/PROCESS INTERFACE
         ORG   TLD+448
TLDTCBP  DS    F               TCB PTR (TASK CNTL BLK)
TLDDRECB DS    F               DISPLAY REQUEST ECB
TLDPRECB DS    F               PROCESS REQUEST ECB
TLDTCECB DS    F               TASK COMPLETION ECB
TLDCCI   DS    F               CCI WORD
TLDSXECB DS    F               STAX POST ECB
TLDSXTCB DS    F               STAX POST TCB PTR
         DS    2F              RESERVED
TLDXSYSP DS    CL32            CONTROLLER TABLE PTRS
         ORG   TLD+484
TLDTXCP  DS    F               TXC PTR (TERM EXIT TBL)
TLDTCMP  DS    F               TCM PTR (TSO CMD TABLE)
         DS    6F              RESERVED
         DS    CL24            PROCESSOR TABLE PTRS
         ORG   TLD+516
TLDTFDCP DS    F               CONTROL CARD TFD PTR
TLDTFDLP DS    F               LISTING TFD PTR
TLDTADP  DS    F               TAD PTR (ALLOC DDNAMES)
TLDIOWAP DS    F               IOWA PTR (STACK CONTROL)
         DS    2F              RESERVED
         DS    CL20            MISCELLANEOUS INTERFACE
         ORG   TLD+540
TLDXBITS DS    CL2             MISC FUNCTION BITS
TLDSTAX  EQU   X'40'           CAT STAX FLAG
TLDSTAX6 EQU   X'20'           OPTION 6 STAX FLAG
TLDDFREE EQU   X'10'           CAT DD FREE SWITCH
         DS    CL2             RESERVED
TLDCSMAP DS    F               CSM AUTO STOR AREA PTR
TLDCFANM DS    CL8             LASTEST CFA NAME FROM DIR
         DS    F               RESERVED
         DS    CL48            RESERVED
         ORG   TLD+316
TLDTESTY DS    F               TSI SPF TEST FLAG
TLDTESTS DS    CL1             SYSTEM LEVEL TEST BITS
TLDTTIO  EQU   X'80'           ON =, TRACE TERM I/O
TLDSPF   EQU   X'40'           ON=SPF MODE
TLDTLOG  EQU   X'20'           ON=TRACE LOG AT TERM
TLDSTEST EQU   X'04'           ON=ALLOWSTAX ATTEN
TLDABEND EQU   X'02'           ON=ALLOW SUBTASK ABEND
TLDMSGMN EQU   X'01'           ON=MSG/MENU TESTING
TLDTESTP DS    CL1             PROC LEVEL TEST BITS
TLDPETFG EQU   X'80'           ON = PET EXECUTION
TLDTESTA DS    CL1             APPL LEVEL TEST BITS
TLDLGERR EQU   X'08'           ON=LOG ALLCSE ERRS
TLDERCON EQU   X'01'           ON=CSE ERR CONTINUE
TLDTESTF DS    CL1             FUNC LEVEL TEST BITS
TLDERRET EQU   X'80'           ON= CSE ERROR RETURN
TLDLGSRV EQU   X'08'           ON=LOG SERVICE CALLS
.ISPFV2F ANOP
         QCOMMON
         END
./       ADD   NAME=ISPSP134
//DORQ134C JOB (6000A,4,,9999),'QI4T QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*JOBPARM SYSAFF=IPO1
/*ROUTE XEQ OVERNITE
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=ACCT01,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3380',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP134,                ENTER SP LEVEL OPTION
//       ISPF=ISPF,               ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1,ISPF             ISPF V1  ONLY
//*        ISPF2,ISPF             ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&ISPF,&OPT,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR
//   DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP4.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,GEN,ISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=A
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP4.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** CLEAR THE OBJECT AND LOAD LIBRARIES
//*
//*********************************************************************
//CLEAR   EXEC SAS
//OBJ      DD  DSN=SYS3.QISPF.JESP4.OBJLIB,DISP=OLD OBJECT LIBRARY
//SYSIN    DD  *
  PROC PDS KILL DDNAME=OBJ   NOLIST; RUN;
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON EXEC QASM,M=Q0     ISPF MODIFIED
//ISPFQI  EXEC QASM,M=ISPFQI ISPF MODIFIED
//ACTIVE  EXEC QASM,M=ACTIVE OK
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH    EXEC QASM,M=AUTH  TSS MODIFIED OK
//CDIE    EXEC QASM,M=CDIE
//CHCT    EXEC QASM,M=CHCT OK
//CIOT    EXEC QASM,M=CIOT  OK
//CJCT    EXEC QASM,M=CJCT  OK
//CJHIST  EXEC QASM,M=CJHIST TSS MODIFIED  OK
//CJOE    EXEC QASM,M=CJOE OK
//CJQE    EXEC QASM,M=CJQE OK
//CKPT    EXEC QASM,M=CKPT OK
//CPDDB   EXEC QASM,M=CPDDB OK
//CPFK    EXEC QASM,M=CPFK
//CSPIN   EXEC QASM,M=CSPIN OK
//CSYS    EXEC QASM,M=CSYS -OK
//CTGPS   EXEC QASM,M=CTGPS
//CTSO    EXEC QASM,M=CTSO -OK
//DDNAME  EXEC QASM,M=DDNAME OK
//DISPLAY EXEC QASM,M=DISPLAY -OK    ISPF MODIFIED
//DOPTION  EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//FFORMAT  EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//FINDJOB EXEC QASM,M=FINDJOB  OK MODIFIED WITH BLANKED JOBNAME
//FINDPDDB EXEC QASM,M=FINDPDDB OK
//FORMAT  EXEC QASM,M=FORMAT OK
//HELP    EXEC QASM,M=HELP -OK
//HEXBLK  EXEC QASM,M=HEXBLK -OK
//HEXDUMP EXEC QASM,M=HEXDUMP -OK
//INIT    EXEC QASM,M=INIT
//INITS   EXEC QASM,M=INITS  OK
//JCL     EXEC QASM,M=JCL OK
//JLOG    EXEC QASM,M=JLOG -OK
//JMSG    EXEC QASM,M=JMSG -OK
//LIST    EXEC QASM,M=LIST -OK
//LISTDS  EXEC QASM,M=LISTDS OK
//LISTDS2  EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//PARSE   EXEC QASM,M=PARSE -OK CDSI MODIFIED
//PRINT   EXEC QASM,M=PRINT -OK
//QUEUE   EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//READSPC EXEC QASM,M=READSPC -OK
//REPOS   EXEC QASM,M=REPOS -OK CDSI MODIFIED
//ROUTE    EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//SAVE    EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//SEARCH  EXEC QASM,M=SEARCH OK
//SYSLOG  EXEC QASM,M=SYSLOG  OK
//SYSOUT  EXEC QASM,M=SYSOUT OK
//XDS     EXEC QASM,M=XDS -OK
//*
//* EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER  WHEN SET OPT=SYSP
//ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//ASIDCSA  EXEC QASM,M=ASIDCSA  JOBS     QASXSYSP
//CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//VSM      EXEC QASM,M=VSM      VSM      QASXSYSP
//VSM1     EXEC QASM,M=VSM1     VSM      QASXSYSP
//VSM2     EXEC QASM,M=VSM2     VSM      QASXSYSP
//VSM3     EXEC QASM,M=VSM3     VSM      QASXSYSP
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=A
//SYSPRINT DD  SYSOUT=A
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP4.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//* INCLUDE SYSSMOD(ASMT3NEW)
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)     JES2 SP1.3.4. AND ISPF V1
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI
 NAME QI@S1341(R)
//*
./       ADD   NAME=ISPSP136
//DORQ136C JOB (6000A,4,,999),'QI4 QUEUE SP136',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=DLIB0B,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3350',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP136,                ENTER SP LEVEL OPTION
//       ISPF='ISPF2,ISPF',       ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1,ISPF             ISPF V1  ONLY
//*        ISPF2,ISPF             ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,CKPT=&CKPT,UNIT=&CUN.,&ISPF.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,ISPF2,NOACF2,SP136'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,VOL=SER=MIPO1P,UNIT=3350
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** CLEAR THE OBJECT AND LOAD LIBRARIES
//*
//*********************************************************************
//CLEAR   EXEC SAS
//OBJ      DD  DSN=SYS3.QISPF.JESC.OBJLIB,DISP=OLD OBJECT LIBRARY
//SYSIN    DD  *
  PROC PDS KILL DDNAME=OBJ   NOLIST; RUN;
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON EXEC QASM,M=Q0     ISPF MODIFIED
//ISPFQI  EXEC QASM,M=ISPFQI ISPF MODIFIED
//ACTIVE  EXEC QASM,M=ACTIVE OK
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH    EXEC QASM,M=AUTH  TSS MODIFIED OK
//CDIE    EXEC QASM,M=CDIE
//CHCT    EXEC QASM,M=CHCT OK
//CIOT    EXEC QASM,M=CIOT  OK
//CJCT    EXEC QASM,M=CJCT  OK
//CJHIST  EXEC QASM,M=CJHIST TSS MODIFIED  OK
//CJOE    EXEC QASM,M=CJOE OK
//CJQE    EXEC QASM,M=CJQE OK
//CKPT    EXEC QASM,M=CKPT OK
//CPDDB   EXEC QASM,M=CPDDB OK
//CPFK    EXEC QASM,M=CPFK
//CSPIN   EXEC QASM,M=CSPIN OK
//CSYS    EXEC QASM,M=CSYS -OK
//CTGPS   EXEC QASM,M=CTGPS
//CTSO    EXEC QASM,M=CTSO -OK
//DDNAME  EXEC QASM,M=DDNAME OK
//DISPLAY EXEC QASM,M=DISPLAY -OK    ISPF MODIFIED
//DOPTION  EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//FFORMAT  EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//FINDJOB EXEC QASM,M=FINDJOB  OK MODIFIED WITH BLANKED JOBNAME
//FINDPDDB EXEC QASM,M=FINDPDDB OK
//FORMAT  EXEC QASM,M=FORMAT OK
//HELP    EXEC QASM,M=HELP -OK
//HEXBLK  EXEC QASM,M=HEXBLK -OK
//HEXDUMP EXEC QASM,M=HEXDUMP -OK
//INIT    EXEC QASM,M=INIT
//INITS   EXEC QASM,M=INITS  OK
//JCL     EXEC QASM,M=JCL OK
//JLOG    EXEC QASM,M=JLOG -OK
//JMSG    EXEC QASM,M=JMSG -OK
//LIST    EXEC QASM,M=LIST -OK
//LISTDS  EXEC QASM,M=LISTDS OK
//LISTDS2  EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//LISTDSR  EXEC QASM,M=LISTDSR  OK CDSI/DOR REQUIRED FOR SYSJOB
//PARSE   EXEC QASM,M=PARSE -OK CDSI MODIFIED
//PRINT   EXEC QASM,M=PRINT -OK
//QUEUE   EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//READSPC EXEC QASM,M=READSPC -OK
//REPOS   EXEC QASM,M=REPOS -OK CDSI MODIFIED
//ROUTE    EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//SAVE    EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//SEARCH  EXEC QASM,M=SEARCH OK
//SYSJOB  EXEC QASM,M=SYSJOB  OK
//SYSLOG  EXEC QASM,M=SYSLOG  OK
//SYSOUT  EXEC QASM,M=SYSOUT OK
//XDS     EXEC QASM,M=XDS -OK
//*
//* EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER  WHEN SET OPT=SYSP
//ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//ASIDCSA  EXEC QASM,M=ASIDCSA  JOBS     QASXSYSP
//CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//VSM      EXEC QASM,M=VSM      VITURAL STORAGE MONITOR
//VSM1     EXEC QASM,M=VSM1     VITURAL STORAGE MONITOR
//VSM2     EXEC QASM,M=VSM2     VITURAL STORAGE MONITOR
//VSM3     EXEC QASM,M=VSM3     VITURAL STORAGE MONITOR
//*
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=ISP.V2R2M0.ISPLOAD,VOL=SER=MIPO1P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESC.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI) JES2  SP 1.3.6  AND ISPF V2
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI6
 NAME QI@S1362(R)
//*
./       ADD   NAME=ISPSR134
//DORQ4ACC JOB (6000A,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//QASM   PROC  M=,CKPT=ACCT01,CUN='3380',RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR  JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//*QCOMMON EXEC QASM,M=Q0     ISPF MODIFIED
//*ISPFQI  EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE  EXEC QASM,M=ACTIVE
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*ASID    EXEC QASM,M=ASID          CDSI MODIFIED
//*AUTH    EXEC QASM,M=AUTH  TSS MODIFIED
//*CDIE    EXEC QASM,M=CDIE
//*CHCT    EXEC QASM,M=CHCT
//*CIOT    EXEC QASM,M=CIOT
//*CJCT    EXEC QASM,M=CJCT
//*CJHIST  EXEC QASM,M=CJHIST TSS MODIFIED
//*CJOE    EXEC QASM,M=CJOE
//*CJQE    EXEC QASM,M=CJQE
//*CKPT    EXEC QASM,M=CKPT
//*CPDDB   EXEC QASM,M=CPDDB
//*CPFK    EXEC QASM,M=CPFK
//*COREZAP EXEC QASM,M=COREZAP COREZAP QASXSYSP CDSI MODIFIED
//*CSPIN   EXEC QASM,M=CSPIN
//*CSYS    EXEC QASM,M=CSYS
//*CTGPS   EXEC QASM,M=CTGPS
//*CTSO    EXEC QASM,M=CTSO
//*DDNAME  EXEC QASM,M=DDNAME
//*DEVIREQ EXEC QASM,M=DEVIREQ     CDSI MODIFIED
//*DISPLAY EXEC QASM,M=DISPLAY     ISPF MODIFIED
//*FINDJOB EXEC QASM,M=FINDJOB     MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB
//*FORMAT  EXEC QASM,M=FORMAT
//*HELP    EXEC QASM,M=HELP
//*HEXBLK  EXEC QASM,M=HEXBLK
//*HEXDUMP EXEC QASM,M=HEXDUMP
//*INIT    EXEC QASM,M=INITNEW
//*INITS   EXEC QASM,M=INITS
//*JCL     EXEC QASM,M=JCL
//*JLOG    EXEC QASM,M=JLOG
//*JMSG    EXEC QASM,M=JMSG
//*LIST    EXEC QASM,M=LIST
//*LISTDS  EXEC QASM,M=LISTDS
//*PARSE   EXEC QASM,M=PARSE CDSI MODIFIED
//*PRINT   EXEC QASM,M=PRINT
//*QUEUE   EXEC QASM,M=QUEUEISP  ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC
//*REPOS   EXEC QASM,M=REPOS CDSI MODIFIED
//*SAVE    EXEC QASM,M=SAVEPGM  RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH  EXEC QASM,M=SEARCH
//*SRM      EXEC QASM,M=SRM      SRM      QASXSYSP CDSI MODIFIED
//*SYSLOG  EXEC QASM,M=SYSLOG
//*SYSOUT  EXEC QASM,M=SYSOUT
//*XDS     EXEC QASM,M=XDS
//** ---- DISPLAY FORMS/FCB
//*FFORMAT  EXEC QASM,M=FFORMAT  CDSI/DOR REQUIRED FOR FORMS
//**
//**   NEW ISPF QUEUE COMMANDS
//*DDNAME2 EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//**DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP   DEBUG
//*ROUTE    EXEC QASM,M=ROUTE    ROUTE    QASXSSM
//*SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//DTAPE   EXEC QASM,M=DTAPE  CDSI MODIFIED
//**COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP DEBUG
//**     LIST WITH CARRIAGE CONTROL CHARS
//*LIST     EXEC QASM,M=LIST     LIST CARRIAGE CONTROL  CDSI
//*DOPTION  EXEC QASM,M=DOPTION  OPT      QASXSSM
//*LISTDS2  EXEC QASM,M=LISTDS2  CDSI/DOR REQUIRED FOR FORMS/LISTCC
//**     ENQ (DEBUG 8/8/85)
//*ENQPGM2   EXEC QASM,M=ENQPGM2  ENQ      QASXSYSP
//*ENQLOAD1  EXEC QASM,M=ENQLOAD1 ENQLOAD1 QASXSYSP
//*ENQLOAD2  EXEC QASM,M=ENQLOAD2 ENQLOAD2 QASXSYSP
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 INCLUDE SYSLIB(DTAPE)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4
 NAME ISPQUEA(R)
//*
./       ADD   NAME=ISR@PRIM
%-----------------------  ISPF/PDF PRIMARY OPTION MENU  ----------------
%OPTION  ===>_ZCMD
%                                                           +USERID   -
%   0 +ISPF PARMS  - Specify terminal and user parameters   +TIME     -
%   1 +BROWSE      - Display source data or output listings +TERMINAL -
%   2 +EDIT        - Create or change source data           +PF KEYS  -
%   3 +UTILITIES   - Perform utility functions
%   4 +FOREGROUND  - Invoke language processors in foreground
%   5 +BATCH       - Submit job for language processing
%   6 +COMMAND     - Enter TSO command or CLIST
%   7 +DIALOG TEST - Perform dialog testing
%   C +CHANGES     - Display summary of changes for this release
%   F +FILEAID     - FILE-AID support
%   QI+QUEUE  %Q+  - JES Queue (QI=ISPF dialog mgmt) (SP134>
%   I +SHOWER      - Systems operator console Interface
%   S +SYSP        - Systems maintainence tools
% SAS +SAS         - Statistical Analysis System
%   V +VPS         - JES/3270 VTAM printer support
%  TS +TSS         - Top secret security administration
%   T +TUTORIAL    - Display information about ISPF/PDF
%   X +EXIT        - Terminate ISPF using log and list defaults
%
+Enter%END+command to terminate ISPF.
%
)INIT
  .HELP = ISR00003
  &ZPRIM = YES        /* ALWAYS A PRIMARY OPTION MENU      */
  &ZHTOP = ISR00003   /* TUTORIAL TABLE OF CONTENTS        */
  &ZHINDEX = ISR91000 /* TUTORIAL INDEX - 1ST PAGE         */
)PROC
  &ZSEL = TRANS( TRUNC (&ZCMD,'.')
                0,'PANEL(ISPOPTA)'
                1,'PGM(ISRBRO)'
                2,'PGM(ISREDIT)'
                3,'PANEL(ISRUTIL)'
                4,'PANEL(ISRFPA)'
                5,'PGM(ISRJB1) PARM(ISRJPA) NOCHECK'
                6,'PGM(ISRPTC)'
                7,'PGM(ISRYXDR) NOCHECK'
                C,'PGM(ISPTUTOR) PARM(ISR00005)'
                F,'PANEL(IFAMU01)'
                V,'CMD(VP41CTL)'
               v1,'CMD(VPS4CTL)'
               VX,'CMD(VPS4CTL)'
               VP,'PGM(ISRFOR) PARM(VPSPRINT)'
      Q,'CMD(QUESP134)'                 /*STANDALONE TSO SP134*/
     Q6,'CMD(QUESP136)'                 /*STANDALONE TSO SP136*/
     QI,'PGM(QI@S1341) NOCHECK'              /*SP134 & ISPF V1*/
    QI2,'PGM(QI@S1342) NOCHECK NEWAPPL(QI@)' /*SP134 & ISPF V2*/
    QI6,'PGM(QI@S1361) NOCHECK'              /*SP136 & ISPF V1*/
   QI62,'PGM(QI@S1362) NOCHECK NEWAPPL(QI@)' /*SP136 & ISPF V2*/
                I,'CMD(SHOWER)'
                S,'PANEL(VSYSP2)'
                SAS,'CMD(%SAS@PRIM)'
               SG,'PANEL(SYSGMAIN)'
                TS,'PANEL(TSS@PRIM)'
                T,'PGM(ISPTUTOR) PARM(ISR00000)'
              ' ',' '
                X,'EXIT'
                *,'?' )
  IF (&ZCMD ='QI2')
     &ZSEL ='PGM(QI@S1342) NOCHECK NEWAPPL(QI@)'
  IF (&ZCMD ='QI62')
     &ZSEL ='PGM(QI@S1362) NOCHECK NEWAPPL(QI@)'
 /* ispf/queue must have pf5 (IFIND) in replace of RFIND. */
  &ZTRAIL = .TRAIL
)END
./       ADD   NAME=ISRSP136
//DORQ136C JOB (6000A,4,,99),'QI4 QUEUE SP136',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=DLIB0B,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3350',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP136,                ENTER SP LEVEL OPTION
//       ISPF='ISPF2,ISPF',       ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,CKPT=&CKPT,UNIT=&CUN.,&ISPF.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,ISPF2,NOACF2,SP136'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,VOL=SER=MIPO1P,UNIT=3350
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//*RESTART EXEC PGM=IEFBR14
//*QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//*ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH   EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT  EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//*HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT   EXEC QASM,M=INIT
//*INITS  EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//*QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//**
//** EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER WHEN SET OPT=SYSP
//*ACTMON  EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID    EXEC QASM,M=ASID     JOBS     QASXSYSP
//*ASIDCSA EXEC QASM,M=ASIDCSA  JOBS     QASXSYSP
//*CHANMON EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2 EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//DEVIREQ EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON  EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN  EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE   EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP    EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS    EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM     EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP  EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO  EXEC QASM,M=SUINFO   SU       QASXSYSP
//*VSM     EXEC QASM,M=VSM      VITURAL STORAGE MONITOR
//*VSM1    EXEC QASM,M=VSM1     VITURAL STORAGE MONITOR
//*VSM2    EXEC QASM,M=VSM2     VITURAL STORAGE MONITOR
//*VSM3    EXEC QASM,M=VSM3     VITURAL STORAGE MONITOR
//*
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=ISP.V2R2M0.ISPLOAD,VOL=SER=MIPO1P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESC.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI) JES2  SP 1.3.6  AND ISPF V2
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI6T
 NAME ISPQ136T(R)
/*
./       ADD   NAME=ISTCHACC
//DORQTEST JOB (6000A,004,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//*                          
//*                          
//*                    VVVVVV      VVVV
//QASM   PROC  M=,CKPT=ACCT01,CUN='3380',
//           RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0                    HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4T
 NAME ISPQ134X(R)
//*
./       ADD   NAME=ISTCHPLP
//DORQTEST JOB (6000E,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//       NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//*                          
//*                          
//*                    VVVVVV      VVVV
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',
//           RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0                    HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4T
 NAME ISPQ134X(R)
//*
./       ADD   NAME=ISTCH134
//DORQTEST JOB (6000A,004,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//*                          
//*                          
//*                    VVVVVV      VVVV
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',
//           RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(TSS,ISPF,NOACF2,SP134,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0                    HASPCKPT VOLUME NAME
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4T
 NAME ISPQ134X(R)
//*
./       ADD   NAME=ISTRL134
//DORQJESA JOB (6000A,004,,99),'QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//*
//* RELINKED AFTER COMPLETED TESTING ISPF QUEUE
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=MVSSY3,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QIA
 NAME ISPQUEA(R)
//*
./       ADD   NAME=ISTSP134
//DORQ134C JOB (6000A,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*JOBPARM SYSAFF=IPO1
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=ACCT01,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3380',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP134,                ENTER SP LEVEL OPTION
//       ISPF=ISPF,               ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,&ISPF,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR
//   DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,GEN,ISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//*RESTART  EXEC PGM=IEFBR14
//QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//*ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH   EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT   EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//*HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//INIT   EXEC QASM,M=INIT
//*INITS  EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//*QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//**
//** EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER WHEN SET OPT=SYSP
//*ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//*ASIDCSA  EXEC QASM,M=ASIDCSA  CSA/STC  QASXSYSP
//*CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//*VSM      EXEC QASM,M=VSM      VSM      QASXSYSP
//*VSM1     EXEC QASM,M=VSM1     VSM      QASXSYSP
//*VSM2     EXEC QASM,M=VSM2     VSM      QASXSYSP
//*VSM3     EXEC QASM,M=VSM3     VSM      QASXSYSP
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=M
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//* INCLUDE SYSSMOD(ASMT3NEW)
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4T
 NAME ISPQ134X(R)
//*
./       ADD   NAME=ISTSP136
//DORQ136C JOB (6000A,4,,99),'QI4 QUEUE SP136',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*    IN PARM DPRF=  IN QASM PROC LINE              3/14/87
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=PLPA02,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3350',              UNIT NAME OF CHECKPOINT DSN
//       DPRF='SYS3',             PREFIX OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP='(SP136,ISPF)',       ENTER SP LEVEL OPTION
//       OPT='TSS,NOACF2'         ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*        (NOTE: ASM INITNEW FOR ISPF INTERFACE OR INIT FOR TSO ONLY)
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,DPRF=&DPRF,CKPT=&CKPT,UNIT=&CUN)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=SIPO2P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0A
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,ISPF,NOACF2,SP136'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR JES2 MACRO
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=SIPO2P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0A
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=A
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//*QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH   EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT   EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//*HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT   EXEC QASM,M=INIT
//*INITS EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//*QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//*
//* EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER  WHEN SET OPT=SYSP
//*ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID    EXEC QASM,M=ASID     JOBS     QASXSYSP
//*CHANMON EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2 EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON  EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN  EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE   EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP    EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS    EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM     EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP  EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO  EXEC QASM,M=SUINFO   SU       QASXSYSP
//*
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=ISP.V2R2M0.ISPLOAD,VOL=SER=SIPO2P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESC.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI6T
 NAME ISPQ136T(R)
//*
./       ADD   NAME=ISTS2134
//DORQ134C JOB (6000A,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*JOBPARM SYSAFF=IPO1
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=ACCT01,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3380',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM='GEN,BGEN',          ENTER ASSEMBLER OPTIONS
//       SP=SP134,                ENTER SP LEVEL OPTION
//       ISPF='ISPF,ISPF2',       ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF QUEUE INTERFACE REQUIRED
//*        ISPF1,ISPF             ISPF V1  ONLY
//*        ISPF2,ISPF             ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,&ISPF,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR
//   DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=*
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,GEN,ISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=*
//SYSPUNCH DD  DSN=SYS3.QISPF.JESP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//*QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//*ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH  EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT   EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//*HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT   EXEC QASM,M=INIT
//*INITS  EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//**
//** EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER WHEN SET OPT=SYSP
//*ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//*ASIDCSA  EXEC QASM,M=ASIDCSA  JOBS     QASXSYSP
//*CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//*VSM      EXEC QASM,M=VSM
//*VSM1     EXEC QASM,M=VSM1
//*VSM2     EXEC QASM,M=VSM2
//*VSM3     EXEC QASM,M=VSM3
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=ISP.V2R2M0.ISPLOAD,VOL=SER=SIPO2P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//* INCLUDE SYSSMOD(ASMT3NEW)
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 INCLUDE SYSLIB(AUTH)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI42
 NAME ISPQ1342(R)
//*
./       ADD   NAME=ISTS2136
//DOR001 JOB (6000A,4,,99),'DAVID RIKER',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT='CKPT=ACCT01,DPRF=SYS1,UNIT=3380', HASPCKPT DSN CONFIG
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP136,                ENTER SP LEVEL OPTION
//       ISPF='ISPF2,ISPF',       ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,&CKPT,&ISPF.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//         VOL=SER=8DBP02,UNIT=3380
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,ISPF2,NOACF2,SP136'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.QUEISPF.SP136.HASPSRC,DISP=SHR,
//         VOL=SER=8DBP02,UNIT=3380
//   DD  DSN=SYS1.HASPSRC,DISP=SHR,VOL=SER=MIPO1P,UNIT=3350
//   DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MIPO1P
//   DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=DLIB0B
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.JESC.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//*RESTART EXEC PGM=IEFBR14
//*QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//*ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH   EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT  EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT   EXEC QASM,M=INIT
//*INITS  EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*LISTDSR EXEC QASM,M=LISTDSR OK DOR/CDSI REQUIRED FOR SYSJOB
//PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//*QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSJOB EXEC QASM,M=SYSJOB  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//**
//** EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER WHEN SET OPT=SYSP
//*ACTMON  EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID    EXEC QASM,M=ASID     JOBS     QASXSYSP
//*ASIDCSA EXEC QASM,M=ASIDCSA  JOBS     QASXSYSP
//*CHANMON EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2 EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON  EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN  EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE   EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP    EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS    EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM     EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP  EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO  EXEC QASM,M=SUINFO   SU       QASXSYSP
//*VSM     EXEC QASM,M=VSM      VITURAL STORAGE MONITOR
//*VSM1    EXEC QASM,M=VSM1     VITURAL STORAGE MONITOR
//*VSM2    EXEC QASM,M=VSM2     VITURAL STORAGE MONITOR
//*VSM3    EXEC QASM,M=VSM3     VITURAL STORAGE MONITOR
//*
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=ISP.V2R2M0.ISPLOAD,VOL=SER=MIPO1P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=C6000A.DOR.LINKLIB3,DISP=SHR LINK LIBRARY
//SYSSYS   DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QISPF.JESC.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(ISPFQI) JES2  SP 1.3.6  AND ISPF V2
 INCLUDE SYSISPF(ISPLINK) ISPF V2 MODULE
 INCLUDE SYSSYS(ASMTRACE)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 INCLUDE SYSLIB(SYSJOB)
 INCLUDE SYSLIB(LISTDSR)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI6T
 NAME ISPQ136T(R)
//*
./       ADD   NAME=JCL
JCL      TITLE 'QUEUE COMMAND - LIST THE JCL FOR A JOB'           ONL01
JCL      QSTART ,                  START JCL CSECT ASSEMBLY       ONL01
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAJCL             PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'10' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'3'   DSID OF DATASET TO BE PRINTED
         L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=JCLCHACC
//DORQ4JES JOB (6000A,4,,99),'Q4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*AFTER DORQ4ACC
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*   SHORT JOB TO CHANGE CKPT
//*   CHANGE IN CKPT= ON QASM PROC LINE      1/6/86
//*
//QASM   PROC  M=,CKPT=ACCT01,CUN='3380',RENT='DECK,RENT,NOLOAD',
//        NOISPF='PFK,TSS,NOISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&NOISPF,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//        UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD  DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(DISPLOLD)
 SETCODE AC(1)
 ENTRY QUEUE
 ALIAS Q4
 NAME QUESP134(R)
//*
./       ADD   NAME=JCLCHPLP
//DORQ4JES JOB (6000A,004,,99),'Q4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*AFTER DORQ4PLP
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*   SHORT JOB TO CHANGE CKPT
//*   CHANGE IN CKPT= ON QASM PROC LINE      1/6/86
//*
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',RENT='DECK,RENT,NOLOAD',
//        NOISPF='PFK,TSS,NOISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&NOISPF,CKPT=&CKPT,UNIT=&CU.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//        UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD  DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(DISPLOLD)
 SETCODE AC(1)
 ENTRY QUEUE
 ALIAS Q4
 NAME QUESP134(R)
//*
./       ADD   NAME=JCLCH134
//DORQ4JES JOB (6000A,004,,99),'Q4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*   SHORT JOB TO CHANGE CKPT
//*   CHANGE IN CKPT= ON QASM PROC LINE      1/6/86
//*
//QASM   PROC  M=,CKPT=PLPA01,CUN='3350',RENT='DECK,RENT,NOLOAD',
//        NOISPF='PFK,TSS,NOISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&NOISPF,CKPT=&CKPT,UNIT=&CU.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//        UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//*        DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD  DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(DISPLOLD)
 SETCODE AC(1)
 ENTRY QUEUE
 ALIAS Q4
 NAME QUESP134(R)
//*
./       ADD   NAME=JCLSP134
//DORQ4JES JOB (6000A,004,,99),'Q4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*
//QASM   PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(PFK,TSS,NOISPF,NOACF2,SP134,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//        UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=D30831
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD  DSN=SYS3.QUEISPF.SP134.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** CLEAR THE OBJECT AND LOAD LIBRARIES
//*
//*********************************************************************
//CLEAR   EXEC SAS
//OBJ      DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=OLD OBJECT LIBRARY
//SYSIN    DD  *
  PROC PDS KILL DDNAME=OBJ   NOLIST; RUN;
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//QCOMMON  EXEC QASM,M=Q0
//ACTIVE   EXEC QASM,M=ACTIVE
//ALLOCATE EXEC QASM,M=ALLOCATE
//AUTH     EXEC QASM,M=AUTH
//CDIE     EXEC QASM,M=CDIE
//CHCT     EXEC QASM,M=CHCT
//CIOT     EXEC QASM,M=CIOT
//CJCT     EXEC QASM,M=CJCT
//CJHIST   EXEC QASM,M=CJHIST
//CJOE     EXEC QASM,M=CJOE
//CJQE     EXEC QASM,M=CJQE
//CKPT     EXEC QASM,M=CKPT
//CPDDB    EXEC QASM,M=CPDDB
//CPFK     EXEC QASM,M=CPFK
//CSPIN    EXEC QASM,M=CSPIN
//CTGPS    EXEC QASM,M=CTGPS
//CTSO     EXEC QASM,M=CTSO
//DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//DISPLAY  EXEC QASM,M=DISPLOLD    DO NOT USE DISPLAY NOT WORK ON PFK
//DOPTION   EXEC QASM,M=DOPTION  OPT      QASXSSM
//FINDJOB  EXEC QASM,M=FINDJOB
//FINDPDDB EXEC QASM,M=FINDPDDB
//FORMAT   EXEC QASM,M=FORMAT
//FFORMAT   EXEC QASM,M=FFORMAT  CDSI/DOR REQUIRED FOR FORMS
//HELP     EXEC QASM,M=HELP
//HEXBLK   EXEC QASM,M=HEXBLK
//HEXDUMP  EXEC QASM,M=HEXDUMP
//INIT     EXEC QASM,M=INIT
//INITS    EXEC QASM,M=INITS
//JCL      EXEC QASM,M=JCL
//JLOG     EXEC QASM,M=JLOG
//JMSG     EXEC QASM,M=JMSG
//LIST     EXEC QASM,M=LIST
//LISTDS   EXEC QASM,M=LISTDS
//LISTDS2   EXEC QASM,M=LISTDS2  CDSI/DOR REQUIRED FOR FORMS/LISTCC
//PARSE    EXEC QASM,M=PARSE
//PRINT    EXEC QASM,M=PRINT
//QUEUE    EXEC QASM,M=QUEUE
//READSPC  EXEC QASM,M=READSPC
//REPOS    EXEC QASM,M=REPOS
//ROUTE     EXEC QASM,M=ROUTE    CDSI     QASXSSM
//SAVEPGM  EXEC QASM,M=SAVEPGM
//SEARCH   EXEC QASM,M=SEARCH
//SYSLOG   EXEC QASM,M=SYSLOG
//SYSOUT   EXEC QASM,M=SYSOUT
//XDS      EXEC QASM,M=XDS
//CSYS     EXEC QASM,M=CSYS
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(DISPLOLD)
 SETCODE AC(1)
 ENTRY QUEUE
 ALIAS Q4
 NAME QUESP134(R)
//*
./       ADD   NAME=JCTSP134
//DORQJESA JOB (6000A,004,,99),'Q4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   SET 0 TO QUBLK IN QSTART
//*   SEE $CDSIDOC
//*
//QASM   PROC  M=,CKPT=MVSDL1,RENT='DECK,RENT,NOLOAD'
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(PFK,GEN,TSS,NOISPF,NOACF2,SP134,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=C6000A.DOR.UTIL393,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//        UNIT=3350,VOL=SER=CDSI06 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=MVSSY3
//         DD  DSN=SYS1.AMODGEN,DISP=SHR,UNIT=3350,VOL=SER=MVSDL1
//         DD DSN=SYS3.AOST.V60.MACLIB,DISP=SHR,UNIT=3350
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//*SYSLIN   DD  DSN=SYS3.QUEUE.JESA.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN    DD  DSN=C6000A.DOR.UTIL393(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*********************************************************************
//*
//**** CLEAR THE OBJECT AND LOAD LIBRARIES
//*
//*********************************************************************
//*********************************************************************
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//*********************************************************************
//RESTART  EXEC PGM=IEFBR14
//AUTH     EXEC QASM,M=AUTH
//*CJHIST   EXEC QASM,M=CJHIST
//*QUEUE     EXEC QASM,M=QUEUE
//*DISPLAY   EXEC QASM,M=DISPLOLD
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS3.QUEUE.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR,UNIT=3350
//SYSLIN   DD  *
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUE)
 INCLUDE SYSLIB(DISPLOLD)
 INCLUDE SYSLIB(AUTH)
 INCLUDE SYSLIB(SAVEPGM)
 SETCODE AC(1)
 ENTRY QUEUE
 ALIAS Q4T
 NAME QUETP134(R)
//*
./       ADD   NAME=JLOG
JLOG     TITLE 'QUEUE COMMAND - LIST JOBLOG MESSAGES FOR A JOB'   ONL01
JLOG     QSTART HASPEQU=YES,       START JLOG CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE CMD - LIST JOBLOG MESSAGES FOR A JOB'
         GBLB  &QSP133                                            UF046
         GBLB  &QSP136        SP 1.3.6 OPTION FLAG                DOR
         GBLB  &QJTIP         JTIP OPTION                         ONL05
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAJLOG            PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL05
*                                                                 ONL05
*   FIND JOB LOG PDDB                                             ONL05
*                                                                 ONL05
******************************************************************ONL05
         SPACE 1                                                  ONL05
         AIF   (NOT &QSP136).NO136A                               DOR
         USING PDB,R2              BASE REG FOR PDDB              DOR
         USING IOT,R3              BASE REG FOR IOT               DOR
         L     R3,QCIOTA           LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOT)     ADJUST FOR HEADER        DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         USING PDBDSECT,R2         BASE REG FOR PDDB
         USING IOTDSECT,R3         BASE REG FOR IOT               UF046
         L     R3,QCIOTA           LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
.X136A   ANOP                                                     DOR
         SPACE 1                                                  ONL03
         CLC   IOTID,=CL4'IOT'     WAS AN IOT READ FROM SPOOL?    ONL03
         BNE   BADIOT              ERROR IF NO                    ONL03
         CLC   QPJOBID,IOTJBKEY    IS THE IOT'S JOB KEY VALID?    ONL03
         BNE   BADIOT              ERROR IF NO                    ONL03
         SPACE 1                                                  ONL03
         LR    R4,R3               COPY IOT ADDR                  ONL03
         A     R4,IOTPDDBP         OFFSET BEYOND LAST PDDB
         LR    R2,R3               BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB          OFFSET TO FIRST PDDB IN IOT    UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1          OFFSET TO FIRST PDDB IN JOT
.C29B    ANOP  ,                                                  UF046
FINDDS   CLC   PDBDSKEY,=H'2'      IS THIS THE JOB LOG
         BE    FOUNDDS             YES. CONTINUE.
         LA    R2,PDBLENG(R2)      NO. LOOK AT NEXT PDDB
         CR    R2,R4               HAVE WE GONE PAST THE LAST PDDB
         BL    FINDDS              NO. TRY AGAIN
         B     NOJLPDDB            ERROR IF JOB LOG PDDB NOT FOUNDONL05
         SPACE 1                                                  ONL05
FOUNDDS  DS    0H                  JLOG PDDB HAS BEEN FOUND       ONL05
         SPACE 2                                                  ONL05
******************************************************************ONL05
*                                                                 ONL05
*  THE JOBLOG IS CONSIDERED AVAILABLE IF:                         ONL05
*                                                                 ONL05
*     (1) IF THE JOBLOG HAS MORE THAN ONE LINE OF OUTPUT.         ONL05
*     (2) THE JOB IS ON THE OUTPUT OR HARDCOPY QUEUES.            ONL05
*     (3) THE JOB IS NOT ON THE INPUT OR CONVERSION QUEUES.       ONL05
*     (4) THE CONVERTER RETURN CODE IS NON-ZERO.                  ONL05
*     (5) IF THE &QJTIP OPTION IS OFF AND THE JOB'S EXECUTION     ONL05
*         START TIME (JCTXEQON) IS NON-ZERO.                      ONL05
*                                                                 ONL05
*  OTHERWISE, THE JOBLOG IS CONSIDERED NOT AVAILABLE.             ONL05
*                                                                 ONL05
******************************************************************ONL05
         SPACE 1                                                  ONL05
         CLC   PDBRECCT,=F'2'      ARE WE SURE JOB LOG HAS INFO ? ONL05
         BH    LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
         SPACE 1                                                  ONL05
         L     R4,QCJQEA           ADDR OF JQE                    ONL05
         AIF   (NOT &QSP136).NO136B                               DOR
         USING JQE,R4             NOTE JQE ADDRESSABILITY         DOR
         AGO   .X136B                                             DOR
.NO136B  ANOP                                                     DOR
         USING JQEDSECT,R4         NOTE JQE ADDRESSABILITY        ONL05
.X136B   ANOP                                                     DOR
         SPACE 1                                                  ONL05
         CLI   JQETYPE,$OUTPUT     IT'S OK TO                     ONL05
         BE    LOGOK                LIST THE JOBLOG               ONL05
         CLI   JQETYPE,$HARDCPY      IF THE JOB IS ON THE         ONL05
         BE    LOGOK                  OUTPUT OR HARDCOPY QUEUES   ONL05
         SPACE 1                                                  ONL05
         CLI   JQETYPE,$INPUT      DON'T LIST THE                 ONL05
         BE    NOLOG                JOBLOG IF THE JOB             ONL05
         CLI   JQETYPE,$XEQ          IS ON THE INPUT              ONL05
         BE    NOLOG                  OR CONVERSION QUEUES        ONL05
         SPACE 1                                                  ONL05
         L     R3,QCJCTA           ADDR OF JCT                    ONL05
         AIF   (NOT &QSP136).NO136C                               DOR
         USING JCT,R3             NOTE JCT ADDRESSABILITY         DOR
         AGO   .X136C                                             DOR
.NO136C  ANOP                                                     DOR
         USING JCTDSECT,R3         NOTE JCT ADDRESSABILITY        ONL16
.X136C   ANOP                                                     DOR
         SPACE 1                                                  ONL05
         CLC   JCTCNVRC,=F'0'      NON-ZERO CONVERTER RETURN CODE?ONL05
         BNE   LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
         SPACE 1                                                  ONL05
         AIF   (&QJTIP).ONL05A                                    ONL05
         CLC   JCTXEQON,=F'0'      JOB EXECUTING OR EXECUTED ?    ONL05
         BNZ   LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
.ONL05A  ANOP  ,                                                  ONL05
         SPACE 1                                                  ONL05
         B     NOLOG               OTHERWISE, DON'T LIST JOBLOG   ONL05
         SPACE 1                                                  ONL05
         DROP  R3                  KILL JCT ADDRESSABILITY        ONL05
         DROP  R4                  KILL JQE ADDRESSABILITY        ONL05
         SPACE 1                                                  ONL05
LOGOK    DS    0H                  OK TO LIST THE JOBLOG          ONL05
         SPACE 2                                                  ONL05
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'2'   DSID OF DATASET TO BE PRINTED
         L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
         SPACE 2                                                  ONL03
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
NOLOG    QTILT '*** JOBLOG IS NOT AVAILABLE ***'                  ONL05
NOJLPDDB QTILT '*** JOBLOG PDDB NOT FOUND ***'                    ONL05
         SPACE 1                                                  ONL05
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
JLOG     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136D                               DOR
         IFGRPL  DSECT=YES,AM=VTAM
         AGO   .X136D                                             DOR
.NO136D  ANOP                                                     DOR
JCT      EQU   0
.X136D   ANOP                                                     DOR
         $BUFFER                                                  UF020
         $JQE
         $TAB
         $JCT
         $PDDB
         $IOT
         QCOMMON ,                                                ONL11
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=JMSG
JMSG     TITLE 'QUEUE COMMAND - LIST SYSTEM MESSAGES FOR A JOB'   ONL01
JMSG     QSTART ,                  START JMSG CSECT ASSEMBLY      ONL01
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAJMSG            PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'4'   DSID OF DATASET TO BE PRINTED
         L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=JOBS
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     2/21/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
JOBS     TITLE 'QUEUE COMMAND - JOBS  INFORMATION  '
JOBS     QSTART ,                  START JOBS DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
***********************************************************************
***       FORMERLY AND MODIFIED FOR QUEISPF                         ***
*              'IEESE03D -   #A  EXTENDED DISPLAY ACTIVE'
***********************************************************************
*               'JOBS .JOBNM    1 LINES OF OUTPUT FOR AN JOBNAME   '
*               'JOBS           1 LINES FOR ALL ACTIVE TASKS       '
*               'JOBS XX        1 LINES OF OUTPUT FOR SELECTED TYPE'
*               '  WHERE  XX  IS    -                            '
*               '       NN        SELECT ALL JOBS IN DOMAIN 00   '
*               '        A        SELECT ALL JOB, TSU, AND STC   '
*               '        J        SELECT ALL JOBS                '
*               '        T        SELECT ALL TSO USERS           '
*               '        S        SELECT ALL STARTED TASKS       '
*               '        I        SELECT ALL IDLE INITIATORS     '
*               '** NOTE -  IF SWAP REASON CODE IS 00,  QUEUE    '
*               '           POSITION PRINTS INSTEAD              '
***********************************************************************
         EJECT
***********************************************************************
*    R1
*    R2   -
*    R3
*    R4   -
*    R5   -
*    R6   -
*    R7
*    R8   -
*    R9   -
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
         TIME  BIN
         ST    R0,TIMECMD
         MVC   PARM(10),=CL10' '
         MVI   LISTIND,C'L'        SET LIST
         MVI   SCANRET,C' '        SET FOUND
         CLI   QPARM1,C' '
         BE    JOBSCAN             YES. GO PROCESS
         LA    R3,QPARM1     SET SCAN TYPE
         LR    R7,R3               SAVE PARM START
         LA    R4,9                MAXLENGTH
         EJECT
PARM1    CLI   0(R3),C' '          END OF PARM
         BE    PARM2               YES, USE IT
         LA    R3,1(0,R3)          INCR INTO PARM
         BCT   R4,PARM1            CHECK NEXT BYTE
         B     ERROR               PARM TOO LONG
         SPACE
PARM2    LA    R6,9                MAX LENGTH-1
         SR    R6,R4               ACTUAL LENGTH
         BNP   ERROR               ZERO LENGTH                     WJB
         STH   R6,JOBLEN
         EX    R6,JOBMOVE          MOVE PARM INFO
         B     JOBSCAN
         SPACE 3
JOBMOVE  MVC   PARM(0),0(R7)       MOVE PARM INFO
JOBCOMP  CLC   PARM+1(*-*),JOBNAME COMPARE ANY LENGTH OF JOBNAME
         EJECT
JOBSCAN  SR    R8,R8               CLEAR ASID
         XC    SCANTYPE(2),SCANTYPE CLEAR TYPE IND
         CLI   PARM,C'.'           JOBNAME REQUEST
         BE    JOBOUT              YES, GO PROCESS
         CLI   PARM,C' '           ALL REQUESTED
         BE    JOBOUTX             SET UP ALL, NO LIST
         TM    PARM+2,X'F0'        ONE JOB ONLY REQUEST
         BO    JOBSCAN1            YES
         SPACE
JOBSCAN0 MVI   SCANTYPE+1,X'04'    TSO USERS
         CLI   PARM,C'T'         IS REQUEST FOR TSO USERS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'08'    JOBS
         CLI   PARM,C'J'         IS REQUEST FOR JOBS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'0C'    STC
         CLI   PARM,C'S'         IS REQUEST FOR STC
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'10'    INITS
         CLI   PARM,C'I'         IS REQUEST FOR INITS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'18'    ALL JOBS
         CLI   PARM,C'A'         IS REQUEST FOR INITS
         BE    JOBOUT              YES, GO PROCESS
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),PARM
         CLC   DOUBLE(2),=C'00'    DOMAIN SPECIFIED
         BNE   ERROR               NO, PARM ERROR
         PACK  DOUBLE(8),PARM(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAINTS         SAVE SCAN DOMAIN
         MVI   SCANTYPE+1,X'14'    SET DOMAIN SCAN
         B     JOBOUT
         SPACE
JOBSCAN1 LA    R4,PARM             ASID INPUT ADDR
         LA    R5,4                LOAD NUMBER OF DIGITS
         SPACE
JOBSCAN2 LA    R3,9                SET ADD BYTE
         CLI   0(R4),C'A'          VALID CHAR
         BL    ERROR               NO, ERROR
         CLI   0(R4),C'F'          VALID CHAR
         BNH   JOBSCAN3            YES, GO USE
         CLI   0(R4),C'0'          VALID CHAR
         BL    ERROR               NO, ERROR
         CLI   0(R4),C'9'          VALID CHAR
         BH    ERROR               NO, ERROR
         SR    R3,R3               CLEAR ADD BYTE
         SPACE
JOBSCAN3 IC    R7,0(0,R4)          INSERT ASID BYTE
         SLL   R7,28               SHIFT OUT JUNK
         SRL   R7,28               SHIFT BACK
         AR    R3,R7               ADD TO CALC ACTUAL DIGIT
         SLL   R3,28               SHIFT OVER DIGIT
         SLDL  R2,4                SHIFT DIGIT INTO ACCUMULATOR
         LR    R8,R2               GET ASID
         LA    R4,1(0,R4)          NEXT ASID BYTE
         BCT   R5,JOBSCAN2         GET NEXT
         B     JOBOUT
         EJECT
JOBOUTX  MVI   LISTIND,C'L'
         SPACE
JOBOUT   EQU   *
         MVC   QDHLINE(80),JOBLINE0
         MVC   QDMSG(80),JOBLINE1
         BAL   R14,DISPLAY
         MVC   QDMSG(80),QBLANK
         LR    R5,R8               LOAD ASID
         LTR   R5,R5               ZERO ASID
         BZ    *+6                 YES, BYPASS ADJUST
         BCTR  R5,0                ADJUST ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         B     JOBOUT4
         SPACE
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         LH    R3,SCANTYPE         LOAD INCR INTO TABLE
         B     *+4(R3)             BR INTO TABLE
         B     JOBOUT2             ALL TYPES
         B     TSO                 TS USERS
         B     JOB                 JOBS
         B     STC                 STARTED TASKS
         B     JOB                 INITS
         B     DOM                 DOMAIN SCAN
         B     JOBOUT2             ALL JOBS
         SPACE
JOBOUT2  BAL   R14,ASCBFORM        GO FORMAT ASCB INFO
         UNPK  OUCB(7),145(4,R5)   OUCB ADDR
         NC    OUCB(6),=8X'0F'
         TR    OUCB(6),=C'0123456789ABCDEF'
         MVI   OUCB+6,C' '
         L     R6,144(0,R5)        OUCB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R14,CSCBFORM        GO FORMAT CSCB INFO
         BAL   R14,OUCBFORM        GO FORMAT OUCB INFO
         CLI   PARM,C'.'           JOBNAME REQUEST
         BNE   JOBOUT2A            NO, BYPASS MATCH
         LH    R14,JOBLEN
         SH    R14,=H'2'           LESS TWO
         EX    R14,JOBCOMP        COMPARE ANY LENGTH OF JOBNAME
         BNE   JOBOUT3             NO MATCH, NO PRINT
JOBOUT2A EQU   *
         BAL   R14,DISPLAY         GO PRINT MSG
         SPACE
JOBOUT3  LTR   R8,R8               ONE JOB ONLY
*        BNZ   RETURN              YES, RETURN
         SPACE
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    RETURN              YES, RETURN
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         SPACE 1
JOBOUT5  MVC   JOBMSG1+28(12),=CL12'DISPATCHABLE'
         L     R5,0(0,R4)          ASCB ADDR
         TM    208(R5),X'80'       LSMQ BIT ON
         BZ    *+10                NO, DISPATCHABLE
         MVC   JOBMSG1+28(12),=CL12' '
         BAL   R14,DISPLAY         GO PRINT MSG
         B     JOBOUT3
         EJECT
TSO      CLI   28(R6),X'01'        TSO USER
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
         SPACE 3
JOB      CLI   28(R6),X'03'        JOB INIT
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
         SPACE 3
STC      CLI   28(R6),X'00'        MASTER/AUXTM
         BE    JOBOUT2             YES, USE IT
         CLI   28(R6),X'03'        JOB INIT
         BE    JOBOUT4             YES, BYPASS
         TM    18(R7),X'50'        START/MOUNT
         BZ    JOBOUT4             NO, CHECK NEXT
         B     JOBOUT2             YES, USE IT
         SPACE 3
DOM      CLC   DOMAINTS(1),40(R7)  DOMAIN MATCH     MVS/SE         WJB
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
         EJECT
ASCBFORM EQU   *
         ST    R14,SAVER14
         LTR   R8,R8               ASID PRESENT
         BZ    ASCBFRM1            NO, CONTINUE
         SR    R14,R14             LOAD
         IC    R14,36(0,R5)
         SLL   R14,8                  ASID
         IC    R14,37(0,R5)
         CR    R14,R8              ASID MATCH
         BNE   JOBOUT4             NO, NO PRINT
         SPACE
ASCBFRM1 EQU   *
*        UNPK  DOUBLE(5),36(3,R5)
*        NC    DOUBLE(4),=4X'0F'
*        TR    DOUBLE(4),=C'0123456789ABCDEF'
*        MVC   ASID(4),DOUBLE      SET ASID IN MSG
         SR    R3,R3
         IC    R3,43(0,R5)         DPRTY TO MSG
         CVD   R3,DOUBLE
         UNPK  DPRTY(3),DOUBLE+6(2)
         OI    DPRTY+2,X'F0'
         LH    R1,122(0,R5)        NON-VAM SLOT COUNT
         CVD   R1,DOUBLE
         UNPK  NVAMSLOT(4),DOUBLE+5(3)
         OI    NVAMSLOT+3,X'F0'
         LH    R1,120(0,R5)        VAM SLOT COUNT
         CVD   R1,DOUBLE
         UNPK  VAMSLOT(5),DOUBLE+5(3)
         OI    VAMSLOT+4,X'F0'
*        MVC   SRC-3(2),=C'QP'     SET QUE POSITION IND
         LH    R1,38(0,R5)         DISP POSITION
         CVD   R1,DOUBLE
         UNPK  SRC(2),DOUBLE+6(2)
         OI    SRC+1,X'F0'
         L     R14,SAVER14
         BR    R14
         EJECT
CSCBFORM ST    R14,SAVER14
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         CLI   PARM,C'S'         STC REQUEST
         BE    JOBOUT4             YES, EXIT
         LA    R3,0(0,R5)          SAVE CSCB ADDR
         SR    R14,R14             INSERT
         IC    R14,30(0,R5)
         SLL   R14,8               ASID
         IC    R14,31(0,R5)
         SPACE
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     CSCBFRM2            CONTINUE
         CR    R5,R9               SAME CSCB
         BE    CSCBFRM2            YES, USE IT
         CH    R14,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
         CLI   PARM,C'I'         REQUEST FOR INITS
         BE    JOBOUT4             YES, BYPASS
         B     CSCBFRM3
         SPACE
CSCBFRM2 CLI   PARM,C'I'         REQUEST FOR INITS
         BNE   JOBOUT4             NO, BYPASS
         SPACE
CSCBFRM3 MVC   JOBNAME(8),8(R5)
         L     R14,SAVER14
         CLC   ASID(4),=C'0001'
         BCR   7,R14
         MVC   JOBNAME(8),=CL8'MASTER'
         BR    R14
         EJECT
OUCBFORM ST    R14,SAVER14
         L     R3,TIMECMD
         SL    R3,52(R6)
         LA    R15,976             SRM FACTOR NUMBER
         M     R14,56(R6)
         DR    R14,R3
         LR    R3,R15
         CVD   R3,DOUBLE                              DOR
         MVC   CHAR,=XL8'4020202020202120'            DOR
         ED    CHAR,DOUBLE+4                          DOR
         MVC   SERV(5),CHAR+3 DOR SERVICE RATE
         LH    R3,82(0,R6)         SWAP IN SIZE         MVS/SE     WJB
         CVD   R3,DOUBLE
         UNPK  SWAPIN(3),DOUBLE+6(2)
         OI    SWAPIN+2,X'F0'
         LH    R3,80(0,R6)         SWAP OUT SIZE        MVS/SE     WJB
         CVD   R3,DOUBLE
         UNPK  SWAPOUT(3),DOUBLE+6(2)
         OI    SWAPOUT+2,X'F0'
         CLI   41(R6),X'00'        JOB ON IN QUEUE      MVS/SE     WJB
         BE    OUCBFRM0            YES, NO SWAP REASON
         ST    R8,SAVER8
         SR    R8,R8
         IC    R8,41(R6)
         LTR   R8,R8          EQUAL TO ZERO?
         BZ    COMN6          GO TO COMN6 AND FIND SWAP COUNT
         SLL   R8,2           MULT. BY 4 FOR TABLE OFFSET
         LA    R7,COMNTBLE    TABLE OF SWAP REASON CODES
         AR    R7,R8          ADD OFFSET
         MVC   SRCX(4),0(R7) MOVE SWAP REASON CODE TO LINE
         B     COMN6          SKIP COMNTBLE
*                 0   1   2   3   4   5   6  7   8   9  10
*                12341234123412341234123412341234123412341234
COMNTBLE DC    C'    OTW/ITW/ LW/ASS/RSS/ DT/ RS/ EE/ERV/  U/'
         SPACE 3
         DS    0F
COMN6    EQU   *
         L     R8,SAVER8
OUCBFRM0 LH    R3,42(0,R6)         SWAP COUNT          MVS/SE      WJB
         CVD   R3,DOUBLE
         UNPK  SWP(4),DOUBLE+5(3)
         OI    SWP+3,X'F0'
*        LA    R3,16(0,R6)         OUCB FLAGS BEGIN
*        LA    R14,QFL             OUTPUT FLAGS BEGIN
*        LA    R7,6                NUMBER OF FLAG BYTES
*        SPACE
*OUCBFRM1 UNPK  0(3,R14),0(2,R3)    UNPACK A FLAG BYTE
*         NC    0(2,R14),=4X'0F'
*         TR    0(2,R14),=C'0123456789ABCDEF'
*         MVI   2(R14),C' '            AND TRANSLATE IT
*         LA    R3,1(0,R3)          NEXT FLAG BYTE
*         LA    R14,5(0,R14)        NEXT OUTPUT AREA
*         BCT   R7,OUCBFRM1         GET NEXT
          SR   R3,R3
OUCBENQ  ICM   R3,1,22(R6)   OUCBENQ
         CVD   R3,DOUBLE
         UNPK  ENQCNT(3),DOUBLE+6(2)
         OI    ENQCNT+2,X'F0'
         EJECT
OUCBFRM2 UNPK  ASCB(7),45(4,R6)    ASCB ADDR         MVS/SE        WJB
         NC    ASCB(6),=8X'0F'
         TR    ASCB(6),=C'0123456789ABCDEF'
         MVI   ASCB+6,C' '
         SR    R7,R7                                  DOR
         IC    R7,40(R6)        DOMAIN NUMBER      DOR EBB1102
         CVD   R7,DOUBLE                              DOR
         MVC   CHAR,=XL8'4020202020202120'            DOR
         ED    CHAR,DOUBLE+4                          DOR
         MVC   DOMAIN(2),CHAR+6 DOR IN DECIMAL (NOT HEX)
* DOR    UNPK  DOMAIN(3),40(2,R6)  DOMAIN NUMBER     MVS/SE        WJB
* DOR    NC    DOMAIN(2),=8X'0F'
* DOR    TR    DOMAIN(2),=C'0123456789ABCDEF'
         MVI   DOMAIN+2,C' '
         SR    R7,R7                                  DOR
         ICM   R7,3,184(R6)        NEW PERFORM NUMBER DOR EBB1102
         CVD   R7,DOUBLE                              DOR
         MVC   CHAR,=XL8'4020202020202120'            DOR
         ED    CHAR,DOUBLE+4                          DOR
         MVC   NPG(2),CHAR+6
* DOR    UNPK  NPG(3),24(2,R6)     NEW PERFORM NUMBER
* DOR    NC    NPG(2),=8X'0F'
* DOR    TR    NPG(2),=C'0123456789ABCDEF'
         MVI   NPG+2,C'/'
* DOR    UNPK  RPG(2),25(2,R6)     RESET PERFORM NUMBER
* DOR    NC    RPG(2),=8X'0F'
* DOR    TR    RPG(2),=C'0123456789ABCDEF'
         SR    R7,R7                                  DOR
         ICM   R7,3,180(R6)        RESET PERFORM NUMBER DOR EBB1102
         CVD   R7,DOUBLE                              DOR
         MVC   CHAR,=XL8'4020202020202120'            DOR
         ED    CHAR,DOUBLE+4                          DOR
         MVC   RPG(2),CHAR+6
         MVI   RPG+2,C'/'
* DOR    UNPK  SPG(3),28(2,R6)     SPECIFIED PERFORM NUMBER
* DOR    NC    SPG(2),=8X'0F'
* DOR    TR    SPG(2),=C'0123456789ABCDEF'
         SR    R7,R7                                  DOR
         ICM   R7,3,182(R6)        SPECIFIED PERFORM NUMBER DOR EBB1102
         CVD   R7,DOUBLE                              DOR
         MVC   CHAR,=XL8'4020202020202120'            DOR
         ED    CHAR,DOUBLE+4                          DOR
         MVC   SPG(2),CHAR+6
         MVI   SPG+2,C' '
         UNPK  NDP(3),26(2,R6)     NEW DPRTY
         NC    NDP(2),=8X'0F'
         TR    NDP(2),=C'0123456789ABCDEF'
         MVI   NDP+2,C'/'
         UNPK  RDP(3),27(2,R6)     REAL DPRTY
         NC    RDP(2),=8X'0F'
         TR    RDP(2),=C'0123456789ABCDEF'
*        MVI   RDP+2,C' '
         L     R14,SAVER14
         BR    R14
         EJECT
DISPLAY  MVI   SCANRET,C'P'
         ST    R14,SAVER14
         ST    R8,SAVER8
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVC   QDMSG(80),QBLANK
         L     R14,SAVER14
         L     R8,SAVER8
         BR    R14
         SPACE 3
ERROR    QTILT 'PARAMETER ERROR'
         SPACE 3
RETURN   CLI   SCANRET,C' '        ANY FOUND
         BE    NOTFOUND            NO, TELL OPERATOR
         QSTOP
         SPACE 3
NOTFOUND MVI   SCANRET,C'P'
         QTILT 'REQUESTED TYPE OR ASID NOT FOUND'
         EJECT
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
NFNDMSG  DC    CL50'REQUESTED TYPE OR ASID NOT FOUND'
         EJECT
         DS    0F
JOBLINE0 DS    0CL80
         DC    C'         SERV         <- SWAP STATUS-> PERF GRP '
*                12345678 1234 12 123 123/123 123 1234 12/12/12
*                123456789012345678901234567890123456789012345678
*                         1         2         3         4
         DC    C'DPRTY OUTS   DP  AUX SLOTS         '
*                12/12  123   12  1234/12345
*                90123456789012345678901234567890
*                 5         6         7         8
JOBLINE1 DS    0CL80
         DC    C'JOBNAME  RATE DMN DP  WHY  IN OUT  CNT NW/RS/SP '
*                12345678 1234 12 123  123/123 123 1234 12/12/12
*                123456789012345678901234567890123456789012345678
*                         1         2         3         4
         DC    C'NW/RL  ENQ QUE#  NVAM/VAM     '
*                12/12  123   12  1234/12345
*                90123456789012345678901234567890
*                 5         6         7         8
         SPACE 3
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
         PRINT NOGEN
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
SAVER14  DS    F
SAVER8   DS    F
TIMECMD  DS    F
PARM     DS    3F
SCANTYPE DS    H
JOBLEN   DS    H
CHAR     DS    CL8
LISTIND  DS    C
DOMAINTS DS    C
SCANRET  DS    C
         EJECT
         DS    0F
JOBMSG1  EQU   QDMSG,80
JOBNAME  EQU   QDMSG,9
ASID     EQU   QDMSG+9,5
SERV     EQU   QDMSG+8,5
DOMAIN   EQU   QDMSG+14,3
DPRTY    EQU   QDMSG+17,4
SRCX     EQU   QDMSG+22,4
SWAPIN   EQU   QDMSG+26,4
SWAPOUT  EQU   QDMSG+30,4
SWP      EQU   QDMSG+34,4
NPG      EQU   QDMSG+39,3
RPG      EQU   QDMSG+42,3
SPG      EQU   QDMSG+45,3
NDP      EQU   QDMSG+48,3
RDP      EQU   QDMSG+51,4
ENQCNT   EQU   QDMSG+55,4
SRC      EQU   QDMSG+61,3
NVAMSLOT EQU   QDMSG+65,5
VAMSLOT  EQU   QDMSG+70,6
         SPACE 3
         DS    0F
JOBMSG3  DS    0CL80
         DS    CL6
QFL      DS    CL5
SFL      DS    CL5
YFL      DS    CL5
AFL      DS    CL5
TFL      DS    CL5
EFL      DS    CL5
UFL      DS    CL5
         DS    CL1
ASCB     DS    CL10
*SRC      DS    CL6
OUCB     DS    CL9
*NVAMSLOT DS    CL5
*VAMSLOT  DS    CL6
ESTAELST DS    4F
WORKEND  DS    0F
         END
./       ADD   NAME=LEAVE
         MACRO
.*                                                      RON MURA, TPD
&LABEL   LEAVE &RC=0,       RETURN CODE (VALUE OR REGISTER)            X
               &LABEL2=     LABEL FOR REGISTER RESTORES
.*                 NO PARAMETERS REQUIRED
         MNOTE *,'*** LEAVE - STANDARD OS LINKAGE ***'
         GBLB  &RENTSW1              1 = REENTERANT SAVEAREA IN ENTER
         GBLC  &WKLNTH
&LABEL   CNOP  0,4
         AIF   ('&RC'(1,1) EQ '(').REGRC    CHECK FOR REGISTER NOTATION
         LA    15,&RC                LOAD RETURN CODE
         AGO   .L13
.REGRC   AIF   ('&RC(1)' EQ '15').L13    SKIP IF RC=(15) CODED
         LR    15,&RC(1)             LOAD RETURN CODE
.L13     AIF   (&RENTSW1 EQ 1).REENT
         L     13,4(13)              RESTORE REG 13 (POINT TO HSA)
.COMMON  ANOP
.*&LABEL2  L     14,12(13)             RESTORE REGISTER
.*         LM    0,12,20(13)           RESTORE REGISTERS
.*       MVI   12(13),X'FF'          SET RETURN INDICATION IN CALLER SA
.*       BR    14
&LABEL2  RETURN (14,12),T                   RESTORE REGISTER
.*       LTORG
         MEXIT
.REENT   ANOP
         LR    1,13                  LOAD REG 1 FOR FREEMAIN
         L     13,4(13)              RESTORE REG 13 (POINT TO HSA)
         MNOTE '         FREEMAIN R,LV=72+&WKLNTH,A=(1) '
         FREEMAIN R,LV=72+&WKLNTH,A=(1)
         AGO  .COMMON
         MEND
./       ADD   NAME=LIST
LIST     TITLE 'QUEUE COMMAND - PRINT A DATASET FROM SPOOL BY ID' ONL01
LIST     QSTART ,                  START LIST CSECT ASSEMBLY      ONL01
         GBLB  &QJTIP                                             ONL05
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING WORK,R13       BASE REG FOR TEMP WORK
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE DATASET ID NUMBER                           *
*                                                                     *
***********************************************************************
         LH    R2,QLNG2       LENGTH OF DATASET ID FIELD
         SH    R2,=H'1'       IS THE DATASET ID FIELD ZERO LENGTH?
         BM    TILT           YES. QUIT.
         LH    R4,QOLDDSID    GET PREVIOUS DSID VALUE             ONL04
         LA    R3,DSIDPLUS    POINT TO ADD INSTRUCTION            UF040
         CLI   QPARM2,C'+'    RELATIVE DSID NUMBER?               UF040
         BE    DSIDREL        YES, GO PROCESS IT                  UF040
         LA    R3,DSIDSUB     POINT TO SUBTRACT INSTRUCTION       UF040
         CLI   QPARM2,C'-'    RELATIVE DSID NUMBER?               UF020
         BE    DSIDREL        YES, GO PROCESS IT                  UF040
         LA    R3,DSIDABS     POINT TO NOP INSTRUCTION            UF040
         B     DSIDTEST       NO, CONTINUE                        UF040
DSIDREL  CLI   QPARM1,C'*'    WANT THE CURRENT JOB?               UF040
         BNE   TILTREL        NO, RELATIVE REQUEST INVALID        UF040
         MVI   QPARM2,C'0'    REPLACE WITH NUMERIC VALUE          UF040
         LTR   R2,R2          WAS FIELD ONLY THE +/-?             UF040
         BP    DSIDTEST       NO, CONTINUE AS BEFORE              UF040
         LA    R2,1           YES, SET VALUE OF 1                 UF040
         B     DSIDCHK        AND SKIP NUMERIC CHECKS             UF040
DSIDTEST DS    0H                                                 UF040
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         EX    R2,PACK        PACK THE FIELD
         CVB   R2,CONVERT     CONVERT TO BINARY
         SPACE 1                                                  UF005
DSIDCHK  DS    0H                                                 UF040
         EX    0,0(R3)        ADJUST VALUE IN R4 BY OFFSET        UF040
         LR    R2,R4          PUT BACK IN R2                      UF040
         LTR   R2,R2          MAKE SURE IS POSITIVE               UF040
         BNP   TILT           ERROR IF NOT                        UF040
         STH   R2,QPDSID      STORE DATASET ID
         STH   R2,QOLDDSID    SET PREVIOUS DSID TO CURRENT        ONL04
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB AND DSID                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QALIST            PERFORM JOB/DSID AUTHORIZATION ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE PRINT OFFSET                                *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' DEFAULT TO ZERO
         LH    R2,QLNG3       LENGTH OF OFFSET FIELD
         SH    R2,=H'1'       IS THE OFFSET FIELD ZERO LENGTH?
         BM    CALLLIST       YES. USE ZERO OFFSET.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ2        MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         EX    R2,PACK2       PACK THE FIELD
         CVB   R2,CONVERT     CONVERT TO BINARY
         STH   R2,QPOFFSET    STORE OFFSET
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
CALLLIST L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         NI    QFLAG1,255-QLISTCC   TURN OFF CC CMD PROCESS
         NI    QFLAG2,255-Q2SYSJOB  TURN OFF LISTDSR PROCESS
         CLI   QSUBNAME,C'C'   CC
         BNE   CALLST
         OI    QFLAG1,QLISTCC    TURN ON CC CMD PROCESS
         L     R15,=V(LISTDS2)  HAVE SPECIAL FORMAT FOR FORMS/FCB
CALLST   BALR  R14,R15        GO TO IT
         QSTOP
TILT     QTILT '*** DATASET ID INVALID ***'
TILTREL  QTILT '*** RELATIVE DATASET ID ONLY VALID IF JOBID IS "*" ***'
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
DSIDPLUS AR    R4,R2          ADD TO PRESENT VALUE                UF040
DSIDSUB  SR    R4,R2          SUBTRACT FROM PRESENT VALUE         UF040
DSIDABS  LR    R4,R2          SET TO PRESENT VALUE                UF040
MVZ      MVZ   QFZONES(1),QPARM2 CHECK FOR NUMERIC
MVZ2     MVZ   QFZONES(1),QPARM3 CHECK FOR NUMERIC
PACK     PACK  CONVERT,QPARM2(1) CONVERT TO BINARY
PACK2    PACK  CONVERT,QPARM3(1) CONVERT TO BINARY
         LTORG
         DROP  ,                   DROP ALL ADDRESSINGS           NERDC
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
LIST     CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
WORK     DSECT
         DS    72C
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=LISTCC
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
***********************************************************************
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
LISTCC   TITLE  'QUEUE COMMAND - PRINT A DATASET FROM SPOOL BY ID/CC'
LISTCC   QSTART
         GBLB  &QACF2         IS ACF2 AUTH CHECKING TO BE DONE     FCI*
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE DATASET ID NUMBER                           *
*                                                                     *
***********************************************************************
         LH    R2,QLNG2       LENGTH OF DATASET ID FIELD
         SH    R2,=H'1'       IS THE DATASET ID FIELD ZERO LENGTH?
         BM    TILT           YES. QUIT.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         ZAP   QDWORK,=P'0'   CLEAR WORK AREA
         EX    R2,PACK        PACK THE FIELD
         CVB   R2,QDWORK      CONVERT TO BINARY
         SPACE 1
ANYDSID  STH   R2,QPDSID      STORE DATASET ID
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE PRINT OFFSET                                *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' DEFAULT TO ZERO
         LH    R2,QLNG3       LENGTH OF OFFSET FIELD
         SH    R2,=H'1'       IS THE OFFSET FIELD ZERO LENGTH?
         BM    CALLLIST       YES. USE ZERO OFFSET.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ2        MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         ZAP   QDWORK,=P'0'   CLEAR WORK AREA
         EX    R2,PACK2       PACK THE FIELD
         CVB   R2,QDWORK      CONVERT TO BINARY
         STH   R2,QPOFFSET    STORE OFFSET
         SPACE
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
CALLLIST L     R15,=V(LISTDS2)  ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
         SPACE 4
TILT     QTILT '*** DATASET ID OR OFFSET INVALID ***'
         AIF   (&QACF2).ACF2
TILT2    QTILT '*** JOBNAME MUST BEGIN WITH USERID ***'
.ACF2    ANOP
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
MVZ      MVZ   QFZONES(1),QPARM2     CHECK FOR NUMERIC
MVZ2     MVZ   QFZONES(1),QPARM3     CHECK FOR NUMERIC
PACK     PACK  QDWORK,QPARM2(1)      CONVERT TO BINARY
PACK2    PACK  QDWORK,QPARM3(1)      CONVERT TO BINARY
         LTORG
*BUFSTART EQU   0
*BUFDSECT EQU   0
*        $JCT
         PRINT NOGEN
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKEND  EQU   *
         END
./       ADD   NAME=LISTDS
LISTDS   TITLE 'QUEUE COMMAND - LIST A DATASET FROM SPOOL'        ONL01
LISTDS   QSTART HASPEQU=YES,       START LISTDS CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - LIST A DATASET FROM SPOOL'
         GBLB  &QSP133                                            UF046
         GBLB  &QSP136        SP 1.3.6 OPTION FLAG                DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   SEE IF DATA SET ID IS VALID                                   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         CLC   QPDSID,=H'0'        IS THE DATA SET ID VALID?      ONL02
         BNE   DSIDOK              SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
         QTILT '*** QUEUE LOGIC ERROR - DSID=0 IN LISTDS ***'     ONL02
         SPACE 1                                                  ONL02
DSIDOK   DS    0H                  DSID EXISTS                    ONL02
         NI    QFLAG2,255-Q2SYSJOB   TURN OFF LISTDSR PROCESS     DOR
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   DETERMINE FUNCTION REQUESTED                                      *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         CLI   QCODE,0        IS THE REQUEST FOR REPOSITIONING?
         BNE   REPOS          YES. DO IT.
         SPACE 2                                                  ONL04
***********************************************************************
*                                                                     *
*   LOCATE PDDB FOR DATASET SPECIFIED IN QPDSID                       *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL04
         NI    QFLAG2,255-QFLG2SPN-QFLG2PDB  CLEAR SEARCH FLAGS   ONL04
         AIF   (NOT &QSP136).NO136A                               DOR
         USING PDB,R2         BASE REG FOR PDDB                   DOR
         USING IOT,R3         BASE REG FOR IOT                    DOR
         L     R5,QCIOTA      IOAREA FOR READ IOT BLOCK           UF046
         LR    R3,R5          POINT TO IOTSTART                   UF046
         SH    R3,=AL2(IOTSTART-IOT)      ADJUST FOR HEADER       DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         USING PDBDSECT,R2    BASE REG FOR PDDB
         USING IOTDSECT,R3    BASE REG FOR IOT                    UF046
         L     R5,QCIOTA      IOAREA FOR READ IOT BLOCK           UF046
         LR    R3,R5          POINT TO IOTSTART                   UF046
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
.X136A   ANOP                                                     DOR
         SPACE 1                                                  ONL04
NEXTIOT  LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB          OFFSET TO FIRST PDDB IN IOT    UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
         SPACE 1                                                  ONL04
FINDDS   DS    0H             SEARCH IOT FOR DSID                 ONL04
         CLC   QPDSID,PDBDSKEY  DOES THE DSID MATCH ?             ONL04
         BNE   SKIPPDDB       SKIP IF NO                          ONL04
         OI    QFLAG2,QFLG2PDB  SHOW PDDB FOR DSID EXISTS         ONL04
         CLC   PDBMTTR,=F'0'  DOES PDDB HAVE OUTPUT ?             ONL04
         BNE   FOUNDDS        SKIP IF YES, WE'VE FOUND OUR OUTPUT ONL04
SKIPPDDB DS    0H                                                 ONL04
         SPACE 1                                                  ONL04
         LA    R2,PDBLENG(R2) ADDR OF NEXT PDDB IN IOT            ONL04
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4          IS THERE ANOTHER IOT?
         BZ    SPINIOT        NO. TRY THE SPIN IOT?
         BAL   R8,READ        READ THE IOT
         B     NEXTIOT        SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136B                               DOR
         USING JCT,R1        BASE REG FOR JCT                     DOR
         AGO   .X136B                                             DOR
.NO136B  ANOP                                                     DOR
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
.X136B   ANOP                                                     DOR
         SPACE 1                                                  ONL04
SPINIOT  TM    QFLAG2,QFLG2SPN  HAVE THE SPIN IOT'S BEEN SEARCHED?ONL04
         BO    NODATA         SKIP IF YES                         ONL04
         OI    QFLAG2,QFLG2SPN  SHOW SPIN IOT'S NOW BEING SEARCHEDONL04
         L     R1,QCJCTA      LOAD BASE REG
         L     R4,JCTSPIOT    DISK ADDR OF SPIN IOT
         DROP  R1
         B     SPIN           SEARCH THE SPIN IOT CHAIN
         SPACE 1                                                  ONL04
NODATA   DS    0H             ALL PDDB'S HAVE BEEN SEARCHED       ONL04
         XC    QPDSID,QPDSID  INVALIDATE DSID                     ONL04
         TM    QFLAG2,QFLG2PDB  WAS DATASET FOUND BUT EMPTY?      ONL04
         BZ    DSNOTFND       SKIP IF NO                          ONL04
         QTILT '*** DATASET ID IS EMPTY ***'                      ONL04
DSNOTFND QTILT '*** DATASET ID NOT FOUND ***'                     ONL04
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
TILT2    QTILT '*** DATASET TABLE LIMITS EXCEEDED ***'
         SPACE 1                                                  ONL04
FOUNDDS  DS    0H             PDDB W/DATA FOUND FOR DSID          ONL04
         MVC   QOLDDSID,QPDSID  SET PREVIOUS DSID TO CURRENT      ONL04
*        MVC   QCJNAME,QPARM1 SAVE THE JOBNAME                    UF007
*        CLI   QPARM1,C'*'    USE LAST JOB NAME?                  UF007
*        BE   JNAMEOK         NO,  SKIP OVERLAY OF JOBNAME        UF007
         L     R1,QCJCTA      BASE ADDRESS OF JCT                 UF040
         AIF   (NOT &QSP136).NO136C                               DOR
         USING JCT,R1        BASE REG FOR JCT                     DOR
         AGO   .X136C                                             DOR
.NO136C  ANOP                                                     DOR
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
.X136C   ANOP                                                     DOR
         MVC   QCJNAME,JCTJNAME SET JOB NAME                      UF040
         DROP  R1             DROP TEMP ADDRESSING                UF040
JNAMEOK  DS    0H                                                 UF040
*        MVC   QCDSNO,QPARM2  SAVE THE DATASET ID NUMBER          UF040
         LH    R0,QPDSID      GET DATASET ID                      UF040
         CVD   R0,DWORD       TO DECIMAL                          UF040
         MVC   QCDSNO,EDIT    SET EDIT PATTERN                    UF040
         ED    QCDSNO,DWORD+4 TO PRINTABLE                        UF040
         MVC   QDHLINE,QCHLINE MOVE IN HEADING LINE
         MVC   QCRECFM,PDBRECFM RECORD FORMAT FOR SAVE
         MVC   QCLRECL,PDBLRECL RECORD LENGTH FOR SAVE
         L     R4,PDBMTTR     DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         L     R2,QCSTART     BEGINNING OF DISK ADDR TABLE
         ZAP   QCCREC,=P'0'   ZERO CURRENT RECORD NO
         MVC   QCCPTR,QCSTART BEGIN OF TBL
         ZAP   QCHREC,=P'0'   ZERO HIGH REC NO
         MVC   QCHPTR,QCSTART BEGIN OF TBL
         ZAP   QPREC,=P'1'    REPOSITION TO TOP OF DATASET
         B     FIRST          PROCESS DATASET
         DROP  R2
         DROP  R3
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         ST    R4,0(R2)       STORE DISK ADDR IN TABLE
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID,4(R5)  DOES THE JOBID MATCH?               UF046
         BNE   END            NO. END OF DATASET.
         AIF   (NOT &QSP133).C29C                                 UF046
         L     R15,QCJQEA     ADDRESS OF JQE                      UF046
         AIF   (NOT &QSP136).NO136D                               DOR
         USING JQE,R15   TEMP ADDRESSING                          DOR
         TM    JQEFLAG3,JQE3SYSD  SYSTEM DATASETS HAVE DSID=0     DOR
         AGO   .X136D                                             DOR
.NO136D  ANOP                                                     DOR
         USING JQEDSECT,R15   TEMP ADDRESSING                     UF046
         TM    JQEFLAG3,QUESYSDS  SYSTEM DATASETS HAVE DSID=0     UF046
.X136D   ANOP                                                     DOR
         DROP  R15                                                UF046
         BO    QDSIDOK        LET IT GO                           UF046
.C29C    ANOP  ,                                                  UF046
         CLC   QPDSID,8(R5)   DATASET ID MATCH?                   UF046
         BNE   END            NO. END OF DATASET                  UF046
QDSIDOK  DS    0H                                                 UF046
         MVC   4(4,R2),QCCREC STORE CURRENT REC NUM IN TABLE
         ST    R2,QCCPTR      STORE CURRENT TABLE ADDR
         CP    QCCREC,QCHREC  IS THE CURRENT REC NO > HIGHEST?
         BNH   NOTHI          NO. SKIP.
         MVC   QCHREC(8),QCCREC REPLACE HI REC CNT AND PTR
NOTHI    LA    R2,8(R2)       INCREMENT TO NEXT TBL ENTRY
         C     R2,QCEND       IS THIS THE END OF TABLE?
         BNL   TILT2          YES. TILT.
         LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         LR    R7,R6          SAVE RECORD LENGTH
         LR    R1,R4          SAVE RECORD LOCATION
         TM    1(R4),X'80'    IS CARRIAGE CONTROL SPECIFIED?
         BZ    NOCCTL         NO. CONTINUE.
         LA    R1,1(R1)       SKIP OVER CARRIAGE CONTROL
NOCCTL   TM    1(R4),X'08'    IS THIS RECORD TO BE IGNORED?
         LR    R4,R1          UPDATE RECORD POINTER
         BNZ   SKIPREC        YES. SKIP IT.
         AP    QCCREC,=P'1'   ADD ONE TO CUR REC NO
         CP    QCCREC,QPREC   HAVE WE REACHED THE RECORD WE WANT?
         BL    SKIPREC        NO. TRY NEXT RECORD.
         CLI   QCODE,4        IS THE REQUEST FOR A FIND?
         BE    FIND           YES. DO IT.
         CLI   QCODE,8        IS THE REQUEST FOR A FINDTIME?
         BE    FINDTIME       YES. DO IT.
FINDOFF  AH    R1,QPOFFSET    ADD OFFSET TO START OF RECORD
         SH    R7,QPOFFSET    SUBTRACT OFFSET FROM LENGTH
         BNP   ZEROPRT        NO DATA LEFT IN RECORD.
         CH    R7,QDLNELEN    IS THE RECORD BIGGER THAN LINE?     UF003
         BNH   LTMAX          NO. USE RECORD LENGTH.              UF003
         LH    R7,QDLNELEN    YES. USE A LENGTH OF LINE.          UF003
LTMAX    STH   R7,QDMLNG      STORE MESSAGE LENGTH                UF003
         LA    R1,3(R1)       OFFSET PAST REC HDR
         ST    R1,QDMSGA      STORE ADDR OF MESSAGE LINE
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         TM    QDOVER,1       WAS THERE A PAGE OVERFLOW?
         BNO   SKIPREC        NO. SKIP.
         ZAP   QPREC,QCCREC   UPDATE THE REPOSITION NUMBER
         MVC   HREC,EDIT      PATTERN FOR EDIT
         ED    HREC,QCCREC    EDIT RECORD NUMBER
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       LENGTH OF SEGMENT
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)    UPDATE RECORD POSITION
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    UPDATE RECORD POSITION
         B     NEXTREC        PROCESS NEXT RECORD
ZEROPRT  LA    R1,QBLANK      PRINT A BLANK
         LA    R7,1           LENGTH OF ONE
         B     LTMAX          PRINT THE RECORD                    UF003
END      CP    QCCREC,=P'0'   IS THE DATASET EMPTY
         BE    STOP           YES. QUIT.
         MVC   HEND,ENDLINE   TELL THEM THIS IS THE END
         MVC   HREND,EDIT     PATTERN FOR EDIT
         ED    HREND,QCCREC   LAST REC NO
         CLI   QCODE,32       WAS REQUEST FOR BOTTOM?
         BE    BOTTOM         YES. BACK UP 21 LINES.
         MVC   QDMLNG,=H'0'   ZERO OUT MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        FLUSH THE SCREEN
         ZAP   QPREC,=P'1'    RECORD NUMBER 1
         MVC   QDHLINE,QCHLINE BLANK THE TITLE LINE
         B     TOP            START AT TOP OF DATASET
STOP     XC    QPDSID,QPDSID  MAKE USER SPECIFY A NEW DATA SET
         MVC   QDHLINE,=CL80'*** DATA SET IS EMPTY ***'
         QSTOP
***********************************************************************
*                                                                     *
*   BOTTOM OF DATASET                                                 *
*                                                                     *
***********************************************************************
BOTTOM   ZAP   QPREC,QCCREC   LAST RECORD NUMBER
         MVI   QCODE,0        AVOID A LOOP
         SP    QPREC,QDLNES   TOP OF PAGE -1                      UF003
         AP    QPREC,=P'1'    TOP OF PAGE                         UF003
         BP    REPOS          CONTINUE IF POSITIVE.
         ZAP   QPREC,=P'1'    TOP OF DATASET
***********************************************************************
*                                                                     *
*   REPOSITION TO REQUESTED RECORD NUMBER                             *
*                                                                     *
***********************************************************************
REPOS    MVC   QDHLINE,QCHLINE MOVE IN HEADING LINE
         MVC   HREC,EDIT      PREPARE FOR EDIT
         ED    HREC,QPREC     EDIT RECORD NUMBER
         CP    QPREC,QCHREC   IS THE REQ NO > HIGHEST READ?
         BNL   HI             YES. GO FROM HI.
         CP    QPREC,QCCREC   IS THE REQ NO > CURRENT REC?
         BH    UP             YES. GO FROM CURRENT.
         CP    QPREC,=P'1'    IS REQ FOR TOP OF DATASET?
         BH    DOWN           NO. GO DOWN FROM CURRENT.
TOP      L     R2,QCSTART     START AT TOP
RESUME   L     R4,0(R2)       LOAD DISK ADDR
         L     R5,QCBLKA      ADDR OF BLOCK IOAREA
         MVC   QCCREC,4(R2)   RESET CURRENT REC NO
         B     FIRST          RESUME PROCESSING
HI       L     R2,QCHPTR      START AT HIGHEST SO FAR
         B     DOWNLOOP       FIND CORRECT BLOCK
UP       L     R2,QCCPTR      CURRENT TABLE PTR
UPLOOP   CP    QPREC,12(4,R2) IS THE NEXT ENTRY > REQ NO?
         BNH   RESUME         YES. PROCESS IT.
         LA    R2,8(R2)       TRY NEXT ENTRY
         B     UPLOOP         AGAIN
DOWN     L     R2,QCCPTR      CURRENT TABLE PTR
DOWNLOOP CLI   QSUBNAME,C'M'  IS THIS THE MODEL COMMAND?          UF045
         BNE   OKCMD                                              UF045
         CLC   QPARM1,=CL8' ' WAS THERE A PARM?                   UF045
         BNE   OKCMD          YES, SKIP                           UF045
         QTILT 'MODEL OPERAND REQUIRED'                           UF045
         SPACE 1                                                  UF045
OKCMD    CP    QPREC,4(4,R2)  IS THE ENTRY < REQ NO?              UF045
         BH    RESUME         YES. PROCESS IT.
         SH    R2,=H'8'       TRY PREVIOUS ENTRY
         B     DOWNLOOP       AGAIN
***********************************************************************
*                                                                     *
*   FIND MATCHING RECORD ROUTINE                                      *
*                                                                     *
***********************************************************************
FIND     LH    R3,QPLNG       LENGTH-1 OF COMPARE
         LR    R14,R6         LENGTH OF RECORD
         SR    R14,R3         NUMBER OF COMPARES
         BNP   SKIPREC        RECORD IS TOO SMALL. SKIP IT.
         LR    R15,R4         FIRST BYTE OF RECORD
         CLC   QOFFE,=H'0'    END RANGE FOR FIND SPECIFIED ?
         BE    FLOOP          NO. BYPASS RANGE FOR FIND
         AH    R15,QOFFS      YES. START ADDR FOR FIND
         LH    R14,QOFFE      END ADDR FOR FIND
         SH    R14,QOFFS      VALID RANGE ?
         BP    FLOOP          YES. CONTINUE PROCESSING
         QTILT ' *** ERROR IN COLUMN SPECIFICATION ***'
FLOOP    EX    R3,CLC         DOES THE FIND DATA MATCH THE RECORD?
         BE    MATCH          YES. DISCONTINUE SEARCH.
         LA    R15,1(R15)     INCREMENT TO NEXT BYTE
         BCT   R14,FLOOP      TRY NEXT BYTE
         B     SKIPREC        SKIP THE RECORD. NO MATCH.
MATCH    CLI   QSUBNAME+1,C'A' IS THE REQUEST FOR A FINDALL?
         BE    FALL           YES. DO NOT DISABLE SEARCH.
         MVI   QCODE,0        END THE SEARCH
         ZAP   QPREC,QCCREC   UPDATE THE REPOSITION NUMBER
FALL     MVC   HREC,EDIT      PREPARE FOR EDIT
         ED    HREC,QCCREC    EDIT RECORD NUMBER
         B     FINDOFF        CONTINUE
CLC      CLC   QPFIND(1),3(R15) COMPARE PARM TO RECORD
***********************************************************************
*                                                                     *
*   FIND THE RECORD WHICH IS GREATER THAN OR EQUAL TO TIME            *
*                                                                     *
***********************************************************************
FINDTIME CLI   10(R4),C'.'    DOES THIS RECORD HAVE TIME?
         BE    FINDTSP1       YES, THIS IS SP 1 SYSLOG            CL003
         CLI   27(R4),C':'         DOES RECORD HAVE TIME?         CL003
         BNE   SKIPREC             NO, NOT SP 2 SYSLOG            CL003
         CLC   QPARM1,25(R4)       IS THIS THE TIME WE WANT?      CL003
         BH    SKIPREC             NO. SKIT IT.                   CL003
         B     MATCH               END THE SEARCH                 CL003
         SPACE 1                                                  CL003
FINDTSP1 CLC   QPARM1,8(R4)   IS THIS THE TIME WE WANT?           CL003
         BH    SKIPREC        NO. SKIP IT.
         B     MATCH          END THE SEARCH
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
ENDLINE  DC    C', END OF DATA. LAST REC #'
EDIT     DC    X'4020202020202021'
         DC    CL45' '
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
LISTDS   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136E                               DOR
         IFGRPL  DSECT=YES,AM=VTAM                                DOR
         AGO   .X136E                                             DOR
.NO136E  ANOP                                                     DOR
JCT      EQU   0
.X136E   ANOP                                                     DOR
         $BUFFER ,                                                UF046
         $TAB
         $JQE  ,                                                  UF046
         $JCT
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDHLINE
         DS    C'JOB XXXXXXXX, DSID XXXXXXXX, REC #'
HREC     DS    CL8
HEND     DS    C', END OF DATA. LAST REC #'
HREND    DS    CL8
WORK     DSECT
         DS    CL72
DWORD    DS    D                                                  UF040
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=LISTDSR
LISTDSR  TITLE 'QUEUE COMMAND - LIST A DATASET FROM SPOOL'        ONL01
LISTDSR  QSTART HASPEQU=YES,      START LISTDSR CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - LIST A DATASET FROM SPOOL'
         GBLB  &QSP133                                            UF046
         GBLB  &QSP136        SP 1.3.6 OPTION FLAG                DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT  ORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   SEE IF DATA SET ID IS VALID                                   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         CLC   QPDSID,=H'0'        IS THE DATA SET ID VALID?      ONL02
         BNE   DSIDOK              SKIP IF YES                    ONL02
         SPACE 1                                                  ONL02
         QTILT '*** QUEUE LOGIC ERROR - DSID=0 IN LISTDSR***'     ONL02
         SPACE 1                                                  ONL02
DSIDOK   DS    0H                  DSID EXISTS                    ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   DETERMINE FUNCTION REQUESTED                                      *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         CLI   QCODE,0        IS THE REQUEST FOR REPOSITIONING?
         BNE   REPOS          YES. DO IT.
         SPACE 2                                                  ONL04
***********************************************************************
*                                                                     *
*   LOCATE PDDB FOR DATASET SPECIFIED IN QPDSID                       *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL04
         NI    QFLAG2,255-QFLG2SPN-QFLG2PDB  CLEAR SEARCH FLAGS   ONL04
         AIF   (NOT &QSP136).NO136A                               DOR
         USING PDB,R2         BASE REG FOR PDDB                   DOR
         USING IOT,R3         BASE REG FOR IOT                    DOR
         L     R5,QCIOTA      IOAREA FOR READ IOT BLOCK           UF046
         LR    R3,R5          POINT TO IOTSTART                   UF046
         SH    R3,=AL2(IOTSTART-IOT)      ADJUST FOR HEADER       DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         USING PDBDSECT,R2    BASE REG FOR PDDB
         USING IOTDSECT,R3    BASE REG FOR IOT                    UF046
         L     R5,QCIOTA      IOAREA FOR READ IOT BLOCK           UF046
         LR    R3,R5          POINT TO IOTSTART                   UF046
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
.X136A   ANOP                                                     DOR
         SPACE 1                                                  ONL04
NEXTIOT  LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB          OFFSET TO FIRST PDDB IN IOT    UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
.C29B    ANOP  ,                                                  UF046
         SPACE 1                                                  ONL04
FINDDS   DS    0H             SEARCH IOT FOR DSID                 ONL04
         CLC   QPDSID,PDBDSKEY  DOES THE DSID MATCH ?             ONL04
         BNE   SKIPPDDB       SKIP IF NO                          ONL04
         OI    QFLAG2,QFLG2PDB  SHOW PDDB FOR DSID EXISTS         ONL04
         CLC   PDBMTTR,=F'0'  DOES PDDB HAVE OUTPUT ?             ONL04
         BNE   FOUNDDS        SKIP IF YES, WE'VE FOUND OUR OUTPUT ONL04
SKIPPDDB DS    0H                                                 ONL04
         SPACE 1                                                  ONL04
         LA    R2,PDBLENG(R2) ADDR OF NEXT PDDB IN IOT            ONL04
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4          IS THERE ANOTHER IOT?
         BZ    SPINIOT        NO. TRY THE SPIN IOT?
         BAL   R8,READ        READ THE IOT
         B     NEXTIOT        SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136B                               DOR
         USING JCT,R1        BASE REG FOR JCT                     DOR
         AGO   .X136B                                             DOR
.NO136B  ANOP                                                     DOR
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
.X136B   ANOP                                                     DOR
         SPACE 1                                                  ONL04
SPINIOT  TM    QFLAG2,QFLG2SPN  HAVE THE SPIN IOT'S BEEN SEARCHED?ONL04
         BO    NODATA         SKIP IF YES                         ONL04
         OI    QFLAG2,QFLG2SPN  SHOW SPIN IOT'S NOW BEING SEARCHEDONL04
         L     R1,QCJCTA      LOAD BASE REG
         L     R4,JCTSPIOT    DISK ADDR OF SPIN IOT
         DROP  R1
         B     SPIN           SEARCH THE SPIN IOT CHAIN
         SPACE 1                                                  ONL04
NODATA   DS    0H             ALL PDDB'S HAVE BEEN SEARCHED       ONL04
         XC    QPDSID,QPDSID  INVALIDATE DSID                     ONL04
         TM    QFLAG2,QFLG2PDB  WAS DATASET FOUND BUT EMPTY?      ONL04
         BZ    DSNOTFND       SKIP IF NO                          ONL04
         QTILT '*** DATASET ID IS EMPTY ***'                      ONL04
DSNOTFND QTILT '*** DATASET ID NOT FOUND ***'                     ONL04
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
TILT2    QTILT '*** DATASET TABLE LIMITS EXCEEDED ***'
         SPACE 1                                                  ONL04
FOUNDDS  DS    0H             PDDB W/DATA FOUND FOR DSID          ONL04
         MVC   QOLDDSID,QPDSID  SET PREVIOUS DSID TO CURRENT      ONL04
*        MVC   QCJNAME,QPARM1 SAVE THE JOBNAME                    UF007
*        CLI   QPARM1,C'*'    USE LAST JOB NAME?                  UF007
*        BE   JNAMEOK         NO,  SKIP OVERLAY OF JOBNAME        UF007
         L     R1,QCJCTA      BASE ADDRESS OF JCT                 UF040
         AIF   (NOT &QSP136).NO136C                               DOR
         USING JCT,R1        BASE REG FOR JCT                     DOR
         AGO   .X136C                                             DOR
.NO136C  ANOP                                                     DOR
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
.X136C   ANOP                                                     DOR
         MVC   QCJNAME+1(8),JCTJNAME SET JOB NAME   DOR
         DROP  R1             DROP TEMP ADDRESSING                UF040
JNAMEOK  DS    0H                                                 UF040
*        MVC   QCDSNO,QPARM2  SAVE THE DATASET ID NUMBER          UF040
         LH    R0,QPDSID      GET DATASET ID                      UF040
         CVD   R0,DWORD       TO DECIMAL                          UF040
         MVC   QCDSNO,EDIT    SET EDIT PATTERN                    UF040
         ED    QCDSNO,DWORD+4 TO PRINTABLE                        UF040
         MVC   QDHLINE,QCHLINE MOVE IN HEADING LINE
         MVC   QDHLINE(4),=CL4'*JOB'   SHOW LISTDS VERSION
         MVC   QCRECFM,PDBRECFM RECORD FORMAT FOR SAVE
         MVC   QCLRECL,PDBLRECL RECORD LENGTH FOR SAVE
         L     R4,PDBMTTR     DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         L     R2,QCSTART     BEGINNING OF DISK ADDR TABLE
         ZAP   QCCREC,=P'0'   ZERO CURRENT RECORD NO
         MVC   QCCPTR,QCSTART BEGIN OF TBL
         ZAP   QCHREC,=P'0'   ZERO HIGH REC NO
         MVC   QCHPTR,QCSTART BEGIN OF TBL
         ZAP   QPREC,=P'1'    REPOSITION TO TOP OF DATASET
         B     FIRST          PROCESS DATASET
         DROP  R2
         DROP  R3
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         ST    R4,0(R2)       STORE DISK ADDR IN TABLE
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID,4(R5)  DOES THE JOBID MATCH?               UF046
         BNE   END            NO. END OF DATASET.
         AIF   (NOT &QSP133).C29C                                 UF046
         L     R15,QCJQEA     ADDRESS OF JQE                      UF046
         AIF   (NOT &QSP136).NO136D                               DOR
         USING JQE,R15   TEMP ADDRESSING                          DOR
         TM    JQEFLAG3,JQE3SYSD  SYSTEM DATASETS HAVE DSID=0     DOR
         AGO   .X136D                                             DOR
.NO136D  ANOP                                                     DOR
         USING JQEDSECT,R15   TEMP ADDRESSING                     UF046
         TM    JQEFLAG3,QUESYSDS  SYSTEM DATASETS HAVE DSID=0     UF046
.X136D   ANOP                                                     DOR
         DROP  R15                                                UF046
         BO    QDSIDOK        LET IT GO                           UF046
.C29C    ANOP  ,                                                  UF046
         CLC   QPDSID,8(R5)   DATASET ID MATCH?                   UF046
         BNE   END            NO. END OF DATASET                  UF046
QDSIDOK  DS    0H                                                 UF046
         MVC   4(4,R2),QCCREC STORE CURRENT REC NUM IN TABLE
         ST    R2,QCCPTR      STORE CURRENT TABLE ADDR
         CP    QCCREC,QCHREC  IS THE CURRENT REC NO > HIGHEST?
         BNH   NOTHI          NO. SKIP.
         MVC   QCHREC(8),QCCREC REPLACE HI REC CNT AND PTR
NOTHI    LA    R2,8(R2)       INCREMENT TO NEXT TBL ENTRY
         C     R2,QCEND       IS THIS THE END OF TABLE?
         BNL   TILT2          YES. TILT.
         LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         LR    R7,R6          SAVE RECORD LENGTH
         LR    R1,R4          SAVE RECORD LOCATION
         TM    1(R4),X'80'    IS CARRIAGE CONTROL SPECIFIED?
         BZ    NOCCTL         NO. CONTINUE.
         LA    R1,1(R1)       SKIP OVER CARRIAGE CONTROL
NOCCTL   TM    1(R4),X'08'    IS THIS RECORD TO BE IGNORED?
         LR    R4,R1          UPDATE RECORD POINTER
         BNZ   SKIPREC        YES. SKIP IT.
         AP    QCCREC,=P'1'   ADD ONE TO CUR REC NO
         CP    QCCREC,QPREC   HAVE WE REACHED THE RECORD WE WANT?
         BL    SKIPREC        NO. TRY NEXT RECORD.
         CLI   QCODE,4        IS THE REQUEST FOR A FIND?
         BE    FIND           YES. DO IT.
         CLI   QCODE,8        IS THE REQUEST FOR A FINDTIME?
         BE    FINDTIME       YES. DO IT.
FINDOFF  AH    R1,QPOFFSET    ADD OFFSET TO START OF RECORD
         SH    R7,QPOFFSET    SUBTRACT OFFSET FROM LENGTH
         BNP   ZEROPRT        NO DATA LEFT IN RECORD.
         CH    R7,QDLNELEN    IS THE RECORD BIGGER THAN LINE?     UF003
         BNH   LTMAX          NO. USE RECORD LENGTH.              UF003
         LH    R7,QDLNELEN    YES. USE A LENGTH OF LINE.          UF003
LTMAX    STH   R7,QDMLNG      STORE MESSAGE LENGTH                UF003
         LA    R1,3(R1)       OFFSET PAST REC HDR
         ST    R1,QDMSGA      STORE ADDR OF MESSAGE LINE
         L     R15,=V(DISPLAY) ADDRESS OF DISPLAY MODULE
         BALR  R14,R15        GO TO IT
         TM    QDOVER,1       WAS THERE A PAGE OVERFLOW?
         BNO   SKIPREC        NO. SKIP.
         ZAP   QPREC,QCCREC   UPDATE THE REPOSITION NUMBER
         MVC   HREC,EDIT      PATTERN FOR EDIT
         ED    HREC,QCCREC    EDIT RECORD NUMBER
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       LENGTH OF SEGMENT
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)    UPDATE RECORD POSITION
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    UPDATE RECORD POSITION
         B     NEXTREC        PROCESS NEXT RECORD
ZEROPRT  LA    R1,QBLANK      PRINT A BLANK
         LA    R7,1           LENGTH OF ONE
         B     LTMAX          PRINT THE RECORD                    UF003
END      CP    QCCREC,=P'0'   IS THE DATASET EMPTY
         BE    STOP           YES. QUIT.
         MVC   HEND,ENDLINE   TELL THEM THIS IS THE END
         MVC   HREND,EDIT     PATTERN FOR EDIT
         ED    HREND,QCCREC   LAST REC NO
         CLI   QCODE,32       WAS REQUEST FOR BOTTOM?
         BE    BOTTOM         YES. BACK UP 21 LINES.
         MVC   QDMLNG,=H'0'   ZERO OUT MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        FLUSH THE SCREEN
EFLUSH   ZAP   QPREC,=P'1'    RECORD NUMBER 1
         MVC   QDHLINE,QCHLINE BLANK THE TITLE LINE
         MVC   QDHLINE(4),=CL4'*JOB'   SHOW LISTDS VERSION
         B     TOP            START AT TOP OF NEXT DATASET
STOP     MVC   QDHLINE,=CL80'*** DATA SET IS EMPTY ***'
*        XC    QPDSID,QPDSID  MAKE USER SPECIFY A NEW DATA SET
STOPR    QSTOP
***********************************************************************
*                                                                     *
*   BOTTOM OF DATASET                                                 *
*                                                                     *
***********************************************************************
BOTTOM   ZAP   QPREC,QCCREC   LAST RECORD NUMBER
         MVI   QCODE,0        AVOID A LOOP
         SP    QPREC,QDLNES   TOP OF PAGE -1                      UF003
         AP    QPREC,=P'1'    TOP OF PAGE                         UF003
         BP    REPOS          CONTINUE IF POSITIVE.
         ZAP   QPREC,=P'1'    TOP OF DATASET
*        B     TOP            DO NOT GO TO TOP GO ON NEXT DATASET DOR
***********************************************************************
*                                                                     *
*   REPOSITION TO REQUESTED RECORD NUMBER                             *
*                                                                     *
***********************************************************************
REPOS    MVC   QDHLINE,QCHLINE MOVE IN HEADING LINE
         MVC   QDHLINE(4),=CL4'*JOB'   SHOW LISTDS VERSION
         MVC   HREC,EDIT      PREPARE FOR EDIT
         ED    HREC,QPREC     EDIT RECORD NUMBER
         CP    QPREC,QCHREC   IS THE REQ NO > HIGHEST READ?
         BNL   HI             YES. GO FROM HI.
         CP    QPREC,QCCREC   IS THE REQ NO > CURRENT REC?
         BH    UP             YES. GO FROM CURRENT.
         CP    QPREC,=P'1'    IS REQ FOR TOP OF DATASET?
         BH    DOWN           NO. GO DOWN FROM CURRENT.
         B     END            GO ON NEXT DATASET   DOR
TOP      L     R2,QCSTART     START AT TOP
RESUME   L     R4,0(R2)       LOAD DISK ADDR
         L     R5,QCBLKA      ADDR OF BLOCK IOAREA
         MVC   QCCREC,4(R2)   RESET CURRENT REC NO
         B     FIRST          RESUME PROCESSING
HI       L     R2,QCHPTR      START AT HIGHEST SO FAR
         B     DOWNLOOP       FIND CORRECT BLOCK
UP       L     R2,QCCPTR      CURRENT TABLE PTR
UPLOOP   CP    QPREC,12(4,R2) IS THE NEXT ENTRY > REQ NO?
         BNH   RESUME         YES. PROCESS IT.
         LA    R2,8(R2)       TRY NEXT ENTRY
         B     UPLOOP         AGAIN
DOWN     L     R2,QCCPTR      CURRENT TABLE PTR
DOWNLOOP CLI   QSUBNAME,C'M'  IS THIS THE MODEL COMMAND?          UF045
         BNE   OKCMD                                              UF045
         CLC   QPARM1,=CL8' ' WAS THERE A PARM?                   UF045
         BNE   OKCMD          YES, SKIP                           UF045
         QTILT 'MODEL OPERAND REQUIRED'                           UF045
         SPACE 1                                                  UF045
OKCMD    CP    QPREC,4(4,R2)  IS THE ENTRY < REQ NO?              UF045
         BH    RESUME         YES. PROCESS IT.
         SH    R2,=H'8'       TRY PREVIOUS ENTRY
         B     DOWNLOOP       AGAIN
***********************************************************************
*                                                                     *
*   FIND MATCHING RECORD ROUTINE                                      *
*                                                                     *
***********************************************************************
FIND     LH    R3,QPLNG       LENGTH-1 OF COMPARE
         LR    R14,R6         LENGTH OF RECORD
         SR    R14,R3         NUMBER OF COMPARES
         BNP   SKIPREC        RECORD IS TOO SMALL. SKIP IT.
         LR    R15,R4         FIRST BYTE OF RECORD
         CLC   QOFFE,=H'0'    END RANGE FOR FIND SPECIFIED ?
         BE    FLOOP          NO. BYPASS RANGE FOR FIND
         AH    R15,QOFFS      YES. START ADDR FOR FIND
         LH    R14,QOFFE      END ADDR FOR FIND
         SH    R14,QOFFS      VALID RANGE ?
         BP    FLOOP          YES. CONTINUE PROCESSING
         QTILT ' *** ERROR IN COLUMN SPECIFICATION ***'
FLOOP    EX    R3,CLC         DOES THE FIND DATA MATCH THE RECORD?
         BE    MATCH          YES. DISCONTINUE SEARCH.
         LA    R15,1(R15)     INCREMENT TO NEXT BYTE
         BCT   R14,FLOOP      TRY NEXT BYTE
         B     SKIPREC        SKIP THE RECORD. NO MATCH.
MATCH    CLI   QSUBNAME+1,C'A' IS THE REQUEST FOR A FINDALL?
         BE    FALL           YES. DO NOT DISABLE SEARCH.
         MVI   QCODE,0        END THE SEARCH
         ZAP   QPREC,QCCREC   UPDATE THE REPOSITION NUMBER
FALL     MVC   HREC,EDIT      PREPARE FOR EDIT
         ED    HREC,QCCREC    EDIT RECORD NUMBER
         B     FINDOFF        CONTINUE
CLC      CLC   QPFIND(1),3(R15) COMPARE PARM TO RECORD
***********************************************************************
*                                                                     *
*   FIND THE RECORD WHICH IS GREATER THAN OR EQUAL TO TIME            *
*                                                                     *
***********************************************************************
FINDTIME CLI   10(R4),C'.'    DOES THIS RECORD HAVE TIME?
         BE    FINDTSP1       YES, THIS IS SP 1 SYSLOG            CL003
         CLI   27(R4),C':'         DOES RECORD HAVE TIME?         CL003
         BNE   SKIPREC             NO, NOT SP 2 SYSLOG            CL003
         CLC   QPARM1,25(R4)       IS THIS THE TIME WE WANT?      CL003
         BH    SKIPREC             NO. SKIT IT.                   CL003
         B     MATCH               END THE SEARCH                 CL003
         SPACE 1                                                  CL003
FINDTSP1 CLC   QPARM1,8(R4)   IS THIS THE TIME WE WANT?           CL003
         BH    SKIPREC        NO. SKIP IT.
         B     MATCH          END THE SEARCH
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
ENDLINE  DC    C', END OF DATA. LAST REC #'
EDIT     DC    X'4020202020202021'
         DC    CL45' '
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
LISTDSR  CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136E                               DOR
         IFGRPL  DSECT=YES,AM=VTAM                                DOR
         AGO   .X136E                                             DOR
.NO136E  ANOP                                                     DOR
JCT      EQU   0
.X136E   ANOP                                                     DOR
         $BUFFER ,                                                UF046
         $TAB
         $JQE  ,                                                  UF046
         $JCT
         $PDDB
         $IOT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDHLINE
         DS    C'JOB XXXXXXXX, DSID XXXXXXXX, REC #'
HREC     DS    CL8
HEND     DS    C', END OF DATA. LAST REC #'
HREND    DS    CL8
WORK     DSECT
         DS    CL72
DWORD    DS    D                                                  UF040
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=LISTDS2
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
***********************************************************************
*    R1
*    R2   -
*    R3
*    R4   -
*    R5   -
*    R6   -
*    R7
*    R8   -
*    R9   -
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
LISTDS2  TITLE 'QUEUE COMMAND - LIST A DATASET WITH CC FROM SPOOL PACK'
LISTDS2  QSTART HASPEQU=YES,                                     DOR XXX
               XTITLE='QUECMD - LIST A DATASET WITH CC FROM SPOOL PACK'
         GBLB   &QSP136       SP 1.3.6  OPTION FLAG                DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING  WORK,R13      BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   DETERMINE FUNCTION REQUESTED                                      *
*                                                                     *
***********************************************************************
         CLI   QCODE,3        IS THE CALLER FORMAT                  PWF
         BE    NORMAL         YES. GO PROCESS AS NORMAL             PWF
         CLI   QCODE,0        IS THE REQUEST FOR REPOSITIONING?
         BNE   REPOS          YES. DO IT.
***********************************************************************
*                                                                     *
*   LOCATE PDDB FOR DATASET SPECIFIED IN QPDSID                       *
*                                                                     *
***********************************************************************
NORMAL   EQU   *
         MVI   SWITCH,0
         OI    QFLAG1,QDSPCC  SHOW CARRIAGE CONTROL DEFAULT BY CC
         NI    QFLAG2,255-QFLG2SPN-QFLG2PDB  CLEAR SEARCH FLAGS   ONL04
         AIF   (NOT &QSP136).NO136A                               DOR
         USING PDB,R2    BASE REG FOR PDDB                        DOR
         USING IOT,R3    BASE REG FOR IOT                         DOR
         L     R5,QCIOTA      IOAAREA FOR READ IOT BLOCK          DOR
         LR    R3,R5          POINT TO IOTSTART                   DOR
         SH    R3,=AL2(IOTSTART-IOT)  ADJSUST FOR HEADER          DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         USING PDBDSECT,R2    BASE REG FOR PDDB
         USING IOTDSECT,R3    BASE REG FOR IOT
         L     R5,QCIOTA      IOAAREA FOR READ IOT BLOCK
         LR    R3,R5          POINT TO IOTSTART
         SH    R3,=AL2(IOTSTART-IOTDSECT)  ADJSUST FOR HEADER
.X136A   ANOP                                                     DOR
*DOR     L     R3,QCIOTA      LOAD BASE REG
*DOR     LR    R5,R3          IOAREA FOR READ IOT BLOCK
NEXTIOT  LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
*DOR     S     R4,QBUFLEN     ADJUST FOR HASP BUFFER PREFIX
         LR    R2,R3          BASE OF IOT
         A     R2,IOTPDDB     OFFSET TO FIRST PDDB IN IOT
*DOR     S     R2,QBUFLEN     ADJUST FOR HASP BUFFER PREFIX
FINDDS   CLC   QPDSID,PDBDSKEY IS THIS THE DATASET?
         BNE   NEXTPDB       SKIP IF NO                          ONL04
         OI    QFLAG2,QFLG2PDB  SHOW PDDB FOR DSID EXISTS         ONL04
         CLC   PDBMTTR,=F'0'  DOES PDDB HAVE OUTPUT ?             ONL04
         BNE   FOUNDDS        YES. CONTINUE.
NEXTPDB  LA    R2,PDBLENG(R2) NO. LOOK AT NEXT PDDB.
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4          IS THERE ANOTHER IOT?
         BZ    SPINIOT        NO. TRY THE SPIN IOT?
         BAL   R8,READ        READ THE IOT
         B     NEXTIOT        SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136B                                 DOR
         USING JCT,R1    BASE REG FOR JCT                           DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         USING JCTDSECT,R1    BASE REG FOR JCT
.X136B   ANOP                                                       DOR
SPINIOT  TM    QFLAG2,QFLG2SPN  HAVE THE SPIN IOT'S BEEN SEARCHED?ONL04
         BO    NODATA         SKIP IF YES                         ONL04
         OI    QFLAG2,QFLG2SPN  SHOW SPIN IOT'S NOW BEING SEARCHEDONL04
         L     R1,QCJCTA      LOAD BASE REG
         L     R4,JCTSPIOT    DISK ADDR OF SPIN IOT
         DROP  R1
         B     SPIN           SEARCH THE SPIN IOT CHAIN
NODATA   DS    0H             ALL PDDB'S HAVE BEEN SEARCHED       ONL04
         XC    QPDSID,QPDSID  INVALIDATE DSID                     ONL04
         TM    QFLAG2,QFLG2PDB  WAS DATASET FOUND BUT EMPTY?      ONL04
         BZ    DSNOTFND       SKIP IF NO                          ONL04
         QTILT '*** DATASET ID IS EMPTY ***'                      ONL04
DSNOTFND QTILT '*** DATASET ID NOT FOUND ***'                     ONL04
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
TILT2    QTILT '*** DATASET TABLE LIMITS EXCEEDED ***'
         SPACE
FOUNDDS  EQU   *                                                    PWF
         MVC   QOLDDSID,QPDSID
*        TM    PDBFLAG1,PDB1NULL  IS THIS PDDB NULL
*        BO    NEXTPDB            YES TRY AGAIN
         CLI   QCODE,3            IS THE REQUEST FROM FORMAT?       PWF
         BNE   FOUNDDS1           NO. BYPASS PROCESSING             PWF
         MVC   QCTRAK,PDBMTTR     YES. SAVE A(DS BUFFER)            PWF
         B     RETURN                                               PWF
FOUNDDS1 MVC   QCJNAME,QPARM1     SAVE THE JOBNAME
         MVC   QCDSNO,QPARM2      SAVE THE DATASET ID NUMBER
         MVC   QDHLINE,QCHLINE    MOVE IN HEADING LINE
         MVC   QCRECFM,PDBRECFM   RECORD FORMAT FOR SAVE
         MVC   QCLRECL,PDBLRECL   RECORD LENGTH FOR SAVE
         L     R1,QCJCTA          LOAD BASE REG
         AIF   (NOT &QSP136).NO136C                                 DOR
         USING JCT,R1             BASE REG FOR JCT DOR
         AGO   .X136C                                               DOR
.NO136C  ANOP                                                       DOR
         USING JCTDSECT,R1        BASE REG FOR JCT
.X136C   ANOP                                                       DOR
         MVC   QCJTYPE(3),JCTJOBID   MOVE TYPE OF JOB TO HEADING
         MVC   QCJNAME(8),JCTJNAME   MOVE TYPE OF JOB TO HEADING
         DROP  R1
         L     R4,PDBMTTR         DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA          ADDR OF DATASET BLOCK IOAREA
         L     R2,QCSTART         BEGINNING OF DISK ADDR TABLE
         ZAP   QCCREC,=P'0'       ZERO CURRENT RECORD NO
         MVC   QCCPTR,QCSTART     BEGIN OF TBL
         ZAP   QCHREC,=P'0'       ZERO HIGH REC NO
         MVC   QCHPTR,QCSTART     BEGIN OF TBL
         ZAP   QPREC,=P'1'        REPOSITION TO TOP OF DATASET
         B     FIRST              PROCESS DATASET
         DROP  R2,R3
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)           DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4              IS THE DISK ADDR ZERO?
         BZ    END                YES. END OF DATASET.
         ST    R4,0(R2)           STORE DISK ADDR IN TABLE
         BAL   R8,READ            READ A BLOCK
         CLC   QPJOBID(6),4(R5)   DOES THE JOBID MATCH?
         BNE   END                NO. END OF DATASET.
         MVC   4(4,R2),QCCREC     STORE CURRENT REC NUM IN TABLE
         ST    R2,QCCPTR          STORE CURRENT TABLE ADDR
         CP    QCCREC,QCHREC      IS THE CURRENT REC NO > HIGHEST?
         BNH   NOTHI              NO. SKIP.
         MVC   QCHREC(8),QCCREC   REPLACE HI REC CNT AND PTR
NOTHI    LA    R2,8(R2)           INCREMENT TO NEXT TBL ENTRY
         C     R2,QCEND           IS THIS THE END OF TABLE?
         BNL   TILT2              YES. TILT.
         LA    R4,10(R5)          ADDR OF FIRST RECORD IN BLOCK
         EJECT
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'        IS LENGTH BYTE FF?
         BE    NEXTBLK            YES. END OF BLOCK.
         TM    1(R4),X'10'        IS THIS A SPANNED RECORD?
         BO    SPAN               YES. SKIP IT.
         SR    R6,R6              ZERO OUT REG
         IC    R6,0(R4)           INSERT LENGTH
         LR    R7,R6              SAVE RECORD LENGTH
         LR    R1,R4              SAVE RECORD LOCATION
         TM    1(R4),X'80'        IS CARRIAGE CONTROL SPECIFIED?
         BZ    NOCCTL             NO. CONTINUE.
         LA    R1,1(R1)           SKIP OVER CARRIAGE CONTROL
         OI    SWITCH,HASCC       SHOW CARRIAGE CONTROL
NOCCTL   TM    1(R4),X'08'        IS THIS RECORD TO BE IGNORED?
         LR    R4,R1              UPDATE RECORD POINTER
         BNZ   SKIPREC            YES. SKIP IT.
         AP    QCCREC,=P'1'       ADD ONE TO CUR REC NO
         CP    QCCREC,QPREC       HAVE WE REACHED THE RECORD WE WANT
         BL    SKIPREC            NO. TRY NEXT RECORD.
         CLI   QCODE,4            IS THE REQUEST FOR A FIND?
         BE    FIND               YES. DO IT.
         CLI   QCODE,8            IS THE REQUEST FOR A FINDTIME?
         BE    FINDTIME           YES. DO IT.
FINDOFF  AH    R1,QPOFFSET        ADD OFFSET TO START OF RECORD
         XC    OVERFLOW,OVERFLOW  RESET OVERFLOW INDICATOR        LBDMC
         SH    R7,QPOFFSET        SUBTRACT OFFSET FROM LENGTH
         BNP   ZEROPRT            NO DATA LEFT IN RECORD.
         TM    QFLAG1,QDSPCC      IS CARRIAGE CONTROL WANTED
         BNO   NOSUBT             NO  DONT DECREMENT
         TM    SWITCH,HASCC       IS CARRIAGE CONTROL IN DSID
         BNO   NOSUBT             NO  DONT DECREMENT
         SH    R1,=H'1'           POINT BACK TO CARRIAGE CONTROL
         AH    R7,=H'1'               INCREASE LENGTH BY 1
         NI    SWITCH,255-HASCC      AND TURN OFF CARRIAGE CONTROL
NOSUBT   CH    R7,QDLNELEN        IS THE RECORD BIGGER THAN LINE   MOD5
         BNH   LTMAX              NO. USE RECORD LENGTH.           MOD5
         SH    R7,QDLNELEN        AMOUNT OF OVERFLOW              LBDMC
         STH   R7,OVERFLOW        STORE OVERFLOW LENGTH           LBDMC
         LH    R7,QDLNELEN        YES. USE A LENGTH OF LINE        MOD5
LTMAX    STH   R7,QDMLNG          STORE MESSAGE LENGTH             MOD5
         LA    R1,3(R1)           OFFSET PAST REC HDR
         ST    R1,QDMSGA          STORE ADDR OF MESSAGE LINE
         TM    QFLAG1,QDSPBLK     DISPLAY BLANK LINES?            LBDMC
         BNO   SKPTST1             YES, SKIP BLANK TEST           LBDMC
         BCTR  R7,0               LENGTH RELATIVE TO ZERO         LBDMC
         EX    R7,TSTBLNKS        TEST FOR ALL BLANKS             LBDMC
         BNE   SKPTST1             NO, DISPLAY LINE               LBDMC
         TM    SWITCH,SWITCH2     IS THIS 2 IN A ROW?             ANRPC
         BE    SKIPREC             YES, SKIP THIS RECORD          LBDMC
         OI    SWITCH,SWITCH2     SET SWITCH ON                   ANRPC
         B     BALRQ5             DON'T RESET THE SWITCH YET      LBDMC
SKPTST1  NI    SWITCH,255-SWITCH2 CLEAR SWITCH                    ANRPC
BALRQ5   L     R15,=V(DISPLAY)    ADDRESS OF DISPLAY MODULE
         BALR  R14,R15            GO TO IT
         XC    OVERFLOW,OVERFLOW  AVOID A LOOP                    LBDMC
         TM    QDOVER,1           WAS THERE A PAGE OVERFLOW?
         BNO   SKIPREC            NO. SKIP.
         ZAP   QPREC,QCCREC       UPDATE THE REPOSITION NUMBER
         MVC   HREC,EDIT          PATTERN FOR EDIT
         ED    HREC,QCCREC        EDIT RECORD NUMBER
SKIPREC  LA    R4,3(R6,R4)        INCREMENT TO NEXT RECORD
         B     NEXTREC            PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)           LENGTH OF SEGMENT
         TM    1(R4),X'08'        IS THIS THE FIRST SEGMENT?
         BO    SPANFRST           YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)        UPDATE RECORD POSITION
         B     NEXTREC            PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)        UPDATE RECORD POSITION
         B     NEXTREC            PROCESS NEXT RECORD
ZEROPRT  LA    R1,QBLANK          PRINT A BLANK
         LA    R7,1               LENGTH OF ONE
         B     LTMAX              PRINT THE RECORD                 MOD5
END      CP    QCCREC,=P'0'       IS THE DATASET EMPTY
         BE    STOP               YES. QUIT.
         MVC   HEND,ENDLINE       TELL THEM THIS IS THE END
         MVC   HREND,EDIT         PATTERN FOR EDIT
         ED    HREND,QCCREC       LAST REC NO
         CLI   QCODE,32           WAS REQUEST FOR BOTTOM?
         BE    BOTTOM             YES. BACK UP ONE PAGE - 1.
         MVC   QDMLNG,=H'0'       ZERO OUT MESSAGE LENGTH
         L     R15,=V(DISPLAY)    ADDR OF DISPLAY MODULE
         BALR  R14,R15            FLUSH THE SCREEN
         ZAP   QPREC,=P'1'        RECORD NUMBER 1
         MVC   QDHLINE,QCHLINE    BLANK THE TITLE LINE
         B     TOP                START AT TOP OF DATASET
STOP     XC    QPDSID,QPDSID      MAKE USER SPECIFY A NEW DATA SET
         MVC   QDHLINE,=CL80'*** DATA SET IS EMPTY ***'
RETURN   QSTOP
         EJECT
***********************************************************************
*                                                                     *
*   BOTTOM OF DATASET                                                 *
*                                                                     *
***********************************************************************
BOTTOM   ZAP   QPREC,QCCREC       LAST RECORD NUMBER
         MVI   QCODE,0            AVOID A LOOP
         SP    QPREC,QDLINES      TOP OF PAGE-1                    MOD5
         AP    QPREC,=P'1'        TOP OF PAGE                      MOD5
         BP    REPOS              CONTINUE IF POSITIVE.
         ZAP   QPREC,=P'1'        TOP OF DATASET
***********************************************************************
*                                                                     *
*   REPOSITION TO REQUESTED RECORD NUMBER                             *
*                                                                     *
***********************************************************************
REPOS    MVC   QDHLINE,QCHLINE    MOVE IN HEADING LINE
         MVC   HREC,EDIT          PREPARE FOR EDIT
         ED    HREC,QPREC         EDIT RECORD NUMBER
         CP    QPREC,QCHREC       IS THE REQ NO > HIGHEST READ?
         BNL   HI                 YES. GO FROM HI.
         CP    QPREC,QCCREC       IS THE REQ NO > CURRENT REC?
         BH    UP                 YES. GO FROM CURRENT.
         CP    QPREC,=P'1'        IS REQ FOR TOP OF DATASET?
         BH    DOWN               NO. GO DOWN FROM CURRENT.
TOP      L     R2,QCSTART         START AT TOP
RESUME   L     R4,0(R2)           LOAD DISK ADDR
         L     R5,QCBLKA          ADDR OF BLOCK IOAREA
         MVC   QCCREC,4(R2)       RESET CURRENT REC NO
         B     FIRST              RESUME PROCESSING
HI       L     R2,QCHPTR          START AT HIGHEST SO FAR
         B     DOWNLOOP           FIND CORRECT BLOCK
UP       L     R2,QCCPTR          CURRENT TABLE PTR
UPLOOP   CP    QPREC,12(4,R2)     IS THE NEXT ENTRY > REQ NO?
         BNH   RESUME             YES. PROCESS IT.
         CP    4(4,R2),12(4,R2)   IS NEXT < THAN CURRENT?         LBDMC
         BL    RESUME              YES, USE THIS ONE              LBDMC
         LA    R2,8(R2)           TRY NEXT ENTRY
         B     UPLOOP             AGAIN
DOWN     L     R2,QCCPTR          CURRENT TABLE PTR
DOWNLOOP CP    QPREC,4(4,R2)      IS THE ENTRY < REQ NO?
         BH    RESUME             YES. PROCESS IT.
         SH    R2,=H'8'           TRY PREVIOUS ENTRY
         B     DOWNLOOP           AGAIN
         EJECT
***********************************************************************
*                                                                     *
*   FIND MATCHING RECORD ROUTINE                                      *
*                                                                     *
***********************************************************************
FIND     LH    R3,QPLNG           LENGTH-1 OF COMPARE
         LR    R14,R6             LENGTH OF RECORD
         SR    R14,R3             NUMBER OF COMPARES
         BNP   SKIPREC            RECORD IS TOO SMALL. SKIP IT.
         LR    R15,R4             FIRST BYTE OF RECORD
         CLC   QOFFE,=H'0'        END RANGE FOR FIND SPECIFIED ?
         BE    FLOOP              NO. BYPASS RANGE FOR FIND
         AH    R15,QOFFS          YES. START ADDR FOR FIND
         LH    R14,QOFFE          END ADDR FOR FIND
         SH    R14,QOFFS          VALID RANGE ?
         BP    FLOOP              YES. CONTINUE PROCESSING
         QTILT ' *** ERROR IN COLUMN SPECIFICATION ***'
FLOOP    EX    R3,CLC             DOES THE FIND DATA MATCH THE REC
         BE    MATCH              YES. DISCONTINUE SEARCH.
         LA    R15,1(R15)         INCREMENT TO NEXT BYTE
         BCT   R14,FLOOP          TRY NEXT BYTE
         B     SKIPREC            SKIP THE RECORD. NO MATCH.
MATCH    CLI   QSUBNAME+1,C'A'    IS THE REQUEST FOR A FINDALL?
         BE    FALL               YES. DO NOT DISABLE SEARCH.
         MVI   QCODE,0            END THE SEARCH
         ZAP   QPREC,QCCREC       UPDATE THE REPOSITION NUMBER
FALL     MVC   HREC,EDIT          PREPARE FOR EDIT
         ED    HREC,QCCREC        EDIT RECORD NUMBER
         B     FINDOFF            AND CONTINUE
***********************************************************************
*                                                                     *
*   FIND THE RECORD WHICH IS GREATER THAN OR EQUAL TO TIME            *
*                                                                     *
***********************************************************************
FINDTIME CLI   10(R4),C'.'        DOES THIS RECORD HAVE TIME?
         BNE   SKIPREC            NO. SKIP IT.
         CLC   QPARM1,8(R4)       IS THIS THE TIME WE WANT?
         BH    SKIPREC            NO. SKIP IT.
         B     MATCH              END THE SEARCH
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK          STORE DISK ADDR
         LR    R1,R5              IOAREA ADDRESS
         L     R15,=V(READSPC)    ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15            GO TO IT
         BR    R8                 RETURN TO CALLER
         EJECT
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
CLC      CLC   QPFIND(1),3(R15)      COMPARE PARM TO RECORD
TSTBLNKS CLC   1(1,R1),=CL132' '  TEST LINE FOR BLANKS            LBDMC
ENDLINE  DC    C', END OF DATA. LAST REC #'
EDIT     DC    X'4020202020202021'
         LTORG
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QPRBGEN  BEGIN  SET PRINT FOR CNTL BLOCK GEN
         AIF   (NOT &QSP136).NO136D                                 DOR
         IFGRPL  DSECT=YES,AM=VTAM                                  DOR
         AGO   .X136D                                               DOR
.NO136D  ANOP                                                       DOR
JCT     EQU    0
.X136D   ANOP                                                       DOR
        $BUFFER ,
        $TAB
        $JQE   ,
        $JCT
        $PDDB
        $IOT
         PRINT NOGEN
         QCOMMON
         QPRBGEN  DONE   RESTORE NORMAL PRINT STATUS
         ORG   QDHLINE
         DS    C'    XXXXXXXX, DSID XXXXXXXX, REC #'
HREC     DS    CL8
HEND     DS    C', END OF DATA. LAST REC #'
HREND    DS    CL8
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
SWITCH   DS    X
SWITCH2  EQU   X'80'
HASCC    EQU   X'40'       DSID HAS CARRIAGE CONTROL              ANRPC
OVERFLOW DS    H                                                  LBDMC
WORKEND  EQU   *
         END
./       ADD   NAME=LISTTCB
*  LISTTCB - DISPLAY TCB TABLES FROM ASID ADDRESS
* TO BE IMPLEMENTED INTO COREZAP
* DAVID RIKER   7/22/85
* COMPUTER DATA SYSTEMS
* 1 CURIE COURT
* ROCKVILLE, MD 20850
* 202 362 1160
***********************************************************************
*       BUILT CSECT TABLE                                             *
*       WITH  PROGRAMS NAME, LOCATION, AND LENGTH
*       SPOOL NUMBER AND LOCATION AND LENGTH                          *
***********************************************************************
MAPCSECT EQU   *
         STM   0,15,SAVEMAPR
         ST    R15,SAVER15
         CLI   MAPSWT,X'FF'     FIRST TIME MAP BUILDER?
         BE    MAPOFF
         MVI   MAPSWT,X'FF'
         L     R4,16         CVT
         L     R4,0(R4)      ADDR OF TCB BOX
         L     R4,4(R4)      ADDR OF CUR TCB TO BE EXCUTED
         ST    R4,TCBADR
         L     R4,540        PSATOLD-PSA   CURRENT TCB
         ST    R4,TCBCUR
         L     R6,TCBADR
         LR    R5,R6
         B     TCBDISP
TCBREP   L     R5,136(R6)          1ST ATTACHED TCB
         LTR   R5,R5
         BNZ   TCBDISP
TCB1     L     R5,128(R6)          PREVIOUSLY ATTACHED TCB
         LTR   R5,R5
         BNZ   TCBDISP
         L     R6,132(R6)          TASK'S TCB
         LA    R6,0(R6)            ADDRESS OF THIS TCB
         L     R5,TCBADR
         LA    R5,0(R5)            ADDRESS OF THIS TCB
         CR    R5,R6               IF SAME TCBS END OF PROCESSING
         BNE   TCB1
MAPEX2   EQU   *
         B     MAPDONE                     EXIT
TCBDISP  EQU   *
         LR    R11,R5              TCB ADDRESS CONVERT EBCDI HEX
         CLI   174(R5),X'00' NO ABEND
         BE    TCBX2
         TM    174(R5),X'40' IS TASK SET NON-DISPATCH ABILITY
         BO    TCBX2
         TM    33(R5),X'80' IS ANOTHER TASK IS IN SYSTEMMUST COMPLETE
         BZ    TCBX1
         LR    R6,R5               TCB ADDRESS
         B     TCBREP              TRY NEXT TCB
TCBX1    L     R7,0(,R5)           ADDR OF RB
         LA    R3,64               RB-64
         SR    R7,R3               OFFSET TO -64
         CLI   63(R7),X'3D'        RB-1  INTERUPTION CODE RBINTCOD
         BE    TCBX2
         CLI   63(R7),X'61'        RB-1
         BE    TCBX2
         LR    R6,R5               NEXT TCB
         B     TCBREP
TCBX2    L     R7,36(,R5)          ADDR OF LLE (LAST LOAD LIST ELEMENT
         L     R15,MAPDIRA
         USING MODDIRD,R15
TCBX21   LA    R7,0(R7)            ADDR OF NEXT LLE
         LTR   R7,R7
         BNZ   TCBX4
         OI    MAPFLAG,X'04'
         B     TCBX7
TCBX3    L     R8,20(,R8)          ADR OF NEXT MINOR CDE
         LA    R8,0(R8)
         B     TCBX41
TCBX4    L     R8,4(,R7)           ADR OF CDE
TCBX41   TM    28(R8),X'04'        SEE IF IT IS MINOR CDE?
         BO    TCBX3               NO,
         MVC   MODNMEX(8),8(R8)
         L     R6,20(,R8)          EXTEND CDE ADDR
         L     R3,4(,R6)           RB ADR
         LR    R8,R3
         SLA   R8,2
         XR    R4,R4
TCBX6    LTR   R3,R3
         BNP   TCBXA
         MVC   MODNME(8),MODNMEX
         LH    R11,MODCNT
         LA    R11,1(,R11)
         CH    R11,MODCNTMX
         BH    MAPERR1
         STH   R11,MODCNT
         L     R11,8(R8,R6)        ADDRESS OF MODULE
         ST    R11,MODADR
         L     R11,8(R4,R6)
         LA    R11,0(R11)          SIZE OF MODULE
         ST    R11,MODSIZE
* DISPLAY TO QUEUE
*    MODADR CONVERT TO HEXA  ALSO PACK EDIT MODSIZE
         BCTR  R3,R0
         LA    R15,16(R15)             BUMP MODULE DIRECTORY PTR
         LA    R4,4(R4)
         LA    R8,4(R8)
         B     TCBX6
TCBX7    L     R7,0(,R5)
         LA    R7,0(R7)
         LTR   R7,R7
         BZ    TCBXG
TCBX8    TM    10(R7),X'C0'
         BZ    TCBX9
TCBX81   L     R7,28(,R7)
         LA    R7,0(R7)
         CR    R7,R5
         BE    TCBXG
         B     TCBX8
TCBX9    L     R8,12(,R7)
         LA    R8,0(R8)
         LTR   R8,R8
         BZ    TCBX81
         B     TCBX41
TCBXA    L     R7,0(,R7)
         TM    MAPFLAG,X'04'
         BO    TCBXG
         B     TCBX21
TCBXG    XR    R6,R6
         L     R4,24(,R5)
         LA    R4,0(R4)
         LTR   R4,R4
         BZ    TCBXI
TCBXGA   TM    8(R4),X'80'
         BO    TCBXH
         L     R8,4(,R4)
TCBXGB   LA    R8,0(R8)
         LTR   R8,R8
         BZ    TCBXG1
         TM    10(R4),X'80'
         BO    TCBXG1
         L     R8,4(,R8)
         B     TCBXGB
TCBXG1   LTR   R6,R6
         BZ    TCBXG2
         LR    R4,R6
         TM    8(R4),X'40'
         BO    TCBXI
         L     R4,0(R4)
         XR    R6,R6
         B     TCBXGA
TCBXG2   TM    8(R4),X'40'
         BO    TCBXI
         L     R4,0(,R4)
         B     TCBXGA
TCBXH    LR    R6,R4
         L     R4,4(,R4)
         L     R8,4(,R4)
         B     TCBXGB
TCBXI    B     MAPDONE
TCBXII   LR    R6,R5
         B     TCBREP
MAPERR1  LA    R3,ERROR1
         LA    R1,PLINE
         LH    R2,0(R3)
         BCTR  R2,R0
         EX    R2,MVCEXT
         STM   R0,R15,SAVEREGS
         LM    R0,R15,SAVEMAPR
         PUT   DCB,PLINE
         LM    R0,R15,SAVEREGS
MAPCLR   EQU   *
         LA    R1,PLINE
         MVI   9(R1),C' '
         MVC   10(80,R1),9(R1)
         B     MAPDONE
MAPOFF   EQU   *
         B     MAPDONE
MVCEXT   MVC   8(1,R1),4(R3)
         DS    0F
SAVER15  DC    F'0'
SAVEMAPR DC    18F'0'
WORKAREA DC    18F'0'
SAVEREGS DC    18F'0'
MARK09   DC    F'00009'
TCBADR   DC    F'0'
TCBCUR   DC    F'0'
MAPDIRA  DC    A(MAPDIR)
MAPDIRE  DC    X'80',AL3(MAPDIR)
MAPDIRN  DC    A(MAPDIR)
INSTONE  DC    F'1'
INSTFOUR DC    F'4'
MODCNT   DC    H'0'
MODCNTMX DC    H'100'   INCREASE THE NUMBER WHEN YOU INCREASE MAPDIR.
MPRTCNT  DC    H'0'
MPRTCNTP DC    H'32000'
MAPSWT   DC    X'00'
NEWCSECT DC    X'47F0F0' IBM STANDARD LINKAGE INSTRUCTION
MODNMEX  DC    CL8' '
MCNT100T DC    CL14'MOD CNT GT 100'
NOMOD    DC    CL5'?????' SOME MODULE DO NOT HAVE IBM STANDARD LINKAGE
         DS    0H
MAPDONE  EQU   *
./       ADD   NAME=PAGEMON
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/02/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
PAGEMON  TITLE 'QUEUE COMMAND - PAGING MONITOR'
PAGEMON  QSTART ,                  START PAGEMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
***********************************************************************
***       FORMERLY AND MODIFIED FOR QUEISPF                         ***
***      TITLE 'CSCZP03D -  ##P  PAGING MONITOR'
***********************************************************************
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   - NO OF ASCBS
*    R8   -   ASID OR CSBD ADDRESS
*    R9   -
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       IEEZP03D -       ##P  PAGING MONITOR                      ***
***       VERSION -        1.1                                      ***
***       MVS LEVEL -      MVS/SE  3.8.  TO MVS/SP1.3               ***
***********************************************************************
         EJECT
         MVC   WTOLIST(80),QBLANK
         LA    R1,XTIME            WAITTIME ADDR
* REMOVED AS WORKAREA OVERLAPPED FROM PREVIOUS COMMAND
*        L     R15,8(0,R1)         LOAD HEX TIME
*        LTR   R15,R15             TIME NOT SPECIFIED
*        BNZ   SETINIT             NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
         EJECT
SETINIT  L     R4,16               CVT
         L     R4,356(0,R4)        PVT
         LA    R6,XTIME
         L     R6,8(0,R6)          HEX NO. OF SECS
         LA    R8,PAGTABLE         PAGE STATISTICS TABLE
         MVC   0(52,R8),248(R4)
         LA    R3,XTIME            WAITTIME ADDR
         STIMER WAIT,DINTVL=(R3)
         EJECT
PAGOUT   EQU   *
 MVC   QDHLINE(80),=CL80'     PAGING MONITOR - 30 SECONDS INTERVALS'
         MVC   PAGMSG(80),QBLANK
         L     R4,16               CVT ADDR
         L     R4,356(0,R4)        PVT ADDR
         SR    R7,R7
         L     R1,256(0,R4)        PVTVAMI  NO OF VIO PAGEINS
         A     R1,260(0,R4)        PVTVAMO  NO OF VIO PAGEOUTS +
         A     R1,16(0,R8)         OLDVAMR
         S     R1,264(0,R4)        PVTVAMR  NO OF VIO RECLAIMS
         S     R1,8(0,R8)          OLDVAMI
         S     R1,12(0,R8)         OLDVAMO
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'VIO PAGING'
         BAL   R9,PAGFORM
         L     R1,268(0,R4)        PVTSPIN   NO OF PAGES SWAPPED IN
         A     R1,272(0,R4)        PVTSPOUT  NO OF PAGES SWAPPED OUT
         S     R1,20(0,R8)         OLDSPIN
         S     R1,24(0,R8)         OLDSPOUT
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'SWAP PAGING'
         BAL   R9,PAGFORM
         L     R1,284(0,R4)        PVTCAIN   NO OF COMMON AREA PAGEINS
         A     R1,288(0,R4)        PVTCAOUT  NO OF COMMON AREA PAGEOUTS
         A     R1,44(0,R8)         OLDCAREC
         S     R1,292(0,R4)        PVTCAREC NO OF RECLAIMS OF COMMON
         S     R1,36(0,R8)         OLDCAIN
         S     R1,40(0,R8)         OLDCAOUT
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'LPA/CSA PAGING'
         BAL   R9,PAGFORM
         L     R1,248(0,R4)        PVTNPIN  NO OF PAGES PAGESIN
*                                  EXCLUDING SWAPINS & VIO PAGEINS
         A     R1,252(0,R4)        PVTNPOUT NO OF PAGES PAGEOUTS
*                                  EXCLUDING SWAPINS & VIO PAGEINS
         A     R1,292(0,R4)        PVTCAREC  NO OF RECLAIMS OF COMMON
         A     R1,28(0,R8)         OLDNPREC
         A     R1,36(0,R8)         OLDCAIN
         A     R1,40(0,R8)         OLDCAOUT
         S     R1,284(0,R4)        PVTCAIN   NO OF COMMON AREA PAGEIN
         S     R1,288(0,R4)        PVTCAOUT NO OF COMMON AREA PAGEOUTS
         S     R1,0(0,R8)          OLDNPIN
         S     R1,4(0,R8)          OLDNPOUT
         S     R1,276(0,R4)        PVTNPREC NO OF PAGES RECLAIMED
*                                  EXCLUDING SWAP RECLAIMS
         S     R1,44(0,R8)         OLDCAREC
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'PLPA PAGING'
         BAL   R9,PAGFORM
         LR    R1,R7               TOTAL PAGES/INTERVAL
         MVC   PAGNAME(16),=CL16'TOTAL PAGING'
         BAL   R9,PAGFORM
         B     RETURN
         EJECT
PAGFORM  LTR   R1,R1               PAGE COUNT OVERFLOW
         BM    PAGFORM1            YES
         LA    R15,XTIME
         SR    R14,R14
         LR    R15,R1
         M     R14,=F'100'         SET UP HUNDREDTHS
         DR    R14,R6              FIND PAGING RATE
         MVC   PAGSEC(7),=XL7'402020214B2020'
         CVD   R15,DOUBLE          PAGES
         ED    PAGSEC(7),DOUBLE+5
         MVC   PSEC(10),=CL10'PAGES/SEC'
         B     PAGFORM2
         SPACE 1
PAGFORM1 MVC   PAGSEC(7),=CL7'*OVER*'
         SPACE 1
PAGFORM2 EQU   *
MSGRTN   EQU   *
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R9
         SPACE 3
RETURN   QSTOP
         EJECT
         LTORG
         DS    0D
WAITTIME DC    CL8'00003000'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
XTIME    DS    2F
WTOLIST  EQU   QDMSG
PAGMSG   EQU   QDMSG
PAGNAME  EQU   QDMSG+1
PAGSEC   EQU   QDMSG+20
PSEC     EQU   QDMSG+30
PAGTABLE DS    13F
WORKEND  DS    0F
         EJECT
         END
./       ADD   NAME=PARSE
PARSE    TITLE 'QUEUE COMMAND - COMMAND LINE PARSE ROUTINES'      ONL01
PARSE    QSTART ,                  START PARSE CSECT ASSEMBLY     ONL01
               GBLB  &QISPF DOR
               GBLB  &QISPF2 DOR
               GBLB  &QSYSP DOR
               GBLB  &QWTO  DOR   Q CMD TO DISPLAY ON SYSLOG
***********************************************************************
* RNB CHANGES:                                                        *
*    (1) ADDED COMMAND ABBREVIATIONS: RNB06                           *
*                JM FOR JMSG                                          *
*                JL FOR JLOG                                          *
*                JC FOR JCL                                           *
*                SL FOR SLOG                                          *
*                FT FOR FTIM                                          *
*                DE FOR DEL                                           *
*                RE FOR REQ                                           *
*    (2) ADDED COMMAND ABBREVIATIONS: DOR01                           *
*                CS FOR CSYS                                          *
*                AS FOR ASID                                          *
*                AL FOR ALLOC                                         *
*                AE FOR AENQ                                          *
*                LE FOR LENQ (ENQLOAD1 AND ENQLOAD2)                  *
*                CZ FOR CZAP
*                SR FOR SRM
*                TA FOR DTAPE    DOR02                                *
*                SU FOR SUINFO   DOR02                                *
*                FR FOR STORAGE  DOR02 (FRAME/CSA)                    *
*                SA FOR SAUGAGE  DOR03 (STORAGE USAGE GRAPH)          *
*                PM FOR PAGEMON  DOR03 (PAGING MONITOR)               *
*                AM FOR ACTMON  DOR03 (ACTIVITY MONITOR)              *
*                XM FOR EXCPMON  DOR03 (EXCPTION MONITOR)             *
*                DM FOR DEVMON  DOR03 (DEVICE BUSY MONITOR)           *
*                CM FOR CHANMON  DOR03 (CHANNEL BUSY MONITOR)         *
*                MP FOR DOMAIN   DOR03 (DISPLAY DOMAIN MPL)           *
*                SP FOR STCMAP   DOR03 (DISPLAY STORAGE MAP)          *
*                AC FOR ASIDCSA   DOR04 CSA OF ASID                   *
*                VSM FOR VSM      DOR04 VIRTUAL STORAGE MGMT          *
*    (3) ADDED COMMAND ABBREVIATIONS: DOR05                           *
*                SJ  FOR SJOB     DOR05 FEATURE LIKE 3.8 LIST         *
*                                 INCLUDE BUILT-IN REPOS              *
*                                                                     *
***********************************************************************
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL     LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   PARSE SUBCOMMAND NAME                                             *
*                                                                     *
***********************************************************************
         LH    R2,QDRLNG      LENGTH OF REPLY LINE
         OC    QDREPLY,QBLANK TRANSLATE TO UPPER CASE
         CLC   QDREPLY,QBLANK IS THE ENTIRE REPLY BLANK?
         BE    LOOKUP         YES. DO LOOKUP.
         MVC   QDTLINE,QDREPLY MOVE COMMAND LINE TO HEADING
         USING  QDQTTY,R3
         L     R3,QVDQTTY
         MVC   QDTLINE+47(15),QCPUSTR    SYSTEM ID/CPU TYPE
         DROP  R3
         MVC   FIELD,QBLANK   BLANK THE WORK FIELD
         MVC   OFFSET(4),=F'0' ZERO THE OFFSET AND LENGTH
         MVC   QOFF0(12),OFFSET INITIALIZE FIRST FIELD
         MVC   QOFF1(48),QOFF0 INITIALIZE NEXT FOUR FIELDS
         LA    R6,QOFF4+12    ADDR PAST LAST FIELD
         LA    R5,QOFF0       ADDR OF FIRST SET OF FIELDS
         LA    R3,QDREPLY     FIRST BYTE OF REPLY LINE
ENCORE   LA    R4,FIELD       FIRST BYTE OF WORK FIELD
BLANK    CLI   0(R3),C' '     IS THIS BYTE BLANK?
         BNE   FIRST          NO. START OF FIELD.
         LA    R3,1(R3)       YES. SKIP IT.
         BCT   R2,BLANK       TRY NEXT BYTE
         B     EMPTY          END OF REPLY LINE.
FIRST    LH    R1,QDRLNG      REPLY LENGTH
         SR    R1,R2          COMPUTE OFFSET TO START OF FIELD
         STH   R1,OFFSET      STORE OFFSET
         LR    R1,R2          SAVE COUNT OF REMAINING BYTES
         B     CHAR           CONTINUE
LOOP     CLI   0(R3),C' '     IS THIS BYTE BLANK?
         BE    LAST           YES. END OF FIELD.
CHAR     MVC   0(1,R4),0(R3)  MOVE BYTE TO SUBNAME
         LA    R3,1(R3)       INCREMENT
         LA    R4,1(R4)       INCREMENT
         BCT   R2,LOOP        TRY NEXT BYTE
LAST     SR    R1,R2          COMPUTE FIELD LENGTH
         CH    R1,=H'8'       IS LENGTH GREATER THAN 8?
         BNH   STORE          NO. USE IT.
         LA    R1,8           YES. USE LENGTH OF EIGHT.
STORE    STH   R1,LENGTH      STORE FIELD LENGTH
EMPTY    MVC   0(12,R5),OFFSET MOVE FIELD TO QCOMMON
         LTR   R2,R2          IS THE REMAINING LENGTH ZERO?
         BZ    LOOKUP         YES. DO THE TABLE LOOKUP.
         MVC   FIELD,QBLANK   BLANK THE WORK FIELD
         MVC   OFFSET(4),=F'0' ZERO OUT OFFSET AND LENGTH
         LA    R5,12(R5)      INCREMENT TO NEXT FIELD
         CR    R5,R6          WAS THAT THE LAST FIELD?
         BL    ENCORE         NO. PROCESS NEXT FIELD.
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM A TABLE LOOK UP FOR THE QUEUE SUB-COMMAND             ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
LOOKUP   DS    0H                  FIND QUE SUB-COMMAND IN TABLE  ONL02
         LA    R2,TABLE            ADDR OF SUB-COMMAND TABLE      ONL02
         TM    QFLAG2,Q2SYSJOB     SJOB COMMAND ENTERED           DOR
         BZ    NEXT                STANDARD TABLE FOR QUEUE
         LA    R2,TABLESJ          ADDR OF SUB-COMMAND TABLE      ONL02
         SPACE 1                                                  ONL02
NEXT     CLC   0(4,R2),QSUBNAME    COMPARE FIRST 4 CHARACTERS     UF014
         BE    FOUND               THIS IS THE ONE
         LA    R2,12(R2)           NEXT ENTRY                     UF014
         CLI   0(R2),X'FF'         IS THIS THE END OF TABLE?
         BNE   NEXT                NO. TRY NEXT ENTRY.
         SPACE 1                                                  ONL02
FOUND    DS    0H                  SUB-CMD FOUND OR END OF TABLE  ONL02
         MVC   QSUBCMD,4(R2)       SET SUB-COMMAND ADDR FROM TABLEONL02
         MVC   QCODEH,8(R2)        SET FUNCTION CODE FROM TABLE   ONL02
         MVC   QASCFLGS,10(R2)     SET TYPE FLAGS FROM TABLE      ONL02
         MVC   QASCUSER,11(R2)     SET USER FLAGS FROM TABLE      ONL02
         SPACE 2                                                  ONL02
         AIF   (NOT &QWTO).NOWTO
******************************************************************DOR
*
*   PERFORM A TOUBLESHOOTING PROBLEM BY ISSUE MSG TO SYSLOG
*
******************************************************************
         USING  QDQTTY,R2
         L     R2,QVDQTTY
         MVC   CHGWTO(WTOLEN),QUEWTO
         MVC   USERIDX(3),QLOGON
         MVC   CHGCMD(4),QSUBNAME
         WTO   MF=(E,CHGWTO)            DO IT
         DROP  R2
.NOWTO   ANOP
         SPACE 2                                                  ONL02
         AIF   (NOT &QISPF2).NOXTUTR
         BAL   R15,LOOKTU          LOOK FOR TUTORIAL PANEL
.NOXTUTR ANOP
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AN AUTHORIZATION CHECK AND RETURN TO PROCESS COMMAND  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAPARSE           PERFORM AUTHORIZATION CHECK    ONL02
         SPACE 1                                                  ONL02
         QSTOP ,                   RETURN TO PROCESS COMMAND      ONL02
         EJECT ,                                                  ONL02
         AIF   (NOT &QISPF2).NOLTUTR
******************************************************************  DOR
*                                                                   DOR
*   PERFORM A TABLE LOOK UP FOR THE QUEUE SUB-COMMAND TUTORIAL      DOR
*                                                                   DOR
******************************************************************  DOR
         SPACE 1                                                    DOR
LOOKTU   DS    0H                  FIND QUE SUB-COMMAND IN TABLE    DOR
         USING  QDQTTY,R1
         L     R1,QVDQTTY
         LA    R2,TUTRTABL         ADDR OF SUB-COMMAND TABLE        DOR
         LA    R3,QSUBNAME         OPERAND
         SPACE 1                                                    DOR
NEXTTU   CLC   0(4,R2),0(R3)       COMPARE FIRST 4 CHARACTERS       DOR
         BE    FOUNDTU             THIS IS THE ONE                  DOR
         LA    R2,12(R2)           NEXT ENTRY                       DOR
         CLI   0(R2),X'FF'         IS THIS THE END OF TABLE?        DOR
         BNE   NEXTTU              NO. TRY NEXT ENTRY.              DOR
         SPACE 1                                                    DOR
FOUNDTU  DS    0H                  SUB-CMD FOUND OR END OF TABLE   DOR
         MVC   QDHELP,4(R2)       LOAD NAME OF TUTORIAL PANEL      DOR
         BR    R15
         DROP  R1
.NOLTUTR ANOP
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   TABLE OF QUEUE SUB-COMMANDS                                   ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
TABLESJ  DS    0F                  QUE SUB-COMMAND COMMAND TABLE  DOR05
         QSCE  FIND,SYSJOB,FNC=4           FIND                   DOR05
         QSCE  FALL,SYSJOB,FNC=4           FIND ALL               DOR05
         QSCE  FA,SYSJOB,FNC=4             FIND ALL               DOR05
         QSCE  F,SYSJOB,FNC=4              FIND                   DOR05
         QSCE  FTIM,SYSJOB,FNC=8           FTIME (SYSLOG)         DOR05
         QSCE  FT,SYSJOB,FNC=8             FTIME (SYSLOG)         DOR05
         QSCE  COL,SYSJOB,FNC=12           COLUMN                 DOR05
         QSCE  CO,SYSJOB,FNC=12            COLUMN                 DOR05
         QSCE  C,SYSJOB,FNC=12             COLUMN                 DOR05
         QSCE  '@',SYSJOB,FNC=16           SYSJOB TO RECORD NUMBERDOR05
         QSCE  MD,SYSJOB,FNC=16            REPOS TO RECORD NUMBER DOR05
         QSCE  '+',SYSJOB,FNC=20           DOWN                   DOR05
         QSCE  D,SYSJOB,FNC=20             DOWN                   DOR05
         QSCE  PF,SYSJOB,FNC=20            PAGE FORWARD           DOR05
         QSCE  HF,SYSJOB,FNC=20            HALF PAGE FORWARD      DOR05
         QSCE  '-',SYSJOB,FNC=24           UP                     DOR05
         QSCE  UP,SYSJOB,FNC=24            UP                     DOR05
         QSCE  PB,SYSJOB,FNC=24            PAGE BACK              DOR05
         QSCE  HB,SYSJOB,FNC=24            HALF BACK              DOR05
         QSCE  TOP,SYSJOB,FNC=28           TOP                    DOR05
         QSCE  T,SYSJOB,FNC=28             TOP                    DOR05
         QSCE  BOTT,SYSJOB,FNC=32          BOTTOM                 DOR05
         QSCE  BOT,SYSJOB,FNC=32           BOTTOM                 DOR05
         QSCE  B,SYSJOB,FNC=32             BOTTOM                 DOR05
         QSCE  MODE,SYSJOB,FNC=36          MODEL                  DOR05
         QSCE  MO,SYSJOB,FNC=36            MODEL                  DOR05
         QSCE  M,SYSJOB,FNC=36             MODEL                  DOR05
         QSCE  NEXT,SYSJOB,FNC=40          NEXT DATASET           DOR05
         QSCE  NX,SYSJOB,FNC=40            NEXT DATASET           DOR05
         QSCE  N,SYSJOB,FNC=40             NEXT DATASET           DOR05
TABLE    DS    0F                  QUE SUB-COMMAND COMMAND TABLE  ONL02
         QSCE  SJOB,SYSJOB,FNC=0           LIST ALL SPOOL DSETS   DOR05
         QSCE  STAT,SEARCH                 STATUS                 ONL02
         QSCE  ST,SEARCH                   STATUS                 ONL02
         QSCE  DD,DDNAME2                  LIST DSID'S FOR A JOB  ONL02
         QSCE  CC,LIST                LIST SYSIN/SYSOUT FILE BY CC DOR
         QSCE  OP,DOPTION                OP JOB  DOR
         QSCE  OPT,DOPTION                OP JOB  DOR
         QSCE  LIST,LIST                   LIST SYSIN/SYSOUT FILE ONL02
         QSCE  L,LIST                      LIST SYSIN/SYSOUT FILE ONL02
         QSCE  FIND,REPOS,FNC=4            FIND                   ONL02
         QSCE  FALL,REPOS,FNC=4            FIND ALL               ONL02
         QSCE  FA,REPOS,FNC=4              FIND ALL               ONL02
         QSCE  F,REPOS,FNC=4               FIND                   ONL02
         QSCE  FTIM,REPOS,FNC=8            FTIME (SYSLOG)         ONL02
         QSCE  FT,REPOS,FNC=8              FTIME (SYSLOG)         ONL02
         QSCE  COL,REPOS,FNC=12            COLUMN                 ONL02
         QSCE  CO,REPOS,FNC=12             COLUMN                 ONL02
         QSCE  C,REPOS,FNC=12              COLUMN                 ONL02
         QSCE  '@',REPOS,FNC=16            REPOS TO RECORD NUMBER ONL02
         QSCE  MD,REPOS,FNC=16             REPOS TO RECORD NUMBER ONL02
         QSCE  '+',REPOS,FNC=20            DOWN                   ONL02
         QSCE  D,REPOS,FNC=20              DOWN                   ONL02
         QSCE  PF,REPOS,FNC=20             PAGE FORWARD           ONL02
         QSCE  HF,REPOS,FNC=20             HALF PAGE FORWARD      ONL02
         QSCE  '-',REPOS,FNC=24            UP                     ONL02
         QSCE  UP,REPOS,FNC=24             UP                     ONL02
         QSCE  PB,REPOS,FNC=24             PAGE BACK              ONL02
         QSCE  HB,REPOS,FNC=24             HALF BACK              ONL02
         QSCE  TOP,REPOS,FNC=28            TOP                    ONL02
         QSCE  T,REPOS,FNC=28              TOP                    ONL02
         QSCE  BOTT,REPOS,FNC=32           BOTTOM                 ONL02
         QSCE  BOT,REPOS,FNC=32            BOTTOM                 ONL02
         QSCE  B,REPOS,FNC=32              BOTTOM                 ONL02
         QSCE  MODE,REPOS,FNC=36           MODEL                  ONL02
         QSCE  MO,REPOS,FNC=36             MODEL                  ONL02
         QSCE  M,REPOS,FNC=36              MODEL                  ONL02
         QSCE  SAVE,SAVE,FNC=4             SAVE CURRENT FILE      ONL02
         QSCE  SPIN,CSPIN,FNC=4            SPIN CURRENT FILE      ONL02
         QSCE  SJ,SYSJOB                   LIST ALL SPOOL DSETS   ONL02
         QSCE  JCL,JCL                     LIST JCL               ONL02
         QSCE  JC,JCL                      LIST JCL               ONL02
         QSCE  JLOG,JLOG                   LIST JOBLOG            ONL02
         QSCE  JL,JLOG                     LIST JOBLOG            ONL02
         QSCE  JMSG,JMSG                   LIST SYSMSGS           ONL02
         QSCE  JM,JMSG                     LIST SYSMSGS           ONL02
         QSCE  JH,CJHIST                   LIST JOB HISTORY       ONL02
         QSCE  JHIS,CJHIST                 LIST JOB HISTORY       ONL02
         QSCE  PFK,CPFK                    PFK LIST/CHANGE CMD    ONL02
         QSCE  PDDB,CPDDB                  LIST PDDB'S FOR JOB    ONL02
         QSCE  DA,SEARCH,FNC=4,TYPE=QASXACTV  DISP ALL IN EXEC    ONL02
         QSCE  DC,ACTIVE,TYPE=QASXACTV     DISP CPU BATCH/STC/TSO ONL02
         QSCE  ROUT,ROUTE               ROUTE JOB  DOR
         QSCE  RTE,ROUTE               ROUTE JOB  DOR
         QSCE  FO,SEARCH,FNC=56,TYPE=QASXBLOG       DOR
         QSCE  DI,SEARCH,FNC=8,            DISP ALL IN INPUT CLASSONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  DO,SEARCH,FNC=12,           DISP ALL IN OUTPUT CLASONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  WO,SEARCH,FNC=52,           OUTPUT QUEUE W/ WTRID  ONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  AI,SEARCH,FNC=16,           DISP ALL AVAIL FOR EXECONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  AO,SEARCH,FNC=20,           DISP ALL AVAIL OUTPUT  ONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  HI,SEARCH,FNC=24,           DISP ALL IN INPUT HOLD ONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  HO,SEARCH,FNC=28,           DISP ALL IN OUTPUT HOLDONL02X
               TYPE=QASXBLOG                                      ONL02
         QSCE  DT,SEARCH,FNC=32,TYPE=QASXACTV  DISP TSO USERS     ONL02
         QSCE  DJ,SEARCH,FNC=36            DISPLAY JOB            ONL02
         QSCE  DS,SEARCH,FNC=40,TYPE=QASXSLOG  DISPLAY STC        ONL02
         QSCE  DQ,SEARCH,FNC=44,TYPE=QASXBLOG  DISP INPUT QUEUES  ONL02
         QSCE  DF,SEARCH,FNC=48,TYPE=QASXBLOG  DISP OUTPUT QUEUES ONL02
         QSCE  DELE,SYSOUT,TYPE=QASXSSSM   DELETE JOB             ONL07
         QSCE  DEL,SYSOUT,TYPE=QASXSSSM    DELETE JOB             ONL02
         QSCE  DE,SYSOUT,TYPE=QASXSSSM     DELETE JOB             ONL02
         QSCE  REQ,SYSOUT,FNC=4,TYPE=QASXSSSM  REQUEUE JOB        ONL02
         QSCE  RE,SYSOUT,FNC=4,TYPE=QASXSSSM  REQUEUE JOB         ONL02
         QSCE  CANC,SYSOUT,FNC=8,TYPE=QASXSSSM  CANCEL JOB        ONL07
         QSCE  CAN,SYSOUT,FNC=8,TYPE=QASXSSSM  CANCEL JOB         ONL02
         QSCE  CA,SYSOUT,FNC=8,TYPE=QASXSSSM  CANCEL JOB          ONL02
         QSCE  CSYS,CSYS,FNC=4,TYPE=QASXSYSP  CONSOLE CMD   DOR01
         QSCE  CS,CSYS,FNC=4,TYPE=QASXSYSP  CONSOLE CMD   DOR01
         AIF   (NOT &QISPF).NOISPF
         QSCE  TAPE,DTAPE,TYPE=QASXSYSP  TAPE CMD   DOR02
         QSCE  TA,DTAPE,TYPE=QASXSYSP  TAPE CMD   DOR02
         AIF   (NOT &QSYSP).NOSYSP
*        BELOW COMMANDS ARE FOR SYSTEMS PROGRAMMERS
         QSCE  XU,DUMP,TYPE=QASXSYSP  DUMP CMD   DOR01
         QSCE  SU,SUINFO,TYPE=QASXSYSP  TAPE CMD   DOR02
         QSCE  JOBS,JOBS,TYPE=QASXSYSP  JOBS CMD   DOR02
         QSCE  JO,JOBS,TYPE=QASXSYSP  JOBS CMD   DOR02
         QSCE  FR,STORAGE,TYPE=QASXSYSP   STORAGE CMD   DOR02
         QSCE  SA,SAUGAGE,TYPE=QASXSYSP   SAUGAGE CMD   DOR03
         QSCE  PM,PAGEMON,TYPE=QASXSYSP   PAGEMON CMD   DOR03
         QSCE  AM,ACTMON,TYPE=QASXSYSP   ACTMON CMD   DOR03
         QSCE  XM,EXCPMON,TYPE=QASXSYSP   EXCPMON CMD   DOR03
         QSCE  DM,DEVMON,TYPE=QASXSYSP   DEVMON CMD   DOR03
         QSCE  CM,CHANMON,TYPE=QASXSYSP   CHANMON CMD   DOR03
         QSCE  MPL,DOMAIN,TYPE=QASXSYSP   DOMAIN CMD   DOR03
         QSCE  MP,DOMAIN,TYPE=QASXSYSP   DOMAIN CMD   DOR03
         QSCE  SPM,STCMAP,TYPE=QASXSYSP   STCMAP CMD   DOR03
         QSCE  SP,STCMAP,TYPE=QASXSYSP   STCMAP CMD   DOR03
         QSCE  ASID,ASID,TYPE=QASXSYSP  ASID CMD   DOR01
         QSCE  AS,ASID,TYPE=QASXSYSP  ASID CMD   DOR01
         QSCE  ACSA,ASIDCSA,TYPE=QASXSYSP  ASIDCSA CMD   DOR04
         QSCE  AC,ASIDCSA,TYPE=QASXSYSP  ASIDCSA CMD   DOR04
         QSCE  VSM,VSM,TYPE=QASXSYSP  VSM  CMD   DOR04
         QSCE  VS,VSM,TYPE=QASXSYSP  VSM  CMD   DOR04
         QSCE  SRM,SRM,TYPE=QASXSYSP  SRM CMD   DOR01
         QSCE  SR,SRM,TYPE=QASXSYSP  SRM CMD   DOR01
         QSCE  CZAP,COREZAP,TYPE=QASXSYSP  CZAP CMD   DOR01
         QSCE  CZ,COREZAP,TYPE=QASXSYSP  CZAP CMD   DOR01
         QSCE  ALLO,DEVIREQ,TYPE=QASXSYSP  ALLOC  CMD   DOR01
         QSCE  AL,DEVIREQ,TYPE=QASXSYSP       ALLOC CMD   DOR01
*        QSCE  AENQ,ENQ,TYPE=QASXSYSP  AENQ  CMD   DOR01 ENQPGM2
*        QSCE  AE,ENQ,TYPE=QASXSYSP  AENQ  CMD   DOR01 EMQPGM2
* ABEND  QSCE  LENQ,ENQLOAD1,TYPE=QASXSYSP  LENQ  CMD   DOR01
*  "     QSCE  LE,ENQLOAD1,TYPE=QASXSYSP  LENQ  CMD   DOR01
.NOSYSP   ANOP
.NOISPF   ANOP
         QSCE  TSO,CTSO,TYPE=QASXEXEC      ISSUE ANY TSO COMMAND  ONL02
         QSCE  EX,CTSO,TYPE=QASXEXEC       IMPLICIT CLIST INVOKE  ONL02
         QSCE  EXEC,CTSO,TYPE=QASXEXEC     IMPLICIT CLIST INVOKE  ONL02
         QSCE  SLOG,SYSLOG,TYPE=QASXSLOG   LIST THE SYSTEM LOG    ONL02
         QSCE  SL,SYSLOG,TYPE=QASXSLOG     LIST THE SYSTEM LOG    ONL02
         QSCE  XI,INITS,TYPE=QASXSYSP      DISP ACTIVE INITS      ONL02
         QSCE  XB,HEXBLK,TYPE=QASXSYSP     DISP SPOOL BLOCK       ONL02
         QSCE  XJ,SEARCH,FNC=36,TYPE=QASXSYSP  DISP HEX JQE/JOE   ONL02
         QSCE  XD,XDS,TYPE=QASXSYSP        UNRESTRICTED FILE DISP ONL02
         QSCE  XP,HELP,TYPE=QASXOPER       ENTER PASSWORD         ONL02
         QSCE  JQE,CJQE,TYPE=QASXSYSP      HEX DUMP OF JQE        ONL02
         QSCE  JCT,CJCT,TYPE=QASXSYSP      HEX DUMP OF JCT        ONL02
         QSCE  IOT,CIOT,TYPE=QASXSYSP      HEX DUMP OF IOTS          CL
         QSCE  HCT,CHCT,TYPE=QASXSYSP      HEX DUMP OF HCT SAVEAREONL02
         QSCE  JOE,CJOE,TYPE=QASXSYSP      HEX DUMP OF JOE        ONL02
         QSCE  TGPS,CTGPS,TYPE=QASXSYSP    LIST LARGE SPOOL USERS ONL02
         QSCE  DIE,CDIE,TYPE=QASXSYSP      FORCE 0C1 PROGRAM CHECKONL02
         SPACE 1                                                  ONL02
HELPCC   DC    F'-1',V(HELP),Y(0),AL1(0,0) MARK END OF TABLE      ONL02
         EJECT ,                                                  ONL02
         AIF  (NOT &QISPF2).NOTUTR
         PUSH  PRINT               SAVE CURRENT PRINT STATUS      ONL02
         PRINT NOGEN               DON'T PRINT #H MACRO EXPANSIONSONL02
         SPACE 1                                                  ONL02
*                                                               DOR1187
TUTRTABL DS    0C                  START OF HELP TABLE          DOR1187
         SPACE 1                                                DOR1187
    QSCH AI,TQIAI001                                            DOR1187
    QSCH ALLOC,TQIAL001                                         DOR1187
    QSCH AL,TQIAL001                                            DOR1187
    QSCH AM,TQIAM001                                            DOR1187
    QSCH AO,TQIAO001                                            DOR1187
    QSCH ASID,TQIAS001                                          DOR1187
    QSCH AS,TQIAS001                                            DOR1187
    QSCH BOTT,TQIB001                                           DOR1187
    QSCH BOT,TQIB001                                            DOR1187
    QSCH B,TQIB001                                              DOR1187
    QSCH CANCEL,TQICA001                                        DOR1187
    QSCH CAN,TQICA001                                           DOR1187
    QSCH CA,TQICA001                                            DOR1187
    QSCH CC,TQICC001                                            DOR1187
    QSCH CSYS,TQICS001                                          DOR1187
    QSCH CS,TQICS001                                            DOR1187
    QSCH CM,TQICM001                                            DOR1187
    QSCH COL,TQICO001                                           DOR1187
    QSCH CO,TQICO001                                            DOR1187
    QSCH C,TQICO001                                             DOR1187
    QSCH CZAP,TQICZ001                                          DOR1187
    QSCH DA,TQIDA001                                            DOR1187
    QSCH DD,TQIDD001                                            DOR1187
    QSCH DC,TQIDC001                                            DOR1187
    QSCH D,TQID001                                              DOR1187
    QSCH DELE,TQIDE001                                          DOR1187
    QSCH DEL,TQIDE001                                           DOR1187
    QSCH DE,TQIDE001                                            DOR1187
    QSCH DIE,TQIDIE01                                           DOR1187
    QSCH DI,TQIDI001                                            DOR1187
    QSCH DO,TQIDO001                                            DOR1187
    QSCH DT,TQIDT001                                            DOR1187
    QSCH DJ,TQIDJ001                                            DOR1187
    QSCH DQ,TQIDQ001                                            DOR1187
    QSCH DS,TQIDS001                                            DOR1187
    QSCH DF,TQIDF001                                            DOR1187
    QSCH DM,TQIDM001                                            DOR1187
    QSCH EXEC,TQIEX001                                          DOR1187
    QSCH FALL,TQIFA001                                          DOR1187
    QSCH FA,TQIFA001                                            DOR1187
    QSCH FIND,TQIF001                                           DOR1187
    QSCH F,TQIF001                                              DOR1187
    QSCH FORMS,TQIFO001                                         DOR1187
    QSCH FO,TQIFO001                                            DOR1187
    QSCH FRAME,TQIFR001                                         DOR1187
    QSCH FR,TQIFR001                                            DOR1187
    QSCH FTIME,TQIFT001                                         DOR1187
    QSCH FTIM,TQIFT001                                          DOR1187
    QSCH FT,TQIFT001                                            DOR1187
    QSCH H,TQTOPICS                                             DOR1187
    QSCH HB,TQIHB001                                            DOR1187
    QSCH HCT,TQIHCT01                                           DOR1187
    QSCH HF,TQIHF001                                            DOR1187
    QSCH HI,TQIHI001                                            DOR1187
    QSCH HO,TQIHO001                                            DOR1187
    QSCH I,TQINDEXA                                             DOR1187
    QSCH IOT,TQIIOT01                                           DOR1187
    QSCH JOBS,TQIJO001                                          DOR1187
    QSCH JO,TQIJO001                                            DOR1187
    QSCH JCL,TQIJC001                                           DOR1187
    QSCH JC,TQIJC001                                            DOR1187
    QSCH JLOG,TQIJL001                                          DOR1187
    QSCH JL,TQIJL001                                            DOR1187
    QSCH JMSG,TQIJM001                                          DOR1187
    QSCH JM,TQIJM001                                            DOR1187
    QSCH JHIS,TQIJH001                                          DOR1187
    QSCH JH,TQIJH001                                            DOR1187
    QSCH JCT,TQIJCT01                                           DOR1187
    QSCH JOE,TQIJOE01                                           DOR1187
    QSCH JQE,TQIJQE01                                           DOR1187
    QSCH LIST,TQIL001                                           DOR1187
    QSCH L,TQIL001                                              DOR1187
    QSCH MD,TQIMD001                                            DOR1187
    QSCH MODE,TQIMO001                                          DOR1187
    QSCH MO,TQIMO001                                            DOR1187
    QSCH M,TQIMO001                                             DOR1187
    QSCH MPL,TQIMP001                                           DOR1187
    QSCH MP,TQIMP001                                            DOR1187
    QSCH NEXT,TQINX001                                          DOR1187
    QSCH NX,TQINX001                                            DOR1187
    QSCH N,TQINX001                                             DOR1187
    QSCH OPT,TQIOP001                                           DOR1187
    QSCH OP,TQIOP001                                            DOR1187
    QSCH PDDB,TQIPDDB1                                          DOR1187
    QSCH PB,TQIPB001                                            DOR1187
    QSCH PF,TQIPF001                                            DOR1187
    QSCH PFK,TQIPFK01                                           DOR1187
    QSCH PM,TQIPM001                                            DOR1187
    QSCH REQ,TQIRE001                                           DOR1187
    QSCH RE,TQIRE001                                            DOR1187
    QSCH ROUT,TQIROUT1                                          DOR1187
    QSCH RTE,TQIROUT1                                           DOR1187
    QSCH SAVE,TQISAVE1                                          DOR1187
    QSCH SA,TQISA001                                            DOR1187
    QSCH SJOB,TQISJ001                                          DOR1187
    QSCH SJ,TQISJ001                                            DOR1187
    QSCH SLOG,TQISL001                                          DOR1187
    QSCH SL,TQISL001                                            DOR1187
    QSCH SPIN,TQISPIN1                                          DOR1187
    QSCH SPA,TQISPA01                                           DOR1187
    QSCH SRM,TQISR001                                           DOR1187
    QSCH SR,TQISR001                                            DOR1187
    QSCH SU,TQISU001                                            DOR1187
    QSCH STATUS,TQIST001                                        DOR1187
    QSCH STAT,TQIST001                                          DOR1187
    QSCH ST,TQIST001                                            DOR1187
    QSCH TAPE,TQITA001                                          DOR1187
    QSCH TA,TQITA001                                            DOR1187
    QSCH TGPS,TQITGPS1                                          DOR1187
    QSCH TOP,TQITOP1                                            DOR1187
    QSCH T,TQITOP1                                              DOR1187
    QSCH UP,TQIUP001                                            DOR1187
    QSCH WO,TQIWO001                                            DOR1187
    QSCH VS,TQIVS001                                            DOR1187
    QSCH VSM,TQIVS001                                           DOR1187
    QSCH XB,TQIXB001                                            DOR1187
    QSCH XD,TQIXD001                                            DOR1187
    QSCH XI,TQIXI001                                            DOR1187
    QSCH XJ,TQIXJ001                                            DOR1187
    QSCH XM,TQIXM001                                            DOR1187
    QSCH XP,TQIXP001                                            DOR1187
    QSCH XU,TQIXU001                                            DOR1187
    QSCH -,TQIUP001                                             DOR1187
    QSCH @,TQIMD001                                             DOR1187
    QSCH +,TQID001                                              DOR1187
    QSCH 1,TQIT001                                              DOR1187
    QSCH 2,TQIT002                                              DOR1187
    QSCH 3,TQIT003                                              DOR1187
    QSCH 4,TQIT004                                              DOR1187
    QSCH 5,TQIT005                                              DOR1187
    QSCH 6,TQIT006                                              DOR1187
    QSCH 7,TQIT007                                              DOR1187
    QSCH 8,TQIT008                                              DOR1187
    QSCH 9,TQIT009                                              DOR1187
    QSCH 10,TQIT010                                             DOR1187
    QSCH 11,TQIT011                                             DOR1187
TUTRCC   DC  XL4'FFFFFFFF',CL8'TQINDEX1'       MARK END OF TABLEDOR1187
         POP   PRINT               RESTORE PRINT STATUS           ONL02
.NOTUTR    ANOP
         EJECT ,                                                  ONL02
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         AIF (NOT &QWTO).NOWTOX
         DS    0F
         AIF (NOT &QISPF).NOISPFX
QUEWTO   WTO   'UUU QISPF CMD: XXXX          ',                        X
               MF=L,DESC=4,ROUTCDE=(2,10)
WTOEND   EQU   *
WTOLEN   EQU   WTOEND-QUEWTO
         AGO   .NOWTOX
.NOISPFX ANOP
QUEWTO   WTO   'UUU QUEUE CMD: XXXX          ',                        X
               MF=L,DESC=4,ROUTCDE=(2,10)
WTOEND   EQU   *
WTOLEN   EQU   WTOEND-QUEWTO
.NOWTOX  ANOP
         LTORG
WPASS    DC    X'C1115D7F1140403C4040001D4C13'  *** SPF TCAM
         SPACE 1                                                  UF024
WORK     DSECT
         DS    CL72
OFFSET   DS    H
LENGTH   DS    H
FIELD    DS    CL8
RPASS    DS    CL8
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=PRINT
PRINT    TITLE 'QUEUE COMMAND - PRINT SCREEN DISPLAY ROUTINE'     ONL01
PRINT    QSTART ,                  START PRINT CSECT ASSEMBLY     ONL01
***********************************************************************
* RNB CHANGES:                                                        *
*      (1) RNB10 - CHANGE DEFAULT SYSOUT CLASS TO C (IF QRNB=1)       *
***********************************************************************
         GBLB  &QRNB                                              RNB10
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA       FCI*
         L     R10,QVDSPL     LOAD BASE REG                        FCI*
         USING QCPRINT,R9     BASE REG FOR PRINT WORK AREA         FCI*
         L     R9,QVPRINT     LOAD BASE REGISTER                   FCI*
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA         FCI*
***********************************************************************
*   PROCESS THE PRINT COMMAND                                      FCI*
***********************************************************************
STARTIT  BAL   R7,PARSECMD    GO PARSE THE PRINT COMMAND           FCI*
         CLC   =C'ON',QPPARM1 IS IT ON?                            FCI*
         BE    STARTPRT         YES..GO START IT                   FCI*
         CLC   =C'OFF',QPPARM1 IS PRINT OFF?                       FCI*
         BE    STOPPRT          YES..GO STOP IT                    FCI*
         CLI   QPPARM1,C' '   NO PARM?                             FCI*
         BE    STARTPRT         YES..ASSUME START                  FCI*
STOP     MVC   QDREPLY,QBLANK   KISS OFF OUR REPLY  (SNEAKY)       FCI*
         XC    QDRLNG,QDRLNG    AND SAY NOBODY HOME                FCI*
         QSTOP                                                     FCI*
         EJECT ,                                                   FCI*
***********************************************************************
*   START (OR CONTINUE) THE PRINT PROCESS                          FCI*
***********************************************************************
STARTPRT DS 0H                                                     FCI*
         TM    QPFLAG,HARDCPY  IS HARDCOPY ON                      FCI*
         BO    JUSTPRT         YES..JUST PRINT                     FCI*
         ZAP   QPPAGE,=P'0'    RESET PAGE NUMBER                   FCI*
         MVI   QPHEAD1,C'0'    AND ASA ON HEADING SO WELL START FRESH
         BAL   R7,ALLOCHC      GO ALLOCATE / OPEN HARDCOPY         FCI*
JUSTPRT  BAL   R7,GETTIME      GO GET DATE AND TIME                FCI*
         MVC   QPUSER,QLOGON   MOVE IN USERID                      FCI*
         MVC   QPDATE,JDATE    MOVE IN DATE TIME INFO              FCI*
         MVC   QPPAGE#,QBLANK     CLEAR OUT PAGE # FIELD           FCI*
         XC    QPHEAD1(1),=X'01'  TOGGLE ASA FLAG 0-1 OR 1-0       FCI*
         CLI   QPHEAD1,C'1'    EJECT NOW SCHEDULED?                FCI*
         BNE   NOPAGE             NO..SKIP PAGE SETTING            FCI*
*                                                                  FCI*
         AP    QPPAGE,=P'1'    BUMP PAGE COUNT                     FCI*
         MVC   QPPAGE#,=X'402020202021'  MOVE IN MASK              FCI*
         ZAP   DBLWORK,QPPAGE  MOVE INTO AREA                      FCI*
         ED    QPPAGE#,DBLWORK+5   EDIT IN PAGE NUMBER             FCI*
NOPAGE   PUT   HASPPRNT,QPHEAD1  PUT OUT TITLE LINE                FCI*
         PUT   HASPPRNT,QPHEAD2  PUT OUT '-' LINE                  FCI*
*                                                                  FCI*
         MVC   QPLINE,QBLANK                   RECONSTRUCT IMAGE   FCI*
         MVC   QPLINE(15),=C'QUEUE COMMAND -'    OF HEADER LINE    FCI*
         MVC   QPLINE+16(L'QPRSAVE),QPRSAVE        WITHOUT 3270    FCI*
         PUT   HASPPRNT,QPDETAIL                      CONTROL CHARS
         EJECT ,                                                   FCI*
*                                                                  FCI*
*  PUT OUT ENTIRE SCREEN OF DETAIL LINES (BLANK OR NOT)            FCI*
*                                                                  FCI*
         MVC   QPLINE(80),QDHLINE MOVE HEADING LINE TO BUFFER     UF003
         PUT   HASPPRNT,QPDETAIL PRINT THE LINE                   UF003
         LH    R3,QDSCRLEN       SIZE OF SCREEN                   UF003
         SR    R2,R2             CLEAR FOR DIVIDE                 UF003
         LH    R7,QDLNELEN       LINE LENGTH                      UF003
         DR    R2,R7             NUMBER OF LINES                  UF003
         BCTR  R7,0              DROP LINE LEN FOR EXECUTES       UF003
         LA    R2,QDLINE1        LOAD ADDRESS OF FIRST LINE       UF003
PUTLOOP  EX    R7,PUTMVC         MOVE LINE TO BUFFER              UF003
         PUT   HASPPRNT,QPDETAIL PUT DETAIL LINE LOUT              FCI*
         LA    R2,1(R2,R7)       POINT TO NEXT LINE               UF003
         BCT   R3,PUTLOOP        AND GRIND THE SCREEN THROUGH      FCI*
*                                                                  FCI*
         MVC   QPLINE,QBLANK                   RECONSTRUCT IMAGE   FCI*
         MVC   QPLINE(07),=C'REPLY -'            OF COMMAND LINE   FCI*
         MVC   QPLINE+08(L'QDREPLY),QDREPLY        WITHOUT 3270    FCI*
         MVC   QPLINE+72(1),QDPLUS                   CONTROL CHARS FCI*
         PUT   HASPPRNT,QPDETAIL                       AND PRINT IT
*                                                                  FCI*
         MVI   QPDETAIL,C'-'       TRIPLE SPACE A BLANK LINE       FCI*
         MVC   QPLINE,QBLANK                                       FCI*
         PUT   HASPPRNT,QPDETAIL   AND PRINT IT                    FCI*
         MVI   QPDETAIL,C' '       RESTORE TO SINGLE SPACE         FCI*
*                                                                  FCI*
         MVC   QDTLINE+L'QDTLINE-L'PRTMSG-1(L'PRTMSG),PRTMSG       FCI*
GOTMSG   LA    R1,0               SET A ZERO                       FCI*
         L     R2,4(R13)              RETURN CODE                  FCI*
         ST    R1,16(R2)                  IN REGISTER 15 (SAVED)   FCI*
         B     STOP                                                FCI*
         SPACE 2                                                   FCI*
PUTMVC   MVC   QPLINE(*-*),0(R2)  EXECUTED MOVE                   UF003
PRTMSG   DC    C'SCREEN PRINTED'                                   FCI*
         EJECT ,                                                   FCI*
***********************************************************************
*   STOP PRINT PROCESS AND FREE HASPPRNT DDNAME                    FCI*
***********************************************************************
STOPPRT  TM    QPFLAG,HARDCPY             IS HARDCPY ON            FCI*
         BNO   STOP                       NOPE..NO WORK TO DO      FCI*
         LA    R2,HASPPRNT          BUILD                          FCI*
         LA    R1,DBLWORK                   LIST                   FCI*
         MVI   DBLWORK,X'80'              LAST ENTRY IN LIST       FCI*
         CLOSE ((2)),MF=(E,(1))           CLOSE OFF THE FILE       FCI*
         FREEPOOL (2)                     FREE THE BUFFERS TOO     FCI*
         MVC   DYNALLOC(F99LEN),F99PTR   COPY DYN FREE LIST        FCI*
         LA    R1,FREERB          RELOCATE THE LIST ADDRESSES.     FCI*
         STCM  R1,B'0111',FREEPTR+1   *                            FCI*
         LA    R1,FREETXPT            *                            FCI*
         ST    R1,FREETPTR            *                            FCI*
         LA    R1,FREETU1             *                            FCI*
         STCM  R1,B'0111',FREETXPT+1  *                            FCI*
         LA    R1,FREETU2             *                            FCI*
         STCM  R1,B'0111',FREETXPT+5  *                            FCI*
         LA    R1,FREEPTR                                          FCI*
         DYNALLOC                                                  FCI*
         NI    QPFLAG,255-HARDCPY    TURN OFF PRINT FLAG           FCI*
         MVC   QDTLINE+L'QDTLINE-L'PRTSTP-1(L'PRTSTP),PRTSTP       FCI*
         B     GOTMSG                                              FCI*
PRTSTP   DC    C'PRINT STOPPED; SYSOUT FREED FOR PRINT'            FCI*
         EJECT ,                                                   FCI*
***********************************************************************
*                                                                  FCI*
*   PARSE PRINT COMMAND                                            FCI*
*                                                                  FCI*
***********************************************************************
PARSECMD LH    R2,QDRLNG      LENGTH OF REPLY LINE                 FCI*
         OC    QDREPLY,QBLANK TRANSLATE TO UPPER CASE              FCI*
         CLC   QDREPLY,QBLANK IS THE ENTIRE REPLY BLANK?           FCI*
         BER   R7             YES. NOTHING TO PARSE..RETURN        FCI*
         MVC   FIELD,QBLANK   BLANK THE WORK FIELD                 FCI*
         MVC   OFFSET(4),=F'0' ZERO THE OFFSET AND LENGTH          FCI*
         MVC   QPOFF0(12),OFFSET INITIALIZE FIRST FIELD            FCI*
         MVC   QPOFF1(48),QPOFF0 INITIALIZE NEXT FOUR FIELDS       FCI*
         LA    R6,QPOFF4+12   ADDR PAST LAST FIELD                 FCI*
         LA    R5,QPOFF0      ADDR OF FIRST SET OF FIELDS          FCI*
         LA    R3,QDREPLY     FIRST BYTE OF REPLY LINE             FCI*
ENCORE   LA    R4,FIELD       FIRST BYTE OF WORK FIELD             FCI*
BLANK    CLI   0(R3),C' '     IS THIS BYTE BLANK?                  FCI*
         BNE   FIRST          NO. START OF FIELD.                  FCI*
         LA    R3,1(R3)       YES. SKIP IT.                        FCI*
         BCT   R2,BLANK       TRY NEXT BYTE                        FCI*
         B     EMPTY          END OF REPLY LINE.                   FCI*
FIRST    LH    R1,QDRLNG      REPLY LENGTH                         FCI*
         SR    R1,R2          COMPUTE OFFSET TO START OF FIELD     FCI*
         STH   R1,OFFSET      STORE OFFSET                         FCI*
         LR    R1,R2          SAVE COUNT OF REMAINING BYTES        FCI*
         B     CHAR           CONTINUE                             FCI*
LOOP     CLI   0(R3),C' '     IS THIS BYTE BLANK?                  FCI*
         BE    LAST           YES. END OF FIELD.                   FCI*
CHAR     MVC   0(1,R4),0(R3)  MOVE BYTE TO SUBNAME                 FCI*
         LA    R3,1(R3)       INCREMENT                            FCI*
         LA    R4,1(R4)       INCREMENT                            FCI*
         BCT   R2,LOOP        TRY NEXT BYTE                        FCI*
LAST     SR    R1,R2          COMPUTE FIELD LENGTH                 FCI*
         CH    R1,=H'8'       IS LENGTH GREATER THAN 8?            FCI*
         BNH   STORE          NO. USE IT.                          FCI*
         LA    R1,8           YES. USE LENGTH OF EIGHT.            FCI*
STORE    STH   R1,LENGTH      STORE FIELD LENGTH                   FCI*
EMPTY    MVC   0(12,R5),OFFSET MOVE FIELD TO QCOMMON               FCI*
         LTR   R2,R2          IS THE REMAINING LENGTH ZERO?        FCI*
         BZR   R7             YES. FINITO OF PARSE..RETURN         FCI*
*                                                                  FCI*
         MVC   FIELD,QBLANK   BLANK THE WORK FIELD                 FCI*
         MVC   OFFSET(4),=F'0' ZERO OUT OFFSET AND LENGTH          FCI*
         LA    R5,12(R5)      INCREMENT TO NEXT FIELD              FCI*
         CR    R5,R6          WAS THAT THE LAST FIELD?             FCI*
         BL    ENCORE         NO. PROCESS NEXT FIELD.              FCI*
         EJECT ,                                                   FCI*
***********************************************************************
* GET DATE/TIME FOR HEADING   ENTER WITH BAL R7,GETTIME            FCI*
* RETURNS WITH JDATE(LEN) = YY.DDD  HH:MM:SS DAY MTH DD,19YY       FCI*
*                           123456789.123456789.123456789.123      FCI*
*                                                                  FCI*
***********************************************************************
GETTIME  TIME  DEC                                                 FCI*
         ST    R1,DATE                 SAVE DATE FOR LATER         FCI*
***FORMAT THE PRESENT TIME (AS SET BY THE OPERATOR)                FCI*
         ST    R0,DBLWORK              CNVT PACKED TO DEC          FCI*
         MVC   MONMSK(MVCLEN),XMONMSK  MOVE IN AND INITIALIZE TABLE/DAT
         MVI   DBLWORK+4,X'0F'                                     FCI*
         UNPK  WORKWORD(9),DBLWORK(5)                              FCI*
         MVC   TIMEHRS,WORKWORD        MOVE TIME TO MSG            FCI*
         MVC   TIMMINS,WORKWORD+2                                  FCI*
         MVC   TIMSECS,WORKWORD+4                                  FCI*
***FORMAT TODAY'S DATE INTO THE OUTPUT MSG                         FCI*
         MVC   WORKWORD(4),DATE        MOVE DATE TO WORK AREA.     FCI*
         MVO   WORKWORD+1(3),WORKWORD(2)   MAKE 00YYDDDS INTO 00000YYS.
         UNPK  CYR(2),WORKWORD+2(2)    FORMAT YEAR.                FCI*
         XC    DBLWORK,DBLWORK                                     FCI*
         MVC   DBLWORK+4(4),WORKWORD   CNVT YEAR TO BIN            FCI*
         CVB   R0,DBLWORK                                          FCI*
         ST    R0,BINYEAR              AND SAVE                    FCI*
         TM    BINYEAR+3,X'03'         LEAP YEAR?                  FCI*
         BNZ   MON1                    NO.                         FCI*
         MVI   MONMSK+10,29            YES, CORRECT                FCI*
MON1     XC    DBLWORK,DBLWORK         CNVT DAYS TO BIN            FCI*
         MVC   DBLWORK+6(2),DATE+2                                 FCI*
         CVB   R2,DBLWORK                                          FCI*
         ST    R2,BINDAYS              SAVE FOR LATER              FCI*
         XR    R1,R1                                               FCI*
         LA    R15,11                                              FCI*
MON2     IC    R1,MONMSK(R15)          COMPUTE MON & DAY           FCI*
         SR    R2,R1                                               FCI*
         BNP   MONOVR                                              FCI*
         BCT   R15,MON2                                            FCI*
         B     *+6                                                 FCI*
MONOVR   AR    R2,R1                   CORRECT OVERDRAW            FCI*
         CVD   R2,DBLWORK              FORMAT DAY                  FCI*
         UNPK  CDAYN(2),DBLWORK+6(2)                               FCI*
         OI    CDAYN+1,X'F0'           FIX UP SIGN                 FCI*
         MH    R15,=H'3'               GET TABLE OFFSET            FCI*
         LA    R15,MONTAB(R15)         AND POINT AT MONTH          FCI*
         MVC   CMON(3),0(R15)          MOVE IT TO THE MSG          FCI*
         EJECT ,                                                   FCI*
***DAY OF WEEK                                                     FCI*
         L     R15,BINYEAR                                         FCI*
         SH    R15,=H'69'                                          FCI*
         BNP   OUTT                    MUST BE GREATER OR BAD      FCI*
         XR    R14,R14                 CLEAR DAY REG               FCI*
         D     R14,=F'4'                                           FCI*
         MH    R15,=H'5'                                           FCI*
         AR    R14,R15                                             FCI*
         A     R14,BINDAYS                                         FCI*
         SRDA  R14,32                                              FCI*
         D     R14,=F'7'               MODULO 7 FOR WEEK           FCI*
         MH    R14,=H'3'                                           FCI*
         LA    R14,DAYTAB(R14)         POINT AT TODAY              FCI*
         MVC   CDAY(3),0(R14)          INSERT IN MSG               FCI*
***                                                                FCI*
MOVEJD   MVC   JDATE-1(7),=X'4020204B202020'                       FCI*
         ED    JDATE-1(7),DATE+1                                   FCI*
*                                                                  FCI*
DATERTN  BR    R7                      RETURN TO MAINLINE          FCI*
*                                                                  FCI*
OUTT     MVC   CDAY(3),=CL3'???'                                   FCI*
         B     MOVEJD                                              FCI*
         SPACE 2                                                   FCI*
***********************************************************************
* LEAVE FIELDS TOGETHER.. INITIALIZED BY ONE MVC WITH VALUES       FCI*
*                                                                  FCI*
XMONMSK  DC    AL1(31,30,31,30,31,31,30,31,30,31,28,31)  L         FCI*
         DC    C' XX.XXX',C'  '                          E  F      FCI*
         DC    CL2' ',C':'                               A  I  T   FCI*
         DC    CL2' ',C':'                               V  E  O   FCI*
         DC    CL2' ',C' '                               E  L  G   FCI*
         DC    CL3' ',C' '                                  D  E   FCI*
         DC    CL3' ',C' '                                  S  T   FCI*
         DC    CL2' ',C',19'                                   H   FCI*
         DC    CL2'  ',C' '                                    E   FCI*
*                                                              R   FCI*
***********************************************************************
MVCLEN   EQU   *-XMONMSK                                           FCI*
*                                                                  FCI*
***********************************************************************
DAYTAB   DC    C'TUEWEDTHRFRISATSUNMON'                            FCI*
MONTAB   DC    C'DECNOVOCTSEPAUGJULJUNMAYAPRMARFEBJAN'             FCI*
         EJECT ,                                                   FCI*
***********************************************************************
* ALLOC HARDCOPY TO HASPPRNT DDNAME                                FCI*
*                                                                  FCI*
***********************************************************************
ALLOCHC  MVC   DYNALLOC(S99LENG),S99RBPTR COPY DYN ALLOCATION LIST.
         LA    R1,P99RB           RELOCATE THE LIST ADDRESSES.     FCI*
         STCM  R1,B'0111',P99RBPTR+1  *                            FCI*
         LA    R1,P99TUPL             *                            FCI*
         ST    R1,P99TXTPP            *                            FCI*
         LA    R1,P99TUKY1            *                            FCI*
         STCM  R1,B'0111',P99TUPL+1   *                            FCI*
         LA    R1,P99TUKY2            *                            FCI*
         STCM  R1,B'0111',P99TUPL+5   *                            FCI*
         LA    R1,P99TUKY3            *                            FCI*
         STCM  R1,B'0111',P99UPLL+1   *                            FCI*
*  PROCESS PARMS..........                                         FCI*
         LH    R1,QPLNG2        GET LENGTH OF SECOND PARM          FCI*
         CH    R1,=H'1'         LENGTH OF ONE?                     FCI*
         BNE   NOCLSCHG         NO..NO CHANGE OF SYSOUT CLASS      FCI*
         CLI   QPPARM2,C'A'     IS IT ALPHA                        FCI*
         BL    NOCLSCHG                                            FCI*
         MVC   P99SYSOC,QPPARM2 MOVE IN PARM FOR SYSOUT CLASS      FCI*
NOCLSCHG CLI   QPPARM3,C' '     ANY DEST SPECIFIED                 FCI*
         BE    NODEST                                              FCI*
         MVC   P99DEST,QPPARM3  MOVE IN DEST                       FCI*
         MVC   P99DESTL,QPLNG3  MOVE IN LENGTH                     FCI*
         MVI   P99EPARM,X'00'   SAY CLASS IS NOT LAST PARM         FCI*
*  DO THE ALLOCATE                                                 FCI*
NODEST   LA    1,DYNALLOC         ADDR OF PARM LIST FOR DYNALLOC.  FCI*
         DYNALLOC                                                  FCI*
         LTR   R15,R15            CHK RETURN CODE                  FCI*
         BNZ   CANTALLC           NO CAN DO..POST MESSAGE          FCI*
         LA    R6,HASPPRNT        ADDRESS OF OUTPUT DCB.           FCI*
         USING IHADCB,R6          ADDRESSABILITY TO OUTPUT DCB.    FCI*
         LA    R1,DBLWORK         BUILD                            FCI*
         MVI   0(R1),X'80'          ONLY ENTRY IN LIST             FCI*
         OPEN  ((6),(OUTPUT)),MF=(E,(1))  OPEN THE FILE            FCI*
         TM    DCBOFLGS,X'10'     CHECK FOR SUCCESSFUL OPEN.       FCI*
         DROP  R6                 ELIMINATE DCB ADDRESSABILITY.    FCI*
         BZ    PRNTBAD            BYPASS SWITCH SETTING IF BAD OPEN.
         OI    QPFLAG,HARDCPY     INDICATE HARDCPY FILE AVAILABLE. FCI*
         MVC   QDTLINE(L'MSGSTART),MSGSTART  MOVE IN START MSG     FCI*
         MVC   M1CLASS,P99SYSOC   MOVE IN SYSOUT CLASS             FCI*
         MVC   M1DEST,P99DEST                                      FCI*
         CLI   M1DEST,C' '        ANY DEST?                        FCI*
         BNE   PRNTOKAY                                            FCI*
         MVC   M1DEST,=CL8'LOCAL' SAY LOCAL                        FCI*
         B     PRNTOKAY           BYPASS TPUT ERROR MSG.           FCI*
         EJECT ,                                                   FCI*
PRNTBAD  QTILT 'SORRY...UNABLE TO ALLOC/OPEN HASPPRNT FOR HARDCOPY'
PRNTOKAY BR    R7                 RETURN                           FCI*
         SPACE 2                                                   FCI*
MSGSTART DC    CL63'PRINT STARTED; SYSOUT=X,DEST=XXXXXXXX'         FCI*
         EJECT ,                                                   FCI*
***********************************************************************
*        FORMULATE TEXT FOR SVC99 ALLOCATE FAILURE                 FCI*
***********************************************************************
         SPACE 3                                                   FCI*
CANTALLC MVC   QDTLINE,QBLANK     CLEAR OUT LINE                   FCI*
         CLC   P99ERROR,=X'046C'  WAS IT 'RMT NOT DEF TO JES2'?    FCI*
         BE    BADRMT             YES..POST MSG AND EXIT           FCI*
*                                                                  FCI*
         MVC   QDTLINE(L'MSGERR),MSGERR                            FCI*
         CVD   R15,DBLWORK        CONVERT SVC 99 RETURN CODE       FCI*
         MVC   M2RC,=X'40202020'   TO NICE PRINTABLE DECIMAL       FCI*
         ED    M2RC,DBLWORK+6                                      FCI*
*                                                                  FCI*
         UNPK  M2ERC(5),P99ERROR(3) CONVERT DYNAM ALLOC ERR CODE   FCI*
         NC    M2ERC,HEXMASK         TO PRINTABLE HEXADECIMAL      FCI*
         TR    M2ERC,HEXTAB          AND FIX IT UP PRETTY          FCI*
         MVI   M2ERC+4,C' '                                        FCI*
*                                                                  FCI*
         UNPK  M2INFO(5),P99INFO(3) CONVERT DYNAM ALLOC INFO       FCI*
         NC    M2INFO,HEXMASK        CODE TO PRNTABLE HEX          FCI*
         TR    M2INFO,HEXTAB         AND FIX IT UP PRETTY          FCI*
         MVI   M2INFO+4,C' '                                       FCI*
         B     GOTMSG                   AND GO POST THE MESSAGE    FCI*
*                                                                  FCI*
BADRMT   MVC   QDTLINE(L'MSGNRMT),MSGNRMT  MOVE IN NO SUCH REMOTE MSG
         MVC   MREMOTE,QPPARM3         MOVE IN REMOTE ASKED FOR    FCI*
         B     GOTMSG                   AND GO POST THE MESSAGE    FCI*
         SPACE 2                                                   FCI*
HEXTAB   DC    C'0123456789ABCDEF'                                 FCI*
HEXMASK  DC    X'0F0F0F0F0F0F0F0F'                                 FCI*
MSGNRMT  DC    C'REMOTE XXXXXXXX NOT DEFINED TO JES2; PRINT BYPASSED'
MSGERR   DC    C'CANT ALLOC SYSOUT FOR PRINT; DARC= XXXX INFO= XXXX R15X
               = XXXX '                                            FCI*
***********************************************************************
         EJECT ,                                                   FCI*
         LTORG                                                     FCI*
         SPACE 2                                                   FCI*
         DS    0F                                                  FCI*
*                                          SVC 99 REQUEST BLOCK  PTR
S99RBPTR DC    X'80',AL3(S99RB)                                    FCI*
*                                          SVC 99 REQUEST BLOCK    FCI*
S99RB    DS    0F                                                  FCI*
S99RBLN  DC    AL1(20)                     LENGTH=20 BYTES         FCI*
S99VERB  DC    X'01'                       VERB CODE=01 (DSNAME ALLOC)
S99FLAG1 DC    X'1000'                     DONT USE EXISTING ALLOC FCI*
S99ERROR DC    AL2(0)                              ERROR CODE      FCI*
S99INFO  DC    AL2(0)                              INFO  CODE      FCI*
S99TXTPP DC    A(S99TUPL)                 POINTER TO TEXT UNIT POINTERS
S99RSVD1 DC    A(0)                          RESERVED              FCI*
S99FLAG2 DC    A(0)                          FLAGS 2               FCI*
S99TUPL  DC    A(S99TUKY1)                TEXT UNIT POINTERS       FCI*
S99EPARM DC    X'80',AL3(S99TUKY2)        LAST PARM IF NO DEST=    FCI*
         DC    X'80',AL3(S99TUKY3)        LAST PARM IF DEST= GIVEN FCI*
S99TUNIT DS    0F                                                  FCI*
*                                                  DDNAME=HASPPRNT FCI*
S99TUKY1 DC    X'0001',X'0001',X'0008',C'HASPPRNT'                 FCI*
*                                                  SYSOUT=A        FCI*
S99TUKY2 DC    X'0018',X'0001',X'0001'                             FCI*
         AIF   (&QRNB).RNB10A                                     RNB10
S99SYSOC DC    C'A'                                                FCI*
         AGO   .RNB10B                                            RNB10
.RNB10A  ANOP                                                     RNB10
S99SYSOC DC    C'C'                                               RNB10
.RNB10B  ANOP                                                     RNB10
*                                      OPTIONAL    DEST=RMTXXX     FCI*
S99TUKY3 DC    X'0058',X'0001'                                     FCI*
S99DESTL DC    X'0000'   LENGTH OF DEST                            FCI*
S99DEST  DC    CL8' '  DEST PARAMETER                              FCI*
*                                                                  FCI*
         DS    0D                                                  FCI*
S99LENG  EQU   *-S99RBPTR              LENGTH OF WHOLE MAGILLA     FCI*
         EJECT ,                                                   FCI*
*.....................................................................*
*.       DYNAMIC ALLOCATION REQUEST BLOCK TO FREE DDNAME HASPPRNT    .*
*.....................................................................*
         SPACE 3                                                   FCI*
         DS    0F                  GET FULLWORD BOUNDARY           FCI*
F99PTR   DC    X'80',AL3(F99RB)    THE POINTER TO THE MESS..       FCI*
*                                                                  FCI*
F99RB    DC    FL1'20'            LENGTH OF RB IN BYTES = 20       FCI*
         DC    XL1'02'            VERB CODE=X'02'..FREE BY DDN     FCI*
         DC    AL2(0)             FLAGS1..NO OPTIONS               FCI*
F99RC    DC    XL2'0000'          ERROR CODE                       FCI*
F99INFO  DC    XL2'0000'          INFO CODE                        FCI*
         DC    AL4(F99TXPT)       ADDRESS OF TEXT UNITS            FCI*
         DC    XL4'00'            RESERVED                         FCI*
         DC    XL4'00'            FLAGS2                           FCI*
         SPACE 2                                                   FCI*
F99TXPT DC     AL4(F99TU1)        ADDR OF DSN TEXT UNIT            FCI*
         DC    X'80',AL3(F99TU2) ADDR OF UNALLOC TEXT TU(LAST)     FCI*
         SPACE 2                                                   FCI*
F99TU1   DC    X'0001',X'0001',FL2'8',C'HASPPRNT' DDNAME           FCI*
F99TU2   DC    X'0007',X'0000'        UNALLOC EVEN IF PERM ALLOC   FCI*
F99LEN   EQU   *-F99PTR           LENGTH OF FILEDS                 FCI*
         EJECT ,                                                   FCI*
***********************************************************************
WORK     DSECT                                                     FCI*
         DS    CL72                                                FCI*
OFFSET   DS    H                                                   FCI*
LENGTH   DS    H                                                   FCI*
FIELD    DS    CL8                                                 FCI*
RPASS    DS    CL8                                                 FCI*
DBLWORK  DC    D'0'                                                FCI*
BINYEAR  DC    F'0'                                                FCI*
BINDAYS  DC    F'0'                                                FCI*
DATE     DC    F'0'                                                FCI*
WORKWORD DC    2F'0'                                               FCI*
***********************************************************************
* LEAVE FIELDS TOGETHER.. INITIALIZED BY ONE MVC WITH VALUES       FCI*
*                                                                  FCI*
MONMSK   DC    AL1(31,30,31,30,31,31,30,31,30,31,28,31)            FCI*
         DC    CL1' '                                    L         FCI*
JDATE    DC    C'XX.XXX',C'  '                           E  F      FCI*
TIMEHRS  DC    CL2' ',C'.'                               A  I  T   FCI*
TIMMINS  DC    CL2' ',C'.'                               V  E  O   FCI*
TIMSECS  DC    CL2' ',C' '                               E  L  G   FCI*
CDAY     DC    CL3' ',C' '                                  D  E   FCI*
CMON     DC    CL3' ',C' '                                  S  T   FCI*
CDAYN    DC    CL2' ',C',19'                                   H   FCI*
CYR      DC    CL2'  ',C' '                                    E   FCI*
*                                                              R   FCI*
***********************************************************************
LEN      EQU   *-JDATE                                             FCI*
         SPACE 2                                                   FCI*
         DS    0F                                                  FCI*
DYNALLOC DS    (S99LENG)XL1                                        FCI*
         ORG   DYNALLOC                                            FCI*
*                                          SVC 99 REQUEST BLOCK  PTR
P99RBPTR DC    X'80',AL3(P99RB)                                    FCI*
*                                          SVC 99 REQUEST BLOCK    FCI*
P99RB    DS    0F                                                  FCI*
P99RBLN  DC    AL1(20)                     LENGTH=20 BYTES         FCI*
P99VERB  DC    X'01'                       VERB CODE=01 (DSNAME ALLOC)
P99FLAG1 DC    X'1000'                     DONT USE EXISTING ALLOC FCI*
P99ERROR DC    AL2(0)                              ERROR CODE      FCI*
P99INFO  DC    AL2(0)                              INFO  CODE      FCI*
P99TXTPP DC    A(P99TUPL)                 POINTER TO TEXT UNIT POINTERS
P99RSVD1 DC    A(0)                          RESERVED              FCI*
P99FLAG2 DC    A(0)                          FLAGS 2               FCI*
P99TUPL  DC    A(P99TUKY1)                TEXT UNIT POINTERS       FCI*
P99EPARM DC    X'80',AL3(P99TUKY2)        LAST PARM IF NO DEST=    FCI*
P99UPLL  DC    X'80',AL3(P99TUKY3)        LAST PARM IF DEST= GIVEN FCI*
P99TUNIT DS    0F                                                  FCI*
*                                                  DDNAME=HASPPRNT FCI*
P99TUKY1 DC    X'0001',X'0001',X'0008',C'HASPPRNT'                 FCI*
*                                                  SYSOUT=A        FCI*
P99TUKY2 DC    X'0018',X'0001',X'0001'                             FCI*
P99SYSOC DC    C'A'                                                FCI*
*                                      OPTIONAL    DEST=RMTXXX     FCI*
P99TUKY3 DC    X'0058',X'0001'                                     FCI*
P99DESTL DC    X'0000'   LENGTH OF DEST                            FCI*
P99DEST  DC    CL8' '  DEST PARAMETER                              FCI*
*                                                                  FCI*
         ORG   DYNALLOC                                            FCI*
         DS    0F                  GET FULLWORD BOUNDARY           FCI*
FREEPTR  DC    X'80',AL3(FREERB)   THE POINTER TO THE MESS..       FCI*
*                                                                  FCI*
FREERB   DC    FL1'20'            LENGTH OF RB IN BYTES = 20       FCI*
         DC    XL1'02'            VERB CODE=X'02'..FREE BY DDN     FCI*
         DC    AL2(0)             FLAGS1..NO OPTIONS               FCI*
FREERC   DC    XL2'0000'          ERROR CODE                       FCI*
FREEINFO DC    XL2'0000'          INFO CODE                        FCI*
FREETPTR DC    AL4(FREETXPT)      ADDRESS OF TEXT UNITS            FCI*
         DC    XL4'00'            RESERVED                         FCI*
         DC    XL4'00'            FLAGS2                           FCI*
         SPACE 2                                                   FCI*
FREETXPT DC    AL4(FREETU1)       ADDR OF DSN TEXT UNIT            FCI*
         DC    X'80',AL3(FREETU2) ADDR OF UNALLOC TEXT TU(LAST)    FCI*
         SPACE 2                                                   FCI*
FREETU1  DC    X'0001',X'0001',FL2'8',C'HASPPRNT' DDNAME           FCI*
FREETU2  DC    X'0007',X'0000'        UNALLOC EVEN IF PERM ALLOC   FCI*
         ORG   ,                                                   FCI*
*                                                                  FCI*
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON                                                   FCI*
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         SPACE 2                                                   FCI*
MREMOTE  EQU   QDTLINE+7,8                                         FCI*
M2ERC    EQU   QDTLINE+35,4                                        FCI*
M2INFO   EQU   QDTLINE+46,4                                        FCI*
M2RC     EQU   QDTLINE+56,4                                        FCI*
M1CLASS  EQU   QDTLINE+22,1                                        FCI*
M1DEST   EQU   QDTLINE+29,8                                        FCI*
         EJECT ,                                                   FCI*
PRINT    CSECT                                                     FCI*
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         DCBD  DSORG=(PS)                                          FCI*
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END  ,                                                    FCI*
./       ADD   NAME=P051B19
*          DATA SET S051B19    AT LEVEL 001 AS OF 07/06/77
*          DATA SET S051B19    AT LEVEL 002 AS OF 03/23/77
*          DATA SET S051B19    AT LEVEL 001 AS OF 09/08/76
P051B19 CSECT
*
* THIS IS THE DTAPES COMMAND FOR TSO    OS/VS2 R3.
*
* THE COMMAND WILL DISPLAY THE STATUS AND VOLSERS OF ALL TAPE UNITS.
* THE COMMAND SYNTAX IS:
*
*   DTAPES
*
*
* ADAPTED FROM MICHIGAN MODS 'USPACE' COMMAND FROM UNITED AIR LINES
*       TSO MODS 3-75  BY KEN TRUE  MAY76
*
*  ALSO BAGGED OBTAIN CODE FROM U.C.L.A  URLISTVO COMMAND FROM THE
*       SAME MISHMODS TAPE.  KT JUNE76.
*
*  BAGGED SORT UCB ADDRESS CODE FROM MISHMODS DDASD COMMAND
*                            KT 13JULY76
*
*  INSTALLED SEARCH OF DEVNAMET FOR UNIT DESCRIPTION.. KT 26APR77
*
*  MODIFIED TO RUN AS TSO COMMAND OR OPER STARTED TASK KT  27MAY77
*
*
*
LINKREG  EQU   6                   LINK REGISTER
*
         STM   R14,R12,D12(R13)         SAVE REGISTERS
         BALR  R12,R0                   PROGRAM BASE
         USING *,R12                    PROGRAM ADDRESSABILITY
         LR    R2,R1
         GETMAIN R,LV=CORENEED          OBTAIN DYNAMIC CORE
         ST    R13,D4(R1)               CHAIN
         ST    R1,D8(R13)                SAVE
         LR    R13,R1                     AREAS
         LR    R11,R13                  CORE ADDR.
         USING CORE,R11
         LOAD  EP=DEVNAMET        LOAD DEVICE NAME TABLE
         ST    R0,DEVADDR         ...AND SAVE ITS ADDRESS
         MVC   EXTRACT1(EXTRACTL),EXTRACT MOVE IN EXTRACT LIST FORM
         LA    R1,ANSWER          LOAD ADDR OF ANSWER
         ST    R1,EXTRACT1          AND SAVE IT IN THE MACRO
         EXTRACT MF=(E,EXTRACT1)
         L     R1,ANSWER            (R1)=ADDR OF TSO FLAG FROM EXTRACT
         MVC   TSOFLAG,0(R1)        MOVE IN THE ANSWER TO OUR FLAG
         SPACE
LISTALL  MVI   SW1,X'00'                INIT PRINT HDR SWITCH
*
         L     R7,CVTPTR                CVT ADDR.
         USING CVT,R7                   CVT ADDRESSABILITY
         L     R7,CVTILK2               UCB LOOKUP TABLE ADDR.
         DROP  R7                       KILL CVT ADDRESSABILITY
         USING UCBSECT,R8               SET ADDRESSAB TO UCB.
         EJECT
         XC    LCT,LCT                  CLEAR COUNT
         MVC   LMAX(2),=H'1000'         SAY ROOM FOR 500 ENTRIES
CYCLE    LH    R8,D0(R7)                UCB ADDR.
         LTR   R8,R8                    TEST UCB STATUS
         BM    RLSE                     END OF TABLE
         BZ    INDEX                    PAD ENTRY
         CLI   UCBID,UCBSTND            IS UCB STANDARD?
         BNE   INDEX                    NO, ERROR
         CLI   UCBTBYT3,UCB3TAPE        IS IT A TAPE?
         BNE   INDEX                    NO
         SR    R4,R4
COMPLIST CH    R4,LCT                   SEE IF WEVE SEEN THIS ONE ?
         BNL   ADDLIST                  NOPE-> GO ADDIT
         CH    R8,LIST(R4)
         BE    INDEX
         LA    R4,2(R4)
         B     COMPLIST
ADDLIST  LH    R4,LCT
         CH    R4,LMAX
         BNL   FULL
         STH   R8,LIST(R4)
         LA    R4,2(R4)
         STH   R4,LCT
FULL     EQU   *
DISPCHK  TM    SW1,HEADING              HAVE WE WRITTEN THE HEADER?
         BNO   WRTFMT                   ->NO..GO WRITE IT
         SPACE
DISPLAY  MVC   BUFFER(WTOMSGL),WTOMSG   REINIT WTO MESSAGE
         MVC   MSGUNIT,UCBNAME          COPY UNIT ADDRESS
         CLI   UCBVOLI,X'00'            ANY VOLSER IN UCBVOLI ?
         BE    NOVOLSER                 NO-> SKIP MOVE OF VOLSER
         MVC   MSGVOL,UCBVOLI           COPY VOLUME SERIAL NUMBER
*
NOVOLSER TM    UCBSTAT,UCBONLI          IS DRIVE ONLINE?
         BNO   NOTON                    ->NO..MARK MSG AS OFFLINE
         MVC   MSGSTAT,ONLINE           ->YES..SAY SO.
         B     CHKVARY
NOTON    MVC   MSGSTAT,OFFLINE
*
CHKVARY  TM    UCBSTAT,UCBCHGS          IS IT CHANGING ON/OFF?
         BNO   CHKDEN                   ->NO GO CHECK DENSITY..
         MVC   MSGVARY,VARY             ->YES..SAY SO.
*
CHKDEN   TM    UCBTBYT2,UCBDUDN1        IS IT 800/1600?
         BNO   CHKDEN1                  ->NO ..KEEP LOOKING
         MVC   MSGDENS,DDEN1
         B     CHKMODL
CHKDEN1  TM    UCBTBYT2,UCBDUDN2        IS IT 1600/6250?
         BNO   CHKDEN2                  -> NO
         MVC   MSGDENS,DDEN2
         B     CHKMODL
CHKDEN2  TM    UCBTBYT1,UCBD1600         HOW ABOUT JUST 1600?
         BNO   CHKDEN3                   -> NO..ONCE MORE WITH FEELING
         MVC   MSGDENS,DEN1600
         B     CHKMODL
CHKDEN3  TM    UCBTBYT1,UCBD6250         LAST CHANCE..IS IT JUST 6250?
         BNO   CHKMODL                   -> NO..DONT KNOW DENSITY..
         MVC   MSGDENS,DEN6250
         SPACE
***
***   USE SYSTEM DEVICE NAME TABLE
***
***
CHKMODL  L     R1,DEVADDR         ADDRESS OF DEVICE NAME TABLE
         L     R10,0(R1)          NUMBER OF ENTRIES
         LA    R1,4(R1)           ADDRESS OF FIRST ENTRY
DEVLP    CLC   UCBTYP(4),8(R1)    IS THIS THE DEVICE TYPE
         BE    DEVFND             YES... BR TO SAVE DEVICE TYPE
         LA    R1,12(R1)          NO... INCR TO NEXT TABLE ENTRY
         BCT   R10,DEVLP          LOOP UNTIL END OF TABLE
         MVC   MSGMODL,=C'????'   SAY WE DONT KNOW DEVICE TYPE
         B     GETWHO
*
DEVFND   MVC   MSGMODL,0(R1)           MOVE UNIT TYPE TO PRINT LINE
*
GETWHO   XR    R10,R10
         L     R10,UCBEXTPT             GET EXTENTION TO UCB
         LTR   R10,R10                  ANYTHING THERE?
         BZ    PUTIT                    NO->SPLIT
         LA    R10,14(R10)              GET UCBASID ADDRESS
         LH    R10,0(R10)               AND GET THE ASID
         N     R10,=X'0000FFFF'          PLUS MASK OFF RESIDUE..
         LTR   R10,R10                  ANY BODY THERE?
         BZ    PUTIT                    NO->SIGH,ALL THAT FOR NAUGHT..
*
GOTASID  L     R4,CVTPTR                GET ADDR OF CVT
         USING CVT,R4                    AND ADDRESS YOURSELF TO IT..
         L     R4,CVTASVT               GET ADDR OF ASVT..
         DROP  R4
         USING ASVT,R4                  AND ESTAB ADDRESSABILITY
         SLL   R10,2                    ADJUST ASID..TO USE AS INDEX
         L     R10,ASVTFRST(R10)        R10=ADDR(ASCB) FOR ASID
         DROP  R4
         USING ASCB,R10                 GOTCHA
         L     R4,ASCBJBNI              IS IT A JOB
         LTR   R4,R4
         BZ    ITSTSO
         MVC   MSGUSER,0(R4)            MOVIN JOBNAME
         B     PUTIT
ITSTSO   L     R4,ASCBJBNS              ITS START/MOUNT/LOGON
         LTR   R4,R4
         BZ    PUTIT
         MVC   MSGUSER,0(R4)            MOVEIN USERID
PUTIT    DS    0H
         LA    R1,BUFFER                MESSAGE ADDR.
         BAL   LINKREG,PUTMSG           ISSUE MESSAGE
         OI    SW1,FOUND                SAY WE FOUND A VOL...
         SPACE
INDEX    LA    R7,D2(R7)                NEXT ENTRY ADDR.
         B     CYCLE                    CONTINUE
         EJECT
WRTFMT   LA    R1,FMTMSG1               WRITE HEADERS....
         BAL   LINKREG,PUTMSG
         OI    SW1,HEADING              SAY WE WROTE THE HEADERS
         B     DISPLAY
         SPACE 2
RLSE     LR    R1,R11                   CORE ADDR.
         L     R13,D4(R13)
THEEND   FREEMAIN R,LV=CORENEED,A=(1)   FREE DYNAMIC CORE
         XC    D16(D4,R13),D16(R13)
         LM    R14,R12,D12(R13)
         XR    R15,R15                  SET RC=0
         BR    R14                      RETURN
         EJECT
*.....................................................................*
*        LOCAL SUBROUTINE FOR IO TO OPER/USER                         *
*.....................................................................*
         SPACE
*
* ENTER WITH WTO,WTOR LIST FORM POINTED TO BY R1
*
*    BAL  LINKREG,PUTMSG    OR
*    BAL  LINKREG,PUTGET
*
*  USES R14 FOR WORK
*
*
PUTMSG   DS    0H
         TM    TSOFLAG,X'80'       IS IT TSO?
         BO    TPUTIT              YES-> GO DO TPUT
         SVC   35                  NO-> USE WTO
         BR    LINKREG
TPUTIT   DS    0H
         LH    R0,0(,R1)           GET LENGTH OF WTO MESSAGE
         S     R0,=F'4'            SUBTRACT OFF HEADER
         LA    R1,4(,R1)           BUMP MSG ADDRESS PAST HDR
         TPUT  (1),(0),R           DO THE TPUT
         BR    LINKREG
         SPACE 2
PUTGET   DS    0H
         TM    TSOFLAG,X'80'       IS IT TSO?
         BO    TSOIT               YES-> GO USE TGET
         LR    R14,R1              NO-> USE WTOR .. SAVE MSG ADDRESS
         SVC   35                  DO THE WTOR...
         L     R1,4(,R14)          GET ADDR OF ECB
         XC    0(4,R1),0(R1)       CLEAN OUT THE ECB....
         LA    R0,1
         SVC   1                   WAIT FOR WTOR TO COMPLETE
         B     PUTRET              RETURN
TSOIT    DS    0H
         LR    R14,R1              SAVE
         LH    R0,8(,R1)           PUT LENGTH
         S     R0,=F'4'
         LA    R1,12(,R1)          PAST HDR
         TPUT  (1),(0),R
         SR    R0,R0
         IC    R0,0(,R14)          GET REPLY LENGTH
         L     R1,0(,R14)          GET REPLY ADRS
         LA    R1,0(,R1)
         ICM   R1,B'1000',=X'80'   INDICATE TGET...
         TGET  (1),(0),R
PUTRET   DS    0H
         L     R1,0(,R14)          GET REPLY ADRS
         XR    R0,R0
         IC    R0,0(,R14)          GET REPLY LENGTH
UPPER    DS    0H
         OI    0(R1),C' '          UPPER CASE
         LA    R1,1(,R1)           NXT
         BCT   R0,UPPER
         BR    LINKREG
         SPACE 2
         EJECT
*.....................................................................*
*        LIST FORMS OF MACROS                                         *
*.....................................................................*
         SPACE 2
EXTRACT  EXTRACT *-*,'S',FIELDS=(TSO),MF=L
EXTRACTL EQU   *-EXTRACT
         SPACE 2
FMTMSG1  WTO   'UNIT VOLUME STATUS  USER          DENSITY   MODEL      X
                         ',ROUTCDE=(11),MF=L
         SPACE 2
WTOMSG   WTO   '                                                       X
                         ',ROUTCDE=(11),MF=L
WTOMSGL  EQU   *-WTOMSG
         EJECT
*.....................................................................*
*        PROGRAM CONSTANTS/LITERALS                                   *
*.....................................................................*
         SPACE 2
ONLINE   DC    CL7'ONLINE'
OFFLINE  DC    CL7'OFFLINE'
VARY     DC    CL4'VARY'
DDEN1    DC    CL9'800/1600'
DDEN2    DC    CL9'1600/6250'
DEN800   DC    CL9'800'
DEN1600  DC    CL9'1600'
DEN6250  DC    CL9'6250'
*
         EJECT
*
* PROGRAM  E Q U A T E S
*
R0       EQU   0              MACROS-WORK
R1       EQU   1              MACROS-WORK
R2       EQU   2
R3       EQU   3
R4       EQU   4              WORK/ASVT
R5       EQU   5
R6       EQU   6              LINKREG FOR PUTGET
R7       EQU   7              UCB LOOKUP TABLE
R8       EQU   8              UCB ADDRESSABILITY
R9       EQU   9
R10      EQU   10             WORK/ASCB
R11      EQU   11             CORE DSECT (WORK AREA) ADDRESSABILITY
R12      EQU   12             PROGRAM BASE REGISTER
R13      EQU   13             SAVE AREA POINTER
R14      EQU   14             MACROS - WORK  RETURN ADDRESS
R15      EQU   15             MACROS - WORK/ RETURN CODE
*
D0       EQU   0
D1       EQU   1
D2       EQU   2
D4       EQU   4
D8       EQU   8
D12      EQU   12
D16      EQU   16
*
HEADING  EQU   X'01'
FOUND    EQU   X'02'
NOTFOUND EQU   X'FD'
SKIP     EQU   X'80'
NOSKIP   EQU   X'7F'
CHARZERO EQU   C'0'
         EJECT
CVT      DSECT
         CVT       SYS=VMS,TSO=YES
         EJECT
UCBSECT  DSECT
         IEFUCBOB
         EJECT
         IHAASCB
         EJECT
         IHAASVT
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
CORE     DSECT
         DS    18F
DEVADDR  DS    F
BUFFER   DS    CL80              TO RECEIVE THE WTO LIST FORM
         ORG   BUFFER+4
         DS    CL1
MSGUNIT  DS    CL3
         DS    CL1
MSGVOL   DS    CL6
         DS    CL1
MSGSTAT  DS    CL7
         DS    CL1
MSGUSER  DS    CL8
         DS    CL1
MSGVARY  DS    CL4
         DS    CL1
MSGDENS  DS    CL9
         DS    CL1
MSGMODL  DS    CL8
*
         ORG
*
SW1      DS    1C
TSOFLAG  DS    X                   ='80' IF TSO. '00' IF NOT TSO
ANSWER   DS    F                   ADDRESS POINTER FOR EXTRACT
DBLW     DS    4D
         ORG   DBLW
EXTRACT1 DS    4D
         ORG
LCT      DS    H                        TO REMEMBER COUNT
LMAX     DS    H                        TO REMEMBER UCB MAX ADDR
LIST     DS    500H                     TO REMEMBER EACH UCB ADDR
CORENEED EQU   *-CORE
         END
./       ADD   NAME=QAUTHCK
         MACRO ,                                                  ONL02
&NAME    QAUTHCK &CODE                                            ONL02
.*****************************************************************ONL02
.*                                                                ONL02
.* MACRO NAME = QAUTHCK                                           ONL02
.*                                                                ONL02
.* MODIFICATION ID = ONL02                                        ONL02
.*                                                                ONL02
.* DESCRIPTIVE NAME =  FUNCTION AUTHORIZATION CHECK REQUEST       ONL02
.*                                                                ONL02
.* AUTHOR = ROBERT M. JINKINS                                     ONL02
.*          OAK RIDGE NATIONAL LABORATORY                         ONL02
.*          BLDG. 4500-N  MS-259                                  ONL02
.*          P.O. BOX X                                            ONL02
.*          OAK RIDGE, TENNESSEE  37830                           ONL02
.*                                                                ONL02
.*          PHONE: (615) 574-7208/5300                            ONL02
.*                  FTS  624-7208/5300                            ONL02
.*                                                                ONL02
.*          SHARE INSTALLATION CODE = OR                          ONL02
.*                                                                ONL02
.* DATE WRITTEN = JUNE 83                                         ONL02
.*                                                                ONL02
.* FUNCTION = THIS MACRO SETS THE AUTHORIZATION CHECK REQUEST     ONL02
.*    CODE AND CALLS THE AUTHORIZATION ROUTINE (AUTH CSECT) TO    ONL02
.*    VALIDATE THE REQUEST.                                       ONL02
.*                                                                ONL02
.* CHANGE ACTIVITY = NONE                                         ONL02
.*                                                                ONL02
.*****************************************************************ONL02
         AIF   ('&CODE'(1,1) EQ '(').REG                          ONL02
         AIF   ('&CODE' EQ 'QASTART').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QAEND').CODEOK                        ONL02
         AIF   ('&CODE' EQ 'QAALLOC').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QABEFOPN').CODEOK                     ONL02
         AIF   ('&CODE' EQ 'QAAFTOPN').CODEOK                     ONL02
         AIF   ('&CODE' EQ 'QASPOOL').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QAPARSE').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QAFINDJ').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QAJCL').CODEOK                        ONL02
         AIF   ('&CODE' EQ 'QAJLOG').CODEOK                       ONL02
         AIF   ('&CODE' EQ 'QAJMSG').CODEOK                       ONL02
         AIF   ('&CODE' EQ 'QALIST').CODEOK                       ONL02
         AIF   ('&CODE' EQ 'QAJHIST').CODEOK                      ONL02
         AIF   ('&CODE' EQ 'QADD').CODEOK                         ONL02
         AIF   ('&CODE' EQ 'QAPDDB').CODEOK                       ONL02
         AIF   ('&CODE' EQ 'QASYSOUT').CODEOK                     ONL02
         AIF   ('&CODE' EQ 'QASYSLOG').CODEOK                     ONL02
         MNOTE 8,'QAUTHCK MACRO - INVALID REQUEST CODE'           ONL02
         MEXIT ,                                                  ONL02
.REG     ANOP  ,                                                  ONL02
&NAME    STC   &CODE(1),QACODE     SET AUTHORIZATION REQUEST CODE ONL02
         AGO   .CALL                                              ONL02
.CODEOK  ANOP  ,                                                  ONL02
&NAME    MVI   QACODE,&CODE        SET AUTHORIZATION REQUEST CODE ONL02
.CALL    ANOP  ,                                                  ONL02
         L     R15,=V(AUTH)        ADDR OF AUTHORIZATION CHECK RTNONL02
         BALR  R14,R15             CALL AUTHORIZATION CHECK RTN   ONL02
         MEND  ,                                                  ONL02
./       ADD   NAME=QCOMMON
         MACRO
         QCOMMON &CSECT=NO
         GBLB  &QISPF     ISPF INTERFACE SEE QSTART MACRO          DOR
         GBLB  &QWTO      TROUBLE SHOOTING ON SYSLOG               DOR
         GBLB  &QPFK      PF-KEY OPTION. SEE QSTART MACRO          ICBC
         GBLB  &QSP       MVS/SP OPTION. SEE QSTART MACRO         UF020
         GBLB  &QSP133    MVS/SP 1.3.3 OPTION                     UF046
         GBLB  &QSP136    MVS/SP 1.3.6 OPTION                     DOR
         GBLB  &QRACF     RACF OPTION. SEE QSTART MACRO           RNB03
         GBLC  &QRACUSR   RACF USERID. SEE QSTART MACRO           RNB03
         GBLC  &QCKPTV    VOLSER OF CHECKPOINT DATASET            UF042
         GBLC  &QCKUNIT   UNIT TYPE OF CHECKPOINT DATASET           DOR
         GBLC  &QSIDS(7)  SYSTEM IDS FOR CPUS                     UF042
         GBLC  &QDSPRFX   DEFINES HASPCKPT/HASPACE DSN PREFIX     CL006
         GBLC  &QPF(24)   PFK DEFINITIONS                         UF042
         GBLC  &Q1CMD     DEFAULT FIRST COMMAND                   UF042
         LCLA  &Q1CMDL    DEFAULT FIRST COMMAND LENGTH            UF042
         LCLA  &RACLEN    LENGTH OF RACF USERID                   RNB03
         LCLA  &SIZE      BLOCK SIZE FOR CKPT DCB
         AIF   ('&CSECT' EQ 'YES').CSECT
         TITLE 'QUEUE COMMAND - COMMON AREA DSECT'
***********************************************************************
*                                                                     *
*   QUEUE COMMAND - COMMON AREA DSECT                                 *
*                                                                     *
***********************************************************************
QCOMMON  DSECT
.CSECT   ANOP
***********************************************************************
*                                                                     *
*   VECTOR TABLE - ADDRESSES OF AREAS IN QCOMMON                      *
*                                                                     *
***********************************************************************
QVDSPL   DC    A(QDISPLAY)    PTR TO DISPLAY WORK AREA
QVDAIR   DC    A(QDAIR)       PTR TO DAIR WORK AREA
QVCKPT   DC    A(QCKPT)       PTR TO CKPT WORK AREA
QVPRINT  DC    A(QCPRINT)     PTR TO PRINT WORK AREA               FCI*
QVDQTTY  DC    A(QDQTTY)      PTR TO TTY                           DST*
         DC    3F'0'          SPARE POINTERS RESERVED FOR FUTURE
QFRSTSA  DC    A(0)           ADDRESS OF FIRST SAVE AREA
***********************************************************************
*                                                                     *
*   MISCELLANEOUS NUTS AND BOLTS                                      *
*                                                                     *
***********************************************************************
QDWORK   DC    D'0'           SCRATCH DOUBLE WORD                 UF009
QDWORD   DC    D'0'           SCRATCH DOUBLE WORD                 UF009
QLOGON   DC    CL8' '         USERID  FROM PSCB                   ONL02
QLOGONLN DC    F'0'           LENGTH OF USERID                    ONL02
QCLASSH  DC    0H'0',X'00'    HALFWORD BOUNDARY
QCLASS   DC    C' '           SEARCH CLASS
QCODEH   DC    0H'0',X'00'    HALFWORD BOUNDARY
QCODE    DC    X'00'          SEARCH FUNCTION CODE
QSUBCMD  DC    A(0)           ADDR OF CURRENT SUBCOMMAND
QOFF0    DC    H'0'           OFFSET TO SUBCOMMAND
QLNG0    DC    H'0'           LENGTH OF SUBCOMMAND
QSUBNAME DC    CL8'STATUS '   NAME OF SUBCOMMAND                  UF018
QOFF1    DC    H'0'           OFFSET TO QPARM1
QLNG1    DC    H'0'           LENGTH OF QPARM1
QPARM1   DC    CL8' '         USER SUPPLIED PARAMETER #1
QOFF2    DC    H'0'
QLNG2    DC    H'0'
QPARM2   DC    CL8' '                                 #2
QOFF3    DC    H'0'
QLNG3    DC    H'0'
QPARM3   DC    CL8' '                                 #3
QOFF4    DC    H'0'
QLNG4    DC    H'0'
QPARM4   DC    CL8' '                                 #4
         SPACE 1                                                  ONL02
QFLAG1   DC    AL1(*-*)       FLAG BYTE 1                         ONL02
QFLG1IOE EQU   B'10000000'    I/O ERROR ON SPOOL READ             ONL02
QFLG1DBC EQU   B'01000000'    ESTAE ENVIRONMENT ESTABLISHED       ONL02
QFLG1LCL EQU   B'00100000'    Q20 - SEARCHING LOCAL JOE QUE (SP3) ONL02
QFLG1SDS EQU   B'00010000'    SYSTEM DATA SET JOB (NO JCT)        ONL14
*        EXTRA FLAGS DOR
QDSPBLK  EQU   B'00001000'    DISPLAY BLANK LINES OPTION DOPTION DOR
QDSPCC   EQU   B'00000100'    DISPLAY CARRIAGE CONTROL DOPTION   DOR
QJOTON   EQU   B'00000010'    JOT SECOND HALF SWITCH  FORMS      DOR
QLISTCC  EQU   B'00000001'    JOT SECOND HALF SWITCH  FORMS      DOR
         SPACE 1                                                  ONL02
QFLAG2   DC    AL1(*-*)       FLAG BYTE 2                         ONL02
QFLG2SPN EQU   B'10000000'    NOW SEARCHING SPIN IOT'S            ONL04
QFLG2PDB EQU   B'01000000'    PDDB FOR DSID WAS FOUND             ONL04
Q2SYSJOB EQU   B'00100000'    SYSJOB REQUIRED LISTDSR             DOR
         SPACE 1                                                  ONL02
QOLDDSID DC    H'0'           PREVIOUS DSID FOR 'L * +/-' COMMAND ONL04
QBLANK   DC    CL132' '       132 BLANKS                          UF003
QFZONE   DC    C'0'           USED TO CLEAR QFZONES
QFZONES  DC    C'00000000'    USED FOR NUMERIC CHECK
QCOUNT   DC    PL3'0'         NUMBER OF ELEMENTS IN QUEUE
QCOUNTA  DC    PL3'0'         NUMBER OF ELEMENTS IN AWAITING QUEUE
QCOUNTE  DC    PL3'0'         NUMBER OF ELEMENTS IN EXECUTION QUEUE
QCOUNTH  DC    PL3'0'         NUMBER OF ELEMENTS IN HOLD QUEUE
QOFFS    DC    H'0'           START COLUMN FOR FIND
QOFFE    DC    H'0'           END COLUMN FOR FIND
QDELIMIT DC    C' '           DELIMITER
QRSVD    DC    XL15'0'        RSVD
QPJOBID  DC    F'0'           JOB ID FOR LISTDS     ** THESE TWO FIELDS
QPDSID   DC    H'0'           DATASET ID FOR LISTDS ** MUST BE CONTIG.
QPOFFSET DC    H'0'           PRINT OFFSET FROM BEGINNING OF RECORD
QPREC    DC    PL4'0'         CURRENT RECORD COUNT
QPLNG    DC    H'0'           LENGTH OF COMPARE FIELD FOR FIND
QPFIND   DC    CL58' '        COMPARE FIELD FOR FIND
QSYSID   DC    CL8' '         SYSTEM ID TABLE
* YOU MUST SUPPLY THE NAME OF EACH CPU IN YOUR COMPLEX
         DC    CL8'&QSIDS(1)' SYSTEM ID FOR SYSTEM 1              UF042
         DC    CL8'&QSIDS(2)'                      2              UF042
         DC    CL8'&QSIDS(3)'                      3              UF042
         DC    CL8'&QSIDS(4)'                      4              UF042
         DC    CL8'&QSIDS(5)'                      5              UF042
         DC    CL8'&QSIDS(6)'                      6              UF042
         DC    CL8'&QSIDS(7)'                      7              UF042
         SPACE 1                                                  CL006
QPREFIX  DC    CL8'&QDSPRFX'       DATA SET NAME PREFIX           CL006
         EJECT
******************************************************************ONL02
*                                                                 ONL02
*  FUNCTION AUTHORIZATION CHECKING FIELDS                         ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
QACODE   DC    AL1(*-*)            AUTHORIZATION CK REQUEST CODE  ONL02
QAFLAGS  DC    AL1(QAFXDFLT)       AUTHORIZATION FLAGS            ONL02
QASCFLGS DC    AL1(*-*)            SUB-COMMAND TYPE FLAGS         ONL02
QASCUSER DC    AL1(*-*)            SUB-COMMAND USER FLAGS         ONL02
QAHELP   DC    AL1(*-*)            HELP DISPLAY CONTROL FLAGS     ONL02
         DC    X'00'               RESERVED                       ONL02
         DC    X'00'               RESERVED                       ONL02
QAUSER   DC    A(*-*)              USER FLAGS                     ONL02
QAUSER1  DC    A(*-*)              USER WORD 1                    ONL02
QAUSER2  DC    A(*-*)              USER WORD 2                    ONL02
         SPACE 1                                                  ONL02
*--------EXTRACT *-*,MF=L          EXTRACT PARAMETER LIST         ONL02
QAEXTLST EXTRACT *-*,MF=L          EXTRACT PARAMETER LIST         ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  FUNCTION CODES (QACODE) USED FOR AUTHORIZATION CHECK REQUESTS  ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
QANULL   EQU   0                   NULL REQUEST                   ONL02
QASTART  EQU   1                   QUEUE COMMAND START-UP         ONL02
QAEND    EQU   2                   QUEUE COMMAND TERMINATION      ONL02
QAALLOC  EQU   3                   DATASET ALLOCATION/UNALLOCATIONONL02
QABEFOPN EQU   4                   BEFORE CKPT/SPOOL OPEN         ONL02
QAAFTOPN EQU   5                   AFTER CKPT/SPOOL OPEN          ONL02
QASPOOL  EQU   6                   READSPC RTN (AFTER SPOOL I/O)  ONL02
QAPARSE  EQU   7                   QUEUE SUBCOMMAND AUTHORIZATION ONL02
QAFINDJ  EQU   8                   FINDJOB RTN FOR JOB            ONL02
QAJCL    EQU   9                   JCL CMD FOR JOB                ONL02
QAJLOG   EQU   10                  JLOG CMD FOR JOB               ONL02
QAJMSG   EQU   11                  JMSG CMD FOR JOB               ONL02
QALIST   EQU   12                  LIST CMD FOR JOB AND DSID      ONL02
QAJHIST  EQU   13                  JHIST CMD FOR JOB              ONL02
QADD     EQU   14                  DD CMD FOR JOB                 ONL02
QAPDDB   EQU   15                  PDDB CMD FOR JOB               ONL02
QASYSOUT EQU   16                  DEL/REQ/CAN CMDS FOR JOB       ONL02
QASYSLOG EQU   17                  AUTHORIZATION TO LOOK AT SYSLOGONL02
         EJECT ,                                                  ONL02
*                                                                 ONL02
*  QAFLAGS BIT DEFINITIONS  (AUTHORIZATION FLAGS)                 ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
QAFXACTV EQU   B'10000000'         MAY DISPLAY ACTIVE LISTS       ONL02
QAFXBLOG EQU   B'01000000'         MAY DISPLAY BACKLOG LISTS      ONL02
QAFXSSSM EQU   B'00100000'         MAY USE CAN, DEL, AND REQ      ONL02
QAFXSLOG EQU   B'00010000'         MAY LOOK AT SYSLOG             ONL02
QAFXEXEC EQU   B'00001000'         MAY ISSUE TSO CMDS FROM QUEUE  ONL02
QAFXOPER EQU   B'00000100'         USER HAS OPER AUTHORITY        ONL02
QAFXSYSP EQU   B'00000010'         USER HAS JES2 SYS-PGMR AUTH    ONL02
         SPACE 1                                                  ONL02
QAFXOPSP EQU   QAFXOPER+QAFXSYSP   COMBINATION OF OPER AND SYSP   ONL02
QAFXDFLT EQU   QAFXACTV+QAFXBLOG+QAFXSSSM+QAFXSLOG  DEFAULT AUTH  ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  QASCFLGS BIT DEFINITIONS  (SUB-COMMAND TYPE FLAGS)             ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
QASXACTV EQU   QAFXACTV            ACTIVE DISPLAY                 ONL02
QASXBLOG EQU   QAFXBLOG            BACKLOG DISPLAY                ONL02
QASXSSSM EQU   QAFXSSSM            CMD USES SUB-SYSTEM INTERFACE  ONL02
QASXSLOG EQU   QAFXSLOG            SYSLOG COMMAND                 ONL02
QASXEXEC EQU   QAFXEXEC            GIVES CONTROL TO OTHER PROGAMS ONL02
QASXOPER EQU   QAFXOPER            OPERATOR AUTHORITY NEEDED      ONL02
QASXSYSP EQU   QAFXSYSP            JES2 SYS-PGMR AUTHORITY NEEDED ONL02
         SPACE 2                                                  ONL02
*                                                                 ONL02
*  QAHELP BIT DEFINITIONS  (HELP DISPLAY CONTROL FLAGS)           ONL02
*                                                                 ONL02
         SPACE 1                                                  ONL02
QAHXACTV EQU   QAFXACTV            SHOW HELP FOR ACTIVE DISPLAYS  ONL02
QAHXBLOG EQU   QAFXBLOG            SHOW HELP FOR BACKLOG DISPLAYS ONL02
QAHXSSSM EQU   QAFXSSSM            SHOW HELP FOR SSSM COMMANDS    ONL02
QAHXSLOG EQU   QAFXSLOG            SHOW HELP FOR SYSLOG           ONL02
QAHXEXEC EQU   QAFXEXEC            SHOW HELP FOR TSO/EXEC COMMANDSONL02
QAHXOPER EQU   QAFXOPER            SHOW HELP FOR OPERATOR AUTH    ONL02
QAHXSYSP EQU   QAFXSYSP            SHOW HELP FOR SYS PGMR AUTH    ONL02
         EJECT ,                                                  ONL02
***********************************************************************
*                                                                     *
*   DATASET ALLOCATION FIELDS                                         *
*      (ADAPTED FROM SYS1.MACLIB (IKJDAPL,IKJDAP08,0C,18))            *
*                                                                     *
***********************************************************************
QDAIR    DS    0D             START OF DAIR WORK AREAS
DAIRECB  DC    F'0'           ECB USED BY DAIR
DAIRFLAG DC    X'00'          FLAG USED BY ALLOCATE SUBROUTINE
         DC    XL3'0'         DEAD SPACE FOR ALLIGNMENT
***********************************************************************
*    THE DYNAMIC ALLOCATION INTERFACE ROUTINE (DAIR) PARAMETER LIST   *
*    (DAPL) IS A LIST OF ADDRESSES PASSED FROM THE INVOKER TO DAIR    *
*    VIA REGISTER 1                                                   *
***********************************************************************
DAPLUPT  DC    A(0)     PTR TO UPT
DAPLECT  DC    A(0)     PTR TO ECT
DAPLECB  DC    A(DAIRECB) PTR TO CP'S ECB
DAPLPSCB DC    A(0)     PTR TO PSCB
DAPLDAPB DC    A(0)     PTR TO DAIR PARAMETER BLOCK
***********************************************************************
*                                                                     *
*   ALLOCATE DDNAME(W) DSNAME(X) SHR UNIT(Y) VOLUME(Z)                *
*                                                                     *
***********************************************************************
DA08CD   DC    X'0008'  DAIR ENTRY CODE
DA08FLG  DC    X'00'    FUNCTIONS TO BE PERFORMED WHEN RET CODE IS 0
         DC    X'00'
DA08DARC DC    H'0'     DYN ALLOC RETURN CODE
DA08CTRC DC    H'0'     CATALOG RETURN CODE
DA08PDSN DC    A(0)     POINTER TO DSNAME TO BE SEARCHED IN DSE
DA08DDN  DC    CL8' '   DDNAME TO BE SEARCHED IN DSE
* YOU MUST SUPPLY THE DEFAULT UNIT AND VOLUME SERIAL FOR YOUR SYSTEM
*DA08UNIT DC    CL8'3350' UNITNAME FOR SYS1.HASPCKPT
DA08UNIT DC    CL8'&QCKUNIT' UNITNAME FOR SYS1.HASPCKPT
DA08SER  DC    CL8'&QCKPTV' VOLUME SERIAL FOR SYS1.HASPCKPT       UF042
DA08BLK  DC    F'0'     DATA SET  AVERAGE RECORD LENGTH
DA08PQTY DC    F'0'     PRIMARY SPACE QUANTITY
DA08SQTY DC    F'0'     SECONDARY SPACE QUANTITY
DA08DQTY DC    F'0'     DIRECTORY BLOCK QUANTITY
DA08MNM  DC    CL8' '   MEMBER NAME
DA08PSWD DC    CL8' '   PASSWORD
DA08DSP1 DC    X'08'    DATA SET STATUS FLGS - SHR
DA08DPS2 DC    X'08'    DATA SET DISPOSITION - KEEP
DA08DPS3 DC    X'08'    DATA SET CONDITIONAL DISPOSITION - KEEP
DA08CTL  DC    X'00'    FLAGS TO CONTROL ACTIONS TAKEN BY DAIR
         DC    XL3'0'   RESERVED
DA08DSO  DC    X'00'    DSORG
DA08ALN  DC    CL8' '   ATTR-LIST-NAME                           C99236
***********************************************************************
*                                                                     *
*   FREE DDNAME(XXXXXXXX)                                             *
*                                                                     *
***********************************************************************
DA18CD   DC    X'0018'  DAIR ENTRY CODE
DA18FLG  DC    X'00'    FUNCTIONS TO BE PERFORMED WHEN RET CODE IS 0
         DC    X'00'
DA18DARC DC    H'0'     DYNAMIC ALLOCATION RETURN CODE
DA18CTRC DC    H'0'     CATALOG RETURN CODE AREA
DA18PDSN DC    A(0)     POINTER TO DSNAME TO BE SEARCHED IN DSE
DA18DDN  DC    CL8' '   DDNAME TO BE SEARCHED IN DSE
DA18MNM  DC    CL8' '   MEMBER NAME
DA18SCLS DC    CL2' '   SYSOUT CLASS DESIRED WHEN UNALLOCATING  A
*                       SYSOUT DATA SET
DA18DPS2 DC    X'08'    DATA SET DISPOSITION - KEEP
DA18CTL  DC    X'10'    FLAGS FOR SPECIAL DAIR PROCESSING
DA18JBNM DC    CL8' '   IGNORED AS OF OS VS/2 RELEASE 2       Y02670
******************************************************************UF036
*                                                                 UF036
*   ALLOCATE DDNAME(W) SYSOUT(X)                                  UF036
*                                                                 UF036
******************************************************************UF036
DA30CD   DC    X'0030'  DAIR ENTRY CODE                           UF036
DA30FLG  DC    X'00'    FN TO BE PERFORMED WHEN RET CODE IS 0     UF036
         DC    X'00'                                              UF036
DA30DARC DC    H'0'     DYN ALLOC RETURN CODE                     UF036
         DC    H'0'     RESERVED                                  UF036
DA30PDSN DC    A(0)     POINTER TO DSNAME TO BE SEARCHED IN DSE   UF036
DA30DDN  DC    CL8' '   DDNAME TO BE SEARCHED IN DSE              UF036
DA30UNIT DC    CL8' '   UNIT NAME                                 UF036
DA30SER  DC    CL8' '   VOLUME SERIAL                             UF036
DA30BLK  DC    F'0'     DATA SET  AVERAGE RECORD LENGTH           UF036
DA30PQTY DC    F'0'     PRIMARY SPACE QUANTITY                    UF036
DA30SQTY DC    F'0'     SECONDARY SPACE QUANTITY                  UF036
DA30PGNM DC    CL8' '   WRITER NAME                               UF036
DA30FORM DC    CL4' '   FORM NUMBER                               UF036
DA30OCLS DC    CL2' '   SYSOUT CLASS                              UF036
         DC    X'00'    RESERVED                                  UF036
DA30CTL  DC    X'00'    FLAGS TO CONTROL ACTIONS TAKEN BY DAIR    UF036
DA30ALN  DC    CL8' '   ATTR-LIST-NAME                            UF036
         SPACE 2                                                  CL006
***********************************************************************
*                                                                     *
*        PARAMETER LIST FOR CALL OF IKJPARS                           *
*                                                                     *
***********************************************************************
         SPACE 2
PPLUPT   DC    A(*-*)              ADDR OF UPT                    CL006
PPLECT   DC    A(*-*)              ADDR OF ECT                    CL006
PPLECB   DC    A(*-*)              ADDR OF CP'S ECB               CL006
PPLPCL   DC    A(*-*)              ADDR OF PARAMETER CONTROL LIST CL006
PPLANS   DC    A(PARSBACK)         ADDR OF PDL POINTER            CL006
PPLCBUF  DC    A(*-*)              ADDR OF THE COMMAND BUFFER     CL006
PPLUWA   DC    A(0)                ADDR OF WORK AREA              CL006
PARSBACK DC    A(*-*)              ADDR OF FIRST PDL              CL006
         EJECT
***********************************************************************
*                                                                     *
*   CHECKPOINT WORK AREAS                                             *
*                                                                     *
***********************************************************************
* NOTE - BLOCKSIZES ARE INSTALLATION DEPENDENT
QCKPT    DS    0D
         AIF   (NOT &QSP133).C29A        DOR
QCTGML   DC    A(0)                NUMBER OF TGM BLOCKS           UF046
QCTGMA   DC    A(0)                ADDRESS OF TGM IOAREA          UF046
QCTNUMTG DC    A(0)                NUMBER OF TRACK GROUPS ON      CL001+
                                    ACTIVE VOLUMES                CL001
.C29A    ANOP  ,                                                  UF046
         AIF   (NOT &QSP).QSP1                                    UF020
QCJIXL   DC    A(0)                                               UF020
QCJIXA   DC    A(0)           ADDRESS OF JIX IOAREA               UF020
         AIF   (NOT &QSP136).NO136A                                 DOR
QCJQEXA  DC    A(0)                ADDR OF JQE EXTENSIONS
QCTDASL  DC    A(0)                NUMBER OF DAS CHKPT BLOCKS
QCTDASA  DC    A(0)                ADDR OF FIRST DAS BLOCK
QCPSTL   DC    A(0)                NUMBER OF PST CHKPT BLOCKS
QCPSTA   DC    A(0)                ADDR OF FIRST PST BLOCK
.NO136A  ANOP                                                       DOR
.QSP1    ANOP                                                     UF020
QCCHKA   DC    A(0)           ADDRESS OF CHK IOAREA                DOR
QCJQTA   DC    A(0)           ADDRESS OF JQT IOAREA
QCJOTA   DC    A(0)           ADDRESS OF JOT IOAREA
QCJCTA   DC    A(0)           ADDRESS OF JCT IOAREA
QCIOTA   DC    A(0)           ADDRESS OF IOT IOAREA
QCBLKA   DC    A(0)           ADDRESS OF DATASET BLOCK IOAREA
QCJQTL   DC    F'0'           ADDRESS OF FIRST CKPT REOCRD
QCJQEA   DC    A(0)           ADDR OF CURRENT JQE
QCJOTL   DC    F'0'           COUNT OF RECORDS ON CKPT DS
QBUFLEN  DC    F'0'           LENGTH OF HASP BUFFER PREFIX
QCDECBPT DC    A(0)           ADDRESS OF DECB WORK AREA           UF039
QCPDDB1  DC    F'0'           OFFSET IN IOT TO FIRST PDDB
QCTRAK   DS    0F             DISK ADDR IN THE FORM MTTR
QCTRAKM  DC    X'0'           EXTENT NUMBER
QCTRAKTT DC    X'0000'        ABSOLUTE TRACK NUMBER
QCTRAKR  DC    X'0'           RECORD NUMBER
         DC    X'0'           EXTRA SPACE NEEDED FOR HEX CONVERT
QCDAD    DS    0XL8           DISK ADDR IN THE FORM MBBCCHHR
QCDADM   DC    X'0'           EXTENT NUMBER
QCDADBB  DC    X'0000'        BIN NUMBER
QCDADCC  DC    X'0000'        CYLINDER NUMBER
QCDADHH  DC    X'0000'        HEAD NUMBER
QCDADR   DC    X'0'           RECORD NUMBER
         DC    XL3'0'         DEAD SPACE TO GET BACK TO FULLWORD
QCJQHEAD DC    A(0)           OFFSET TO JQE HEADERS
         DS    0F
QCCREC   DC    PL4'0'         CURRENT RECORD NUMBER
QCCPTR   DC    A(0)           CURRENT TABLE ADDRESS
QCHREC   DC    PL4'0'         HIGHEST RECORD NUMBER
QCHPTR   DC    A(0)           HIGHEST TABLE ADDRESS
QCSTART  DC    A(0)           ADDRESS OF TABLE START
QCEND    DC    A(0)           ADDRESS OF TABLE END
QCHLINE  DS    0CL80          HEADING LINE FOR LISTDS
QCJTYPE  DC    C'JOB '
QCJNAME  DC    CL8' '         JOBNAME
         DC    C', DSID '
QCDSNO   DC    CL8' '         DATASET ID NUMBER
         DC    C', REC #       1'
         DC    CL40' '
QCLRECL  DC    H'0'           LRECL FOR SAVE
QCRECFM  DC    X'0'           RECFM FOR SAVE
QCSPOOLS DC    36F'0'         LIST OF DCBS FOR HASPACE
QCTRKCYL DC    36F'0'         LIST OF TRACKS/CYLINDER FOR EACH DCB
         EJECT
&SIZE    SETA  4096
*ASPCKPT DCB   DDNAME=HASPCKPT,DSORG=PS,MACRF=(RCP),                  X
*              RECFM=U,BLKSIZE=&SIZE,NCP=4                        UF039
HASPCKPT DCB   DDNAME=HASPCKPT,DSORG=PS,MACRF=(RCP),                   X
               RECFM=U,BLKSIZE=&SIZE,NCP=4                        UF039
         EJECT
*ASPACE  DCB   DDNAME=HASPACE1,DSORG=DA,MACRF=(RIC),OPTCD=A,          X
*              RECFM=F
HASPACE  DCB   DDNAME=HASPACE1,DSORG=DA,MACRF=(RIC),OPTCD=A,           X
               RECFM=F
QCDCBL   EQU   *-HASPACE      LENGTH OF HASPACE DCB
         EJECT
*COUT    DCB   DDNAME=HASPSAVE,DSORG=PS,MACRF=(PM),BUFL=8192
QCOUT    DCB   DDNAME=HASPSAVE,DSORG=PS,MACRF=(PM),BUFL=8192
         EJECT
*        READ  HDECB1,SF,HASPCKPT,,&SIZE,MF=L
         READ  HDECB1,SF,HASPCKPT,,&SIZE,MF=L
HDECB1L  EQU   *-HDECB1            LENGTH OF DECB                 UF039
         SPACE 3
*        READ  HDECB2,DI,HASPACE,,0,0,QCDAD,MF=L
         READ  HDECB2,DI,HASPACE,,0,0,QCDAD,MF=L
         SPACE 3
*COPEN   OPEN  (QCOUT,OUTPUT),MF=L
QCOPEN   OPEN  (QCOUT,OUTPUT),MF=L
         SPACE 3
*OCKPT   OPEN  (HASPCKPT),MF=L
HOCKPT   OPEN  (HASPCKPT),MF=L
         EJECT
***********************************************************************
*                                                                  FCI*
*   PRINT WORKAREA                                                 FCI*
*                                                                  FCI*
***********************************************************************
QCPRINT  DS    0D                                                  FCI*
QPOFF0   DC    H'0'           OFFSET TO SUBCOMMAND                 FCI*
QPLNG0   DC    H'0'           LENGTH OF SUBCOMMAND                 FCI*
QPSUBNME DC    CL8'PRINT'     NAME OF SUBCOMMAND                   FCI*
QPOFF1   DC    H'0'           OFFSET TO QPPARM1                    FCI*
QPLNG1   DC    H'0'           LENGTH OF QPPARM1                    FCI*
QPPARM1  DC    CL8' '         USER SUPPLIED PARAMETER #1           FCI*
QPOFF2   DC    H'0'                                                FCI*
QPLNG2   DC    H'0'                                                FCI*
QPPARM2  DC    CL8' '                                 #2           FCI*
QPOFF3   DC    H'0'                                                FCI*
QPLNG3   DC    H'0'                                                FCI*
QPPARM3  DC    CL8' '                                 #3           FCI*
QPOFF4   DC    H'0'                                                FCI*
QPLNG4   DC    H'0'                                                FCI*
QPPARM4  DC    CL8' '                                 #4           FCI*
QPHEAD1  DC    CL1'1'                                              FCI*
*        123456789.123456789.123456789.123456789.'                 FCI*
 DC CL40'QUEUE HARDCOPY LOG  USER=XXXXXXXX  DATE='                 FCI*
 DC CL40'YY.DDD  HH:MM:SS DAY MON DD,19XX   XXXXX'                 FCI*
 DC CL52' '                                                       UF003
         ORG   QPHEAD1+26                                          FCI*
QPUSER   DS    CL8           FOR USERID                            FCI*
         ORG   QPHEAD1+41                                          FCI*
QPDATE   DS    CL32                                                FCI*
         ORG   QPHEAD1+75                                          FCI*
QPPAGE#  DS    CL6                                                 FCI*
         ORG   ,                                                   FCI*
QPHEAD2  DS    0CL81                                               FCI*
         DC    C' ',80C'-'                                         FCI*
         DC    52C' '                                             UF003
QPDETAIL DC    CL1' '         ASA CONTROL CHARACTER                FCI*
QPLINE   DC    CL132' '       TO HOLD PRINT LINE                  UF003
QPPAGE   DC    PL3'1'                                              FCI*
QPFLAG   DC    XL1'00'                                             FCI*
HARDCPY  EQU   X'80'                                               FCI*
QPRSAVE  DS    CL63           SAVE AREA TO HOLD SUBTITLE INFO      FCI*
QPPWORK  DC    6F'0'          SPARE WORK ZONE                      FCI*
         DS    0F                                                  FCI*
*HASPPRNT DCB  DDNAME=HASPPRNT,DSORG=PS,MACRF=(PM),                FCI*
*              RECFM=FA,LRECL=133,BLKSIZE=133                     UF003
HASPPRNT DCB   DDNAME=HASPPRNT,DSORG=PS,MACRF=(PM),                FCI*X
               RECFM=FA,LRECL=133,BLKSIZE=133                     UF003
         EJECT ,                                                  ONL02
         AIF   (NOT &QRACF).RNB03A                                RNB03
******************************************************************RNB03
*                                                                *RNB03
*   RACF FIELDS                                                  *RNB03
*                                                                *RNB03
******************************************************************RNB03
         SPACE 1                                                  RNB03
&RACLEN  SETA  K'&QRACUSR       LENGTH OF NEW RACF USERID         RNB03
QNEWUSR  DC    AL1(&RACLEN),CL8'&QRACUSR'  NEW USERID             RNB03
QUSRSAV  EQU   *,9                         OLD USERID             RNB03
         DC    AL1(0),CL8' '               OLD USERID             RNB03
QRACNMXP DC    CL8'QUEUEXP'       ENTITY FOR RACHECK FOR XP CMD   RNB03
QRACNMXD DC    CL8'QUEUEXDS'      ENTITY FOR RACHECK FOR XDS CMD  RNB03
         SPACE 1                                                  RNB03
*RACHECK RACHECK ENTITY=QRACNMXP,CLASS='APPL',ATTR=READ,          RNB03
*              APPL=QRACNMXP,MF=L                                 RNB03
QRACHECK RACHECK ENTITY=QRACNMXP,CLASS='APPL',ATTR=READ,          RNB03X
               APPL=QRACNMXP,MF=L                                 RNB03
.RNB03A  ANOP                                                     RNB03
***********************************************************************
*                                                                     *
*   LIST FORM OF TPUT/TGET                                            *
*                                                                     *
***********************************************************************
QTPUT    TPUT  QDSCREEN,QDSLNG,FULLSCR,MF=L
QTGET    TGET  QDREPLY,63,MF=L
         EJECT
***********************************************************************
*                                                                     *
*   DISPLAY WORK FIELDS                                               *
*                                                                     *
***********************************************************************
QDISPLAY DS    0D             START OS DISPLAY WORK AREA
QDOSZR0  DC    F'0'           ORIG SCREEN DEPTH                   UF003
QDOSZR1  DC    F'0'           ORIG SCREEN LINESZ                  UF003
QDLNELEN DC    H'80'          LENGTH OF DISPLAY LINE              UF003
QDLNES   DC    PL2'21'        LINES PER SCREEN                    UF003
         ORG   QDLNES
QDLINES  DC    PL2'21'        SAME AS QDLNES
QDSCRLEN DC    AL2(21*80)     LEN OF DISPLAY AREA                 UF003
QDSCRPLN DC    AL2(21*80+QDLINE1-QDSCREEN)   WHAT A PAIN          UF003
         DS    0D                                                 UF003
         AIF   (NOT &QPFK).PFK1
PFREPLY  DS    0CL69                                               ICBC
PFCODE   DC    CL6' '                                              ICBC
PFTXT    DC    CL63' '                                             ICBC
.PFK1    ANOP
QDMSGA   DC    A(0)           ADDRESS OF MESSAGE TO BE DISPLAYED
QDMLNG   DC    H'0'           MESSAGE LENGTH
QDMSG    DC    CL80' '        WORK AREA FOR BUILDING OUTPUT LINE
&Q1CMDL  SETA  K'&Q1CMD       LENGTH OF FIRST COMMAND             UF042
QDRLNG   DC    AL2(&Q1CMDL)   REPLY LENGTH                        UF018
QDREPLY  DC    CL63'&Q1CMD'   TERMINAL USER REPLY                 UF018
         DC    C' '           RESERVED
QDNEXT   DC    H'0'           CURRENT LINE NUMBER ON SCREEN
         DC    C' '           RESERVED
QDSCREEN DS    0C             DISPLAY SCREEN
         DC    X'27'          CONTROL                             UF003
QDSCRO1  DC    X'F5'          ERASE/WRITE ALTERNATE (132 COL)     UF003
         DC    X'C1115D7F1140403C404000' CLEAR SCREEN
         DC    C'QUEUE COMMAND -' TITLE LINE
         DC    X'1DC8'        MARK NEXT FIELD AS INPUT FIELD
QDTLINE  DC    CL63' '        SUBTITLE
         DC    X'1DF0'        TERMINATE INPUT FIELD
         DC    X'11'          SET BUFFER ADDRESS                  UF003
QDSCRO2  DC    X'C150'        (2,1)                               UF003
QDHLINE  DC    CL80' '        HEADING LINE
         DC    X'11'          SET BUFFER ADDRESS                  UF003
QDSCRO3  DC    X'5CF0'        (24,1)                              UF003
         DC    C'REPLY -'     REPLY PROMPT
*        DC    X'1DC8115DF71DF0' 3270 CONTROL CHARACTERS          UF003
         DC    X'1DC8'        MARK NEXT FIELD AS INPUT FIELD      UF003
         DC    X'13'          SET CURSOR ADDRESS                  UF003
         DC    X'11'          SET BUFFER ADDRESS                  UF003
QDSCRO4  DC    X'5DF7'        (24,72)                             UF003
         DC    X'1DF0'        TERMINATE INPUT FIELD               UF003
QDPLUS   DC    C' '           INDICATES MORE TO BE DISPLAYED
         DC    X'11'          SET BUFFER ADDRESS                  UF003
QDSCRO5  DC    X'C260'        (3,1)                               UF003
QDLINE1  DC    40CL80' '      MESSAGE TEXT AREA (FOR 40X80 MAX)   UF003
*DLINE1  DC    CL80' '        FIRST MESSAGE LINE ON SCREEN        UF003
*        DC    20CL80' '      NEXT 20 LINES                       UF003
*        DC    X'115CF813'    TCAM REQUIRES CURSOR AT END OF STR  UF003
QDLINEND EQU   *              END OF LINE BUFFERS                 UF003
QDSLNG   EQU   *-QDSCREEN     LENGTH OF SCREEN BUFFER
QDOVER   DC    X'00'          PAGE OVERFLOW INDICATOR
         SPACE 3                                                  UF043
         AIF  (NOT &QPFK).PFK3                                     ICBC
* PF-KEY DEFINITIONS                                               ICBC
QDPFKTAB EQU   *                                                   ICBC
         DC    CL8'&QPF(1)'                                       UF043
         DC    CL8'&QPF(2)'                                       UF043
         DC    CL8'&QPF(3)'                                       UF043
         DC    CL8'&QPF(4)'                                       UF043
         DC    CL8'&QPF(5)'                                       UF043
         DC    CL8'&QPF(6)'                                       UF043
         DC    CL8'&QPF(7)'                                       UF043
         DC    CL8'&QPF(8)'                                       UF043
         DC    CL8'&QPF(9)'                                       UF043
         DC    CL8'&QPF(10)'                                      UF043
         DC    CL8'&QPF(11)'                                      UF043
         DC    CL8'&QPF(12)'                                      UF043
.PFK3    ANOP                                                      ICBC
         EJECT
***********************************************************************
*                                                                     *
*   SAVE AREA FOR GETMAIN/FREEMAIN                                    *
*                                                                     *
***********************************************************************
QGETAREA DC    3F'0'
QGETA1   EQU   QGETAREA+0
QGETA2   EQU   QGETAREA+4
QGETA3   EQU   QGETAREA+8
QGETLNGH DC    F'65536',2F'0'
QGETL2   EQU   QGETLNGH+4
QGETL3   EQU   QGETLNGH+8
QFREE    FREEMAIN L,LA=QGETLNGH,A=QGETAREA,MF=L
         EJECT
**********************************************************************
*                                                                    *
*   INSERT BY DOR/CDSI TO SUPPORT DIALOG MANAGEMENT INTERFACE        *
*                                                                    *
*     MUST BE A LAST STATEMENT OF QCOMMON (BEFORE MEND STATEMENT)    *
**********************************************************************
         AIF   (NOT &QISPF).NOISPF
QISP#    DC    CL8' '         ISPF DIAGLOG MESSAGE ID
QISPSCR  DC    F'0'
QLNG69   DC    F'69'
QISPR12  DC    F'0'
QISPR13  DC    F'0'
*VDEF     DC    CL8'VDEFINE'   DIAGLOG SERVICE
VDISPLAY DC    CL8'DISPLAY' DIAGLOG SERVICE
VQDLINE  DC    CL10'(QSCREEN)' ISPF VARIABLE NAME
VQREPLY  DC    CL10'(QREPLY)'  ISPF VARIABLE NAME
VCHAR    DC    CL8'CHAR'
VQPANEL  DC    CL9'QISPANEL' ISPF PANEL NAME
VREPLY   DC    CL8'QREPLY'   ISPF CURSOR FIELD
         DS    0F         FULLWORD BOUNDARY
.NOISPF  ANOP
         EJECT
QSUSWT    DC   X'00'
QDQTTY    DS   0F
SYSPRINT DCB   DDNAME=SYSPRINT,DSORG=PS,MACRF=(PM),                DST*X
               RECFM=F,LRECL=133,BLKSIZE=133                       DST*
SYSIN    DCB   DDNAME=SYSIN,DSORG=PS,MACRF=(GM),                   DST*X
               RECFM=F,LRECL=80,BLKSIZE=80                         DST*
INOPEN   OPEN  (SYSIN),MF=L
OUTOPEN  OPEN  (SYSPRINT,OUTPUT),MF=L
QTTY     DC    X'00'          FLAG FOR TTY OUTPUT                   DST
         EJECT
SNAPOPN  OPEN  (SNAPX,OUTPUT),MF=L
*NAPEXEC SNAP  DCB=SNAPX,PDATA=ALL,SDATA=ALL,LIST=QAREA,ID=255,MF=L
*NAPEXEA SNAP DCB=SNAPX,PDATA=(PSW,REGS),SDATA=(ERR),
*              LIST=QAREA,ID=255,MF=L
         DS    0F
SNAP1    EQU   *
QAREA    DC    A(QVDSPL) DUMP FULL OF QCOMMON AREA
SNAP2    DC    0F'0',X'80',AL3(QTTY)
SNAPSWT  DC    X'00'
SNAPX    DCB   DDNAME=SYSSNAP,BLKSIZE=882,DSORG=PS,LRECL=125,          X
               MACRF=(W),RECFM=VBA
         DS    0F
*     SYSTEM COMMAND PROCEDURE
QPOPER   DC    A(QPOPRA)
QPOPRA   DC    A(QPOPRL)
QPOPR2   DC    XL1'80',AL3(QPOPRN)
QPOPRN   DC    F'0'
QPOPRL   DC    H'0'
QPOPRD   DC    CL80' '
*     SAVE DSECT UNDER R13 BY GETMAIN  FOR EXTRA WORK AREA
QSVDSECT  DC   F'0'
QR13SAVE  DC   F'0'
*     CPPL   COMMAND BUFFER
QPCBUFL   DC   H'0'
QPCBUFO   DC   H'0'
QPCBUFD   DC   CL80' '
         AIF   (NOT &QWTO).NOWTO
         DS    0F
CHGWTO   WTO   'UUU QUEUE CMD: XXXX          ',                        X
               MF=L,DESC=4,ROUTCDE=(2,10)
USERIDX  EQU   CHGWTO+4  POS. +4
CHGCMD   EQU   CHGWTO+19
.NOWTO   ANOP
QCPUSTR  DS    0CL15
         DC    CL6'SYSID='
QCPUID   DS    CL4
         DC    CL1'/'
QCPUMDL  DS    CL4
QDHELP   DC    CL8'TQTOPICS'   NAME OF TUTORIAL PANEL
         MEND
./       ADD   NAME=QGUIDE
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1 -
*    R2   -
*    R3 -
*    R4   -
*    R5   -
*    R6   -
*    R7 -
*    R8   -
*    R9   -
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
./       ADD   NAME=QI@A
)ATTR DEFAULT(%!_)
  %  TYPE(TEXT)  INTENS(HIGH)  SKIP(ON)
  !  TYPE(TEXT)  INTENS(LOW)   SKIP(ON)
)BODY
% &ZTIME !-- &QSCRT0
%QUEUE CMD=>_ZCMD
&QSCRH0
&QSCR01
&QSCR02
&QSCR03
&QSCR04
&QSCR05
&QSCR06
&QSCR07
&QSCR08
&QSCR09
&QSCR10
&QSCR11
&QSCR12
&QSCR13
&QSCR14
&QSCR15
&QSCR16
&QSCR17
&QSCR18
&QSCR19
&QSCR20
&QSCR21
)INIT
  &ZCMD=&Z
)PROC
)END
./       ADD   NAME=QI@CMDS

B 
0



SETVERB

PGM(ISPTUTOR) PARM(&ZPARM) NOFUNC
CT CMD(&ZPARM)
PT) PARM(ISPOPT3)

CREENN
CURSOR
 SCREEN IMAGE (WITH HIGH INTENSITY OVERSTRIKE)

EN IMAGE
NC
REEN VERTICALLY USING HARDWARE PARTITIONS
./       ADD   NAME=QI@PROF

DV0 ./%bqt
F?=
RETURN	ZPF05   
	ZPF11   
PF17   
 
VE          	ZPF24   
L14  
  

PFL12  
PAD
PAD
PAD
PAD
PAD                                                      
./       ADD   NAME=QI@TEMP
)ATTR DEFAULT(%!_)
  %  TYPE(TEXT)  INTENS(HIGH)  SKIP(ON)
  !  TYPE(TEXT)  INTENS(LOW)   SKIP(ON)
  #  AREA(DYNAMIC) EXTEND(ON) SCROLL(ON)
)BODY WIDTH(&ZSCREENW) EXPAND(//)
% &ZTIME !-- &QSCRT0
%QUEV2 CMD=>_ZCMD
&QSCRH0
#QSBUF1 -----------------------/-/--------------------------------------
)INIT
  .HELP = &QI@HELP
  &ZCMD=&Z
)PROC
&QILVLN = LVLINE(QSBUF1)
)END
./       ADD   NAME=QI@V2
)ATTR DEFAULT(%!_)
  %  TYPE(TEXT)  INTENS(HIGH)  SKIP(ON)
  !  TYPE(TEXT)  INTENS(LOW)   SKIP(ON)
  #  AREA(DYNAMIC) EXTEND(ON) SCROLL(ON)
)BODY WIDTH(&ZSCREENW) EXPAND(//)
% &ZTIME !-- &QSCRT0
%QUEV2 CMD=>_ZCMD
&QSCRH0
#QSBUF1 -----------------------/-/--------------------------------------
)INIT
  .HELP = &QI@HELP
  &ZCMD=&Z
)PROC
&QILVLN = LVLINE(QSBUF1)
)END
./       ADD   NAME=QISPANEL
%---------------------  JES2 QUEUE SUPPORT -----------------------------
%QUEUE COMMAND ===>_QREPLY
%                                                           +TIME     -
&QSCREEN
)INIT
)PROC
)END
./       ADD   NAME=QITASID
%----------ISPF QUEUE ASID COMMAND   -    TUTORIAL PANEL  -------------
%
+  THE ASID COMMAND DISPLAYS INFORMATION ON THE ADDRESS SPACES.
+
+   QUEUE COMMAND SYNTAX -
+         ASID    'ASID#'/*  STC/JOBS/TS/ALL
+                 (DEFAULTS - ASID ALL )
+----------------------------------------------------------------------
+
+   OPERANDS -
+  'ASID#'   - ADDRESS SPACE IDENTIFICATION NUMBER.  AN ASTERISK (*)
+              INDICATES CURRENT TSO USER.
+  STC       - DISPLAY STARTED OR SYSTEM TASKS.
+  JOBS      - DISPLAY JOBS ON JES INITIATORS.
+  TS        - DISPLAY TSO USERS.
+  ALL       - PERFORM SYSTEM, INITIATOR AND TSO FUNCTIONS.
+
%            ( CONTINUE FOR ASID OUTPUT FORMAT)
+
)PROC
     &CONT = QITASID
)END
./       ADD   NAME=QITASID2
%----------ISPF QUEUE ASID COMMAND   -    TUTORIAL PANEL  -------------
%
+            ASID OUTPUT HAS THE FOLLOWING FORMAT :
+
+ID DP JOB  STEP  FLAGS CPU-TIME REAL WORK  G/P/D  SRC SC SERV TRC SERV
+WHERE
+ ID - ASID NUMBER; DP - DISPATCHING PRIORITY; JOB - JOBNAME; STEP - STE
+ FLAGS - XXXYY
+ XXX
+ IN  - IN CORE, SWAPPED IN
+       (DEFAULT IF NONE OF THE BELOW)
+ NSW - NON-SWAPPABLE                         TW  - TERMINAL WAIT
+ PVL - PRIVILEDGED (NON-SWAPPABLE            MW  - LONG WAIT STATUS
+       EXCEPT FOR LONG WAIT)                       DETECTED BY MSO (MS
+ AXS - AUX SHORTAGE FORCED SWAP              LW  - EXPLICIT LONG WAIT
+ OUT - SWAPPED OUT                           NW  - NON-SWAPPABLE WAIT
+ GOO - IN PROCESS OF BEING SWAPPED OUT       OW  - OUTPUT TERMINAL WAI
+ GOI - IN PROCESS OF BEING SWAPPED IN        CP  - SIGINIFICANT CPU US
+ GOB - CURRENTLY CHANGING STATUS                   (SET BY IRARMCPM)
+ ENQ - TEMPORARILY NON-SWAPPABLE DUE TO ENQ
+ APG - AUTOMATIC-PRIORITY-GROUP APPLIES
+ RMA - RMA ALGORITHM APPLIES (RTB=0)
+  CPU TIME - STEP CPU TIME IN HOURS:MINUTES:SECONDS
+      REAL - AMOUNT OF REAL CORE AT LAST PAGE-IN
+      WORK - WORKING SET SIZE AT LAST SWAPIN
+     G/P/D - PERFORMANCE GROUP/PERFORMANCE GROUP PERIOD/DOMAIN
+       SRC - SWAP OUT REASON CODES
+             OTW - OUTPUT TERMINAL WAIT
+             ITW - INPUT TERMINAL WAIT
+              LW - LONGWAIT
+             ASS - AUXILIARY STORAGE SHORTAGE
+             RSS - REAL PAGEABLE STORAGE SHORTAGE
+              DT - DETECTED WAIT
+              RS - REQUESTED SWAP
+              EE - ENQ EXCHANGE
+             ERV - EXCHANGE OF RECOMMENDATION VALUE
+               U - UNILATERAL
+       SWC - NUMBER OF SWAPS FOR CURRENT TRANSACTION
+      SERV - SERVICE UNITS ACCUMALATED FOR CURRENT TRANSACTION
+       TRC - NUMBER OF TRANSACTIONS DURING SESSION
+      SERV - SERVICE UNITS ACCUMALATED DURING SESSION
+
)PROC
     &CONT = TFLIST2
)END
./       ADD   NAME=QI4T
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INITNEW)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QI4T
 NAME ISPQ134X(R)
./       ADD   NAME=QMHELP
            MACRO
            QMHELP
            MHELP B'11111'
            MEND
./       ADD   NAME=QMHELPOF
            MACRO
            QMHELP
            MHELP B'00000'
            MEND
./       ADD   NAME=QPRBGEN
         MACRO ,                                                  ONL01
&LABEL   QPRBGEN &TYPE                                            ONL01
         GBLB  &QBGEN                                             ONL01
         AIF   ('&TYPE' EQ 'BEGIN').BEGIN                         ONL01
         AIF   ('&TYPE' EQ 'DONE').DONE                           ONL01
         MNOTE 4,'PRTGENB MACRO - INVALID OPERAND'                ONL01
         MEXIT ,                                                  ONL01
.BEGIN   ANOP  ,                                                  ONL01
         PUSH  PRINT               SAVE CURRENT PRINT STATUS      ONL01
         AIF   (&QBGEN).GEN                                       ONL01
         PRINT NOGEN               DON'T EXPAND CNTL BLOCK MACROS ONL01
         MEXIT ,                                                  ONL01
.GEN     ANOP  ,                                                  ONL01
         PRINT GEN                 EXPAND CNTL BLOCK MACROS       ONL01
         MEXIT ,                                                  ONL01
.DONE    ANOP  ,                                                  ONL01
         POP   PRINT               RESTORE PRINT STATUS           ONL01
         MEND  ,                                                  ONL01
./       ADD   NAME=QSCE
         MACRO ,                                                  ONL02
&NAME    QSCE  &CMDTEXT,&ADDR,&FNC=0,&TYPE=0,&USER=0              ONL02
.*****************************************************************ONL02
.*                                                                ONL02
.* MACRO NAME = QSCE                                              ONL02
.*                                                                ONL02
.* MODIFICATION ID = ONL02                                        ONL02
.*                                                                ONL02
.* DESCRIPTIVE NAME =  QUEUE SUB-COMMAND ENTRY                    ONL02
.*                                                                ONL02
.* AUTHOR = ROBERT M. JINKINS                                     ONL02
.*          OAK RIDGE NATIONAL LABORATORY                         ONL02
.*          BLDG. 4500-N  MS-259                                  ONL02
.*          P.O. BOX X                                            ONL02
.*          OAK RIDGE, TENNESSEE  37830                           ONL02
.*                                                                ONL02
.*          PHONE: (615) 574-7208/5300                            ONL02
.*                  FTS  624-7208/5300                            ONL02
.*                                                                ONL02
.*          SHARE INSTALLATION CODE = OR                          ONL02
.*                                                                ONL02
.* DATE WRITTEN = JUNE 83                                         ONL02
.*                                                                ONL02
.* FUNCTION = THIS MACRO DEFINES PARSE TABLE ENTRIES FOR QUEUE    ONL02
.*    SUB-COMMANDS.                                               ONL02
.*                                                                ONL02
.* SYNTAX:  LLLL QSCE XXXX,AAAA,FNC=CCCC,TYPE=TTTT,USER=UUUU      ONL02
.*                                                                ONL02
.*   WHERE:                                                       ONL02
.*     LLLL - IS AN OPTIONL LABEL.                                ONL02
.*     XXXX - IS THE SUB-COMMAND NAME.  THE NAME MUST BE          ONL02
.*            ENCLOSED IN APOSTROPHES IF SPECIAL CHARACTERS       ONL02
.*            ARE USED.  THE ASSEMBLED LENGTH MUST NOT EXCEED     ONL02
.*            FOUR CHARACTERS.                                    ONL02
.*     AAAA - IS A V-TYPE ADDRESS CONSTANT FOR THE ROUTINE        ONL02
.*            WHICH WILL PROCESS THE SUB-COMMAND.                 ONL02
.*     CCCC - IS AN OPTIONAL FUNCTION CODE USED BY THE SUB--      ONL02
.*            COMMAND PROCESSING ROUTINE.                         ONL02
.*     TTTT - IS AN OPTIONAL COMMAND TYPE CLASSIFICATION          ONL02
.*            USED FOR SUB-COMMAND AUTHORIZATION.  THE            ONL02
.*            EQUATES FOR USE WITH THIS OPERAND MAY BE            ONL02
.*            FOUND IN THE QCOMMON DSECT.                         ONL02
.*     UUUU - IS THE SAME AS 'TTTT' ABOVE, BUT IS INTENDED        ONL02
.*            FOR AUTHORIZATION CHECKING SPECIFIC TO YOUR         ONL02
.*            INSTALLATION.                                       ONL02
.*                                                                ONL02
.* CHANGE ACTIVITY = NONE                                         ONL02
.*                                                                ONL02
.*****************************************************************ONL02
         LCLC  &CMD                                               ONL02
&CMD     SETC  '&CMDTEXT'                                         ONL02
         AIF   ('&CMD'(1,1) EQ '''').SKIP                         ONL02
&CMD     SETC  ''''.'&CMDTEXT'.''''                               ONL02
.SKIP    ANOP  ,                                                  ONL02
&NAME    DC    0F'0',CL4&CMD,V(&ADDR),Y(&FNC),AL1(&TYPE,&USER)    ONL02
         MEND  ,                                                  ONL02
./       ADD   NAME=QSCH
         MACRO ,                                                  DOR
&NAME    QSCH  &CMDTEXT,&TUTR                                     DOR
.*****************************************************************DOR
.*                                                                DOR
.* MACRO NAME = QSCH                                              DOR
.*                                                                DOR
.* MODIFICATION ID = DOR                                          DOR
.*                                                                DOR
.* DESCRIPTIVE NAME =  QUEUE TUTORIAL SUB-COMMAND ENTRY           DOR
.*                                                                DOR
.*                                                                DOR
.* FUNCTION = THIS MACRO DEFINES PARSE TABLE ENTRIES FOR QUEUE    DOR
.*    TUTORIAL SUB-COMMANDS.                                      DOR
.*                                                                DOR
.* SYNTAX:  LLLL QSCE XXXX,AAAA                                   DOR
.*                                                                DOR
.*   WHERE:                                                       DOR
.*     LLLL - IS AN OPTIONL LABEL.                                DOR
.*     XXXX - IS THE TUTORIAL SUB-COMMAND NAME. THE NAME MUST BE  DOR
.*            ENCLOSED IN APOSTROPHES IF SPECIAL CHARACTERS       DOR
.*            ARE USED.  THE ASSEMBLED LENGTH MUST NOT EXCEED     DOR
.*            FOUR CHARACTERS.                                    DOR
.*                                                                DOR
.* CHANGE ACTIVITY = NONE                                         DOR
.*                                                                DOR
.*****************************************************************DOR
         LCLC  &CMD                                               DOR
&CMD     SETC  '&CMDTEXT'                                         DOR
         AIF   ('&CMD'(1,1) EQ '''').SKIP                         DOR
&CMD     SETC  ''''.'&CMDTEXT'.''''                               DOR
.SKIP    ANOP  ,                                                  DOR
         LCLC  &TUTOR                                             DOR
&TUTOR   SETC  '&TUTR'                                            DOR
         AIF   ('&TUTOR'(1,1) EQ '''').SKIPT                      DOR
&TUTOR   SETC  ''''.'&TUTR'.''''                                  DOR
.SKIPT   ANOP  ,                                                  DOR
&NAME    DC    CL4&CMD,CL8&TUTOR                                  DOR
         MEND  ,                                                  DOR
./       ADD   NAME=QSTART
         MACRO
&NAME    QSTART &TITLE,&MAIN=NO,&TYPE=NORMAL,&HASPEQU=NO,&XTITLE=
.*      HASPEQU ADDED FOR SP136  DOR  2-27-87
.*      XTITLE (EXTENDED TITLE) ADDED FOR SP136  DOR  2-27-87
         GBLB  &QISPF         ISPF INTERFACE OPTIONDOR
         GBLB  &QISPF2        ISPF V2 OPTION FLAG  DOR
         GBLB  &QSYSP       SYSTEM PGMMER INDICATOR FOR EXTRA CMDS DOR
         GBLB  &QWTO        DISPLAY CMD NAME & WHO ON SYSLOG       DOR
         GBLB  &QCDSI        SP 1.3.0 VOL=SER= NAME     DOR
         GBLB  &QTSS        ENABLE TOP SECURITY CODE DOR
         GBLB  &QPFK          PF-KEY OPTION
         GBLB  &QACF2         ACF2 AUTH CHECKING                   FCI*
         GBLB  &QSP           MVS/SP LEVEL OF JES2.               UF020
         GBLB  &QSP133        MVS/SP 1.3.3 LEVEL OF JES2          UF046
         GBLB  &QSP134        MVS/SP 1.3.4 LEVEL OF JES2          DOR
         GBLB  &QSP136        MVS/SP 1.3.6 LEVEL OF JES2          DOR
         GBLB  &QGEN          FORCE PRINT GEN OF MACRO EXPANSIONS UF019
         GBLB  &QBGEN         FORCE PRINT GEN OF CNTL BLOCK MACROSONL01
         GBLB  &QJTIP         JTIP PRODUCT INSTALLED              UF025
         GBLB  &QDBC          DBC  PRODUCT INSTALLED              UF024
         GBLB  &QRNB          ENABLES RNB-SPECIFIC CODE           RNB05
         GBLB  &QRACF         RACF CHECKING                       RNB03
         GBLC  &QRACUSR       NEW RACF USERID                     RNB03
         GBLB  &QNERDC        ENABLES NERDC SPECIFIC CODE         UF032
         GBLB  &QONL          ENABLES ONL SPECIFIC CODE           ONL06
         GBLB  &LOCK          ENABLES LOCKHEED SPECIFIC CODE         CL
         GBLC  &QDSPRFX       DEFINES HASPCKPT/HASPACE DSN PREFIX ONL09
         GBLC  &QCKPTV        VOLSER OF CHECKPOINT VOLUME         UF042
         GBLC  &QCKUNIT       UNITNAME OF CHECKPOINT VOLUME     DOR
         GBLC  &QSIDS(7)      SMF ID'S OF SHARED CPU'S            UF042
         GBLC  &Q1CMD         DEFAULT FIRST COMMAND               UF042
         GBLC  &QPF(24)       PFK DEFINITIONS                     UF042
         GBLC  &ATITLE                                            DOR
&ATITLE  SETC  '-*-'
         AIF  ('&TITLE' EQ '').NILT                              DOR
&ATITLE  SETC  '&TITLE'
         AGO    .NILTIT                                           DOR
.NILT    ANOP                                                     DOR
         AIF  ('&XTITLE' EQ '').NILTIT                           DOR
&ATITLE   SETC  '&XTITLE'   EXTENDED TITLE STRING                 DOR
.NILTIT  ANOP                                                     DOR
.* QISPF=0 SELECTS NO ISPF INTERFACE                               DOR
.* QISPF=1 SELECTS ISPF INTERFACE                                  DOR
.* QISPF1=0 SELECTS ISPF V1                                        DOR
.* QISPF1=1 SELECTS ISPF V2                                        DOR
.* QSYSP=0 SELECTS NO CMDS - SAVE 100K OR MORE STORAGE CORE        DOR
.* QSYSP=1 SELECTS ALL COMMANDS FOR SYSTEM PROGRAMMERS             DOR
.* QWTO=0 NO DISPLAY OF WHAT CMD & WHO ON SYSLOG                  DOR
.* QWTO=1    DISPLAY OF WHAT CMD & WHO ON SYSLOG                  DOR
.*QCDSI=0 SELECTS PRE SP 1.3.0 SUPPORT                           DOR
.*QCDSI=1 SELECTS SP 1.3.0 SUPPORT                               DOR
.*QTSS=0 SELECTS TOP SECRET PRODUCT                             DOR
.*QTSS=1 SELECTS TOP SECRET PRODUCT                             DOR
.*     TSS REQUIRED NO TESTAUTH
.* QPFK=0 SELECTS NO PF-KEY SUPPORT
.* QPFK=1 SELECTS PF=KEY SUPPORT
.*QACF2=0 SELECTS NO ACF2 CHECKING (SHOPS WITHOUT ACF2)            FCI*
.*QACF2=1 SELECTS ACF2 AUTH TO SYSOUT VIA DSN='SYSOUT.LID.JOBNAME' FCI*
.*  QSP=0 SELECTS PRE-SP SUPPORT                                  UF020
.*  QSP=1 SELECTS SP SUPPORT                                      UF020
.*QSP133=0 SELECTS PRE SP 1.3.3 SUPPORT                           UF046
.*QSP133=1 SELECTS SP 1.3.3 OR SP134 SUPPORT DOR
.*QSP136=0 SELECTS PRE SP 1.3.6 SUPPORT                           DOR
.*QSP136=1 SELECTS SP 1.3.6 SUPPORT                               DOR
.* QGEN=0 SELECTS PRINT NOGEN OPTION                              UF019
.* QGEN=1 SELECTS PRINT GEN OPTION                                UF019
.*QBGEN=0 SELECTS PRINT NOGEN OPTION FOR CONTROL BLOCK MACROS     ONL01
.*QBGEN=1 SELECTS PRINT GEN OPTION FOR CONTROL BLOCK MACROS       ONL01
.*QJTIP=0 SELECTS NO JTIP SUPPORT.                                UF025
.*QJTIP=1 SELECTS SHOPS WITH JTIP INSTALLED                       UF025
.* QDBC=0 SELECTS NO DBC SUPPORT.                                 UF024
.* QDBC=1 SELECTS SHOPS WITH DBC INSTALLED                        UF024
.*QRACF=0 SELECTS NO RACF SUPPORT                                 RNB03
.*QRACF=1 SELECTS RACF SUPPORT FOR ACCESS TO THE SPOOL/CHECKPOINT RNB03
.*        AND FOR THE XP AND XDS COMMANDS. DEFINE TWO RACF        RNB03
.*        RESOURCES IN CLASS(APPL): QUEUEXP WILL CONTROL THE XP   RNB03
.*        COMMAND AND QUEUEXDS WILL PROVIDE FURTHER CONTROL OVER  RNB03
.*        THE XDS COMMAND. WHEN THE RACHECK FOR THE XDS COMMAND   RNB03
.*        IS DONE, THE JOBNAME WILL BE SPECIFIED AS THE APPLID.   RNB03
.*        THUS, IF YOU SPECIFY AUDIT(ALL) FOR APPL-QUEUEXDS YOU   RNB03
.*        WILL KNOW WHAT DATA YOUR PRIVILEGED USERS HAVE BEEN     RNB03
.*        EXAMINING (AUDITORS LIKE THIS). QRACF IS NOT SUPPORTED  RNB03
.*        VIA THE SYSPARM OPTION.                                 RNB03
.*QRACUSR IS USED IF YOUR SPOOL AND CHECKPOINT ARE DEFINED TO     RNB03
.*        RACF WITH UACC=NONE. IT SPECIFIES A USERID THAT HAS     RNB03
.*        ACCESS TO THE SPOOL AND CHECKPOINT WITH READ AUTHORITY. RNB03
.*        DURING INITIALIZATION, THE SPECIFIED USERID WILL BE     RNB03
.*        SUBSTITUTED INTO THE RACF ACEE SO THE USER OF QUEUE HAS RNB03
.*        ACCESS TO THE SPOOL AND CHECKPOINT DATA SETS ONLY WHILE RNB03
.*        THE QUEUE COMMAND IS IN PROGRESS. IF QRACF=1, THEN      RNB03
.*        QRACUSR MUST BE SPECIFIED. IF YOUR SPOOL AND CHECKPOINT RNB03
.*        HAVE A UACC OF >= READ, SPECIFY QRACUSR AS NULL ('') TO RNB03
.*        BYPASS CHANGING THE ACEE USERID. QRACUSR IS NOT         RNB03
.*        SUPPORTED VIA THE SYSPARM OPTION.                       RNB03
.*                                                                UF019
&QISPF   SETB  1 DOR
&QISPF2  SETB  0 DOR ISPF V1 DEFAULT
&QSYSP   SETB  0 DOR FOR CDSI USERS
&QWTO    SETB  0 DOR NO TEST & TROUBLE SHOOTING
&QCDSI   SETB  0    DOR
&QTSS    SETB  0    DOR
&QPFK    SETB  1
&QACF2   SETB  0                                                   FCI*
&QSP     SETB  1                                                  UF020
&QSP133  SETB  1                                                  UF046
&QSP134  SETB  0                                                  DOR
&QSP136  SETB  0                                                  DOR
&QGEN    SETB  0                                                  ONL01
&QBGEN   SETB  0                                                  ONL01
&QJTIP   SETB  0                                                  UF025
&QDBC    SETB  0                                                  UF024
&QRNB    SETB  0                                                  RNB05
&QRACF   SETB  0                                                  RNB03
&QRACUSR SETC  'QCMD'                                             RNB03
&QNERDC  SETB  0                                                  UF032
&QONL    SETB  0                                                  ONL06
&QDSPRFX SETC  'SYS1'                                             ONL09
.*&QCKPTV  SETC  'SCR005'
.*&QCKPTV  SETC  'PPVOL3'
&QCKPTV  SETC  'ACCT01' 1/6/85 DOR DEFAULT
&QCKUNIT SETC  '3380'   1/6/85 DOR DEFAULT
&QSIDS(1) SETC 'IPO1'                                             UF042
&QSIDS(2) SETC 'IPO2'                                             UF042
&QSIDS(3) SETC '    '                                             UF042
&QSIDS(4) SETC '    '                                             UF042
&QSIDS(5) SETC '    '                                             UF042
&QSIDS(6) SETC '    '                                             UF042
&QSIDS(7) SETC '    '                                             UF042
&Q1CMD    SETC 'ST  '                                             UF042
&QPF(1)  SETC  'HELP'                                             UF043
&QPF(2)  SETC  'DA'                                               UF043
&QPF(3)  SETC  'END'                                              UF043
&QPF(4)  SETC  'PRINT'                                            UF043
&QPF(5)  SETC  'FIND'                                             UF043
&QPF(6)  SETC  'DI'                                               UF043
&QPF(7)  SETC  '-     21'                                         UF043
&QPF(8)  SETC  '+     21'                                         UF043
&QPF(9)  SETC  'DO'                                               UF043
&QPF(10) SETC  'CO    1'                                          UF043
&QPF(11) SETC  'CO    50'                                         UF043
&QPF(12) SETC  'ST'                                               UF043
.*                                                                UF019
         LCLA  &CNT,&CTR,&STRNG,&LNTH,&SUB                        UF019
         AIF   (K'&SYSPARM EQ 0).SYSPEND                          UF019
 MNOTE *,'SYSPARM=''&SYSPARM'''
         AIF   ('&SYSPARM'(1,1) EQ '(').MORE                      UF019
  MNOTE 2,'SYSPARM SYNTAX ERROR--MUST BE ENCLOSED IN PARENS'      UF019
         AGO   .SYSPEND                                           UF019
.MORE    ANOP                                                     UF019
&CNT     SETA  K'&SYSPARM                                         UF019
&CTR     SETA  1                                                  UF019
&STRNG   SETA  &CTR+1                                             UF019
.LOOP    AIF   ('&SYSPARM'(&CTR,1) EQ ',' OR &CTR EQ &CNT).FOUND  UF019
&CTR     SETA  &CTR+1                                             UF019
         AGO   .LOOP                                              UF019
.FOUND   ANOP                                                     UF019
&LNTH    SETA  &CTR-&STRNG                                        UF019
         AIF   (&LNTH EQ 0).NULL                                  UF019
         AIF   ('&SYSPARM'(&STRNG,4) NE 'UNIT').CKUNIT        DOR
         AIF   ('&SYSPARM'(&STRNG,5) NE 'UNIT=').CKPUEQU       DOR
         AIF   ('&SYSPARM'(&STRNG,6) EQ 'UNIT=U').CKUEQUU      DOR
&STRNG   SETA  &STRNG+5
         AGO   .CKUNITX
.CKUEQUU ANOP FOR START PROCNAME,UNIT=U3350  FOR EXAMPLE
&STRNG   SETA  &STRNG+6
.CKUNITX ANOP
&QCKUNIT SETC '&SYSPARM'(&STRNG,4)
  MNOTE *,' &QCKUNIT CHANGED HASPCKPT UNITNAME '
         AGO   .NULL
.CKPUEQU ANOP
  MNOTE 8,'CKUNIT SYNTAX ERROR--MUST BE HAVE EQUAL SYMBOL'      DOR
.CKUNIT  AIF   ('&SYSPARM'(&STRNG,4) NE 'CKPT').CKDSN         DOR
         AIF   ('&SYSPARM'(&STRNG,5) NE 'CKPT=').CKPTEQU           DOR
&STRNG   SETA  &STRNG+5
&QCKPTV  SETC '&SYSPARM'(&STRNG,6)
  MNOTE *,' &QCKPTV  CHANGED HASPCKPT VOLUME NAME '
         AGO   .NULL
.CKPTEQU ANOP
  MNOTE 8,'CKPT SYNTAX ERROR--MUST BE HAVE EQUAL SYMBOL'      DOR
.CKDSN   AIF   ('&SYSPARM'(&STRNG,4) NE 'DPRF').NOCKPT          DOR
         AIF   ('&SYSPARM'(&STRNG,5) NE 'DPRF=').CKDSEQU           DOR
&STRNG   SETA  &STRNG+5
&QDSPRFX SETC '&SYSPARM'(&STRNG,4)
  MNOTE *,' &QDSPRFX CHANGED HASPCKPT PREFIX NAME '
         AGO   .NULL
.CKDSEQU ANOP
  MNOTE 8,'CKPT SYNTAX ERROR--MUST BE HAVE EQUAL SYMBOL'      DOR
.NOCKPT  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'TSS').SPEC30        DOR
&QTSS   SETB  1                                                  DOR
.SPEC30  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOTSS').SPEC302     DOR
&QTSS   SETB  0                                                  DOR
.SPEC302 ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'CDSI').SPNC30       DOR
&QCDSI  SETB  1                                                  DOR
.SPNC30  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOCDSI').SPNC3X2    DOR
&QCDSI  SETB  0                                                  DOR
.SPNC3X2 ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SYSP').SPNC3X       DOR
&QSYSP  SETB  1                                                  DOR
.SPNC3X  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSYSP').SPNCWTO    DOR
&QSYSP  SETB  0                                                  DOR
.SPNCWTO ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'WTO').SWTO3X       DOR
&QWTO   SETB  1                                                  DOR
.SWTO3X  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOWTO').SPNC302    DOR
&QWTO   SETB  0                                                  DOR
.SPNC302 ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ISPF').SPNISP        DOR
&QISPF   SETB  1                                                 DOR
.SPNISP  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOISPF').SPISPF2     DOR
&QISPF   SETB  0                                                 DOR
.SPISPF2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ISPF2').SPNISP1       DOR
&QISPF2  SETB  1                                                 DOR
&QISPF   SETB  1      MUST HAVE ISPF QUEUE INTERFACE             DOR
.SPNISP1 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ISPF1').SPNISP2       DOR
&QISPF2  SETB  0                                                 DOR
&QISPF   SETB  1      MUST HAVE ISPF QUEUE INTERFACE             DOR
.SPNISP2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'PFK').SPNPFK        DOR
&QPFK    SETB  1                                                  UF019
.SPNPFK  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOPFK').SPNPFK2      UF019
&QPFK    SETB  0                                                  UF019
.SPNPFK2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ACF2').SPNACF        UF019
&QACF2   SETB  1                                                  UF019
.SPNACF  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOACF2').SPNACF2     UF019
&QACF2   SETB  0                                                  UF019
.SPNACF2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP').SPNSP           UF019
&QSP     SETB  1                                                  UF019
.SPNSP   AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP').SPNSP2        UF019
&QSP     SETB  0                                                  UF019
.SPNSP2  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP133').SPNC29       UF019
&QSP133  SETB  1                                                  UF019
.SPNC29  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP133').SPNC292    UF019
&QSP133  SETB  0                                                  UF019
.SPNC292 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP134').SPNC49       UF019
&QSP133  SETB  1                                                  UF019
&QSP134  SETB  1                                                  UF019
.SPNC49  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP134').SPNC494    UF019
&QSP133  SETB  0                                                  UF019
&QSP134  SETB  0                                                  UF019
.SPNC494 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP136').SPNC26       UF019
&QSP136  SETB  1                                                  UF019
.SPNC26  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP136').SPNC262    UF019
&QSP136  SETB  0                                                  UF019
.SPNC262 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'GEN').SPNGEN         UF019
&QGEN    SETB  1                                                  UF019
.SPNGEN  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOGEN').SPNGEN2      UF019
&QGEN    SETB  0                                                  UF019
.SPNGEN2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'BGEN').BGENN1        ONL01
&QBGEN   SETB  1                                                  ONL01
.BGENN1  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOBGEN').BGENN0      ONL01
&QBGEN   SETB  0                                                  ONL01
.BGENN0  ANOP  ,                                                  ONL01
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'JTIP').SPNJTIP       UF019
&QJTIP   SETB  1                                                  UF019
.SPNJTIP AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOJTIP').SPNJTP2     UF019
&QJTIP   SETB  0                                                  UF019
.SPNJTP2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'DBC').SPNDBC         UF019
&QDBC    SETB  1                                                  UF019
.SPNDBC  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NODBC').SPNDBC2      UF019
&QDBC    SETB  0                                                  UF019
.SPNDBC2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NERDC').SPNNER       UF032
&QNERDC  SETB  1                                                  UF032
&QJTIP   SETB  1
&QDBC    SETB  1
.*
&QPF(2)  SETC  'L *    +'                                         UF043
&QPF(9)  SETC  'HELP'                                             UF043
.*
         AIF   (NOT &QSP133).SPNNER SKIP IF NOT SP133             UF046
&QJTIP   SETB  0                   TURN OFF JTIP CODE             UF046
.*
.SPNNER  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NONERDC').SPNNER2    UF032
&QNERDC  SETB  0                                                  UF032
.SPNNER2 ANOP                                                     UF032
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ONL').ONLN1          ONL06
&QONL    SETB  1                                                  ONL06
.ONLN1   AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOONL').ONLN0        ONL06
&QONL    SETB  0                                                  ONL06
.ONLN0   ANOP  ,                                                  ONL06
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'LOCK').LOCK1        CL
&LOCK    SETB  1                                                     CL
.LOCK1   ANOP                                                        CL
.NULL    ANOP                                                     UF019
         AIF   (&CTR EQ &CNT).SYSPEND                             UF019
&CTR     SETA  &CTR+1                                             UF019
&STRNG   SETA  &CTR                                               UF019
         AGO   .LOOP                                              UF019
.SYSPEND ANOP                                                     UF019
         AIF   (NOT &QONL).NOTONL                                 ONL06
&QISPF   SETB  1                  .                               DOR
&QISPF2  SETB  0                  .                               DOR
&QPFK    SETB  1                   THESE                          ONL06
&QACF2   SETB  ('&NAME' EQ 'CJHIST')  PARAMETERS                  ONL06
&QSP     SETB  1                     ARE                          ONL06
&QSP133  SETB  1                      FORCED                      ONL06
&QSP134  SETB  0
&QSP136  SETB  0
&QGEN    SETB  1                       IF                         ONL06
&QBGEN   SETB  0                        &QONL=1                   ONL06
&QJTIP   SETB  0                         .                        ONL06
&QDBC    SETB  0                          .                       ONL06
&QRNB    SETB  0                           .                      ONL06
&QRACF   SETB  0                            .                     ONL06
&QNERDC  SETB  0                             .                    ONL06
&QDSPRFX SETC  'SYS1'                         .                   ONL06
*QCKPTV  SETC  'PPVOL3'                        .                  ONL06
*&QCKPTV  SETC  'ACCT01'                       .                  ONL06
&QSIDS(1) SETC 'X10A'                           .                 ONL06
&QSIDS(2) SETC 'X10B'                            .                ONL06
&QSIDS(3) SETC 'X10C'                             .               ONL06
&QSIDS(4) SETC 'X10D'                              .              ONL06
&QPF(2)  SETC  'L *    +'                           .             ONL06
&QPF(6)  SETC  'FA F142I'                            .            ONL06
&QPF(9)  SETC  'DD     *'                             .           ONL06
.NOTONL  ANOP  ,                                                  ONL06
         AIF   (NOT &QCDSI).NOCDSI DOR
&QISPF   SETB  1                  .                               DOR
&QISPF2  SETB  0                  .                               DOR
&QSYSP   SETB  0                  .                               DOR
&QPFK    SETB  1                   THESE                          DOR
&QACF2   SETB  0                      PARAMETERS                  DOR
&QSP     SETB  1                     ARE                          DOR
&QSP133  SETB  0                      FORCED                      DOR
&QSP134  SETB  0                                                  DOR
&QSP136  SETB  0                                                  DOR
&QGEN    SETB  0                       IF                         DOR
&QBGEN   SETB  0                        &QCDSI=1                 DOR
&QJTIP   SETB  0                         .                        DOR
&QDBC    SETB  0                          .                       DOR
&QRNB    SETB  0                           .                      DOR
&QRACF   SETB  0                            .                     DOR
&QNERDC  SETB  0                             .                    DOR
&QDSPRFX SETC  'SYS1'                         .                   DOR
*QCKPTV  SETC  'PPVOL3'                        .                  DOR
*&QCKPTV  SETC  'ACCT01'   1/6/86              .                  DOR
&QSIDS(1) SETC 'IPO1'                           .                 DOR
&QSIDS(2) SETC 'IPO2'                            .                DOR
.NOCDSI ANOP  ,                                                  DOR
          AIF (NOT &QISPF).QPFK
&QPF(1)  SETC  'ISPF PF1'
&QPF(2)  SETC  'ISPF PF2'
&QPF(4)  SETC  'ISPF PF4 '
&QPF(9)  SETC  'ISPF PF9'
&QPF(12) SETC  'ISPF PF12'
.QPFK    ANOP
         AIF   ('&TYPE'  EQ 'GLOBAL').GEN  FORCE PRINT GEN FOR QCOMMON
         AIF   (&QGEN).GEN                                        UF019
         PRINT NOGEN                                              UF019
         AGO   .START                                             UF019
.GEN     PRINT GEN                                                UF019
.START   ANOP                                                     UF019
***********************************************************************
*        BUILT BLOCKHEAD FOR MICROFICHE
         @     &NAME
 MNOTE *,'CDSI=&QCDSI, TSS=&QTSS SYSP=&QSYSP WTO=&QWTO'
 MNOTE *,'ISPF=&QISPF, ISPF2=&QISPF2 '
 MNOTE *,'PFK=&QPFK, GEN=&QGEN, BGEN=&QBGEN, JTIP=&QJTIP, DBC=&QDBC'
 MNOTE *,'SPOOL=&QCKPTV, UNITNAME= &QCKUNIT, DSNPRFX=&QDSPRFX'
 MNOTE *,'SP=&QSP, SP133=&QSP133, SP134=&QSP134, SP136=&QSP136'
 MNOTE *,'NERDC=&QNERDC, ONL=&QONL, RNB=&QRNB, LOCK=&LOCK '
 MNOTE *,'ACF2=&QACF2, RACF=&QRACF, RACUSR=&QRACUSR'
***********************************************************************
         AIF  ('&MAIN' NE 'GBLS').NOGLBS                         DOR
         TITLE &ATITLE
         MEXIT                                                   DOR
.NOGLBS  ANOP                                                    DOR
         SPACE 1                                                  ONL01
&NAME    START 0
         AIF   ('&TYPE' EQ 'GLOBAL' OR '&MAIN' EQ 'YES').PRTSKP1  ONL01
         AIF   (&QBGEN).PRTSKP1                                   ONL01
         PUSH  PRINT                                              ONL01
         PRINT OFF                                                ONL01
.PRTSKP1 ANOP  ,                                                  ONL01
         SPACE 1                                                  ONL01
***********************************************************************
*                                                                     *
*   THE QUEUE COMMAND WAS WRITTEN FOR YOUR AMUSEMENT AND AMAZEMENT BY *
*     THE INTERGALACTIC MESSIANIC INDIVIDUAL GROUP THERAPY DIVISION   *
*     OF TRW SYSTEMS, 1 SPACE PARK, REDONDO BEACH, CA. 90278          *
*   THE ORIGINAL PROGRAMMING WAS DONE BY ANDY ZIDE, CHIEF PROGRAMMER  *
*     AND RESIDENT FLAKE WHO HAS SINCE DEPARTED TRW TO PLAY WITH      *
*     MICROCODE.                                                      *
*   PLEASE ADDRESS ANY COMMENTS, SUGGESTIONS, COMPLAINTS, OR THREATS  *
*     TO STEVE ANDERSON (R3/1028)   (213) 535-0682   OR               *
*        PAUL FELIX     (R3/1028)   (213) 535-0682                    *
*                                                                     *
*   STEVE ANDERSON HAS LEFT TRW.  PLEASE ADDRESS ANY COMMENTS OR      *
*   FIXES TO JACK SCHUDEL AT THE ADDRESS LISTED BELOW.                *
*                                                                     *
*   THE FOLLOWING INDIVIDUALS HAVE MADE MODIFICATIONS TO QUEUE WHICH  *
*     HAVE BEEN INCORPORATED INTO THIS CURRENT VERSION.               *
*                                                                     *
*        VILKO MACEK                                                  *
*        INSURANCE CORPORATION OF BRITISH COLUMBIA                    *
*        MODIFICATION: PFK SUPPORT                                    *
*                                                                     *
*        TRW ISD                                                      *
*        ANAHEIM, CALIFORNIA                                          *
*        MODIFICATION: DISPLAY CPU TIME FOR BATCH, STC AND TSO        *
*                      DISPLAY INITIATORS                             *
*                                                                     *
*        KEN TRUE                                                     *
*        FAIRCHILD CAMERA AND INSTRUMENT                              *
*        MOUNTAIN VIEW, CALIFORNIA                                    *
*        MODIFICATION: ACF2 SUPPORT                                   *
*                      PRINT SCREEN SUPPORT                           *
*                                                                     *
*        JACK SCHUDEL                                                 *
*        NORTHEAST REGIONAL DATA CENTER                               *
*        233 SSRB, UNIVERSITY OF FLORIDA                              *
*        GAINESVILLE, FLORIDA  32611                                  *
*        (904) 392-4601                                               *
*        MODIFICATIONS:  SEE MEMBER $UFDOC                            *
*                                                                     *
*        WALT FARRELL                                                 *
*        RAINIER NATIONAL BANK                                        *
*        P. O. BOX C34030                                             *
*        SEATTLE, WASHINGTON  98124                                   *
*        (206) 433-7467                                               *
*        MODIFICATIONS:  SEE MEMBER $RNBDOC                           *
*                                                                     *
*        ROBERT M. JINKINS                                            *
*        OAK RIDGE NATIONAL LABORATORY                                *
*        BLDG. 4500-N  MS-259                                         *
*        P.O. BOX X                                                   *
*        OAK RIDGE, TENN.  37830                                      *
*        (615) 574-7208/5300                                          *
*          FTS 624-7208/5300                                          *
*        SHARE INSTALLATION CODE:  OR                                 *
*        MODIFICATIONS:  SEE MEMBER $ONLDOC                           *
*                                                                     *
*        JOHN KINN                                                    *
*        LOCKHEED - CALIFORNIA COMPANY                                *
*        PLANT A1 BUILDING 67 DEPTMENT 8321                           *
*        P.O. BOX 551                                                 *
*        BURBANK, CALIFORNIA 91520                                    *
*        (818) 847-7492                                               *
*        SHARE INSTALLATION CODE:  CL                                 *
*        MODIFICATIONS:  SEE MEMBER $CLDOC                            *
*                                                                     *
*        DAVID RIKER                                                  *
*        COMPUTER DATA SYSTEMS INC                                    *
*        1 CURIE COURT                                                *
*        ROCKVILLE, MARYLAND 20850                                    *
*        (202) 362-1160                                               *
*        SHARE INSTALLATION CODE:  ??                                 *
*        MODIFICATIONS:  ISPF INTERFACE DRIVER - SEE MEMBER $CDSIDOC  *
*                                                                     *
***********************************************************************
         SPACE 2                                                  ONL01
*                                                                 ONL01
*  REGISTER EQUATES  OR HASPEQU (SP136 ONLY)                      DOR
*                                                                 ONL01
         SPACE 1                                                  ONL01
         AIF   ('&HASPEQU' EQ 'YES' AND &QSP136).HASPEQU
R0       EQU   0              TEMP WORK                             DOR
R1       EQU   1              TEMP WORK                             DOR
R2       EQU   2              WORK REG                              DOR
R3       EQU   3              WORK REG                              DOR
R4       EQU   4              WORK REG                              DOR
R5       EQU   5              WORK REG                              DOR
R6       EQU   6              WORK REG                              DOR
R7       EQU   7              WORK REG                              DOR
R8       EQU   8              WORK REG                              DOR
R9       EQU   9              ADDRESS OF COMMON SUB-AREA            DOR
R10      EQU   10             ADDRESS OF COMMON SUB-AREA            DOR
R11      EQU   11             ADDRESS OF COMMON VECTOR TABLE        DOR
R12      EQU   12             BASE REGISTER                         DOR
R13      EQU   13             SAVE AREA AND TEMPORARY WORK AREA     DOR
R14      EQU   14             TEMP WORK                             DOR
R15      EQU   15             TEMP WORK                             DOR
         AGO   .NOHASP                                              DOR
.HASPEQU ANOP                                                       DOR
         $HASPEQU      REQUIRED TO USE SYS1.HASPSRC                 DOR
         TITLE &ATITLE
.NOHASP ANOP                                                        DOR
         AIF   ('&TYPE' EQ 'GLOBAL' OR '&MAIN' EQ 'YES').PRTSKP2  ONL01
         AIF   (&QBGEN).PRTSKP2                                   ONL01
         SPACE 1                                                  ONL01
         POP   PRINT                                              ONL01
.PRTSKP2 ANOP  ,                                                  ONL01
         AIF   ('&TYPE' EQ 'NORMAL').GO
         MEXIT
.GO      ANOP
         SPACE 1                                                  ONL01
         USING *,R12               BASE REGISTER
         USING QCOMMON,R11         ACCESS TO COMMON VECTOR TABLE
         B     @PROLONG-*(15)                              DOR/CDSI
         DC    AL1(11),CL11'&NAME.'   USE FOR ASMTRACE     DOR/CDSI
         DC    CL16' &SYSDATE &SYSTIME' DOR/CDSI
@PROLONG EQU   * DOR/CDSI
         STM   R14,R12,12(R13)     STANDARD REGISTER SAVE
         LR    R12,R15             LOAD BASE REG
         AIF   ('&MAIN' EQ 'YES').MAINYES
         LR    R15,R13             RETAIN SAVE AREA ADDR
         LA    R13,72(R13)         POINT TO NEXT SAVE AREA
         AGO   .MAINNO
.MAINYES ANOP
         LR    R2,R1               SAVE PARAMETER REGISTER
         GETMAIN R,LV=4096         GET STORAGE FOR SAVEAREA
         ST    R1,8(R13)           FORWARD POINTER
         ST    R13,4(R1)           BACKWARD POINTER
         LR    R13,R1              MOVE ADDR TO R1
         MEXIT
.MAINNO  ANOP
         ST    R13,8(R15)          FORWARD POINTER
         ST    R15,4(R13)          BACKWARD POINTER
         MEND
./       ADD   NAME=QSTART2
         MACRO
&NAME    QSTART &TITLE,&MAIN=NO,&TYPE=NORMAL
         GBLB  &QISPF         ISPF INTERFACE OPTIONDOR
         GBLB  &QCDSI        SP 1.3.0 VOL=SER= NAME     DOR
         GBLB  &QTSS        ENABLE TOP SECURITY CODE DOR
         GBLB  &QPFK          PF-KEY OPTION
         GBLB  &QACF2         ACF2 AUTH CHECKING                   FCI*
         GBLB  &QSP           MVS/SP LEVEL OF JES2.               UF020
         GBLB  &QSP133        MVS/SP 1.3.3 LEVEL OF JES2          UF046
         GBLB  &QGEN          FORCE PRINT GEN OF MACRO EXPANSIONS UF019
         GBLB  &QBGEN         FORCE PRINT GEN OF CNTL BLOCK MACROSONL01
         GBLB  &QJTIP         JTIP PRODUCT INSTALLED              UF025
         GBLB  &QDBC          DBC  PRODUCT INSTALLED              UF024
         GBLB  &QRNB          ENABLES RNB-SPECIFIC CODE           RNB05
         GBLB  &QRACF         RACF CHECKING                       RNB03
         GBLC  &QRACUSR       NEW RACF USERID                     RNB03
         GBLB  &QNERDC        ENABLES NERDC SPECIFIC CODE         UF032
         GBLB  &QONL          ENABLES ONL SPECIFIC CODE           ONL06
         GBLB  &LOCK          ENABLES LOCKHEED SPECIFIC CODE         CL
         GBLC  &QDSPRFX       DEFINES HASPCKPT/HASPACE DSN PREFIX ONL09
         GBLC  &QCKPTV        VOLSER OF CHECKPOINT VOLUME         UF042
         GBLC  &QSIDS(7)      SMF ID'S OF SHARED CPU'S            UF042
         GBLC  &Q1CMD         DEFAULT FIRST COMMAND               UF042
         GBLC  &QPF(24)       PFK DEFINITIONS                     UF042
.*                                                                UF019
.* QISPF=0 SELECTS NO ISPF INTERFACE                               DOR
.* QISPF=1 SELECTS ISPF INTERFACE                                  DOR
.*QCDSI=0 SELECTS PRE SP 1.3.0 SUPPORT                           DOR
.*QCDSI=1 SELECTS SP 1.3.0 SUPPORT                               DOR
.*QTSS=0 SELECTS TOP SECRET PRODUCT                             DOR
.*QTSS=1 SELECTS TOP SECRET PRODUCT                             DOR
.*     TSS REQUIRED NO TESTAUTH
.* QPFK=0 SELECTS NO PF-KEY SUPPORT
.* QPFK=1 SELECTS PF=KEY SUPPORT
.*QACF2=0 SELECTS NO ACF2 CHECKING (SHOPS WITHOUT ACF2)            FCI*
.*QACF2=1 SELECTS ACF2 AUTH TO SYSOUT VIA DSN='SYSOUT.LID.JOBNAME' FCI*
.*  QSP=0 SELECTS PRE-SP SUPPORT                                  UF020
.*  QSP=1 SELECTS SP SUPPORT                                      UF020
.*QSP133=0 SELECTS PRE SP 1.3.3 SUPPORT                           UF046
.*QSP133=1 SELECTS SP 1.3.3 SUPPORT                               UF046
.* QGEN=0 SELECTS PRINT NOGEN OPTION                              UF019
.* QGEN=1 SELECTS PRINT GEN OPTION                                UF019
.*QBGEN=0 SELECTS PRINT NOGEN OPTION FOR CONTROL BLOCK MACROS     ONL01
.*QBGEN=1 SELECTS PRINT GEN OPTION FOR CONTROL BLOCK MACROS       ONL01
.*QJTIP=0 SELECTS NO JTIP SUPPORT.                                UF025
.*QJTIP=1 SELECTS SHOPS WITH JTIP INSTALLED                       UF025
.* QDBC=0 SELECTS NO DBC SUPPORT.                                 UF024
.* QDBC=1 SELECTS SHOPS WITH DBC INSTALLED                        UF024
.*QRACF=0 SELECTS NO RACF SUPPORT                                 RNB03
.*QRACF=1 SELECTS RACF SUPPORT FOR ACCESS TO THE SPOOL/CHECKPOINT RNB03
.*        AND FOR THE XP AND XDS COMMANDS. DEFINE TWO RACF        RNB03
.*        RESOURCES IN CLASS(APPL): QUEUEXP WILL CONTROL THE XP   RNB03
.*        COMMAND AND QUEUEXDS WILL PROVIDE FURTHER CONTROL OVER  RNB03
.*        THE XDS COMMAND. WHEN THE RACHECK FOR THE XDS COMMAND   RNB03
.*        IS DONE, THE JOBNAME WILL BE SPECIFIED AS THE APPLID.   RNB03
.*        THUS, IF YOU SPECIFY AUDIT(ALL) FOR APPL-QUEUEXDS YOU   RNB03
.*        WILL KNOW WHAT DATA YOUR PRIVILEGED USERS HAVE BEEN     RNB03
.*        EXAMINING (AUDITORS LIKE THIS). QRACF IS NOT SUPPORTED  RNB03
.*        VIA THE SYSPARM OPTION.                                 RNB03
.*QRACUSR IS USED IF YOUR SPOOL AND CHECKPOINT ARE DEFINED TO     RNB03
.*        RACF WITH UACC=NONE. IT SPECIFIES A USERID THAT HAS     RNB03
.*        ACCESS TO THE SPOOL AND CHECKPOINT WITH READ AUTHORITY. RNB03
.*        DURING INITIALIZATION, THE SPECIFIED USERID WILL BE     RNB03
.*        SUBSTITUTED INTO THE RACF ACEE SO THE USER OF QUEUE HAS RNB03
.*        ACCESS TO THE SPOOL AND CHECKPOINT DATA SETS ONLY WHILE RNB03
.*        THE QUEUE COMMAND IS IN PROGRESS. IF QRACF=1, THEN      RNB03
.*        QRACUSR MUST BE SPECIFIED. IF YOUR SPOOL AND CHECKPOINT RNB03
.*        HAVE A UACC OF >= READ, SPECIFY QRACUSR AS NULL ('') TO RNB03
.*        BYPASS CHANGING THE ACEE USERID. QRACUSR IS NOT         RNB03
.*        SUPPORTED VIA THE SYSPARM OPTION.                       RNB03
.*                                                                UF019
&QISPF   SETB  1 DOR
&QCDSI   SETB  0    DOR
&QTSS    SETB  0    DOR
&QPFK    SETB  1
&QACF2   SETB  0                                                   FCI*
&QSP     SETB  1                                                  UF020
&QSP133  SETB  1                                                  UF046
&QGEN    SETB  0                                                  ONL01
&QBGEN   SETB  0                                                  ONL01
&QJTIP   SETB  0                                                  UF025
&QDBC    SETB  0                                                  UF024
&QRNB    SETB  0                                                  RNB05
&QRACF   SETB  0                                                  RNB03
&QRACUSR SETC  'QCMD'                                             RNB03
&QNERDC  SETB  0                                                  UF032
&QONL    SETB  0                                                  ONL06
&QDSPRFX SETC  'SYS1'                                             ONL09
*&QCKPTV  SETC  'SCR005'
*&QCKPTV  SETC  'PPVOL3'
&QCKPTV  SETC  'MVSDL1' 1/6/85 DOR
&QSIDS(1) SETC 'IPO1'                                             UF042
&QSIDS(2) SETC 'IPO2'                                             UF042
&QSIDS(3) SETC '    '                                             UF042
&QSIDS(4) SETC '    '                                             UF042
&QSIDS(5) SETC '    '                                             UF042
&QSIDS(6) SETC '    '                                             UF042
&QSIDS(7) SETC '    '                                             UF042
&Q1CMD    SETC 'ST  '                                             UF042
&QPF(1)  SETC  'HELP'                                             UF043
&QPF(2)  SETC  'DA'                                               UF043
&QPF(3)  SETC  'END'                                              UF043
&QPF(4)  SETC  'PRINT'                                            UF043
&QPF(5)  SETC  'FIND'                                             UF043
&QPF(6)  SETC  'DI'                                               UF043
&QPF(7)  SETC  '-     21'                                         UF043
&QPF(8)  SETC  '+     21'                                         UF043
&QPF(9)  SETC  'DO'                                               UF043
&QPF(10) SETC  'CO    1'                                          UF043
&QPF(11) SETC  'CO    50'                                         UF043
&QPF(12) SETC  'ST'                                               UF043
.*                                                                UF019
         LCLA  &CNT,&CTR,&STRNG,&LNTH,&SUB                        UF019
         AIF   (K'&SYSPARM EQ 0).SYSPEND                          UF019
         MNOTE *,'SYSPARM IS ''&SYSPARM'' '                       UF019
         AIF   ('&SYSPARM'(1,1) EQ '(').MORE                      UF019
  MNOTE 2,'SYSPARM SYNTAX ERROR--MUST BE ENCLOSED IN PARENS'      UF019
         AGO   .SYSPEND                                           UF019
.MORE    ANOP                                                     UF019
&CNT     SETA  K'&SYSPARM                                         UF019
&CTR     SETA  1                                                  UF019
&STRNG   SETA  &CTR+1                                             UF019
.LOOP    AIF   ('&SYSPARM'(&CTR,1) EQ ',' OR &CTR EQ &CNT).FOUND  UF019
&CTR     SETA  &CTR+1                                             UF019
         AGO   .LOOP                                              UF019
.FOUND   ANOP                                                     UF019
&LNTH    SETA  &CTR-&STRNG                                        UF019
         AIF   (&LNTH EQ 0).NULL                                  UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'TSS').SPEC30        DOR
&QTSS   SETB  1                                                  DOR
.SPEC30  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOTSS').SPEC302     DOR
&QTSS   SETB  0                                                  DOR
.SPEC302 ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'CDSI').SPNC30       DOR
&QCDSI  SETB  1                                                  DOR
.SPNC30  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOCDSI').SPNC302    DOR
&QCDSI  SETB  0                                                  DOR
.SPNC302 ANOP                                                     DOR
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ISPF').SPNISP        DOR
&QISPF   SETB  1                                                 DOR
.SPNISP  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOISPF').SPNISP2     DOR
&QISPF   SETB  0                                                 DOR
.SPNISP2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'PFK').SPNPFK        DOR
&QPFK    SETB  1                                                  UF019
.SPNPFK  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOPFK').SPNPFK2      UF019
&QPFK    SETB  0                                                  UF019
.SPNPFK2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ACF2').SPNACF        UF019
&QACF2   SETB  1                                                  UF019
.SPNACF  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOACF2').SPNACF2     UF019
&QACF2   SETB  0                                                  UF019
.SPNACF2 AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP').SPNSP           UF019
&QSP     SETB  1                                                  UF019
.SPNSP   AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP').SPNSP2        UF019
&QSP     SETB  0                                                  UF019
.SPNSP2  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'SP133').SPNC29       UF019
&QSP133  SETB  1                                                  UF019
.SPNC29  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOSP133').SPNC292    UF019
&QSP133  SETB  0                                                  UF019
.SPNC292 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'GEN').SPNGEN         UF019
&QGEN    SETB  1                                                  UF019
.SPNGEN  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOGEN').SPNGEN2      UF019
&QGEN    SETB  0                                                  UF019
.SPNGEN2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'BGEN').BGENN1        ONL01
&QBGEN   SETB  1                                                  ONL01
.BGENN1  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOBGEN').BGENN0      ONL01
&QBGEN   SETB  0                                                  ONL01
.BGENN0  ANOP  ,                                                  ONL01
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'JTIP').SPNJTIP       UF019
&QJTIP   SETB  1                                                  UF019
.SPNJTIP AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOJTIP').SPNJTP2     UF019
&QJTIP   SETB  0                                                  UF019
.SPNJTP2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'DBC').SPNDBC         UF019
&QDBC    SETB  1                                                  UF019
.SPNDBC  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NODBC').SPNDBC2      UF019
&QDBC    SETB  0                                                  UF019
.SPNDBC2 ANOP                                                     UF019
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NERDC').SPNNER       UF032
&QNERDC  SETB  1                                                  UF032
&QJTIP   SETB  1
&QDBC    SETB  1
.*
&QPF(2)  SETC  'L *    +'                                         UF043
&QPF(9)  SETC  'HELP'                                             UF043
.*
         AIF   (NOT &QSP133).SPNNER SKIP IF NOT SP133             UF046
&JTIP    SETB  0                   TURN OFF JTIP CODE             UF046
.*
.SPNNER  AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NONERDC').SPNNER2    UF032
&QNERDC  SETB  0                                                  UF032
.SPNNER2 ANOP                                                     UF032
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'ONL').ONLN1          ONL06
&QONL    SETB  1                                                  ONL06
.ONLN1   AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'NOONL').ONLN0        ONL06
&QONL    SETB  0                                                  ONL06
.ONLN0   ANOP  ,                                                  ONL06
         AIF   ('&SYSPARM'(&STRNG,&LNTH) NE 'LOCKHEED').LOCK1        CL
&LOCK    SETB  1                                                     CL
.LOCK1   ANOP                                                        CL
.NULL    ANOP                                                     UF019
         AIF   (&CTR EQ &CNT).SYSPEND                             UF019
&CTR     SETA  &CTR+1                                             UF019
&STRNG   SETA  &CTR                                               UF019
         AGO   .LOOP                                              UF019
.SYSPEND ANOP                                                     UF019
         AIF   (NOT &QONL).NOTONL                                 ONL06
&QISPF   SETB  1                  .                               DOR
&QPFK    SETB  1                   THESE                          ONL06
&QACF2   SETB  ('&NAME' EQ 'CJHIST')  PARAMETERS                  ONL06
&QSP     SETB  1                     ARE                          ONL06
&QSP133  SETB  1                      FORCED                      ONL06
&QGEN    SETB  1                       IF                         ONL06
&QBGEN   SETB  0                        &QONL=1                   ONL06
&QJTIP   SETB  0                         .                        ONL06
&QDBC    SETB  0                          .                       ONL06
&QRNB    SETB  0                           .                      ONL06
&QRACF   SETB  0                            .                     ONL06
&QNERDC  SETB  0                             .                    ONL06
&QDSPRFX SETC  'SYS1'                         .                   ONL06
*QCKPTV  SETC  'PPVOL3'                        .                  ONL06
&QCKPTV  SETC  'MVSDL1'                        .                  ONL06
&QSIDS(1) SETC 'X10A'                           .                 ONL06
&QSIDS(2) SETC 'X10B'                            .                ONL06
&QSIDS(3) SETC 'X10C'                             .               ONL06
&QSIDS(4) SETC 'X10D'                              .              ONL06
&QPF(2)  SETC  'L *    +'                           .             ONL06
&QPF(6)  SETC  'FA F142I'                            .            ONL06
&QPF(9)  SETC  'DD     *'                             .           ONL06
.NOTONL  ANOP  ,                                                  ONL06
         AIF   (NOT &QCDSI).NOCDSI DOR
&QISPF   SETB  1                  .                               DOR
&QPFK    SETB  1                   THESE                          DOR
&QACF2   SETB  0                      PARAMETERS                  DOR
&QSP     SETB  1                     ARE                          DOR
&QSP133  SETB  0                      FORCED                      DOR
&QGEN    SETB  0                       IF                         DOR
&QBGEN   SETB  0                        &QCDSI=1                 DOR
&QJTIP   SETB  0                         .                        DOR
&QDBC    SETB  0                          .                       DOR
&QRNB    SETB  0                           .                      DOR
&QRACF   SETB  0                            .                     DOR
&QNERDC  SETB  0                             .                    DOR
&QDSPRFX SETC  'SYS1'                         .                   DOR
*QCKPTV  SETC  'PPVOL3'                        .                  DOR
&QCKPTV  SETC  'MVSDL1'    1/6/86              .                  DOR
&QSIDS(1) SETC 'IPO1'                           .                 DOR
&QSIDS(2) SETC 'IPO2'                            .                DOR
.NOCDSI ANOP  ,                                                  DOR
          AIF (NOT &QISPF).QPFK
&QPF(1)  SETC  'ISPF PF1'
&QPF(2)  SETC  'ISPF PF2'
&QPF(4)  SETC  'ISPF PF4 '
&QPF(9)  SETC  'ISPF PF9'
&QPF(12) SETC  'ISPF PF12'
.QPFK    ANOP
         AIF   ('&TYPE'  EQ 'GLOBAL').GEN  FORCE PRINT GEN FOR QCOMMON
         AIF   (&QGEN).GEN                                        UF019
         PRINT NOGEN                                              UF019
         AGO   .START                                             UF019
.GEN     PRINT GEN                                                UF019
.START   ANOP                                                     UF019
***********************************************************************
*        BUILT BLOCKHEAD FOR MICROFICHE
         @     &NAME
 MNOTE *,'ISPF=&QISPF, CDSI=&QCDSI, TSS=&QTSS'
 MNOTE *,'PFK=&QPFK, GEN=&QGEN, BGEN=&QBGEN, JTIP=&QJTIP, DBC=&QDBC'
 MNOTE *,'SPOOL=&QCKPTV, DSNPRFX=&QDSPRFX, SP=&QSP, SP133=&QSP133'
 MNOTE *,'NERDC=&QNERDC, ONL=&QONL, RNB=&QRNB, LOCK=&LOCK '
 MNOTE *,'ACF2=&QACF2, RACF=&QRACF, RACUSR=&QRACUSR'
***********************************************************************
         AIF  ('&MAIN' NE 'GBLS').NOGLBS                         DOR
         TITLE &TITLE                                            DOR
         MEXIT                                                   DOR
.NOGLBS  ANOP                                                    DOR
         SPACE 1                                                  ONL01
&NAME    START 0
         AIF   ('&TYPE' EQ 'GLOBAL' OR '&MAIN' EQ 'YES').PRTSKP1  ONL01
         AIF   (&QBGEN).PRTSKP1                                   ONL01
         PUSH  PRINT                                              ONL01
         PRINT OFF                                                ONL01
.PRTSKP1 ANOP  ,                                                  ONL01
         SPACE 1                                                  ONL01
***********************************************************************
*                                                                     *
*   THE QUEUE COMMAND WAS WRITTEN FOR YOUR AMUSEMENT AND AMAZEMENT BY *
*     THE INTERGALACTIC MESSIANIC INDIVIDUAL GROUP THERAPY DIVISION   *
*     OF TRW SYSTEMS, 1 SPACE PARK, REDONDO BEACH, CA. 90278          *
*   THE ORIGINAL PROGRAMMING WAS DONE BY ANDY ZIDE, CHIEF PROGRAMMER  *
*     AND RESIDENT FLAKE WHO HAS SINCE DEPARTED TRW TO PLAY WITH      *
*     MICROCODE.                                                      *
*   PLEASE ADDRESS ANY COMMENTS, SUGGESTIONS, COMPLAINTS, OR THREATS  *
*     TO STEVE ANDERSON (R3/1028)   (213) 535-0682   OR               *
*        PAUL FELIX     (R3/1028)   (213) 535-0682                    *
*                                                                     *
*   STEVE ANDERSON HAS LEFT TRW.  PLEASE ADDRESS ANY COMMENTS OR      *
*   FIXES TO JACK SCHUDEL AT THE ADDRESS LISTED BELOW.                *
*                                                                     *
*   THE FOLLOWING INDIVIDUALS HAVE MADE MODIFICATIONS TO QUEUE WHICH  *
*     HAVE BEEN INCORPORATED INTO THIS CURRENT VERSION.               *
*                                                                     *
*        VILKO MACEK                                                  *
*        INSURANCE CORPORATION OF BRITISH COLUMBIA                    *
*        MODIFICATION: PFK SUPPORT                                    *
*                                                                     *
*        TRW ISD                                                      *
*        ANAHEIM, CALIFORNIA                                          *
*        MODIFICATION: DISPLAY CPU TIME FOR BATCH, STC AND TSO        *
*                      DISPLAY INITIATORS                             *
*                                                                     *
*        KEN TRUE                                                     *
*        FAIRCHILD CAMERA AND INSTRUMENT                              *
*        MOUNTAIN VIEW, CALIFORNIA                                    *
*        MODIFICATION: ACF2 SUPPORT                                   *
*                      PRINT SCREEN SUPPORT                           *
*                                                                     *
*        JACK SCHUDEL                                                 *
*        NORTHEAST REGIONAL DATA CENTER                               *
*        233 SSRB, UNIVERSITY OF FLORIDA                              *
*        GAINESVILLE, FLORIDA  32611                                  *
*        (904) 392-4601                                               *
*        MODIFICATIONS:  SEE MEMBER $UFDOC                            *
*                                                                     *
*        WALT FARRELL                                                 *
*        RAINIER NATIONAL BANK                                        *
*        P. O. BOX C34030                                             *
*        SEATTLE, WASHINGTON  98124                                   *
*        (206) 433-7467                                               *
*        MODIFICATIONS:  SEE MEMBER $RNBDOC                           *
*                                                                     *
*        ROBERT M. JINKINS                                            *
*        OAK RIDGE NATIONAL LABORATORY                                *
*        BLDG. 4500-N  MS-259                                         *
*        P.O. BOX X                                                   *
*        OAK RIDGE, TENN.  37830                                      *
*        (615) 574-7208/5300                                          *
*          FTS 624-7208/5300                                          *
*        SHARE INSTALLATION CODE:  OR                                 *
*        MODIFICATIONS:  SEE MEMBER $ONLDOC                           *
*                                                                     *
*        JOHN KINN                                                    *
*        LOCKHEED - CALIFORNIA COMPANY                                *
*        PLANT A1 BUILDING 67 DEPTMENT 8321                           *
*        P.O. BOX 551                                                 *
*        BURBANK, CALIFORNIA 91520                                    *
*        (818) 847-7492                                               *
*        SHARE INSTALLATION CODE:  CL                                 *
*        MODIFICATIONS:  SEE MEMBER $CLDOC                            *
*                                                                     *
*        DAVID RIKER                                                  *
*        COMPUTER DATA SYSTEMS INC                                    *
*        1 CURIE COURT                                                *
*        ROCKVILLE, MARYLAND 20850                                    *
*        (202) 362-1160                                               *
*        SHARE INSTALLATION CODE:  ??                                 *
*        MODIFICATIONS:  ISPF INTERFACE DRIVER - SEE MEMBER $CDSIDOC  *
*                                                                     *
***********************************************************************
         SPACE 2                                                  ONL01
*                                                                 ONL01
*  REGISTER EQUATES                                               ONL01
*                                                                 ONL01
         SPACE 1                                                  ONL01
R0       EQU   0              TEMP WORK
R1       EQU   1              TEMP WORK
R2       EQU   2              WORK REG
R3       EQU   3              WORK REG
R4       EQU   4              WORK REG
R5       EQU   5              WORK REG
R6       EQU   6              WORK REG
R7       EQU   7              WORK REG
R8       EQU   8              WORK REG
R9       EQU   9              ADDRESS OF COMMON SUB-AREA
R10      EQU   10             ADDRESS OF COMMON SUB-AREA
R11      EQU   11             ADDRESS OF COMMON VECTOR TABLE
R12      EQU   12             BASE REGISTER
R13      EQU   13             SAVE AREA AND TEMPORARY WORK AREA
R14      EQU   14             TEMP WORK
R15      EQU   15             TEMP WORK
         AIF   ('&TYPE' EQ 'GLOBAL' OR '&MAIN' EQ 'YES').PRTSKP2  ONL01
         AIF   (&QBGEN).PRTSKP2                                   ONL01
         SPACE 1                                                  ONL01
         POP   PRINT                                              ONL01
.PRTSKP2 ANOP  ,                                                  ONL01
         AIF   ('&TYPE' EQ 'NORMAL').GO
         MEXIT
.GO      ANOP
         SPACE 1                                                  ONL01
         USING *,R12               BASE REGISTER
         USING QCOMMON,R11         ACCESS TO COMMON VECTOR TABLE
         B     @PROLONG-*(15)                              DOR/CDSI
         DC    AL1(11),CL11'&NAME.'   USE FOR ASMTRACE     DOR/CDSI
         DC    CL16' &SYSDATE &SYSTIME' DOR/CDSI
@PROLONG EQU   * DOR/CDSI
         STM   R14,R12,12(R13)     STANDARD REGISTER SAVE
         LR    R12,R15             LOAD BASE REG
*DOR     B     *+28                BRANCH AROUND IDENTIFIER
*DOR     DC    CL8'&NAME'          MODULE IDENTIFIER
*DOR     DC    CL8'&SYSDATE'       ASSEMBLY DATE
*DOR     DC    CL8' &SYSTIME'      ASSEMBLY TIME
         AIF   ('&MAIN' EQ 'YES').MAINYES
         LR    R15,R13             RETAIN SAVE AREA ADDR
         LA    R13,72(R13)         POINT TO NEXT SAVE AREA
         AGO   .MAINNO
.MAINYES ANOP
         LR    R2,R1               SAVE PARAMETER REGISTER
         GETMAIN R,LV=4096         GET STORAGE FOR SAVEAREA
         ST    R1,8(R13)           FORWARD POINTER
         ST    R13,4(R1)           BACKWARD POINTER
         LR    R13,R1              MOVE ADDR TO R1
         MEXIT
.MAINNO  ANOP
         ST    R13,8(R15)          FORWARD POINTER
         ST    R15,4(R13)          BACKWARD POINTER
         MEND
./       ADD   NAME=QSTOP
         MACRO ,                                                  ONL11
&NAME    QSTOP &RC=                                               ONL11
&NAME    L     R13,4(,R13)         ADDR OF CALLER'S SAVE AREA     ONL11
         AIF   (T'&RC EQ 'O').NORC                                ONL11
         RETURN (14,12),T,RC=&RC   RETURN TO CALLER               ONL11
         MEXIT ,                                                  ONL11
.NORC    ANOP  ,                                                  ONL11
         LM    R14,R12,12(R13)     RESTORE CALLER'S REGISTERS     ONL11
         MVI   12(R13),X'FF'       SET RETURN INDICATION          ONL11
         BR    R14                 RETURN TO CALLER               ONL11
         MEND  ,                                                  ONL11
./       ADD   NAME=QTILT
         MACRO
&NAME    QTILT &MESSAGE
         USING QDISPLAY,R15   BASE REG FOR DISPLAY WORK AREA
&NAME    L     R15,QVDSPL     LOAD BASE REG
         MVC   QDHLINE,=CL80&MESSAGE
         MVC   QDMLNG,=H'0'   ZERO MESSAGE LENGTH
         DROP  R15
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         LR    R14,R15        SET FOR LOOP
         BR    R15            GO TO IT
         MEND
./       ADD   NAME=QTILTR
         MACRO
&NAME    QTILTR &REG
         USING QDISPLAY,R15   BASE REG FOR DISPLAY WORK AREA
&NAME    L     R15,QVDSPL     LOAD BASE REG
         MVC   QDHLINE(80),QBLANK CLEAR HEADER MSG
         SR    R2,R2
         IC    R2,1(&REG)
         EX    R2,&NAME.X
         MVC   QDMLNG,=H'0'   ZERO MESSAGE LENGTH
         DROP  R15
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         LR    R14,R15        SET FOR LOOP
         BR    R15            GO TO IT
&NAME.X  MVC   QDHLINE(*-*),2(&REG)
         MEND
./       ADD   NAME=QUEINFO
***********************************************************************
*    COMMENT BY DAVE RIKER / CDSI
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -
*    R9   -  WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
./       ADD   NAME=QUEOBJ
//QUEOBJ PROC
//IEBCOPY EXEC  PGM=IEBCOPY,REGION=300K,PARM='SIZE=200K'
//SYSPRINT  DD  SYSOUT=M,DEST=R55
//SYSABEND  DD  SYSOUT=M,DEST=R55
//SYSUT1    DD  UNIT=VIO,SPACE=(CYL,(5))
//SYSUT2    DD  UNIT=VIO,SPACE=(CYL,(5))
//INDD1     DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR
//INDD2     DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR
//SYSIN     DD  DSN=IPO1.PARMLIB(QUEOBJ),DISP=SHR
./       ADD   NAME=QUEOBJT
//QUEOBJT PROC
//IEBCOPY EXEC  PGM=IEBCOPY,REGION=300K,PARM='SIZE=200K'
//SYSPRINT  DD  SYSOUT=M,DEST=R55
//SYSABEND  DD  SYSOUT=M,DEST=R55
//SYSUT1    DD  UNIT=VIO,SPACE=(CYL,(5))
//SYSUT2    DD  UNIT=VIO,SPACE=(CYL,(5))
//INDD1     DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR
//INDD2     DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR
//SYSIN     DD  DSN=IPO1.PARMLIB(QUEOBJ),DISP=SHR
./       ADD   NAME=QUEQI4
//QUEQI4  PROC  CKPT=ACCT01,        DEFAULT SPOOL VOL NAME
//             CUNIT=U3380,         DEFAULT UNITNAME FOR ACCT01
//             RENT='DECK,RENT,NOLOAD',     PERMANENT PARAMETER
//             ISPF='TSS,ISPF,NOACF2,SP134' PERMANENT PARAMETER
//*-----------------------------------------------------------
//*  COMMENT BY DAVID RIKER CDSI 9/16/86
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ISPF,CKPT=&CKPT,UNIT=&CUNIT.)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AOST.V60.MACLIB,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=SYSDA
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(Q0),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(Q0),DISP=SHR SOURCE LIBRARY
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF DD DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M,DEST=R55
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  DSN=IPO1.PARMLIB(LINKQI4),DISP=SHR
./       ADD   NAME=QUEQI4T
//QUEQI4T PROC  CKPT=ACCT01,        DEFAULT SPOOL VOL NAME
//             CUNIT=U3380,         DEFAULT UNITNAME FOR ACCT01
//             RENT='DECK,RENT,NOLOAD',     PERMANENT PARAMETER
//             ISPF='TSS,ISPF,NOACF2,SP134' PERMANENT PARAMETER
//*-----------------------------------------------------------
//*  COMMENT BY DAVID RIKER CDSI 9/16/86
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ISPF,CKPT=&CKPT,UNIT=&CUNIT.)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AOST.V60.MACLIB,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=SYSDA
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(Q0),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(Q0),DISP=SHR SOURCE LIBRARY
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF DD DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M,DEST=R55
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  DSN=IPO1.PARMLIB(LINKQI4T),DISP=SHR
./       ADD   NAME=QUEQI42
//QUEQI42 PROC  CKPT=ACCT01,        DEFAULT SPOOL VOL NAME
//             CUNIT=U3380,         DEFAULT UNITNAME FOR ACCT01
//             RENT='DECK,RENT,NOLOAD',     PERMANENT PARAMETER
//             ISPF='TSS,ISPF,NOACF2,SP134' PERMANENT PARAMETER
//*-----------------------------------------------------------
//*  COMMENT BY DAVID RIKER CDSI 9/16/86
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ISPF,CKPT=&CKPT,UNIT=&CUNIT.)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AOST.V60.MACLIB,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=SYSDA
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(Q0),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(Q0),DISP=SHR SOURCE LIBRARY
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF DD DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M,DEST=R55
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  DSN=IPO1.PARMLIB(LINKQI42),DISP=SHR
./       ADD   NAME=QUEQ4
//QUEQ4  PROC  CKPT=ACCT01,        DEFAULT SPOOL VOL NAME
//             CUNIT=U3380,         DEFAULT UNITNAME FOR ACCT01
//             RENT='DECK,RENT,NOLOAD',     PERMANENT PARAMETER
//             NOISPF='PFK,TSS,NOISPF,NOACF2,SP134' PERMANENT PARMS
//*-----------------------------------------------------------
//*  COMMENT BY DAVID RIKER CDSI 9/16/86
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME
//*    IN QSTART  CHANGE CHKPT= IN QASM PROC     1/6/85
//*   FOR MORE DETAILS, SEE $CHKPTCHG
//*-----------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&NOISPF,CKPT=&CKPT,UNIT=&CUNIT.)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP134.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.QISPF.JESA.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR,
//           UNIT=3350,VOL=SER=PPVOL2 JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AOST.V60.MACLIB,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=SYSDA
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSPUNCH DD  DSN=SYS3.QISPF.JESA.OBJLIB(Q0),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP134.SRCLIB(Q0),DISP=SHR SOURCE LIBRARY
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1000K,
//             COND=(7,LT)
//SYSISPF DD DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M,DEST=R55
//SYSPRINT DD  SYSOUT=M,DEST=R55
//SYSLIB   DD  DSN=SYS3.QISPF.JESA.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSLIN   DD  DSN=IPO1.PARMLIB(LINKQ4),DISP=SHR
./       ADD   NAME=QUEUE
QUEUE    TITLE 'QUEUE COMMAND - MAINLINE MODULE'                  ONL01
QUEUE    QSTART MAIN=YES           START QUEUE CSECT ASSEMBLY     ONL01
***********************************************************************
* RNB CHANGES:                                                        *
*      (1) RNB01 - FIX FINAL TPUT MESSAGE TO WORK WITH SPF TCAM       *
*                                                                     *
***********************************************************************
***********************************************************************
*                                                                     *
*   CALL - INITIALIZATION                                             *
*                                                                     *
***********************************************************************
         L     R15,=V(INIT)   ADDR OF INIT
         BALR  R14,R15        GO TO IT
         LA    R10,LOOP       INTERRUPTED RETURN ADDRESS
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
*        CALL TRACE
******************************************************************UF003
*                                                                 UF003
*   INITIALIZE 3270 SCREEN VARIABLES                              UF003
*                                                                 UF003
******************************************************************UF003
         GTSIZE ,             READ 3270 SCREEN SIZE               UF003
         STM   R0,R1,QDOSZR0  SAVE FOR LATER RESTORE              UF003
         LTR   R0,R0          DISPLAY DEVICE?                     UF003
         BZ    NOTDISP        NO, ABORT                           UF003
         SPACE 1                                                  UF003
         STFSMODE ON,INITIAL=YES  TELL VTAM ABOUT FULLSCREEN MODE UF003
         SPACE 1                                                  UF003
         LM    R0,R1,QDOSZR0  RESTORE DESTROYED REGS              UF003
         CH    R1,=H'80'      POSSIBLE MODEL 2 OR 4 TERMINAL?     UF003
         BNE   TRYM5          NO, TRY FOR MODEL 5                 UF003
         CH    R0,=H'43'      MODEL 4 TERMINAL?                   UF003
         BE    MODEL4         YES, SET IT                         UF003
         CH    R0,=H'32'      MODEL 3 TERMINAL?                   UF003
         BNE   SETM2          NO, SET MODEL 2 DEFAULT             UF003
         SPACE 1                                                  UF003
MODEL3   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'29'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'29'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'29'                           UF043
         MVC   QDSCRLEN,=AL2(29*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(29*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'E6F0'    (32,1)                         UF003
         MVC   QDSCRO4,=X'E7F7'    (32,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL4   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'40'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'40'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'40'                           UF043
         MVC   QDSCRLEN,=AL2(40*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(40*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F460'    (43,1)                         UF003
         MVC   QDSCRO4,=X'F5E7'    (43,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
TRYM5    CH    R1,=H'132'     POSSIBLE MODEL 5 TERMINAL?          UF003
         BNE   SETM2          NO, FORCE MODEL 2 DEFAULT           UF003
         CH    R0,=H'27'      ACTUAL MODEL 5?                     UF003
         BNE   SETM2          NO, FORCE MODEL 2 DEFAULT           UF003
         SPACE 1                                                  UF003
MODEL5   MVC   QDLNELEN,=H'132'    LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'24'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'24'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'24'                           UF043
         MVC   QDSCRLEN,=AL2(24*132)  SCR LENGTH                  UF003
         MVC   QDSCRPLN,=AL2(24*132+QDLINE1-QDSCREEN) TPUT LEN    UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C2C4'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F5E8'    (27,1)                         UF003
         MVC   QDSCRO4,=X'F66F'    (27,72)                        UF003
         MVC   QDSCRO5,=X'C4C8'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
SETM2    STSIZE SIZE=80,LINE=24  FORCE MODEL 2 DEFAULT            UF003
         SPACE 1                                                  UF003
         B     LOOP           GO TO PROCESS LOOP                  UF003
         SPACE 1                                                  UF003
NOTDISP  TPUT  NOTDSPL,L'NOTDSPL SEND MESSAGE TO USER             UF003
         B     EXIT2          AND RETURN TO CALLER                UF003
         SPACE 1                                                  UF003
NOTDSPL  DC    C'QUEUE COMMAND REQUIRES DISPLAY TERMINAL'         UF003
         EJECT ,                                                  UF003
***********************************************************************
*                                                                     *
*   CALL - COMMAND LINE PARSE                                         *
*                                                                     *
***********************************************************************
LOOP     DS    0H                                                 UF006
         L     R15,=V(PARSE)  ADDR OF PARSE
         BALR  R14,R15        GO TO IT
         CLC   =C'E ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'EXIT ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'END ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'STOP ',QSUBNAME STOP?
         BE    EXIT           YES.
***********************************************************************
*                                                                     *
*   CALL - SUB-COMMAND MODULE SELECTED BY PARSE                       *
*                                                                     *
***********************************************************************
         MVC   QDHLINE,DUMMY  NO OUTPUT MESSAGE
         L     R15,QSUBCMD    ADDR OF SUBCMD FROM QCOMMON
         BALR  R14,R15        GO TO IT
         MVC   QDMLNG,=H'0'   ZERO OUT MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        WRITE LAST SCREEN, GET NEXT INPUT
         B     LOOP           DO IT AGAIN
***********************************************************************
*                                                                     *
*   CLEAN UP AND GO HOME                                              *
*                                                                     *
***********************************************************************
EXIT     STSIZE SIZELOC=QDOSZR1,LINELOC=QDOSZR0  RESTORE SCRSIZE  UF003
         TPUT  CLEAR,L'CLEAR,FULLSCR,MF=(E,QTPUT) CLEAR SCREEN    UF003
         STLINENO LINE=1,MODE=OFF                 OFF FULLSCR     UF003
         USING QCKPT,R8 BASE REG FOR CKPT WORK AREA
EXIT2    DS    0H                                                 UF003
         L     R8,QVCKPT      LOAD BASE REG
         CLOSE MF=(E,HOCKPT)
         SPACE 1                                                     CL
         LA    R7,QCSPOOLS         ADDR OF FIRST DCB POINTER         CL
         LA    R6,9                MAXIMUM NUMBER OF EXTENTS         CL
         SPACE 1                                                     CL
CLOSELOP OC    0(4,R7),0(R7)       SKIP IF THIS EXTENT               CL
         BZ    CLOSEBMP             IS NOT ACTIVE                    CL
         OI    0(R7),X'80'         SET END OF LIST INDICATE          CL
         CLOSE (,FREE),MF=(E,(R7)) CLOSE ONE EXTENT                  CL
CLOSEBMP LA    R7,4(,R7)           BUMP TO NEXT EXTENT               CL
         BCT   R6,CLOSELOP         CONTINUE IF MORE EXTENTS          CL
         SPACE 1                                                     CL
         TM    QPFLAG,HARDCPY         IS HARDCOPY INVOKED?         FCI*
         BNO   FREEUP                   NO..SPLIT THIS STUFF       FCI*
         L     R15,=V(PRINT)               INVOKE PRINT            FCI*
         MVC   QDREPLY,QBLANK                  TO                  FCI*
         MVC   QDREPLY(09),=C'PRINT OFF'          FREE UP          FCI*
         MVC   QDRLNG,=X'0009'                        HARDCOPY     FCI*
         BALR  R14,R15                                     OUTPUT  FCI*
         EJECT
***********************************************************************
*                                                                  FCI*
*   FREE HASPCKPT AND HASPACEN DDNAMES BEFORE LEAVING TO BE NEAT.. FCI*
*                                                                  FCI*
***********************************************************************
FREEUP   MVI   DAIRFLAG,X'18'    INDICATE FREE DDNAME(XXXXXXXX)    FCI*
         MVC   DA18DDN,HASPCKPT+40  GET DDNAME USED...             FCI*
         L     R15,=V(ALLOCATE)  GET ROUTINE NAME                  FCI*
         BALR  R14,R15           GO FREE IT..                      FCI*
*
         LA    R2,QCSPOOLS       GET ADDR OF LIST OF HASPACE DCBS  FCI*
         LA    R4,35             MAX OF 35 PASSES THROUGH HERE..   FCI*
FREEUP1  L     R3,0(R2)          GET ADDRESS OF DCB TO WORK ON     FCI*
         LTR   R3,R3             ANYONE THERE?                     FCI*
         BZ    EXITQCK                                             FCI*
         MVC   DA18DDN,40(R3)    MOVE IN DDNAME FROM DCB           FCI*
         L     R15,=V(ALLOCATE)  GET ROUTINE NAME                  FCI*
         BALR  R14,R15           AND GO INVOKE DAIR TO FREE IT..   FCI*
         LA    R2,4(R2)          BUMP                              FCI*
         BCT   R4,FREEUP1                                          FCI*
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   ISSUE FINAL AUTHORIZATION CHECK BEFORE RETURNING TO THE SYSTEMONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
EXITQCK  DS    0H                  QUEUE COMMAND PROCESSING DONE  ONL02
         QAUTHCK QAEND             ISSUE FINAL AUTHORIZATION CHECKONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   FREE THE AREAS ACQUIRED IN INIT (Q3)                              *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         OI    QGETL3,X'80'        PREPARE FOR FREEMAIN           ONL02
         FREEMAIN MF=(E,QFREE)
         TM    QFLAG1,QFLG1DBC    NEED TO TERMINATE ESTAE?        UF024
         BZ    NOESTAE            NO, SKIP THIS                   UF024
         ESTAE 0                  DELETE CURRENT ESTAE            UF024
         NI    QFLAG1,255-QFLG1DBC  CLEAR FLAG                    UF024
NOESTAE  DS    0H                                                 UF024
         QSTOP RC=0               RETURN TO TMP WITH RC=0         ONL11
***********************************************************************
*                                                                     *
*   CONSTANTS AND OTHER ODDITIES                                      *
*                                                                     *
***********************************************************************
         LTORG
CLEAR1   EQU   *                   START OF CLEAR DATA            UF003
*        DC    X'27F5C1'           ESC; ERASE/WRITE; RESET MDT    UF003
         DC    X'C1'               FIX FOR SPF/TCAM               RNB01
         DC    X'115D7E'           SBA  24,80                     UF003
         DC    X'114040'           SBA  1,1                       UF003
         DC    X'3C404000'         RTA  1,1 WITH NULLS            UF003
         DC    X'1DC8'             SF, INTENSIFIED                UF003
         DC    X'13'               INSERT CURSOR                  UF003
CLEAR    EQU   CLEAR1,*-CLEAR1                                    UF003
DUMMY    DC    CL80'    NO DATA IS AVAILABLE FOR YOUR REQUEST'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=QUEUEISP
QUEUE    QSTART 'QUEUE COMMAND - MAINLINE MODULE'                  DOR
*  UNDER ISPF INTERFACE QUEUE TREATED AS SUBROUTINE   DOR
*QUEUE    QSTART MAIN=YES           START QUEUE CSECT ASSEMBLY    DOR
         GBLB   &QISPF DOR
***********************************************************************
* RNB CHANGES:                                                        *
*      (1) RNB01 - FIX FINAL TPUT MESSAGE TO WORK WITH SPF TCAM       *
*                                                                     *
***********************************************************************
         GETMAIN R,LV=4096    GET STORAGE FOR SAVEAREA            DOR
* NOTICE THAT FOR EACH SUBCOMMAND THE MAXIMUM SIZE OF WORK AREA   DOR
* IS 4096 BYTES. THE REASON IS THAT                               DOR
* EACH WORK AREA IS INTACT AND USED AND SHARED BY EACH            DOR
* SUBCOMMAND. THE VALUES FROM EACH SUBCOMMAND ARE UNPREDICATED    DOR
* CHANGED WHEN USE THE WORK AREA AND DESTROYED THE VALUES OF THE  DOR
* CURRENT COMMAND EXCEPT SAVEAREA FOR LINKAGE REGISTERS.          DOR
* THE COMMAND PROGRAM MUST TAKE CARE OF THE WORK AREA             DOR
* WITH REINITIALIZED VALUES EVERY TIME THE COMMAND IS INVOKED.    DOR
* IF THE COMMAND IS REPEATLY REUSED, THE VALUES WILL BE THE SAME. DOR
* IF THE COMMAND IS NEEDED TO EXTRA CORE, IT MUST USE TO GETMAIN  DOR
* ANOTHER AREA  FOR PRECIOUS CONSTANT VALUES (IE TIME STATISTICS).DOR
*  COMMENT FROM DOR/CDSI  07/15/86                                DOR
         ST    R1,8(R13)      FORWARD POINTER                     DOR
         ST    R13,4(R1)      BACKWARD POINTER                    DOR
         LR    R13,R1         MOVE ADDR TO R1                     DOR
***********************************************************************
*                                                                     *
*   CALL - INITIALIZATION                                             *
*                                                                     *
***********************************************************************
         L     R15,=V(INIT)   ADDR OF INIT
         BALR  R14,R15        GO TO IT
         LA    R10,LOOP       INTERRUPTED RETURN ADDRESS
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
*   SYSSNAP IS FOR DEBUGGING WHEN DEVELOP QUEUE COMMAND. DOR
*        OPEN  MF=(E,SNAPOPN)  OPEN SYSSNAP OUTPUT DOR
******************************************************************UF003
*                                                                 UF003
*   INITIALIZE 3270 SCREEN VARIABLES                              UF003
*                                                                 UF003
******************************************************************UF003
         GTSIZE ,             READ 3270 SCREEN SIZE               UF003
         STM   R0,R1,QDOSZR0  SAVE FOR LATER RESTORE              UF003
         LTR   R0,R0          DISPLAY DEVICE?                     UF003
         BZ    NOTDISP        NO, ABORT                           UF003
         SPACE 1                                                  UF003
         STFSMODE ON,INITIAL=YES  TELL VTAM ABOUT FULLSCREEN MODE UF003
         SPACE 1                                                  UF003
         LM    R0,R1,QDOSZR0  RESTORE DESTROYED REGS              UF003
         CH    R1,=H'80'      POSSIBLE MODEL 2 OR 4 TERMINAL?     UF003
         BNE   TRYM5          NO, TRY FOR MODEL 5                 UF003
         CH    R0,=H'43'      MODEL 4 TERMINAL?                   UF003
         BE    MODEL4         YES, SET IT                         UF003
         CH    R0,=H'32'      MODEL 3 TERMINAL?                   UF003
         BNE   SETM2          NO, SET MODEL 2 DEFAULT             UF003
         SPACE 1                                                  UF003
MODEL3   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'29'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'29'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'29'                           UF043
         MVC   QDSCRLEN,=AL2(29*80)  SCR LENGTH                   UF003
         AIF (NOT &QISPF).ISPF1A                                  DOR
         MVC   QDSCRPLN,=AL2(29*80) ISPF FULL SCREEN DOR /CDSI    DOR
         AGO   .ISPF2A                                            DOR
.ISPF1A  ANOP                                                     DOR
         MVC   QDSCRPLN,=AL2(29*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
.ISPF2A  ANOP                                                     DOR
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'E6F0'    (32,1)                         UF003
         MVC   QDSCRO4,=X'E7F7'    (32,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL4   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'40'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'40'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'40'                           UF043
         MVC   QDSCRLEN,=AL2(40*80)  SCR LENGTH                   UF003
         AIF (NOT &QISPF).ISPF1
         MVC   QDSCRPLN,=AL2(40*80) ISPF FULL SCREEN DOR /CDSI
         AGO   .ISPF2
.ISPF1   ANOP
         MVC   QDSCRPLN,=AL2(40*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
.ISPF2   ANOP
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F460'    (43,1)                         UF003
         MVC   QDSCRO4,=X'F5E7'    (43,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
TRYM5    CH    R1,=H'132'     POSSIBLE MODEL 5 TERMINAL?          UF003
         BNE   SETM2          NO, FORCE MODEL 2 DEFAULT           UF003
         CH    R0,=H'27'      ACTUAL MODEL 5?                     UF003
         BNE   SETM2          NO, FORCE MODEL 2 DEFAULT           UF003
         SPACE 1                                                  UF003
MODEL5   MVC   QDLNELEN,=H'132'    LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'24'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'24'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'24'                           UF043
         MVC   QDSCRLEN,=AL2(24*132)  SCR LENGTH                  UF003
         AIF (NOT &QISPF).ISPF1B
         MVC   QDSCRPLN,=AL2(24*132) ISPF FULL SCREEN DOR /CDSI
         AGO   .ISPF2B
.ISPF1B  ANOP
         MVC   QDSCRPLN,=AL2(24*132+QDLINE1-QDSCREEN) TPUT LEN    UF003
.ISPF2B  ANOP
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C2C4'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F5E8'    (27,1)                         UF003
         MVC   QDSCRO4,=X'F66F'    (27,72)                        UF003
         MVC   QDSCRO5,=X'C4C8'    (3,1)                          UF003
         B     LOOP                JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
SETM2    STSIZE SIZE=80,LINE=24  FORCE MODEL 2 DEFAULT            UF003
         SPACE 1                                                  UF003
         B     LOOP           GO TO PROCESS LOOP                  UF003
         SPACE 1                                                  UF003
NOTDISP  TPUT  NOTDSPL,L'NOTDSPL SEND MESSAGE TO USER             UF003
         B     EXIT2          AND RETURN TO CALLER                UF003
         SPACE 1                                                  UF003
NOTDSPL  DC    C'QUEUE COMMAND REQUIRES DISPLAY TERMINAL'         UF003
         EJECT ,                                                  UF003
***********************************************************************
*                                                                     *
*   CALL - COMMAND LINE PARSE                                         *
*                                                                     *
***********************************************************************
LOOP     DS    0H                                                 UF006
         L     R15,=V(PARSE)  ADDR OF PARSE
         BALR  R14,R15        GO TO IT
         CLC   =C'E ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'EXIT ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'END ',QSUBNAME STOP?
         BE    EXIT           YES.
         CLC   =C'STOP ',QSUBNAME STOP?
         BE    EXIT           YES.
***********************************************************************
*                                                                     *
*   TSO  ALLOWS TO USE ISPF/PDF  BY COMMAND MEANS                     *
*                                                                     *
***********************************************************************
         CLC   =C'TSO',QSUBNAME   TSO ?
         BNE   OTHCMD
***********************************************************************
*                                                                     *
*   CALL - SUB-COMMAND MODULE SELECTED BY PARSE                       *
*                                                                     *
***********************************************************************
OTHCMD   MVC   QDHLINE,DUMMY  NO OUTPUT MESSAGE
         L     R15,QSUBCMD    ADDR OF SUBCMD FROM QCOMMON
         BALR  R14,R15        GO TO IT
         MVC   QDMLNG,=H'0'   ZERO OUT MESSAGE LENGTH
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE
         BALR  R14,R15        WRITE LAST SCREEN, GET NEXT INPUT
         B     LOOP           DO IT AGAIN
***********************************************************************
*                                                                     *
*   CLEAN UP AND GO HOME                                              *
*                                                                     *
***********************************************************************
EXIT     STSIZE SIZELOC=QDOSZR1,LINELOC=QDOSZR0  RESTORE SCRSIZE  UF003
         AIF (&QISPF).ISPFA                                       DOR
         TPUT  CLEAR,L'CLEAR,FULLSCR,MF=(E,QTPUT) CLEAR SCREEN    UF003
         STLINENO LINE=1,MODE=OFF                 OFF FULLSCR     UF003
.ISPFA  ANOP                                                      DOR
         USING QCKPT,R8 BASE REG FOR CKPT WORK AREA
EXIT2    DS    0H                                                 UF003
         L     R8,QVCKPT      LOAD BASE REG
         CLOSE MF=(E,HOCKPT)
         SPACE 1                                                     CL
         LA    R7,QCSPOOLS         ADDR OF FIRST DCB POINTER         CL
         LA    R6,9                MAXIMUM NUMBER OF EXTENTS         CL
         SPACE 1                                                     CL
CLOSELOP OC    0(4,R7),0(R7)       SKIP IF THIS EXTENT               CL
         BZ    CLOSEBMP             IS NOT ACTIVE                    CL
         OI    0(R7),X'80'         SET END OF LIST INDICATE          CL
         CLOSE (,FREE),MF=(E,(R7)) CLOSE ONE EXTENT                  CL
CLOSEBMP LA    R7,4(,R7)           BUMP TO NEXT EXTENT               CL
         BCT   R6,CLOSELOP         CONTINUE IF MORE EXTENTS          CL
         SPACE 1                                                     CL
         TM    QPFLAG,HARDCPY         IS HARDCOPY INVOKED?         FCI*
         BNO   FREEUP                   NO..SPLIT THIS STUFF       FCI*
         L     R15,=V(PRINT)               INVOKE PRINT            FCI*
         MVC   QDREPLY,QBLANK                  TO                  FCI*
         MVC   QDREPLY(09),=C'PRINT OFF'          FREE UP          FCI*
         MVC   QDRLNG,=X'0009'                        HARDCOPY     FCI*
         BALR  R14,R15                                     OUTPUT  FCI*
         EJECT
***********************************************************************
*                                                                  FCI*
*   FREE HASPCKPT AND HASPACEN DDNAMES BEFORE LEAVING TO BE NEAT.. FCI*
*                                                                  FCI*
***********************************************************************
FREEUP   MVI   DAIRFLAG,X'18'    INDICATE FREE DDNAME(XXXXXXXX)    FCI*
         MVC   DA18DDN,HASPCKPT+40  GET DDNAME USED...             FCI*
         L     R15,=V(ALLOCATE)  GET ROUTINE NAME                  FCI*
         BALR  R14,R15           GO FREE IT..                      FCI*
*
         LA    R2,QCSPOOLS       GET ADDR OF LIST OF HASPACE DCBS  FCI*
         LA    R4,35             MAX OF 35 PASSES THROUGH HERE..   FCI*
FREEUP1  L     R3,0(R2)          GET ADDRESS OF DCB TO WORK ON     FCI*
         LTR   R3,R3             ANYONE THERE?                     FCI*
         BZ    EXITQCK                                             FCI*
         MVC   DA18DDN,40(R3)    MOVE IN DDNAME FROM DCB           FCI*
         L     R15,=V(ALLOCATE)  GET ROUTINE NAME                  FCI*
         BALR  R14,R15           AND GO INVOKE DAIR TO FREE IT..   FCI*
         LA    R2,4(R2)          BUMP                              FCI*
         BCT   R4,FREEUP1                                          FCI*
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   ISSUE FINAL AUTHORIZATION CHECK BEFORE RETURNING TO THE SYSTEMONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
EXITQCK  DS    0H                  QUEUE COMMAND PROCESSING DONE  ONL02
         QAUTHCK QAEND             ISSUE FINAL AUTHORIZATION CHECKONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   FREE THE AREAS ACQUIRED IN INIT (Q3)                              *
*                                                                     *
***********************************************************************
         SPACE 1                                                  ONL02
         OI    QGETL3,X'80'        PREPARE FOR FREEMAIN           ONL02
         FREEMAIN MF=(E,QFREE)
         AIF (NOT &QISPF).NISPFE                                 DOR
         LR    R10,R9           SAVE QDISPLAY DSECT POINTER      DOR
         L     R15,=V(ISP#QE)   SUBROUTINE RETURN                DOR
         BR    R15              EXIT TO ISPF DRIVER              DOR
.NISPFE  ANOP
NULLISPF TM    QFLAG1,QFLG1DBC    NEED TO TERMINATE ESTAE?        UF024
         BZ    NOESTAE            NO, SKIP THIS                   UF024
         ESTAE 0                  DELETE CURRENT ESTAE            UF024
         NI    QFLAG1,255-QFLG1DBC  CLEAR FLAG                    UF024
NOESTAE  DS    0H                                                 UF024
         QSTOP RC=0               RETURN TO TMP WITH RC=0         ONL11
***********************************************************************
*                                                                     *
*   CONSTANTS AND OTHER ODDITIES                                      *
*                                                                     *
***********************************************************************
         LTORG
CLEAR1   EQU   *                   START OF CLEAR DATA            UF003
*        DC    X'27F5C1'           ESC; ERASE/WRITE; RESET MDT    UF003
         DC    X'C1'               FIX FOR SPF/TCAM               RNB01
         DC    X'115D7E'           SBA  24,80                     UF003
         DC    X'114040'           SBA  1,1                       UF003
         DC    X'3C404000'         RTA  1,1 WITH NULLS            UF003
         DC    X'1DC8'             SF, INTENSIFIED                UF003
         DC    X'13'               INSERT CURSOR                  UF003
CLEAR    EQU   CLEAR1,*-CLEAR1                                    UF003
DUMMY    DC    CL80'    NO DATA IS AVAILABLE FOR YOUR REQUEST'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=QWTO
         MACRO
&NAME    QWTO  &MSG                                               LBDMC
         LCLA  &MLEN                                              LBDMC
&MLEN    SETA  K'&MSG-2                                           LBDMC
&NAME    BAL   R1,QWTO&SYSNDX                                     LBDMC
         DC    C&MSG              MESSAGE TEXT                    LBDMC
QWTO&SYSNDX MVC   QDMLNG,=H'&MLEN' SET MESSAGE LENGTH             LBDMC
         ST    R1,QDMSGA                                          LBDMC
         L     R15,=V(DISPLAY)    PTR OF DISPLAY MODULE           LBDMC
         BALR  R14,R15            GO TO IT                        LBDMC
         MEND
./       ADD   NAME=Q0
QCOMMON  TITLE 'QUEUE COMMAND - COMMON AREA'                      UF004
QCOMMON  QSTART TYPE=GLOBAL
         QCOMMON CSECT=YES
         END
./       ADD   NAME=READSPC
READSPC  TITLE 'QUEUE COMMAND - READ A BLOCK FROM HASPACE'        ONL01
READSPC  QSTART ,                  START READSPC CSECT ASSEMBLY   ONL01
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
***********************************************************************
*                                                                     *
*   CONVERT MTTR TO MBBCCHHR                                          *
*                                                                     *
***********************************************************************
*
* NOTE - THE INPUT TO THIS ROUTINE IS AS FOLLOWS:
*            QCTRAK CONTAINS THE MTTR
*            R1 CONTAINS THE IOAREA ADDRESS
*
         LR    R2,R1          MOVE IOAREA ADDR TO R2
         SR    R3,R3          ZERO R3
         IC    R3,QCTRAKM     RELATIVE DCB NUMBER
         CH    R3,=H'36'      COMPARE WITH MAX POSSIBLE SPOOLS    UF044
         BNL   QTILT1         ERROR IF TOO LARGE                  UF044
         SLL   R3,2           MULTIPLY BY 4
         L     R15,QCTRKCYL(R3)                                   UF044
         LTR   R15,R15        VALID?                              UF044
         BZ    QTILT1         ERROR IF ZERO                       UF044
         L     R15,QCSPOOLS(R3)                                   UF044
         LTR   R15,R15        VALID?                              UF044
         BZ    QTILT1         ERROR IF ZERO                       UF044
         MVC   QCDADR,QCTRAKR MOVE RECORD NUMBER
         MVC   QCDADHH,QCTRAKTT MOVE TRACK TO A HALFWORD BOUNDARY
         LH    R5,QCDADHH     LOAD RELATIVE TRACK NUMBER
         SR    R4,R4          ZERO R4
         D     R4,QCTRKCYL(R3) DIVIDE TRACKS BY TRACKS PER CYLINDER
         STH   R4,QCDADHH     STORE HEAD NUMBER
         STH   R5,QCDADCC     STORE CYLINDER NUMBER
         L     R3,QCSPOOLS(R3) DCB ADDRESS
         USING IHADCB,R3      ADDRESSING FOR DCB DSECT            UF009
         MVC   DCBSYNAD+1(3),=AL3(SYNAD)  SET SYNAD ADDR IN DCB   UF009
         DROP  R3             DROP ADDRESSING FOR DCB             UF009
         READ  HDECB2,DI,(R3),(R2),MF=E
         CHECK HDECB2
         TM    QFLAG1,QFLG1IOE  I/O ERROR?                        UF009
         BZ    READOK         SKIP IF NO                          ONL02
         NI    QFLAG1,255-QFLG1IOE  CLEAR ERROR FLAG              UF009
*        SIMULATE QTILT ACTION                                    UF009
QTILTSIM DS    0H                                                 UF044
         L     R15,=V(DISPLAY) ADDR OF DISPLAY MODULE             UF009
         LR    R14,R15        SET FOR LOOP                        UF009
         BR    R15            GO TO IT                            UF009
         SPACE 2                                                  ONL02
READOK   DS    0H                  SPOOL READ WAS SUCCESSFUL      ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR SPOOL BUFFER                  ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         LR    R1,R2               PASS BUFFER ADDR TO AUTH RTN   ONL02
         QAUTHCK QASPOOL           LET AUTHORIZATION RTN SEE BUFR ONL02
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   RETURN TO CALLER                                              ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QSTOP ,                   RETURN TO CALLER               ONL02
         SPACE 2                                                  ONL02
QTILT1   MVC   QDHLINE,QBLANK CLEAR TARGET AREA                   UF044
         MVC   QDHLINE(L'QTILT1M),QTILT1M  SET ERROR MESSAGE      UF044
         UNPK  QDHLINE+QTILT1M2-QTILT1M1(9),QCTRAK(5)             UF044
         TR    QDHLINE+QTILT1M2-QTILT1M1(8),HEXTAB                UF044
         MVI   QDHLINE+QTILT1M2-QTILT1M1+8,C' '                   UF044
         B     QTILTSIM       GO TO QTILT SIMULATION ROUTINE      UF044
QTILT1M1 DC    C'*** INVALID INPUT TO READSPC - MTTR = '          UF044
QTILT1M2 DC    CL8'        '                                      UF044
         DC    C' ***'                                            UF044
QTILT1M  EQU   QTILT1M1,*-QTILT1M1  ADDRESS AND LENGTH            UF044
         SPACE 1                                                  UF044
SYNAD    SYNADAF ACSMETH=BDAM DECODE ERROR CAUSE                  UF009
         OI    QFLAG1,QFLG1IOE  SET I/O ERROR FLAG                UF009
         USING QDISPLAY,R15   BASE REG FOR DISPLAY WORK AREA      UF009
         L     R15,QVDSPL     LOAD BASE REG                       UF009
         MVC   QDHLINE,QBLANK BLANK MESSAGE AREA                  UF009
         MVC   QDHLINE(78),50(R1)  COPY SYNAD MESSAGE             UF009
         MVC   QDMLNG,=H'0'   ZERO MESSAGE LENGTH                 UF009
         DROP  R15                                                UF009
         SYNADRLS ,           RELEASE WORK AREA                   UF009
         BR    R14            RETURN TO OP SYS                    UF009
         LTORG
HEXTAB   EQU   *-C'0'                                             UF044
         DC    C'0123456789ABCDEF'                                UF044
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
READSPC  CSECT                                                    RNB03
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         DCBD  DSORG=DA,DEVD=DA                                   UF009
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=REPOS
REPOS    TITLE 'QUEUE COMMAND - DATASET REPOSITIONING ROUTINES'   ONL01
REPOS    QSTART ,                  START REPOS CSECT ASSEMBLY     ONL01
         GBLB  &QONL          ENABLES ONL SPECIFIC CODE           ONL06
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         CLC   QCODEH,=H'36'  MODEL 2/5 COMMAND?                  UF003
         BE    MODEL          OK IF NO DATASET                    UF003
         SPACE 1                                                  UF003
CHKID    CLC   QPDSID,=H'0'   IS THERE A VALID DATASET?
         BNE   GO             YES. GO AHEAD.
         QTILT '*** YOU ARE NOT PROCESSING A VALID DATASET ***'
GO       LH    R1,QCODEH      LOAD FUNCTION CODE
         CH    R1,=H'32'      IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     TILT           0 OFFSET
         B     FIND           4
         B     FINDTIME       8
         B     COLUMN         12
         B     AT             16
         B     PLUS           20
         B     MINUS          24
         B     TOP            28
         B     BOTTOM         32
TILT     QTILT '*** PARAMETER IS INVALID OR OMITTED ***'
***********************************************************************
*                                                                     *
*   REPOSITION VERTICALLY                                             *
*                                                                     *
***********************************************************************
* SKIP FORWARD
PLUS     CLI   QPARM1,C' '    DEFAULT NEEDED
         BNE   PLUS010        NO
         MVI   QLNG1+1,X'01'  YES, SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET DEFAULT TO 1
PLUS010  BAL   R4,NUMERIC     VALIDATE PARAMETER
         AP    QPREC,COUNT    ADD COUNT TO CURRENT RECORD
         B     RESUME         CALL LISTDS
* SKIP BACKWARD
MINUS    CLI   QPARM1,C' '    DEFAULT NEEDED
         BNE   MINUS010       NO
         MVI   QLNG1+1,X'01'  YES, SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET DEFAULT TO 1
MINUS010 BAL   R4,NUMERIC     VALIDATE PARAMETER
         SP    QPREC,COUNT    SUBTRACT COUNT FROM CURRENT RECORD
         BP    RESUME         CALL LISTDS IF RESULT POSITIVE.
* TOP OF DATASET
TOP      ZAP   QPREC,=P'1'    SET CURRENT RECORD TO TOP OF DS
* RESUME AT CURRENT RECORD
RESUME   L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         TM    QFLAG1,QLISTCC  IS CC CMD PROCESS FLAG ON?
         BZ    LISTDS
         L     R15,=V(LISTDS2)  ONLY FOR CC CMD
LISTDS   BALR  R14,R15        GO TO IT
STOP     QSTOP
* BOTTOM OF DATASET
BOTTOM   ZAP   QPREC,=P'9999999' SET CURRENT RECORD TO LARGEST
         B     RESUME         CALL LISTDS
* POSITION TO THIS RECORD
AT       BAL   R4,NUMERIC     VALIDATE PARAMETER
         ZAP   QPREC,COUNT    INDICATE REPOSITION NO
         B     RESUME         CALL LISTDS
* CHECK THE PARMETER FOR VALID NUMERIC AND PACK IT
NUMERIC  LH    R2,QLNG1       LENGTH OF PARM
         SH    R2,=H'1'       IS THE COUNT FIELD ZERO?
         BM    RESUME         YES. RESUME FROM CURRENT POSITION.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC CHECK
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. TILT.
         EX    R2,PACK        PACK THE FIELD INTO COUNT
         CLI   QSUBNAME,C'P'  ?/PAGE FORWARD/BACKWARD SPECIFIED
         BE    FOUNDP         YES. GO PROCESS
         CLI   QSUBNAME,C'H'  ?/HALF PAGE FORWARD/BACKWARD SPECIFIED
         BNE   NEXIT          NO. GO TO EXIT
         MP    COUNT,QDLNES   YES. MULTIPLY BY PAGE SIZE          UF003
         DP    COUNT,=P'2'    AND CONVERT TO HALF PAGES           UF003
         ZAP   COUNT,COUNT(7) RE-ALIGN THE STUPID FIELD           UF003
         B     NEXIT
FOUNDP   MP    COUNT,QDLNES   YES. MULTIPLY BY PAGE SIZE          UF003
NEXIT    BR    R4             RETURN
* EXECUTED INSTRUCTIONS
MVZ      MVZ   QFZONES(1),QPARM1 CHECK FOR NUMERIC
PACK     PACK  COUNT,QPARM1(1) PACK COUNT
***********************************************************************
*                                                                     *
*   REPOSITION HORIZONTALLY                                           *
*                                                                     *
***********************************************************************
COLUMN   CLI   QPARM1,C' '    ?/DEFAULT NEEDED
         BE    COL010         YES, GO SET IT
         CLI   QPARM1,C'0'    ?/SET COLUMN TO 1
         BNE   COL020         NO, TEST IF NUMERIC
COL010   MVI   QLNG1+1,X'01'  SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET COLUMN TO 1
COL020   BAL   R4,NUMERIC     VALIDATE PARAMETER
         CP    COUNT,=P'255'  IS THE COUNT FIELD TOO BIG?
         BH    TILT           YES. TILT.
         SP    COUNT,=P'1'    COLUMN RELATIVE TO ZERO
         BM    TILT           INVALID. TILT.
         CVB   R5,COUNT       CONVERT TO BINARY
         STH   R5,QPOFFSET    STORE IN QPOFFSET
         B     RESUME         CALL LISTDS
***********************************************************************
*                                                                     *
*   LOCATE SPECIFIC RECORD                                            *
*                                                                     *
***********************************************************************
FIND     CLI   QSUBNAME+1,C'A' IS THE REQUEST FOR FIND ALL?
         BE    FIND2          YES. DO NOT UPDATE RECORD POINTER.
         AP    QPREC,=P'1'    START SEARCH AT NEXT RECORD
FIND2    CLI   QPARM1,C' '    IS THERE A PARAMETER?
         BE    RESUME         NO. CONTINUE WITH PREVIOUS FIND.
         LA    R2,QDREPLY+62  END OF USER REPLY
         LA    R3,61          MAXIMUM LENGTH OF PARM
         SH    R3,QOFF1       OFFSET TO FIRST PARM
         AIF   (NOT &QONL).SKPONL1                                ONL12
         CLI   QPARM1,C'/'         DO 'OLD TIME' SCAN IF FIRST    ONL12
         BE    LOOP                 CHARACTER IS A SLASH          ONL12
.SKPONL1 ANOP  ,                                                  ONL12
         CLI   QPARM1,C''''        DO 'OLD TIME' SCAN IF FIRST    CL002
         BE    LOOP                 CHARACTER IS AN APOSTROPHE    CL002
         CLI   QPARM1,C'"'           OR IF THE FIRST CHARACTER    ONL13
         BE    LOOP                   IS A DOUBLE QUOTE           ONL13
         LA    R2,QDREPLY+1         FIRST POSSIBLE ADDR OF REPLY  CL002
         AH    R2,QOFF1            ADDR OF SECOND BYTE OF REPLY   CL002
         SPACE 1                                                  CL002
LOOPNA   CLI   0(R2),C' '          LOOK FOR FIRST BLANK           CL002
         BE    FOUNDNA             BR WHEN FOUND                  CL002
         LA    R2,1(,R2)           EXAMINE NEXT CHARACTER         CL002
         BCT   R3,LOOPNA           KEEP LOOKING IF POSSIBLE       CL002
         B     TILT                END IF TOO LONG                CL002
FOUNDNA  LR    R3,R2               ADDR OF FIRST BLANK            CL002
         LA    R2,QDREPLY          ADDR OF FIRST POSSIBLE CHAR    CL002
         AH    R2,QOFF1            ACTUAL ADDR OF FIRST NON-BLANK CL002
         SR    R3,R2               LENGTH OF STRING               CL002
         BCTR  R3,0                MACHINE LENGTH OF STRING       CL002
         B     FOUNDNA2            RE-JOIN LOGIC                  CL002
LOOP     CLC   0(1,R2),QPARM1 IS THIS THE DELIMITER?
         BE    FOUND          YES. CONTINUE.
         BCTR  R2,0           TRY THE PREVIOUS BYTE
         BCT   R3,LOOP        IS THE LENGTH FIELD EXHAUSTED?
         B     TILT           YES. TILT.
FOUND    BCTR  R3,0           DECREMENT LENGTH BY 1
         LA    R2,QDREPLY+1   ADDR OF REPLY + 1
         AH    R2,QOFF1       ADDR OF FIRST BYTE OF PARM
FOUNDNA2 DS    0H                                                 CL002
         EX    R3,MVC         MOVE PARM TO QPFIND
         STH   R3,QPLNG       SAVE LENGTH-1 OF PARM
         B     COLTEST        TEST IF COLUMN KEYWORD IS PRESENT
MVC      MVC   QPFIND(1),0(R2) MOVE PARM TO QPFIND
***********************************************************************
*                                                                     *
*    COLUMN RANGE FOR FIND                                            *
*                                                                     *
***********************************************************************
COLTEST  XC    QOFFS,QOFFS    RESET COLUMN OFFSETS
         XC    QOFFE,QOFFE
         LA    R2,3(R2,R3)    PREPARE FOR NEXT FIELD
         LA    R3,QDREPLY+55  END OF USER REPLY
         SPACE 1                                                  ONL13
         AIF   (NOT &QONL).SKPONL2                                ONL12
         CLI   QPARM1,C'/'         WERE DELIMITER CHARS USED?     ONL12
         BE    DLMUSED             SKIP IF YES                    ONL12
.SKPONL2 ANOP  ,                                                  ONL12
         CLI   QPARM1,C''''        WERE DELIMITER CHARS USED?     ONL13
         BE    DLMUSED             SKIP IF YES                    ONL13
         CLI   QPARM1,C'"'         WERE DELIMITER CHARS USED?     ONL13
         BE    DLMUSED             SKIP IF YES                    ONL13
         BCTR  R2,0                ACCOUNT FOR MISSING DELIMITERS ONL13
DLMUSED  DS    0H                                                 ONL13
         SPACE 1                                                  ONL13
LOOP1    CLC   0(3,R2),=CL3'COL'  ?/COLUMN PARAMETER
         BE    FOUNDA         YES. GO PROCESS
         LA    R2,1(R2)       NO. LOOK AT NEXT FIELD
         CR    R2,R3          ?/END OF REPLY
         BH    RESUME         YES. EXIT
         B     LOOP1          NO. CHECK AGAIN
FOUNDA   LA    R2,3(R2)       NEXT FIELD
         CLI   0(R2),C'('     ?/LP PRESENT
         BNE   PRESUME        NO. EXIT
         LA    R2,1(R2)       NEXT FIELD
         LA    R3,QDREPLY+62  END OF REPLY
         LR    R5,R2          SAVE START OF THIS FIELD
         MVI   QDELIMIT,C','  LOOKING FOR DELIMITER = ','
         BAL   R7,CHKDEL      GO CHECK THE DELIMITER
         CVB   R6,COUNT       CONVERT START COLUMN OFFSET TO BINARY
         LTR   R6,R6          ?/USER SPECIFY OFFSET OF ZERO
         BZ    PRESUME        YES. GO INDICATE AN ERROR
         BCTR  R6,0           DECREMENT OFFSET BY 1
         STH   R6,QOFFS       SAVE START COLUMN
         LA    R2,1(R2)       NEXT FIELD
         LR    R5,R2          SAVE START OF THIS FIELD
         MVI   QDELIMIT,C')'  LOOKING FOR DELIMITER = ')'
         BAL   R7,CHKDEL      GO CHECK THE DELIMITER
         CVB   R6,COUNT       CONVERT END COLUMN OFFSET TO BINARY
         LTR   R6,R6          ?/USER SPECIFY OFFSET OF ZERO
         BZ    PRESUME        YES. GO INDICATE AN ERROR
         BCTR  R6,0           DECREMENT OFFSET BY 1
         STH   R6,QOFFE       SAVE END COLUMN
         CLC   QOFFS,QOFFE    ?/ERROR IN COLUMN SPECIFICATION
         BNL   PRESUME        YES. DISREGARD COLUMN SEARCH
         B     RESUME         NO. CONTINUE WITH NORMAL PROCESSING
CHKDEL   CLC   0(1,R2),QDELIMIT ?/DELIMITER FOUND
         BE    CHK010         YES. GO PROCESS
         LA    R2,1(R2)       NO. LOOK AT NEXT FIELD
         CR    R2,R3          ?/END OF REPLY
         BH    PRESUME        YES. EXIT
         B     CHKDEL         NO. CHECK AGAIN
CHK010   LR    R4,R2          SAVE DELIMITER ADDRESS
         SR    R4,R5          LENGTH OF SUB-PARM
         CH    R4,=H'3'       ?/LENGTH TO LONG
         BNL   PRESUME        YES. DISREGARD COLUMN SEARCH
         BCTR  R4,0           LENGTH FOR EXEC INTRUCTION
         MVC   QFZONES,QFZONE  NUMERIC TEST
         EX    R4,MVZ1
         CLC   QFZONES,QFZONE ?/FIELD NUMERIC
         BNE   TILT           NO. EXIT WITH ERROR MESSAGE
         EX    R4,PACK1
         BR    R7
PRESUME  XC    QOFFS,QOFFS    DISREGARD FIND
         XC    QOFFE,QOFFE       BY COLUMN RANGE
         QTILT ' *** ERROR IN COLUMN SPECIFICATION ***'
MVZ1     MVZ   QFZONES(1),0(R5)
PACK1    PACK  COUNT,0(1,R5)
***********************************************************************
*                                                                     *
*   REPOSITION IN SYSLOG DATASET BY TIME OF DAY                       *
*                                                                     *
***********************************************************************
FINDTIME CLI   QPARM1,C' '    IS THE PARM OMITTED?
         BE    TILT           YES. TILT.
         B     RESUME         CALL LISTDS
         EJECT                                                    UF003
******************************************************************UF003
*                                                                 UF003
*   SWITCH MODEL TYPE FOR 3270 TERMINAL                           UF003
*                                                                 UF003
******************************************************************UF003
MODEL    DS    0H             ,                                   UF003
         BAL   R4,NUMERIC     VALIDATE PARAMETER                  UF003
         CP    COUNT,=P'2'    MODEL 2?                            UF003
         BE    MODEL2         YES, BRANCH                         UF003
         CP    COUNT,=P'3'    MODEL 3?                            UF003
         BE    MODEL3         YES, BRANCH                         UF003
         CP    COUNT,=P'4'    MODEL 4?                            UF003
         BE    MODEL4         YES, BRANCH                         UF003
         CP    COUNT,=P'5'    MODEL 5?                            UF003
         BE    MODEL5         YES, BRANCH                         UF003
         QTILT 'UNSUPPORTED MODEL TYPE'                           UF003
         SPACE 1                                                  UF003
MODEL2   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'21'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'21'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'21'                           UF043
         MVC   QDSCRLEN,=AL2(21*80) SCREEN LENGTH                 UF003
         MVC   QDSCRPLN,=AL2(21*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'F5'       ERASE/WRITE                    UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'5CF0'    (24,1)                         UF003
         MVC   QDSCRO4,=X'5DF7'    (24,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=24    SET SCREEN SIZE FOR VTAM       UF003
         SPACE 1                                                  UF003
MODELN   CLC   QPDSID,=H'0'        IS THERE A DATASET?            UF003
         BNE   RESUME              YES, CALL LISTDS               UF003
         MVC   QDHLINE,=CL80' '    BLANK HEADING LINE             UF003
         B     STOP                AND RETURN                     UF003
         SPACE 1                                                  UF003
MODEL3   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'29'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'29'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'29'                           UF043
         MVC   QDSCRLEN,=AL2(29*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(29*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'E6F0'    (32,1)                         UF003
         MVC   QDSCRO4,=X'E7F7'    (32,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=32    SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL4   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'40'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'40'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'40'                           UF043
         MVC   QDSCRLEN,=AL2(40*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(40*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F460'    (43,1)                         UF003
         MVC   QDSCRO4,=X'F5E7'    (43,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=43    SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL5   MVC   QDLNELEN,=H'132'    LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'24'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'24'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'24'                           UF043
         MVC   QDSCRLEN,=AL2(24*132)  SCR LENGTH                  UF003
         MVC   QDSCRPLN,=AL2(24*132+QDLINE1-QDSCREEN) TPUT LEN    UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C2C4'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F5E8'    (27,1)                         UF003
         MVC   QDSCRO4,=X'F66F'    (27,72)                        UF003
         MVC   QDSCRO5,=X'C4C8'    (3,1)                          UF003
         STSIZE SIZE=132,LINE=27   SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         EJECT                                                    UF003
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    CL72
COUNT    DS    D
         END
./       ADD   NAME=REQUS
         MACRO
         REQUS
         GBLB  &HADREQ
         AIF   (&HADREQ).MEND
&HADREQ  SETB  1
         SPACE 2
* G E N E R A L   R E G I S T E R S
*
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         SPACE
.MEND    MEND
./       ADD   NAME=ROUTE
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/12/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
ROUTE    TITLE 'QUEUE COMMAND - REROUTE A JOB  '
ROUTE    QSTART HASPEQU=YES,       START ROUTE DSECT ASSEMBLY DOR XXXXXX
               XTITLE='QUEUE COMMAND - REROUTE A JOB  '
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QSP136        SP1.3.6 OPTION FLAG               DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA    DOR
         L     R10,QVDSPL     LOAD BASE REG                     DOR
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA      DOR
         LA    R8,4095(R11)
         LA    R8,1(,R8)
         USING QCOMMON+4096,R8
***********************************************************************
***********************************************************************
*    R1
*    R2   -
*    R3
*    R4   -
*    R5   -
*    R6   -
*    R7  JCTDSECT
*    R8   - QCOMMON+4096
*    R9   - QVDSPL
*    R10  -  QDISPLAY
*    R11     QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
*        L     R15,=V(CHKAUTH)    BRANCH TO AUTHORIZATION
*        BALR  R14,R15                         CHECK ROUTINE
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB)     ADDR OF MODULE TO FIND JOB
         BALR  R14,R15             GO TO IT
         AIF   (&QACF2).ACF1
         TM    QAFLAGS,QAFXOPER     IS USER TSO OPER AUTHORIZED
         BO    COMMAND             YES   BYPASS JOBNAME CHECKING
***********************************************************************
*                                                                     *
*   ENSURE JOBNAME BEGINS WITH USER ID                                *
*                                                                     *
***********************************************************************
         LA    R2,7               MAXIMUM LENGTH OF USER ID
         LA    R3,QLOGON+3        LAST BYTE OF USER ID
LOOP     CLI   0(R3),C' '         IS THIS BYTE BLANK?
         BNE   CHECK              NO. CONTINUE.
         BCTR  R3,0               TRY PREVIOUS BYTE
         BCT   R2,LOOP            TRY AGAIN
CHECK    EX    R2,CLC             IS THE JOBNAME VALID?
         BNE   TILT               NO. TILT.
.ACF1    ANOP  ,                  ACF2 HAS ALREADY CHECKED AUTHORITY
         SPACE 4
***********************************************************************
*                                                                     *
*   BUILD ROUTE COMMAND AND ISSUE SVC                                 *
*                                                                     *
***********************************************************************
COMMAND  EQU   *
         L     R7,QCJCTA           ADDR OF IOAREA FOR JCT
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JCT,R7         BASE REG FOR JCT               DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JCTDSECT,R7         BASE REG FOR JCT               DOR
.X136A   ANOP                                                       DOR
         MVC   RALL,=C'$RALL,J=T'
         CLI   JCTJOBID,C'T' 'TSU JOBNBR'
         BE    YESJID
         MVC   RALL,=C'$RALL,J=S'
         CLI   JCTJOBID,C'S' 'STC JOBNBR'
         BE    YESJID
*   THE JOBS TO BE REROUTED
NOTSO    MVC   RALL,=C'$RALL,J=J'    MOVE FIRST PART OF COMMAND
YESJID   EQU   *
         LH    R2,QLNG1
         SH    R2,=H'1'
         BM    OLDJID      BLANKED JOB ID - DEFAULT CURRENT JOB ID
         CLI   QPARM1,C'-' CURRENT JOB ID
         BE    OLDJID
         CLI   QPARM1,C'*' CURRENT JOB ID
         BE    OLDJID
         MVC   JOBN,QPARM1           MOVE JOB NUMBER TO COMMAND
THATJID  MVC   DEST(10),=CL10',D= '    MOVE SECOND PART OF COMMAND
         LA    R2,QPARM2
         LH    R3,QLNG2
         LTR   R3,R3
         BNZ   DESTOK
         MVC   DEST+3,=CL5'LOCAL'
         LA    R3,5
         B     DESTDEF   DEFAULT D=LOCAL
OLDJID   EQU   *
         LA    R3,4
         LA    R1,JCTJOBID+4
JIDLOOP  CLI   0(R1),C' '  CHECK FOR VARIABLE JOB ID LENGTH
         BNE   JIDFIND
         LA    R1,1(R1)
         BCT   R3,JIDLOOP LESS ONE BYTE
         B     TILTJ
JIDFIND  EX    R3,JIDMVC
         B     THATJID
JIDMVC   MVC   JOBN(*-*),0(R1)         FILL IN CURRENT JOB ID
DESTOK   EX    R3,MVCDEST
DESTDEF  LA    R1,L'RALL+L'JOBN         LOAD  LENGTH OF COMMAND
         LA    R1,3(R1)    ADD ',D='
         AR    R1,R3         ADD DEST LENGTH
         LR    R3,R1          MAXIMUM LENGTH OF PARM
         LA    R1,4(,R1)                ADD   LENGTH OF HEADER
         STH   R1,SVC34PL               STORE LENGTH OF COMMAND
         MVI   QPOPRD,C' '
         MVC   QPOPRD+1(79),QPOPRD
         LA    R2,RALL        ADDR OF REPLY + 1
         EX    R3,MVC         MOVE PARM TO QPFIND
         STH   R3,QPLNG       SAVE LENGTH-1 OF PARM
         STH   R3,QPOPRL      SAVE LENGTH-1 OF PARM
         LA    R3,0
         CLC   QPOPRD(1),=C'$'
         BE    RJES$
         L     R3,=F'1'
RJES$    ST    R3,QPOPRN
         LA    R3,QPOPRN
         ST    R3,QPOPR2
         OI    QPOPR2,X'80'
         LA    R3,QPOPRL
         ST    R3,QPOPRA
         B     COSVC34        TEST IF COLUMN KEYWORD IS PRESENT
MVC      MVC   QPOPRD(1),0(R2) MOVE PARM TO QPOPRD
MVCDEST  MVC   DEST+3(1),0(R2) MOVE PARM TO DEST
COSVC34  EQU   *
         SETAUTH  ON
         LA    R1,QPOPRA      LOAD OPER PARM LIST POINTER
         LINK  EP=COMMAND TREAT BOTH AS SVC34 AND WTO
         SETAUTH  OFF
COMMOK   QTILT '**** JOB HAS BEEN RE-ROUTED ****'
TILTJ    QTILT '**** JOBNAME MUST DEFINE IN 4 NUMERICAL DIGITS ****'
         EJECT
         AIF   (&QACF2).ACF2
CLC      CLC   QLOGON(1),JCTJNAME    IS THE JOBNAME EQUAL TO USERID
TILT     QTILT '**** JOBNAME MUST BEGIN WITH USERID  ****'
.ACF2    ANOP
         LTORG
         PRINT NOGEN
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136B                                 DOR
         IFGRPL  DSECT=YES,AM=VTAM                                  DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
JCT     EQU   0
.X136B   ANOP                                                       DOR
        $BUFFER
        $JQE
        $JCT
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    CL72
COUNT    DS    D
TRACESW  DS    F
SVC34PL  DS    0H             ASSUME HALF-WORD BOUNDARY
SVC34LEN DC    AL2(L'RALL+L'JOBN+L'DEST)    LENGTH OF COMMAND
SVC340   DC    H'0'           RESERVED
RALL     DS    CL9            FIRST HALF
JOBN     DS    CL4            JOB NUMBER
DEST     DS    CL30           SECOND HALF
         END
./       ADD   NAME=SAUGAGE
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     2/21/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
SAUGAGE  TITLE 'QUEUE COMMAND - DISPLAY STORAGE USAGE INFORMATION  '
SAUGAGE  QSTART ,                  START SAUAGE DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
***********************************************************************
***       FORMERLY AND MODIFIED FOR QUEISPF                         ***
***      TITLE 'CSCGF03D -   #F  DISPLAY STORAGE USAGE GRAPHICALLY'
***********************************************************************
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   - NO OF ASCBS
*    R8   -   ASID OR CSBD ADDRESS
*    R9   -
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
***********************************************************************
***********************************************************************
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***       CSCGF03D -       F  DISPLAY STORAGE USAGE                 ***
***       VERSION -        1.1                                      ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***       UPDATED -        07/19/81 AXC-CBT FIX ESTAE               ***
***********************************************************************
*        CLI   TRACESWT,X'00'
*        BNE   TRACEOK
*        CALL  TRACE
*        MVI   TRACESWT,X'FF'
TRACEOK  EQU   *
***********************************************************************
         LA    R4,JOBTABAD         POINT TO TIME
         TIME  BIN
         L     R6,4(0,R4)          PREVIOUS TIME
         LR    R5,R0               CURRENT TIME
         SR    R5,R6               INTERVAL TIME
         ST    R0,4(0,R4)
         LTR   R6,R6               1ST TIME
         BZ    PFTLIST
         ST    R5,0(0,R4)          SAVE INTERVAL TIME
         EJECT
PFTLIST  MVC   QDHLINE(80),=CL80'      STORAGE USAGE GRAPHICALLY'
         L     R14,16              LOAD CVT ADDR
         L     R6,556(0,R14)       LOAD ASVT ADDR
         L     R7,516(0,R6)        MAX NO. OF ASCBS
         ST    R7,NOASCBS
         LA    R6,524(0,R6)        1ST ASCB SLOT
         L     R3,356(0,R14)       LOAD PVT ADDR
         L     R4,12(0,R3)         PFT APPARENT ADDR
         AH    R4,16(0,R3)         PFT ACTUAL ADDR
         SR    R5,R5               INDEX
         ICM   R5,3,18(R3)         INDEX TO THE END OF PTF  MVS/SP DOR
         SH    R5,16(0,R3)
         SRL   R5,4                DIVIDE BY 16
         STM   R4,R5,PFTREGS       SAVE PFT REGS
         LH    R14,16(0,R3)        NUCLEUS FRAMES
         SRL   R14,4               DIVIDE BY 16
         AH    R14,8(0,R3)         NON-NUCLEUS FRAMES
         ST    R14,TOTFRMS
         CVD   R14,DOUBLE          CONVERT TO DECIMAL
         MVC   QDMSG(80),QBLANK
         MVC   QDMSG(12),=CL12'TOTAL'
         MVC   QDMSG+8(6),=X'402020202120'
         ED    QDMSG+8(6),DOUBLE+5
         LH    R14,16(0,R3)        NUCLEUS FRAMES
         SRL   R14,4               DIVIDE BY 16
         AH    R14,1830(0,R3)      TOTAL FIXED
         L     R1,TOTFRMS
         SR    R1,R14              TOTAL PAGABLE
         ST    R1,TOTFRMS          TOTAL PAGABLE
         CVD   R1,DOUBLE
         MVC   QDMSG+20(12),=CL12'PAGABLE'
         MVC   QDMSG+28(6),=X'402020202120'
         ED    QDMSG+28(6),DOUBLE+5
         L     R14,16              CVT
         L     R14,604(0,R14)      RMCT
         L     R15,4(0,R14)        CCT            MVS/SP134 DOR
         SR    R1,R1
         ICM   R1,3,104(R15)       LONG TERM CPU AVG (CCVUGUTL)
         CVD   R1,DOUBLE
         MVC   QDMSG+40(14),=CL14'LGCPU='
         MVC   QDMSG+46(4),=X'40202120'
         ED    QDMSG+46(4),DOUBLE+6
         LH    R1,102(0,R15)  AVERAGE CPU  (CCVUTILP)    MVS/SP134 DOR
         CVD   R1,DOUBLE
         MVC   QDMSG+54(14),=CL14'AVCPU='
         MVC   QDMSG+60(4),=X'40202120'
         ED    QDMSG+60(4),DOUBLE+6
         L     R15,228(0,R14)      RCT            MVS/SP134 DOR
         LH    R1,62(0,R15)       AVERAGE UIC     MVS/SP134 DOR
         CVD   R1,DOUBLE          RCVUICA
         MVC   QDMSG+68(12),=CL12'AVUIC='
         MVC   QDMSG+74(4),=X'40202120'
         ED    QDMSG+74(4),DOUBLE+6
         LH    R1,72(0,R15)       AVERAGE PAGING   MVS/SP134 DOR
         ST    R1,AVPAG           RCVPTR
         LH    R1,70(0,R15)       AVERAGE ASMQ      MVS/SP134 DOR
         ST    R1,AVASQ           RCVASMQA
         SR    R2,R2
         BAL   R7,PGPRINT
         MVC   QDMSG(80),QBLANK
         L     R8,=X'0000FFFF'
         BAL   R7,PAGEPRNT         GO COUNT AND FORMAT
         MVC   QDMSG(80),QBLANK
         EJECT
GETASCB  LA    R6,4(0,R6)          NEXT SLOT
         L     R7,NOASCBS
         BCT   R7,ASCBFND          GO PROCESS
         B     PAGEPJP             GO OUTPUT RESULTS
         SPACE 3
RETURN   EQU   *
         QSTOP
         SPACE 3
ASCBFND  EQU   *
         ST    R7,NOASCBS
         TM    0(R6),X'80'         AVAILABLE SLOT
         BO    GETASCB             YES, GET NEXT SLOT
         L     R9,0(0,R6)          LOAD ASCB ADDR
         ST    R9,ASCBADDR
         SR    R8,R8             LOAD
         ICM   R8,3,36(R9)          ASID    MVS/SP DOR
         BAL   R7,PAGEPRNT         GO COUNT AND FORMAT
         B     GETASCB
         EJECT
JPAGE    L     R14,16              LOAD CVT ADDR
         L     R14,556(0,R14)      LOAD ASVT ADDR
         LA    R14,524(0,R14)      1ST ASCB SLOT
         SLL   R8,2
         LA    R14,0(R8,R14)      THIS ASID ASCB SLOT
         LR    R8,R2              JOB TABLE SLOT THIS ASID
         L     R9,0(0,R14)         ASCB ADDR
         L     R2,JOBTABAD         POINT TO TIME
*        L     R2,0(0,R2)          INTERVAL TIME
         L     R1,148(0,R9)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BCR   8,R7                NO
         ST    R1,SAVEOUXB
         CLC   0(24,R8),=24X'00'  1ST TIME
         BNE   JPAGE2              NO
         SPACE 1
JPAGE1   L     R1,SAVEOUXB
         MVC   0(24,R8),16(R1)    SAVE OUXB PAGING ACCUM FIELDS
         BR    R7
         SPACE 1
JPAGE2   LTR   R2,R2               1ST TIME
         BCR   8,R7
         L     R14,16(0,R1)        CURR PAGEIN
         S     R14,0(0,R8)        SUB PREV PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         LR    R15,R14             ACCUMULATE
         L     R14,20(0,R1)        CURR PAGEOUT
         S     R14,4(0,R8)        SUB PREV PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         S     R14,8(0,R8)        SUB PREV PAGE RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         SR    R15,R14             ACCUMULATE
         L     R14,28(0,R1)        CURR VIO PAGEIN
         S     R14,12(0,R8)       SUB PREV VIO PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         S     R14,16(0,R8)       SUB PREV VIO PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,36(0,R1)        CURR VIO RECLAIM
         S     R14,20(0,R8)       SUB PREV VIO RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         SR    R15,R14             ACCUMULATE
         SR    R14,R14
         M     R14,=F'100'
         DR    R14,R2              PAGES PER SEC
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   QDMSG+25(10),=X'402021204B2020404040'
         ED    QDMSG+25(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R2              HUNDREDTHS
         CVD   R15,DOUBLE
         UNPK  QDMSG+30(2),DOUBLE+6(2)
         OI    QDMSG+31,X'F0'
         SLL   R1,1
         C     R15,=F'50'          ROUND UP GRAPH
         BL    *+8                 NO
         LA    R1,1(0,R1)
         CH    R1,=H'46'
         BNH   *+8
         LH    R1,=H'46'          FORCE MAX
         EX    R1,PAGMVE
         LA    R1,QDMSG+38(R1)
         MVI   0(R1),C'>'
         B     JPAGE1
         SPACE 1
JPAGE4   MVC   QDMSG+25(18),=CL18'   0 '
         B     JPAGE1
         SPACE 1
PAGMVE   MVC   QDMSG+38(0),PAGGRAPH
         EJECT
PAGEPRNT LM    R4,R5,PFTREGS       LOAD PFT REGS
         SR    R14,R14             CLEAR FRAME COUNT
         SR    R9,R9               CLEAR AVAILABLE FRAME COUNT
         SPACE 3
         SR    R15,R15             CLEAR REGISTER FOR ICM
PAGEPR1  EQU   *
         TM    13(R4),X'10'      NOT VIRTUAL PAGE OWNED BY ASID
         BO    PAGEPR2            VIO FRAME (NOT OWNED BY ASID)
         ICM   R15,3,0(R4)       LOAD PFT ASID  MVS/SP DOR
         CR    R8,R15             ASID MATCH
         BNE   PAGEPR2             NO, DONT INCR FRAME COUNT
         LA    R14,1(0,R14)        ADD 1 TO FRAME COUNT
         LA    R2,1
         SPACE 3
PAGEPR2  LA    R4,16(0,R4)         NEXT PFT
         BCT   R5,PAGEPR1          PROCESS NEXT
         C     R8,=X'00000001'    MASTER
         BE    ASIDMSTR            YES, GO PRINT MASTER
         C     R8,=X'0000FFFF'    SYS PAGES
         BNE   PAGEPR3             NO, ASID
         L     R15,AVPAG           AVERAGE PAGING
         CVD   R15,DOUBLE
         MVC   QDMSG+4(12),=CL12'*SYSTEM*'
         MVC   QDMSG+27(12),=CL12'AVPAG='
         MVC   QDMSG+33(5),=X'4020212040'
         ED    QDMSG+33(4),DOUBLE+6
         CH    R15,=H'46'
         BNH   *+8
         LH    R15,=H'46'          FORCE MAX
         EX    R15,SYSMVE
         LA    R15,QDMSG+38(R15)
         MVI   0(R15),C'>'
         B     PAGEPR4
         SPACE 1
SYSMVE   MVC   QDMSG+38(0),SYSGRAPH
         EJECT
PAGEPR3  LTR   R14,R14             ANY FRAMES
         BCR   8,R7                NO, BYPASS PRINT
         CH    R8,=H'130'         MAX ASID ALLOWED
         BCR   2,R7                OVER MAX
         MH    R8,=H'28'          COUNT AREA SIZE
         LA    R3,JOBTABAD
         AR    R8,R3             POINT TO ASID COUNT SLOTS
         ST    R14,24(0,R8)       SAVE FRAME COUNT
         BR    R7
         SPACE 3
PAGEPR4  CVD   R14,DOUBLE
         MVC   QDMSG+12(6),=X'402020202120'
         ED    QDMSG+12(6),DOUBLE+5
         CLC   QDMSG+4(3),=C'AS  '
         BE    JOBFIND
         EJECT
PGPRINT  L     R1,TOTFRMS          LOAD TOTAL PAGABLE FRAMES
         LTR   R2,R2               DATA LINE
         BZ    PRINT               NO
         CVB   R15,DOUBLE
         SR    R14,R14
         M     R14,=F'100'
         DR    R14,R1
         LA    R15,1(0,R15)
         CVD   R15,DOUBLE          PERCENT FRAMES
         MVC   QDMSG+19(5),=X'402021206C'
         ED    QDMSG+19(4),DOUBLE+6
         SPACE 3
*PRINT    LA    R1,QDMSG            LOAD OUTPUT MSG ADDR
PRINT    EQU   *                   LOAD OUTPUT MSG ADDR
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R7
         SPACE 3
ASIDMSTR L     R15,AVASQ           AVERAGE ASMQ
         CVD   R15,DOUBLE
         MVC   QDMSG+4(12),=CL12'*MASTER*'
         MVC   QDMSG+27(12),=CL12'ASMQ='
         MVC   QDMSG+33(5),=X'4020212040'
         ED    QDMSG+33(4),DOUBLE+6
         CH    R15,=H'46'
         BNH   *+8
         LH    R15,=H'46'          FORCE MAX
         EX    R15,SYSMVE
         LA    R15,QDMSG+38(R15)
         MVI   0(R15),C'>'
         B     PAGEPR4
         EJECT
PAGEPJP  LA    R2,JOBTABAD         JOB TABLE
         LA    R1,130              MAX ASID
         SR    R8,R8
         XC    HIGHFRAM(4),HIGHFRAM
         XC    HIGHJCNT(4),HIGHJCNT
         XC    HIGHASID(4),HIGHASID
         SPACE 1
PAGEPJP1 LA    R2,28(0,R2)         NEXT JOB ENTRY
         LA    R8,1(0,R8)        ASID
         L     R14,24(0,R2)        FRAME COUNT
         LTR   R14,R14             GOOD FRAME COUNT
         BNP   PAGEPJP2            NO
         C     R14,HIGHFRAM        HIGHER
         BL    PAGEPJP2            ANY FRAMES
         ST    R14,HIGHFRAM        HIGH FRAME COUNT
         ST    R8,HIGHASID        HIGH ASID
         ST    R2,HIGHJCNT         HIGH COUNT ADDR
         SPACE 1
PAGEPJP2 BCT   R1,PAGEPJP1
         L     R2,HIGHJCNT
         LTR   R2,R2               END OF OUTPUT
         BZ    RETURN              YES
         L     R8,HIGHASID
         SPACE 1
PAGEPJP3 ST    R8,SAVEASID
         MVC   QDMSG(80),QBLANK
         MVC   QDMSG+4(12),=CL12'AS  '
         XC    24(4,R2),24(R2)     CLEAR FRAME COUNT
         BAL   R7,JPAGE            CALCULATE JOB INTERVAL PAGING
         L     R8,SAVEASID
         L     R14,HIGHFRAM
         STH   R8,DOUBLE+6
         UNPK  DOUBLE(5),DOUBLE+6(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   QDMSG+7(4),DOUBLE   ASID TO MSG
         LA    R2,1
         BAL   R7,PAGEPR4
         B     PAGEPJP
         EJECT
JOBFIND  EQU   *
         L     R8,ASCBADDR
         L     R9,56(0,R8)         CSCB ADDR
         CLI   28(R9),X'03'        INIT
         BE    JOBFIND1            YES, GO SEARCH
         SPACE
JOBFIND0 MVC   QDMSG+4(8),8(R9)    JOBNAME
         MVI   QDMSG+12,C' '
         B     PGPRINT
         SPACE
JOBFIND1 LA    R1,0(0,R9)          SAVE ADDR
         SR    R14,R14             LOAD
         ICM   R14,3,30(R9)        LOAD ASID   MVS/SP DOR
         SPACE
JOBFIND2 L     R9,0(0,R9)          NEXT CSCB
         LA    R9,0(0,R9)
         LTR   R9,R9               END OF CHAIN
         BNZ   JOBFIND3            NO, CONTINUE
         LR    R9,R1               USE ORIG CSCB
         B     JOBFIND0
         SPACE
JOBFIND3 CR    R9,R1               END OF CHAIN
         BE    JOBFIND0            YES, USE ORIG CSCB
         CH    R14,30(0,R9)        ASID EQUAL
         BE    JOBFIND0            YES, USE THIS CSCB
         B     JOBFIND2
         EJECT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    AL4(WORKEND-WORKSTRT)
         SPACE 3
PAGGRAPH DC    C'0=1=2=3=4=5=6=7=8==10========15========20========='
         SPACE 3
SYSGRAPH DC    C'0=========1=========2=========3=========4========='
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
NOASCBS  DS    F
ASCBADDR DS    F
TRACESWT DS    F
AVPAG    DS    F
AVASQ    DS    F
HIGHASID DS    F
HIGHJCNT DS    F
HIGHFRAM DS    F
SAVEASID DS    F
SAVEOUXB DS    F
         DS    F
TOTFRMS  DS    F
PFTREGS  DS    2F
JOBTABAD DS    130XL28
WORKEND  DS    0F
         END
./       ADD   NAME=SAVEPGM
SAVE     TITLE 'QUEUE COMMAND - CREATE A COPY OF CURRENT DATASET' ONL01
SAVE     QSTART HASPEQU=YES,       START SAVE CSECT ASSEMBLY      DOR XX
               XTITLE='QUEUE CMD - CREATE A COPY OF CURRENT DATASET'
         GBLB   &QSP136       SP  1.3.6 OPTION FLAG               DOR
         USING QCKPT,R10      BASE REG FOR CHECKPOINT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13       LOCAL WORK AREA
***********************************************************************
*                                                                     *
*   ALLOCATE OUTPUT DATASET                                           *
*                                                                     *
***********************************************************************
         CLC   QPDSID,=H'0'   IS THERE A VALID DATASET?
         BE    TILT1          NO. TELL THE USER.
         MVC   DSNAME+2(44),QBLANK BLANK THE DSNAME
         MVC   DSNAME+2(3),QLOGON  PICK USERID                     DOR
         MVI   DSNAME+5,C'.'     MOVE IN DELIMITER                 DOR
         MVC   DSNAME+6(8),QPARM1 FIRST PART OF DSNAME
         LA    R1,DSNAME      ADDR OF DSNAME
         ST    R1,DA08PDSN    STORE IN PARM LIST
         LH    R2,QLNG1       LENGTH OF QPARM1
         LA    R2,4(R2)       ADD 4 BYTES (USERID PLUS DELIMITER)  DOR
         LA    R1,2(R2,R1)    OFFSET INTO DSNAME
         LH    R3,QLNG2       LENGTH OF QPARM2
         LTR   R3,R3          ?/LENGTH ZERO
         BZ    DATA           YES. USE DATA AS DEFAULT DS TYPE
         MVI   0(R1),C'.'     MOVE IN DELIMITER
         MVC   1(8,R1),QPARM2 NO. SAVE DS TYPE
         LA    R1,1(R3,R2)    LENGTH OF DSNAME
         B     DSLNGH         GO SAVE LENGTH
DATA     MVC   0(5,R1),=C'.DATA' LAST PART OF DSNAME
         LA    R1,5(R2)       LENGTH OF DSNAME
DSLNGH   STH   R1,DSNAME      STORE LENGTH OF DSNAME
         MVC   DA08DDN(72),ALCLIST REMAINDER OF PARM LIST
         LH    R3,QLNG3       LENGTH OF QPARM3 (VOLSER)           UF028
         LTR   R3,R3          WAS IT SPECIFIED?                   UF028
         BZ    DSALLOC2       NO, SKIP THIS                       UF028
         MVC   DA08SER(8),QPARM3  SET VOLSER                      UF028
         B     DSALLOC
DSALLOC2 MVC   DA08SER(8),=CL8' '     DEFAULT DOR 2/06/87
         MVC   DA08UNIT(8),=CL8'3380' DEFAULT FOR DOR 2/6/87
DSALLOC  MVI   DAIRFLAG,X'08' INDICATE ALLOC FUNCTION
         L     R15,=V(ALLOCATE) ADDR OF DAIR MODULE
         BALR  R14,R15        GO TO IT
         MVC   QCOUT+36(1),QCRECFM MOVE IN RECORD FORMAT
         NI    QCOUT+36,X'06' TURN OFF EVERTHING BUT CCTL
         OI    QCOUT+36,X'90' SPECIFY FIXED BLOCKED RECORDS
         LH    R1,QCLRECL     RECORD LENGTH
         LTR   R1,R1          IS THE LRECL ZERO?
         BNZ   RECOK          NO. SKIP.
         LA    R1,133         YES. USE LRECL 133.
RECOK    STH   R1,QCOUT+82    STORE LRECL
BIGGER   LR    R2,R1          UPDATE BLKSIZE
         AH    R1,QCOUT+82    ADD LRECL TO BLKSIZE
         CH    R1,=H'4096'    IS THE BLKSIZE GREATER THAN 4096?
         BL    BIGGER         NO. MAKE IT BIGGER.
         STH   R2,QCOUT+62    STORE BLKSIZE
         OPEN  MF=(E,QCOPEN)
***********************************************************************
*                                                                     *
*   REPOSITION DATASET TO TOP                                         *
*                                                                     *
***********************************************************************
         L     R4,QCSTART     TOP OF DATASET POINTER
         L     R4,0(R4)       DISK ADDR TOP OF DATASET
         L     R5,QCBLKA      IOAREA ADDRESS
         B     FIRST          GO DO IT
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID(6),4(R5) DOES THE JOBID MATCH?
         BE    IDISOK              BR IF SO                          CL
         L     R4,QCJQEA           ADDR OF JQE                       CL
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING  JQE,R4                                              DOR
         TM    JQEFLAG3,JQE3SYSD END OF DATA SET                    DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         TM    QUEFLAG3(R4),QUESYSDS END OF DATA SET                 CL
.X136A   ANOP                                                       DOR
         BNO   END                    IF NOT SYSTEM JQE              CL
         CLC   QPJOBID,4(R5)           ELSE JUST CHECK JOB KEY       CL
         BNE   END            NO. END OF DATASET.
IDISOK   LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK          CL
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         TM    1(R4),X'80'    IS CCTL SPECIFIED?
         BZ    NOCCTL         NO. SKIP.
         LA    R6,1(R6)       INCREMENT LENGTH FOR CCTL
NOCCTL   TM    1(R4),X'08'    IS THIS RECORD TO BE IGNORED?
         BO    SKIPREC        YES. SKIP IT.
         MVI   BUFFER,C' '    BLANK FIRST BYTE OF BUFFER
         MVC   BUFFER+1(255),BUFFER BLANK THE BUFFER
         LR    R7,R6          DO NOT DESTROY R6
         SH    R7,=H'1'       IS LENGTH ZERO?
         BM    SKIPREC        YES. SKIP RECORD.
         EX    R7,MVCREC      MOVE RECORD TO BUFFER
         PUT   QCOUT,BUFFER
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       SEGMENT LENGTH
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE LARGER HEADER SIZE.
         LA    R4,4(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
***********************************************************************
*                                                                     *
*   CLOSE UP SHOP AND GO HOME                                         *
*                                                                     *
***********************************************************************
END      CLOSE MF=(E,QCOPEN)
         MVI   DAIRFLAG,X'18' INDICATE FREE FUNCTION
         L     R15,=V(ALLOCATE) ADDR OF DAIR MODULE
         BALR  R14,R15        GO TO IT
         L     R15,=V(LISTDS) GO BACK TO LISTDS
         BALR  R14,R15        GO TO IT
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE(44),DSNAME+2
         MVC   QDHLINE+46(20),=CL20'IS CREATED AND SAVED'
         L     R15,=V(DISPLAY)    PTR OF DISPLAY MODULE
         BALR  R14,R15            GO TO IT
         QSTOP
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
TILT1    QTILT '*** YOU ARE NOT PROCESSING A VALID DATASET ***'
         LTORG
MVCREC   MVC   BUFFER(1),3(R4)
         DS    0F
ALCLIST  DC    C'HASPSAVE',CL16' ',F'0',F'10',F'50',F'0'
         DC    CL16' ',X'040202B0',F'0',CL8' '
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         $JQE                                                        CL
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
WORK     DSECT
         DS    CL80
BUFFER   DS    CL256
DSNAME   DS    H
         DS    CL44
         END
./       ADD   NAME=SCANLINE
         MACRO
.*                                                      RON MURA, TPD
&LBL     SCANLINE &SEEK,      CHARS SOUGHT (IN QUOTES)                 X
               &RECADDR=,     START OF RECORD TO BE SEARCHED           X
               &STRTCOL=1,    STARTING COLUMN                          X
               &ENDCOL=71,    ENDING COLUMN                            X
               &FIND=,        BRANCH ADDRESS IF CHARS FOUND            X
               &NOFIND=,      BRANCH ADDRESS IF CHARS NOT FOUND        X
               &WKREG=15      WORK REGISTER
.*   THIS MACRO GENERATES REENTERANT CODE.
         LCLA  &WORK,&WORK2
         LCLB  &ERRSW,&RECSW
         LCLC  &NDX
&NDX     SETC  '&SYSNDX'       KEEP IN SHORT-NAMED FIELD FOR ALIGNMENT
         AIF   (T'&SEEK EQ 'O').ERR1
.CHK2    AIF   (T'&RECADDR EQ 'O').WARN1
.CHK4    AIF   (T'&FIND EQ 'O' AND T'&NOFIND EQ 'O').ERR2
.CHK5    AIF   (T'&STRTCOL NE 'N' OR T'&ENDCOL NE 'N').ERR3
         AIF   (&STRTCOL GT &ENDCOL).ERR4
         AIF   (&ERRSW EQ 1).MEND
         AIF   (&RECSW EQ 1).R3OK    BRANCH IF DEFAULT (REG 1)
         AIF   ('&RECADDR'(1,1) EQ '(').REG    CHECK FOR REG FORMAT
&LBL     LA    1,&RECADDR            LOAD RECORD ADDRESS
         AGO   .R3OK
.REG     AIF   ('&RECADDR(1)' EQ '1').R3OK
&LBL     LR    1,&RECADDR(1)         LOAD RECORD ADDRESS
.R3OK    ANOP
&WORK    SETA  &STRTCOL-1
         AIF   (&WORK EQ 0).SKPLA1   IF 0, LA IS NOT NEEDED
         LA    1,&WORK.(0,1)         POINT AT START LOCATION
.SKPLA1  ANOP
&WORK    SETA  &ENDCOL-&STRTCOL+1    NUMBER OF COLUMNS TO BE SEARCHED
&WORK2   SETA  K'&SEEK-2             ASSUME CHARACTER DATA - SET LENGTH
.*                                   (SUBTRACT 2 FOR QUOTES)
&WORK    SETA  &WORK-&WORK2+1        MAX NUMBER OF SEARCHES NEEDED
         LA    &WKREG,&WORK          LOAD MAX NUMBER OF SEARCHES
SCCL&NDX CLC   0(&WORK2,1),=C&SEEK
         AIF   (T'&FIND EQ 'O').FIND2
         BE    &FIND
         AGO   .LA
.FIND2   ANOP
         BE    SCEX&NDX
.LA      ANOP
         LA    1,1(0,1)              INCREMENT TO NEXT POSITION
         BCT   &WKREG,SCCL&NDX
         XR    1,1                   STRING NOT FOUND
         AIF   (T'&NOFIND EQ 'O').END
         B     &NOFIND
.END     ANOP
.*               NO NEED FOR SCEX LABEL IF FIND PROVIDED:
         AIF   (T'&FIND NE 'O').MEND
SCEX&NDX EQU   *                     END OF SCANLINE MACRO
         AGO   .MEND
.ERR1    MNOTE 12,'*** NO STRING TO BE FOUND SPECIFIED ***'
&ERRSW   SETB  1
         AGO   .CHK2
.WARN1   MNOTE *,'*** NO RECORD ADDR SPECIFIED - REG. 1 ASSUMED ***'
&RECSW   SETB  1
         AGO   .CHK4
.ERR2    MNOTE *,'*** NO FIND OR NOFIND ADDRESS GIVEN ***'
         AGO   .CHK5
.ERR3    MNOTE 12,'*** STRTCOL AND ENDCOL MUST BE NUMERIC ***'
         AGO   .MEND
.ERR4    MNOTE 12,'*** STRTCOL MAY NOT BE GREATER THAN ENDCOL ***'
         AGO   .MEND
.FIN     ANOP
.MEND    MEND
./       ADD   NAME=SEARCH
SEARCH   TITLE 'QUEUE COMMAND - JQE AND JOE SEARCH AND FORMAT'    ONL01
SEARCH   QSTART HASPEQU=YES,       START SEARCH CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - JQE AND JOE SEARCH AND FORMAT'
*******************************************************************
* RNB CHANGES:                                                    *
*      (1) RNB16 - PROCESS BOTH LOCAL AND REMOTE JOE QUEUE.       *
*                  ALSO, FIX BUG IN UF020 THAT WAS CLEARING       *
*                  FIELD JOEFLAG IN THE WORK JOE.                 *
*      (2) RNB19 - FOR SP, SEARCH DUMP Q AND CONVERSION (XEQ) Q IF*
*                  STATUS COMMAND OR DJ. ALSO OUTPUT QUEUE        *
*******************************************************************
         GBLB  &QSP           MVS/SP OPTION                       UF020
         GBLB  &QSP136         SP 1.3.6 OPTION FLAG                DOR
         L     R10,QVCKPT     LOAD BASE REG
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JQE,R9         BASE REG FOR JQE DSECT                DOR
         USING JOE,R8         BASE REG FOR JOE DSECT                DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JQEDSECT,R9    BASE REG FOR JQE DSECT
         USING JOEDSECT,R8    BASE REG FOR JOE DSECT
.X136A   ANOP                                                       DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
******************************************************************UF006
*                                                                 UF006
*   CALL - READ JES2 CHECKPOINT FILE                              UF006
*                                                                 UF006
******************************************************************UF006
         L     R15,=V(CKPT)   ADDR OF CKPT ROUTINE                UF006
         BALR  R14,R15        GO TO IT                            UF006
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         LH    R1,QCODEH      LOAD FUNCTION CODE INTO R1
         CH    R1,=H'56'      IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     ST             0 OFFSET
         B     DA             4
         B     DI             8
         B     AO   DO        12
         B     AI             16
         B     AO             20
         B     HI             24
         B     HO             28
         B     DT             32
         B     DJ             36
         B     DS             40
         B     DQ             44
         B     DF             48
         B     WO             52   WTRID OUTPUT                   UF047
         B     FO             56   FORM/FCB DISPLAY FORMAT        DOR
***********************************************************************
*                                                                     *
*   STATUS - FIND ALL JOBS THAT MATCH LEVEL                           *
*                                                                     *
***********************************************************************
ST       EQU   *
         CLI   QPARM1,C' '    DID USER SPECIFY LEVEL?
         BNE   ST2            NO. USE QLOGON.
         MVC   QPARM1,QLOGON  MOVE USER PARM1 TO LEVEL
ST2      BAL   R2,PARMLEN     DETERMINE PARM LENGTH
* SEARCH THE TSO QUEUE
         USING JQTDSECT,R1    BASE REG FOR JQT
DJ2      LH    R6,QLNG1       LENGTH OF COMPARE FOR LEVEL
         L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTTSU      ADDR OF TSO QUEUE
         MVI   QCLASS,0       INDICATE THIS IS THE TSO QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DJ3            END OF QUEUE
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE RECORD
* SEARCH THE SYSTEM QUEUE
DJ3      L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTSTC      ADDR OF STC QUEUE
         MVI   QCLASS,4       INDICATE THIS IS THE STC QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DJ4A           END OF QUEUE                        CL005
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE RECORD
         SPACE 1                                                  CL005
* SEARCH FOR SETUP QUEUE ELEMENT                                  CL005
DJ4A     L     R1,QCJQHEAD         LOAD ADDR OF JQT               CL005
         LA    R4,JQTSETUP         ADDR OF $SETUP QUEUE           CL005
         MVI   QCLASS,24           INDICATE THIS IS SETUP QUEUE   CL005
         BAL   R2,SRCHJQE          SEARCH THE QUEUE               CL005
         B     DJ4                 + 0 END OF QUEUE               CL005
         EX    R6,STCLC            + 4 JOBNAME EQUAL TO LEVEL?    CL005
         BNE   SKIPJQE             NO, SKIP THIS RECORD           CL005
         B     PRTJQE              PRINT THE ELEMENT              CL005
         SPACE 1                                                  CL005
* SEARCH FOR HELD OUTPUT
DJ4      L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTOUT      ADDR OF $OUTPUT QUEUE
         DROP  R1
         MVI   QCLASS,8       INDICATE THIS IS THE HELD OUT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         AIF   (&QSP).RNB19A                                      RNB19
         B     ST3            END OF QUEUE
         AGO   .RNB19B                                            RNB19
.RNB19A  ANOP                                                     RNB19
         B     DJ5            END OF QUEUE                        RNB19
.RNB19B  ANOP                                                     RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         CLI   JQEHLDCT,0     ARE THERE ANY HELD DATASETS? (PART 1)
         BNE   PRTJQE         YES. PRINT THE RECORD.
         TM    JQEHQLOK,X'F0' ARE THERE ANY HELD DATASETS? (PART 2)
         BNZ   PRTJQE         YES. PRINT THE RECORD.
         AIF   (NOT &QSP136).NO136B                                 DOR
         TM    JQEFLAG3,JQE3SYSD   PRINT JQE IF                    DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
         TM    JQEFLAG3,QUESYSDS   PRINT JQE IF                      CL
.X136B   ANOP                                                       DOR
         BO    PRTJQE               SPECIAL                          CL
         B     REJJQE         REJECT THE RECORD
         AIF   (NOT &QSP).RNB19C                                  RNB19
         AIF   (&QSP136).NSP136
* SEARCH DUMP QUEUE                                               RNB19
DJ5      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTDUMP     ADDR OF DUMP QUEUE                  RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,12      INDICATE THIS IS THE DUMP QUEUE     RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     DJ6            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
         AGO   .NOSP136            DOR
.NSP136  ANOP
DJ5      B     DJ6            SKIP JQTDUMP RECORD INVALID IN SP136 DOR
.NOSP136 ANOP                   DOR
* SEARCH CONVERSION (XEQ) QUEUE                                   RNB19
DJ6      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTXEQ      ADDR OF CONVERSION QUEUE            RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,16      INDICATE THIS IS THE CNV QUEUE      RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     DJ7            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
* SEARCH OUTPUT (AWAITING OUTPUT) QUEUE                           RNB19
DJ7      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTAWOUT    ADDR OF OUTPUT QUEUE                RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,20      INDICATE THIS IS THE CNV QUEUE      RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     ST3            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
.RNB19C  ANOP                                                     RNB19
* SEARCH INPUT QUEUES
ST3      MVI   QCLASS,192     START WITH CLASS A
ST4      BAL   R2,NEXTJQT     FIND NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     ST4            END OF QUEUE
         AIF   (NOT &QSP136).NO136Y                                 DOR
         CLI   JQEFLAG1,0     IS THE JOB EXECUTING OR HELD?         DOR
         AGO   .X136Y                                               DOR
.NO136Y  ANOP                                                       DOR
         CLI   JQEFLAGS,0     IS THE JOB EXECUTING OR HELD?
.X136Y   ANOP                                                       DOR
         BNE   ST7            YES. SPECIAL HANDLING.
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE JQE
ST7      EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   REJJQE         NO. SKIP THIS RECORD.
         B     PRT2JQE        PRINT THE RECORD WITHOUT INCR COUNT
* SEARCH OUTPUT QUEUES
ST5      MVI   QCLASS,192     START WITH CLASS A
ST6      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE
         B     ST6            END OF QUEUE
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJOE        NO. SKIP THIS RECORD.
         B     PRTJOE         PRINT THE RECORD
* COMPARE USED TO CHECK LEVEL
STCLC    CLC   QPARM1(1),JQEJNAME IS THE JOBNAME EQUAL TO LEVEL?
***********************************************************************
*                                                                     *
*   DQ - PRINT SUMMARY OF ALL JOBS IN THE INPUT QUEUES                *
*                                                                     *
***********************************************************************
*  SEARCH ALL QUEUES
DQ       MVI   QCLASS,192           START WITH CLASS A
         MVC   QDHLINE,DQHEADER     MOVE IN THE HEADING
DQ1      BAL   R2,NEXTJQT           FIND NEXT QUEUE
         ZAP   QCOUNTE,=P'0'        ZERO COUNT FOR EXECUTING JOBS
         ZAP   QCOUNTA,=P'0'        ZERO COUNT FOR AWAITING JOBS
         ZAP   QCOUNTH,=P'0'        ZERO COUNT FOR HELD JOBS
         BAL   R2,SRCHJQE           SEARCH THE QUEUE
         B     DQ4                  END OF QUEUE
         AIF   (NOT &QSP136).NO136C                                 DOR
         TM    JQEFLAG1,JQE1BUSY    IS THIS JOB EXECUTING
         BZ    DQ2                  NO, NEXT TEST
         AP    QCOUNTE,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ2      TM    JQEFLAG1,X'E0'       IS THIS A HELD JOB
         BZ    DQ3                  NO, NEXT TEST
         AP    QCOUNTH,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ3      CLI   JQEFLAG1,0           IS THIS JOB AWAITING EXECUTION
         AGO   .X136C                                               DOR
.NO136C  ANOP                                                       DOR
         TM    JQEFLAGS,QUEBUSY     IS THIS JOB EXECUTING
         BZ    DQ2                  NO, NEXT TEST
         AP    QCOUNTE,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ2      TM    JQEFLAGS,X'E0'       IS THIS A HELD JOB
         BZ    DQ3                  NO, NEXT TEST
         AP    QCOUNTH,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ3      CLI   JQEFLAGS,0           IS THIS JOB AWAITING EXECUTION
.X136C   ANOP                                                       DOR
         BNE   SKIPJQE              NO, PROCESS NEXT JQE
         AP    QCOUNTA,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ4      CLC   QCOUNT,=PL3'0'       IS THIS QUEUE EMPTY
         BE    DQ1                  YES, TRY THE NEXT QUEUE
         MVC   QDMSG,DQLINE         MOVE IN DETAIL LINE
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTE            NUMBER OF JOBS
         MVC   QECOUNT,FCOUNT+3                    IN EXECUTION
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTA            NUMBER OF JOBS
         MVC   QACOUNT,FCOUNT+3                    AWAITING EXECUTION
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTH            NUMBER OF JOBS
         MVC   QHCOUNT,FCOUNT+3                    IN HELD STATUS
         MVC   FCOUNT,ED5           MOVE IN THE TOTAL NUMBER OF JOBS
         ED    FCOUNT,QCOUNT             IN THIS QUEUE
         MVC   CLASS,QCLASS         MOVE IN QUEUE CLASS
         BAL   R2,DISPLAY           GO DISPLAY THIS LINE
         B     DQ1                  PROCESS THE NEXT QUEUE
***********************************************************************
*                                                                     *
*   DF - PRINT SUMMARY OF ALL JOBS IN THE OUTPUT QUEUES               *
*                                                                     *
***********************************************************************
DF       MVI   QCLASS,192           START WITH CLASS A
         MVC   QDHLINE,DFHEADER     MOVE IN THE HEADING
DF1      BAL   R2,NEXTJOT           FIND NEXT QUEUE
         ZAP   QCOUNTE,=P'0'        ZERO COUNT FOR JOBS PRINTING
         BAL   R2,SRCHJOE           SEARCH THE QUEUE
         B     DF2                  END OF QUEUE
         AIF   (NOT &QSP136).NO136D                                 DOR
         TM    JOEFLAG1,X'20'        IS JOB PRINTING
         AGO   .X136D                                               DOR
.NO136D  ANOP                                                       DOR
         TM    JOEFLAG,X'20'        IS JOB PRINTING
.X136D   ANOP                                                       DOR
         BNO   SKIPJOE              NO, PROCESS NEXT JOE
         AP    QCOUNTE,=P'1'        YES, BUMP COUNTER
         B     SKIPJOE              PROCESS NEXT JOE
DF2      CLC   QCOUNT,=PL3'0'       QUEUE EMPTY
         BE    DF1                  YES, TRY THE NEXT QUEUE
         MVC   QDMSG,DFLINE         MOVE IN DETAIL LINE
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTE            NUMBER OF JOBS
         MVC   QECOUNT,FCOUNT+3                    PRINTING
         MVC   FCOUNT,ED5           MOVE IN TOTAL NUMBER OF JOBS
         ED    FCOUNT,QCOUNT             IN THIS QUEUE
         MVC   CLASS,QCLASS         MOVE IN QUEUE CLASS
         BAL   R2,DISPLAY           GO DISPLAY THIS LINE
         B     DF1                  PROCESS NEXT QUEUE
***********************************************************************
*                                                                     *
*   DJ - FIND A SPECIFIC JOB                                          *
*                                                                     *
***********************************************************************
DJ       CLI   QPARM1,C' '    DID USER SPECIFY JOBNAME?
         BE    DJ9            NO. TILT.
         MVC   QLNG1,=H'7'    COMPARE FOR 8 CHARACTERS
         B     DJ2            USE THE STATUS ROUTINES
DJ9      QTILT '*** YOU MUST SPECIFY JOBNAME ***'
***********************************************************************
*                                                                     *
*   DI - PRINT ALL JOBS IN INPUT QUEUES                               *
*                                                                     *
***********************************************************************
DI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   DI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
DI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     DI2            END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
DI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   AI - PRINT JOBS IN INPUT QUEUES THAT ARE AVAILABLE FOR SELECTION  *
*                                                                     *
***********************************************************************
AI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   AI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
AI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     AI2            END OF QUEUE
         AIF   (NOT &QSP136).NO136E                                 DOR
         CLI   JQEFLAG1,0     IS THE JOB BUSY OR HELD?
         BNE   REJJQE         YES. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
AI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         CLI   JQEFLAG1,0     IS THE JOB BUSY OR HELD?
         AGO   .X136E                                               DOR
.NO136E  ANOP                                                       DOR
         CLI   JQEFLAGS,0     IS THE JOB BUSY OR HELD?
         BNE   REJJQE         YES. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
AI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         CLI   JQEFLAGS,0     IS THE JOB BUSY OR HELD?
.X136E   ANOP                                                       DOR
         BNE   REJJQE         YES. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
         EJECT
***********************************************************************
*                                                                     *
*   FO - PRINT AVAILABLE JOBS IN THE OUTPUT QUEUE  BY FORMS/FCB       *
*                                                                     *
***********************************************************************
FO        DS    0H
*****
*****  SEARCH ALL QUEUES
*****
         MVI   QCLASS,192     START WITH CLASS A
FO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2B           END OF QUEUE
         BAL   R2,PRTJOE      PRINT THE RECORD
FO2B     LA    R4,4(,R4)      POINT TO SECOND HALF OF QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2            END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
         SPACE 4
***********************************************************************
*                                                                     *
*   AO - PRINT AVAILABLE JOBS IN THE OUTPUT QUEUE                     *
*                                                                     *
***********************************************************************
AO       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   AO5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
AO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE
         B     AO2            END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
AO5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJOT     FIND QUEUE
         BAL   R2,SRCHJOE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   WO - PRINT JOES IN OUTPUT QUEUE THAT HAVE WTRID SPECIFIED         *
*                                                                     *
***********************************************************************
* SEARCH ALL QUEUES                                               UF047
WO       MVI   QCLASS,192     START WITH CLASS A                  UF047
WO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE                UF047
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE                  UF047
         B     WO2            END OF QUEUE                        UF047
         SR    R1,R1          CLEAR REG FOR INSERT                UF047
         ICM   R1,B'0111',JOECHARB  OFFSET TO CHAR JOE            UF047
         BZ    REJJOE         NONE, SKIP THIS ONE                 UF047
         A     R1,QCJOTA      GET REAL JOE ADDRESS                UF047
         AIF   (NOT &QSP136).NO136F                                 DOR
         TM    JOEWTRID-JOE(R1),X'FF'-X'40' WTRID PRESENT?          DOR
         AGO   .X136F                                               DOR
.NO136F  ANOP                                                       DOR
         TM    JOEWTRID-JOEDSECT(R1),X'FF'-X'40' WTRID PRESENT?   UF047
.X136F   ANOP                                                       DOR
         BZ    REJJOE         NO, TRY NEXT ONE                    UF047
         B     PRTJOE         PRINT THE RECORD                    UF047
***********************************************************************
*                                                                     *
*   HI - PRINT JOBS IN INPUT QUEUES THAT ARE HELD                     *
*                                                                     *
***********************************************************************
HI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   HI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
HI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     HI2            END OF QUEUE
         AIF   (NOT &QSP136).NO136G                                 DOR
         TM    JQEFLAG1,X'E0' IS THE JOB HELD?
         BZ    REJJQE         NO. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
HI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         TM    JQEFLAG1,X'E0' IS THE JOB HELD?
         AGO   .X136G                                               DOR
.NO136G  ANOP                                                       DOR
         TM    JQEFLAGS,X'E0' IS THE JOB HELD?
         BZ    REJJQE         NO. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
HI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         TM    JQEFLAGS,X'E0' IS THE JOB HELD?
.X136G   ANOP                                                       DOR
         BZ    REJJQE         NO. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   HO - LIST ALL JOBS WITH HELD OUTPUT                               *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
HO       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTOUT      ADDR OF $OUTPUT QUEUE
         DROP  R1
         MVI   QCLASS,8       INDICATE THIS IS THE HELD OUT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         CLI   JQEHLDCT,0     ARE THERE ANY HELD DATASETS? (PART 1)
         BNE   PRTJQE         YES. PRINT THE RECORD.
         TM    JQEHQLOK,X'F0' ARE THERE ANY HELD DATASETS? (PART 2)
         BNZ   PRTJQE         YES. PRINT THE RECORD.
         B     REJJQE         REJECT THE RECORD
***********************************************************************
*                                                                     *
*   DA - FIND ALL EXECUTING JOBS                                      *
*                                                                     *
***********************************************************************
DA       MVI   QCLASS,192     START WITH CLASS A
DA2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DA2            END OF QUEUE
         AIF   (NOT &QSP136).NO136H                                 DOR
         TM    JQEFLAG1,JQE1BUSY IS THE JOB EXECUTING?              DOR
         AGO   .X136H                                               DOR
.NO136H  ANOP                                                       DOR
         TM    JQEFLAGS,QUEBUSY IS THE JOB EXECUTING?
.X136H   ANOP                                                       DOR
         BZ    REJJQE         NO. REJECT IT.
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DT - LIST ALL TSO USERS                                           *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
DT       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTTSU      ADDR OF TSO QUEUE
         DROP  R1
         MVI   QCLASS,0       INDICATE THIS IS THE TSO QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DS - LIST ALL SYSTEM STARTED TASKS                                *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
DS       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTSTC      ADDR OF STC QUEUE
         DROP  R1
         MVI   QCLASS,4       INDICATE THIS IS THE STC QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DETERMINE LENGTH OF LEVEL                                         *
*                                                                     *
***********************************************************************
PARMLEN  LA    R3,7           MAXIMUM LENGTH OF 8
         LA    R4,QPARM1+7    END OF FIELD
PARMLEN2 CLI   0(R4),C' '     IS THIS BYTE BLANK?
         BNE   PARMLEN3       NO. THIS IS THE LENGTH
         BCTR  R4,0           TRY PREVIOUS BYTE
         BCT   R3,PARMLEN2    LOOP
PARMLEN3 STH   R3,QLNG1       STORE THE LENGTH OF LEVEL
         BR    R2             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   SEARCH A JQE QUEUE                                                *
*                                                                     *
***********************************************************************
SRCHJQE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
         AIF   (&QSP).QSP3                                        UF020
         LH    R9,0(R4)       LOAD FIRST JQE OFFSET
         N     R9,=X'0000FFFF' KILL EXTRANEOUS BITS
NEXTJQE  SLA   R9,2           MULTIPLY BY 4
         AGO   .QSP4                                              UF020
.QSP3    ANOP                                                     UF020
         L     R9,0(R4)       LOAD FIRST JQE OFFSET               UF020
NEXTJQE  LA    R9,0(,R9)      KILL EXTRANEOUS BITS                UF020
         LTR   R9,R9          TEST FOR END OF QUEUE               UF020
.QSP4    ANOP                                                     UF020
         BZR   R2             END OF QUEUE. RETURN.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJQE   AP    QCOUNT,=P'1'   INCREMENT COUNT
PRT2JQE  SR    R1,R1          INDICATE THIS IS A JQE
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE FORMS/FCB LINES
         CLC   QSUBNAME(2),=C'FO'  FORMS
         BE    PRT2JQEF
         L     R15,=V(FORMAT) ADDR OF PRINT MODULE
PRT2JQEF BALR  R14,R15        PRINT THE JQE IN R9
         AIF   (&QSP).QSP5                                        UF020
REJJQE   LH    R9,JQECHAIN    LOAD OFFSET TO NEXT JQE
         AGO   .QSP6                                              UF020
.QSP5    ANOP                                                     UF020
REJJQE   L     R9,JQENEXT     LOAD OFFSET TO NEXT JQE             UF020
.QSP6    ANOP                                                     UF020
         B     NEXTJQE        GET THE NEXT JQE
SKIPJQE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     REJJQE         CONTINUE
***********************************************************************
*                                                                     *
*   SEARCH A JOE QUEUE                                                *
*                                                                     *
***********************************************************************
         AIF   (&QSP).QSP7                                        RNB16
SRCHJOE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
FIRSTJOE LH    R8,0(R4)       LOAD FIRST JOE OFFSET
         N     R8,=X'0000FFFF' KILL EXTRANEOUS BITS.
         AGO   .QSP8                                              UF020
.QSP7    ANOP                                                     UF020
SRCHJOE  ZAP   QCOUNT,=P'0'    ZERO THE QUEUE COUNT               RNB16
         OI    QFLAG1,QFLG1LCL SHOW SEARCHING LOCAL QUEUE         RNB16
         B     FIRSTJOE        AND GO DO IT                       RNB16
*                                                                 RNB16
SRCHJOE1 NI    QFLAG1,X'FF'-QFLG1LCL TURN OFF LOCAL QUEUE FLAG    RNB16
         LA    R4,4(,R4)             POINT TO REMOTE QUEUE        RNB16
*                                                                 RNB16
FIRSTJOE L     R8,0(R4)       LOAD FIRST JOE OFFSET               UF020
         LA    R8,0(,R8)       KILL EXTRANEOUS BITS.              UF020
.QSP8    ANOP                                                     UF020
         LTR   R8,R8          IS THE QUEUE EMPTY?
         AIF   (&QSP).QSP8A                                       RNB16
         BZR   R2             YES. RETURN TO CALLER.
         AGO   .QSP8B                                             RNB16
.QSP8A   BNZ   $1             /NO  - CONTINUE                     RNB16
*                             /YES -                              RNB16
         TM    QFLAG1,QFLG1LCL WAS THIS THE LOCAL QUEUE?          RNB16
         BO    SRCHJOE1       /YES - GO DO REMOTE QUEUE           RNB16
         BR    R2             /NO  - RETURN TO CALLER             RNB16
$1       EQU   *                                                  RNB16
.QSP8B   ANOP                                                     RNB16
         XC    PRIORITY(12),PRIORITY ZERO OUT HIGHEST POINTERS
         AIF   (&QSP).QSP9                                        UF020
NEXTJOE  SLA   R8,2           MULTIPLY BY 4
         AGO   .QSP10                                             UF020
.QSP9    ANOP                                                     UF020
NEXTJOE  LA    R8,0(,R8)      CLEAR EXTRA BITS                    UF020
         LTR   R8,R8          TEST FOR END OF QUEUE               UF020
.QSP10   ANOP                                                     UF020
         BZ    TESTJOE        END OF QUEUE. PASS HIGHEST TO CALLER.
         A     R8,QCJOTA      ADD BASE TO OFFSET
         AIF   (&QSP).QSP11                                       UF020
         LH    R9,JOEJQE      OFFSET TO JQE
         SLA   R9,2           MULTIPLY BY 4
         AGO   .QSP12                                             UF020
.QSP11   ANOP                                                     UF020
         L     R9,JOEJQE      OFFSET TO JQE                       UF020
         N     R9,=A(X'00FFFFFF')  CLEAR EXTRA BITS               UF020
.QSP12   ANOP                                                     UF020
         BZ    TRYJOE         THIS JOE ALREADY USED. TRY NEXT ONE.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         LA    R7,255         PRESET MAXIMUM PRIORITY
         TM    JQEPRIO,240    IS THIS JOB PRIORITY 15?
         BO    HIGHJOE        YES. PASS TO CALLER.
         LA    R1,16          PRESET PRIORITY ONE
         CLI   JQETYPE,$HARDCPY IS THE JOB EXECUTING?
         BNE   EXECJOE        YES. USE PRIORITY ONE.
         IC    R1,JQEPRIO     INSERT JQE PRIORITY
EXECJOE  IC    R7,JOEPRIO     INSERT JOE PRIORITY
         AR    R7,R1          ADD PRIORITIES
         SRL   R7,1           BECAUSE HASP DOES IT, THAT'S WHY
HIGHJOE  C     R7,PRIORITY    IS THIS LESS THAN PREVIOUS HIGH?
         BL    TRYJOE         YES. TRY NEXT ONE.
         STM   R7,R9,PRIORITY NO. REPLACE PREVIOUS HIGH.
         AIF   (&QSP).QSP11A                                      UF020
TRYJOE   LH    R8,JOENEXT     ADDR OF NEXT JOE
         AGO   .QSP12A                                            UF020
.QSP11A  ANOP                                                     UF020
TRYJOE   L     R8,JOENEXT     ADDR OF NEXT JOE                    UF020
         N     R8,=A(X'00FFFFFF')  CLEAR EXTRA BITS               UF020
.QSP12A  ANOP                                                     UF020
         B     NEXTJOE        TRY NEXT JOE
TESTJOE  LM    R7,R9,PRIORITY LOAD ADDR OF HIGHEST JOE
         LTR   R8,R8          WAS THE QUEUE EMPTY?
         AIF   (&QSP).QSP12B                                      RNB16
         BZR   R2             YES. END OF QUEUE.
         AGO   .QSP12C                                            RNB16
.QSP12B  ANOP                                                     RNB16
         BNZ   $2                                                 RNB16
         TM    QFLAG1,QFLG1LCL WAS THIS THE LOCAL QUEUE?          RNB16
         BO    SRCHJOE1       /YES - GO DO REMOTE QUEUE           RNB16
         BR    R2             /NO  - END OF QUEUE.                RNB16
$2       EQU   *                                                  RNB16
.QSP12C  ANOP                                                     RNB16
         MVC   JOEJQEB,=F'0'  INDICATE THIS JOE USED              RNB16
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJOE   LA    R1,4           INDICATE THIS IS A JOE
         AP    QCOUNT,=P'1'   INCREMENT COUNT
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE FORMS/FCB LINES
         CLI   QSUBNAME,C'F'  FORMS
         BE    REJJOEF
         L     R15,=V(FORMAT) ADDR OF PRINT MODULE
REJJOEF  BALR  R14,R15        PRINT THE JOE IN R9
REJJOE   B     FIRSTJOE       GET THE NEXT JOE
SKIPJOE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     REJJOE         CONTINUE
***********************************************************************
*                                                                     *
*   DETERMINE INPUT QUEUE                                             *
*                                                                     *
***********************************************************************
FINDJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         B     NEXTJQT2       CONTINUE
NEXTJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   NEXTJQT9       YES. GO HOME.
NEXTJQT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         AR    R4,R4          MULTIPLY BY 2
         AIF   (NOT &QSP).QSP13                                   UF020
         AR    R4,R4          AND BY 2 AGAIN                      UF020
.QSP13   ANOP                                                     UF020
         USING JQTDSECT,R1    BASE REG FOR JQT
         L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTCLSA(R4) NEXT QUEUE
         DROP  R1
         BR    R2             RETURN TO CALLER
NEXTJQT9 CLI   QCODE,0        IS THIS A STATUS REQUEST?
         BE    ST5            YES. GO TO STATUS.
         CLI   QCODE,36       IS THIS A DJ REQUEST?
         BNE   STOP           NO. GO HOME.
         B     ST5            YES. GO TO STATUS.
***********************************************************************
*                                                                     *
*   DETERMINE OUTPUT QUEUE                                            *
*                                                                     *
***********************************************************************
FINDJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         B     NEXTJOT2       CONTINUE
NEXTJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   STOP           YES. GO HOME.
NEXTJOT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         AR    R4,R4          MULTIPLY BY 2
         AIF   (NOT &QSP).QSP14                                   UF020
         SLL   R4,2           AND THEN BY 4 (WILL ONLY GET LOCALS)UF020
.QSP14   ANOP                                                     UF020
         AIF   (NOT &QSP136).NO136I                                 DOR
         USING JOT,R1        BASE REG FOR JOT                       DOR
         AGO   .X136I                                               DOR
.NO136I  ANOP                                                       DOR
         USING JOTDSECT,R1    BASE REG FOR JOT
.X136I   ANOP                                                       DOR
         L     R1,QCJOTA      LOAD ADDR OF JOT
         LA    R4,JOTCLSQ(R4) NEXT QUEUE
         DROP  R1
         BR    R2             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   CALL DISPLAY ROUTINE                                              *
*                                                                     *
***********************************************************************
DISPLAY  LA    R1,QDMSG             SAVE ADDRESS
         ST    R1,QDMSGA                 OF THE MESSAGE
         MVC   QDMLNG,=H'80'        SET THE LENGTH
         L     R15,=V(DISPLAY)      BRANCH TO
         BALR  R14,R15                     DISPLAY
         BR    R2                   RETURN TO CALLER
***********************************************************************
*                                                                     *
*   GO HOME                                                           *
*                                                                     *
***********************************************************************
STOP     QSTOP
         LTORG
***********************************************************************
*                                                                     *
*   TABLES FOR CLASS DETERMINATION                                    *
*                                                                     *
***********************************************************************
NAMETBL  DC    C'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
CLASSTBL DC    192X'01'
         DC    X'00010203040506070809',7X'00'
         DC    X'0A0B0C0D0E0F101112',8X'00'
         DC    X'131415161718191A',6X'00'
         DC    X'1B1C1D1E1F2021222324',6X'00'
***********************************************************************
*                                                                     *
*   MISCELLANEOUS GARBAGE                                             *
*                                                                     *
***********************************************************************
ED5      DC    X'402020202120'
DQHEADER DC    CL80'*** INPUT QUEUES ***'
DQLINE   DC    CL80' INPUT                        EXECUTING      WAITINX
               G      HELD'
DFHEADER DC    CL80'*** OUTPUT QUEUES ***'
DFLINE   DC    CL80' OUTPUT                       PRINTING'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
SEARCH   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         SPACE 1                                                  UF001
         AIF   (NOT &QSP136).NO136X                                 DOR
         IFGRPL  DSECT=YES,AM=VTAM                                  DOR
         $BUFFER                                                    DOR
         AGO   .X136X                                               DOR
.NO136X  ANOP                                                       DOR
$MAXNODE EQU   99             FOR NJE $JOT EXPANSION              UF001
.X136X   ANOP                                                       DOR
JQEHQLOK EQU   JQEJBLOK       NEW LABEL FOR OLD FIELD             UF020
         SPACE 1                                                  UF001
         $JQE
         $JOE
         $JOT
         $JQT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    CL9
CLASS    DS    CL1
         DS    CL2
QTCOUNT  DS    CL6
         DS    CL7
QECOUNT  DS    CL3
         DS    CL12
QACOUNT  DS    CL3
         DS    CL10
QHCOUNT  DS    CL3
         ORG   QTCOUNT
FCOUNT   DS    CL6
WORK     DSECT
         DS    CL80
PRIORITY DS    3F
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=SEARCHK
SEARCH   TITLE 'QUEUE COMMAND - JQE AND JOE SEARCH AND FORMAT'    ONL01
SEARCH   QSTART ,                  START SEARCH CSECT ASSEMBLY    ONL01
*******************************************************************
* RNB CHANGES:                                                    *
*      (1) RNB16 - PROCESS BOTH LOCAL AND REMOTE JOE QUEUE.       *
*                  ALSO, FIX BUG IN UF020 THAT WAS CLEARING       *
*                  FIELD JOEFLAG IN THE WORK JOE.                 *
*      (2) RNB19 - FOR SP, SEARCH DUMP Q AND CONVERSION (XEQ) Q IF*
*                  STATUS COMMAND OR DJ. ALSO OUTPUT QUEUE        *
*******************************************************************
         GBLB  &QSP           MVS/SP OPTION                       UF020
         L     R10,QVCKPT     LOAD BASE REG
         USING JQEDSECT,R9    BASE REG FOR JQE DSECT
         USING JOEDSECT,R8    BASE REG FOR JOE DSECT
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA
******************************************************************UF006
*                                                                 UF006
*   CALL - READ JES2 CHECKPOINT FILE                              UF006
*                                                                 UF006
******************************************************************UF006
         L     R15,=V(CKPT)   ADDR OF CKPT ROUTINE                UF006
         BALR  R14,R15        GO TO IT                            UF006
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
         LH    R1,QCODEH      LOAD FUNCTION CODE INTO R1
         CH    R1,=H'56'      IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     ST             0 OFFSET
         B     DA             4
         B     DI             8
         B     AO   DO        12
         B     AI             16
         B     AO             20
         B     HI             24
         B     HO             28
         B     DT             32
         B     DJ             36
         B     DS             40
         B     DQ             44
         B     DF             48
         B     WO             52   WTRID OUTPUT                   UF047
         B     FO             56   FORM/FCB DISPLAY FORMAT        DOR
***********************************************************************
*                                                                     *
*   STATUS - FIND ALL JOBS THAT MATCH LEVEL                           *
*                                                                     *
***********************************************************************
ST       CLI   QPARM1,C' '    DID USER SPECIFY LEVEL?
         BNE   ST2            NO. USE QLOGON.
         MVC   QPARM1,QLOGON  MOVE USER PARM1 TO LEVEL
ST2      BAL   R2,PARMLEN     DETERMINE PARM LENGTH
* SEARCH THE TSO QUEUE
         USING JQTDSECT,R1    BASE REG FOR JQT
DJ2      LH    R6,QLNG1       LENGTH OF COMPARE FOR LEVEL
         L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTTSU      ADDR OF TSO QUEUE
         MVI   QCLASS,0       INDICATE THIS IS THE TSO QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DJ3            END OF QUEUE
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE RECORD
* SEARCH THE SYSTEM QUEUE
DJ3      L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTSTC      ADDR OF STC QUEUE
         MVI   QCLASS,4       INDICATE THIS IS THE STC QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DJ4A           END OF QUEUE                        CL005
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE RECORD
         SPACE 1                                                  CL005
* SEARCH FOR SETUP QUEUE ELEMENT                                  CL005
DJ4A     L     R1,QCJQHEAD         LOAD ADDR OF JQT               CL005
         LA    R4,JQTSETUP         ADDR OF $SETUP QUEUE           CL005
         MVI   QCLASS,24           INDICATE THIS IS SETUP QUEUE   CL005
         BAL   R2,SRCHJQE          SEARCH THE QUEUE               CL005
         B     DJ4                 + 0 END OF QUEUE               CL005
         EX    R6,STCLC            + 4 JOBNAME EQUAL TO LEVEL?    CL005
         BNE   SKIPJQE             NO, SKIP THIS RECORD           CL005
         B     PRTJQE              PRINT THE ELEMENT              CL005
         SPACE 1                                                  CL005
* SEARCH FOR HELD OUTPUT
DJ4      L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTOUT      ADDR OF $OUTPUT QUEUE
         DROP  R1
         MVI   QCLASS,8       INDICATE THIS IS THE HELD OUT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         AIF   (&QSP).RNB19A                                      RNB19
         B     ST3            END OF QUEUE
         AGO   .RNB19B                                            RNB19
.RNB19A  ANOP                                                     RNB19
         B     DJ5            END OF QUEUE                        RNB19
.RNB19B  ANOP                                                     RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         CLI   JQEHLDCT,0     ARE THERE ANY HELD DATASETS? (PART 1)
         BNE   PRTJQE         YES. PRINT THE RECORD.
         TM    JQEHQLOK,X'F0' ARE THERE ANY HELD DATASETS? (PART 2)
         BNZ   PRTJQE         YES. PRINT THE RECORD.
         TM    JQEFLAG3,QUESYSDS   PRINT JQE IF                      CL
         BO    PRTJQE               SPECIAL                          CL
         B     REJJQE         REJECT THE RECORD
         AIF   (NOT &QSP).RNB19C                                  RNB19
* SEARCH DUMP QUEUE                                               RNB19
DJ5      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTDUMP     ADDR OF DUMP QUEUE                  RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,12      INDICATE THIS IS THE DUMP QUEUE     RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     DJ6            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
* SEARCH CONVERSION (XEQ) QUEUE                                   RNB19
DJ6      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTXEQ      ADDR OF CONVERSION QUEUE            RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,16      INDICATE THIS IS THE CNV QUEUE      RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     DJ7            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
* SEARCH OUTPUT (AWAITING OUTPUT) QUEUE                           RNB19
DJ7      L     R1,QCJQHEAD    LOAD ADDR OF JQT                    RNB19
         USING JQTDSECT,R1    BASE REG FOR JQT                    RNB19
         LA    R4,JQTAWOUT    ADDR OF OUTPUT QUEUE                RNB19
         DROP  R1                                                 RNB19
         MVI   QCLASS,20      INDICATE THIS IS THE CNV QUEUE      RNB19
         BAL   R2,SRCHJQE     SEARCH THE QUEUE                    RNB19
         B     ST3            END OF QUEUE                        RNB19
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?      RNB19
         BNE   SKIPJQE        NO. SKIP THIS RECORD.               RNB19
         B     PRTJQE         PRINT THE RECORD                    RNB19
.RNB19C  ANOP                                                     RNB19
* SEARCH INPUT QUEUES
ST3      MVI   QCLASS,192     START WITH CLASS A
ST4      BAL   R2,NEXTJQT     FIND NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     ST4            END OF QUEUE
         CLI   JQEFLAGS,0     IS THE JOB EXECUTING OR HELD?
         BNE   ST7            YES. SPECIAL HANDLING.
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJQE        NO. SKIP THIS RECORD.
         B     PRTJQE         PRINT THE JQE
ST7      EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   REJJQE         NO. SKIP THIS RECORD.
         B     PRT2JQE        PRINT THE RECORD WITHOUT INCR COUNT
* SEARCH OUTPUT QUEUES
ST5      MVI   QCLASS,192     START WITH CLASS A
ST6      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE
         B     ST6            END OF QUEUE
         EX    R6,STCLC       IS THE JOBNAME EQUAL TO LEVEL?
         BNE   SKIPJOE        NO. SKIP THIS RECORD.
         B     PRTJOE         PRINT THE RECORD
* COMPARE USED TO CHECK LEVEL
STCLC    CLC   QPARM1(1),JQEJNAME IS THE JOBNAME EQUAL TO LEVEL?
***********************************************************************
*                                                                     *
*   DQ - PRINT SUMMARY OF ALL JOBS IN THE INPUT QUEUES                *
*                                                                     *
***********************************************************************
*  SEARCH ALL QUEUES
DQ       MVI   QCLASS,192           START WITH CLASS A
         MVC   QDHLINE,DQHEADER     MOVE IN THE HEADING
DQ1      BAL   R2,NEXTJQT           FIND NEXT QUEUE
         ZAP   QCOUNTE,=P'0'        ZERO COUNT FOR EXECUTING JOBS
         ZAP   QCOUNTA,=P'0'        ZERO COUNT FOR AWAITING JOBS
         ZAP   QCOUNTH,=P'0'        ZERO COUNT FOR HELD JOBS
         BAL   R2,SRCHJQE           SEARCH THE QUEUE
         B     DQ4                  END OF QUEUE
         TM    JQEFLAGS,QUEBUSY     IS THIS JOB EXECUTING
         BZ    DQ2                  NO, NEXT TEST
         AP    QCOUNTE,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ2      TM    JQEFLAGS,X'E0'       IS THIS A HELD JOB
         BZ    DQ3                  NO, NEXT TEST
         AP    QCOUNTH,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ3      CLI   JQEFLAGS,0           IS THIS JOB AWAITING EXECUTION
         BNE   SKIPJQE              NO, PROCESS NEXT JQE
         AP    QCOUNTA,=P'1'        YES, BUMP COUNTER
         B     SKIPJQE              PROCESS NEXT JQE
DQ4      CLC   QCOUNT,=PL3'0'       IS THIS QUEUE EMPTY
         BE    DQ1                  YES, TRY THE NEXT QUEUE
         MVC   QDMSG,DQLINE         MOVE IN DETAIL LINE
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTE            NUMBER OF JOBS
         MVC   QECOUNT,FCOUNT+3                    IN EXECUTION
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTA            NUMBER OF JOBS
         MVC   QACOUNT,FCOUNT+3                    AWAITING EXECUTION
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTH            NUMBER OF JOBS
         MVC   QHCOUNT,FCOUNT+3                    IN HELD STATUS
         MVC   FCOUNT,ED5           MOVE IN THE TOTAL NUMBER OF JOBS
         ED    FCOUNT,QCOUNT             IN THIS QUEUE
         MVC   CLASS,QCLASS         MOVE IN QUEUE CLASS
         BAL   R2,DISPLAY           GO DISPLAY THIS LINE
         B     DQ1                  PROCESS THE NEXT QUEUE
***********************************************************************
*                                                                     *
*   DF - PRINT SUMMARY OF ALL JOBS IN THE OUTPUT QUEUES               *
*                                                                     *
***********************************************************************
DF       MVI   QCLASS,192           START WITH CLASS A
         MVC   QDHLINE,DFHEADER     MOVE IN THE HEADING
DF1      BAL   R2,NEXTJOT           FIND NEXT QUEUE
         ZAP   QCOUNTE,=P'0'        ZERO COUNT FOR JOBS PRINTING
         BAL   R2,SRCHJOE           SEARCH THE QUEUE
         B     DF2                  END OF QUEUE
         TM    JOEFLAG,X'20'        IS JOB PRINTING
         BNO   SKIPJOE              NO, PROCESS NEXT JOE
         AP    QCOUNTE,=P'1'        YES, BUMP COUNTER
         B     SKIPJOE              PROCESS NEXT JOE
DF2      CLC   QCOUNT,=PL3'0'       QUEUE EMPTY
         BE    DF1                  YES, TRY THE NEXT QUEUE
         MVC   QDMSG,DFLINE         MOVE IN DETAIL LINE
         MVC   FCOUNT,ED5           MOVE IN
         ED    FCOUNT,QCOUNTE            NUMBER OF JOBS
         MVC   QECOUNT,FCOUNT+3                    PRINTING
         MVC   FCOUNT,ED5           MOVE IN TOTAL NUMBER OF JOBS
         ED    FCOUNT,QCOUNT             IN THIS QUEUE
         MVC   CLASS,QCLASS         MOVE IN QUEUE CLASS
         BAL   R2,DISPLAY           GO DISPLAY THIS LINE
         B     DF1                  PROCESS NEXT QUEUE
***********************************************************************
*                                                                     *
*   DJ - FIND A SPECIFIC JOB                                          *
*                                                                     *
***********************************************************************
DJ       CLI   QPARM1,C' '    DID USER SPECIFY JOBNAME?
         BE    DJ9            NO. TILT.
         MVC   QLNG1,=H'7'    COMPARE FOR 8 CHARACTERS
         B     DJ2            USE THE STATUS ROUTINES
DJ9      QTILT '*** YOU MUST SPECIFY JOBNAME ***'
***********************************************************************
*                                                                     *
*   DI - PRINT ALL JOBS IN INPUT QUEUES                               *
*                                                                     *
***********************************************************************
DI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   DI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
DI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     DI2            END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
DI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   AI - PRINT JOBS IN INPUT QUEUES THAT ARE AVAILABLE FOR SELECTION  *
*                                                                     *
***********************************************************************
AI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   AI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
AI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     AI2            END OF QUEUE
         CLI   JQEFLAGS,0     IS THE JOB BUSY OR HELD?
         BNE   REJJQE         YES. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
AI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         CLI   JQEFLAGS,0     IS THE JOB BUSY OR HELD?
         BNE   REJJQE         YES. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
         EJECT
***********************************************************************
*                                                                     *
*   FO - PRINT AVAILABLE JOBS IN THE OUTPUT QUEUE  BY FORMS/FCB       *
*                                                                     *
***********************************************************************
FO        DS    0H
*****
*****  SEARCH ALL QUEUES
*****
         MVI   QCLASS,192     START WITH CLASS A
FO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2B           END OF QUEUE
         BAL   R2,PRTJOE      PRINT THE RECORD
FO2B     LA    R4,4(,R4)      POINT TO SECOND HALF OF QUEUE
         BAL   R2,SRCHJOE     SEARCH A JOE QUEUE
         B     FO2            END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
         SPACE 4
***********************************************************************
*                                                                     *
*   AO - PRINT AVAILABLE JOBS IN THE OUTPUT QUEUE                     *
*                                                                     *
***********************************************************************
AO       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   AO5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
AO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE
         B     AO2            END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
AO5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJOT     FIND QUEUE
         BAL   R2,SRCHJOE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJOE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   WO - PRINT JOES IN OUTPUT QUEUE THAT HAVE WTRID SPECIFIED         *
*                                                                     *
***********************************************************************
* SEARCH ALL QUEUES                                               UF047
WO       MVI   QCLASS,192     START WITH CLASS A                  UF047
WO2      BAL   R2,NEXTJOT     DETERMINE NEXT QUEUE                UF047
         BAL   R2,SRCHJOE     SEARCH A JQE QUEUE                  UF047
         B     WO2            END OF QUEUE                        UF047
         SR    R1,R1          CLEAR REG FOR INSERT                UF047
         ICM   R1,B'0111',JOECHARB  OFFSET TO CHAR JOE            UF047
         BZ    REJJOE         NONE, SKIP THIS ONE                 UF047
         A     R1,QCJOTA      GET REAL JOE ADDRESS                UF047
         TM    JOEWTRID-JOEDSECT(R1),X'FF'-X'40' WTRID PRESENT?   UF047
         BZ    REJJOE         NO, TRY NEXT ONE                    UF047
         B     PRTJOE         PRINT THE RECORD                    UF047
***********************************************************************
*                                                                     *
*   HI - PRINT JOBS IN INPUT QUEUES THAT ARE HELD                     *
*                                                                     *
***********************************************************************
HI       CLI   QPARM1,C' '    DID USER SPECIFY CLASS?
         BNE   HI5            YES. LIMIT TO ONE QUEUE.
* SEARCH ALL QUEUES
         MVI   QCLASS,192     START WITH CLASS A
HI2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH A JQE QUEUE
         B     HI2            END OF QUEUE
         TM    JQEFLAGS,X'E0' IS THE JOB HELD?
         BZ    REJJQE         NO. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
* SEARCH ONLY ONE QUEUE
HI5      MVC   QCLASS,QPARM1  USER SPECIFIED CLASS
         BAL   R2,FINDJQT     FIND QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         TM    JQEFLAGS,X'E0' IS THE JOB HELD?
         BZ    REJJQE         NO. SKIP IT.
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   HO - LIST ALL JOBS WITH HELD OUTPUT                               *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
HO       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTOUT      ADDR OF $OUTPUT QUEUE
         DROP  R1
         MVI   QCLASS,8       INDICATE THIS IS THE HELD OUT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         CLI   JQEHLDCT,0     ARE THERE ANY HELD DATASETS? (PART 1)
         BNE   PRTJQE         YES. PRINT THE RECORD.
         TM    JQEHQLOK,X'F0' ARE THERE ANY HELD DATASETS? (PART 2)
         BNZ   PRTJQE         YES. PRINT THE RECORD.
         B     REJJQE         REJECT THE RECORD
***********************************************************************
*                                                                     *
*   DA - FIND ALL EXECUTING JOBS                                      *
*                                                                     *
***********************************************************************
DA       MVI   QCLASS,192     START WITH CLASS A
DA2      BAL   R2,NEXTJQT     DETERMINE NEXT QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     DA2            END OF QUEUE
         TM    JQEFLAGS,QUEBUSY IS THE JOB EXECUTING?
         BZ    REJJQE         NO. REJECT IT.
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DT - LIST ALL TSO USERS                                           *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
DT       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTTSU      ADDR OF TSO QUEUE
         DROP  R1
         MVI   QCLASS,0       INDICATE THIS IS THE TSO QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DS - LIST ALL SYSTEM STARTED TASKS                                *
*                                                                     *
***********************************************************************
         USING JQTDSECT,R1    BASE REG FOR JQT
DS       L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTSTC      ADDR OF STC QUEUE
         DROP  R1
         MVI   QCLASS,4       INDICATE THIS IS THE STC QUEUE
         BAL   R2,SRCHJQE     SEARCH THE QUEUE
         B     STOP           END OF QUEUE
         B     PRTJQE         PRINT THE RECORD
***********************************************************************
*                                                                     *
*   DETERMINE LENGTH OF LEVEL                                         *
*                                                                     *
***********************************************************************
PARMLEN  LA    R3,7           MAXIMUM LENGTH OF 8
         LA    R4,QPARM1+7    END OF FIELD
PARMLEN2 CLI   0(R4),C' '     IS THIS BYTE BLANK?
         BNE   PARMLEN3       NO. THIS IS THE LENGTH
         BCTR  R4,0           TRY PREVIOUS BYTE
         BCT   R3,PARMLEN2    LOOP
PARMLEN3 STH   R3,QLNG1       STORE THE LENGTH OF LEVEL
         BR    R2             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   SEARCH A JQE QUEUE                                                *
*                                                                     *
***********************************************************************
SRCHJQE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
         AIF   (&QSP).QSP3                                        UF020
         LH    R9,0(R4)       LOAD FIRST JQE OFFSET
         N     R9,=X'0000FFFF' KILL EXTRANEOUS BITS
NEXTJQE  SLA   R9,2           MULTIPLY BY 4
         AGO   .QSP4                                              UF020
.QSP3    ANOP                                                     UF020
         L     R9,0(R4)       LOAD FIRST JQE OFFSET               UF020
NEXTJQE  LA    R9,0(,R9)      KILL EXTRANEOUS BITS                UF020
         LTR   R9,R9          TEST FOR END OF QUEUE               UF020
.QSP4    ANOP                                                     UF020
         BZR   R2             END OF QUEUE. RETURN.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJQE   AP    QCOUNT,=P'1'   INCREMENT COUNT
PRT2JQE  SR    R1,R1          INDICATE THIS IS A JQE
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE FORMS/FCB LINES
         CLC   QSUBNAME(2),=C'FO'  FORMS
         BE    PRT2JQEF
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE
PRT2JQEF BALR  R14,R15        PRINT THE JQE IN R9
         AIF   (&QSP).QSP5                                        UF020
REJJQE   LH    R9,JQECHAIN    LOAD OFFSET TO NEXT JQE
         AGO   .QSP6                                              UF020
.QSP5    ANOP                                                     UF020
REJJQE   L     R9,JQENEXT     LOAD OFFSET TO NEXT JQE             UF020
.QSP6    ANOP                                                     UF020
         B     NEXTJQE        GET THE NEXT JQE
SKIPJQE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     REJJQE         CONTINUE
***********************************************************************
*                                                                     *
*   SEARCH A JOE QUEUE                                                *
*                                                                     *
***********************************************************************
         AIF   (&QSP).QSP7                                        RNB16
SRCHJOE  ZAP   QCOUNT,=P'0'   ZERO THE QUEUE COUNT
FIRSTJOE LH    R8,0(R4)       LOAD FIRST JOE OFFSET
         N     R8,=X'0000FFFF' KILL EXTRANEOUS BITS.
         AGO   .QSP8                                              UF020
.QSP7    ANOP                                                     UF020
SRCHJOE  ZAP   QCOUNT,=P'0'    ZERO THE QUEUE COUNT               RNB16
         OI    QFLAG1,QFLG1LCL SHOW SEARCHING LOCAL QUEUE         RNB16
         B     FIRSTJOE        AND GO DO IT                       RNB16
*                                                                 RNB16
SRCHJOE1 NI    QFLAG1,X'FF'-QFLG1LCL TURN OFF LOCAL QUEUE FLAG    RNB16
         LA    R4,4(,R4)             POINT TO REMOTE QUEUE        RNB16
*                                                                 RNB16
FIRSTJOE L     R8,0(R4)       LOAD FIRST JOE OFFSET               UF020
         LA    R8,0(,R8)       KILL EXTRANEOUS BITS.              UF020
.QSP8    ANOP                                                     UF020
         LTR   R8,R8          IS THE QUEUE EMPTY?
         AIF   (&QSP).QSP8A                                       RNB16
         BZR   R2             YES. RETURN TO CALLER.
         AGO   .QSP8B                                             RNB16
.QSP8A   BNZ   $1             /NO  - CONTINUE                     RNB16
*                             /YES -                              RNB16
         TM    QFLAG1,QFLG1LCL WAS THIS THE LOCAL QUEUE?          RNB16
         BO    SRCHJOE1       /YES - GO DO REMOTE QUEUE           RNB16
         BR    R2             /NO  - RETURN TO CALLER             RNB16
$1       EQU   *                                                  RNB16
.QSP8B   ANOP                                                     RNB16
         XC    PRIORITY(12),PRIORITY ZERO OUT HIGHEST POINTERS
         AIF   (&QSP).QSP9                                        UF020
NEXTJOE  SLA   R8,2           MULTIPLY BY 4
         AGO   .QSP10                                             UF020
.QSP9    ANOP                                                     UF020
NEXTJOE  LA    R8,0(,R8)      CLEAR EXTRA BITS                    UF020
         LTR   R8,R8          TEST FOR END OF QUEUE               UF020
.QSP10   ANOP                                                     UF020
         BZ    TESTJOE        END OF QUEUE. PASS HIGHEST TO CALLER.
         A     R8,QCJOTA      ADD BASE TO OFFSET
         AIF   (&QSP).QSP11                                       UF020
         LH    R9,JOEJQE      OFFSET TO JQE
         SLA   R9,2           MULTIPLY BY 4
         AGO   .QSP12                                             UF020
.QSP11   ANOP                                                     UF020
         L     R9,JOEJQE      OFFSET TO JQE                       UF020
         N     R9,=A(X'00FFFFFF')  CLEAR EXTRA BITS               UF020
.QSP12   ANOP                                                     UF020
         BZ    TRYJOE         THIS JOE ALREADY USED. TRY NEXT ONE.
         A     R9,QCJQTA      ADD BASE TO OFFSET
         LA    R7,255         PRESET MAXIMUM PRIORITY
         TM    JQEPRIO,240    IS THIS JOB PRIORITY 15?
         BO    HIGHJOE        YES. PASS TO CALLER.
         LA    R1,16          PRESET PRIORITY ONE
         CLI   JQETYPE,$HARDCPY IS THE JOB EXECUTING?
         BNE   EXECJOE        YES. USE PRIORITY ONE.
         IC    R1,JQEPRIO     INSERT JQE PRIORITY
EXECJOE  IC    R7,JOEPRIO     INSERT JOE PRIORITY
         AR    R7,R1          ADD PRIORITIES
         SRL   R7,1           BECAUSE HASP DOES IT, THAT'S WHY
HIGHJOE  C     R7,PRIORITY    IS THIS LESS THAN PREVIOUS HIGH?
         BL    TRYJOE         YES. TRY NEXT ONE.
         STM   R7,R9,PRIORITY NO. REPLACE PREVIOUS HIGH.
         AIF   (&QSP).QSP11A                                      UF020
TRYJOE   LH    R8,JOENEXT     ADDR OF NEXT JOE
         AGO   .QSP12A                                            UF020
.QSP11A  ANOP                                                     UF020
TRYJOE   L     R8,JOENEXT     ADDR OF NEXT JOE                    UF020
         N     R8,=A(X'00FFFFFF')  CLEAR EXTRA BITS               UF020
.QSP12A  ANOP                                                     UF020
         B     NEXTJOE        TRY NEXT JOE
TESTJOE  LM    R7,R9,PRIORITY LOAD ADDR OF HIGHEST JOE
         LTR   R8,R8          WAS THE QUEUE EMPTY?
         AIF   (&QSP).QSP12B                                      RNB16
         BZR   R2             YES. END OF QUEUE.
         AGO   .QSP12C                                            RNB16
.QSP12B  ANOP                                                     RNB16
         BNZ   $2                                                 RNB16
         TM    QFLAG1,QFLG1LCL WAS THIS THE LOCAL QUEUE?          RNB16
         BO    SRCHJOE1       /YES - GO DO REMOTE QUEUE           RNB16
         BR    R2             /NO  - END OF QUEUE.                RNB16
$2       EQU   *                                                  RNB16
.QSP12C  ANOP                                                     RNB16
         MVC   JOEJQEB,=F'0'  INDICATE THIS JOE USED              RNB16
         B     4(R2)          DETERMINE ELIGIBILITY
PRTJOE   LA    R1,4           INDICATE THIS IS A JOE
         AP    QCOUNT,=P'1'   INCREMENT COUNT
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE FORMS/FCB LINES
         CLI   QSUBNAME,C'F'  FORMS
         BE    REJJOEF
         L     R15,=V(FFORMAT) ADDR OF PRINT MODULE
REJJOEF  BALR  R14,R15        PRINT THE JOE IN R9
REJJOE   B     FIRSTJOE       GET THE NEXT JOE
SKIPJOE  AP    QCOUNT,=P'1'   INCREMENT COUNT
         B     REJJOE         CONTINUE
***********************************************************************
*                                                                     *
*   DETERMINE INPUT QUEUE                                             *
*                                                                     *
***********************************************************************
FINDJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         B     NEXTJQT2       CONTINUE
NEXTJQT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   NEXTJQT9       YES. GO HOME.
NEXTJQT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         AR    R4,R4          MULTIPLY BY 2
         AIF   (NOT &QSP).QSP13                                   UF020
         AR    R4,R4          AND BY 2 AGAIN                      UF020
.QSP13   ANOP                                                     UF020
         USING JQTDSECT,R1    BASE REG FOR JQT
         L     R1,QCJQHEAD    LOAD ADDR OF JQT
         LA    R4,JQTCLSA(R4) NEXT QUEUE
         DROP  R1
         BR    R2             RETURN TO CALLER
NEXTJQT9 CLI   QCODE,0        IS THIS A STATUS REQUEST?
         BE    ST5            YES. GO TO STATUS.
         CLI   QCODE,36       IS THIS A DJ REQUEST?
         BNE   STOP           NO. GO HOME.
         B     ST5            YES. GO TO STATUS.
***********************************************************************
*                                                                     *
*   DETERMINE OUTPUT QUEUE                                            *
*                                                                     *
***********************************************************************
FINDJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         BCTR  R4,0           SUBTRACT 1
         STH   R4,QCLASSH     RESTORE VALUE
         B     NEXTJOT2       CONTINUE
NEXTJOT  TR    QCLASS,CLASSTBL DETERMINE OFFSET FROM FIRST CLASS
         LH    R4,QCLASSH     LOAD TABLE OFFSET
         CH    R4,=H'36'      IS THIS THE LAST QUEUE?
         BNL   STOP           YES. GO HOME.
NEXTJOT2 TR    QCLASS,NAMETBL MOVE CLASS NAME TO QCLASS
         AR    R4,R4          MULTIPLY BY 2
         AIF   (NOT &QSP).QSP14                                   UF020
         SLL   R4,2           AND THEN BY 4 (WILL ONLY GET LOCALS)UF020
.QSP14   ANOP                                                     UF020
         USING JOTDSECT,R1    BASE REG FOR JOT
         L     R1,QCJOTA      LOAD ADDR OF JOT
         LA    R4,JOTCLSQ(R4) NEXT QUEUE
         DROP  R1
         BR    R2             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   CALL DISPLAY ROUTINE                                              *
*                                                                     *
***********************************************************************
DISPLAY  LA    R1,QDMSG             SAVE ADDRESS
         ST    R1,QDMSGA                 OF THE MESSAGE
         MVC   QDMLNG,=H'80'        SET THE LENGTH
         L     R15,=V(DISPLAY)      BRANCH TO
         BALR  R14,R15                     DISPLAY
         BR    R2                   RETURN TO CALLER
***********************************************************************
*                                                                     *
*   GO HOME                                                           *
*                                                                     *
***********************************************************************
STOP     QSTOP
         LTORG
***********************************************************************
*                                                                     *
*   TABLES FOR CLASS DETERMINATION                                    *
*                                                                     *
***********************************************************************
NAMETBL  DC    C'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
CLASSTBL DC    192X'01'
         DC    X'00010203040506070809',7X'00'
         DC    X'0A0B0C0D0E0F101112',8X'00'
         DC    X'131415161718191A',6X'00'
         DC    X'1B1C1D1E1F2021222324',6X'00'
***********************************************************************
*                                                                     *
*   MISCELLANEOUS GARBAGE                                             *
*                                                                     *
***********************************************************************
ED5      DC    X'402020202120'
DQHEADER DC    CL80'*** INPUT QUEUES ***'
DQLINE   DC    CL80' INPUT                        EXECUTING      WAITINX
               G      HELD'
DFHEADER DC    CL80'*** OUTPUT QUEUES ***'
DFLINE   DC    CL80' OUTPUT                       PRINTING'
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
SEARCH   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         SPACE 1                                                  UF001
$MAXNODE EQU   99             FOR NJE $JOT EXPANSION              UF001
         SPACE 1                                                  UF001
         $JQE
JQEHQLOK EQU   JQEJBLOK       NEW LABEL FOR OLD FIELD             UF020
         $JOE
         $JOT
         $JQT
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDMSG
         DS    CL9
CLASS    DS    CL1
         DS    CL2
QTCOUNT  DS    CL6
         DS    CL7
QECOUNT  DS    CL3
         DS    CL12
QACOUNT  DS    CL3
         DS    CL10
QHCOUNT  DS    CL3
         ORG   QTCOUNT
FCOUNT   DS    CL6
WORK     DSECT
         DS    CL80
PRIORITY DS    3F
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=SETAUTH
         MACRO
&NAME    SETAUTH &PASSWD
         AIF   (K'&PASSWD EQ 0).ERROR1
         AIF   ('&PASSWD' EQ 'ON').SWON
         AIF   ('&PASSWD' EQ 'OFF').SWOFF
         AIF   ('&PASSWD' EQ 'ON-IMS').SWONIMS
         MNOTE 12,'INVALID PASSWORD FOR SETAUTH MACRO'
         MEXIT
.ERROR1  MNOTE 12,'PASSWORD MISSING FOR SETAUTH MACRO'
         MEXIT
.SWON    ANOP
&NAME    L     0,=C'ON  '         PUT PASSWORD INTO REGISTER 0
         AGO   .COMMON
.SWOFF   ANOP
&NAME    L     0,=C'OFF '         PUT PASSWORD INTO REGISTER 0
         AGO   .COMMON
.SWONIMS ANOP
&NAME    L     0,=C'ONOK'         PUT PASSWORD INTO REGISTER 0
.COMMON  ANOP
         SVC   243
         MEND
./       ADD   NAME=SPWSP134
//SPWQ134C JOB (6000A,4,,99),'QI4 QUEUE SP134',CLASS=A,MSGCLASS=M,
//   NOTIFY=SPW
/*JOBPARM SYSAFF=IPO1
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*   USE THIS JOB TO ASSEMBLE ALL QUEUE MODULES
//*   IF YOU REASM ONE MODULE AND RELINK QUEUE, USE ISPSR134.
//*-----------------------------------------------------------
//*  THIS IS SHORT JOB TO UPGRADE HASPCKPT VOLUME NAME AND UNITNAME
//*    IN PARM CKPT=  IN QASM PROC LINE              1/6/85
//*    IN PARM UNIT=  IN QASM PROC LINE              9/15/86
//*-----------------------------------------------------------
//* TSS= TOP SECRET SYSTEM ISPF=ISPF DRIVER INTERFACE
//*   SEE $CDSIDOC
//* AT CDSI, USERS ARE DIVIDED INTO THREE GROUPS:
//*
//*  (1) ORDINARY USERS
//*  (2) USERS WITH THE TSO OPERATOR PRIVILEGE
//*  (3) JES2 SYSTEM PROGRAMMERS
//*
//* THESE GROUPS ARE GIVEN THE FOLLOWING QUEUE AUTHORIZATIONS:
//*
//*  AUTHORIZATION    ----GROUP----    DESCRIPTION
//*  -------------    (1)  (2)  (3)    -------------------------
//*    QAFXACTV             X    X     DISPLAY ACTIVE LISTS
//*    QAFXBLOG        X    X    X     DISPLAY BACKLOG LISTS
//*    QAFXSSSM        X    X    X     MAY USE CAN/DEL/REQ
//*    QAFXSLOG        X    X    X     MAY LOOK AT SYSLOG
//*    QAFXEXEC                  X     MAY ISSUE TSO CMDS IN QUE
//*    QAFXOPER             X    X     OPERATOR AUTHORITY
//*    QAFXSYSP                  X     JES2 SYSTEM PROGRAMMER
//*
//* A USER IS GRANTED JES2 SYSTEM PROGRAMMER AUTHORITY ONLY
//* IF THEY HAVE OPERATOR AUTHORITY AND THEIR USERID IS ALSO
//* CONTAINED IN A TABLE (SEE LABEL "SYSPTABL" IN AUTH PGM).
//*
//* ASM/LKED PARAMETER SPECIFICATIONS:
//QASM   PROC  M=,                SOURCE MEMBER TO BE ASMED/LKED
//       CKPT=PLPA02,             VOLUME NAME OF HASPCKPT DSN
//       CUN='3350',              UNIT NAME OF CHECKPOINT DSN
//       RENT='DECK,RENT,NOLOAD', ENTER LKED OPTIONS
//       ASM=,                    ENTER ASSEMBLER OPTIONS
//       SP=SP134,                ENTER SP LEVEL OPTION
//       ISPF=ISPF,               ENTER ISPF LEVEL OPTION
//       OPT='TSS,NOACF2,SYSP'    ENTER OTHER SYSTEM OPTIONS
//*  ------SYSTEM PRODUCTS SUPPORTS ----------------------------------
//*    SP= SP133     REQUIRED JES2 SP133 BASE  (DEFAULT)
//*        SP134     SUPPORT SP 1.3.4 HASP MACROS AND SOURCE
//*        SP136     SUPPORT SP 1.3.6 HASP MACROS AND SOURCE
//*        CDSI      DOES NOT SUPPORT JES2 SP130 BASE
//*        NOCDSI    SUPPORT JES2 SP130 BASE  (DEFAULT)
//*        NOSP133   DO NOT REQUIRED SP133 AND UP
//*        SP        REQUIRE SP MACROS (DEFAULT)
//*        NOSP      REQUIRE NON-SP MACROS (OLD MVS/JES2)
//*  ------ISPF INTERFACE OPTIONS ----------------------------------
//*  ISPF= ISPF                   ISPF V1 OR V2 (MIXED VERSION)
//*        ISPF1                  ISPF V1  ONLY
//*        ISPF2                  ISPF V2  ONLY
//*        NOISPF                 TSO ONLY
//*  ------SYSTEM INTERFACE OPTIONS ----------------------------------
//*   OPT=  TSS     TOP SECRET SYSTEM INTERFACE INSTALLED
//*         NOTSS   OTHER THAN TSS ( RACF OR ACF2 INCLUDED)
//*         ACF2    ACF2 INTERFACE INSTALLED
//*         NOACF2  OTHER THAN ACF2 ( RACF OR TSS INCLUDED)
//*         RACF    IBM RACF INTERFACE INSTALLED (SEE QSTART/QRACF.)
//*         NORACF  OTHER THAN RACF ( ACF2 OR TSS INCLUDED)
//*         SYSP    EXTRA COMMANDS FOR SYSTEM PROGRAMMER (JES2 + MVS)
//*                 THEY MAY ADD 256K STORAGE AREA AND ARE AUTHORIZED
//*                 FOR SYS. PGMER.  TO REMOVE THEM FOR OTHER USERS
//*                 CAN BE BENEFIT FOR LESS STORAGE.
//*         NOSYSP  REMOVE EXTRA COMMANDS (DEFAULT)
//* ------- OTHER DATA CENTER SUPPORTS -----------------------------
//*         (ALL ARE NOT SET AS DEFAULT UNLESS YOU CODE.)
//*         JTIP    JTIP PRODUCT INSTALLED
//*         DBC     DBC PRODUCT INSTALLED
//*         RNB     ENABLES RNB-SPECIFIED CODE
//*         ONL     ENABLES ONL-SPECIFIED CODE
//*         NERDC   ENABLES NERDC-SPECIFIED CODE
//*         LOCK    ENABLES LOCKHEED-SPECIFIED CODE
//*  ------ASSEMBLER REQUIREMENTS ------------------------------------
//*   ASM= GEN      PRINT ASM MACRO GENNED.
//*        NOGEN    TURN OFF ASM MACRO GENNED PRINTING. (DEFAULT)
//*        BGEN     PRINT ASM DSECT GENNED.
//*        NOBGEN   TURN OFF ASM DSECT GENNED PRINTING. (DEFAULT)
//*        WTO      TURN ON SYSLOG DISPLAY (USERID AND COMMAND)
//*        NOWTO    TURN OFF SYSLOG DISPLAY (DEFAULT)
//*        PFK      TURN ON PF-KEYS (DEFAULT FOR ISPF INTERFACE)
//*        NOPFK    TURN OFF PF-KEYS (USED FOR TSO WITHOUT ISPF)
//*  -----------------------------------------------------------------
//* OTHER THAN USING SYSPARM, CODE IN QSTART FOR
//*  A. SYSTEM IDS (QSIDS) UP TO SEVEN SYSTEMS ON SHARED SPOOL.
//*  B. PREFIX FOR HASPCKPT (QDSPRFX) DEFAULT=SYS1
//*  C. RACF USERS (QRACUSR=1) IF SYSPARM=RACF. SEE NOTE IN QSTART
//*  D. DEFAULT FIRST QUEUE COMMAND NAME WHEN QUEUE IS STARTED. (Q1CMD)
//*     (Q1CMD DEFAULT IS "STATUS".)
//*  E. DEFAULT PK DEFINITIONS  (QPF(24))
//*     YOU DEFINE 24 OF THEM IN QSTART.
//*  -----------------------------------------------------------------
//ASM    EXEC  PGM=IEV90,REGION=3500K,           (IBM ASSEMBLER H)
// PARM='&RENT,SYSPARM=(&ASM,&SP,&OPT,&ISPF,CKPT=&CKPT,UNIT=&CUN.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//   DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR   HASP MACROS
//   DD  DSN=SYS1.MACLIB,DISP=SHR
//   DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//QASMU  PROC  M=,CKPT=ACCT01,RENT='DECK,RENT,NOLOAD',
//           CDSTD='TSS,GEN,ISPF,NOACF2,SP134'
//ASM    EXEC  PGM=IEUASM,REGION=3500K,           (IBM ASSEMBLER)
// PARM='&RENT,SYSPARM=(SYSP,&CDSTD,CKPT=&CKPT.)'
//*    PARM='LOAD,NODECK,TEST,NORLD,RENT,XREF(&XREF)'
//SYSLIB   DD  DSN=SYS3.QUEISPF.SP136.SRCLIB,DISP=SHR MACRO LIBRARY
//         DD  DSN=SYS3.JES2.V134.HASPMRG,DISP=SHR JES2 MACRO
//         DD  DSN=SYS1.MACLIB,DISP=SHR,UNIT=3350,VOL=SER=M3083P
//         DD  DSN=SYS3.AMODGEN,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT2   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSUT3   DD  SPACE=(CYL,(5,5)),UNIT=VIO
//SYSPRINT DD  SYSOUT=M
//SYSPUNCH DD  DSN=SYS3.QISPF.SYSP.OBJLIB(&M),DISP=OLD OBJECT LIBRARY
//SYSIN DD DSN=SYS3.QUEISPF.SP136.SRCLIB(&M),DISP=SHR SOURCE LIBRARY
//*
//PEND   PEND
//*
//**** ASSEMBLE ALL THE REENTRANT MODULES
//*
//* MODULES REQUIRES HASPSRC: ACTIVE,AUTH,CHCT,CIOT
//*
//*********************************************************************
//*RESTART  EXEC PGM=IEFBR14
//QCOMMON EXEC QASM,M=Q0    ISPF MODIFIED
//*ISPFQI EXEC QASM,M=ISPFQI ISPF MODIFIED
//*ACTIVE EXEC QASM,M=ACTIVE OK
//*ALLOCATE EXEC QASM,M=ALLOCATE
//*AUTH   EXEC QASM,M=AUTH  TSS MODIFIED OK
//*CDIE   EXEC QASM,M=CDIE
//*CHCT   EXEC QASM,M=CHCT OK
//*CIOT   EXEC QASM,M=CIOT  OK
//*CJCT   EXEC QASM,M=CJCT  OK
//*CJHIST EXEC QASM,M=CJHIST TSS MODIFIED  OK
//*CJOE   EXEC QASM,M=CJOE OK
//*CJQE   EXEC QASM,M=CJQE OK
//*CKPT   EXEC QASM,M=CKPT OK
//*CPDDB  EXEC QASM,M=CPDDB OK
//*CPFK   EXEC QASM,M=CPFK
//*CSPIN  EXEC QASM,M=CSPIN OK
//*CSYS   EXEC QASM,M=CSYS -OK
//*CTGPS  EXEC QASM,M=CTGPS
//*CTSO   EXEC QASM,M=CTSO -OK
//*DDNAME EXEC QASM,M=DDNAME OK
//*DISPLAY EXEC QASM,M=DISPLAY -OK   ISPF MODIFIED
//*DOPTION EXEC QASM,M=DOPTION  -OK OPT      QASXSSM
//*FFORMAT EXEC QASM,M=FFORMAT OK CDSI/DOR REQUIRED FOR FORMS
//*FINDJOB EXEC QASM,M=FINDJOB OK MODIFIED WITH BLANKED JOBNAME
//*FINDPDDB EXEC QASM,M=FINDPDDB OK
//*FORMAT EXEC QASM,M=FORMAT OK
//*HELP   EXEC QASM,M=HELP -OK
//*HEXBLK EXEC QASM,M=HEXBLK -OK
//*HEXDUMP EXEC QASM,M=HEXDUMP -OK
//*INIT   EXEC QASM,M=INIT
//*INITS  EXEC QASM,M=INITS  OK
//*JCL    EXEC QASM,M=JCL OK
//*JLOG   EXEC QASM,M=JLOG -OK
//*JMSG   EXEC QASM,M=JMSG -OK
//*LIST   EXEC QASM,M=LIST -OK
//*LISTDS EXEC QASM,M=LISTDS OK
//*LISTDS2 EXEC QASM,M=LISTDS2  OK CDSI/DOR REQUIRED FOR FORMS/LISTCC
//*PARSE  EXEC QASM,M=PARSE -OK CDSI MODIFIED
//*PRINT  EXEC QASM,M=PRINT -OK
//*QUEUE  EXEC QASM,M=QUEUEISP -OK ISPF MODIFIED
//*READSPC EXEC QASM,M=READSPC -OK
//*REPOS  EXEC QASM,M=REPOS -OK CDSI MODIFIED
//*ROUTE   EXEC QASM,M=ROUTE  OK  ROUTE    QASXSSM
//*SAVE   EXEC QASM,M=SAVEPGM OK RENAMED FROM SAVE DUE TO MACRO CALL
//*SEARCH EXEC QASM,M=SEARCH OK
//*SYSLOG EXEC QASM,M=SYSLOG  OK
//*SYSOUT EXEC QASM,M=SYSOUT OK
//*XDS    EXEC QASM,M=XDS -OK
//**
//** EXTRA QUEUE COMMANDS FOR SYSTEMS PROGRAMMER WHEN SET OPT=SYSP
//*ACTMON   EXEC QASM,M=ACTMON  ACTIVITY MONITOR  QASXSYSP
//*ASID     EXEC QASM,M=ASID     JOBS     QASXSYSP
//*ASIDCSA  EXEC QASM,M=ASIDCSA  CSA/STC  QASXSYSP
//*CHANMON  EXEC QASMU,M=CHANMON  CHANNEL BUSY MONITOR
//*COREZAP  EXEC QASM,M=COREZAP COREZAP QASXSYSP
//*DDNAME2  EXEC QASM,M=DDNAME2  CDSI MODIFIED EXPANDED FIELDS
//*DEVIREQ  EXEC QASM,M=DEVIREQ  DEVIREQ  QASXSYSP
//*DEVMON   EXEC QASM,M=DEVMON  DEVICE BUSY MONITOR
//*DOMAIN   EXEC QASM,M=DOMAIN   DOMAIN MPL DISPLAY
//*DTAPE    EXEC QASM,M=DTAPE  CDSI MODIFIED
//*DUMP     EXEC QASM,M=DUMP     XU       QASXSYSP
//*EXCPMON  EXEC QASMU,M=EXCPMON  EXCPTION MONITOR REQ: PGM=IEUASM
//*JOBS     EXEC QASM,M=JOBS     JOBS     QASXSYSP
//*PAGEMON  EXEC QASM,M=PAGEMON  PAGING MONITOR  QASXSYSP
//*SAUGAGE  EXEC QASM,M=SAUGAGE  STORAGE USAGE  QASXSYSP
//*SRM      EXEC QASM,M=SRM      SRM      QASXSYSP
//*STCMAP   EXEC QASM,M=STCMAP   DISPLAY STORAGE MAP  QASXSYSP
//*STORAGE  EXEC QASM,M=STORAGE  FRAME    QASXSYSP
//*SUINFO   EXEC QASM,M=SUINFO   SU       QASXSYSP
//*VSM      EXEC QASM,M=VSM      VSM      QASXSYSP
//*VSM1     EXEC QASM,M=VSM1     VSM      QASXSYSP
//*VSM2     EXEC QASM,M=VSM2     VSM      QASXSYSP
//*VSM3     EXEC QASM,M=VSM3     VSM      QASXSYSP
//*
//LKED   EXEC  PGM=IEWL,PARM='TERM,XREF,LIST,LET,TEST',REGION=1500K,
//             COND=(7,LT)
//SYSISPF  DD  DSN=SYS1.V1R1M0.ISPLOAD,VOL=SER=M3083P,
//     UNIT=3350,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.PGMPROD.LINKLIB,DISP=SHR LINK LIBRARY
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(2,1))
//SYSTERM  DD  SYSOUT=M
//SYSPRINT DD  SYSOUT=M
//SYSLIB   DD  DSN=SYS3.QISPF.SYSP.OBJLIB,DISP=SHR OBJECT LIBRARY
//SYSSMOD  DD  DSN=C6000A.DOR.LINKLIB2,DISP=SHR LINK LIBRARY
//* INCLUDE SYSSMOD(ASMT3NEW)
//SYSLIN   DD  *
 INCLUDE SYSISPF(ISPLINK)
 INCLUDE SYSLIB(ISPFQI)
 INCLUDE SYSLIB(Q0)
 INCLUDE SYSLIB(QUEUEISP)
 INCLUDE SYSLIB(SAVEPGM)
 INCLUDE SYSLIB(INIT)
 SETCODE AC(1)
 ENTRY ISPFQI
 ALIAS QIAT
 NAME ISPQ134A(R)
//*
./       ADD   NAME=SRM
*          DATA SET TEC128901  AT LEVEL 001 AS OF 11/12/82
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     6/28/85
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
*  FORMER       SE2SJ03D -      #I  DISPLAY SYSTEM INDICATORS FILE 266
SRM      TITLE 'QUEUE COMMAND - #I  DISPLAY SYSTEM INDICATORS'
SRM      QSTART ,                  START SRM  CSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         USING QDISPLAY,R10   BASE REG FOR DISPLAY WORK AREA    DOR
         L     R10,QVDSPL     LOAD BASE REG                     DOR
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA      DOR
***********************************************************************
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SJ03D -       #I  DISPLAY SYSTEM INDICATORS            ***
***                                                                 ***
***       VERSION -        1.3                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SP1.3 LEVEL                          ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                                  ADD #IC SUBCOMMAND             ***
***                        08/10/81  JGS - #IR SUBCOMMAND ADDED   NERDC
***                        11/14/82  LMB-CBT FIX #IC FOR 1.3        ***
***                        06/28/85  CONVERT TO ISPF QUEUE CMD     DOR
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
         CLC   QSUBNAME(8),OLDNAME
         BE   SAMECMD
         MVI   COPYDSWT,X'00'
         MVC   OLDNAME(8),QSUBNAME
SAMECMD  CLI   COPYDSWT,X'FF'
         BE    HAVEDMNT
         SETAUTH ON
         MODESET  KEY=ZERO,MODE=SUP
         LA    R1,COPYDMNT
         OI    0(R1),X'40'    SET DATAAREA SIZE
         LA    R0,40          COPYDMNT SYSEVENTCODE
         L     R15,16         CVT ADDRESS
         L     R15,536(,R15)  SYSEVENT ROUTINE
         BALR  R14,R15        BRANCH TO SYSEVENT
         MODESET  KEY=NZERO,MODE=PROB
         SETAUTH OFF
         MVI   COPYDSWT,X'FF'
HAVEDMNT EQU   *
         LH    R3,QDRLNG           IS PARM STRING EMPTY?
         LTR   R3,R3               ANY SUB-PARMS
         BNZ   PARM                YES, GO PROCESS
*    REPEAT REQUEST IF BLANK
         TM    SRMFLAG,X'01'
         BO    PART
         TM    SRMFLAG,X'02'
         BO    PCCW
         TM    SRMFLAG,X'04'
         BO    ASM
         TM    SRMFLAG,X'08'
         BO    PART
         TM    SRMFLAG,X'10'
         BO    PERF
         TM    SRMFLAG,X'20'
         BO    RCT
SRMALL   MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE(80),LINE1
         TM    SRMFLAG,X'C0' ROTATE BIT
         BZ    NOROT00
         MVI   SRMFLAG,X'FF'      REROTATE COMMANDS AGAIN
NOROT00  EQU   *
         L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         L     R5,20(0,R4)         RMCA
         L     R4,24(0,R4)         WMST
         LA    R6,LINES            LINE FORMATS
         LA    R5,132(0,R5)        SWAP COUNTS IN RMCA             SE2
         LA    R8,14               NUMBER OF LINES                 WJB
*        MVC   QDHLINE+26(2),4(R4) IPS ID
         MVC   QDHLINE+12(8),COPYIPS
         MVC   QDHLINE+26(8),COPYOPT
         MVC   QDHLINE+40(8),COPYICS
         EJECT
PRINT0   L     R4,16               CVT
         USING CVTDSECT,R4         ADDRESSING                     DOR
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         DOR
         USING RMCT,R4             ADDRESSING                     DOR
         L     R4,RMCTCCT          POINT TO SRM RCT               DOR
         USING CCTDSECT,R4         ADDRESSING FOR RCT (FINALLY)   DOR
         CLC   =C'CCT ',CCTCCT     FOUND IT?                      DOR
         BNE   CCTBAD              NOPE - GIVE UP                 DOR
         L     R1,SRMOVA
         MVC   QDMSG(54),0(R1)
         SR    R1,R1
         IC    R1,CCVLGUTL         LONG TERM CPU AVG
         CVD   R1,DOUBLE
         MVC   QDMSG+8(4),=X'40212020'
         ED    QDMSG+8(4),DOUBLE+6
         LH    R1,CCVUTILP         AVERAGE CPU
         CVD   R1,DOUBLE
         MVC   QDMSG+18(4),=X'40212020'
         ED    QDMSG+18(4),DOUBLE+6
         L     R4,16               CVT                            DOR
         USING CVTDSECT,R4         ADDRESSING                     DOR
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         DOR
         USING RMCT,R4             ADDRESSING                     DOR
         L     R4,RMCTRCT          POINT TO SRM RCT               DOR
         USING RCTDSECT,R4         ADDRESSING FOR RCT (FINALLY)   DOR
         CLC   =C'RCT ',RCTRCT     FOUND IT?                      DOR
         BNE   RCTBAD              NOPE - GIVE UP                 DOR
         LH    R1,RCVDPR           AVERAGE PAGING
         CVD   R1,DOUBLE
         MVC   QDMSG+28(4),=X'40212020'
         ED    QDMSG+28(4),DOUBLE+6
         LH    R1,RCVUICA          AVERAGE UIC
         CVD   R1,DOUBLE
         MVC   QDMSG+38(4),=X'40212020'
         ED    QDMSG+38(4),DOUBLE+6
         LH    R1,RCVASMQA         AVERAGE ASMQ
         CVD   R1,DOUBLE
         MVC   QDMSG+48(4),=X'40212020'
         ED    QDMSG+48(4),DOUBLE+6
         EJECT
PRINT    BAL   R7,DISPLAY
         BCT   R8,PRINT1
         B     EXIT
         SPACE 3
PRINT1   MVC   QDMSG+4(36),0(R6) SET A LINE
         L     R1,0(0,R5)          LOAD SWAP COUNT
         CVD   R1,DOUBLE
         MVC   QDMSG+32(8),=X'4020206B20212040'
         ED    QDMSG+32(7),DOUBLE+5
         LA    R5,4(0,R5)          NEXT COUNT
         LA    R6,36(0,R6)         NEXT LINE
         B     PRINT
PARMERR  QTILT 'SUB-PARM NOT SUPPORTED'
         SPACE 3
SARTMSG  QTILT 'NO SWAP DATA SETS IN USE'
         SPACE 3
***********************************************************************
*   LOCAL SUBROUTINE TO PUT OUT LINE VIA Q DISPLAY                  NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR OUT MESSAGE                     NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   QDMSG,C' '      BLANK LINE
         MVC   QDMSG+1(79),QDMSG
         BR    R7             RETURN TO MAINLINE...                 NTL
         SPACE 3
EXIT     QSTOP
         SPACE 3
PARM     EQU   *
         USING  QCKPT,R9
         L     R9,QVCKPT
         LA    R3,QDREPLY
         AH    R3,QOFF1
         MVI   SRMFLAG,X'00'
         CLC   0(2,R3),=CL2'SR'  IF QOFF1 =0 NO PARM
         BE    SRMALL              DEFAULT ALL
         MVI   SRMFLAG,X'FF'
         CLC   0(3,R3),=CL3'ALL'        ROTATE DISPLAYS (ALL)
         BE    PART                YES, GO PROCESS
         MVI   SRMFLAG,X'01'
         CLC   0(4,R3),=CL4'PAGE'          PAGE DS DISPLAY
         BE    PART                YES, GO PROCESS
         MVI   SRMFLAG,X'02'
         CLC   0(4,R3),=CL4'PCCW'       PAGE DS DISPLAY
         BE    PCCW                YES, GO PROCESS
         MVI   SRMFLAG,X'04'
         CLC   0(4,R3),=CL4'ASM'        ASM DISPLAY
         BE    ASM                 YES, GO PROCESS
         MVI   SRMFLAG,X'08'
         CLC   0(4,R3),=CL4'SWAP'       SWAP DS DISPLAY
         BE    PART                YES, GO PROCESS
         MVI   SRMFLAG,X'10'
         CLC   0(4,R3),=CL4'PERF'       PERFORMANCE GROUP DISPLAY
         BE    PERF                YES, GO PROCESS
         MVI   SRMFLAG,X'20'
         CLC   0(3,R3),=CL3'RCT'     RCT DISPLAY                NERDC
         BE    RCT                 YES, GO PROCESS                NERDC
         MVI   SRMFLAG,X'00'
         B     PARMERR
         DROP  R9
         EJECT
PCCW     SR    R5,R5               CLEAR REG 5
         TM    SRMFLAG,X'C0'
         BZ    NOROT2
         NI    SRMFLAG,X'FD'      STRIP BIT OFF
NOROT2   EQU   *
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE+20(4),=CL4'PCCW'
         L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R4,72(0,R3)         NUMBER OF PCCWS CREATED BY RIM
         L     R3,64(0,R3)         POINTER TO FIRST AVAILABLE PCCW
         LTR   R3,R3               ARE THERE ANY AVAILABLE PCCWS
         BZ    ALLDONE             IF NOT THEN PRINT 0000'S IN MSG
         A     R5,=F'1'            ADD ONE TO COUNTER PCCW IS AVAIL
DOITTOIT L     R3,12(0,R3)         GET POINTER TO NEXT PCCW LMB-CBT
         LTR   R3,R3               IS IT THE LAST ONE
         BZ    ALLDONE             IF SO THEN ALL DONE
         A     R5,=F'1'            ADD ONE TO COUNTER
         B     DOITTOIT            GO GET THE NEXT ONE
ALLDONE  CVD   R4,DOUBLE           CONVERT TOTAL NUM OF PCCWS
         MVC   QDMSG(28),PCCWMSG1    SET UP WTO
*        MVC   QDMSG+34(8),=CL8'4020202020202120'
         UNPK  QDMSG+34(8),DOUBLE    UNPK TOTAL NUMBER OF PCCWS
         OI    QDMSG+41,X'F0'        MAKE IT PRINTABLE
         BAL   R7,DISPLAY
         CVD   R5,DOUBLE           CONVERT TOTAL NUM OF PCCWS
         MVC   QDMSG(28),PCCWMSG2    SET UP WTO
*        MVC   QDMSG+34(8),=CL8'4020202020202120'
         UNPK  QDMSG+34(8),DOUBLE    UNPK AVAILABLE PCCWS
         OI    QDMSG+41,X'F0'        MAKE IT PRINTABLE
         BAL   R7,DISPLAY
         B     EXIT                GET OUT BOZO
PART     L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R3,8(0,R3)          PART
         L     R4,24(0,R3)         DSNAME TABLE
         LA    R3,80(0,R3)         PART ENTRIES
         MVC   QDHLINE(80),QBLANK
         L     R1,PAGEADR
         MVC   QDHLINE(70),0(R1)
         TM    SRMFLAG,X'C0'
         BZ    NOROT1
         NI    SRMFLAG,X'FE'      STRIP BIT OFF
NOROT1   EQU   *
         SPACE 3
PART1    MVC   PARTDSP1(70),QBLANK
         MVC   PARTNAME(20),0(R4)  DSNAME
         MVC   PARTTYPE(4),=C'PLPA'
         TM    8(R3),X'80'
         BO    PART2
         MVC   PARTTYPE(4),=C'COMN'
         TM    8(R3),X'40'
         BO    PART2
         MVC   PARTTYPE(4),=C'DPLX'
         TM    8(R3),X'20'
         BO    PART2
         MVC   PARTTYPE(4),=C'LOCL'
         EJECT
PART2    L     R1,44(0,R3)         UCB ADDR
         MVC   PARTUNIT(3),13(R1)  UNIT ADDR
         MVC   PARTVOL(6),28(R1)   VOLSER
         L     R15,16(0,R3)        SIZE IN SLOTS
         CVD   R15,DOUBLE
         UNPK  PARTSIZE(5),DOUBLE+5(3)
         OI    PARTSIZE+4,X'F0'
         L     R9,20(0,R3)         AVAILABLE SLOTS
         CVD   R9,DOUBLE
         UNPK  PARTAVAL(5),DOUBLE+5(3)
         OI    PARTAVAL+4,X'F0'
         SR    R8,R8
         M     R8,=F'100'
         DR    R8,R15              CALCULATE PERCENT AVAILABLE
         L     R8,=F'100'
         SR    R8,R9               PERCENT USED
         CVD   R8,DOUBLE
         OI    DOUBLE+7,X'0F'      FORCE + SIGN
         UNPK  PARTPCNT(2),DOUBLE+6(2)
         CLC   DOUBLE+6(2),=X'100F'   100 PERCENT
         BNE   *+10                NO, LEAVE ALONE
         MVC   PARTPCNT(2),=C'99'  MAKE IT 99 PERCENT
*        L     R1,56(0,R3)         PARERQTM -   BURST COMPUTATION VALUE
*        SRL   R1,8                DIVIDE BY 256
         SR    R1,R1               CLEAR R1
         ICM   R1,7,56(R3)         PICK FIRST THREE BYTES
         CVD   R1,DOUBLE
         UNPK  PARTBRST(3),DOUBLE+6(2)
         OI    PARTBRST+2,X'F0'
         L     R1,24(0,R3)         LOAD PART ENTRY ERROR COUNT
         CVD   R1,DOUBLE
         UNPK  PARTERR(3),DOUBLE+6(2)
         OI    PARTERR+2,X'F0'
         MVC   QDMSG(70),PARTDSP1
         BAL   R7,DISPLAY
         SPACE 3
PART3    LA    R4,44(0,R4)         NEXT DSNAME
         LA    R3,64(0,R3)         NEXT PART ENTRY
         CLI   8(R3),X'00'         END OF PART
         BE    SART                YES, EXIT
         TM    9(R3),X'80'         NOT IN USE
         BO    PART3               YES, GET NEXT
         B     PART1
         EJECT
SART     L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R3,4(0,R3)          SART
         L     R4,24(0,R3)         DSNAME TABLE
         TM    SRMFLAG,X'C0'
         BZ    NOROT8
         NI    SRMFLAG,X'F7'      STRIP BIT OFF
NOROT8   EQU   *
         SPACE 3
SART0    L     R1,SARTOV0A
         MVC   SARTDSP0(42),0(R1)
         MVC   SARTNO(4),=XL4'40202120'
         MVC   SARTTAVL(6),=XL6'402020202120'
         MVC   SARTPGST(6),=XL6'402020202120'
         L     R1,8(0,R3)          NO. OF SWAP DS IN USE
         CVD   R1,DOUBLE
         ED    SARTNO(4),DOUBLE+6
         LR    R8,R1              SAVE NO. OF SWAP DS
         ST    R8,SWAPDSNO
         L     R1,36(0,R3)         AVAILABLE SWAP SETS TOTAL
         CVD   R1,DOUBLE
         ED    SARTTAVL(6),DOUBLE+5
         L     R1,56(0,R3)         PAGES/SWAPSET
         CVD   R1,DOUBLE
         ED    SARTPGST(6),DOUBLE+5
         MVC   QDMSG(42),SARTDSP0
         BAL   R7,DISPLAY
         LA    R3,80(0,R3)         SART ENTRIES
         LTR   R8,R8             ANY SWAP DS IN USE
         BZ    EXIT               NO, ISSUE MSG
         SPACE 3
SART1    EQU   *
         MVC   PARTDSP1(70),QBLANK
         MVC   PARTTYPE(4),=CL4'SWAP'
         MVC   PARTNAME(20),0(R4)  DSNAME
         L     R1,44(0,R3)         UCB ADDR
         MVC   PARTUNIT(3),13(R1)  UNIT ADDR
         MVC   PARTVOL(6),28(R1)   VOLSER
         EJECT
SART2    L     R15,16(0,R3)        SIZE IN SWAP SETS
         CVD   R15,DOUBLE
         UNPK  PARTSIZE(5),DOUBLE+5(3)
         OI    PARTSIZE+4,X'F0'
         L     R9,20(0,R3)         AVAILABLE SWAP SETS
         CVD   R9,DOUBLE
         UNPK  PARTAVAL(5),DOUBLE+5(3)
         OI    PARTAVAL+4,X'F0'
         SR    R8,R8
         M     R8,=F'100'
         DR    R8,R15              CALCULATE PERCENT AVAILABLE
         L     R8,=F'100'
         SR    R8,R9               PERCENT USED
         CVD   R8,DOUBLE
         OI    DOUBLE+7,X'0F'      FORCE + SIGN
         UNPK  PARTPCNT(2),DOUBLE+6(2)
         CLC   DOUBLE+6(2),=X'100F'   100 PERCENT
         BNE   *+10                NO, LEAVE ALONE
         MVC   PARTPCNT(2),=C'99'  MAKE IT 99 PERCENT
         L     R1,24(0,R3)         SWAP SETS IN ERROR
         CVD   R1,DOUBLE
         UNPK  PARTERR(3),DOUBLE+6(2)
         OI    PARTERR+2,X'F0'
         MVC   PARTBRST(3),=CL3'N/A'
         MVC   QDMSG(70),PARTDSP1
         BAL   R7,DISPLAY
         SPACE 3
SART3    L     R8,SWAPDSNO
         BCT   R8,*+8             PROCESS NEXT ENTRY
         B     EXIT                END
         ST    R8,SWAPDSNO
         LA    R4,44(0,R4)         NEXT DSNAME
         LA    R3,48(0,R3)         NEXT SART ENTRY
         TM    9(R3),X'80'         NOT IN USE
         BO    SART3               YES, GET NEXT
         B     SART1
         SPACE 3
         EJECT
ASM      EQU   *
         TM    SRMFLAG,X'C0' ROTATE BIT
         BZ    NOROT4
         NI    SRMFLAG,X'FB'      STRIP BIT OFF
NOROT4   EQU   *
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE+12(4),=CL4'ASM'
         L     R4,16               CVT
         L     R4,704(0,R4)        ASMVT
         MVC   QDMSG+4(12),=CL12'ILRSLOTC'
         MVC   QDMSG+16(10),=X'40206B2020206B202120'
         L     R1,128(0,R4)        LOAD
         LA    R1,0(0,R1)             SLOTC
         SH    R1,=H'8'                  VALUE
         L     R1,0(0,R1)                   AND
         CVD   R1,DOUBLE                       CONVERT
         ED    QDMSG+16(10),DOUBLE+4
         BAL   R7,DISPLAY          GO PRINT RESULTS
         MVC   QDMSG+4(12),=CL12'ILRSLOTV'
         MVC   QDMSG+16(10),=X'40206B2020206B202120'
         L     R1,128(0,R4)        LOAD
         L     R1,0(0,R1)             SLOTV VALUE
         CVD   R1,DOUBLE                 AND CONVERT
         ED    QDMSG+16(10),DOUBLE+4
         BAL   R7,DISPLAY          GO PRINT RESULTS
         LA    R4,108(0,R4)        ASM COUNTS
         MVC   QDMSG+4(12),=CL12'AVAIL SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   QDMSG+4(12),=CL12'TOTAL SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   QDMSG+4(12),=CL12'VIO SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   QDMSG+4(12),=CL12'ADSPC SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   QDMSG+4(12),=CL12'BAD SLOTS'
         BAL   R5,AFORM            GO FORMAT
         B     EXIT                EXIT
         SPACE 3
AFORM    L     R1,0(0,R4)          LOAD COUNT
         CVD   R1,DOUBLE              AND CONVERT
         MVC   QDMSG+16(10),=X'40206B2020206B202120'
         ED    QDMSG+16(10),DOUBLE+4
         LA    R4,4(0,R4)          NEXT COUNT
         SPACE 3
         BAL   R7,DISPLAY
         BR    R5                  RETURN
         EJECT
PERF     EQU   *
         TM    SRMFLAG,X'C0' ROTATE BIT
         BZ    NOROT10
         NI    SRMFLAG,X'EF'      STRIP BIT OFF
NOROT10  EQU   *
         ST    R11,SAVER11
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE+25(4),=CL4'PERF'
         L     R1,PERFOVA
         MVC   QDMSG(54),0(R1)
         BAL   R7,DISPLAY
         L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         L     R5,88(0,R4)         WAMT
         LH    R7,38(0,R5)         MAX PERFORM GROUP NUMBER
         SR    R8,R8
         LA    R9,84(0,R5)         WAMP OFFSET TABLE
         SR    R2,R2
         SR    R11,R11
         XC    WAMPTOTL(80),WAMPTOTL
         SPACE 1
PERF1    LA    R8,1(0,R8)          INCR PGN NUMBER
         ST    R7,MAXPGRP
         CLC   0(4,R9),4(R9)       NEXT SAME AS PREVIOUS
         BE    PERF3               YES, GET NEXT OFFSET
         L     R6,0(0,R9)          WAMP OFFSET
         L     R15,4(0,R9)         NEXT OFFSET
         SR    R15,R6
         SR    R14,R14
         LH    R1,36(0,R5)         WAMP LENGTH
         DR    R14,R1
         CH    R15,=H'1'           ONLY ONE
         BE    *+10                YES
         LR    R11,R15             SAVE NUMBER OF PERIODS
         LA    R2,1               1ST PERIOD
         AR    R6,R5               WAMP ADDRESS
         SPACE 1
PERF2    CVD   R8,DOUBLE
         MVI   QDMSG+4,C' '
         MVC   QDMSG+5(49),QDMSG+4
         UNPK  QDMSG+4(2),DOUBLE+6(2)
         OI    QDMSG+5,X'F0'
         CVD   R2,DOUBLE
         UNPK  QDMSG+9(1),DOUBLE+7(1)
         OI    QDMSG+9,X'F0'
         CLI   QDMSG+9,C'0'        ONE PERIOD IN PGN
         BNE   *+10                NO
         MVC   QDMSG+8(3),=C'ALL'
         L     R15,0(0,R6)         NUMBER OF TRANSACTIONS
         LR    R3,R15              SAVE NO. OF TRANS
         L     R1,0(0,R6)          NUMBER OF TRANSACTIONS
         A     R1,WAMPTOTL
         ST    R1,WAMPTOTL         SAVE TOTAL FOR ALL PERIODS
         LTR   R15,R15             ZERO
         BZ    PERF3               YES, NO PRINT
         CVD   R15,DOUBLE
         MVC   QDMSG+12(7),=X'4020206B202120'
         ED    QDMSG+12(7),DOUBLE+5
         SR    R14,R14
         L     R15,40(0,R6)        TOTAL SWAPS
         L     R1,40(0,R6)         NUMBER OF SWAPS
         A     R1,WAMPTOTL+40
         ST    R1,WAMPTOTL+40      SAVE TOTAL FOR ALL PERIODS
         DR    R14,R3              DIVIDE BY ENDED TRANSACTIONS
         CVD   R15,DOUBLE          AVG SWAPS
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R3              AVG HUNDREDTHS SWAPS
         CVD   R15,DOUBLEX
         MVC   QDMSG+38(7),=X'402021204B2020'
         ED    QDMSG+38(4),DOUBLE+6
         UNPK  QDMSG+43(2),DOUBLEX+6(2)
         OI    QDMSG+44,X'F0'
         SR    R14,R14
         L     R15,12(0,R6)        TOTAL ELAPSED TIME FOR ENDED TRANS
         L     R1,12(0,R6)         TOTAL TIME
         A     R1,WAMPTOTL+12
         ST    R1,WAMPTOTL+12      SAVE TOTAL FOR ALL PERIODS
         DR    R14,R3              DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'
         CVD   R15,DOUBLE          AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX         AVG HUNDREDTHS RESPONSE TIME
         MVC   QDMSG+45(9),=X'4020202021204B2020'
         ED    QDMSG+45(6),DOUBLE+5
         UNPK  QDMSG+52(2),DOUBLEX+6(2)
         OI    QDMSG+53,X'F0'
         L     R3,8(0,R6)          TOTAL SERVICE
         L     R1,8(0,R6)          TOTAL SERVICE
         A     R1,WAMPTOTL+8
         ST    R1,WAMPTOTL+8       SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R15,R3
         M     R14,=F'1000'
         LR    R3,R15              SERVICE TIMES 1000
         L     R15,4(0,R6)         TOTAL TRANS TIME
         L     R1,4(0,R6)          TOTAL TRANS TIME
         A     R1,WAMPTOTL+4
         ST    R1,WAMPTOTL+4       SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R1,R15
         LR    R15,R3
         DR    R14,R1              DIVIDE SERVICE
         CVD   R15,DOUBLE          AVG TR SERVICE
         MVC   QDMSG+20(7),=X'4020206B202120'
         ED    QDMSG+20(7),DOUBLE+5
         SR    R14,R14
         L     R15,36(0,R6)        TOTAL RES TIME
         L     R1,36(0,R6)         TOTAL RES TIME
         A     R1,WAMPTOTL+36
         ST    R1,WAMPTOTL+36      SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R1,R15
         LR    R15,R3
         DR    R14,R1              DIVIDE SERVICE
         CVD   R15,DOUBLE          AVG ABS RATE
         MVC   QDMSG+29(7),=X'4020206B202120'
         ED    QDMSG+29(7),DOUBLE+5
         ST    R11,PERFR11
         L     R11,SAVER11
         BAL   R7,DISPLAY
         L     R11,PERFR11
         EJECT
PERF3    LTR   R11,R11             MULTIPLE PERIODS OR 'ALL'
         BZ    PERF5               NO
         LH    R1,36(0,R5)         WAMP SIZE
         AR    R6,R1               NEXT PERIOD WAMP
         LA    R2,1(0,R2)        BUMP PERIOD NUMBER
         CR    R11,R2             END OF PERIODS
         BNL   PERF2               NO
         SPACE 1
PERF4    SR    R2,R2
         SR    R11,R11
         LA    R6,WAMPTOTL
         B     PERF2               PRINT TOTALS
         SPACE 1
PERF5    LA    R9,4(0,R9)          INCR INTO TABLE
         XC    WAMPTOTL(80),WAMPTOTL
         L     R7,MAXPGRP
         BCT   R7,PERF1
         L     R11,SAVER11
         B     EXIT
         EJECT ,                                                  NERDC
RCT      DS    0H                                                 NERDC
         TM    SRMFLAG,X'C0' ROTATE BIT
         BZ    NOROT20
         NI    SRMFLAG,X'DF'      STRIP BIT OFF
NOROT20  EQU   *
         MVC   QDHLINE(80),QBLANK
         L     R1,RCTLADR0
         MVC   QDHLINE+10(39),0(R1) TITLE LINE                NERDC
         L     R4,16               CVT                            NERDC
         USING CVTDSECT,R4         ADDRESSING                     NERDC
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         NERDC
         USING RMCT,R4             ADDRESSING                     NERDC
         L     R4,RMCTRCT          POINT TO SRM RCT               NERDC
         USING RCTDSECT,R4         ADDRESSING FOR RCT (FINALLY)   NERDC
         CLC   =C'RCT ',RCTRCT     FOUND IT?                      NERDC
         BNE   RCTBAD              NOPE - GIVE UP                 NERDC
         SPACE 1                                                  NERDC
         L     R1,RCTLADR1
         MVC   QDMSG+4(37),0(R1)       SECOND TITLE LINE         NERDC
         BAL   R7,DISPLAY
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'CPU UTILIZATION'                 NERDC
         LH    R1,RCVCPUA                                         NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCCPUTL                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCCPUTH                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'CPU UTIL W/ DEM PAG'             NERDC
         LH    R1,RCCCPUPL                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCCPUPH                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'PAGING RATE'                     NERDC
         LH    R1,RCVPTR                                          NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCPTRTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCPTRTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'DEMAND PAGING RATE'              NERDC
         LH    R1,RCVDPR                                          NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCDPRTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCDPRTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'TOTAL PAGING RATE'               NERDC
         LH    R1,RCVPAGRT                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'PAGE DELAY TIME (MS)'            NERDC
         LH    R1,RCVMSPP                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCPDLTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCPDLTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'PAGE DELAY W/ DEM PAG'           NERDC
         LH    R1,RCCMSPTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCMSPTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'AVG ASM QUEUE'                   NERDC
         LH    R1,RCVASMQA                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCASMTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCASMTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'AVG UIC'                         NERDC
         LH    R1,RCVUICA                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         LH    R1,RCCUICTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+27(5),DOUBLE                               NERDC
         LH    R1,RCCUICTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+32(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY                                         NERDC
         SPACE 1                                                  NERDC
         MVC   QDMSG+4(37),=CL37'AVG AVAIL FRAMES'                NERDC
         LH    R1,RCVAFQA                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   QDMSG+4+20(5),DOUBLE                               NERDC
         BAL   R7,DISPLAY          PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         B     EXIT                DONE                           NERDC
         SPACE 3                                                  NERDC
RCTBIN   DS    0H                  CONVERT VALUE TO BIN           NERDC
         CVD   R1,DOUBLE           TO DECIMAL                     NERDC
         MVC   DOUBLE-1(6),=X'402020202120'                       NERDC
         ED    DOUBLE-1(6),DOUBLE+5                               NERDC
         BR    R5                  RETURN TO CALLER               NERDC
         SPACE 3                                                  NERDC
RCTBAD   DS    0H                                                 NERDC
         MVC   QDMSG+4(37),=CL37'RCT NOT LOCATABLE'               NERDC
         BAL   R7,DISPLAY          SEND MESSAGE                   NERDC
         B     EXIT                RETURN TO CALLER               NERDC
CCTBAD   DS    0H                                                 NERDC
         MVC   QDMSG+4(37),=CL37'CCT NOT LOCATABLE'               NERDC
         BAL   R7,DISPLAY          SEND MESSAGE                   NERDC
         B     EXIT                RETURN TO CALLER               NERDC
         EJECT
         LTORG
         SPACE 3
PERFOVA  DC    A(PERFOVLY)
SRMOVA   DC    A(SRMOVLY)
SARTOV0A DC    A(SARTOVL0)
RCTLADR0 DC    A(RCTLINE0)
RCTLADR1 DC    A(RCTLINE1)
PAGEADR  DC    A(PAGELINE)
PCCWMSG1 DC    CL28'NUMBER OF PCCWS BUILT BY RIM'
         SPACE 3
PCCWMSG2 DC    CL28'NUMBER OF AVAILABLE PCCWS   '
         SPACE 3
LINE1    DC    CL80'CURRENT IPS=IEAIPSXX  OPT=IEAOPTXX  ICS=IEAICSXX'
*                   123456789012345678901234567890123456789012345
         SPACE 3
LINES    DC    CL20'TERM WAIT - OUT',C'(01)',CL12' '
         DC    CL20'TERM WAIT - IN',C'(02)',CL12' '
         DC    CL20'LONG WAIT',C'(03)',CL12' '
         DC    CL20'AUX STOR SHORTAGE',C'(04)',CL12' '
         DC    CL20'REAL STOR SHORTAGE',C'(05)',CL12' '
         DC    CL20'DETECTED WAIT',C'(06)',CL12' '
         DC    CL20'REQUEST SWAP',C'(07)',CL12' '
         DC    CL20'ENQ EXCHANGE',C'(08)',CL12' '
         DC    CL20'WORKLOAD EXCHANGE',C'(09)',CL12' '
         DC    CL20'UNILATERAL SWAP',C'(0A)',CL12' '
         DC    CL20'TRANSITION SWAP',C'(0B)',CL12' '
         DC    CL20'LOGICAL SWAPS',C'(0C)',CL12' '
         DC    CL20'LOGICAL SWAPS FAIL',C'(0D)',CL12' '
         EJECT
RCTLINE0 DC    CL39'RESOURCE CONTROL TABLE (RCT)'
RCTLINE1 DC    CL37'                  CURRENT   THRESHOLD'        NERDC
         SPACE 3
SRMOVLY  DS    0CL54
         DC    CL4'    '
         DC    CL5'LGCPU',CL5' '
         DC    CL5'AVCPU',CL5' '
         DC    CL5'AVDPG',CL5' '
         DC    CL4'AUIC',CL6' '
         DC    CL4'ASMQ',CL6' '
         SPACE 3
PAGELINE DC    CL41'TYPE  UNIT  VOLNAME    DSNAME'
         DC    CL29'ERR  SIZE AVAIL %USED BURST'
         SPACE 3
SARTOVL0 DS    0CL42
         DC    CL9'SWAP  DS-'
         DC    CL4' '
         DC    CL7'  SETS-'
         DC    CL6' '
         DC    CL10'  PGS/SET-'
         DC    CL6' '
         SPACE 3
PERFOVLY DS    0CL80
     DC    CL80'   PGN PER   TR CNT TR RATE  AB RATE  SW RATE   AVGRSP'
*                   NN   N   NN,NNN  NNN.NN   NNN.NN   NNN.NN NNNNN.NN
         LTORG ,                                                  NERDC
         EJECT
         PRINT NOGEN
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
OLDNAME  DS    CL8
COUNT    DS    D
WORKSTRT DS    0D
         DS    D                   SCRATCH BEFORE DOUBLE          NERDC
DOUBLE   DS    D
DOUBLEX  DS    D
SAVRET   DS    F
SAVER11  DS    F
PERFR11  DS    F
SWAPDSNO DS    F
MAXPGRP  DS    F
         SPACE 3
         DS    0F
PARTLST1 DS    CL4
PARTDSP1 DS    0CL70
PARTTYPE DS    CL4
         DS    CL2
PARTUNIT DS    CL4
         DS    CL2
PARTVOL  DS    CL6
         DS    CL2
PARTNAME DS    CL20
         DS    CL1
PARTERR  DS    CL3
         DS    CL1
PARTSIZE DS    CL5
         DS    CL1
PARTAVAL DS    CL5
         DS    CL4
PARTPCNT DS    CL2
         DS    CL4
PARTBRST DS    CL3
         DS    CL5
         EJECT
         DS    0F
SARTLST0 DS    CL4
SARTDSP0 DS    0CL42
         DS    CL9
SARTNO   DS    CL4
         DS    CL7
SARTTAVL DS    CL6
         DS    CL10
SARTPGST DS    CL6
         SPACE 3
         DS    F
WAMPTOTL DS    CL80
SRMFLAG  DS    X
COPYDSWT DS    X
         DS    0F
COPYDMNT DS    CL40
         ORG   COPYDMNT+16
COPYIPS  DS    CL8
COPYOPT  DS    CL8
COPYICS  DS    CL8
         ORG   COPYDMNT+40
WORKEND  DS    0D
         EJECT
RMCT     DSECT ,                                                  NERDC
         ORG   RMCT+4
RMCTCCT  DS    F                   POINTER TO CCT
         ORG   RMCT+228                                           NERDC
RMCTRCT  DS    F                   POINTER TO RCT                 NERDC
         ORG   ,                                                  NERDC
         SPACE 3                                                  NERDC
RCTDSECT DSECT ,                   SRM RES CNTL TABLE             NERDC
RCTRCT   DS    CL4                 'RCT'                          NERDC
RCCUICTL DS    H                   UIC THRESHOLD LOW              NERDC
RCCUICTH DS    H                   UIC THRESHOLD HIGH             NERDC
RCCCPUTL DS    H                   CPU THRESHOLD LOW              NERDC
RCCCPUTH DS    H                   CPU THRESHOLD HIGH             NERDC
RCCPTRTL DS    H                   PAGING THRESHOLD LOW           NERDC
RCCPTRTH DS    H                   PAGING THRESHOLD HIGH          NERDC
RCCASMTL DS    H                   ASM Q REQUEST THRESHOLD LOW    NERDC
RCCASMTH DS    H                   ASM Q REQUEST THRESHOLD HIGH   NERDC
RCCDPRTL DS    H                   DEMAND PAGE RATE LOW THRESH    NERDC
RCCDPRTH DS    H                   DEMAND PAGE RATE HIGH THRESH   NERDC
RCCCPUPL DS    H                   CPU UTIL W/ DEMAND PAGING LOW  NERDC
RCCCPUPH DS    H                   CPU UTIL W/ DEMAND PAGING HI   NERDC
RCCMSPTL DS    H                   PAGE DELAY W/ DEMAND PAGING LO NERDC
RCCMSPTH DS    H                   PAGE DELAY W/ DEMAND PAGING HI NERDC
RCCPDLTL DS    H                   PAGE DELAY TIME (MS) LOW       NERDC
RCCPDLTH DS    H                   PAGE DELAY TIME (MS) HIGH      NERDC
         ORG   RCTDSECT+60                                        NERDC
RCVCTMC  DS    H                   SAMPLE INTERVALS COUNT         NERDC
RCVUICA  DS    H                   UIC AVERAGE                    NERDC
RCVCPUA  DS    H                   CPU USAGE AVERAGE              NERDC
RCVAVQC  DS    H                   AVQ LOWW COUNT                 NERDC
RCVAFQA  DS    H                   AVG AVAIL FRAMES               NERDC
RCVASMQA DS    H                   ASM Q LENGTH AVERAGE           NERDC
RCVPTR   DS    H                   PAGING RATE                    NERDC
RCVDPR   DS    H                   DEMAND PAGING RATE             NERDC
RCVPAGRT DS    H                   TOTAL PAGING RATE              NERDC
RCVMSPP  DS    H                   PAGE DELAY TIME (MS)           NERDC
         ORG   ,                                                  NERDC
CCTDSECT DSECT
         DS    0F
CCTCCT   DC    CL4'CCT' -          ACRONYM IN EBCDIC -CCT-
*
*        CPU CONTROL CONSTANTS
*
* TIME INTERVAL CONSTANTS - 1000 UNITS = APPROXIMATELY 1 SECOND
CCCAPMET DC    F'200' -            MINIMUM USER EXECUTION INTERVAL FOR
*                                  MEAN TIME TO WAIT COMPUTATION
CCCAPMIN DC    F'1000' -           MINIMUM APG INVOCATION INTERVAL
CCCAPMAX DC    F'0003000' -        MAXIMUM APG INVOCATION INTERVAL
CCCAPDEL DC    F'1000' -           DELTA FOR CHANGING APG INTERVAL
CCCMNUIN DC    F'30000' -           TIME USER MUST BE IN MAIN STORAGE
*                                   BEFORE SWAP OUT CPU REC IS GIVEN
CCCMNSIN DC    F'5000' -           MINIMUM INTERVAL FOR COMPUTING
*                                  SYSTEM CPU UTILIZATION
CCCRSVF1 DC    F'0' -              RESERVED
* APG DISPATCHING PRIORITY COMPUTATION CONSTANTS
CCCAPDIV DC    H'4' -              DP COMPUTATION DIVISOR      @Z40BPEB
CCCAPROT DC    H'11' -             VALUE OF APG ROTATE GROUP   @Z40BPEB
CCCAPBDP DC    H'15' -             BASE DP FROM WHICH QUOTIENT IS
*                                  SUBTRACTED
CCCAPLDP DC    H'1' -              DP FOR UNDISPATCHED APG USERS
CCCAPMDP DC    H'0' -              DP FOR MAX MEAN TIME TO WAIT
CCCAPGDP DC    H'06' -             APG INITIAL DP              @Z40BPCH
CCCR01    DC    H'0' -             RESERVED                  @ZM43085
* APG THRESHOLDS EXPRESSED AS % OF APG USERS CHAPPED AT APG CALL
CCCAPRLT DC    H'20' -             LOW THRESHOLD - LENGTHEN APG
*                                  INVOCATION INTERVAL
CCCAPRHT DC    H'60' -             HIGH THRESHOLD - SHORTEN INTERVAL
* CPU LOAD BALANCING RECOMMENDATION VALUE COMPUTATION CONSTANTS
CCCUTHIT DC    H'100' -            HIGH UTILIZATION IMBALANCE
*                                  THRESHOLD
CCCUTLOT DC    H'80' -             LOW UTILIZATION IMBALANCE
*                                  THRESHOLD
CCCHISCF DC    H'6400' -           HIGH THRESHOLD SCALING FACTOR
CCCLOSCF DC    H'1' -              LOW THRESHOLD SCALING FACTOR
CCCMAXRV DC    H'128' -            MAXIMUM CPL REC VALUE
CCCMINRV DC    H'-128' -           MINIMUM CPL REC VALUE
CCCSCFAC DC    H'64' -             REC VALUE SCALING DIVISOR
CCCSIGDP DC    H'02' -             SIGNIFICANT CPU USER D PRIORITY
CCCSIGUR DC    H'26' -             SIGNIFICANT MEAN TIME TO WAIT IN MS
CCCR02   DC    H'0' -              RESERVED                   @ZM43085
CCCSCFC1 DC    H'10' -             SYSTEM WAIT % AVERAGING FACTOR
CCCSCFC2 DC    H'11' -             CCCSCFC1+1
CCCRSVH1 DC    H'0' -              RESERVED
CCCEND   DS    0F -                END OF CCT CONSTANTS
*
*        CPU CONTROL VARIABLES
*
CCVR03  DC    F'0' -               RESERVED                   @ZM43085
CCVRBSWT DC    F'0' -              RECENT BASE SYSTEM WAIT TIME
CCVR04   DC    F'0' -              RESERVED                  @ZM43085
CCVRBSTD DC    F'0' -              RECENT BASE TIME OF DAY
CCVRVSWF DC    F'0' -              SYSTEM WAIT FACTOR FOR CPL
*                                  RECOMMENDATION VALUE COMPUTATION
CCVPGCPF DC    F'0' -              PAGE CP SERVICE FACTOR FOR CPL
*                                  RECOMMENDATION VALUE COMPUTATION
CCVEJST  DC    F'0' -              LOW PRIORITY USER JOB STEP TIME
CCVIMBBT DC    F'0' -               TIME OF LAST CPU IMBALANCE
CCVR05   DC    H'0' -              RESERVED                   @ZM43085
CCVUTILP DC    H'50' -             SYSTEM CPU UTILIZATION
CCVR06   DC    H'0' -              RESERVED                  @ZM43085
CCVR07   DC   H'0' -               RESERVED                   @ZM43085
CCVLGUTL DC    AL2(50*256) -       LONG TERM UTILIZATION * 256
CCVLGFMC DC    H'10' -             AVERAGE AVAILABLE FRAME COUNT
CCVENQCT DC    H'0' -              NO. OF USERS NON SWAPPABLE FOR
*                                  ENQ REASONS
CCVCPUCT DC    H'0' -              NUMBER OF ONLINE CPUS
*
*        CPU CONTROL FLAGS
*
CCTFLG1  DC    B'0' -
CCTFLG2  DC    3B'0' -             RESERVED
CCVEND   DS    0D -                END OF CCT
CCTLEN   EQU   CCVEND-CCTDSECT -        LENGTH OF CCT
         PRINT NOGEN                                              NERDC
CVTDSECT CVT   ,                                                  NERDC
         END
./       ADD   NAME=STCMAP
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     7/14/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
         MACRO
&NAME    ON    &FLAG
.*
.**********************************************************************
.*                                                                    *
.*  COPYRIGHT (C) 1981 BY BROIDO COMPUTER CONSULTING.  ALL RIGHTS     *
.*  RESERVED EXCEPT:                                                  *
.*                                                                    *
.*  PARTICULAR LICENSE IS GRANTED TO DISTRIBUTE THIS MACRO FREE       *
.*  OF CHARGE, BUT IT MUST NOT BE SOLD.  A SERVICE CHARGE FOR         *
.*  HANDLING A COLLECTION OF SOFTWARE OF WHICH THIS IS A PART,        *
.*  ON THE OTHER HAND, IS APPROPRIATE.                                *
.*                                                                    *
.*                                  BROIDO COMPUTER CONSULTING        *
.*                                  104 MILLS STREET                  *
.*                                  MORRISTOWN, N.J.  07960           *
.*                                                                    *
.**********************************************************************
.*
         LCLC  &L
&L       SETC  'L'''
&NAME    OI    &FLAG,&L.&FLAG              (TURN ON BIT FLAG)
         MEND
         MACRO
&NAME    TF    &FLAG
.*
.**********************************************************************
.*                                                                    *
.*  COPYRIGHT (C) 1981 BY BROIDO COMPUTER CONSULTING.  ALL RIGHTS     *
.*  RESERVED EXCEPT:                                                  *
.*                                                                    *
.*  PARTICULAR LICENSE IS GRANTED TO DISTRIBUTE THIS MACRO FREE       *
.*  OF CHARGE, BUT IT MUST NOT BE SOLD.  A SERVICE CHARGE FOR         *
.*  HANDLING A COLLECTION OF SOFTWARE OF WHICH THIS IS A PART,        *
.*  ON THE OTHER HAND, IS APPROPRIATE.                                *
.*                                                                    *
.*                                  BROIDO COMPUTER CONSULTING        *
.*                                  104 MILLS STREET                  *
.*                                  MORRISTOWN, N.J.  07960           *
.*                                                                    *
.**********************************************************************
.*
         LCLC  &L
&L       SETC  'L'''
&NAME    TM    &FLAG,&L.&FLAG      TEST FLAG.
         MEND
STCMAP   TITLE 'QUEUE COMMAND TO PROVIDE MVS/SP STORAGE LAYOUT MAP'
STCMAP  QSTART ,                  START DEVMON DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R10       BASE REG FOR DISPLAY WORK AREA
         L     R10,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -  TABLEN
*    R6   -
*    R7   -
*    R8   -
*    R9   - WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*COPY FROM CBT FILE 423 AND CONVERT INTO QUEUE ISPF
*%A PPLINK AMODGEN NOTEST AC(1)
         SPACE 1
***********************************************************************
*                                                                     *
*  COPYRIGHT (C) 1984 BY BROIDO COMPUTER CONSULTING.  ALL RIGHTS      *
*  RESERVED EXCEPT:                                                   *
*                                                                     *
*  PARTICULAR LICENSE IS GRANTED TO DISTRIBUTE THIS PROGRAM FREE      *
*  OF CHARGE, BUT IT MUST NOT BE SOLD.  A SERVICE CHARGE FOR          *
*  HANDLING A COLLECTION OF SOFTWARE OF WHICH THIS IS A PART,         *
*  ON THE OTHER HAND, IS APPROPRIATE.                                 *
*                                                                     *
*                                  BROIDO COMPUTER CONSULTING         *
*                                  104 MILLS STREET                   *
*                                  MORRISTOWN, N.J.  07960            *
*                                                                     *
***********************************************************************
         SPACE 1
***********************************************************************
*                                                                     *
*        MAPSP - TSO COMMAND TO PRODUCE STORAGE BOUNDARY MAP FOR      *
*                MVS/SP (NON-XA).                                     *
*                                                                     *
*                SYSLIB: ASM: SYS1.AMODGEN.                           *
*                        LNK: NONE.                                   *
*                                                                     *
*                NOT REENTRANT.                                       *
*                TESTED THROUGH LEVEL SP 1.3.4.                       *
*                                                                     *
*                                  JEFFREY R. BROIDO                  *
*                                  MHT/WCF-4/NYP-NYC                  *
*                                  26  JANUARY  1984                  *
*                                                                     *
***********************************************************************
         SPACE 1
         L     R9,X'10'            POINT TO CVT.
         USING CVT,R9              TELL ASSEMBLER.
         L     R8,0(,R9)           POINT TO TCB/ASCB WORDS.
         L     R8,0(,R8)           POINT TO TCB.
         L     R8,X'B4'(,R8)       POINT TO JSCB.
         SETAUTH ON
         MODESET KEY=ZERO
*        ON    AFLG                TURN ON OK-TO-MODESET FLAG.
         L     R8,CVTGDA           POINT TO GDA.
         USING GDA,R8              TELL ASSEMBLER.
         ON    GFLG                TURN ON 3X7X FLAG.
HEADOUT  MVC   QDHLINE(80),QBLANK  CLEAN OUT
         MVC   QDMSG(80),QBLANK    CLEAN OUT
         MVC   QDHLINE(49),HEAD1   OUTPUT HEADINGS.
         MVC   QDMSG(51),HEAD2     OUTPUT UNDERLINES.
         BAL   R6,DISPLAY
         LA    R3,TABLE            POINT TO TABLE ENTRY.
         USING TABLED,R3           TELL ASSEMBLER.
TABLUP   CLI   0(R3),X'00'         END OF TABLE?
         BE    EXIT                B IF YES.
         MVC   AREA,TABTITLE       MOVE ENTRY TITLE.
         L     R15,TABRES          POINT TO DATA RESOLUTION ROUTINE.
         BALR  R14,R15             FILL-IN TABLE ENTRY.
         LA    R1,TABSTART         POINT TO AREA START ADDRESS.
         TM    0(R1),X'80'         IS START ADDRESS PTR NEGATIVE?
         BO    MISSING             B IF YES.  AREA IS INDEED MISSING.
         BAL   R14,HEXOUT          CONVERT TO CHARACTER HEX.
         MVC   START,WORKX+2        MOVE START ADDR. CHARACTER HEX.
         LA    R1,TABEND           POINT TO AREA END ADDRESS.
         BAL   R14,HEXOUT          CONVERT TO CHARACTER HEX.
         MVC   END,WORKX+2          MOVE END ADDR. CHAR. HEX.
         L     R1,TABLEN           LOAD AREA LENGTH FROM TABLE.
         SRL   R1,10               "DIVIDE" BY 1K.
         CVD   R1,WORKX            DECIMALIZE IT.
         MVC   LENGTH,=X'40206B2020206B202120'  MOVE EDIT PATTERN.
         ED    LENGTH,WORKX+4       EDIT LENGTH.
         ICM   R1,15,TABFULL       LOAD AREA BYTES USED.
         BNZ   TFE                 B IF NOT ZERO.
         MVC   FULL,=C'--'         MOVE "NOT APPLICABLE" GRAPHIC.
         B     DETPUT              CONTINUE.
MISSING  MVC   START,=C'    --  '  MOVE "MISSING" GRAPHIC.
         MVC   END,=C'    --  '    MOVE "MISSING" GRAPHIC.
         MVC   LENGTH,=C'        --'  MOVE "MISSING" GRAPHIC.
         MVC   FULL,=C'--'         MOVE "MISSING" GRAPHIC.
         B     DETPUT              CONTINUE.
TFE      L     R5,TABLEN           LOAD DIVISOR.
         MH    R1,=H'100'          MULTIPLY BYTES BY 100.
         SR    R0,R0               ZERO HIGH ORDER DIVIDEND.
         DR    R0,R5               GENERATE PERCENT USED.
         SRL   R5,1                "DIVIDE" DIVISOR BY 2.
         CR    R0,R5               SHALL I ROUND?
         BL    NOROUND             B IF NOT.
         LA    R1,1(,R1)           ROUND PERCENTAGE.
NOROUND  CVD   R1,WORKX            DECIMALIZE PERCENT.
         UNPK  WORK1(3),WORKX+6(2)  UNPAKC PERCENT.
         MVC   FULL,WORK1+1        MOVE PERCENT.
         OI    FULL+1,C'0'         FIX SIGN.
DETPUT   EQU   *
         BAL   R6,DISPLAY
         LA    R3,TLEN(,R3)        BUMP TO NEXT TABLE ENTRY.
         B     TABLUP              LOOP.
         SPACE 1
DISPLAY  EQU   *                                                    DOR
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            DOR
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                DOR
         ST    R0,QDMSGA      AND SAVE ADDRESS                      DOR
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    DOR
         BALR  R14,R15        CALL THE MOTHER                       DOR
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R6
         SPACE 1
EXIT     EQU   *
         MODESET KEY=NZERO
         SETAUTH OFF
EXIT1    QSTOP
         TITLE 'DATA RESOLUTION ROUTINES.'
NOPRES   BR    R14                 NOOP RESOLUTION ROUTINE.
PRES     L     R1,PASIZE           LOAD PRIVATE SIZE.
         ST    R1,TABLEN           SAVE IT IN TABLE.
         L     R2,PASTRT           LOAD PRIVATE START ADDRESS.
         ST    R2,TABSTART         SAVE IT IN TABLE.
         AR    R1,R2               GENERATE ...
         BCTR  R1,*-*              ... END ADDRESS.
         ST    R1,TABEND           SAVE IT IN TABLE.
         BR    R14                 RETURN.
PLPARES  L     R1,PLPAEND          LOAD END OF PLPA + 1
         LR    R15,R1              PRESERVE IT.
         L     R2,CVTLPDIA         POINT TO START OF PLPA.
         LA    R2,0(,R2)           CLEAR FLAG BYTE.
         ST    R2,TABSTART         SAVE IN TABLE.
         ST    R2,LPASTART         SAVE FOR MLPARES.
         SR    R1,R2               GENERATE LENGTH OF PLPA.
         ST    R1,TABLEN           SAVE IN TABLE.
         BCTR  R15,*-*             GENERATE END OF PLPA.
         ST    R15,TABEND          SAVE IN TABLE.
         BR    R14                 RETURN.
MLPARES  L     R1,CVTVPSA          POINT TO SYSGENED PSA.
         LA    R1,X'FFF'(,R1)      GENERATE START ...
         LA    R1,1(,R1)           ... OF MLPA AND/OR BLDL.
         L     R2,LPASTART         POINT TO START OF PLPA.
         OI    TABSTART,X'80'      TELL TABLE AREA MISSING BY DEFAULT.
         CR    R1,R2               ANY MLPA AND/OR BLDL?
         BER   R14                 RETURN IF NOT.
         ST    R1,TABSTART         SAVE START ADDRESS IN TABLE.
         LR    R15,R2              PRESERVE END ADDRESS.
         BCTR  R2,*-*              GENERATE END ADDRESS.
         ST    R2,TABEND           SAVE IN TABLE.
         SR    R15,R1              GENERATE LENGTH.
         ST    R15,TABLEN          SAVE IN TABLE.
         BR    R14                 RETURN.
SPSARES  L     R1,CVTVPSA          POINT TO SYSGENED PSA.
         ST    R1,TABSTART         SAVE IN TABLE.
         LA    R1,X'FFF'(,R1)      GENERATE END ADDRESS (+4K-1).
         ST    R1,TABEND           SAVE IN TABLE.
         BR    R14                 RETURN.
CRES     L     R15,CSAPQEP         POINT TO CSA PQE.
         USING PQESECT,R15         (TELL ASSEMBLER).
         L     R1,PQEREGN          POINT TO START OF CSA REGION.
         ST    R1,TABSTART         SAVE IN TABLE.
         L     R0,PQESIZE          LOAD LENGTH OF CSA REGION.
         ST    R0,TABLEN           SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... END ADDRESS.
         ST    R1,TABEND           SAVE IN TABLE.
         TF    AFLG                OK TO LOOK AT FETCH PROT. AREAS?
         BZR   R14                 B IF NOT.  RETURN.
         L     R4,PQEFFBQE         POINT TO FIRST FBQE.
         USING FBQESECT,R4         (TELL ASSEMBLER).
CFBQELUP CR    R15,R4              FBQE PTR POINT BACK TO PQE?
         BE    CSUB                B IF YES.  END.
         S     R0,SIZE             SUBTRACT FREE BLOCK SIZE.
         L     R4,0(,R4)           POINT TO NEXT FBQE.
         B     CFBQELUP            LOOP.
CSUB     L     R15,CSASPQEP        POINT TO LAST CSA SPQE.
         USING SPQESECT,R15        (TELL ASSEMBLER)
CSPQELUP ICM   R4,7,SPDQEPTR+1     POINT TO FIRST DQE FOR THIS SUBPOOL.
         USING DQESECT,R4          (TELL ASSEMBLER)
         BZ    CSPQEBMP            B IF NO DQES FOR THIS SUBPOOL.
CDQELUP  CLC   DQFQEPTR,=A(0)      THIS DQE DESCRIBE STORAGE?
         BE    CDQEBUMP            B IF NOT.
         L     R7,DQFQEPTR        POINT TO FIRST FQE.
         USING FQESECT,R7         TELL ASSEMBLER.
CFQELUP  LA    R7,0(,R7)         CLEAR HIGH BYTE.
         LTR   R7,R7               ANY MORE FREE AREAS?
         BZ    CDQEBUMP            B IF NOT.
         S     R0,FQELNTH          DECREMENT USED SPACE ACCUM.
         L     R7,FQEPTR           BUMP TO NEXT FQE.
         B     CFQELUP             LOOP.
CDQEBUMP ICM   R4,7,DQEPTR+1       BUMP TO NEXT DQE.
         BNZ   CDQELUP             LOOP.
CSPQEBMP TM    SPQEFLGS,LASTSPQE   THIS THE LAST SPQE?
         BO    CRESFREE            B IF YES. CALCULATE FREE SPACE.
         L     R15,SPQEAD          POINT TO PREVIOUS SPQE.
         B     CSPQELUP            LOOP.
CRESFREE ST    R0,TABFULL          SAVE CSA USED LENGTH IN TABLE.
         DROP  R15,R4,R7
         BR    R14                 RETURN.
SRES     L     R15,SQASPQEP        POINT TO SQE (SP 245) SPQE.
         USING SPQESECT,R15        (TELL ASSEMBLER)
         L     R4,SPDQEPTR         POINT TO ONLY DQE FOR THIS SUBPOOL.
         USING DQESECT,R4          (TELL ASSEMBLER)
         L     R1,DQEBLKAD         LOAD START ADDRESS OF SQA.
         ST    R1,TABSTART         SAVE IN TABLE.
         ST    R1,PLPAEND          SAVE FOR PLPARES ROUTINE.
         L     R0,DQELNTH          LOAD LENGTH OF SQA.
         ST    R0,TABLEN           SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... END ADDRESS.
         ST    R1,TABEND           SAVE IN TABLE.
         L     R7,DQFQEPTR         POINT TO FIRST FQE.
         USING FQESECT,R7          TELL ASSEMBLER.
SFQELUP  LA    R7,0(,R7)           CLEAR HIGH BYTE.
         LTR   R7,R7               ANY MORE FREE AREAS?
         BZ    SRESFREE            B IF NOT.
         S     R0,FQELNTH          DECREMENT USED SPACE ACCUM.
         L     R7,FQEPTR           BUMP TO NEXT FQE.
         B     SFQELUP             LOOP.
SRESFREE ST    R0,TABFULL          SAVE SQA USED LENGTH IN TABLE.
         DROP  R15,R4,R7
         BR    R14                 RETURN.
VRRES    L     R15,VRPQEP          POINT TO V=R PQE.
         USING PQESECT,R15         (TELL ASSEMBLER).
         L     R1,PQEREGN          POINT TO START OF V=R REGION.
         ST    R1,TABSTART         SAVE IN TABLE.
         L     R2,PQESIZE          LOAD LENGTH OF V=R REGION.
         ST    R2,TABLEN           SAVE IN TABLE.
         AR    R1,R2               GENERATE ...
         BCTR  R1,*-*              ... END ADDRESS.
         ST    R1,TABEND           SAVE IN TABLE.
         DROP  R15
         BR    R14                 RETURN.
NUCRES   L     R1,CVTNUCB          POINT PAST END OF NUC.
         BCTR  R1,*-*              GENERATE END OF NUC.
         ST    R1,TABEND           SAVE IN TABLE.
         SH    R2,=H'4095'         GENERATE NUC LENGTH.
         ST    R2,TABLEN           SAVE IN TABLE.
         BR    R14                 RETURN.
         TITLE 'SUBROUTINE(S).'
***********************************************************************
*                                                                     *
*    HEXOUT - SUBROUTINE TO GENERATE CHARACTER CODED HEXADECIMAL      *
*        FOR OUTPUT.  R1 POINTS TO THE FULLWORD TO BE TRANSLATED.     *
*        FIND OUTPUT CHARACTER RESULT IN DOUBLEWORD "WORKX."          *
*                                                                     *
***********************************************************************
         SPACE 1
HEXOUT   MVO   WORK1,0(4,R1)       GENERATE PSEUDO PACKED VALUE.
         UNPK  WORKX,WORK1+3(5)     SEPARATE NIBBLES.
         NC    WORKX,=X'0F0F0F0F0F0F0F0F' ELIMINATE ZONES.
         TR    WORKX,=C'0123456789ABCDEF' TRANSLATE TO PRINTABLE HEX.
         BR    R14                 RETURN TO CALLER.
         TITLE 'DATA AREAS.'
         SPACE 1
HEAD1    DC    C'AREA          '
HEAD1A   DC    C'START    '
HEAD1B   DC    C'END      '
HEAD1C   DC    C'LENGTH (K)  '
HEAD1D   DC    C'%FULL'
LEN      EQU   *-HEAD1
HEAD2    DC    CL51' '
         ORG   HEAD2
HEAD2A   DC    C'------------'
         ORG   HEAD2+(HEAD1A-HEAD1)
HEAD2B   DC    C'------'
         ORG   HEAD2+(HEAD1B-HEAD1)
HEAD2C   DC    C'------'
         ORG   HEAD2+(HEAD1C-HEAD1)
HEAD2D   DC    C'----------'
         ORG   HEAD2+(HEAD1D-HEAD1)
HEAD2E   DC    C'-------'
LEN2     EQU   *-HEAD2
         ORG
         SPACE 1
***********************************************************************
*                                                                     *
*    THE FOLLOWING IS A TABLE OF STORAGE AREAS TO MAP.  THE FIRST     *
*        12 BYTES OF EACH ENTRY IS THE AREA TITLE, THE NEXT WORD      *
*        IS THE AREA START ADDRESS, THE NEXT WORD IS THE LENGTH,      *
*        THE NEXT WORD IS THE END ADDRESS, THE NEXT WORD IS THE       *
*        NUMBER OF BYTES USED OR 0 AND THE LAST WORD IS THE DATA      *
*        RESOLUTION ROUTINE ADDRESS.                                  *
*                                                                     *
***********************************************************************
         SPACE 1
TABLE    DS    0A                  START OF TABLE OF AREAS.
         DC    CL12'SQA',A(0),A(0),A(0),A(0),A(SRES)
         DC    CL12'PLPA',A(0),A(0),A(0),A(0),A(PLPARES)
*        DC    CL12'FLPA',A(CVTFLPAS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
         DC    CL12'MLPA/BLDL',A(0),A(0),A(0),A(0),A(MLPARES)
         DC    CL12'SYSGEN PSA',A(0),A(4096),A(0),A(0),A(SPSARES)
         DC    CL12'CSA',A(0),A(0),A(0),A(0),A(CRES)
         DC    CL12'V=R (IF ANY)',A(0),A(0),A(0),A(0),A(VRRES)
         DC    CL12'PRIVATE',A(4096),A(0),A(0),A(0),A(PRES)
         DC    CL12'NUCLEUS',A(4096),A(0),A(0),A(0),A(NUCRES)
         DC    CL12'PSA',A(0),A(4096),A(4095),A(0),A(NOPRES)
         DC    X'00'               END OF TABLE.
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         PRINT NOGEN
         QCOMMON
         PRINT GEN
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    0F FULL WORD BOUNDARY
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
TRACESWT DS    F
SAVE     DS    9D                  SAVE AREA.
WORKX    DS    D                   WORK DOUBLEWORD.
WORK1    DS    D                   WORK DOUBLEWORD.
PLPAEND  DC    A(0)                END OF PLPA + 1 (SAVED BY SRES).
LPASTART DC    A(0)                START OF PLPA.
         SPACE 1
FLAG     DC    X'00'               VARIOUS FLAG(S).
GFLG     EQU   FLAG,B'10000000'    USER AT DISPLAY TERMINAL.
AFLG     EQU   FLAG,B'01000000'    OK TO DO MODESET.
         SPACE 3
DETAIL   EQU   QDMSG
AREA     EQU   QDMSG,12
START    EQU   QDMSG+(HEAD1A-HEAD1),8
END      EQU   QDMSG+(HEAD1B-HEAD1),8
LENGTH   EQU   QDMSG+(HEAD1C-HEAD1),10
FULL     EQU   QDMSG+(HEAD1D-HEAD1),2
WORKEND  DS    0F
         TITLE 'MAPSP - DSECTS.'
         CVT   DSECT=YES
         IHAGDA
         IHAPQE
         IHASPQE
         IHADQE
         IHAFBQE
         SPACE 1
*        IHAFQE                    MAPPING MACRO NOT ON SYSTEM.
FQESECT  DSECT                     FREE QUEUE ELEMENT.
FQETYPE  DS    AL1                 FLAG BYTE.
FQERGNFL EQU   B'10000000'         REGION FLAG.
FQECPB   EQU   B'01000000'         FREE AREA CROSSES PAGE BOUNDARY.
         ORG   FQETYPE
FQEPTR   DS    A                   PTR TO NEXT LOWER FQE.
FQELNTH  DS    A                   NUMBER OF BYTES IN FREE SPACE.
FQAREA   DS    A                   HIGH ADDRESS OF FREE SPACE.
FQERSVD  DS    A                   YOU KNOW WHAT.
         SPACE 1
TABLED   DSECT                     TABLE ENTRY MAPPING DSECT.
TABTITLE DS    CL12                TABLE ENTRY TITLE.
TABSTART DS    A                   START ADDRESS OF ENTRY'S AREA.
TABLEN   DS    A                   LENGTH OF ENTRY'S AREA.
TABEND   DS    A                   END ADDRESS OF ENTRY'S AREA.
TABFULL  DS    A                   NUMBER OF BYTES USED.
TABRES   DS    A                   ADDRESS OF RESOLUTION ROUTINE.
TLEN     EQU   *-TABLED            LENGTH OF TABLE ENTRY.
         END
./       ADD   NAME=STORAGE
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     2/21/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
STORAGE  TITLE 'QUEUE COMMAND - FRAME ASSIGN/CSA USAGE INFORMATION  '
STORAGE  QSTART ,                  START DEVIREQ DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
***********************************************************************
***       FORMERLY AND MODIFIED FOR QUEISPF                         ***
***      TITLE 'IEESF03D -   #F  DISPLAY STORAGE USAGE'
***********************************************************************
*        FRAME B/C/R/M/O
*             B           BAD FRAME REQUEST
*             C           CSA DISPLAY REQUEST
*             R           V=R DISPLAY REQUEST
*             M           MEGABYTE DISPLAY REQUEST
*             O           OFFLINE INTERCEPT REQUEST
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   - LOAD PVT ADDR
*    R4   -
*    R5   -
*    R6   -   ASVT ADDR AND ASVTENTY THEN EVERY 4 BYTES
*    R7   - MAX OF ASCBS AND DEDUCTABLE BY 1 FOR EACH ASVTENTY
*    R8   -
*    R9   -
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK    AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
*****************************************************************
         XC    OUTMSLIM(4),OUTMSLIM
         MVI   VOSWIT,X'00'        CLEAR OFFLINE SWITCH
         MVI   VBSWIT,X'00'        CLEAR BAD FRAME SWITCH
         MVC   QDMSG(80),QBLANK
         CLC   =C' ',QPARM1
         BE    PTFLIST             YES. GO PROCESS
         LA    R3,QPARM1
         CLI   0(R3),C'B'          BAD FRAME REQUEST
         BE    VBDISP              YES, GO PROCESS
         CLI   0(R3),C'C'          CSA DISPLAY REQUEST
         BE    VCDISP              YES, GO PROCESS
         CLI   0(R3),C'R'          V=R DISPLAY REQUEST
         BE    VRDISP              YES, GO PROCESS
         CLI   0(R3),C'M'          MEGABYTE DISPLAY REQUEST
         BE    VVDISP              YES, GO PROCESS
         CLI   0(R3),C'O'          OFFLINE INTERCEPT REQUEST
         BE    VODISP              YES, GO PROCESS
ERRMSG   QTILT 'PARAMETER ERROR'
         EJECT
PTFLIST  L     R14,16              LOAD CVT ADDR
         L     R6,556(0,R14)       LOAD ASVT ADDR
         L     R7,516(0,R6)        MAX NO. OF ASCBS
         ST    R7,ASCBCNT
         LA    R6,524(0,R6)        1ST ASCB SLOT
         ST    R6,ASVTPTR          SAVE POINTER
         L     R3,356(0,R14)       LOAD PVT ADDR
         L     R4,12(0,R3)         PFT APPARENT ADDR
         AH    R4,16(0,R3)         PFT ACTUAL ADDR
         SR    R5,R5               INDEX
         ICM   R5,3,18(R3)         TO END OF PFT
         SH    R5,16(0,R3)
         SRL   R5,4                DIVIDE BY 16
         STM   R4,R5,PFTREGS       SAVE PFT REGS
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE+10(26),VSHDR
* ------------------------------------------------------------------
         LH    R14,16(0,R3)        NUCLEUS FRAMES
         SRL   R14,4               DIVIDE BY 16
         AH    R14,8(0,R3)         NON-NUCLEUS FRAMES
         CVD   R14,DOUBLE          CONVERT TO DECIMAL
         MVC   QDMSG+4(12),=CL12'TOTAL'
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         ST    R14,WORKR14
         L     R2,=F'-1'
         BAL   R14,PGPRINT         GO PRINT
* ------------------------------------------------------------------
         LH    R14,16(0,R3)        NUCLEUS FRAMES
         SRL   R14,4               DIVIDE BY 16
         CVD   R14,DOUBLE          CONVERT TO DECIMAL
         MVC   QDMSG+4(12),=CL12'NUCLEUS'
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         ST    R14,WORKR14
         L     R2,=F'-1'
         BAL   R14,PGPRINT         GO PRINT
* ------------------------------------------------------------------
         LH    R14,1830(0,R3)      TOTAL FIXED
         CVD   R14,DOUBLE
         MVC   QDMSG+4(12),=CL12'TOT FIXED'
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         ST    R14,WORKR14
         L     R2,=F'-1'
         BAL   R14,PGPRINT
* ------------------------------------------------------------------
         LH    R14,1832(0,R3)      TOTAL SQA FIXED
         CVD   R14,DOUBLE
         MVC   QDMSG+4(12),=CL12'SQA FIXED'
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         ST    R14,WORKR14
         L     R2,=F'-1'
         BAL   R14,PGPRINT
* ------------------------------------------------------------------
         LH    R14,1834(0,R3)      COMMON FIXED
         CVD   R14,DOUBLE
         MVC   QDMSG+4(12),=CL12'CMN FIXED'
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         ST    R14,WORKR14
         L     R2,=F'-1'
         BAL   R14,PGPRINT
* ------------------------------------------------------------------
         L     R7,=X'0000FFFF'
         BAL   R14,PAGEPRNT        GO COUNT AND FORMAT
         EJECT
GETASCB  L     R6,ASVTPTR          LOAD POINTER TO ASVT
         LA    R6,4(0,R6)          NEXT SLOT
         ST    R6,ASVTPTR          SAVE POINTER OF ASVT
         L     R7,ASCBCNT
         BCT   R7,ASCBFND          GO PROCESS
RETURN   QSTOP
         SPACE 3
ASCBFND  ST    R7,ASCBCNT          AVAILABLE SLOT
         TM    0(R6),X'80'         AVAILABLE SLOT
         BO    GETASCB             YES, GET NEXT SLOT
         L     R8,0(0,R6)          LOAD ASCB ADDR  FROM ASVTENTY
         SR    R7,R7             LOAD
         ICM   R7,3,36(R8)  ADDRESS SPACE IDENTIFIER (ASID)
         BAL   R14,PAGEPRNT        GO COUNT AND FORMAT
         B     GETASCB
         EJECT
PAGEPRNT LM    R4,R5,PFTREGS       LOAD PFT REGS
         ST    R14,SAVER14
         SR    R14,R14             CLEAR FRAME COUNT
         SR    R2,R2               CLEAR LSQA COUNT
         SR    R0,R0               CLEAR AVAILABLE FRAME COUNT
         SPACE 3
PAGEPR1  SR    R15,R15             LOAD
         ICM   R15,3,0(R4)            PFT
         CR    R7,R15             ASID MATCH
         BNE   PAGEPR2             NO, DONT INCR FRAME COUNT
         C     R7,=X'0000FFFF'    SYS PAGES
         BNE   *+12
         TM    12(R4),X'80'        AVAILABLE PAGE
         BO    AVAILCNT            GO ADD TO AVAILABLE COUNT
         LA    R14,1(0,R14)        ADD 1 TO FRAME COUNT
         TM    12(R4),X'20'        LSQA FRAME
         BZ    PAGEPR2             NO
         LA    R2,1(0,R2)          ADD 1 T0 LSQA FRAME COUNT
         SPACE 3
PAGEPR2  LA    R4,16(0,R4)         NEXT PFT
         BCT   R5,PAGEPR1          PROCESS NEXT
         MVC   QDMSG+4(12),=CL12'ASID'
         C     R7,=X'00000001'    MASTER
         BE    ASIDMSTR            YES, GO PRINT MASTER
         C     R7,=X'0000FFFF'    SYS PAGES
         BNE   PAGEPR3             NO, ASID
         MVC   QDMSG+4(12),=CL12'SYS PAGES'
         B     PAGEPR4
PAGEEXIT L     R14,SAVER14
         BR    R14
PAGEPR3  LTR   R14,R14             ANY FRAMES
         BE    PAGEEXIT            NO, BYPASS PRINT
         STH   R7,DOUBLE+6        SAVE ASID
         UNPK  DOUBLE(5),DOUBLE+6(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   QDMSG+9(4),DOUBLE   ASID TO MSG
         SPACE 3
PAGEPR4  CVD   R14,DOUBLE
         MVC   QDMSG+15(5),=X'2020202120'
         ED    QDMSG+14(6),DOUBLE+5
         CLC   QDMSG+4(4),=C'ASID'
         BE    JOBFIND
         B     PGPRINTX
         EJECT
PGPRINT  ST    R14,SAVER14         LOAD OUTPUT MSG ADDR
         L     R14,WORKR14
PGPRINTX CVB   R14,DOUBLE
         SLL   R14,2               CHG FRAMES TO K
         CVD   R14,DOUBLE          CONVERT TO DECIMAL
         MVC   QDMSG+22(7),=X'402020202120D2'
         ED    QDMSG+22(6),DOUBLE+5
         MVI   QDMSG+32,C' '
         MVC   QDMSG+33(15),QDMSG+32
         LTR   R2,R2               LSQA/SQA COUNT
         BM    PRINT               NO
         SLL   R2,2                CHG FRAMES TO K
         CVD   R2,DOUBLE           CONVERT TO DECIMAL
         MVC   QDMSG+35(5),=C'LSQA='
         CLC   QDMSG+4(12),=CL12'SYS PAGES'
         BNE   PGPRINT1            NOT SYS PAGES
         MVC   QDMSG+35(5),=C'SQA= '
         SPACE 1
PGPRINT1 MVC   QDMSG+40(7),=X'402020202120D2'
         ED    QDMSG+40(6),DOUBLE+5
         SPACE 3
PRINT    ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         L     R14,SAVER14
         CLC   QDMSG+4(12),=CL12'SYS PAGES'
         BCR   7,R14               NOT SYS PAGES, NOT AVAILABLE
         MVC   QDMSG+4(12),=CL12'AVAILABLE'
         LR    R14,R0              AVAILABLE COUNT
         L     R2,=F'-1'
         B     PAGEPR4             GO FORMAT
         SPACE 3
AVAILCNT LA    R0,1(0,R0)          ADD 1 TO COUNT
         B     PAGEPR2
         SPACE 3
ASIDMSTR MVC   QDMSG+4(12),=CL12'MASTER'
         B     PAGEPR4
         SPACE 3
VONONE   QTILT 'NO FRAMES INTERCEPTED OFFLINE'
         SPACE 3
VBNONE   QTILT 'NO BAD FRAMES'
         EJECT
JOBFIND  EQU   *
         L     R6,56(0,R8)         CSCB ADDR
         CLI   28(R6),X'03'        INIT
         BE    JOBFIND1            YES, GO SEARCH
         SPACE
JOBFIND0 EQU   *
         MVC   QDMSG+4(8),8(R6)    JOBNAME
         MVI   QDMSG+12,C' '
         B     PGPRINTX
         SPACE
JOBFIND1 LA    R1,0(0,R6)          SAVE ADDR
         SR    R14,R14             LOAD
         ICM   R14,3,30(R6)        ASID
         SPACE
JOBFIND2 L     R6,0(0,R6)          NEXT CSCB
         LA    R6,0(0,R6)
         LTR   R6,R6               END OF CHAIN
         BNZ   JOBFIND3            NO, CONTINUE
         LR    R6,R1               USE ORIG CSCB
         B     JOBFIND0
         SPACE
JOBFIND3 CR    R6,R1               END OF CHAIN
         BE    JOBFIND0            YES, USE ORIG CSCB
         CH    R14,30(0,R6)        ASID EQUAL
         BE    JOBFIND0            YES, USE THIS CSCB
         B     JOBFIND2
         EJECT
VRDISP   MVI   VRSWIT,X'F0'        SET HDR SWITCH
         MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE(33),VRHDR1    SET 1ST HDR
         MVC   QDMSG(20),VRHDR2    SET 2ND HDR
         BAL   R7,DISPLAY         GO WTO IT
         MVI   VRSWIT,X'00'        CLEAR HDR SWITCH
         L     R14,16              CVT ADDR
         L     R3,356(0,R14)       PVT ADDR
         L     R4,12(0,R3)         PFT APPARENT ADDR
         AH    R4,20(0,R3)         PFT V=R ACTUAL ADDR
         LH    R5,22(0,R3)         INDEX TO V=R END
         SH    R5,20(0,R3)         SUBTRACT V=R START
         SRL   R5,4                NO. OF V=R PAGES
         LA    R5,1(0,R5)          ADJUST NO OF FRAMES
         MVI   VRSWIT,X'00'        CLEAR V=R END SWITCH
         MVC   QDMSG(20),VRMSG     SET UP V=R MSG BASE
         B     VRDISP3             GO PROCESS
         SPACE 3
VRDISP1  CLI   VOSWIT,X'00'        OFFLINE INTERCEPT REQUEST
         BE    VRDISP1O            NO
         TM    12(R4),X'01'        OFFLINE INTERCEPT FLAG BIT ON
         BNO   VRDISP2O            NO, NEXT PFTE
         SPACE 3
VRDISP1O CLC   0(2,R4),VRASID      ASID MATCH
         BNE   VRDISP4             NO, GO FORMAT AND PRINT
         CLC   12(0,R4),VRFLAGS    FLAGS MATCH
         BNE   VRDISP4             NO, GO FORMAT AND PRINT
         SPACE 3
VRDISP2  L     R14,VRNUM           ADD 1
         LA    R14,1(0,R14)           TO EQUAL
         ST    R14,VRNUM                 ENTRY COUNT
         SPACE 3
VRDISP2O LA    R4,16(0,R4)         NEXT PFTE
         BCT   R5,VRDISP1
         MVI   VRSWIT,X'FF'        SET END OF V=R SWITCH
         B     VRDISP4             GO FORMAT AND PRINT LAST
         SPACE 3
VRDISP3  XC    VRNUM(4),VRNUM      CLEAR COUNT
         MVC   VRFLAGS(3),12(R4)   SET FLAGS
         TM    13(R4),X'10'        IS IT A VIO FRAME?
         BO    VRNOASID            YES, NOT ASID
         MVC   VRASID(2),0(R4)     SET ASID
         B     VRDISP2
VRNOASID MVC   VRASID(2),=H'00'    SET ASID
         B     VRDISP2
         EJECT
VRDISP4  L     R14,VRNUM           NO. OF FRAMES
         CVD   R14,DOUBLE          DECIMAL
         UNPK  QDMSG(3),DOUBLE+6(2)
         OI    QDMSG+2,X'F0'
         UNPK  DOUBLE(5),VRASID(3) TRANSLATE ASID
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   QDMSG+6(4),DOUBLE PUT ASID IN MSG
         SPACE 3
VRDISP5A MVC   QDMSG+13(17),=CL17'OFFLINE   '
         TM    VRFLAGS+1,X'40'
         BO    VRDISP5B
         MVC   QDMSG+13(17),=CL17'OFFLINE INTERCEPT'
         TM    VRFLAGS,X'01'
         BO    VRDISP5B
         MVC   QDMSG+13(17),=CL17'V=R ALLOCATED    '
         TM    VRFLAGS,X'02'
         BO    VRDISP5B
         MVC   QDMSG+13(17),=CL17'V=R INTERCEPT'
         TM    VRFLAGS,X'40'
         BO    VRDISP5B
         MVC   QDMSG+13(17),=CL17'AVAILABLE '
         TM    VRFLAGS,X'80'
         BO    VRDISP5B
         MVC   QDMSG+13,=CL17'NO STATUS '
         SPACE 3
VRDISP5B MVC   QDMSG+31(15),=CL15'BAD PAGE '
         TM    VRFLAGS,X'04'
         BO    VRDISP5C
         MVC   QDMSG+31(15),=CL15'LONG TERM FIXED '
         TM    VRFLAGS,X'10'
         BO    VRDISP5C
         MVC   QDMSG+31(15),=CL15'LSQA/SQA PAGE '
         TM    VRFLAGS,X'20'
         BO    VRDISP5C
         MVC   QDMSG+31(15),=CL15'VIO PAGE '
         TM    VRFLAGS+1,X'10'
         BO    VRDISP5C
         MVC   QDMSG+31(15),=CL15'NO STATUS '
         EJECT
VRDISP5C MVC   QDMSG+48(12),=CL12'AVAILABLE '
         TM    VRFLAGS+2,X'FF'
         BZ    VRDISP5D
         MVC   QDMSG+48(12),=CL12'NOT QUEUED '
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'SQA '
         TM    VRFLAGS+2,X'C0'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'LSQA '
         TM    VRFLAGS+2,X'84'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'SQA RESERVED'
         TM    VRFLAGS+2,X'04'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'COMMON '
         TM    VRFLAGS+2,X'08'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'LOCAL '
         TM    VRFLAGS+2,X'80'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'REAL STORAGE'
         TM    VRFLAGS+2,X'10'
         BO    VRDISP5D
         MVC   QDMSG+48(12),=CL12'NO STATUS '
         SPACE 3
VRDISP5D ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         TM    VRSWIT,X'FF'        TEST HDR/END SWITCH
         BO    RETURN              END
         B     VRDISP3
         EJECT
VBDISP   MVI   VBSWIT,X'FF'        SET BAD FRAME ONLY SW
         B     VVDISP
         SPACE 3
VODISP   MVI   VOSWIT,X'FF'        SET OFFLINE INTERCEPT ONLY SW
         SPACE 3
VVDISP   MVI   VRSWIT,X'F0'        SET HDR SWITCH
         MVI   DOUBLE,X'F0'        TEST
         MVZ   DOUBLE(1),1(R3)        NUMERIC
         CLI   DOUBLE,X'F0'              MEGABYTE NUMBER
         BNE   VVDISP1             NOT NUMERIC, ERROR
         MVC   QDMSG(80),QBLANK
         MVC   QDHLINE(33),VRHDR1    1ST HDR
         MVC   QDMSG(20),VRHDR2    2ND HDR
         BAL   R11,VRDISP5D
         MVI   VRSWIT,X'00'        CLEAR HDR SWITCH
         MVC   QDMSG(20),VRMSG     BASE MSG
         B     VVDISP2
         EJECT
VVDISP1  LA    R14,RETURN
         B     PRINT
         SPACE 3
VVDISP2  IC    R5,1(0,R3)          CALCULATE
         SLL   R5,28                  PFTE INDEX
         SRL   R5,16                     TO THIS MEG
         LTR   R5,R5               ZERO MEG
         BZ    VVDISP1             YES, ERROR
         L     R14,16              CVT ADDR
         L     R3,356(0,R14)       PVT ADDR
         L     R4,12(0,R3)         PFT APPARENT ADDR
         AR    R4,R5               PFT MEG START ADDR
         SR    R1,R1
         ICM   R1,3,18(R3)         LAST FRAME INDEX
         CR    R5,R1               PAST END OF PFT
         BH    VVDISP1             YES, ERROR
         LA    R5,256              NO. OF FRAMES IN  MEG
         CLI   VOSWIT,X'00'        OFFLINE INTERCEPT REQUEST
         BNE   VODISP1             YES, CONTINUE PROCESS
         CLI   VBSWIT,X'00'        BAD FRAME REQUEST
         BNE   VBDISP1             YES, CONTINUE PROCESS
         B     VRDISP3             GO PROCESS
         SPACE 3
VODISP1  TM    12(R4),X'01'        OFFLINE INTERCEPT FLAG BIT ON
         BO    VRDISP3             YES, GO CONTINUE PROCESS
         LA    R4,16(0,R4)         NEXT PFTE
         BCT   R5,VODISP1          GO CHECK NEXT
         B     VONONE              NO INTERCEPT OFFLINE, GO MSG
         SPACE 3
VBDISP1  TM    12(R4),X'04'        BAD FRAME BIT ON
         BO    VRDISP3             YES, GO CONTINUE PROCESS
         LA    R4,16(0,R4)         NEXT PFTE
         BCT   R5,VBDISP1          GO CHECK NEXT
         B     VBNONE              NO INTERCEPT OFFLINE, GO MSG
         EJECT
VCDISP   MVC   QDHLINE(80),QBLANK
         MVC   QDHLINE+12(26),VCMSG
         L     R1,16               CVT
         L     R3,356(0,R1)        LOAD PVT ADDR
         L     R1,560(0,R1)        GDA
         LR    R6,R1               SAVE GDA ADDR
         L     R4,8(0,R6)          CSA PQE
         L     R5,0(0,R4)          1ST FBQE FOR CSA
         SR    R7,R7
         CR    R4,R5               END OF CHAIN
         BE    VCDISPB             YES
         SPACE 1
VCDISPA  A     R7,8(0,R5)          ADD FREE AREA
         L     R5,0(0,R5)          NEXT FBQE
         CR    R4,R5               END OF CHAIN
         BNE   VCDISPA             NO
         L     R5,0(0,R4)          1ST FBQE FOR CSA
         SPACE 1
CSADISP  EQU   QDMSG
VCDISPB  MVC   CSADISP(80),QBLANK
         MVC   CSADISP+4(14),=CL14'CSA SIZE ='
         L     R1,20(0,R4)         CSA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'    CSA ADDR ='
         UNPK  CSADISP+42(7),25(4,R4)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'SQA FREE ='
         L     R1,28(0,R6)         SQA AVAIL
         SR    R1,R7               SUBTRACT CSA
         BP    *+6                 IF NOT NEGATIVE, BYPASS
         SR    R1,R1
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'   SQA AVAIL ='
         L     R1,28(0,R6)         SQA AVAIL
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+41(8),=X'402020212020D240'
         ED    CSADISP+41(6),DOUBLE+5
         MVC   CSADISP+49(3),=CL4' '
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'NUC END ='
         LH    R14,16(0,R3)        NUCLEUS FRAMES
         SLL   R14,8               NUCLEUS END ADDR
         ST    R14,DOUBLE
         UNPK  CSADISP+19(7),DOUBLE+1(4)
         NC    CSADISP+19(6),=8X'0F'
         TR    CSADISP+19(6),=C'0123456789ABCDEF'
         MVC   CSADISP+25(17),=CL17'     SEG END ='
         UNPK  CSADISP+42(7),17(4,R6)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         SPACE 1
VCDISPC  STM   R4,R5,VCSASAV
         L     R4,12(0,R6)         V=R PQE
         L     R5,0(0,R4)          1ST FBQE FOR V=R
         SPACE 1
VCDISPD  MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'V=R SIZE ='
         L     R1,20(0,R4)         V=R SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'    V=R ADDR ='
         UNPK  CSADISP+42(7),25(4,R4)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         L     R15,20(0,R4)        V=R SIZE
         A     R15,24(0,R4)        DYNAMIC AREA ADDR
         ST    R15,DOUBLE
         S     R15,16(0,R6)        SUB PRIVATE AREA ORIGIN
         MVC   CSADISP+25(17),=CL17'    PRV ADDR ='
         UNPK  CSADISP+42(7),DOUBLE+1(4)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'PRV SIZE ='
         L     R1,20(0,R6)         PRIVATE AREA SIZE
         SR    R1,R15
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
*        CALL TRACE
         SPACE 1
         EJECT
VCDISP0  LM    R4,R5,VCSASAV
         L     R1,24(0,R4)         CSA ADDR
         C     R1,12(0,R5)         1ST CHUNK OF CSA FREE
         BE    VCDISP1             YES
         L     R14,12(0,R5)        1ST FREE AREA ADDR
         B     VCDISP3             GO PROCESS ALLOCATED CHUNK
         SPACE 1
VCDISP1  CR    R4,R5               END OF FBQES
         BE    RETURN              YES
         MVC   CSADISP(4),=X'00340100'
         L     R1,8(0,R5)          FREE AREA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+4(30),=CL30'FREE        SIZE='
         MVC   CSADISP+34(9),=CL9'ADDR ='
         MVC   CSADISP+22(8),=X'402020202120D240'
         ED    CSADISP+22(6),DOUBLE+5
         UNPK  CSADISP+42(7),13(4,R5)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         L     R1,OUTMSLIM
         LA    R1,1(0,R1)
         ST    R1,OUTMSLIM
         C     R1,=F'100'           200 +  LINES OF OUTPUT
         BH    RETURN               YES, THATS ALL.  AVOID SQA FILL
         EJECT
VCDISP2  L     R1,12(0,R5)         FREE AREA ADDR
         A     R1,8(0,R5)          ADD FREE AREA LENGTH
         L     R5,0(0,R5)          NEXT FBQE
         CR    R4,R5               END OF FBQES
         BE    VCDISP4             YES
         L     R14,12(0,R5)        NEXT FREE AREA ADDR
         SPACE 3
VCDISP3  SR    R14,R1
         SRL   R14,10              USED AREA LENGTH
         CVD   R14,DOUBLE
         ST    R1,DOUBLE           USED AREA ADDR
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(30),=CL30'ALLOCATED   SIZE='
         MVC   CSADISP+34(9),=CL9'ADDR ='
         MVC   CSADISP+22(8),=X'402020202120D240'
         ED    CSADISP+22(6),DOUBLE+5
         UNPK  CSADISP+42(7),DOUBLE+1(4)
         NC    CSADISP+42(6),=8X'0F'
         TR    CSADISP+42(6),=C'0123456789ABCDEF'
         MVC   CSADISP+48(4),=CL4' '
*        MVC   CSADISP+52(9),=CL9'OWNED BY '
*        L     R6,16(R5)     PQETCB
*        L     R6,0(R6)
*        L     R6,180(R6)    TCBJSCB
*        MVC   CSADISP+61(8),360(R6)  JSCBPGMNM
         ST    R7,SAVER7
         BAL   R7,DISPLAY
         L     R7,SAVER7
         B     VCDISP1
         SPACE  3
VCDISP4  L     R14,24(0,R4)        CSA ADDR
         A     R14,20(0,R4)        ADD CSA LENGTH
         B     VCDISP3
         EJECT
DISPLAY  EQU   *                                                    NTL
         STM   R0,R15,SAVEREGS
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVC   QDMSG(80),QBLANK
         LM    R0,R15,SAVEREGS
         BR    R7             RETURN TO MAINLINE...                 NTL
         EJECT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
VSHDR    DC    CL26'  CPU STORAGE USAGE'
         SPACE 3
         DS    0F
VCMSG    DC    CL26'COMMON STORAGE AREA- CSA'
         SPACE 3
         DS    0F
VRHDR1   DC    CL33'PAGES ASID    FRAME STATUS/FLAGS'
         SPACE 3
         DS    0F
VRHDR2   DC    16C'-'
         SPACE 3
         DS    0F
VRMSG    DC    CL16'   ...    ...   '
         EJECT
         IHASDWA
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
VCSASAV  DS    2F
ASCBCNT  DS    F
ASVTPTR  DS    F INCREASE BY 4 BYTES FOR EACH ASVTENTY
SAVER7   DS    F
SAVER14  DS    F
WORKR14  DS    F
PFTREGS  DS    2F
VRNUM    DS    F
VRFLAGS  DS    CL3
VRSWIT   DS    C
VOSWIT   DS    C
VBSWIT   DS    C
VRASID   DS    H
         DS    0F
OUTMSLIM DS    F
ESTAELST DS    4F
WORKEND  DS    0F
         END
./       ADD   NAME=SUINFO
*   REMODIFIED FOR ISPF QUEUE SP134
*        DAVID RIKER     2/21/86
*        COMPUTER DATA SYSTEMS INC
*        1 CURIE COURT
*        ROCKVILLE, MD 20855
*
SUINFO   TITLE 'QUEUE COMMAND - SU INFORMATION  '
SUINFO   QSTART ,                  START DEVIREQ DSECT ASSEMBLY DOR
         GBLB  &QSP           SP2 FLAG DOR
         GBLB  &QSP133        SP1.3.3 FLAG                      DOR
         GBLB  &QNERDC        NERDC FLAG                        DOR
         GBLB  &QONL          ONL FLAG                          DOR
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                         DOR
         SPACE 1
         AIF   (NOT &QACF2).$SKIP0                                ANRP*
         GBLC  &ACF2JCB                                           ANRP*
         #ACFJES2 ,                                               ANRP*
.$SKIP0  ANOP                                                     ANRP*
         USING QDISPLAY,R9        BASE REG FOR DISPLAY WORK AREA
         L     R9,QVDSPL          LOAD BASE REG
         USING WORK,R13
***********************************************************************
***********************************************************************
***       FORMERLY AND MODIFIED FOR QUEISPF                         ***
***       IEESP03D -       #P  SU CONFIGURATION                     ***
***********************************************************************
*        SU S/C/A/I
*           S           SET SU SELECT SCAN TYPE
*           C           DISPLAY CURRENT
*           A           DISPLAY ALL
*           I           DISPLAY INSTALLED
***********************************************************************
         EJECT
         MVI   TYPE,C'S'          SET SU SELECT SCAN TYPE
         CLC   =C' ',QPARM1
         BNE   SELECT              YES. GO PROCESS
         MVC   TYPE(1),QPARM1     SET SCAN TYPE
*   R3   CVT
*   R4   SMCA
*   R9   QUEUE DISPLAY
*   R7   WORK AREA
*   R13  QUEUE WORK STORAGE
SELECT   L     R3,16              CVT
         L     R4,196(0,R3)       SMCA
         LA    R7,0(0,R3)
         S     R7,=F'8'
         MVC   QDHLINE+4(48),SYSOVLY
         MVC   QDHLINE+14(4),16(R4) SYSID
         UNPK  QDHLINE+29(5),2(3,R7) CPU MODEL
         OI    QDHLINE+32,X'F0'
         MVI   QDHLINE+33,C' '
         MVC   QDHLINE+48(4),4(R7)  OPER SYSTEM LEVEL
         MVC   QDHLINE+48(1),5(R7)  OPER SYSTEM LEVEL
         MVI   QDHLINE+49,C'.'
         L     R3,1044(0,R3)      SU BITS
         LA    R4,SUTABLE-52
         LA    R8,4                NO. OF SUBIT WORDS
         EJECT
SUBIT1   L     R7,0(0,R3)          1ST WORD OF SU BITS
         SR    R6,R6
         LA    R5,32
         SPACE 1
SUBIT2   SLDL  R6,1
         LA    R4,52(0,R4)
         CLI   TYPE,C'C'           PRINT CURRENT
         BE    SUBIT5
         CLI   TYPE,C'A'           PRINT ALL
         BE    SUBIT6
         LTR   R6,R6               SU BIT ON
         BZ    SUBIT3              NO
         CLI   TYPE,C'I'           PRINT INSTALLED
         BE    SUBIT4              YES
         CLC   12(9,R4),=CL9'-OBSOLETE'
         BNE   SUBIT4
         SPACE 1
SUBIT3   BCT   R5,SUBIT2           NEXT BIT
         LA    R3,4(0,R3)          NEXT WORD
         BCT   R8,SUBIT1
         B     EXIT
         SPACE 1
SUBIT4   LA    R1,0(0,R4)          SU BIT TABLE MESSAGE
         MVC   QDMSG(80),QBLANK
         MVC   QDMSG(52),0(R1)
         BAL   R7,DISPLAY
         SR    R6,R6
         B     SUBIT3
         SPACE 1
SUBIT5   CLC   12(9,R4),=CL9'-OBSOLETE'
         BE    SUBIT3
         SPACE 1
SUBIT6   CLI   12(R4),C' '         VALID SU
         BNE   SUBIT4              YES
         B     SUBIT3
         SPACE 3
EXIT     QSTOP
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVC   QDMSG(80),QBLANK
         BR    R7             RETURN TO MAINLINE...                 NTL
         EJECT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORK)
         SPACE 3
SYSOVLY  DC    CL48'SYSTEM -  XXXX    CPU -  XXXX    VS2 REL -  XXXX'
         EJECT
SUTABLE  DC    CL4' ',CL48' '
 DC CL4' ',CL48'SU1     VTAM RELEASE 2            FMID(EVT0108)'
 DC CL4' ',CL48'SU2     -OBSOLETE-                             '
 DC CL4' ',CL48'SU3     -OBSOLETE-                             '
 DC CL4' ',CL48'SU4     SCHEDULER IMPROVEMENTS                 '
 DC CL4' ',CL48'SU5     SUPERVISOR PERF. # 1                   '
 DC CL4' ',CL48'SU6     -OBSOLETE-                             '
 DC CL4' ',CL48'SU7     SUPERVISOR PERF. # 2                   '
 DC CL4' ',CL48'SU8     DATA MANAGEMENT                        '
 DC CL4' ',CL48'SU9     SAM-E  5740-AM3    (PP)   FMID(JDM1112)'
 DC CL4' ',CL48'SU10    3800 SUPPORT                           '
 DC CL4' ',CL48'SU11    TSO CMD 5740-XT6   (PP)   FMID(JBB1112)'
 DC CL4' ',CL48'SU12    -OBSOLETE-                             '
 DC CL4' ',CL48'SU13    -OBSOLETE-                             '
 DC CL4' ',CL48'SU14    -OBSOLETE-                             '
 DC CL4' ',CL48'SU15    -OBSOLETE-                             '
 DC CL4' ',CL48'SU16    SCHEDULER/IOS SUPPORT                  '
 DC CL4' ',CL48'SU17    SERVICE DATA IMPROV.                   '
 DC CL4' ',CL48'SU18    -OBSOLETE-                             '
 DC CL4' ',CL48'SU19    -OBSOLETE-                             '
 DC CL4' ',CL48'SU20    -OBSOLETE-                             '
 DC CL4' ',CL48'SU21    -OBSOLETE-                             '
 DC CL4' ',CL48'SU22    -OBSOLETE-                             '
 DC CL4' ',CL48'SU23    JES2 NJE3 5740-XR8 (PP)   FMID(JJE1112)'
 DC CL4' ',CL48'SU24    3850 MSS R3 IMPROVMENTS   FMID(EMS1102)'
 DC CL4' ',CL48'SU25    JES2 R4.1                 FMID(EJE1102)'
 DC CL4' ',CL48'SU26    JES3 R3                   FMID(EJS1102)'
 DC CL4' ',CL48'SU27    EREP                                   '
 DC CL4' ',CL48'SU28                                           '
 DC CL4' ',CL48'SU29    3838 SUPPORT                           '
 DC CL4' ',CL48'SU30    3895 SUPPORT                           '
 DC CL4' ',CL48'SU31                                           '
 DC CL4' ',CL48'SU32    RACF                                   '
 DC CL4' ',CL48'SU33    DUMP IMPROVEMENTS                      '
 DC CL4' ',CL48'SU34    ACF/VTAM 5735-RC2  (PP)   FMID(JVT1122)'
 DC CL4' ',CL48'SU35    ACF/VTAM 5735-RC2  (PP)   FMID(JVT1112)'
 DC CL4' ',CL48'SU36    TCAM 10  NCP/VS DIRECT    FMID(ETC0108)'
 DC CL4' ',CL48'SU37    SSS R5                    FMID(ESS1102)'
 DC CL4' ',CL48'SU38                                           '
 DC CL4' ',CL48'SU39    CRYPT0   5740-XY5  (PP)   FMID(HCR1102)'
 DC CL4' ',CL48'SU40    ACF/VTAM SCP              FMID(EVT1102)'
 DC CL4' ',CL48'SU41    DASDR              (PP)   FMID(JDS1112)'
 DC CL4' ',CL48'SU42    3800 OFFL 5748-UT2 (PP)   FMID(JUT1112)'
 DC CL4' ',CL48'SU43    -OBSOLETE-                             '
 DC CL4' ',CL48'SU44    ACF/TCAM 5735-RC1  (PP)   FMID(JCT1122)'
 DC CL4' ',CL48'SU45    NOSP  5734-XX2     (PP)   FMID(HNO1102)'
 DC CL4' ',CL48'SU46    ACF/TCAM 5735-RC1  (PP)   FMID(JTC1112)'
 DC CL4' ',CL48'SU47    -OBSOLETE-                             '
 DC CL4' ',CL48'SU48    3800 12 LINES/INCH                     '
 DC CL4' ',CL48'SU49    -OBSOLETE-                             '
 DC CL4' ',CL48'SU50    MVS/SE R1 5740-XE1 (PP)   FMID(JBB1122)'
 DC CL4' ',CL48'SU51    PROCESSOR SUPPORT # 1                  '
 DC CL4' ',CL48'SU52    -OBSOLETE-                             '
 DC CL4' ',CL48'SU53    RMF2 R2.0 5740-XY4 (PP)   FMID(HRM2205)'
 DC CL4' ',CL48'SU54    ACF/VTAM CRYPTO    (PP)   FMID(JVT1132)'
 DC CL4' ',CL48'SU55    HARDWARE RECOVERY IMP.                 '
 DC CL4' ',CL48'SU56    VPSS   5744-CK1    (PP)   FMID(EVP1102)'
 DC CL4' ',CL48'SU57    IPCS                      FMID(EIP1102)'
 DC CL4' ',CL48'SU58    TSO/VTAM LEVEL 2          FMID(ETV0108)'
 DC CL4' ',CL48'SU59    ACF/TCAM SCP  TCAM11      FMID(ETC1102)'
 DC CL4' ',CL48'SU60    DATA MANAGEMENT SUPPORT                '
 DC CL4' ',CL48'SU61    RMF2 R2.2 5740-XY4 (PP)   FMID(HRM2204)'
 DC CL4' ',CL48'SU62    RACF V1 R3         (PP)   FMID(HRF1302)'
 DC CL4' ',CL48'SU63    -OBSOLETE-                             '
 DC CL4' ',CL48'SU64    PROCESSOR SUPPORT # 2                  '
 DC CL4' ',CL48'SU65    MVS/SE WITH SU64                       '
 DC CL4' ',CL48'SU66    HSM SUPPED BY SU99 (PP)   FMID(HHM1102)'
 DC CL4' ',CL48'SU67    SMP4                                   '
 DC CL4' ',CL48'SU68    DEMF                      FMID(EDE1102)'
 DC CL4' ',CL48'SU69                                           '
 DC CL4' ',CL48'SU70                                           '
 DC CL4' ',CL48'SU71                                           '
 DC CL4' ',CL48'SU72    AMS CRYPT 5740-AM8 (PP)   FMID(JDM1122)'
 DC CL4' ',CL48'SU73                                           '
 DC CL4' ',CL48'SU74                                           '
 DC CL4' ',CL48'SU75                                           '
 DC CL4' ',CL48'SU76                                           '
 DC CL4' ',CL48'SU77                                           '
 DC CL4' ',CL48'SU78    TSO SESION MANAGER (PP)   FMID(HTS1202)'
 DC CL4' ',CL48'SU79                                           '
 DC CL4' ',CL48'SU80                                           '
 DC CL4' ',CL48'SU81                                           '
 DC CL4' ',CL48'SU82                                           '
 DC CL4' ',CL48'SU83                                           '
 DC CL4' ',CL48'SU84    DEVICE SUPPORT FACILITY                '
 DC CL4' ',CL48'SU85                                           '
 DC CL4' ',CL48'SU86                                           '
 DC CL4' ',CL48'SU87                                           '
 DC CL4' ',CL48'SU88                                           '
 DC CL4' ',CL48'SU89                                           '
 DC CL4' ',CL48'SU90                                           '
 DC CL4' ',CL48'SU91                                           '
 DC CL4' ',CL48'SU92                                           '
 DC CL4' ',CL48'SU93                                           '
 DC CL4' ',CL48'SU94                                           '
 DC CL4' ',CL48'SU95    RMF SPPTZ (MVS/SE) (PP)                '
 DC CL4' ',CL48'SU96    RMF SPPTZ (NON/SE) (PP)                '
 DC CL4' ',CL48'SU97                                           '
 DC CL4' ',CL48'SU98                                           '
 DC CL4' ',CL48'SU99    HSM                (PP)   FMID(HHM1202)'
 DC CL4' ',CL48'SU100                                          '
 DC CL4' ',CL48'SU101                                          '
 DC CL4' ',CL48'SU102                                          '
 DC CL4' ',CL48'SU103                                          '
 DC CL4' ',CL48'SU104                                          '
 DC CL4' ',CL48'SU105                                          '
 DC CL4' ',CL48'SU106                                          '
 DC CL4' ',CL48'SU107                                          '
 DC CL4' ',CL48'SU108                                          '
 DC CL4' ',CL48'SU109                                          '
 DC CL4' ',CL48'SU110                                          '
 DC CL4' ',CL48'SU111                                          '
 DC CL4' ',CL48'SU112                                          '
 DC CL4' ',CL48'SU113                                          '
 DC CL4' ',CL48'SU114                                          '
 DC CL4' ',CL48'SU115                                          '
 DC CL4' ',CL48'SU116                                          '
 DC CL4' ',CL48'SU117                                          '
 DC CL4' ',CL48'SU118                                          '
 DC CL4' ',CL48'SU119                                          '
 DC CL4' ',CL48'SU120                                          '
 DC CL4' ',CL48'SU121                                          '
 DC CL4' ',CL48'SU122                                          '
 DC CL4' ',CL48'SU123                                          '
 DC CL4' ',CL48'SU124                                          '
 DC CL4' ',CL48'SU125                                          '
 DC CL4' ',CL48'SU126                                          '
 DC CL4' ',CL48'SU127                                          '
         EJECT
         IHASDWA
         EJECT
*
* DYNAMIC WORK AREA FOR PROGRAM
*
* DOR
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
         DS    0D
SAVRET   DS    F
TYPE     DS    F
         SPACE 3
WORKEND  EQU   *
         END
./       ADD   NAME=SYSJOB
SYSJOB   TITLE 'QUEUE COMMAND - LIST ALL SPOOL DSETS FOR A JOB'   ONL01
SYSJOB   QSTART HASPEQU=YES,       START SYSJOB CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE CMD - LIST JOBLOG MESSAGES FOR A JOB'
         GBLB  &QSP           SP V1.3.X OPTION                    UF046
         GBLB  &QSP133        SP V1.3.3 OPTION                    UF046
         GBLB  &QSP136        SP V1.3.6 OPTION FLAG                DOR
         GBLB  &QJTIP         JTIP OPTION                         ONL05
         GBLB  &QONL          ENABLES ONL SPECIFIC CODE           ONL06
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING QDISPLAY,R9    BASE REG FOR CKPT WORK AREA
         L     R9,QVDSPL      LOAD BASE REG
         USING WORK,R13
***********************************************************************
*                                                                     *
*   DECIDE IF PURE SJOB OR REPOS COMMANDS                             *
*                                                                     *
***********************************************************************
         OI    QFLAG2,Q2SYSJOB    TURN ON LISTDSR PROCESS DOR05
         CLC   QCODEH,=H'00'      IS THE FUNCTION SUPPORTED?
         BH    REPOSCMD
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
SYSJOBL  L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QAJLOG            PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
         B     GO
***********************************************************************
*                                                                     *
*   BRANCH TO PROPER ROUTINE                                          *
*                                                                     *
***********************************************************************
REPOSCMD CLC   QCODEH,=H'36'  MODEL 2/5 COMMAND?                  UF003
         BE    MODEL          OK IF NO DATASET                    UF003
         SPACE 1                                                  UF003
CHKID    CLC   QPDSID,=H'0'   IS THERE A VALID DATASET?
         BNE   GO             YES. GO AHEAD TO PRINT DATASETS
         QTILT '*** YOU ARE NOT PROCESSING A VALID DATASET ***'
GO       LH    R1,QCODEH      LOAD FUNCTION CODE
         CH    R1,=H'40'      IS THE FUNCTION SUPPORTED?
         BH    STOP           NO. RETURN.
         B     *+4(R1)        BRANCH TO ROUTINE
         B     SYSJOBB        0 OFFSET
         B     FIND           4
         B     FINDTIME       8
         B     COLUMN         12
         B     AT             16
         B     PLUS           20
         B     MINUS          24
         B     TOP            28
         B     BOTTOM         32
         B     MODEL          36
         B     NEXT           40
TILT     QTILT '*** PARAMETER IS INVALID OR OMITTED ***'
***********************************************************************
*                                                                     *
*   REPOSITION VERTICALLY                                             *
*                                                                     *
***********************************************************************
* SKIP FORWARD
PLUS     CLI   QPARM1,C' '    DEFAULT NEEDED
         BNE   PLUS010        NO
         MVI   QLNG1+1,X'01'  YES, SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET DEFAULT TO 1
PLUS010  BAL   R4,NUMERIC     VALIDATE PARAMETER
         AP    QPREC,COUNT    ADD COUNT TO CURRENT RECORD
         B     RESUME         CALL LISTDS
* SKIP BACKWARD
MINUS    CLI   QPARM1,C' '    DEFAULT NEEDED
         BNE   MINUS010       NO
         MVI   QLNG1+1,X'01'  YES, SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET DEFAULT TO 1
MINUS010 BAL   R4,NUMERIC     VALIDATE PARAMETER
         SP    QPREC,COUNT    SUBTRACT COUNT FROM CURRENT RECORD
         BP    RESUME         CALL LISTDS IF RESULT POSITIVE.
* TOP OF DATASET
TOP      ZAP   QPREC,=P'1'    SET CURRENT RECORD TO TOP OF DS
* RESUME AT CURRENT RECORD
RESUME   BAL   R8,LISTDSRS
         CLI   QCODE,0        LAST REQUEST WAS BOTTOM?
         BE    STOP0          CONTINUE ON NEXT  REPOSITION COMMAND
         CLI   QCODE,32       LAST REQUEST WAS BOTTOM?
         BNE   STOP           CONTINUE ON NEXT  REPOSITION COMMAND
NEXT     EQU   *              NEXT DATASET REQUEST
         MVI   QCODE,0        IF QCODE IS 32 PREVENT LOOPING
         ZAP   QPREC,=P'1'    SET CURRENT RECORD TO TOP OF DS
STOP0    L     R8,QDWORD      ENTER CURRENT ADDRESS OF BRANCHED LISTDS
         LTR   R8,R8
         BZ    STOP           NO RETURN ADDRESS
         MVC   QDREPLY,=CL8'SJOB'   CONTINUED SJOB COMMAND
         BR    R8             CONTINUE ON NEXT DATASET
* BOTTOM OF DATASET
BOTTOM   ZAP   QPREC,=P'9999999' SET CURRENT RECORD TO LARGEST
         B     RESUME         CALL LISTDS
* POSITION TO THIS RECORD
AT       BAL   R4,NUMERIC     VALIDATE PARAMETER
         ZAP   QPREC,COUNT    INDICATE REPOSITION NO
         B     RESUME         CALL LISTDS
* CHECK THE PARMETER FOR VALID NUMERIC AND PACK IT
NUMERIC  LH    R2,QLNG1       LENGTH OF PARM
         SH    R2,=H'1'       IS THE COUNT FIELD ZERO?
         BM    RESUME         YES. RESUME FROM CURRENT POSITION.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC CHECK
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. TILT.
         EX    R2,PACK        PACK THE FIELD INTO COUNT
         CLI   QSUBNAME,C'P'  ?/PAGE FORWARD/BACKWARD SPECIFIED
         BE    FOUNDP         YES. GO PROCESS
         CLI   QSUBNAME,C'H'  ?/HALF PAGE FORWARD/BACKWARD SPECIFIED
         BNE   NEXIT          NO. GO TO EXIT
         MP    COUNT,QDLNES   YES. MULTIPLY BY PAGE SIZE          UF003
         DP    COUNT,=P'2'    AND CONVERT TO HALF PAGES           UF003
         ZAP   COUNT,COUNT(7) RE-ALIGN THE STUPID FIELD           UF003
         B     NEXIT
FOUNDP   MP    COUNT,QDLNES   YES. MULTIPLY BY PAGE SIZE          UF003
NEXIT    BR    R4             RETURN
* EXECUTED INSTRUCTIONS
MVZ      MVZ   QFZONES(1),QPARM1 CHECK FOR NUMERIC
PACK     PACK  COUNT,QPARM1(1) PACK COUNT
***********************************************************************
*                                                                     *
*   REPOSITION HORIZONTALLY                                           *
*                                                                     *
***********************************************************************
COLUMN   CLI   QPARM1,C' '    ?/DEFAULT NEEDED
         BE    COL010         YES, GO SET IT
         CLI   QPARM1,C'0'    ?/SET COLUMN TO 1
         BNE   COL020         NO, TEST IF NUMERIC
COL010   MVI   QLNG1+1,X'01'  SET LENGTH OF PARM
         MVI   QPARM1,X'F1'   SET COLUMN TO 1
COL020   BAL   R4,NUMERIC     VALIDATE PARAMETER
         CP    COUNT,=P'255'  IS THE COUNT FIELD TOO BIG?
         BH    TILT           YES. TILT.
         SP    COUNT,=P'1'    COLUMN RELATIVE TO ZERO
         BM    TILT           INVALID. TILT.
         CVB   R5,COUNT       CONVERT TO BINARY
         STH   R5,QPOFFSET    STORE IN QPOFFSET
         B     RESUME         CALL LISTDS
***********************************************************************
*                                                                     *
*   LOCATE SPECIFIC RECORD                                            *
*                                                                     *
***********************************************************************
FIND     CLI   QSUBNAME+1,C'A' IS THE REQUEST FOR FIND ALL?
         BE    FIND2          YES. DO NOT UPDATE RECORD POINTER.
         AP    QPREC,=P'1'    START SEARCH AT NEXT RECORD
FIND2    CLI   QPARM1,C' '    IS THERE A PARAMETER?
         BE    RESUME         NO. CONTINUE WITH PREVIOUS FIND.
         LA    R2,QDREPLY+62  END OF USER REPLY
         LA    R3,61          MAXIMUM LENGTH OF PARM
         SH    R3,QOFF1       OFFSET TO FIRST PARM
         AIF   (NOT &QONL).SKPONL1                                ONL12
         CLI   QPARM1,C'/'         DO 'OLD TIME' SCAN IF FIRST    ONL12
         BE    LOOP                 CHARACTER IS A SLASH          ONL12
.SKPONL1 ANOP  ,                                                  ONL12
         CLI   QPARM1,C''''        DO 'OLD TIME' SCAN IF FIRST    CL002
         BE    LOOP                 CHARACTER IS AN APOSTROPHE    CL002
         CLI   QPARM1,C'"'           OR IF THE FIRST CHARACTER    ONL13
         BE    LOOP                   IS A DOUBLE QUOTE           ONL13
         LA    R2,QDREPLY+1         FIRST POSSIBLE ADDR OF REPLY  CL002
         AH    R2,QOFF1            ADDR OF SECOND BYTE OF REPLY   CL002
         SPACE 1                                                  CL002
LOOPNA   CLI   0(R2),C' '          LOOK FOR FIRST BLANK           CL002
         BE    FOUNDNA             BR WHEN FOUND                  CL002
         LA    R2,1(,R2)           EXAMINE NEXT CHARACTER         CL002
         BCT   R3,LOOPNA           KEEP LOOKING IF POSSIBLE       CL002
         B     TILT                END IF TOO LONG                CL002
FOUNDNA  LR    R3,R2               ADDR OF FIRST BLANK            CL002
         LA    R2,QDREPLY          ADDR OF FIRST POSSIBLE CHAR    CL002
         AH    R2,QOFF1            ACTUAL ADDR OF FIRST NON-BLANK CL002
         SR    R3,R2               LENGTH OF STRING               CL002
         BCTR  R3,0                MACHINE LENGTH OF STRING       CL002
         B     FOUNDNA2            RE-JOIN LOGIC                  CL002
LOOP     CLC   0(1,R2),QPARM1 IS THIS THE DELIMITER?
         BE    FOUND          YES. CONTINUE.
         BCTR  R2,0           TRY THE PREVIOUS BYTE
         BCT   R3,LOOP        IS THE LENGTH FIELD EXHAUSTED?
         B     TILT           YES. TILT.
FOUND    BCTR  R3,0           DECREMENT LENGTH BY 1
         LA    R2,QDREPLY+1   ADDR OF REPLY + 1
         AH    R2,QOFF1       ADDR OF FIRST BYTE OF PARM
FOUNDNA2 DS    0H                                                 CL002
         EX    R3,MVC         MOVE PARM TO QPFIND
         STH   R3,QPLNG       SAVE LENGTH-1 OF PARM
         B     COLTEST        TEST IF COLUMN KEYWORD IS PRESENT
MVC      MVC   QPFIND(1),0(R2) MOVE PARM TO QPFIND
***********************************************************************
*                                                                     *
*    COLUMN RANGE FOR FIND                                            *
*                                                                     *
***********************************************************************
COLTEST  XC    QOFFS,QOFFS    RESET COLUMN OFFSETS
         XC    QOFFE,QOFFE
         LA    R2,3(R2,R3)    PREPARE FOR NEXT FIELD
         LA    R3,QDREPLY+55  END OF USER REPLY
         SPACE 1                                                  ONL13
         AIF   (NOT &QONL).SKPONL2                                ONL12
         CLI   QPARM1,C'/'         WERE DELIMITER CHARS USED?     ONL12
         BE    DLMUSED             SKIP IF YES                    ONL12
.SKPONL2 ANOP  ,                                                  ONL12
         CLI   QPARM1,C''''        WERE DELIMITER CHARS USED?     ONL13
         BE    DLMUSED             SKIP IF YES                    ONL13
         CLI   QPARM1,C'"'         WERE DELIMITER CHARS USED?     ONL13
         BE    DLMUSED             SKIP IF YES                    ONL13
         BCTR  R2,0                ACCOUNT FOR MISSING DELIMITERS ONL13
DLMUSED  DS    0H                                                 ONL13
         SPACE 1                                                  ONL13
LOOP1    CLC   0(3,R2),=CL3'COL'  ?/COLUMN PARAMETER
         BE    FOUNDA         YES. GO PROCESS
         LA    R2,1(R2)       NO. LOOK AT NEXT FIELD
         CR    R2,R3          ?/END OF REPLY
         BH    RESUME         YES. EXIT
         B     LOOP1          NO. CHECK AGAIN
FOUNDA   LA    R2,3(R2)       NEXT FIELD
         CLI   0(R2),C'('     ?/LP PRESENT
         BNE   PRESUME        NO. EXIT
         LA    R2,1(R2)       NEXT FIELD
         LA    R3,QDREPLY+62  END OF REPLY
         LR    R5,R2          SAVE START OF THIS FIELD
         MVI   QDELIMIT,C','  LOOKING FOR DELIMITER = ','
         BAL   R7,CHKDEL      GO CHECK THE DELIMITER
         CVB   R6,COUNT       CONVERT START COLUMN OFFSET TO BINARY
         LTR   R6,R6          ?/USER SPECIFY OFFSET OF ZERO
         BZ    PRESUME        YES. GO INDICATE AN ERROR
         BCTR  R6,0           DECREMENT OFFSET BY 1
         STH   R6,QOFFS       SAVE START COLUMN
         LA    R2,1(R2)       NEXT FIELD
         LR    R5,R2          SAVE START OF THIS FIELD
         MVI   QDELIMIT,C')'  LOOKING FOR DELIMITER = ')'
         BAL   R7,CHKDEL      GO CHECK THE DELIMITER
         CVB   R6,COUNT       CONVERT END COLUMN OFFSET TO BINARY
         LTR   R6,R6          ?/USER SPECIFY OFFSET OF ZERO
         BZ    PRESUME        YES. GO INDICATE AN ERROR
         BCTR  R6,0           DECREMENT OFFSET BY 1
         STH   R6,QOFFE       SAVE END COLUMN
         CLC   QOFFS,QOFFE    ?/ERROR IN COLUMN SPECIFICATION
         BNL   PRESUME        YES. DISREGARD COLUMN SEARCH
         B     RESUME         NO. CONTINUE WITH NORMAL PROCESSING
CHKDEL   CLC   0(1,R2),QDELIMIT ?/DELIMITER FOUND
         BE    CHK010         YES. GO PROCESS
         LA    R2,1(R2)       NO. LOOK AT NEXT FIELD
         CR    R2,R3          ?/END OF REPLY
         BH    PRESUME        YES. EXIT
         B     CHKDEL         NO. CHECK AGAIN
CHK010   LR    R4,R2          SAVE DELIMITER ADDRESS
         SR    R4,R5          LENGTH OF SUB-PARM
         CH    R4,=H'3'       ?/LENGTH TO LONG
         BNL   PRESUME        YES. DISREGARD COLUMN SEARCH
         BCTR  R4,0           LENGTH FOR EXEC INTRUCTION
         MVC   QFZONES,QFZONE  NUMERIC TEST
         EX    R4,MVZ1
         CLC   QFZONES,QFZONE ?/FIELD NUMERIC
         BNE   TILT           NO. EXIT WITH ERROR MESSAGE
         EX    R4,PACK1
         BR    R7
PRESUME  XC    QOFFS,QOFFS    DISREGARD FIND
         XC    QOFFE,QOFFE       BY COLUMN RANGE
         QTILT ' *** ERROR IN COLUMN SPECIFICATION ***'
MVZ1     MVZ   QFZONES(1),0(R5)
PACK1    PACK  COUNT,0(1,R5)
***********************************************************************
*                                                                     *
*   REPOSITION IN SYSLOG DATASET BY TIME OF DAY                       *
*                                                                     *
***********************************************************************
FINDTIME CLI   QPARM1,C' '    IS THE PARM OMITTED?
         BE    TILT           YES. TILT.
         B     RESUME         CALL LISTDS
         EJECT                                                    UF003
******************************************************************UF003
*                                                                 UF003
*   SWITCH MODEL TYPE FOR 3270 TERMINAL                           UF003
*                                                                 UF003
******************************************************************UF003
MODEL    DS    0H             ,                                   UF003
         BAL   R4,NUMERIC     VALIDATE PARAMETER                  UF003
         CP    COUNT,=P'2'    MODEL 2?                            UF003
         BE    MODEL2         YES, BRANCH                         UF003
         CP    COUNT,=P'3'    MODEL 3?                            UF003
         BE    MODEL3         YES, BRANCH                         UF003
         CP    COUNT,=P'4'    MODEL 4?                            UF003
         BE    MODEL4         YES, BRANCH                         UF003
         CP    COUNT,=P'5'    MODEL 5?                            UF003
         BE    MODEL5         YES, BRANCH                         UF003
         QTILT 'UNSUPPORTED MODEL TYPE'                           UF003
         SPACE 1                                                  UF003
MODEL2   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'21'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'21'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'21'                           UF043
         MVC   QDSCRLEN,=AL2(21*80) SCREEN LENGTH                 UF003
         MVC   QDSCRPLN,=AL2(21*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'F5'       ERASE/WRITE                    UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'5CF0'    (24,1)                         UF003
         MVC   QDSCRO4,=X'5DF7'    (24,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=24    SET SCREEN SIZE FOR VTAM       UF003
         SPACE 1                                                  UF003
MODELN   CLC   QPDSID,=H'0'        IS THERE A DATASET?            UF003
         BNE   RESUME              YES, CALL LISTDS               UF003
         MVC   QDHLINE,=CL80' '    BLANK HEADING LINE             UF003
         B     STOP                AND RETURN                     UF003
         SPACE 1                                                  UF003
MODEL3   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'29'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'29'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'29'                           UF043
         MVC   QDSCRLEN,=AL2(29*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(29*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'E6F0'    (32,1)                         UF003
         MVC   QDSCRO4,=X'E7F7'    (32,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=32    SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL4   MVC   QDLNELEN,=H'80'     LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'40'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'40'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'40'                           UF043
         MVC   QDSCRLEN,=AL2(40*80)  SCR LENGTH                   UF003
         MVC   QDSCRPLN,=AL2(40*80+QDLINE1-QDSCREEN) TPUT LEN     UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C150'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F460'    (43,1)                         UF003
         MVC   QDSCRO4,=X'F5E7'    (43,72)                        UF003
         MVC   QDSCRO5,=X'C260'    (3,1)                          UF003
         STSIZE SIZE=80,LINE=43    SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         SPACE 1                                                  UF003
MODEL5   MVC   QDLNELEN,=H'132'    LINE LENGTH                    UF003
         MVC   QDLNES,=PL2'24'     LINES PER SCREEN AREA          UF003
         MVC   QDPFKTAB+6*8+6(2),=C'24'                           UF043
         MVC   QDPFKTAB+7*8+6(2),=C'24'                           UF043
         MVC   QDSCRLEN,=AL2(24*132)  SCR LENGTH                  UF003
         MVC   QDSCRPLN,=AL2(24*132+QDLINE1-QDSCREEN) TPUT LEN    UF003
         MVI   QDSCRO1,X'7E'       ERASE/WRITE ALTERNATE          UF003
         MVC   QDSCRO2,=X'C2C4'    (2,1)                          UF003
         MVC   QDSCRO3,=X'F5E8'    (27,1)                         UF003
         MVC   QDSCRO4,=X'F66F'    (27,72)                        UF003
         MVC   QDSCRO5,=X'C4C8'    (3,1)                          UF003
         STSIZE SIZE=132,LINE=27   SET SCREEN SIZE FOR VTAM       UF003
         B     MODELN              JOIN COMMON CODE               UF003
         EJECT                                                    UF003
******************************************************************ONL05
*                                                                 ONL05
*   FIND JOB LOG PDDB                                             ONL05
*                                                                 ONL05
******************************************************************ONL05
SYSJOBB  EQU   *
         SPACE 1                                                  ONL05
         AIF   (NOT &QSP136).NO136A                               DOR
         USING PDB,R2              BASE REG FOR PDDB              DOR
         USING IOT,R3              BASE REG FOR IOT               DOR
         L     R3,QCIOTA           LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOT)     ADJUST FOR HEADER        DOR
         AGO   .X136A                                             DOR
.NO136A  ANOP                                                     DOR
         USING PDBDSECT,R2         BASE REG FOR PDDB
         USING IOTDSECT,R3         BASE REG FOR IOT               UF046
         L     R3,QCIOTA           LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
.X136A   ANOP                                                     DOR
         SPACE 1                                                  ONL03
         CLC   IOTID,=CL4'IOT'     WAS AN IOT READ FROM SPOOL?    ONL03
         BNE   BADIOT              ERROR IF NO                    ONL03
         CLC   QPJOBID,IOTJBKEY    IS THE IOT'S JOB KEY VALID?    ONL03
         BNE   BADIOT              ERROR IF NO                    ONL03
         SPACE 1                                                  ONL03
         LR    R4,R3               COPY IOT ADDR                  ONL03
         A     R4,IOTPDDBP         OFFSET BEYOND LAST PDDB
         LR    R2,R3               BASE OF IOT
         AIF   (NOT &QSP133).C29A                                 UF046
         A     R2,IOTPDDB          OFFSET TO FIRST PDDB IN IOT    UF046
         AGO   .C29B                                              UF046
.C29A    ANOP  ,                                                  UF046
         A     R2,QCPDDB1          OFFSET TO FIRST PDDB IN JOT
.C29B    ANOP  ,                                                  UF046
FINDDS   CLC   PDBDSKEY,=H'2'      IS THIS THE JOB LOG
         BE    FOUNDDS             YES. CONTINUE.
         LA    R2,PDBLENG(R2)      NO. LOOK AT NEXT PDDB
         CR    R2,R4               HAVE WE GONE PAST THE LAST PDDB
         BL    FINDDS              NO. TRY AGAIN
         B     NOJLPDDB            ERROR IF JOB LOG PDDB NOT FOUNDONL05
         SPACE 1                                                  ONL05
FOUNDDS  DS    0H                  SYSJOB PDDB HAS BEEN FOUND     ONL05
         SPACE 2                                                  ONL05
******************************************************************ONL05
*                                                                 ONL05
*  THE JOBLOG IS CONSIDERED AVAILABLE IF:                         ONL05
*                                                                 ONL05
*     (1) IF THE JOBLOG HAS MORE THAN ONE LINE OF OUTPUT.         ONL05
*     (2) THE JOB IS ON THE OUTPUT OR HARDCOPY QUEUES.            ONL05
*     (3) THE JOB IS NOT ON THE INPUT OR CONVERSION QUEUES.       ONL05
*     (4) THE CONVERTER RETURN CODE IS NON-ZERO.                  ONL05
*     (5) IF THE &QJTIP OPTION IS OFF AND THE JOB'S EXECUTION     ONL05
*         START TIME (JCTXEQON) IS NON-ZERO.                      ONL05
*                                                                 ONL05
*  OTHERWISE, THE JOBLOG IS CONSIDERED NOT AVAILABLE.             ONL05
*                                                                 ONL05
******************************************************************ONL05
         SPACE 1                                                  ONL05
         CLC   PDBRECCT,=F'2'      ARE WE SURE JOB LOG HAS INFO ? ONL05
         BH    LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
         SPACE 1                                                  ONL05
         L     R4,QCJQEA           ADDR OF JQE                    ONL05
         AIF   (NOT &QSP136).NO136B                               DOR
         USING JQE,R4             NOTE JQE ADDRESSABILITY         DOR
         AGO   .X136B                                             DOR
.NO136B  ANOP                                                     DOR
         USING JQEDSECT,R4         NOTE JQE ADDRESSABILITY        ONL05
.X136B   ANOP                                                     DOR
         SPACE 1                                                  ONL05
         CLI   JQETYPE,$OUTPUT     IT'S OK TO                     ONL05
         BE    LOGOK                LIST THE JOBLOG               ONL05
         CLI   JQETYPE,$HARDCPY      IF THE JOB IS ON THE         ONL05
         BE    LOGOK                  OUTPUT OR HARDCOPY QUEUES   ONL05
         SPACE 1                                                  ONL05
         CLI   JQETYPE,$INPUT      DON'T LIST THE                 ONL05
         BE    NOLOG                JOBLOG IF THE JOB             ONL05
         CLI   JQETYPE,$XEQ          IS ON THE INPUT              ONL05
         BE    NOLOG                  OR CONVERSION QUEUES        ONL05
         SPACE 1                                                  ONL05
         L     R3,QCJCTA           ADDR OF JCT                    ONL05
         AIF   (NOT &QSP136).NO136C                               DOR
         USING JCT,R3             NOTE JCT ADDRESSABILITY         DOR
         AGO   .X136C                                             DOR
.NO136C  ANOP                                                     DOR
         USING JCTDSECT,R3         NOTE JCT ADDRESSABILITY        ONL16
.X136C   ANOP                                                     DOR
         SPACE 1                                                  ONL05
         CLC   JCTCNVRC,=F'0'      NON-ZERO CONVERTER RETURN CODE?ONL05
         BNE   LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
         SPACE 1                                                  ONL05
         AIF   (&QJTIP).ONL05A                                    ONL05
         CLC   JCTXEQON,=F'0'      JOB EXECUTING OR EXECUTED ?    ONL05
         BNZ   LOGOK               SKIP IF YES, LIST JOBLOG       ONL05
.ONL05A  ANOP  ,                                                  ONL05
         SPACE 1                                                  ONL05
         B     NOLOG               OTHERWISE, DON'T LIST JOBLOG   ONL05
         SPACE 1                                                  ONL05
         DROP  R3                  KILL JCT ADDRESSABILITY        ONL05
         DROP  R4                  KILL JQE ADDRESSABILITY        ONL05
         SPACE 1                                                  ONL05
LOGOK    DS    0H                  OK TO LIST THE JOBLOG          ONL05
         SPACE 2                                                  ONL05
***********************************************************************
*                                                                     *
*   CALL LISTDSR TO LIST THE JOB LOG DATASET                          *
*                                                                    *
***********************************************************************
         MVC   QPOFFSET,=H'0' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'2'   DSID OF DATASET TO BE PRINTED
         BAL   R8,LISTDSRR
***********************************************************************
*                                                                     *
*   CALL LISTDSR TO LIST THE JCL DATASET OF THE JOB                   *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'10' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'3'   DSID OF DATASET TO BE PRINTED
         BAL   R8,LISTDSRR
***********************************************************************
*                                                                     *
*   CALL LISTDSR TO LIST THE JOB MESSAGES OF THE JOB                  *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' PRINT OFFSET FOR EACH RECORD
         MVC   QPDSID,=H'4'   DSID OF DATASET TO BE PRINTED
         BAL   R8,LISTDSRR
******************************************************************ONL11
*                                                                 ONL11
*   GET DSID'S FOR THE JOB AND LIST THE DDNAME                    ONL11
*                                                                 ONL11
******************************************************************ONL11
         AIF   (&QSP133).C29DD                                    ONL11
***********************************************************************
*                                                                     *
*   DETERMINE JOB TYPE (BATCH OR TSO)                                 *
*                                                                     *
***********************************************************************
         USING JCTDSECT,R1    BASE REG FOR JCT                    ONL16
         USING PDBDSECT,R2    BASE REG FOR PDDB
         L     R1,QCJCTA      A(JCT)
         CLI   QPARM2,C'S'                                        RNB11
         BE    DDTSO                                              RNB11
         CLC   JCTJOBID(3),=CL3'TSU' ?/TSO USER
         BE    DDTSO          YES. GO PROCESS
         CLC   JCTJOBID(3),=CL3'STC' ?/STARTED TASK
         BE    DDTSO          YES. GO PROCESS
***********************************************************************
*                                                                     *
*   LOCATE PDDB NUMBER 5                                              *
*                                                                     *
***********************************************************************
DDJOB    L     R3,QCIOTA      LOAD BASE REG
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP THE POINTER     UF046
         USING IOTDSECT,R3    BASE REG FOR IOT                    UF046
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
FINDDS   CLC   =H'5',PDBDSKEY IS THIS THE DATASET?
         BE    FOUNDDS        YES. CONTINUE.
         LA    R2,PDBLENG(R2) NO. LOOK AT NEXT PDDB.
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB?
         BL    FINDDS         NO. TRY AGAIN.
         QTILT '*** JOB DOES NOT HAVE DD TABLE ***'
FOUNDDS  L     R4,PDBMTTR     DISK ADDR OF FIRST BLOCK
         L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         B     FIRST          PROCESS DATASET
***********************************************************************
*                                                                     *
*   PROCESS DATASET                                                   *
*                                                                     *
***********************************************************************
NEXTBLK  L     R4,0(R5)       DISK ADDR OF NEXT BLOCK
FIRST    LTR   R4,R4          IS THE DISK ADDR ZERO?
         BZ    END            YES. END OF DATASET.
         BAL   R8,READ        READ A BLOCK
         CLC   QPJOBID,4(R5)  DOES THE JOBID MATCH?
         BNE   END            NO. END OF DATASET.
         CLC   =H'5',8(R5)    IS THE DSID 5?
         BNE   END            NO. END OF DATASET.
         LA    R4,10(R5)      ADDR OF FIRST RECORD IN BLOCK
***********************************************************************
*                                                                     *
*   PROCESS RECORDS                                                   *
*                                                                     *
***********************************************************************
NEXTREC  CLI   0(R4),X'FF'    IS LENGTH BYTE FF?
         BE    NEXTBLK        YES. END OF BLOCK.
         TM    1(R4),X'10'    IS THIS A SPANNED RECORD?
         BO    SPAN           YES. SKIP IT.
         SR    R6,R6          ZERO OUT REG
         IC    R6,0(R4)       INSERT LENGTH
         TM    5(R4),2        IS THIS AN EXEC    RECORD?
         BO    SKIPREC        YES. PROCESS IT.
         TM    5(R4),4        IS THIS A DD RECORD?
         BO    DD             YES. PROCESS IT.
SKIPREC  LA    R4,3(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPAN     LH    R6,2(R4)       LENGTH OF SEGMENT
         TM    1(R4),X'08'    IS THIS THE FIRST SEGMENT?
         BO    SPANFRST       YES. USE HEADER LENGTH OF 6.
         LA    R4,4(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
SPANFRST LA    R4,6(R6,R4)    INCREMENT TO NEXT RECORD
         B     NEXTREC        PROCESS NEXT RECORD
END      QSTOP
***********************************************************************
*                                                                     *
*   PROCESS DD RECORDS                                                *
*                                                                     *
***********************************************************************
DD       TM    6(R4),X'30'    IS THIS A SYSIN OR SYSOUT DD?
         BZ    SKIPREC        NO. SKIP THE RECORD.
         LA    R7,7(R4)       ADDR OF FIRST KEY
         LR    R8,R6          REMAINING LENGTH OF RECORD
         SR    R15,15         ZERO OUT R15
         SR    R14,R14        ZERO OUT R14
         SR    R1,R1          ZERO OUT R1
TRYFLD   EQU   *
         CLI   0(R7),X'4A'    IS THIS THE DSNAME?
         BNE   NEXTFLD        NO. GET NEXT FIELD
         CLC   3(3,R7),=C'JES' YES. IS THIS TRULY A JES2 SYSIN/OUT DS?
         BE    DSKEY          YES. PROCESS IT.
NEXTFLD  IC    R1,1(R7)       NUMBER OF SUBFIELDS
         LA    R7,2(R7)       UPDATE LOCATION
         SH    R8,=H'2'       REMAINING COUNT
         SR    R8,R1          REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         LTR   R1,R1          ARE THERE ANY SUBFIELDS?
         BZ    TRYFLD         NO. TRY NEXT FIELD.
LOOPFLD  TM    0(R7),X'80'    IS THIS A SUB-SUB-FIELD
         BZ    NOSUB          NO. CONTINUE.
         NI    0(R7),X'7F'    CLEAR THE HEX 80 BIT
         IC    R14,0(R7)      NUMBER OF SUB-SUB-FIELDS
         LA    R7,1(R7)       UPDATE LOCATION
         SH    R8,=H'1'       REMAINING COUNT
         SR    R8,R14         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
         AR    R1,R14         INCREASE NUMBER OF SUBFIELDS
         B     YESSUB         DECREMENT AND TRY AGAIN
NOSUB    IC    R15,0(R7)      SUBFIELD LENGTH
         LA    R7,1(R15,R7)   ADD TO LOCATION
         SR    R8,R15         REMAINING COUNT
         BNP   SKIPREC        RECORD IS EXHAUSTED
YESSUB   BCT   R1,LOOPFLD     DO NEXT SUBFIELD
         B     TRYFLD         TRY NEXT FIELD
DSKEY    MVC   DSID+1(3),20(R7)  MOVE THE DSID
         L     R15,=V(FINDPDDB) ADDR OF FINDPDDB MODULE
         BALR  R14,R15        GO TO IT
         MVC   QPOFFSET,=H'0'   PRINT OFFSET FOR EACH RECORD
         BAL   R8,LISTDSRR
         B     SKIPREC        PROCESS NEXT RECORD
***********************************************************************
*                                                                     *
*   PROCESS DD TSU                                                    *
*                                                                     *
***********************************************************************
DDTSO    L     R5,QCBLKA      ADDR OF DATASET BLOCK IOAREA
         LR    R3,R5          BASE OF IOAREA
         SH    R3,=AL2(IOTSTART-IOTDSECT) BACK UP THE POINTER     UF046
         L     R4,JCTSPIOT    ADDR OF FIRST SPIN IOT
TSO010   LTR   R4,R4          IS IOT ADDR ZERO?
         BZ    DDJOB          YES, GO READ REGULAR IOT'S
         BAL   R8,READ        READ IOT
         LR    R4,R3          BASE OF IOT
         CLC   IOTID,=CL4'IOT'  WAS AN IOT READ FROM SPOOL ?      ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         CLC   QPJOBID,IOTJBKEY  IS THE IOT'S JOB KEY VALID ?     ONL03
         BNE   BADIOT         ERROR IF NO                         ONL03
         A     R4,IOTPDDBP    OFFSET BEYOND LAST PDDB
         LR    R2,R3          BASE OF IOT
         A     R2,QCPDDB1     OFFSET TO FIRST PDDB IN IOT
TSO020   CLI   PDBFLAG1,X'00' IS THIS PDDB VALID
         BE    TSO040         NO, GET NEXT IOT
         SR    R0,R0          CLEAR REG 0
         LH    R0,PDBDSKEY    CONVERT
         STH   R0,QPDSID
         STH   R0,QOLDDSID
TSO030   EQU   *
         MVC   QPOFFSET,=H'0'   PRINT OFFSET FOR EACH RECORD
         BAL   R8,LISTDSRR
         LA    R2,PDBLENG(R2) LOOK AT NEXT PDDB
         CR    R2,R4          HAVE WE GONE PAST THE LAST PDDB
         BL    TSO020         NO, TRY AGAIN
TSO040   L     R4,IOTIOTTR    DISK ADDR OF NEXT IOT
         B     TSO010         GO SEARCH THE NEXT IOT
         AGO   .END                                               ONL11
.C29DD   ANOP  ,                                                  ONL11
***********************************************************************
*                                                                     *
*   FIND ALL PDDBS FOR THIS JOB WITH A DSID OF 101 OR GRATER          *
*                                                                     *
***********************************************************************
         AIF   (NOT &QSP136).NO136F
         USING PDB,R2        BASE REG FOR PDDB  DOR
         AGO   .X136F
.NO136F  ANOP
         USING PDBDSECT,R2        BASE REG FOR PDDB
.X136F   ANOP
         MVI   SWITCH,0        CLEAR FLAG BYTE
SWITCH   EQU   QVDQTTY+4       USE SPARE BYTE IN QCOMMON
         L     R3,QCIOTA          LOAD BASE REG
         LR    R5,R3              IOAREA FOR READ IOT BLOCK
         AIF   (NOT &QSP136).NO136G
         SH    R3,=AL2(IOTSTART-IOT) ADJUST FOR HEADER       DOR
         USING IOT,R3        BASE REG FOR IOT                DOR
         AGO   .X136G
.NO136G  ANOP
         SH    R3,=AL2(IOTSTART-IOTDSECT) ADJUST FOR HEADER       UF046
         USING IOTDSECT,R3        BASE REG FOR IOT                UF046
.X136G   ANOP
         AIF   (NOT &QSP133).C29A1                                UF046
         L     R1,QCJQEA          ADDRESS OF JQE                  UF046
         AIF   (NOT &QSP136).NO136H
         USING JQE,R1             SET TEMP ADDRESSING             DOR
         TM    JQEFLAG3,JQE3SYSD  JQETRAK POINT TO IOT?           DOR
         AGO   .X136H
.NO136H  ANOP
         USING JQEDSECT,R1        SET TEMP ADDRESSING             UF046
         TM    JQEFLAG3,QUESYSDS  JQETRAK POINT TO IOT?           UF046
.X136H   ANOP
         BZ    READJCT            NO, SKIP THIS CODE              UF046
         OI    SWITCH,1            SKIP SPIN IOT'S                UF046
         L     R4,JQETRAK          ADDRESS OF FIRST IOT           UF046
         B     READIOT             READ FIRST IOT                 UF046
READJCT  DS    0H                                                 UF046
.C29A1   ANOP  ,                                                  UF046
         AIF   (NOT &QSP136).NO136I
         USING JCT,R1             SET TEMP ADDRESSING             DOR
         AGO   .X136I
.NO136I  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136I   ANOP
         L     R1,QCJCTA          POINT TO JCT
         L     R4,JCTIOT          FIRST IOT ADDRESS
         DROP  R1                 DROP TEMP ADDRESSING
READIOT  DS    0H                                                 UF046
         BAL   R8,READ            READ THE IOT
         SPACE 1
NEXTIOT  LR    R4,R3              BASE OF IOT
         CLC   IOTID,=CL4'IOT'    WAS AN IOT READ FROM SPOOL ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         CLC   QPJOBID,IOTJBKEY   IS THE IOT'S JOB KEY VALID ?    ONL03
         BNE   BADIOT             ERROR IF NO                     ONL03
         A     R4,IOTPDDBP        OFFSET BEYOND LAST PDDB
         LR    R2,R3              BASE OF IOT
         AIF   (NOT &QSP133).C29AX                                UF046
         A     R2,IOTPDDB            ADD OFFSET TO FIRST PDDB     UF046
         AGO   .C29BX                                             UF046
.C29AX   ANOP  ,                                                  UF046
         A     R2,QCPDDB1         OFFSET TO FIRST PDDB IN IOT
.C29BX   ANOP  ,                                                  UF046
         SPACE 1                                                  ONL11
PDDBLOOP LH    R0,PDBDSKEY        GET THE DSID
         C     R0,=F'101'         IS DSID .GE. 101?               ONL11
         BL    NEXTPDDB           IF NOT, IGNORE THIS PDDB        ONL11
         SPACE 1                                                  ONL11
         LTR   R0,R0              TEST FOR NULL PDDB#
         BZ    NEXTPDDB           SKIP IF SO
         STH   R0,QPDSID
         STH   R0,QOLDDSID
         L     R0,PDBRECCT        ANY RECORDS?
         LTR   R0,R0
         BZ    NEXTPDDB           NO RECORDS SKIP DATASET
         STM   R1,R5,QPPWORK      STORE CURRENT PDDB
         BAL   R8,LISTDSRR
         LM    R1,R5,QPPWORK      GET CURRENT PDDB
NEXTPDDB LA    R2,PDBLENG(R2)     POINT TO NEXT PDDB
         CR    R2,R4              HAVE WE GONE PAST THE LAST PDDB
         BL    PDDBLOOP           NO. KEEP TRYING
         L     R4,IOTIOTTR        DISK ADDR OF NEXT IOT
SPIN     LTR   R4,R4              IS THERE ANOTHER IOT?
         BZ    SPINIOT            NO. TRY THE SPIN IOT.
         BAL   R8,READ            READ THE IOT
         B     NEXTIOT            SEARCH THE NEXT IOT
         AIF   (NOT &QSP136).NO136J
         USING JCT,R1             SET TEMP ADDRESSING             DOR
         AGO   .X136J
.NO136J  ANOP
         USING JCTDSECT,R1        SET TEMP ADDRESSING             UF046
.X136J   ANOP
SPINIOT  TM    SWITCH,1           DID WE SEARCH THE SPINIOT ALREADY
         BO    SYSJOBL            YES, DONE AND GO TO FIRST DATASET
         OI    SWITCH,1           SET SWITCH
         L     R1,QCJCTA          LOAD BASE REG
         L     R4,JCTSPIOT        DISK ADDR OF SPIN IOT
         B     SPIN               SEARCH THE SPIN IOT CHAIN
         DROP  R1
.END     ANOP  ,                                                  ONL11
STOP     QSTOP                    GO BACK TO CALLER
***********************************************************************
*                                                                     *
*   READ A BLOCK FROM HASPACE                                         *
*                                                                     *
***********************************************************************
READ     ST    R4,QCTRAK      STORE DISK ADDR
         LR    R1,R5          IOAREA ADDRESS
         L     R15,=V(READSPC) ADDR OF ROUTINE TO READ HASPACE
         BALR  R14,R15        GO TO IT
         BR    R8             RETURN TO CALLER
***********************************************************************
*                                                                     *
*   PROCESS LISTDSR FOR DISPLAY DATASET                               *
*                                                                     *
***********************************************************************
LISTDSRR ST    R8,QDWORD
LISTDSRS ST    R8,QDWORD+4
         L     R15,=V(LISTDSR) ADDR OF LISTDSR MODULE
         BALR  R14,R15        GO TO IT
         L     R8,QDWORD+4
         BR    R8
         SPACE 2                                                  ONL03
BADIOT   QTILT '*** JOB HAS PURGED (OR IOT IS INVALID) ***'       ONL03
NOLOG    QTILT '*** JOBLOG IS NOT AVAILABLE ***'                  ONL05
NOJLPDDB QTILT '*** JOBLOG PDDB NOT FOUND ***'                    ONL05
         SPACE 1                                                  ONL05
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
SYSJOB   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136K                               DOR
         IFGRPL  DSECT=YES,AM=VTAM
         AGO   .X136K                                             DOR
.NO136K  ANOP                                                     DOR
JCT      EQU   0
.X136K   ANOP                                                     DOR
         $BUFFER                                                  UF020
         $JQE
         $TAB
         $JCT
         $PDDB
         $IOT
         QCOMMON ,                                                ONL11
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
WORK     DSECT
         DS    CL72
DWORD    DS    D                  RESERVED FOR LISTDSR USAGE
         DS    5F                 RESERVED BY PARSE AREA
LASTLIST DS    F                  CURRENT ADDRESS OF BRANCH LISTDSR
LISTADDR DS    F                  CURRENT ADDRESS OF BRANCH LISTDSR
COUNT    DS    D
*SWITCH   DS    C
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=SYSLOG
SYSLOG   TITLE 'QUEUE COMMAND - PRINT THE SYSTEM LOG DATASET'     DOR
SYSLOG   QSTART HASPEQU=YES,       START SYSLOG CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - PRINT THE SYSTEM LOG DATASET'
         GBLB   &QSP136       SP 1.3.6 OPTION FLAG                DOR
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING WORK,R13       BASE REG FOR TEMP WORK
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CHECK JOBNAME EQUAL SYSLOG                                        *
*                                                                     *
***********************************************************************
         L     R9,QCJCTA      ADDR OF IOAREA FOR JCT
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JCT,R9        BASE REG FOR JCT                       DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JCTDSECT,R9    BASE REG FOR JCT                    ONL16
.X136A   ANOP                                                       DOR
         CLC   JCTJNAME,=CL8'SYSLOG' IS THIS SYSLOG?
         BNE   TILT           NO. TILT.
***********************************************************************
*                                                                     *
*   DETERMINE NUMBER OF DATASETS FROM CURRENT DATASET                 *
*                                                                     *
***********************************************************************
         LH    R3,JCTPDDBK    HIGHEST DATASET ID NUMBER
         LH    R2,QLNG2       LENGTH OF BACKUP PARM
         SH    R2,=H'1'       IS THE BACKUP PARM ZERO LENGTH?
         BM    CALLLIST       YES. SKIP.
         CLI   QPARM2,C'-'    IS THERE A MINUS SIGN?
         BNE   PLUS           NO. SKIP.
         MVI   QPARM2,C'0'    CHANGE MINUS TO ZERO
PLUS     MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         EX    R2,PACK        PACK THE FIELD
         CVB   R2,CONVERT     CONVERT TO BINARY
         SR    R3,R2          BACK UP NUMBER OF DATASETS
         CH    R3,=H'101'     IS THE NUMBER LESS THAN 101?
         BL    TILT           YES. TILT.
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR LOOKING AT THE SYSTEM LOG     ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QASYSLOG          SEE IF USER CAN LOOK AT SYSLOG ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
CALLLIST STH   R3,QPDSID      STORE DATASET ID
         MVC   QPOFFSET,=H'0' PRINT OFFSET ZERO
         L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
TILT     QTILT '*** INVALID PARAMETER ***'
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
MVZ      MVZ   QFZONES(1),QPARM2 CHECK FOR NUMERIC
PACK     PACK  CONVERT,QPARM2(1) CONVERT TO BINARY
         LTORG
         DROP  ,                   DROP ALL ADDRESSING            NERDC
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
SYSLOG   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136B                                 DOR
         IFGRPL  DSECT=YES,AM=VTAM                                  DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
JCT      EQU   0
.X136B   ANOP                                                       DOR
        $BUFFER ,                                                 ONL16
        $JCT   ,
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
WORK     DSECT
         DS    72C
CONVERT  DS    D
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=SYSOUT
SYSOUT   TITLE 'QUEUE COMMAND - MANIPULATE SYSOUT'                ONL01
SYSOUT   QSTART HASPEQU=YES,       START SYSOUT CSECT ASSEMBLY    DOR XX
               XTITLE='QUEUE COMMAND - MANIPULATE SYSOUT'
***********************************************************************
* RNB CHANGES:                                                        *
*      (1) RNB00 - MOVED THINGS AROUND FOR FOX ASSEMBLER              *
*      (2) RNB09 - FOR A REQ COMMAND, IF NO NEWCLASS GIVEN USE CLASS C*
*                  KEYED TO QRNB=1.                                   *
***********************************************************************
         GBLB  &QRNB                                              RNB09
         GBLB  &QSP136             SP 1.3.6 OPTION FLAG           DOR
         USING QCKPT,R10
         L     R10,QVCKPT
         USING QDISPLAY,R9
         L     R9,QVDSPL
         USING WORK,R13
***********************************************************************
*                                                                     *
*   TEST AUTHORIZATION OF QUEUE                                       *
*   COMMENT BY DOR/CDSI NOT WORK ON TSS                               *
***********************************************************************
*        TESTAUTH FCTN=1          TEST AUTHORIZATION OF USER
*        LTR   R15,R15            ?/AUTHORIZED
*        BZ    FJOB               YES. KEEP ON TRUCKING
*        QTILT ' *** FUNCTION IS NOT AUTHORIZED ***'
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT AND IOT                       *
*                                                                     *
***********************************************************************
FJOB     L     R15,=V(FINDJOB)    ADDR OF MODULE TO FIND JOB
         BALR  R14,R15            GO TO IT
         L     R4,QCJCTA          ADDR OF JCT                     ONL02
         AIF   (NOT &QSP136).NO136A                                 DOR
         USING JCT,R4             NOTE JCT ADDRESSABILITY      DOR
         AGO   .X136A                                               DOR
.NO136A  ANOP                                                       DOR
         USING JCTDSECT,R4        NOTE JCT ADDRESSABILITY         ONL16
.X136A   ANOP                                                       DOR
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   VALIDATE THE FUNCTION CODE                                        *
*                                                                     *
***********************************************************************
         LH    R1,QCODEH          GET FUNCTION CODE
         CH    R1,=H'8'           ?/VALID FUNCTION CODE
         BH    STOP               NO. EXIT
         SPACE 2                                                  ONL02
******************************************************************ONL02
*                                                                 ONL02
*   PERFORM AUTHORIZATION CHECK FOR JOB                           ONL02
*                                                                 ONL02
******************************************************************ONL02
         SPACE 1                                                  ONL02
         QAUTHCK QASYSOUT          PERFORM JOB AUTHORIZATION      ONL02
         SPACE 2                                                  ONL02
***********************************************************************
*                                                                     *
*   BRANCH TO THE APPROPIATE PROCESSOR                                *
*                                                                     *
***********************************************************************
         LA    R7,SSOBHDR         ADDR FOR SUBSYSTEM OPTION BLOCK
         USING SSOB,R7
         B     *+4(R1)
         B     DELETE             0   DELETE REQUEST
         B     REQUEUE            4   REQUEUE REQUEST
         B     CANCEL             8   CANCEL REQUEST
***********************************************************************
*                                                                     *
*   PROCESS CANCEL REQUEST                                            *
*                                                                     *
***********************************************************************
CANCEL   LA    R5,SSCSBGN         A(CANCEL PARAMETER LIST)
         BAL   R6,INITSSOB        GO INITIALIZE THE SSOB.
         MVC   SSOBFUNC,=AL2(SSOBCANC)  SET THE FUNCTION
         XC    SSCSBGN(SSCSIZE),SSCSBGN CLEAR PARM LIST
         MVC   SSCSLEN,=AL2(SSCSIZE) SET LENGTH OF CANCEL PARM LIST
         CLI   QPARM2,C'P'        ?/PURGE THE OUTPUT
         BNE   CAN000             NO. DON'T SET THE FLAG
         OI    SSCSFLGS,SSCSCOUT  YES
CAN000   MVC   SSCSJOBN,JCTJNAME  JOBNAME
         MVC   SSCSJOBI,JCTJOBID  JES2 JOB ID
         MVC   SSCSDIMP,=H'16'
         LA    R5,SSCSJOBI        A(JES2 JOB ID)
         BAL   R6,FIXJOBID        ENSURE JOBID HAS NO IMBEDDED BLANKS
         BAL   R6,VERREQ          VERIFY THE REQUEST
         BAL   R6,CALLSSI         GO CALL SUBSYSTEM INTERFACE RTN
         L     R1,SSOBRETN        GET RC FOR CANCEL FUNCTION
         B     *+4(R1)
         B     FUNCTOK            0 -  CANCEL COMPLETED
         B     TILTNOJB           4 -  JOBNAME NOT FOUND
         B     TILTBADI           8 -  INVALID JOBNAME/JOB ID COMB.
         B     TILTNCAN           12 - JOB NOT CANCELLED - DUP JOBN
         B     TILTMALL           16 - STATUS ARRAY TOO SMALL
         B     TILTOUTP           20 - JOB NOT CANCELLED - ON OUTPUT Q
         B     TILTYNTX           24 - JOB ID WITH INVALID SYNTAX
         B     TILTICAN           28 - INVALID CANCEL REQUEST
***********************************************************************
*                                                                     *
*   PROCESS REQUEUE REQUEST                                           *
*                                                                     *
***********************************************************************
REQUEUE  LA    R5,SSSOBGN         A(REQUEUE SYSOUT PARM LIST)
         BAL   R6,INITSSOB        GO INITIALIZE THE SSOB
         AIF   (NOT &QRNB).RNB09A                                 RNB09
         CLI   QPARM2,C' '        WAS NEW CLASS GIVEN?            RNB09
         BNE   RNB09A             /YES - USE IT                   RNB09
         MVI   QPARM2,C'C'        /NO  - DEFAULT TO CLASS C       RNB09
RNB09A   DS    0H                                                 RNB09
.RNB09A  ANOP                                                     RNB09
         MVC   SSOBFUNC,=AL2(SSOBSOUT) INDICATE SYSOUT IS THE FUNCTION
         XC    SSSOBGN(SSSOSIZE),SSSOBGN CLEAR PARM LIST
         MVC   SSSOLEN,=AL2(SSSOSIZE) SET LENGTH OF SYSOUT PARM LIST
         OI    SSSOUFLG,SSSOSETC  USE SSSOCLAS AS DISP
         OI    SSSOUFLG,SSSORLSE  RELEASE ALL SELECTED DATA SETS
         OI    SSSOFLG1,SSSOHLD   SELECTION INCLUDES HELD SYSOUT DS
         OI    SSSOFLG1,SSSOSJBN  JOB NAME IS PRESENT
         OI    SSSOFLG1,SSSOSJBI  JOB ID IS PRESENT
         OI    SSSOFLG2,SSSOCTRL  PROCESSING COMPLETED
         MVC   SSSOJOBN,JCTJNAME  JOBNAME
         MVC   SSSOJOBI,JCTJOBID  JOB ID
         MVC   SSSOCLAS,QPARM2    NEWCLASS
         LA    R5,SSSOJOBI        A(JES JOB ID)
         BAL   R6,FIXJOBID        ENSURE JOBID HAS NO EMBEDDED BLANKS
         BAL   R6,VERREQ          VERIFY THE REQUEST
         BAL   R6,CALLSSI         GO CALL SUBSYSTEM INTERFACE RTN
CHKSORC  L     R1,SSOBRETN        GET RETURN CODE FOR SYSOUT FUNCTION
         B     *+4(R1)
         B     FUNCTOK            0 -  SYSOUT COMPLETED
         B     TILTEODS           4 -  NO MORE DS TO SELECT
         B     TILTNJOB           8 -  JOB NOT FOUND
         B     TILTINVA           12 - INVALID SEARCH ARGUMENTS
         B     TILTUNAV           16 - UNABLE TO PROCESS NOW
         B     TILTDUPJ           20 - DUPLICATE JOB NAMES
         B     TILTINVJ           24 - INVALID JOBN/JOBID COMBO
         B     TILTIDST           28 - INVALID DEST SPECIFIED
***********************************************************************
*                                                                     *
*   PROCESS DELETE  REQUEST                                           *
*                                                                     *
***********************************************************************
DELETE   LA    R5,SSSOBGN         A(DELETE SYSOUT PARM LIST)
         BAL   R6,INITSSOB        GO INITIALIZE THE SSOB
         MVC   SSOBFUNC,=AL2(SSOBSOUT) INDICATE SYSOUT IS THE FUNCTION
         XC    SSSOBGN(SSSOSIZE),SSSOBGN CLEAR PARM LIST
         MVC   SSSOLEN,=AL2(SSSOSIZE) SET LENGTH OF SYSOUT PARM LIST
         OI    SSSOUFLG,SSSODELC  INDICATE DELETE REQUEST
         OI    SSSOFLG1,SSSOHLD   SELECTION INCLUDES HELD DS
         OI    SSSOFLG1,SSSOSJBN  JOB NAME PRESENT
         OI    SSSOFLG1,SSSOSJBI  JES2 JOB ID PRESENT
         OI    SSSOFLG2,SSSOCTRL  PROCESSING COMPLETED
         MVC   SSSOJOBN,JCTJNAME  JOBNAME
         MVC   SSSOJOBI,JCTJOBID  JES2 JOBID
         LA    R5,SSSOJOBI        A(JES2 JOBID)
         BAL   R6,FIXJOBID        ENSURE JOBID HAS NO EMBEDDED BLANKS
         BAL   R6,VERREQ          VERIFY THE REQUEST
         BAL   R6,CALLSSI         GO CALL SUBSYSTEM INTERFACE RTN.
         B     CHKSORC            GO CHECK RC
***********************************************************************
*                                                                     *
*   INITIALIZE THE SUBSYSTEM OPTION BLOCK (SSOB)                      *
*                                                                     *
*        R5 - ADDRESS OF FUNCTION PARM LIST                           *
*        R6 - RETURN ADDRESS                                          *
*        R7 - A(SSOB)                                                 *
*                                                                     *
***********************************************************************
INITSSOB XC    SSOBEGIN(SSOBHSIZ),SSOBEGIN CLEAR THE SSOB
         MVC   SSOBID,=C'SSOB'
         MVC   SSOBLEN,=AL2(SSOBHSIZ) LENGTH OF SSOB HEADER
         ST    R5,SSOBINDV        FUNCTION DEPENDENT AREA POINTER
         ST    R7,SSOBPTR         SAVE ADDR OF SSOB
         OI    SSOBPTR,X'80'      REQUIRED FOR IEFSSREQ INTERFACE
         BR    R6
***********************************************************************
*                                                                     *
*   REMOVE EMBEDDED BLANKS IN JES2 JOB ID                             *
*                                                                     *
***********************************************************************
FIXJOBID LA    R8,5               MAX LENGTH OF SCAN
         LA    R5,3(R5)           START LOCATION FOR SCAN
FIX000   CLI   0(R5),C' '         ?/EMBEDDED BLANK
         BNE   FIX010             NO. CONTINUE WITH THE SCAN
         MVI   0(R5),C'0'         YES. REPLACE WITH 0
FIX010   LA    R5,1(R5)           POINT TO NEXT BYTE
         BCT   R8,FIX000          GO DO IT AGAIN
         BR    R6                 ALL OVER. RETURN TO CALLER
***********************************************************************
*                                                                     *
*   TELL THE USER WHAT HE IS ABOUT TO DO                              *
*                                                                     *
***********************************************************************
VERREQ   MVC   VCLEAR,WARNING     MOVE IN THE WARNING MSG
         MVC   VJOBN(8),JCTJNAME
         MVC   VJOBID(8),JCTJOBID
         LR    R2,R6              SAVE RETURN ADDR
         LA    R5,VJOBID          A(JES JOB ID)
         BAL   R6,FIXJOBID        INSURE NO IMBEDDED BLANKS
         LR    R6,R2              RESTORE RETURN ADDR
         CLI   QSUBNAME,C'D'      ?/DELETE COMMAND
         BNE   VER000
         MVC   VCMD(6),=C'DELETE'
         B     VER020
VER000   CLI   QSUBNAME,C'C'      ?/CANCEL COMMAND
         BNE   VER010
         MVC   VCMD(6),=C'CANCEL'
         CLI   QPARM2,C'P'        PURGE SPECIFIED
         BNE   VER020
         MVC   VACTION(5),QPARM2
         B     VER020
VER010   MVC   VCMD(7),=C'REQUEUE'
         MVC   VACTION,RQACTION
         MVC   VCLASS(1),QPARM2
VER020   MVC   QDMLNG,=H'0'       TELL DISPLAY TO PRINT IT NOW
         L     R15,=V(DISPLAY)    A(MODULE TO DISPLAY THE MESSAGE)
         BALR  R14,R15            GO DISPLAY THE WARNING
         BR    R6                 RETURN TO THE CALLER
***********************************************************************
*                                                                     *
*   INTERFACE TO THE SUBSYSTEM                                        *
*                                                                     *
***********************************************************************
CALLSSI  L     R2,16              A(CVT)
         L     R2,296(R2)         A(JESCT)
         SETAUTH ON
         MODESET MODE=SUP         GET SUPER
         LA    R1,SSOBPTR         ADDR OF PTR TO SSOB
         L     R15,20(R2)         A(JESSSREQ)
         BALR  R14,R15
         LR    R2,R15             SAVE RETURN CODE
         MODESET MODE=PROB        BACK TO NORMAL
         SETAUTH OFF
         B     *+4(R2)
         BR    R6                 0 -  SUCCESSFUL INSTRUCTION
         BR    R6                      DUMMY INSTRUCTION
         B     TILTNSUP           4 -  SS DOESN'T SUPPORT THIS FUNCTION
         B     TILTNTUP           8 -  SS EXIST, BUT IS NOT UP
         B     TILTNOSS           12 - SS DOES NOT EXIST
         B     TILTDIST           16 - FUNCTION NOT SUPPORTED
         B     TILTLERR           20 - LOGICAL ERROR
***********************************************************************
*                                                                     *
*   RETURN TO CALLER                                                  *
*                                                                     *
***********************************************************************
STOP     QSTOP
FUNCTOK  QTILT ' *** COMMAND SUCCESSFULLY PROCESSED ***'
***********************************************************************
*                                                                     *
*   ERROR MESSAGES                                                    *
*                                                                     *
***********************************************************************
TILTNSUP QTILT ' *** QUEUE LOGIC ERROR -- RC =4  FROM SSI ***'
TILTNTUP QTILT ' *** JES2 IS NOT UP ***'
TILTNOSS QTILT ' *** QUEUE LOGIC ERROR -- RC =12 FROM SSI ***'
TILTDIST QTILT ' *** DISASTROUS ERROR DURING PROCESSING ***'
TILTLERR QTILT ' *** QUEUE LOGIC ERROR -- RC =20 FROM SSI ***'
TILTNOJB EQU   *
TILTNJOB QTILT ' *** JOBNAME NOT FOUND ***'
TILTBADI EQU   *
TILTINVJ QTILT ' *** INVALID JOBNAME/JOB ID COMBINATION ***'
TILTNCAN EQU   *
TILTDUPJ QTILT ' *** DUPLICATE JOBNAME AND NO JOBID GIVEN ***'
TILTEODS QTILT ' *** JOB HAS NO HELD DATA SETS ***'
TILTICAN QTILT ' *** CAN''T CANCEL YOUR TSO SESSION OR A STARTED TASK *X
               **'
TILTOUTP QTILT ' *** JOB NOT CANCELLED - JOB ON OUTPUT QUEUE ***'
TILTMALL EQU   *
TILTYNTX EQU   *
TILTINVA EQU   *
TILTUNAV EQU   *
TILTIDST QTILT ' *** QUEUE LOGIC ERROR ***'
***********************************************************************
*                                                                     *
*   MISCELLANEOUS NUTS, BOLTS, ETC.                                   *
*                                                                     *
***********************************************************************
WARNING  DS    0CL80
         DC    CL21' *** '
         DC    CL1'('
         DC    CL8' '
         DC    CL1')'
         DC    CL12' '
         DC    CL37'. HIT ENTER IF OK OR RESPECIFY. ***'
RQACTION DC    CL11'NEWCLASS( )'
         LTORG
         DROP  ,                   DROP ALL ADDRESSINGS           NERDC
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
SYSOUT   CSECT ,                                                  UF023
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         AIF   (NOT &QSP136).NO136B                                 DOR
         IFGRPL  DSECT=YES,AM=VTAM                                  DOR
         AGO   .X136B                                               DOR
.NO136B  ANOP                                                       DOR
JCT      EQU   0
.X136B   ANOP                                                       DOR
        $BUFFER ,                                                 ONL16
         $TAB
         $JCT
         $PDDB                                                    RNB00
         $IOT                                                     RNB00
         IEFJSSOB (SO,CS),CONTIG=YES
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
         ORG   QDHLINE
VCLEAR   DS    0CL80
         DS    CL5
VCMD     DS    CL8
VJOBN    DS    CL9
VJOBID   DS    CL10
VACTION  DS    CL11
         DS    CL37
VCLASS   EQU   VACTION+9
WORK     DSECT
FILLER   DS    CL512              BIG FILLER
SSOBPTR  DS    F
SSOBHDR  DS    CL140
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END
./       ADD   NAME=TQIAI001
%TUTORIAL ----- DISPLAY JOBS AVAILABLE FOR PROCESSING -----------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE AI COMMAND IS TO DISPLAY JOBS AVAILABLE FOR PROCESSING.
%
+SYNTAX:         AI CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIAL001
%TUTORIAL ----- DISPLAY DEVICE INTERVENTION REQUIRED  -----------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE ALLOC COMMAND IS TO DISPLAY DEVICE INTERVENTION REQUIRED.
%
+SYNTAX:    ALLO D/T/M/V/B (D=DISK, T=TAPE, M=MOUNTS V=VARIED B=BOTH)
+           ALLO S=VVVVVV  (VVVVVV=FULL VOLSER NAME)
+           ALLO U=XXX     (XXX=UNIT NUMBER)
%
+ABBREVIATIONS: AL
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIAL002
)END
./       ADD   NAME=TQIAL002
%TUTORIAL ----- DISPLAY DEVICE INTERVENTION REQUIRED - SAMPLE ---------T
%NEXT SELECTION ===>_ZCMD

%  14:09   -- AL                                             SYSID=IPO1/
% QUEV2 CMD=>
+  DEVICE VOLSER  STATUS   ASID      JOBNAME
%    125  CHD003  BUSY     AS=0026   INIT
%    126  FSDCD1  BUSY     AS=0019   INIT
%    301  MVSLC1  BUSY     AS=001F   BLR
%    302  PLPA01  BUSY     AS=0026   INIT
%    601  SCR001  BUSY     AS=0026   INIT
%    607  8DBP03  BUSY     AS=0015   RFWINTER
%    616  8SBP02  BUSY     AS=0016   INIT
)PROC
  &ZUP  = TQIAL001
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIAM001
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR ------------------------------T
%NEXT SELECTION ===>_ZCMD

+FUNCTION: THE AM COMMAND IS TO DISPLAY ACTIVITY MONITOR. THE COMMAND WI
+          WAIT FOR 10 SECONDS FOR THE INTERVAL STATISTICAL VALUES.
%
+SYNTAX:         AM  J  (JOB)    
+                    I  (INIT)   
+                    S  (STC)    
+                    T  (TSO)    
+                    D  (DOMAIN) 
+  NO OPERAND: ALL DEFAULT
+
+               (CONTINUE FOR SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIAM002
  &ZINDEX = TQINDEXA
)END
./       ADD   NAME=TQIAM002
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR SAMPLE -----------------------T
%NEXT SELECTION ===>_ZCMD

%  14:10   -- AM                                             SYSID=IPO1/
% QUEV2 CMD=>
% ACTIVITY MONITOR -+10 SEC. INTERVAL
+** IN  QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN
%MASTER                .52      .23      .00       4K  0001 255   0   0
%PCAUTH   PCAUTH       .00      .00      .00       4K  0002 254  13   0
%GRS      GRS          .00      .00      .00       0K  0003 255   0   0
%CONSOLE  CONSOLE      .34     1.00      .00       4K  0005 255  13   0
%ALLOCAS  ALLOCAS      .00      .00      .00       0K  0006 254  13   0
%JES2     JES2        1.26     4.53      .00       0K  0007 253   7   0
%TOP      SECRET       .07      .66      .00       0K  0008 253   7   0
%STABIL1  STABIL1      .00      .00      .00       0K  000C 251   6   0
%MILTEN   MILTEN      8.85    20.66      .00       0K  000F 187  11   0
%NET      NET          .43      .00      .00       0K  0018 253  10   0
%CICPROD  CICPROD    13.64    10.16      .00       0K  0027 237   8   0
)PROC
  &ZUP  = TQIAM001
  &ZCONT= TQIAM003
)END
./       ADD   NAME=TQIAM003
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR - INITIATOR ------------------T
%NEXT SELECTION ===>_ZCMD
+ OUTPUT SAMPLE:
 ACTIVITY MONITOR - 10 SEC. INTERVAL
%* IN  QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+INIT    INIT     **CHG**                         0K  000A 113   1   0
+INIT    INIT         .00      .00     1.76       0K  000B 117   2   0
+INIT    INIT         .00      .03      .00       0K  000E 119   1   0
+INIT    INIT     **CHG**                         0K  0012 120   1   0
+INIT    INIT        7.09     5.16      .36       0K  0014 119   1   0
%   ## IN Q TOTL #   7.63     9.02     2.45
%* OUT QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+INIT    INIT     **CHG**                         0K  000C 186   1   0
+INIT    INIT         .00      .00  **OVF**       0K  000D 255   1   0
+INIT    INIT         .00      .00      .00       0K  0013 255   0   0
%
)PROC
  &ZUP  = TQIAM002
  &ZCONT= TQIAM004
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIAM004
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR - STC ------------------------T
%NEXT SELECTION ===>_ZCMD
+ OUTPUT SAMPLE:
 ACTIVITY MONITOR - 10 SEC. INTERVAL
%* IN  QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+PCAUTH  PCAUTH       .00      .00      .00       0K  0002 254  13   0
+GRS     GRS          .00      .00      .00       0K  0003 255   0   0
+CONSOLE CONSOLE     1.15     1.69      .00       0K  0005 255  13   0
+ALLOCAS ALLOCAS      .00      .00      .00       4K  0006 254  13   0
%   ## IN Q TOTL #   1.15     1.69      .00
%* OUT QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+DUMPSRV DUMPSRV      .00      .00      .00       0K  0004 255   0   0
%
)PROC
  &ZUP  = TQIAM003
  &ZCONT= TQIAM005
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIAM005
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR - TSO USER -------------------T
%NEXT SELECTION ===>_ZCMD
+ OUTPUT SAMPLE:
 ACTIVITY MONITOR - 10 SEC. INTERVAL
%* IN  QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+USER1   #ISPF        .00      .00      .06       0K  0020 191   3   0
+USER2   #STEVPRC     .21      .00     2.79       0K  0024 191   3   0
%   ## IN Q TOTL #    .21      .00     2.85
&* OUT QUEUE **   CPU PCT  SIO/SEC  PAG/SEC  WORKSET  ASID DSP DMN PGN S
+USER3   #ISPF        .00      .00      .00       0K  0017 255   4   0
+USER4   #ISPF        .00      .00      .00       8K  001C 001   3   0
+USER5   #ISPF        .00      .00      .00       0K  001D 255   3   0
+USER6   #ISPF       1.24     2.23     1.66       0K  001F 001   3   0
%
)PROC
  &ZUP  = TQIAM004
  &ZCONT= TQIAM006
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIAM006
%TUTORIAL ----- DISPLAY ACTIVITY MONITOR - DOMAIN ---------------------T
%NEXT SELECTION ===>_ZCMD
+ OUTPUT SAMPLE:
 ACTIVITY MONITOR - 10 SEC. INTERVAL
%*  DOMAINS  **   CPU PCT  SIO/SEC  PAG/SEC
+   DOMAIN 00       1.38      .62      .03
+   DOMAIN 01        .00      .03      .00
+   DOMAIN 02      16.92    57.16     1.65
+   DOMAIN 03       2.79     1.42     7.00
+   DOMAIN 06        .30     1.42      .00
+   DOMAIN 07       1.11     2.91      .06
+   DOMAIN 08      12.91     5.98     1.75
+   DOMAIN 09       1.67      .62      .36
+   DOMAIN 10        .24      .00      .00
+   DOMAIN 11      26.39    31.75      .03
+   DOMAIN 12        .87      .19     4.36
+   DOMAIN 13        .58      .92      .00
+   DOMAIN 17        .15      .00      .00
%   TOTAL PCT      65.31   103.02    15.24
%
)PROC
  &ZUP  = TQIAM005
  &ZCONT= TQIAM001
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIAO001
%TUTORIAL ----- DISPLAY AVAILABLE OUTPUT -----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE AO COMMAND IS TO DISPLAY AVAILABLE OUTPUT.
%
+SYNTAX:         AO CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIAS001
%TUTORIAL ----- ASID INFORMATION COMMAND ------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE ASID COMMAND IS TO DISPLAY THE ASID INFORMATION.
%
+SYNTAX:         ASID STC     (LIST ASIDS OF ALL START TASK CONTROL)
+                ASID JOBS    (LIST ASIDS OF ALL BATCH JOBS)
+                ASID TS      (LIST ASIDS OF ALL TSO USERS JOBS)
+                ASID ALL     (ALL OF ABOVE)
+                ASID         (SAME AS ALL)
+                ASID "ASID#" ( LIST OF SELECTED ASID NUMBER)
+                ASID *       (LIST ASID OF YOUR TSO SESSION)
%
+ABBREVIATIONS:  AS
%
+OPERANDS:
+ -STC/JOBS/TS/ALL  OR "ASID#"/*
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIAS002
)END
./       ADD   NAME=TQIAS002
%TUTORIAL ----- ASID INFORMATION OUTPUT LINE DESCRIPTIONS -------------T
%NEXT SELECTION ===>_ZCMD

%   ID+- ASID NUMBER                % JOB+- JOBNAME
%   DP+- DISPATCHING PRIORITY       %STEP+- STEPNAME
%FLAGS+-%XXXYY +
%XXX-IN +- IN CORE, SWAPPED IN                  %YY-TW +- TERMINAL WAIT
%    NSW+- NON-SWAPPABLE                         %  MW +- LONG WAIT STAT
%    PVL+- PRIVILEDGED                           +         DETECTED BY M
+          (NON-SWAP EXCEPT LONG WAIT)           %  LW +- EXPLICIT LONG
%    AXS+- AUX SHORTAGE FORCED SWAP              %  NW +- NON-SWAPPABLE
%    OUT+- SWAPPED OUT                           %  OW +- OUTPUT TERMINA
%    GOO+- IN PROCESS OF BEING SWAPPED OUT       %  CP +- SIGINIFICANT C
%    GOI+- IN PROCESS OF BEING SWAPPED IN                  (SET BY IRARM
%    GOB+- CURRENTLY CHANGING STATUS
%    ENQ+- TEMPORARILY NON-SWAPPABLE DUE TO ENQ
%    APG+- AUTOMATIC-PRIORITY-GROUP APPLIES
%    RMA+- RMA ALGORITHM APPLIES (RTB=0)
%
)PROC
  &ZUP  = TQIAS001
  &ZCONT= TQIAS003
)END
./       ADD   NAME=TQIAS003
%TUTORIAL ----- ASID INFORMATION OUTPUT LINE DESCRIPTIONS -------------T
%NEXT SELECTION ===>_ZCMD

%CPU TIME+- STEP CPU TIME IN HOURS:MINUTES:SECONDS
%    REAL+- AMOUNT OF REAL CORE AT LAST PAGE-IN
%    WORK+- WORKING SET SIZE AT LAST SWAPIN
%   G/P/D+- PERFORMANCE GROUP/PERF GROUP PERIOD/DOMAIN
%     SRC+- SWAP OUT REASON CODES
%           OTW+- OUTPUT TERMINAL WAIT
%           ITW+- INPUT TERMINAL WAIT
%            LW+- LONGWAIT
%           ASS+- AUXILIARY STORAGE SHORTAGE
%           RSS+- REAL PAGEABLE STORAGE SHORTAGE
%            DT+- DETECTED WAIT
%            RS+- REQUESTED SWAP
%            EE+- ENQ EXCHANGE
%           ERV+- EXCHANGE OF RECOMMENDATION VALUE
%             U+- UNILATERAL
%     SWC+- NUMBER OF SWAPS
%    SERV+- SERVICE UNITS ACCUMULATED (%K+=1024 OR %MK+=MEGA)
%     TRC+- NUMBER OF TRANSACTIONS DURING SESSION
%    SERV+- SERVICE UNITS ACCUMALATED DURING SESSION
%
)PROC
  &ZUP  = TQIAS002
  &ZCONT= TQIAS004
)END
./       ADD   NAME=TQIAS004
%TUTORIAL ----- ASID INFORMATION SAMPLE -------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+  23:53   -- ASID STC                                       SYSID=IPO1/
+ QUEV2 CMD=>
%ID DP ****** STC ****** FLAGS  CPU-TIME REAL WORK  G/P/D  SRC/SWC
+ 1 FF *MASTER*          NSW    00:04:43 192K   0K  0/1/0
+ 2 FE PCAUTH            NSW    00:00:00  72K  20K 15/1/13
+ 3 FF GRS               NSW    00:00:00 420K  20K  0/1/0
+ 4 FF DUMPSRV           OUT-MW 00:00:00   0K  24K  0/1/0   DT   2
+ 5 FF CONSOLE           NSW    00:07:37 260K  20K 15/1/13
+ 6 FE ALLOCAS           NSW    00:00:00 136K  20K 15/1/13       1
+ 7 FD JES2              NSW    01:13:031256K  60K  8/1/7
+ 8 FD TOP               NSW    00:03:11 184K  44K  8/1/7
+ 9 FF RMF               OUT-LW 00:00:04   0K 100K  9/1/6   LW  98
+23 FF TSO               OUT-MW 00:00:01   0K  68K  0/1/0   DT 152
+24 FD NET               NSW    00:07:331304K 124K 10/1/10
+32 BB MILTEN            NSW    03:03:311128K   0K 12/1/11
%
)PROC
  &ZUP  = TQIAS003
  &ZCONT= TQIAS005
)END
./       ADD   NAME=TQIAS005
%TUTORIAL ----- ASID INFORMATION SAMPLE -------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+  23:53   -- ASID JOBS                                      SYSID=IPO1/
+ QUEV2 CMD=>
%ID DP ****** JOB ****** FLAGS  CPU-TIME REAL WORK  G/P/D  SRC SWC SERV
+13 66 RXFDWNLD HUDDMRFH APG    00:00:39 816K  84K  1/7/14          2MK
%
)PROC
  &ZUP  = TQIAS004
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIB001
%TUTORIAL -----REPOSITION TO BOTTOM OF DATASET ------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE TOP  COMMAND IS TO REPOSITION TO BOTTOM OF DATASET.
%
+SYNTAX:         BOTT
%
+ABBREVIATIONS:  BOT/B
%
+NO OPERANDS:
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQICA001
%TUTORIAL ----- CANCEL JOB --------------------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE CANCEL COMMAND IS TO CANCEL JOB.
%
+SYNTAX:         CANC JOBNAME <P>
%
+ABBREVIATIONS:  CAN/CA
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
+ -      P CAN BE AN OPTION FOR PURGE THE JOB FROM SPOOL.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQICC001
%TUTORIAL ---- LIST SYSIN/SYSOUT DSID WITH CARRIAGE CONTROL -----------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE CC COMMAND IS TO DISPLAY THE LIST OF A DSID OF THE
+  JOBNAME. EACH LINE WILL SHOW THE CARRIAGE CONTROL CHARACTER ON
+  THE FIRST CHARACTER OF THAT LINE IN DCB=RECFM=FA.
+ THE SPECIAL OPTION CONTROL TO SUPPRESS BLANK LINE BY ENTERING
+  "OPT NOBL" BEFORE ENTERING THE COMMAND CC. TO INCLUDE THE BLANK
+  LINES, ENTER "OPT BL" BEFORE ENTEING "CC'.
%
+SYNTAX:         CC JOBNAME DSID
%
+ABBREVIATIONS:  CC
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
% -DSID CAN BE DETERMINED BY USING SUBCOMMAND DD OR PDDB.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQICM001
%TUTORIAL ----- CHANNEL BUSY MONITOR  ---------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DM COMMAND IS TO DISPLAY THE DEVICE BUSY MONITOR OF
+  DEVICE UNIT.
%
+SYNTAX:         CM        (CHANNEL BUSY MONITOR)
+                CM CC     (CC=CHANNEL UNIT #)
+                CM CC,J  (BY JOB STATISTICS)
+                CM CC,D  (BY DEVICE STATISTICS)
%
+ABBREVIATIONS:  CM
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQICM002
)END
./       ADD   NAME=TQICM002
%TUTORIAL ----- CHANNEL MONITOR  SAMPLE -------------------------------T
%NEXT SELECTION ===>_ZCMD

+  23:55   -- CM                                             SYSID=IPO1/
+ QUEV2 CMD=>
+   CHANNEL BUSY MONITOR
+CHANNEL 01 BUSY       3% 0>
+CHANNEL 02 BUSY       0% >
+CHANNEL 03 BUSY       1% >
+CHANNEL 04 BUSY       0% >
+CHANNEL 05 BUSY       0% >
+CHANNEL 06 BUSY       3% 0>
+CHANNEL 07 BUSY      16% 0====1==>
+CHANNEL 08 BUSY       0% >
+CHANNEL 09 BUSY       0% >
+CHANNEL 10 BUSY       0% >
+CHANNEL 11 BUSY       0% >
+CHANNEL 12 BUSY       0% >
+CHANNEL 13 BUSY       0% >
+CHANNEL 14 BUSY       0% >
+CHANNEL 15 BUSY       0% >
%
)PROC
  &ZUP  = TQICM001
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQICO001
%TUTORIAL -----REPOSITION HORIZONTALLY TO COLUMN NUMBER ---------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE COL  COMMAND IS TO REPOSITION HORIZONALLY TO COLUMN NUMBE
+  WITHIN THE DATASET.
%
+SYNTAX:         COL  #
%
+ABBREVIATIONS:  CO
%
+OPERANDS:
+  #  CAN BE COLUMN NUMBER OF THE DATASET.
+
+  NOTES: PFK10 CAN BE "COL 1".
+         PFK11 CAN BE "COL 50'.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQICS001
%TUTORIAL ----- ISSUE SYSTEM CONSOLE COMMAND --------------------------T
%NEXT SELECTION ===>_ZCMD

%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+FUNCTION: THE CSYS COMMAND IS TO ISSUE SYSTEM COMMAND STRING TO SYSTEM
+  JES2. NO OUTPUT RESULT FROM SYSTEM/JES2 TO QUEUE IS DONE.  THIS COMMA
+  WILL  SEND SOME  COMMANDS TO SYSTEM/JES2 WITHOUT HAVE THE RESULT BACK
+  QUEUE SCREEN (ONE WAY COMMUNICATION).  THE SYSTEM CONSOLE WILL LOG YO
+  REQUEST AND DISPLAY THE RESULT ON SYSTEM CONSOLE.
%
+SYNTAX:         CSYS 'STRING'
%
+ABBREVIATIONS:  CS
%
+OPERANDS:
+ -'STRING' CAN BE THE STRING OF CHARACTERS OF ANY SYSTEMS/JES2 OPERATOR
+             COMMANDS.
%
+ EXAMPLE: CS $TOJ1234,OUTGRP=1.1.1,Q=T
+        -MEANS QUEUE WILL SEND A COMMAND OF "$TOJ1234,OUTGRP=1.1.1,Q=T"
+         TO SYSTEM CONSOLE.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDA001
%TUTORIAL ----- DISPLAY ALL JOBS IN EXCUTION --------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DA COMMAND IS TO DISPLAY ALL JOBS IN EXECUTION.
%
+SYNTAX:         DA
%
+NO ABBREVIATIONS NOR OPERANDS
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDC001
%TUTORIAL ----- DISPLAY CPU BATCH/STC/TSO -----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DC COMMAND IS TO DISPLAY CPU BATCH/STC/TSO.
%
+SYNTAX:         DC TYPE
%
+NO ABBREVIATIONS.
%
+OPERANDS: -TYPE CAN BE BLANK FOR ALL CPU TASKS,
+                           B FOR ALL CPU BATCH TASKS,
+                           S FOR ALL CPU STC TASKS, OR
+                           T FOR ALL CPU TSO TASKS.
%
+            (CONTINUE FOR OUTPUT DESCRIPTION)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIDC002
)END
./       ADD   NAME=TQIDC002
%TUTORIAL ----- DISPLAY CPU BATCH/STC/TSO -----------------------------T
%NEXT SELECTION ===>_ZCMD

% --------    THIS IS OUTPUT SAMPLE FOR A BATCH TASK  ------------------
+  QUEUE  JOBNAME   JOB#  STEPNAME PROCSTEP   SLOTS    TCB-TIME    SRB-T
+   XEQ B OPRREC     7609 STEP2                636K       0.49S       0.
+                                                             
+  TASK                                                        
+  TYPE                                                        
+  CLASS#                                                       
+  JOB NAME--#                                                   
+  JOB NUMBER#-------#                                            
+  NAMENOFESTEP ------------#                                      
+  PROCSTEP-(NAME OF PROCEDURE STEP) --#                            
+  SLOTSA(PAGE) --------------------------------#                    
+  TCB-TIME-(CPU TIME)--------------------------------------#         
+  SRB-TIME (IO TIME)-------------------------------------------------#
%                 (CONTINUE FOR SAMPLE OF A STC TASK)
)PROC
  &ZUP  = TQIDC001
  &ZCONT= TQIDC003
)END
./       ADD   NAME=TQIDC003
%TUTORIAL ----- DISPLAY CPU BATCH/STC/TSO -----------------------------T
%NEXT SELECTION ===>_ZCMD

% --------    THIS IS OUTPUT SAMPLE FOR STC TASKS ----------------------
+  QUEUE  JOBNAME   JOB#  STEPNAME PROCSTEP   SLOTS    TCB-TIME    SRB-T
+SYSTEM Q NET        7240          NETNCP     1020K      46.70S      19.
+SYSTEM Q TSO        7253          TCAS          0K       0.27S       0.
+SYSTEM Q CICPROD    7362          PRODCICS   3108K     292.16S      34.
+                                                             
+  TASK                                                        
+  TYPE                                                        
+  CLASS#                                                       
+  JOB NAME--#                                                   
+  JOB NUMBER#-------#                                            
+  NAME OF STEP ------------#                                      
+  PROCSTEP (NAME OF PROCEDURE STEP) --#                            
+  SLOTS (PAGE) --------------------------------#                    
+  TCB-TIME (CPU TIME)--------------------------------------#         
+  SRB-TIME (IO TIME)-------------------------------------------------#
%                 (CONTINUE FOR SAMPLE OF A TSO TASK)
)PROC
  &ZUP  = TQIDC002
  &ZCONT= TQIDC004
)END
./       ADD   NAME=TQIDC004
%TUTORIAL ----- DISPLAY CPU BATCH/STC/TSO -----------------------------T
%NEXT SELECTION ===>_ZCMD

% --------    THIS IS OUTPUT SAMPLE FOR TSO TASKS ----------------------
+  QUEUE  JOBNAME   JOB#  STEPNAME PROCSTEP   SLOTS    TCB-TIME    SRB-T
+TSO USER DOR        7527                      492K      10.06S       3.
+                                                             
+  TASK                                                        
+  TYPE                                                        
+  CLASS#                                                       
+  JOB NAME--#                                                   
+  JOB NUMBER#-------#                                            
+  NAME OF STEP ------------#                                      
+  PROCSTEP (NAME OF PROCEDURE STEP) --#                            
+  SLOTS (PAGE) --------------------------------#                    
+  TCB-TIME (CPU TIME)--------------------------------------#         
+  SRB-TIME (IO TIME)-------------------------------------------------#
%                 (CONTINUE FOR HOW TO ANALYSIS TASKS)
)PROC
  &ZUP  = TQIDC003
  &ZCONT= TQIDC005
)END
./       ADD   NAME=TQIDC005
%TUTORIAL ----- HOW TO ANALYSIS TASKS UNDER DC COMMAND ----------------T
%NEXT SELECTION ===>_ZCMD

%
+      LOOK FOR ACCUMULATION INCREASE EVERY TIME YOU PRESS "ENTER".
%
+  1. TCB-TIME - A. IF TCB-TIME DO NOT INCREASE, SYSTEM ENQUEUES IT.
+                B. IF TCB-TIME INCREASE WHILE SRB-TIME NOT, LOOPING
+                      OR LONG CPU EXECUTION MAY BE INVOLVED.
%
+  2. SRB-TIME - A. IF SRB-TIME DO NOT INCREASE WHILE TCB-TIME INCREASIN
+                      I/O DEVICE IS NOT USED.
+                B. IF BOTH SRB-TIME OR TCB-TIME NOT INCREASING, THE I/O
+                      DEVICE IS ENQUEUED.
%
+  3. SLOTS    - A. IF SLOTS EQUAL ZEROS, THE TASK IS SWAPPED OUT AS IDL
+                      OR IS ENQUEUED BY SYSTEM.
+                B. IF INCREASING, THE TASK IS GETMAINED OR REQUESTED WI
+                      INCREASING STORAGE SPACES  (NORMAL).
+
)PROC
  &ZUP  = TQIDC004
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDD001
%TUTORIAL ----- LIST SYSIN/SYSOUT DATASETS FOR A JOB ------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DD COMMAND IS TO DISPLAY THE LIST OF DATASETS OF THE
+  JOBNAME. EACH DATASET CAN BE DISPLAYED IN DATASET ID (DSID).
%
+SYNTAX:         DD JOBNAME
%
+ABBREVIATIONS:  DD
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDE001
%TUTORIAL ----- DELETE JOB --------------------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DELETE COMMAND IS TO DELETE JOB.
%
+SYNTAX:         DELE JOBNAME
%
+ABBREVIATIONS:  DEL/DE
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDF001
%TUTORIAL ----- DISPLAY OUTPUT QUEUES --------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DF COMMAND IS TO DISPLAY OUTPUT QUEUES.
%
+SYNTAX:         DF
%
+NO ABBREVIATIONS OR OPERANDS.
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDIE01
%TUTORIAL ----- GENERATE S0C1 FOR DEBUGGING  --------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DIE COMMAND IS TO TERMINTE QUEUE TO DUMP THE WHOLE
+           PROBLEM FOR FURTHER DEBUGGING. IT WILL GENERATE S0C1 ABEND.
%
+SYNTAX:         DIE
%
+NO ABBREVIATIONS NOR OPERANDS
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDI001
%TUTORIAL ----- DISPLAY ALL JOBS IN INPUT CLASS -----------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DI COMMAND IS TO DISPLAY ALL JOBS IN INPUT CLASS.
%
+SYNTAX:         DI CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDJ001
%TUTORIAL ----- DISPLAY JOB BY JOBNAME --------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DJ COMMAND IS TO DISPLAY JOB BY JOBNAME.
%
+SYNTAX:         DJ JOBNAME
%
+NO ABBREVIATIONS.
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDM001
%TUTORIAL ----- DEVICE BUSY MONITOR -----------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DM COMMAND IS TO DISPLAY THE DEVICE BUSY MONITOR OF
+  DEVICE UNIT.
%
+SYNTAX:         DM DDD       (DDD=DEVICE UNIT #)
+                DM DDX       (DDX CATEGORY OR GROUP)
+                DM DDD,J     (STATISTICS BY JOB NAME)
+                DM DDD,S     (SEEK ANALYSIS BY CYLINDER)
%
+ABBREVIATIONS:  DM
%
+OPERANDS:
+ -DDD CAN BE DEVICE UNIT NUMBER. I.E 301,302., 416, 5AE, ...
+ -DDX CAN BE DEVICE UNIT NUMBER IN CATEGORY OR GROUP. FOR EXAMPLE,
+     30X CAN BE  GROUPED DEVICES FROM 300 TO 30F.
+     30X CAN BE  GROUPED DEVICES FROM 300 TO 30F.
+ - INTERVAL TIME WILL BE 30 SECONDS BETWEEN THE COMMANDS.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIDM002
)END
./       ADD   NAME=TQIDM002
%TUTORIAL ----- DISPLAY DEVICE MONITOR SAMPLE -------------------------T
%NEXT SELECTION ===>_ZCMD

+  23:49   -- DM 60X                                         SYSID=IPO1/
+ QUEV2 CMD=>
+ DEVICE BUSY MONITOR
+601 SCR001 BUSY  22%  2% 0====1====2>
+603 SCR002 BUSY  74% 59% 0====1====2====3====4====5====6====7=>
+605 8DBP02 BUSY 100%100% 0====1====2====3====4====5====6====7====8====9
%
+                 (CONTINUE FOR MORE OUTPUT SAMPLE)
)PROC
  &ZUP  = TQIDM001
  &ZCONT= TQIDM003
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIDM003
%TUTORIAL ----- DISPLAY DEVICE MONITOR SAMPLE -------------------------T
%NEXT SELECTION ===>_ZCMD

+  23:50   -- DM 60X,J                                       SYSID=IPO1/
+ QUEV2 CMD=>
+ DEVICE BUSY MONITOR
+601 SCR001 BUSY  30%  0% 0====1====2====>
+-- RXFDWNLD      30%  0%
+603 SCR002 BUSY  65% 60% 0====1====2====3====4====5====6=>
+-- RXFDWNLD      65% 60%
+605 8DBP02 BUSY 100%100% 0====1====2====3====4====5====6====7====8====9
+-- *MASTER*     100%100%
%
)PROC
  &ZUP  = TQIDM002
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIDO001
%TUTORIAL ----- DISPLAY ALL JOBS IN OUTPUT CLASS ----------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DO COMMAND IS TO DISPLAY ALL JOBS IN OUTPUT CLASS.
%
+SYNTAX:         DO CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDQ001
%TUTORIAL ----- DISPLAY INPUT QUEUES ---------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DQ COMMAND IS TO DISPLAY INPUT QUEUES.
%
+SYNTAX:         DQ
%
+NO ABBREVIATIONS OR OPERANDS.
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDS001
%TUTORIAL ----- DISPLAY SYSTEM TASKS (STC)-----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DS COMMAND IS TO DISPLAY SYSTEM TASKS.
%
+SYNTAX:         DS
%
+NO ABBREVIATIONS NOR OPERANDS.
%
%
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIDT001
%TUTORIAL ----- DISPLAY TSO USERS -------------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE DT COMMAND IS TO DISPLAY TSO USERS.
%
+SYNTAX:         DT
%
+NO ABBREVIATIONS NOR OPERANDS
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQID001
)BODY DEFAULT(%@_)
%TUTORIAL -----REPOSITION FORWARD IN DATASET # RECORDS ----------------T
%NEXT SELECTION ===>_ZCMD

%
@FUNCTION: THE D COMMAND IS TO REPOSITION FORWARD IN DATASET # RECORDS
@  WITHIN THE DATASET.
@
@SYNTAX:         D   #
@
@ABBREVIATIONS:  +
%
@OPERANDS:
@  #  CAN BE RECORD/LINE NUMBER OF THE DATASET. THE TOP NUMBER OF THE
@     DATASET CAN BE 1. THE BOTTOM NUMBER OF THE DATASET CAN BE DETERMIN
@     BY USING SUBCOMMAND DD. DEFAULTS IS 1.
%
@ EXAMPLE:  D 1000  - THE CMD WILL REPOSTION TO 1000TH RECORD OF THE DAT
@                     FROM THE NUMBER OF THE SCREEN.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIFA001
%TUTORIAL ----- FIND ALL OCCURANCES OF STRING -------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE FIND COMMAND IS TO FIND CHARACTER STRINGS WITHIN
+  A DATASET FOR A JOB.
%
+SYNTAX:         FALL 'STRINGS' COL(SS,EE)
%
+ABBREVIATIONS:  FA
%
+OPERANDS:
+  'STRINGS' CAN BE CHARACTER STRINGS. IT CAN BE QUOTED OR NOT. IT CAN B
+            ALPHABETIC, NUMERIC, OR ANY CHARACTER.
+   COL(SS,EE) CAN BE THE COLUMN NUMBER WHICH THE STRING CAN BE FOUND.
+          SS IS THE START COLUMN NUMBER.
+          EE IS THE END COLUMN NUMBER.
%
+ EXAMPLE: FA DOG   - THE CMD WILL SEARCH "DOG" IN ANY WHERE OF DATASET.
+          FA DOG COL(50 60) - THE CMD WILL SEARCH "DOG" IN THE COLUMNS
+                              BETWEEN 50 AND 60.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIFO001
%TUTORIAL ----- DISPLAY ALL JOBS IN OUTPUT CLASS BY FORMS/FCB ---------T
%NEXT SELECTION ===>_ZCMD

+FUNCTION: THE FO COMMAND IS TO DISPLAY  ALL IN OUTPUT CLASS BY FORMS/FC
%
+SYNTAX:         FO Q=U C=VVVV F=WWWW R=RMTYYYY 
+                   Q^U C^VVVV F^WWWW R^RMTYYYY 
+OPERANDS:
+  Q@U            WHERE    U = SYSOUT CLASS
+  C@VVVV         WHERE VVVV = FCB IMAGE
+  F@WWWW         WHERE WWWW = FORMS
+  R@RMTYYYY      WHERE YYYY = REMOTE ID (R@'BLANK' = LOCAL DEFAULT)
%
+  NOTES:  @ MEANS "=" (INCLUDE) OR  "^" (EXCLUDE)
%
+  THE ABOVE OPERANDS MAY BE MIXED AND BE ENTERED IN ANY ORDER.
%
+               (CONTINUE FOR SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIFO002
  &ZINDEX = TQINDEXA
)END
./       ADD   NAME=TQIFO002
%TUTORIAL ----- DISPLAY ALL JOBS IN OUTPUT CLASS BY FORMS/FCB ---------T
%NEXT SELECTION ===>_ZCMD

%
+  FOR EXAMPLE:
+   FO Q=X F^STD   -WOULD SHOW ALL SYSOUT=X THAT DO NOT USE A STANDARD F
+   FO Q^X F^STD   -WOULD SHOW ALL SYSOUT (EXCEPT SYSOUT=X) THAT DO NOT
+                                      A STANDARD FORM.
+   FO Q=A R^      -WOULD SHOW ALL SYSOUT=A THAT ARE NOT IN LOCAL DESTIN
+   FO R=          -WOULD SHOW ALL SYSOUTS  THAT ARE FOR LOCAL DESTINATI
+   FO F=6CL1      -WOULD SHOW ALL SYSOUT THAT HAVE SPECIAL FORMS NAMED
+   FO F^STD       -WOULD SHOW ALL SYSOUT THAT REQUIRE SPECIAL FORMS.
%
+           (CONTINUE FOR OUTPUT DESCRIPTION)
)PROC
  &ZUP  = TQIFO001
  &ZCONT= TQIFO003
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIFO003
%TUTORIAL ----- OUTPUT DESCRIPTION FOR FO COMMAND ---------------------T
%NEXT SELECTION ===>_ZCMD
+  QUEUE   POS   JOBNAME     JOB#   PRIO   LINES  FORM     FCB ---STATU
+OUTPUT A    1   STOR        7596     1    18252  STD      **** PRINTER1
+OUTPUT A    1   TSCDL2RP    6919     1      209  STD      ****
+OUTPUT E    1   PSTGENPR    7765     1      836  6CL1     ****
+OUTPUT E    2   NIHGA10     7720     1      143  6CH1     **** PRINTER2
+OUTPUT M    1   CICTEST     7361     1       33  STD      ****
+OUTPUT M    2   CICESA      4875     1     4636  STD      ****
+OUTPUT T    1   TLS195TX    7790     1    25227  8ST1     ****
+OUTPUT M    1   CICTEST     7361     1       33  STD      ****
+                                                            
+  CLASS#                                                     
+  POSITION--#                                                 
+  JOB NAME & NO. ---#----------#                                
+  PRIORITY LEVEL --------------------#                           
+  NUMBER OF LINES AVAILABLE TO PRINT----------#                   
+  FORM NAME -------------------------------------#                 
+  FCB (*** = UNKNOWN)-------------------------------------#         
+  STATUS (LEFT ADJUSTED = ON PRINTER/RIGHT ADJUSTED = AWAITING)-----#
+         (BLANKED = AWAITING FOR LOCAL PRINTER)
)PROC
  &ZUP  = TQIFO002
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIFR001
%TUTORIAL ----- DISPLAY STORAGE INFORMATION ---------------------------T
%NEXT SELECTION ===>_ZCMD

+FUNCTION: THE FR COMMAND IS TO DISPLAY STORAGE INFORMATION.
%
+SYNTAX:         FR  B (BAD FRAME REQUEST)         OR
+                    C (CSA DISPLAY REQUEST)       OR
+                    R (V=R DISPLAY REQUEST)       OR
+                    M (MEGABYTE DISPLAY REQUEST)  OR
+                    O (OFFLINE INTERCEPT REQUEST)   
+NO OPERANDS:        DISPLAY PAGE FRAME ASSIGNMENTS
%
+               (CONTINUE FOR OUTPUT SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIFR002
  &ZINDEX = TQINDEXA
)END
./       ADD   NAME=TQIFR002
%TUTORIAL ----- DISPLAY CSA VIRTUAL STORAGE USAGE   -------------------T
%NEXT SELECTION ===>_ZCMD

+<--DESCRIPTION ---> <---------- "FR C" OUPUT SAMPLE   ------------>
+ HEADING INFO ---->         COMMON STORAGE AREA- CSA             
+ CSA INFO --------> CSA SIZE =      2132K    CSA ADDR =   880000 
+ SQA INFO --------> SQA FREE =        12K   SQA AVAIL =     656K 
+ NUCLEUS INFO ----> NUC END =      00F300     SEG END =   100000 
+ V=R INFO --------> V=R SIZE =       100K    V=R ADDR =   104000 
+ PRIVATE INFO ----> PRV SIZE =      7564K    PRV ADDR =   11D000 
+ CSA ALLOCATE AREA> ALLOCATED   SIZE=    628K     ADDR =  880000 
+ CSA FREE AREA ---> FREE        SIZE=      4K     ADDR =  91D000 
+ CSA ALLOCATE AREA> ALLOCATED   SIZE=      4K     ADDR =  91E000 
+ CSA FREE AREA ---> FREE        SIZE=      4K     ADDR =  91F000 
+                    <--------------------------------------------->
%
+                 (CONTINUE FOR MORE OUTPUT SAMPLE)
)PROC
  &ZUP  = TQIFR001
  &ZCONT= TQIFR003
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIFR003
%TUTORIAL ----- DISPLAY THE V=R AREA ----------------------------------T
%NEXT SELECTION ===>_ZCMD
+  FR R - TO DISPLAY THE V=R AREA SHOWING FRAME ALLOCATION,  INCLUDING
+         NO. OF FRAMES, OWNING ASID AND PFT FLAGS.
+<-DESCRIPTION -> <---------- "FR R" OUPUT SAMPLE   --------------------
+ HEADING INFO -> PAGES.ASID.   FRAME STATUS/FLAGS
+ MASTER PAGE---> 001...0000...OFFLINE INTERCEPT BAD PAGE        LOCAL
+ EXTRA SQA-----> 001   2001   OFFLINE INTERCEPT LSQA/SQA PAGE   SQA RE
+                 <-----------------------------------------------------
+PAGES COLUMN- NO. OF FRAMES OWNED BY THIS ASID AND WITH THESE FLAGS IN
+ASID COLUMN - ASID OF ADDRESS SPACE LAST TO OWN OR CURRENTLY OWNING TH
+               FRAMES. FFFF INDICATES NO OWNER.
+FRAME STATUS- THE FOLLOWING MEANINGS OF PTFE FLAGS
+ FIRST PTFE FLAG    SECOND PTFE FLAG      FRAME QUEUE STATUS
+ OFFLINE            BAD FRAME             AVAILABLE QUEUE
+ OFFLINE INTERCEPT  LONG TERM FIXED       SQA RESERVED QUEUE
+ V=R ALLOCATE       SQA/LSQA FRAME        COMMON QUEUE
+ V=R INTERCEPT      VIO FRAME             SQA QUEUE
+ AVAILABLE                                LOCAL QUEUE
+                                          LSQA QUEUE
+                                          NOT QUEUED
+               (CONTINUE FOR MORE OUTPUT SAMPLE)
)PROC
  &ZUP  = TQIFR002
  &ZCONT= TQIFR004
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIFR004
%TUTORIAL ----- DISPLAY PAGE FRAME ASSIGNMENTS ------------------------T
%NEXT SELECTION ===>_ZCMD

+<-DESCRIPTION -> <---------- "FR " OUPUT SAMPLE   ---------------->
+ HEADING INFO -->           CPU STORAGE USAGE                    
+ TOTAL PAGES --->   TOTAL       3756   15024K                    
+ NUCLEUS PAGES-->   NUCLEUS       15      60K                    
+ TOTAL FIXED --->   TOT FIXED    526    2104K                    
+ SQA FIXED PAGES>   SQA FIXED    202     808K                    
+ CSA FIXED PAGES>   CMN FIXED     94     376K                    
+ SYSTEM PAGES--->   SYS PAGES      0       0K      SQA=      0K  
+ MASTER PAGES--->   MASTER         0       0K      LSQA=     0K  
+                                   1       4K      LSQA=     4K  
+                                   1       4K      LSQA=     0K  
+                 <------------------------------------------------>
+               (CONTINUE FOR MORE OUTPUT SAMPLE)
%
)PROC
  &ZUP  = TQIFR003
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIFT001
%TUTORIAL ----- REPOSITION SYSTEM LOG TO GIVEN TIME -------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE FTIME COMMAND IS TO REPOSTION SYSTEM LOG TO GIVEN TIME.
%
+SYNTAX:         FTIME     HH.MM.SS
%
+ABBREVIATIONS:  FT
%
+OPERANDS:
+  HH.MM.SS  CAN BE HOUR, MINUTES, SECONDS OF CLOCK TIME.
+
%
+ EXAMPLE:  FT 10.30   -  THE CMD WILL REPOSITION SYSLOG TO GIVEN HH.MM.
+           FT 15.55.10 - THE CMD WILL REPOSTION SYSLOG TO GIVEN HH.MM.S
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIF001
%TUTORIAL ----- FIND CHARACTER STRINGS --------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE FIND COMMAND IS TO FIND CHARACTER STRINGS WITHIN
+  A DATASET FOR A JOB.
%
+SYNTAX:         FIND 'STRINGS' COL(SS,EE)
%
+ABBREVIATIONS:  F
%
+OPERANDS:
+  'STRINGS' CAN BE CHARACTER STRINGS. IT CAN BE QUOTED OR NOT. IT CAN B
+            ALPHABETIC, NUMERIC, OR ANY CHARACTER.
+   COL(SS,EE) CAN BE THE COLUMN NUMBER WHICH THE STRING CAN BE FOUND.
+          SS IS THE START COLUMN NUMBER.
+          EE IS THE END COLUMN NUMBER.
%
+ EXAMPLE:  F DOG   - THE CMD WILL SEARCH "DOG" IN ANY WHERE OF DATASET.
+           F DOG COL(50 60) - THE CMD WILL SEARCH "DOG" IN THE COLUMNS
+                              BETWEEN 50 AND 60.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIHB001
%TUTORIAL ----- FORWARD/BACKWARD # HALF PAGES -------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE HF/HB COMMAND IS TO SCROLL HALF PAGES FORWARD OR BACKWARD
+  WITHIN THE DATASET.
%
+SYNTAX:         HF   # (FORWARD)
+                HB   # (BACKWARD)
%
+OPERANDS:
+  #  CAN BE NUMBER OF HALF-PAGE OF THE DATASET.
%
+ EXAMPLE:  HB 100  - THE CMD WILL REPOSTION TO 100TH HALF-PAGE.
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIHF001
%TUTORIAL ----- FORWARD/BACKWARD # HALF PAGES -------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE HF/HB COMMAND IS TO SCROLL HALF PAGES FORWARD OR BACKWARD
+  WITHIN THE DATASET.
%
+SYNTAX:         HF   # (FORWARD)
+                HB   # (BACKWARD)
%
+OPERANDS:
+  #  CAN BE NUMBER OF HALF-PAGE OF THE DATASET.
%
+ EXAMPLE:  HF 100  - THE CMD WILL REPOSTION TO 100TH HALF-PAGE.
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIHI001
%TUTORIAL ----- DISPLAY HELD JOBS IN INPUT CLASS ----------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE HI COMMAND IS TO DISPLAY HELD JOBS IN INPUT CLASS.
%
+SYNTAX:         HI CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIHO001
%TUTORIAL ----- DISPLAY HELD OUTPUT -----------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE HO COMMAND IS TO DISPLAY HELD OUTPUT.
%
+SYNTAX:         HO CLASS
%
+NO ABBREVIATIONS.
%
+OPERANDS: -CLASS CAN BE BLANK FOR ALL CLASSES,  OR A VALID CHARACTER
+                   THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIJC001
%TUTORIAL ----- LIST JCL FOR A JOB ------------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE JCL COMMAND IS TO LIST JCL LISTING FOR A JOB.
%
+SYNTAX:         JCL JOBNAME
%
+ABBREVIATIONS:  JC
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIJH001
%TUTORIAL ----- LIST JOB HISTORY INFORMATION   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE JHIS COMMAND IS TO DISPLAY INFORMATION ABOUT A JOB.
%
+SYNTAX:         JHIS JOBNAME
%
+ABBREVIATIONS:  JH
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIJL001
%TUTORIAL ----- LIST JOBLOG FOR A JOB ---------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE JLOG COMMAND IS TO LIST JOBLOG FOR A JOB.
%
+SYNTAX:         JLOG JOBNAME
%
+ABBREVIATIONS:  JL
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIJM001
%TUTORIAL ----- LIST SYSTEM MESSAGES FOR A JOB ------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE JMSG COMMAND IS TO LIST SYSTEM MESAGES FOR A JOB.
%
+SYNTAX:         JMSG JOBNAME
%
+ABBREVIATIONS:  JM
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIJO001
%TUTORIAL ----- DISPLAY STATUS OF JOBS --------------------------------T
%NEXT SELECTION ===>_ZCMD
%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+FUNCTION: THE JOBS COMMAND IS TO DISPLAY STATUS OF JOBS.
%
+SYNTAX:         JOBS <DOMAIN NUM>
+                     .<JOBNAME>  
+                     A/J/S/T/I   
+ABBREVIATIONS:  JO
+OPERANDS:
+  <DOMAIN NUM> -CAN BE THE DOMAIN NUMBER (00 - 255).
+  .<JOBNAME>   -CAN BE A JOBNAME. THE FIRST CHARACTER MUST BE A PERIOD.
+                 ANY LENGTH OF JOBNAME CAN BE ACCEPTED. IE .CIC TO LIST
+                 THAN ONE APPLICATIONS BEGIN WITH "CIC".
+  A            -SELECT ALL JOB, TSU, AND STC.
+  J            -SELECT ALL JOBS.
+  T            -SELECT ALL TSO USERS.
+  S            -SELECT ALL STARTED TASKS.
+  I            -SELECT ALL IDLE INITIATORS.
%                  (CONTINUE)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIJO002
)END
./       ADD   NAME=TQIJO002
)BODY DEFAULT(%$_)
%TUTORIAL ----- DISPLAY STATUS OF JOBS --------------------------------T
%NEXT SELECTION ===>_ZCMD
$OUTPUT DESCRIPTION: %*** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
%                      <- SWAP STATUS-> PERF GRP DPRTY OUTS   DP  AUX SL
%JOBNAME  ASID DMN DP  WHY  IN OUT  CNT NW/RS/SP NW/RL  ENQ QUE#  NVAM/V
$MASTER   0001 00 255      000 000 0000 00/0F/00 FF/FF  000   01  0295 0
$DUMPSRV  0004 00-255   DT/008 008 0002 00/0F/00 FF/FF  000   67  0008 0
$                                                   
$JOBNAME                                             
$ASID--------+                                        
$DOMAIN NUMBER--+                                      
$ASCB DISP PRTY-----+                                   
$SWAP REASON-------------+                               
$SWAP-IN COUNTS--------------+                            
$PAGES SWP AT LAST SWPOUT--------+                         
$TRANSACTION SWAP COUNT---------------+                     
$PERFORMANCE GROUP NUMBERS (NEW/RESET/SPECIFY)-+             
$DPRTY NUMBERS (NEW/REAL)----------------------------+        
$NO. OF OUTSTANDING ENQHOLDS------------------------------+    
$SEQ. # REPRESENTS ASCB'S POSITION ON THE DISPATCHING QUEUE----+
$ALLOC AUXILIARY SLOT CNT (NONVAM/VAM) ---------------------------------
%                      (CONTINUE)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIJO003
)END
./       ADD   NAME=TQIJO003
)BODY DEFAULT(%$_)
%TUTORIAL ----- DISPLAY STATUS OF JOBS --------------------------------T
%NEXT SELECTION ===>_ZCMD
%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
$OUTPUT DESCRIPTION:
$   SWAP REASONS: OTW =  OUTPUT TERMINAL WAIT
$                 ITW = INPUT TERMINAL WAIT
$                  LW =  LONG WAIT
$                 ASS = AUXILIARY STORAGE SHORTAGE
$                 RSS = REAL PAGEABLE STORAGE SHORTAGE
$                  DT = DETECTED WAIT
$                  RS = REQUESTED SWAP
$                  EE = ENQ EXCHANGE
$                 ERV = EXCHANGE OF RECOMMENDATION VALUE
$                   U = UNILATERAL
)PROC
  &ZUP  = TQIJO002
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIL001
%TUTORIAL -----LIST A SYSIN OR SYSOUT DATASETS FOR A JOB --------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE LIST COMMAND IS TO LIST A SYSIN/SYSOUT DATASETS
+  FOR A JOB. EACH JOBNAME CAN BE TSO USERID, JOBNAME BEGIN
+  WITH USERID, OR ANY TASK NAME FOUND IN SPOOL DATASET.
%
+SYNTAX:         LIST JOBNAME DSID
%
+ABBREVIATIONS:  L
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
+
+     DSID CAN BE THE DATASET ID NUMBER RANGED FROM 101 TO 999 AS
+          IT CAN BE DETERMINED BY USING SUBCOMMAND DD OR PDDB.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIL002
)END
./       ADD   NAME=TQIL002
)BODY DEFAULT(%$_)
%TUTORIAL -----LIST NEXT OR PREVIOUS N'TH DATASET ---------------------T
%NEXT SELECTION ===>_ZCMD

%
$FUNCTION: THE LIST COMMAND IS TO SCROLL NEXT OR PREVIOUS N'TH DATASET.
$          IT CAN  BE BROUGHT TO SCROLL THE DATASET BY MOVING THE
$          DATASET UPWARD OR DOWNWARD OF THE SCREEN.
%
$SYNTAX:         LIST   *   -/+N
%
$ABBREVIATIONS:  L
%
$OPERANDS:
$  *       CAN BE CURRENT JOBNAME. "-" IS ALSO SYNONYM FOR "*'.
$
$  -N OR   CAN BE THE NUMBER OF LINES TO BE UPWARD OR DOWNWARD OF
$  +N      THE DATASET. "-N" IS THE NUMBER OF LINES TO BE SCROLLED
$          TOWARD THE TOP OF THE DATASET. "+N" IS THE NUMBER OF LINES
$          TO BE SCROLLED TOWARD THE BOTTOM OF THE DATASET.
%
$  EXAMPLE: L  -  +5
$         - SCROLLS SCREEN  BY FIVE LINES TOWARD THE BOTTOM OF THE
$           DATASET.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIMD001
%TUTORIAL -----REPOSITION TO SPECIFIC RECORD NUMBER -------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE MD   COMMAND IS TO REPOSITION TO SPECIFIC RECORD NUMBER
+  WITHIN THE DATASET.
%
+SYNTAX:         MD   #
%
+ABBREVIATIONS:  @
%
+OPERANDS:
+  #  CAN BE RECORD/LINE NUMBER OF THE DATASET. THE TOP NUMBER OF THE
+     DATASET CAN BE 1. THE BOTTOM NUMBER OF THE DATASET CAN BE DETERMIN
+     BY USING SUBCOMMAND DD.
+   WARNING: THE LARGE NUMBER OF A DATASET WILL BE LIMITED OR THE QUEUE
+      ERROR MESSAGE " DATASET TABLE LIMITS EXCEEDED" WILL BE APPEARED.
+      TO SOLVE THAT PROBLEM, ENTER "@ #" WHERE # IS NOT MORE THAN 50000
%
+ EXAMPLE:  @ 1000  - THE CMD WILL REPOSTION TO 1000TH RECORD OF THE DAT
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIMO001
%TUTORIAL ----- SET 3270 MODEL TO 2, 3, 4, OR 5 -----------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE MODE COMMAND IS TO SET 3270 MODEL TO 2, 3, 4, OR 5.
+
%
+SYNTAX:         MODEL  #
%
+ABBREVIATIONS:  MO/M
%
+OPERANDS:
+  #  CAN BE MODEL NUMBER. CAN BE USE 2, 3, 4, OR 5.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIMP001
%TUTORIAL ----- MPL - MULTIPLE PROGRAMMING LEVEL ----------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE MPL COMMAND IS TO DISPLAY MULTIPLE PROGRAMMING LEVEL.
+
%
+SYNTAX:         MPL        (ALL OF DOMAINS IN THE SYSTEM)
+                MPL P N    (ALL OR SELECTED PERFORMANCE NUMBER)
+                MPL D      (ALL OD DOMAINS IN THE SYSTEM)
%
+ABBREVIATIONS:  MP
%
+OPERANDS:
+  N  CAN BE PERFORMANCE NUMBER I.E 1, 2, 3 ,4 .. ETC.
% (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIMP002
)END
./       ADD   NAME=TQIMP002
%TUTORIAL ----- MPL - MULTIPLE PROGRAMMING LEVEL - SAMPLES ------------T
%NEXT SELECTION ===>_ZCMD

%
%  09:17   -- MPL                                            SYSID=IPO1/
% QUEV2 CMD=>
+CURRENT IPS=%IEAIPS00 +OPT=%IEAOPT00 + ICS=%IEAICS00
+    <----- MPL ------>  A:M <- STATUS OF USER-><-WEIGHT-> <MPL TGT CNTL
+DMN MIN  MAX  TGT CURR  RUA GOOU OUTU  INC  NSW TWSR  TWT AOBJ DOBJ FWK
%  0  255  255  255    0 0:0     0    0    0    2   14    0    0    0
%  1   20   30   20    1 1:1     0    0    1    1  108    0    2    2
%  2   20   30   20    4 5:4     0    0    3    0 1060    0    3    3
%  3   20   30   20    1 0:1     0    0    0    0  173    0  256    0
%  4   20   30   20    1 1:1     0    0    1    0  243    0  256    0
%  5   20   30   20    0 0:0     0    0    0    0   17    0    3    3
%  6   20   30   20    0 0:0     0    0    0    3    2    0    0    0
%  7   15   15   15    0 0:0     0    0    0    2  173    0    0    0
%  8   15   15   15    0 0:0     0    0    0    2  586    0    0    0
%  9    1   15    1    0 0:0     0    0    0    2   50    0    0    0
% 10   15   15   15    0 0:0     0    0    0    1   37    0    0    0
%                                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQIMP001
  &ZCONT= TQIMP003
)END
./       ADD   NAME=TQIMP003
%TUTORIAL ----- MPL - MULTIPLE PROGRAMMING LEVEL - SAMPLES ------------T
%NEXT SELECTION ===>_ZCMD

%  09:18   -- MPL P                                          SYSID=IPO1/
% QUEV2 CMD=>
+CURRENT IPS=%IEAIPS00 + OPT=%IEAOPT00  +ICS=%IEAICS00
+ PG PD OBJ DMN IODP DISP <-TIME SLICE-> <WORKSET><PAGERATE>          <-
+  #  #   #   # PRTY PRTY   DP  GRP  RTO  LOW HIGH LOW  HIGH  ISV  DUR P
%  1  1   3   1  112  117  255  255                           30K  10K
%     2   4   2  112  117  255  255                           30K 150K
%     3   4  16  112  117  255  255                           30K 400K
%     4   5  14   96  101  255  255                           10K
%  2  1   1   3  191  191  255  255  195                     200K  700
%     2   2   4  190  190  255  255                          150K 2000
%     3   3   5  192  197  255  255                          120K  10K
%     4   4   5  176  181  255  255                          100K
%  3  1   2   3  176  181  255  255                           50K  50K
%     2   2   4  160  165  255  255                          100K
%  4  1   5   2   96  101  255  255                           10K
%  5  1   4   6  186  186  255  255                           30K
%  6  1   1   8  237  237  255  255       250  750    2    5 100K     WK
%  7  1   1   9  192  197  255  255                          300K
%                                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQIMP002
  &ZCONT= TQIMP004
)END
./       ADD   NAME=TQIMP004
%TUTORIAL ----- MPL - MULTIPLE PROGRAMMING LEVEL - SAMPLES ------------T
%NEXT SELECTION ===>_ZCMD

%  09:18   -- MPL P 1                                        SYSID=IPO1/
% QUEV2 CMD=>
+CURRENT IPS=%IEAIPS00 + OPT=%IEAOPT00  +ICS=%IEAICS00
+ PG PD OBJ DMN IODP DISP <-TIME SLICE-> <WORKSET><PAGERATE>          <-
+  #  #   #   # PRTY PRTY   DP  GRP  RTO  LOW HIGH LOW  HIGH  ISV  DUR P
%  1  1   3   1  112  117  255  255                           30K  10K
%     2   4   2  112  117  255  255                           30K 150K
%     3   4  16  112  117  255  255                           30K 400K
%     4   5  14   96  101  255  255                           10K
%                                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQIMP003
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQINDEXA
)BODY DEFAULT(%$_)
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% +/D  $#         - REPOSITION FORWARD IN DATASET # RECORDS
% -/UP $#         - REPOSITION BACKWARD IN DATASET # RECORDS
% @/MD $#         - REPOSITION TO SPECIFIC RECORD NUMBER
% AI   $CLASS     - DISPLAY JOBS AVAILABLE FOR PROCESSING
% ALLO $D/T/M/V/B - (D=DISK, T=TAPE, M=MOUNTS V=VARIED B=BOTH)
% ALLO $S=VVVVVV  - (VVVVVV=FULL VOLSER NAME)
% ALLO $U=XXX     - (XXX=UNIT NUMBER)
% AM   $          - (ALL ACTIVITY MONITOR)
% AM   $ D        - (DOMAIN ACTIVITY MONITOR)
% AM   $ I        - (INIT ACTIVITY MONITOR)
% AM   $ J        - (JOB ACTIVITY MONITOR)
% AM   $ S        - (STC ACTIVITY MONITOR)
% AM   $ T        - (TSO ACTIVITY MONITOR)
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT = TQINDEXB
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXB
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% AO    +CLASS          - DISPLAY AVAILABLE OUTPUT
% ASID  +"ASID#"/*      - DISPLAY ASID BY NUMBER OR "*" AS TSOSESSION
% ASID  +STC/JOBS/TS/ALL- DISPLAY ASID INFORMATION BY SPECIFIED GROUP
% B/BOT +               - REPOSITION TO BOTTOM OF DATASET
% CAN   +JOBNAME <P>    - CANCEL JOB ("P" OPTION FOR PURGE)
% CC    +JOBNAME DSID   - LIST A SYSIN/SYSOUT DSN WITH
% CM    +CC             - CHANNEL BUSY MONITOR   (CC=CHANNEL UNIT #)
% CM    +CC,D           - CHANNEL BUSY MONITOR   BY DEVICE STATISTICS
% CM    +CC,J           - CHANNEL BUSY MONITOR   BY JOB STATISTICS
% COL   +#              - REPOSITION HORIZONTALLY TO COLUMN NUMBER
% CSYS  +"ANY SYSTEM/JES2 COMMAND" - ISSUE SYSTEMS CONSOLE COMMAND
%
)PROC
  &ZUP = TQINDEXA
  &ZCONT = TQINDEXC
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXC
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% CZAP +>AAAA,SSSSSS/VVVVVVVV/RRRRRRRR
% CZAP +>AAAA,SSSSSS,LL
% CZAP +CHAP,AAAA,DDD              - SET ASID AAAA TO DPRTY=DDD
% CZAP +EXIT,AAAA                  - TERMINATE MEMORY FOR ASID AAAA
% CZAP +NOCANC,AAAA                - SET ASID AAAA NON-CANCELLABLE
% CZAP +NOSWAP,AAAA                - SET ASID AAAA NON-SWAPABLE
% CZAP +OKCANC,AAAA                - SET ASID AAAA CANCELABLE
% CZAP +OKSWAP,AAAA                - SET ASID AAAA SWAPABLE
% CZAP +SSSSSS/VVVVVVVV/RRRRRRRR
% CZAP +SSSSSS,LL
% CZAP +UNNN                       - UCB
% DA   +                           - DISPLAY ALL JOBS IN EXECUTION
% DC   +TYPE (B/J/S/T)             - DISPLAY CPU BATCH/STC/TSO
%
)PROC
  &ZUP  = TQINDEXB
  &ZCONT = TQINDEXD
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXD
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% DD  +JOBNAME      - LIST SYSIN/SYSOUT DATASETS FOR A JOB
% DEL +JOBNAME      - DELETE JOB
% DF  +             - DISPLAY OUTPUT QUEUES
% DI  +CLASS        - DISPLAY ALL JOBS IN INPUT CLASS
% DJ  +JOBNAME      - DISPLAY JOB BY JOBNAME
% DM  +DDD          - DEVICE BUSY MONITOR  BY DEVICE UNIT #
% DM  +DDX          - DEVICE BUSY MONITOR  BY CATEGORY OR GROUP
% DM  +DDD,J        - DEVICE BUSY MONITOR  BY JOB STATISTICS
% DM  +DDD,S        - DEVICE BUSY MONITOR  BY CYLINDER STATISTICS
% DO  +CLASS        - DISPLAY ALL JOBS IN OUTPUT CLASS
% DQ  +             - DISPLAY INPUT QUEUES
% DS  +             - DISPLAY SYSTEM TASKS
% DT  +             - DISPLAY TSO USERS
%
)PROC
  &ZUP = TQINDEXC
  &ZCONT = TQINDEXE
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXE
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% FALL  +'STRING' COL(SS,EE)  - FIND ALL OCCURRENCES OF
% FIND  +'STRING' COL(SS,EE)  - FIND CHARACTER STRING
% FO    + SEE TUTORIALS       - DISPLAY ALL JOBS IN OUTPUT CLASS BY FORM
% FRAME + B                   - BAD FRAME REQUEST
% FRAME + C                   - CSA DISPLAY REQUEST
% FRAME + M                   - MEGABYTE DISPLAY REQUEST
% FRAME + O                   - OFFLINE INTERCEPT REQUEST
% FRAME + R                   - V=R DISPLAY REQUEST
% FTIME +HH.MM.SS             - REPOSITION SYSTEM LOG TO GIVEN TIME
% HCT   +                     - DISPLAY HCT $SAVE AREA
% HF/HB +#                    - FORWARD/BACKWARD # HALF PAGES
% HI    +CLASS                - DISPLAY HELD JOBS IN INPUT CLASS
% HO    +CLASS                - DISPLAY HELD OUTPUT
% IOT   +JOBNAME              - DISPLAY IOTS IN HEX/EBCDIC
%
)PROC
  &ZUP  = TQINDEXD
  &ZCONT = TQINDEXF
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXF
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% JCL  +JOBNAME           - LIST JCL FOR A JOB
% JCT  +JOBNAME <OFFSET>  - DISPLAY JCT IN HEX/EBCDIC
% JHIS +JOBNAME           - LIST JOB HISTORY INFORMATION
% JLOG +JOBNAME           - LIST JOBLOG FOR A JOB
% JMSG +JOBNAME           - LIST SYSTEM MESSAGES FOR A JOB
% JOBS +                  - DISPLAY STATUS FOR ALL ACTIVE TASKS
% JOBS +.JOBNM            - DISPLAY STATUS BY JOBNAME
% JOBS +ASID              - DISPLAY STSTUS FOR AN ASID
% JOBS +XX                - DISPLAY STATUS FOR SELECTED TYPE
% JOBS +XX,D              - DISPLAY STATUS BY DISPATCHABILITY OUTPUT
% JOBS +XX,L              - DISPLAY LONG STATUS FOR SELECTED TYPE
% JOBS +XX,S              - DISPLAY SHORT STATUS FOR SELECTED TYPE
% JOBS +0000              - DISPLAY LONG STATUS FOR ALL ACTIVE TASKS
%
)PROC
  &ZUP  = TQINDEXE
  &ZCONT = TQINDEXG
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXG
)BODY DEFAULT(%$_)
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% JOE   $JOBNAME        - DISPLAY JOES IN HEX/EBCDIC
% JQE   $JOBNAME        - DISPLAY JQE IN HEX/EBCDIC
% LIST  $* +/-N         - LIST NEXT OR PREVIOUS N'TH DATASET
% LIST  $JOBNAME DSID   - LIST A SYSIN OR SYSOUT DATASET
% MODEL $ #             - SET 3270 MODEL 2, 3, 4, OR 5
% OPT   $BL             - DISPLAY BLANK LINE (CC CMD ONLY)
% OPT   $NOBL           - DISPLAY NO BLANK LINE (SUPPRESSED)
% PDDB  $JOBNAME        - LIST PDDB'S FOR A JOB
% PF/PB $#              - FORWARD/BACKWARD # PAGES
% PFK   $               - LIST PROGRAM FUNCTION KEYS
% PFK   $NN  TEXT       - REDEFINE PROGRAM FUNCTION KEYS
% PM    $               - PAGING MONITOR
% PRINT $               - PRINT CURRENT SCREEN
% PRINT $OFF            - CLOSE SCREEN LOG
% PRINT $ON CLASS DEST  - OPEN SCREEN LOG
%
)PROC
  &ZUP  = TQINDEXF
  &ZCONT = TQINDEXH
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXH
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% REQ     +JOBNAME <NEWCLASS> - RELEASE JOB'S HELD OUTPUT
% ROUT    +JOBNUMBER DEST- REROUTE A JOB TO LOCAL/RMT
% SA      + (NO PARM)   - (STORAGE USAGE)
% SAVE    +DSNAME       - CREATE A COPY OF THE CURRENT DATASET
% SJOB    +JOBNAME      - DISPLAY ALL SPOOL DATASETS BY JOBNAME
% SLOG    +ID  <SEQ>    - LIST THE SYSTEM LOG DATASET
% SPIN    +             - SEND COPY OF CURRENT DATASET TO SYSOUT
% SRM     +(NO PARM)    - SHOW AVERAGES
% SRM     +ALL          - ROTATE OF SUBCMDS "HIT ENTER BUTTON REPEATLY"
% SRM     +PAGE/PCCW/ASM/SWAP/PERF/RCT (DEFAULT AVG)
% STAT    +LEVEL        - DISPLAY ALL JOBS BEGINNING WITH LEVEL
% T/TOP   +             - REPOSITION TO TOP OF DATASET
% TAPE/TA + (NO PARM)   - LIST OF TAPE DRIVES
% TGPS    +             - LIST HIGH TRACK GROUP USERS (VERY SLOW CMD)
% TSO     +CMD PARMS    - ISSUE ANY TSO COMMAND W/OPTIONAL PARMS
%
)PROC
  &ZUP  = TQINDEXG
  &ZCONT = TQINDEXI
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEXI
%TUTORIAL ----------------- QUEUE INDEX MENU   ------------------------T
%NEXT SELECTION ===>_ZCMD

%
% WO  +              - DISPLAY ONLY OUTPUT JOBS WITH WRITER NAME SPECIFI
% XB  +MTTR          - DISPLAY BLOCK FROM SYS1.HASPACE
% XD  +JOBNAME DSID  - UNRESTRICTED DISPLAY OF DATASETS
% XI  +              - DISPLAY ACTIVE INITIATORS
% XJ  +JOBNAME       - DISPLAY UNINTERPRETED JQES AND JOES
% XM  +              - EXCEPTION MONITOR
% XU  +CKPT          - DISPLAY JES2 CHECKPOINT
% XU  +HCT           - DISPLAY HCT $SAVE AREA
% XU  +JOBNAME CB    - DUMP CONTROL BLOCKS
% XU  +JOT           - DISPLAY JOT IN HEX/EBCDIC
%
)PROC
  &ZUP  =  TQINDEXH
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    I,TQINDEXA 1,TQIT001 2,TQIT002 3,TQIT003 4,TQIT004 5,TQIT005
    6,TQIT006 7,TQIT007 8,TQIT008 9,TQIT009 10,TQIT010 STAT,TQIST001
    '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001 DA,TQIDA001
    DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001 CC,TQICC001
    HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001 OPT,TQIOP001
    FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001 TAPE,TQITA001
    DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001 FALL,TQIFA001
    MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001 JOBS,TQIJO001
    HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001 FR,TQIFR001
    SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001 JCL,TQIJC001
    DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001 JLOG,TQIJL001
    DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001 DM,TQIDM001
    MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001 '+',TQID001
    ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001 SRM,TQISR001
    HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001 JCT,TQIJCT01
    EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001 SLOG,TQISL001
    XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01 TSO,TQITSO01
    XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01 SPA,TQISPA01
            )
)END
./       ADD   NAME=TQINDEX1
)BODY DEFAULT($%_)
%TUTORIAL -----------------$VALID QUEUE COMMANDS%----------------------T
%NEXT SELECTION ===>_ZCMD

%AI     CC     DELE   EXEC   H      JLOG   MODE   PF     SLOG
%ALLOC  CSYS   DEL    FALL   HB     JL     MO     PFK    SL
%AL     CS     DE     FA     HCT    JMSG   M      PM     SPIN
%AM     CM     DIE    FIND   HF     JM     MPL    REQ    SPA
%AO     COL    DI     F      HI     JHIS   MP     RE     SRM
%ASID   CO     DO     FORMS  HO     JH     NEXT   ROUT   SR
%AS     C      DT     FO            JCT    NX     RTE    SU
%BOTT   CZAP   DJ     FRAME  IOT    JOE    N      SAVE   STATUS
%BOT    DA     DQ     FR     JOBS   JQE    OPT    SA     STAT
%B      DD     DS     FTIME  JO     LIST   OP     SJOB   ST
%CANCEL DC     DF     FTIM   JCL    L      PDDB   SJ     TAPE
%CAN    D      DM     FT     JC     MD     PB            TA
%CA                                                      
%-      @      +                                         
%                                                        
%                                                        
)PROC
  &ZUP  = TQTOPICS
  &ZCONT = TQINDEX1
)END
./       ADD   NAME=TQINX001
%TUTORIAL ----- DISPLAY ALL SPOOL DATASETS OF A JOB -------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE SJOB COMMAND IS TO DISPLAY ALL SPOOL DATASETS OF A JOB.
  SPOOL DATASET WILL BE DISPLAYED AS SEQUENCE FASHION.  NEXT SPOOL DATAS
  BE DISPLAYED WHEN YOU ENTER "NEXT/N".

  THE SJOB COMMAND IS EQUIVALENT TO IBM ISPF OPTION 3.8  AS IT IS REPLAC
  LIST, JCL, JMGS, AND JLOG". IT HAS THE SAME FEATURE OF "LIST" COMMAND
  DOWN, COL, FIND, FALL, TOP, BOT, FTIME, AND @ SUB-COMMANDS.
%
+SYNTAX:         SJOB JOBNAME       (DISPLAY FIRST DATASET OF A JOB)
+                NEXT               (NEXT SPOOL DATASET)
%
+ABBREVIATIONS:  SJ
+                N
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIOP001
%TUTORIAL ---- SUPPRESS BLANK LINES WHILE USING CC COMMAND ------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE OPT COMMAND IS TO SUPPORT THE CC COMMAND TO SUPPRESS THE
+  BLANK LINES OR NOT. THE OPT COMMAND MUST USE BEFORE ENTERING "CC"
+  COMMAND. THE OPERAND "BL" IS TO SUPPRESS BLANKED LINES AND "NOBL"
+  IS TO INCLUDE BLANKED LINES AS DISPLAYED.
+  2 OR MORE BLANK LINES WILL BE DISPLAYED TO 1 BLANK LINE. ALL
+  CARRIAGE CONTROL CHARACTERES WILL BE DISPLAYED.
%
+SYNTAX:        OPT BL/NOBL
%
+ABBREVIATIONS:  OP
%
+OPERANDS:
+  BL      - SUPPRESS  THE BLANK LINES.
+  NOBL    - DISPLAY THE BLANK LINES.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIPB001
%TUTORIAL ----- FORWARD/BACKWARD # PAGES ------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE PF/PB COMMAND IS TO SCROLL  PAGES FORWARD OR BACKWARD
+  WITHIN THE DATASET.
%
+SYNTAX:         PF   # (FORWARD)
+                PB   # (BACKWARD)
%
+OPERANDS:
+  #  CAN BE NUMBER OF PAGES OF THE DATASET.
%
+ EXAMPLE:  PB 100  - THE CMD WILL REPOSTION TO 100TH PAGE BACKWARD.
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIPDDB1
%TUTORIAL ----- LIST PDDB'S FOR A JOB ---------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE PDDB COMMAND IS TO DISPLAY THE LIST OF DATASETS OF THE
+          JOBNAME IN SYSTEM FORMAT.
+          EACH DATASET CAN BE DISPLAYED IN DATASET ID (DSID).
%
+SYNTAX:         PDDB JOBNAME
%
+NO ABBREVIATIONS
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIPFK01
%TUTORIAL -----LIST PROGRAM FUNCTION KEYS -----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE PFK COMMAND IS TO LIST PROGRAM FUNCTION KEYS OF THE QUEUE
%
+SYNTAX:         PFK (NO OPERANDS)
+                PFK NN  TEXT
%
+OPERANDS:
+  NN CAN BE PFK NUMBER FROM 01 TO 12.
+  TEXT CAN BE THE STRING OF UP TO
%
+ PRESS "ENTER" FOR THE DEFAULT LIST OF PTFS.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIPFK02
)END
./       ADD   NAME=TQIPFK02
%TUTORIAL -----DEFAULTS PROGRAM FUNCTION KEYS--------------------------T
%NEXT SELECTION ===>_ZCMD

%
+ DEFAULTS: -  ISPF QUEUE                   NONISPF QUEUE
+              -----------                  --------------
+ PFK 1        ISPF PFK1                     HELP
+ PFK 2        ISPF PFK2                     DA
+ PFK 3        END                           END
+ PFK 4        ISPF PFK4                     PRINT
+ PFK 5        FIND                          FIND
+ PFK 6        DI                            DI
+ PFK 7        - 21                          - 21
+ PFK 8        + 21                          + 21
+ PFK 9        ISPF PFK9                     DO
+ PFK 10       CO 1                          CO 1
+ PFK 11       CO 50                         CO 50
+ PFK 12       ISPF PFK12                    ST
+
+                 (CONTINUED)
)PROC
  &ZUP  = TQIPFK01
  &ZCONT= TQIPFK03
)END
./       ADD   NAME=TQIPFK03
%TUTORIAL -----LIST PROGRAM FUNCTION KEYS - EXAMPLE -------------------T
%NEXT SELECTION ===>_ZCMD

%
+EXAMPLES: PFK 03 DC - THE PKFCMD WILL REPLACE "DC" ON PFK 3.
%
+  FOR USING ISPF QUEUE,  PFKS 1, 2, 4, 9, AND 12 CAN BE ALTERNATED
+   BY ISPF OPTION 0.
&
)PROC
  &ZUP  = TQIPFK01
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIPF001
%TUTORIAL ----- FORWARD/BACKWARD # PAGES ------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE PF/PB COMMAND IS TO SCROLL  PAGES FORWARD OR BACKWARD
+  WITHIN THE DATASET.
%
+SYNTAX:         PF   # (FORWARD)
+                PB   # (BACKWARD)
%
+OPERANDS:
+  #  CAN BE NUMBER OF PAGES OF THE DATASET.
%
+ EXAMPLE:  PF 100  - THE CMD WILL REPOSTION TO 100TH PAGE FORWARD.
+
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIPM001
%TUTORIAL ----- DISPLAY PAGING MONITOR --------------------------------T
%NEXT SELECTION ===>_ZCMD

+FUNCTION: THE PM COMMAND IS TO DISPLAY PAGING MONITOR. THE COMMAND WILL
+          WAIT FOR 30 SECONDS FOR THE INTERVAL STATISTICAL VALUES.
%
+SYNTAX:         PM (NO OPERANDS)
%
+               (CONTINUE FOR SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIPM002
  &ZINDEX = TQINDEXA
)END
./       ADD   NAME=TQIPM002
%TUTORIAL ----- DISPLAY PAGING MONITOR --------------------------------T
%NEXT SELECTION ===>_ZCMD
+<- DESCRIPTION --> <------------ OUTPUT SAMPLE   ---------------->
+HEADING----------->     PAGING MONITOR - 30 SECONDS INTERVALS   
+VIO---------------> VIO PAGING             .00   PAGES/SEC      
+                    SWAP PAGING           4.33   PAGES/SEC      
+                    COMMON PAGING         3.46   PAGES/SEC      
+                    ADDRSPC PAGING        6.73   PAGES/SEC      
+                    TOTAL PAGING         14.53   PAGES/SEC      
+                   <--------------------------------------------->
+ <------------ REASONABLE PAGING RATE WHEN AT PEAK ---------------->
+ PAGES/SEC   DEVICE   PAGES/SEC  DEVICE    PAGES/SEC   DEVICE
+    15       3330        15      3350        15-20      3380
+    20       2305-2      15      3375        60-80      3880-11
+     (SOURCE: SHARE MVS TUNING REPORT V -METHODOLOGY 3.0 PAGING)
%
)PROC
  &ZUP  = TQIPM001
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIRE001
%TUTORIAL ----- RELEASE JOB'S HELD OUTPUT -----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE REQ COMMAND IS TO RELEASE JOB'S HELD OUTPUT.
%
+SYNTAX:         REQ JOBNAME <NEWCLASS>
%
+ABBREVIATIONS:  RE
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
+ -NEWCLASS CAN BE A CLASS THAT DEFINES IN JES2 PARAMETER.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIROUT1
%TUTORIAL ----- REROUTE A JOB TO DESTINATION --------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE ROUTE COMMAND IS TO REROUTE A JOB TO DESTINATION.
%
+SYNTAX:         ROUT JOBNAME DEST
%
+ABBREVIATIONS:  RTE
%
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
+ -DEST    CAN BE "LOCAL" FOR LOCAL PRINTER,  OR
+                 "RMTXXX" FOR REMOTE DESTINATION WHERE XXX IS RJE NUMBE
%            (DEFAULT "LOCAL" IF THE DEST OPERAND IS OMITTED.)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQISAVE1
%TUTORIAL ----- CREATE A COPY OF THE CURRENT DATASET ------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE SAVE COMMAND IS TO CREATE A COPY OF THE CURRENT DATASET.
+
%
+SYNTAX:         SAVE  DSNAME
%
+NO ABBREVIATIONS
%
+OPERANDS:
+ -DSNAME CAN BE A LEVEL NAME OF UP TO EIGHT CHARACTERS TO BE IMBEDDED
+         BETWEEN "ACCOUNT.USERID." AND ".DATA".
%
+ EXAMPLE :  SAVE DEBUG  - THE SAVE CMD WILL CREATE THE COPY TO THE
+                        DSNAME CALLED "C6000A.DSD.DEBUG.DATA".
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQISA001
%TUTORIAL ----- DISPLAY STORAGE USAGE ---------------------------------T
%NEXT SELECTION ===>_ZCMD

+FUNCTION: THE SA COMMAND IS TO DISPLAY STORAGE USAGE.
%
+SYNTAX:         SA(NO OPERANDS)
%
+               (CONTINUE FOR SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQISA002
  &ZINDEX = TQINDEXA
)END
./       ADD   NAME=TQISA002
%TUTORIAL ----- DISPLAY STORAGE USAGE ---------------------------------T
%NEXT SELECTION ===>_ZCMD

+ OUTPUT SAMPLE:
      STORAGE USAGE GRAPHICALLY
+ # OF PAGES
+                                                      
TOTAL   3756  PAGABLE 3145  LGCPU= 220  AVCPU=  99 AVUIC= 255
    *SYSTEM*     0         AVPAG=   9 0========>
    *MASTER*     0         ASMQ=    2 0=>
    DOR          1    1%    0.03      >
%
)PROC
  &ZUP  = TQISA001
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQISJ001
%TUTORIAL ----- DISPLAY ALL SPOOL DATASETS OF A JOB -------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE SJOB COMMAND IS TO DISPLAY ALL SPOOL DATASETS OF A JOB.
  SPOOL DATASET WILL BE DISPLAYED AS SEQUENCE FASHION.  NEXT SPOOL DATAS
  BE DISPLAYED WHEN YOU ENTER "NEXT/N".

  THE SJOB COMMAND IS EQUIVALENT TO IBM ISPF OPTION 3.8  AS IT IS REPLAC
  LIST, JCL, JMGS, AND JLOG". IT HAS THE SAME FEATURE OF "LIST" COMMAND
  DOWN, COL, FIND, FALL, TOP, BOT, FTIME, AND @ SUB-COMMANDS.
%
+SYNTAX:         SJOB JOBNAME       (DISPLAY FIRST DATASET OF A JOB)
+                NEXT               (NEXT SPOOL DATASET)
%
+ABBREVIATIONS:  SJ
+                N
%
+OPERANDS:
+  JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+             "*", "-", OR "BLANK" CHARACTER.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQISPIN1
%TUTORIAL ----- SEND A COPY OF CURRENT DATASET TO SYSOUT --------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE SPIN COMMAND IS TO SEND A COPY OF THE CURRENT DATASET TO
+          IT WILL GENERATE THE DATASET TO YOUR SESSION SYSOUT CALLED HA
+          THE SYSOUT WILL BE PRINTED LOCALLY UNDER USER'S SESSION.
%
+SYNTAX:         SPIN
%
+NO ABBREVIATIONS
%
+NO OPERANDS
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQISR001
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT --------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE SRM COMMAND IS TO DISPLAY SYSTEMS RESOURCES MANAGEMENT.
+
%
+SYNTAX:         SRM        (DISPLAY OF SRM VALUES)
+                SRM PAGE   (DISPLAY PAGE DATASETS AND STATISTICS)
+                SRM SWAP   (DISPLAY SWAP DATASETS AND STATISTICS)
+                SRM PCCW   (DISPLAY PCCW INFORMATION.)
+                SRM ASM    (DISPLAY ASM  INFORMATION.)
+                SRM PERF   (DISPLAY PERFORMANACE INFORMATION.)
+                SRM RCT    (DISPLAY RCT INFORMATION.)
+                SRM ALL    (DISPLAY OF THE ABOVE IN SEQUENCE FASHION.)
%
+ABBREVIATIONS:  VS
%
% (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQISR002
)END
./       ADD   NAME=TQISR002
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- SRM PAGE                                       SYSID=IPO1/
% QUEV2 CMD=>
+TYPE  UNIT  VOLNAME    DSNAME            ERR  SIZE AVAIL  USED BURST
%PLPA  616   8SBP02  PAGE.V8SBP02.PLPA    000 02250 01125    50    005
%COMN  125   CHD003  PAGE.VCHD003.COMMON  000 02250 01730    24    005
%LOCL  605   8DBP02  PAGE.V8DBP02.LOCAL1  000 06000 03540    41    008
%LOCL  126   FSDCD1  PAGE.VFSDCD1.LOCAL2  000 06000 03503    42    008
%LOCL  301   MVSLC1  PAGE.VMVSLC1.LOCAL3  000 05200 03467    34    153
%SWAP  DS-   0  SETS-     0  PGS/SET-    12
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR001
  &ZCONT= TQISR003
)END
./       ADD   NAME=TQISR003
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- SRM PCCW                                       SYSID=IPO1/
% QUEV2 CMD=>
+                    PCCW
+NUMBER OF PCCWS BUILT BY RIM %    00000592
+NUMBER OF AVAILABLE PCCWS    %    00000589
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR002
  &ZCONT= TQISR004
)END
./       ADD   NAME=TQISR004
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- SRM ASM                                        SYSID=IPO1/
% QUEV2 CMD=>
+            ASM
+    ILRSLOTC   % 2,095,389
+    ILRSLOTV   % 7,483,647
+    AVAIL SLOTS %   16,884
+    TOTAL SLOTS %   17,200
+    VIO SLOTS   %        0
+    ADSPC SLOTS %    6,962
+    BAD SLOTS   %        0
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR003
  &ZCONT= TQISR005
)END
./       ADD   NAME=TQISR005
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:20   -- SRM ALL                                        SYSID=IPO1/
% QUEV2 CMD=>
+                         PERF
+   PGN PER   TR CNT TR RATE  AB RATE  SW RATE   AVGRSP
%    01   1       21     122      122     0.00    37.14
%    01   2       19     228      228     0.00   264.21
%    01   3        1     594      594     0.00   695.54
%    01  ALL      41     253      253     0.00   158.43
%    02   1      308     255      265     0.89     0.61
%    02   2       57     299      299     0.49     5.37
%    02   3        2     410      410     1.00     9.90
%    02  ALL     367     267      275     0.83     1.40
%    05  ALL       4       5        5     0.50     5.01
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR004
  &ZCONT= TQISR006
)END
./       ADD   NAME=TQISR006
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:20   -- SRM RCT                                        SYSID=IPO1/
% QUEV2 CMD=>
+          RESOURCE CONTROL TABLE (RCT)
+                      CURRENT   THRESHOLD
+    CPU UTILIZATION     %  51     98  101
+    CPU UTIL W/ DEM PAG %         95   98
+    PAGING RATE         %   0   1000 1000
+    DEMAND PAGING RATE  %   0     58   72
+    TOTAL PAGING RATE   %   0
+    PAGE DELAY TIME (MS) % 38   1000 1000
+    PAGE DELAY W/ DEM PAG%       100  130
+    AVG ASM QUEUE       %   0   1000 1000
+    AVG UIC             % 255      2    4
+    AVG AVAIL FRAMES    % 364
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR005
  &ZCONT= TQISR007
)END
./       ADD   NAME=TQISR007
%TUTORIAL ----- SYSTEMS RESOURCES MANAGEMENT - SAMPLES ----------------T
%NEXT SELECTION ===>_ZCMD

%  09:20   -- SRM                                            SYSID=IPO1/
% QUEV2 CMD=>
+CURRENT IPS=%IEAIPS00 + OPT=%IEAOPT00 + ICS=%IEAICS00
+    LGCP %80 +AVCP %01 +AVDP %00 +AUIC%255+ ASMQ% 00
+    TERM WAIT - OUT     (01)%     1,512
+    TERM WAIT - IN      (02)%    36,872
+    LONG WAIT           (03)%     1,030
+    AUX STOR SHORTAGE   (04)%         0
+    REAL STOR SHORTAGE  (05)%         0
+    DETECTED WAIT       (06)%     2,099
+    REQUEST SWAP        (07)%         0
+    ENQ EXCHANGE        (08)%         0
+    WORKLOAD EXCHANGE   (09)%         0
+    UNILATERAL SWAP     (0A)%         4
+    TRANSITION SWAP     (0B)%        43
+    LOGICAL SWAPS       (0C)%    36,369
+    LOGICAL SWAPS FAIL  (0D)%       937
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQISR006
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIST001
%TUTORIAL -----DISPLAY ALL JOBS BEGINNING WITH LEVEL ------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE STATUS COMMAND IS TO DISPLAY THE LIST OF JOBNAMES
+  BEGINING WITH LEVEL. EACH JOBNAME CAN BE TSO USERID, JOBNAME BEGIN
+  WITH USERID, OR ANY TASK NAME FOUND IN SPOOL DATASET.
%
+SYNTAX:         STAT LEVEL
%
+ABBREVIATIONS:  ST
%
% NOTES:  (1) DEFAULT FOR LEVEL IS LOGON USERID
%         (2) LEVEL CAN BE JOBNAME OR CURRENT LEVEL
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQISU001
%TUTORIAL ----- DISPLAY SU INFORMATION --------------------------------T
%NEXT SELECTION ===>_ZCMD

%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+FUNCTION: THE SU COMMAND IS TO DISPLAY SU INFORMATION OF THE SYSTEM.
          (THE QUEUE INSTALLER CAN UPGRADE THE TITLE AND FMID OF EACH SU
           THE SUINFO SOURCE.)
.
%
+SYNTAX:         SU
%
+NO ABBREVIATIONS AND OPERANDS.
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQITA001
%TUTORIAL ----- DISPLAY TAPE DRIVE STATUS -----------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE TAPE COMMAND IS TO DISPLAY TAPE DRIVE STATUS.
%
+SYNTAX:         TAPE
%
+ABBREVIATIONS:  TA
%
+NO OPERANDS.
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQITOP1
%TUTORIAL -----REPOSITION TO TOP OF DATASET ---------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE TOP  COMMAND IS TO REPOSITION TO TOP OF DATASET.
%
+SYNTAX:         TOP
%
+ABBREVIATIONS:  T
%
+NO OPERANDS:
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIT001
%TUTORIAL ----------- JOB INFORMATION   MENU   ------------------------T
%CMD  SELECTION ===>_ZCMD

%  ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  STAT +LEVEL               - DISPLAY ALL JOBS BEGINNING WITH LEVEL
%  DJ   +JOBNAME             - DISPLAY JOB BY JOBNAME
%  JCL  +JOBNAME             - LIST JCL FOR A JOB
%  JLOG +JOBNAME             - LIST JOBLOG FOR A JOB
%  JMSG +JOBNAME             - LIST SYSTEM MESSAGES FOR A JOB
%  JHIS +JOBNAME             - LIST JOB HISTORY INFORMATION
%  DD   +JOBNAME             - LIST SYSIN/SYSOUT DATASETS FOR A JOB
%  LIST +JOBNAME DSID        - LIST A SYSIN OR SYSOUT DATASET
%  CAN  +JOBNAME <P>         - CANCEL JOB ("P" OPTION FOR PURGE)
%  DEL  +JOBNAME             - DELETE JOB
%  REQ  +JOBNAME <NEWCLASS>  - RELEASE JOB'S HELD OUTPUT
%  ROUT +JOBNUMBER  DEST     - REROUTE A JOB TO LOCAL/RMT
%  SJOB +JOBNAME             - DISPLAY ALL SPOOL DATASETS OF A JOB
%
)PROC
  &ZUP = TQTOPICS
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT002
%TUTORIAL --------INPUT/OUTPUT QUEUE INFORMATION ----------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
+ ---------------- INPUT QUEUES ---------------------------------------
%  DQ          +- DISPLAY INPUT QUEUES
%  DI +CLASS    - DISPLAY ALL JOBS IN INPUT CLASS
%  AI +CLASS    - DISPLAY JOBS AVAILABLE FOR PROCESSING
%  HI +CLASS    - DISPLAY HELD JOBS IN INPUT CLASS
+ ---------------- OUTPUT QUEUES --------------------------------------
%  DF          +- DISPLAY OUTPUT QUEUES
%  DO +CLASS    - DISPLAY ALL JOBS IN OUTPUT CLASS
%  WO          +- DISPLAY ONLY OUTPUT JOBS WITH WRITER NAME SPECIFIED
%  AO +CLASS    - DISPLAY AVAILABLE OUTPUT
%  HO +CLASS    - DISPLAY HELD OUTPUT
%  FO          +- DISPLAY ALL JOBS IN OUTPUT CLASS BY FORMS/FCB
%
)PROC
  &ZUP = TQIT001
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT003
%TUTORIAL ------- SPECIAL QUEUE COMMANDS       ------------------------T
%NEXT SELECTION ===>_ZCMD

%   ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  CC +JOBNAME DSID      - LIST A SYSIN/SYSOUT DSN WITH
%  OPT +BL               - DISPLAY BLANK LINE (CC CMD ONLY)
%  OPT +NOBL             - DISPLAY NO BLANK LINE (SUPPRESSED)
%  SAVE +DSNAME          - CREATE A COPY OF THE CURRENT DATASET
%  SPIN  +               - SEND COPY OF CURRENT DATASET TO SYSOUT
%  PRINT +ON CLASS DEST  - OPEN SCREEN LOG
%  PRINT +               - PRINT CURRENT SCREEN
%  PRINT +OFF            - CLOSE SCREEN LOG
%  MODEL +#              - SET 3270 MODEL 2, 3, 4, OR 5
%  TSO +CMD PRMS         - ISSUE ANY TSO COMMAND W/OPTIONAL PARMS
%  TAPE/TA +             - DISPLAY TAPE DRIVE STATUS
%
)PROC
  &ZUP = TQIT002
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT004
%TUTORIAL ------ PROGRAM FUNCTION KEYS INFORMATION --------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  PFK +              - LIST PROGRAM FUNCTION KEYS
%  PFK + NN  TEXT     - REDEFINE PROGRAM FUNCTION KEYS
%
)PROC
  &ZUP = TQIT003
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT005
%TUTORIAL --------- SYSTEMS INFORMATION        ------------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  DA +                  - DISPLAY ALL JOBS IN EXECUTION
%  DT +                  - DISPLAY TSO USERS
%  DS +                  - DISPLAY SYSTEM TASKS
%  DC +TYPE              - DISPLAY CPU BATCH/STC/TSO  (BLANK,B/J/S/T)
%  ASID +STC/JOBS/TS/ALL - DISPLAY TASKS STATUS BY ASID
%  ALLO +D/T/M/V/B       - DISPLAY DEVICE INTERVENTION REQUIRED ----
%  FRAME +B/C/R/M/O      - DISPLAY STORAGE INFORMATION ----
%  JOBS  +               - STATUS OF JOBS
%  TAPE/TA +             - STATUS OF TAPE DRIVE
%
)PROC
  &ZUP = TQIT004
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT006
%TUTORIAL ----------- MONITOR COMMANDS --------------------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  SRM +- DISPLAY SYSTEM INDICATORS/RESOURCES
%  XM  +- EXCEPTION MONITOR
%  AM  +- ACTIVITY MONITOR
%  PM  +- PAGING MONITOR
%  SA  +- STORAGE USAGE
%  DM  +- DEVICE BUSY MONITOR
%  CM  +- CHANNEL BUSY MONITOR
%
)PROC
  &ZUP = TQIT005
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT007
%TUTORIAL ---------- ASID INFORMATION ---------------------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  ASID + STC/JOBS/TS/ALL
%  ASID + "ASID#"/*
%
)PROC
  &ZUP = TQIT006
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT008
%TUTORIAL ------------ JES2 INFORMATION COMMANDS ----------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  XB + MTTR             - DISPLAY BLOCK FROM SYS1.HASPACE
%  XD + JOBNAME DSID     - UNRESTRICTED DISPLAY OF DATASETS
%  XI +                  - DISPLAY ACTIVE INITIATORS
%  XJ + JOBNAME          - DISPLAY UNINTERPRETED JQES AND JOES
%  JQE +JOBNAME          - DISPLAY JQE IN HEX/EBCDIC
%  JCT +JOBNAME <OFFSET> - DISPLAY JCT IN HEX/EBCDIC
%  IOT +JOBNAME          - DISPLAY IOTS IN HEX/EBCDIC
%  JOE +JOBNAME          - DISPLAY JOES IN HEX/EBCDIC
%  HCT +                 - DISPLAY HCT $SAVE AREA
%  TGPS +                - LIST HIGH TRACK GROUP USERS
%  CSYS +                - ISSUE ANY SYSTEM/JES2 COMMAND
%  XU +JOBNAME CB        - DUMP CONTROL BLOCKS
+                         WHERE CB=JQE/IOT/JCT/JCB/PDDB/JOE/ALL
%  XU +JOT               - DISPLAY JOT IN HEX/EBCDIC
%  XU +HCT               - DISPLAY HCT $SAVE AREA
%  XU +CKPT              - DISPLAY JES2 CHECKPOINT
%
)PROC
  &ZUP = TQIT007
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT009
%TUTORIAL -------- SYSTEM LOG COMMANDS --------------------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  SLOG + ID  <SEQ>   - LIST THE SYSTEM LOG DATASET
%  FTIME +HH.MM.SS    - REPOSITION SYSTEM LOG TO GIVEN TIME
%
)PROC
  &ZUP = TQIT008
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT010
)BODY DEFAULT(%$_)
%TUTORIAL ------ DISPLAY SCREEN CONTROL COMMANDS ----------------------T
%NEXT SELECTION ===>_ZCMD

% ENTER ANY COMMAND TO BE HELPFUL TO YOU.
%  LIST $*    N              - LIST NEXT OR PREVIOUS N'TH DATASET
%  CC $JOBNAME DSID          - LIST A SYSIN/SYSOUT DSN WITH
$                                CARRIAGE CONTROL
%  OPT $BL/NOBL              - DISPLAY BLANK LINE /SUPPRESS BLANK LINES
%  FIND $'STRING' COL(SS,EE) - FIND CHARACTER STRING
%  FALL $'STRING' COL(SS,EE) - FIND ALL OCCURRENCES OF
$                               STRING (COL DEFAULTS TO ALL)
%  COL  $#                   - REPOSITION HORIZONTALLY TO COLUMN NUMBER
%  @/MD $#                   - REPOSITION TO SPECIFIC RECORD NUMBER
%  +/D  $#                   - REPOSITION FORWARD IN DATASET # RECORDS
%  -/UP $#                   - REPOSITION BACKWARD IN DATASET # RECORDS
%  T/TOP $                   - REPOSITION TO TOP OF DATASET
%  B/BOTTOM $                - REPOSITION TO BOTTOM OF DATASET
%  HF/HB $#                  - FORWARD/BACKWARD # HALF PAGES
%  PF/PB $#                  - FORWARD/BACKWARD # PAGES
%
)PROC
  &ZUP = TQIT009
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIT011
)BODY DEFAULT(%$_)
%TUTORIAL ------ QUEUE TRICKS AND HINTS -------------------------------T
%NEXT SELECTION ===>_ZCMD

% TRICKS:
$ 1. MULTIPLE QUEUE COMMANDS ARE ALLOWED WITH CMD DELIMITER BETWEEN THEM
$    (THE DELIMITER CHARACTER MUST BE THE SAME AS FROM ISPF OPTION 0.1.)
$    I.E.: L JOBNAME 101%;$F IEV  OR SL CPU%;$F PRINTER3
$ 2. USING FIND COMMAND, THE FIRST OPERAND VALUE CAN BE MEMORIED BY QUEU
$    YOU CAN REPEATLY ENTER F <BLANK> OR PF5 KEY WITH SAVED VALUE.
$ 3. THE FIND VALUE SHOULD NOT BE QUOTED UNLESS SEPERATED BY MORE THAN 2
$     I.E.:  F IEV90    OR F 'ABEND B37'
$ 4. THE JOBNAME OR JOBNUMBER OPERAND CAN BE MEMORIZED BY QUEUE AFTER FI
$    COMMAND (JL, JC, JM, DD, OR LIKE). THE SECOND COMMAND CANNOT BE ENT
$    WITH SAME JOBNAME OR JOBNUMBER OR USE BLANKED EXCEPT LIST, XD, OR A
$    COMMAND REQUIRED SECOND OPERAND.  I.E.  JL 2345;JM <BLANK>
$    FOR LIST COMMAND, YOU CAN USE EITHER "*" OR "-" IN REPLACE OF
$     JOBNAME OR JOBNUMBER.  I.E.   JL 2345;L - 101;F IEV90
$ 5. SJOB IS NEW COMMAND THAT LISTS ALL SPOOL DATASETS OF THE JOBNAME IN
$    SEQUENCE FASHION. TO JUMP FROM ONE DSID TO ANOTHER DSID, USE "NEXT"
$    TO WORK WITHIN A DSID, REPOSITION COMMANDS (TOP,BOT,FIND,ETC) ARE P
$    DURING SJOB PROCESSING.
)PROC
  &ZUP = TQIT010
  &ZCONT = TQTOPICS
  &ZSEL = TRANS(&ZCMD
    STAT,TQIST001 '-',TQIUP001 PDDB,TQIPDDB1 RE,TQIRE001 UP,TQIUP001
    DA,TQIDA001 DD,TQIDD001 PB,TQIPB001 DC,TQIDC001 CAN,TQICA001
    CC,TQICC001 HB,TQIHB001 ROUT,TQIROUT1 TOP,TQITOP1 CSYS,TQICS001
    OPT,TQIOP001 FO,TQIFO001 LIST,TQIL001 BOTT,TQIB001 DI,TQIDI001
    TAPE,TQITA001 DO,TQIDO001 FIND,TQIF001 WO,TQIWO001 XU,TQIXU001
    FALL,TQIFA001 MODE,TQIMO001 AI,TQIAI001 SU,TQISU001 AO,TQIAO001
    JOBS,TQIJO001 HI,TQIHI001 FTIME,TQIFT001 SAVE,TQISAVE1 HO,TQIHO001
    FR,TQIFR001 SPIN,TQISPIN1 DT,TQIDT001 SA,TQISA001 COL,TQICO001
    JCL,TQIJC001 DJ,TQIDJ001 PM,TQIPM001 DS,TQIDS001 AM,TQIAM001
    JLOG,TQIJL001 DQ,TQIDQ001 XM,TQIXM001 '@',TQIMD001 DF,TQIDF001
    DM,TQIDM001 MD,TQIMD001 JMSG,TQIJM001 DELE,TQIDE001 CM,TQICM001
    '+',TQID001 ASID,TQIAS001 D,TQID001 JHIS,TQIJH001 REQ,TQIRE001
    SRM,TQISR001 HF,TQIHF001 PFK,TQIPFK01 CZAP,TQICZ001 XB,TQIXB001
    JCT,TQIJCT01 EXEC,TQIEX001 XJ,TQIXJ001 IOT,TQIIOT01 ALLO,TQIAL001
    SLOG,TQISL001 XD,TQIXD001 HCT,TQIHCT01 XP,TQIXP001 JOE,TQIJOE01
    TSO,TQITSO01 XI,TQIXI001 JQE,TQIJQE01 TGPS,TQITGPS1 DIE,TQIDIE01
    SPA,TQISPA01
            )
)END
./       ADD   NAME=TQIUP001
%TUTORIAL -----REPOSITION BACKWARD IN DATASET # RECORDS ---------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE UP COMMAND IS TO REPOSITION BACKWARD IN DATASET # RECORDS
+  WITHIN THE DATASET.
%
+SYNTAX:         UP  #
%
+ABBREVIATIONS:  -
%
+OPERANDS:
+  #  CAN BE RECORD/LINE NUMBER OF THE DATASET. THE TOP NUMBER OF THE
+     DATASET CAN BE 1. THE BOTTOM NUMBER OF THE DATASET CAN BE DETERMIN
+     BY USING SUBCOMMAND DD. DEFAULTS IS 1.
%
+ EXAMPLE:  - 1000  - THE CMD WILL REPOSTION TO 1000TH RECORD OF THE DAT
+                     FROM THE NUMBER OF THE SCREEN.
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIVS001
%TUTORIAL ----- VIRTUAL STORAGE LISTING -------------------------------T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE VSM COMMAND IS TO DISPLAY VIRTUAL STORAGE OF THE SYSTEM.
+
%
+SYNTAX:         VSM        (VIRTUAL STORAGE MENU)
+                VSM 1      (MAP VIRTUAL STORAGE)
+                VSM 2      (DISPLAY CSA/SQA SUBPOOL UTILIZATION)
+                VSM 3      (DISPLAY CSA UTILIZATION BY PROTECT KEY)
%
+ABBREVIATIONS:  VS
%
% (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIVS002
)END
0  09:19   -- VSM                                            SYSID=IPO1/
0 QUEV2 CMD=>
0    VIRTUAL STORAGE MONITOR FOR CPU ID =  IPO1  CPU MODEL = 3083
0    ENTER VS AND THE SELECT NUMBER
0    1  MAP VIRTUAL STORAGE
0    2  DISPLAY CSA/SQA SUBPOOL UTILIZATION
0    3  DISPLAY CSA UTILIZATION BY PROTECT KEY
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
1

0 -------------------------  TSO COMMAND PROCESSOR  --------------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- VSM 1                                          SYSID=IPO1/
0 QUEV2 CMD=>
0                    VIRTUAL STORAGE MAP
0       +-----------------------------------------------+
0              SQA  00FFFFFF  SIZE =    .5 MEG
0                   00F80000           512 K
0       +-----------------------------------------------+
0             PLPA  00F7FFFF  SIZE =   4.3 MEG
0                   00B2C000          4432 K
0       +-----------------------------------------------+
0              CSA  00B2BFFF  SIZE =   2.1 MEG
0                   00910000          2160 K
0       +-----------------------------------------------+
0          PRIVATE  0090FFFF  SIZE =   8.0 MEG
0             AREA  00110000          8192 K
0       +-----------------------------------------------+
0         V=R LINE  0012D000  SIZE =   100 K
0       +-----------------------------------------------+
0          NUCLEUS  0010FFFF  SIZE =   1.0 MEG
0                   00000000          1088 K
0       +-----------------------------------------------+
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+ _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- VSM 2                                          SYSID=IPO1/
0 QUEV2 CMD=>
0                    SQA/CSA UTILIZATION
0                         UNAL OR     LARGEST     PCT UNAL
0      ID        SIZE     FREE SP    UNAL/FREE    OR FREE
0     SQA        512 K    1624 K       456 K        317%
0   SP  245      512 K      52 K        39 K         10%
0   ------------------------------------------------------
0     CSA       2160 K     456 K       400 K         21%
0   SP  227      216 K       3 K         2 K          1%
0   SP  228      200 K      18 K         3 K          9%
0   SP  231      764 K       8 K         2 K          1%
0   SP  239        0 K       0 K         0 K          0%
0   SP  241      524 K      24 K         2 K          4%
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- VSM 3                                          SYSID=IPO1/
0 QUEV2 CMD=>
0                         CSA UTILIZATION BY PROTECT KEY
0    KEY        NAME       CSA     SP 227   SP 228   SP 231   SP 239   S
0     0      SUPERVISOR   1020 K     48 K    180 K    424 K      0 K
0     1      SCHDLR/JES     96 K      0 K     12 K     36 K      0 K
0     2                      0 K      0 K      0 K      0 K      0 K
0     3                     44 K      8 K      0 K      0 K      0 K
0     4                      0 K      0 K      0 K      0 K      0 K
0     5      DATA MNGT       4 K      0 K      0 K      0 K      0 K
0     6      ACF/VTAM      524 K    160 K      4 K    304 K      0 K
0     7      IMS             0 K      0 K      0 K      0 K      0 K
0     8      V=V JOBS       16 K      0 K      4 K      0 K      0 K
0    9-15    V=R JOBS        0 K      0 K      0 K      0 K      0 K
0    -------------------------------------------------------------------
0    0-15    ALL KEYS     1704 K    216 K    200 K    764 K      0 K
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0TYPE  UNIT  VOLNAME    DSNAME            ERR  SIZE AVAIL %USED BURST
0PLPA  616   8SBP02  PAGE.V8SBP02.PLPA    000 02250 01125    50    005
0COMN  125   CHD003  PAGE.VCHD003.COMMON  000 02250 01730    24    005
0LOCL  605   8DBP02  PAGE.V8DBP02.LOCAL1  000 06000 03540    41    008
0LOCL  126   FSDCD1  PAGE.VFSDCD1.LOCAL2  000 06000 03503    42    008
0LOCL  301   MVSLC1  PAGE.VMVSLC1.LOCAL3  000 05200 03467    34    153
0SWAP  DS-   0  SETS-     0  PGS/SET-    12
0
0
0
0
0
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0                    PCCW
0NUMBER OF PCCWS BUILT BY RIM      00000592
0NUMBER OF AVAILABLE PCCWS         00000589
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:19   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0            ASM
0    ILRSLOTC     2,095,389
0    ILRSLOTV     7,483,647
0    AVAIL SLOTS     16,884
0    TOTAL SLOTS     17,200
0    VIO SLOTS            0
0    ADSPC SLOTS      6,962
0    BAD SLOTS            0
0
0
0
0
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:20   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0                         PERF
0   PGN PER   TR CNT TR RATE  AB RATE  SW RATE   AVGRSP
0    01   1       21     122      122     0.00    37.14
0    01   2       19     228      228     0.00   264.21
0    01   3        1     594      594     0.00   695.54
0    01  ALL      41     253      253     0.00   158.43
0    02   1      308     255      265     0.89     0.61
0    02   2       57     299      299     0.49     5.37
0    02   3        2     410      410     1.00     9.90
0    02  ALL     367     267      275     0.83     1.40
0    05  ALL       4       5        5     0.50     5.01
0
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:20   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0          RESOURCE CONTROL TABLE (RCT)
0                      CURRENT   THRESHOLD
0    CPU UTILIZATION        51     98  101
0    CPU UTIL W/ DEM PAG           95   98
0    PAGING RATE             0   1000 1000
0    DEMAND PAGING RATE      0     58   72
0    TOTAL PAGING RATE       0
0    PAGE DELAY TIME (MS)   38   1000 1000
0    PAGE DELAY W/ DEM PAG        100  130
0    AVG ASM QUEUE           0   1000 1000
0    AVG UIC               255      2    4
0    AVG AVAIL FRAMES      364
0
0
0
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:20   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0CURRENT IPS=IEAIPS00  OPT=IEAOPT00  ICS=IEAICS00
0    LGCP  80  AVCP  01  AVDP  00  AUIC 255  ASMQ  00
0    TERM WAIT - OUT     (01)      1,512
0    TERM WAIT - IN      (02)     36,872
0    LONG WAIT           (03)      1,030
0    AUX STOR SHORTAGE   (04)          0
0    REAL STOR SHORTAGE  (05)          0
0    DETECTED WAIT       (06)      2,099
0    REQUEST SWAP        (07)          0
0    ENQ EXCHANGE        (08)          0
0    WORKLOAD EXCHANGE   (09)          0
0    UNILATERAL SWAP     (0A)          4
0    TRANSITION SWAP     (0B)         43
0    LOGICAL SWAPS       (0C)     36,369
0    LOGICAL SWAPS FAIL  (0D)        937
0
0
0
0
0
1

0 ------------------- ISPF/PDF V2.2 PRIMARY OPTION MENU  ---------------
+             _
0 .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .
0  09:20   -- SRM ALL                                        SYSID=IPO1/
0 QUEV2 CMD=>
0TYPE  UNIT  VOLNAME    DSNAME            ERR  SIZE AVAIL %USED BURST
0PLPA  616   8SBP02  PAGE.V8SBP02.PLPA    000 02250 01125    50    005
0COMN  125   CHD003  PAGE.VCHD003.COMMON  000 02250 01730    24    005
0LOCL  605   8DBP02  PAGE.V8DBP02.LOCAL1  000 06000 03547    41    008
0LOCL  126   FSDCD1  PAGE.VFSDCD1.LOCAL2  000 06000 03505    42    008
./       ADD   NAME=TQIVS002
%TUTORIAL ----- VIRTUAL STORAGE LISTING - SAMPLES ---------------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- VSM                                            SYSID=IPO1/
% QUEV2 CMD=>
%    VIRTUAL STORAGE MONITOR FOR CPU ID =  IPO1  CPU MODEL = 3083
%    ENTER VS AND THE SELECT NUMBER
+    1 %MAP VIRTUAL STORAGE
+    2 %DISPLAY CSA/SQA SUBPOOL UTILIZATION
+    3 %DISPLAY CSA UTILIZATION BY PROTECT KEY
%
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQIVS001
  &ZCONT= TQIVS003
)END
./       ADD   NAME=TQIVS003
%TUTORIAL ----- VIRTUAL STORAGE LISTING - SAMPLES ---------------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- VSM 1                                          SYSID=IPO1/
% QUEV2 CMD=>
%                    VIRTUAL STORAGE MAP
%       +-----------------------------------------------+
%              SQA  00FFFFFF  SIZE =    .5 MEG
%                   00F80000           512 K
%       +-----------------------------------------------+
%             PLPA  00F7FFFF  SIZE =   4.3 MEG
%                   00B2C000          4432 K
%       +-----------------------------------------------+
%              CSA  00B2BFFF  SIZE =   2.1 MEG
%                   00910000          2160 K
%       +-----------------------------------------------+
%          PRIVATE  0090FFFF  SIZE =   8.0 MEG
%             AREA  00110000          8192 K
%       +-----------------------------------------------+
%         V=R LINE  0012D000  SIZE =   100 K
%       +-----------------------------------------------+
%          NUCLEUS  0010FFFF  SIZE =   1.0 MEG
%                   00000000          1088 K
%       +-----------------------------------------------+
%                (CONTINUED FOR SAMPLES)
%
)PROC
  &ZUP  = TQIVS002
  &ZCONT= TQIVS004
)END
./       ADD   NAME=TQIVS004
%TUTORIAL ----- VIRTUAL STORAGE LISTING - SAMPLES ---------------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- VSM 2                                          SYSID=IPO1/
% QUEV2 CMD=>
%                    SQA/CSA UTILIZATION
%                         UNAL OR     LARGEST     PCT UNAL
%      ID        SIZE     FREE SP    UNAL/FREE    OR FREE
%     SQA        512 K    1624 K       456 K        317%
%   SP  245      512 K      52 K        39 K         10%
%   ------------------------------------------------------
%     CSA       2160 K     456 K       400 K         21%
%   SP  227      216 K       3 K         2 K          1%
%   SP  228      200 K      18 K         3 K          9%
%   SP  231      764 K       8 K         2 K          1%
%   SP  239        0 K       0 K         0 K          0%
%   SP  241      524 K      24 K         2 K          4%
%
%                (CONTINUED FOR SAMPLES)
)PROC
  &ZUP  = TQIVS002
  &ZCONT= TQIVS004
)END
./       ADD   NAME=TQIVS005
%TUTORIAL ----- VIRTUAL STORAGE LISTING - SAMPLES ---------------------T
%NEXT SELECTION ===>_ZCMD

%  09:19   -- VSM 3                                          SYSID=IPO1/
% QUEV2 CMD=>
+                         CSA UTILIZATION BY PROTECT KEY
+    KEY        NAME       CSA     SP 227   SP 228   SP 231   SP 239   S
%     0      SUPERVISOR   1020 K     48 K    180 K    424 K      0 K
%     1      SCHDLR/JES     96 K      0 K     12 K     36 K      0 K
%     2                      0 K      0 K      0 K      0 K      0 K
%     3                     44 K      8 K      0 K      0 K      0 K
%     4                      0 K      0 K      0 K      0 K      0 K
%     5      DATA MNGT       4 K      0 K      0 K      0 K      0 K
%     6      ACF/VTAM      524 K    160 K      4 K    304 K      0 K
%     7      IMS             0 K      0 K      0 K      0 K      0 K
%     8      V=V JOBS       16 K      0 K      4 K      0 K      0 K
%    9-15    V=R JOBS        0 K      0 K      0 K      0 K      0 K
+    -------------------------------------------------------------------
+    0-15    ALL KEYS     1704 K    216 K    200 K    764 K      0 K
%
%                (CONTINUED FOR SAMPLES)
)PROC
  &ZUP  = TQIVS004
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIWO001
%TUTORIAL ----- DISPLAY ONLY OUTPUT JOBS WITH WRITER NAME SPECIFIED --T
%NEXT SELECTION ===>_ZCMD

%
+FUNCTION: THE WO COMMAND IS TO DISPLAY ONLY OUTPUT JOBS WITH WRITER NAM
+               SPECIFIED.
%
+SYNTAX:         WO
%
+NO ABBREVIATIONS OR OPERANDS.
%
%
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQIXM001
%TUTORIAL ----- EXCEPTION MONITOR -------------------------------------T
%NEXT SELECTION ===>_ZCMD

%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+FUNCTION: THE XM COMMAND IS TO MONITOR EXCEPTION.
%
+SYNTAX:         XM

%                      (CONTINUE FOR OUTPUT SAMPLES)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIXM002
)END
./       ADD   NAME=TQIXM002
)BODY DEFAULT($_)
TUTORIAL ----- EXCEPTION MONITOR - OUTPUT SAMPLES --------------------T
NEXT SELECTION ===>_ZCMD
$
                   EXCEPTION MONITOR OUTPUT MESSAGES
                ---------------------------------------

    SYSTEM EXCEPTION MESSAGES
    --------------------------------------

    CHANNEL XX   XXX% BUSY  FOR XXXXX SEC
    UUU VVVVVV   XXX% BUSY  FOR XXXXX SEC
    UUU VVVVVV   NOT READY  FOR XXXXX SEC
    EXCESS SYSTEM PAGING FOR    XXXXX SEC
    LOCAL PAGE I/O DEGRADED FOR XXXXX SEC
    WTO BUFFER SHORTAGE, WQE COUNT= XXXXX
    SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK

                      (CONTINUE FOR OUTPUT SAMPLES)
)PROC
  &ZUP  = TQIXM001
  &ZCONT= TQIXM003
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIXM003
)BODY DEFAULT($_)
TUTORIAL ----- EXCEPTION MONITOR - OUTPUT SAMPLES --------------------T
NEXT SELECTION ===>_ZCMD
$
                   EXCEPTION MONITOR OUTPUT MESSAGES
                ---------------------------------------

    JOB RESOURCE USAGE EXCEPTION MESSAGES
    --------------------------------------

    JJJJJJJJ POSSIBLE LOOP FOR  XXXXX SEC
    JJJJJJJJ XXX% CPU FOR       XXXXX SEC
    JJJJJJJJ ABEND IN PROGRESS  XXXXX SEC
    JJJJJJJJ EXCESS SWAP COUNT = XXXXX
    JJJJJJJJ XXXXX FRAMES FOR   XXXXX SEC


                      (CONTINUE FOR OUTPUT SAMPLES)
)PROC
  &ZUP  = TQIXM002
  &ZCONT= TQIXM004
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIXM004
)BODY DEFAULT($_)
TUTORIAL ----- EXCEPTION MONITOR - OUTPUT SAMPLES --------------------T
NEXT SELECTION ===>_ZCMD
$
$                  JOB WAIT EXCEPTION MESSAGES
$             --------------------------------------
$    ( NOTE -   A JOB IS CONSIDERED TO BE WAITING IF IT USES 0% CPU  )
$
$   JJJJJJJJ ENQ SYSDSN   WAIT  XXXXX SEC       ENQ CONFLICT
$   JJJJJJJJ I/O ON UUU   WAIT  XXXXX SEC       I/O PENDING
$   JJJJJJJJ ALLOC QUEUE  WAIT  XXXXX SEC       ALLOC QUEUE
$   JJJJJJJJ REPLY NN     WAIT  XXXXX SEC       REPLY PENDING
$   JJJJJJJJ SWAP RRRRRR  WAIT  XXXXX SEC       SWAPPED OUT
$
$ <-----------  RRRRRR - ( SWAP REASON CODES ) ------------------>
$ LONGWT  = LONG WAIT                    REQUEST = REQUEST SWAP
$ AUXSTOR = AUXILLARY STORAGE SHORTAGE   ENQEXC  = ENQ EXCHANGE
$ REALSTR = REAL STORAGE SHORTAGE        WORKEXC = WORKLOAD EXCHANGE
$ DETWAIT = MSO DETECTED WAIT            UNILATR = UNILATERAL
$  ----- ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND -----

)PROC
  &ZUP  = TQIXM003
  &ZCONT= TQTOPICS
  &ZINDEX= TQINDEXA
)END
./       ADD   NAME=TQIXU001
%TUTORIAL ----- DUMP JES2 CONTROL BLOCKS --- --------------------------T
%NEXT SELECTION ===>_ZCMD

%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+FUNCTION: THE XU COMMAND IS TO DUMP JES2 CONTROL BLOCKS.
%
+SYNTAX:         XU <JOBNAME JQE/IOT/JCT/JCB/PDDB/JOE/ALL> 
+                XU JOT                                    
+                XU HCT                                    
+                XU CKPT                                   
+NO ABBREVIATIONS.
+OPERANDS:
+ -JOBNAME CAN BE JOBNAME, NUMBER, OR CURRENT JOB USING
+                           "*", "-", OR "BLANK" CHARACTER.
+ -JQE, IOT,JCT,JCB, PDDB, OR JOE CAN BE REQUESTED TO DISPLAY FOR THE JO
+ -ALL IS THE OPERAND FOR THE ROTATED DISPLAY OF JQE, IOT, JCT, JCB, PDD
+         JOE OF THE JOBNAME.
+ ----------------------------------------------------------------------
+ -    JOT CAN BE REQUESTED TO DISPLAY JES2 JOB OUTPUT TABLE IN HEX/EBCD
+ -    HCT CAN BE REQUESTED TO DISPLAY JES2 HCT IN HEX/EBCDIC.
+ -   CKPT CAN BE REQUESTED TO DISPLAY JES2 CHECKPOINT.
%                         (CONTINUE)
)PROC
  &ZUP  = TQTOPICS
  &ZCONT= TQIXU002
)END
./       ADD   NAME=TQIXU002
%TUTORIAL ----- DUMP JES2 CONTROL BLOCKS --- --------------------------T
%NEXT SELECTION ===>_ZCMD

%                *** FOR AUTHORIZED SYSTEMS PROGRAMMER ***
+OPERANDS:
%
+ JQE  - DISPLAY JOBNAME'S JQE IN HEX/EBCDIC.
+ IOT  - DISPLAY JOBNAME'S IOT IN HEX/EBCDIC.
+ JCT  - DISPLAY JOBNAME'S JCT IN HEX/EBCDIC.
+ JCB  - DISPLAY JOBNAME'S JCB IN HEX/EBCDIC.
+ PDDB - DISPLAY JOBNAME'S PDDB IN HEX/EBCDIC.
+ JOE  - DISPLAY JOBNAME'S JOE IN HEX/EBCDIC.
+ ALL  - CAN BE THE ROTATED DISPLAY OF JQE, IOT, JCT, JCB, PDDB, AND JOE
+
)PROC
  &ZUP  = TQIXU001
  &ZCONT= TQTOPICS
)END
./       ADD   NAME=TQTOPICS
%TUTORIAL ----------------- QUEUE TOPICS MENU  ------------------------T
%NEXT SELECTION ===>_ZCMD

%   enter any commands or any options below
%   I +  Queue Commands by INDEX
%   1 +  JOB Queue Commands
%   2 +  INPUT/OUTPUT QUEUE Information
%   3 +  Special Queue Commands
%   4 +  PFK - Program function keys definition
%   5 +  System Queue Information
%   6 +  Monitor Commands
%   7 +  ASID  Information
%   8 +  JES2 Information
%   9 +  SYSTEM LOG Information
%  10 +  Display Screen Control Commands
%  11 +  QUEUE TRICKS AND HINTS
%  12 +  valid queue command listing
%
)PROC
  &ZINDEX =TQINDEXA
      &ZSEL = TRANS(&ZCMD
      ' ',TQTOPICS
      AI,TQIAI001
      SJOB,TQISJ001
      NEXT,TQISJ001
      AM,TQIAM001
      AO,TQIAO001
     BOT,TQIB001
     CANCEL,TQICA001
     CC,TQICC001
     CM,TQICM001
     COL,TQICO001
     DA,TQIDA001
     DD,TQIDD001
     DC,TQIDC001
     D,TQID001
     DEL,TQIDE001
     DIE,TQIDIE01
     DO,TQIDO001
     DT,TQIDT001
     DJ,TQIDJ001
     DQ,TQIDQ001
     DS,TQIDS001
     DF,TQIDF001
     DM,TQIDM001
     EXEC,TQIEX001
     FALL,TQIFA001
     FIND,TQIF001
     FORMS,TQIFO001
     FTIME,TQIFT001
     HB,TQIHB001
     HCT,TQIHCT01
     HF,TQIHF001
     HI,TQIHI001
     HO,TQIHO001
     I,TQINDEXA
     IOT,TQIIOT01
     JCL,TQIJC001
     JLOG,TQIJL001
     JMSG,TQIJM001
     JHIS,TQIJH001
     JCT,TQIJCT01
     JOE,TQIJOE01
     JQE,TQIJQE01
     LIST,TQIL001
     MD,TQIMD001
     MODE,TQIMO001
     OPT,TQIOP001
     PB,TQIPB001
     PF,TQIPF001
     PFK,TQIPFK01
     PM,TQIPM001
     REQ,TQIRE001
     ROUT,TQIROUT1
     SAVE,TQISAVE1
     SLOG,TQISL001
     SPIN,TQISPIN1
     SPA,TQISPA01
     SU,TQISU001
     STATUS,TQIST001
     TAPE,TQITA001
     TOP,TQITOP1
     UP,TQIUP001
     WO,TQIWO001
     XB,TQIXB001
     XD,TQIXD001
     XI,TQIXI001
     XJ,TQIXJ001
     XM,TQIXM001
     XP,TQIXP001
     XU,TQIXU001
     '-',TQIUP001
     '@',TQIMD001
     '+',TQID001
     1,TQIT001
     2,TQIT002
     3,TQIT003
     4,TQIT004
     5,TQIT005
     6,TQIT006
     7,TQIT007
     8,TQIT008
     9,TQIT009
     10,TQIT010
     11,TQIT011
     12,TQINDEX1
     )
)END
./       ADD   NAME=VSM
       COPY VSMDSECT
VSM     TITLE 'QUEUE COMMAND  - DISPLAY VIRTUAL STORAGE MONITOR'
 SPACE 4
*
*   VSM WAS MODIFIED TO QUEUE SUBROUTINE
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*            4/21/87
 EJECT
VSM      QSTART ,                  START VSM    CSECT ASSEMBLY
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
***********************************************************************
*    COMMENT BY DAVE RIKER / CDSI
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -
*    R9   -  WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
         SPACE
***********************************************************************
*    SYSTEM -           VIRTUAL STORAGE MONITOR                       *
*    VERSION -          1.1                                           *
*    MODNAME -          VSM                                           *
*    DESCRIPTIVE NAME - VIRTUAL STORAGE MONITOR CONTROL MODULE        *
*    AUTHOR -           R.P. SHANNON                                  *
*                       HALLMARK CARDS                                *
*                       ENFIELD DISTRIBUTION CENTER                   *
*    DATE -             9/1/82                                        *
*    FUNCTION -         THIS IS THE CONTROL MODULE FOR THE VIRTUAL    *
*                       STORAGE MONITOR. IT PRODUCES THE PRIMARY      *
*                       MENU AND SERVICES REQUESTS BY BRANCHING TO    *
*                       THE APPROPRIATE MODULES.                      *
*    ATTRIBUTES -       REUS                                          *
*    REGS AT ENTRY-     R14  - RETURN ADDRESS                         *
*                       R15  - EPA                                    *
*    REG USAGE     -    R0   - WORK REG                               *
*                       R1   - POINTER TO INTER MODULE LINKAGE        *
*                       R10  - LINKAGE AREA POINTER                   *
*                       R11  - BASE REG                               *
*                       R13  - SAVE AREA                              *
*                       R14  - RETURN ADDR                            *
*                       R15  - ADDR OF CALLED MODULES                 *
*    REGS AT EXIT -     R14  - RETURN ADDRESS                         *
*                       R15  - RETURN CODE                            *
*    LABELS             SOME OF THE FIELD USAGE IN THIS MODULE CAN    *
*                       BE DETERMINED BY THE FIRST CHARACTER OF THE   *
*                       FIELD. THE KEYS ARE:                          *
*                            @ - FIELD IS IN INTER-MODULE LINKAGE     *
*                                AREA                                 *
*                            # - FIELD IS PART OF THE OUTPUT SCREEN   *
*                            $ - DSECT                                *
*    MACROS -           STFSMODE   => VTAM TERMINAL CONTROL           *
*                       HMAP       => SCREEN BUILDER                  *
*                       $LNKSECT   => LINKAGE AREA DSECT              *
*    MODS -                                                           *
*          VERSION 1.0  - BASE                                        *
*          VERSION 1.1  - 1. REMOVED AUTOMATIC UPSHIFT OF KEYBOARD    *
*                         FOR TERMINALS WITH NUM OPTION               *
***********************************************************************
         EJECT
*        PRINT NOGEN
         SPACE
P000100  DS    0H
         L     R0,SIZEAREA
         GETMAIN  R,LV=(0)
         ST    R1,EXTRAREA
         LR    R8,R1
         USING  $LNKSECT,R8
         L     R3,16                    CVT POINTER
         LA    R2,256(0,0)              BACKUP TO
         SR    R3,R2                    CVT PREFIX
         USING CVTFIX,R3                CVT DSECT ADDRESSABILITY
         L     R2,CVTGDA                DETERMINE GDA ADDRESS
         LA    R2,0(R2)                 CLEAR HIGH ORDER BYTE
         ST    R2,@GDA                  STORE GDA ADDRESS
         MVC   @MAXCORE,CVTMZ00         DETERMINE MAX MEMORY ADDRESS
         MVC   @NUCHIGH,CVTNUCB         DETERMINE HIGHEST NUC ADDR
         MVC   @CSALOW,CVTSHRVM         DETERMINE BEGIN CSA ADDR
         MVC   @VRLINE,CVTREAL          DETERMINE V=R LINE
         MVC   #SCRENC(80),QBLANK
         L     R2,CVTSMCA               POINT TO SMF WORK AREA
         LA    R2,0(R2)                 CLEAR HIGH ORDER BYTE
         LTR   R2,R2                    SMF IN USE (ADDR ^ 0) ?
         BZ    P000200                  BIF NO
         MVC   #SCRENC(80),#SCREEN
         MVC   #CPUID,16(R2)            MOVE CPU ID TO SCREEN
         MVC   CPUMDL,CVTMDL            DETERMINE CPU MODEL
         DROP  R3                       DROP CVT DSECT ADDRESSABILITY
         SPACE
P000200  DS    0H
         UNPK  TENBYTE,CPUMDL           UNPACK CPU MODEL
         TR    TENBYTE+1(4),TRTABLE     TRANSLATE
         MVC   CPUMDL,TENBYTE+3         MOVE BACK
         MVC   #CPUMDL,CPUMDL           MOVE CPU MODEL TO SCREEN
*        MVC   @IOMOD,VSM99000          MOVE I/O MOD ADDR TO LINKAGE
         MVI   @BADCMND,C' '            MOVE BLANK TO BAD COMMAND IND
         SPACE
P000300  DS    0H
         SPACE
P000400  DS    0H                       WHAT TO DO ?
         USING QCKPT,R9
         L     R9,QVCKPT
         LA    R3,QDREPLY
         AH    R3,QOFF1
P000401  EQU   *
         LH    R2,QDRLNG         CHANGE IN PARM STRING (NON BLANK)
         LTR   R2,R2
         BNZ   P000402          CHECK FOR  PARM STRING
         CLI   @VSMFLAG,X'01'
         BE    P000500
         CLI   @VSMFLAG,X'02'
         BE    P000600
         CLI   @VSMFLAG,X'04'
         BE    P000700
*  CURRENT REQUEST IS NOT SAVED....
P0004ER EQU   *
         MVC   QDHLINE(80),#SCRENC
         MVC   QDMSG(80),#SCRENS
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN1
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN2
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN3
         BAL   R7,DISPLAY
         QSTOP
*  NEW REQUEST IS ENTERED..
P000402  EQU   *
         CLI   0(R3),C'1'               MAP VIRTUAL STORAGE ?
         BE    P000500                  BIF YES
         CLI   0(R3),C'2'               SHOW SUBPOOL UTILIZATION ?
         BE    P000600                  BIF YES
         CLI   0(R3),C'3'               SHOW CSA BY PROTECT KEY ?
         BE    P000700                  BIF YES
         B     P0004ER
         SPACE
P000500  DS    0H
         L     R15,=V(VSM1)             LOAD ADDR OF VIRT STOR MAPPER
PRETURN  EQU   *
         L     R1,EXTRAREA
         BALR  R14,R15                  GO MAP VIRTUAL STORAGE
         L     R0,SIZEAREA
         FREEMAIN  R,LV=(0),A=(1)
         QSTOP
         SPACE
P000600  DS    0H
         L     R15,=V(VSM2)             LOAD ADDR OF SUBPOOL MONITOR
         B     PRETURN                  READ RESPONSE
         SPACE
P000700  DS    0H
         L     R15,=V(VSM3)             LOAD ADDR OF PROTECT KEY CP
         B     PRETURN                  READ RESPONSE
         SPACE
P000800  DS    0H
         MVI   @BADCMND,C'1'            INDICATE INVALID COMMAND
         SPACE
P999999  QSTOP
***********************************************************************
*   LOCAL SUBROUTINE TO PUT LINE LINE VIA Q DISPLAY                 NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR LINE MESSAGE                    NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
LINE     EQU   QDMSG
         EJECT
*VSM99000 DC    V(VSM99000)              TERMINAL I/O MODULE
         DS     0F
SIZEAREA DC    X'00',AL3(@GETLEN)
TRTABLE  DS    0CL256
         DC    CL240' '
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
#SCREEN  DS    0CL80
         DC    CL80' '
         ORG   #SCREEN+4
         DC    CL28'VIRTUAL STORAGE MONITOR FOR '
         ORG   #SCREEN+32
         DC    CL10'CPU ID = '
         DS    CL4
         ORG   #SCREEN+48
         DC    CL12'CPU MODEL = '
         DS    CL4
         ORG
#SCRENS  DS    0CL80
         DC    CL80' '
         ORG   #SCRENS+4
         DC    C'ENTER VS AND THE SELECT NUMBER'
         ORG
*                12345678901234567890123456789012345678
#SCREN1  DS    0CL80
         DC    CL80' '
         ORG   #SCREN1+4
         DC    C'1  '
         DC    CL19'MAP VIRTUAL STORAGE'
         ORG
#SCREN2  DS    0CL80
         DC    CL80' '
         ORG   #SCREN2+4
         DC    C'2  '
         DC    CL35'DISPLAY CSA/SQA SUBPOOL UTILIZATION'
         ORG
#SCREN3  DS    0CL80
         DC    CL80' '
         ORG   #SCREN3+4
         DC    C'3  '
         DC    CL38'DISPLAY CSA UTILIZATION BY PROTECT KEY'
         ORG
#SCRNLEN EQU   *-#SCREEN
         LTORG
         CVT   DSECT=YES,PREFIX=YES
         $GDA
         $LNKSECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
WORKX1   DS    D
DWORD    DS    D
CHAR     DS    D
EXTRAREA DS    F
SAVEAREA DC    18F'0'                   MY SAVEAREA
TENBYTE  DS    XL10
CPUMDL   DS    F
LINKAGE  DS    CL80
#SCRENC  DS    CL80
         ORG   #SCRENC+4
         DC    CL28'VIRTUAL STORAGE MONITOR FOR '
         ORG   #SCRENC+32
         DC    CL10'CPU ID = '
#CPUID   DS    CL4
         ORG   #SCRENC+48
         DC    CL12'CPU MODEL = '
#CPUMDL  DS    CL4
         ORG
         END
./       ADD   NAME=VSMDSECT
         MACRO --- $LNKSECT---VSM LINKAGE SECTION DSECT
         $LNKSECT &DOC=NO
         TITLE 'VSM LINKAGE SECTION DSECT'
         SPACE 2
$LNKSECT DSECT .
@GDA     DS    F .           ADDR OF GLOBAL DATA AREA
@MAXCORE DS    F .           MAXIMUM VIRTUAL MEMORY ADDRESS
@NUCHIGH DS    F .           HIGHEST NUCLEUS ADDRESS
@CSALOW  DS    F .           BEGINNING CSA ADDRESS
@VRLINE  DS    F .           V=R LINE ADDRESS
@PUTAREA DS    F .           ADDRESS OF OUTPUT SCREEN
@PUTLEN  DS    F .           LENGTH OF OUTPUT SCREEN
@IOMOD   DS    F .           ADDR OF I/O MODULE
@BADCMND DS    CL1 .         BAD COMMAND INDICATOR
@VSMFLAG DS    CL1
*              X'00'   NO FLAG
*              X'01'   ENTERED 1
*              X'02'   ENTERED 2
*              X'04'   ENTERED 3
         DS    0F
@GETLEN  EQU   *-@GDA     .  LENGTH OF INPUT AREA
         MEND
         MACRO --- $DQE --- DESCRIPTER QUEUE ELEMENT DSECT
         $DQE &DOC=NO
         TITLE 'DESCRIPTER QUEUE ELEMENT'
$DQE     DSECT .
DQFQEPTR DS    AL4 .         PTR TO FIRST FREE ELEMENT
DQEPTR   DS    AL4 .         PTR TO NEXT DQE OR ZERO
DQEBLKAD DS    AL4 .         ADDR 1ST 4K BLOCK DESCRIBED BY THIS DQE
DQELNTH  DS    F .           LENGTH OF AREA DESCRIBED BY THIS DQE
         MEND
         MACRO --- $FBQE --- FREE BLOCK QUEUE ELEMENT
         $FBQE &DOC=NO
         TITLE 'FREE BLOCK QUEUE ELEMENT'
         SPACE 2
$FBQE    DSECT .             FREE BLOCK QUEUE ELEMENT
FWDPTR   DS    AL4 .         PTR TO NEXT FBQE OR PQE
BCKPTR   DS    AL4 .         PTR TO PREVIOUS FBQE OR PQE
SIZE     DS    F .           SIZE OF THIS FREE BLOCK
FBQAREA  DS    AL4 .         LOW ADDRESS OF FREE BLOCK
         MEND
         MACRO --- $FQESECT --- FREE QUEUE ELEMENT
         $FQESECT &DOC=NO
         TITLE 'FREE QUEUE ELEMENT'
         SPACE 2
$FQESECT DSECT .
FQEPTR   DS    AL4 .         PTR TO NEXT LOWER FREE AREA
FQELNTH  DS    F .           NUMBER BYTES IN FREE AREA
FQAREA   DS    AL4 .         HIGH ADDRESS OF FREE SPACE
FQERSVD  DS    F .           RESERVED
         MEND
         MACRO --- $GDA --- GLOBAL DATA AREA DSECT
         $GDA &DOC=NO
         TITLE 'GLOBAL DATA AREA'
         SPACE 2
$GDA     DSECT .
GDAFLAGS DS    B .
NIPFOURK EQU   X'20' .       FLAG RSM NOT READY (NIP)
SQATHRS1 EQU   X'08' .       SQA THRESHOLD 1 (APPROACHING CRITICAL)
SQATHRS2 EQU   X'04' .       SQA THRESHOLD 2 (CRITICAL)
WAITCUE  EQU   X'02' .       INDICATES V=R GETPART WAIT FOR REAL REGN
         DS    CL3 .         RESERVED
VRDREG   DS    F .           DEFAULT V=R SIZE
CSAPQEP  DS    F .           CSA PQE PTR
VRPQEP   DS    F .           V=R PQE PTR
PASTRT   DS    F .           PRIVATE AREA START ADDR
PASIZE   DS    F .           PRIVATE AREA SIZE
SQASPQEP DS    F .           SQA SPQE PTR
SQASPLFT DS    F .           SQA SPACE LEFT UNALLOCATED
VRPFEL   DS    F .           PTR TO 1ST QUEUE ELEMENT
VRPLEL   DS    F .           PTR TO LAST QUEUE ELEMENT
VRWAITQ  DS    F .           V=R WAIT QUEUE ANCHOR BLOCK
VRWLEL   DS    F .           PTR TO LAST QUEUE ELEMENT
PFSTCPAB DS    F .           FIRST CPAB PTR
CSASPQEP DS    F .           FIRST CSA SPQE PTR
GLBLCELL DS    F .           INTERNAL CELL ANCHOR BLOCK
GBLCELCT DS    F .           COUNT OF FREE INTERNAL CELLS
         MEND
         MACRO  --- $PQE --- VSM PARTITION QUEUE ELEMENT DSECT
         $PQE &DOC=NO
         TITLE 'PARTITION QUEUE ELEMENT'
         SPACE 2
$PQE     DSECT .
PQEFFBQE DS    AL4 .   PTR TO 1ST FBQE OR IF NONE TO PQE
PQEBFBQE DS    AL4 .   PTR TO LAST FBQE OR IF NONE TO PQE
PQEFPQE  DS    AL4 .   ADDR OF NEXT PQE OR ZERO
PQEBPQE  DS    AL4 .   ADDR OF PREVIOUS PQE OR ZERO
PQETCB   DS    AL4 .   ADDR TCB FOR JOB STEP TO WHICH SPACE BELONGS
PQESIZE  DS    BL4 .   SIZE OF REGION DESCRIBED BY THIS PQE
PQEREGN  DS    AL4 .   ADDR 1ST BYTE OF REGION DESCRIBED BY THIS PQE
PQERFLGS DS    CL1 .   FLAG BYTE
PQEHRID  DS    CL1 .   HIERARCHY IDENTIFIER
VMMFLGS  DS    B .     SEVEN HIGH ORDER BITS ZERO
VVVRFLG  EQU   X'01' . REAL OR VIRTUAL REGION FLAG
PQERSVD  DS    CL1 .   RESERVED
         MEND
         MACRO --- $SPQE --- SUBPOOL PARTITION QUEUE ELEMENT DSECT
         $SPQE &DOC=NO
         TITLE 'SUBPOOL PARTITION QUEUE ELEMENT DSECT'
         SPACE 2
$SPQE    DSECT .
SPQEAD   DS    F .           ADDRESS OF NEXT OLDEST SPQE
SPDQEPTR DS    F .           PTR TO 1ST DQE FOR SUBPOOL
SPQEFLGS DS    B .           SPQE FLAGS
SPSHARE  EQU   X'80' .       0 = SUBPOOL OWNED; 1 = SHARED, NOT OWNED
LASTSPQE EQU   X'40' .       LAST SPQE ON CHAIN
SPQEOWN  EQU   X'20' .       0 = SUBPOOL OWNED, NOT SHARED ; 1 = OWNED
*                            AND SHARED
SPQERES1 DS    BL1 .         RESERVED
SPQEID   DS    BL1 .         IDENTIFYING NUMBER OF SUBPOOL
SPQEKEY  DS    B .           KEY OF OWNING TASK ADDR
SPQERES2 DS    H .           RESERVED
         MEND
./       ADD   NAME=VSM1
       COPY VSMDSECT
VSM1    TITLE 'QUEUE COMMAND  - DISPLAY VIRTUAL STORAGE MONITOR'
 SPACE 4
*
*   VSM1 WAS MODIFIED TO QUEUE SUBROUTINE
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*            4/21/87
 EJECT
VSM1      QSTART ,                  START VSM    CSECT ASSEMBLY
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
***********************************************************************
*    COMMENT BY DAVE RIKER / CDSI
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -
*    R9   -  WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
         TITLE 'VSM1 => VIRTUAL STORAGE MEMORY MAPPER'
***********************************************************************
*    SYSTEM -           VIRTUAL STORAGE MONITOR                       *
*    VERSION -          1.1                                           *
*    MODNAME -          VSM1                                          *
*    DESCRIPTIVE NAME - VIRTUAL STORAGE MEMORY MAPPER                 *
*    AUTHOR -           R.P. SHANNON                                  *
*                       HALLMARK CARDS                                *
*                       ENFIELD DISTRIBUTION CENTER                   *
*    DATE -             9/1/82                                        *
*    FUNCTION -         THIS MODULE WILL MAP VIRTUAL STORAGE . IT     *
*                       WILL SHOW THE HIGH AND LOW VIRTUAL ADDRESS    *
*                       OF SQA, PLPA, CSA, THE PRIVATE AREA AND THE   *
*                       NUCLEUS. IT WILL ALSO SHOW THE SIZE OF EACH   *
*                       AREA IN MEG AND IN K.                         *
*    ATTRIBUTES -       REUS                                          *
*    REGS AT ENTRY-     R1   - INTER MODULE LINKAGE                   *
*                       R14  - RETURN ADDRESS                         *
*                       R15  - EPA                                    *
*    REG USAGE     -    R0   - WORK REG                               *
*                       R10  - LINKAGE AREA POINTER                   *
*                       R11  - BASE REG                               *
*                       R13  - SAVE AREA                              *
*                       R14  - RETURN ADDR                            *
*                       R15  - ADDR OF CALLED MODULES                 *
*    REGS AT EXIT -     R14  - RETURN ADDRESS                         *
*    LABELS             SOME OF THE FIELD USAGE IN THIS MODULE CAN    *
*                       BE DETERMINED BY THE FIRST CHARACTER OF THE   *
*                       FIELD. THE KEYS ARE:                          *
*                            @ - FIELD IS IN INTER-MODULE LINKAGE     *
*                                AREA                                 *
*                            # - FIELD IS PART OF THE OUTPUT SCREEN   *
*                            $ - DSECT                                *
*    MACROS -           $DQE       => RYO DQE DSECT                   *
*                       $GDA       => RYO DQE DSECT                   *
*                       $LNKSECT   => LINKAGE AREA DSECT              *
*                       $PQE       => RYO PQE                         *
*                       $SPQE      => RYO SPQE                        *
*    MODS -                                                           *
*          VERSION 1.0  - BASE                                        *
*          VERSION 1.1  - 1. REMOVED AUTOMATIC UPSHIFT OF KEYBOARD    *
***********************************************************************
*R11      EQU   11                  BASE REG
*R12      EQU   12
*R13      EQU   13                  GETMAINED ADDRESSABILITY
*R14      EQU   14                  RETURN ADDRESS
*R15      EQU   15                  EPA/RC
         EJECT
P000100  DS    0H
         SPACE
         LR    R8,R1
         USING $LNKSECT,R8
         MVI   @VSMFLAG,X'01'  ENTERED 1
         LA    R2,CLRAREA              CLEAR
         LA    R3,CLEARLEN             WORK
         LR    R4,R2                   FIELDS
         LA    R5,0                    WITH
         MVCL  R2,R4                   ZEROS
         LA    R2,#SCREEN              REPLACEMENT
         LA    R3,#SCRNLEN
         LA    R4,XSCREEN
         LR    R5,R3
         MVCL  R2,R4
         SPACE
P000200  DS    0H
         L     R4,@GDA             LOAD GDA ADDR INTO R4TY
         USING $GDA,R4             DSECT ADDRESSABILITY
         SPACE
         SETAUTH  ON
         MODESET  KEY=ZERO,MODE=SUP
         MVC   PVTLOW,PASTRT       DETERMINE BEGIN PRIVATE AREA ADDR
         MVC   PVTSIZE,PASIZE      DETERMINE PRIVATE AREA SIZE
         L     R3,CSAPQEP          CSA PQE POINTER
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         L     R5,SQASPQEP         SQA SPQE POINTER
         LA    R5,0(R5)            CLEAR HIGH ORDER BYTE
         DROP  R4                  DROP GDA ADDRESSABILITY
         SPACE
         USING $PQE,R3             PQE DSECT ADDRESSABILITY
         MVC   CSASIZE,PQESIZE     DETERMINE CSA SIZE
         LR    R4,R5               SQA SPQE POINTER NOW IN R4
         DROP  R3                  DROP CSA PQE ADDRESSABILITY
         SPACE
         USING $SPQE,R4            SPQE DSECT ADDRESSABILITY
         L     R3,SPDQEPTR         POINT TO DQE
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         DROP  R4                  DROP SPQE DSECT ADDRESSABILITY
         SPACE
         USING $DQE,R3             DQE DSECT ADDRESSABILITY
         MVC   SQALOW,DQEBLKAD     DETERMINE SQA BEGIN ADDR
         MVC   SQASIZE,DQELNTH     DETERMINE SQA SIZE
         DROP  R3                  DROP DQE DSECT ADDRESSABILITY
         EJECT
***********************************************************************
*        DO THE CALCULATIONS                                          *
***********************************************************************
P000300  DS    0H
         L     R3,@CSALOW      ADD THE CSA LOW ADDR AND THE
         A     R3,CSASIZE      CSA SIZE TO COMPUTE THE
         ST    R3,LPALOW       LPA LOW ADDR
         BCTR  R3,0            DECREMENT BY +1 TO
         ST    R3,CSAHIGH      FIND CSA HIGH ADDR
         SPACE
         L     R3,SQALOW       DECREMENT THE SQA LOW
         BCTR  R3,0            ADDR BY +1 TO FIND
         ST    R3,LPAHIGH      LPA HIGH ADDR
         SPACE
         S     R3,LPALOW       SUBTRACT LPA LOW ADDR FROM LPA
         ST    R3,LPASIZE      HIGH ADDR TO FIND LPA SIZE
         SPACE
         L     R3,@CSALOW      DECREMENT THE CSA LOW ADDR
         BCTR  R3,0            BY +1 GIVING THE
         ST    R3,PVTHIGH      PVT HIGH ADDR
         SPACE
         L     R3,@VRLINE      SUBTRACT THE HIGH NUCLEUS ADDR
         S     R3,@NUCHIGH     AND THE SYSTEM AREA FROM
         S     R3,K16          THE V=R LINE TO
         ST    R3,VRSIZE       FIND V=R REGION SIZE
         SPACE
         L     R3,@NUCHIGH     STORE VALUE IN @NUCHIGH
         ST    R3,NUCSIZE      AS NUC SIZE AND DECREMENT
         BCTR  R3,0            BY +1 TO OBTAIN
         ST    R3,NUCHIGH      THE PROPER NUC HIGH ADDR
         EJECT
***********************************************************************
*        FORMAT DATA TO BE OUTPUT AND OUTPUT IT                       *
***********************************************************************
P000400  DS    0H
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         SR    R4,R4                 CLEAR R4
         SR    R5,R5                 CLEAR R5
         SR    R6,R6                 CLEAR R6
         SPACE
         L     R4,TEN                SET R4 TO TEN
         L     R5,ONEMEG             LOAD ONE MEG INTO R4
         SPACE 3
         MVC   FIVEBYTE,@MAXCORE     MOVE SQA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE
         MVC   #SQAHIGH,TENBYTE+1    MOVE TO SCREENN
         SPACE
         MVC   FIVEBYTE,SQALOW       MOVE SQA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE
         MVC   #SQALOW,TENBYTE+1     MOVE TO OUTPUT SCREEN
         SPACE
         L     R3,SQASIZE            DETERMINE SQA SIZE IN MEGS
         MR    R2,R4                 BY MULT X 10
         DR    R2,R5                 THEN DIVIDING BY 1 MEG
         CVD   R3,DBLEWORD           CONVERT TO PROPER
         MVC   #SQASIZE,EDIT1        FORMAT THEN
         ED    #SQASIZE,DBLEWORD+6   MOVE TO OUTPUT SCREEN
         SPACE
         L     R3,SQASIZE            DETERMINE SQA SIZE IN K
         SRA   R3,10                 BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #SQASIZK,EDIT2        EDIT
         ED    #SQASIZK,DBLEWORD+5   MOVE TO OUTPUT SCREEN
         SPACE 3
         MVC   FIVEBYTE,LPAHIGH      MOVE LPA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #LPAHIGH,TENBYTE+1    MOVE TO SCREEN
         SPACE
         MVC   FIVEBYTE,LPALOW       MOVE SQA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #LPALOW,TENBYTE+1     MOVE TO SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         L     R3,LPASIZE            DETERMINE LPA SIZE IN MEG
         MR    R2,R4                 BY MULT X 10
         DR    R2,R5                 THEN DIVIDING BY 1 MEG
         CVD   R3,DBLEWORD           CONVERT
         MVC   #LPASIZE,EDIT1        EDIT
         ED    #LPASIZE,DBLEWORD+6   MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         L     R3,LPASIZE            DETERMINE LPA SIZE IN K
         LA    R3,1(R3)              BY BUMPING UP BY +1
         SRA   R3,10                 THEN BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #LPASIZK,EDIT2        EDIT
         ED    #LPASIZK,DBLEWORD+5   MOVE TO OUTPUT SCREEN
         SPACE 3
         MVC   FIVEBYTE,CSAHIGH      MOVE CSA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK IT AND TRANSLATE TO
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #CSAHIGH,TENBYTE+1    MOVE TO OUTPUT SCREEN
         SPACE
         MVC   FIVEBYTE,@CSALOW      MOVE CSA HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #CSALOW,TENBYTE+1     MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         L     R3,CSASIZE            DETERMINE CSA SIZE IN MEG
         MR    R2,R4                 BY MULT X 10
         DR    R2,R5                 THEN DIVIDING BY 1 MEG
         CVD   R3,DBLEWORD           CONVERT
         MVC   #CSASIZE,EDIT1        EDIT
         ED    #CSASIZE,DBLEWORD+6   MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         L     R3,CSASIZE            DETERMINE CSA SIZE IN K
         SRA   R3,10                 BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #CSASIZK,EDIT2        EDIT
         ED    #CSASIZK,DBLEWORD+5   MOVE TO OUTPUT SCREEN
         SPACE 3
         MVC   FIVEBYTE,PVTHIGH      MOVE PVT HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #PVTHIGH,TENBYTE+1    MOVE TO OUTPUT SCREEN
         SPACE
         MVC   FIVEBYTE,PVTLOW       MOVE PVT LOW ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #PVTLOW,TENBYTE+1     MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         L     R3,PVTSIZE            DETERMINE PVT AREA SIZE IN MEG
         MR    R2,R4                 BY MULTIPLYING X 10
         DR    R2,R5                 THEN DIVIDING BY 1 MEG
         CVD   R3,DBLEWORD           CONVERT
         MVC   #PVTSIZE,EDIT1        EDIT
         ED    #PVTSIZE,DBLEWORD+6   MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         L     R3,PVTSIZE            DETERMINE PVT AREA SIZE IN K
         SRA   R3,10                 BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #PVTSIZK,EDIT2        EDIT
         ED    #PVTSIZK,DBLEWORD+5   MOVE TO OUTPUT SCREEN
         SPACE 3
         MVC   FIVEBYTE,NUCHIGH      MOVE NUC HIGH ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #NUCHIGH,TENBYTE+1    MOVE TO OUTPUT SCREEN
         SPACE
         MVC   FIVEBYTE,NUCLOW       MOVE NUC LOW ADDR TO FIVEBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1(8),TRTABLE  TRANSLATE TO DISPLAY
         MVC   #NUCLOW,TENBYTE+1     MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         L     R3,NUCSIZE            DETERMINE NUC SIZE IN MEG
         MR    R2,R4                 BY MULT X 10
         DR    R2,R5                 THEN DIVIDING BY 1 MEG
         CVD   R3,DBLEWORD           CONVERT
         MVC   #NUCSIZE,EDIT1        EDIT
         ED    #NUCSIZE,DBLEWORD+6   MOVE TO OUTPUT SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         L     R3,NUCSIZE            DETERMINE NUC SIZE IN K
         SRA   R3,10                 BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #NUCSIZK,EDIT2        EDIT AND MOVE TO
         ED    #NUCSIZK,DBLEWORD+5   MOVE TO OUTPUT SCREEN
         SPACE 3
         MVC   FIVEBYTE,@VRLINE      MOVE V=R ADDR TO TENBYTE
         UNPK  TENBYTE,FIVEBYTE      UNPACK
         TR    TENBYTE+1,TRTABLE     CONVERT TO DISPLAY
         MVC   #VRLINE,TENBYTE+1     MOVE TO SCREEN
         SPACE
         SR    R2,R2                 CLEAR R2
         SR    R3,R3                 CLEAR R3
         L     R3,VRSIZE             DETERMINE V=R SIZE IN K
         SRA   R3,10                 BY DIVIDING BY 1024
         CVD   R3,DBLEWORD           CONVERT
         MVC   #VRSIZE,EDIT3         EDIT
         ED    #VRSIZE,DBLEWORD+6    MOVE TO OUTPUT SCREEN
         EJECT
P000500  DS    0H
         MODESET  KEY=NZERO,MODE=PROB
         SETAUTH  OFF
         MVC   QDHLINE(80),#SCREEN            LOAD SCREEN ADDRESS
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN1
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN1B
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN2
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN3
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN4
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN5
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN6
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN7
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN8
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN9
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRENA
         BAL   R7,DISPLAY
         MVC   QDMSG(80),XSCRENT
         BAL   R7,DISPLAY
         SPACE 3
P999999  EQU    *
         LR   R1,R8       EXTRASAVE TO BE FREEMAINED
         QSTOP
         EJECT
***********************************************************************
*   LOCAL SUBROUTINE TO PUT LINE LINE VIA Q DISPLAY                 NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR LINE MESSAGE                    NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
LINE     EQU   QDMSG
         EJECT
         DS   0F
TEN      DC   X'0000000A'         TEN IN HEX
ONEMEG   DC   X'00100000'         ONE MEGABYTE
K16      DC   X'00004000'         16 K
TRTABLE  DS   0CL256
         DC   CL240' '
         DC   X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
EDIT1    DC   X'4020214B20'       EDIT PATTERN FOR SIZE IN MEG
EDIT2    DC   X'402020202120'     EDIT PATTERN FOR SIZE IN K
EDIT3    DC   X'40202120'         EDIT PATTERN FOR V=R SIZE
         DS   0F
XSCRENT  DS   0CL80
         DC   CL80' '
         ORG XSCRENT+7
         DC   C'+-----------------------------------------------+'
         ORG
XSCREEN  DS   0CL80
         DC   CL80' '
         ORG  XSCREEN+20
         DC   C'VIRTUAL STORAGE MAP'
         ORG
* --------------------------------------------------
XSCREN1  DS   0CL80
         DC   CL80' '
         ORG XSCREN1+14
         DC   C'SQA'
         ORG XSCREN1+19
XSQAHIGH DS   CL8
         ORG XSCREN1+29
         DC   C'SIZE ='
         ORG XSCREN1+36
XSQASIZE DS   CL5
         ORG XSCREN1+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
XSCREN1B DS   0CL80
         DC   CL80' '
         ORG XSCREN1B+19
XSQALOW  DS   CL8
         ORG XSCREN1B+35
XSQASIZK DS   CL6
         ORG XSCREN1B+42
         DC   C'K'
         ORG
* --------------------------------------------------
XSCREN2  DS   0CL80
         DC   CL80' '
         SPACE
         ORG XSCREN2+13
         DC   C'PLPA'
         ORG XSCREN2+19
XLPAHIGH DS   CL8
         ORG XSCREN2+29
         DC   C'SIZE ='
         ORG XSCREN2+36
XLPASIZE DS   CL5
         ORG XSCREN2+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
XSCREN3  DS   0CL80
         DC   CL80' '
         ORG XSCREN3+19
XLPALOW  DS   CL8
         ORG XSCREN3+35
XLPASIZK DS   CL6
         ORG XSCREN3+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
XSCREN4  DS   0CL80
         DC   CL80' '
         ORG XSCREN4+14
         DC   C'CSA'
         ORG XSCREN4+19
XCSAHIGH DS   CL8
         ORG XSCREN4+29
         DC   C'SIZE ='
         ORG XSCREN4+36
XCSASIZE DS   CL5
         ORG XSCREN4+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
XSCREN5  DS   0CL80
         DC   CL80' '
         ORG XSCREN5+19
XCSALOW  DS   CL8
         ORG XSCREN5+35
XCSASIZK DS   CL6
         ORG XSCREN5+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
XSCREN6  DS   0CL80
         DC   CL80' '
         ORG XSCREN6+10
         DC   C'PRIVATE'
         ORG XSCREN6+19
XPVTHIGH DS   CL8
         ORG XSCREN6+29
         DC   C'SIZE ='
         ORG XSCREN6+36
XPVTSIZE DS   CL5
         ORG XSCREN6+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
XSCREN7  DS   0CL80
         DC   CL80' '
         ORG XSCREN7+13
         DC   C'AREA'
         ORG XSCREN7+19
XPVTLOW  DS   CL8
         ORG XSCREN7+35
XPVTSIZK DS   CL6
         ORG XSCREN7+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
XSCREN8  DS   0CL80
         DC   CL80' '
         ORG XSCREN8+9
         DC   C'V=R LINE'
         ORG XSCREN8+19
XVRLINE  DS   CL8
         ORG XSCREN8+29
         DC   C'SIZE ='
         ORG XSCREN8+37
XVRSIZE  DS   CL4
         ORG XSCREN8+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
XSCREN9  DS   0CL80
         DC   CL80' '
         ORG XSCREN9+10
         DC   C'NUCLEUS'
         ORG XSCREN9+19
XNUCHIGH DS   CL8
         ORG XSCREN9+29
         DC   C'SIZE ='
         ORG XSCREN9+36
XNUCSIZE DS   CL5
         ORG XSCREN9+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
XSCRENA  DS   0CL80
         DC   CL80' '
         ORG XSCRENA+19
XNUCLOW  DS   CL8
         ORG XSCRENA+35
XNUCSIZK DS   CL6
         ORG XSCRENA+42
         DC   C'K'
         ORG
#SCRNLEN EQU  *-XSCREEN
         EJECT
         LTORG
         SPACE 4
         $GDA                     GENERAL DATA AREA DSECT
         SPACE 4
         $PQE                     POOL QUEUE ELEMENT DSECT
         SPACE 4
         $SPQE                    SUBPOOL QUEUE ELEMENT DSECT
         SPACE 4
         $DQE                     DESCRIPTOR QUEUE ELEMENT DSECT
         SPACE 4
         $LNKSECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
WORKX1   DS    D
DWORD    DS    D
CHAR     DS    D
EXTRAREA DS    F
SAVEAREA DC   18F'0'              MY SAVE AREA
CLRAREA  EQU  *
ZERO     DC   F'0'
INPUT    DS   F                   INPUT AREA FOR TGET
FIVEBYTE DS   XL5
DBLEWORD DC   D'0'                DOUBLE WORD WORK AREA
TENBYTE  DS   XL10
MAXCORE  DS   F                   MAXIMUM STORAGE AVAILABLE
SQALOW   DS   F                   BEGINNING SQA ADDR
SQASIZE  DS   F                   BEGINNING SQA ADDR
LPALOW   DS   F                   LOWEST LPA ADDR
LPAHIGH  DS   F                   HIGHEST LPA ADDR
LPASIZE  DS   F                   SIZE OF LPA
CSAHIGH  DS   F                   HIGHEST CSA ADDR
CSASIZE  DS   F                   SIZE OF CSA
PVTLOW   DS   F                   LOWEST PVT AREA ADDR
PVTHIGH  DS   F                   HIGHEST PVT AREA ADDR
PVTSIZE  DS   F                   SIZE OF PRIVATE AREA
VRLINE   DS   F                   V=R LINE
VRSIZE   DS   F                   V=R SIZE
NUCLOW   DS   F                   LOWEST NUCLEUS ADDR
NUCHIGH  DS   F                   HIGHEST NUCLEUS ADDR
NUCSIZE  DS   F                   NUCLEUS SIZE
CLEARLEN EQU  *-CLRAREA
#SCREEN  DS   CL80
         ORG  #SCREEN+20
         DC   C'VIRTUAL STORAGE MAP'
         ORG
* --------------------------------------------------
#SCREN1  DS   CL80
         ORG #SCREN1+14
         DC   C'SQA'
         ORG #SCREN1+19
#SQAHIGH DS   CL8
         ORG #SCREN1+29
         DC   C'SIZE ='
         ORG #SCREN1+36
#SQASIZE DS   CL5
         ORG #SCREN1+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
#SCREN1B DS   CL80
         ORG #SCREN1B+19
#SQALOW  DS   CL8
         ORG #SCREN1B+35
#SQASIZK DS   CL6
         ORG #SCREN1B+42
         DC   C'K'
         ORG
* --------------------------------------------------
#SCREN2  DS   CL80
         SPACE
         ORG #SCREN2+13
         DC   C'PLPA'
         ORG #SCREN2+19
#LPAHIGH DS   CL8
         ORG #SCREN2+29
         DC   C'SIZE ='
         ORG #SCREN2+36
#LPASIZE DS   CL5
         ORG #SCREN2+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
#SCREN3  DS   CL80
         ORG #SCREN3+19
#LPALOW  DS   CL8
         ORG #SCREN3+35
#LPASIZK DS   CL6
         ORG #SCREN3+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
#SCREN4  DS   CL80
         ORG #SCREN4+14
         DC   C'CSA'
         ORG #SCREN4+19
#CSAHIGH DS   CL8
         ORG #SCREN4+29
         DC   C'SIZE ='
         ORG #SCREN4+36
#CSASIZE DS   CL5
         ORG #SCREN4+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
#SCREN5  DS   CL80
         ORG #SCREN5+19
#CSALOW  DS   CL8
         ORG #SCREN5+35
#CSASIZK DS   CL6
         ORG #SCREN5+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
#SCREN6  DS   CL80
         ORG #SCREN6+10
         DC   C'PRIVATE'
         ORG #SCREN6+19
#PVTHIGH DS   CL8
         ORG #SCREN6+29
         DC   C'SIZE ='
         ORG #SCREN6+36
#PVTSIZE DS   CL5
         ORG #SCREN6+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
#SCREN7  DS   CL80
         ORG #SCREN7+13
         DC   C'AREA'
         ORG #SCREN7+19
#PVTLOW  DS   CL8
         ORG #SCREN7+35
#PVTSIZK DS   CL6
         ORG #SCREN7+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
#SCREN8  DS   CL80
         ORG #SCREN8+9
         DC   C'V=R LINE'
         ORG #SCREN8+19
#VRLINE  DS   CL8
         ORG #SCREN8+29
         DC   C'SIZE ='
         ORG #SCREN8+37
#VRSIZE  DS   CL4
         ORG #SCREN8+42
         DC   C'K'
         SPACE
         ORG
* --------------------------------------------------
#SCREN9  DS   CL80
         ORG #SCREN9+10
         DC   C'NUCLEUS'
         ORG #SCREN9+19
#NUCHIGH DS   CL8
         ORG #SCREN9+29
         DC   C'SIZE ='
         ORG #SCREN9+36
#NUCSIZE DS   CL5
         ORG #SCREN9+42
         DC   C'MEG'
         ORG
* --------------------------------------------------
#SCRENA  DS   CL80
         ORG #SCRENA+19
#NUCLOW  DS   CL8
         ORG #SCRENA+35
#NUCSIZK DS   CL6
         ORG #SCRENA+42
         DC   C'K'
         END
./       ADD   NAME=VSM2
       COPY VSMDSECT
VSM2    TITLE 'QUEUE COMMAND  - DISPLAY VIRTUAL STORAGE MONITOR'
 SPACE 4
*
*   VSM2 WAS MODIFIED TO QUEUE SUBROUTINE
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*            4/21/87
 EJECT
VSM2      QSTART ,                  START VSM    CSECT ASSEMBLY
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
         TITLE 'VSM00200 - SQA/CSA SUBPOOL MONITOR'
***********************************************************************
*    SYSTEM -           VIRTUAL STORAGE MONITOR                       *
*    VERSION -          1.1                                           *
*    MODNAME -          VSM00100                                      *
*    AUTHOR -           R.P. SHANNON                                  *
*                       HALLMARK CARDS                                *
*                       ENFIELD DISTRIBUTION CENTER                   *
*    DATE -             9/1/82                                        *
*    FUNCTION -         THIS MODULE WILL SHOW SUBPOOL UTILIZATION     *
*                       IN CSA AND IN SQA. IT SHOWS THE AMOUNT OF     *
*                       FREE OR UNALLOCATED SPACE IN EACH SUBPOOL,    *
*                       THE LARGEST CONTIGUOUS FREE SPACE AND THE     *
*                       PERCENTAGE FREE OR UNUSED.                    *
*    ATTRIBUTES -       REUS                                          *
*    REGS AT INPUT-     R1   - INTER MODULE LINKAGE                   *
*                       R14  - RETURN ADDRESS                         *
*                       R15  - EPA                                    *
*    REG USAGE     -    R0-R7 - WORK REGS                             *
*                       R8   - GDA POINTER                            *
*                       R9   - INTERNAL BAL REG                       *
*                       R10  - LINKAGE AREA POINTER                   *
*                       R11  - BASE REG                               *
*                       R13  - SAVEAREA POINTER                       *
*    REGS AT EXIT -     R14  - RETURN ADDRESS                         *
*    NOTE -             SOME OF THE FIELD USAGE IN THIE MODULE CAN    *
*                       BE DETERMINED BY THE FIRST CHARACTER OF THE   *
*                       FIELD. THE KEYS ARE:                          *
*                            @ - THE FIELD IS IN THE INTER MODULE     *
*                                LINKAGE AREA                         *
*                            # - FIELD IS PART OF THE OUTPUT SCREEN   *
*                            $ - DSECT                                *
*    MACROS -           $DQE       => RYO DQESECT                     *
*                       $FBQE      => RYO FBQESECT                    *
*                       $FQESECT   => RYO FQESECT                     *
*                       $GDA       => RYO GDA                         *
*                       $PQE       => RYO PQESECT                     *
*                       $SPQE      => RYO SPQESECT                    *
*                       HMAP       => SCREEN BUILDER                  *
*                       PKEY       => AUTHORIZATION MACRO             *
*    MODS -                                                           *
*          VERSION 1.0  - BASE                                        *
*          VERSION 1.1  - 1. REMOVED AUTOMATIC UPSHIFT OF KEYBOARD    *
*                         2. STARTED USING THE SQASPLFT FIELD OF      *
*                            THE GDA TO DETERMINE AVAILABLE SPACE     *
*                            IN SQA. THIS CAN (WILL) CAUSE SQA        *
*                            FREE SPACE TO APPEAR > SQA SIZE, AND     *
*                            PCT FREE CAN EXCEED 100% (SEE CODE)      *
***********************************************************************
***********************************************************************
*        FIND ALL NECESSARY ADDRESSES AND POINTERS                    *
***********************************************************************
P000100  DS    0H
         LR    R7,R1      EXTRAREA
         USING $LNKSECT,R7
         MVI   @VSMFLAG,X'02'
         SPACE
P000200  DS    0H
         LA    R2,SQADQE           CLEAR
         LA    R3,CLEARLEN         WORK
         LR    R4,R2               AREA
         LA    R5,0                WITH
         MVCL  R2,R4               ZEROS
         LA    R2,#SCREEN
         LA    R3,#SCRNLEN
         LA    R4,XSCREEN
         LR    R5,R3
         MVCL  R2,R4
         SPACE
         SR    R0,R0               CLEAR R0
         SR    R2,R2               CLEAR R2
         SR    R3,R3               CLEAR R3
         SR    R4,R4               CLEAR R4
         SR    R5,R5               CLEAR R5
         SPACE
         L     R8,@GDA             GDA POINTER
         USING $GDA,R8             GDA DSECT ADDRESSABILITY
         SPACE
P000300  DS    0H
         L     R3,SQASPQEP         SQA SPQE POINTER
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         ST    R3,SQASPQE          SAVE THIS ADDR
         USING $SPQE,R3            SPQE DSECT ADDRESSABILITY
         L     R5,SPDQEPTR         SQA DQE POINTER
         LA    R5,0(R5)            CLEAR HIGH ORDER BYTE
         ST    R5,SQADQE           SAVE SQA DQE ADDR
         USING $DQE,R5             SQA DQE DSECT ADDRESSABILITY
         MVC   SQASIZE,DQELNTH     DETERMINE SQA SIZE
         DROP  R3                  DROP SQA SPQE ADDRESSABILITY
         DROP  R5                  DROP SQA DQE ADDRESSABILITY
         SPACE
         L     R3,CSAPQEP          CSA PQE POINTER
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         ST    R3,CSAPQE           SAVE THIS ADDR FOR LATER USE
         USING $PQE,R3             PQE DSECT ADDRESSABILITY
         MVC   CSASIZE,PQESIZE     DETERMINE CSA SIZE
         DROP  R3                  DROP CSA PQE ADDRESSABILITY
         EJECT
***********************************************************************
*        DETERMINE THE FREE SPACE, UNALLOCATED SPACE AND % UTILIZED   *
***********************************************************************
P000400  DS    0H
         LA    R6,$SPINFO          POINT TO SUBPOOL INFO AREA
         LA    R6,0(R6)            CLEAR HIGH ORDER BYTE
         L     R3,SQASPQE          POINT TO SQA SPQE
         SETAUTH ON
         MODESET KEY=ZERO,MODE=SUP KEY ZERO SUPERVISOR STATE CBT-AXC
         BAL   R9,SPQELOOP         PERFORM SUB-ROUTINE
         SPACE
         L     R3,SQADQE           POINT TO THE SQA DQE
         USING $DQE,R3             SQA DQE DSECT ADDRESSABILITY
         L     R0,DQEPTR           LOAD NEXT DQE PTR
         LTR   R0,R0               TEST FOR SQA OVERFLOW INTO CSA
         BZ    P000500             BRANCH IF NO OVERFLOW
         MVC   #SQAOVFL,MSG3       MOVE OVERFLOW MSG TO OUTPUT SCREEN
         SPACE
P000500  DS    0H
         DROP  R3                  DROP SQA DQE ADDRESSABILITY
         L     R3,CSAPQE           PTR TO CSA PSA => SETUP FOR PQELOOP
         SR    R1,R1               CLEAR R1 => SETUP FOR PQELOOP
         TM    GDAFLAGS,X'0C'      ANY SQA PROBLEMS ?
         BZ    P000700             NOPE => GO DO CSA
         TM    GDAFLAGS,X'08'      SQA THRESHOLD 1 ?
         BZ    P000600             IF NO, MUST BE THRESHOLD 2
         MVC   #SQATHRS,MSG1       MOVE THRESHOLD 1 MSG TO OUTPUT SCR
         B     P000600             GO DO CSA
         SPACE
P000600  DS    0H
         MVC   #SQATHRS,MSG2       MOVE THRESHOLD 2 MSG TO OUTPUT SCR
         SPACE
P000700  DS    0H
         BAL   R9,PQELOOP          PERFORM CSA UNALLOCATED SUBRTN
         L     R3,CSASPQEP         CSA SPQE POINTER
         BAL   R9,SPQELOOP         PERFORM FREE SPACE SUBRTN
 MODESET KEY=NZERO,MODE=PROB ORIG PROTECT KEY, PROBLEM STATE CBT-AXC
         SETAUTH OFF
         EJECT
**********************************************************************
*        => MOD FOR VERSION 1.1 <=                                   *
*        WE USED TO SET ALL THE SQA VALUES EQUAL TO THE SUBPOOL      *
*        245 VALUES BECAUSE 245 IS SQA'S SUBPOOL. HOWEVER THE        *
*        SQASPLFT FIELD IN THE GDA SHOWS SQA FREE SPACE AS           *
*        SUBPOOL 245 FS + CSA UNALLOCATED SPACE. WE NOW USE          *
*        SQASPLFT TO REFLECT SQA FREE SPACE. THEREFORE IS IS NOW     *
*        POSSIBLE TO SHOW SQA FREE SPACE > SQA SIZE AND PCT FREE     *
*        MAY EXCEED 100%. I CONSIDER THE VALUES IN SP245 TO BE       *
*        THE TRUE VALUES FOR SQA. BY USING THE SQASPLFT VALUE FOR    *
*        SQA WE  REVEAL WHAT MVS THINKS IS AVAILABLE. ALTHOUGH       *
*        MVS CAN GETMAIN THE REMAINING CSA UNALLOCATED SPACE INTO    *
*        SP239 THIS CERTAINLY IS NOT DESIREABLE. I DON'T KNOW WHEN   *
*        MVS UPDATES SQASPLFT BUT IT USUALLY VARIES BY A FEW K FROM  *
*        THE SUM OF CSA UNALLOCATED SPACE + SP245 FREE SPACE AS WE   *
*        CALCULATE THEM.                                             *
**********************************************************************
P000750  DS    0H
         SR    R4,R4               CLEAR R4
         L     R5,TEN              SET R5 TO 10
         MVC   SQAUNAL,SQASPLFT    DETERMINE UNALLOCATED SPACE IN SQA
         LA    R6,$SPINFO          POINT TO SPINFO AREA
         LA    R6,80(R6)           OFFSET TO SP245
         USING $SPDSECT,R6         DSECT ADDRESSABILITY
         CLC   CSAUNAL,$SPLARGE    CSA LARGEST FS > SP245 LARGEST ?
         BH    P000760             BIF YES
         MVC   SQALARGE,$SPLARGE   MAKE SQA LARGEST FS = SP245 LARGEST
         B     P000770             BRANCH
         SPACE
P000760  DS    0H
         MVC   SQALARGE,CSAUNAL    MAKE SQA LARGEST FS = CSA LARGEST
         SPACE
P000770  DS    0H
         DROP  R6                  DROP DSECT ADDRESSABILITY
         LA    R6,SQASIZE          POINT TO SQA SIZE
         USING $SPDSECT,R6         DSECT ADDRESSABILITY
*                                  WE'RE CHEATING HERE AND USING THE
*                                  SUBPOOL AREA DSECT BUT IT WORKS OK
         BAL   R9,SPLOOP01         GO DO SUB-POOL CALCS FOR SQA
         MVC   #SQAFREE,WRKFREE    MOVE SQA FREE SPACE TO SCREEN
         MVC   #SQALRGE,WRKLARGE   MOVE SQA LARGEST UNUSED SP TO SCREEN
         MVC   #SQASIZE,WRKSIZE    MOVE SQA SIZE TO SCREEN
         MVC   #SQAPCT,WRKPCT      MOVE SQA PCT UTILIZED TO SCREEN
         SPACE
P000800  DS    0H
         SR    R4,R4               CLEAR R4
         MVC   FSACCUM,ZERO        SET FREE SPACE ACCUM TO ZERO
         SPACE
         LA    R6,$SPINFO          POINT TO SP INFO AREA
         LA    R6,80(R6)           OFFSET TO SUBPOOL 245
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS FOR SP 245
         SPACE
         MVC   #245NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #245FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #245LRGE,WRKLARGE   MOVE SP LARGEST UNUSED SP TO SCREEN
         MVC   #245SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #245PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         SPACE
         SPACE
P000900  DS    0H
         SR    R2,R2               CLEAR R2
         SR    R4,R4               CLEAR R4
         L     R3,CSASIZE          COMPUTE CSA IN K
         SRA   R3,10               BY DIVIDING BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   #CSASIZE,EDIT2      MOVE IN PATTERN
         ED    #CSASIZE,DBLEWORD+5 EDIT
         EJECT
P001000  DS    0H
         SR    R2,R2               CLEAR R2
         L     R3,CSAUNAL          COMPUTE CSA UNAL SPACE IN K
         SRA   R3,10               BY DIVIDING BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   #CSAUNAL,EDIT2      MOVE IN PATTERN
         ED    #CSAUNAL,DBLEWORD+5 EDIT
         SPACE
P001100  DS    0H
         SR    R2,R2               CLEAR R2
         L     R3,CSALARG          COMPUTE CSA LARGEST UNAL SPACE IN K
         SRA   R3,10               BY DIVIDING BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   #CSALARG,EDIT2      MOVE IN PATTERN
         ED    #CSALARG,DBLEWORD+5 EDIT
         SPACE
P001200  DS    0H
         SR    R2,R2               CLEAR R2
         SR    R4,R4               CLEAR R4
         LA    R4,100(R4)          SET R4 TO 100
         L     R3,CSASIZE          LOAD CSA SIZE INTO R3
         DR    R2,R4               DIVIDE SIZE BY 100
         LR    R4,R3               MOVE SIZE/100 INTO R4
         SR    R2,R2               CLEAR R2
         L     R3,CSAUNAL          LOAD SUBPOOL FS INTO R3
         DR    R2,R4               COMPUTE % FREE
         CVD   R3,DBLEWORD         CONVERT THE PCT TO DECIMAL
         MVC   #CSAPCT,EDIT3       MOVE IN EDIT PATTERN
         ED    #CSAPCT,DBLEWORD+6  EDIT THE % UTILIZED
         SPACE
**********************************************************************
*        DO THE SUB-POOL CALCULATIONS FOR CSA                        *
**********************************************************************
P001300  DS    0H
         LA    R6,$SPINFO          POINT TO SP INFO AREA
         LA    R6,0(R6)            CLEAR HIGH ORDER BYTE
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS
         MVC   #227NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #227SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #227FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #227LRGE,WRKLARGE   MOVE SP LARGEST UNUSED SP TO SCREEN
         MVC   #227PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         SPACE
         LA    R6,16(R6)           ADDRESS NEXT PART OF SP INFO AREA
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS
         MVC   #228SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #228NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #228FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #228LRGE,WRKLARGE   MOVE SP LARGEST UNUSED SP TO SCREEN
         MVC   #228PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         SPACE
         LA    R6,16(R6)           ADDRESS NEXT PART OF SP INFO AREA
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS
         MVC   #231NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #231FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #231SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #231LRGE,WRKLARGE   MOVE SP LARGEST UNUSED SP TO SCREEN
         MVC   #231PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         SPACE
         LA    R6,16(R6)           ADDRESS NEXT PART OF SP INFO AREA
         USING $SPDSECT,R6         DSECT ADDRESSABILITY
         MVC   $SPNUMB,SP239       INDICATE THIS IS SUB-POOL 239
         DROP  R6                  DROP DSECT ADDRESSABILITY
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS
         MVC   #239SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #239NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #239FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #239LRGE,WRKLARGE   MOVE SP LARGEST UNSUED SP TO SCREEN
         MVC   #239PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         SPACE
         LA    R6,16(R6)           ADDRESS NEXT PART OF SP INFO AREA
         BAL   R9,SPLOOP           GO DO SUB-POOL CALCS
         MVC   #241SIZE,WRKSIZE    MOVE SP SIZE TO SCREEN
         MVC   #241NUMB,WRKNUMB    MOVE SP NUMBER TO SCREEN
         MVC   #241FREE,WRKFREE    MOVE SP FREE SPACE TO SCREEN
         MVC   #241LRGE,WRKLARGE   MOVE SP LARGEST UNSUED SP TO SCREEN
         MVC   #241PCT,WRKPCT      MOVE SP PCT UTILIZED TO SCREEN
         EJECT
***********************************************************************
*        OUTPUT THE SCREEN                                            *
***********************************************************************
P001400  DS    0H
         LR    R8,R7
         DROP  R7
         MVC   QDHLINE(80),#SCREEN
         MVC   QDMSG(80),#SCRENH
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRENH2
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRSQA
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S245
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRCSS
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRCSA
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S227
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S228
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S231
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S239
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#S241
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SSQA
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SSQAOV
         BAL   R7,DISPLAY
P999999  DS   0H
         LR   R1,R8
         QSTOP
***********************************************************************
*   LOCAL SUBROUTINE TO PUT LINE LINE VIA Q DISPLAY                 NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR LINE MESSAGE                    NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
LINE     EQU   QDMSG
         EJECT
**********************************************************************
*                                                                    *
*        => PQELOOP <=                                               *
*                                                                    *
*        TOTAL THE UNALLOCATED SPACE IN CSA BY ADDING                *
*        THE SIZE OF ALL THE FBQE'S OF ALL THE PQE'S                 *
*                                                                    *
*        LOOP STRUCTURE FOR THE FOLLOWING CODE:                      *
*                                                                    *
*        => PQELOOP                                                  *
*                                                                   *
*             => FBQELOOP                                           *
*                                                                  *
*             => FBQEEND                                            *
*                                                                   *
*        => PQEEND                                                   *
*                                                                    *
*                                                                    *
*       REGISTER USAGE FOR THIS SUBROUTINE:                          *
*                                                                    *
*       R0 =>   TEMPORARY WORK REGISTER                              *
*       R1 =>   UNALLOCATED SPACE ACCUMULATOR                        *
*       R3 =>   PQE POINTER                                          *
*       R4 =>   FBQE POINTER                                         *
*       R9 =>   RETURN ADDRESS                                       *
*                                                                    *
**********************************************************************
PQELOOP  DS    0H
         LTR   R3,R3               ANY (MORE) PQE'S ?
         BZ    PQEEND              BRANCH IF NO
         USING $PQE,R3             PQE DSECT ADDRESSABILITY
         L     R4,PQEFFBQE         POINT TO FBQE
         SPACE
FBQELOOP DS    0H
         CR    R3,R4               ANY (MORE) FBQE'S ?
         BE    FBQEEND             BRANCH IF NO
         USING $FBQE,R4            FBQE DSECT ADDRESSABILITY
         A     R1,SIZE             ACCUMULATE UNALLOCATED SPACE
         CLC   CSALARG,SIZE        LARGEST UNAL SPACE SO FAR ?
         BNL   FBQEREST            BRANCH IF NO
         MVC   CSALARG,SIZE        SAVE IF YES
         SPACE
FBQEREST DS    0H
         L     R0,FWDPTR           POINT TO NEXT FBQE
         DROP  R4                  DROP FBQE ADDRESSABILITY
         LR    R4,R0               LOAD NEXT FBQE ADDR INTO R4
         B     FBQELOOP            GO DOIT AGAIN
         SPACE
FBQEEND  DS    0H
         L     R0,PQEFPQE          POINT TO NEXT PQE
         LA    R0,0(R0)            CLEAR HIGH ORDER BYTE
         DROP  R3                  DROP PQE ADDRESSABILITY
         LR    R3,R0               POINT R3 TO NEXT PQE
         B     PQELOOP             GO DO PQE AGAIN
         SPACE
PQEEND   DS    0H
         ST    R1,CSAUNAL          STORE UNALLOCATED SPACE ACCUM
         BR    R9                  RETURN
         EJECT
**********************************************************************
*                                                                    *
*       => SPQELOOP <=                                               *
*                                                                    *
*       COMPUTE SUB-POOL SIZE BY FOLLOWING THE DQE CHAINS            *
*       COMPUTE THE SUB-POOL FREE SPACE BY FOLLOWING THE FQE CHAINS  *
*                                                                    *
*                                                                    *
*       LOOP STRUCTURE FOR THE FOLLOWING CODE:                       *
*                                                                    *
*        => SPQELOOP                                                 *
*                                                                   *
*              => DQELOOP                                           *
*                                                                  *
*                    => FQELOOP                                    *
*                                                                 *
*                    => FQEEND                                     *
*                                                                  *
*              => DQEEND                                            *
*                                                                   *
*        => SPQEEND                                                  *
*                                                                    *
*                                                                    *
*       REGISTER USAGE FOR THIS SUBROUTINE:                          *
*                                                                    *
*       R0 =>   TEMPORARY WORK REGISTER                              *
*       R1 =>   SUB-POOL SIZE ACCUMULATOR;CLEARED BEFORE ENTRY       *
*       R2 =>   SUB-POOL FREE SPACE ACCUMULATOR;CLEARED BEFORE ENTRY *
*       R3 =>   SPQE POINTER                                         *
*       R4 =>   FQE POINTER                                          *
*       R5 =>   FQE  POINTER                                         *
*       R6 =>   SUBPOOL INFO AREA POINTER                            *
*       R9 =>   RETURN ADDRESS                                       *
*                                                                    *
**********************************************************************
SPQELOOP DS    0H
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         LTR   R3,R3               ANY (MORE) SPQE'S ?
         BZ    ENDSPQE             BRANCH IF NO
         USING $SPQE,R3            SPQE DSECT ADDRESSABILITY
         CLC   SPLAST,SPQEID       SAME SUBPOOL AS LAST TIME ?
         BE    SPQEREST            BRANCH IF YES
         MVC   SPLAST,SPQEID       SAVE SUBPOOL ID
         LA    R6,$SPINFO          POINT TO SPINFO AREA
         CLC   SPQEID,SP239        SUBPOOL 239 ?
         BE    SPQE239             BRANCH IF YES
         BH    SPQE241             BRANCH IF HIGH
         CLC   SPQEID,SP228        SUBPOOL 228 ?
         BE    SPQE228             BRANCH IF YES
         BH    SPQE231             BRANCH IF HIGH
         SPACE
SPQE227  DS    0H
         LA    R6,0(R6)            CLEAR HIGH ORDER BYTE FOR SP 227
         B     SPQEREST            KEEP GOING
         SPACE
SPQE228  DS    0H
         LA    R6,16(R6)           OFFSET FOR SUB-POOL 228
         B     SPQEREST            KEEP GOING
         SPACE
SPQE231  DS    0H
         LA    R6,32(R6)           OFFSET FOR SUB-POOL 231
         B     SPQEREST            KEEP GOING
         SPACE
SPQE239  DS    0H
         LA    R6,48(R6)           OFFSET FOR SUBPOOL 239
         B     SPQEREST            KEEP GOING
         SPACE
SPQE241  DS    0H
         CLC   SPQEID,SP241        SUBPOOL 241 ?
         BH    SPQE245             BRANCH IF NO
         LA    R6,64(R6)           OFFSET FOR SUBPOOL 241
         B     SPQEREST            CONTINUE
         SPACE
SPQE245  DS    0H
         LA    R6,80(R6)           OFFSET FOR SUBPOOL 245
         SPACE
SPQEREST DS    0H
         USING $SPDSECT,R6         SUBPOOL AREA DSECT ADDRESSABILITY
         MVC   $SPNUMB,SPQEID      DETERMINE SUBPOOL NUMBER
         L     R4,SPDQEPTR         LOAD DQE ADDR INTO R4
         L     R1,$SPSIZE          RESET R1
         L     R2,$SPFREE          RESET R2
         SPACE
DQELOOP  DS    0H
         LTR   R4,R4               ANY (MORE) DQE'S ?
         BZ    ENDDQE              BRANCH IF NO
         USING $DQE,R4             CSA DQE ADDRESSABILITY
         A     R1,DQELNTH          ACCUMULATE SUB-POOL LENGTH
         L     R5,DQFQEPTR         POINTER TO FIRST FQE
         SPACE
FQELOOP  DS    0H
         LA    R5,0(R5)            CLEAR FLAGS
         LTR   R5,R5               ANY (MORE) FQE'S ?
         BZ    ENDFQE              BRANCH IF NO
         USING $FQESECT,R5         FQE DSECT ADDRESSABILITY
         A     R2,FQELNTH          ACCUMULATE SUB-POOL FREE SPACE
         CLC   $SPLARGE,FQELNTH    IS THIS THE LARGEST FREE SP SO FAR ?
         BNL   FQEREST             BRANCH IF NO
         MVC   $SPLARGE,FQELNTH    SAVE IF YES
         SPACE
FQEREST  DS    0H
         L     R0,FQEPTR           LOAD POINTER TO NEXT FQE
         DROP  R5                  DROP DSECT ADDRESSABILITY
         LR    R5,R0               LOAD NEXT FQE ADDR INTO R5
         B     FQELOOP             GO DO FQE LOOP AGAIN
         SPACE
ENDFQE   DS    0H
         L     R0,DQEPTR           LOAD POINTER TO NEXT DQE
         DROP  R4                  DROP DQE DSECT ADDRESSABILITY
         LR    R4,R0               LOAD NEXT DQE ADDR INTO R4
         B     DQELOOP             GO DO DQE LOOP AGAIN
         SPACE
ENDDQE   DS    0H
         ST    R1,$SPSIZE          STORE SUB-POOL SIZE
         ST    R2,$SPFREE          STORE SUB-POOL FREE SPACE
         TM    SPQEFLGS,LASTSPQE   LAST SPQE ON THE CHAIN ?
         BO    ENDSPQE             BRANCH IF YES
         L     R0,SPQEAD           LOAD POINTER TO NEXT SPQE
         DROP  R3                  DROP SPQE DSECT ADDRESSABILITY
         LR    R3,R0               LOAD NEXT SPQE ADDR INTO R3
         DROP  R6                  DROP SUBPOOL DSECT ADDRESSABILITY
         B     SPQELOOP            GO DO SPQE LOOP AGAIN
         SPACE
ENDSPQE  DS    0H
         BR    R9                  RETURN
         EJECT
**********************************************************************
*                                                                    *
*       => SPLOOP <=                                                 *
*                                                                    *
*       PREPARE THE DATA IN SPINFO AREA FOR OUTPUT                   *
*                                                                    *
*       REGISTER USAGE FOR THIS SUBROUTINE:                          *
*                                                                    *
*       R0  =>   TEMPORARY WORK REGISTER                             *
*       R1  =>   TEMPORARY WORK REGISTER                             *
*       R2  =>   TEMPORARY WORK REGISTER                             *
*       R3  =>   TEMPORARY WORK REGISTER                             *
*       R4  =>   TEMPORARY WORK REGISTER                             *
*       R5  =>   TEMPORARY WORK REGISTER                             *
*       R6  =>   SPINFO AREA POINTER
*       R9  =>   RETURN ADDRESS                                      *
*                                                                    *
**********************************************************************
SPLOOP   DS    0H
         USING $SPDSECT,R6         SP INFO DSECT ADDRESSABILITY
         SR    R0,R0               CLEAR R0
         SR    R4,R4               CLEAR R4
         IC    R0,$SPNUMB          LOAD SUBPOOL ID INTO R0
         SPACE
         DS    0H
         CVD   R0,DBLEWORD         CONVERT
         MVC   WRKNUMB,EDIT1       AND EDIT
         ED    WRKNUMB,DBLEWORD+6  SUBPOOL ID
         SPACE
SPLOOP01 DS    0H
         SR    R2,R2               DETERMINE SUB-POOL SIZE IN K
         L     R3,$SPSIZE          BY DIVIDING THE SIZE IN BYTES
         SRA   R3,10               BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   WRKSIZE,EDIT2       MOVE IN PATTERN
         ED    WRKSIZE,DBLEWORD+5  EDIT
         SPACE
         SR    R2,R2               DETERMINE SUB-POOL FS IN K
         L     R3,$SPFREE          BY DIVIDING THE SIZE IN BYTES
         SRA   R3,10               BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   WRKFREE,EDIT2       MOVE IN PATTERN
         ED    WRKFREE,DBLEWORD+5  EDIT
         SPACE
         SR    R2,R2               CLEAR R2
         SR    R2,R2               DETERMINE SUBPOOL LARGEST FS IN K
         L     R3,$SPLARGE         BY DIVIDING THE SIZE IN BYTES
         SRA   R3,10               BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         MVC   WRKLARGE,EDIT2      MOVE IN PATTERN
         ED    WRKLARGE,DBLEWORD+5 EDIT
         SPACE
         CLC   $SPSIZE,ZERO        IF SUBPOOL SIZE ^ ZERO
         BNE   SPLOOP10            GO COMPUTE PCT USED
         CVD   R2,DBLEWORD         ELSE
         MVC   WRKPCT,EDIT3        SET PCT USED
         ED    WRKPCT,DBLEWORD+6   TO ZERO
         B     ENDSPLP             BRANCH TO LOOP END
         SPACE
SPLOOP10 DS    0H
         SR    R2,R2               CLEAR R2
         SR    R4,R4               CLEAR R4
         LA    R4,100(R4)          SET R4 TO 100
         L     R3,$SPSIZE          LOAD SUBPOOL SIZE INTO R3
         DR    R2,R4               DIVIDE SIZE BY 100
         LR    R4,R3               MOVE SIZE/100 INTO R4
         SR    R2,R2               CLEAR R2
         L     R3,$SPFREE          LOAD SUBPOOL FS INTO R3
         DR    R2,R4               COMPUTE % FREE
         CVD   R3,DBLEWORD         CONVERT THE PCT TO DECIMAL
         MVC   WRKPCT,EDIT3        MOVE IN EDIT PATTERN
         ED    WRKPCT,DBLEWORD+6   EDIT THE % UTILIZED
         SPACE
ENDSPLP  DS    0H
         BR    R9                  RETURN
         EJECT
         DS    0F
TEN      DC   X'0000000A'         TEN IN HEX
WAITTIME DC   X'00000320'         10 SECONDS IN 1/100'S
ZERO     DC   F'0'
MSG1     DC   C'=====>      SQA THRESHOLD 1     <====='
MSG2     DC   C'=====>      SQA THRESHOLD 2     <====='
MSG3     DC   C'=====> SQA OVERFLOWING INTO CSA <====='
EDIT1    DC   X'40202120'         EDIT PATTERN FOR SIZE IN MEG
EDIT2    DC   X'402020202120'     EDIT PATTERN FOR SIZE IN K
EDIT3    DC   X'40202120'         EDIT PATTERN FOR PCT
SP228    DC   X'E4'               SUBPOOL 228
SP239    DC   X'EF'               SUBPOOL 239
SP241    DC   X'F1'               SUBPOOL 241
         DS   0F
XSCREEN  DS   0CL80
         DC   CL80' '
         ORG  XSCREEN+20
         DC   C'SQA/CSA UTILIZATION'
         ORG
*        ---------------------------------------------------
XSCRENH  DS   0CL80
         DC   CL80' '
         ORG  XSCRENH+25
         DC   C'UNAL OR     LARGEST     PCT UNAL'
         ORG
*        ---------------------------------------------------
XSCRENH2 DS   0CL80
         DC   CL80' '
         ORG  XSCRENH2+6
         DC   C'ID        SIZE     FREE SP    UNAL/FREE    OR FREE'
         ORG
*        ---------------------------------------------------
XSCRSQA  DS   0CL80
         DC   CL80' '
          ORG  XSCRSQA+5
         DC   C'SQA'
          ORG  XSCRSQA+13
XSQASIZE DS   CL6
          ORG  XSCRSQA+20
         DC   C'K'
          ORG  XSCRSQA+23
XSQAFREE DS   CL6
          ORG  XSCRSQA+30
         DC   C'K'
          ORG  XSCRSQA+35
XSQALRGE DS   CL6
          ORG  XSCRSQA+42
         DC   C'K'
          ORG  XSCRSQA+50
XSQAPCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS245    DS   0CL80
         DC   CL80' '
         ORG XS245+3
         DC   C'SP'
         ORG XS245+6
X245NUMB DS   CL4
         ORG XS245+13
X245SIZE DS   CL6
         ORG XS245+20
         DC   C'K'
         ORG XS245+23
X245FREE DS   CL6
         ORG XS245+30
         DC   C'K'
         ORG XS245+35
X245LRGE DS   CL6
         ORG XS245+42
         DC   C'K'
         ORG XS245+50
X245PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XSCRCSS  DS   0CL80
         DC   CL80' '
         ORG XSCRCSS+3
         DC   54C'-'
          ORG
*        ---------------------------------------------------
XSCRCSA  DS   0CL80
         DC   CL80' '
         ORG XSCRCSA+5
         DC   C'CSA'
         ORG XSCRCSA+13
XCSASIZE DS   CL6
         ORG XSCRCSA+20
         DC   C'K'
         ORG XSCRCSA+23
XCSAUNAL DS   CL6
         ORG XSCRCSA+30
         DC   C'K'
         ORG XSCRCSA+35
XCSALARG DS   CL6
         ORG XSCRCSA+42
         DC   C'K'
         ORG XSCRCSA+50
XCSAPCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS227    DS   0CL80
         DC   CL80' '
         ORG XS227+3
         DC   C'SP'
         ORG XS227+6
X227NUMB DS   CL4
         ORG XS227+13
X227SIZE DS   CL6
         ORG XS227+20
         DC   C'K'
         ORG XS227+23
X227FREE DS   CL6
         ORG XS227+30
         DC   C'K'
         ORG XS227+35
X227LRGE DS   CL6
         ORG XS227+42
         DC   C'K'
         ORG XS227+50
X227PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS228    DS   0CL80
         DC   CL80' '
         ORG XS228+3
         DC   C'SP'
         ORG XS228+6
X228NUMB DS   CL4
         ORG XS228+13
X228SIZE DS   CL6
         ORG XS228+20
         DC   C'K'
         ORG XS228+23
X228FREE DS   CL6
         ORG XS228+30
         DC   C'K'
         ORG XS228+35
X228LRGE DS   CL6
         ORG XS228+42
         DC   C'K'
         ORG XS228+50
X228PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS231    DS   0CL80
         DC   CL80' '
         ORG XS231+3
         DC   C'SP'
         ORG XS231+6
X231NUMB DS   CL4
         ORG XS231+13
X231SIZE DS   CL6
         ORG XS231+20
         DC   C'K'
         ORG XS231+23
X231FREE DS   CL6
         ORG XS231+30
         DC   C'K'
         ORG XS231+35
X231LRGE DS   CL6
         ORG XS231+42
         DC   C'K'
         ORG XS231+50
X231PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS239    DS   0CL80
         DC   CL80' '
         ORG XS239+3
         DC   C'SP'
         ORG XS239+6
X239NUMB DS   CL4
         ORG XS239+13
X239SIZE DS   CL6
         ORG XS239+20
         DC   C'K'
         ORG XS239+23
X239FREE DS   CL6
         ORG XS239+30
         DC   C'K'
         ORG XS239+35
X239LRGE DS   CL6
         ORG XS239+42
         DC   C'K'
         ORG XS239+50
X239PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XS241    DS   0CL80
         DC   CL80' '
         ORG XS241+3
         DC   C'SP'
         ORG XS241+6
X241NUMB DS   CL4
         ORG XS241+13
X241SIZE DS   CL6
         ORG XS241+20
         DC   C'K'
         ORG XS241+23
X241FREE DS   CL6
         ORG XS241+30
         DC   C'K'
         ORG XS241+35
X241LRGE DS   CL6
         ORG XS241+42
         DC   C'K'
         ORG XS241+50
X241PCT  DS   CL4
         DC   C'%'
          ORG
*        ---------------------------------------------------
XSSQA    DS   0CL80
         DC   CL80' '
         ORG  XSSQA+11
XSQATHRS DC   38C' '
          ORG
*        ---------------------------------------------------
XSSQAOV  DS   0CL80
         DC   CL80' '
         ORG  XSSQAOV+11
XSQAOVFL DC   38C' '
          ORG
#SCRNLEN EQU  *-XSCREEN           LENGTH FOR CLEAR
         LTORG
$SPDSECT DSECT
$SPSIZE  DS   F
$SPFREE  DS   F
$SPLARGE DS   F
$SPNUMB  DS   CL1
$UNUSED  DS   CL3
         SPACE
         $DQE                     DESCRIPTOR QUEUE ELEMENT DSECT
         $FBQE                    FREE BLOCK QUEUE ELEMENT DSECT
         $FQESECT                 FREE QUEUE ELEMENT DSECT
         $GDA                     GENERAL DATA AREA DSECT
         $PQE                     PARTITIONED QUEUE ELEMENT
         $SPQE                    SUBPOOL QUEUE ELEMENT DSECT
         $LNKSECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
WORKX1   DS    D
DWORD    DS    D
CHAR     DS    D
EXTRAREA DS    F
SAVEAREA DS    18F                MY SAVE AREA
SQADQE   DS    F                  SQA DQE ADDR
SQASPQE  DS    F                  SQA SPQE ADDR
CSAPQE   DS    F                  CSA 1ST PQE ADDR
CSASIZE  DS    F                  CSA SIZE
FULLWORD DS    F
DBLEWORD DS    D                  DOUBLE WORD WORK AREA
TENBYTE  DS    XL10
SPLAST   DS    B                  LAST SUBPOOL HOLD
FSACCUM  DS    F                  ACCUMULATOR FOR SUB-POOL FREE SPACE
WRKNUMB  DS    F                  WORK AREA FOR SUB-POOL SIZE
WRKSIZE  DS    CL6                WORK AREA FOR SUB-POOL SIZE
WRKFREE  DS    CL6                WORK AREA FOR SUB-POOL FREE SPACE
WRKLARGE DS    CL6                WORK AREA FOR SUB-POOL UNALLOC SPACE
WRKPCT   DS    F                  WORK AREA FOR SUB-POOL %
SQASIZE  DS    F                  SQA SIZE
SQAUNAL  DS    F                  SQA UNALLOCATED SPACE ACCUM
SQALARGE DS    F                  SQA LARGEST FREE SPACE
CSAUNAL  DS    F                  CSA UNALLOCATED SPACE ACCUM
CSALARG  DS    F                  CSA LARGEST UNALLOCATED SPACE
         DS   0F
$SPINFO  DS   CL96                THIS AREA SHOULD BE ON FW BOUNDARY
CLEARLEN EQU  *-SQADQE            LENGTH FOR CLEAR
         DS   0F
#SCREEN  DS   CL80
         ORG  #SCREEN+20
         DC   C'SQA/CSA UTILIZATION'
         ORG
*        ---------------------------------------------------
#SCRENH  DS   CL80
         ORG  #SCRENH+25
         DC   C'UNAL OR     LARGEST     PCT UNAL'
         ORG
*        ---------------------------------------------------
#SCRENH2 DS   CL80
         ORG #SCRENH2+6
         DC   C'ID        SIZE     FREE SP    UNAL/FREE    OR FREE'
         ORG
*        ---------------------------------------------------
#SCRSQA  DS   CL80
          ORG  #SCRSQA+5
         DC   C'SQA'
          ORG  #SCRSQA+13
#SQASIZE DS   CL6
          ORG  #SCRSQA+20
         DC   C'K'
          ORG  #SCRSQA+23
#SQAFREE DS   CL6
          ORG  #SCRSQA+30
         DC   C'K'
          ORG  #SCRSQA+35
#SQALRGE DS   CL6
          ORG  #SCRSQA+42
         DC   C'K'
          ORG  #SCRSQA+50
#SQAPCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S245    DS   CL80
         ORG #S245+3
         DC   C'SP'
         ORG #S245+6
#245NUMB DS   CL4
         ORG #S245+13
#245SIZE DS   CL6
         ORG #S245+20
         DC   C'K'
         ORG #S245+23
#245FREE DS   CL6
         ORG #S245+30
         DC   C'K'
         ORG #S245+35
#245LRGE DS   CL6
         ORG #S245+42
         DC   C'K'
         ORG #S245+50
#245PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#SCRCSS DS   CL80
         ORG #SCRCSS+3
         DC   54C'-'
          ORG
*        ---------------------------------------------------
#SCRCSA  DS   CL80
         ORG #SCRCSA+5
         DC   C'CSA'
         ORG #SCRCSA+13
#CSASIZE DS   CL6
         ORG #SCRCSA+20
         DC   C'K'
         ORG #SCRCSA+23
#CSAUNAL DS   CL6
         ORG #SCRCSA+30
         DC   C'K'
         ORG #SCRCSA+35
#CSALARG DS   CL6
         ORG #SCRCSA+42
         DC   C'K'
         ORG #SCRCSA+50
#CSAPCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S227    DS   CL80
         ORG #S227+3
         DC   C'SP'
         ORG #S227+6
#227NUMB DS   CL4
         ORG #S227+13
#227SIZE DS   CL6
         ORG #S227+20
         DC   C'K'
         ORG #S227+23
#227FREE DS   CL6
         ORG #S227+30
         DC   C'K'
         ORG #S227+35
#227LRGE DS   CL6
         ORG #S227+42
         DC   C'K'
         ORG #S227+50
#227PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S228    DS   CL80
         ORG #S228+3
         DC   C'SP'
         ORG #S228+6
#228NUMB DS   CL4
         ORG #S228+13
#228SIZE DS   CL6
         ORG #S228+20
         DC   C'K'
         ORG #S228+23
#228FREE DS   CL6
         ORG #S228+30
         DC   C'K'
         ORG #S228+35
#228LRGE DS   CL6
         ORG #S228+42
         DC   C'K'
         ORG #S228+50
#228PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S231    DS   CL80
         ORG #S231+3
         DC   C'SP'
         ORG #S231+6
#231NUMB DS   CL4
         ORG #S231+13
#231SIZE DS   CL6
         ORG #S231+20
         DC   C'K'
         ORG #S231+23
#231FREE DS   CL6
         ORG #S231+30
         DC   C'K'
         ORG #S231+35
#231LRGE DS   CL6
         ORG #S231+42
         DC   C'K'
         ORG #S231+50
#231PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S239    DS   CL80
         ORG #S239+3
         DC   C'SP'
         ORG #S239+6
#239NUMB DS   CL4
         ORG #S239+13
#239SIZE DS   CL6
         ORG #S239+20
         DC   C'K'
         ORG #S239+23
#239FREE DS   CL6
         ORG #S239+30
         DC   C'K'
         ORG #S239+35
#239LRGE DS   CL6
         ORG #S239+42
         DC   C'K'
         ORG #S239+50
#239PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#S241    DS   CL80
         ORG #S241+3
         DC   C'SP'
         ORG #S241+6
#241NUMB DS   CL4
         ORG #S241+13
#241SIZE DS   CL6
         ORG #S241+20
         DC   C'K'
         ORG #S241+23
#241FREE DS   CL6
         ORG #S241+30
         DC   C'K'
         ORG #S241+35
#241LRGE DS   CL6
         ORG #S241+42
         DC   C'K'
         ORG #S241+50
#241PCT  DS   CL4
          ORG
*        ---------------------------------------------------
#SSQA    DS   CL80
         ORG  #SSQA+11
#SQATHRS DC   38C' '
          ORG
*        ---------------------------------------------------
#SSQAOV  DS   CL80
         ORG  #SSQAOV+11
#SQAOVFL DC   38C' '
         END
./       ADD   NAME=VSM3
        COPY  VSMDSECT
VSM3    TITLE 'QUEUE COMMAND  - DISPLAY VIRTUAL STORAGE MONITOR'
 SPACE 4
*
*   VSM3 WAS MODIFIED TO QUEUE SUBROUTINE
*            DAVID RIKER
*            COMPUTER DATA SYSTEMS INC
*            1 CURIE COURT
*            ROCKVILLE, MD 20855
*            202- 362 1160
*            4/21/87
 EJECT
VSM3      QSTART ,                  START VSM    CSECT ASSEMBLY
         GBLB  &QSP           SP2 FLAG                            UF030
         GBLB  &QSP133        SP1.3.3 FLAG                        UF046
         GBLB  &QNERDC        NERDC FLAG                          UF030
         GBLB  &QONL          ONL FLAG                            ONL06
         GBLB  &QTSS         TSS FLAG    DOR
         GBLB  &QACF2         ACF2 FLAG                             NTL
         SPACE 1                                                  ONL15
         GBLC  &ACF2XIT,&ACF2DCT,&ACF2JCT,&OFFSET  ACF2 GLOBALS   ONL15
         SPACE 1                                                  ONL15
         USING QDISPLAY,R10  BASE REG FOR DISPLAY WORK AREA        NTL
         L     R10,QVDSPL     LOAD BASE REG                         NTL
         USING WORK,R13       BASE REG FOR LOCAL WORK AREA          NTL
***********************************************************************
*    COMMENT BY DAVE RIKER / CDSI
***********************************************************************
*         THIS IS QUEUE STANDARD REGISTERS FOR EACH ROUTINE
*    R1   -
*    R2   -
*    R3   -
*    R4   -
*    R5   -
*    R6   -
*    R7   -
*    R8   -
*    R9   -  WORK REG IE CALLED REGS
*    R10  -  QDISPLAY
*    R11  -  QCOMMON
*    R12  -  BASE REG
*    R13  -  WORK AREA (QUEUE 4096 MAX)
*    R14  -
*    R15  -
***********************************************************************
         TITLE 'VSM00300 => CSA PROTECT KEY MONITOR'
***********************************************************************
*    SYSTEM -           VIRTUAL STORAGE MONITOR                       *
*    VERSION -          1.1                                           *
*    MODNAME -          VSM00300                                      *
*    AUTHOR -           R.P. SHANNON                                  *
*                       HALLMARK CARDS                                *
*                       ENFIELD DISTRIBUTION CENTER                   *
*                       ENFIELD CT.                                   *
*    DATE -             9/1/82                                        *
*    FUNCTION -         SHOW CSA SUBPOOL UTILIZATION BY PROTECT KEY   *
*    ATTRIBUTES -       REUS                                          *
*    REGS AT INPUT-     R1   - INTER MODULE LINKAGE                   *
*                       R14  - RETURN ADDRESS                         *
*                       R15  - EPA                                    *
*    REG USAGE     -    R0-R7 - WORK REGS                             *
*                       R8   - GDA POINTER                            *
*                       R9   - INTERNAL BAL REG                      *
*                       R10  - LINKAGE AREA POINTER                  *
*                       R11  - BASE REG                               *
*                       R13  - SAVEAREA POINTER                       *
*    REGS AT EXIT -     R14  - RETURN ADDRESS                         *
*                       R15  - RETURN CODE                            *
*    LABELS -           SOME OF THE FIELD USAGE IN THIS MODULE CAN    *
*                       BE DETERMINED BY THE FIRST CHARACTED OF THE   *
*                       FIELD. THE KEYS ARE:                          *
*                            @ - FIELD IS IN INTER MODULE LINKAGE     *
*                                AREA                                 *
*                            # - FIELD IS PART OF THE OUTPUT SCREEN   *
*                            $ - DSECT                                *
*    MACROS -           $DQE       => RYO DQESECT                     *
*                       $GDA       => RYO GDA                         *
*                       $LNKSECT   => INTER MODULE LINKAGE DSCET      *
*                       $SPQE      => RYO SPQESECT                    *
*                       HMAP       => SCREEN BUILDER                  *
*                       PKEY       => AUTHORIZATION MACRO             *
*    MODS -                                                           *
*          VERSION 1.0  - BASE                                        *
*          VERSION 1.1  - 1. REMOVED AUTOMATIC UPSHIFT OF KEYBOARDS   *
*                            FOR TERMINALS WITH NUM OPTION            *
***********************************************************************
***********************************************************************
*        FIND ALL NECESSARY ADDRESSES AND POINTERS                    *
***********************************************************************
P000100  DS    0H
         SPACE
         LR    R7,R1
         USING $LNKSECT,R7
         MVI   @VSMFLAG,X'04'
         SR    R0,R0               CLEAR R0
         SR    R2,R2               CLEAR R2
         SR    R3,R3               CLEAR R3
         SR    R4,R4               CLEAR R4
         SR    R5,R5               CLEAR R5
         SPACE
         LA    R2,CLRAREA          CLEAR
         LA    R3,CLEARLEN         WORK FIELDS
         LR    R4,R2               FIELDS
         LA    R5,0                WITH
         MVCL  R2,R4               ZEROS
         LA    R2,#SCREEN
         LA    R3,#SCRNLEN
         LA    R4,XSCREEN
         LR    R5,R3
         MVCL  R2,R4               ZEROS
         SPACE
         L     R8,@GDA             GDA POINTER
         USING $GDA,R8             GDA DSECT ADDRESSABILITY
         SPACE
***********************************************************************
*             MAINLINE PROCESSING                                     *
***********************************************************************
P000200  DS    0H
         SETAUTH  ON
         MODESET KEY=ZERO,MODE=SUP KEY ZERO SUPERVISOR STATE CBT-AXC
         L     R3,CSASPQEP         CSA SPQE POINTER
         BAL   R9,SPQELOOP         PERFORM SUBPOOL ANALYSIS
 MODESET KEY=NZERO,MODE=PROB ORIG PROTECT KEY, PROBLEM STATE CBT-AXC
         SETAUTH OFF
         SPACE
P000300  DS    0H
         MVC   TOTCSA,ZERO         MOVE ZERO TO CSA TOTAL
         MVC   TOT227,ZERO         MOVE ZERO TO SP227 TOTAL
         MVC   TOT228,ZERO         MOVE ZERO TO SP228 TOTAL
         MVC   TOT231,ZERO         MOVE ZERO TO SP231 TOTAL
         MVC   TOT239,ZERO         MOVE ZERO TO SP239 TOTAL
         MVC   TOT241,ZERO         MOVE ZERO TO SP241 TOTAL
         SPACE
         LA    R6,XPWORK           POINT TO THE XPOZ WORKAREA
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         SPACE
         MVC   #00CSA,#TOTCSA
         MVC   #00SP227,#TOT227
         MVC   #00SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #00SP231,#TOT231
         MVC   #00SP239,#TOT239
         MVC   #00SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORKAREA
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #01CSA,#TOTCSA
         MVC   #01SP227,#TOT227
         MVC   #01SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #01SP231,#TOT231
         MVC   #01SP239,#TOT239
         MVC   #01SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORKAREA
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #02CSA,#TOTCSA
         MVC   #02SP227,#TOT227
         MVC   #02SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #02SP231,#TOT231
         MVC   #02SP239,#TOT239
         MVC   #02SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #03CSA,#TOTCSA
         MVC   #03SP227,#TOT227
         MVC   #03SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #03SP231,#TOT231
         MVC   #03SP239,#TOT239
         MVC   #03SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #04CSA,#TOTCSA
         MVC   #04SP227,#TOT227
         MVC   #04SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #04SP231,#TOT231
         MVC   #04SP239,#TOT239
         MVC   #04SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #05CSA,#TOTCSA
         MVC   #05SP227,#TOT227
         MVC   #05SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #05SP231,#TOT231
         MVC   #05SP239,#TOT239
         MVC   #05SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #06CSA,#TOTCSA
         MVC   #06SP227,#TOT227
         MVC   #06SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #06SP231,#TOT231
         MVC   #06SP239,#TOT239
         MVC   #06SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #07CSA,#TOTCSA
         MVC   #07SP227,#TOT227
         MVC   #07SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #07SP231,#TOT231
         MVC   #07SP239,#TOT239
         MVC   #07SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT DATA FOR OUTPUT
         MVC   #08CSA,#TOTCSA
         MVC   #08SP227,#TOT227
         MVC   #08SP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #08SP231,#TOT231
         MVC   #08SP239,#TOT239
         MVC   #08SP241,#TOT241
         SPACE
         LA    R6,20(R6)           OFFSET INTO XPWORK
         BAL   R9,FORMAT           GO FORMAT V=R DATA FOR OUTPUT
         MVC   #VRCSA,#TOTCSA
         MVC   #VRSP227,#TOT227
         MVC   #VRSP228,#TOT228    MOVE OUTPUT TO CORRECT LINE
         MVC   #VRSP231,#TOT231
         MVC   #VRSP239,#TOT239
         MVC   #VRSP241,#TOT241
         EJECT
***********************************************************************
*        COMPUTE TOTAL CSA USAGE FOR ALL PROTECT KEYS                 *
***********************************************************************
P000400  DS    0H
         L     R3,TOT227           LOAD TOTAL SP227 SIZE INTO R3
         LR    R0,R3               ADD TO CSA TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT227,EDIT1       MOVE IN PATTERN
         ED    #TOT227,DBLEWORD+5  EDIT
         SPACE
         L     R3,TOT228           LOAD TOTAL SP228 SIZE INTO R3
         AR    R0,R3               ADD TO CSA TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT228,EDIT1       MOVE IN PATTERN
         ED    #TOT228,DBLEWORD+5  EDIT
         SPACE
         L     R3,TOT231           LOAD TOTAL SP231 SIZE INTO R3
         AR    R0,R3               ADD TO CSA TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT231,EDIT1       MOVE IN PATTERN
         ED    #TOT231,DBLEWORD+5  EDIT
         SPACE
         L     R3,TOT239           LOAD TOTAL SP239 SIZE INTO R3
         AR    R0,R3               ADD TO CSA TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT239,EDIT1       MOVE IN PATTERN
         ED    #TOT239,DBLEWORD+5  EDIT
         SPACE
         L     R3,TOT241           LOAD TOTAL SP241 SIZE INTO R3
         AR    R0,R3               ADD TO CSA TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT241,EDIT1       MOVE IN PATTERN
         ED    #TOT241,DBLEWORD+5  EDIT
         SPACE
         LR    R3,R0               LOAD TOTAL CSA SIZE INTO R3
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOTCSA,EDIT1       MOVE IN PATTERN
         ED    #TOTCSA,DBLEWORD+5  EDIT
         EJECT
***********************************************************************
*        OUTPUT THE SCREEN                                            *
***********************************************************************
P000500  DS    0H
         LR    R8,R7
         DROP  R7
         MVC   QDHLINE(80),#SCREEN
         MVC   QDMSG(80),#SCRENH
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN0
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN1
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN2
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN3
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN4
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN5
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN6
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN7
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCREN8
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRENV
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRENS
         BAL   R7,DISPLAY
         MVC   QDMSG(80),#SCRENT
         BAL   R7,DISPLAY
         SPACE 3
P999999  DS   0H
         LR  R1,R8
         QSTOP
***********************************************************************
*   LOCAL SUBROUTINE TO PUT LINE LINE VIA Q DISPLAY                 NTL
***********************************************************************
DISPBLNK MVC   QDMSG,QBLANK   CLEAR LINE MESSAGE                    NTL
*                                                                   NTL
DISPLAY  EQU   *                                                    NTL
         MVC   QDMLNG,=H'80'  SET LENGTH                            NTL
         LA    R0,QDMSG       GET ADDRESS OF MESSAGE                NTL
         ST    R0,QDMSGA      AND SAVE ADDRESS                      NTL
         L     R15,=V(DISPLAY) GET ADDRESS OF MODULE FOR DISPLAY    NTL
         BALR  R14,R15        CALL THE MOTHER                       NTL
         MVI   LINE,C' '      BLANK LINE
         MVC   LINE+1(79),LINE
         BR    R7             RETURN TO MAINLINE...                 NTL
LINE     EQU   QDMSG
         EJECT
**********************************************************************
*                                                                    *
*       => SPQELOOP <=                                               *
*                                                                    *
*       COMPUTE SUB-POOL SIZE BY FOLLOWING THE DQE CHAINS            *
*                                                                    *
*                                                                    *
*       LOOP STRUCTURE FOR THE FOLLOWING CODE:                       *
*                                                                    *
*        => SPQELOOP                                                 *
*                                                                   *
*              => DQELOOP                                           *
*                                                                  *
*                                                                  *
*              => DQEEND                                            *
*                                                                   *
*        => SPQEEND                                                  *
*                                                                    *
*                                                                    *
*       REGISTER USAGE FOR THIS SUBROUTINE:                          *
*                                                                    *
*       R0 =>   TEMPORARY WORK REGISTER                              *
*       R1 =>   SUB-POOL SIZE ACCUMULATOR;CLEARED BEFORE ENTRY       *
*       R2 =>   SUB-POOL FREE SPACE ACCUMULATOR;CLEARED BEFORE ENTRY *
*       R3 =>   SPQE POINTER                                         *
*       R4 =>   FQE POINTER                                          *
*       R5 =>   FQE  POINTER                                         *
*       R6 =>   SUBPOOL INFO AREA POINTER                            *
*       R7 =>   WORK REGISTER
*       R9 =>   RETURN ADDRESS                                       *
*                                                                    *
**********************************************************************
SPQELOOP DS    0H
         STM   R0,R15,SAVEAREA
         LA    R3,0(R3)            CLEAR HIGH ORDER BYTE
         LTR   R3,R3               ANY (MORE) SPQE'S ?
         BZ    ENDSPQE             BIF NO
         USING $SPQE,R3            SPQE DSECT ADDRESSABILITY
         SR    R5,R5               CLEAR R5
         SR    R6,R6               CLEAR R6
         SR    R7,R7               CLEAR R7
         IC    R5,SPQEKEY          LOAD PROTECT KEY INTO R5
         TM    SPQEKEY,X'80'       KEY 0 - 7 ?
         BZ    SPQE01              BIF YES
         TM    SPQEKEY,X'70'       KEY 8 ?
         BZ    SPQE01              BIF YES
         MVC   HOLDKEY,SPQEKEY     MOVE KEY TO WORK FIELD
         OI    HOLDKEY,X'90'       TREAT ALL V=R KEYS AS KEY 9 SO
*                                  THAT 1 WORK AREA IS USED FOR ALL
         IC    R5,HOLDKEY          LOAD PROTECT KEY INTO R5
         SPACE
SPQE01   LA    R7,20(R7)           LOAD R6 WITH OFFSET
         SRA   R5,4                SHIFT PROTECT KEY RIGHT 1 NIBBLE
         MR    R6,R5               COMPUTE OFFSET INTO XP WORK AREA
         LR    R6,R7               STORE RESULT IN R6
         LA    R7,XPWORK           LOAD ADDRESS OF XP WORK
         LA    R7,0(R7)            CLEAR HI-ORDER
         AR    R6,R7               POINT TO WHERE WE WANT TO BE
         CLC   SPQEID,SP239        SUBPOOL 239 ?
         BE    SPQE239             BRANCH IF YES
         BH    SPQE241             BRANCH IF HIGH
         CLC   SPQEID,SP228        SUBPOOL 228 ?
         BE    SPQE228             BRANCH IF YES
         BH    SPQE231             BRANCH IF HIGH
         SPACE
SPQE227  DS    0H
         LA    R6,0(R6)            CLEAR HIGH ORDER BYTE FOR SP 227
         B     SPQEREST            KEEP GOING
         SPACE
SPQE228  DS    0H
         LA    R6,4(R6)            OFFSET FOR SUB-POOL 228
         B     SPQEREST            KEEP GOING
         SPACE
SPQE231  DS    0H
         LA    R6,8(R6)            OFFSET FOR SUB-POOL 231
         B     SPQEREST            KEEP GOING
         SPACE
SPQE239  DS    0H
         LA    R6,12(R6)           OFFSET FOR SUBPOOL 239
         B     SPQEREST            KEEP GOING
         SPACE
SPQE241  DS    0H
         LA    R6,16(R6)           OFFSET FOR SUBPOOL 241
         B     SPQEREST            CONTINUE
         SPACE
SPQEREST DS    0H
         L     R4,SPDQEPTR         LOAD DQE ADDR INTO R4
         L     R1,0(R6)            LOAD ACCUMULATION INTO R1
         SPACE
DQELOOP  DS    0H
         LTR   R4,R4               ANY (MORE) DQE'S ?
         BZ    ENDDQE              BRANCH IF NO
         USING $DQE,R4             CSA DQE ADDRESSABILITY
         A     R1,DQELNTH          ACCUMULATE SUB-POOL LENGTH
         L     R0,DQEPTR           LOAD POINTER TO NEXT DQE
         DROP  R4                  DROP DQE DSECT ADDRESSABILITY
         LR    R4,R0               LOAD NEXT DQE ADDR INTO R4
         B     DQELOOP             GO DO DQE LOOP AGAIN
         SPACE
ENDDQE   DS    0H
         ST    R1,0(R6)            STORE SUB-POOL SIZE
         SR    R1,R1               CLEAR R1
         TM    SPQEFLGS,LASTSPQE   LAST SPQE ON THE CHAIN ?
         BO    ENDSPQE             BRANCH IF YES
         L     R0,SPQEAD           LOAD POINTER TO NEXT SPQE
         DROP  R3                  DROP SPQE DSECT ADDRESSABILITY
         LR    R3,R0               LOAD NEXT SPQE ADDR INTO R3
         B     SPQELOOP            GO DO SPQE LOOP AGAIN
         SPACE
ENDSPQE  DS    0H
         LM    R0,R15,SAVEAREA
         BR    R9                  RETURN
         EJECT
***********************************************************************
*        FORMAT THE DATA FOR OUTPUT                                   *
***********************************************************************
FORMAT   DS    0H
         ST    R9,SAVEREG9         SAVE RETURN ADDRESS
         USING $WRKSECT,R6         DSECT ADDRESSABILITY
         SPACE
         SR    R1,R1               CLEAR R1
         L     R0,TOT227           LOAD TOTAL SP227 SIZE INTO R0
         L     R3,WRK227           LOAD PROTECT KEY SP227 SIZE INTO R3
         AR    R0,R3               ADD TO SP 227 TOTAL
         AR    R1,R3               ADD TO PROTECT KEY TOTAL
         ST    R0,TOT227           STORE SP 227 TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT227,EDIT1       MOVE IN PATTERN
         ED    #TOT227,DBLEWORD+5  EDIT
         SPACE
         L     R0,TOT228           LOAD TOTAL SP228 SIZE INTO R0
         L     R3,WRK228           LOAD PROTECT KEY SP228 SIZE INTO R3
         AR    R0,R3               ADD TO SP228 TOTAL
         AR    R1,R3               ADD TO PROTECT KEY TOTAL
         ST    R0,TOT228           STORE SP228 TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT228,EDIT1       MOVE IN PATTERN
         ED    #TOT228,DBLEWORD+5  EDIT
         SPACE
         L     R0,TOT231           LOAD TOTAL SP231 SIZE INTO R0
         L     R3,WRK231           LOAD PROTECT KEY SP231 SIZE INTO R3
         AR    R0,R3               ADD TO SP231 TOTAL
         AR    R1,R3               ADD TO PROTECT KEY TOTAL
         ST    R0,TOT231           STORE SP231 TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT231,EDIT1       MOVE IN PATTERN
         ED    #TOT231,DBLEWORD+5  EDIT
         SPACE
         L     R0,TOT239           LOAD TOTAL SP239 SIZE INTO R0
         L     R3,WRK239           LOAD PROTECT KEY SP239 SIZE INTO R3
         AR    R0,R3               ADD TO SP239 TOTAL
         AR    R1,R3               ADD TO PROTECT KEY TOTAL
         ST    R0,TOT239           STORE SP239 TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT239,EDIT1       MOVE IN PATTERN
         ED    #TOT239,DBLEWORD+5  EDIT
         SPACE
         L     R3,WRK241           LOAD SP241 SIZE INTO R3
         L     R0,TOT241           LOAD TOTAL SP239 SIZE INTO R0
         AR    R0,R3               ADD TO SP239 TOTAL
         AR    R1,R3               ADD TO PROTECT KEY TOTAL
         ST    R0,TOT241           STORE TOTAL
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOT241,EDIT1       MOVE IN PATTERN
         ED    #TOT241,DBLEWORD+5  EDIT
         SPACE
         LR    R3,R1               LOAD CSA SIZE INTO R3
         BAL   R9,FORMAT2          GO COMPUTE K
         MVC   #TOTCSA,EDIT1       MOVE IN PATTERN
         ED    #TOTCSA,DBLEWORD+5  EDIT
         SPACE
         DROP  R6                  DROP DSECT ADDRESSABILITY
         L     R9,SAVEREG9         LOAD MAINLINE RETURN ADDRESS
         BR    R9                  RETURN
         SPACE
FORMAT2  DS    0H
         SR    R2,R2               CLEAR R2
         SR    R4,R4               CLEAR R4
         SRA   R3,10               DIVIDE SIZE BY 1024
         CVD   R3,DBLEWORD         CONVERT TO DECIMAL
         BR    R9
         EJECT
TEN      DC   X'0000000A'         TEN IN HEX
ONEMEG   DC   X'00100000'         ONE MEGABYTE
ZERO     DC   F'0'
EDIT1    DC   X'402020202120'     EDIT PATTERN FOR SIZE IN K
SP228    DC   X'E4'               SUBPOOL 228
SP239    DC   X'EF'               SUBPOOL 239
SP241    DC   X'F1'               SUBPOOL 241
         DS   0F
XSCREEN  DS   0CL80
         DC   CL80' '
         ORG  XSCREEN+25
         DC   C'CSA UTILIZATION BY PROTECT KEY'
         ORG
*        --------------------------------------------------
XSCRENH  DS   0CL80
         DC   CL80' '
         ORG XSCRENH+4
         DC   C'KEY'
         ORG XSCRENH+15
         DC   C'NAME'
         ORG XSCRENH+26
         DC   C'CSA'
         ORG XSCRENH+34
         DC   C'SP 227'
         ORG XSCRENH+43
         DC   C'SP 228'
         ORG XSCRENH+52
         DC   C'SP 231'
         ORG XSCRENH+61
         DC   C'SP 239'
         ORG XSCRENH+70
         DC   C'SP 241'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN0  DS   0CL80
         DC   CL80' '
         ORG XSCREN0+4
X00KEY   DC   CL4' 0  '
         ORG XSCREN0+12
X00NAME  DC   C'SUPERVISOR'
         ORG XSCREN0+23
X00CSA   DS   CL6
         ORG XSCREN0+30
         DC   C'K'
         ORG XSCREN0+32
X00SP227 DS   CL6
         ORG XSCREN0+39
         DC   C'K'
         ORG XSCREN0+41
X00SP228 DS   CL6
         ORG XSCREN0+48
         DC   C'K'
         ORG XSCREN0+50
X00SP231 DS   CL6
         ORG XSCREN0+57
         DC   C'K'
         ORG XSCREN0+59
X00SP239 DS   CL6
         ORG XSCREN0+66
         DC   C'K'
         ORG XSCREN0+68
X00SP241 DS   CL6
         ORG XSCREN0+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN1  DS   0CL80
         DC   CL80' '
         ORG XSCREN1+4
X01KEY   DC   CL4' 1  '
         ORG XSCREN1+12
X01NAME  DC   C'SCHDLR/JES'
         ORG XSCREN1+23
X01CSA   DS   CL6
         ORG XSCREN1+30
         DC   C'K'
         ORG XSCREN1+32
X01SP227 DS   CL6
         ORG XSCREN1+39
         DC   C'K'
         ORG XSCREN1+41
X01SP228 DS   CL6
         ORG XSCREN1+48
         DC   C'K'
         ORG XSCREN1+50
X01SP231 DS   CL6
         ORG XSCREN1+57
         DC   C'K'
         ORG XSCREN1+59
X01SP239 DS   CL6
         ORG XSCREN1+66
         DC   C'K'
         ORG XSCREN1+68
X01SP241 DS   CL6
         ORG XSCREN1+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN2  DS   0CL80
         DC   CL80' '
         ORG XSCREN2+4
X02KEY   DC   CL4' 2  '
         ORG XSCREN2+12
X02NAME  DC   C'          '
         ORG XSCREN2+23
X02CSA   DS   CL6
         ORG XSCREN2+30
         DC   C'K'
         ORG XSCREN2+32
X02SP227 DS   CL6
         ORG XSCREN2+39
         DC   C'K'
         ORG XSCREN2+41
X02SP228 DS   CL6
         ORG XSCREN2+48
         DC   C'K'
         ORG XSCREN2+50
X02SP231 DS   CL6
         ORG XSCREN2+57
         DC   C'K'
         ORG XSCREN2+59
X02SP239 DS   CL6
         ORG XSCREN2+66
         DC   C'K'
         ORG XSCREN2+68
X02SP241 DS   CL6
         ORG XSCREN2+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN3  DS   0CL80
         DC   CL80' '
         ORG XSCREN3+4
X03KEY   DC   CL4' 3  '
         ORG XSCREN3+12
X03NAME  DC   C'          '
         ORG XSCREN3+23
X03CSA   DS   CL6
         ORG XSCREN3+30
         DC   C'K'
         ORG XSCREN3+32
X03SP227 DS   CL6
         ORG XSCREN3+39
         DC   C'K'
         ORG XSCREN3+41
X03SP228 DS   CL6
         ORG XSCREN3+48
         DC   C'K'
         ORG XSCREN3+50
X03SP231 DS   CL6
         ORG XSCREN3+57
         DC   C'K'
         ORG XSCREN3+59
X03SP239 DS   CL6
         ORG XSCREN3+66
         DC   C'K'
         ORG XSCREN3+68
X03SP241 DS   CL6
         ORG XSCREN3+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN4  DS   0CL80
         DC   CL80' '
         ORG XSCREN4+4
X04KEY   DC   CL4' 4  '
         ORG XSCREN4+12
X04NAME  DC   C'          '
         ORG XSCREN4+23
X04CSA   DS   CL6
         ORG XSCREN4+30
         DC   C'K'
         ORG XSCREN4+32
X04SP227 DS   CL6
         ORG XSCREN4+39
         DC   C'K'
         ORG XSCREN4+41
X04SP228 DS   CL6
         ORG XSCREN4+48
         DC   C'K'
         ORG XSCREN4+50
X04SP231 DS   CL6
         ORG XSCREN4+57
         DC   C'K'
         ORG XSCREN4+59
X04SP239 DS   CL6
         ORG XSCREN4+66
         DC   C'K'
         ORG XSCREN4+68
X04SP241 DS CL6
         ORG XSCREN4+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN5  DS   0CL80
         DC   CL80' '
         ORG XSCREN5+4
X05KEY   DC   CL4' 5  '
         ORG XSCREN5+12
X05NAME  DC   C'DATA MNGT '
         ORG XSCREN5+23
X05CSA   DS   CL6
         ORG XSCREN5+30
         DC   C'K'
         ORG XSCREN5+32
X05SP227 DS   CL6
         ORG XSCREN5+39
         DC   C'K'
         ORG XSCREN5+41
X05SP228 DS   CL6
         ORG XSCREN5+48
         DC   C'K'
         ORG XSCREN5+50
X05SP231 DS   CL6
         ORG XSCREN5+57
         DC   C'K'
         ORG XSCREN5+59
X05SP239 DS   CL6
         ORG XSCREN5+66
         DC   C'K'
         ORG XSCREN5+68
X05SP241 DS   CL6
         ORG XSCREN5+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN6  DS   0CL80
         DC   CL80' '
         ORG XSCREN6+4
X06KEY   DC   CL4' 6  '
         ORG XSCREN6+12
X06NAME  DC   C'ACF/VTAM  '                      CBT-AXC
*06NAME  DC   C'TCAM/VTAM '                      CBT-AXC
         ORG XSCREN6+23
X06CSA   DS   CL6
         ORG XSCREN6+30
         DC   C'K'
         ORG XSCREN6+32
X06SP227 DS   CL6
         ORG XSCREN6+39
         DC   C'K'
         ORG XSCREN6+41
X06SP228 DS   CL6
         ORG XSCREN6+48
         DC   C'K'
         ORG XSCREN6+50
X06SP231 DS   CL6
         ORG XSCREN6+57
         DC   C'K'
         ORG XSCREN6+59
X06SP239 DS   CL6
         ORG XSCREN6+66
         DC   C'K'
         ORG XSCREN6+68
X06SP241 DS   CL6
         ORG XSCREN6+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN7  DS   0CL80
         DC   CL80' '
         ORG XSCREN7+4
X07KEY   DC   CL4' 7  '
         ORG XSCREN7+12
X07NAME  DC   C'IMS       '                    CBT-AXC
         ORG XSCREN7+23
X07CSA   DS   CL6
         ORG XSCREN7+30
         DC   C'K'
         ORG XSCREN7+32
X07SP227 DS   CL6
         ORG XSCREN7+39
         DC   C'K'
         ORG XSCREN7+41
X07SP228 DS   CL6
         ORG XSCREN7+48
         DC   C'K'
         ORG XSCREN7+50
X07SP231 DS   CL6
         ORG XSCREN7+57
         DC   C'K'
         ORG XSCREN7+59
X07SP239 DS   CL6
         ORG XSCREN7+66
         DC   C'K'
         ORG XSCREN7+68
X07SP241 DS   CL6
         ORG XSCREN7+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCREN8  DS   0CL80
         DC   CL80' '
         ORG XSCREN8+4
X08KEY   DC   CL4' 8  '
         ORG XSCREN8+12
X08NAME  DC   C'V=V JOBS  '
         ORG XSCREN8+23
X08CSA   DS   CL6
         ORG XSCREN8+30
         DC   C'K'
         ORG XSCREN8+32
X08SP227 DC   CL6' '
         ORG XSCREN8+39
         DC   C'K'
         ORG XSCREN8+41
X08SP228 DS   CL6
         ORG XSCREN8+48
         DC   C'K'
         ORG XSCREN8+50
X08SP231 DS   CL6
         ORG XSCREN8+57
         DC   C'K'
         ORG XSCREN8+59
X08SP239 DS   CL6
         ORG XSCREN8+66
         DC   C'K'
         ORG XSCREN8+68
X08SP241 DS   CL6
         ORG XSCREN8+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCRENV  DS   0CL80
         DC   CL80' '
         ORG XSCRENV+4
XVRKEY   DC   CL4'9-15'
         ORG XSCRENV+12
XVRNAME  DC   C'V=R JOBS  '
         ORG XSCRENV+23
XVRCSA   DS   CL6
         ORG XSCRENV+30
         DC   C'K'
         ORG XSCRENV+32
XVRSP227 DS   CL6
         ORG XSCRENV+39
         DC   C'K'
         ORG XSCRENV+41
XVRSP228 DS   CL6
         ORG XSCRENV+48
         DC   C'K'
         ORG XSCRENV+50
XVRSP231 DS   CL6
         ORG XSCRENV+57
         DC   C'K'
         ORG XSCRENV+59
XVRSP239 DS   CL6
         ORG XSCRENV+66
         DC   C'K'
         ORG XSCRENV+68
XVRSP241 DS   CL6
         ORG XSCRENV+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
XSCRENS  DS   0CL80
         DC   CL80' '
         ORG  XSCRENS+4
         DC   72C'-'
         SPACE
         ORG
*        --------------------------------------------------
XSCRENT  DS   0CL80
         DC   CL80' '
         ORG  XSCRENT+4
XTOTKEY  DC   CL4'0-15'
         ORG XSCRENT+12
XTOTNAME DC   C'ALL KEYS  '
         ORG XSCRENT+23
XTOTCSA  DS   CL6
         ORG XSCRENT+30
         DC   C'K'
         ORG XSCRENT+32
XTOT227  DS   CL6
         ORG XSCRENT+39
         DC   C'K'
         ORG XSCRENT+41
XTOT228  DS   CL6
         ORG XSCRENT+48
         DC   C'K'
         ORG XSCRENT+50
XTOT231  DS   CL6
         ORG XSCRENT+57
         DC   C'K'
         ORG XSCRENT+59
XTOT239  DS   CL6
         ORG XSCRENT+66
         DC   C'K'
         ORG XSCRENT+68
XTOT241  DS   CL6
         ORG XSCRENT+75
         DC   C'K'
         SPACE
         ORG
#SCRNLEN EQU  *-XSCREEN
         SPACE
         LTORG
$WRKSECT DSECT
WRK227   DS   F
WRK228   DS   F
WRK231   DS   F
WRK239   DS   F
WRK241   DS   F
         $DQE                     DESCRIPTOR QUEUE ELEMENT DSECT
         $GDA                     GENERAL DATA AREA DSECT
         $SPQE                    SUBPOOL QUEUE ELEMENT DSECT
         $LNKSECT
         DS    0F
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION
         QCOMMON
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION
WORK     DSECT
         DS    CL72
COUNT    DS    D
WORKX    DS    D
WORKX1   DS    D
DWORD    DS    D
CHAR     DS    D
EXTRAREA DS    F
SAVEAREA DS   18F                 MY SAVE AREA
CLRAREA  EQU  *
SAVEREG9 DS   F
DBLEWORD DS   D                   DOUBLE WORD WORK AREA
TOTCSA   DS   F
TOT227   DS   F
TOT228   DS   F
TOT231   DS   F
TOT239   DS   F
TOT241   DS   F
XPWORK   DS   CL448
CLEARLEN EQU  *-CLRAREA
HOLDKEY  DC   X'00'               HOLD PROTECT KEY
         DS   0F
#SCREEN  DS   CL80
         ORG  #SCREEN+25
         DC   C'CSA UTILIZATION BY PROTECT KEY'
         ORG
*        --------------------------------------------------
#SCRENH  DS   CL80
         ORG #SCRENH+4
         DC   C'KEY'
         ORG #SCRENH+15
         DC   C'NAME'
         ORG #SCRENH+26
         DC   C'CSA'
         ORG #SCRENH+34
         DC   C'SP 227'
         ORG #SCRENH+43
         DC   C'SP 228'
         ORG #SCRENH+52
         DC   C'SP 231'
         ORG #SCRENH+61
         DC   C'SP 239'
         ORG #SCRENH+70
         DC   C'SP 241'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN0  DS   CL80
         ORG #SCREN0+4
#00KEY   DC   CL4' 0  '
         ORG #SCREN0+12
#00NAME  DC   C'SUPERVISOR'
         ORG #SCREN0+23
#00CSA   DS   CL6
         ORG #SCREN0+30
         DC   C'K'
         ORG #SCREN0+32
#00SP227 DS   CL6
         ORG #SCREN0+39
         DC   C'K'
         ORG #SCREN0+41
#00SP228 DS   CL6
         ORG #SCREN0+48
         DC   C'K'
         ORG #SCREN0+50
#00SP231 DS   CL6
         ORG #SCREN0+57
         DC   C'K'
         ORG #SCREN0+59
#00SP239 DS   CL6
         ORG #SCREN0+66
         DC   C'K'
         ORG #SCREN0+68
#00SP241 DS   CL6
         ORG #SCREN0+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN1  DS   CL80
         ORG #SCREN1+4
#01KEY   DC   CL4' 1  '
         ORG #SCREN1+12
#01NAME  DC   C'SCHDLR/JES'
         ORG #SCREN1+23
#01CSA   DS   CL6
         ORG #SCREN1+30
         DC   C'K'
         ORG #SCREN1+32
#01SP227 DS   CL6
         ORG #SCREN1+39
         DC   C'K'
         ORG #SCREN1+41
#01SP228 DS   CL6
         ORG #SCREN1+48
         DC   C'K'
         ORG #SCREN1+50
#01SP231 DS   CL6
         ORG #SCREN1+57
         DC   C'K'
         ORG #SCREN1+59
#01SP239 DS   CL6
         ORG #SCREN1+66
         DC   C'K'
         ORG #SCREN1+68
#01SP241 DS   CL6
         ORG #SCREN1+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN2  DS   CL80
         ORG #SCREN2+4
#02KEY   DC   CL4' 2  '
         ORG #SCREN2+12
#02NAME  DC   C'          '
         ORG #SCREN2+23
#02CSA   DS   CL6
         ORG #SCREN2+30
         DC   C'K'
         ORG #SCREN2+32
#02SP227 DS   CL6
         ORG #SCREN2+39
         DC   C'K'
         ORG #SCREN2+41
#02SP228 DS   CL6
         ORG #SCREN2+48
         DC   C'K'
         ORG #SCREN2+50
#02SP231 DS   CL6
         ORG #SCREN2+57
         DC   C'K'
         ORG #SCREN2+59
#02SP239 DS   CL6
         ORG #SCREN2+66
         DC   C'K'
         ORG #SCREN2+68
#02SP241 DS   CL6
         ORG #SCREN2+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN3  DS   CL80
         ORG #SCREN3+4
#03KEY   DC   CL4' 3  '
         ORG #SCREN3+12
#03NAME  DC   C'          '
         ORG #SCREN3+23
#03CSA   DS   CL6
         ORG #SCREN3+30
         DC   C'K'
         ORG #SCREN3+32
#03SP227 DS   CL6
         ORG #SCREN3+39
         DC   C'K'
         ORG #SCREN3+41
#03SP228 DS   CL6
         ORG #SCREN3+48
         DC   C'K'
         ORG #SCREN3+50
#03SP231 DS   CL6
         ORG #SCREN3+57
         DC   C'K'
         ORG #SCREN3+59
#03SP239 DS   CL6
         ORG #SCREN3+66
         DC   C'K'
         ORG #SCREN3+68
#03SP241 DS   CL6
         ORG #SCREN3+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN4  DS   CL80
         ORG #SCREN4+4
#04KEY   DC   CL4' 4  '
         ORG #SCREN4+12
#04NAME  DC   C'          '
         ORG #SCREN4+23
#04CSA   DS   CL6
         ORG #SCREN4+30
         DC   C'K'
         ORG #SCREN4+32
#04SP227 DS   CL6
         ORG #SCREN4+39
         DC   C'K'
         ORG #SCREN4+41
#04SP228 DS   CL6
         ORG #SCREN4+48
         DC   C'K'
         ORG #SCREN4+50
#04SP231 DS   CL6
         ORG #SCREN4+57
         DC   C'K'
         ORG #SCREN4+59
#04SP239 DS   CL6
         ORG #SCREN4+66
         DC   C'K'
         ORG #SCREN4+68
#04SP241 DS CL6
         ORG #SCREN4+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN5  DS   CL80
         ORG #SCREN5+4
#05KEY   DC   CL4' 5  '
         ORG #SCREN5+12
#05NAME  DC   C'DATA MNGT '
         ORG #SCREN5+23
#05CSA   DS   CL6
         ORG #SCREN5+30
         DC   C'K'
         ORG #SCREN5+32
#05SP227 DS   CL6
         ORG #SCREN5+39
         DC   C'K'
         ORG #SCREN5+41
#05SP228 DS   CL6
         ORG #SCREN5+48
         DC   C'K'
         ORG #SCREN5+50
#05SP231 DS   CL6
         ORG #SCREN5+57
         DC   C'K'
         ORG #SCREN5+59
#05SP239 DS   CL6
         ORG #SCREN5+66
         DC   C'K'
         ORG #SCREN5+68
#05SP241 DS   CL6
         ORG #SCREN5+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN6  DS   CL80
         ORG #SCREN6+4
#06KEY   DC   CL4' 6  '
         ORG #SCREN6+12
#06NAME  DC   C'ACF/VTAM  '                      CBT-AXC
*06NAME  DC   C'TCAM/VTAM '                      CBT-AXC
         ORG #SCREN6+23
#06CSA   DS   CL6
         ORG #SCREN6+30
         DC   C'K'
         ORG #SCREN6+32
#06SP227 DS   CL6
         ORG #SCREN6+39
         DC   C'K'
         ORG #SCREN6+41
#06SP228 DS   CL6
         ORG #SCREN6+48
         DC   C'K'
         ORG #SCREN6+50
#06SP231 DS   CL6
         ORG #SCREN6+57
         DC   C'K'
         ORG #SCREN6+59
#06SP239 DS   CL6
         ORG #SCREN6+66
         DC   C'K'
         ORG #SCREN6+68
#06SP241 DS   CL6
         ORG #SCREN6+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN7  DS   CL80
         ORG #SCREN7+4
#07KEY   DC   CL4' 7  '
         ORG #SCREN7+12
#07NAME  DC   C'IMS       '                    CBT-AXC
         ORG #SCREN7+23
#07CSA   DS   CL6
         ORG #SCREN7+30
         DC   C'K'
         ORG #SCREN7+32
#07SP227 DS   CL6
         ORG #SCREN7+39
         DC   C'K'
         ORG #SCREN7+41
#07SP228 DS   CL6
         ORG #SCREN7+48
         DC   C'K'
         ORG #SCREN7+50
#07SP231 DS   CL6
         ORG #SCREN7+57
         DC   C'K'
         ORG #SCREN7+59
#07SP239 DS   CL6
         ORG #SCREN7+66
         DC   C'K'
         ORG #SCREN7+68
#07SP241 DS   CL6
         ORG #SCREN7+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCREN8  DS   CL80
         ORG #SCREN8+4
#08KEY   DC   CL4' 8  '
         ORG #SCREN8+12
#08NAME  DC   C'V=V JOBS  '
         ORG #SCREN8+23
#08CSA   DS   CL6
         ORG #SCREN8+30
         DC   C'K'
         ORG #SCREN8+32
#08SP227 DC   CL6' '
         ORG #SCREN8+39
         DC   C'K'
         ORG #SCREN8+41
#08SP228 DS   CL6
         ORG #SCREN8+48
         DC   C'K'
         ORG #SCREN8+50
#08SP231 DS   CL6
         ORG #SCREN8+57
         DC   C'K'
         ORG #SCREN8+59
#08SP239 DS   CL6
         ORG #SCREN8+66
         DC   C'K'
         ORG #SCREN8+68
#08SP241 DS   CL6
         ORG #SCREN8+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCRENV  DS   CL80
         ORG #SCRENV+4
#VRKEY   DC   CL4'9-15'
         ORG #SCRENV+12
#VRNAME  DC   C'V=R JOBS  '
         ORG #SCRENV+23
#VRCSA   DS   CL6
         ORG #SCRENV+30
         DC   C'K'
         ORG #SCRENV+32
#VRSP227 DS   CL6
         ORG #SCRENV+39
         DC   C'K'
         ORG #SCRENV+41
#VRSP228 DS   CL6
         ORG #SCRENV+48
         DC   C'K'
         ORG #SCRENV+50
#VRSP231 DS   CL6
         ORG #SCRENV+57
         DC   C'K'
         ORG #SCRENV+59
#VRSP239 DS   CL6
         ORG #SCRENV+66
         DC   C'K'
         ORG #SCRENV+68
#VRSP241 DS   CL6
         ORG #SCRENV+75
         DC   C'K'
         SPACE
         ORG
*        --------------------------------------------------
#SCRENS  DS   CL80
         ORG  #SCRENS+4
         DC   72C'-'
         SPACE
         ORG
*        --------------------------------------------------
#SCRENT  DS   CL80
         ORG  #SCRENT+4
#TOTKEY  DC   CL4'0-15'
         ORG #SCRENT+12
#TOTNAME DC   C'ALL KEYS  '
         ORG #SCRENT+23
#TOTCSA  DS   CL6
         ORG #SCRENT+30
         DC   C'K'
         ORG #SCRENT+32
#TOT227  DS   CL6
         ORG #SCRENT+39
         DC   C'K'
         ORG #SCRENT+41
#TOT228  DS   CL6
         ORG #SCRENT+48
         DC   C'K'
         ORG #SCRENT+50
#TOT231  DS   CL6
         ORG #SCRENT+57
         DC   C'K'
         ORG #SCRENT+59
#TOT239  DS   CL6
         ORG #SCRENT+66
         DC   C'K'
         ORG #SCRENT+68
#TOT241  DS   CL6
         ORG #SCRENT+75
         DC   C'K'
         SPACE
         ORG
         END
./       ADD   NAME=XDS
XDS      TITLE 'QUEUE COMMAND - PRINT A DATASET FROM SPOOL BY ID' ONL01
XDS      QSTART ,                  START XDS CSECT ASSEMBLY       ONL01
         USING QCKPT,R10      BASE REG FOR CKPT WORK AREA
         L     R10,QVCKPT     LOAD BASE REG
         USING WORK,R13       BASE REG FOR TEMP WORK
***********************************************************************
*                                                                     *
*   CALL FINDJOB TO LOCATE THE JQE, JCT, AND IOT                      *
*                                                                     *
***********************************************************************
         L     R15,=V(FINDJOB) ADDR OF MODULE TO FIND JOB
         BALR  R14,R15        GO TO IT
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE DATASET ID NUMBER                           *
*                                                                     *
***********************************************************************
         LH    R2,QLNG2       LENGTH OF DATASET ID FIELD
         SH    R2,=H'1'       IS THE DATASET ID FIELD ZERO LENGTH?
         BM    TILT           YES. QUIT.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ         MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         EX    R2,PACK        PACK THE FIELD
         CVB   R2,CONVERT     CONVERT TO BINARY
         STH   R2,QPDSID      STORE DATASET ID
***********************************************************************
*                                                                     *
*   CHECK AND CONVERT THE PRINT OFFSET                                *
*                                                                     *
***********************************************************************
         MVC   QPOFFSET,=H'0' DEFAULT TO ZERO
         LH    R2,QLNG3       LENGTH OF OFFSET FIELD
         SH    R2,=H'1'       IS THE OFFSET FIELD ZERO LENGTH?
         BM    CALLLIST       YES. USE ZERO OFFSET.
         MVC   QFZONES,QFZONE INITIALIZE NUMERIC TEST
         EX    R2,MVZ2        MOVE THE ZONES FOR VALIDITY CHECK
         CLC   QFZONES,QFZONE IS THE FIELD NUMERIC?
         BNE   TILT           NO. QUIT.
         EX    R2,PACK2       PACK THE FIELD
         CVB   R2,CONVERT     CONVERT TO BINARY
         STH   R2,QPOFFSET    STORE OFFSET
***********************************************************************
*                                                                     *
*   CALL LISTDS TO LIST THE DATASET                                   *
*                                                                     *
***********************************************************************
CALLLIST L     R15,=V(LISTDS) ADDR OF LISTDS MODULE
         BALR  R14,R15        GO TO IT
         QSTOP
TILT     QTILT '*** DATASET ID INVALID ***'
***********************************************************************
*                                                                     *
*   MISCELLANY                                                        *
*                                                                     *
***********************************************************************
MVZ      MVZ   QFZONES(1),QPARM2 CHECK FOR NUMERIC
MVZ2     MVZ   QFZONES(1),QPARM3 CHECK FOR NUMERIC
PACK     PACK  CONVERT,QPARM2(1) CONVERT TO BINARY
PACK2    PACK  CONVERT,QPARM3(1) CONVERT TO BINARY
         LTORG
SYMDEL   DSECT ,                   KILL SYM CARD GENERATION       UF023
WORK     DSECT
         DS    72C
CONVERT  DS    D
         QPRBGEN BEGIN             SET PRINT FOR CNTL BLOCK GEN   ONL01
         QCOMMON
         QPRBGEN DONE              RESTORE NORMAL PRINT STATUS    ONL01
SYMNODEL DSECT ,                   RESTORE SYM CARD GENERATION    UF023
         END

./       ADD   NAME=$ASMHOLD
//DORASM JOB (6000A,4,,99),'ASM HOLDPGM',CLASS=A,MSGCLASS=A,
//       NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//* REFER  SYS1.PROCLIB(ASMFCL)
//*
//ASMPTF PROC MEM=
//ASMPTF EXEC  PGM=IEV90,PARM=OBJECT,REGION=1200K
//SYSLIB DD DSN=C6000A.DOR.PTFSRCT2,DISP=SHR
//*      DD DSN=C6000A.DOR.MACLIB,DISP=SHR
//       DD DSN=SYS1.MACLIB,DISP=SHR
//SYSUT1   DD  UNIT=(SYSDA,SEP=SYSLIB),SPACE=(CYL,(10,5)),DSN=&SYSUT1
//SYSPUNCH DD  DUMMY,DCB=BLKSIZE=80
//SYSPRINT DD SYSOUT=(Y,,DS06),
//   DCB=(BLKSIZE=3509),UNIT=(,SEP=(SYSUT1,SYSPUNCH))
//SYSLIN   DD  DISP=(MOD,PASS),UNIT=SYSDA,SPACE=(CYL,(5,5,0)),
//             DSN=&&LOADSET
//SYSIN DD DSN=C6000A.DOR.PTFSRCT2(&MEM),DISP=SHR
// PEND
//*------------------------------------------------------------
//HOLDPGM  EXEC ASMPTF,MEM=HOLDPGM2
//*------------------------------------------------------------
//LKED EXEC  PGM=IEWL,PARM='MAP,LET,LIST,NCAL',
//        REGION=1000K
//SYSLIN   DD  DSN=&&LOADSET,DISP=(OLD,DELETE)
//         DD  DDNAME=SYSIN
//SYSSMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR
//*SYSOBJ   DD DSN=C6000A.DOR.PTFLIB2,DISP=SHR
//SYSLMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR
//SYSPRINT DD SYSOUT=(Y,,DS06)
//*  THIS LINK DID MAKE FINDFIX6  DOR
//*  INCLUDE SYSSMOD(ASMTRACE) IF YOU WANT TO ASMTRACE
//SYSIN DD *
     ENTRY HOLDPGM
     INCLUDE SYSSMOD(ASMTRACE)
     NAME HOLDPGM2(R)
/*
./       ADD   NAME=$ASMPTF
//DORASM JOB (6000A,004,,99),'ASM FINDFIX V2.2',CLASS=A,MSGCLASS=Z,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//* REFER  SYS1.PROCLIB(ASMFCL)
//*
//ASMPTF PROC MEM=
//ASMPTF EXEC  PGM=IEV90,PARM=OBJECT,REGION=1200K
//SYSLIB DD DSN=C6000A.DOR.PTFSRCT2,DISP=SHR
//       DD DSN=C6000A.DOR.MACLIB,DISP=SHR
//       DD DSN=SYS1.MACLIB,DISP=SHR
//SYSUT1   DD  UNIT=(SYSDA,SEP=SYSLIB),SPACE=(CYL,(10,5)),DSN=&SYSUT1
//SYSPUNCH DD  DUMMY,DCB=BLKSIZE=80
//SYSPRINT DD SYSOUT=(Y,,DS06),
//   DCB=(BLKSIZE=3509),UNIT=(,SEP=(SYSUT1,SYSPUNCH))
//SYSLIN   DD  DISP=(MOD,PASS),UNIT=SYSDA,SPACE=(CYL,(5,5,0)),
//             DSN=&&LOADSET
//SYSIN DD DSN=C6000A.DOR.PTFSRCT2(&MEM),DISP=SHR
// PEND
//*------------------------------------------------------------
//PTFROUT  EXEC ASMPTF,MEM=PTFROUT
//PTFVSAM  EXEC ASMPTF,MEM=PTFVSAM
//PTFINFO  EXEC ASMPTF,MEM=PTFINFO
//PTFENV   EXEC ASMPTF,MEM=PTFENV
//PTFFIX   EXEC ASMPTF,MEM=PTFFIX
//PTFPARM  EXEC ASMPTF,MEM=PTFPARM
//*------------------------------------------------------------
//LKED EXEC  PGM=IEWL,PARM='MAP,LET,LIST,NCAL',
//        REGION=1000K
//SYSLIN   DD  DSN=&&LOADSET,DISP=(OLD,DELETE)
//         DD  DDNAME=SYSIN
//SYSSMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR
//*SYSOBJ   DD DSN=C6000A.DOR.PTFLIB2,DISP=SHR
//SYSLMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR
//SYSPRINT DD SYSOUT=(Y,,DS06)
//*  THIS LINK DID MAKE FINDFIX6  DOR
//*  INCLUDE SYSSMOD(ASMTRACE) IF YOU WANT TO ASMTRACE
//SYSIN DD *
     ENTRY PTFROUT
     NAME FINDFIX8(R)
/*
./       ADD   NAME=$ASMPTFU
//DORASM JOB (6000A,004,,999),'ASM PTF UTILITIES',CLASS=A,MSGCLASS=A,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//* REFER  SYS1.PROCLIB(ASMFCL)
//*
//PTFASM   PROC MEM=
//ASM    EXEC  PGM=IEV90,PARM=OBJECT,REGION=1200K
//SYSLIB DD DSN=SYS1.MACLIB,DISP=SHR
//       DD DSN=C6000A.DOR.MACLIB,DISP=SHR
//*      DD DSN=SYS1.AMODGEN,VOL=SER=CDSI05,UNIT=3350,DISP=SHR
//*      DD DSN=SYS1.PVTMAC,VOL=SER=CDSI05,UNIT=3350,DISP=SHR
//SYSUT1   DD  UNIT=(SYSDA,SEP=SYSLIB),SPACE=(CYL,(10,5)),DSN=&SYSUT1
//SYSPUNCH DD  DUMMY,DCB=BLKSIZE=80
//SYSPRINT DD SYSOUT=A,DCB=(BLKSIZE=3509),UNIT=(,SEP=(SYSUT1,SYSPUNCH))
//SYSLIN   DD  DISP=(,PASS),UNIT=SYSDA,SPACE=(CYL,(5,5,0)),
//             DSN=&&LOADSET
//SYSIN DD DSN=C6000A.DOR.PTFLIB(&MEM.),DISP=SHR
// PEND
//PTFLKED  PROC
//LKED EXEC  PGM=IEWL,PARM='MAP,LET,LIST,NCAL',
//        REGION=1000K
//SYSLIN   DD  DSN=&&LOADSET,DISP=(OLD,DELETE)
//         DD  DDNAME=SYSIN
//SYSSMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR,UNIT=3350
//SYSLMOD  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR,UNIT=3350
//SYSPRINT DD SYSOUT=A
// PEND
//*PTFUTIL  EXEC PTFASM,MEM=PTFUTIL
//*PTFMERG  EXEC PTFASM,MEM=PTFMERG
//*PTFMAST  EXEC PTFASM,MEM=PTFMAST
//PTFSORT  EXEC PTFASM,MEM=PTFSORT2
//LKEDSORT EXEC PTFLKED
//SYSIN DD  *
 ENTRY PTFSORT
 NAME PTFSORT2(R)
/*
./       ADD   NAME=CONVERT
         MACRO
&NAME    CONVERT  &REG
***            CONVERT HEX CHARACTERS TO PRINTABLE FORMAT   PMCF.
***            CONVERT (TO,FROM,LENGTH)
*    TO = REG WITH ADDRESS OF OUTPUT LOCATION MUST HAVE TWICE OF INPUT
*   FROM= REG WITH ADDRESS OF INPUT LOCATION
* LENGTH= REG WITH THE LENGTH OF DATA TO CONVERT
&NAME    DS    0H                      ALIGN ON HALF-WORD
         LA    14,*+56                 LOAD RETURN ADDRESS
         MVO   0(2,&REG(1)),0(1,&REG(2)) ADJUST OFFSET
         MVN   1(1,&REG(1)),0(&REG(2)) SET NUMERIC CHAR.
         NI    1(&REG(1)),X'0F'        FLIP UNWANTED BITS OFF
         TR    0(2,&REG(1)),*+20       TRANSLATE THE BYTE
         LA    &REG(1),2(0,&REG(1))    BUMP UP REGISTER
         LA    &REG(2),1(0,&REG(2))    BUMP UP REGISTER
         BCT   &REG(3),*-30            CONVERT AGAIN IF REG. NZERO
         BCR   15,14                   BRANCH TO EXECUTABLE INST.
         DC    C'0123456789ABCDEF'     CHARACTER STRING FOR TR INST.
         MEND
./       ADD   NAME=CSIKEY
*------------------------------------------------------------;
* IRBCATG    DESCRIPTION
   01        ZPOOL1
   02        ZONE ASSIGNMENT (ZONEINDEX)
   03
   04        CATG=CAT
   05        CATG=REL
   10        ZONE
   11        OPTIONS
   12        DDDEF
   13        UTILITY
   14        FMIDSET
   20        ASSEM
   21        LMOD
   22        MAC
   23        MOD
   24        SRC
   25        DLIB
   26        SYSMOD
   30        ASM SRC
   31        LMOD SRC
   32        HOLD DATA ;
*------------------------------------------------------------;
* IRBRELA    DESCRIPTION           IRBRELA       DESCRIPTION
* -------    ------------          ---------     --------------;
* X'0101'      MAIN CSI             X'2001'      ASM SECURITY
* X'0201'      ZONE INDEX CODE      X'2010'      ASM BACKUP
* X'0301'      RDE  CODE            X'2100'      LMOD SECURITY
* X'0401'           CODE            X'2101'      LMOD ATTR
* X'0501'           CODE            X'2110'      LMOD BACKUP
* X'1000'      ZONE SECURITY        X'2113'      LOADLIB
* X'1001'      ZONE INDEX           X'2200'      MAC SECURITY
* X'1020'      ZONE RELATED         X'2201'      MAC  FMID
* X'1021'      ZONE SREL            X'2202'      MAC RMID
* X'1022'      ZONE FMID            X'2210'      MAC BACKUP
* X'1027'      ZONE OPTIONS         X'2211'      MAC DLIB
* X'1172'      AMS IDCAMS UCLIN     X'2213'      MAC LIB
* X'1173'      ASSEMBLER            X'2230'      GENASM
* X'1174'      COMP                 X'2240'      ALIAS
* X'1175'      IEBCOPY              X'2250'      UMID
* X'1177'      LINKAGE EDITOR       X'2300'      MOD SECURITY
* X'1178'      RETRY (IEBCOPY)      X'2301'      MOD FMID
* X'1179'      UPDATE (IEBUPDTE)    X'2302'      MOD RMID
* X'117A'      SZAP (IMASPZAP)      X'2310'      MOD BACKUP
* X'117B'      NUCID                X'2311'      MODDLIB
* X'1180'      UCLIN PAGELEN        X'2313'      MOD ATTR
* X'1181'      UCLIN PREMAX         X'2340'      CSECT
* X'1182'      PURGE/NOPURGE        X'2341'      CSECT LMODE
* X'1183'      REQUEST/NOREQUEST    X'2342'      TALIAS
* X'1188'      RETRY DDNAME         X'2343'      DALIAS
* X'1190'      SAVEMTS              X'2350'      UPDATE ID (UMID)
* X'1191'      SAVESTS              X'2401'      SRC FMID
* X'1192'      DSSPACE              X'2402'      SRC RMID
* X'1193'      DSPREFIX             X'2410'      SRC BACKUP
* X'1201'      DSN=                 X'2411'      SRC DLIB
* X'1202'      VOL=SER=             X'2413'      SRC LIB
* X'1203'      UNIT=                X'2450'      SRC UMID
* X'1209'      CONCAT DD            X'2500'      DLIB SECURITY
* X'1210'      DISP=                X'2501'      DLIB BACKUP
* X'1301'      PGM=                 X'2513'      COPY LIB
* X'1302'      PARM=
* X'1303'      DDN= (PRINT)
* X'1304'      RETURN CODE
* X'1401'      SETFMID ;
* X'2600'      SYSMOD SECURITY      X'26A9'      VERSION
* X'2601'      SYSMOD TYPE          X'26B1'      MOD
* X'2602'      SYSMOD ATTRIBUTE     X'26B2'      ZAP
* X'2611'      DELBY                X'26B3'      XZAP
* X'2612'      LSUBBY               X'26B4'      MAC
* X'2630'      BACKUP               X'26B5'      MACU
* X'2631'      FMID                 X'26B6'      SRC
* X'2632'      RECDATE              X'26B7'      SRCU
* X'2633'      INSDATE              X'26C1'      ASM
* X'2635'      RSTDATE              X'26C2'      APPLY ID
* X'2636'      UCLDATE              X'26C3'      ACCEPT ID
* X'2637'      DSN=                 X'26D1'      RMOD
* X'2638'      # OF REL FILE        X'26D2'      RZAP
* X'2639'      SECID                X'26D3'      RXZAP
* X'263A'      FESN                 X'26D4'      RMAC
* X'26A1'      VSREC                X'26D5'      RMACU
* X'26A2'      VFMID                X'26D6'      RSRC
* X'26A3'      VPRE                 X'26D7'      RSRCU
* X'26A4'      VNPRE                X'26F0'      SUPBY
* X'26A5'      VSUP                 X'26F1'      CIFREQ
* X'26A6'      VREQ                 X'26F4'      HOLDERR
* X'26A7'      VIREQ                X'26F5'      HOLDSYS
* X'26A8'      VDEL                 X'26F6'      HOLDUSR  ;
* X'3001'      SOURCE LISTING       X'3210'      ++HOLD CARD;
* X'3101'      LMOD CARDS           X'3220'      ++HOLD COMMENT;
*                                   X'3230'      ++HOLD FULLGEN;
./       ADD   NAME=CSISASRY
* SAS PROGRAM TO READ AND ANALYZE A PTF OUTPUT FROM SMPE ;
DATA CSI(KEEP=IRBRELAX CCACZIDX IRBCATGX IRBOCCRX);
LENGTH TYPE $ 8 SYSMOD $ 8 SYSENT $ 50  SYMTYPE $ 8 CSINAME $ 12;
LENGTH SRCLST $ 8 DLIB $ 8 ATTRX $ 8 LMOD $ 8 MOD $ 8 MAC $ 8 SRC $ 8;
LENGTH ZONEI $ 8 ZONE $ 8 DDEF $ 8 DSN $ 8 PGM $ 8 FMID $ 8 ASM $ 8;
LENGTH PARM $ 50 CARD $ 80 HOLD $ 8 LMODCD $ 8;
LENGTH COCCR $2;
* ---------- DEFINE INFILE ---------------;
  INFILE SMPCSI VSAM LENGTH=KEYLGTH JFCB=DSNAME;
OPTIONS  MISSING=' ' TIME=MAX LINESIZE=132 PS=56 NUMBER;
TITLE  SMPE  CSI FILE LISTING;
*---------- SET BANNER PAGE ON EACH DDNAME WITH DATE -------;
LENGTH STR $ 40 ;
LENGTH STRX $ 40 ;
LENGTH YEAR $ 4;
RETAIN BANNER ' '  MONTH  DATEX DAYN 0;
RETAIN YEAR;
IF BANNER = ' ' THEN DO;
BANNER='X';
DATEX=DATE();
DAYN=DAY(DATEX); * PUT PAGE BANNER ON SYSOUT FOR EASIER READING;
MONTH=MONTH(DATEX);YEAR=YEAR(DATEX);
 IF DAYN = 1       THEN STR='/1';
ELSE IF  DAYN = 2 THEN  STR='/2';
ELSE IF  DAYN = 3 THEN  STR='/3';
ELSE IF  DAYN = 4 THEN  STR='/4';
ELSE IF  DAYN = 5 THEN  STR='/5';
ELSE IF  DAYN = 6 THEN  STR='/6';
ELSE IF  DAYN = 7 THEN  STR='/7';
ELSE IF  DAYN = 8 THEN  STR='/8';
ELSE IF  DAYN = 9 THEN  STR='/9';
ELSE IF  DAYN = 10 THEN STR='/10';
ELSE IF  DAYN = 11 THEN STR='/11';
ELSE IF  DAYN = 12 THEN STR='/12';
ELSE IF  DAYN = 13 THEN STR='/13';
ELSE IF  DAYN = 14 THEN STR='/14';
ELSE IF  DAYN = 15 THEN STR='/15';
ELSE IF  DAYN = 16 THEN STR='/16';
ELSE IF  DAYN = 17 THEN STR='/17';
ELSE IF  DAYN = 18 THEN STR='/18';
ELSE IF  DAYN = 19 THEN STR='/19';
ELSE IF  DAYN = 20 THEN STR='/20';
ELSE IF  DAYN = 21 THEN STR='/21';
ELSE IF  DAYN = 22 THEN STR='/22';
ELSE IF  DAYN = 23 THEN STR='/23';
ELSE IF  DAYN = 24 THEN STR='/24';
ELSE IF  DAYN = 25 THEN STR='/25';
ELSE IF  DAYN = 26 THEN STR='/26';
ELSE IF  DAYN = 27 THEN STR='/27';
ELSE IF  DAYN = 28 THEN STR='/28';
ELSE IF  DAYN = 29 THEN STR='/29';
ELSE IF  DAYN = 30 THEN STR='/30';
ELSE IF  DAYN = 31 THEN STR='/31';
LL=LENGTH(STR);
IF MONTH = 1        THEN
       STR=SUBSTR(STR,1,LL) ×× '/JANUARY/'   ×× YEAR ×× '/';
  ELSE IF MONTH = 2 THEN
       STR=SUBSTR(STR,1,LL) ×× '/FEBRUARY/'  ×× YEAR ×× '/';
  ELSE IF MONTH = 3 THEN
  STR=SUBSTR(STR,1,LL) ×× '/MARCH/'     ×× YEAR ×× '/';
  ELSE IF MONTH = 4 THEN
  STR=SUBSTR(STR,1,LL) ×× '/APRIL/'     ×× YEAR ×× '/';
  ELSE IF MONTH = 5 THEN
  STR=SUBSTR(STR,1,LL) ×× '/MAY/'       ×× YEAR ×× '/';
  ELSE IF MONTH = 6 THEN
  STR=SUBSTR(STR,1,LL) ×× '/JUNE/'      ×× YEAR ×× '/';
  ELSE IF MONTH = 7 THEN
  STR=SUBSTR(STR,1,LL) ×× '/JULY/'      ×× YEAR ×× '/';
  ELSE IF MONTH = 8 THEN
  STR=SUBSTR(STR,1,LL) ×× '/AUGUST/'    ×× YEAR ×× '/';
  ELSE IF MONTH = 9 THEN
  STR=SUBSTR(STR,1,LL) ×× '/SEPTEMBER/' ×× YEAR ×× '/';
  ELSE IF MONTH = 10 THEN
  STR=SUBSTR(STR,1,LL) ×× '/OCTOBER/'  ×× YEAR ×× '/';
  ELSE IF MONTH = 11 THEN
  STR=SUBSTR(STR,1,LL) ×× '/NOVEMBER/' ×× YEAR ×× '/';
  ELSE IF MONTH = 12 THEN
   STR=SUBSTR(STR,1,LL) ×× '/DECEMBER/' ×× YEAR ×× '/';
LL=LENGTH(STR);
STRX='(ZONERPT)' ×× SUBSTR(STR,1,LL) ×× 'ZONE/' ;
CALL BLOKHEAD(STRX);
STRX='(DDEFRPT)' ×× SUBSTR(STR,1,LL) ×× 'DDEF/' ;
CALL BLOKHEAD(STRX);
STRX='(DSNRPT)' ×× SUBSTR(STR,1,LL) ×× 'DSN/' ;
CALL BLOKHEAD(STRX);
STRX='(PGMRPT)' ×× SUBSTR(STR,1,LL) ×× 'PGM/' ;
CALL BLOKHEAD(STRX);
STRX='(FMIDRPT)' ×× SUBSTR(STR,1,LL) ×× 'FMID/' ;
CALL BLOKHEAD(STRX);
STRX='(ASMRPT)' ×× SUBSTR(STR,1,LL) ×× 'ASM/' ;
CALL BLOKHEAD(STRX);
STRX='(LMODRPT)' ×× SUBSTR(STR,1,LL) ×× 'LMOD/' ;
CALL BLOKHEAD(STRX);
STRX='(MACRPT)' ×× SUBSTR(STR,1,LL) ×× 'MAC/' ;
CALL BLOKHEAD(STRX);
STRX='(MODRPT)' ×× SUBSTR(STR,1,LL) ×× 'MOD/' ;
CALL BLOKHEAD(STRX);
STRX='(SRCRPT)' ×× SUBSTR(STR,1,LL) ×× 'SRC/' ;
CALL BLOKHEAD(STRX);
STRX='(DLIBRPT)' ×× SUBSTR(STR,1,LL) ×× 'DLIB/' ;
CALL BLOKHEAD(STRX);
STRX='(SYSMOD)' ×× SUBSTR(STR,1,LL) ×× 'SYSMOD/' ;
CALL BLOKHEAD(STRX);
STRX='(SRCLTRPT)' ×× SUBSTR(STR,1,LL) ×× 'SRCLST/' ;
CALL BLOKHEAD(STRX);
STRX='(LMODCRPT)' ×× SUBSTR(STR,1,LL) ×× 'LMODCD/' ;
CALL BLOKHEAD(STRX);
STRX='(HOLDRPT)' ×× SUBSTR(STR,1,LL) ×× 'HOLD/' ;
CALL BLOKHEAD(STRX);
END;* END OF BANNER PAGE SETUPS;
*------------------------------------------------------------;
* IRBCATG    DESCRIPTION
   01        ZPOOL1
   02        ZONE ASSIGNMENT (ZONEINDEX)
   03
   04        CATG=CAT
   05        CATG=REL
   10        ZONE
   11        OPTIONS
   12        DDDEF
   13        UTILITY
   14        FMIDSET
   20        ASSEM
   21        LMOD
   22        MAC
   23        MOD
   24        SRC
   25        DLIB
   26        SYSMOD
   30        ASM SRC
   31        LMOD SRC
   32        HOLD DATA ;
*------------------------------------------------------------;
* IRBRELA    DESCRIPTION           IRBRELA       DESCRIPTION
* -------    ------------          ---------     --------------;
* X'0101'      MAIN CSI             X'2001'      ASM SECURITY
* X'0201'      ZONE INDEX CODE      X'2010'      ASM BACKUP
* X'0301'      RDE  CODE            X'2100'      LMOD SECURITY
* X'0401'           CODE            X'2101'      LMOD ATTR
* X'0501'           CODE            X'2110'      LMOD BACKUP
* X'1000'      ZONE SECURITY        X'2113'      LOADLIB
* X'1001'      ZONE INDEX           X'2200'      MAC SECURITY
* X'1020'      ZONE RELATED         X'2201'      MAC  FMID
* X'1021'      ZONE SREL            X'2202'      MAC RMID
* X'1022'      ZONE FMID            X'2210'      MAC BACKUP
* X'1027'      ZONE OPTIONS         X'2211'      MAC DLIB
* X'1172'      AMS IDCAMS UCLIN     X'2213'      MAC LIB
* X'1173'      ASSEMBLER            X'2230'      GENASM
* X'1174'      COMP                 X'2240'      ALIAS
* X'1175'      IEBCOPY              X'2250'      UMID
* X'1177'      LINKAGE EDITOR       X'2300'      MOD SECURITY
* X'1178'      RETRY (IEBCOPY)      X'2301'      MOD FMID
* X'1179'      UPDATE (IEBUPDTE)    X'2302'      MOD RMID
* X'117A'      SZAP (IMASPZAP)      X'2310'      MOD BACKUP
* X'117B'      NUCID                X'2311'      MODDLIB
* X'1180'      UCLIN PAGELEN        X'2313'      MOD ATTR
* X'1181'      UCLIN PREMAX         X'2340'      CSECT
* X'1182'      PURGE/NOPURGE        X'2341'      CSECT LMODE
* X'1183'      REQUEST/NOREQUEST    X'2342'      TALIAS
* X'1188'      RETRY DDNAME         X'2343'      DALIAS
* X'1190'      SAVEMTS              X'2350'      UPDATE ID (UMID)
* X'1191'      SAVESTS              X'2401'      SRC FMID
* X'1192'      DSSPACE              X'2402'      SRC RMID
* X'1193'      DSPREFIX             X'2410'      SRC BACKUP
* X'1201'      DSN=                 X'2411'      SRC DLIB
* X'1202'      VOL=SER=             X'2413'      SRC LIB
* X'1203'      UNIT=                X'2450'      SRC UMID
* X'1209'      CONCAT DD            X'2500'      DLIB SECURITY
* X'1210'      DISP=                X'2501'      DLIB BACKUP
* X'1301'      PGM=                 X'2513'      COPY LIB
* X'1302'      PARM=
* X'1303'      DDN= (PRINT)
* X'1304'      RETURN CODE
* X'1401'      SETFMID ;
* X'2600'      SYSMOD SECURITY      X'26A9'      VERSION
* X'2601'      SYSMOD TYPE          X'26B1'      MOD
* X'2602'      SYSMOD ATTRIBUTE     X'26B2'      ZAP
* X'2611'      DELBY                X'26B3'      XZAP
* X'2612'      LSUBBY               X'26B4'      MAC
* X'2630'      BACKUP               X'26B5'      MACU
* X'2631'      FMID                 X'26B6'      SRC
* X'2632'      RECDATE              X'26B7'      SRCU
* X'2633'      INSDATE              X'26C1'      ASM
* X'2635'      RSTDATE              X'26C2'      APPLY ID
* X'2636'      UCLDATE              X'26C3'      ACCEPT ID
* X'2637'      DSN=                 X'26D1'      RMOD
* X'2638'      # OF REL FILE        X'26D2'      RZAP
* X'2639'      SECID                X'26D3'      RXZAP
* X'263A'      FESN                 X'26D4'      RMAC
* X'26A1'      VSREC                X'26D5'      RMACU
* X'26A2'      VFMID                X'26D6'      RSRC
* X'26A3'      VPRE                 X'26D7'      RSRCU
* X'26A4'      VNPRE                X'26F0'      SUPBY
* X'26A5'      VSUP                 X'26F1'      CIFREQ
* X'26A6'      VREQ                 X'26F4'      HOLDERR
* X'26A7'      VIREQ                X'26F5'      HOLDSYS
* X'26A8'      VDEL                 X'26F6'      HOLDUSR  ;
*                                   X'26F7'      HOLDFMID ;
* X'3001'      SOURCE LISTING       X'3210'      ++HOLD CARD;
* X'3101'      LMOD CARDS           X'3220'      ++HOLD COMMENT;
*                                   X'3230'      ++HOLD FULLGEN;
RETAIN PTR 13 I 1 TYPE SYSMOD SYSENT SYMTYPE ' ';
RETAIN SRCLST DLIB LMOD MOD MAC SRC LMODCD HOLD ' ';
RETAIN ZONEI ZONE DDEF DSN PGM FMID ASM ' ';
RETAIN INDEX ' ';
* CSI KEY FORMAT;
  INPUT CCACZID PIB2.
  @3    IRBCATG PIB1.
  @4    IRBNAME1 $8.
  @12   IRBRELA PIB2.
  @12   IRBRELAC $CHAR2.
  @14   IRBOCCR PIB2. @;
* @16   IRBNAM2F $8. ;
 FORMAT  CCACZIDX IRBOCCRX HEX4. ;
 FORMAT IRBCATGX                   HEX2. ;
 IRBCATGX=IRBCATG;
 CCACZIDX=CCACZID;
 IRBOCCRX=IRBOCCR;
* IF KEYLGTH > 23 THEN LIST;
  NAMELEN=KEYLGTH-16;
 *--------  MAIN CSI  -----------------------------------------;
 IF IRBCATG = 1     THEN  DELETE;
 *-----    ZONEINDEX ------------------------------------------;
 IF IRBCATG = 2 THEN DO;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEIX: IF ZONEI = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @4  (ZINDEX1 ZINDEX2) (PIB2.) @;
      FORMAT ATTRX  $HEX8.;
      FORMAT ZID1 ZID2   HEX4.;
      ZID1=ZINDEX1; ZID2=ZINDEX2;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      PUT @PTR ' ZONENAME-' CSINAME @; PTR+20;
      PUT @PTR ' PRIMARY INDEX-' ZID1 @; PTR+20;
      PUT @PTR ' SECONDARY INDEX-' ZID2 ; PTR+20;
      DELETE;
END;* END OF ZONEI=IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONEI=IRBNAME1;
    PUT ' ZONEINDEX '@;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEIX;
    END;
    DELETE;
    END;
 *-----    ZONE   ---------------------------------------------;
 IF  IRBCATG = 3 × IRBCATG = 4 × IRBCATG = 5  THEN DO;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEX: IF ZONE = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      LIST;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONE=IRBNAME1;
    PUT '**@ ' ZONE @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEX;
    END;
    DELETE;
    END;
 *-------   ZONE DEFINITION -----------------------------------;
 IF IRBCATG = 16    THEN DO; * ZONE;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEY: IF ZONE = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1000'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1001'X THEN DO;
         INDEX=CSINAME;
         PUT @PTR  ' INDEX-' CSINAME @; END;
 ELSE IF IRBRELAC = '1010'X THEN PUT @PTR  ' RELATED-' CSINAME @;
 ELSE IF IRBRELAC = '1021'X THEN PUT @PTR  ' SREL-' CSINAME @;
 ELSE IF IRBRELAC = '1022'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '1026'X THEN PUT @PTR  ' OPTS-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONE=IRBNAME1;
    PUT '** ' ZONE @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEY;
    END;
    DELETE;
    END;
 *-------   OTHER DEFINITION -----------------------------------;
 IF IRBCATG = 17    THEN DO; * ZONE;
    FILE DDEFRPT HEADER=DDEFHDR  PRINT;
DDEFX:    IF DDEF = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1100'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1172'X THEN PUT @PTR  ' AMS-' CSINAME @;
 ELSE IF IRBRELAC = '1173'X THEN PUT @PTR  ' ASMBLR-' CSINAME @;
 ELSE IF IRBRELAC = '1174'X THEN PUT @PTR  ' COMPRS-' CSINAME @;
 ELSE IF IRBRELAC = '1175'X THEN PUT @PTR  ' COPY-' CSINAME @;
 ELSE IF IRBRELAC = '1177'X THEN PUT @PTR  ' LKED-' CSINAME @;
 ELSE IF IRBRELAC = '1178'X THEN PUT @PTR  ' RETRY-' CSINAME @;
 ELSE IF IRBRELAC = '1179'X THEN PUT @PTR  ' UPDTE-' CSINAME @;
 ELSE IF IRBRELAC = '117A'X THEN PUT @PTR  ' SZAP-' CSINAME @;
 ELSE IF IRBRELAC = '117B'X THEN PUT @PTR  ' NUCID-' CSINAME @;
 ELSE IF IRBRELAC = '1180'X THEN PUT @PTR  ' PGELEN-' CSINAME @;
 ELSE IF IRBRELAC = '1181'X THEN PUT @PTR  ' PREMAX-' CSINAME @;
 ELSE IF IRBRELAC = '1182'X THEN PUT @PTR  ' PURGE-' CSINAME @;
 ELSE IF IRBRELAC = '1183'X THEN PUT @PTR  ' REQST-' CSINAME @;
 ELSE IF IRBRELAC = '1188'X THEN PUT @PTR  ' RTYDD-' CSINAME @;
 ELSE IF IRBRELAC = '1190'X THEN PUT @PTR  ' SAVEMTS-' CSINAME @;
 ELSE IF IRBRELAC = '1191'X THEN PUT @PTR  ' SAVESTS-' CSINAME @;
 ELSE IF IRBRELAC = '1192'X THEN DO;
        INPUT @16 PRIM PIB2. @18 SECS PIB2. @20 DIRECTY PIB2. @;
        PUT @PTR  ' DSSPACE-' PRIM ',' SECS ',' DIRECTY @;
        PTR+10; END;
 ELSE IF IRBRELAC = '1193'X THEN DO;
        INPUT @16 PARM &$50.@;
        PUT @PTR  ' DSPREFIX-' PARM @;
        PTR+(NAMELEN-9); END;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DDEF=IRBNAME1;
    PUT '** ' DDEF @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DDEFX;
    END;
    DELETE;
    END;
 *-----DSN  ---------------------------------------------------;
 IF IRBCATG = 18    THEN DO; * LMOD;
    FILE DSNRPT HEADER=DSNHDR PRINT;
DSNX:  IF DSN = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1200'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1201'X THEN DO;
        INPUT @16 PARM &$50.@;
        PUT @PTR  ' DSN-' PARM @;
        IF NAMELEN-9 < 20 THEN PTR+20;
                          ELSE PTR+40;
        END;
 ELSE IF IRBRELAC = '1202'X THEN PUT @PTR  ' VOL-' CSINAME @;
 ELSE IF IRBRELAC = '1203'X THEN PUT @PTR  ' UNIT-' CSINAME @;
 ELSE IF IRBRELAC = '1209'X THEN PUT @PTR  ' CONCAT-' CSINAME @;
 ELSE IF IRBRELAC = '1210'X THEN PUT @PTR  ' DISP-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DSN=IRBNAME1;
    PUT '** ' DSN @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DSNX;
    END;
    DELETE;
    END;
 *-----PGM NAME -----------------------------------------------;
 IF IRBCATG = 19    THEN DO; * LMOD;
    FILE PGMRPT HEADER=PGMHDR  PRINT;
 PGMX:   IF PGM = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 PARM &50. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1300'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1301'X THEN PUT @PTR  ' PGMNME-' CSINAME @;
 ELSE IF IRBRELAC = '1302'X THEN DO;
          PUT @PTR  ' PARM-' PARM @; PTR+(NAMELEN-6); END;
 ELSE IF IRBRELAC = '1303'X THEN DO;
          PUT @PTR  ' SYSOUT-' CSINAME @; PTR+5; END;
 ELSE IF IRBRELAC = '1304'X THEN PUT @PTR  ' RETCODE-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    PGM=IRBNAME1;
    PUT '** ' PGM @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO PGMX;
    END;
    DELETE;
    END;
 *-----SET FMID -----------------------------------------------;
 IF IRBCATG = 20    THEN DO; * LMOD;
    FILE FMIDRPT HEADER=FMIDHDR  PRINT;
FMIDX: IF FMID = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1400'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1401'X THEN PUT @PTR  ' FMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    FMID=IRBNAME1;
    PUT '** ' FMID @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO FMIDX;
    END;
    DELETE;
    END;
 *-----ASM  -----------------------------------------------;
 IF IRBCATG = 32    THEN DO; * LMOD;
    FILE ASMRPT HEADER=ASMHDR  PRINT;
ASMX: IF ASM = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2000'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2010'X THEN PUT @PTR  ' BKUP-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ASM=IRBNAME1;
    PUT '** ' ASM @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ASMX;
    END;
    DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 33    THEN DO; * LMOD;
    FILE LMODRPT HEADER=LMODHDR  PRINT;
LMODX: IF LMOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2100'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2101'X THEN PUT @PTR  ' ATTR-' ATTRX @;
 *  ATTR ANALYSIS CAN BE DONE ON IOPLMLEP SEE GIMMPIOP;
 ELSE IF IRBRELAC = '2110'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2113'X THEN PUT @PTR  ' LLIB-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    LMOD=IRBNAME1;
    PUT '** ' LMOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO LMODX;
    END;
    DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 34    THEN DO; * MAC ;
    FILE MACRPT  HEADER=MACHDR  PRINT;
MACX: IF MAC = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2200'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2201'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2202'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2210'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2211'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2213'X THEN PUT @PTR  ' LLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2230'X THEN PUT @PTR  ' GENASM-' CSINAME @;
 ELSE IF IRBRELAC = '2240'X THEN PUT @PTR  ' ALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2250'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF MAC =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    MAC=IRBNAME1;
    PUT '** ' MAC @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO MACX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 35    THEN DO; * MOD ;
    FILE MODRPT  HEADER=MODHDR  PRINT;
MODX:    IF MOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2300'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2301'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2302'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2310'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2311'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2313'X THEN PUT @PTR  ' ATTR-' ATTRX @;
 *  ATTR ANALYSIS CAN BE DONE ON IOPMDLEP SEE GIMMPIOP;
 ELSE IF IRBRELAC = '2340'X THEN PUT @PTR  ' CSECT-' CSINAME @;
 ELSE IF IRBRELAC = '2341'X THEN PUT @PTR  ' CSECTL-' CSINAME @;
 ELSE IF IRBRELAC = '2342'X THEN PUT @PTR  ' TALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2343'X THEN PUT @PTR  ' DALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2350'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    MOD=IRBNAME1;
    PUT '** ' MOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO MODX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 36    THEN DO; * SRC ;
    FILE SRCRPT  HEADER=SRCHDR  PRINT;
SRCX: IF SRC = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2400'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2401'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2402'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2410'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2411'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2413'X THEN PUT @PTR  ' LIB-' CSINAME @;
 ELSE IF IRBRELAC = '2450'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SRC=IRBNAME1;
    PUT '** ' SRC @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SRCX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 37    THEN DO; * DLIB;
    FILE DLIBRPT  HEADER=DLIBHDR  PRINT;
DLIBX: IF DLIB = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2500'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2510'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2513'X THEN PUT @PTR  ' CPYLIB-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DLIB=IRBNAME1;
    PUT '** ' DLIB @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DLIBX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 38    THEN DO;    *SYSMOD RECORD;
    FILE SYSMOD HEADER=SMODHDR  PRINT;
SYSMODX: IF SYSMOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @14 OCCR PIB2. @;
      FORMAT  COCCR $CHAR4.;
      IF IRBOCCR NE 0 THEN DO;
          IF IRBOCCR > 0 THEN DO;
             COCCR=LEFT(OCCR);
             LL=LENGTH(COCCR);
             XOCCR= '<' ×× SUBSTR(COCCR,1,LL);
             END;
                      ELSE XOCCR='  ' ;
          END;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      LI=LENGTH(IRBNAM2F);
      IF IRBRELAC = '26A1'X THEN LI=4; * SREL ALWAYS HAS 4 BYTES;
      CSINAME=SUBSTR(IRBNAM2F,1,LI) ×× XOCCR;
      IF IRBRELAC = '2637'X × IRBRELAC = '2638'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2601'X THEN DO;
         TYPE= CSINAME;
         PUT @PTR  ' TYPE-' TYPE @ ; END;
 ELSE IF IRBRELAC = '2600'X THEN PUT @PTR  ' SMDSEC-' CSINAME @;
 ELSE IF IRBRELAC = '2602'X THEN DO;
    PUT @PTR  ' ATTR-' ATTRX @;
    PTR+15;
    IF PTR > 118 THEN DO; PUT; PTR=13; END;
    * IOPPSTAT ANALYSIS;
    IF ATTRB1 = '1.......'B THEN DO;
       PUT @PTR 'PTF APPLIED' @; PTR+15;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.1......'B THEN DO;
       PUT @PTR 'RESTORE ATTEMPTED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '..1.....'B THEN DO;
       PUT @PTR 'PTF ACCEPTED' @; PTR+15;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '...1....'B THEN DO;
       PUT @PTR 'SYS ERR ENCOUNTERED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.....1..'B THEN DO;
       PUT @PTR 'PTF IS SUPED/DELETED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '......1.'B THEN DO;
       PUT @PTR 'BYPASS USED TO PROCESS' @; PTR+25;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.......1'B THEN DO;
       PUT @PTR 'PTF DEFAULT APPLIED VIA SYSGEN' @; PTR+30;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
   END;
 ELSE IF IRBRELAC = '2611'X THEN PUT @PTR  ' DELBY-' CSINAME @;
 ELSE IF IRBRELAC = '2612'X THEN PUT @PTR  ' LSUBBY-' CSINAME @;
 ELSE IF IRBRELAC = '26A1'X THEN PUT @PTR  ' SREL-' CSINAME  @;
 ELSE IF IRBRELAC = '26C2'X THEN PUT @PTR  ' APP-' CSINAME @;
 ELSE IF IRBRELAC = '26C3'X THEN PUT @PTR  ' ACC-' CSINAME @;
 ELSE IF IRBRELAC = '26F0'X THEN PUT @PTR  ' SUPBY-' CSINAME @;
 ELSE IF IRBRELAC = '26F1'X THEN DO;
        PUT @PTR  ' (SMOD-' CSINAME @;
        INPUT @24 IRBNAM2F $CHAR8. @;
        CSINAME=IRBNAM2F; PTR+17; IF PTR >120 THEN DO;PUT;PTR=13;END;
        PUT @PTR  ' CIREQ-' CSINAME  ')' @;
        END;
 ELSE IF IRBRELAC = '26F4'X THEN PUT @PTR  ' HERR-' CSINAME @;
 ELSE IF IRBRELAC = '26F5'X THEN PUT @PTR  ' HSYS-' CSINAME @;
 ELSE IF IRBRELAC = '26F6'X THEN PUT @PTR  ' HUSER-' CSINAME @;
 ELSE IF IRBRELAC = '26F7'X THEN PUT @PTR  ' HFMID-' CSINAME @;
 ELSE IF IRBRELAC = '2630'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2631'X THEN PUT @PTR  ' FMID-' CSINAME  @;
 ELSE IF IRBRELAC = '2639'X THEN PUT @PTR  ' SRCEID-' CSINAME @;
 ELSE IF IRBRELAC = '263A'X THEN PUT @PTR  ' FESD-' CSINAME @;
 ELSE IF IRBRELAC = '26A2'X THEN PUT @PTR  ' FMID-' CSINAME  @;
 ELSE IF IRBRELAC = '26A3'X THEN PUT @PTR  ' PRE-' CSINAME  @;
 ELSE IF IRBRELAC = '26A4'X THEN PUT @PTR  ' NPRE-' CSINAME  @;
 ELSE IF IRBRELAC = '26A5'X THEN PUT @PTR  ' SUP-' CSINAME  @;
 ELSE IF IRBRELAC = '26A6'X THEN PUT @PTR  ' REQ-' CSINAME  @;
 ELSE IF IRBRELAC = '26A7'X THEN PUT @PTR  ' IREQ-' CSINAME @;
 ELSE IF IRBRELAC = '26A8'X THEN PUT @PTR  ' DEL-' CSINAME @;
 ELSE IF IRBRELAC = '26A9'X THEN PUT @PTR  ' VERSION-' CSINAME @;
 ELSE IF IRBRELAC = '26B1'X THEN PUT @PTR  ' MOD-' CSINAME @;
 ELSE IF IRBRELAC = '26B2'X THEN PUT @PTR  ' ZAP-' CSINAME @;
 ELSE IF IRBRELAC = '26B3'X THEN PUT @PTR  ' XZAP-' CSINAME @;
 ELSE IF IRBRELAC = '26B4'X THEN PUT @PTR  ' MAC-' CSINAME @;
 ELSE IF IRBRELAC = '26B5'X THEN PUT @PTR  ' MACU-' CSINAME @;
 ELSE IF IRBRELAC = '26B6'X THEN PUT @PTR  ' SRC-' CSINAME @;
 ELSE IF IRBRELAC = '26B7'X THEN PUT @PTR  ' SRCU-' CSINAME @;
 ELSE IF IRBRELAC = '26C1'X THEN PUT @PTR  ' ASM-' CSINAME @;
 ELSE DO; INPUT  @16 IRBDATE PD3. @;
    IF IRBRELAC = '2632'X THEN PUT @PTR  ' RECDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2633'X THEN PUT @PTR  ' INSDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2635'X THEN PUT @PTR  ' RSTDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2636'X THEN PUT @PTR  ' UCLDATE-' IRBDATE @ ;
  END; * END OF IRBDATE;
  PTR+17;
  IF PTR > 120 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SYSMOD=IRBNAME1;
    PUT '** ' SYSMOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SYSMODX;
    END;
  DELETE;
    END;
 *------------  SOURCE CARDS ------------------------------------;
 IF IRBCATG = 48    THEN DO;    *SRCLST RECORD;
    FILE SRCLTRPT HEADER=SRCLTHDR  PRINT;
SRCLTX: IF SRCLST = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '3001'X THEN DO;
         INPUT @16 CARD $80. @;
         PUT @PTR  ' SRCLIST-' CARD ;
        PTR=28 ; END;
END;* END OF SRCLST =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SRCLST=IRBNAME1;
    PUT '** ' SRCLST @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SRCLTX;
    END;
  DELETE;
    END;
 *------------  LMOD CARDS ------------------------------------;
 IF IRBCATG = 49    THEN DO;    *LMOD RECORD;
    FILE LMODCRPT HEADER=LMODCHDR  PRINT;
LMODCX: IF LMODCD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC ^= '3101'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '3101'X THEN DO;
         INPUT @16 CARD $80. @;
         PUT @PTR  ' LMODCARD-' CARD ;
        PTR=28 ; END;
END;* END OF LMODCD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    LMODCD=IRBNAME1;
    PUT '** ' LMODCD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO LMODCX;
    END;
  DELETE;
    END;
 *------------  HOLD CARDS ------------------------------------;
 IF IRBCATG = 50    THEN DO;    *HOLD RECORD;
    FILE HOLDRPT HEADER=HOLDHDR  PRINT;
HOLDX: IF HOLD = IRBNAME1 THEN DO;
         INPUT @16 CARD $80. @;
      IF IRBRELAC = '3210'X
         THEN DO;
         PUT @PTR  ' ++HOLD-' CARD ;
        PTR=26 ; END;
 ELSE IF IRBRELAC = '3220'X THEN DO;
         PUT @PTR  ' ++COMMENT-' CARD ;
        PTR=26 ; END;
 ELSE IF IRBRELAC = '3230'X THEN DO;
         PUT @PTR  ' ++FULLGEN-' CARD ;
        PTR=26 ; END;
        ELSE LIST;
END;* END OF HOLD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    HOLD=IRBNAME1;
    PUT '** ' HOLD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+13;
    GO TO HOLDX;
    END;
  DELETE;
    END;
 LIST;DELETE;
RETURN;
SMODHDR: PUT ' CDSI -    SYSMOD LISTING FROM ' DSNAME $CHAR44.
  'NOTE: NUMBER WITH PREFIX "<" IS OCCURANCE IN MCS OF SYSMOD.';
         RETURN;
HOLDHDR: PUT ' CDSI -    ++HOLD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
LMODHDR: PUT ' CDSI -    LMOD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
LMODCHDR: PUT ' CDSI -    LMOD CARDS LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
SRCLTHDR: PUT ' CDSI -    SOURCE CARDS LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
MODHDR: PUT ' CDSI -    MOD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
MACHDR: PUT ' CDSI -    MAC LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
SRCHDR: PUT ' CDSI -    SRC LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DLIBHDR: PUT ' CDSI -    DLIB LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
ZONEHDR: PUT ' CDSI -    ZONE LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DDEFHDR: PUT ' CDSI -    DDDEF LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DSNHDR: PUT ' CDSI -    DSN LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
PGMHDR: PUT ' CDSI -    PGM LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
FMIDHDR: PUT ' CDSI -   FMID LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
ASMHDR: PUT ' CDSI -    ASM LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
./       ADD   NAME=CSISASTA
* SAS PROGRAM TO READ AND ANALYZE A PTF OUTPUT FROM SMPE ;
DATA CSI(KEEP=IRBRELAX CCACZIDX IRBCATGX IRBOCCRX);
LENGTH TYPE $ 8 SYSMOD $ 8 SYSENT $ 50  SYMTYPE $ 8 CSINAME $ 12;
LENGTH SRCLST $ 8 DLIB $ 8 ATTRX $ 8 LMOD $ 8 MOD $ 8 MAC $ 8 SRC $ 8;
LENGTH ZONEI $ 8 ZONE $ 8 DDEF $ 8 DSN $ 8 PGM $ 8 FMID $ 8 ASM $ 8;
LENGTH PARM $ 50 CARD $ 80 HOLD $ 8 LMODCD $ 8;
LENGTH COCCR $2;
* ---------- DEFINE INFILE ---------------;
  INFILE SMPCSI LENGTH=KEYLGTH JFCB=DSNAME; * READ FROM TAPE;
OPTIONS  MISSING=' ' TIME=MAX LINESIZE=132 PS=56 NUMBER;
TITLE  SMPE  CSI FILE LISTING;
*---------- SET BANNER PAGE ON EACH DDNAME WITH DATE -------;
LENGTH STR $ 40 ;
LENGTH STRX $ 40 ;
LENGTH YEAR $ 4;
RETAIN BANNER ' '  MONTH  DATEX DAYN 0;
RETAIN YEAR;
IF BANNER = ' ' THEN DO;
BANNER='X';
DATEX=DATE();
DAYN=DAY(DATEX); * PUT PAGE BANNER ON SYSOUT FOR EASIER READING;
MONTH=MONTH(DATEX);YEAR=YEAR(DATEX);
 IF DAYN = 1       THEN STR='/1';
ELSE IF  DAYN = 2 THEN  STR='/2';
ELSE IF  DAYN = 3 THEN  STR='/3';
ELSE IF  DAYN = 4 THEN  STR='/4';
ELSE IF  DAYN = 5 THEN  STR='/5';
ELSE IF  DAYN = 6 THEN  STR='/6';
ELSE IF  DAYN = 7 THEN  STR='/7';
ELSE IF  DAYN = 8 THEN  STR='/8';
ELSE IF  DAYN = 9 THEN  STR='/9';
ELSE IF  DAYN = 10 THEN STR='/10';
ELSE IF  DAYN = 11 THEN STR='/11';
ELSE IF  DAYN = 12 THEN STR='/12';
ELSE IF  DAYN = 13 THEN STR='/13';
ELSE IF  DAYN = 14 THEN STR='/14';
ELSE IF  DAYN = 15 THEN STR='/15';
ELSE IF  DAYN = 16 THEN STR='/16';
ELSE IF  DAYN = 17 THEN STR='/17';
ELSE IF  DAYN = 18 THEN STR='/18';
ELSE IF  DAYN = 19 THEN STR='/19';
ELSE IF  DAYN = 20 THEN STR='/20';
ELSE IF  DAYN = 21 THEN STR='/21';
ELSE IF  DAYN = 22 THEN STR='/22';
ELSE IF  DAYN = 23 THEN STR='/23';
ELSE IF  DAYN = 24 THEN STR='/24';
ELSE IF  DAYN = 25 THEN STR='/25';
ELSE IF  DAYN = 26 THEN STR='/26';
ELSE IF  DAYN = 27 THEN STR='/27';
ELSE IF  DAYN = 28 THEN STR='/28';
ELSE IF  DAYN = 29 THEN STR='/29';
ELSE IF  DAYN = 30 THEN STR='/30';
ELSE IF  DAYN = 31 THEN STR='/31';
LL=LENGTH(STR);
IF MONTH = 1        THEN
       STR=SUBSTR(STR,1,LL) ×× '/JANUARY/'   ×× YEAR ×× '/';
  ELSE IF MONTH = 2 THEN
       STR=SUBSTR(STR,1,LL) ×× '/FEBRUARY/'  ×× YEAR ×× '/';
  ELSE IF MONTH = 3 THEN
  STR=SUBSTR(STR,1,LL) ×× '/MARCH/'     ×× YEAR ×× '/';
  ELSE IF MONTH = 4 THEN
  STR=SUBSTR(STR,1,LL) ×× '/APRIL/'     ×× YEAR ×× '/';
  ELSE IF MONTH = 5 THEN
  STR=SUBSTR(STR,1,LL) ×× '/MAY/'       ×× YEAR ×× '/';
  ELSE IF MONTH = 6 THEN
  STR=SUBSTR(STR,1,LL) ×× '/JUNE/'      ×× YEAR ×× '/';
  ELSE IF MONTH = 7 THEN
  STR=SUBSTR(STR,1,LL) ×× '/JULY/'      ×× YEAR ×× '/';
  ELSE IF MONTH = 8 THEN
  STR=SUBSTR(STR,1,LL) ×× '/AUGUST/'    ×× YEAR ×× '/';
  ELSE IF MONTH = 9 THEN
  STR=SUBSTR(STR,1,LL) ×× '/SEPTEMBER/' ×× YEAR ×× '/';
  ELSE IF MONTH = 10 THEN
  STR=SUBSTR(STR,1,LL) ×× '/OCTOBER/'  ×× YEAR ×× '/';
  ELSE IF MONTH = 11 THEN
  STR=SUBSTR(STR,1,LL) ×× '/NOVEMBER/' ×× YEAR ×× '/';
  ELSE IF MONTH = 12 THEN
   STR=SUBSTR(STR,1,LL) ×× '/DECEMBER/' ×× YEAR ×× '/';
LL=LENGTH(STR);
STRX='(ZONERPT)' ×× SUBSTR(STR,1,LL) ×× 'ZONE/' ;
CALL BLOKHEAD(STRX);
STRX='(DDEFRPT)' ×× SUBSTR(STR,1,LL) ×× 'DDEF/' ;
CALL BLOKHEAD(STRX);
STRX='(DSNRPT)' ×× SUBSTR(STR,1,LL) ×× 'DSN/' ;
CALL BLOKHEAD(STRX);
STRX='(PGMRPT)' ×× SUBSTR(STR,1,LL) ×× 'PGM/' ;
CALL BLOKHEAD(STRX);
STRX='(FMIDRPT)' ×× SUBSTR(STR,1,LL) ×× 'FMID/' ;
CALL BLOKHEAD(STRX);
STRX='(ASMRPT)' ×× SUBSTR(STR,1,LL) ×× 'ASM/' ;
CALL BLOKHEAD(STRX);
STRX='(LMODRPT)' ×× SUBSTR(STR,1,LL) ×× 'LMOD/' ;
CALL BLOKHEAD(STRX);
STRX='(MACRPT)' ×× SUBSTR(STR,1,LL) ×× 'MAC/' ;
CALL BLOKHEAD(STRX);
STRX='(MODRPT)' ×× SUBSTR(STR,1,LL) ×× 'MOD/' ;
CALL BLOKHEAD(STRX);
STRX='(SRCRPT)' ×× SUBSTR(STR,1,LL) ×× 'SRC/' ;
CALL BLOKHEAD(STRX);
STRX='(DLIBRPT)' ×× SUBSTR(STR,1,LL) ×× 'DLIB/' ;
CALL BLOKHEAD(STRX);
STRX='(SYSMOD)' ×× SUBSTR(STR,1,LL) ×× 'SYSMOD/' ;
CALL BLOKHEAD(STRX);
STRX='(SRCLTRPT)' ×× SUBSTR(STR,1,LL) ×× 'SRCLST/' ;
CALL BLOKHEAD(STRX);
STRX='(LMODCRPT)' ×× SUBSTR(STR,1,LL) ×× 'LMODCD/' ;
CALL BLOKHEAD(STRX);
STRX='(HOLDRPT)' ×× SUBSTR(STR,1,LL) ×× 'HOLD/' ;
CALL BLOKHEAD(STRX);
END;* END OF BANNER PAGE SETUPS;
*------------------------------------------------------------;
* IRBCATG    DESCRIPTION
   01        ZPOOL1
   02        ZONE ASSIGNMENT (ZONEINDEX)
   03
   04        CATG=CAT
   05        CATG=REL
   10        ZONE
   11        OPTIONS
   12        DDDEF
   13        UTILITY
   14        FMIDSET
   20        ASSEM
   21        LMOD
   22        MAC
   23        MOD
   24        SRC
   25        DLIB
   26        SYSMOD
   30        ASM SRC
   31        LMOD SRC
   32        HOLD DATA ;
*------------------------------------------------------------;
* IRBRELA    DESCRIPTION           IRBRELA       DESCRIPTION
* -------    ------------          ---------     --------------;
* X'0101'      MAIN CSI             X'2001'      ASM SECURITY
* X'0201'      ZONE INDEX CODE      X'2010'      ASM BACKUP
* X'0301'      RDE  CODE            X'2100'      LMOD SECURITY
* X'0401'           CODE            X'2101'      LMOD ATTR
* X'0501'           CODE            X'2110'      LMOD BACKUP
* X'1000'      ZONE SECURITY        X'2113'      LOADLIB
* X'1001'      ZONE INDEX           X'2200'      MAC SECURITY
* X'1020'      ZONE RELATED         X'2201'      MAC  FMID
* X'1021'      ZONE SREL            X'2202'      MAC RMID
* X'1022'      ZONE FMID            X'2210'      MAC BACKUP
* X'1027'      ZONE OPTIONS         X'2211'      MAC DLIB
* X'1172'      AMS IDCAMS UCLIN     X'2213'      MAC LIB
* X'1173'      ASSEMBLER            X'2230'      GENASM
* X'1174'      COMP                 X'2240'      ALIAS
* X'1175'      IEBCOPY              X'2250'      UMID
* X'1177'      LINKAGE EDITOR       X'2300'      MOD SECURITY
* X'1178'      RETRY (IEBCOPY)      X'2301'      MOD FMID
* X'1179'      UPDATE (IEBUPDTE)    X'2302'      MOD RMID
* X'117A'      SZAP (IMASPZAP)      X'2310'      MOD BACKUP
* X'117B'      NUCID                X'2311'      MODDLIB
* X'1180'      UCLIN PAGELEN        X'2313'      MOD ATTR
* X'1181'      UCLIN PREMAX         X'2340'      CSECT
* X'1182'      PURGE/NOPURGE        X'2341'      CSECT LMODE
* X'1183'      REQUEST/NOREQUEST    X'2342'      TALIAS
* X'1188'      RETRY DDNAME         X'2343'      DALIAS
* X'1190'      SAVEMTS              X'2350'      UPDATE ID (UMID)
* X'1191'      SAVESTS              X'2401'      SRC FMID
* X'1192'      DSSPACE              X'2402'      SRC RMID
* X'1193'      DSPREFIX             X'2410'      SRC BACKUP
* X'1201'      DSN=                 X'2411'      SRC DLIB
* X'1202'      VOL=SER=             X'2413'      SRC LIB
* X'1203'      UNIT=                X'2450'      SRC UMID
* X'1209'      CONCAT DD            X'2500'      DLIB SECURITY
* X'1210'      DISP=                X'2501'      DLIB BACKUP
* X'1301'      PGM=                 X'2513'      COPY LIB
* X'1302'      PARM=
* X'1303'      DDN= (PRINT)
* X'1304'      RETURN CODE
* X'1401'      SETFMID ;
* X'2600'      SYSMOD SECURITY      X'26A9'      VERSION
* X'2601'      SYSMOD TYPE          X'26B1'      MOD
* X'2602'      SYSMOD ATTRIBUTE     X'26B2'      ZAP
* X'2611'      DELBY                X'26B3'      XZAP
* X'2612'      LSUBBY               X'26B4'      MAC
* X'2630'      BACKUP               X'26B5'      MACU
* X'2631'      FMID                 X'26B6'      SRC
* X'2632'      RECDATE              X'26B7'      SRCU
* X'2633'      INSDATE              X'26C1'      ASM
* X'2635'      RSTDATE              X'26C2'      APPLY ID
* X'2636'      UCLDATE              X'26C3'      ACCEPT ID
* X'2637'      DSN=                 X'26D1'      RMOD
* X'2638'      # OF REL FILE        X'26D2'      RZAP
* X'2639'      SECID                X'26D3'      RXZAP
* X'263A'      FESN                 X'26D4'      RMAC
* X'26A1'      VSREC                X'26D5'      RMACU
* X'26A2'      VFMID                X'26D6'      RSRC
* X'26A3'      VPRE                 X'26D7'      RSRCU
* X'26A4'      VNPRE                X'26F0'      SUPBY
* X'26A5'      VSUP                 X'26F1'      CIFREQ
* X'26A6'      VREQ                 X'26F4'      HOLDERR
* X'26A7'      VIREQ                X'26F5'      HOLDSYS
* X'26A8'      VDEL                 X'26F6'      HOLDUSR  ;
* X'3001'      SOURCE LISTING       X'3210'      ++HOLD CARD;
* X'3101'      LMOD CARDS           X'3220'      ++HOLD COMMENT;
*                                   X'3230'      ++HOLD FULLGEN;
RETAIN PTR 13 I 1 TYPE SYSMOD SYSENT SYMTYPE ' ';
RETAIN SRCLST DLIB LMOD MOD MAC SRC LMODCD HOLD ' ';
RETAIN ZONEI ZONE DDEF DSN PGM FMID ASM ' ';
RETAIN INDEX ' ';
* CSI KEY FORMAT;
  INPUT CCACZID PIB2.
  @3    IRBCATG PIB1.
  @4    IRBNAME1 $8.
  @12   IRBRELA PIB2.
  @12   IRBRELAC $CHAR2.
  @14   IRBOCCR PIB2. @;
* @16   IRBNAM2F $8. ;
 FORMAT  CCACZIDX IRBOCCRX HEX4. ;
 FORMAT IRBCATGX                   HEX2. ;
 IRBCATGX=IRBCATG;
 CCACZIDX=CCACZID;
 IRBOCCRX=IRBOCCR;
* IF KEYLGTH > 23 THEN LIST;
  NAMELEN=KEYLGTH-16;
 *--------  MAIN CSI  -----------------------------------------;
 IF IRBCATG = 1     THEN  DELETE;
 *-----    ZONEINDEX ------------------------------------------;
 IF IRBCATG = 2 THEN DO;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEIX: IF ZONEI = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @4  (ZINDEX1 ZINDEX2) (PIB2.) @;
      FORMAT ATTRX  $HEX8.;
      FORMAT ZID1 ZID2   HEX4.;
      ZID1=ZINDEX1; ZID2=ZINDEX2;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      PUT @PTR ' ZONENAME-' CSINAME @; PTR+20;
      PUT @PTR ' PRIMARY INDEX-' ZID1 @; PTR+20;
      PUT @PTR ' SECONDARY INDEX-' ZID2 ; PTR+20;
      DELETE;
END;* END OF ZONEI=IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONEI=IRBNAME1;
    PUT ' ZONEINDEX '@;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEIX;
    END;
    DELETE;
    END;
 *-----    ZONE   ---------------------------------------------;
 IF  IRBCATG = 3 × IRBCATG = 4 × IRBCATG = 5  THEN DO;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEX: IF ZONE = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      LIST;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONE=IRBNAME1;
    PUT '**@ ' ZONE @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEX;
    END;
    DELETE;
    END;
 *-------   ZONE DEFINITION -----------------------------------;
 IF IRBCATG = 16    THEN DO; * ZONE;
    FILE ZONERPT HEADER=ZONEHDR  PRINT;
ZONEY: IF ZONE = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1000'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1001'X THEN DO;
         INDEX=CSINAME;
         PUT @PTR  ' INDEX-' CSINAME @; END;
 ELSE IF IRBRELAC = '1010'X THEN PUT @PTR  ' RELATED-' CSINAME @;
 ELSE IF IRBRELAC = '1021'X THEN PUT @PTR  ' SREL-' CSINAME @;
 ELSE IF IRBRELAC = '1022'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '1026'X THEN PUT @PTR  ' OPTS-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ZONE=IRBNAME1;
    PUT '** ' ZONE @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ZONEY;
    END;
    DELETE;
    END;
 *-------   OTHER DEFINITION -----------------------------------;
 IF IRBCATG = 17    THEN DO; * ZONE;
    FILE DDEFRPT HEADER=DDEFHDR  PRINT;
DDEFX:    IF DDEF = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1100'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1172'X THEN PUT @PTR  ' AMS-' CSINAME @;
 ELSE IF IRBRELAC = '1173'X THEN PUT @PTR  ' ASMBLR-' CSINAME @;
 ELSE IF IRBRELAC = '1174'X THEN PUT @PTR  ' COMPRS-' CSINAME @;
 ELSE IF IRBRELAC = '1175'X THEN PUT @PTR  ' COPY-' CSINAME @;
 ELSE IF IRBRELAC = '1177'X THEN PUT @PTR  ' LKED-' CSINAME @;
 ELSE IF IRBRELAC = '1178'X THEN PUT @PTR  ' RETRY-' CSINAME @;
 ELSE IF IRBRELAC = '1179'X THEN PUT @PTR  ' UPDTE-' CSINAME @;
 ELSE IF IRBRELAC = '117A'X THEN PUT @PTR  ' SZAP-' CSINAME @;
 ELSE IF IRBRELAC = '117B'X THEN PUT @PTR  ' NUCID-' CSINAME @;
 ELSE IF IRBRELAC = '1180'X THEN PUT @PTR  ' PGELEN-' CSINAME @;
 ELSE IF IRBRELAC = '1181'X THEN PUT @PTR  ' PREMAX-' CSINAME @;
 ELSE IF IRBRELAC = '1182'X THEN PUT @PTR  ' PURGE-' CSINAME @;
 ELSE IF IRBRELAC = '1183'X THEN PUT @PTR  ' REQST-' CSINAME @;
 ELSE IF IRBRELAC = '1188'X THEN PUT @PTR  ' RTYDD-' CSINAME @;
 ELSE IF IRBRELAC = '1190'X THEN PUT @PTR  ' SAVEMTS-' CSINAME @;
 ELSE IF IRBRELAC = '1191'X THEN PUT @PTR  ' SAVESTS-' CSINAME @;
 ELSE IF IRBRELAC = '1192'X THEN DO;
        INPUT @16 PRIM PIB2. @18 SECS PIB2. @20 DIRECTY PIB2. @;
        PUT @PTR  ' DSSPACE-' PRIM ',' SECS ',' DIRECTY @;
        PTR+10; END;
 ELSE IF IRBRELAC = '1193'X THEN DO;
        INPUT @16 PARM &$50.@;
        PUT @PTR  ' DSPREFIX-' PARM @;
        PTR+(NAMELEN-9); END;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DDEF=IRBNAME1;
    PUT '** ' DDEF @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DDEFX;
    END;
    DELETE;
    END;
 *-----DSN  ---------------------------------------------------;
 IF IRBCATG = 18    THEN DO; * LMOD;
    FILE DSNRPT HEADER=DSNHDR PRINT;
DSNX:  IF DSN = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1200'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1201'X THEN DO;
        INPUT @16 PARM &$50.@;
        PUT @PTR  ' DSN-' PARM @;
        IF NAMELEN-9 < 20 THEN PTR+20;
                          ELSE PTR+40;
        END;
 ELSE IF IRBRELAC = '1202'X THEN PUT @PTR  ' VOL-' CSINAME @;
 ELSE IF IRBRELAC = '1203'X THEN PUT @PTR  ' UNIT-' CSINAME @;
 ELSE IF IRBRELAC = '1209'X THEN PUT @PTR  ' CONCAT-' CSINAME @;
 ELSE IF IRBRELAC = '1210'X THEN PUT @PTR  ' DISP-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DSN=IRBNAME1;
    PUT '** ' DSN @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DSNX;
    END;
    DELETE;
    END;
 *-----PGM NAME -----------------------------------------------;
 IF IRBCATG = 19    THEN DO; * LMOD;
    FILE PGMRPT HEADER=PGMHDR  PRINT;
 PGMX:   IF PGM = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 PARM &50. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1300'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1301'X THEN PUT @PTR  ' PGMNME-' CSINAME @;
 ELSE IF IRBRELAC = '1302'X THEN DO;
          PUT @PTR  ' PARM-' PARM @; PTR+(NAMELEN-6); END;
 ELSE IF IRBRELAC = '1303'X THEN DO;
          PUT @PTR  ' SYSOUT-' CSINAME @; PTR+5; END;
 ELSE IF IRBRELAC = '1304'X THEN PUT @PTR  ' RETCODE-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    PGM=IRBNAME1;
    PUT '** ' PGM @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO PGMX;
    END;
    DELETE;
    END;
 *-----SET FMID -----------------------------------------------;
 IF IRBCATG = 20    THEN DO; * LMOD;
    FILE FMIDRPT HEADER=FMIDHDR  PRINT;
FMIDX: IF FMID = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '1400'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '1401'X THEN PUT @PTR  ' FMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    FMID=IRBNAME1;
    PUT '** ' FMID @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO FMIDX;
    END;
    DELETE;
    END;
 *-----ASM  -----------------------------------------------;
 IF IRBCATG = 32    THEN DO; * LMOD;
    FILE ASMRPT HEADER=ASMHDR  PRINT;
ASMX: IF ASM = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2000'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2010'X THEN PUT @PTR  ' BKUP-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    ASM=IRBNAME1;
    PUT '** ' ASM @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO ASMX;
    END;
    DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 33    THEN DO; * LMOD;
    FILE LMODRPT HEADER=LMODHDR  PRINT;
LMODX: IF LMOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2100'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2101'X THEN PUT @PTR  ' ATTR-' ATTRX @;
 *  ATTR ANALYSIS CAN BE DONE ON IOPLMLEP SEE GIMMPIOP;
 ELSE IF IRBRELAC = '2110'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2113'X THEN PUT @PTR  ' LLIB-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF LMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    LMOD=IRBNAME1;
    PUT '** ' LMOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO LMODX;
    END;
    DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 34    THEN DO; * MAC ;
    FILE MACRPT  HEADER=MACHDR  PRINT;
MACX: IF MAC = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2200'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2201'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2202'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2210'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2211'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2213'X THEN PUT @PTR  ' LLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2230'X THEN PUT @PTR  ' GENASM-' CSINAME @;
 ELSE IF IRBRELAC = '2240'X THEN PUT @PTR  ' ALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2250'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF MAC =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    MAC=IRBNAME1;
    PUT '** ' MAC @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO MACX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 35    THEN DO; * MOD ;
    FILE MODRPT  HEADER=MODHDR  PRINT;
MODX:    IF MOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2300'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2301'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2302'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2310'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2311'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2313'X THEN PUT @PTR  ' ATTR-' ATTRX @;
 *  ATTR ANALYSIS CAN BE DONE ON IOPMDLEP SEE GIMMPIOP;
 ELSE IF IRBRELAC = '2340'X THEN PUT @PTR  ' CSECT-' CSINAME @;
 ELSE IF IRBRELAC = '2341'X THEN PUT @PTR  ' CSECTL-' CSINAME @;
 ELSE IF IRBRELAC = '2342'X THEN PUT @PTR  ' TALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2343'X THEN PUT @PTR  ' DALIAS-' CSINAME @;
 ELSE IF IRBRELAC = '2350'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    MOD=IRBNAME1;
    PUT '** ' MOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO MODX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 36    THEN DO; * SRC ;
    FILE SRCRPT  HEADER=SRCHDR  PRINT;
SRCX: IF SRC = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2400'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2401'X THEN PUT @PTR  ' FMID-' CSINAME @;
 ELSE IF IRBRELAC = '2402'X THEN PUT @PTR  ' RMID-' CSINAME @;
 ELSE IF IRBRELAC = '2410'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2411'X THEN PUT @PTR  ' DLIB-' CSINAME @;
 ELSE IF IRBRELAC = '2413'X THEN PUT @PTR  ' LIB-' CSINAME @;
 ELSE IF IRBRELAC = '2450'X THEN PUT @PTR  ' UMID-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SRC=IRBNAME1;
    PUT '** ' SRC @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SRCX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 37    THEN DO; * DLIB;
    FILE DLIBRPT  HEADER=DLIBHDR  PRINT;
DLIBX: IF DLIB = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '2500'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2510'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2513'X THEN PUT @PTR  ' CPYLIB-' CSINAME @;
  PTR+15;
  IF PTR > 118 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    DLIB=IRBNAME1;
    PUT '** ' DLIB @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO DLIBX;
    END;
  DELETE;
    END;
 *-------------------------------------------------------------;
 IF IRBCATG = 38    THEN DO;    *SYSMOD RECORD;
    FILE SYSMOD HEADER=SMODHDR  PRINT;
SYSMODX: IF SYSMOD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @14 OCCR PIB2. @;
      FORMAT  COCCR $CHAR4.;
      IF IRBOCCR NE 0 THEN DO;
          IF IRBOCCR > 0 THEN DO;
             COCCR=LEFT(OCCR);
             LL=LENGTH(COCCR);
             XOCCR= '<' ×× SUBSTR(COCCR,1,LL);
             END;
                      ELSE XOCCR='  ' ;
          END;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      LI=LENGTH(IRBNAM2F);
      IF IRBRELAC = '26A1'X THEN LI=4; * SREL ALWAYS HAS 4 BYTES;
      CSINAME=SUBSTR(IRBNAM2F,1,LI) ×× XOCCR;
      IF IRBRELAC = '2637'X × IRBRELAC = '2638'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '2601'X THEN DO;
         TYPE= CSINAME;
         PUT @PTR  ' TYPE-' TYPE @ ; END;
 ELSE IF IRBRELAC = '2600'X THEN PUT @PTR  ' SMDSEC-' CSINAME @;
 ELSE IF IRBRELAC = '2602'X THEN DO;
    PUT @PTR  ' ATTR-' ATTRX @;
    PTR+15;
    IF PTR > 118 THEN DO; PUT; PTR=13; END;
    * IOPPSTAT ANALYSIS;
    IF ATTRB1 = '1.......'B THEN DO;
       PUT @PTR 'PTF APPLIED' @; PTR+15;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.1......'B THEN DO;
       PUT @PTR 'RESTORE ATTEMPTED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '..1.....'B THEN DO;
       PUT @PTR 'PTF ACCEPTED' @; PTR+15;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '...1....'B THEN DO;
       PUT @PTR 'SYS ERR ENCOUNTERED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.....1..'B THEN DO;
       PUT @PTR 'PTF IS SUPED/DELETED' @; PTR+20;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '......1.'B THEN DO;
       PUT @PTR 'BYPASS USED TO PROCESS' @; PTR+25;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
    IF ATTRB1 = '.......1'B THEN DO;
       PUT @PTR 'PTF DEFAULT APPLIED VIA SYSGEN' @; PTR+30;
       IF PTR > 118 THEN DO; PUT; PTR=13; END;  END;
   END;
 ELSE IF IRBRELAC = '2611'X THEN PUT @PTR  ' DELBY-' CSINAME @;
 ELSE IF IRBRELAC = '2612'X THEN PUT @PTR  ' LSUBBY-' CSINAME @;
 ELSE IF IRBRELAC = '26A1'X THEN PUT @PTR  ' SREL-' CSINAME  @;
 ELSE IF IRBRELAC = '26C2'X THEN PUT @PTR  ' APP-' CSINAME @;
 ELSE IF IRBRELAC = '26C3'X THEN PUT @PTR  ' ACC-' CSINAME @;
 ELSE IF IRBRELAC = '26F0'X THEN PUT @PTR  ' SUPBY-' CSINAME @;
 ELSE IF IRBRELAC = '26F1'X THEN DO;
        PUT @PTR  ' (SMOD-' CSINAME @;
        INPUT @24 IRBNAM2F $CHAR8. @;
        CSINAME=IRBNAM2F; PTR+17; IF PTR >120 THEN DO;PUT;PTR=13;END;
        PUT @PTR  ' CIREQ-' CSINAME  ')' @;
        END;
 ELSE IF IRBRELAC = '26F4'X THEN PUT @PTR  ' HERR-' CSINAME @;
 ELSE IF IRBRELAC = '26F5'X THEN PUT @PTR  ' HSYS-' CSINAME @;
 ELSE IF IRBRELAC = '26F6'X THEN PUT @PTR  ' HUSER-' CSINAME @;
 ELSE IF IRBRELAC = '2630'X THEN PUT @PTR  ' BKUP-' CSINAME @;
 ELSE IF IRBRELAC = '2631'X THEN PUT @PTR  ' FMID-' CSINAME  @;
 ELSE IF IRBRELAC = '2639'X THEN PUT @PTR  ' SRCEID-' CSINAME @;
 ELSE IF IRBRELAC = '263A'X THEN PUT @PTR  ' FESD-' CSINAME @;
 ELSE IF IRBRELAC = '26A2'X THEN PUT @PTR  ' FMID-' CSINAME  @;
 ELSE IF IRBRELAC = '26A3'X THEN PUT @PTR  ' PRE-' CSINAME  @;
 ELSE IF IRBRELAC = '26A4'X THEN PUT @PTR  ' NPRE-' CSINAME  @;
 ELSE IF IRBRELAC = '26A5'X THEN PUT @PTR  ' SUP-' CSINAME  @;
 ELSE IF IRBRELAC = '26A6'X THEN PUT @PTR  ' REQ-' CSINAME  @;
 ELSE IF IRBRELAC = '26A7'X THEN PUT @PTR  ' IREQ-' CSINAME @;
 ELSE IF IRBRELAC = '26A8'X THEN PUT @PTR  ' DEL-' CSINAME @;
 ELSE IF IRBRELAC = '26A9'X THEN PUT @PTR  ' VERSION-' CSINAME @;
 ELSE IF IRBRELAC = '26B1'X THEN PUT @PTR  ' MOD-' CSINAME @;
 ELSE IF IRBRELAC = '26B2'X THEN PUT @PTR  ' ZAP-' CSINAME @;
 ELSE IF IRBRELAC = '26B3'X THEN PUT @PTR  ' XZAP-' CSINAME @;
 ELSE IF IRBRELAC = '26B4'X THEN PUT @PTR  ' MAC-' CSINAME @;
 ELSE IF IRBRELAC = '26B5'X THEN PUT @PTR  ' MACU-' CSINAME @;
 ELSE IF IRBRELAC = '26B6'X THEN PUT @PTR  ' SRC-' CSINAME @;
 ELSE IF IRBRELAC = '26B7'X THEN PUT @PTR  ' SRCU-' CSINAME @;
 ELSE IF IRBRELAC = '26C1'X THEN PUT @PTR  ' ASM-' CSINAME @;
 ELSE DO; INPUT  @16 IRBDATE PD3. @;
    IF IRBRELAC = '2632'X THEN PUT @PTR  ' RECDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2633'X THEN PUT @PTR  ' INSDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2635'X THEN PUT @PTR  ' RSTDATE-' IRBDATE @;
 ELSE IF IRBRELAC = '2636'X THEN PUT @PTR  ' UCLDATE-' IRBDATE @ ;
  END; * END OF IRBDATE;
  PTR+17;
  IF PTR > 120 THEN DO; PUT; PTR=13; END;
END;* END OF SYSMOD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SYSMOD=IRBNAME1;
    PUT '** ' SYSMOD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SYSMODX;
    END;
  DELETE;
    END;
 *------------  SOURCE CARDS ------------------------------------;
 IF IRBCATG = 48    THEN DO;    *SRCLST RECORD;
    FILE SRCLTRPT HEADER=SRCLTHDR  PRINT;
SRCLTX: IF SRCLST = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC = '3001'X THEN DO;
         INPUT @16 CARD $80. @;
         PUT @PTR  ' SRCLIST-' CARD ;
        PTR=28 ; END;
END;* END OF SRCLST =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    SRCLST=IRBNAME1;
    PUT '** ' SRCLST @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO SRCLTX;
    END;
  DELETE;
    END;
 *------------  LMOD CARDS ------------------------------------;
 IF IRBCATG = 49    THEN DO;    *LMOD RECORD;
    FILE LMODCRPT HEADER=LMODCHDR  PRINT;
LMODCX: IF LMODCD = IRBNAME1 THEN DO;
      INPUT @16 IRBNAM2F $CHAR8. @16 IRBATTRX $CHAR4.
            @16 ATTRB1 PIB1. @;
      FORMAT ATTRX  $HEX8.;
      ATTRX=IRBATTRX;
      CSINAME=IRBNAM2F;
      IF IRBRELAC ^= '3101'X
         THEN DO; DELETE; RETURN; END;
 ELSE IF IRBRELAC = '3101'X THEN DO;
         INPUT @16 CARD $80. @;
         PUT @PTR  ' LMODCARD-' CARD ;
        PTR=28 ; END;
END;* END OF LMODCD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    LMODCD=IRBNAME1;
    PUT '** ' LMODCD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+15;
    GO TO LMODCX;
    END;
  DELETE;
    END;
 *------------  HOLD CARDS ------------------------------------;
 IF IRBCATG = 50    THEN DO;    *HOLD RECORD;
    FILE HOLDRPT HEADER=HOLDHDR  PRINT;
HOLDX: IF HOLD = IRBNAME1 THEN DO;
         INPUT @16 CARD $80. @;
      IF IRBRELAC = '3210'X
         THEN DO;
         PUT @PTR  ' ++HOLD-' CARD ;
        PTR=26 ; END;
 ELSE IF IRBRELAC = '3220'X THEN DO;
         PUT @PTR  ' ++COMMENT-' CARD ;
        PTR=26 ; END;
 ELSE IF IRBRELAC = '3230'X THEN DO;
         PUT @PTR  ' ++FULLGEN-' CARD ;
        PTR=26 ; END;
        ELSE LIST;
END;* END OF HOLD =IRBNAME1;
ELSE DO;
    PUT; PTR=13;
    HOLD=IRBNAME1;
    PUT '** ' HOLD @;
    PUT @PTR ' ZONE-' CCACZIDX @; PTR+13;
    GO TO HOLDX;
    END;
  DELETE;
    END;
 LIST;DELETE;
RETURN;
SMODHDR: PUT ' CDSI -    SYSMOD LISTING FROM ' DSNAME $CHAR44.
  'NOTE: NUMBER WITH PREFIX "<" IS OCCURANCE IN MCS OF SYSMOD.';
         RETURN;
HOLDHDR: PUT ' CDSI -    ++HOLD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
LMODHDR: PUT ' CDSI -    LMOD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
LMODCHDR: PUT ' CDSI -    LMOD CARDS LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
SRCLTHDR: PUT ' CDSI -    SOURCE CARDS LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
MODHDR: PUT ' CDSI -    MOD LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
MACHDR: PUT ' CDSI -    MAC LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
SRCHDR: PUT ' CDSI -    SRC LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DLIBHDR: PUT ' CDSI -    DLIB LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
ZONEHDR: PUT ' CDSI -    ZONE LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DDEFHDR: PUT ' CDSI -    DDDEF LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
DSNHDR: PUT ' CDSI -    DSN LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
PGMHDR: PUT ' CDSI -    PGM LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
FMIDHDR: PUT ' CDSI -   FMID LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
ASMHDR: PUT ' CDSI -    ASM LISTING FROM ' DSNAME $CHAR44.;
         RETURN;
./       ADD   NAME=HOLDPGM
HOLDPGM   CSECT
*         PROGRAM FOUND FROM TECHNICAL SUPPORT VOL 1 NO 8 DEC 87
*         COPIED BY DAVID RIKER
R1        EQU   1
R2        EQU   2
R3        EQU   3
R4        EQU   4
R5        EQU   5
R6        EQU   6
R7        EQU   7
R8        EQU   8
R9        EQU   9
R10       EQU   10
R11       EQU   11
R12       EQU   12
R13       EQU   13
R14       EQU   14
R15       EQU   15
          SAVE  (14,12)
          LR    R12,R15
          USING HOLDPGM,R12
          ST    R13,SAVE+4
          LA    R14,SAVE
          ST    R14,8(R13)
          LR    R13,R14
*---------------------------------------------------------------------
*         PROCESS INPUT PARM
*---------------------------------------------------------------------
          L     R3,0(,R1)           LOAD REG 3 WITH POINTER TO PARM
          LH    R4,0(,R3)           LOAD REG 4 WITH LENGTH OF PARM
          BCTR  R4,0                SUBSTRACT 1 FOR EXEC MVC LENGTH
          B     EXECWTO             BRANCH ARAOUND EXECUTE TARGET
EXECMV1   MVC   WTOPARM+15(0),2(R3) EXECUTE TARGET
EXECWTO   EX    R4,EXECMV1          MOVE PARM TO WTO
WTOPARM   WTO   'PARM=         '    WTO THE TARGET ZONE NAME
          B     EXCPARM             BRANCH AROUND EXECUTIVE ZONE NAME
EXECMV2   MVC   ZONENAME(0),2(R3)   EXECUTE TARGET
EXCPARM   EX    R4,EXECMV2          MOVE ZONE NAME TO KEY
          OPEN  (GLBLCSI,(INPUT),TARGCSI,(INPUT),REPORT,(OUTPUT))
          LTR    R15,R15            TEST FOR GOOD RETURN CODE
          BNZ   ERROR               IF BAD RETURN CODE, ABEND
*---------------------------------------------------------------------
*         FIND THE TARGET ZONE RECORD THAT HAS A HEX NUMBER IN IT THAT
*         IS USED AS PART OF THE KEY TO THAT TARGET ZONE.
*---------------------------------------------------------------------
FINDZONE  GET   RPL=TARGSEQ         GET RECORD
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          BNZ   ERROR               IF BAD RETURN CODE, ABEND
          CLC   TARGETZ,=X'000002'  TEXT IF WE'RE PAST ZONE RECORDS
          BNH   FINDZON2            IF WE ARE TELL US
          WTO   'THERE IS NO TARGET ZONE TO MATCH YOUR INPUT PARM'
          B     STOP2
FINDZON2  CLC   ZONENAME,TARGETS    COMPARE PARM AND ZONE IN RECORD
          BNE   FINDZONE            IF NO MATCH, KEEP LOOKING
          MVC   TARGHEX,TARGETH     MOVE THE ZONE HEX NUMBER TO KEY
*---------------------------------------------------------------------
*         POSITION OURSELVES INTO THE GLOBAL ZONE AT
*         THE FIRST GLOBAL ZONE SYSMOD RECORD.
*---------------------------------------------------------------------
SETUP     POINT RPL=GLBLSEQ         POSITION TO GLOBAL ZONE START
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          BNZ   ERROR               ID BAD RETURN CODE, ABEND
*---------------------------------------------------------------------
*         LOOK  AT EACH GLOBAL ZOME  SYSMODS RECORD TO SEE IF
*         IT IS  A HOLD TYPE SYSMOD .
*---------------------------------------------------------------------
READGLB   GET   RPL=GLBLSEQ         GET RECORD
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          BNZ   ERROR               ID BAD RETURN CODE, ABEND
          CLC   GLOBALK,ZONE26      LAST GLOBAL SYSMOD RECORD?
          BNE   STOP                IF LAST SYSMOD RECORD, END
          CLI   GLOBALF,X'F4'       HOLD TYPE SYSMOD?
          BNE   HOLDERR             IF NOT, KEEP LOOKING
          MVC   REPCSI(4),=CL4'ERR:'
          B     HOLDPUT
HOLDTGT   MVC   REPCSI(4),=CL4'TGT:'
          B     HOLDPUT2
HOLDTGT2  MVC   REPCSI(4),=CL4'TG2:'
HOLDPUT2  ST    R15,REPRC
          MVC   REPLINX(40),GLOBAL
          PUT   REPORT,REPLINE
          B     READGLB
HOLDERR   CLI   GLOBALF,X'F5'       HOLD TYPE SYSMOD?
          BNE   READGLB             IF NOT, KEEP LOOKING
          MVC   REPCSI(4),=CL4'SYS:'
HOLDPUT   MVC   REPLINX(40),GLOBAL
          PUT   REPORT,REPLINE
*---------------------------------------------------------------------
*         ONCE WE HAVE A HOLD TYPE SYSMOD, SEE IF IT APPLIED
*         IN OUR TARGET ZONE.
*---------------------------------------------------------------------
          MVC   TARGSYS,GLOBALP     MOVE HOLD PTF
          GET   RPL=TARGDIR         FIND OUT IF THE HELD PTF IS IN
          LTR   R15,R15             THE TARGET DONE?
          BNZ   HOLDTGT             IF IT'S ON, FALL THRU
          MVC   REPCSI(4),=CL4'TGT'
          MVC   REPLINX(40),TARGET
          PUT   REPORT,REPLINE
*---------------------------------------------------------------------
*         JUST  BECAUSE THE HELD PT F IS APPLIED DOESN'T MEAN IT IS
*         ON IN  ERROR, THE APAR NU MBER THAT THE PTF IS BEING HELD FOR
*         MAY HAVE BEEN VALIDLY SUPERCEDED BY ANOTHER PTF.
*         TO CHECK THIS OUT, SEE IF THE APAR IS ERROR IS APPLIED
*         IN OUT TARGET ZONE. IF IT IS, THEN WE KNOW THAT THE HELD
*         PTF IS IN ERROR.
*---------------------------------------------------------------------
          MVC   TARGSYS,GLOBALE     MOVE ERROR APAR
          GET   RPL=TARGDIR         FIND OUT IF THE ERROR APR IS IN
          LTR   R15,R15             THE TARGET DONE?
          BNZ   HOLDTGT2            IF IT'S ON, FALL THRU
          MVC   REPRTS,GLOBALP      BUILD REPORT ENTRY
          MVC   REPRTS,GLOBALE
          PUT   REPORT,REPRT        WRITE REPORT ENTRY
          AP    COUNT,=P'1'         ADD ONE TO COUNTER
          B     READGLB             KEEP ON PROCESSING
*---------------------------------------------------------------------
STOP      UNPK  WTO+23(8),COUNT     UNPACK COUNT INTO WTO
          OI    WTO+30,B'00110000'  FIX LAST DIGIT SIGN
WTO       WTO   'RECORD COUNT = XXXXXXXX'
          CLOSE (GLBLCSI,,TARGCSI,,REPORT)
STOP2     L     R13,SAVE+4
          RETURN  (14,12),RC=0
*---------------------------------------------------------------------
ERROR     ABEND  16,DUMP            DUMP  WITH USER CODE 16
*
ZONE26    DC    XL3'000026'
*
GLOBAL    DS    0CL142
GLOBALK   DS    CL3
GLOBALP   DS    CL7
          DS    CL2
GLOBALF   DS    CL1
          DS    CL2
GLOBALE   DS    CL7
          DS    CL1
          DS    CL119
*
ZONENAME  DC    CL7' '
*
TARGKEY   DS    CL10
          DC    XL1'00'
TARGHEX   DS    XL1
          DC    XL1'26'
TARGSYS   DS    CL7
*
TARGET    DS    0CL142
TARGETZ   DS    CL3
TARGETE   DS    CL7
          DS    CL5
TARGETS   DS    CL7
          DS    CL1
          DS    CL119
*
          ORG   TARGET
          DS    CL4
TARGETH   DS    XL1
          ORG
*
REPRT     DS    0CL80
          DS    CL2' '
REPRTS    DS    CL7
          DS    CL2' '
REPRTE    DS    CL7
          DC    CL62' '
*
          DS    0H
REPLINE   DS    0CL80
          DS    CL2' '
REPRC     DS    CL4' '
REPCSI    DS    CL4
          DS    CL1':'
REPLINX   DS    CL40
          DC    CL29' '
*
SAVE      DS    18F'0'
COUNT     DC    PL8'0'
*
GLBLCSI   ACB   AM=VSAM,MACRF=(KEY,SEQ,DIR,IN),STRNO=1,BUFNI=4,        *
               BUFND=11,DDNAME=GLBLCSI,EXLST=CSIEXIT
*
TARGCSI   ACB   AM=VSAM,MACRF=(KEY,SEQ,DIR,IN),STRNO=1,BUFNI=4, *      *
               BUFND=2,DDNAME=TARGCSI,EXLST=CSIEXIT
*
GLBLSEQ   RPL   ACB=GLBLCSI,AM=VSAM,OPTCD=(KEY,SEQ,KEQ,GEN,MVE), *     *
               KEYLEN=3,ARG=ZONE26,AREA=GLOBAL,AREALEN=142
*
TARGDIR   RPL   ACB=TARGCSI,AM=VSAM,OPTCD=(KEY,DIR,MVE,GEN,KEQ), *     *
               KEYLEN=10,ARG=TARGKEY,AREA=TARGET,AREALEN=142
*
TARGSEQ   RPL   ACB=TARGCSI,AM=VSAM,OPTCD=(KEY,SEQ,MVE), *             *
               AREA=TARGET,AREALEN=142
*
CSIEXIT   EXLST AM=VSAM,EODAD=STOP
*
REPORT    DCB   DDNAME=REPORT,DSORG=PS,RECFM=FB,LRECL=80,MACRF=PM
*
          END   HOLDPGM
./       ADD   NAME=HOLDPGM2
HOLDPGM   CSECT
*         PROGRAM FOUND FROM TECHNICAL SUPPORT VOL 1 NO 8 DEC 87
*         COPIED BY DAVID RIKER
*         MODIFY TO SHOW VSAM FEEDBACK CODES
R1        EQU   1
R2        EQU   2
R3        EQU   3
R4        EQU   4
R5        EQU   5
R6        EQU   6
R7        EQU   7
R8        EQU   8
R9        EQU   9
R10       EQU   10
R11       EQU   11
R12       EQU   12
R13       EQU   13
R14       EQU   14
R15       EQU   15
          SAVE  (14,12)
          LR    R12,R15
          USING HOLDPGM,R12
          ST    R13,SAVE+4
          LA    R14,SAVE
          ST    R14,8(R13)
          LR    R13,R14
*---------------------------------------------------------------------
*         PROCESS INPUT PARM
*---------------------------------------------------------------------
          L     R3,0(,R1)           LOAD REG 3 WITH POINTER TO PARM
          LH    R4,0(,R3)           LOAD REG 4 WITH LENGTH OF PARM
          BCTR  R4,0                SUBSTRACT 1 FOR EXEC MVC LENGTH
          B     EXECWTO             BRANCH ARAOUND EXECUTE TARGET
EXECMV1   MVC   WTOPARM+15(0),2(R3) EXECUTE TARGET
EXECWTO   EX    R4,EXECMV1          MOVE PARM TO WTO
WTOPARM   WTO   'PARM=         '    WTO THE TARGET ZONE NAME
          B     EXCPARM             BRANCH AROUND EXECUTIVE ZONE NAME
EXECMV2   MVC   ZONENAME(0),2(R3)   EXECUTE TARGET
EXCPARM   EX    R4,EXECMV2          MOVE ZONE NAME TO KEY
          OPEN  (GLBLCSI,(INPUT),TARGCSI,(INPUT),REPORT,(OUTPUT))
          LTR    R15,R15            TEST FOR GOOD RETURN CODE
          LA     R5,4
          BNZ   ERRORX              IF BAD RETURN CODE, ABEND
*---------------------------------------------------------------------
*         FIND THE TARGET ZONE RECORD THAT HAS A HEX NUMBER IN IT THAT
*         IS USED AS PART OF THE KEY TO THAT TARGET ZONE.
*---------------------------------------------------------------------
FINDZONE  GET   RPL=TARGSEQ         GET RECORD
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          LA     R5,5
          BNZ   ERRORX              IF BAD RETURN CODE, ABEND
          CLC   TARGETZ,=X'000002'  TEXT IF WE'RE PAST ZONE RECORDS
          BNH   FINDZON2            IF WE ARE TELL US
          WTO   'THERE IS NO TARGET ZONE TO MATCH YOUR INPUT PARM'
          B     STOP2
FINDZON2  CLC   ZONENAME,TARGETS    COMPARE PARM AND ZONE IN RECORD
          BNE   FINDZONE            IF NO MATCH, KEEP LOOKING
          MVC   TARGHEX,TARGETH     MOVE THE ZONE HEX NUMBER TO KEY
*---------------------------------------------------------------------
*         POSITION OURSELVES INTO THE GLOBAL ZONE AT
*         THE FIRST GLOBAL ZONE SYSMOD RECORD.
*---------------------------------------------------------------------
SETUP     POINT RPL=GLBLSEQ         POSITION TO GLOBAL ZONE START
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          LA     R5,6
          BNZ   ERRORX              ID BAD RETURN CODE, ABEND
*---------------------------------------------------------------------
*         LOOK  AT EACH GLOBAL ZOME  SYSMODS RECORD TO SEE IF
*         IT IS  A HOLD TYPE SYSMOD .
*---------------------------------------------------------------------
READGLB   GET   RPL=GLBLSEQ         GET RECORD
          LTR   R15,R15             TEST FOR GOOD RETURN CODE
          LA     R5,7
          BNZ   ERRORX              ID BAD RETURN CODE, ABEND
          CLC   GLOBALK,ZONE26      LAST GLOBAL SYSMOD RECORD?
          BNE   STOP                IF LAST SYSMOD RECORD, END
          CLI   GLOBALF,X'F4'       HOLD TYPE SYSMOD?
          BNE   READGLB             IF NOT, KEEP LOOKING
          MVC   REPCSI(4),=CL4'ERR:'
HOLDPUT   MVC   REPLINX(40),GLOBAL
          PUT   REPORT,REPLINE
*---------------------------------------------------------------------
*         ONCE WE HAVE A HOLD TYPE SYSMOD, SEE IF IT APPLIED
*         IN OUR TARGET ZONE.
*---------------------------------------------------------------------
          MVC   TARGSYS,GLOBALP     MOVE HOLD PTF
          GET   RPL=TARGDIR         FIND OUT IF THE HELD PTF IS IN
          LTR   R15,R15             THE TARGET DONE?
          BZ    OKTGT               IF IT'S ON, FALL THRU
          CHECK RPL=TARGDIR    WAIT FOR VSAM PROCESSING ENDING
          LTR   R15,R15
          BNZ   GETERR
OKTGT     MVC   REPCSI(4),=CL4'TGT'
          ST     R15,REPRC
          MVC   REPLINX(40),TARGET
          PUT   REPORT,REPLINE
*---------------------------------------------------------------------
*         JUST  BECAUSE THE HELD PT F IS APPLIED DOESN'T MEAN IT IS
*         ON IN  ERROR, THE APAR NU MBER THAT THE PTF IS BEING HELD FOR
*         MAY HAVE BEEN VALIDLY SUPERCEDED BY ANOTHER PTF.
*         TO CHECK THIS OUT, SEE IF THE APAR IS ERROR IS APPLIED
*         IN OUT TARGET ZONE. IF IT IS, THEN WE KNOW THAT THE HELD
*         PTF IS IN ERROR.
*---------------------------------------------------------------------
          MVC   TARGSYS,GLOBALE     MOVE ERROR APAR
          GET   RPL=TARGDIR         FIND OUT IF THE ERROR APR IS IN
          LTR   R15,R15             THE TARGET DONE?
          BNZ   OKTGT2              IF IT'S ON, FALL THRU
          CHECK RPL=TARGDIR    WAIT FOR VSAM PROCESSING ENDING
          LTR   R15,R15
          BNZ   GETERR2
OKTGT2    MVC   REPRTS,GLOBALP      BUILD REPORT ENTRY
          MVC   REPRTS,GLOBALE
          PUT   REPORT,REPRT        WRITE REPORT ENTRY
          AP    COUNT,=P'1'         ADD ONE TO COUNTER
          B     READGLB             KEEP ON PROCESSING
*---------------------------------------------------------------------
STOP      UNPK  WTO+23(8),COUNT     UNPACK COUNT INTO WTO
          OI    WTO+30,B'00110000'  FIX LAST DIGIT SIGN
WTO       WTO   'RECORD COUNT = XXXXXXXX'
          CLOSE (GLBLCSI,,TARGCSI,,REPORT)
STOP2     L     R13,SAVE+4
          RETURN  (14,12),RC=0
*---------------------------------------------------------------------
ERRORX    ABEND  (5),DUMP            DUMP  WITH USER CODE 16
*
GETERR   SHOWCB RPL=TARGDIR,LENGTH=4,AREA=ERROR,FIELDS=(FDBK)
         MVC   TYPERR,=CL26' GET FAILED,   FEEDBACK='
         BAL   R8,WRITERR
         B     OKTGT
GETERR2  SHOWCB RPL=TARGDIR,LENGTH=4,AREA=ERROR,FIELDS=(FDBK)
         MVC   TYPERR,=CL26' GET FAILED, 2 FEEDBACK='
         BAL   R8,WRITERR
         B     OKTGT2
WRITERR  EQU   *
         ST    R8,WRTSAVE
         L     R1,ERROR
         C     R1,F16
         LA     R5,16
         BE    ERRORX
         SR    R1,R1
         IC    R1,ERROR+1 RETURN CODE
         CVD   R1,CVDAREA
         MVC   ERRMSG(4),=X'40202120'
         ED    ERRMSG(4),CVDAREA+6
         SR    R1,R1
         IC    R1,ERROR+2
         CVD   R1,CVDAREA
         MVC   ERRMSG+4(4),=X'40202120'
         ED    ERRMSG+4(4),CVDAREA+6
         SR    R1,R1
         IC    R1,ERROR+3
         CVD   R1,CVDAREA
         MVC   ERRMSG+8(4),=X'40202120'
         ED    ERRMSG+8(4),CVDAREA+6
         PUT   REPORT,PROCMSG
         L     R15,ERROR
         L     R8,WRTSAVE
         BR    R8
         DS    0F
CVDAREA  DS    D
ERROR    DS    F
WRTSAVE  DS    F
F16      DC    F'16'
ZONE26    DC    XL3'000026'
*
GLOBAL    DS    0CL142
GLOBALK   DS    CL3
GLOBALP   DS    CL7
          DS    CL2
GLOBALF   DS    CL1
          DS    CL2
GLOBALE   DS    CL7
          DS    CL1
          DS    CL119
*
ZONENAME  DC    CL7' '
*
TARGKEY   DS    CL10
          DC    XL1'00'
TARGHEX   DS    XL1
          DC    XL1'26'
TARGSYS   DS    CL7
*
TARGET    DS    0CL142
TARGETZ   DS    CL3
TARGETE   DS    CL7
          DS    CL5
TARGETS   DS    CL7
          DS    CL1
          DS    CL119
*
          ORG   TARGET
          DS    CL4
TARGETH   DS    XL1
          ORG
*
REPRT     DS    0CL80
          DS    CL2' '
REPRTS    DS    CL7
          DS    CL2' '
REPRTE    DS    CL7
          DC    CL62' '
*
          DS    0H
REPLINE   DS    0CL80
          DS    CL2' '
REPRC     DS    CL4' '
REPCSI    DS    CL4
          DS    CL1':'
REPLINX   DS    CL40
          DC    CL29' '
*
*        VSAM MESSAGE
PROCMSG  DS    0CL80
TYPERR   DC    CL26' OPEN ERROR RETURN CODE ='
ERRMSG   DS    CL4' '
         DC    CL50' '
*
SAVE      DS    18F'0'
COUNT     DC    PL8'0'
*
GLBLCSI   ACB   AM=VSAM,MACRF=(KEY,SEQ,DIR,IN),STRNO=1,BUFNI=4,        *
               BUFND=11,DDNAME=GLBLCSI,EXLST=CSIEXIT
*
TARGCSI   ACB   AM=VSAM,MACRF=(KEY,SEQ,DIR,IN),STRNO=1,BUFNI=4, *      *
               BUFND=2,DDNAME=TARGCSI,EXLST=CSIEXIT
*
GLBLSEQ   RPL   ACB=GLBLCSI,AM=VSAM,OPTCD=(KEY,SEQ,KEQ,GEN,MVE), *     *
               KEYLEN=3,ARG=ZONE26,AREA=GLOBAL,AREALEN=142
*
TARGDIR   RPL   ACB=TARGCSI,AM=VSAM,OPTCD=(KEY,DIR,MVE,GEN,KEQ), *     *
               KEYLEN=10,ARG=TARGKEY,AREA=TARGET,AREALEN=142
*
TARGSEQ   RPL   ACB=TARGCSI,AM=VSAM,OPTCD=(KEY,SEQ,MVE), *             *
               AREA=TARGET,AREALEN=142
*
CSIEXIT   EXLST AM=VSAM,EODAD=STOP
*
REPORT    DCB   DDNAME=REPORT,DSORG=PS,RECFM=FB,LRECL=80,MACRF=PM
*
          END   HOLDPGM
./       ADD   NAME=JCLCSI
//DORSCSIL JOB (6000A,004,,9999),'NCP GLOBAL CSI',
//         CLASS=A,MSGCLASS=Z,NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//JOBCAT  DD DSN=CATALOG.NCPVSM1.VVTAM01,DISP=SHR   NCP
//         DD DSN=CATALOG.MVSICF1.VPPVOL4,DISP=SHR   MVS
//         DD DSN=CATALOG.MVSICF1.VPPVOL2,DISP=SHR   MVS
//*
//*  SAS PROGRAM TO READ VSAM CSI LIBRARY AND PRINT IN SUMMARY
//*-------------------------------------------------------------
//* ORIGIN:   DAVE RIKER, COMPUTER DATA SYSTEMS, INC
//*                     ONE CURIE COURT, ROCKVILLE, MD 20850
//*-------------------------------------------------------------
//CSI EXEC SAS,REGION=500K,TIME=500
//SMPCSI     DD  DSN=M3083P.TGT.CSI,DISP=SHR
//*NCPGLOB   DD  DSN=NCPD21DS.GLOBAL.CSI,DISP=SHR
//*NCPTGT    DD  DSN=N210TTA.CSI,DISP=SHR
//*NCPDLIB   DD  DSN=N210DTA.CSI,DISP=SHR
//*MVSTGT    DD  DSN=M3083P.TGT.CSI,DISP=SHR
//*          DD  DSN=M4341P.TGT.CSI,DISP=SHR
//*          DD  DSN=M3083M.TGT.CSI,DISP=SHR
//*          DD  DSN=M4341M.TGT.CSI,DISP=SHR
//*MVSDLIB   DD  DSN=D30831.DLIB.CSI,DISP=SHR
//*          DD  DSN=D43411.DLIB.CSI,DISP=SHR
//*MVSGLOB   DD  DSN=PPVOL4E.GLOBAL.CSI,DISP=SHR
//LISTPRT  DD  SYSOUT=(Y,,DS06)
//ZONERPT  DD  SYSOUT=(Y,,DS06)
//DDEFRPT  DD  SYSOUT=(Y,,DS06)
//DSNRPT   DD  SYSOUT=(Y,,DS06)
//PGMRPT   DD  SYSOUT=(Y,,DS06)
//FMIDRPT  DD  SYSOUT=(Y,,DS06)
//ASMRPT   DD  SYSOUT=(Y,,DS06)
//SYSMOD   DD  SYSOUT=(Y,,DS06)
//LMODRPT  DD  SYSOUT=(Y,,DS06)
//MACRPT   DD  SYSOUT=(Y,,DS06)
//MODRPT   DD  SYSOUT=(Y,,DS06)
//SRCRPT   DD  SYSOUT=(Y,,DS06)
//DLIBRPT  DD  SYSOUT=(Y,,DS06)
//SRCLTRPT DD  SYSOUT=(Y,,DS06)
//LMODCRPT DD  SYSOUT=(Y,,DS06)
//HOLDRPT  DD  SYSOUT=(Y,,DS06)
//SYSIN DD  DSN=C6000A.DOR.PTFSRCT2(CSISASRY),DISP=SHR
./       ADD   NAME=JCLHOLD
//DORCSIH  JOB  (6000A,4,,9999),'LIST HOLD PTF',CLASS=A,MSGCLASS=A,
//     NOTIFY= DOR
/*ROUTE PRINT R55
//JOBCAT  DD DSN=CATALOG.DSDICF1.V8DBP04,DISP=SHR   NCP
//* ZONE=NCPDLIB
//HOLDPGM  EXEC PGM=HOLDPGM2,PARM='NCPTGT'
//STEPLIB  DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR
//GLBLCSI   DD  DSN=NCPD21DS.GLOBAL.CSI,DISP=SHR
//TARGCSI   DD  DSN=N210TTA.TGT.CSI,DISP=SHR
//*TARGCSI  DD  DSN=N210DTA.DLIB.CSI,DISP=SHR
//REPORT   DD SYSOUT=Y,DCB=BLKSIZE=80
//SYSUDUMP DD SYSOUT=Y
//SYSOUT   DD SYSOUT=Y
//SYSTRACE DD SYSOUT=Y
./       ADD   NAME=MVSFIND
//DORFMVS  JOB (6000A,4,,9999),'MVS FINDFIX',CLASS=A,MSGCLASS=Y,
//   NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*--------MVS FMIDS ---------------------------------------------
//*--- FMID=(EAS1102,EBB1102,EBT1102,EDE1102,EER3100,EGA1102,EGS1102)
//*--- FMID=(EMF1102,EMI1102,EML1102,EMS1102,ESU1102,ESY1400,ETC0108)
//*--- FMID=(ETI1106,EXW1102,FBB1221,FDZ1810,HAE1500,HAH2100,HDQ1102)
//*--- FMID=(HDV1102,HFL1300,HFT1300,HFX1102,HIF1102,HIP2329,HJE2330)
//*--- FMID=(HMP1200,HOP1102,HRM2406,HVT2102,JBB1113,JBB1114)
//*--- FMID=(JBB1326,JBB1329,JBT1112,JFL1311,JFL1312,JFT1311,JFT1312)
//*---------------------------------------------------------------
//FINDFIX EXEC PGM=FINDFIX8,PARM='LC=56',REGION=1000K
//STEPCAT  DD DSN=CATALOG.DSDICF1.V8DBV01,DISP=SHR   MVS
//STEPLIB DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR,UNIT=3350
//SYSUDUMP DD SYSOUT=*
//SYSPRINT DD SYSOUT=(Y,,DS02),DCB=(RECFM=FBA,LRECL=121,BLKSIZE=1210)
//SMPCSI   DD  DSN=PPVOL4E.GLOBAL.CSI,DISP=SHR
//CSITGT   DD  DSN=M3083M.TGT.CSI,DISP=SHR
//SMPCNTL  DD DUMMY,DCB=(LRECL=80,BLKSIZE=9440,RECFM=FB),
//        DSN=SYS3.CDSI.CBSELPTF(R8607HD2),DISP=SHR
//*  SUPERCEDED/SYSMODS WERE FOUND FROM SMPE APPLY CHECK REPORT
//*  WITH PREFIXED  FLAGS OF ^, *, OR #. PUT THEM IN CONTROL.
//CONTROL  DD *
ZONE=M3083M
MAXDATE=86/07/09
FMID=JBB1326
UZDUMMY
/*
//*   SYSIN MUST BE ACCEPTED/SUPERCEDED SYSMODS  FROM TARGET ZONE
//* BE SURE TO INCLUDE SREL=Z038 ON TOP OF THE DATA
//*SYSIN    DD DSN=C6000A.DOR.SYSMOD.DATA,DISP=SHR
//*    DO NOT PUT ALL SYSMODS IN SYSIN... FINDFIX WILL PUT ALL
//*      APPLIED/ACCEPTED SYSMODS FROM GLOBAL CSI, UNLESS YOU RERUN
//*      WITH RECEIVED/INSTALLED SYSMODS.
//SYSIN DD *
SREL=Z038
//* INFOIN/INFOUT SYSMODS MUST BE SELECTED BY FMID FROM PUT TAPES OR
//*  PTF TAPES (PTFSORT/PTFMAST/PTFUTIL) IN ORDER TO ASSURE THE
//*  SUCESSFUL FINDFIX PROCESSING. IT IS WISE TO PUT FINDFIX IN
//*  SHORT RUN TIME WITH PROPER FMID SELECTIONS FOR YOUR SYSTEMS
//*  UNDER SMPE.
//INFOIN DD DSN=SYS3.SMPE.MVS.INFOIN,DISP=SHR,
//   DCB=(LRECL=8,BLKSIZE=9440,RECFM=FB)
./       ADD   NAME=NCPFIND
//DORFNCP  JOB (6000A,4,,9999),'NCP FINDFIX',
//      CLASS=A,MSGCLASS=Z,NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//JOBCAT  DD DSN=CATALOG.NCPVSM1.VVTAM01,DISP=SHR   NCP
//FINDFIX EXEC PGM=FINDFIX8,PARM='LC=56',REGION=1000K
//STEPLIB DD DSN=C6000A.DOR.LINKLIB2,DISP=SHR,UNIT=3350
//SYSUDUMP DD SYSOUT=(Y,,DS06)
//*SYSTRACE DD SYSOUT=M
//SYSABEND DD SYSOUT=(Y,,DS06)
//ABNLIGNR DD SYSOUT=*
//ABNLDUMP DD SYSOUT=*
//ABNLHELP DD SYSOUT=*
//SYSPRINT DD  SYSOUT=(Y,,DS02)
//*SYSPRINT DD  DUMMY,DCB=(RECFM=FBM,LRECL=121,BLKSIZE=6171),
//*      DSN=SYS3.CDSI.RETAIN.NCP(M8606),DISP=SHR
//SMPCSI   DD  DSN=NCPD21DS.GLOBAL.CSI,DISP=SHR
//CSITGT   DD  DSN=N210DTA.CSI,DISP=SHR
//*                      NO SMPE HAVE SMPCDS/ PUT ALL ACCEPT/SUPERCEDED
//*                      SYSMODS IN SYSIN USING DOR.PTFLIN(JCLSELTG)
//*                      TO GENERATE OUTPUT  INTO THIS SYSIN
//SMPCNTL  DD DUMMY,DCB=(LRECL=80,BLKSIZE=9440,RECFM=FB),DISP=SHR,
//        DSN=SYS3.CDSI.CBSELPTF(SNCP8606)
//CONTROL  DD *
ZONE=N210DTA
MAXDATE=86/06/01
FMID=EEP0300
FMID=HNC2100
FMID=HNT1200
FMID=HSP2105
URDUMMY
/*
//*   SYSIN MUST BE ACCEPTED/SUPERCEDED SYSMODS  FROM TARGET ZONE
//* BE SURE TO INCLUDE SREL=P004 ON TOP OF THE DATA
//*SYSIN    DD DSN=C6000A.DOR.SYSMOD.DATA,DISP=SHR
//SYSIN DD *
SREL=P004
//INFOIN DD DSN=SYS3.SMPE.NCP.INFOIN,DISP=SHR,
//   DCB=(LRECL=8,BLKSIZE=9440,RECFM=FB)
./       ADD   NAME=OLDENV
         TITLE   'PTFENV - FINDFIX ROUTINE '
         PRINT GEN
PTFENV   CSECT
         ENTRY EODSYSIN
         ENTRY EODCNTL
         USING  *,R11
ENV      B     @PROLONG-*(15)
         DC    AL1(11),CL11'PTFENV'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         LR    R15,R13
         LA    R13,72(R13)
         ST    R13,8(R15)                  FORWARD POINTER
         ST    R15,4(R13)                  BACKWARD POINTER
         USING PARMPTR,R10
         LA    R2,2048(R11)
         USING ENV+4096,R2
         LA    R2,2048(R2)
         BAL   R12,GETTABLE                PERFORM
         CLI   MODFLAG,X'00'
         BNE   EXIT
         CLI   PTR40,X'FF'
         BE    NOCSIRUN
         BAL   R12,CSMPECSI               TGT/DLIB APPLIED SYSMODS
NOCSIRUN CLI   MODFLAG,X'00'
         BNE   EXIT
         BAL   R12,CALLCDS                 PERFORM
         CLI   PTR40,X'FF'
         BE    EXIT
         BAL   R12,CSMPEGLB                GLOBAL RECEIVED SYSMODS
EXIT     EQU   *
         L     R13,4(R13)
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
ENDREC   EQU   *
         MVI   PTR40,X'FF'
         B     PUTREC
ENDREC2  EQU   *
         MVI   PTR39A,X'FF'
         B     PUTREC
PRINTMSG EQU   *
         PUT   SYSPRINT,PRTLINE
         MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
         BR    R3
GETTABLE EQU   *
         L     R9,TABLEBEG
         ST    R9,IOBUFFER
         LA    R9,264(R9)
         ST    R9,HOLDTABS
         ST    R9,HOLDTABE
         A     R9,=F'48000'
         SLR   R4,R4
         LA    R5,CONTROL
         MVC   POS2(18),CNTLBEG
         BAL   R3,PRINTMSG
         MVC   POS17(5),SBLANKS
         TM    CNTL2,X'10'
         BNO   MFLAG0C
PUTREC   EQU   *
         LR    R1,R5
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
         MVC   POS2(80),RECORD
         PUT   SYSPRINT,PRTLINE
         CLI   RECORD,C' '
         BE    PUTREC
         CLC   RECORD(5),ZONE
         BE    ZONEREC
         CLC   RECORD(7),INFORUN
         BE    ENDREC
         CLC   RECORD(4),DUMPMSG
         BE    ENDREC2
         CLC   RECORD(5),FMID
         BE    FMIDREC
         CLC   RECORD(8),MAXDATEM
         BE    CONTSYM
         L     R3,CNTLSMOD
         LTR   R3,R3
         BNZ   CKMFLAG
         ST    R9,CNTLSMOD
         ST    R4,0(R9)
SAVESMOD EQU   *
         MVC   4(7,R9),RECORD
         LA    R9,12(R9)
         ST    R4,0(R9)
         B     PUTREC
CKMFLAG  EQU   *
         CLC   0(4,R3),NULLADDR
         BE    SAVTADDR
         L     R3,0(R3)
         B     CKMFLAG
SAVTADDR EQU   *
         ST    R9,0(R3)
         B     SAVESMOD
MFLAG0C  EQU   *
         MVI   MODFLAG,X'0C'
         BR    R12
CONTSYM  EQU   *
         CLI   PTR50,X'61'
         BNE   ERRORMAX
         MVC   MAXDATE(8),PTR49
         B     PUTREC
ZONEREC  EQU   *
         MVC   ZONEDATA(8),RECORD+5
         B     PUTREC
ERRORMAX EQU   *
         MVC   POS2(15),ERMAXDT
         BAL   R3,PRINTMSG
         MVC   POS2(16),SBLANKS
         B     PUTREC
FMIDREC  L     R3,FMIDREQ
         LTR   R3,R3
         BNZ   FMIDREC2
         ST    R9,FMIDREQ
         ST    R4,0(,R9)
FMIDREC3 MVC   4(7,R9),PTR48
         XC    11(9,R9),11(R9)
         LA    R9,20(R9)
         ST    R4,0(,R9)
         B     PUTREC
FMIDREC2 CLC   0(4,R3),NULLADDR
         BE    FMIDREC4
         L     R3,0(,R3)
         B     FMIDREC2
FMIDREC4 ST    R9,0(,R3)
         B     FMIDREC3
EODCNTL  TM    PTR40,X'FF'
         BO    EODCNTL2
         CLC   CNTLSMOD(4),NULLADDR
         BE    MFLAG0C
EODCNTL2 MVC   POS2(16),CNTLEND
         BAL   R3,PRINTMSG
         TM    SMFCDSX,X'10'
         BCR   14,R12
         MVC   POS2(17),CDSSTRT
         BAL   R3,PRINTMSG
         MVC   POS5(16),SBLANKS
         L     R5,IOBUFFER
         LA    R6,SMPCDS1
READCDS  BAL   R1,READCDSX                 PARM SET BRCH
READCDS1 EQU   *
         DC    F'0'                  +0
         DC    X'00800000',F'0'      +4
         DC    F'0'                  +8 DCB ADDR
         DC    F'0'                 +12 TABLE PTR
READCDSX ST    R6,8(R1)
         ST    R5,12(R1)
         L     R15,8(R1)
         L     R15,48(,R15)
         BALR  R14,R15                     STD LINKAGE
         LA    R1,READCDS1
         L     R14,8(,R1)
         L     R15,52(,R14)
         BALR  R14,R15                     STD LINKAGE
         TM    PATCH,X'80'
         BO    PASSTWO
         OI    PATCH,X'80'
         LA    R1,600
         CLI   10(R5),X'00'
         BNE   PTRABEND
         MVC   CDSDATA,10(R5)
         B     NEXTCDS
PASSTWO  OI    PATCH,X'40'
         CLI   0(R5),X'FF'
         BE    CDSOFF
NEXTCDS  LA R8,10(,R5)
FINDPTF  CLI   0(R8),C'3' SYSMOD CODE OF SMP4 CDS
*                         OTHER CODES IGNORED (A=ASSEM,P=DLIB,D=LMOD,
*                          G=MAC,J=MOD,M=SRC, ETC)
         BE    PTFSYM
         BH    CONVERT       X'FF'=END OF MEMBER...BEGIN TO UNPACK
         SR    R3,R3
         IC    R3,11(R8)
         N     R3,F31
         SLL   R3,1
         LA    R8,12(R3,R8)
         LA    R7,8(,R5)
         LH    R3,8(,R5)
         LA    R7,0(R3,R7)
         CLR   R8,R7              END OF BUFFER?
         BL    FINDPTF            NO
         B     READCDS            YES
CDSOFF   OI    PATCH,X'20'
         B     NEXTCDS
CHKCDS   TM    17(R8),X'80'
         BO    SETUPCDS
         B     SETU2CDS
SMODOK   MVI   7(R9),X'00'
         TM    14(R8),X'A0'
         BZ    CHKCDS
         OC    7(1,R9),14(R8)
SETUPCDS MVC   0(7,R9),0(R8)      MOVE PACKED MEMBER TO STORAGE
SETU2CDS LA    R9,8(R9)
         SR    R3,R3
         IC    R3,11(R8)
         N     R3,F31
         SLL   R3,1
         LA    R8,12(R3,R8)
         LA    R3,8(R9)           NEXT POINTER
         L     R4,TABLEND         END OF TABLE
         CLR   R3,R4
         BNL   GETEXIT            NOT ENOUGH STORAGE
         LA    R7,8(,R5)
         LH    R3,8(,R5)
         LA    R7,0(R3,R7)
         CLR   R8,R7
         BL    FINDPTF
         B     READCDS
PTFSYM   TM    PATCH,X'08'
         BO    SMODOK
         ST    R9,CDSTABS
         OI    PATCH,X'08'
         B     SMODOK
GETEXIT  MVI   MODFLAG,X'0B'
         BR    R12
CONVERT  ST    R9,CDSTABE
         LA    R9,0(R9)
         L     R8,CDSTABS
         LA    R8,0(R8)
NXTUNPK  CLR   R8,R9
         BNLR  R12
         L     R7,0(R8)
         SLL   R7,8
         BAL   R3,UNPACK                   PERFORM
         LA    R8,4(R8)
         L     R7,0(R8)
         BAL   R3,UNPACK2                  PERFORM
         LA    R8,4(R8)
         B     NXTUNPK
UNPACK   LA    R5,4
         LR    R4,R8
UNPKLOOP SR    R6,R6
         SLDL  R6,6               BREAK MEMBER INTO SIX BITS
         STC   R6,0(R4)
         LA    R4,1(R4)
         BCT   R5,UNPKLOOP
         TR    0(4,R8),CDSKEYTB
         BR    R3
UNPACK2  LA    R5,3
         LR    R4,R8
UNPKLOP2 SR    R6,R6
         SLDL  R6,6
         STC   R6,0(R4)
         LA    R4,1(R4)
         BCT   R5,UNPKLOP2
         TR    0(3,R8),CDSKEYTB
         BR    R3
CALLCDS  EQU   *
         ST    R9,ENDTBADR
         TM    SMPCDSY,X'10'
         BNO   NOPNCDS
         TM    SMFCDSX,X'10'
         BNO   NOPNCDS
         MVC   CDSNAME(3),BLANKOUT
         LA    R1,SMPCDS2
         LA    R0,CDSNAME
         L     R15,84(,R1)
         BAL   R14,4(R15)                  PERFORM
         L     R8,ENDTBADR
         LA    R7,SMPCDS2
         BAL   R1,READ2CDS                 PARM SET BRCH
READ2CDX EQU   *
         DC    F'0'                  +0
         DC    X'00800000',F'0'      +4
         DC    F'0'                  +8 DCB ADDR
         DC    F'0'                 +12 TABLE PTR
READ2CDS ST    R7,8(R1)
         ST    R8,12(R1)
         L     R15,8(R1)
         L     R15,48(,R15)
         BALR  R14,R15                     STD LINKAGE
         LA    R1,READ2CDX
         L     R14,8(,R1)
         L     R15,52(,R14)
         BALR  R14,R15                     STD LINKAGE
         MVC   CDSISREL(4),8(R8)
         MVC   POS2(15),CDSEND
         BAL   R3,PRINTMSG
NOPNCDS  TM    SYSIN2,X'10'
         BCR   14,R12
         MVC   POS2(16),SYSSTRT
         BAL   R3,PRINTMSG
         LA    R7,SYSIN
NXTSYSIN EQU   *
         LR    R1,R7
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
         MVC   POS2(80),RECORD
         PUT   SYSPRINT,PRTLINE
         LA    R6,10
         LA    R5,RECORD
         CLC   RECORD(9),NOCOL
         BE    NOTCOL
         CLC   RECORD(5),SREL
         BNE   NOTSREL
         MVC   SYSISREL(4),PTR48
         B     NXTSYSIN
NOTCOL   MVI   COLLECT,X'FF'
         B     NXTSYSIN
NOTSREL  CLI   0(R5),C' '
         BE    NXTSYSIN
         L     R4,ENDTBADR
         L     R3,INFOSREL
         LTR   R3,R3
         BNZ   NINFOTAB
         ST    R4,INFOSREL
MVCSYSIN MVC   0(4,R4),NULLADDR
         MVC   4(7,R4),0(R5)
         MVI   11(R4),X'A0'
         LA    R4,12(R4)
         ST    R4,ENDTBADR
         LA    R5,8(R5)
         BCT   R6,NOTSREL
         B     NXTSYSIN
NINFOTAB CLC   0(4,R3),NULLADDR
         BE    ENDINFTB
         L     R3,0(R3)
         B     NINFOTAB
ENDINFTB ST    R4,0(R3)
         B     MVCSYSIN
EODSYSIN MVC   POS2(16),SYSEND
         BAL   R3,PRINTMSG
         BR    R12
         DS    0F
CSMPECSI EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        TO REPLACE SMP/E CSI FOR SMP4 CDS
*        READ VSAM CSI TARGET OR DLIB DSN (DO NOT USE GLOBAL)
*        SELECT  PTF NAME AND ITS SUPERCEDED SYSMODS
*        STORE INTO CDSTABLE.
*
         ST   R12,CSMPER12
*        MODCB  RPL=RPLCSI,ARG=BYTE0,KEYLEN=1,
*               OPTCD=(LOC,GEN,KGE)
         CALL  PTFVSAM,MSDRPL8,VL    MODIFY RPL WITH 1 BYTE KEY SEQ
         CALL  PTFVSAM,FCALLCSI,VL    OPEN AND GET VSAM RECORD
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         MVC   POS2(17),CSISTAR
         BAL   R3,PRINTMSG
         ST    R9,CDSTABS
*        ST    R9,SMODMISS
GETLOOP  CALL  PTFVSAM,FGETCSI,VL     GET NEXT VSAM RECORD
GETSEQ   CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         LA    R1,CSIKEY2
         USING CSIRECD,R1
         CLI   IRBCATG,X'02'         ZONE INDEX
         BE    ZONEIX
         CLC   ZONEINDX(2),=XL2'FFFF'
         BE    CHKLOOP               GO ON UNTIL ZONEIINDEX IS MATCHED
         CLC   ZONEINDX(2),CCACZID   CSI RECORD EQUALS ZONE INDEX
         BNE   GETLOOP               GO ON UNTIL ZONEIINDEX IS MATCHED
         CLI   IRBCATG,X'10'         ZONE FOR SREL
         BE    ZONEHIT
         CLI   IRBCATG,X'26'
         BH    ENVEODYD    IGNORE SRC LISTING (30) LOADMOD (31)
*                             ++HOLD CARDS (32)
         BNE   GETLOOP
         CLC   SMODNME(8),IRBNAME1
         BE    NAMEOK
         BH    ENVEODYD     PROBABLY MORE THAN ONE ZONE IN CSI DSN
NEWSMOD  MVC   SMODNME(8),IRBNAME1
         B     GETLOOP
CHKLOOP  EQU   *
         CLI   IRBCATG,X'02'
         BNH   GETLOOP
         ABEND 920,DUMP    ZONE NAME DID NOT BELONG TO CSITGT
ZONEIX   EQU   *
         CLC   IRBNAM2F(8),ZONEDATA
         BNE   GETLOOP
         MVC   ZONEINDX(4),IRBNAME1 ZONE INDEX ASSOCIATED TO ZNAME
         MVC   BYTE0(2),ZONEINDX
         CALL  PTFVSAM,MSDRPL10,VL    MODIFY RPL WITH 2 BYTE KEY KGE
         CALL  PTFVSAM,FCALLCSI,VL    OPEN AND GET VSAM RECORD
         CALL  PTFVSAM,MSDRPL11,VL    MODIFY RPL WITH 2 BYTE KEY SEQ
         B     GETSEQ
ZONEHIT  CLC   IRBRELA,=XL2'1021'     SREL
         BNE   GETLOOP
         MVC   CDSISREL(4),IRBNAM2F   SREL
         B     GETLOOP
NAMEOK   CLC   IRBRELA,=XL2'2601'     TYPE=PTF OR FUNCTION OR UNKNOWN
         BNE   GETLOOP
ZONEOK   MVI   CSIFLAG,X'00'
         CLC   IRBNAM2F(3),=CL3'UNK'
         BE    CSISUP               AUTOMATICALLY SUPERCEDED
         MVI   CSIFLAG,X'FE'
         CLC   IRBNAM2F(3),=CL3'FUN'
         BE    DOPTF
         CLC   IRBNAM2F(3),=CL3'PTF'
         BNE   GETLOOP
         MVI   CSIFLAG,X'FF'
DOPTF    CALL  PTFVSAM,FGETCSI,VL     GET NEXT VSAM RECORD
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         LA    R1,CSIKEY2
         USING CSIRECD,R1
         CLC   SMODNME(8),IRBNAME1
         BNE   NEWSMOD                    NOT ACCEPT/APPLIED
         CLC   IRBRELA,=XL2'2602' ATTRIBUTE  IOPPSTAT
         BNE   DOPTF
CSIATTR  TM     IRBNAM2F,X'20'            ACCEPTED
         BO     CSIPTF
         TM     IRBNAM2F,X'04'            PTF IS SUPED OR DELETED.
         BO     CSISUPX
         TM     IRBNAM2F,X'80'            APPLIED
         BZ     GETLOOP
*.....................................    STORE INTO CDS TABLE
CSIPTF   CLI    CSIFLAG,X'FF'             PTF MUST BE APPLIED
         BNE    CSIFUNC
         MVC    CSIFLAG(1),IRBNAM2F       IOPSSTAT FLAG AS CSIFLAG
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'00'               CLEAR IT (UNUSED)
         B      CSISUPS
CSISUPX  TM     IRBNAM2F+3,X'80'            PTF IS SUPED .
         BZ     GETLOOP
CSISUP   MVC    CSIFLAG(1),IRBNAM2F       IOPSSTAT = CSIFLAG
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'00'               CLEAR IT (UNUSED)
         B      CSISUPS
CSIFUNC  CLI    CSIFLAG,X'FE'            FUNCTION MUST BE APPLIED
         BNE    NEWSMOD
         MVI    CSIFLAG,X'00'
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'21'               CLEAR IT (UNUSED)
CSISUPS  LA     R9,8(R9)                  NEXT SLOT
         ST     R9,CDSTABE                SAVE END OF TABLE
         LA     R3,8(R9)                  NEXT SLOT
         L      R4,TABLEND
         CLR    R3,R4
         BNL    CSIEXIT
         B      NEWSMOD                    FOR MORE SUPERCEDED
CSIEXIT  EQU   *
         MVI   MODFLAG,X'0B'
         B     ENVEODXD
* ENVEODXD CLOSE (VSAMCSI)
ENVEODYD CALL  PTFVSAM,FCLSECSI,VL    CLOSE VSAM DSN (EARLIER)
ENVEODAD EQU   *
         MVC   POS2(15),CSIEND
         BAL   R3,PRINTMSG
* ENVEODXD CLOSE (VSAMCSI)
ENVEODXD EQU   *                ALREADY CLOSED BY PTFVSAM
         L    R12,CSMPER12
         BR    R12
CSMPEGLB  EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        READ VSAM CSI GLOBAL DSN
*        SELECT  PTF NAME RECEIVED.
*        STORE INTO SYSIN TABLE.
*
         ST   R12,CSMPER12
         CLI   COLLECT,X'FF'   DO NOT COLLECT SYSMODS INTO SYSIN
         BER   R12
*        MODCB  RPL=RPLGLOB,ARG=BYTE0,KEYLEN=1,
*               OPTCD=(LOC,GEN,KGE)
         CALL  PTFVSAM,MSDRPL9,VL         MODIFY RPL TO 1 BYTE KEY SEQ
         CALL  PTFVSAM,FCALLGLB,VL        OPEN AND GET VSAM RECORD
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         MVC   POS2(17),CSIGSTAR
         BAL   R3,PRINTMSG
*        SKIP  GLOBAL MAIN RECORD
GETLOOPG CALL  PTFVSAM,FGETGLB,VL         GET NEXT VSAM RECORD
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         LA    R1,CSIKEY
         USING CSIRECD,R1
         CLI   IRBCATG,X'26'
         BH    ENVEODYG   IGNORE SRC LISTING (30) LOADMOD (31)
*                             ++HOLD CARDS (32)
         BNE   GETLOOPG
         CLC   SMODNME,IRBNAME1
         BE    NAMEOKG
NEWSMODG MVC   SMODNME(8),IRBNAME1
         B     GETLOOPG
NAMEOKG  CLC   IRBRELA,=XL2'2601'     TYPE=PTF OR FUNCTION OR UNKNOWN
         BNE   GETLOOPG
         MVI   CSIFLAG,X'00'
         CLC   IRBNAM2F(3),=CL3'PTF'
         BNE   GETLOOPG
         MVI   CSIFLAG,X'FF'
DOPTFG   CALL  PTFVSAM,FGETGLB,VL    GET NEXT VSAM RECORD
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         LA    R1,CSIKEY
         USING CSIRECD,R1
         CLC   SMODNME,IRBNAME1
         BNE   NEWSMODG                   NOT ACCEPT/APPLIED
         CLC   IRBRELA,=XL2'26C2' APPLIED ID TGT
         BE    GLOBSYSM
         CLC   IRBRELA,=XL2'26C3' ACCEPT ID DLIB
         BE    GLOBSYSM
*.....................................    HOLD SYSMOD??
         CLC   IRBRELA,=XL2'26F4'   HOLD ERROR CODE
         BE    HOLDDATA
         CLC   IRBRELA,=XL2'26F5'   HOLD SYSTEM CODE
         BE    HOLDDATA
         CLC   IRBRELA,=XL2'26F6'   HOLD USERCODE
         BNE   DOPTFG
HOLDDATA CLI   HOLDSWT,X'FF'
         BE    HOLDTWO
         L     R4,HOLDTABS
         ST    R4,HOLDTABE
         A     R4,=F'47976' WARNING OF HOLD TABLE BEFORE FULL
         ST    R4,HOLDTEND
         MVI   HOLDSWT,X'FF'
HOLDTWO  L     R4,HOLDTABE
         MVI   0(R4),X'01'
         MVC   1(7,R4),IRBNAME1
         MVI   8(R4),X'08'
         MVC   9(7,R4),IRBNAM2F
         MVC   16(8,R4),=CL8'ERROR '
         CLI   IRBRELA+1,X'F4'
         BE    HOLDDONE
         MVC   16(8,R4),=CL8'SYSTEM '
         CLI   IRBRELA+1,X'F5'
         BE    HOLDDONE
         MVC   16(8,R4),=CL8'USER '
HOLDDONE LA    R4,24(R4)
         ST    R4,HOLDTABE
         C     R4,HOLDTEND
         BL    DOPTFG
         ABEND 800,DUMP          TABLE IS FULL
*.....................................    STORE INTO SYSIN TABLE
GLOBSYSM CLI    CSIFLAG,X'FF'             PTF MUST BE RECEIVED
         BNE    DOPTFG
         CLC    ZONEDATA(8),IRBNAM2F  MUST BE MATCHED TO ZONE=
         BNE    DOPTFG
         MVI    CSIFLAG,X'00'
         L     R4,ENDTBADR
         L     R3,INFOSREL
         LTR   R3,R3
         BNZ   NGLOBTAB
         ST    R4,INFOSREL
MVCGLOBL MVC   0(4,R4),NULLADDR
         MVC   4(7,R4),IRBNAME1
         MVI   11(R4),X'A0'
         LA    R4,12(R4)
         ST    R4,ENDTBADR
         B     DOPTFG
NGLOBTAB CLC   0(4,R3),NULLADDR
         BE    ENDGLOBL
         L     R3,0(R3)
         B     NGLOBTAB
ENDGLOBL ST    R4,0(R3)
         B     MVCGLOBL
ENVEODYG CALL  PTFVSAM,FCLSEGLB,VL    CLOSE VSAM DSN (EARLIER)
ENVEODA2 EQU   *
         MVC   POS2(15),CSIGEND
         BAL   R3,PRINTMSG
*ENVEODAG CLOSE (VSAMGLOB)
ENVEODAG EQU   *              ALREADY CLOSED BY PTFVSAM RC=7FFFF
         L    R12,CSMPER12
          BR    R12
         DROP  R10
         DROP  R11
         LTORG
CDSKEYTB EQU   *,3
         DC    C'        '
         DC    C' '
         DC    X'5B'
         DC    C'        '
         DC    C'    '
         DC    X'7B7C'
         DC    C'    ABCD'
         DC    C'EFGHIJKL'
         DC    C'MNOPQRST'
         DC    C'UVWXYZ01'
         DC    C'23456789'
CDSDATA  EQU   *,36
         DC    C'        '
BLANKOUT EQU   *,3
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'    '
         DC    7F'0'
         DS    0F
MAXDATEM DC    CL8'MAXDATE='
CNTLEND  DC    CL16'CONTROL READ END'
SYSSTRT  DC    CL16'SYSIN READ START'
SYSEND   DC    CL16'SYSIN READ END  '
DUMPMSG  DC    C'DUMP'
CNTLBEG  DC    CL18'CONTROL READ START'
INFORUN  DC    C'INFORUN'
ZONE     DC    C'ZONE='
FMID     DC    CL5'FMID='
ERMAXDT  DC    CL15'INVALID  MAXDATE'
CDSSTRT  DC    CL17'SMPCDS READ START'
CDSEND   DC    CL15'SMPCDS READ END'
SREL     DC    CL5'SREL='
NOCOL    DC    CL9'NOCOLLECT'
COLLECT  DC    X'00'
PATCH    DC    X'00'
         DC    C'PATCH AREA'
         DC    X'00'
         DC  33F'0'
CSIRECD  DSECT
CCACZID  DS    XL2  VARIED FOR INDEX
IRBCATG  DS    X      SAME  AS IRBRELA+0
IRBNAME1 DS    CL8
IRBRELA  DS    XL2 RELATIONSHIP ASSOCIATED
IRBOCCR  DS    XL2
IRBNAM2F DS    CL184     VARIED LENGTH MOST 8 CHARS
         PRINT   NOGEN
         PTFCOMN
         END
./       ADD   NAME=OLDFIX
*        DOR001   FIXED ON 11/5/86
*                 1. ADD PRINTED PREFIXES 'PE-, SYS, USE AND ++.
*                 2. ADD PRINTED "HOLD" COLUMN SAYING ERR, SYS,OR USE.
*                 3. CORRECTION PRINTED LINE IN ERROR
*                 4. INDICATE A SYMBOL OF "×" TO SHOW SYSMOD IS TARGET
         TITLE     'PTFFIX   -  FINDFIX SUBROUTINE '
         PRINT  GEN
PTFFIX   CSECT
         USING *,R11
FIX      B     @PROLONG-*(15)
         DC    AL1(11),CL11'PTFFIX'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         LR    R15,R13
         LA    R13,72(R13)
         ST    R13,8(R15)
         ST    R15,4(R13)
         LA    R2,4095(R11)
         USING FIX+4096,R2
         USING PARMPTR,R10
         LA    R2,1(R2)
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         L     R5,TABLEND
         SL    R5,F30
         ST    R5,TABLEND
         L     R5,ENDTBADR
         ST    R5,SMODTABS
* ------ MODCB EXLST=EXLST,EODAD=EODAD
         CALL  PTFVSAM,MSDACB0,VL
         CALL  PTFVSAM,MSDACB1,VL
         B     FIXBEG
         EJECT
GETSMOD EQU    *
*       SMOD TABLE FORMAT 36 BYTES
*    +0    +4    +8   +12   +16    +20   +27  +28
*    ×     ×     ×    ×     ×      ×     ×    ×
*    ×     ×     ×    ×     ×      ×     ×    +-- DATE YY/MM/DD
*    ×     ×     ×    ×     ×      ×     +--  SYSMOD FLAG BYTE
*    ×     ×     ×    ×     ×      ×     XXXX XXX1 EARLIER REFER.
*    ×     ×     ×    ×     ×      ×     XXXX XX1X RESERVED
*    ×     ×     ×    ×     ×      ×     XXXX X1XX IFREQ
*    ×     ×     ×    ×     ×      ×     XXXX 1XXX PRE
*    ×     ×     ×    ×     ×      ×     XXX1 XXXX SUPERCEDED
*    ×     ×     ×    ×     ×      ×     XX1X XXXX AVAILABLE IN PTF LIB
*    ×     ×     ×    ×     ×      ×     X1XX XXXX NOT AVAIL IN PTF LIB
*    ×     ×     ×    ×     ×      ×     1XXX XXXX ALREADY INSTALLED
*    ×     ×     ×    ×     ×      +----- SYSMOD NAME
*    ×     ×     ×    ×     +------------ ADDRESS POINT TO SYSMOD
*    ×     ×     ×    +------------------ ADDRESS POINT TO SYSMOD
*    ×     ×     +----------------------- ADDRESS POINT TO SYSMOD
*    ×     +----------------------------- ADDRESS POINT TO SYSMOD
*    +----------------------------------- ADDRESS POINT TO SYSMOD
*                                            DEPENDING ON FLAG (+27)
*
         L     R5,ENDTBADR
         CL    R5,TABLEND
         BNL   MFLAG0E
         XC    0(36,R5),0(R5)     ERASE SYSMOD TABLE
         MVC   20(7,R5),SBLANKS   STORE SYSMOD NAME
         MVC   28(8,R5),SBLANKS   STORE SYSMOD NAME
         LA    R9,36(R5)          NEXT SYSMOD TABLE
         ST    R9,ENDTBADR        SAVE AS END OF SYSMOD TABLE
         BR    R12
MFLAG0E  EQU   *
         MVI   MODFLAG,X'0E'
         B     EXITFIX
         EJECT
NEXTTAB  EQU   *
         L     R4,8(,R5)
         LTR   R4,R4
         BZ    TABEMPTY
         LR    R5,R4
         B     NEXTSYSM
FIXBEG   MVC   SMODKYAA(4),CNTLSMOD
         MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
TABEMPTY L     R4,SMODKYAA
         LTR   R4,R4
         BZ    TABGONE
         MVC   SMODKYAA(4),0(R4)
         LA    R3,4(R4)
         BAL   R12,GETSMOD                 PERFORM
CNTLSYSM MVC   20(7,R5),0(R3)
*        MVC   POS2(8),0(R3)
*        MVC   POS17(10),=CL10'CNTLSYSM'
*        BAL   R8,PRTDEFIX
         LR    R4,R5
DOSYSMOD SL    R4,F36
         CL    R4,SMODTABS
         BL    FNDSMOD
         CLC   20(7,R4),20(R5)
         BE    SAMESMOD
*        MVC   POS2(8),20(R4)
*        MVC   POS17(10),=CL10'DOSYSMOD'
*        MVC   POS32(7),20(R5)
*        BAL   R8,PRTDEFIX
         B     DOSYSMOD
SAMESMOD OI    27(R5),X'01'
*        MVC   POS2(8),20(R4)
*        MVC   POS17(10),=CL10'SAMESYSM'
*        MVC   POS32(7),20(R5)
*        BAL   R8,PRTDEFIX
         B     NEXTSYSM
FNDSMOD  BAL   R12,FINDMOD                 PERFORM
         B     MISSSMD
         OI    27(R5),X'80' FOUND IN CDS/CSI TABLE
*       MVC   POS2(8),0(R3)
*        MVC   POS17(10),=CL10'FOUND'
*        BAL   R8,PRTDEFIX
         B     NEXTSYSM
MISSSMD EQU    *
*        MVC   POS2(8),0(R3)
*        MVC   POS17(10),=CL10'NOT FOUND'
*        BAL   R8,PRTDEFIX
         L     R3,SMODMISS        MUST BE IN INFOTABLE AREA
         LTR   R3,R3                   DOR SMODMISS IS ZERO.
         BZ    NEXTSYSM                DOR
*        MVC   POS2(8),20(R5)
*        MVC   POS17(10),=CL10'SUPNAME'
*        MVC   POS30(8),0(R3)
*        MVC   POS42(10),=CL10'R3'
*        BAL   R8,PRTDEFIX
         MVC   SUPNAME,20(R5)
*                                                                  DOR
*        REMODIFIED TO SEARCH FOR SUPERCEDED SYSMODS IN SHORT TIME DOR
*                                                                  DOR
         LR    R1,R3                                               DOR
         CLI   0(R3),X'01'                                         DOR
         BNE   FINDSUP                                             DOR
NEXTSUP  MVC   INFOFFST+1(3),21(R3) NEXT OFFSET OF SYSMOD FIELD    DOR
         LR    R1,R3                                               DOR
         A     R1,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         LA    R3,24(R3)        BYPASS  SYSMOD+DATE+SREL FIELDS    DOR
FINDSUP  CLC   SUPSYSM(8),0(R3)
         BE    MATCHSMD
FINDSUPA LA    R3,8(R3)
         CLI   0(R3),X'08'     SUPED SYSMOD                        DOR
         BE    FINDSUP                                             DOR
         CLI   0(R3),X'11'     IFREQ SYSMOD                        DOR
         BE    FINDSUPA                                            DOR
         CLI   0(R3),X'10'     IFREQ FMID                          DOR
         BE    FINDSUPA                                            DOR
         CLI   0(R3),X'0A'     ELEMENTS                            DOR
         BL    FINDSUP1                                            DOR
         LR    R3,R1           SKIP  ELEMENT FIELDS                DOR
FINDSUP1 CLI   0(R3),X'01'                                         DOR
         BE    NEXTSUP                                             DOR
FINDSUP2 CL    R3,SMODMISE   END OF INFOTABLE
         BL    FINDSUP
         L     R3,SMODMISS
         MVC   SYSMODNM(7),20(R5)
CHKSYSM  CLI   0(R3),X'01'   LOOK FOR SYSMOD
         BE    SYSMODY
NOTSYSM  EQU   *
*        LA    R3,8(R3) INEFFECTIVE METHOD                         DOR
*                                                                  DOR
*        REMODIFIED TO SEARCH SYSMODS IN SHORT TIME                DOR
*                                                                  DOR
         MVC   INFOFFST+1(3),21(R3) NEXT OFFSET OF SYSMOD FIELD    DOR
         A     R3,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         CL    R3,SMODMISE
         BL    CHKSYSM
         B     SYSMNONE
SYSMODY  CLC   SYSMCODE(8),0(R3)
         BNE   NOTSYSM
*--------------------------------------
*        MVC   POS2(8),SYSMCODE
*        MVC   POS10(14),0(R3)
*        MVC   POS27+14(7),=CL7'SYSMODY'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         OI    27(R5),X'20'
         CLI   10(R3),X'61'
         BNE   PATHPRE
*--------------------------------------
*        MVC   POS2(7),SYSMCODE
*        MVC   POS10(14),0(R3)
*        MVC   POS27+14(7),=CL7'SYSMDTE'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         MVC   28(8,R5),8(R3)
         B     PATHPRE
SYSMNONE OI    27(R5),X'40'
         B     NEXTSYSM
NEXTSYSM L     R4,16(,R5)
         LTR   R4,R4
         BNZ   CHKSMOD
HAVESMOD L     R4,0(,R5)
         LTR   R4,R4
         BZ    NEXTTAB
         LR    R5,R4
         B     NEXTSYSM
         EJECT
CHKSMOD CLI    0(R4),X'01'
         BNE   CHKPRE
SYSMNEXT MVC   16(4,R5),NULLADDR
         B     HAVESMOD
CHKPRE   CLI   0(R4),X'05'
         BNE   CHKREQ
         MVI   FIXSWT,X'08'
         B     SYSMODD
CHKREQ   CLI   0(R4),X'06'
         BNE   CHKIFREQ
         MVI   FIXSWT,X'04'
         B     SYSMODD
CHKIFREQ CLI   0(R4),X'11'
         BNE   CHKFMID
         MVI   FIXSWT,X'02'
         B     SYSMODD
CHKFMID  CLI   0(R4),X'10'
         BNE   NEXTSMOD
         LA    R3,1(R4)
         BAL   R12,FINDMOD                 PERFORM
         B     FOUNDMOD         +RC=0
         B     NEXTSMOD         +RC=4
         EJECT
NEXTSMOD LA    R4,8(R4)
         CL    R4,SMODMISE
         BNL   SYSMNEXT
         B     CHKSMOD
FOUNDMOD LA    R4,8(R4)
         CLI   0(R4),X'11'
         BNE   CHKSMOD
         B     FOUNDMOD
         EJECT
SYSMODD  LR    R6,R5
         LA    R4,8(R4)
         ST    R4,16(,R5)
         SL    R4,F8VAL
         L     R7,4(,R5)
         LTR   R7,R7
         BNZ   NEXTSMD
         BAL   R12,GETSMOD                 PERFORM
         ST    R6,0(,R5)
         ST    R5,4(,R6)
         MVC   20(7,R5),1(R4)
         MVC   27(1,R5),FIXSWT
         LA    R3,1(R4)
         LR    R4,R5
         B     DOSYSMOD
         EJECT
NEXTTAB2 BAL   R12,GETSMOD                 PERFORM
         ST    R5,12(,R6)
         ST    R6,8(,R5)
         MVC   0(4,R5),0(R6)
         MVC   20(7,R5),1(R4)
         MVC   27(1,R5),FIXSWT
         LA    R3,1(R4)
         LR    R4,R5
         B     DOSYSMOD
NEXTSMD  LR    R6,R7
         L     R7,12(,R7)
         LTR   R7,R7
         BNZ   NEXTSMD
         B     NEXTTAB2
         EJECT
MATCHSMD OI    27(R5),X'10'
*        MVC   POS2(7),20(R5)
*        MVC   POS17(10),=CL10'MATCHED R5'
*        MVC   POS30(7),0(R3)
*        MVC   POS42(10),=CL10'R3'
*        BAL   R8,PRTDEFIX
         LR    R6,R5
         MVI   FIXSWT,X'00'
         LR    R4,R3
FSYSMOD  SL    R4,F8VAL
         CLI   0(R4),X'01'
         BE    NEXTTAB2
         B     FSYSMOD
PATHPRE  LA  R4,8(R3)
         B     CHKSMOD
PATHSTAY TM    PTR29A,X'FF'
         BNO   PATHOUT
         L     R5,FMIDPTR
         LTR   R5,R5
         BNZ   PATHON1
         MVC   POS10(15),TITLE10
NEGSYSM  BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   MODFLAG(1),PATCH
         B     EXITFIX
PATHON1  L     R9,FMIDADRX
PATHON2  LA    R5,8(R5)
         CL    R5,SMODMISE
         BNL   PATHOVER
         CLI   0(R5),X'03'
         BNE   PATHON2
         CLC   1(7,R5),4(R9)
         BNE   PATHON2
         ST    R5,FMIDPTR
FSYSMOD2 SL    R5,F8VAL
         CLI   0(R5),X'01'
         BNE   FSYSMOD2
         ST    R5,FMIDADDR
         BAL   R12,GETSMOD                 PERFORM
         L     R9,FMIDADRX
         L     R4,12(,R9)
         LTR   R4,R4
         BNZ   PATHUP
         ST    R5,12(,R9)
PATHUP   ST    R5,16(,R9)
         L     R3,FMIDADDR
         LA    R3,1(R3)
         B     CNTLSYSM
PATHOUT  L     R3,FMIDREQ
PATHCHK  LTR   R3,R3
         BZ    NOPATH
         TM    11(R3),X'80'
         BNO   PATHSMOD
         L     R3,0(,R3)
         B     PATHCHK
PATHSMOD ST    R3,FMIDADRX
         L     R5,SMODMISS
         LTR   R5,R5              SEE IF R5=0, ABNORMAL NO SYSMOD
         MVC   POS10(16),TITLE11
         BZ    NEGSYSM            NO SYSMOD IN TABLE
         OI    11(R3),X'80'
         MVI   PTR29A,X'FF'
         B     PATHON1
PATHOVER MVI   PTR29A,X'00'
         B     PATHOUT
TABGONE  CLC   SMODTABE(4),F0
         BNE   PATHSTAY
         MVC   SMODTABE(4),ENDTBADR
         B     PATHSTAY
         EJECT
NOSYSMOD L     R3,0(,R3)
         B     NOSYSMDX
FUNCPATH MVC   POS32(12),FUNCMSG
         L     R7,FMIDADDR
         MVC   POS45(7),4(R7)
         MVI   POS51+2,X'7A'
         OI    INFTABEA,X'40'
         B     PRINTFNC
NOPATH   CLC   SMODTABS(4),SMODTABE
         BE    NOSYSMDY
         CLI   DEFIX,X'FF'
         BE    NOPATHX
         CALL  TRACE
         MVI   DEFIX,X'FF'    DOR001 FOR DEBUG
NOPATHX  EQU   *
         L     R5,SMODTABS
         ST    R5,FDUMMY
         MVC   POS2(8),=CL8'SMODBEG'
         MVC   POS2+9(4),FDUMMY DOR001
         MVC   POS2+14(36),0(R5) DOR001
         BAL   R8,PRTDEFIX       DOR001
         LTR   R5,R5
         BZ    FINISHUP
PATHEND  CLC   0(4,R5),NULLADDR
         BNE   PATHEND2
         CLC   8(4,R5),NULLADDR
         BE    DISPSMOD
PATHEND2 LA    R5,36(R5)
         ST    R5,FDUMMY
         MVC   POS2(8),=CL8'SMODTNX'
         MVC   POS2+9(4),FDUMMY DOR001
         MVC   POS2+14(36),0(R5) DOR001
         BAL   R8,PRTDEFIX       DOR001
         CL    R5,SMODTABE
         BL    PATHEND
FINISHUP MVC   POS2(30),TITLE1
         MVC   POS32(8),FINISH
         MVI   PRTLINE,X'19'
         BAL   R12,PRINTER                 PERFORM
         MVI   PRTLINE,X'09'
         BAL   R12,CLRPRINT                PERFORM
NOSYSMDY L     R3,FMIDREQ
NOSYSMDX LTR   R3,R3
         BZ    PRINT8
         ST    R3,FDUMMY
         MVC   POS2(8),=CL8'NOSMODX'
         MVC   POS2+9(4),FDUMMY DOR001
         MVC   POS2+14(36),0(R3) DOR001
         BAL   R8,PRTDEFIX       DOR001
         TM    11(R3),X'40'
         BO    NOSYSMOD
         OI    11(R3),X'40'
         MVC   SMODTABS(4),12(R3)
         OI    INFTABEA,X'80'
         NI    INFTABEA,X'BF'
         L     R5,16(,R3)
         LA    R5,36(R5)
         ST    R5,SMODTABE
         ST    R3,FMIDADDR
         CLC   SMODTABS(4),NULLADDR
         BNE   NOPATH
         MVC   POS2(16),NOSMOD
         MVC   POS19(12),FUNCMSG
         MVC   POS32(7),4(R3)
         MVI   PRTLINE,X'19'
         BAL   R12,PRINTER                 PERFORM
         MVI   PRTLINE,X'09'
         BAL   R12,CLRPRINT                PERFORM
         B     NOSYSMOD
         EJECT
CLRPRINT MVI   POS2,C' '
         MVC   POS3(131),POS2
         BR    R12
         SPACE 4
PRINTER  EQU   *
         PUT   SYSPRINT,PRTLINE
         L     R1,LNENUM
         CLI   PRTLINE,X'19'
         BE    PRTERSET
         SL    R1,F1
PRINTER2 ST    R1,LNENUM
         LTR   R1,R1
*------- BC    12,PRINT5     CAUSE DOUBLE PRINT   DOR
PRTEXIT  BR    R12
PRTERSET SL    R1,F3
         B     PRINTER2
         EJECT
DISPSMOD MVC   ONE(4),FMIDREQA
         CL    R5,SMODTABS
         BE    RPTREQST
         TM    INFTABEA,X'40'
         BO    CLEARLNE
         L     R1,LNENUM
         CL    R1,F7
         BNH   PRINT3
         PUT   SYSPRINT,PRTLINE
         L     R1,LNENUM
         SL    R1,F3
         ST    R1,LNENUM
         LTR   R1,R1
         BC    12,PRINT3
RPTREQST MVC   POS2(30),TITLE1
         TM    INFTABEA,X'80'
         BO    FUNCPATH
         MVC   POS32(10),TITLE2
         MVC   POS43(7),20(R5)
         MVI   POS51,C':'
PRINTFNC BAL   R12,PRINTER                 PERFORM
         L     R1,LNENUM
         SL    R1,F1
         ST    R1,LNENUM
         LTR   R1,R1
* ------ BC    12,PRINT4 CAUSE DOUBLE PRINT DOR
CLEARLNE BAL   R12,CLRPRINT                PERFORM
RPTSMOD  MVC   REPORT(7),20(R5)
         MVI   REPORT+8,C' '
         MVC   REPORT+9(110),REPORT+8
         BAL   R8,HOLDCHK        TO INDICATE IF IT IS IN HOLD   DOR001
* ------------------------------------------------------
         MVC   POS2(8),=CL8'RPTSMOD'
         ST    R5,FDUMMY
         MVC   POS2+10(4),FDUMMY
         MVC   POS2+15(36),0(R5) DOR001
         BAL   R8,PRTDEFIX       DOR001
* ------------------------------------------------------
         TM    27(R5),X'0E'
         BZ    SYSMHAVE
         TM    27(R5),X'08'
         BZ    RPTREQ
         MVC   SMODTYPE(3),PRE
         B     RPTIS
RPTREQ   TM    27(R5),X'04'
         BZ    RPTIFREQ
         MVC   SMODTYPE(3),REQ
         B     RPTIS
RPTIFREQ MVC   SMODTYPE(6),IFREQ
         BAL   R8,FMIDDISP         SHOW FMID NAME
RPTIS    MVC   PRTP09(2),IS
         MVC   PRTP18(3),FOR
         L     R7,0(,R5)
         LA    R1,400
         LTR   R7,R7
         BZ    PTRABEND
         MVC   PRTP22(7),20(R7)
         BAL   R9,PRTSYSM                  PERFORM
SYSMHAVE TM    27(R5),X'80'
         BNO   RPTEARLY
* ------ SYSMOD ALREADY INSTALLED MSG
         MVC   REPORT(7),=CL7'   >>>>>'
         MVC   PRTP09(25),TITLE4
         MVC   PRTP34,INSTLMSG
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,CSIINFO
RPTEARLY TM    27(R5),X'01'
         BNO   NOSTAR2
* ------ EARLIER REFERENCED MSG
         CLI   27(R5),X'01' BYPASS DOR001
         BE    RPTEARL2            DOR001
         MVC   REPORT(7),=CL7'   >>>>>'
RPTEARL2 MVC   PRTP09(18),EARLYMSG
         MVC   PRTP27,TITLE3
         BAL   R9,PRTSYSM                  PERFORM
NOSTAR2  TM    27(R5),X'40'
         BNO   SMDAVAIL
* ------ NOT AVAILABLE IN YOUR PTF LIBRARY
         MVI   PATCH,X'0F'
         MVC   RPTPREF(2),STAR2
         MVC   PRTP09(3),NOT
         MVC   PRTP12,TITLE5
         MVC   PRTP30,TITLE6
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,FINDHOLD
SMDAVAIL TM    27(R5),X'20'
         BNO   RPTSUPBY
*------- AVAILABLE IN YOUR PTF LIBRARY
         MVC   PRTP09(8),28(R5)
         MVC   PRTP17,TITLE5
         MVC   PRTP30,TITLE6
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,FINDHOLD
         BAL   R8,ELEMDISP
RPTSUPBY TM    27(R5),X'10'
         BNO   RPTSUPB2
* ------ IS SUPERCEDED BY MSG
         MVC   PRTP09(16),ISSUPMSG
         L     R7,12(,R5)
         LA    R1,500
         LTR   R7,R7
         BZ    PTRABEND
         MVC   PRTP25,20(R7)
         BAL   R9,PRTSYSM                  PERFORM
         TM    27(R5),X'30'
         BO    SUPBYEQU
RPTSUPB2 TM    27(R5),X'20'
         BZ    SUPBYEQU
* ----------------------------------------------------
         L     R3,SMODRCVE
         LTR   R3,R3
         BZ    SETTBADR
         L     R4,SMODRCVS
CHKSUPBY CLC   8(7,R4),20(R5)
         BE    SUPBYEQU
         LA    R4,24(R4)
         CL    R4,SMODRCVE
         BL    CHKSUPBY
         LA    R4,24(R3)
         CL    R4,TABLEND
         BH    FIXDONE
         ST    R4,ENDTBADR
         ST    R4,SMODRCVE
         LR    R4,R3
         MVC   0(4,R4),NULLADDR
         MVC   4(4,R4),NULLADDR
         MVC   8(7,R4),20(R5)
         MVC   16(8,R4),28(R5)
         B     SUPBYEQU
SETTBADR L     R3,ENDTBADR
         LA    R4,24(R3)
         CL    R4,TABLEND
         BH    FIXDONE
         ST    R4,ENDTBADR
         ST    R4,SMODRCVE
         ST    R3,SMODRCVS
         MVC   0(4,R3),NULLADDR
         MVC   4(4,R3),NULLADDR
         MVC   8(7,R3),20(R5)
         MVC   16(8,R3),28(R5)
         B     SUPBYEQU
FIXDONE  MVI   MODFLAG,X'10'
         B     EXITFIX
SUPBYEQU L     R7,4(,R5)
         LTR   R7,R7
         BZ    NONXTSUP
         LR    R5,R7
         L     R7,ONE
         AL    R7,FMIDREQA
         ST    R7,ONE
         B     RPTSMOD
NONXTSUP L     R7,12(,R5)
         LTR   R7,R7
         BZ    NONXTSU2
         LR    R5,R7
         B     RPTSMOD
NONXTSU2 L     R7,0(,R5)
         LTR   R7,R7
         BZ    PATHEND2
         LR    R5,R7
* ------------------------------------------------------
         MVC   POS2(8),=CL8'NONXTSU'
         ST    R5,FDUMMY
         MVC   POS2+10(4),FDUMMY
         MVC   POS2+15(36),0(R5) DOR001
         BAL   R8,PRTDEFIX       DOR001
* ------------------------------------------------------
         L     R7,ONE
         SL    R7,FMIDREQA
         ST    R7,ONE
         L     R7,12(,R5)
         LTR   R7,R7
         BZ    NONXTSU2
         LR    R5,R7
         B     RPTSMOD
         EJECT
FINDHOLD EQU   *
         ST    R8,SAVER8
         CLI   HOLDSWT,X'FF'
         BNE   EXTINFO         NO HOLD TABLE
         BAL   R12,FINDHLD     SPECIAL SEARCH ROUTINE           DOR001
         B     HOLDEXIT DO NOT HAVE HOLDDATA             DOR001
*        L     R6,HOLDTABS     BEGIN OF HOLD TABLE
*        B     FNDHOLD
*BUMPHOLD LA    R6,24(R6)
*         C     R6,HOLDTABE
*         BNL   HOLDEXIT
*FNDHOLD  CLC   1(7,R6),20(R5)   SYSMOD MATCH TO HOLD SYSMOD ?
*         BH    HOLDEXIT
*         BL    BUMPHOLD
         L     R6,HOLDADDR                                      DOR001
         MVC   PRTP09(11),=CL11'IS HOLD BY '
         MVC   PRTP19(6),16(R6)    ERROR/SYSTEM/USER
         MVC   PRTP26(15),=CL15'WITH REASON OF '
         MVC   PRTP41(7),9(R6)     SUPERCEDED SYSMOD
         MVC   REPORT(7),=CL7'   >>>>>'
*-------- GET HOLD   DATE ------------------------
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MSDRPL13,VL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HOLDEXPT
HDTXMORE EQU   *
*--------------------------------------
* DOR001 MVC   POS2(13),HOLD0
*        MVC   POS2+14(6),=CL6'HOLDAX'
*        MVC   POS2+20(100),CSIKEY
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HOLDEXPT
         CLC   CSIKEY+15(7),9(R6)
         BNE   HDTXNEXT
         MVC   PRTP41+8(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTXLOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTXFND
         LA    R7,1(R7)
         BCT   R9,HDTXLOOP
         B     HOLDEXPT
HDTXNEXT EQU   *
         CALL  PTFVSAM,MSDRPL14,VL   SEQUENTIAL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HOLDEXPT
         B     HDTXMORE
HDTXFND  LA    R7,3(R7)
HDTXFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTXFND2
         BCT   R9,HDTXFND1
         B     HOLDEXPT
HDTXFND2 MVC   PRTP41+13(5),1(R7)
HOLDEXPT BAL   R9,PRTSYSM
HOLDEXIT B     EXTINFO
         EJECT
FMIDDISP EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF FMID IFREQ BY THE SYSMOD
         L     R6,SMODMISS     BEGIN OF MISSED SYSMOD TABLE
         L     R7,0(,R5)
         LTR   R7,R7
         BZ    FMIDEXIT      R7 CONTAINS ZEROS AS IT MAY BE A PROBLEM
FMIDNEXT CLC   20(7,R7),1(R6)   FIND SYSMOD
         BE    FMIDCHK
FMIDNXT  EQU   *
         MVC   INFOFFST+1(3),21(R6)
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA
         CL    R6,SMODMISE         END OF SYSMOD TABLE
         BL    FMIDNEXT
         B     FMIDEXIT
FMIDCHK  CLI   0(R6),X'01'      SYSMOD CODE
         BNE   FMIDNXT
*--------------------------------------
*        MVC   POS2(7),20(R7)
*        MVC   POS10(13),1(R6)
*        MVC   POS27+14(6),=CL6'FMIDCK'
*        BAL   R8,PRTDEFIX
*--------------------------------------
FMIDSMOD LA    R6,8(R6)
         CL    R6,SMODMISE
         BE    FMIDEXIT       TABLE DRY OUT
         CLI   0(R6),X'01' SYSMOD HEADER TABLE
         BE    FMIDEXIT       NO IFREQ FOUND
         CLI   0(R6),X'11'    IFREQ SYSMOD CODE
         BNE   FMIDSMOD
         CLC   20(7,R5),1(R6)
         BNE   FMIDSMOD
         SL    R6,F8           BACKUP 8 BYTES FOR FMID NAME
         CLI   0(R6),X'10'    IFREQ FMID CODE
         BNE   FMIDEXIT        SOMETHING IS WRONG WITH IFREQ
* -----  LA    R3,1(R6)
* ------ BAL   R12,FINDMOD
* ------ B     FMIDOK          INSTALLED
*------- B     FMIDSMOD        NONE INSTALLED
FMIDOK   MVC   PRTP30(5),=CL5'FMID-'
         MVC   PRTP35(7),1(R6)
FMIDEXIT L     R8,SAVER8
         B     0(R8)
         EJECT
ELEMDISP EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF ELEMSNT MODIFICATIONS BY THE SYSMOD
         L     R6,SMODMISS     BEGIN OF HOLD TABLE
ELEMNEXT CLC   20(7,R5),1(R6)   FIND SYSMOD
         BE    ELEMCHK
ELEMNXT  EQU   *
* -----  LA    R6,8(R6)
         MVC   INFOFFST+1(3),21(R6)
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA
         CL    R6,SMODMISE         END OF SYSMOD TABLE
         BL    ELEMNEXT
ELEMDONE B     EXTINFO
ELEMCHK  CLI   0(R6),X'01'      SYSMOD CODE
         BNE   ELEMNXT
*--------------------------------------
* DOR001 MVC   POS2(7),20(R5)
*        MVC   POS10(13),1(R6)
*        MVC   POS27+14(6),=CL6'ELEMCK'
*        BAL   R8,PRTDEFIX
*--------------------------------------
ELEMPTF  LA    R6,8(R6)
         CL    R6,SMODMISE
         BNL   EXTINFO
         CLI   0(R6),X'01'   END OF SYSMOD
         BE    EXTINFO
         CLI   0(R6),X'1F'
         BE    ELEMHOLD
         CLI   0(R6),X'1E'
         BE    ELEMRLSE
         CLI   0(R6),X'1D'
         BE    ELEMJCLN
         CLI   0(R6),X'0A'
         BL    ELEMPTF
         CLI   0(R6),X'0F'
         BH    ELEMPTF
         CLI   0(R6),X'0D'
         MVC   PRTP28(7),=CL7'   ZAP-'
         BE    ELEMPRT
         CLI   0(R6),X'0C'
         MVC   PRTP28(7),=CL7'MACUPD-'
         BE    ELEMPRT
         CLI   0(R6),X'0B'
         MVC   PRTP28(7),=CL7'SRCUPD-'
         BE    ELEMPRT
         MVC   PRTP28(7),=CL7'   SRC-'
         MVI   BYTE2,X'24'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2402'    SRC RMID CODE
         CLI   0(R6),X'0A'  SRC
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'   MOD-'
         MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    MOD RMID CODE
         CLI   0(R6),X'0F' MOD
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'   MAC-'
         MVI   BYTE2,X'22'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2202'    MAC RMID CODE
         CLI   0(R6),X'0E'   MAC
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'       '
         XC    BYTE0(13),BYTE0      CLEAR SEARCH ARGUMENT
         B     ELEMPTF
ELEMRLSE MVC   PRTP20(7),=CL7'RELEAS-'
         B     ELEMDTA
ELEMHOLD MVC   PRTP20(7),=CL7'  HOLD-'
ELEMDTA  MVC   PRTP09(12),=CL12'HAS DATA OF '
         MVC   PRTP27(8),8(R6)   ERROR/SYSTEM/USER
         MVC   PRTP27+9(7),=CL7'REASON-'
         MVC   PRTP27+16(7),1(R6)    HOLDDATA REASON-ID
*-------- GET HOLD   DATE ------------------------
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MSDRPL13,VL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HDTYEXIT
HDTYMORE EQU   *
*--------------------------------------
* DOR001 MVC   POS2(13),HOLD0
*        MVC   POS2+14(6),=CL6'HOLDAY'
*        MVC   POS2+20(100),CSIKEY
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HDTYEXIT
         CLC   CSIKEY+15(7),1(R6)
         BNE   HDTYNEXT
         MVC   PRTP27+23(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTYLOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTYFND
         LA    R7,1(R7)
         BCT   R9,HDTYLOOP
         B     HDTYEXIT
HDTYNEXT EQU   *
         CALL  PTFVSAM,MSDRPL14,VL   SEQUENTIAL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HDTYEXIT
         B     HDTXMORE
HDTYFND  LA    R7,3(R7)
HDTYFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTYFND2
         BCT   R9,HDTYFND1
         B     HDTYEXIT
HDTYFND2 MVC   PRTP27+28(5),1(R7)
HDTYEXIT EQU   *
         B     ELEMPRT2
ELEMJCLN MVC   PRTP09(19),=CL19'HAS DATA OF JCLIN.'
         B     ELEMPRT2
ELEMPRT  MVC   PRTP35(8),1(R6)    ELEMENT REPLACEMENT NAME
ELEMPRTX MVC   PRTP09(20),=CL20'HAS REPLACEMENTS OF '    DOR001
ELEMPRT2 MVC   REPORT(7),=CL7'   >>>>>'
         ST    R6,SAVER6
         BAL   R9,PRTSYSM
         L     R6,SAVER6
         LA    R6,8(R6)
         B     ELEMPTF
ELEMRMID EQU   *
         ST    R6,SAVER6
         MVC   BYTENAME(8),1(R6)
         MVC   PRTP35(8),1(R6)    ELEMENT REPLACEMENT NAME
* ------ MODCB RPL=RPLCSI,KEYLEN=13,ARG=BYTE0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,1 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ELEMPRTX
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'CSITGT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   1(8,R6),CSIKEY2+3
         BE    ELEMRMOD
         MVC   PRTP45(6),=CL6' NEW '    NOT FOUND ON CSI FILE
         B     ELEMPRTX
ELEMRMOD MVC   PRTP45(6),=CL6' RMID-'
         MVC   PRTP45+6(8),CSIKEY2+15
         LA    R7,PRTP45+14
         MVI   REPFLAG,X'00'
*-------- GET RECEVED   DATE ------------------------
         MVC   BYTENAME(8),CSIKEY2+15    SYSMOD
         MVC   BYTERELA(2),=XL2'2632'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ELEMRSTD
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'RECDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMINSD
         OI    REPFLAG,X'10'
         MVC   0(9,R7),=CL9' RECDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET INSTALLED DATE ------------------------
ELEMINSD EQU   *
         MVC   BYTERELA(2),=XL2'2633'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ELEMRSTD
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'INSDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMRSTD
         OI    REPFLAG,X'20'
         MVC   0(9,R7),=CL9' INSDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET RESTORED DATE ------------------------
ELEMRSTD EQU   *
         MVC   BYTERELA(2),=XL2'2635'    RESTORE DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ELEMPRTX
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'RSTDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ESUPPRTX
         OI    REPFLAG,X'40'
         MVC   0(9,R7),=CL9' RSTDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
ESUPPRTX EQU   *
         TM    REPFLAG,X'70'
         BNZ   ELEMPRTX
*-------- LAST SUPERCEDED BY ----------
         MVC   BYTERELA(2),=XL2'2612'    LSUBBY CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ELEMPRTX
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'LSUBBY'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMPRTX
         MVI   REPFLAG,X'00'
         MVC   0(8,R7),=CL8' LSUBBY-'
         MVC   8(8,R7),CSIKEY2+15
         B     ELEMPRTX
         EJECT
CSIINFO  EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF ELEMSNT MODIFICATIONS BY THE SYSMOD
         MVC   GLOBNAME(8),=CL8'        '
         MVC   GLOBNAME(7),20(R5)
         MVC   GLOB0(3),=XL3'000026'
* ------ MODCB RPL=RPLGLOB,KEYLEN=11,ARG=GLOB0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------  LA    R1,2 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL2,VL
         CALL  PTFVSAM,FCALLGLB,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNE   EXTINFO
* ------ MODCB RPL=RPLGLOB,OPTCD=(SEQ)
* ------ LA    R1,3 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL3,VL
ECSIFIND LA    R6,CSIKEY       BEGIN OF GLOBAL CSI RECORD
         USING CSIRECD,R6
*--------------------------------------
* DOR001 MVC   POS2(23),0(R6)
*        MVC   POS27(13),GLOB0
*        MVC   POS27+14(6),=CL6'SMPCSI'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   IRBNAME1(7),20(R5) END OF SYSMOD
         BH    INFOCSI
         BNE   EXTINFO
ECSIOFF  EQU   *
         MVC   SAVEKEYG(23),CSIKEY
         MVI   HOLDSWTX,X'00'
         BAL   R9,ECSIRPT
         CLI   HOLDSWTX,X'FF'
         BNE   ECSIEASY DONT NEED TO REPOINT TO SAVEKEYG
         MVI   HOLDSWTX,X'00'
         CALL  PTFVSAM,MSDRPL15,VL   POINT TO RECORD WITH SAVEKEYG
         CALL  PTFVSAM,FGETGLB,VL
         LTR   R15,R15
         BNZ   EXTINFO
ECSIEASY CALL  PTFVSAM,MSDRPL3,VL
         CALL  PTFVSAM,FGETGLB,VL
         LTR   R15,R15
         BZ    ECSIFIND
EXTINFO  L     R8,SAVER8
         BR    R8
         EJECT
ECSIRPT  ST    R9,SAVER9
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         CLI   IRBRELA+1,X'F4'
         BE    ECSIHERR
         CLI   IRBRELA+1,X'F5'
         BE    ECSIHSYS
         CLI   IRBRELA+1,X'F6'
         BE    ECSIHUSE
         CLI   IRBRELA+1,X'B1'
         MVC   PRTP28(7),=CL7'   MOD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B4'
         MVC   PRTP28(7),=CL7'   MAC-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B2'
         MVC   PRTP28(7),=CL7'   ZAP-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B3'
         MVC   PRTP28(7),=CL7'  XZAP-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B5'
         MVC   PRTP28(7),=CL7'MACUPD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B7'
         MVC   PRTP28(7),=CL7'SRCUPD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B6'
         MVC   PRTP28(7),=CL7'   SRC-'
         BE    ECSIPRT
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         CLI   IRBRELA+1,X'12'
         MVC   PRTP17(15),=CL14'LAST SUPED BY '
         BE    ECSSUPE
         CLI   IRBRELA+1,X'11'
         MVC   PRTP17(15),=CL14'   DELETED BY '
         BE    ECSSUPE
         CLI   IRBRELA+1,X'F0'
         MVC   PRTP17(15),=CL14' SUPECEDED BY '
         BE    ECSSUPE
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         B     ECSIR9
ECSIHSYS MVC   PRTP20(7),=CL7'  HSYS-'
         B     ECSIDTA
ECSIHUSE MVC   PRTP20(7),=CL7'  HUSE-'
         B     ECSIDTA
ECSIHERR MVC   PRTP20(7),=CL7'  HERR-'
ECSIDTA  MVC   PRTP09(12),=CL12'HAS HOLD OF '
         MVC   RPTPREF(2),=CL2'++'                           DOR001
         MVC   PRTP27(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVC   SAVEFMID(8),IRBNAM2F  REASON-ID
*-------- GET HOLD   DATE ------------------------
         MVI   HOLDSWTX,X'FF'
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MSDRPL13,VL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HDTEEXIT
HDTEMORE EQU   *
*--------------------------------------
* DOR001 MVC   POS2(13),HOLD0
*        MVC   POS2+14(6),=CL6'HOLDAT'
*        MVC   POS2+20(100),CSIKEY
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HDTEEXIT
         CLC   CSIKEY+15(7),SAVEFMID REASON-ID MATCH ??
         BNE   HDTENEXT
         MVC   PRTP27+10(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTELOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTEFND
         LA    R7,1(R7)
         BCT   R9,HDTELOOP
         B     HDTEEXIT
HDTENEXT EQU   *
         CALL  PTFVSAM,MSDRPL14,VL   SEQUENTIAL
         CALL  PTFVSAM,FCALGLB2,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   HDTEEXIT
         B     HDTEMORE
HDTEFND  LA    R7,3(R7)
HDTEFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTEFND2
         BCT   R9,HDTEFND1
         B     HDTEEXIT
HDTEFND2 MVC   PRTP27+15(5),1(R7)
HDTEEXIT EQU   *
         B     ECSIPRT3
ECSSUPE  MVC   PRTP09(4),=CL4'HAS '
         MVC   PRTP30+2(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVC   REPORT(7),=CL7'   >>>>>'
         B     ECSIPRT3
ECSIPRT  MVC   PRTP09(20),=CL20'HAS REPLACEMENTS OF '    DOR001
         MVC   PRTP35(8),IRBNAM2F ELEMENT REPLACEMENT NAME
ECSIPRT2 MVC   REPORT(7),=CL7'   >>>>>'
         CLI   IRBRELA+1,X'B1' MOD
         BNE   RMIDMAC
RMIDMODX MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    MOD RMID CODE
FINDELEM MVC   BYTENAME(8),IRBNAM2F
* ------ MODCB RPL=RPLCSI,KEYLEN=13,ARG=BYTE0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,1 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ECSIPRT3
         LA    R6,CSIKEY2
         MVC   PRTP45(6),=CL6' RMID-'
         MVC   PRTP45+6(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVI   REPFLAG,X'00'
         LA    R7,PRTP45+14
*-------- GET RECEVED   DATE ------------------------
         MVC   BYTENAME(8),CSIKEY2+15    SYSMOD
         MVC   BYTERELA(2),=XL2'2632'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   EFNDRSTD
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'RECDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDINSD
         OI    REPFLAG,X'10'
         MVC   0(9,R7),=CL9' RECDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET INSTALLED DATE ------------------------
EFNDINSD EQU   *
         MVC   BYTERELA(2),=XL2'2633'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   EFNDRSTD
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'INSDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDRSTD
         OI    REPFLAG,X'20'
         MVC   0(9,R7),=CL9' INSDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET RESTORED DATE ------------------------
EFNDRSTD EQU   *
         MVC   BYTERELA(2),=XL2'2635'    RESTORE DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   EFNDLSUP
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'RSTDAT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDLSUP
         OI    REPFLAG,X'40'
         MVC   0(9,R7),=CL9' RSTDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
EFNDLSUP EQU   *
         TM    REPFLAG,X'70'
         BNZ   ECSIPRT3
*-------- LAST SUPERCEDED BY ----------
         MVC   BYTERELA(2),=XL2'2612'    LSUBBY CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MSDRPL1,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   ECSIPRT3
*--------------------------------------
* DOR001 MVC   POS2(24),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'LSUBBY'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ECSIPRT3
         MVI   REPFLAG,X'00'
         MVC   0(8,R7),=CL8' LSUBBY-'
         MVC   8(8,R7),CSIKEY2+15
         B     ECSIPRT3
RMIDMAC  CLI   IRBRELA+1,X'B4' MAC
         BNE   RMIDMACU
RMIDMACX MVI   BYTE2,X'22'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2202'    MAC RMID CODE
         B     FINDELEM
RMIDMACU CLI   IRBRELA+1,X'B5' MAC
         BNE   RMIDSRC
         B     RMIDMACX
RMIDSRC  CLI   IRBRELA+1,X'B6' SRC
         BNE   RMIDSRCU
RMIDSRCX MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    SRC RMID CODE
         B     FINDELEM
RMIDSRCU CLI   IRBRELA+1,X'B7' SRCU
         BE    RMIDSRCX
RMIDZAP  CLI   IRBRELA+1,X'B2' ZAP
         BE    RMIDMODX
RMIDXZAP CLI   IRBRELA+1,X'B3' ZAP
         BE    RMIDMODX
ECSIPRT3 BAL   R9,PRTSYSM
*--------------------------------------
*DOR001  MVC   POS2(23),CSIKEY2
*        MVC   POS27(13),BYTE0
*        MVC   POS27+14(6),=CL6'CSITGT'
*        BAL   R8,PRTDEFIX
ECSIR9   EQU   *
         L     R9,SAVER9
         BR    R9
*--------------------------------------
         EJECT
*--------------------------------------
INFOCSI  MVC   ARGU0(11),GLOB0
         MVC   ARGU0(2),ZONEINDX     TGT OR DLIB INDEXED
*------  MODCB RPL=RPLCSI,KEYLEN=11,ARG=ARGU0,
*------        OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
*------  LA    R1,4     LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL4,VL
         CALL  PTFVSAM,FCALLCSI,VL
         BAL   R9,EXTCSI
         LTR   R15,R15
         BNZ   EXTINFO
*------  MODCB RPL=RPLCSI,OPTCD=(SEQ)
*------  LA    R1,5     LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL4,VL
INFOFIND LA    R7,CSIKEY2      BEGIN OF GLOBAL CSI RECORD
         USING CSIRECD,R7
         CLC   IRBNAME1(7),20(R5) END OF SYSMOD
         BH    EXTINFO
         BNE   EXTINFO
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
*--------------------------------------
* DOR001 MVC   POS2(23),0(R6)
*        MVC   POS27(13),ARGU0
*        MVC   POS27+14(6),=CL6'CSITGT'
*        BAL   R8,PRTDEFIX
*--------------------------------------
         CLI   IRBRELA+1,X'02'    ATTR  IOPSTAT
         BE    INFOATTR
         BL    INFOSHOT    LOOKING FOR ATTRIBUTE OF SYSMOD FIRST
INFOCRY  MVC   SAVEKEY(23),CSIKEY2
INFORPT  BAL   R9,ECSIRPT
* ------ RE-KEY INDEXED AFTER ECSIRPT POINT TO RMID OF MOD/MAC & SRC.
* ------ MODCB RPL=RPLCSI,KEYLEN=23,ARG=SAVEKEY,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,6 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL6,VL
         CALL  PTFVSAM,FGETCSI,VL
         BAL   R9,EXTCSIG
         LTR   R15,R15
         BNZ   EXTINFO
INFOSHOT EQU   *         SKIP IRBRELA+1 X'00' AND X'01'
* ------ MODCB RPL=RPLCSI,KEYLEN=11,ARG=ARGU0,
* ------       OPTCD=(SEQ)
* ------ LA    R1,7 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL7,VL
INFOPTF  CALL  PTFVSAM,FGETCSI,VL
         BAL   R9,EXTCSIG
         LTR   R15,R15
         BZ    INFOFIND
         B     EXTINFO
INFODUM  MVC   PRTP08(29),=CL29' HAS SUPED OR LSUPED. '
         BAL   R9,PRTSYSM
         B     INFOPTF
INFOATTR EQU   *
         MVC   REPORT(7),=CL7'   >>>>>'
         CLI   IRBNAM2F,X'00'
         BE    INFODUM
         TM    IRBNAM2F,X'F0'
         BZ    INFOAT04
         TM    IRBNAM2F,X'80'
         BZ    INFOAT01
         MVC   PRTP08(29),=CL29' HAS APPLIED. '
         BAL   R9,PRTSYSM
INFOAT01 TM    IRBNAM2F,X'40'
         BZ    INFOAT02
         MVC   PRTP08(29),=CL29' HAS RESTORED. '
         BAL   R9,PRTSYSM
INFOAT02 TM    IRBNAM2F,X'20'
         BZ    INFOAT03
         MVC   PRTP08(29),=CL29' HAS ACCEPTED. '
         BAL   R9,PRTSYSM
INFOAT03 TM    IRBNAM2F,X'10'
         BZ    INFOAT04
         MVC   PRTP08(29),=CL29' HAS SYS ERR ENCOUNTERED.'
         BAL   R9,PRTSYSM
INFOAT04 TM    IRBNAM2F,X'0F'
         BZ    INFOPTF
         TM    IRBNAM2F,X'04'
         BZ    INFOAT06
         MVC   PRTP08(29),=CL29' HAS SUPED OR DELETED. '
         BAL   R9,PRTSYSM
INFOAT06 TM    IRBNAM2F,X'02'
         BZ    INFOAT07
         MVC   PRTP08(29),=CL29' HAS BYPASSED. '
         BAL   R9,PRTSYSM
INFOAT07 TM    IRBNAM2F,X'01'
         BZ    INFOPTF
         MVC   PRTP08(29),=CL29' HAS DEFAULTED VIA SYS GENED.'
         BAL   R9,PRTSYSM
         B     INFOPTF
         EJECT
EXTGLOB  EQU   *
         MVC   POS27+14(8),=CL8'CALLGLOB'
*--------------------------------------
EXTGLO2  ST    R15,SAVER15
         CL    R15,=XL4'00007FFF'    EODAD SIGNAL ?
         BNE   EXTR15OK
         MVC   POS2(6),=CL6'CLOSED'
         B     EXTCLSE
EXTR15OK MVC   POS2(4),SAVER15
EXTCLSE  MVC   POS27(13),GLOB0
         MVC   POS27+22(23),CSIKEY
*        BAL   R8,PRTDEFIX
*--------------------------------------
         L     R15,SAVER15
         BR    R9
EXTGLOG  EQU   *
*--------------------------------------
         MVC   POS27+14(7),=CL7'GETGLOB'
         B     EXTGLO2
EXTCSI   EQU   *
         MVC   POS27+14(7),=CL7'CALLCSI'
*--------------------------------------
EXTCSI2  ST    R15,SAVER15
*        MVC   POS2(4),SAVER15
*        MVC   POS27(13),BYTE0
*        MVC   POS27+22(23),CSIKEY2
*        BAL   R8,PRTDEFIX
*--------------------------------------
         L     R15,SAVER15
         BR    R9
EXTCSIG  EQU   *
*--------------------------------------
         MVC   POS27+14(7),=CL7'GETCSI'
         B     EXTCSI2
         EJECT
PRTSYSM  L     R6,ONE
         CL    R6,F15
         BH    PRTSMDST
         C     R6,F1                                       DOR001
         BNE   PRTSMOD2                                    DOR001
*        CLI   RPTPREF,X'40'
*        BNE   PRTSMOD2
         MVI   POS3,C'×'                                   DOR001
PRTSMOD2 SLL   R6,1
         LA    R6,POS2(6)
         MVC   0(120,R6),RPTPREF
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVI   PRTP08,C' '
         MVC   PRTP09(112),PRTP08
         MVC   RPTPREF(3),PRTP08
         BR    R9
PRTSMDST L     R6,F15
         B     PRTSMOD2
         EJECT
PRINT1   TM    SMPCNTL1,X'10'
         BNO   PRINT2
         LA    R1,SMPCNTL
         LA    R0,POS2
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
PRINT2   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVI   POS2,C' '
         MVC   POS3(131),POS2
         L     R1,LNENUM
         SL    R1,F1
         ST    R1,LNENUM
         LTR   R1,R1
         BC    12,PRINT6
PRNTEXIT BR    R12
         EJECT
PRINT3   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         B     RPTREQST
         SPACE 2
PRINT4   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         B     CLEARLNE
         SPACE 2
PRINT5   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         B     PRTEXIT
         SPACE 2
PRINT6   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         B     PRNTEXIT
         SPACE 2
PRINT7   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         B     RPTNOTE
         EJECT
PRINT8   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         MVC   POS2(27),TITLE7
         MVC   POS30(11),TITLE8
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   POS3(10),RECVCMD
         L     R3,SMODRCVS
         LTR   R3,R3
         BZ    FIXEXIT3
RCVDAPP1 MVI   PTR39,X'00'
         LA    R4,24(R3)
RCVDAPP2 CL    R4,SMODRCVE
         BE    RCVDAPP4
         CLC   8(16,R3),8(R4)
         BL    RCVDAPP3
         MVC   SMODDATA,8(R3)
         MVC   8(16,R3),8(R4)
         MVC   8(16,R4),SMODDATA
         MVI   PTR39,X'FF'
         B     RCVDAPP1
RCVDAPP3 LA    R4,24(R4)
         B     RCVDAPP2
RCVDAPP4 TM    PTR39,X'FF'
         BO    RCVDAPP1
         LA    R3,24(R3)
         CL    R3,SMODRCVE
         BL    RCVDAPP1
         L     R3,SMODRCVS      BEG ADDRESS  OF SYSMODS TO BE RECEIVED
         L     R4,SMODRCVE      END ADDRESS  OF SYSMODS TO BE RECEIVED
         LTR   R3,R3
         BZ    FIXEXIT3
         BAL   R12,PRINT1                  PERFORM
         MVI   POS2,X'40'
         MVC   POS2(100),POS2+1
         MVC   POS2(80),TITLERVD
         BAL   R12,PRINT1                  PERFORM
RPTCOMM  EQU   *
*       RECEIVE FORMAT:
*        SYSMOD   /* FMID  DATE  HOLD/AVAIL/SUPERCEDED */
*
         MVC   GLOBNAME(8),=CL8'        '
         MVC   GLOBNAME(7),8(R3)
         MVC   GLOB0(3),=XL3'000026'
         MVC   GLOBRELA(2),=X'26A2'     FMID CODE
* ------ MODCB RPL=RPLGLOB,KEYLEN=13,ARG=GLOB0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------  LA    R1,2 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MSDRPL12,VL
         CALL  PTFVSAM,FCALLGLB,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   RPTNCOMN             GLOBAL DOESNT HAVE IT NOW
         CLC   CSIKEY+11(2),GLOBRELA
         BNE   RPTNCOMN
         CLC   CSIKEY+3(7),8(R3)
         BNE   RPTNCOMN
         MVC   SAVEFMID(7),CSIKEY+15  FMID
*--------------------------------------
         MVC   GLOBRELA(2),=XL2'2632'    RECEIVE DATE CODE
         CALL  PTFVSAM,MSDRPL12,VL
         CALL  PTFVSAM,FCALLGLB,VL
         BAL   R9,EXTGLOB
         LTR   R15,R15
         BNZ   RPTDATE
         CLC   GLOBRELA(2),CSIKEY+11
         BNE   RPTDATE
         UNPK  POS42+14(5),CSIKEY+15(3)
         B     RPTDATE
RPTNCOMN L     R6,SMODMISS
CHKSMODX CLI   0(R6),X'01'   LOOK FOR SYSMOD
         BE    SMODY
NOTSMOD  EQU   *
*                                                                  DOR
*        REMODIFIED TO SEARCH SYSMODS IN SHORT TIME                DOR
*                                                                  DOR
         MVC   INFOFFST+1(3),21(R6) NEXT OFFSET OF SYSMOD FIELD    DOR
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         CL    R6,SMODMISE
         BL    CHKSMODX
         B     SMODNONE
SMODY    CLC   8(7,R3),1(R6)
         BNE   NOTSMOD
         LA    R6,24(R6)        BYPASS  SYSMOD+DATE+SREL FIELDS    DOR
SMODFMID CLI   0(R6),X'03'
         BE    RPTFMIDM
         CLI   0(R6),X'01'   NEXT SYSMOD
         BE    SMODNONE
         LA    R6,8(R6)
         B     SMODFMID
RPTFMIDM MVC   SAVEFMID(7),1(R6)      FMID FROM SMOD MISSED TABLE
RPTFMI2M MVC   POS42+14(7),=CL7'NOT YET'
         B     RPTDATE
SMODNONE MVC   SAVEFMID(7),=CL7'NO FMID'
         B     RPTFMI2M
RPTDATE  MVC   POS42(8),16(R3)     DATE
         MVC   POS22(7),8(R3)      SYSMOD
         MVC   POS32+2(7),SAVEFMID   FMID
         MVC   POS32(2),COMMBEG
         CLI   HOLDSWT,X'FF'
         BNE   RPTCOMMX        NO HOLD TABLE
         BAL   R12,FINDHLD     SPECIAL SEARCH ROUTINE       DOR001
         B     RPTCOMMX
*        L     R6,HOLDTABS     BEGIN OF HOLD TABLE
*        B     RPTHOLD
*RPTCHOLD LA    R6,24(R6)
*         C     R6,HOLDTABE
*         BNL   RPTCOMMX
*RPTHOLD  CLC   1(7,R6),8(R3)   SYSMOD MATCH TO HOLD SYSMOD ?
*         BH    RPTCOMMX
*         BL    RPTCHOLD
         L     R6,HOLDADDR                                   DOR001
*        MVC   POS42+9(4),=CL4'HOLD'
         MVC   POS42+9(3),16(R6) SHOW ERR,SYS,OR USE HOLD TYPE DOR001
RPTCOMMX MVC   POS32+38(2),COMMEND
         BAL   R12,PRINT1                  PERFORM
RPTCOMN  LA    R3,24(R3)
         CLR   R3,R4
         BL    RPTCOMM
         MVC   POS3(3),END1
         BAL   R12,PRINT1                  PERFORM
         MVC   POS3(8),APPLYMSG
         BAL   R12,PRINT1                  PERFORM
         L     R3,SMODRCVS      BEG ADDRESS  OF SYSMODS TO BE RECEIVED
RPTSELET MVC   POS22(7),8(R3)
         BAL   R12,PRINT1                  PERFORM
         LA    R3,24(R3)
         CLR   R3,R4
         BL    RPTSELET
         MVC   POS3(9),CHECKEND
         BAL   R12,PRINT1                  PERFORM
         CLI   PATCH,X'0F'
         BNE   FIXEXIT2
         L     R1,LNENUM
         CL    R1,F4
         BNH   PRINT7
         PUT   SYSPRINT,PRTLINE
RPTNOTE  MVC   POS2(6),NOTECMD
         MVC   POS10(15),TITLE9
         MVC   POS27(16),MSG1
         MVC   POS44(16),MSG2
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   MODFLAG(1),PATCH
FIXEXIT2 B     EXITFIX
FIXEXIT3 MVI   MODFLAG,X'11'
         B     EXITFIX
         EJECT
EXITFIX  EQU   *
         L     R13,4(R13)
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
         EJECT
HOLDCHK  EQU   *                                               DOR001
         BAL   R12,FINDHLD    SPECIAL SEARCH ROUTINE           DOR001
         B     NOTHOLD                                         DOR001
         L     R7,HOLDADDR                                     DOR001
         CLI   16(R7),C'E'                                     DOR001
         BNE   HOLDC2                                          DOR001
         MVC   RPTPREF(3),=CL3'PE-'                            DOR001
NOTHOLD  BR    R8                                              DOR001
HOLDC2   CLI   16(R7),C'S'                                     DOR001
         BNE   HOLDC3                                          DOR001
         MVC   RPTPREF(3),=CL3'SY-'                            DOR001
         BR    R8                                              DOR001
HOLDC3   MVC   RPTPREF(3),=CL3'US-'                            DOR001
         BR    R8                                              DOR001
         EJECT
         DC    H'0'
PATCH    DC    X'00'
         DC    C'PATCH AREA'
         DC    X'00'
         LTORG
CSIRECD  DSECT
CCACZID  DS    XL2  VARIED FOR INDEX
IRBCATG  DS    X      SAME  AS IRBRELA+0
IRBNAME1 DS    CL8
IRBRELA  DS    XL2 RELATIONSHIP ASSOCIATED
IRBOCCR  DS    XL2
IRBNAM2F DS    CL184     VARIED LENGTH MOST 8 CHARS
         PRINT   NOGEN
         PTFCOMN
         END
./       ADD   NAME=PTFCOMN
         MACRO
         PTFCOMN   &CSECT=NO
         TITLE    'PTFPARM - FINDFIX ROUTINE'
         AIF      ('&CSECT' EQ 'YES').CSECT
         DS    0F
PTFCOMN  DSECT
PARMPTR  EQU      *
.CSECT   ANOP
PARM     DC    AL1(11),CL11'PTFPARM'
         DC    CL16' &SYSDATE &SYSTIME'
         USING PARM,R10
         USING WORKAREA,R13
BEGIN    LA    R1,100
PTRABEND LA    R0,128
         SLL   R0,24
         OR    R1,R0
         SVC   13                          ABEND
FINDMOD  STM   R4,R7,SAVEREGS              SAVE REGS
         CLC   CDSTABS(4),NULLADDR
         BE    NOMOD
         L     R5,CDSTABE
         L     R7,CDSTABS
         ST    R5,XCDSTABS
         ST    R7,XCDSTABE
NEXTMOD  EQU   *
         SR    R4,R4
         L     R5,XCDSTABS
         SR    R5,R7
*        B     TRACE21      FINDMOD IS AN EXCELLENT  ALGORITHM.
         D     R4,F8
         SRL   R5,1
         M     R4,F8
         AR    R5,R7
         CLC   0(7,R5),0(R3)
*        B     TRACE2              DEBUG & DISPLAY
         BH    HIGHMOD
         BL    LOWMOD
THATMOD  LM    R4,R7,SAVEREGS              RESTORE REGS
         B     4(R12)
OKRC0    LM    R4,R7,SAVEREGS              RESTORE REGS
         B     0(R12)
ERRRC4   LM    R4,R7,SAVEREGS              RESTORE REGS
         B     4(R12)
HIGHMOD  ST    R5,XCDSTABS
MOREMOD  EQU   *
         CLC   XCDSTABE(4),XCDSTABS
         BL    NEXTMOD
         B     NOMOD
LOWMOD   LA    R7,8(R5)
         ST    R7,XCDSTABE
         B     MOREMOD
NOMOD    L     R4,INFOSREL
SRCHMOD  EQU   *
         LTR   R4,R4
         BZ    OKRC0
         CLC   4(7,R4),0(R3)
         BE    ERRRC4
         L     R4,0(R4)
         B     SRCHMOD
         DS    0F
CORESIZE DC    X'0002E630'
         DC    X'002DC6C0'
F64000   DC    F'64000'
         DC    F'0'
TABEND2  DC    F'0'
         DC    F'0'
         DC    H'0'
         DC    C'K0'
INFTABEA DC    H'0'
PTR31 DC       X'00101424'
         DC    X'140C1418'
         DC    X'1C282C24'
         DC    X'20242404'
         DC    X'2408'
SUPSYSM  DC    X'08'    CODE FOR SUPERCEDED
SUPNAME  DC    C'       '
SAVEFMID DC    CL8' '
SYSMCODE DC    X'01'    CODE FOR SYSMOD
SYSMODNM DC    C'       '
         DC    X'00'
         DC    H'0'
         DS    0F
FMIDREQA DC    F'00001'
SBLANKS  DC    CL16'                '
SMODDATA DC    CL16'                '
PTR40A   DC    X'11'
PRTLNEX  DC    X'70'
PRTLNE   DC    X'51'
         DS    0F
VPTFROUT DC    V(PTFROUT)
VPTFENV  DC    V(PTFENV)
VPTFINFO DC    V(PTFINFO)
VPTFFIX  DC    V(PTFFIX)
VPTFPARM DC    A(PARM)
SMODKEY1 DC    X'FFFFFFFF'
         DC    X'FFFFFFFF'
SMODKEY2 DC    X'FFFFFFFF'
         DC    X'FFFFFFFF'
SMODKEY3 DC    X'FFFFFFFF'
         DC    X'FFFFFFFF'
MAXDATE  EQU   *,8
         DC    X'FFFFFFFF'
SMODKEYB EQU   *,8
         DC    X'FFFFFFFF'
SMODKYAA DC    F'0'
         DS    0F
* -----------------------------------------------------------------
PTFMA    DCB   DDNAME=PTFMA,MACRF=(GM),LRECL=80,RECFM=FB,DSORG=PS,     *
               BLKSIZE=0
         ORG   PTFMA+33      TO EODAD FIELD
PTFMA1   DS    CL3           EODAD FIELD
         ORG   PTFMA+48      IO FLAGS
PTFMA2    DS    CL3
         ORG
* -----------------------------------------------------------------
INFOUT   DCB   DDNAME=INFOUT,MACRF=(PM),RECFM=FB,LRECL=8,DSORG=PS,     *
               BLKSIZE=0
         ORG   INFOUT+48
INFOUT1  DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
INFOIN   DCB   DDNAME=INFOIN,MACRF=(GM),RECFM=FB,LRECL=8,DSORG=PS ******
               BLKSIZE=0
         ORG   INFOIN+33
INFOIN1  DS    CL3          EODAD FIELD
         ORG   INFOIN+48
INFOIN2  DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
SMPCDS1  DCB   DDNAME=SMPCDS,MACRF=(RK),RECFM=FB,DSORG=DA,            **
               KEYLEN=8,BLKSIZE=256
         ORG   SMPCDS1+33
         DC    AL3(BEGIN) EODAD  ABEND
         ORG   SMPCDS1+48
SMFCDSX  DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
SMPCDS2  DCB   DDNAME=SMPCDS,MACRF=(RK),RECFM=FB,DSORG=DA,            **
               KEYLEN=8
         ORG   SMPCDS2+33
         DC    AL3(BEGIN) EODAD  ABEND
         ORG   SMPCDS2+48
SMPCDSY  DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
SYSPRINT DCB   DDNAME=SYSPRINT,MACRF=(PM),RECFM=FBA,LRECL=121,         *
               BLKSIZE=1210,DSORG=PS
         ORG   SYSPRINT+48
SYSPRT1  DS   CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
SMPCNTL  DCB   DDNAME=SMPCNTL,MACRF=(PM),RECFM=FB,LRECL=80,DSORG=PS, ***
               BLKSIZE=0
         ORG   SMPCNTL+48
SMPCNTL1 DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
SYSIN    DCB   DDNAME=SYSIN,MACRF=(GM),RECFM=F,LRECL=80,DSORG=PS
         ORG   SYSIN+33
SYSIN1 DS      CL3         EODAD FIELD
         ORG   SYSIN+48
SYSIN2 DS      CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
CONTROL  DCB   DDNAME=CONTROL,MACRF=(GM),RECFM=F,LRECL=80,DSORG=PS,    *
               BLKSIZE=0
         ORG   CONTROL+33
CNTL1    DS    CL3         EODAD FIELD
         ORG   CONTROL+48
CNTL2    DS    CL3         IOFLAGS
         ORG
* -----------------------------------------------------------------
         DS    0F
DSMPCDS  DC    C'SMPCDS  '
         DC    A(SMPCDS1)
DSMPCDS2 DC    C'SMPCDS  '
         DC    A(SMPCDS2)
DSYSIN   DC    C'SYSIN   '
         DC    A(SYSIN)
DCONTROL DC    C'CONTROL '
         DC    A(CONTROL)
DPTFMA   DC    C'PTFMA   '
         DC    A(PTFMA)
DINFOIN  DC    C'INFOIN  '
         DC    A(INFOIN)
DINFOUT  DC    C'INFOUT  '
         DC    A(INFOUT)
DSMPCNTL DC    C'SMPCNTL '
         DC    A(SMPCNTL)
DSYSPRNT DC    C'SYSPRINT'
         DC    A(SYSPRINT)
         DS    0F
         EJECT
         CNOP  0,4
*    ROUTINE TO FIND HOLD SYSMOD NAME IN SHORT TIME
FINDHLD  STM   R3,R7,SAVERHLD              SAVE REGS
         CLI   HOLDSWT,X'FF'
         BNE   NOHOLD
*        CLC   HOLDTABS(4),NULLADDR
*        BE    NOHOLD
         LR    R3,R5 GET SYSMOD NAME
         L     R5,HOLDTABE
         L     R7,HOLDTABS
         ST    R5,XCDSTABS
         ST    R7,XCDSTABE
NEXTHLD  EQU   *
         SR    R4,R4
         L     R5,XCDSTABS
         SR    R5,R7
         D     R4,F24    ENTRY IS 24 BYTES LONG
         SRL   R5,1
         M     R4,F24
         AR    R5,R7
         CLC   1(7,R5),20(R3)
         BH    HIGHHLD
         BL    LOWHLD
         ST    R5,HOLDADDR
THATHLD  LM    R3,R7,SAVERHLD              RESTORE REGS
         B     4(R12)                      HAVE HOLDDATA
NOHOLD   EQU   *
OKRC0H   LM    R3,R7,SAVERHLD              RESTORE REGS
         B     0(R12)                      HAVE NO HOLDDATA
HIGHHLD  ST    R5,XCDSTABS
MOREHLD  EQU   *
         CLC   XCDSTABE(4),XCDSTABS
         BL    NEXTHLD
         B     NOHOLD
LOWHLD   LA    R7,24(R5)
         ST    R7,XCDSTABE
         B     MOREHLD
         EJECT
* THE BELOW INSTRUCTIONS ARE WRITTEN OR EXPANDED BY DOR/CDSI.
TRACE21  EQU   *
*        DURING TESING, THE ALGORITHM IS TRACED BY DISPLAYING STRINGS
*         OF R3 AND R5 PTRS TO SEE IF THAT FLOW IS IN EFFECTIVE.
*         THIS ALGORITHM BY SWIZERLAND IS THE MOST EFFECTIVE AND FASTER
*         ONE I HAVE EVER HAD.  DOR.  HENCE, TRACE21 AND TRACE2 IS
*         IS WRITTEN BY DOR AND NOT USED UNLESS YOU PLAY WITH IT.
         LR    R5,R7
TRACE2   EQU   *
         MVC   PRTLINE+1(7),0(R3)
         MVC   PRTLINE+10(7),0(R5)
         MVC   PRTLINE+20(7),MFINDMOD
         PUT   SYSPRINT,PRTLINE
         MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
         CLC   0(7,R5),0(R3)
         BH    HIGHMOD
         BL    LOWMOD
         B     THATMOD
MFINDMOD DC    CL7'FINDMOD'
*
         EJECT
*
*        WHEN PARM=DEBUG IS GIVEN, THE ROUTINE WILL PRINT ANY THING
*           YOU GIVE ON PRTLINE.
*
         DS     0F
PRTDEBUG EQU   *
         CLI   DEBUG,X'FF'
         BNE   PRTDEOUT
         PUT   SYSPRINT,PRTLINE
PRTDEOUT MVI   POS2,C' '
         MVC   POS3(100),POS2
         BR    R12
         SPACE 4
         DROP  R13
         USING WORKAREA,R9
PRTDEON  PUT   SYSPRINT,PRTLINE
         MVI   POS2,C' '
         MVC   POS3(100),POS2
         BR    R12
PRTDEFR9 EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOR9
         PUT   SYSPRINT,PRTLINE
PRTDEOR9 MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
         BR    R8
         DROP  R9
         USING WORKAREA,R13
*
*        WHEN PARM=DEFIX IS GIVEN, THE ROUTINE WILL PRINT ANY THING
*           YOU GIVE ON PRTLINE.
*
PRTDEFIX EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         PUT   SYSPRINT,PRTLINE
         CLI   HEXSWT,X'FF'
         BNE   PRTDHEX1
         MVI   HEXSWT,X'00'
         STM   R3,R5,SAVERHLD
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,POS10
         LA    R4,HEXLINE+1
         LA    R5,8
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         LA    R3,POS24
         LA    R4,HEXLINE+25
         LA    R5,8
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         PUT   SYSPRINT,HEXLINE
         MVI   HEXLINE,X'40'
         MVC   HEXLINE+1(100),HEXLINE
         LA    R3,POS36
         LA    R4,HEXLINE+1
         LA    R5,36
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
PRTHEXLN PUT   SYSPRINT,HEXLINE
         MVI   HEXLINE,X'40'
         MVC   HEXLINE+1(100),HEXLINE
PRTDHEXD LM    R3,R5,SAVERHLD
PRTDEOUX MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
         BR    R8
PRTDHEX1 CLI   HEXSWT,X'FE'
         BNE   PRTDEOUX
         MVI   HEXSWT,X'00'
         STM   R3,R5,SAVERHLD
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,POS2+9
         LA    R4,HEXLINE+1
         LA    R5,4
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         LA    R3,POS2+14
         LA    R4,HEXLINE+10
         LA    R5,36
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         B     PRTHEXLN
PRT345   EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVI   HEXSWT,X'FF'
* SAMPLE MVC   POS2(8),=CL8'LABEL'
* SAMPLE BAL   R8,PRT345
         MVC   POS10(8),0(R3)
         MVC   POS20(2),DATAR3
         MVC   POS24(8),0(R4)
         MVC   POS32(2),DATAR4
         MVC   POS36(36),0(R5)
         MVC   POS55+18(2),DATAR5
         B     PRTDEFIX
PRT59MIS EQU   *
         MVC   POS24(4),SMODMISE
         MVC   POS32(3),DATAMI
PRT59    EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVI   HEXSWT,X'FF'
* SAMPLE MVC   POS2(8),=CL8'LABEL'
* SAMPLE BAL   R8,PRT59
         MVC   POS10(8),0(R5)
         MVC   POS20(2),DATAR5
         MVC   POS36(20),0(R9)
         MVC   POS55+2(2),DATAR9
         B     PRTDEFIX
PRTFMID  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVI   HEXSWT,X'FF'
         MVC   POS36(20),0(R3)
         MVC   POS55+3(4),DATAFI
         B     PRTDEFIX
PRTSMOD5 EQU   *
         MVC   POS2+14(36),0(R5) DOR001
PRTSMODX CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVI   HEXSWT,X'FE'
         MVC   POS2+9(4),FDUMMY DOR001
         B     PRTDEFIX
PRTSMOD3 EQU   *
         MVC   POS2+14(36),0(R3) DOR001
         B     PRTSMODX
PRTHOLD  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(13),HOLD0
         MVC   POS24(100),CSIKEY
         PUT   SYSPRINT,PRTLINE
         STM   R3,R5,SAVERHLD
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,POS10
         LA    R4,HEXLINE+1
         LA    R5,13
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         PUT   SYSPRINT,HEXLINE
         LA    R3,POS24
         LA    R4,HEXLINE+1
         LA    R5,60
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         B     PRTHEXLN
PRTCSI2  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(13),BYTE0
         MVC   POS24(100),CSIKEY2
PRTCSIC  PUT   SYSPRINT,PRTLINE
         STM   R3,R5,SAVERHLD
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,POS10
         LA    R4,HEXLINE+1
         LA    R5,13
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         PUT   SYSPRINT,HEXLINE
         LA    R3,POS24
         LA    R4,HEXLINE+1
         LA    R5,60
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         B     PRTHEXLN
PRTCK7  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(7),20(R7)
         B     PRTCHK
PRTCK5  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(7),20(R7)
PRTCHK   MVC   POS24(13),1(R6)
         B     PRTCSIC
PRTCSIG EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(13),GLOB0
         B     PRTCHKZ
PRTCSIA EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS10(13),ARGU0
PRTCHKZ  MVC   POS24(23),0(R6)
         B     PRTCSIC
PRTRCG  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS2(7),DATAEG
         MVC   POS10(13),GLOB0
         MVC   POS24(23),CSIKEY
         B     PRTRETC
PRTRCC  EQU   *
         CLI   DEFIX,X'FF'
         BNE   PRTDEOUX
         MVC   POS2(6),DATAEC
         MVC   POS10(13),BYTE0
         MVC   POS24(23),CSIKEY2
PRTRETC  MVC   POS50(3),DATARC
         STM   R3,R5,SAVERHLD
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,SAVER15
         LA    R4,POS54
         LA    R5,4
         CONVERT (R4,R3,R5)   CONVERT TO HEX DISPLAY (MAX LEN= 50)
         LM    R3,R5,SAVERHLD
         B     PRTCSIC
DATAEC   DC    CL6'EXTCSI'
DATAEG   DC    CL7'EXTGLOB'
DATAR3   DC    CL2'<3'
DATAR4   DC    CL2'<4'
DATAR5   DC    CL2'<5'
DATAR9   DC    CL2'<9'
DATAMI   DC    CL3'<MI'
DATARC   DC    CL3'RC='
DATAFI   DC    CL4'FMID'
         EJECT
*        KEY ARGUMENT 1  FOR TGT/DLIB CSI
ARGU0    DC    X'00'
ARGU1    DC    X'00'
ARGU2    DC    X'00'
ARGUNAME DC    CL8' '
ARGURELA DC    XL2'0000'
*        KEY ARGUMENT 2  FOR TGT/DLIB CSI
BYTE0    DC    X'00'
BYTE1    DC    X'00'
BYTE2    DC    X'00'
BYTENAME DC    CL8' '
BYTERELA DC    XL2'0000'
*        KEY ARGUMENT FOR GLOBAL CSI
GLOB0    DC    X'00'
GLOB1    DC    X'00'
GLOB2    DC    X'00'
GLOBNAME DC    CL8' '
GLOBRELA DC    XL2'0000'
*        KEY ARGUMENT FOR GLOBAL CSI
HOLD0    DC    X'00'
HOLD1    DC    X'00'
HOLD2    DC    X'00'
HOLDNAME DC    CL8' '
HOLDRELA DC    XL2'0000'
*        MISC CONSTANTS
         DS    0F
SMODNME  DC    CL8' '
SAVEPOOL DC    F'0'
SYSREGS  DC    18F'0' SYSTEM ENTRY REGISTERS
REGSROUT DC    18F'0' PTFENV, PTFINFO, OR PTFFIX SAVE REGS OF PTFROUT
PTFREGV  DC    18F'0' PTFVSAM SAVEREGS PTFVSAM USE R9
CSISTAR  DC    CL17'CSITGT READ START'
CSIEND   DC    CL15'CSITGT READ END'
CSIGSTAR DC    CL17'SMPCSI READ START'
CSIGEND  DC    CL15'SMPCSI READ END'
ZONEDATA DC    CL8' '
ZONEINDX DC    XL4'FFFFFFFF'    ZONE INDEX PRIMARY SECONDARY
*        CONTENTS FOR PTF ROUTINES
         DS    0F
ONE      DC    F'00001'
F0       DC    F'0'
F1       DC    F'00001'
F2       DC    F'00002'
F3       DC    F'00003'
F4       DC    F'00004'
F5       DC    F'00005'
F6       DC    F'00006'
F7       DC    F'00007'
F8       DC    F'00008'
F8VAL    DC    F'00008'
F9       DC    F'00009'
F10      DC    F'00010'
F11      DC    F'00011'
F12      DC    F'00012'
F13      DC    F'00013'
F14      DC    F'00014'
F15      DC    F'00015'
F16      DC    F'00016'
F20      DC    F'00020'
F24      DC    F'00024'
F30      DC    F'00030'
F31      DC    F'00031'
F36      DC    F'00036'
F56      DC    F'00056'
H4       DC    H'4'
H61      DC    H'61'
H142     DC    H'142'
         DS    0F
*        PTFVSAM COMMANDS
EMDRPL0  CALL  ,(MSDRPL0),VL,MF=L
EMDRPL1  CALL  ,(MSDRPL1),VL,MF=L
EMDRPL2  CALL  ,(MSDRPL2),VL,MF=L
EMDRPL3  CALL  ,(MSDRPL3),VL,MF=L
EMDRPL4  CALL  ,(MSDRPL4),VL,MF=L
EMDRPL5  CALL  ,(MSDRPL5),VL,MF=L
EMDRPL6  CALL  ,(MSDRPL6),VL,MF=L
EMDRPL7  CALL  ,(MSDRPL7),VL,MF=L
EMDRPL8  CALL  ,(MSDRPL8),VL,MF=L
EMDRPL9  CALL  ,(MSDRPL9),VL,MF=L
EMDRPL10 CALL  ,(MSDRPL10),VL,MF=L
EMDRPL11 CALL  ,(MSDRPL11),VL,MF=L
EMDRPL12 CALL  ,(MSDRPL12),VL,MF=L
EMDRPL13 CALL  ,(MSDRPL13),VL,MF=L
EMDRPL14 CALL  ,(MSDRPL14),VL,MF=L
EMDRPL15 CALL  ,(MSDRPL15),VL,MF=L
ECALLCSI CALL  ,(FCALLCSI),VL,MF=L
EGETCSI  CALL  ,(FGETCSI),VL,MF=L
ECALLGLB CALL  ,(FCALLGLB),VL,MF=L
EGETGLB  CALL  ,(FGETGLB),VL,MF=L
EGETGLB2 CALL  ,(FGETGLB2),VL,MF=L
ECALGLB2 CALL  ,(FCALGLB2),VL,MF=L
ECLSECSI CALL  ,(FCLSECSI),VL,MF=L
ECLSEGLB CALL  ,(FCLSEGLB),VL,MF=L
EMODACB0 CALL  ,(MSDACB0),VL,MF=L
EMODACB1 CALL  ,(MSDACB1),VL,MF=L
*        PTFVSAM COMMAND CODES
MSDRPL0  DC    X'04',AL3(0)
MSDRPL1  DC    X'04',AL3(1)
MSDRPL2  DC    X'04',AL3(2)
MSDRPL3  DC    X'04',AL3(3)
MSDRPL4  DC    X'04',AL3(4)
MSDRPL5  DC    X'04',AL3(5)
MSDRPL6  DC    X'04',AL3(6)
MSDRPL7  DC    X'04',AL3(7)
MSDRPL8  DC    X'04',AL3(8)
MSDRPL9  DC    X'04',AL3(9)
MSDRPL10 DC    X'04',AL3(10)
MSDRPL11 DC    X'04',AL3(11)
MSDRPL12 DC    X'04',AL3(12)
MSDRPL13 DC    X'04',AL3(13)
MSDRPL14 DC    X'04',AL3(14)
MSDRPL15 DC    X'04',AL3(15)
FCALLCSI  DC    X'0C',AL3(0)
FGETCSI   DC    X'10',AL3(0)
FCALLGLB DC    X'14',AL3(0)
FGETGLB  DC    X'18',AL3(0)
FGETGLB2 DC    X'20',AL3(0)
FCALGLB2 DC    X'24',AL3(0)
FCLSECSI  DC    X'00',AL3(0)
FCLSEGLB DC    X'00',AL3(1)
MSDACB0  DC    X'1C',AL3(0)
MSDACB1  DC    X'1C',AL3(1)
         SPACE  2
         DS    0F
*        PTFFIX CONSTANTS
*REPFLAG  DC    X'00'
*HOLDSWTX DC    X'00' HOLD USE RPLGLOB2 MUST POINT SAVEKEYG TO RPLGLOB
FINISH   DC    CL8'FINISHED'
NOSMOD   DC    CL16'NO SYSMODS FOUND'
ISSUPMSG DC    CL16' SUPERCEDED BY'
APPLYMSG DC    CL8'APPLY S('
MSG1     DC    CL16'WHICH ARE NOT IN'
MSG2     DC    CL16'YOUR PTF LIBRARY'
FUNCMSG  DC    CL12'FOR FUNCTION'
INSTLMSG DC    CL12'INSTALLATION'
TITLE1   DC    CL30'REQUESTED INSTALLATION REPORT '
TITLE2   DC    CL10'FOR SYSMOD'
TITLERVD DS    0CL80
         DC    CL80' '
         ORG   TITLERVD+12
         DC    CL2'/*'
         ORG   TITLERVD+22
         DC    CL37'SYSMOD     FMID    LEVEL    HOLD RCVD'
         ORG   TITLERVD+70
         DC    CL10'/* '
IFREQ    DC    C'IF REQ'
IS       DC    C'IS'
EARLYMSG DC    CL18'EARLIER REFERENCED'
TITLE3   DC    CL14'IN THIS REPORT'
STAR2    DC    CL2'**'
RECVCMD  DC    CL10'RECEIVE S('
COMMBEG  DC    C'/*'
COMMEND  DC    C'*/'
NOTECMD  DC    CL6'NOTE :'
PRE      DC    C'PRE'
REQ      DC    C'REQ'
FOR      DC    C'FOR'
TITLE4   DC    CL25'ALREADY INSTALLED IN YOUR'
NOT      DC    CL3'NOT'
TITLE5   DC    CL17'AVAILABLE IN YOUR'
TITLE6   DC    CL11'PTF LIBRARY'
TITLE7   DC    CL27'RESULTING RECEIVE AND APPLY'
TITLE8   DC    CL11'STATEMENT :'
END1     DC    CL3') .'
CHECKEND DC    CL9') CHECK .'
TITLE9   DC    CL15'FOUND SYSMOD(S)'
TITLE10  DC    CL15'NO FMID MATCHED'
TITLE11  DC    CL16' HAS NO SYSMODS'
*        HEADER LINE / PTFROUT CONSTANTS
HDRLINE  DS    0CL58
HDRVERS  DC    CL15'FINDFIX 2.2 -- '
HDRSESS  DC    CL16'SESSION STARTED '
INDEX    DC    CL4' ON '
DATERSLT DC    CL8'MM/DD/YY',CL4' AT '
TIMERSLT DC    XL11'4021207A20207A20204B20'
HDRLNG   EQU   *-HDRLINE
*        VSAM CONSTANTS
CSISWT   DC    X'00'
GLOBSWT  DC    X'00'
         DS    0F
*   FOR ALL VSAM DSN/RPL
LASTCI   DC    F'0'
FIXLEN   DC    H'0'
INIT     DS    X
         DS    0F
*  PATCH FOR PTFCOMN
PPATCH   EQU   *
         DC    C'PATCH AREA'
         DC    H'0'
*        DC    33F'0'
         DS    0F
*        REQS DEFINITIONS  ( R0-R15)
         REQU
         PTFWORK
         MEND
./       ADD   NAME=PTFENV
         TITLE   'PTFENV - FINDFIX ROUTINE '
         PRINT NOGEN
PTFENV   CSECT
         ENTRY EODSYSIN
         ENTRY EODCNTL
         USING  *,R11
ENV      B     @PROLONG-*(,15)
         DC    AL1(11),CL11'PTFENV'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         USING PARMPTR,R10
         LA    R15,REGSROUT
         ST    R15,8(R13)                  FORWARD POINTER
         MVC   0(72,R15),0(R13)            SAVE REGS
         ST    R13,4(R15)                  BACKWARD POINTER
         USING WORKAREA,R13
         LA    R2,2048(R11)
         USING ENV+4096,R2
         LA    R2,2048(R2)
         BAL   R12,GETTABLE                PERFORM
         CLI   MODFLAG,X'00'
         BNE   EXIT
         CLI   PTR40,X'FF'
         BE    NOCSIRUN
         BAL   R12,CSMPECSI               TGT/DLIB APPLIED SYSMODS
NOCSIRUN CLI   MODFLAG,X'00'
         BNE   EXIT
         BAL   R12,CALLCDS                 PERFORM
         CLI   PTR40,X'FF'
         BE    EXIT
         BAL   R12,CSMPEGLB                GLOBAL RECEIVED SYSMODS
EXIT     EQU   *
         MVC   0(72,R13),REGSROUT
         L     R13,4(R13)
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
ENDREC   EQU   *
         MVI   PTR40,X'FF'
         B     PUTREC
ENDREC2  EQU   *
         MVI   PTR39A,X'FF'
         B     PUTREC
PRINTMSG EQU   *
         PUT   SYSPRINT,PRTLINE
         MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
         BR    R3
GETTABLE EQU   *
         L     R9,TABLEBEG
         ST    R9,IOBUFFER
         LA    R9,264(R9)
         ST    R9,HOLDTABS
         ST    R9,HOLDTABE
         A     R9,=F'48000'
         SLR   R4,R4
         LA    R5,CONTROL
         MVC   POS2(18),CNTLBEG
         BAL   R3,PRINTMSG
         MVC   POS17(5),SBLANKS
         TM    CNTL2,X'10'
         BNO   MFLAG0C
PUTREC   EQU   *
         LR    R1,R5
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
         MVC   POS2(80),RECORD
         PUT   SYSPRINT,PRTLINE
         CLI   RECORD,C' '
         BE    PUTREC
         CLC   RECORD(5),ZONE
         BE    ZONEREC
         CLC   RECORD(7),INFORUN
         BE    ENDREC
         CLC   RECORD(4),DUMPMSG
         BE    ENDREC2
         CLC   RECORD(5),FMID
         BE    FMIDREC
         CLC   RECORD(8),MAXDATEM
         BE    CONTSYM
         L     R3,CNTLSMOD
         LTR   R3,R3
         BNZ   CKMFLAG
         ST    R9,CNTLSMOD
         ST    R4,0(R9)
*  FORMAT OF FIRST SYSMOD IS
*            1 1
* 0123 4567890 1
*   ×  ×       ×
*   ×  ×       +-----------
*   ×  +------------------- SYSMOD NAME AS REQUIRED
*   +---------------------- POINTER OF FIRST SYSMOD ADDRESS WHICH HAS
*                           THE ALL SYSMODS UNDER THAT SYSMOD.
*  FORMAT OF SUBSEQUENT SYSMOD IS
*
*   0  1234567
*   ×  ×
*   ×  +------------------- SYSMOD NAME AS REQUIRED
*   +---------------------- TYPE OF SYSMOD
*                           00 = DEFAULT
SAVESMOD EQU   *
         MVC   4(7,R9),RECORD
         LA    R9,12(R9)
         ST    R4,0(R9)
         B     PUTREC
CKMFLAG  EQU   *
         CLC   0(4,R3),NULLADDR
         BE    SAVTADDR
         L     R3,0(R3)
         B     CKMFLAG
SAVTADDR EQU   *
         ST    R9,0(R3)
         B     SAVESMOD
MFLAG0C  EQU   *
         MVI   MODFLAG,X'0C'
         BR    R12
CONTSYM  EQU   *
         CLI   PTR50,X'61'
         BNE   ERRORMAX
         MVC   MAXDATE(8),PTR49
         B     PUTREC
ZONEREC  EQU   *
         MVC   ZONEDATA(8),RECORD+5
         B     PUTREC
ERRORMAX EQU   *
         MVC   POS2(15),ERMAXDT
         BAL   R3,PRINTMSG
         MVC   POS2(16),SBLANKS
         B     PUTREC
FMIDREC  L     R3,FMIDREQ
         LTR   R3,R3
         BNZ   FMIDREC2
         ST    R9,FMIDREQ
         ST    R4,0(,R9)
*  FORMAT OF FMIDREQ IS :     (20 BYTES ENTRY)
*            11 1111 1111
* 0123 45678901 2345 6789
*   ×  ×        ×    ×
*   ×  ×        ×    +----- ADDRESS OF LAST CHAINED SYSMOD THAT FOLLOWS
*   ×  ×        ×           FROM THE BEGIN ADDRESS.
*   ×  ×        +---------- ADDRESS OF FIRST SYSMOD ENTRY THAT
*   ×  ×                    IS BEING CHAINNED FOR THAT FMID
*   ×  +------------------- FMID NAME AS REQUIRED
*   +---------------------- ADDRESS OF NEXT FMID ENTRY. NULL ADDRESS
*                           ID THE LAST FMID ENTRY
FMIDREC3 MVC   4(7,R9),PTR48
         XC    11(9,R9),11(R9)
         LA    R9,20(R9)
         ST    R4,0(,R9)
         B     PUTREC
FMIDREC2 CLC   0(4,R3),NULLADDR
         BE    FMIDREC4
         L     R3,0(,R3)
         B     FMIDREC2
FMIDREC4 ST    R9,0(,R3)
         B     FMIDREC3
EODCNTL  EQU   *
         TM    PTR40,X'FF'
         BO    EODCNTL2
         CLC   CNTLSMOD(4),NULLADDR
         BE    MFLAG0C
EODCNTL2 MVC   POS2(16),CNTLEND
         BAL   R3,PRINTMSG
         TM    SMFCDSX,X'10'
         BCR   14,R12
         MVC   POS2(17),CDSSTRT
         BAL   R3,PRINTMSG
         MVC   POS5(16),SBLANKS
         L     R5,IOBUFFER
         LA    R6,SMPCDS1
READCDS  BAL   R1,READCDSX                 PARM SET BRCH
READCDS1 EQU   *
         DC    F'0'                  +0
         DC    X'00800000',F'0'      +4
         DC    F'0'                  +8 DCB ADDR
         DC    F'0'                 +12 TABLE PTR
READCDSX ST    R6,8(R1)
         ST    R5,12(R1)
         L     R15,8(R1)
         L     R15,48(,R15)
         BALR  R14,R15                     STD LINKAGE
         LA    R1,READCDS1
         L     R14,8(,R1)
         L     R15,52(,R14)
         BALR  R14,R15                     STD LINKAGE
         TM    PATCH,X'80'
         BO    PASSTWO
         OI    PATCH,X'80'
         LA    R1,600
         CLI   10(R5),X'00'
         BNE   PTRABEND
         MVC   CDSDATA,10(R5)
         B     NEXTCDS
PASSTWO  OI    PATCH,X'40'
         CLI   0(R5),X'FF'
         BE    CDSOFF
NEXTCDS  LA R8,10(,R5)
FINDPTF  CLI   0(R8),C'3' SYSMOD CODE OF SMP4 CDS
*                         OTHER CODES IGNORED (A=ASSEM,P=DLIB,D=LMOD,
*                          G=MAC,J=MOD,M=SRC, ETC)
         BE    PTFSYM
         BH    CONVERT       X'FF'=END OF MEMBER...BEGIN TO UNPACK
         SR    R3,R3
         IC    R3,11(R8)
         N     R3,F31
         SLL   R3,1
         LA    R8,12(R3,R8)
         LA    R7,8(,R5)
         LH    R3,8(,R5)
         LA    R7,0(R3,R7)
         CLR   R8,R7              END OF BUFFER?
         BL    FINDPTF            NO
         B     READCDS            YES
CDSOFF   OI    PATCH,X'20'
         B     NEXTCDS
CHKCDS   TM    17(R8),X'80'
         BO    SETUPCDS
         B     SETU2CDS
SMODOK   MVI   7(R9),X'00'
         TM    14(R8),X'A0'
         BZ    CHKCDS
         OC    7(1,R9),14(R8)
SETUPCDS MVC   0(7,R9),0(R8)      MOVE PACKED MEMBER TO STORAGE
SETU2CDS LA    R9,8(R9)
         SR    R3,R3
         IC    R3,11(R8)
         N     R3,F31
         SLL   R3,1
         LA    R8,12(R3,R8)
         LA    R3,8(R9)           NEXT POINTER
         L     R4,TABLEND         END OF TABLE
         CLR   R3,R4
         BNL   GETEXIT            NOT ENOUGH STORAGE
         LA    R7,8(,R5)
         LH    R3,8(,R5)
         LA    R7,0(R3,R7)
         CLR   R8,R7
         BL    FINDPTF
         B     READCDS
PTFSYM   TM    PATCH,X'08'
         BO    SMODOK
         ST    R9,CDSTABS
         OI    PATCH,X'08'
         B     SMODOK
GETEXIT  MVI   MODFLAG,X'0B'
         BR    R12
CONVERT  ST    R9,CDSTABE
         LA    R9,0(R9)
         L     R8,CDSTABS
         LA    R8,0(R8)
NXTUNPK  CLR   R8,R9
         BNLR  R12
         L     R7,0(R8)
         SLL   R7,8
         BAL   R3,UNPACK                   PERFORM
         LA    R8,4(R8)
         L     R7,0(R8)
         BAL   R3,UNPACK2                  PERFORM
         LA    R8,4(R8)
         B     NXTUNPK
UNPACK   LA    R5,4
         LR    R4,R8
UNPKLOOP SR    R6,R6
         SLDL  R6,6               BREAK MEMBER INTO SIX BITS
         STC   R6,0(R4)
         LA    R4,1(R4)
         BCT   R5,UNPKLOOP
         TR    0(4,R8),CDSKEYTB
         BR    R3
UNPACK2  LA    R5,3
         LR    R4,R8
UNPKLOP2 SR    R6,R6
         SLDL  R6,6
         STC   R6,0(R4)
         LA    R4,1(R4)
         BCT   R5,UNPKLOP2
         TR    0(3,R8),CDSKEYTB
         BR    R3
CALLCDS  EQU   *
         ST    R9,ENDTBADR
         TM    SMPCDSY,X'10'
         BNO   NOPNCDS
         TM    SMFCDSX,X'10'
         BNO   NOPNCDS
         MVC   CDSNAME(3),BLANKOUT
         LA    R1,SMPCDS2
         LA    R0,CDSNAME
         L     R15,84(,R1)
         BAL   R14,4(R15)                  PERFORM
         L     R8,ENDTBADR
         LA    R7,SMPCDS2
         BAL   R1,READ2CDS                 PARM SET BRCH
READ2CDX EQU   *
         DC    F'0'                  +0
         DC    X'00800000',F'0'      +4
         DC    F'0'                  +8 DCB ADDR
         DC    F'0'                 +12 TABLE PTR
READ2CDS ST    R7,8(R1)
         ST    R8,12(R1)
         L     R15,8(R1)
         L     R15,48(,R15)
         BALR  R14,R15                     STD LINKAGE
         LA    R1,READ2CDX
         L     R14,8(,R1)
         L     R15,52(,R14)
         BALR  R14,R15                     STD LINKAGE
         MVC   CDSISREL(4),8(R8)
         MVC   POS2(15),CDSEND
         BAL   R3,PRINTMSG
NOPNCDS  TM    SYSIN2,X'10'
         BCR   14,R12
         MVC   POS2(16),SYSSTRT
         BAL   R3,PRINTMSG
         LA    R7,SYSIN
NXTSYSIN EQU   *
         LR    R1,R7
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
         MVC   POS2(80),RECORD
         PUT   SYSPRINT,PRTLINE
         LA    R6,10
         LA    R5,RECORD
         CLC   RECORD(9),NOCOL
         BE    NOTCOL
         CLC   RECORD(5),SREL
         BNE   NOTSREL
         MVC   SYSISREL(4),PTR48
         B     NXTSYSIN
NOTCOL   MVI   COLLECT,X'FF'
         B     NXTSYSIN
NOTSREL  CLI   0(R5),C' '
         BE    NXTSYSIN
         L     R4,ENDTBADR
         L     R3,INFOSREL
         LTR   R3,R3
         BNZ   NINFOTAB
         ST    R4,INFOSREL
MVCSYSIN MVC   0(4,R4),NULLADDR
         MVC   4(7,R4),0(R5)
         MVI   11(R4),X'A0'
         LA    R4,12(R4)
         ST    R4,ENDTBADR
         LA    R5,8(R5)
         BCT   R6,NOTSREL
         B     NXTSYSIN
NINFOTAB CLC   0(4,R3),NULLADDR
         BE    ENDINFTB
         L     R3,0(R3)
         B     NINFOTAB
ENDINFTB ST    R4,0(R3)
         B     MVCSYSIN
EODSYSIN MVC   POS2(16),SYSEND
         BAL   R3,PRINTMSG
         BR    R12
         DS    0F
CSMPECSI EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        TO REPLACE SMP/E CSI FOR SMP4 CDS
*        READ VSAM CSI TARGET OR DLIB DSN (DO NOT USE GLOBAL)
*        SELECT  PTF NAME AND ITS SUPERCEDED SYSMODS
*        STORE INTO CDSTABLE.
*
         ST   R12,CSMPER12
*        MODCB  RPL=RPLCSI,ARG=BYTE0,KEYLEN=1,
*               OPTCD=(LOC,GEN,KGE)
         CALL  PTFVSAM,MF=(E,EMDRPL8) MODIFY RPL WITH 1 BYTE KEY SEQ
         CALL  PTFVSAM,MF=(E,ECALLCSI) OPEN AND GET VSAM RECORD
         CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         MVC   POS2(17),CSISTAR
         BAL   R3,PRINTMSG
         ST    R9,CDSTABS
*        ST    R9,SMODMISS
GETLOOP  CALL  PTFVSAM,MF=(E,EGETCSI) GET NEXT VSAM RECORD
GETSEQ   CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         LA    R1,CSIKEY2
         USING CSIRECD,R1
         CLI   IRBCATG,X'02'         ZONE INDEX
         BE    ZONEIX
         CLC   ZONEINDX(2),=XL2'FFFF'
         BE    CHKLOOP               GO ON UNTIL ZONEIINDEX IS MATCHED
         CLC   ZONEINDX(2),CCACZID   CSI RECORD EQUALS ZONE INDEX
         BNE   GETLOOP               GO ON UNTIL ZONEIINDEX IS MATCHED
         CLI   IRBCATG,X'10'         ZONE FOR SREL
         BE    ZONEHIT
         CLI   IRBCATG,X'26'
         BH    ENVEODYD    IGNORE SRC LISTING (30) LOADMOD (31)
*                             ++HOLD CARDS (32)
         BNE   GETLOOP
         CLC   SMODNME(8),IRBNAME1
         BE    NAMEOK
         BH    ENVEODYD     PROBABLY MORE THAN ONE ZONE IN CSI DSN
NEWSMOD  MVC   SMODNME(8),IRBNAME1
         B     GETLOOP
CHKLOOP  EQU   *
         CLI   IRBCATG,X'02'
         BNH   GETLOOP
         MVC   POS2(12),=CL12'ERROR: 900 -'
         MVC   POS13(8),ZONEDATA
         MVC   POS22(30),=CL30'-ZONENAME NOT FOUND IN CSITGT'
*                              1234567890123456789012345678901234
         BAL   R3,PRINTMSG
         ABEND 920,DUMP    ZONE NAME DID NOT BELONG TO CSITGT
ZONEIX   EQU   *
         CLC   IRBNAM2F(8),ZONEDATA
         BNE   GETLOOP
         MVC   ZONEINDX(4),IRBNAME1 ZONE INDEX ASSOCIATED TO ZNAME
         MVC   BYTE0(2),ZONEINDX
         CALL  PTFVSAM,MF=(E,EMDRPL10) MODIFY RPL WITH 2 BYTE KEY KGE
         CALL  PTFVSAM,MF=(E,ECALLCSI) OPEN AND GET VSAM RECORD
         CALL  PTFVSAM,MF=(E,EMDRPL11) MODIFY RPL WITH 2 BYTE KEY SEQ
         B     GETSEQ
ZONEHIT  CLC   IRBRELA,=XL2'1021'     SREL
         BNE   GETLOOP
         MVC   CDSISREL(4),IRBNAM2F   SREL
         B     GETLOOP
NAMEOK   CLC   IRBRELA,=XL2'2601'     TYPE=PTF OR FUNCTION OR UNKNOWN
         BNE   GETLOOP
ZONEOK   MVI   CSIFLAG,X'00'
         CLC   IRBNAM2F(3),=CL3'UNK'
         BE    CSISUP               AUTOMATICALLY SUPERCEDED
         MVI   CSIFLAG,X'FE'
         CLC   IRBNAM2F(3),=CL3'FUN'
         BE    DOPTF
         CLC   IRBNAM2F(3),=CL3'PTF'
         BNE   GETLOOP
         MVI   CSIFLAG,X'FF'
DOPTF    CALL  PTFVSAM,MF=(E,EGETCSI) GET NEXT VSAM RECORD
         CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODAD
         LA    R1,CSIKEY2
         USING CSIRECD,R1
         CLC   SMODNME(8),IRBNAME1
         BNE   NEWSMOD                    NOT ACCEPT/APPLIED
         CLC   IRBRELA,=XL2'2602' ATTRIBUTE  IOPPSTAT
         BNE   DOPTF
CSIATTR  TM     IRBNAM2F,X'20'            ACCEPTED
         BO     CSIPTF
         TM     IRBNAM2F,X'04'            PTF IS SUPED OR DELETED.
         BO     CSISUPX
         TM     IRBNAM2F,X'80'            APPLIED
         BZ     GETLOOP
*.....................................    STORE INTO CDS TABLE
CSIPTF   CLI    CSIFLAG,X'FF'             PTF MUST BE APPLIED
         BNE    CSIFUNC
         MVC    CSIFLAG(1),IRBNAM2F       IOPSSTAT FLAG AS CSIFLAG
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'00'               CLEAR IT (UNUSED)
         B      CSISUPS
CSISUPX  TM     IRBNAM2F+3,X'80'            PTF IS SUPED .
         BZ     GETLOOP
CSISUP   MVC    CSIFLAG(1),IRBNAM2F       IOPSSTAT = CSIFLAG
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'00'               CLEAR IT (UNUSED)
         B      CSISUPS
CSIFUNC  CLI    CSIFLAG,X'FE'            FUNCTION MUST BE APPLIED
         BNE    NEWSMOD
         MVI    CSIFLAG,X'00'
         MVC    0(7,R9),IRBNAME1          PTF SYSMOD NAME TO CDS TAB
         MVI    7(R9),X'21'               CLEAR IT (UNUSED)
CSISUPS  LA     R9,8(R9)                  NEXT SLOT
         ST     R9,CDSTABE                SAVE END OF TABLE
         LA     R3,8(R9)                  NEXT SLOT
         L      R4,TABLEND
         CLR    R3,R4
         BNL    CSIEXIT
         B      NEWSMOD                    FOR MORE SUPERCEDED
CSIEXIT  EQU   *
         MVI   MODFLAG,X'0B'
         B     ENVEODXD
* ENVEODXD CLOSE (VSAMCSI)
ENVEODYD CALL  PTFVSAM,MF=(E,ECLSECSI) CLOSE VSAM DSN (EARLIER)
ENVEODAD EQU   *
         MVC   POS2(15),CSIEND
         BAL   R3,PRINTMSG
* ENVEODXD CLOSE (VSAMCSI)
ENVEODXD EQU   *                ALREADY CLOSED BY PTFVSAM
         L    R12,CSMPER12
         BR    R12
CSMPEGLB  EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        READ VSAM CSI GLOBAL DSN
*        SELECT  PTF NAME RECEIVED.
*        STORE INTO SYSIN TABLE.
*
         ST   R12,CSMPER12
         CLI   COLLECT,X'FF'   DO NOT COLLECT SYSMODS INTO SYSIN
         BER   R12
*        MODCB  RPL=RPLGLOB,ARG=BYTE0,KEYLEN=1,
*               OPTCD=(LOC,GEN,KGE)
         CALL  PTFVSAM,MF=(E,EMDRPL9)   MODIFY RPL TO 1 BYTE KEY SEQ
         CALL  PTFVSAM,MF=(E,ECALLGLB)
         CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         MVC   POS2(17),CSIGSTAR
         BAL   R3,PRINTMSG
*        SKIP  GLOBAL MAIN RECORD
GETLOOPG CALL  PTFVSAM,MF=(E,EGETGLB)   GET NEXT VSAM RECORD
         CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         LA    R1,CSIKEY
         USING CSIRECD,R1
         CLI   IRBCATG,X'26'
         BH    ENVEODYG   IGNORE SRC LISTING (30) LOADMOD (31)
*                             ++HOLD CARDS (32)
         BNE   GETLOOPG
         CLC   SMODNME,IRBNAME1
         BE    NAMEOKG
NEWSMODG MVC   SMODNME(8),IRBNAME1
         B     GETLOOPG
NAMEOKG  CLC   IRBRELA,=XL2'2601'     TYPE=PTF OR FUNCTION OR UNKNOWN
         BNE   GETLOOPG
         MVI   CSIFLAG,X'00'
         CLC   IRBNAM2F(3),=CL3'PTF'
         BNE   GETLOOPG
         MVI   CSIFLAG,X'FF'
DOPTFG   CALL  PTFVSAM,MF=(E,EGETGLB) GET NEXT VSAM RECORD
         CLC   SAVER15(4),=XL4'00007FFF'    EODAD SIGNAL
         BE    ENVEODA2
         LA    R1,CSIKEY
         USING CSIRECD,R1
         CLC   SMODNME,IRBNAME1
         BNE   NEWSMODG                   NOT ACCEPT/APPLIED
         CLC   IRBRELA,=XL2'26C2' APPLIED ID TGT
         BE    GLOBSYSM
         CLC   IRBRELA,=XL2'26C3' ACCEPT ID DLIB
         BE    GLOBSYSM
*.....................................    HOLD SYSMOD??
         CLC   IRBRELA,=XL2'26F4'   HOLD ERROR CODE
         BE    HOLDDATA
         CLC   IRBRELA,=XL2'26F5'   HOLD SYSTEM CODE
         BE    HOLDDATA
         CLC   IRBRELA,=XL2'26F6'   HOLD USERCODE
         BNE   DOPTFG
HOLDDATA CLI   HOLDSWT,X'FF'
         BE    HOLDTWO
         L     R4,HOLDTABS
         ST    R4,HOLDTABE
         A     R4,=F'47976' WARNING OF HOLD TABLE BEFORE FULL
         ST    R4,HOLDTEND
         MVI   HOLDSWT,X'FF'
HOLDTWO  L     R4,HOLDTABE
         MVI   0(R4),X'01'
         MVC   1(7,R4),IRBNAME1
         MVI   8(R4),X'08'
         MVC   9(7,R4),IRBNAM2F
         MVC   16(8,R4),=CL8'ERROR '
         CLI   IRBRELA+1,X'F4'
         BE    HOLDDONE
         MVC   16(8,R4),=CL8'SYSTEM '
         CLI   IRBRELA+1,X'F5'
         BE    HOLDDONE
         MVC   16(8,R4),=CL8'USER '
HOLDDONE LA    R4,24(R4)
         ST    R4,HOLDTABE
         C     R4,HOLDTEND
         BL    DOPTFG
         MVC   POS2(31),=CL31'ERROR: 800 - HOLD TABLE IS FULL'
*                             1234567890123456789012345678901234
         BAL   R3,PRINTMSG
         ABEND 800,DUMP          TABLE IS FULL
*.....................................    STORE INTO SYSIN TABLE
GLOBSYSM CLI    CSIFLAG,X'FF'             PTF MUST BE RECEIVED
         BNE    DOPTFG
         CLC    ZONEDATA(8),IRBNAM2F  MUST BE MATCHED TO ZONE=
         BNE    DOPTFG
         MVI    CSIFLAG,X'00'
         L     R4,ENDTBADR
         L     R3,INFOSREL
         LTR   R3,R3
         BNZ   NGLOBTAB
         ST    R4,INFOSREL
MVCGLOBL MVC   0(4,R4),NULLADDR
         MVC   4(7,R4),IRBNAME1
         MVI   11(R4),X'A0'
         LA    R4,12(R4)
         ST    R4,ENDTBADR
         B     DOPTFG
NGLOBTAB CLC   0(4,R3),NULLADDR
         BE    ENDGLOBL
         L     R3,0(R3)
         B     NGLOBTAB
ENDGLOBL ST    R4,0(R3)
         B     MVCGLOBL
ENVEODYG CALL  PTFVSAM,MF=(E,ECLSEGLB) CLOSE VSAM DSN (EARLIER)
ENVEODA2 EQU   *
         MVC   POS2(15),CSIGEND
         BAL   R3,PRINTMSG
*ENVEODAG CLOSE (VSAMGLOB)
ENVEODAG EQU   *              ALREADY CLOSED BY PTFVSAM RC=7FFFF
         L    R12,CSMPER12
          BR    R12
         DROP  R10
         DROP  R11
         LTORG
CDSKEYTB EQU   *,3
         DC    C'        '
         DC    C' '
         DC    X'5B'
         DC    C'        '
         DC    C'    '
         DC    X'7B7C'
         DC    C'    ABCD'
         DC    C'EFGHIJKL'
         DC    C'MNOPQRST'
         DC    C'UVWXYZ01'
         DC    C'23456789'
CDSDATA  EQU   *,36
         DC    C'        '
BLANKOUT EQU   *,3
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'    '
         DC    7F'0'
         DS    0F
MAXDATEM DC    CL8'MAXDATE='
CNTLEND  DC    CL16'CONTROL READ END'
SYSSTRT  DC    CL16'SYSIN READ START'
SYSEND   DC    CL16'SYSIN READ END  '
DUMPMSG  DC    C'DUMP'
CNTLBEG  DC    CL18'CONTROL READ START'
INFORUN  DC    C'INFORUN'
ZONE     DC    C'ZONE='
FMID     DC    CL5'FMID='
ERMAXDT  DC    CL15'INVALID  MAXDATE'
CDSSTRT  DC    CL17'SMPCDS READ START'
CDSEND   DC    CL15'SMPCDS READ END'
SREL     DC    CL5'SREL='
NOCOL    DC    CL9'NOCOLLECT'
COLLECT  DC    X'00'
PATCH    DC    X'00'
         DC    C'PATCH AREA'
         DC    X'00'
         DC  33F'0'
CSIRECD  DSECT
CCACZID  DS    XL2  VARIED FOR INDEX
IRBCATG  DS    X      SAME  AS IRBRELA+0
*------------------------------------------------------------
*
* IRBCATG    DESCRIPTION              × IRBCATG    DESCRIPTION
*  01        ZPOOL1                   ×  20        ASSEM
*  02 ZONE ASSIGNMENT (ZONEINDEX)     ×  21        LMOD
*  03                                 ×  22        MAC
*  04        CATG=CAT                 ×  23        MOD
*  05        CATG=REL                 ×  24        SRC
*  10        ZONE                     ×  25        DLIB
*  11        OPTIONS                  ×  26        SYSMOD
*  12        DDDEF                    ×  30        ASM SRC
*  13        UTILITY                  ×  31        LMOD SRC
*  14        FMIDSET                  ×  32        HOLD DATA
*------------------------------------------------------------
IRBNAME1 DS    CL8
*------------------------------------------------------------
IRBRELA  DS    XL2 RELATIONSHIP ASSOCIATED
*------------------------------------------------------------
* IRBRELA    DESCRIPTION           IRBRELA       DESCRIPTION
* -------    ------------          ---------     --------------
* X'0101'      MAIN CSI             X'2001'      ASM SECURITY
* X'0201'      ZONE INDEX CODE      X'2010'      ASM BACKUP
* X'0301'      RDE  CODE            X'2100'      LMOD SECURITY
* X'0401'           CODE            X'2101'      LMOD ATTR
* X'0501'           CODE            X'2110'      LMOD BACKUP
* X'1000'      ZONE SECURITY        X'2113'      LOADLIB
* X'1001'      ZONE INDEX           X'2200'      MAC SECURITY
* X'1020'      ZONE RELATED         X'2201'      MAC  FMID
* X'1021'      ZONE SREL            X'2202'      MAC RMID
* X'1022'      ZONE FMID            X'2210'      MAC BACKUP
* X'1027'      ZONE OPTIONS         X'2211'      MAC DLIB
* X'1172'      AMS IDCAMS UCLIN     X'2213'      MAC LIB
* X'1173'      ASSEMBLER            X'2230'      GENASM
* X'1174'      COMP                 X'2240'      ALIAS
* X'1175'      IEBCOPY              X'2250'      UMID
* X'1177'      LINKAGE EDITOR       X'2300'      MOD SECURITY
* X'1178'      RETRY (IEBCOPY)      X'2301'      MOD FMID
* X'1179'      UPDATE (IEBUPDTE)    X'2302'      MOD RMID
* X'117A'      SZAP (IMASPZAP)      X'2310'      MOD BACKUP
* X'117B'      NUCID                X'2311'      MODDLIB
* X'1180'      UCLIN PAGELEN        X'2313'      MOD ATTR
* X'1181'      UCLIN PREMAX         X'2340'      CSECT
* X'1182'      PURGE/NOPURGE        X'2341'      CSECT LMODE
* X'1183'      REQUEST/NOREQUEST    X'2342'      TALIAS
* X'1188'      RETRY DDNAME         X'2343'      DALIAS
* X'1190'      SAVEMTS              X'2350'      UPDATE ID (UMID)
* X'1191'      SAVESTS              X'2401'      SRC FMID
* X'1192'      DSSPACE              X'2402'      SRC RMID
* X'1193'      DSPREFIX             X'2410'      SRC BACKUP
* X'1201'      DSN=                 X'2411'      SRC DLIB
* X'1202'      VOL=SER=             X'2413'      SRC LIB
* X'1203'      UNIT=                X'2450'      SRC UMID
* X'1209'      CONCAT DD            X'2500'      DLIB SECURITY
* X'1210'      DISP=                X'2501'      DLIB BACKUP
* X'1301'      PGM=                 X'2513'      COPY LIB
* X'1302'      PARM=
* X'1303'      DDN= (PRINT)
* X'1304'      RETURN CODE
* X'1401'      SETFMID
* X'2600'      SYSMOD SECURITY      X'26A9'      VERSION
* X'2601'      SYSMOD TYPE          X'26B1'      MOD
* X'2602'      SYSMOD ATTRIBUTE     X'26B2'      ZAP
* X'2611'      DELBY                X'26B3'      XZAP
* X'2612'      LSUBBY               X'26B4'      MAC
* X'2630'      BACKUP               X'26B5'      MACU
* X'2631'      FMID                 X'26B6'      SRC
* X'2632'      RECDATE              X'26B7'      SRCU
* X'2633'      INSDATE              X'26C1'      ASM
* X'2635'      RSTDATE              X'26C2'      APPLY ID
* X'2636'      UCLDATE              X'26C3'      ACCEPT ID
* X'2637'      DSN=                 X'26D1'      RMOD
* X'2638'      # OF REL FILE        X'26D2'      RZAP
* X'2639'      SECID                X'26D3'      RXZAP
* X'263A'      FESN                 X'26D4'      RMAC
* X'26A1'      VSREC                X'26D5'      RMACU
* X'26A2'      VFMID                X'26D6'      RSRC
* X'26A3'      VPRE                 X'26D7'      RSRCU
* X'26A4'      VNPRE                X'26F0'      SUPBY
* X'26A5'      VSUP                 X'26F1'      CIFREQ
* X'26A6'      VREQ                 X'26F4'      HOLDERR
* X'26A7'      VIREQ                X'26F5'      HOLDSYS
* X'26A8'      VDEL                 X'26F6'      HOLDUSR
* X'3001'      SOURCE LISTING       X'3210'      ++HOLD CARD
* X'3101'      LMOD CARDS           X'3220'      ++HOLD COMMENT
*                                   X'3230'      ++HOLD FULLGEN
IRBOCCR  DS    XL2
IRBNAM2F DS    CL184     VARIED LENGTH MOST 8 CHARS
         PRINT  NOGEN
         DS     0F
         PTFCOMN
         END
./       ADD   NAME=PTFFIX
*        DOR001   FIXED ON 11/5/86
*                 1. ADD PRINTED PREFIXES 'PE-, SYS, USE AND ++.
*                 2. ADD PRINTED "HOLD" COLUMN SAYING ERR, SYS,OR USE.
*                 3. CORRECTION PRINTED LINE IN ERROR
*                 4. INDICATE A SYMBOL OF "×" TO SHOW SYSMOD IS TARGET
*                 5. IMPROVE DEFIX OUTPUT LAYOUTS AND ALGORITHMS
*                 6. REWRITE HOLD ALGORITHMS
*                 7. MINOR FIXED ALGORITHMS  ON FMID PATHS
*        DOR002   FIXED ON 01/22/87
*                 1. SUPECEDED PTF NOT ON RECEIVE LIST..SMPE SAYS IT
*                     MISSED WHEN A PTF IS PRE BY SUPECEDED PTF.
*        DOR003   FIXED ON 01/29/87
*                 1. PAGE HEADER ADDED
         TITLE     'PTFFIX   -  FINDFIX SUBROUTINE '
         PRINT  NOGEN
PTFFIX   CSECT
         USING *,R11
FIX      B     @PROLONG-*(,15)
         DC    AL1(11),CL11'PTFFIX'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         USING PARMPTR,R10
         LA    R15,REGSROUT
         ST    R15,8(R13)
         MVC   0(72,R15),0(R13)    SAVE PTFROUT REGS
         ST    R13,4(R15)
         LA    R2,4095(R11)
         USING FIX+4096,R2
         USING WORKAREA,R13
         LA    R2,1(R2)
         PUT   SYSPRINT,PRTLINE
         MVC   LNENUM,F56
         L     R5,TABLEND
         SL    R5,F30
         ST    R5,TABLEND
         L     R5,ENDTBADR
         ST    R5,SMODTABS
* ------ MODCB EXLST=EXLST,EODAD=EODAD
         CALL  PTFVSAM,MF=(E,EMODACB0)
         CALL  PTFVSAM,MF=(E,EMODACB1)
         B     FIXBEG
         EJECT
GETSMOD EQU    *
*       SMOD TABLE FORMAT 36 BYTES
*    +0    +4    +8   +12   +16    +20   +27  +28
*    ×     ×     ×    ×     ×      ×     ×    ×
*    ×     ×     ×    ×     ×      ×     ×    +-- DATE YY/MM/DD
*    ×     ×     ×    ×     ×      ×     +--  SYSMOD FLAG BYTE
*    ×     ×     ×    ×     ×      ×     XXXX XXX1 EARLIER REFER.
*    ×     ×     ×    ×     ×      ×     XXXX XX1X RESERVED
*    ×     ×     ×    ×     ×      ×     XXXX X1XX IFREQ
*    ×     ×     ×    ×     ×      ×     XXXX 1XXX PRE
*    ×     ×     ×    ×     ×      ×     XXX1 XXXX SUPERCEDED
*    ×     ×     ×    ×     ×      ×     XX1X XXXX AVAILABLE IN PTF LIB
*    ×     ×     ×    ×     ×      ×     X1XX XXXX NOT AVAIL IN PTF LIB
*    ×     ×     ×    ×     ×      ×     1XXX XXXX ALREADY INSTALLED
*    ×     ×     ×    ×     ×      +----- SYSMOD NAME
*    ×     ×     ×    ×     +------------ ADDRESS POINT TO SYSMOD
*    ×     ×     ×    +------------------ ADDRESS POINT TO SYSMOD
*    ×     ×     +----------------------- ADDRESS POINT TO SYSMOD
*    ×     +----------------------------- ADDRESS POINT TO SYSMOD
*    +----------------------------------- ADDRESS POINT TO SYSMOD
*                                            DEPENDING ON FLAG (+27)
*
         L     R5,ENDTBADR
         CL    R5,TABLEND
         BNL   MFLAG0E
         XC    0(36,R5),0(R5)     ERASE SYSMOD TABLE
         MVC   20(7,R5),SBLANKS   STORE SYSMOD NAME
         MVC   28(8,R5),SBLANKS   STORE SYSMOD NAME
         LA    R9,36(R5)          NEXT SYSMOD TABLE
         ST    R9,ENDTBADR        SAVE AS END OF SYSMOD TABLE
         BR    R12
MFLAG0E  EQU   *
         MVI   MODFLAG,X'0E'
         B     EXITFIX
         EJECT
NEXTTAB  EQU   *
         L     R4,8(,R5)
         MVC   POS2(8),=CL8'NEXTTAB '
         BAL   R8,PRT345
         LTR   R4,R4
         BZ    TABEMPTY
         LR    R5,R4
         B     NEXTSYSM
FIXBEG   MVC   SMODKYAA(4),CNTLSMOD
         MVI   PRTLINE,X'40'
         MVC   PRTLINE+1(100),PRTLINE
TABEMPTY L     R4,SMODKYAA
         LTR   R4,R4
         BZ    TABGONE
         MVC   SMODKYAA(4),0(R4)
         LA    R3,4(R4)
         BAL   R12,GETSMOD                 PERFORM
CNTLSYSM MVC   20(7,R5),0(R3)
         MVC   POS2(8),=CL8'NEW SYSM'
         BAL   R8,PRT345
         LR    R4,R5
DOSYSMOD SL    R4,F36
         CL    R4,SMODTABS
         BL    FNDSMOD
         CLC   20(7,R4),20(R5)
         BE    SAMESMOD
*        MVC   POS2(8),=CL8'DOSYSMOD'   DONOT USE SINCE LONG LISTING
*        BAL   R8,PRT345
         B     DOSYSMOD
SAMESMOD OI    27(R5),X'01'
         MVC   POS2(8),=CL8'EARLIER'
         BAL   R8,PRT345
         B     NEXTSYSM
FNDSMOD  BAL   R12,FINDMOD                 PERFORM
         B     MISSSMD
         OI    27(R5),X'80' FOUND IN CDS/CSI TABLE
         MVC   POS2(8),=CL8'INSTALL'
         BAL   R8,PRT345
         B     NEXTSYSM
MISSSMD EQU    *
         MVC   POS2(8),=CL8'NOTFOUND'
         BAL   R8,PRT345
         L     R3,SMODMISS        MUST BE IN INFOTABLE AREA
         LTR   R3,R3                   DOR SMODMISS IS ZERO.
         BZ    NEXTSYSM                DOR
         MVC   POS2(8),=CL8'SUPNAME'
         BAL   R8,PRT345
         MVC   SUPNAME,20(R5)
*                                                                  DOR
*        REMODIFIED TO SEARCH FOR SUPERCEDED SYSMODS IN SHORT TIME DOR
*                                                                  DOR
         LR    R1,R3                                               DOR
         CLI   0(R3),X'01'                                         DOR
         BNE   FINDSUP                                             DOR
NEXTSUP  MVC   INFOFFST+1(3),21(R3) NEXT OFFSET OF SYSMOD FIELD    DOR
         LR    R1,R3                                               DOR
         A     R1,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         LA    R3,24(R3)        BYPASS  SYSMOD+DATE+SREL FIELDS    DOR
FINDSUP  CLC   SUPSYSM(8),0(R3)
         BE    MATCHSMD
FINDSUPA LA    R3,8(R3)
         CLI   0(R3),X'08'     SUPED SYSMOD                        DOR
         BE    FINDSUP                                             DOR
         CLI   0(R3),X'11'     IFREQ SYSMOD                        DOR
         BE    FINDSUPA                                            DOR
         CLI   0(R3),X'10'     IFREQ FMID                          DOR
         BE    FINDSUPA                                            DOR
         CLI   0(R3),X'0A'     ELEMENTS                            DOR
         BL    FINDSUP1                                            DOR
         LR    R3,R1           SKIP  ELEMENT FIELDS                DOR
FINDSUP1 CLI   0(R3),X'01'                                         DOR
         BE    NEXTSUP                                             DOR
FINDSUP2 CL    R3,SMODMISE   END OF INFOTABLE
         BL    FINDSUP
         BAL   R12,FSMODAVL                                  DOR002
         B     SYSMNONE   SYSMOD IS NOT IN INFOIN            DOR002
         B     FSMODOK    SYSMOD IS EXISTED IN INFOIN        DOR002
FSMODAVL EQU   *    FIND SYSMOD AVAILABLE OR NOT   DOR002
         L     R3,SMODMISS
         MVC   SYSMODNM(7),20(R5)
CHKSYSM  CLI   0(R3),X'01'   LOOK FOR SYSMOD
         BE    SYSMODY
NOTSYSM  EQU   *
*        LA    R3,8(R3) INEFFECTIVE METHOD                         DOR
*                                                                  DOR
*        REMODIFIED TO SEARCH SYSMODS IN SHORT TIME                DOR
*                                                                  DOR
         MVC   INFOFFST+1(3),21(R3) NEXT OFFSET OF SYSMOD FIELD    DOR
         A     R3,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         CL    R3,SMODMISE
         BL    CHKSYSM
         BR    R12              NO SYSMOD FROM INFOIN        DOR002
SYSMODY  CLC   SYSMCODE(8),0(R3)
         BNE   NOTSYSM
         B     4(R12)            SYSMOD IS EXISTED IN INFOIN DOR002
FSMODOK  EQU   *
*--------------------------------------
         MVC   POS2(8),=CL8'AVAIL'
         MVC   POS11(8),SYSMCODE
         MVC   POS20(14),0(R3)
         BAL   R8,PRTDEFIX
*--------------------------------------
         OI    27(R5),X'20'
         CLI   10(R3),X'61'
         BNE   PATHPRE
*--------------------------------------
         MVC   POS2(8),=CL8'ADD DATE'
         MVC   POS11(7),SYSMCODE
         MVC   POS20(14),0(R3)
         BAL   R8,PRTDEFIX
*--------------------------------------
         MVC   28(8,R5),8(R3)
         B     PATHPRE
SYSMNONE OI    27(R5),X'40'
         MVC   POS2(8),=CL8'NOTAVAIL'
         BAL   R8,PRT345
         B     NEXTSYSM
NEXTSYSM L     R4,16(,R5)
         MVC   POS2(8),=CL8'NEXTSYSM'
         BAL   R8,PRT345
         LTR   R4,R4
         BNZ   CHKSMOD
HAVESMOD L     R4,0(,R5)
         LTR   R4,R4
         BZ    NEXTTAB
         MVC   POS2(8),=CL8'HAVESMOD'
         BAL   R8,PRT345
         LR    R5,R4
         B     NEXTSYSM
         EJECT
CHKSMOD CLI    0(R4),X'01'
         BNE   CHKPRE
SYSMNEXT MVC   16(4,R5),NULLADDR
         MVC   POS2(8),=CL8'SYSMNEXT'
         BAL   R8,PRT345
         B     HAVESMOD
CHKPRE   CLI   0(R4),X'05'
         BNE   CHKREQ
         MVC   POS2(8),=CL8'PRE=05'
         BAL   R8,PRT345
         MVI   FIXSWT,X'08'
         B     SYSMODD
CHKREQ   CLI   0(R4),X'06'
         BNE   CHKIFREQ
         MVC   POS2(8),=CL8'REQ=06'
         BAL   R8,PRT345
         MVI   FIXSWT,X'04'
         B     SYSMODD
CHKIFREQ CLI   0(R4),X'11'
         BNE   CHKFMID
         MVC   POS2(8),=CL8'IFREQ=11'
         BAL   R8,PRT345
         MVI   FIXSWT,X'02'
         B     SYSMODD
CHKFMID  CLI   0(R4),X'10'
         BNE   NEXTSMOD
         LA    R3,1(R4)
         MVC   POS2(8),=CL8'FMID=10'
         BAL   R8,PRT345
         BAL   R12,FINDMOD                 PERFORM
         B     FOUNDMOD         +RC=0
         B     NEXTSMOD         +RC=4
         EJECT
NEXTSMOD LA    R4,8(R4)
         MVC   POS2(8),=CL8'NEXTSMOD'
         BAL   R8,PRT345
         CL    R4,SMODMISE
         BNL   SYSMNEXT
         B     CHKSMOD
FOUNDMOD LA    R4,8(R4)
         MVC   POS2(8),=CL8'FOUNDMOD'
         BAL   R8,PRT345
         CLI   0(R4),X'11'
         BNE   CHKSMOD
         MVC   POS2(8),=CL8'IFREQ#11'
         BAL   R8,PRT345
         B     FOUNDMOD
         EJECT
SYSMODD  LR    R6,R5
         LA    R4,8(R4)
         ST    R4,16(,R5)
         MVC   POS2(8),=CL8'SYSMOD16'
         BAL   R8,PRT345
         SL    R4,F8VAL
         L     R7,4(,R5)
         LTR   R7,R7
         BNZ   NEXTSMD
         BAL   R12,GETSMOD                 PERFORM
         ST    R6,0(,R5)
         ST    R5,4(,R6)
         MVC   20(7,R5),1(R4)
         MVC   27(1,R5),FIXSWT
         MVC   POS2(8),=CL8'SYSMOD27'
         BAL   R8,PRT345
         LA    R3,1(R4)
         LR    R4,R5
         B     DOSYSMOD
         EJECT
NEXTTAB2 BAL   R12,GETSMOD                 PERFORM
         ST    R5,12(,R6)
         ST    R6,8(,R5)
         MVC   0(4,R5),0(R6)
         MVC   20(7,R5),1(R4)
         MVC   27(1,R5),FIXSWT
         MVC   POS2(8),=CL8'SYSMOD8'
         BAL   R8,PRT345
         LA    R3,1(R4)
         LR    R4,R5
         B     DOSYSMOD
NEXTSMD  LR    R6,R7
         MVC   POS2(8),=CL8'NEXTSMD'
         BAL   R8,PRT345
         L     R7,12(,R7)
         LTR   R7,R7
         BNZ   NEXTSMD
         B     NEXTTAB2
         EJECT
MATCHSMD OI    27(R5),X'10'
         MVC   POS2(8),=CL8'SUPEDSMD'
         BAL   R8,PRT345
         LR    R6,R5
         MVI   FIXSWT,X'00'
         LR    R4,R3
FSYSMOD  SL    R4,F8VAL
         CLI   0(R4),X'01'
         BNE   FSYSMOD
         ST    R3,SAVESUPE
         BAL   R12,FSMODAVL       IS SUPERSEDED AVAILABLE ? DOR002
         B     NEXTTABX           NOT AVIALABLE             DOR002
*--------------------------------------                     DOR002
         MVC   POS2(8),=CL8'SUP-AVL'                        DOR002
         MVC   POS11(8),SYSMCODE                            DOR002
         MVC   POS20(14),0(R3)                              DOR002
         BAL   R8,PRTDEFIX                                  DOR002
*--------------------------------------                     DOR002
         CLI   10(R3),X'61'                                 DOR002
         BNE   NEXTTABX                                     DOR002
*--------------------------------------                     DOR002
         MVC   POS2(8),=CL8'SUP DATE'                       DOR002
         MVC   POS11(7),SYSMCODE                            DOR002
         MVC   POS20(14),0(R3)                              DOR002
         BAL   R8,PRTDEFIX                                  DOR002
*--------------------------------------                     DOR002
         MVC   28(8,R5),8(R3)                               DOR002
NEXTTABX L     R3,SAVESUPE                                  DOR002
         MVI   30(R5),C'S'   INDICATED SYSMOD AS SUPERSEDED DOR002
         B     NEXTTAB2                                     DOR002
PATHPRE  LA  R4,8(R3)
         MVC   POS2(8),=CL8'PATHPRE'
         BAL   R8,PRT345
         B     CHKSMOD
         EJECT
*******************************************************************
*        START OF FINDFIX REPORT
*
PATHSTAY TM    PTR29A,X'FF'
         BNO   PATHOUT
         L     R5,FMIDPTR    POINTER OF FIRST BYTE OF SYSMOD ENTRY
         LTR   R5,R5
         BNZ   PATHON1       INTITIAL
         MVC   POS10(15),TITLE10    NO FMID FOUND
NEGSYSM  BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   MODFLAG(1),PATCH
         B     EXITFIX
*        SEARCH FOR FMID FROM INFOTABLE MUST BE MATCH TO FMID REQ.
PATHON1  L     R9,FMIDADRX
         MVC   POS2(8),=CL8'PATHON1'
         BAL   R8,PRT59
         LR    R1,R5
         ST    R5,SYSMFMID    CURRENT SYSMOD ENTRY
         CLI   0(R5),X'01'
         BNE   PATHON3
PATHFMID MVC   INFOFFST+1(3),21(R5)  NEXT OFFSET OF SYSMOD FIELD
         LR    R1,R5
         ST    R5,SYSMFMID    CURRENT SYSMOD ENTRY
         A     R1,INFOFFST    ADD VER PLUS ELEMENT DATA
         ST    R1,SYSNFMID    NEXT SYSMOD ENTRY
         LA    R5,24(R5)      BYPASS SYSMOD + DATA +SREL FIELDS
PATHON3  CL    R1,SMODMISE
         BNL   PATHOVER
PATHON4  CLI   0(R5),X'03'
         BE    FMIDPATH
         MVC   POS2(8),=CL8'PATHON'
         BAL   R8,PRT59
         CLI   0(R5),X'0A'    ELEMENTS
         BL    PATHON5
PATHON2  L     R5,SYSNFMID   GET NEXT SYSMOD ENTRY
         MVC   POS2(8),=CL8'PATHON2'
         BAL   R8,PRT59
PATHON5  CLI   0(R5),X'01'
         BE    PATHFMID      GO TO NEXT SYSMOD ENTRY
         CL    R5,SMODMISE
         BL    PATHON4
         B     PATHOVER
* ---------------------------------------------------------
*PATHON2  LA    R5,8(R5)
*        CL    R5,SMODMISE
*        BNL   PATHOVER
*        CLI   0(R5),X'03'
*        BNE   PATHON2
FMIDPATH CLC   1(7,R5),4(R9)
         BNE   PATHON2
         MVC   POS2(8),=CL8'FMID='
         BAL   R8,PRT59
         L     R5,SYSNFMID GET NEXT SYSMOD ENTRY AFTER FMID WAS HIT
         ST    R5,FMIDPTR
FSYSMOD2 L     R5,SYSMFMID GET CURRENT SYSMOD ENTRY WHERE FMID IS HIT
*FSYSMOD2 SL    R5,F8VAL
         MVC   POS2(8),=CL8'FSYSMOD2'
         BAL   R8,PRT59
         CLI   0(R5),X'01'
         BNE   PATHON2 GO TO NEXT SYSMOD ENTRY
         MVC   POS2(8),=CL8'=01'
         BAL   R8,PRT59
         ST    R5,FMIDADDR
         BAL   R12,GETSMOD                 PERFORM
         L     R9,FMIDADRX
         L     R4,12(,R9)
         LTR   R4,R4
         BNZ   PATHUP
         MVC   POS2(8),=CL8'PATH12+'
         BAL   R8,PRT59
         ST    R5,12(,R9)
PATHUP   ST    R5,16(,R9)
         MVC   POS2(8),=CL8'PATH16+'
         BAL   R8,PRT59
         L     R3,FMIDADDR
         LA    R3,1(R3)
         B     CNTLSYSM
PATHOUT  L     R3,FMIDREQ
PATHCHK  LTR   R3,R3
         BZ    NOPATH
         MVC   POS2(8),=CL8'PATHCHK'
         BAL   R8,PRTFMID
         TM    11(R3),X'80'
         BNO   PATHSMOD
         L     R3,0(,R3)
         B     PATHCHK
PATHSMOD ST    R3,FMIDADRX
         MVC   POS2(8),=CL8'PATHCHK'
         BAL   R8,PRTFMID
         L     R5,SMODMISS
         MVC   POS2(8),4(R3)      FMID NAME
         MVC   POS10(16),TITLE11
         LTR   R5,R5              SEE IF R5=0, ABNORMAL NO SYSMOD
         BZ    NEGSYSM            NO SYSMOD IN TABLE
         OI    11(R3),X'80'
         MVC   POS2(8),=CL8'PATH=80'
         BAL   R8,PRTFMID
         MVI   PTR29A,X'FF'
         B     PATHON1
PATHOVER MVI   PTR29A,X'00'
         MVC   POS2(8),=CL8'PATHOVER'
         BAL   R8,PRTFMID
         B     PATHOUT
TABGONE  CLC   SMODTABE(4),F0
         BNE   PATHSTAY
         MVC   SMODTABE(4),ENDTBADR
         B     PATHSTAY
         EJECT
NOSYSMOD L     R3,0(,R3)
         MVC   POS2(8),=CL8'NOSYSMOD'
         BAL   R8,PRTFMID
         B     NOSYSMDX
FUNCPATH MVC   POS32(12),FUNCMSG
         L     R7,FMIDADDR
         MVC   POS45(7),4(R7)
         MVI   POS51+2,X'7A'
         OI    INFTABEA,X'40'
         MVC   PAGLINE+102(7),4(R7) FMID NAME ON PAGE LINE
         BAL   R8,PRTPAGE
         B     PRINTFNC
NOPATH   CLC   SMODTABS(4),SMODTABE
         BE    NOSYSMDY
         L     R5,SMODTABS
         ST    R5,FDUMMY
         MVC   POS2(8),=CL8'SMODBEG'
         BAL   R8,PRTSMOD5       DOR001
         LTR   R5,R5
         BZ    FINISHUP
PATHEND  CLC   0(4,R5),NULLADDR
         BNE   PATHEND2
         CLC   8(4,R5),NULLADDR
         BE    DISPSMOD
PATHEND2 LA    R5,36(R5)
         ST    R5,FDUMMY
         MVC   POS2(8),=CL8'SMODTNX'
         BAL   R8,PRTSMOD5       DOR001
         CL    R5,SMODTABE
         BL    PATHEND
FINISHUP MVC   POS2(30),TITLE1
         MVC   POS32(8),FINISH
         MVI   PRTLINE,X'19'
         BAL   R12,PRINTER                 PERFORM
         MVI   PRTLINE,X'09'
         BAL   R12,CLRPRINT                PERFORM
NOSYSMDY L     R3,FMIDREQ
NOSYSMDX LTR   R3,R3
         BZ    PRINT8
         ST    R3,FDUMMY
         MVC   POS2(8),=CL8'NOSMODX'
         BAL   R8,PRTSMOD3       DOR001
         TM    11(R3),X'40'
         BO    NOSYSMOD
         OI    11(R3),X'40'
         MVC   SMODTABS(4),12(R3)
         OI    INFTABEA,X'80'
         NI    INFTABEA,X'BF'
         L     R5,16(,R3)
         LA    R5,36(R5)
         ST    R5,SMODTABE
         ST    R3,FMIDADDR
         CLC   SMODTABS(4),NULLADDR
         BNE   NOPATH
         MVC   POS2(16),NOSMOD
         MVC   POS19(12),FUNCMSG
         MVC   POS32(7),4(R3)
         MVI   PRTLINE,X'19'
         BAL   R12,PRINTER                 PERFORM
         MVI   PRTLINE,X'09'
         BAL   R12,CLRPRINT                PERFORM
         B     NOSYSMOD
         EJECT
CLRPRINT MVI   POS2,C' '
         MVC   POS3(131),POS2
         BR    R12
         SPACE 4
PRINTER  EQU   *
         PUT   SYSPRINT,PRTLINE
         L     R1,LNENUM
         CLI   PRTLINE,X'19'
         BE    PRTERSET
         SL    R1,F1
PRINTER2 ST    R1,LNENUM
         LTR   R1,R1
         BNZR   R12                                             DOR003
         BAL   R8,PRTPAGE
PRTEXIT  BR    R12
PRTPAGE  MVC   LNENUM,F56                                      DOR003
         L     R1,PAGNUM                                       DOR003
         LA    R1,1(R1)      ADD ONE PAGE COUNT                DOR003
         ST    R1,PAGNUM                                       DOR003
         CVD   R1,DOUBLE                                       DOR003
         MVC   PAGLINE+115(5),=X'4020202120'                   DOR003
         ED    PAGLINE+115(4),DOUBLE+6                          DOR003
         PUT   SYSPRINT,PAGLINE                                DOR003
         BR    R8
PRTERSET SL    R1,F3
         B     PRINTER2
         EJECT
DISPSMOD MVC   ONE(4),FMIDREQA
         CL    R5,SMODTABS
         BE    RPTREQST
         TM    INFTABEA,X'40'
         BO    CLEARLNE
         L     R1,LNENUM
         CL    R1,F7
         BNH   PRINT3
         PUT   SYSPRINT,PRTLINE
         L     R1,LNENUM
         SL    R1,F3
         ST    R1,LNENUM
         LTR   R1,R1
         BC    12,PRINT3
RPTREQST MVC   POS2(30),TITLE1
         TM    INFTABEA,X'80'
         BO    FUNCPATH
         MVC   POS32(10),TITLE2
         MVC   POS43(7),20(R5)
         MVI   POS51,C':'
         MVC   PAGLINE+102(7),20(R5) FMID NAME ON PAGE LINE
         BAL   R8,PRTPAGE
PRINTFNC BAL   R12,PRINTER                 PERFORM
         L     R1,LNENUM
         SL    R1,F2
         ST    R1,LNENUM
         LTR   R1,R1
* ------ BC    12,PRINT4 CAUSE DOUBLE PRINT DOR
CLEARLNE BAL   R12,CLRPRINT                PERFORM
RPTSMOD  MVC   REPORT(7),20(R5)
         MVI   REPORT+8,C' '
         MVC   REPORT+9(110),REPORT+8
         BAL   R8,HOLDCHK        TO INDICATE IF IT IS IN HOLD   DOR001
* ------------------------------------------------------
         MVC   POS2(8),=CL8'RPTSMOD'
         ST    R5,FDUMMY
         BAL   R8,PRTSMOD5       DOR001
* ------------------------------------------------------
         TM    27(R5),X'0E'
         BZ    SYSMHAVE
         TM    27(R5),X'08'
         BZ    RPTREQ
         MVC   SMODTYPE(3),PRE
         B     RPTIS
RPTREQ   TM    27(R5),X'04'
         BZ    RPTIFREQ
         MVC   SMODTYPE(3),REQ
         B     RPTIS
RPTIFREQ MVC   SMODTYPE(6),IFREQ
         BAL   R8,FMIDDISP         SHOW FMID NAME
RPTIS    MVC   PRTP09(2),IS
         MVC   PRTP18(3),FOR
         L     R7,0(,R5)
         LA    R1,400
         LTR   R7,R7
         BZ    PTRABEND
         MVC   PRTP22(7),20(R7)
         BAL   R9,PRTSYSM                  PERFORM
SYSMHAVE TM    27(R5),X'80'
         BNO   RPTEARLY
* ------ SYSMOD ALREADY INSTALLED MSG
         MVC   REPORT(7),=CL7'   >>>>>'
         MVC   PRTP09(25),TITLE4
         MVC   PRTP34,INSTLMSG
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,CSIINFO
RPTEARLY TM    27(R5),X'01'
         BNO   NOSTAR2
* ------ EARLIER REFERENCED MSG
         CLI   27(R5),X'01' BYPASS DOR001
         BE    RPTEARL2            DOR001
         MVC   REPORT(7),=CL7'   >>>>>'
RPTEARL2 MVC   PRTP09(18),EARLYMSG
         MVC   PRTP27,TITLE3
         BAL   R9,PRTSYSM                  PERFORM
NOSTAR2  TM    27(R5),X'40'
         BNO   SMDAVAIL
* ------ NOT AVAILABLE IN YOUR PTF LIBRARY
         MVI   PATCH,X'0F'
         MVC   RPTPREF(2),STAR2
         MVC   PRTP09(3),NOT
         MVC   PRTP12,TITLE5
         MVC   PRTP30,TITLE6
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,FINDHOLD
SMDAVAIL TM    27(R5),X'20'
         BNO   RPTSUPBY
*------- AVAILABLE IN YOUR PTF LIBRARY
         MVC   PRTP09(8),28(R5)
         MVC   PRTP17,TITLE5
         MVC   PRTP30,TITLE6
         BAL   R9,PRTSYSM                  PERFORM
         BAL   R8,FINDHOLD
         BAL   R8,ELEMDISP
RPTSUPBY TM    27(R5),X'10'
         BNO   RPTSUPB2
* ------ IS SUPERCEDED BY MSG
         MVC   PRTP09(16),ISSUPMSG
         L     R7,12(,R5)
         LA    R1,500
         LTR   R7,R7
         BZ    PTRABEND
         MVC   PRTP25,20(R7)
         BAL   R9,PRTSYSM                  PERFORM
         B     RPTRECVD         PUT SUPE SYSMOD ON RECEIVED DOR002
RPTSUPB1 TM    27(R5),X'30'     HAVE AVAILABLE BUT IS SUPERCEDED
         BO    SUPBYEQU
RPTSUPB2 TM    27(R5),X'20'
         BNO   SUPBYEQU
* ----------------------------------------------------
RPTRECVD EQU   *
         L     R3,SMODRCVE
         LTR   R3,R3
         BZ    SETTBADR
         L     R4,SMODRCVS
CHKSUPBY CLC   8(7,R4),20(R5)
         BE    SUPBYEQU
         LA    R4,24(R4)
         CL    R4,SMODRCVE
         BL    CHKSUPBY
         LA    R4,24(R3)
         CL    R4,TABLEND
         BH    FIXDONE
         ST    R4,ENDTBADR
         ST    R4,SMODRCVE
         LR    R4,R3
         MVC   0(4,R4),NULLADDR
         MVC   4(4,R4),NULLADDR
         MVC   8(7,R4),20(R5)
         MVC   16(8,R4),28(R5)
*        TM    27(R5),X'10'   SUPERCEDED SYSMOD?             DOR002
*        BNO   SUPBYEQU                                      DOR002
*        MVI   18(R4),C'S'     REPLACE "/" BY "S" AS SUPERSEDED DOR002
         B     SUPBYEQU
SETTBADR L     R3,ENDTBADR
         LA    R4,24(R3)
         CL    R4,TABLEND
         BH    FIXDONE
         ST    R4,ENDTBADR
         ST    R4,SMODRCVE
         ST    R3,SMODRCVS
         MVC   0(4,R3),NULLADDR
         MVC   4(4,R3),NULLADDR
         MVC   8(7,R3),20(R5)
         MVC   16(8,R3),28(R5)
         B     SUPBYEQU
FIXDONE  MVI   MODFLAG,X'10'
         B     EXITFIX
SUPBYEQU L     R7,4(,R5)
         LTR   R7,R7
         BZ    NONXTSUP
         LR    R5,R7
         L     R7,ONE
         AL    R7,FMIDREQA
         ST    R7,ONE
         B     RPTSMOD
NONXTSUP L     R7,12(,R5)
         LTR   R7,R7
         BZ    NONXTSU2
         LR    R5,R7
         B     RPTSMOD
NONXTSU2 L     R7,0(,R5)
         LTR   R7,R7
         BZ    PATHEND2
         LR    R5,R7
* ------------------------------------------------------
         MVC   POS2(8),=CL8'NONXTSU'
         ST    R5,FDUMMY
*        MVC   POS2+9(4),FDUMMY
*        MVC   POS2+14(36),0(R5) DOR001
         BAL   R8,PRTSMOD5       DOR001
* ------------------------------------------------------
         L     R7,ONE
         SL    R7,FMIDREQA
         ST    R7,ONE
         L     R7,12(,R5)
         LTR   R7,R7
         BZ    NONXTSU2
         LR    R5,R7
         B     RPTSMOD
         EJECT
FINDHOLD EQU   *
         ST    R8,SAVER8
         BAL   R12,FINDHLD                 DOR001
         B     EXTINFO   DO NOT HAVE HOLDDATA
         L     R6,HOLDADDR
         MVC   PRTP09(11),=CL11'IS HOLD BY '
         MVC   PRTP19(6),16(R6)    ERROR/SYSTEM/USER
         MVC   PRTP26(15),=CL15'WITH REASON OF '
         MVC   PRTP41(7),9(R6)     SUPERCEDED SYSMOD
         MVC   REPORT(7),=CL7'   >>>>>'
*-------- GET HOLD   DATE ------------------------
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MF=(E,EMDRPL13)
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HOLDEXPT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
HDTXMORE EQU   *
*--------------------------------------
         MVC   POS2(6),=CL6'HOLDAX'
         BAL   R8,PRTHOLD
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HOLDEXPT
         CLC   CSIKEY+15(7),9(R6)
         BNE   HDTXNEXT
         MVC   PRTP41+8(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTXLOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTXFND
         LA    R7,1(R7)
         BCT   R9,HDTXLOOP
         B     HOLDEXPT
HDTXNEXT EQU   *
         CALL  PTFVSAM,MF=(E,EMDRPL14) SEQUENTIAL
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HOLDEXPT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
         B     HDTXMORE
HDTXFND  LA    R7,3(R7)
HDTXFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTXFND2
         BCT   R9,HDTXFND1
         B     HOLDEXPT
HDTXFND2 MVC   PRTP41+13(5),1(R7)
HOLDEXPT BAL   R9,PRTSYSM
HOLDEXIT B     EXTINFO
         EJECT
FMIDDISP EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF FMID IFREQ BY THE SYSMOD
         L     R6,SMODMISS     BEGIN OF MISSED SYSMOD TABLE
         L     R7,0(,R5)
         LTR   R7,R7
         BZ    FMIDEXIT      R7 CONTAINS ZEROS AS IT MAY BE A PROBLEM
FMIDNEXT CLC   20(7,R7),1(R6)   FIND SYSMOD
         BE    FMIDCHK
FMIDNXT  EQU   *
         MVC   INFOFFST+1(3),21(R6)
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA
         CL    R6,SMODMISE         END OF SYSMOD TABLE
         BL    FMIDNEXT
         B     FMIDEXIT
FMIDCHK  CLI   0(R6),X'01'      SYSMOD CODE
         BNE   FMIDNXT
*--------------------------------------
         MVC   POS2(6),=CL6'FMIDCK'
         BAL   R8,PRTCK7
*--------------------------------------
FMIDSMOD LA    R6,8(R6)
         CL    R6,SMODMISE
         BE    FMIDEXIT       TABLE DRY OUT
         CLI   0(R6),X'01' SYSMOD HEADER TABLE
         BE    FMIDEXIT       NO IFREQ FOUND
         CLI   0(R6),X'11'    IFREQ SYSMOD CODE
         BNE   FMIDSMOD
         CLC   20(7,R5),1(R6)
         BNE   FMIDSMOD
         SL    R6,F8           BACKUP 8 BYTES FOR FMID NAME
         CLI   0(R6),X'10'    IFREQ FMID CODE
         BNE   FMIDEXIT        SOMETHING IS WRONG WITH IFREQ
* -----  LA    R3,1(R6)
* ------ BAL   R12,FINDMOD
* ------ B     FMIDOK          INSTALLED
*------- B     FMIDSMOD        NONE INSTALLED
FMIDOK   MVC   PRTP30(5),=CL5'FMID-'
         MVC   PRTP35(7),1(R6)
FMIDEXIT L     R8,SAVER8
         B     0(R8)
         EJECT
ELEMDISP EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF ELEMSNT MODIFICATIONS BY THE SYSMOD
         L     R6,SMODMISS     BEGIN OF HOLD TABLE
ELEMNEXT CLC   20(7,R5),1(R6)   FIND SYSMOD
         BE    ELEMCHK
ELEMNXT  EQU   *
* -----  LA    R6,8(R6)
         MVC   INFOFFST+1(3),21(R6)
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA
         CL    R6,SMODMISE         END OF SYSMOD TABLE
         BL    ELEMNEXT
ELEMDONE B     EXTINFO
ELEMCHK  CLI   0(R6),X'01'      SYSMOD CODE
         BNE   ELEMNXT
*--------------------------------------
         MVC   POS2(6),=CL6'ELEMCK'
         BAL   R8,PRTCK5
*--------------------------------------
ELEMPTF  LA    R6,8(R6)
         CL    R6,SMODMISE
         BNL   EXTINFO
         CLI   0(R6),X'01'   END OF SYSMOD
         BE    EXTINFO
         CLI   0(R6),X'1F'
         BE    ELEMHOLD
         CLI   0(R6),X'1E'
         BE    ELEMRLSE
         CLI   0(R6),X'1D'
         BE    ELEMJCLN
         CLI   0(R6),X'0A'
         BL    ELEMPTF
         CLI   0(R6),X'0F'
         BH    ELEMPTF
         CLI   0(R6),X'0D'
         MVC   PRTP28(7),=CL7'   ZAP-'
         BE    ELEMPRT
         CLI   0(R6),X'0C'
         MVC   PRTP28(7),=CL7'MACUPD-'
         BE    ELEMPRT
         CLI   0(R6),X'0B'
         MVC   PRTP28(7),=CL7'SRCUPD-'
         BE    ELEMPRT
         MVC   PRTP28(7),=CL7'   SRC-'
         MVI   BYTE2,X'24'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2402'    SRC RMID CODE
         CLI   0(R6),X'0A'  SRC
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'   MOD-'
         MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    MOD RMID CODE
         CLI   0(R6),X'0F' MOD
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'   MAC-'
         MVI   BYTE2,X'22'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2202'    MAC RMID CODE
         CLI   0(R6),X'0E'   MAC
         BE    ELEMRMID
         MVC   PRTP28(7),=CL7'       '
         XC    BYTE0(13),BYTE0      CLEAR SEARCH ARGUMENT
         B     ELEMPTF
ELEMRLSE MVC   PRTP20(7),=CL7'RELEAS-'
         B     ELEMDTA
ELEMHOLD MVC   PRTP20(7),=CL7'  HOLD-'
ELEMDTA  MVC   PRTP09(12),=CL12'HAS DATA OF '
         MVC   PRTP27(8),8(R6)   ERROR/SYSTEM/USER
         MVC   PRTP27+9(7),=CL7'REASON-'
         MVC   PRTP27+16(7),1(R6)    HOLDDATA REASON-ID
*-------- GET HOLD   DATE ------------------------
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MF=(E,EMDRPL13)
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HDTYEXIT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
HDTYMORE EQU   *
*--------------------------------------
         MVC   POS2(6),=CL6'HOLDAY'
         BAL   R8,PRTHOLD
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HDTYEXIT
         CLC   CSIKEY+15(7),1(R6)
         BNE   HDTYNEXT
         MVC   PRTP27+23(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTYLOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTYFND
         LA    R7,1(R7)
         BCT   R9,HDTYLOOP
         B     HDTYEXIT
HDTYNEXT EQU   *
         CALL  PTFVSAM,MF=(E,EMDRPL14) SEQUENTIAL
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HDTYEXIT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
         B     HDTXMORE
HDTYFND  LA    R7,3(R7)
HDTYFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTYFND2
         BCT   R9,HDTYFND1
         B     HDTYEXIT
HDTYFND2 MVC   PRTP27+28(5),1(R7)
HDTYEXIT EQU   *
         B     ELEMPRT2
ELEMJCLN MVC   PRTP09(19),=CL19'HAS DATA OF JCLIN.'
         B     ELEMPRT2
ELEMPRT  MVC   PRTP35(8),1(R6)    ELEMENT REPLACEMENT NAME
ELEMPRTX MVC   PRTP09(20),=CL20'HAS REPLACEMENTS OF '    DOR001
ELEMPRT2 MVC   REPORT(7),=CL7'   >>>>>'
         ST    R6,SAVER6
         BAL   R9,PRTSYSM
         L     R6,SAVER6
         LA    R6,8(R6)
         B     ELEMPTF
ELEMRMID EQU   *
         ST    R6,SAVER6
         MVC   BYTENAME(8),1(R6)
         MVC   PRTP35(8),1(R6)    ELEMENT REPLACEMENT NAME
* ------ MODCB RPL=RPLCSI,KEYLEN=13,ARG=BYTE0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,1 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ELEMPRTX  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'CSITGT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   1(8,R6),CSIKEY2+3
         BE    ELEMRMOD
         MVC   PRTP45(6),=CL6' NEW '    NOT FOUND ON CSI FILE
         B     ELEMPRTX
ELEMRMOD MVC   PRTP45(6),=CL6' RMID-'
         MVC   PRTP45+6(8),CSIKEY2+15
         LA    R7,PRTP45+14
         MVI   REPFLAG,X'00'
*-------- GET RECEVED   DATE ------------------------
         MVC   BYTENAME(8),CSIKEY2+15    SYSMOD
         MVC   BYTERELA(2),=XL2'2632'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ELEMRSTD  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'RECDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMINSD
         OI    REPFLAG,X'10'
         MVC   0(9,R7),=CL9' RECDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET INSTALLED DATE ------------------------
ELEMINSD EQU   *
         MVC   BYTERELA(2),=XL2'2633'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ELEMRSTD  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'INSDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMRSTD
         OI    REPFLAG,X'20'
         MVC   0(9,R7),=CL9' INSDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET RESTORED DATE ------------------------
ELEMRSTD EQU   *
         MVC   BYTERELA(2),=XL2'2635'    RESTORE DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ELEMPRTX  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'RSTDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ESUPPRTX
         OI    REPFLAG,X'40'
         MVC   0(9,R7),=CL9' RSTDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
ESUPPRTX EQU   *
         TM    REPFLAG,X'70'
         BNZ   ELEMPRTX
*-------- LAST SUPERCEDED BY ----------
         MVC   BYTERELA(2),=XL2'2612'    LSUBBY CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ELEMPRTX  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS27+14(6),=CL6'LSUBBY'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ELEMPRTX
         MVI   REPFLAG,X'00'
         MVC   0(8,R7),=CL8' LSUBBY-'
         MVC   8(8,R7),CSIKEY2+15
         B     ELEMPRTX
         EJECT
CSIINFO  EQU   *
         ST    R8,SAVER8
* ------ MODIFICATIONS BY DAVE RIKER
* ------ TO DISPLAY THE NAME OF ELEMSNT MODIFICATIONS BY THE SYSMOD
         MVC   GLOBNAME(8),=CL8'        '
         MVC   GLOBNAME(7),20(R5)
         MVC   GLOB0(3),=XL3'000026'
* ------ MODCB RPL=RPLGLOB,KEYLEN=11,ARG=GLOB0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------  LA    R1,2 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL2)
         CALL  PTFVSAM,MF=(E,ECALLGLB)
         BAL   R9,EXTGLOB
         B     EXTINFO  HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
* ------ MODCB RPL=RPLGLOB,OPTCD=(SEQ)
* ------ LA    R1,3 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL3)
ECSIFIND LA    R6,CSIKEY       BEGIN OF GLOBAL CSI RECORD
         USING CSIRECD,R6
*--------------------------------------
         MVC   POS2(6),=CL6'SMPCSI'
         BAL   R8,PRTCSIG
*--------------------------------------
         CLC   IRBNAME1(7),20(R5) END OF SYSMOD
         BH    INFOCSI
         BNE   EXTINFO
ECSIOFF  EQU   *
         MVC   SAVEKEYG(23),CSIKEY
         MVI   HOLDSWTX,X'00'
         BAL   R9,ECSIRPT
         CLI   HOLDSWTX,X'FF'
         BNE   ECSIEASY DONT NEED TO REPOINT TO SAVEKEYG
         MVI   HOLDSWTX,X'00'
         CALL  PTFVSAM,MF=(E,EMDRPL15) POINT TO RECORD WITH SAVEKEYG
         CALL  PTFVSAM,MF=(E,EGETGLB)
         BAL   R9,EXTGLOB
         B     EXTINFO
ECSIEASY CALL  PTFVSAM,MF=(E,EMDRPL3)
         CALL  PTFVSAM,MF=(E,EGETGLB)
         BAL   R9,EXTGLOB
         B     EXTINFO
         B     ECSIFIND
EXTINFO  L     R8,SAVER8
         BR    R8
         EJECT
ECSIRPT  ST    R9,SAVER9
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         CLI   IRBRELA+1,X'F4'
         BE    ECSIHERR
         CLI   IRBRELA+1,X'F5'
         BE    ECSIHSYS
         CLI   IRBRELA+1,X'F6'
         BE    ECSIHUSE
         CLI   IRBRELA+1,X'B1'
         MVC   PRTP28(7),=CL7'   MOD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B4'
         MVC   PRTP28(7),=CL7'   MAC-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B2'
         MVC   PRTP28(7),=CL7'   ZAP-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B3'
         MVC   PRTP28(7),=CL7'  XZAP-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B5'
         MVC   PRTP28(7),=CL7'MACUPD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B7'
         MVC   PRTP28(7),=CL7'SRCUPD-'
         BE    ECSIPRT
         CLI   IRBRELA+1,X'B6'
         MVC   PRTP28(7),=CL7'   SRC-'
         BE    ECSIPRT
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         CLI   IRBRELA+1,X'12'
         MVC   PRTP17(15),=CL14'LAST SUPED BY '
         BE    ECSSUPE
         CLI   IRBRELA+1,X'11'
         MVC   PRTP17(15),=CL14'   DELETED BY '
         BE    ECSSUPE
         CLI   IRBRELA+1,X'F0'
         MVC   PRTP17(15),=CL14' SUPECEDED BY '
         BE    ECSSUPE
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
         B     ECSIR9
ECSIHSYS MVC   PRTP20(7),=CL7'  HSYS-'
         B     ECSIDTA
ECSIHUSE MVC   PRTP20(7),=CL7'  HUSE-'
         B     ECSIDTA
ECSIHERR MVC   PRTP20(7),=CL7'  HERR-'
ECSIDTA  MVC   PRTP09(12),=CL12'HAS HOLD OF '
         MVC   RPTPREF(2),=CL2'++'                           DOR001
         MVC   PRTP27(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVC   SAVEFMID(8),IRBNAM2F  REASON-ID
*-------- GET HOLD   DATE ------------------------
         MVI   HOLDSWTX,X'FF'
         MVC   HOLDNAME(8),=CL8' '
         MVC   HOLDNAME(7),20(R5)        SYSMOD
         MVC   HOLDRELA(2),=XL2'3210'    ++HOLD CARD CODE
         MVC   HOLD0(3),=XL3'000032'
         CALL  PTFVSAM,MF=(E,EMDRPL13)
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HDTEEXIT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
HDTEMORE EQU   *
*--------------------------------------
         MVC   POS2(6),=CL6'HOLDAT'
         BAL   R8,PRTHOLD
*--------------------------------------
         CLC   HOLDRELA(2),CSIKEY+11
         BNE   HDTEEXIT
         CLC   CSIKEY+15(7),SAVEFMID REASON-ID MATCH ??
         BNE   HDTENEXT
         MVC   PRTP27+10(5),=CL5'DATE-'
         LA    R7,CSIKEY+23
         LA    R9,90
HDTELOOP CLC   0(4,R7),=CL4'DATE'
         BE    HDTEFND
         LA    R7,1(R7)
         BCT   R9,HDTELOOP
         B     HDTEEXIT
HDTENEXT EQU   *
         CALL  PTFVSAM,MF=(E,EMDRPL14) SEQUENTIAL
         CALL  PTFVSAM,MF=(E,ECALGLB2)
         BAL   R9,EXTGLOB
         B     HDTEEXIT HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
         B     HDTEMORE
HDTEFND  LA    R7,3(R7)
HDTEFND1 LA    R7,1(R7)
         CLI   0(R7),C'('
         BE    HDTEFND2
         BCT   R9,HDTEFND1
         B     HDTEEXIT
HDTEFND2 MVC   PRTP27+15(5),1(R7)
HDTEEXIT EQU   *
         B     ECSIPRT3
ECSSUPE  MVC   PRTP09(4),=CL4'HAS '
         MVC   PRTP30+2(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVC   REPORT(7),=CL7'   >>>>>'
         B     ECSIPRT3
ECSIPRT  MVC   PRTP09(20),=CL20'HAS REPLACEMENTS OF '    DOR001
         MVC   PRTP35(8),IRBNAM2F ELEMENT REPLACEMENT NAME
ECSIPRT2 MVC   REPORT(7),=CL7'   >>>>>'
         CLI   IRBRELA+1,X'B1' MOD
         BNE   RMIDMAC
RMIDMODX MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    MOD RMID CODE
FINDELEM MVC   BYTENAME(8),IRBNAM2F
* ------ MODCB RPL=RPLCSI,KEYLEN=13,ARG=BYTE0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,1 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ECSIPRT3  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
         LA    R6,CSIKEY2
         MVC   PRTP45(6),=CL6' RMID-'
         MVC   PRTP45+6(8),IRBNAM2F ELEMENT REPLACEMENT NAME
         MVI   REPFLAG,X'00'
         LA    R7,PRTP45+14
*-------- GET RECEVED   DATE ------------------------
         MVC   BYTENAME(8),CSIKEY2+15    SYSMOD
         MVC   BYTERELA(2),=XL2'2632'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     EFNDRSTD  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'RECDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDINSD
         OI    REPFLAG,X'10'
         MVC   0(9,R7),=CL9' RECDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET INSTALLED DATE ------------------------
EFNDINSD EQU   *
         MVC   BYTERELA(2),=XL2'2633'    INSTALL DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     EFNDRSTD  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'INSDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDRSTD
         OI    REPFLAG,X'20'
         MVC   0(9,R7),=CL9' INSDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
         LA    R7,14(R7)
*-------- GET RESTORED DATE ------------------------
EFNDRSTD EQU   *
         MVC   BYTERELA(2),=XL2'2635'    RESTORE DATE CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     EFNDLSUP  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'RSTDAT'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   EFNDLSUP
         OI    REPFLAG,X'40'
         MVC   0(9,R7),=CL9' RSTDATE-'
         UNPK  9(5,R7),CSIKEY2+15(3)
EFNDLSUP EQU   *
         TM    REPFLAG,X'70'
         BNZ   ECSIPRT3
*-------- LAST SUPERCEDED BY ----------
         MVC   BYTERELA(2),=XL2'2612'    LSUBBY CODE
         MVI   BYTE2,X'26'
         CALL  PTFVSAM,MF=(E,EMDRPL1)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     ECSIPRT3  HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*--------------------------------------
         MVC   POS2(6),=CL6'LSUBBY'
         BAL   R8,PRTCSI2
*--------------------------------------
         CLC   BYTERELA(2),CSIKEY2+11
         BNE   ECSIPRT3
         MVI   REPFLAG,X'00'
         MVC   0(8,R7),=CL8' LSUBBY-'
         MVC   8(8,R7),CSIKEY2+15
         B     ECSIPRT3
RMIDMAC  CLI   IRBRELA+1,X'B4' MAC
         BNE   RMIDMACU
RMIDMACX MVI   BYTE2,X'22'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2202'    MAC RMID CODE
         B     FINDELEM
RMIDMACU CLI   IRBRELA+1,X'B5' MAC
         BNE   RMIDSRC
         B     RMIDMACX
RMIDSRC  CLI   IRBRELA+1,X'B6' SRC
         BNE   RMIDSRCU
RMIDSRCX MVI   BYTE2,X'23'
         MVC   BYTE0(2),ZONEINDX
         MVC   BYTERELA(2),=XL2'2302'    SRC RMID CODE
         B     FINDELEM
RMIDSRCU CLI   IRBRELA+1,X'B7' SRCU
         BE    RMIDSRCX
RMIDZAP  CLI   IRBRELA+1,X'B2' ZAP
         BE    RMIDMODX
RMIDXZAP CLI   IRBRELA+1,X'B3' ZAP
         BE    RMIDMODX
ECSIPRT3 BAL   R9,PRTSYSM
*--------------------------------------
         MVC   POS2(6),=CL6'CSITGT'
         BAL   R8,PRTCSI2
ECSIR9   EQU   *
         L     R9,SAVER9
         BR    R9
*--------------------------------------
         EJECT
*--------------------------------------
INFOCSI  MVC   ARGU0(11),GLOB0
         MVC   ARGU0(2),ZONEINDX     TGT OR DLIB INDEXED
*------  MODCB RPL=RPLCSI,KEYLEN=11,ARG=ARGU0,
*------        OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
*------  LA    R1,4     LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL4)
         CALL  PTFVSAM,MF=(E,ECALLCSI)
         BAL   R9,EXTCSI
         B     EXTINFO   HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
*------  MODCB RPL=RPLCSI,OPTCD=(SEQ)
*------  LA    R1,5     LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL4)
INFOFIND LA    R7,CSIKEY2      BEGIN OF GLOBAL CSI RECORD
         USING CSIRECD,R7
         CLC   IRBNAME1(7),20(R5) END OF SYSMOD
         BH    EXTINFO
         BNE   EXTINFO
         MVI   PRTP09,X'40'
         MVC   PRTP09(100),PRTP09+1
*--------------------------------------
         MVC   POS2(8),=CL8'INFOCSI'
         BAL   R8,PRTCSIA
*--------------------------------------
         CLI   IRBRELA+1,X'02'    ATTR  IOPSTAT
         BE    INFOATTR
         BL    INFOSHOT    LOOKING FOR ATTRIBUTE OF SYSMOD FIRST
INFOCRY  MVC   SAVEKEY(23),CSIKEY2
INFORPT  BAL   R9,ECSIRPT
* ------ RE-KEY INDEXED AFTER ECSIRPT POINT TO RMID OF MOD/MAC & SRC.
* ------ MODCB RPL=RPLCSI,KEYLEN=23,ARG=SAVEKEY,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------ LA    R1,6 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL6)
         CALL  PTFVSAM,MF=(E,EGETCSI)
         BAL   R9,EXTCSI
         B     EXTINFO   HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
INFOSHOT EQU   *         SKIP IRBRELA+1 X'00' AND X'01'
* ------ MODCB RPL=RPLCSI,KEYLEN=11,ARG=ARGU0,
* ------       OPTCD=(SEQ)
* ------ LA    R1,7 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL7)
INFOPTF  CALL  PTFVSAM,MF=(E,EGETCSI)
         BAL   R9,EXTCSI
         B     EXTINFO   HAS EODAD OTHERWISE CONT NEXT INSTRUCTION
         B     INFOFIND
INFODUM  MVC   PRTP08(29),=CL29' HAS SUPED OR LSUPED. '
         BAL   R9,PRTSYSM
         B     INFOPTF
INFOATTR EQU   *
         MVC   REPORT(7),=CL7'   >>>>>'
         CLI   IRBNAM2F,X'00'
         BE    INFODUM
         TM    IRBNAM2F,X'F0'
         BZ    INFOAT04
         TM    IRBNAM2F,X'80'
         BZ    INFOAT01
         MVC   PRTP08(29),=CL29' HAS APPLIED. '
         BAL   R9,PRTSYSM
INFOAT01 TM    IRBNAM2F,X'40'
         BZ    INFOAT02
         MVC   PRTP08(29),=CL29' HAS RESTORED. '
         BAL   R9,PRTSYSM
INFOAT02 TM    IRBNAM2F,X'20'
         BZ    INFOAT03
         MVC   PRTP08(29),=CL29' HAS ACCEPTED. '
         BAL   R9,PRTSYSM
INFOAT03 TM    IRBNAM2F,X'10'
         BZ    INFOAT04
         MVC   PRTP08(29),=CL29' HAS SYS ERR ENCOUNTERED.'
         BAL   R9,PRTSYSM
INFOAT04 TM    IRBNAM2F,X'0F'
         BZ    INFOPTF
         TM    IRBNAM2F,X'04'
         BZ    INFOAT06
         MVC   PRTP08(29),=CL29' HAS SUPED OR DELETED. '
         BAL   R9,PRTSYSM
INFOAT06 TM    IRBNAM2F,X'02'
         BZ    INFOAT07
         MVC   PRTP08(29),=CL29' HAS BYPASSED. '
         BAL   R9,PRTSYSM
INFOAT07 TM    IRBNAM2F,X'01'
         BZ    INFOPTF
         MVC   PRTP08(29),=CL29' HAS DEFAULTED VIA SYS GENED.'
         BAL   R9,PRTSYSM
         B     INFOPTF
         EJECT
EXTGLOB  EQU   *
*--------------------------------------
         BAL   R8,PRTRCG      SHOW RETURN CODE WHEN PARM=DEFIX
*--------------------------------------
EXTGLOBE L     R15,SAVER15
         LTR   R15,R15
         BZ    4(R9)
         B     0(R9)
EXTCSI   EQU   *
*--------------------------------------
         BAL   R8,PRTRCC      SHOW RETURN CODE WHEN PARM=DEFIX
*--------------------------------------
         L     R15,SAVER15
         LTR   R15,R15
         BZ    4(R9)
         B     0(R9)
*--------------------------------------
         EJECT
PRTSYSM  L     R6,ONE
         CL    R6,F15
         BH    PRTSMDST
         C     R6,F1                                       DOR001
         BNE   PRTSMOD2                                    DOR001
*        CLI   RPTPREF,X'40'
*        BNE   PRTSMOD2
         MVI   POS3,C'×'                                   DOR001
PRTSMOD2 SLL   R6,1
         LA    R6,POS2(6)
         MVC   0(120,R6),RPTPREF
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVI   PRTP08,C' '
         MVC   PRTP09(112),PRTP08
         MVC   RPTPREF(3),PRTP08
         BR    R9
PRTSMDST L     R6,F15
         B     PRTSMOD2
         EJECT
PRINT1   TM    SMPCNTL1,X'10'
         BNO   PRINT2
         PUT   SMPCNTL,POS2
PRINT2   EQU   *
         PUT   SYSPRINT,PRTLINE
         MVI   POS2,C' '
         MVC   POS3(131),POS2
         L     R1,LNENUM
         SL    R1,F1
         ST    R1,LNENUM
         LTR   R1,R1
         BC    12,PRINT6
PRNTEXIT BR    R12
         EJECT
PRINT3   EQU   *
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         B     RPTREQST
         SPACE 2
PRINT4   EQU   *
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         B     CLEARLNE
         SPACE 2
PRINT5   EQU   *
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         B     PRTEXIT
         SPACE 2
PRINT6   EQU   *
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         B     PRNTEXIT
         SPACE 2
PRINT7   EQU   *
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         B     RPTNOTE
         EJECT
PRINT8   EQU   *
         MVC   PAGLINE+102(8),=CL8'RECEIVE'
         BAL   R8,PRTPAGE
*        PUT   SYSPRINT,PRTLINE
*        MVC   LNENUM,F56
         MVC   POS2(27),TITLE7
         MVC   POS30(11),TITLE8
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         L     R3,SMODRCVS
         LTR   R3,R3
         BZ    FIXEXIT3
         MVC   POS2(22),=CL22'SET BOUNDARY(GLOBAL).'
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   POS3(10),RECVCMD
RCVDAPP1 MVI   PTR39,X'00'
         LA    R4,24(R3)
RCVDAPP2 CL    R4,SMODRCVE
         BE    RCVDAPP4
         CLC   8(16,R3),8(R4)
         BL    RCVDAPP3
         MVC   SMODDATA,8(R3)
         MVC   8(16,R3),8(R4)
         MVC   8(16,R4),SMODDATA
         MVI   PTR39,X'FF'
         B     RCVDAPP1
RCVDAPP3 LA    R4,24(R4)
         B     RCVDAPP2
RCVDAPP4 TM    PTR39,X'FF'
         BO    RCVDAPP1
         LA    R3,24(R3)
         CL    R3,SMODRCVE
         BL    RCVDAPP1
         L     R3,SMODRCVS      BEG ADDRESS  OF SYSMODS TO BE RECEIVED
         L     R4,SMODRCVE      END ADDRESS  OF SYSMODS TO BE RECEIVED
         LTR   R3,R3
         BZ    FIXEXIT3
         BAL   R12,PRINT1                  PERFORM
         MVI   POS2,X'40'
         MVC   POS2(100),POS2+1
         MVC   POS2(80),TITLERVD
         BAL   R12,PRINT1                  PERFORM
RPTCOMM  EQU   *
*       RECEIVE FORMAT:
*        SYSMOD   /* FMID  DATE  HOLD/AVAIL/SUPERCEDED */
*
         MVC   GLOBNAME(8),=CL8'        '
         MVC   GLOBNAME(7),8(R3)
         MVC   GLOB0(3),=XL3'000026'
         MVC   GLOBRELA(2),=X'26A2'     FMID CODE
* ------ MODCB RPL=RPLGLOB,KEYLEN=13,ARG=GLOB0,
* ------       OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
* ------  LA    R1,2 LOGICAL CODE FOR THAT MODCB
         CALL  PTFVSAM,MF=(E,EMDRPL12)
         CALL  PTFVSAM,MF=(E,ECALLGLB)
         BAL   R9,EXTGLOB
         B     RPTNCOMN HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
         CLC   CSIKEY+11(2),GLOBRELA
         BNE   RPTNCOMN
         CLC   CSIKEY+3(7),8(R3)
         BNE   RPTNCOMN
         MVC   SAVEFMID(7),CSIKEY+15  FMID
*--------------------------------------
         MVC   GLOBRELA(2),=XL2'2632'    RECEIVE DATE CODE
         CALL  PTFVSAM,MF=(E,EMDRPL12)
         CALL  PTFVSAM,MF=(E,ECALLGLB)
         BAL   R9,EXTGLOB
         B     RPTDATE  HAS EODAD OTHERWISE CONTINUE NEXT INSTRUCTION
         CLC   GLOBRELA(2),CSIKEY+11
         BNE   RPTDATE
         UNPK  POS42+14(5),CSIKEY+15(3)
         B     RPTDATE
RPTNCOMN L     R6,SMODMISS
CHKSMODX CLI   0(R6),X'01'   LOOK FOR SYSMOD
         BE    SMODY
NOTSMOD  EQU   *
*                                                                  DOR
*        REMODIFIED TO SEARCH SYSMODS IN SHORT TIME                DOR
*                                                                  DOR
         MVC   INFOFFST+1(3),21(R6) NEXT OFFSET OF SYSMOD FIELD    DOR
         A     R6,INFOFFST      ADD VER PLUS ELEMENT DATA DOR      DOR
         CL    R6,SMODMISE
         BL    CHKSMODX
         B     SMODNONE
SMODY    CLC   8(7,R3),1(R6)
         BNE   NOTSMOD
         LA    R6,24(R6)        BYPASS  SYSMOD+DATE+SREL FIELDS    DOR
SMODFMID CLI   0(R6),X'03'
         BE    RPTFMIDM
         CLI   0(R6),X'01'   NEXT SYSMOD
         BE    SMODNONE
         LA    R6,8(R6)
         B     SMODFMID
RPTFMIDM MVC   SAVEFMID(7),1(R6)      FMID FROM SMOD MISSED TABLE
RPTFMI2M MVC   POS42+14(7),=CL7'NOT YET'
         B     RPTDATE
SMODNONE MVC   SAVEFMID(7),=CL7'NO FMID'
         B     RPTFMI2M
RPTDATE  EQU   *                                             DOR002
         CLI   18(R3),C'S' IS SYSMOD SUPERSEDED ?            DOR002
         BNE   RPTDATE2                                      DOR002
         MVC   POS42+22(5),=CL5'SUPED'                       DOR002
         MVI   18(R3),C'/'  REPLACED "S" FOR "/"             DOR002
RPTDATE2 MVC   POS42(8),16(R3)     DATE
RPTSUPED MVC   POS22(7),8(R3)      SYSMOD
         MVC   POS32+2(7),SAVEFMID   FMID
         MVC   POS32(2),COMMBEG
         LR    R5,R3           FINDHLD USE R5 ENTRY
         LA    R5,8(R5)        MOVE OFFSET OF TRUE SYSMOD
         S     R5,F20          TREAT IT AS MISSED SYSMOD ENTRY FIELD
         BAL   R12,FINDHLD     SEARCH IF THE SYSMOD HAVE HOLDDATA
         B     RPTCOMMX        DO NOT HAVE HOLDDATA
RPTCOMMH L     R6,HOLDADDR
         MVC   POS42+9(3),16(R6) SHOW ERR,SYS,OR USE HOLD TYPE DOR001
RPTCOMMX MVC   POS32+38(2),COMMEND
         BAL   R12,PRINT1                  PERFORM
RPTCOMN  LA    R3,24(R3)
         CLR   R3,R4
         BL    RPTCOMM
         MVC   POS3(3),END1
         BAL   R12,PRINT1                  PERFORM
         MVC   PAGLINE+102(8),=CL8'APPLY  '
         BAL   R8,PRTPAGE
         MVC   POS3(13),=CL13'SET BOUNDARY('
         MVC   POS3+13(8),ZONEDATA
         MVC   POS3+21(2),=CL2').'
         BAL   R12,PRINT1                  PERFORM
         MVC   POS3(8),APPLYMSG
         BAL   R12,PRINT1                  PERFORM
         L     R3,SMODRCVS      BEG ADDRESS  OF SYSMODS TO BE RECEIVED
RPTSELET MVC   POS22(7),8(R3)
         BAL   R12,PRINT1                  PERFORM
         LA    R3,24(R3)
         CLR   R3,R4
         BL    RPTSELET
         MVC   POS3(9),CHECKEND
         BAL   R12,PRINT1                  PERFORM
         CLI   PATCH,X'0F'
         BNE   FIXEXIT2
         L     R1,LNENUM
         CL    R1,F4
         BNH   PRINT7
         PUT   SYSPRINT,PRTLINE
RPTNOTE  MVC   POS2(6),NOTECMD
         MVC   POS10(15),TITLE9
         MVC   POS27(16),MSG1
         MVC   POS44(16),MSG2
         BAL   R12,PRINTER                 PERFORM
         BAL   R12,CLRPRINT                PERFORM
         MVC   MODFLAG(1),PATCH
FIXEXIT2 B     EXITFIX
FIXEXIT3 MVI   MODFLAG,X'11'
         B     EXITFIX
         EJECT
EXITFIX  EQU   *
         MVC   0(72,R13),REGSROUT RESTORE PTFROUT REGS
         L     R13,4(R13)
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
         EJECT
HOLDCHK  EQU   *                                               DOR001
         BAL   R12,FINDHLD   DOR001
         B     NOTHOLD
*        CLI   HOLDSWT,X'FF'         NO HOLD TABLE             DOR001
*        BNER  R8                                              DOR001
*        L     R7,HOLDTABS                                     DOR001
*        B     HOLDC1                                          DOR001
*HOLDC0   LA    R7,24(R7)                                       DOR001
*         C     R7,HOLDTABE                                     DOR001
*         BNLR  R8                                              DOR001
*HOLDC1   CLC   1(7,R7),20(R5)                                  DOR001
*         BHR   R8                                              DOR001
*         BL    HOLDC0                                          DOR001
         L     R7,HOLDADDR
         CLI   16(R7),C'E'                                     DOR001
         BNE   HOLDC2                                          DOR001
         MVC   RPTPREF(3),=CL3'PE-'                            DOR001
NOTHOLD  BR    R8                                              DOR001
HOLDC2   CLI   16(R7),C'S'                                     DOR001
         BNE   HOLDC3                                          DOR001
         MVC   RPTPREF(3),=CL3'SY-'                            DOR001
         BR    R8                                              DOR001
HOLDC3   MVC   RPTPREF(3),=CL3'US-'                            DOR001
         BR    R8                                              DOR001
         EJECT
         DC    H'0'
PATCH    DC    X'00'
         DC    C'PATCH AREA'
         DC    X'00'
         LTORG
CSIRECD  DSECT
CCACZID  DS    XL2  VARIED FOR INDEX
IRBCATG  DS    X      SAME  AS IRBRELA+0
IRBNAME1 DS    CL8
IRBRELA  DS    XL2 RELATIONSHIP ASSOCIATED
IRBOCCR  DS    XL2
IRBNAM2F DS    CL184     VARIED LENGTH MOST 8 CHARS
         PRINT   NOGEN
         DS     0F
         PTFCOMN
         END
./       ADD   NAME=PTFINFO
         TITLE   'PTFINFO -  FINDFIX ROUTINE '
         PRINT  NOGEN
PTFINFO  CSECT
         ENTRY EODPTFMA
         ENTRY EODINFOI
         USING *,R11
INFO     B     @PROLONG-*(,15)
         DC    AL1(11),CL11'PTFINFO'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         USING PARMPTR,R10
         LR    R11,R15
         LA    R15,REGSROUT
         ST    R15,8(R13)
         MVC   0(72,R15),0(R13)       SAVE PTFROUT REGS
         ST    R13,4(R15)
         USING WORKAREA,R13
         LA    R2,4095(R11)
         LA    R2,1(R2)
         USING INFO+4096,R2
         L     R3,TABLEND
         SL    R3,F64000
         ST    R3,TABEND
         SL    R3,F64000
         ST    R3,TABEND2
         CL    R3,ENDTBADR
         BNH   MFLAG0B
         TM    PTFMA2,X'10'
         BNO   PTFMAON
         MVI   SMODKEY1,X'00'
         MVC   POS2(16),PTFMARS
         BAL   R12,PRINTMSG                PERFORM
PTFMAON  EQU   *
         TM    INFOIN2,X'10'
         BNO   INFOINON
         MVI   SMODKEY2,X'00'
         MVC   POS2(17),INFOIRS
         BAL   R12,PRINTMSG                PERFORM
         SPACE 2
INFOINON EQU   *
         TM    INFOUT1,X'10'
         BNO   INFOUTON
         MVC   POS2(18),INFOUWE
         BAL   R12,PRINTMSG                PERFORM
         SPACE 2
INFOUTON EQU   *
         TM    PTFMA2,X'10'
         BNO   PTFMAOX
*            ----------------------------
         MVC   POS2(1),=C'A'
         MVC   POS2+1(7),SMODKEY3
         MVC   POS17(10),=CL10'SMODKEY3'
         MVC   POS32(8),SMODKEY1
         MVC   POS42(10),=CL10'SMODKEY1'
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLI   RDMASWX,X'FF'         PTFMA EOD SIGNAL INDICATOR
         CLC   SMODKEY1(7),SMODKEY3
         BNE   GETTEND
*            ----------------------------
         MVC   POS2(1),=C'B'
         MVC   POS2+1(7),SMODKEY3
         MVC   POS17(10),=CL10'SMODKEY3'
         MVC   POS32(8),SMODKEY2
         MVC   POS42(10),=CL10'SMODKEY2'
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLC   SMODKEY2(7),SMODKEY3
         BE    SAVEMFLG
         B     PTFMAOX
         EJECT
GETTEND  EQU   * PTFMA INPUT TO CORE
         L     R6,TABEND
         LR    R7,R6
         USING SYSMOD,R7
NEXTPTF  EQU   *
         CLI   RDMASWT,X'FF'             PTFMA EOD SIGNAL INDICATOR
         BE    SAVEMFLG              NO MORE PTFMA  END OF PTFINFO
         BAL   R12,GETPTF                  PERFORM
         CLR   R6,R7
         BE    NEXTPTF
         MVI   SMODFLAG,X'FF'
         SLR   R7,R6
         ST    R7,INFTABE2
*                                  TO STORE SYSMOD DATA LENGTH
         MVC   21(3,R6),INFTABE2+1 IN 21ST BYTES OF SYSMOD TABLE
*                                  FOR FASTER SYSMOD SCANNER
         MVC   SMODKEY1(7),1(R6)
         TM    PTFMASWT,X'FF'
         BO    PTFMAOY
         OI    PTFMASWT,X'FF'
PTFMAOX  EQU   *
         TM    INFOIN2,X'10'
         BNO   INFOINOX
*            ----------------------------
         MVC   POS2(1),=C'X'
         MVC   POS2+1(7),SMODKEY3
         MVC   POS17(10),=CL10'SMODKEY3'
         MVC   POS32(8),SMODKEY2
         MVC   POS42(10),=CL10'SMODKEY2'
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLC   SMODKEY2(7),SMODKEY3
         BNE   WRTEPTF
         CLC   SMODKEY1(7),SMODKEY3
         BE    SAVEMFLG
*            ----------------------------
         MVC   POS2(1),=C'Y'
         MVC   POS2+1(7),SMODKEY3
         MVC   POS17(10),=CL10'SMODKEY3'
         MVC   POS32(8),SMODKEY1
         MVC   POS42(10),=CL10'SMODKEY1'
         BAL   R12,PRTDEBUG
*            ----------------------------
         B     INFOUTON
         EJECT
WRTEPTF  EQU   *
         L     R6,TABEND2
*        ST    R6,SMODMISS
         LR    R7,R6
WRTINFIN EQU   *
         LA    R1,INFOIN
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
WRTINFCK CLI   RECORD,X'FF'
         BE    CHKMFLAG
         MVC   SYSMOD(8),RECORD
*   ----------------------------
         CLI   RECORD,X'01'
         MVC   POS27(8),=CL8'SYSMOD'
         BE    PRTMSG
         CLI   RECORD,X'02'
         MVC   POS27(8),=CL8'VER'
         BE    PRTMSG
         CLI   RECORD,X'03'
         MVC   POS27(8),=CL8'FMID'
         BE    PRTMSG
         CLI   RECORD,X'04'
         MVC   POS27(8),=CL8'NPRE'
         BE    PRTMSG
         CLI   RECORD,X'05'
         MVC   POS27(8),=CL8'PRE'
         BE    PRTMSG
         CLI   RECORD,X'06'
         MVC   POS27(8),=CL8'REQ'
         BE    PRTMSG
         CLI   RECORD,X'07'
         MVC   POS27(8),=CL8'07?'
         BE    PRTMSG
         CLI   RECORD,X'08'
         MVC   POS27(8),=CL8'SUP'
         BE    PRTMSG
         CLI   RECORD,X'10'
         MVC   POS27(8),=CL8'IFMID'
         BE    PRTMSG
         CLI   RECORD,X'11'
         MVC   POS27(8),=CL8'IFREQ'
         BE    PRTMSG
         CLI   RECORD,X'0F'
         MVC   POS27(8),=CL8'MOD'
         BE    PRTMSGL
         CLI   RECORD,X'0E'
         MVC   POS27(8),=CL8'MAC'
         BE    PRTMSGL
         CLI   RECORD,X'0D'
         MVC   POS27(8),=CL8'ZAP'
         BE    PRTMSGL
         CLI   RECORD,X'0C'
         MVC   POS27(8),=CL8'MACUPD'
         BE    PRTMSGL
         CLI   RECORD,X'0B'
         MVC   POS27(8),=CL8'SRCUPD'
         BE    PRTMSGL
         CLI   RECORD,X'0A'
         MVC   POS27(8),=CL8'SRC'
         BE    PRTMSGL
         CLI   RECORD,X'1F'
         MVC   POS27(8),=CL8'HOLD'
         BE    PRTMSGL
         CLI   RECORD,X'1E'
         MVC   POS27(8),=CL8'RELEASE'
         BE    PRTMSGL
         CLI   RECORD,X'1D'
         MVC   POS27(8),=CL8'JCLIN'
         BE    PRTMSGL
         MVC   POS27(8),=CL8'?????'
PRTMSG   MVC   POS2(8),SYSMOD
         B     PRTMSG2
PRTMSGL  EQU   *
         GET   INFOIN,RECORD
         MVC   8(8,R7),RECORD      LONG FIELD REQUIRED TO LOAD
         MVC   POS2(16),SYSMOD
         LA    R7,8(R7)
PRTMSG2  MVC   POS17(10),=CL10'INFOIN'
         BAL   R12,PRTDEBUG
*   ----------------------------
         LA    R7,8(R7)
         C     R7,TABLEND
         BL    WRTINFIN
         MVC   POS2(33),=CL33'ERROR: 500 - INFOIN TABLE IS FULL'
*                             12345678901234567890123456789012345
         BAL   R12,PRINTMSG
ABENDINF ABEND 500,DUMP
         EJECT
PRINTMSG EQU   *
         PUT   SYSPRINT,PRTLINE
         MVI   POS2,C' '
         MVC   POS3(100),POS2
         BR    R12
         EJECT
CHKMFLAG EQU   *
         CLI   0(R6),X'01'
         BNE   MFLAG01
*            ----------------------------
         MVC   POS2(8),0(R6)
         MVC   POS17(10),=CL10'CHKMFLAG'
         MVC   POS32(10),=CL10'SYSMOD  '
         BAL   R12,PRTDEBUG
*            ----------------------------
         SLR   R7,R6
         ST    R7,INFTABE
*                                  TO STORE SYSMOD DATA LENGTH
         MVC   21(3,R6),INFTABE+1  IN 21ST BYTES OF SYSMOD TABLE
*                                  FOR FASTER SYSMOD SCANNER
* ------- FORMAT OF SYSMOD SECTION --------------------------
*                  1         2
*        012345678901234567890123456789
*        ××      ×       ×    ×  ×
*        ××      ×       ×    ×  +-ANY ORDER OF ENVIRONMENTAL,
*        ××      ×       ×    ×    ELEMENT, OR EXCEPTIONS
*        ××      ×       ×    +----THE OFFSET LENGTH BETWEEN THE
*        ××      ×       ×         FIRST BYTE TO END OF SYSMOD TABLE
*        ××      ×       +--------- THE SREL NAME OF THE FIRST VER
*        ××      +-----------------THE DATE (YY/MM/DD) OF SYSMOD PUT
*        ×+------------------------SYSMOD NAME
*        +-------------------------ALWAYS X'01' FOR SYSMOD NAME
* --------------------------------------------------------------
*    ANY SYSMOD MISSES  FROM CDS OR CSI  WILL BE KEPT IF
*         IT MEET THE CONDITION OF SELECTED SREL (SYSIN) OR
*         FMID IS BEING ACCEPTED/APPLIED IN CDS/CSI.
* --------------------------------------------------------------
         MVC   SMODKEY2(7),1(R6)
PTFMAOY  EQU   *
*            ----------------------------
         MVI   POS2,C'Z'
         MVC   POS2+1(7),SMODKEY2
         MVC   POS17(10),=CL10'SMODKEY2'
         MVC   POS32(8),SMODKEY1
         MVC   POS42(10),=CL10'SMODKEY1'
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLI   RDMASWX,X'FF'         PTFMA EOD SIGNAL INDICATOR
         BE    LASTPTF
         CLC   SMODKEY1(7),SMODKEY2
         BE    PTFMAOX
         BH    WRTEPTF2
LASTPTF  L     R7,INFTABE2
         L     R6,TABEND
         B     WRTINFOU
WRTEPTF2 EQU   *
         L     R7,INFTABE
         L     R6,TABEND2
WRTINFOU EQU   *
         TM    INFOUT1,X'10'
         BNO   CALLPARM
         SR    R4,R4
         LR    R5,R7
         D     R4,F8VAL
         LR    R4,R6
         LA    R3,1(R5)
         AL    R3,PTR59
         ST    R3,PTR59
WRTIFOUT EQU   *
         LA    R1,INFOUT
         LR    R0,R4
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
*            ----------------------------
         MVC   POS2(8),0(4)
         MVC   POS17(10),=CL10'INFOUT'
         BAL   R12,PRTDEBUG
*            ----------------------------
         LA    R4,8(R4)
         BCT   R5,WRTIFOUT
         LA    R1,INFOUT
         LA    R0,SMODKEY3
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
CALLPARM EQU   *
*            ----------------------------
         MVC   POS2(8),MAXDATE
         MVC   POS17(10),=CL10'MAXDATE'
         MVC   POS27(8),8(R6)
         BAL   R12,PRTDEBUG
*            ----------------------------
         LA    R3,1(R6)
         CLC   MAXDATE(8),8(R6)
         BL    CHKRLGTH
         BAL   R12,FINDMOD                 PERFORM
         B     CHKMFLGR
CHKRLGTH EQU   *
*            ----------------------------
         MVC   POS2(8),0(R6)
         MVC   POS17(10),=CL10'NEXT SYSMOD'
         BAL   R12,PRTDEBUG
*            ----------------------------
         CL    R6,TABEND2
         BE    PTFMAOX
         CL    R6,TABEND
         BE    INFOUTON
         LA    R1,200
         B     PTRABEND
INFOINOX EQU   *
         TM    PTFMA2,X'10'
         BO    PTFMAOY
         MVI   MODFLAG,X'07'
         B     INFOEXIT
CHKMFLGR EQU   *
*            ----------------------------
         MVC   POS2(8),0(R6)
         MVC   POS17(10),=CL10'MISSED'
         MVC   POS27(4),SYSISREL
         MVC   POS32(4),NULLADDR
         MVC   POS42(4),CDSISREL
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLC   SYSISREL(4),NULLADDR
         BNE   NEXTMFLG
         CLC   CDSISREL(4),NULLADDR
         BE    CHKRLGTH
NEXTMFLG EQU   *
* --------------------------------------------------------------
*    ANY INFOIN SYSMOD MISSES  FROM CDS OR CSI  WILL BE KEPT IF
*         IT MEETS THE CONDITION OF SELECTED SREL (SYSIN) OR
*         FMID THAT IS BEING ACCEPTED/APPLIED IN CDS/CSI.
*         THUS THE UNCONDITIONAL SREL SECTION
*         IS STRIPPED FROM SYSMOD SECTION. AND THE NEW SYSMOD
*         SECTION IS REDUCED WITH PROPER SREL AND FMID. THE ELEMENT
*         SECTION IS ALWAYS THE LAST PART OF SYSMOD SECTION AND
*         NEVER BE REMOVED.      DOR
* --------------------------------------------------------------
         LA    R5,0(R6,R7)
         LA    R4,16(R6)
         L     R12,ENDTBADR
         ST    R12,VERADDR
         MVI   SRELFLAG,X'00'      00= NOT SELECTED  FF= SELECTED   DOR
CKMFLG02 EQU   *
         CLI   0(R4),X'10'      IFREQ FMID
         BE    GETNMFLG
         CLI   0(R4),X'11'      IFREQ SYSMOD
         BE    GETNMFLG
*                               LOOK FOR ELEMENT SECTION
         CLI   0(R4),X'1F'      HOLDDATA
         BE    CKMFLY02         DO THE REST OF THE SYSMOD SECTION
         CLI   0(R4),X'1E'      RELEASE DATA
         BE    CKMFLY02         DO THE REST OF THE SYSMOD SECTION
         CLI   0(R4),X'1D'      JCLIN   INFORMATION
         BE    CKMFLY02         DO THE REST OF THE SYSMOD SECTION
         CLI   0(R4),X'0A'      ELEMENT DATA (MOD, MAC,SRC,MACUPD,
         BL    CKMFLG12           SRCUPD,ZAP)
         CLI   0(R4),X'0F'
         BNH   CKMFLY02         DO THE REST OF THE SYSMOD SECTION
CKMFLG12 CLI   0(R4),X'02'
         BNE   GETNMFLG
GETMFLG  EQU   *
*            ----------------------------
         MVC   POS2(8),0(R4)
         MVC   POS17(10),=CL10'VER   '
         MVC   POS27(4),SYSISREL
         MVC   POS42(4),CDSISREL
         BAL   R12,PRTDEBUG
*            ----------------------------
         LR    R3,R4
         MVI   SRELSWT,X'00'        THE TRUE SREL IS ON
         CLC   1(4,R4),SYSISREL
         BE    CKMFLG03
         CLC   1(4,R4),CDSISREL
         BE    CKMFLG03
GETNMFLG EQU   *
         MVI   SRELSWT,X'FF'        THE TRUE SREL IS OFF
         LA    R4,8(R4)
         CLR   R4,R5
         BNL   CLRFLAG1
         CLI   0(R4),X'FF'
         BE    CLRFLAG1
         B     CKMFLG02
CKMFLY02 CLI   SRELFLAG,X'00'                               DOR
         BE    GETNMFLG          IGNORE ELEMENT SECTIONS    DOR
         CLI   SRELSWT,X'00'
         BE    CKMFLX02          POSTION TO TRUE SREL       DOR
         LR    R3,R4             POSTION TO ELEMENT SECTION DOR
         B     CKMFLX02                                     DOR
GETNMFLGF  EQU  *
*            ----------------------------
         MVC   POS2(8),0(R4)
         MVC   POS17(10),=CL10'MISSED'
         BAL   R12,PRTDEBUG
*            ----------------------------
         B     GETNMFLG
CKMFLG03 EQU   *
CKMFLG13 LA    R4,8(R4)
         CLI   0(R4),X'03'
         BNE   CKTABEND
         ST    R3,TABINFO
         LA    R3,1(R4)
         BAL   R12,FINDMOD                 PERFORM
         B     GETNMFLGF
         MVI   SRELFLAG,X'FF'      00= NOT SELECTED  FF= SELECTED   DOR
         L     R3,TABINFO   FMID FOUND
*            ----------------------------
         MVC   POS2(8),0(R4)
         MVC   POS17(10),=CL10'FMID FOUND'
         BAL   R12,PRTDEBUG
*            ----------------------------
CKMFLX02 EQU   *
         LA    R4,8(R4)
         CLR   R4,R5
         BNL   CKFLAG1
         CLI   0(R4),X'02'
         BE    CKFLAG1
         CLI   0(R4),X'FF'
         BE    CKFLAG1
         B     CKMFLX02
CKFLAG1  EQU   *
*            ----------------------------
         MVC   POS2(8),0(R4)
         MVC   POS17(10),=CL10'VER/END '
         BAL   R12,PRTDEBUG
*            ----------------------------
         TM    FLAG1,X'40'
         BO    NENDTBADR
         OI    FLAG1,X'40'
*            ----------------------------
         MVC   POS2(8),=CL8'FLAG1-40'
         MVC   POS17(10),=CL10'SMODMISS'
         BAL   R12,PRTDEBUG
*            ----------------------------
         MVC   SMODMISS(4),ENDTBADR
NENDTBADR EQU  *
         L     R7,ENDTBADR
         TM    FLAG1,X'80'
         BO    GETADDR
*            ----------------------------
         MVC   POS2(8),=CL8'FLAG1-80'
         MVC   POS17(16),0(R6)
         BAL   R12,PRTDEBUG
*            ----------------------------
         MVC   SYSMOD(16),0(R6)
         LA    R7,16(R7)
         OI    FLAG1,X'80'
GETADDR  EQU   *
         BAL   R12,GENDTBADR               PERFORM
         CLI   0(R4),X'02'
         BE    GETMFLG
CLRFLAG1 EQU   *
         L     R12,ENDTBADR
         SL    R12,VERADDR
         ST    R12,INFLENG
         L     R12,VERADDR BEGIN OF  SYSMOD SECTION
         MVC   21(3,R12),INFLENG+1 STORE IN OFFSET FIELD OF SYSMOD TAB
         NI    FLAG1,X'7F'
         B     CHKRLGTH
CKTABEND EQU   *
         CLR   R4,R5
         BNL   CKFLAG1
         CLI   0(R4),X'FF'
         BE    CKFLAG1
         CLI   0(R4),X'02'
         BE    CKFLAG1
         B     CKMFLG03
COPYMFLG MVC   SMODFLAG(1),0(R3)
GENDTBADR EQU  *
         STM   R5,R6,INFOSAVE              SAVE REGS
         LR    R6,R4
         SLR   R6,R3
         LR    R5,R6
LESSONE  EQU   *
         BCTR  R6,R0
         N     R6,F255
         EX    R6,COPYMFLG
         LA    R7,1(R6,R7)
         LA    R3,1(R6,R3)
         LA    R6,1(R6)
         SLR   R5,R6
         LTR   R6,R5
         BNZ   LESSONE
         CL    R7,TABEND2
         BNL   MFLAG0D
         ST    R7,ENDTBADR
         LM    R5,R6,INFOSAVE              RESTORE REGS
         BR    R12
MFLAG0D  EQU   *
         MVI   MODFLAG,X'0D'
         B     INFOEXIT
EODPTFMA MVC   SMODKEY1(7),SMODKEY3
*            ----------------------------
         MVC   POS2(8),=CL8'EODPTFMA'
         MVC   POS2+9(1),RDMASWX
         MVC   POS2+11(1),RDMACNT
         MVC   POS17(8),SMODKEY1
         MVC   POS27(8),SMODKEY2
         BAL   R12,PRTDEBUG
*            ----------------------------
         MVI   RDMASWT,X'FF'         PTFMA EOD SIGNAL INDICATOR
         CLI   RDMASWX,X'04'         SEARCH FOR NEXT PLUSTWO?
         BE    EXITPTF               YES EXIT OF GETPTF ROUTINE
         B     LASTPTF               NORMAL END OF PTF
ENDPTF   CLC   SMODKEY2(7),SMODKEY3
         BE    SAVEMFLG
         B     PTFMAOX
EODINFOI MVC   SMODKEY2(7),SMODKEY3
*            ----------------------------
         MVC   POS2(8),=CL8'EODINFOI'
         MVC   POS17(8),SMODKEY2
         MVC   POS27(8),SMODKEY1
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLC   SMODKEY1(7),SMODKEY3
         BE    SAVEMFLG
         BL    PTFMAOY      FIRST PTF TO BE TO INFOIN
         B     INFOUTON
SAVEMFLG EQU   *
         MVC   SMODMISE(4),ENDTBADR
         TM    INFOUT1,X'10'
         BNO   SETINFOU
         MVC   POS2(16),INFOUWS
         BAL   R12,PRINTMSG                PERFORM
SETINFOU EQU   *
         TM    INFOIN2,X'10'
         BNO   SETPTFMA
         MVC   POS2(15),INFOIRE
         BAL   R12,PRINTMSG                PERFORM
SETPTFMA EQU   *
         TM    PTFMA2,X'10'
         BNO   INFOEXIT
         MVC   POS2(14),PTFMARE
         BAL   R12,PRINTMSG                PERFORM
         B     INFOEXIT
         EJECT
GETPTF   EQU   *
         ST    R12,INFOSR12
NEXTLINE EQU   *
         CLI   PLUSSWT,X'00'
         BNE   HADPLUS2
         MVI   RDMASWT,X'00'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     NEWLINE
HADPLUS2 MVI   PLUSSWT,X'00'
         MVC   RECORD(80),RECORD2
         LA    R4,RECORD
NEWLINE  LA    R5,PTR51
         CLC   0(2,R4),PLUSTWO
         BNE   EXITPTF
CHECKCXD EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'PLUSTWO'
         MVC   POS17(30),0(R4)
         BAL   R12,PRTDEBUG
*            ----------------------------
         LA    R4,2(R4)
CHECKCMD EQU   *
         CLC   0(3,R4),PTF
         BE    SYMBOL
         CLC   0(4,R4),APAR
         BE    SYMBOL
         CLC   0(8,R4),FUNCT
         BE    SYMBOL
         CLC   0(7,R4),USERMOD
         BE    SYMBOL
         CLC   0(3,R4),DMAC
         BE    MAC
         CLC   0(3,R4),DMOD
         BE    MOD
         CLC   0(3,R4),DSRC
         BE    SRC
         CLC   0(3,R4),DZAP
         BE    ZAP
         CLC   0(6,R4),DMACUPD
         BE    MACUPD
         CLC   0(6,R4),DSRCUPD
         BE    SRCUPD
         CLC   0(4,R4),DHOLD
         BE    HOLDDATA
         CLC   0(7,R4),DRLSE
         BE    RLSEDATA
         CLC   0(5,R4),DJCLIN
         BE    JCLIN
         CLC   0(6,R4),DDELE
         BE    NAMEMA
         CLC   0(4,R4),DMOVE
         BE    NAMEMA
         CLC   0(7,R4),DRNME
         BE    NAMEMA
         CLC   0(6,R4),DASSGN
         BE    NAMEMA
CHECKVER TM    INFOSWT,X'80'
         BO    OLDIFCMD
         CLC   0(3,R4),VER
         BE    VERSYMB
         TM    INFOSWT,X'40'
         BO    OLDIFCMD
         CLC   0(2,R4),IF
         BE    IFSYMB
OLDIFCMD EQU   *
         CLI   0(R4),C' '
         BNE   EXITPTF
         LA    R4,1(R4)
         CLR   R4,R5
         BNL   NEXTLINE
         B     CHECKCMD
MOD      MVI   SMODFLAG,X'0F'
NAMESCAN EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'NAMESCAN'
         MVC   POS17(30),0(R4)
         BAL   R12,PRTDEBUG
*            ----------------------------
         LA    R5,PTR51
         BAL   R12,SCANLINE
NAMEMA   MVI   RDMASWT,X'04'               EOD SIGNAL
         BAL   R9,READMA     READ ELEMENT DATA AND LOOK FOR PLUS TWO
         LA    R5,PTR51
         LA    R3,3
NAMEPTWO CLC   0(2,R4),PLUSTWO
         BE    CHECKXXD
         LA    R4,1(R4)
         BCT   R3,NAMEPTWO
         B     NAMEMA
CHECKXXD LA    R4,2(R4)
CHECKELE CLC   0(3,R4),DMAC
         BE    MAC
         CLC   0(3,R4),VER
         BE    CHECKVER
         CLC   0(2,R4),IF
         BE    CHECKVER
         CLC   0(3,R4),PTF
         BE    EXITPLUS
         CLC   0(4,R4),APAR
         BE    EXITPLUS
         CLC   0(8,R4),FUNCT
         BE    EXITPLUS
         CLC   0(7,R4),USERMOD
         BE    EXITPLUS
         CLC   0(3,R4),DMOD
         BE    MOD
         CLC   0(3,R4),DSRC
         BE    SRC
         CLC   0(3,R4),DZAP
         BE    ZAP
         CLC   0(6,R4),DMACUPD
         BE    MACUPD
         CLC   0(6,R4),DSRCUPD
         BE    SRCUPD
         CLC   0(4,R4),DHOLD
         BE    HOLDDATA
         CLC   0(7,R4),DRLSE
         BE    RLSEDATA
         CLC   0(5,R4),DJCLIN
         BE    JCLIN
         CLC   0(6,R4),DDELE
         BE    NAMEMA
         CLC   0(4,R4),DMOVE
         BE    NAMEMA
         CLC   0(7,R4),DRNME
         BE    NAMEMA
         CLC   0(6,R4),DASSGN
         BE    NAMEMA
         CLI   0(R4),C' '
         BNE   NAMEMA              GO NEXT RECORD THE ++ RECORD MAY
*                                   BE A COMMENT RECORD
         LA    R4,1(R4)
         CLR   R4,R5
         BL    CHECKELE
EXITPLUS MVI   PLUSSWT,X'FF'
         MVC   RECORD2(80),RECORD
         B     EXITPTF
MAC      MVI   SMODFLAG,X'0E'
         B     NAMESCAN
ZAP      MVI   SMODFLAG,X'0D'
         B     NAMESCAN
MACUPD   MVI   SMODFLAG,X'0C'
         B     NAMESCAN
SRCUPD   MVI   SMODFLAG,X'0B'
         B     NAMESCAN
SRC      MVI   SMODFLAG,X'0A'
         B     NAMESCAN
HOLDDATA MVI   SMODFLAG,X'1F'
         B     NAMESCAN
RLSEDATA MVI   SMODFLAG,X'1E'
         B     NAMESCAN
JCLIN    MVI   SMODFLAG,X'1D'
         MVI   SMODNAME,C' '
         MVC   SMODNAME+1(14),SMODNAME
         MVC   SMODNAME(5),DJCLIN
*            ----------------------------
         MVC   POS2(8),=CL8'JCLIN'
         MVC   POS17(16),0(R7)
         BAL   R12,PRTDEBUG
*            ----------------------------
         MVC   SYSMOD+16(1),SMODFLAG
         LA    R7,16(R7)
         MVI   SMODNAME,X'FF'
         B     NAMEMA
EXITPTF  EQU   *
         L     R12,INFOSR12
         BR    R12
         EJECT
READMA   EQU   *
         ST    R12,SAVER12X
*            ----------------------------
         CLC   RDMASWT(1),RDMASWX
         BNE   READRPT
READCNT  SR    R12,R12
         IC    R12,RDMACNT
         LA    R12,1(R12)
         C     R12,=F'255'
         BE    READRPT
         STC   R12,RDMACNT
         B     READGA
READRPT  MVC   POS2(6),=CL6'READMA'
         MVC   POS2+7(1),RDMASWX
         MVC   POS2+9(1),RDMACNT
         MVI   RDMACNT,X'00' RESET TO ZERO
         MVC   RDMASWX(1),RDMASWT
         BAL   R12,PRTDEBUG
READGA   L     R12,SAVER12X
*            ----------------------------
         LA    R1,PTFMA
         LA    R0,RECORD
         L     R15,48(,R1)
         BALR  R14,R15                     STD LINKAGE
         LA    R4,RECORD
         BR    R9
         EJECT
SYMBOL   EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'SYMBOL'
         MVC   POS17(30),0(R4)
         BAL   R12,PRTDEBUG
*            ----------------------------
         NI    INFOSWT,X'3F'
         MVC   SYSMOD+8(8),PTR51
         MVI   SMODFLAG,X'01'
         BAL   R12,SCANLINE                PERFORM
         CLI   MODFLAG,X'00'
         BNE   ABEND200
         BAL   R12,SCANLINE                PERFORM
         CLI   MODFLAG,X'04'
         MVI   MODFLAG,X'06'
         BC    7,ABEND200
         MVI   MODFLAG,X'00'
         B     NEXTLINE
ABEND200 EQU   *
         MVC   POS2(13),=CL13'ERROR: 200 - '
*        CONVERT  (TO,FROM,LENGTH)
         LA    R3,POS15
         LA    R4,MODFLAG
         LA    R5,1
         CONVERT (R3,R4,R5)
         MVC   POS18(27),=CL27' - MODFLAG ERROR IN PTFINFO'
*                              1234567890123456789012345678901234567
         PUT   SYSPRINT,PRTLINE
         LA    R1,200
         LA    R0,128
         SLL   R0,24
         OR    R1,R0
         SVC   13                          ABEND
         EJECT
COMMENT  EQU   *
         CLC   0(2,R4),COMEND
         BER   R12
         LA    R4,1(R4)
         CLR   R4,R5
         BL    COMMENT
         MVI   RDMASWT,X'08'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     COMMENT
         SPACE 2
VERSYMB  EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'VER'
         MVC   POS17(30),0(R4)
         BAL   R12,PRTDEBUG
*            ----------------------------
         NI    INFOSWT,X'BF'
         MVI   SMODFLAG,X'02'
DOSCAN   EQU   *
         BAL   R12,SCANLINE                PERFORM
         CLI   MODFLAG,X'00'
         BNE   ABEND200
CHCKFMID EQU   *
         CLC   0(4,R4),FMID
         BNE   CHCKNPRE
         MVI   SMODFLAG,X'03'
         B     DOSCAN
CHCKNPRE EQU   *
         CLC   0(4,R4),NPRE
         BNE   CHECKPRE
         MVI   SMODFLAG,X'04'
         B     DOSCAN
CHECKPRE EQU   *
         CLC   0(3,R4),PRE
         BNE   CHECKREQ
         MVI   SMODFLAG,X'05'
         B     DOSCAN
CHECKREQ EQU   *
         CLC   0(3,R4),REQ
         BNE   CHECKSUP
         MVI   SMODFLAG,X'06'
         B     DOSCAN
CHECKSUP EQU   *
         CLC   0(3,R4),SUP
         BNE   CHKCMEND
         MVI   SMODFLAG,X'08'
         B     DOSCAN
CHKCMEND EQU   *
         CLC   0(2,R4),COMBEG
         BNE   CHKPERID
         BAL   R12,COMMENT                 PERFORM
CHKPERID EQU   *
         CLI   0(R4),C'.'
         BE    NAMEMA                      LOOK FOR ++
         LA    R4,1(R4)
         CLR   R4,R5
         BL    CHCKFMID
         MVI   RDMASWT,X'0C'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     CHCKFMID
         EJECT
CHKMFLA2 EQU   *
         CLI   SMODFLAG,X'11'
         BE    NAMEMA                      LOOK FOR ++
         MVI   MODFLAG,X'02'
         B     ABEND200
MOREFLAG EQU   *
         BAL   R12,SCANLINE                PERFORM
         CLI   MODFLAG,X'00'
         BNE   ABEND200
IFSYMB   EQU   *
         CLC   0(4,R4),FMID
         BNE   CHKCEND2
         MVI   SMODFLAG,X'10'
         B     MOREFLAG
CHKCEND2 EQU   *
         CLC   0(2,R4),COMBEG
         BNE   CHKREQ2
         BAL   R12,COMMENT                 PERFORM
         B     IFSYMB
CHKREQ2  EQU   *
         CLC   0(3,R4),REQ
         BNE   CHKDOT2
         MVI   SMODFLAG,X'11'
         B     MOREFLAG
CHKDOT2  EQU   *
         CLI   0(R4),C'.'
         BE    CHKMFLA2
         LA    R4,1(R4)
         CLR   R4,R5
         BL    IFSYMB
         MVI   RDMASWT,X'10'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     IFSYMB
         EJECT
SCANLINE EQU   *
         ST    R12,SAVER12
SRCHLINE EQU   *
         CLI   0(R4),C'('
         BE    BUMPCHAR
         CLI   0(R4),C' '
         BE    NEXTCHAR
         CLI   0(R4),C','
         BE    NEXTCHAR
         CLC   0(2,R4),COMBEG
         BNE   SRCHDOT
         BAL   R12,COMMENT                 PERFORM
         B     SRCHLINE
SRCHDOT  EQU   *
         CLI   0(R4),C'.'
         BNE   NEXTCHAR
         MVI   MODFLAG,X'04'
         L     R12,SAVER12
         BR    R12
NEXTCHAR EQU   *
         LA    R4,1(R4)
         CLR   R4,R5
         BL    SRCHLINE
         MVI   RDMASWT,X'14'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     SRCHLINE
BUMPCHAR EQU   *
         LA    R4,1(R4)
CHKPAREN EQU   *
         CLI   0(R4),C')'
         BNE   CHKCOMMA
EXITX    EQU   *
         L     R12,SAVER12
         BR    R12
CHKCOMMA EQU   *
         CLI   0(R4),C','
         BE    BUMPCHR2
         CLI   0(R4),C' '
         BE    BUMPCHR2
         CLC   0(2,R4),COMBEG
         BNE   CHKDOT3
         BAL   R12,COMMENT                 PERFORM
         B     BUMPCHAR
CHKDOT3  EQU   *
         CLI   0(R4),C'.'
         BNE   COPYSMOD
COPYSMOD EQU   *
         CLI   SMODFLAG,X'1F'           HOLDDATA
         BE    HOLDCOPY
         CLI   SMODFLAG,X'1E'           RELEASE DATA
         BE    HOLDCOPY
         CLI   SMODFLAG,X'0A'
         BL    CPYSMOD2
         CLI   SMODFLAG,X'0F'
         BH    CPYSMOD2
ELEMCOPY LR   R3,R4
*        ELEMENT DATA FIELD (16 BYTES LONG)
*        01234567890123456
*        ××        ×
*        ××        +- RESERVED (BLANKED) (SEVEN CHARS)
*        ×+--------- MOD/MAC/SRC/MACUPD/SRCUPD/ZAP NAME (EIGHT CHARS)
*        +---------- SYSMOD FLAG X'0A' FOR SRC ; X'0B' FOR SRCUPD
*                                X'0C' FOR MACUPD ; X'0D' FOR ZAP
*                                X'0E' FOR MAC ; X'0F' FOR MOD
*
NEXTELEM LA   R4,1(R4)
         CLI   0(R4),C')'
         BNE   NEXTELEM
         MVI   SMODNAME,C' '
         MVC   SMODNAME+1(14),SMODNAME
         BCTR  R4,0
         LR    R1,R4
         SR    R1,R3
         LR    R4,R3
         EX    R1,MVCELEM
EXITHLD  EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'COPYELE'
         MVC   POS17(16),0(R7)
         BAL   R12,PRTDEBUG
*            ----------------------------
         MVC   SYSMOD+16(1),SMODFLAG
         LA    R7,16(R7)
         MVI   SMODNAME,X'FF'
         B     EXITX
HOLDCOPY EQU  *
*        HOLD/RELEASE DATA FIELD (16 BYTES LONG)
*        01234567890123456
*        ××       ×
*        ××       +- ERROR/SYSTEM/USER (EIGHT CHARS)
*        ×+--------- REASON-ID         (SEVEN CHARS)
*        +---------- SYSMOD FLAG X'1F' FOR HOLD; X'1E' FOR RELEASE
*                                X'1D' FOR JCLIN;
         MVI   SMODNAME,C' '
         MVC   SMODNAME+1(14),SMODNAME
HLD0     CLC  0(3,R4),ERRORX
         BNE  HLD1
         MVC  SMODNAME+8(8),ERRORX
         B    HLDREAS
HLD1     CLC  0(3,R4),SYSTEM
         BNE  HLD2
         MVC  SMODNAME+8(8),SYSTEM
         B    HLDREAS
HLD2     CLC  0(3,R4),USER
         BNE  HLD3
         MVC  SMODNAME+8(8),ERRORX
         B    HLDREAS
HLD3     CLC  0(6,R4),REASON
         BE   HOLDREAS
         CLI  0(R4),C'.'
         BE   EXITHLD
HLDREAS  LA   R4,1(R4)
         CLR  R4,R5
         BL   HLD0
         MVI   RDMASWT,X'1C'               EOD SIGNAL
         BAL  R9,READMA
         LA   R5,PTR51
         B    HLD0
HOLDREAS EQU  *
         LA   R4,5(R4)
HLDNRS   LA   R4,1(R4)
         CLR  R4,R5
         BNL  EXITHLD
         CLI  0(R4),C'('
         BNE  HLDNRS
         LA   R4,1(R4)
         LR   R3,R4
HOLDRS   LA   R4,1(R4)
         CLI   0(R4),C')'
         BNE   HOLDRS
         BCTR  R4,0
         LR    R1,R4
         SR    R1,R3
         LR    R4,R3
         EX    R1,MVCELEM     REASON-ID HAS VARIABLE FIELD LENGTH
         B     EXITHLD
MVCELEM  MVC   SMODNAME(*-*),0(R4)
CPYSMOD2 EQU   *
         MVC   SMODNAME(7),0(R4)
        CLI   SMODFLAG,X'02'
        BNE   CPYSMOD3
        MVC   SMODNAME+4(3),=CL3'   '   DROP PARENTHESIS FOR SREL
CPYSMOD3 EQU   *
*            ----------------------------
         MVC   POS2(8),=CL8'COPYSM2'
         MVC   POS17(16),0(R7)
         BAL   R12,PRTDEBUG
*            ----------------------------
         CLI   SMODFLAG,X'01'
         BE    COPYMOD2
         MVC   SYSMOD+8(1),SMODFLAG
         LA    R7,8(R7)
ENDFLAG  EQU   *
         MVI   SMODNAME,X'FF'
         CLI   SMODFLAG,X'02'
         BE    BUMPWORD
         LA    R4,7(R4)
         CLI   SMODFLAG,X'11'
         BNH   ENDLINE
BUMPCHR2 EQU   *
         LA    R4,1(R4)
ENDLINE  EQU   *
         CLR   R4,R5
         BL    CHKPAREN
         MVI   RDMASWT,X'18'               EOD SIGNAL
         BAL   R9,READMA                   PERFORM
         B     CHKPAREN
BUMPWORD EQU   *
         LA    R4,4(R4)
         B     ENDLINE
COPYMOD2 EQU   *
         MVC   SYSMOD+16(1),SYSMOD
         LA    R7,16(R7)
         B     ENDFLAG
INFOEXIT EQU   *
         MVC   0(72,R13),REGSROUT     RESTORE PTFROUT REGS
         L     R13,4(R13)
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
MFLAG0B  EQU   *
         MVI   MODFLAG,X'0B'
         B     INFOEXIT
MFLAG01  EQU   *
         MVI   MODFLAG,X'01'
         MVC   POS2(8),0(R6)
         MVC   POS17(10),=CL10'MFLAG01 '
         MVC   POS32(10),=CL10'NO SMOD  '
         BAL   R12,PRTDEBUG
         B     COPYMOD2
         DROP  R10
         DROP  R11
PATCH    EQU   *
         DC    C'PATCH AREA'
         DS    0F
         DC    33F'0'
PTFMARS  DC    CL16'PTFMA READ START'
INFOUWS  DC    CL16'INFOUT WRITE END'
FUNCT    DC    C'FUNCTION'
*F8VAL    DC    F'00008'   DUPLICATED IN PTFCOMN DOR001
F255     DC    F'00255'
VERADDR  DC    F'0000'
INFLENG  DC    F'0000'
VERFLAG  DC    X'00'
SRELFLAG DC    X'00'
SRELSWT  DC    X'00'
APAR     DC    C'APAR'
FMID     DC    C'FMID'
NPRE     DC    C'NPRE'
INFOUWE  DC    CL18'INFOUT WRITE START'
PTFMARE  DC    CL14'PTFMA READ END'
PLUSTWO  DC    C'++'
PLUSSWT  DC    X'00'
IF       DC    C'IF'
DMAC      DC    C'MAC'
DMOD      DC    C'MOD'
DZAP      DC    C'ZAP'
DSRC      DC    C'SRC'
DSRCUPD   DC    C'SRCUPD'
DMACUPD   DC    C'MACUPD'
DHOLD     DC    C'HOLD'
DRLSE     DC    C'RELEASE'
DJCLIN    DC    C'JCLIN'
DDELE     DC    C'DELETE'
DMOVE     DC    C'MOVE'
DRNME     DC    C'RENAME'
DASSGN    DC    C'ASSIGN'
COMBEG   DC    C'/*'
COMEND   DC    C'*/'
INFOIRS  DC    CL17'INFOIN READ START'
INFOIRE  DC    CL15'INFOIN READ END'
PTF      DC    C'PTF'
USERMOD  DC    C'USERMOD'
USER     DC    CL8'USER   '
ERRORX   DC    CL8'ERROR  '
SYSTEM   DC    CL8'SYSTEM '
REASON   DC    CL7'REASON'
VER      DC    C'VER'
*PRE      DC    C'PRE' DUPLICATED IN PTFCOMN DOR001
*REQ      DC    C'REQ' DUPLICATED IN PTFCOMN DOR001
SUP      DC    C'SUP'
RECORD2  DC    CL80' '
         LTORG
SYSMOD   DSECT
SMODFLAG DS   CL1
SMODNAME DS   CL7
         PRINT   NOGEN
         DS    0F
         PTFCOMN
         END
./       ADD   NAME=PTFPARM
         TITLE    'PTFPARM - FINDFIX ROUTINE'
PTFPARM  CSECT
         PTFCOMN  CSECT=YES
         LTORG
         END
./       ADD   NAME=PTFROUT
*        11/17/86 CDSI/DOR   ADD TIME &DATE ON HEADER LINE  DOR001
         TITLE  'PTFROUT - MAIN FINDFIX ROUTINE'
         PRINT   NOGEN
PTFROUT  CSECT
         USING *,R11
ROUT     B     @PROLONG-*(,15)
         DC    AL1(11),CL11'PTFROUT'
         DC    CL16' &SYSDATE &SYSTIME'
         DS    0F
@PROLONG STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         LA    R2,4095(R11)
         LA    R2,1(R2)
         USING ROUT+4096,R2
         USING PARMPTR,R10
         L     R10,PTFPARM
         LR    R5,R1                  SAVE PARM REGISTER
         GETMAIN R,LV=4096            GET STORAGE FOR SAVEAREA
         ST    R1,8(R13)              FORWARD POINTER
         ST    R1,SAVEPOOL            FORWARD POINTER
         ST    R13,4(R1)              BACKWARD POINTER
         LR    R13,R1
         USING WORKAREA,R13
         MVC   SYSREGS(72),0(R13)
         LR    R1,R5
         L     R6,0(R1)
         LTR   R6,R6
         BZ    NOPARM
         LH    R3,0(R6)
         LTR   R3,R3
         BC    12,NOPARM
         LA    R6,2(R6)
FINDPARM CLC   0(3,R6),LC@EQU
         BE    LCNT
         CLI   0(R6),C','
         BE   NEXTCHAR
         CLC   0(5,R6),=CL5'DEBUG'
         BNE   DEFIXQ
         MVI   DEBUG,X'FF'
         S     R3,=F'5'
         LA    R6,5(R6)
         B     NEXTCHAR
DEFIXQ   CLC   0(5,R6),=CL5'DEFIX'
         BNE   DEVSMQ
         MVI   DEFIX,X'FF'
         S     R3,=F'5'
         LA    R6,5(R6)
         B     NEXTCHAR
DEVSMQ   CLC   0(6,R6),=CL5'DEVSAM'
         BNE   DUMPQ
         MVI   DEVSAM,X'FF'
         S     R3,=F'6'
         LA    R6,6(R6)
         B     NEXTCHAR
DUMPQ    CLC   0(4,R6),=CL4'DUMP'
         BNE   NEXTCHAR
         MVI   DUMP,X'FF'
         S     R3,=F'4'
         LA    R6,4(R6)
         B     NEXTCHAR
LCNT     SR    R4,R4
         IC    R4,3(R6)
         SLL   R4,28
         SRL   R4,20
         SR    R5,R5
         IC    R5,4(R6)
         SLL   R5,28
         SRL   R5,24
         OR    R4,R5
         LA    R4,12(R4)
         ST    R4,PTR13
         CVB   R4,PTR12
         ST    R4,F56
         S     R3,=F'5'
         LA    R6,5(R6)
NEXTCHAR LA    R6,1(R6)
         S     R3,=F'1'
         C     R3,=F'0'
         BH    FINDPARM
NOPARM   EQU   *
         MVC   LNENUM,F56
         MVC   PAGNUM,F1
         MVC   SYSIN1,EOXSYSIN
         MVC   PTFMA1,EOXPTFMA
         MVC   INFOIN1,EOXINFOI
         MVC   CNTL1,EOXCNTL
         LA    R7,6
         LA    R8,DSMPCDS
NEXTDDN  EQU   *
         MVC   PARMDDN,0(R8)
         L     R6,8(R8)
         LA    R1,PARMDDN
         LA    R0,PARMBLK
         SVC   24                          DEVTYPE
         LTR   R15,R15
         BNZ   BUMPDDN
         BAL   R1,OPENDDN                  PARM SET BRCH
         DC    F'0'
OPENDDN  EQU   *
         ST    R6,0(R1)
         MVI   0(R1),X'80'
         SVC   19                          OPEN
BUMPDDN  EQU   *
         LA    R8,12(R8)
         BCT   R7,NEXTDDN
         LA    R7,3
         LA    R8,DINFOUT
COPYDDN  EQU   *
         MVC   PARMDDN,0(R8)
         L     R6,8(R8)
         LA    R1,PARMDDN
         LA    R0,PARMBLK
         SVC   24                          DEVTYPE
         LTR   R15,R15
         BNZ   BUMPDDN2
         BAL   R1,OPENDDN2                 PARM SET BRCH
         DC    F'0'
OPENDDN2 EQU   *
         ST    R6,0(R1)
         MVI   0(R1),X'8F'
         SVC   19                          OPEN
BUMPDDN2 EQU   *
         LA    R8,12(R8)
         BCT   R7,COPYDDN
         LA    R9,CORESIZE
         LA    R8,TABLEBEG
         CNOP  0,4
         BAL   R1,SAVEDDN3                 PARM SET BRCH
         DC    F'0'
         DC    F'0'
         DC    X'C000'
SAVEDDN3 EQU   *
         ST    R9,0(,R1)
         ST    R8,4(,R1)
         SVC   4                           GETMAIN
         L     R8,TABLEBEG
         AL    R8,TABLENG
         LA    R8,0(R8)
         ST    R8,TABLEND
         TM    SYSPRT1,X'10'
         BNO   MFLAG08
*                                                               DOR001
*   INSERT TIME & DATE ON PRTLINE                                    .
         STM   R0,R8,SAVETIME SAVE REGISTERS
         TIME  DEC                GET DATE IN R1 IN FORM 00YYJJJF    .
         ST    R0,BADLNGTH        SAVE TIME WHILE YOU'RE AT IT       .
         LR    R2,R1              PUT IN R2 TO PASS TO DATE SUBROUTINE
         LA    R8,INDEX                                             .
         LA    R1,DATERSLT-INDEX(R8)  PTR TO DATE'S RESULT FIELD    .
         L     R15,=V(DATE)       IRSS DATE SUBROUTINE (DATECONV)    .
         BALR  R14,R15            CONVERT 00YYJJJF TO MM/DD/YY       .
*    EDIT INTO  HEADER LINE BUFFER                                   .
         ED    TIMERSLT-INDEX(11,R8),BADLNGTH                       .
         LM    R0,R8,SAVETIME    RESTORE REGISTERS
*        MVC   POS2(58),HDRLINE   INCLUDE TIME & DATE                .
*                                                               DOR001
         MVI   PAGLINE,C' '
         MVC   PAGLINE+1(122),PAGLINE
         L     R1,PAGNUM                                       DOR003
         MVC   PAGLINE+1(58),HDRLINE                           DOR003
         CVD   R1,DOUBLE                                       DOR003
         MVC   PAGLINE+115(5),=X'4020202120'                   DOR003
         ED    PAGLINE+115(4),DOUBLE+6                          DOR003
         MVC   PAGLINE+108(8),=CL8' - PAGE '                   DOR003
         PUT   SYSPRINT,PAGLINE                                DOR003
         MVI   PAGLINE,X'F1'    PAGE EJECT FROM SECOND AND UP  DOR003
* DOR003
         MVI   POS2,C' '
         MVC   POS3(58),POS2
         L     R15,VPTFENV
         BALR  R14,R15                     STD LINKAGE
         CLI   MODFLAG,X'00'
         BNE   CLOSEDDN
         L     R15,VPTFINFO
         BALR  R14,R15                     STD LINKAGE
         CLI   MODFLAG,X'00'
         BNE   CLOSEDDN
         CLC   SYSISREL,NULLADDR
         BNE   STARTMSG
         CLC   CDSISREL,NULLADDR
         BNE   STARTMSG
         CLI   PTR40,X'FF'
         BE    CLOSEDDN
         MVI   MODFLAG,X'05'
         B     CLOSEDDN
STARTMSG EQU   *
         MVC   POS2(20),STRTMSG
         PUT   SYSPRINT,PRTLINE
         L     R15,VPTFFIX
         BALR  R14,R15                     STD LINKAGE
CLOSEDDN EQU   *
ABEND300 EQU   *
         SR    R8,R8
         IC    R8,MODFLAG
         LA    R8,PTR31(8)
         MVC   PATCH,0(R8)
         CLI   DUMP,X'FF'
         BNE   NODUMP
         MVC   POS2(32),=CL32'ERROR: 700 - PARM=DUMP REQUESTED'
*                             12345678901234567890123456789012
         PUT   SYSPRINT,PRTLINE
         ABEND 700,DUMP
         DS    0F
NODUMP   LA    R1,300
         CLI   PTR39A,X'FF'
         BNE   FREEALL
         MVC   POS2(35),=CL35'ERROR: 300 - CONTROL DUMP REQUESTED'
*                             12345678901234567890123456789012345
         PUT   SYSPRINT,PRTLINE
         B    PTRABEND
FREEALL  LA    R8,TABLEBEG
         CNOP  0,4
         BAL   R1,FREEMAIN                 PARM SET BRCH
         DC    F'0'
         DC    F'0'
         DC    X'C000'
FREEMAIN EQU   *
         ST    R8,4(,R1)
         SVC   5                           FREEMAIN
         LA    R7,9
         LA    R8,DSMPCDS
NXTCLDDN EQU   *
         MVC   PARMDDN,0(R8)
         L     R6,8(R8)
         LA    R1,PARMDDN
         LA    R0,PARMBLK
         SVC   24                          DEVTYPE
         LTR   R15,R15
         BNZ   NXTDDN
         NOPR  R0
         BAL   R1,CLOSEDD2                 PARM SET BRCH
         DC    F'0'
CLOSEDD2 EQU   *
         ST    R6,0(R1)
         MVI   0(R1),X'80'
         SVC   20                          CLOSE
NXTDDN   EQU   *
         LA    R8,12(R8)
         BCT   R7,NXTCLDDN
         MVC   0(72,R13),SYSREGS
         L     R13,4(R13)
         MVC   16(4,R13),NULLADDR
         MVC   19(1,R13),PATCH
         LM    R14,R12,12(R13)             RESTORE REGS
         BR    R14                         EXIT
MFLAG08  EQU   *
         MVI   MODFLAG,X'08'
         B     CLOSEDDN
         DROP  R10
         DROP  R11
PTFPARM  DC    V(PTFPARM)
SAVETIME DC    10F'0'
PARMDDN  DC    CL8'        '
PARMBLK  DC    6F'0'
PATCH    DC    X'00'
         DC    C'PATCH AREA'
         DC    X'00'
         DC    33F'0'
STRTMSG  DC    CL20'START OF REAL PTFFIX'
LC@EQU   DC    CL3'LC='
         DS    0D
BADLNGTH DC    D'0'
EOXSYSIN DC    VL3(EODSYSIN)
EOXPTFMA DC    VL3(EODPTFMA)
EOXINFOI DC    VL3(EODINFOI)
EOXCNTL  DC    VL3(EODCNTL)
         LTORG
         DROP  R2
         EJECT
         PRINT  GEN
         DS    0F                          BOUNDARY OF FULLWORDS
DATE     CSECT
         SAVE  (14,12),T,*
*      R1 = ADDR FOR OUTPUT (DS CL8'MM/DD/YY')
*      R2 = R1 FROM THE TIME MACRO
         LR    R12,R15
         USING DATE,R12
         LA    R11,4095(R12)   SECOND BASE
         LA    R11,1(,R11)     MAKE IT 4096 X'1000'
         USING DATE+4096,R11
         LA    R3,DATESAVE
         ST    R13,4(,R3)
         ST    R3,8(,R13)
         LR    R13,R3
         USING PARMAREA,R1
*        L     R1,0(,R1)   GET ADDR FOR OUTPUT            *LACCD*
         ST    R2,W2                    STORE DATE (00YYDDDF)
         SR    R2,R2
         ICM   R2,1,W2+1              PICK YY FROM 00YYDDDF
         SLL   R2,4                 SHIFT 00YY TO 0YY0
         O     R2,=X'0000900F' 0YY0 TO 9YYF
         ST    R2,OVERLAP
         MVC   WRKPKYR+1(2),OVERLAP+2
         OI    WRKPKYR,X'01'         009YYF TO 019YYF
         ZAP   WRKPKNUM(8),WRKPKYR(3)
         DP    WRKPKNUM(8),=PL1'4'   DIVISABLE BY FOUR
         ZAP   WRKLEAPS,WRKPKNUM(7)  SAVE QUOTIENT
         ZAP   WRKLEAPR,WRKPKNUM+7(1)  SAVE REMAINDER
         MVI   MONTHTBL+5,28            SETUP FEB NONLEAP YEAR
         CP    WRKLEAPR,=PL1'0'  IF ZEROS THEN ITS A LEAP YEAR
         BNE   NOLEAP
         MVI   MONTHTBL+5,29            SETUP FEB LEAP YEAR
NOLEAP   UNPK  MMDDYY(3),W2+1(2)           UNPK YR
         XC    W1(6),W1                  CLEAR YR FOR DAY RTN.
         CVB   R4,W1                    GET DAY
         LA    R5,MONTHTBL-4            SET BACK PTR
MONLUPE  LA    R5,4(R5)                 INCR THRU MON TBL
         SH    R4,0(R5)                 DROP DOWN THRU MONTBL
         BH    MONLUPE                  NOT YET, TRY AGAIN
         AH    R4,0(R5)                 ADD BACK THE DAY
         CVD   R4,W1                    MAKE
         OI    W2+3,X'0F'                  THE DAY
         UNPK  MMDDYY+5(3),W2+2(2)            PRINTABLE
         MVI   MMDDYY+5,C'/'            RESTORE SLASH
         MVC   MMDDYY+3(2),2(R5)          MOVE THE MONTH
         MVI   MMDDYY+2,C'/'  RESTORE SLASH
         MVC   THEDATE,MMDDYY         MOVE DATE TO USER
RETURN   DS    0H
         L     R13,4(,R13)
         RETURN (14,12),,RC=0 RESTORE REGS AND RETURN
         EJECT
         SPACE 2
MONTHTBL DS    0CL48
MTK      DC    H'31',C'01' JAN
         DC    H'28',C'02' FEB
         DC    H'31',C'03' MAR
         DC    H'30',C'04' APR
         DC    H'31',C'05' MAY
         DC    H'30',C'06' JUN
         DC    H'31',C'07' JLY
         DC    H'31',C'08' AUG
         DC    H'30',C'09' SEP
         DC    H'31',C'10' OCT
         DC    H'30',C'11' NOV
         DC    H'255',C'12' DEC
         SPACE 2
DATESAVE     DS    9D
W1       DS    F              WORKARE1
W2       DS    F              WORKAREA2
OVERLAP  DS    F
MMDDYY   DS    CL9
WRKPKYR  DS    PL3                YEAR TO BE CHECKED BY LEAP YEAR RTN
WRKPKNUM DS    PL8                GENERAL USE PACKED DECIMAL FIELD
WRKLEAPS DS    PL2                PACKED - YEAR / 4   - TRUNCATED
WRKLEAPR DS    PL2                PACKED - REMAINDER AFTER DIVIDE BY 4
         DS    0F
         LTORG
         DROP  R11
         DS    0F                          BOUNDARY OF FULLWORDS
PARMAREA DSECT
THEDATE  DS    CL8
         SPACE 5
         PRINT NOGEN
         DS    0F
         PTFCOMN
         END
./       ADD   NAME=PTFVSAM
         TITLE    'PTFVSAM - FINDFIX VSAM IO ROUTINE'
         PRINT  GEN
PTFVSAM  CSECT
         USING *,R11
         B     @PROLONG-*(,15)
         DC    AL1(11),CL11'PTFVSAM'
         DC    CL16' &SYSDATE &SYSTIME'
@PROLONG EQU   *
         STM   R14,R12,12(R13)             SAVE REGS
         LR    R11,R15
         USING PARMPTR,R10
         LA    R15,PTFREGV PTFVSAM SAVEREGS
         ST    R13,4(R15)
         ST    R15,8(R13)
         LR    R9,R13
         LR    R13,R15
         USING WORKAREA,R9
         SR    R3,R3
         L     R2,0(R1)     PICK ADDRESS
         IC    R3,0(R2)     PICK CODE BYTE
         CLI   R3,X'24'
         BH    ABEND900
         B     *+4(R3)
         B     VSAMCLSE       +0
         B     MODRPL         +4
         B     MEXIT          +8 CANCELED R15=7FFFF IS EODAD SIGNAL
         B     CALLCSI        +12
         B     GETCSI         +16
         B     CALLGLOB       +20
         B     GETGLOB        +24
         B     MODACB         +28
         B     GETGLOB2       +32
         B     CALGLOB2       +36
ABEND900 EQU   *
         MVC   POS2(38),=CL38'ERROR: 900 - ILLEGAL PTFVSAM CALL CODE'
*                             12345678901234567890123456789012345678
         PUT   SYSPRINT,PRTLINE
         ABEND 900,DUMP
VSAMCLSE EQU   *
         L     R3,0(R2)       PICK VALUE
         LA    R3,0(R3)       DROP CODE
         LTR   R3,R3
         BZ    EODAD           CLOSE VSAMCSI
         B     EODAD2          CLOSE VSAMGLOB
* -------------------------------------------------------------
         DS    0F
* -------------------------------------------------------------
* -------------------------------------------------------------
         DS    0F
MODRPL   EQU   *
         L     R1,0(R2) PICK VALUE
         LA    R1,0(R1)       DROP CODE
         LTR   R1,R1
         BZ    MEXIT
* -------------------------------------------------------------
         CL    R1,F1 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL2
         MVC   WORD0(13),BYTE0
         MODCB RPL=RPLCSI,KEYLEN=13,ARG=WORD0,                      XXXX
               OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL2  CL    R1,F2 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL3
         MVC   WORD1(11),GLOB0
         MODCB RPL=RPLGLOB,KEYLEN=11,ARG=WORD1,                     XXXX
               OPTCD=(SYN,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL3  CL    R1,F3 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL4
         MODCB RPL=RPLGLOB,OPTCD=(SEQ)
         B     MEXIT
* -------------------------------------------------------------
MODRPL4  CL    R1,F4 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL5
         MVC   WORD2(11),ARGU0
         MODCB RPL=RPLCSI,KEYLEN=11,ARG=WORD2,                      XXXX
               OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL5  CL    R1,F5 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL6
         MODCB RPL=RPLCSI,OPTCD=(SEQ)
         B     MEXIT
* -------------------------------------------------------------
MODRPL6  CL    R1,F6 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL7
         MVC   WORD3(23),SAVEKEY
         MODCB RPL=RPLCSI,KEYLEN=23,ARG=WORD3,                        XX
               OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL7  CL    R1,F7 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL8
         MVC   WORD2(11),ARGU0
         MODCB RPL=RPLCSI,KEYLEN=11,ARG=WORD2,                       XXX
               OPTCD=(SEQ)
         B     MEXIT
* -------------------------------------------------------------
MODRPL8  CL    R1,F8 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL9
         MVI   WORD2,X'00'
         MODCB RPL=RPLCSI,KEYLEN=1,ARG=WORD2,                        XXX
               OPTCD=(LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL9  CL    R1,F9 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL10
         MVI   WORD2,X'00'
         MODCB RPL=RPLGLOB,KEYLEN=1,ARG=WORD2,                       XXX
               OPTCD=(LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL10 CL    R1,F10 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL11
         MVC   WORD0(2),BYTE0
         MODCB RPL=RPLCSI,KEYLEN=2,ARG=WORD0,                       XXXX
               OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL11 CL    R1,F11 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL12
         MODCB RPL=RPLCSI,                                           XXX
               OPTCD=(SEQ)
         B     MEXIT
* -------------------------------------------------------------
MODRPL12 CL    R1,F12 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL13
         MVC   WORD1(13),GLOB0
         MODCB RPL=RPLGLOB,KEYLEN=13,ARG=WORD1,                     XXXX
               OPTCD=(SYN,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL13 CL    R1,F13 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL14
         MVC   WORD4(13),HOLD0
         MODCB RPL=RPLGLOB2,KEYLEN=13,ARG=WORD4,                    XXXX
               OPTCD=(SYN,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MODRPL14  CL    R1,F14 LOGICAL CODE FOR THAT MODCB
         BNE   MODRPL15
         MODCB RPL=RPLGLOB2,OPTCD=(SEQ)
         B     MEXIT
MODRPL15 CL    R1,F15 LOGICAL CODE FOR THAT SETPOINT
         BNE   MEXIT
         MVC   WORD5(23),SAVEKEYG
         MODCB RPL=RPLGLOB,KEYLEN=23,ARG=WORD5,                     XXXX
               OPTCD=(SYN,NSP,KEY,DIR,LOC,GEN,KGE)
         B     MEXIT
* -------------------------------------------------------------
MEXIT    LA    R15,0
         B     EXITVSAM
         EJECT
* -------------------------------------------------------------
         DS    0F
MODACB   EQU   *
         L     R1,0(R2) PICK VALUE
         LA    R1,0(R1)       DROP CODE
         LTR   R1,R1
         BZ    ACBCSI
* -------------------------------------------------------------
         CL    R1,F1 LOGICAL CODE FOR THAT MODCB
         BNE   MEXIT
         MODCB ACB=VSAMGLOB,MACRF=(KEY,DIR,SEQ,IN)
         B     MEXIT
* -------------------------------------------------------------
ACBCSI   MODCB ACB=VSAMCSI,MACRF=(KEY,DIR,SEQ,IN)
         B     MEXIT
         EJECT
         DS    0F
GETCSI   EQU   *
GETCSIN  LA    R15,RPLCSI
         ST    R15,RPLADDR
         GET   RPL=RPLCSI                  GET FIRST RECORD
         LTR   R15,R15
         BZ    GETSCSI
         CHECK RPL=RPLCSI     WAIT FOR VSAM PROCESSING ENDING
         LTR   R15,R15
         BNZ   GETERR
GETSCSI  EQU   *
         SHOWCB RPL=RPLCSI,AREA=RBA,LENGTH=8,FIELDS=(RBA,RECLEN)
         L     R1,RECAREA               ADDRESS FOR RECORD
         A     R1,RKP
         L     R4,RECLEN                DATA LENGTH
         EX    R4,MOVEKEY2              MOVE HIGHKEY
         CLI   DEVSAM,X'FF'
         BNE   CSIEXIT
         MVC   POS2(6),=CL6'VSAM'
         MVC   POS2+7(32),RECAREA
         BAL   R12,PRTDEON
         MVC   POS2(6),=CL6'VREC'
         L     R4,RECLEN
         EX    R4,MVCPOS2
         BAL   R12,PRTDEON
         B     CSIEXIT
MVCPOS2  MVC   POS2+7(*-*),CSIKEY2
*-------------------------------------------------------------
         EJECT
         DS    0F
GETGLOB  EQU   *
GETGLOBN LA    R15,RPLGLOB
         ST    R15,RPLADDR
         GET   RPL=RPLGLOB              GET FIRST RECORD
         LTR   R15,R15
         BZ    GETSGLOB
         CHECK RPL=RPLGLOB    WAIT FOR VSAM PROCESSING ENDING
         LTR   R15,R15
         BNZ   GETERR
GETSGLOB EQU   *
         SHOWCB RPL=RPLGLOB,AREA=RBAG,LENGTH=8,FIELDS=(RBA,RECLEN)
         L     R1,RECAREAG              ADDRESS FOR RECORD
         A     R1,RKPG
         L     R4,RECLENG               DATA LENGTH
         EX    R4,MOVEKEY               MOVE HIGHKEY
         CLI   DEVSAM,X'FF'
         BNE   CSIEXIT
         MVC   POS2(6),=CL6'VSAMG '
         MVC   POS2+7(32),RECAREAG
         BAL   R12,PRTDEON
         MVC   POS2(6),=CL6'VRECG'
         L     R4,RECLENG
         EX    R4,MVCPOS
         BAL   R12,PRTDEON
         B     CSIEXIT
MVCPOS   MVC   POS2+7(*-*),CSIKEY
*-------------------------------------------------------------
         EJECT
         DS    0F
GETGLOB2 EQU   *
GETGLBN2 LA    R15,RPLGLOB2
         ST    R15,RPLADDR
         GET   RPL=RPLGLOB2              GET FIRST RECORD
         LTR   R15,R15
         BZ    GETSGLB2
         CHECK RPL=RPLGLOB2    WAIT FOR VSAM PROCESSING ENDING
         LTR   R15,R15
         BNZ   GETERR
GETSGLB2 EQU   *
         SHOWCB RPL=RPLGLOB2,AREA=RBA2,LENGTH=8,FIELDS=(RBA,RECLEN)
         L     R1,RECAREA2               ADDRESS FOR RECORD
         A     R1,RKP2
         L     R4,RECLEN2              DATA LENGTH
         EX    R4,MOVEKEY               MOVE HIGHKEY
         CLI   DEVSAM,X'FF'
         BNE   CSIEXIT
         MVC   POS2(6),=CL6'VSAMG2'
         MVC   POS2+7(32),RECAREA2
         BAL   R12,PRTDEON
         MVC   POS2(6),=CL6'VRECG2'
         L     R4,RECLEN2
         EX    R4,MVCPOS
         BAL   R12,PRTDEON
         B     CSIEXIT
         EJECT
         DS    0F
CALLCSI  EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        TO REPLACE SMP/E CSI FOR SMP4 CDS
*        READ VSAM CSI TARGET OR DLIB DSN (DO NOT USE GLOBAL)
*        SELECT  PTF NAME AND ITS SUPERCEDED SYSMODS
*        BY INDEXED SEQUENTIAL KEY WORD.
*        DISPLAY.
*
         CLI   CSISWT,X'00'
         BNE   CSIOPEN
         MVI   CSISWT,X'FF'
         MODCB ACB=VSAMCSI,EXLST=EXLST
         OPEN  (VSAMCSI)
         TESTCB ACB=VSAMCSI,OFLAGS=OPEN
         BNZ   OPENERR
         SHOWCB ACB=VSAMCSI,AREA=CINV,LENGTH=16,                       X
               FIELDS=(CINV,LRECL,KEYLEN,RKP)
         L     R3,CINV                  CONTROL INT. SIZE
         SH    R3,H4                 ADJUST FOR CIDF
         ST    R3,MAXPOS                CI LENGTH
         L     R3,KEYLEN
         BCTR  R3,0
         CH    R3,H142                MAX TO WRITE
         BNH   R2OK
         LH    R3,H142
R2OK     EQU   *
         MVC   POS2(17),CSISTAR
         BAL   R8,PRTDEFR9
         ST    R3,KEYLEN
CSIOPEN  EQU   *
         B     GETCSIN
CSIEXIT  EQU   *
         LA    R15,0
         B     EXITVSAM
EODAD    EQU   *
         MVC   POS2(15),CSIEND
         BAL   R8,PRTDEFR9
         MVI   CSISWT,X'00'
EODADX   CLOSE (VSAMCSI)
         L     R15,=XL4'00007FFF'      EODAD SIGNAL
         B     EXITVSAM
         EJECT
         DS    0F
CALLGLOB  EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        READ VSAM CSI GLOBAL DSN
*        SELECT  PTF NAME RECEIVED.
*        STORE INTO SYSIN TABLE.
*
*
         CLI   GLOBSWT,X'00'
         BNE   GLOBOPEN
         MVI   GLOBSWT,X'FF'
         MODCB ACB=VSAMGLOB,EXLST=EXLST2
         OPEN  (VSAMGLOB)
         TESTCB ACB=VSAMGLOB,OFLAGS=OPEN
         BNZ   OPENERRG
         SHOWCB ACB=VSAMGLOB,AREA=CINVG,LENGTH=16,                     X
               FIELDS=(CINV,LRECL,KEYLEN,RKP)
         MVC   CINV2(16),CINVG         COPY FOR SECOND RPL
         L     R3,CINVG                 CONTROL INT. SIZE
         SH    R3,H4                 ADJUST FOR CIDF
         ST    R3,MAXPOSG               CI LENGTH
         L     R3,KEYLENG
         BCTR  R3,0
         CH    R3,H61                MAX TO WRITE
         BNH   R2OKG
         LH    R3,H61
R2OKG    EQU   *
         MVC   POS2(17),CSIGSTAR
         BAL   R8,PRTDEFR9
         ST    R3,KEYLENG
GLOBOPEN EQU   *
         B     GETGLOBN
         EJECT
         DS    0F
CALGLOB2  EQU   *
*
*        IMPLEMENTED BY DAVID RIKER
*         1 CURIE COURT  ROCKVILLE, MD 20850 (202) 362 1160
*
*        READ VSAM CSI GLOBAL DSN
*        SELECT  PTF NAME RECEIVED.
*        STORE INTO SYSIN TABLE.
*
*
         CLI   GLOBSWT,X'00'
         BNE   GLB2OPEN
         MVI   GLOBSWT,X'FF'
         OPEN  (VSAMGLOB)
         TESTCB ACB=VSAMGLOB,OFLAGS=OPEN
         BNZ   OPENERRG
         SHOWCB ACB=VSAMGLOB,AREA=CINVG,LENGTH=16,                     X
               FIELDS=(CINV,LRECL,KEYLEN,RKP)
         MVC   CINV2(16),CINVG         COPY FOR SECOND RPL
         L     R3,CINVG                 CONTROL INT. SIZE
         SH    R3,H4                 ADJUST FOR CIDF
         ST    R3,MAXPOSG               CI LENGTH
         L     R3,KEYLENG
         BCTR  R3,0
         CH    R3,H61                MAX TO WRITE
         BNH   R2OKG2
         LH    R3,H61
R2OKG2   EQU   *
         MVC   POS2(17),CSIGSTAR
         BAL   R8,PRTDEFR9
         ST    R3,KEYLENG
GLB2OPEN EQU   *
         B     GETGLBN2
         EJECT
EODAD2   EQU   *
         MVC   POS2(15),CSIGEND
         BAL   R8,PRTDEFR9
         MVI   GLOBSWT,X'00'
EODADXG  CLOSE (VSAMGLOB)
EODCODE  L     R15,=XL4'00007FFF'      EODAD SIGNAL
EXITVSAM EQU   *
*        ST    R15,SAVERC15
         ST    R15,SAVER15
         L     R13,4(,R13)
         LM    R14,R12,12(R13)             RESTORE REGS
*        L     R15,SAVERC15
         BR    R14                         EXIT
EOFCODE  L     R15,=XL4'00007777'      END OF FILE SIGNAL RC0 FDBK=16
         B     EXITVSAM
OPENERRG EQU   *
         SHOWCB ACB=VSAMGLOB,LENGTH=4,AREA=ERROR,FIELDS=(ERROR)
         B     WRITERR
OPENERR  EQU   *
         SHOWCB ACB=VSAMCSI,LENGTH=4,AREA=ERROR,FIELDS=(ERROR)
OPNXERR  MVC   TYPERR,=CL26' OPEN  FAILED, FEEDBACK='
WRITERR  EQU   *
         L     R1,ERROR
         C     R1,F16
         BE    EOFCODE
         SR    R1,R1
         IC    R1,ERROR+1 RETURN CODE
         CVD   R1,CVDAREA
         MVC   ERRMSG(4),=X'40202120'
         ED    ERRMSG(4),CVDAREA+6
         SR    R1,R1
         IC    R1,ERROR+2
         CVD   R1,CVDAREA
         MVC   ERRMSG+4(4),=X'40202120'
         ED    ERRMSG+4(4),CVDAREA+6
         SR    R1,R1
         IC    R1,ERROR+3
         CVD   R1,CVDAREA
         MVC   ERRMSG+8(4),=X'40202120'
         ED    ERRMSG+8(4),CVDAREA+6
         PUT   SYSPRINT,PROCMSG
         L     R15,ERROR
         B     EXITVSAM
POINTERR EQU   *
         L     R15,RPLADDR
         ST    R15,PTRERR+18   NEW RPL ADDRESS
PTRERR   SHOWCB RPL=RPLCSI,LENGTH=4,AREA=ERROR,FIELDS=(FDBK)
PTRXERR  MVC   TYPERR,=CL26' POINT FAILED, FEEDBACK='
         MVI   MODFLAG,X'80'
         B     WRITERR
GETERR   EQU   *
         L     R15,RPLADDR
         ST    R15,GETERRY+18   NEW RPL ADDRESS
GETERRY  SHOWCB RPL=RPLCSI,LENGTH=4,AREA=ERROR,FIELDS=(FDBK)
GETERRX  MVC   TYPERR,=CL26' GET FAILED,   FEEDBACK='
         MVI   MODFLAG,X'80'
         B     WRITERR
         EJECT
*        EXECUTE INSTRUCTIONS
MOVEKEY  MVC   CSIKEY(*-*),0(R1)         **** EXECUTED ONLY ***
MOVEKEY2 MVC   CSIKEY2(*-*),0(R1)         **** EXECUTED ONLY ***
*        VSAM   EXLST
         DS    0F
*        VSAM ACCESS TO DDN CSITGT (SMPE TARGET/DLIB CSI DSNS)
EXLST    EXLST  EODAD=EODAD
*        VSAM ACCESS TO DDN SMPCSI (SMPE GLOBAL CSI DSNS)
EXLST2   EXLST  EODAD=EODAD2
         DS    0F
*        VSAM CONSTANTS
         DS    0F
*   FOR ALL VSAM DSN/RPL
PASSWORD DC    X'08',CL8' '
*        VSAM   ARGUMENT
WORD0    DC    CL13' '
WORD1    DC    CL11' '
WORD2    DC    CL11' '
WORD3    DC    CL23' '
WORD4    DC    CL23' '
WORD5    DC    CL23' '
*        VSAM CONSTANTS
         DS    0F
*   FOR ALL VSAM DSN/RPL
ERROR    DS    F
CVDAREA  DS    D
* FOR SMPCSI
RECAREA  DS    F
MAXPOS   DS    F
CINV     DS    F
LRECL    DS    F
KEYLEN   DS    F
RKP      DS    F
*
RBA      DS    F
RECLEN   DS    F
* FOR GLOBAL CSI
RECAREAG DS    F
MAXPOSG  DS    F
CINVG    DS    F
LRECLG   DS    F
KEYLENG  DS    F
RKPG     DS    F
*
RBAG     DS    F
RECLENG  DS    F
* FOR GLOBAL CSI SECOND RPL
RECAREA2 DS    F
MAXPOS2  DS    F
CINV2    DS    F
LRECL2   DS    F
KEYLEN2  DS    F
RKP2     DS    F
*
RBA2     DS    F
RECLEN2  DS    F
*        VSAM   EXLST, ACB AND RPL DEFINITIONS
         DS    0F
*        VSAM ACCESS TO DDN CSITGT (SMPE TARGET/DLIB CSI DSNS)
VSAMCSI  ACB   AM=VSAM,DDNAME=CSITGT,PASSWD=PASSWORD,MACRF=(KEY,SEQ,IN)
RPLCSI   RPL   ACB=VSAMCSI,AREA=RECAREA,AREALEN=4,ARG=WORD0,KEYLEN=1,  X
               OPTCD=(LOC,GEN,KGE)
*        VSAM ACCESS TO DDN SMPCSI (SMPE GLOBAL CSI DSNS)
VSAMGLOB ACB   AM=VSAM,DDNAME=SMPCSI,PASSWD=PASSWORD,                XXX
               MACRF=(KEY,SEQ,IN)
RPLGLOB  RPL   ACB=VSAMGLOB,AREA=RECAREAG,AREALEN=4,ARG=WORD0,KEYLEN=1,X
               OPTCD=(LOC,GEN,KGE)
RPLGLOB2 RPL   ACB=VSAMGLOB,AREA=RECAREA2,AREALEN=4,ARG=WORD4,KEYLEN=1,X
               OPTCD=(LOC,GEN,KGE)
         LTORG
         PRINT NOGEN
         DS    0F
         PTFCOMN
         END
./       ADD   NAME=PTFWORK
         MACRO
         PTFWORK
         TITLE    'PTFWORK - FINDFIX ROUTINE'
         DS    0F
WORKAREA DSECT
         DS    20F         SAVE REGISTERS
         DS    20F         SAVE REGISTERS CALLED
PRTLINE  DS    0CL121
         DC    X'09'
POS2     DC    CL1' '
POS3     DC    CL1' '
POS4     DC    CL1' '
POS5     DC    CL1' '
POS6     DC    CL1' '
POS7     DC    CL1' '
POS8     DC    CL1' '
POS9     DC    CL1' '
POS10    DC    CL1' '
POS11    DC    CL1' '
POS12    DC    CL1' '
POS13    DC    CL1' '
POS14    DC    CL1' '
POS15    DC    CL1' '
POS16    DC    CL1' '
POS17    DC    CL1' '
POS18    DC    CL1' '
POS19    DC    CL1' '
POS20    DC    CL1' '
POS21    DC    CL1' '
POS22    DC    CL1' '
POS23    DC    CL1' '
POS24    DC    CL1' '
POS25    DC    CL1' '
POS26    DC    CL1' '
POS27    DC    CL1' '
POS28    DC    CL1' '
POS29    DC    CL1' '
POS30    DC    CL1' '
POS31    DC    CL1' '
POS32    DC    CL1' '
POS33    DC    CL1' '
POS34    DC    CL1' '
POS35    DC    CL1' '
POS36    DC    CL1' '
POS37    DC    CL1' '
POS38    DC    CL1' '
POS39    DC    CL1' '
POS40    DC    CL1' '
POS41    DC    CL1' '
POS42    DC    CL1' '
POS43    DC    CL1' '
POS44    DC    CL1' '
POS45    DC    CL1' '
POS46    DC    CL1' '
POS47    DC    CL1' '
POS48    DC    CL1' '
POS49    DC    CL1' '
POS50    DC    CL1' '
POS51    DC    CL1' '
POS52    DC    CL1' '
POS53    DC    CL1' '
POS54    DC    CL1' '
POS55    DC    CL80' '
RECORD   EQU   *
         DC    C'     '
PTR48    EQU   *
         DC    C'   '
PTR49    EQU   *
         DC    C'  '
PTR50    EQU   *
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'        '
         DC    C'      '
PTR51    EQU   *,4
         DC    C'        '
         DC    X'00'
         DS    0F
*           REPORT LINE
RPTPREF  DC    C'   '
REPORT   DC    C'       '
PRTP08   EQU   *,42
         DC    C' '
PRTP09   EQU   *,2
         DC    C'   '
SMODTYPE EQU   *,3
         DC    C' '
PRTP12   EQU   *,17
         DC    C'     '
PRTP17   EQU   *,17
         DC    C' '
PRTP18   EQU   *,3
         DC    C' '
PRTP19   EQU   *,3
         DC    C' '
PRTP20   EQU   *,3
         DC    C' '
PRTP21   EQU   *,1
         DC    C' '
PRTP22   EQU   *,7
         DC    C'   '
PRTP25   EQU   *,7
         DC    C' '
PRTP26   EQU   *,7
         DC    C' '
PRTP27   EQU   *,14
         DC    C' '
PRTP28   EQU   *,14
         DC    C' '
PRTP29   EQU   *,14
         DC    C' '
PRTP30   EQU   *,11
         DC    C'    '
PRTP34   EQU   *,12
         DC    C' '
PRTP35   EQU   *,12
         DC    C'  '
PRTP37   EQU   *,12
         DC    C' '
PRTP38   EQU   *,12
         DC    C'  '
PRTP40   EQU   *,4
         DC    C' '
PRTP41   EQU   *,4
         DC    C'   '
PRTP44   EQU   *,3
         DC    C' '
PRTP45   EQU   *,3
         DC    C'  '
PRTP47   EQU   *,12
         DC    C'   '
PRTP50   EQU   *,12
         DC    CL85' '
PAGLINE  DC    CL122' '
*        MISC CONSTANTS
         DS    0D
DOUBLE   DC    D'0'
         DS    0F
SAVERHLD DC    6F'0'
TABLEBEG DC    F'0'
TABLENG  DC    F'0'
TABLEND  DC    F'0'
INFOSR12 DC    F'0'
INFOSAVE DC    F'0'
         DC    F'0'
TABINFO  DC    F'0'
SAVEREGS DC    F'0'
         DC    F'0'
         DC    F'0'
         DC    F'0'
SAVER12  DC    F'0'
SAVER12X DC    F'0'
         DC    F'0'
TABEND   DC    F'0'
INFTABE2 DC    F'0'
INFTABE  DC    F'0'
PTR12    DC    F'0'
PTR13    DC    F'0'
LNENUM   DC    F'0'
PAGNUM   DC    F'0'
PTR29A   EQU   *
PTFMASWT DC    X'00'
MODFLAG  DC    X'00'
FIXSWT   DC    X'00'
FLAG1    DC    X'00'
INFOSWT  DC    X'00'
PTR39    DC    X'00'
PTR39A   DC    X'00'
PTR40    DC    X'00'
DEBUG    DC    X'00'
DUMP     DC    X'00'
HOLDSWT  DC    X'00'
DEFIX    DC    X'00'  DEBUG IN PTFFIX
DEVSAM   DC    X'00'
RDMASWT  DC    X'00'        PTFMA EOD SIGNAL INDICATOR
RDMASWX  DC    X'00'        PTFMA EOD SIGNAL INDICATOR
RDMACNT  DC    X'00'        PTFMA BRANCH  INDICATOR  COUNTS
CSIFLAG  DC    X'00'
         DS    0F
NULLADDR DC    F'0'
FMIDADDR DC    F'0'
FMIDPTR  DC    F'0'
FMIDADRX DC    F'0'
SMODMISS DC    F'0'
SMODMISE DC    F'0'
SMODRCVS DC    F'0'
SMODRCVE DC    F'0'
FMIDREQ  DC    F'0'
CDSTABS  DC    F'0'
CDSTABE  DC    F'0'
XCDSTABE DC    F'0'
XCDSTABS DC    F'0'
PTR59    DC    F'0'
CDSISREL DC    F'0'
SYSISREL DC    F'0'
INFOSREL DC    F'0'
CNTLSMOD DC    F'0'
ENDTBADR DC    F'0'
SMODTABS DC    F'0'
SMODTABE DC    F'0'
FDUMMY   DC    F'0'
HOLDTABS DC    F'0'
HOLDTABE DC    F'0'
HOLDTEND DC    F'0'
RPLADDR  DC    F'0'
CDSNAME  DC    F'0'
IOBUFFER DC    F'0'
CSMPER12 DC    F'0'
SAVER11  DC    F'0'
SAVESUPE DC    F'0'  SAVE R3 FOR SUPERSEDED DOR002
SAVERC15 DC    F'0'
HOLDADDR DC    F'0'
SAVER6   DC    F'0'
SAVER8   DC    F'0'
SAVER9   DC    F'0'
SAVER15  DC    F'0'
SYSMFMID DC    F'0'   CURRENT SYSMOD INFOTAB ENTRY
SYSNFMID DC    F'0'      NEXT SYSMOD INFOTAB ENTRY
INFOFFST DC    F'0'
SAVEKEY  DC    CL23' '
SAVEKEYG DC    CL23' '
CSIKEY   DC    CL140' '
         DC    CL1' '
CSIKEY2  DC    CL140' '
         DC    CL1' '
*        PTFFIX CONSTANTS
REPFLAG  DC    X'00'
HOLDSWTX DC    X'00' HOLD USE RPLGLOB2 MUST POINT SAVEKEYG TO RPLGLOB
HEXSWT   DC    X'00'
HEXLINE  DC    CL100' '
*        VSAM MESSAGE
PROCMSG  DS    0CL133
TYPERR   DC    CL26' OPEN ERROR RETURN CODE ='
ERRMSG   DS    CL4' '
         DC    CL103' '
WORKEND  DC    C' '
WORKLTH  EQU   WORKEND-WORKAREA
          MEND
./       ADD   NAME=SASINFO
//DORSINFO JOB (6000A,4,,9999),'SAS INFO PRT',
//         CLASS=A,MSGCLASS=Z,NOTIFY=DOR
/*ROUTE PRINT RMT55
/*ROUTE PUNCH RMT55
//*
//*  SAS PROGRAM TO READ INFOIN RECORDS
//*      AND PRINT IN TABLE FORMAT.
//*-------------------------------------------------------------
//* AUTHOR: DAVE RIKER, COMPUTER DATA SYSTEMS, INC
//*                     ONE CURIE COURT, ROCKVILLE, MD 20850
//*-------------------------------------------------------------
//S1  EXEC SAS,REGION=1500K
//INFOIN   DD  DSN=SYS3.SMPE.MVS.INFOIN,DISP=SHR,
//         VOL=SER=MVSLC1,UNIT=3350
//FT12F001 DD SYSOUT=*
//INFOPRT  DD SYSOUT=(Y,,DS06)
//SYSIN DD *
* SAS PROGRAM TO READ INFOIN RECORDS AND                 ;
*                GENERATE  REPORTS                       ;
DATA _NULL_;
INFILE INFOIN  MISSOVER  JFCB=DSNJFCB;
OPTIONS LS=120  PS=60  TIME=90  NUMBER ;
LENGTH VER $4 DATA $8 TYPE1 $7 TYPE $8 TYPE2 $7;
RETAIN  PTR 10 CURCODE 0;
FILE INFOPRT HEADER=DSNHDR ;
TITLE LISTING OF INFOIN FILE GENERATED BY FINDFIX;
 INPUT @1 CODE  PIB1. @2 TYPE $CHAR7. @ ;
  IF CODE = 1 THEN DO; PUT  TYPE @; PTR=-6; END;
  IF CODE = 2 THEN DO;
     PUT;PTR=10;
     INPUT @2 VER $CHAR4. @;
     PUT @PTR ' VER-' VER @; END;
  IF CODE = 3 THEN PUT @PTR ' FMID-' TYPE @;
  IF CODE = 4 THEN PUT @PTR ' NPRE-' TYPE @;
  IF CODE = 5 THEN PUT @PTR ' PRE-' TYPE @;
  IF CODE = 6 THEN PUT @PTR ' REQ-' TYPE @;
  IF CODE = 8 THEN PUT @PTR ' SUP-' TYPE @;
  IF CODE = 16 THEN DO;
     IF PTR > 16 THEN PUT; CURCODE=0;
     PTR=10; PUT @PTR ' IFFMID-' TYPE @; END;
  IF CODE = 17 THEN DO; PUT @PTR ' IFREQ-' TYPE @; CURCODE=CODE; END;
  IF (CODE ^= 17 AND CURCODE = 17) THEN DO;
     CURCODE=0; PUT; PTR=10; END;
  IF CODE = 15 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' MOD-' DATA @; END;
  IF CODE = 14 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
      PUT @PTR ' MAC-' DATA @; END;
  IF CODE = 13 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' ZAP-' DATA @; END;
  IF CODE = 12 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' MACUPD-' DATA @; END;
  IF CODE = 11 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' SRCUPD-' DATA @; END;
  IF CODE = 10 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' SRC-' DATA @; END;
  IF CODE = 31 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' HOLD-' DATA @; END;
  IF CODE = 30 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' RLSE-' DATA @; END;
  IF CODE = 29 THEN DO;
     INPUT @2 TYPE1 $CHAR7.;INPUT TYPE2 $CHAR7. @; DATA=TYPE1 ×× TYPE2;
     PUT @PTR ' JCLIN-' DATA @; END;
  IF CODE > 35 AND CODE < 255 THEN DO;
  INPUT @1 DATE $CHAR8. @1 YY $CHAR2. @4 MM $CHAR2. @;
  PUTLVL=YY ×× MM; PUT @PTR ' PUTLEVEL-' PUTLVL @;
  PTR+16; PUT @PTR ' PTFDATE-' DATE @; END;
  IF CODE = 255 THEN DO;  PUT; PTR=10; END;
                ELSE PTR+16;
  IF PTR > 106 THEN DO; PUT;
     IF (CODE > 9 AND CODE < 16) THEN PTR=10;
     IF (CODE > 28 AND CODE < 32) THEN PTR=10;
     IF (CODE > 0  AND CODE < 10) THEN PTR=26;
     IF (CODE > 15 AND CODE < 18) THEN PTR=26;
     END;
  DELETE;
DSNHDR: PUT  @40 DSNJFCB $CHAR44.; RETURN;

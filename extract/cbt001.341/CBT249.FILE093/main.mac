C          APEMAN DATA ANLYSIS AT LEVEL 003 AS OF 04/02/82
C   ***********************************
C
C   MAIN ANALYSIS ROUTINE
C
C   ***********************************
      COMMON/OPTION/ISTRM,GRAPH,LIST,ALL,DUMP,TRACE
      REAL*8 KEY1/'GRAPH   '/,KEY2/'LIST    '/
      REAL*8 KEY3/'ALL     '/,KEY4/'DUMP    '/
      REAL*8 KEY5/'TRACE   '/,KEY6/'NONE    '/
      REAL*8 DATE
      REAL*8 NULL/'        '/
      REAL*8 SELECT/'SELECT= '/
      INTEGER NAME/'MAIN'/,MINT(26)
      INTEGER*4 NAME2/'DATE'/
      LOGICAL SINGLE,NONE,ANY,FIRST
      LOGICAL GRAPH,LIST,ALL,DUMP,TRACE
      LOGICAL FIRST
      LOGICAL*1 TIT1(40)
      DATA IEND/'END '/
      REAL*8 WORK(10000)
      INTEGER SIZE /20000/
      INTEGER*4 NAMES(26)
      EQUIVALENCE  (NAMES(1),MONA),(NAMES(2),MONB),(NAMES(3),MONC),
     * (NAMES(4),MOND),(NAMES(5),MONE),(NAMES(6),MONF),
     * (NAMES(7),MONG),(NAMES(8),MONH),(NAMES(9),MONI),
     * (NAMES(10),MONJ),(NAMES(11),MONK),(NAMES(12),MONL),
     * (NAMES(13),MONM),(NAMES(14),MONN),(NAMES(15),MONO),
     * (NAMES(16),MONP),(NAMES(17),MONQ),(NAMES(18),MONR),
     * (NAMES(19),MONS),(NAMES(20),MONT),(NAMES(21),MONU),
     * (NAMES(22),MONV),(NAMES(23),MONW),(NAMES(24),MONX),
     * (NAMES(25),MONY),(NAMES(26),MONZ)
      DATA MONA/'MONA'/,MONB/'MONB'/,MONC/'MONC'/,MOND/'MOND'/,
     *MONE/'MONE'/,MONF/'MONF'/,MONG/'MONG'/,MONH/'MONH'/,MONI/'MONI'/
      DATA MONJ/'MONJ'/,MONK/'MONK'/,MONL/'MONL'/,MONM/'MONM'/,
     *MONN/'MONN'/,MONO/'MONO'/,MONP/'MONP'/,MONQ/'MONQ'/,MONR/'MONR'/
      DATA MONS/'MONS'/,MONT/'MONT'/,MONU/'MONU'/,MONV/'MONV'/,
     *MONW/'MONW'/,MONX/'MONX'/,MONY/'MONY'/,MONZ/'MONZ'/
      DATA LENGTH/26/
C
C   SET UP OPTIONS REQUIRED FOR THIS RUN
C
      FIRST=.TRUE.
      ISTRM=1
      CALL GETPRM (LNPARM, WORK)
      CALL FNDPRS(LNPARM,WORK,5,KEY1,GRAPH)
      CALL FNDPRS(LNPARM,WORK,4,KEY2,LIST)
      CALL FNDPRS(LNPARM,WORK,3,KEY3,ALL)
      CALL FNDPRS(LNPARM,WORK,4,KEY4,DUMP)
      CALL FNDPRS(LNPARM,WORK,5,KEY5,TRACE)
      CALL FNDPRS(LNPARM,WORK,4,KEY6,NONE)
      CALL FNDVAL(LNPARM,WORK,7,SELECT,M,IVAL)
      SINGLE=(IVAL.GT.0.AND.IVAL.LE.26.AND.M.NE.0)
      WRITE(6,6000)
 6000 FORMAT('1APEMAN - AERE PERFORMANCE EVALUATION MONITOR',
     *' AND ANALYZER')
      WRITE(8,6000)
      WRITE(6,6030) GRAPH,LIST,ALL,DUMP,TRACE,NONE
 6030 FORMAT(' OPTIONS ARE :',/' GRAPH=',L1,',LIST=',L1,',ALL=',
     *L1,',DUMP=',L1,',TRACE=',L1,',NONE=',L1)
      WRITE(8,6030) GRAPH,LIST,ALL,DUMP,TRACE,NONE
C
C   READ DATE OF RUN FROM LOG
C
      DATE=NULL
      IFLAG=-1
      CALL MONRD(NAME2,2,DATE,IFLAG)
      IF(IFLAG.GT.0) GOTO 99
      IFLAG=0
      CALL MONRD(NAME2,2,DATE,IFLAG)
      IF(IFLAG.GT.0) GOTO 100
      WRITE(6,6040) DATE
 6040 FORMAT(' MONITOR RUN ON ',A8)
      WRITE(8,6040) DATE
  100 CONTINUE
      IF(DUMP) CALL HEXDMP
      ANY = ALL
      IF(ALL) GOTO 20
C
C   FIND ACTIVE MONITORS
C
      DO 200 I=1,26
      MINT(I)=0
  200 CONTINUE
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,MINT,IFLAG)
      IF(IFLAG.GT.0) GOTO 99
      IFLAG=0
      CALL MONRD(NAME,LENGTH,MINT,IFLAG)
      IF(.NOT.NONE) GOTO 201
      DO 202 I=1,26
      MINT(I)=0
  202 CONTINUE
  201 CONTINUE
      IF(SINGLE) MINT(IVAL)=1
      DO 5 I=1,26
      IF(MINT(I).GT.0) ANY=.TRUE.
    5 CONTINUE
      IF(ANY) GOTO 30
   99 CONTINUE
      WRITE(6,6020)
 6020 FORMAT('0NO MONITORS ACTIVE OR NONE SELECTED')
      WRITE(8,6020)
      GOTO 50
   20 CONTINUE
C
C   ALL SELECTED - EVERY ANALYSIS ROUTINE TO BE CALLED
C
      DO 6 I=1,26
      MINT(I) = 1
    6 CONTINUE
C
   30 CONTINUE
C
C   CALL ANALYSIS ROUTINES CORRESPONDING TO ACTIVE MONITORS ONLY
C
      IF(MINT(1).GT.0) CALL ANLA(MONA,DATE,WORK,SIZE)
      IF(MINT(2).GT.0) CALL ANLB(MONB,DATE,WORK,SIZE)
      IF(MINT(3).GT.0) CALL ANLC(MONC,DATE,WORK,SIZE)
      IF(MINT(4).GT.0) CALL ANLD(MOND,DATE,WORK,SIZE)
      IF(MINT(5).GT.0) CALL ANLE(MONE,DATE,WORK,SIZE)
      IF(MINT(6).GT.0) CALL ANLF(MONF,DATE,WORK,SIZE)
      IF(MINT(7).GT.0) CALL ANLG(MONG,DATE,WORK,SIZE)
      IF(MINT(8).GT.0) CALL ANLH(MONH,DATE,WORK,SIZE)
      IF(MINT(9).GT.0) CALL ANLI(MONI,DATE,WORK,SIZE)
      IF(MINT(10).GT.0) CALL ANLJ(MONJ,DATE,WORK,SIZE)
      IF(MINT(11).GT.0) CALL ANLK(MONK,DATE,WORK,SIZE)
      IF(MINT(12).GT.0) CALL ANLL(MONL,DATE,WORK,SIZE)
      IF(MINT(13).GT.0) CALL ANLM(MONM,DATE,WORK,SIZE)
      IF(MINT(14).GT.0) CALL ANLN(MONN,DATE,WORK,SIZE)
      IF(MINT(15).GT.0) CALL ANLO(MONO,DATE,WORK,SIZE)
      IF(MINT(16).LE.0) GO TO 47
C        PEEL OFF 2500 DOUBLE WORDS FOR LPA MODULE NAME ARRAY
      LSIZE = SIZE - 5000
      CALL ANLP(MONP,DATE,WORK(2501),LSIZE,WORK)
C
   47 IF(MINT(17).GT.0) CALL ANLQ(MONQ,DATE,WORK,SIZE)
      IF(MINT(18).GT.0) CALL ANLR(MONR,DATE,WORK,SIZE)
      IF(MINT(19).GT.0) CALL ANLS(MONS,DATE,WORK,SIZE)
      IF(MINT(20).GT.0) CALL ANLT(MONT,DATE,WORK,SIZE)
      IF(MINT(21).GT.0) CALL ANLU(MONU,DATE,WORK,SIZE)
      IF(MINT(22).GT.0) CALL ANLV(MONV,DATE,WORK,SIZE)
      IF(MINT(23).GT.0) CALL ANLW(MONW,DATE,WORK,SIZE)
      IF(MINT(24).GT.0) CALL ANLX(MONX,DATE,WORK,SIZE)
      IF(MINT(25).GT.0) CALL ANLY(MONY,DATE,WORK,SIZE)
      IF(MINT(26).GT.0) CALL ANLZ(MONZ,DATE,WORK,SIZE)
   50 CONTINUE
      WRITE(6,6010)
 6010 FORMAT('0END OF ANALYSIS')
      WRITE(8,6010)
      STOP
      END

      SUBROUTINE ANLQ(NAME,DATE)
C   ***********************************
C
C   ROUTINE FORMATS QCB TRACE
C
C   ************************************
      REAL*8 MAJOR,BLNK/'        '/,MAJ,MINOR(6),MIN(6),
     *DATE
      REAL*8 SCOPE,SYSTEM/'SYSTEM  '/,SYSTES/'SYSTEMS '/,
     *STEP/'STEP    '/,NOENQS/'NO ENQS '/
      INTEGER TYPE,TTIME,TIME,IDATA(24),LENGTH/24/
      INTEGER*2 LT2(2),ASID
      INTEGER LT4
      LOGICAL*4 LT,MSK/Z00F00000/
      LOGICAL*1 LT1(4)
      LOGICAL*1 FIRST/.TRUE./,LTTIME(4)
      LOGICAL*1 NEWL
C
      EQUIVALENCE(TTIME,LTTIME(1)),(TIME,IDATA(1)),
     *(MAJOR,IDATA(3)),(TYPE,IDATA(2)),(MINOR(1),IDATA(5))
      EQUIVALENCE(LT4,LT1(1)),(LT4,LT),(LT4,LT2(1))
C
C   REWIND LOG
C
      IFLAG=-1
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 999
      WRITE(6,6100) DATE
 6100 FORMAT('1QCB ANALYSIS ON ',A8)
C
  100 CONTINUE
      IFLAG=0
      CALL MONRD(NAME,LENGTH,IDATA,IFLAG)
      IF(IFLAG.GT.0) GOTO 200
      IF(FIRST) GOTO 10
      IF(TTIME.EQ.TIME) GOTO 5
   10 CONTINUE
C   NEW TIME - WRITE HEADER
      TTIME=TIME
      WRITE(6,6010) LTTIME,DATE
 6010 FORMAT('0ENQS AT ',3(Z2,'.'),Z2,' ON ',A8)
      WRITE(6,6030)
      FIRST=.FALSE.
      NEWL=.TRUE.
      GOTO 16
    5 CONTINUE
C
C   CHECK FOR NEW MAJORNAME
C
      NEWL=.TRUE.
      IF(MAJOR.EQ.MAJ) GOTO 15
   16 CONTINUE
C
C   NEW MAJORNAME
C
      MAJ=MAJOR
      WRITE(6,6020) MAJ
 6020 FORMAT(1X,A8)
      NEWL=.FALSE.
      IF(TYPE.EQ.1) GOTO 100
      GOTO 21
   15 CONTINUE
C
C   CHECK FOR NEW MINORNAME
C
      DO 20 I=1,6
      IF(MINOR(I).NE.MIN(I)) GOTO 21
   20 CONTINUE
      IF(TYPE.EQ.2) GOTO 100
      GOTO 30
   21 CONTINUE
C
C   NEW MINORNAME
C
      IF(NEWL) WRITE(6,6030)
      NEWL=.FALSE.
      SCOPE=BLNK
      LT4=IDATA(17)
      ASID=LT2(2)
      LT=LT.AND.MSK
      LT2(1)=LT2(1)/16
      IF(LT2(1).EQ.8) SCOPE=SYSTEM
      IF(LT2(1).EQ.4) SCOPE=SYSTES
      IF(LT2(1).EQ.2) SCOPE=STEP
      IF(LT2(1).EQ.1) SCOPE=NOENQS
      DO 22 I=1,6
      MIN(I)=MINOR(I)
   22 CONTINUE
      WRITE(6,6040) MIN,SCOPE
 6040 FORMAT('+',10X,6A8,1X,A8)
      IF(SCOPE.EQ.STEP) WRITE(6,6041) ASID,IDATA(23),IDATA(24)
 6041 FORMAT('+',67X,I3,3X,2A4)
      IF(TYPE.EQ.2) GOTO 100
   30 CONTINUE
C
C   NEW QEL
C
      IF(NEWL) WRITE(6,6030)
 6030 FORMAT(1X)
      WRITE(6,6050) IDATA(18)
 6050 FORMAT('+',71X,Z8)
      LT4=IDATA(19)
      ASID=LT2(2)
      LT2(2)=LT2(1)
      DO 40 I=1,4
      LT2(1)=0
      LT4=LT4*2
      IF(I.EQ.1.AND.LT2(1).EQ.0) WRITE(6,6052)
 6052 FORMAT('+',80X,'EXCL')
      IF(LT2(1).EQ.0) GOTO 40
      IF(I.EQ.1) WRITE(6,6051)
 6051 FORMAT('+',80X,'SHR')
      IF(I.EQ.2) WRITE(6,6053)
 6053 FORMAT('+',85X,'MC')
      IF(I.EQ.4) WRITE(6,6054)
 6054 FORMAT('+',88X,'RES')
   40 CONTINUE
      LT4=LT4*16
      LT2(1)=0
      LT4=LT4*4
      IF(LT2(1).EQ.3) WRITE(6,6055)
 6055 FORMAT('+',92X,'ECB')
      IF(LT2(1).EQ.2) WRITE(6,6056)
 6056 FORMAT('+',92X,'RB')
      WRITE(6,6057) ASID,IDATA(23),IDATA(24)
 6057 FORMAT('+',96X,I3,3X,2A4)
      GOTO 100
  200 CONTINUE
C
C   EOF FOUND
C
      IF(FIRST) GOTO 999
      WRITE(6,6999)
 6999 FORMAT('0END OF ENQ TRACE')
  999 CONTINUE
      RETURN
      END

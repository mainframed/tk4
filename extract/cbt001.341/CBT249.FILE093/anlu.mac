      SUBROUTINE ANLU (NAME, DATE, WORK, SIZE)
C   ***********************************
C
C   ROUTINE PRINTS OUT UCB RECORDS
C
C   ***********************************
      REAL*8 DATE
      INTEGER*4 IDATA(17), LENGTH/17/, TIME, TTIME, VOLSER(2), VOLS(2),
     * LT4, SIZE
      DIMENSION RCNTS(11)
      INTEGER*2 LT2(4), WORK(SIZE), BLNK2/'  '/
      LOGICAL*1 LTTIME(4), FIRST/.TRUE./, UL(4), BLNK1/' '/
      LOGICAL*1 NEWL
C
      EQUIVALENCE (IDATA(1),TIME), (TTIME,LTTIME(1)),
     * (VOLS(1),IDATA(13)), (LT4,LT2(1),UL(1),VOLSER(1))
C
      COMMON /OPTION/ ISTRM, GRAPH, LIST
      LOGICAL*4 GRAPH, LIST
C
C   REWIND LOG
C
      ICT = 0
      NMAX = 0
      ISIZE = SIZE * 2
      IMAX = ISIZE / 16
      DO 4 I = 1, ISIZE
    4 WORK(I) = 0
      NCALLS = 0
      IFLAG = -1
      CALL MONRD (NAME, LENGTH, IDATA, IFLAG)
      IF (IFLAG .GT. 0) GOTO 999
   20 CONTINUE
      IFLAG = 0
      CALL MONRD (NAME, LENGTH, IDATA, IFLAG)
      IF (IFLAG .GT. 0) GOTO 200
      IF (FIRST) GOTO 25
      IF (TTIME .EQ. TIME) GOTO 30
   25 CONTINUE
C
C   NEW TIME - WRITE HEADER
C
      NCALLS = NCALLS + 1
      FIRST = .FALSE.
      TTIME = TIME
      INDEX = 0
      IF (.NOT. LIST) GOTO 30
      WRITE (6,6000) LTTIME, DATE
 6000 FORMAT ('1UCBS AT ',3(Z2,'.'),Z2,' ON ',A8)
   30 CONTINUE
      ICT = INDEX + 1
      J = 16 * INDEX + 1
C   PICK UP UNIT NAME
      LT4 = IDATA(5)
      UL(1) = BLNK1
      IF (NCALLS .GT. 1) GOTO 44
      IF (ICT .GT. IMAX) GOTO 48
      WORK(J) = LT2(1)
      WORK(J+1) = LT2(2)
      WORK(J+2) = BLNK2
      WORK(J+3) = BLNK2
      WORK(J+4) = BLNK2
      NMAX = ICT
      GOTO 48
   44 IF (LT2(2) .NE. WORK(J+1)) GOTO 46
      IF (LT2(1) .EQ. WORK(J)) GOTO 48
   46 ICT = ICT + 1
      J = J + 16
      IF (ICT .LE. NMAX) GOTO 44
   48 CONTINUE
      IF (.NOT. LIST) GOTO 50
      WRITE (6,6010) LT4
 6010 FORMAT ('0UNIT NAME',A4)
   50 CONTINUE
C   PICK UP CLASS OF DEVICE
      ITYPE = 0
      LT4 = IDATA(6)
      L1 = 11
      DO 60 I=1,8
      LT2(1) = 0
      LT4 = LT4 * 2
      IF (LT2(1) .EQ. 0) GOTO 60
      IF (I .EQ. 8 .AND. ITYPE .EQ. 1) ITYPE = 9
      IF (ITYPE .NE. 9) ITYPE = I
   60 CONTINUE
C
C   WRITE CLASS OF DEVICE
C
      IF (.NOT. LIST) GOTO 80
      IF (ITYPE .EQ. 1) WRITE (6,6001)
      IF (ITYPE .EQ. 2) WRITE (6,6002)
      IF (ITYPE .EQ. 3) WRITE (6,6003)
      IF (ITYPE .EQ. 4) WRITE (6,6004)
      IF (ITYPE .EQ. 5) WRITE (6,6005)
      IF (ITYPE .EQ. 6) WRITE (6,6006)
      IF (ITYPE .EQ. 9) WRITE (6,6009)
 6001 FORMAT ('+',15X,'TAPE')
 6002 FORMAT ('+',15X,'COMMUNICATIONS')
 6003 FORMAT ('+',15X,'DIRECT ACCESS')
 6004 FORMAT ('+',15X,'DISPLAY')
 6005 FORMAT ('+',15X,'UNIT RECORD')
 6006 FORMAT ('+',15X,'CHARACTER READER')
 6009 FORMAT ('+',15X,'CHANNEL ADAPTOR')
   80 CONTINUE
      IF (ITYPE .NE. 1 .AND. ITYPE .NE. 3) GOTO 90
C
C   IF TAPE OR D.A. PICK UP VOLSER
C
      L1 = 17
      DO 85 I=1,2
      VOLSER(I) = VOLS(I)
   85 CONTINUE
      IF (ICT .GT. IMAX) GOTO 90
      WORK(J+2) = LT2(1)
      WORK(J+3) = LT2(2)
      WORK(J+4) = LT2(3)
   90 CONTINUE
      IALL = 0
      LT4 = IDATA(2)
      LT2(1) = LT2(2)
C
C   FIND STATUS OF UCB
C
      DO 100 I=1,8
      LT2(2) = 0
      LT4 = LT4 / 2
      IF (LT2(2) .EQ. 0) GOTO 100
      IF (I .EQ. 3 .AND. LIST) WRITE (6,6050)
 6050 FORMAT('+',35X,'PERM RES')
      IF (I .EQ. 4) IALL = 1
      IF (I .EQ. 4 .AND. LIST) WRITE (6,6051)
 6051 FORMAT ('+',46X,'ALLOCATED')
      IF (I .EQ. 6 .AND. LIST) WRITE (6,6052)
 6052 FORMAT ('+',58X,'RESERVED')
      IF (I .EQ. 8 .AND. LIST) WRITE (6,6053)
 6053 FORMAT ('+',69X,'ONLINE')
      IF (I .EQ. 8 .AND. ICT .LE. NMAX) WORK(J+13) = WORK(J+13) + 1
  100 CONTINUE
C
C   WRITE ASID
C
      LT4 = IDATA(11)
      IF (IALL .EQ. 1 .AND. LIST) WRITE (6,6054) LT2(2)
 6054 FORMAT ('+',78X,'ASID=',I3)
      IF (L1 .EQ. 17 .AND. LIST) WRITE (6,6055) VOLSER
 6055 FORMAT ('+',89X,2A4)
      IF (ITYPE .NE. 1) GOTO 120
C
C   CHECK IF TAPE IS REWINDING
C
      LT4 = IDATA(5)
      LT2(2) = LT2(1)
      LT4 = LT4 * 8
      LT2(1) = 0
      LT4 = LT4 * 2
      IF (LT2(1) .NE. 0 .AND. LIST) WRITE (6,6056)
 6056 FORMAT ('+',100X,'REWIND')
      IF (LT2(1).NE.0 .AND. ICT.LE.IMAX) WORK(J+14) = WORK(J+14) + 1
  120 CONTINUE
      NEWL = .FALSE.
C
C   PICK UP SUPERVISOR FLAG A
C
      LT4 = IDATA(3)
      DO 160 I=1,8
      LT2(1) = 0
      LT4 = LT4 * 2
      IF (LT2(1) .EQ. 0) GOTO 160
C   NEWLINE?
      IF (NEWL .OR. .NOT. LIST) GOTO 140
      WRITE (6,6060)
 6060 FORMAT (1X)
      NEWL = .TRUE.
  140 CONTINUE
      IF (ICT .LE. NMAX) WORK(J+4+I) = WORK(J+4+I) + 1
      IF (.NOT. LIST) GOTO 160
      IF (I .EQ. 1) WRITE (6,6061)
 6061 FORMAT ('+BUSY')
      IF (I .EQ. 2) WRITE(6,6062)
 6062 FORMAT ('+',6X,'NOT READY')
      IF (I .EQ. 3) WRITE(6,6063)
 6063 FORMAT ('+',17X,'POST')
      IF (I .EQ. 4) WRITE(6,6064)
 6064 FORMAT ('+',23X,'SENSE PENDING')
      IF (I .EQ. 5) WRITE(6,6065)
 6065 FORMAT ('+',38X,'C.U. BUSY')
      IF (I .EQ. 6) WRITE(6,6066)
 6066 FORMAT ('+',50X,'SAP ACTIVE')
      IF (I .EQ. 7) WRITE(6,6067)
 6067 FORMAT ('+',63X,'CP ACTIVE')
      IF (I .EQ. 8) WRITE(6,6068)
 6068 FORMAT ('+',75X,'QUIESCED')
  160 CONTINUE
      INDEX = ICT
C
C   FIND COUNT OF QUEUED REQUESTS
C
      LT4 = IDATA(4)
      LT2(2) = 0
      LT4 = LT4 / 256
      LT2(1) = 0
      LT4 = LT4 / 256
      IF (LIST) WRITE (6,6069) LT4
 6069 FORMAT ('+',110X,'# QED REQUESTS=',I4)
      IF (ICT .LE. IMAX) WORK(J+15) = WORK(J+15) + LT4
C
C   WRITE UCB IN HEX
C
      IF (.NOT. LIST) GOTO 20
      WRITE (6,6070) (IDATA(I),I=2,7)
 6070 FORMAT (' UCB ',6(Z8,1X))
      IF (L1 .EQ. 17) WRITE (6,6071) (IDATA(I),I=12,17)
 6071 FORMAT (' DDS ',6(Z8,1X))
      WRITE (6,6072) (IDATA(I),I=8,11)
 6072 FORMAT (' EXT ',4(Z8,1X))
      GOTO 20
  200 CONTINUE
      IF (FIRST) GOTO 999
      WRITE (6,6100) DATE
 6100 FORMAT ('1UCB AVERAGES ON ',A8,/,1X)
      WRITE (8,6080) DATE
 6080 FORMAT ('0UCB AVERAGES ON ',A8,/,1X)
      WRITE (6,6102) NCALLS
 6102 FORMAT (' NO OF CALLS = ',I4,/,1X)
      WRITE (8,6102) NCALLS
      WRITE (6,6101)
 6101 FORMAT (' UNIT  VOLSER  BUSY  NOT READY  POST  SENSE  CU BUSY',
     * '  SAP ACT  CP ACT  QUIESCED  ONLINE  REWIND  QED REQT',/,1X)
      WRITE (8,6101)
      CALLS = NCALLS
      DO 300 ICT=1,NMAX
      J = ICT * 16 - 15
      DO 280 I=1,11
      RCNTS(I) = 100.0 * WORK(J+4+I) / CALLS
  280 CONTINUE
      WRITE (6,6103) (WORK(J+I-1),I=1,5),(RCNTS(J),J=1,11)
 6103 FORMAT (1X,2A2,2X,3A2,2X,F6.2,2X,F6.2,2X,F6.2,2X,F6.2,2X,F6.2,
     * 2X,F6.2,2X,F6.2,3X,F6.2,3X,F6.2,2X,F6.2,3X,F6.2)
      WRITE (8,6103) (WORK(J+I-1),I=1,5),(RCNTS(J),J=1,11)
  300 CONTINUE
      WRITE (8,6130)
      WRITE (6,6130)
 6130 FORMAT ('0END OF UCB TRACE')
  999 CONTINUE
      RETURN
      END

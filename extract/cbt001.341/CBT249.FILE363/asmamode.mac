         TITLE 'ASMAMODE - SETAMODE LISTING'
         COPY  SETAMODE
         TITLE 'ASMAMODE - TSTAMODE LISTING'
         COPY  TSTAMODE
         TITLE 'ASMAMODE - MODULE EQUATES'
ASMAMODE START 000000
*
*
*        DEFINE THE EQUATES FOR GENERAL REGISTER USAGE
R0       EQU   0
R1       EQU   1
RWORK1   EQU   1
R2       EQU   2
RWORK2   EQU   2
RWORK3   EQU   3
RWORK4   EQU   4
RWORK5   EQU   5
RWORK6   EQU   6
RWORK7   EQU   7
RWORK8   EQU   8
RAREA    EQU   9
RMSGBASE EQU   10                  BASE REGISTER FOR AREA FROM WTO
RBASE2   EQU   11                  SECOND MODULE BASE REGISTER
R12      EQU   12
RBASE1   EQU   12                  PRIMARY MODULE BASE REGISTER
R13      EQU   13
RSAVE    EQU   13                  SAVE AREA BASE REGISTER
R14      EQU   14
RLINK    EQU   14                  MODULE LINKAGE REGISTER
R15      EQU   15
RENTRY   EQU   15                  ENTRY ADDRESS REGISTER
*
*
*        EBCDIC CHARACTER EQUATES
ENULL    EQU   X'00'
EBLANK   EQU   X'40'
ECOMMA   EQU   C','
ESEMIC   EQU   C';'
ECOLON   EQU   C':'
EGT      EQU   C'>'
         TITLE 'ASMAMODE - WORKING STORAGE DSECTS'
         SPACE 3
*
*
*        DEFINE AND MAP THE LOCAL WORK AREA
*        OBTAINED, USED, AND RELEASED BY THIS MODULE.
*
WRKAREA  DSECT  ,
WRKSAVE  DS    18A(0)              REGISTER SAVE AREA
WRKPACK  DS    D                   CVB/CVD WORK AREA
WRKEND   DS    0D                  END OF WORK AREA
WRKSIZE  EQU   WRKEND-WRKAREA      WORK AREA SIZE
WRKSUBP  EQU   000                 SUBPOOL FROM WHICH TO GET WORK AREA
         TITLE 'ASMAMODE - MODULE INITIALIZATION'
ASMAMODE CSECT                     RESUME CSECT DEFINITION
         USING *,R15               TEMPORARY BASE
         B     BYID                BRANCH AROUND MODULE IDENTIFIER
         DC    AL1(NDID-*)         IDENTIFIER LENGTH
         DC    CL8'ASMAMODE'       MODULE NAME EYECATCHER
         DC    CL8'&SYSDATE'       MODULE ASSEMBLY DATE
         DC    CL5'&SYSTIME'       MODULE ASSEMBLY TIME
NDID     EQU   *                   MARK IDENTIFIER END
BYID     DS    0H                  BRANCH POINT AROUND IDENTIFIER
         STM   R14,R12,12(R13)     SAVE GENERAL REGISTERS
         LA    RBASE1,0(,R15)      LOAD BASE REGISTER
         LA    RBASE2,2048(RBASE1)      ESTABLISH
         LA    RBASE2,2048(RBASE2)      SECOND BASE REGISTER
         USING ASMAMODE,RBASE1,RBASE2   ESTABLISH ADDRESSABILITY
         DROP  R15                 DROP TEMPORARY BASE
*
*
*        GET STORAGE FOR THE WORK  AREA
         L     R0,WORKSIZE         LOAD SP&SIZE FOR GETMAIN
         GETMAIN R,LV=(0)          GET THE WORK AREA STORAGE
         LA    RAREA,0(,R1)        ADDRESS OF WORK AREA TO REGISTER
         USING WRKAREA,RAREA       WORK AREA ADDRESSABILITY
         ST    R13,WRKSAVE+4       CALLER'S SAVE AREA ADDRESS
         LA    R1,WRKSAVE          POINT TO OUR SAVE AREA
         ST    R1,8(,R13)          POINT CALLER'S AREA TO OURS
         LR    R13,R1              POINT R13 TO OUR AREA
         TITLE 'ASMAMODE - ASSEMBLE SETAMODE'
S0       SETAMODE RWORK1,ASMHV2=NO,AMODE=24,AMASK=(,AMSK8000)
S0Z      EQU   *-S0
         EJECT  ,
S1       SETAMODE RWORK1,AMODE=24,AMASK=((RWORK7))
S1Z      EQU   *-S1
         EJECT  ,
S2       SETAMODE RWORK1,AMODE=31
S2Z      EQU   *-S2
         EJECT  ,
S3       SETAMODE RWORK1,AMODE=RESET
S3Z      EQU   *-S3
         EJECT  ,
S4       SETAMODE RWORK1,CVTMAP=NO,AMODE=24
S4Z      EQU   *-S4
         EJECT  ,
S5       SETAMODE RWORK1,CVTMAP=NO,AMODE=31
S5Z      EQU   *-S5
         EJECT  ,
S6       SETAMODE RWORK1,CVTMAP=NO,AMODE=RESET
S6Z      EQU   *-S6
         EJECT  ,
S7       SETAMODE RWORK1,RWORK2,CVTMAP=YES,AMODE=24
S7Z      EQU   *-S7
         EJECT  ,
S8       SETAMODE RWORK1,RWORK2,CVTMAP=YES,AMODE=31
S8Z      EQU   *-S8
         EJECT  ,
S9       SETAMODE RWORK1,RWORK2,CVTMAP=YES,AMODE=RESET,                X
               AMASK=((RWORK7))
S9Z      EQU   *-S9
         EJECT  ,
S10      SETAMODE RWORK1,RWORK2,CVTMAP=NO,AMODE=24
S10Z     EQU   *-S10
         EJECT  ,
S11      SETAMODE RWORK1,RWORK2,CVTMAP=NO,AMODE=31
S11Z     EQU   *-S11
         EJECT  ,
S12      SETAMODE RWORK1,RWORK2,CVTMAP=NO,AMODE=RESET
S12Z     EQU   *-S12
         EJECT  ,
S13      SETAMODE RWORK1,S370=NO,AMODE=24
S13Z     EQU   *-S13
         EJECT  ,
S13A     SETAMODE RWORK1,S370=NO,AMODE=24,AMASK=AMSK8000
S13AZ    EQU   *-S13A
         EJECT  ,
S13B     SETAMODE RWORK1,S370=NO,AMODE=24,AMASK=((RWORK7))
S13BZ    EQU   *-S13B
         EJECT  ,
S14      SETAMODE RWORK1,S370=NO,AMODE=31
S14Z     EQU   *-S14
         EJECT  ,
S14A     SETAMODE RWORK1,S370=NO,AMODE=31,AMASK=AMSK8000
S14AZ    EQU   *-S14A
         EJECT  ,
S15      SETAMODE RWORK1,RWORK2,S370=NO,AMODE=RESET
S15Z     EQU   *-S15
         EJECT  ,
S16      SETAMODE RWORK1,S370=NO,AMASK=AMSK8000,AMODE=RESET
S16Z     EQU   *-S16
         EJECT  ,
S17      SETAMODE RWORK1,ASMHV2=NO,S370=NO,AMASK=AMSK8000,AMODE=RESET
S17Z     EQU   *-S17
         TITLE 'ASMAMODE - ASSEMBLE TSTAMODE'
T0       TSTAMODE RWORK1
T0Z      EQU   *-T0
         EJECT  ,
T1       TSTAMODE RWORK1,AMASK=AMSK8000
T1Z      EQU   *-T1
         EJECT  ,
T2       TSTAMODE RWORK1,AMASK=((RWORK7))
T2Z      EQU   *-T2
         TITLE 'ASMAMODE - RETURN SEQUENCE'
*
*
*        RELEASE THE WORK AREA, RELOAD THE CALLER'S REGISTERS,
*        AND RETURN TO THE CALLER.
EXIT     DS    0H
         L     RSAVE,WRKSAVE+4     RELOAD POINTER TO CALLER'S S/A
         L     R0,WORKSIZE         LOAD SP AND SIZE TO FREE
         FREEMAIN R,A=(RAREA),LV=(0) RELEASE THE WORK AREA
         RETURN (14,12)            RETURN TO THE CALLER
         TITLE 'ASMAMODE - MODULE CONSTANTS AND MACRO LIST FORMS'
         DS    0D                  BOUNDARY ALIGN
EBLANKS  DC    CL32' '             CONSTANT OF BLANKS
WORKSIZE DC    0A(0),AL1(WRKSUBP),AL3(WRKSIZE) SP&SIZE FOR GM/FM
         SPACE 5
         LTORG  *
         TITLE 'ASMAMODE - CVT MAPPING DSECT'
         CVT   DSECT=YES,LIST=YES
         END    ,

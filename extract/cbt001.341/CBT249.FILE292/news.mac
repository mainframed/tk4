         TITLE 'N E W S -- DESCRIPTION AND DISCLAIMER'            KHP11
**********************************************************************
*                                                                    *
*                      D I S C L A I M E R                           *
*                                                                    *
*   THIS PROGRAMMING MATERIAL OR DOCUMENTATION HAS BEEN PROVIDED BY  *
*   THE KAISER FOUNDATION HEALTH PLAN,  NORTHERN CALIFORNIA REGION.  *
*   THIS MATERIAL IS NOT COPYRIGHT BY THE KAISER FOUNDATION  HEALTH  *
*   PLAN, NOR DOES IT CONTAIN ANY DATA OR INFORMATION DEEMED CONFI-  *
*   DENTIAL OR PROPRIETARY BY THE KAISER FOUNDATION HEALTH PLAN.     *
*                                                                    *
*   THIS MATERIAL MAY ITSELF CONTAIN UNCOPYRIGHTED MATERIAL OR DOC-  *
*   UMENTATION OBTAINED BY THE KAISER  FOUNDATION  HEALTH PLAN FROM  *
*   OTHER SOURCES,  AND DEEMED NON-PROPRIETARY AND NON-CONFIDENTIAL  *
*   BY THOSE SOURCES. SUCH MATERIAL MAY BE IN ITS ORIGINAL FORM, OR  *
*   IT MAY HAVE BEEN MODIFIED AND EXTENDED BY THE KAISER FOUNDATION  *
*   HEALTH PLAN.                                                     *
*                                                                    *
*   THIS MATERIAL OR DOCUMENTATION HAS BEEN  USED  SUCCESSFULLY  BY  *
*   THE KAISER FOUNDATION HEALTH PLAN, AND TO THE BEST OF OUR KNOW-  *
*   LEDGE IT IS BOTH CORRECT AND COMPLETE,  EXCEPT  WHERE OTHERWISE  *
*   STATED  WITHIN  THE  MATERIAL  ITSELF.   HOWEVER, NO  WARRANTY,  *
*   EITHER EXPRESS OR IMPLIED,  IS  MADE  BY  THE KAISER FOUNDATION  *
*   WARRANTY EITHER EXPRESS OR IMPLIED IS MADE BY KAISER FOUNDATION  *
*   HEALTH PLAN OR ANY OF ITS SUBSIDIARIES  OR EMPLOYEES  AS TO THE  *
*   ACCURACY OR COMPLETENESS OF THE MATERIAL, AND NO RESPONSIBILITY  *
*   IS ASSUMED FOR THE EFFECT OF ANY USE OF THIS MATERIAL OR OF ANY  *
*   MODIFICATIONS MADE TO THIS MATERIAL.   IT IS THE SOLE RESPONSI-  *
*   BILITY OF THE USER TO EVALUATE THE USEFULNESS OF  THIS MATERIAL  *
*   TO THE USER AND THE USER'S INSTALLATION.                         *
*                                                                    *
*   THE KAISER FOUNDATION HEALTH PLAN DOES NOT  GUARANTEE  TO  KEEP  *
*   ANY OF THIS MATERIAL UP TO DATE, NOR DOES IT GUARANTEE  TO PRO-  *
*   VIDE ANY CORRECTIONS OR EXTENSIONS DESCRIBED BY THE USER OR ANY  *
*   CORRECTIONS OR EXTENSIONS MADE TO THIS MATERIAL BY  THE  KAISER  *
*   FOUNDATION HEALTH PLAN ITSELF.                                   *
*                                                                    *
**********************************************************************
         EJECT
***********************************************************************
*                                                                     *
*        N E W S                                                      *
*                                                                     *
*        THIS COMMAND IS AN EXTENSIVELY MODIFIED VERSION OF THE CBT   *
*        NEWS COMMAND.  THE MODIFICATIONS SUPPORT CONDITIONAL         *
*        DISPLAY OF SUPERCEDED ITEMS (AND, IF DISPLAYED, THEY         *
*        ARE SHOWN IN LOW-INTENSITY); MULTI-SCREEN SUPPORT FOR        *
*        DETAIL ITEMS, INCLUDING PFK7/19 BACKUP ABILITY; MULTIPLE     *
*        PRINT ITEMS IN A SINGLE SYSOUT DATASET; ETC.  THE            *
*        RESTRICTION ON USING ONLY THE FIRST 80 DATA BYTES OF EACH    *
*        LINE IS RETAINED.  PAGE NUMBERS HAVE BEEN DROPPED SINCE      *
*        # OF PAGES IS VARIABLE DEPENDING UPON WHETHER OR NOT         *
*        SUPERCEDED ENTRIES ARE BEING DISPLAYED; INSTEAD, A '*MORE*   *
*        WILL APPEAR IN THE UPPER RIGHT CORNER FOR BOTH THE SUMMARY   *
*        AND DETAIL DISPLAYS.                                         *
*                                                                     *
*        THE 'NEWS DATASET ID' HAS BEEN MADE THE HIGH-LEVEL INDEX     *
*        OF A DATASET NAMED "ANYINDEX.NEWS.TEXT" ALLOWING INDIVIDUALS *
*        AND USER GROUPS TO HAVE THEIR INDEPENDENT NEWS DATASETS.     *
*        "MVS" IS THE DEFAULT HIGH-LEVEL INDEX.  IF THE DEFAULT IS    *
*        BEING DISPLAYED, "TSO NEWS" SHOWS AS THE ID ON THE HEADER.   *
*                                                                     *
*        IF THE DEVICE IS NOT A 3270, ONLY THE "CURRENT" ITEMS WILL   *
*        BE LISTED UNLESS THE COMMAND IS ISSUED AS "NEWS ALL".        *
*                                                                     *
*        THE TUTORIAL "HELP" INFORMATION FOR 3270 USERS IS MOSTLY     *
*        BUILT INTO THE COMMAND AND IS ACCESSIBLE VIA "H" OR PFK      *
*        1/13.                                                        *
*                                                                     *
*        A HARDCOPY OF THE INDEX ITSELF IS AVAILABLE BY HITTING       *
*        PFK 4/16 WHILE DISPLAYING THE INDEX.  THE HARDCOPY WILL      *
*        ALWAYS LIST ALL OR CURRENT DEPENDING UPON THE MODE IN WHICH  *
*        THE INDEX IS BEING DISPLAYED AT THE MOMENT.                  *
*                                                                     *
*                              D. THEWLIS, 25 JULY 1981.              *
*                                                                     *
*                                                                     *
***********************************************************************
         EJECT
***********************************************************************
*                                                                     *
*        THE DEFAULT DATASET NAME IS MVS.NEWS.TEXT               KHP10*
*                                                                     *
*        NEWS IS A TSO COMMAND TO PROVIDE LISTINGS OF VARIOUS         *
*        ITEMS OF INFORMATION OF GENERAL INTEREST TO THE TSO          *
*        USER COMMUNITY.  NEWS DISPLAYS A DATASET NAMED               *
*        "ANYINDEX.NEWS.TEXT" WHICH CONTAINS HEADER ITEM LINES AND    *
*        DETAILED COMMENTARY ABOUT EACH ITEM.                         *
*                                                                     *
*        ENTER:                                                       *
*          NEWS  -or-      WILL ENTER NEWS WITH THE DEFAULT           *
*          NEWS CURRENT×C  NEWS DATASET "MVS.NEWS.TEXT" AS INPUT      *
*                          AND THE "CURRENT" SUMMARY MODE SET     KHP11
*          NEWS ALL×A      DITTO WITH "ALL" SUMARY MODE SET       KHP11
*          NEWS HELP×H     WILL ENTER NEWS IN HELP/TUTORIAL MODE  KHP11
*        WITH ANY OF THE ABOVE,                                       *
*               ID(XXXXXX) WILL ENTER NEWS WITH THE DATASET           *
*                          "XXXXX.NEWS.TEXT" AS THE INPUT             *
*                NEWS ##   (WHERE ## IS A SPECIFIC ITEM NUMBER)       *
*                          WILL CAUSE NEWS TO DISPLAY INFORMATION     *
*                          ABOUT THAT ITEM NUMBER AND TERMINATE.      *
*                   ID ALSO WORKS IN THIS CASE.                       *
*        FOR CASES (1) AND (2):                                       *
*        NEWS WILL PROVIDE A ONE-LINE SUMMARY REPORT                  *
*        OF ALL ENTRIES IN THE SPECIFIED DATA SET.                    *
*        NORMALLY ONLY CURRENT (NON-EXPIRED) ENTRIES WILL BE          *
*        DISPLAYED.  IF "A" IS ENTERED THE DISPLAY WILL SHOW ALL      *
*        ENTRIES; SUPERCEDED (EXPIRED) ENTRIES WILL BE DISPLAYED      *
*        LOW-INTENSITY AND WILL BE FLAGGED WITH A "*" BY THE          *
*        EXPIRATION DATE.  ENTERING "C" RETURNS THE DISPLAY TO        *
*        CURRENT ENTRIES ONLY.  IF PFK 3 OR 15, OR PA1, IS ENTERED,   *
*        THE NEWS COMMAND WILL TERMINATE.                             *
*                                                                     *
*        IF THE CURSOR IS MOVED TO A SUMMARY LINE AND "ENTER" IS      *
*        HIT, *OR* IF THE ITEM NUMBER IS ENTERED IN THE COMMAND       *
*        LINE, NEWS WILL DISPLAY THE DETAILED INFORMATION FOR THAT    *
*        ITEM.  IF MORE THAN ONE PAGE OF INFORMATION EXISTS,          *
*        *MORE* WILL BE DISPLAYED IN THE UPPER RIGHT OF THE SCREEN;   *
*        HITTING "ENTER" OR ANY UNASSIGNED PFK WILL MOVE TO THE       *
*        NEXT SCREEN; HITTING PFK 7 OR 19 WILL REDISPLAY THE PREVIOUS *
*        SCREEN.  HITTING PFK 3 OR 15 WILL RETURN TO THE SUMMARY      *
*        SCREEN WHICH WAS BEING DISPLAYED.  HITTING PA1 (BREAK)       *
*        WILL TERMINATE THE NEWS COMMAND COMPLETELY.                  *
*                                                                     *
*        NEWS IS TERMINATED BY ENTERING 'E' ON THE FIRST              *
*        LINE OF THE SUMMARY DISPLAY; BY ENTERING PFK 3 OR 15 WHILE   *
*        DISPLAYING THE SUMMARY DISPLAY; OR BY PA1 (BREAK).           *
*                                                                     *
*        SINCE THE HIGH-LEVEL INDEX (NEWS DATASET ID) CAN BE          *
*        SPECIFIED BY THE CALLER, MULTIPLE NEWS DATASETS CAN          *
*        BE MAINTAINED, FOR EXAMPLE, GROUPS CAN HAVE THEIR OWN.       *
*                                                                     *
***********************************************************************
         TITLE 'N E W S -- IMBEDDED MACROS'                       KHP11
         MACRO
&NAME    TSOENTER &FAKE,&BASE=12,&REGS=YES,&PL=,&WORK=0,&DSECT=NO
         GBLC  &R
         LCLA  &A
         LCLB  &OPTS(8),&BIT
         LCLC  &BASEREG
TSODSECT DSECT ,                        DEFINE NAME OF DSECT
TSOSAVE  DS    18F .                    FIRST SAVE AREA
         CPPL  DSECT=NO                 PARAMETER LIST
&A       SETA  1
.A1      AIF   (&A GT N'&PL).L1
&OPTS(1) SETB  ((&OPTS(1))OR('&PL(&A)' EQ 'MESSAGE'))
&OPTS(2) SETB  ((&OPTS(2))OR('&PL(&A)' EQ 'PARSE'))
&OPTS(3) SETB  ((&OPTS(3))OR('&PL(&A)' EQ 'IO'))
&OPTS(4) SETB  ((&OPTS(4))OR('&PL(&A)' EQ 'CSCAN'))
&OPTS(5) SETB  ((&OPTS(5))OR('&PL(&A)' EQ 'DAIR'))
&A       SETA  &A+1
         AGO   .A1
.L1      ANOP
TSOECB   DS    F .                      DEFINE COMMAND ECB
.LL1     AIF   (NOT &OPTS(1)).L2
         MNOTE 0,'MESSAGE PARM LIST UNDEFINED'
.L2      AIF   (NOT &OPTS(2)).L3
         PPL   DSECT=NO                 PARSE PARM LIST
.L3      AIF   (NOT &OPTS(3)).L4
         IOPL  DSECT=NO                 I/O PARAMETER LIST
.L4      AIF   (NOT &OPTS(4)).L5
         CSPL  DSECT=NO                 CMD SCAN PARM LIST
.L5      AIF   (NOT &OPTS(5)).L6
         DAPL  DSECT=NO                 DAIR PARM LIST
.L6      AIF   (('&WORK' EQ '0')OR('&WORK' EQ '')).L7
TSOWORK  DS    0D .                     ALIGN TO DOUBLE-WORD
TSOUSER  EQU   * .                      GIVE ALTERNATE NAME
         DS    (&WORK)X .               INCREMENT BY SIZE
.L7      ANOP
TSOLEN   EQU   *-TSODSECT .             LENGTH OF DSECT
         AIF   ('&REGS' NE 'YES').NOREGS
         REGS
&R       SETC  'R'
.NOREGS  AIF   ('&DSECT' EQ 'NO').GEN
         MEXIT
.GEN     EJECT
&NAME    CSECT
         SAVE  (14,12),T,*
         AIF   (T'&BASE NE 'N').LUSE1
&BASEREG SETC  '&R&BASE'
         AGO   .LUSE2
.LUSE1   ANOP
&BASEREG SETC  '&BASE'
.LUSE2   LUSE  &NAME,&BASEREG .         TELL ASSEMBLER
         LR    &BASEREG,15 .            GET ENTRY POINT
         LR    &R.2,1 .                 SAVE CPPL POINTER
         GETMAIN R,LV=TSOLEN,SP=1
         ST    13,4(,1) .               CHAIN
         ST    1,8(,13) .               SAVE
         LR    &R.13,1 .                AREAS
         LUSE  TSODSECT,&R.13 .         ESTABLISH ADDRESSABILITY
         MVC   CPPL(CPPLLEN),0(&R.2) .  COPY PARM LIST
         AIF   (NOT &OPTS(2)).NPARSE
         MVC   PPLUPT(4),CPPLUPT .      USER PROFILE TAB
         MVC   PPLECT(4),CPPLECT
         LA    &R.0,PPLRANS .              LOAD ANSWER PLACE
         ST    &R.0,PPLANS
         LA    &R.0,TSOECB
         ST    &R.0,PPLECB
&BIT     SETB  1
.NPARSE  AIF   (NOT &OPTS(3)).NIO
         MVC   IOPLECT(4),CPPLECT
         MVC   IOPLUPT(4),CPPLUPT
         AIF   (&BIT).Q1
         LA    &R.0,TSOECB
.Q1      ST    &R.0,IOPLECB
&BIT     SETB  1
.NIO     AIF   (NOT &OPTS(5)).NDAIR
         MVC   DAPLUPT(4),CPPLUPT
         MVC   DAPLECT(4),CPPLECT
         MVC   DAPLPSCB(4),CPPLPSCB
         AIF   (&BIT).Q2
&BIT     SETB  1
         LA    &R.0,TSOECB
.Q2      ST    &R.0,DAPLECB
.NDAIR   AIF   (NOT &OPTS(4)).NCSCAN
         MVC   CSPLUPT(4),CPPLUPT
         MVC   CSPLECT(4),CPPLECT
         AIF   (&BIT).Q3
&BIT     SETB  1
         LA    &R.0,TSOECB
.Q3      ST    &R.0,CSPLECB
         LA    &R.0,CSFLG
         ST    &R.0,CSPLFLG
         LA    &R.0,CSOA
         ST    &R.0,CSPLOA
.NCSCAN  INUSE
.MEND    MEND
         MACRO
&NAME    TSOLEAVE &LENGTH=TSOLEN,&ISN=,&RETCODE=0
         GBLC  &R
.*       TSOLEAVE MACRO                  BRUCE M. DANE
.*       LAST UPDATED:                  01 DEC 1972
.*       MACRO GENERATES RE-ENTRANT CODE
.*
&NAME    LR    1,&R.13 .                LOAD RETURN ADDRESS
         L     13,4(0,13) .             LOAD REGISTER POINTER
*        GIVE BACK MY CORE
         FREEMAIN R,A=(1),SP=1,LV=&LENGTH
.RETTEST AIF   ('&RETCODE' EQ '').RETEQ0 * MESSAGE, ASSUME ZERO
         AIF   ('&RETCODE'(1,1) EQ '(').REGTYPE * REGISTER NOT.
         AIF   (T'&RETCODE NE 'N').REGLD1 * RETURN NUMBER?
         AIF   (&RETCODE EQ 0).R0       * RETCODE=0
         AGO   .REGLA                   * LOAD ADDRESS ON RETCODE
.RETEQ0  MNOTE *,'*** WARNING *** RETCODE ASSUMED ZERO (0)'
         AGO   .R0
.REGLD1  L     15,&RETCODE .            LOAD SAVED RETURN CODE
         AGO   .BR14
.REGLA   LA    15,&RETCODE .            LOAD REQUESTED RETURN CODE
         AGO   .BR14
.REGTYPE AIF (('&RETCODE(1)' EQ '15')OR('&RETCODE(1)' EQ 'R15')).BR14
         LR    15,&RETCODE(1) .         LOAD RETURN CODE
         AGO   .BR14
.R0      LM    14,12,12(13) .           RELOAD CALLERS' REGS
         XR    15,15 .                  CLEAR RETURN CODE
         BR    14 .                     RETURN TO CALLER
         AGO   .ISNCHEK
.BR14    LM    0,12,20(13) .            LOAD SAVED REGS
         L     14,12(0,13) .            AND RETURN
         BR    14 .                     RETURN TO CALLER
.ISNCHEK AIF   ('&ISN' EQ '').MEND
         &ISN
.MEND    MEND
         MACRO
&NAME    TSOPARSE &X,&PCL=,&CBUF=,&MF=I,&USER=,&ENTRY=
         LCLC  &N
&N       SETC  '&NAME'
         AIF   (('&MF(1)' NE 'I')AND('&MF(1)' NE 'E')AND('&MF(1)' NE 'L*
               ')).ERR1
         AIF   (('&MF(1)' EQ 'I')AND(('&PCL' EQ '')OR('&CBUF' EQ ''))).*
               ERR2
         AIF   ('&PCL' EQ '').GCBUF
         AIF   ('&PCL'(1,1) EQ '(').RPCL
&N       L     0,&PCL .                 GET ADDRESS
&N       SETC  ''
         ST    0,PPLPCL .               SAVE IN PARM LIST
         AGO   .GCBUF
.RPCL    ANOP
&N       ST    &PCL(1),PPLPCL .         SAVE IN PARM LIST
&N       SETC  ''
.GCBUF   AIF   ('&CBUF' EQ '').GWORK
         AIF   ('&CBUF'(1,1) EQ '(').RCBUF
&N       L     0,&CBUF .                LOAD ADDRESS OF BUFFER
&N       SETC  ''
         ST    0,PPLCBUF .              SAVE IN PARM LIST
         AGO   .GWORK
.RCBUF   ANOP
&N       ST    &CBUF(1),PPLCBUF .       SAVE IN PARM LIST
&N       SETC  ''
.GWORK   AIF   ('&USER' EQ '').CALL
         AIF   ('&USER'(1,1) EQ '(').RWORK
&N       LA    0,&USER(1) .             GET USER FIELD
         ST    0,PPLUWA .               SAVE IN USER FIELD
&N       SETC  ''
         AGO   .CALL
.RWORK   ANOP
&N       ST    &USER(1),PPLUWA .        STORE USER FIELD
&N       SETC  ''
.CALL    AIF   ('&MF(1)' EQ 'L').MEND
&N       LA    1,PPL .                  LOAD ADDRESS OF PARM LIST
&N       SETC  ''
         AIF   ('&ENTRY' NE '').SPCALL  SPECIAL CALL
         LINK  EP=IKJPARS
.MEND    AIF   ('&N' EQ '').DONE
&N       NOPR  0 .                      DEFINE NAME
.DONE    MEXIT
.SPCALL  AIF   ('&ENTRY'(1,1) EQ '(').RSPCALL
         L     15,&ENTRY(1) .           LOAD EPLOC
.CALLBAL BALR  14,15 .                  CALL PARSE
         MEXIT
.RSPCALL AIF   (('&ENTRY(1)' EQ '15')OR('&ENTRY(1)' EQ 'R15')).CALLBAL
         LR    15,&ENTRY(1) .           GET ADDRESS OF PARSE
         AGO   .CALLBAL
.ERR1    MNOTE 12,'MF=&MF IS INVALID'
         AGO   .MEND
.ERR2    MNOTE 12,'PCL= AND CBUF= REQUIRED WITH MF=I'
         AGO   .MEND
         MEND
         MACRO
&X       CPPL  &Y,&DSECT=NO
         AIF   ('&DSECT' NE 'NO').DSECT
CPPL     DS    0A .                     COMMAND PROC PARM LIST
         AGO   .COM
.DSECT   ANOP
CPPL     DSECT ,                        COMMAND PROC PARM LIST
.COM     ANOP
CPPLCBUF DC    A(0) .                   COMMAND BUFFER ADDR
CPPLUPT  DC    A(0) .                   USER PROF. TAB
CPPLPSCB DC    A(0) .                   PROT STEP CB
CPPLECT  DC    A(0) .                   ENV. CTL TABLE
CPPLLEN  EQU   *-CPPL .                 LENGTH
         MEND
         MACRO
&X       PPL   &Y,&DSECT=NO
         AIF   ('&DSECT' NE 'NO').DSECT
PPL      DS    0A ,                     PARSE PARM LIST
         AGO   .COM
.DSECT   ANOP
PPL      DSECT ,                        PARSE PARM LIST
.COM     ANOP
PPLUPT   DC    A(0) .                   USER PROF. TAB
PPLECT   DC    A(0) .                   ENV. CTL TAB
PPLECB   DC    A(0) .                   ECB ADDRESS
PPLPCL   DC    A(0) .                   PARSE CTL LIST
PPLANS   DC    A(0) .                   ANSWER ADDRESS
PPLCBUF  DC    A(0) .                   COMMAND BUFFER
PPLUWA   DC    A(0) .                   USER WORK AREA
PPLRANS  DC    A(0) .                   RETURNED ANSWER ADDRESS
PPLLEN   EQU   *-PPL .                  LENGTH
         MEND
         MACRO
         REGS
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         MEND
         MACRO
&NAME    LUSE  &WHERE,&W1,&W2
         GBLB  &LUSED
         GBLC  &USENM(50),&USEW(25)
         LCLA  &A,&B,&C,&D,&E
         LCLC  &X1,&X2
         AIF   ('&NAME' EQ '').NONAME
&NAME    DS    0H .           DEFINE NAME
.NONAME  AIF   (N'&SYSLIST LE 10).OK1
         MNOTE 16,'OPERAND ERROR - TOO MANY OPERANDS'
.OPFIELD MNOTE *,'OPERAND FIELD FOLLOWS'
         MNOTE *,'&SYSLIST(1),&SYSLIST(2),&SYSLIST(3),&SYSLIST(4),&SYSL*
               IST(5),&SYSLIST(6),&SYSLIST(7),&SYSLIST(8)'
         AIF   (N'&SYSLIST LE 8).MEND
         MNOTE *,'- REMAINING OPERANDS NOT PRINTED -'
         MEXIT
.OK1     AIF   (N'&SYSLIST LT 2).ERR
&A       SETA  1
&C       SETA  N'&SYSLIST
.OKX     AIF   ('&SYSLIST(&A)' NE '').INCR
         MNOTE 16,'OPERAND ERROR - NULL OPERAND'
         AGO   .OPFIELD
.INCR    AIF   (&A EQ &C).GEN
&A       SETA  &A+1
         AGO   .OKX
.GEN     AIF   (&C NE 2).RECURSE
&A       SETA  1
.FNULL   AIF   ('&USEW(&A)' EQ '').HNULL
&A       SETA  &A+1
         AIF   (&A LE 25).FNULL
         MNOTE 16,'LUSE USER ERROR - TOO MANY LUSE WITHOUT LDROP'
         AGO   .OPFIELD
.HNULL   ANOP
&D       SETA  (&A*2)-1
&E       SETA  K'&WHERE-8
&X1      SETC  '&WHERE'
         AIF   (&E LE 0).COMMON
         AIF   (&E LE 8).SETX2
&E       SETA  8
.SETX2   ANOP
&X2      SETC  '&WHERE'(9,&E)
.COMMON  ANOP
&USENM(&D)     SETC           '&X1'
&USENM(&D+1) SETC '&X2'
&USEW(&A) SETC '&W1'
&E       SETA  1
.MATCH   AIF   (&E GE &A).GENUSE
         AIF   ('&USEW(&E)' EQ '&USEW(&A)').MN0
&E       SETA  &E+1
         AGO   .MATCH
.MN0     MNOTE 0,'** WARNING **  REGISTER '
         MNOTE *,'&USEW(&E) PREVIOUSLY LUSED AS BASE FOR'
&D       SETA  (&E*2)-1
         MNOTE *,'&USENM(&D)&USENM(&D+1) - NEW USING CREATED'
&E       SETA  &E+1
         AGO   .MATCH
.GENUSE  USING &WHERE,&W1 .   GEN USING STMT
         AIF   (&LUSED).MEND
*        --> LUSE, LDROP, AND INUSE MACROS ESTABLISHED <-
&LUSED   SETB  1
         SPACE 1
         MEXIT
.RECURSE ANOP
&B       SETA  2
.RCU     AIF   (&B GT &C).MEND
         LUSE  &WHERE&X1,&SYSLIST(&B)
&B       SETA  &B+1
&E       SETA  &E+4096
&X1      SETC  '+'.'&E'
         AGO   .RCU
.ERR     MNOTE 16,'OPERAND ERROR - AT LEAST 2 OPERANDS REQUIRED'
         AGO   .OPFIELD
.MEND    MEND
         MACRO
&NAME    INUSE &FOOLASM
         GBLB  &LUSED
         GBLC  &USENM(50),&USEW(25)
         LCLA  &A,&D,&B
         LCLB  &F
         LCLC  &X1,&X2
         AIF   ('&NAME' EQ '').CHK
&NAME    DS    0H .                     NAME DEFINED
.CHK     AIF   (&LUSED).GO
         MNOTE 0,'USER ERROR - LUSE NEVER USED, NO KNOWN BASE REGS'
         MEXIT
.GO      SPACE 2
&A       SETA  1
*              THE FOLLOWING REGISTER(S) IN USE:
*                LOCATION           BASE
.LOOP    AIF   ('&USEW(&A)' EQ '').MENDX
&D       SETA  (&A*2)-1
&X1      SETC  '&USENM(&D)'.'           '
&X2      SETC  '&USENM(&D+1)'.'            '
         MNOTE *,'&X1&X2    &USEW(&A)'
&A       SETA  &A+1
&F       SETB  1
         AGO   .LOOP
.MENDX   AIF   (&F).MEXIT
*              ** NO REGISTERS CURRENTLY IN USE **
.MEXIT   ANOP
         SPACE 1
         MEND
         MACRO
&NAME    DATEMDY &FIELD,&TM,&DATE=SYSTEM
&NAME    STM   0,5,XAH1&SYSNDX         STOREREGS
         AIF   ('&DATE' EQ 'SUPPLIED').XDDXNTR
         TIME  DEC
.XDDXNTR AIF   ('&TM' EQ '').XDTXN
         ST    0,XAH2&SYSNDX
         OI    XAH2&SYSNDX+3,X'0F'
         UNPK  XAH3&SYSNDX.(7),XAH2&SYSNDX.(4)
         MVC   &TM.(2),XAH3&SYSNDX
         MVI   &TM+2,C':'
         MVC   &TM+3(2),XAH3&SYSNDX+2
         MVI   &TM+5,C':'
         MVC   &TM+6(2),XAH3&SYSNDX+4
.*
.XDTXN   AIF   ('&FIELD' EQ '').XTMXN
         ST    1,XAH2&SYSNDX
         XC    XAH3&SYSNDX.(8),XAH3&SYSNDX
         MVO   XAH3&SYSNDX+6(2),XAH2&SYSNDX+1(1)
         OI    XAH3&SYSNDX+7,X'0F'
         CVB   2,XAH3&SYSNDX                YEAR TO R2
         MVI   XAH4&SYSNDX+1,X'1C'           FEB=28
         N     2,XAH5&SYSNDX                LEAP YEAR?
         BNE   XAHA&SYSNDX                    NO
         MVI   XAH4&SYSNDX+1,X'1D'           FEB=29
XAHA&SYSNDX MVC XAH3&SYSNDX,XAH6&SYSNDX     ZERO CV AREA
         MVC   XAH3&SYSNDX+6(2),XAH2&SYSNDX+2   CV=ADTE
         CVB   2,XAH3&SYSNDX                R2=DATE
         SR    3,3
         SR    4,4
         LA    4,XAH4&SYSNDX-1              R4=TABLE-1
XAHB&SYSNDX A  3,XAH7&SYSNDX                MONTH=MONTH+1
         A     4,XAH7&SYSNDX                TABLE=TABLE+1
         STC   2,XAH8&SYSNDX                STORE 8BITS OF DATE
         SR    5,5
         IC    5,0(4)                       R5=TABLE ENTRY
         SR    2,5                          DATE-#DAYSIN MO.
         BP    XAHB&SYSNDX                  GO IF MORE DAYS
         SR    5,5
         IC    5,XAH8&SYSNDX           8BITS DATE TO R5
         CVD   5,XAH3&SYSNDX
         MVO   XAH9&SYSNDX+1(2),XAH3&SYSNDX+6(2)  DAYS TO FIELD
         CVD   3,XAH3&SYSNDX                #MONTHS TO DEC
         MVO   XAHV&SYSNDX.(2),XAH3&SYSNDX+6(2)  MO TO HOLD
         MVC   XAH9&SYSNDX.(1),XAHV&SYSNDX     HOLD MO TO FIELD
         MVC   XAH9&SYSNDX+2(1),XAH2&SYSNDX+1   YEARS TO FIELD
         MVO   XAHZ&SYSNDX.(4),XAH9&SYSNDX     FIELD TO PROP
         OI    XAHZ&SYSNDX+3,X'0F'          SET DONE SIGN
         MVC   XAHX&SYSNDX.(9),XAHY&SYSNDX    PATTERN TO RCV
         ED    XAHX&SYSNDX.(9),XAHZ&SYSNDX        EDIT DATE
         CLI   XAHX&SYSNDX+1,X'20'
         BNE   XAHU&SYSNDX
         MVI   XAHX&SYSNDX+1,X'40'
XAHU&SYSNDX MVC &FIELD.(8),XAHX&SYSNDX+1    FIELD TO FIELD
.XTMXN   ANOP
         B     XAHC&SYSNDX                  GO AROUND DCS
XAH1&SYSNDX DC 6F'0'        STORE REGS
XAH2&SYSNDX DC F'0'              RCV DATE FROM REG1
XAH3&SYSNDX DC D'0'              CV AREA
         AIF   ('&FIELD' EQ '').XZZZZ
XAH4&SYSNDX DC X'1F1C1F1E1F1E1F1F1E1F1E1F'       TABLE
XAH5&SYSNDX DC F'3'             TEST FOR LEAP YEAR=X4
XAH6&SYSNDX DC D'0'          CONSTANT DOUBLEWORD ZEROS
XAH7&SYSNDX DC F'1'         FULLWORD=1
XAH8&SYSNDX DC C' '       HOLD DATE=8BITS
XAH9&SYSNDX DC X'000000'         HOLD MODAYR NO SIGNS
XAHZ&SYSNDX DC X'00000000'       HOLD 0MODAYRS
XAHY&SYSNDX DC X'202020612020612020'    EDIT PATTERN
XAHX&SYSNDX DC 9X'00'
XAHV&SYSNDX DC X'0000'                 HOLD MONTH
.XZZZZ   ANOP
XAHC&SYSNDX LM 0,5,XAH1&SYSNDX
         MEND
       EJECT
         TITLE 'NEWS --- SET UP ENTRY LINKAGE'
UVNS     TSOENTER REGS=YES,PL=(PARSE),WORK=260
         LA    R11,UVNS+4095
         LA    R11,1(R11)
         USING UVNS+4096,R11
TSODSECT DSECT ,
         ORG   TSOWORK
         TITLE 'NEWS MAINLINE'
***********************************************************************
*                                                                     *
*        PARSE THE COMMAND FOR AN ITEM NUMBER.                        *
*                                                                     *
***********************************************************************
*                                                                     *
UVNS     CSECT
         STAX  LWATTNRT
         STM   R11,R12,SAVER11 GET ADDRESSABILITY
         XC    PPLRANS(4),PPLRANS  CLEAR STUFF OUT
         XC    TSOECB(4),TSOECB
         L     R15,CPPLCBUF   LOAD COMMAND BUFFER
         TSOPARSE CBUF=(15),PCL==A(PCL) CALL PARSE
         LTR   R15,R15        PARSE O.K. ?
         BNZ   LWERR1
         USING PDL,R10
         L     R10,PPLANS     POINT TO ANSWER
         L     R10,0(R10)
         ICM   R15,B'1111',PIDID POINT TO THE ENTERED ID
         BNZ   ENTERED        IF NOT ZERO, IT'S THERE
         MVC   LWPRDDSN(13),=C'MVS.NEWS.TEXT' SET DEFAULT        KHP10
         MVC   LWID(8),=C'TSO NEWS'                              KHP10
         LA    R14,13
         STH   R14,LWPRDLDN   SET THE LENGTH
         B     LWALLOC
ENTERED  LA    R1,LWPRDDSN    POINT TO VARIABLE PART
         LH    R14,PIDID+4    GET LENGTH
         LA    R14,10(R14)    ADD THE .NEWS.TEXT PART            KHP10
         STH   R14,LWPRDLDN   SAVE THE LENGTH IN THE DYNALLOC LIST
         LH    R14,PIDID+4    GET LENGTH AGAIN
         BCTR  R14,0          DEREASE FOR THE MOVE
         MVC   0(0,R1),0(R15)
         EX    R14,*-6        MOVE IN THE ENTERED ID
         MVC   LWID(0),0(R15) PUT ID IN HEADER
         EX    R14,*-6
         LA    R1,1(R14,R1)
         MVC   0(10,R1),=C'.NEWS.TEXT' COMPLETE THE NAME          KHP10
         SPACE 4                                                  KHP10
***********************************************************************
*                                                                     *
*        DYNAMICALLY ALLOCATE THE DATA SET,                           *
*            MVS.NEWS.TEXT    OR XXX.NEWS.TEXT                        *
*                                                                     *
***********************************************************************
*                                                                     *
LWALLOC  LA    R1,LWDYNPRD    POINT TO PROD DYNAM ALLOC LIST
         DYNALLOC             GO ALLOC THE DATA SET
         LTR   R15,R15        IS IT O.K. ?
         BNZ   LWERR2         NO, GO ISSUE MESSAGE
         MVC   LWFREDDN(8),LWRETDDN  SAVE RETURNED DDNAME
         MVC   SYSNEWS+40(8),LWRETDDN
         TITLE 'N E W S  --- TABLE HEADER RECORDS'
***********************************************************************
*                                                                     *
*        OPEN THE SYSNEWS DATA SET                                    *
*                                                                     *
***********************************************************************
*                                                                     *
         OPEN  SYSNEWS
         TM    SYSNEWS+48,X'10'  OPEN MAKE IT ?
         BNO   LWERR3
         GETMAIN R,LV=84000,SP=120     FOR TITLES (1000 MAX)
         SR    R3,R3          CLEAR COUNTER
         SR    R6,R6          CLEAR TOTAL COUNTER
         SR    R4,R4          CLEAR CHAIN POINTER
         LR    R2,R1          SET START OF TABLE
         ST    R1,TITABLE     SAVE ADDRESS OF TITLE TABLE         KHP10
         SPACE 4
***********************************************************************
*                                                                     *
*        GET CURRENT DATE IN FORM YYMMDD                              *
*                                                                     *
***********************************************************************
*                                                                     *
         PUSH  PRINT                                              KHP10
         PRINT ON,NOGEN                                           KHP10
         DATEMDY DATE,TIME                                        KHP10
         MVC  TODYEAR(2),DATE+6     GET TODAY'S YEAR              KHP10
         MVC  TODMONTH(2),DATE      GET TODAY'S MONTH             KHP10
         MVC  TODDAY(2),DATE+3      GET TODAY'S DATE              KHP10
         OC   TODAY(6),=6C'0'       ENSURE ALL VALID NUMERICS     KHP10
         POP  PRINT                                               KHP10
         EJECT
***********************************************************************
*                                                                     *
*        LOOP THRU THE DATA SET AND TABLE ALL THE HEADERS.            *
*                                                                     *
***********************************************************************
*                                                                     *
LWGETIT  GET   SYSNEWS,(R2)
         CLC   4(6,R2),=6C'×' IS IT A HEADER RECORD ?
         BNE   LWGETIT        NO, KEEP LOOKING
         SPACE 1
         LA    R6,1(,R6)      BUMP TOTAL COUNTER                  KHP10
         OC    15(7,R2),=7X'40'   MAKE ENTRY DATE CAPS            KHP10
         OC    29(7,R2),=7X'40'   MAKE REMOVAL DATE CAPS          KHP10
         CLC   29(7,R2),=C'***PERM' IS THIS A PERMANENT ENTRY?    KHP10
         BE    LWGETM22             YES, ALWAYS CURRENT           KHP10
* THIS MESS FIGURES OUT IF THE REMOVE DATE IS < TODAY'S DATE AND  KHP10
* FLAGS THE HEADER RECORD IF IT IS.                               KHP10
         LA    R1,=C'JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC'        KHP10
         LA    R14,1                ---SET A COUNTER              KHP10
LWGETM1  CLC   31(3,R2),0(R1)       IS THIS THE MONTH?            KHP10
         BE    LWGETM2              YES, GO SAVE ITS NUMBER       KHP10
         LA    R1,3(,R1)            BUMP MONTH VECTOR             KHP10
         LA    R14,1(,R14)          BUMP MONTH NUMBER             KHP10
         CH    R14,=H'12'           HAVE WE EXHAUSTED MONTHS?     KHP10
         BNH   LWGETM1              NO, TRY THIS MONTH            KHP10
*                                   YES, USE "13" AS MONTH        KHP10
LWGETM2  CVD   R14,PACK             CONVERT MONTH NUMBER TO DEC   KHP10
         OI    PACK+7,X'0F'         AND FORCE NUMERIC             KHP10
         UNPK  REMONTH-1(3),PACK+6(2)   2-CHARACTER NUMERIC MONTH KHP10
         MVC   REMDAY(2),29(R2)     USE NUMERIC DAY               KHP10
         MVC   REMYEAR(2),34(R2)    AND YEAR                      KHP10
         OC    REMDATE(6),=6C'0'    ENSURE ALL VALID NUMERICS     KHP10
         MVI   36(R2),C'*'          INDICATE SUPERCEDED ENTRY     KHP10
         CLC   TODAY(6),REMDATE     OKAY, IS TODAY LATER THAN     KHP10
         BH    LWGETM3              REMOVE DATE?  IF NOT,         KHP10
         SPACE 1
LWGETM22 MVI   36(R2),C' '          REMOVE SUPERCEDED FLAG AND    KHP10
         LA    R3,1(R3)             BUMP "CURRENT" COUNTER ALSO   KHP10
         SPACE 1
LWGETM3  CH    R6,=H'990'     IS TABLE EXCEEDED?                  KHP10
         BH    LWERR4         TABLE WAS EXCEEDED
         LH    R15,0(R2)      SAVE LENGTH OF ENTRY
         STH   R15,4(R2)
         ST    R4,0(R2)       SAVE LAST POINTER
         LR    R4,R2          SAVE CURRENT POINTER
         LA    R2,84(R2)      BUMP TO NEXT TABLE ENTRY
         B     LWGETIT        AND KEEP LOOKING
         TITLE 'N E W S  --- DISPLAY THE SUMMARY LINES'
***********************************************************************
*                                                                     *
*        TABLE COMPLETE, CLOSE DATA SET AND SET UP FOR DISPLAY        *
*                                                                     *
***********************************************************************
*                                                                     *
LWEOF1   ST    R3,LWNUMTIT SAVE NUMBER OF CURRENT TITLES          KHP10
         ST    R6,LWTOTTIT SAVE NUMBER OF TOTAL TITLES            KHP10
         ST    R4,LWTOPPTR    SAVE ADDRESS OF POINTER LIST TOP
         CLOSE SYSNEWS
         LTR   R4,R4          IS POINTER ZERO ?
         BZ    LWERR5         YES, NO TITLES WERE IN DATA SET
         L     R1,PDMODE      POINT TO MODE                       KHP11
         SPACE 1                                                  KHP11
         L     R15,=A(HELP1)  POINT TO FIRST HELP PANEL           KHP11
         LA    R14,LWGTSIZE   SET RETURN FROM HELP                KHP11
         CLC   PDMODE,=H'3'   IF USER ENTERED ASKING FOR HELP,    KHP11
         BE    LHELP          GO DO SO STARTING WITH FIRST        KHP11
         SPACE 1                                                  KHP11
         CLC   PDMODE,=H'2'   "NEWS CURRENT" SPECIFIED?           KHP11
         BE    LWQZERO        YES, AND THAT IS DEFAULT            KHP11
         SPACE 1                                                  KHP11
         CLC   PDMODE,=H'1'   "NEWS ALL" SPECIFIED?               KHP11
         BNE   LWQZERO        NO, ASSUME CURRENT                  KHP11
         OI    LWSWITCH,LWALL INDICATE ALL ITEMS OF INDEX WANTED  KHP11
         MVC   LWHD2M,=CL7'All'   INDICATE MODE IS "ALL"          KHP11
         SPACE 1                                                  KHP11
LWQZERO  L     R1,PDMSGNO     POINT TO MESSAGE NUMBER             KHP11
         CLI   0(R1),C'0'     WAS IT SPECIFIED?                   KHP11
         BH    LWPRDET        YES, GO PRINT ONLY ITS DETAILS      KHP11
         SPACE 1                                                  KHP11
LWGTSIZE GTSIZE ,                                                 KHP11
         LTR   R0,R0          IS IT A TUBE
         BZ    LWPRSUM        NO, DON'T DO FULL-SCREEN STUFF
         SPACE 1
* PAGE # CALCULATION REMOVED AND REPLACED BY *MORE* FLAG SINCE    KHP10
* ABILITY TO DO TOTAL OR JUST CURRENT MAKES THIS MEANINGLESS.     KHP10
         SPACE 1                                                  KHP10
         AGO   .BYPASS1       BYPASS THIS CODE                    KHP10
         SR    R2,R2          CLEAR R2
         D     R2,=F'21'      DIVIDE BY NUMBER OF TITLES PER PAGE+1
         LA    R3,1(R3)       BUMP BY 1 FOR PARTIAL LAST PAGE
         STH   R3,LWSPAGES    SAVE NUMBER OF PAGES
         CVD   R3,PACK        PUT TOTAL PAGES IN HEADING
         UNPK  LWSUMTP(2),PACK(8)
         OI    LWSUMTP+1,X'F0' MAKE IT NUMERIC
         CLI   LWSUMTP,C'0'
         BNE   LWSETPG
         MVI   LWSUMTP,C' '
.BYPASS1 ANOP                                                     KHP10
LWSETPG  SR    R3,R3          SET CURRENT PAGE NUMBER
         LA    R1,1(R3)
         STH   R1,LWSPAGEC    SAVE IN CURRENT PAGE
         L     R4,LWTOPPTR
         EJECT
***********************************************************************
*                                                                     *
*        BUILD A SUMMARY PAGE.                                        *
*                                                                     *
***********************************************************************
*                                                                     *
LWLOOP1  LTR   R4,R4          IS POINTER ZERO ?
         BZ    LWSETPG        YES, GO RESET TO TOP
         ST    R4,LWDETPTR    SAVE POSITION FOR RETURN FROM DET
LWENDLP1 LA    R5,20          SET LINE COUNTER
         LA    R8,LWADDTBL    POINT AT ADDRESS TABLE
         LA    R7,LWLINEAD    POINT AT LINE TABLE
         LA    R6,LWTITLIN    START OF OUTPUT SCREEN TITLE AREA
         SR    R1,R1          CLEAR BYTE COUNTER
         SR    R9,R9          CLEAR LINE COUNTER
LWLOOP2  MVI   0(R6),X'11'    SBA COMMAND
         MVC   1(2,R6),0(R8)  SET LINE ADDRESS
         MVC   3(2,R6),=X'1DE8' SF  HI, PROT
         MVI   5(R6),C' '     CLEAR OUTPUT AREA
         MVC   6(71,R6),5(R6)
         SPACE 1
         CLI   36(R4),C'*'    IS THIS HEADER FLAGGED SUPERCEDED?  KHP10
         BNE   LWLCONT        NO, CONTINUE WITH IT                KHP10
         TM    LWSWITCH,LWALL ARE WE DISPLAYING ALL HEADERS?      KHP10
         BO    LWLCONTL       YES, FLAG HEADER AS LOW INTENSITY   KHP10
         SPACE 1
         L     R4,0(,R4)      BYPASS THIS HEADER: POINT TO NEXT   KHP10
         LTR   R4,R4          IS THERE ONE HE ASKED               KHP10
         BNZ   LWLOOP2        YES, RECURSE THROUGH SETUP          KHP10
         OI    LWSWITCH,LWEND   INDICATE END NEXT TIME THROUGH    KHP10
         MVC   LWMORE(6),=6C' ' REMOVE *MORE* IF ON               KHP10
         B     LWLOOP2        RECURSE THROUGH LOOP                KHP10
         EJECT                                                    KHP10
LWLCONTL MVI   4(R6),X'E4'    CHANGE TO LOW INTENSITY DISPLAY     KHP10
         SPACE 1
LWLCONT  LH    R15,4(R4)      GET LENGTH OF HEADER                KHP10
         SH    R15,=H'12'     DECREMENT FOR MOVE
         MVC   5(0,R6),11(R4) EXECUTED MOVE INSTRUCTION
         EX    R15,*-6        MOVE THE HEADER INTO DATA LINE
         ST    R4,0(R7)       PUT IN LINE ADDRESS TABLE
         TM    LWSWITCH,LWEND WAS END SIGNALED ?
         BO    LWENDLP2       YES, GET OUT OF LOOP
         L     R4,0(R4)       POINT AT NEXT TITLE
         LTR   R4,R4          LAST ONE ?
         BNZ   LWLOOP3        NO, KEEP GOING
         OI    LWSWITCH,LWEND YES, SIGNAL TO END AFTER THIS TIME
         MVC   LWMORE(6),=6C' '    BLANK OUT "MORE" AREA          KHP10
LWLOOP3  LA    R1,77(R1)      BUMP BYTE COUNTER
         LA    R6,77(R6)      BUMP PTR TO NEXT OUTPUT LINE
         LA    R8,2(R8)       BUMP LINE ADDRESS
         LA    R7,4(R7)       BUMP LINE TABLE POINTER
         LA    R9,1(R9)       BUMP LINE COUNTER
         BCT   R5,LWLOOP2     GO DO NEXT LINE
         MVC   LWMORE(6),=C'*MORE*' INDICATE MORE PAGES COMING    KHP10
LWENDLP2 NI    LWSWITCH,X'FF'-LWEND
         LA    R1,LWSUMSZ(R1) ADD HEADING LENGTH TO SIZE
         ST    R1,LWPUT1SZ    SAVE MESSAGE SIZE FOR RE-DISPLAY
         ST    R4,LWCURPTR    SAVE CURRENT POINTER
         STH   R9,LWCURLIN
         AGO   .BYPASS2       BYPASS THIS CODE                    KHP10
         LH    R15,LWSPAGEC   GET CURRENT PAGE NUMBER             KHP10
         CVD   R15,PACK                                           KHP10
         UNPK  LWSUMCP(2),PACK(8)                                 KHP10
         CLI   LWSUMCP,C'0'                                       KHP10
         BNE   LWSUMNUM       MAKE DISPLAY AND STICK IT IN HDR    KHP10
         MVI   LWSUMCP,C' '                                       KHP10
LWSUMNUM OI    LWSUMCP+1,X'F0'                                    KHP10
.BYPASS2 ANOP                                                     KHP10
         EJECT
***********************************************************************
*                                                                     *
*        ISSUE SUMMARY LINE TPUT FULL-SCREEN.                         *
*                                                                     *
***********************************************************************
*                                                                     *
         MVC   LWHD2M,=CL7'Current'     INDICATE DISPLAY MODE     KHP11
         TM    LWSWITCH,LWALL           ARE WE DOING ALL?         KHP11
         BNO   *+10                         IF SO,                KHP11
         MVC   LWHD2M,=CL7'All'             SHOW IT               KHP11
         TPUT  LWSUMSCN,(R1),FULLSCR
         LTR   R15,R15        IS IT O.K. ?
         BNZ   LWERR6
         MVI   LWHD3A,C'-' RESET THE INFO LINE
         MVC   LWHD3A+1(25),LWHD3A
         SPACE 4
***********************************************************************
*                                                                     *
*        NOW A TGET ASIS FOR THE INPUT DATA (SUMMARY).                *
*                                                                     *
***********************************************************************
*                                                                     *
         XC    LWTGETIN,LWTGETIN
         TGET  LWTGETIN,70,ASIS
         EJECT                                                    KHP10
***********************************************************************
*                                                                     *
*        ANALYZE RESPONSE FOR PFK OR PA1                          KHP11
*                                                                     *
***********************************************************************
*                                                                     *
         TM    LWSWITCH,LWATTN  WAS AN ATTN HIT ?
         BO    LWEXIT           YES, GO QUIT
         LTR   R15,R15        IS IT O.K. ?
         BNZ   LWERR7
         SPACE 1                                                  KHP10
         L     R15,=A(HELP2)  POINT TO FIRST SUMMARY PANEL HELP   KHP10
         LA    R14,LWSETPG    RETURN TO REDISPLAY SUMMARY         KHP10
         CLI   LWTGETIN,C'1'  IS THIS PFK 1?                      KHP10
         BE    LHELP          IF SO, GO DO HELP AND REDISPLAY     KHP10
         CLI   LWTGETIN,C'A'  IS THIS PFK 13?                     KHP10
         BE    LHELP          IF SO, GO DO HELP AND REDISPLAY     KHP10
         SPACE 1                                                  KHP10
         CLI   LWTGETIN,C'3'  PFK  3 ENTERED ?                    KHP10
         BE    LWEXIT         YES, QUIT                           KHP10
         CLI   LWTGETIN,C'C'  PFK 15 ENTERED ?                    KHP10
         BE    LWEXIT         YES, QUIT                           KHP10
         SPACE 1                                                  KHP10
         CLI   LWTGETIN,C'4'  PFK  4 ENTERED ?                    KHP10
         BE    LWPRINTS       YES, GO TO PRINT TO SYSOUT          KHP10
         CLI   LWTGETIN,C'D'  PFK 16 ENTERED ?                    KHP10
         BE    LWPRINTS       YES, GO TO PRINT TO SYSOUT          KHP10
         SPACE 1
         EJECT
***********************************************************************
*                                                                     *
*        DETERMINE CURSOR LINE.                                       *
*                                                                     *
***********************************************************************
*                                                                     *
         SR    R4,R4          CLEAR WORK REGS
         SR    R5,R5
         IC    R4,LWTGETIN+1  GET FIRST CURSOR BYTE
         N     R4,=F'63'      TURN OFF ALL BUT LAST 6 BITS
         IC    R5,LWTGETIN+2  GET SECOND CURSOR BYTE
         N     R5,=F'63'
         SLL   R4,6 SHIFT LEFT 6
         AR    R5,R4          R5 = BYTE LOCATION OF CURSOR
         SR    R4,R4          DIVIDE BY 80 TO GET LINE NUMBER
         D     R4,=F'80'
         SH    R5,=H'3'       SUBTRACT OFF THE HEADING LINES
         BNP   LWREDISP       CURSOR IS STILL IN HEADING, GO REDISPLAY
         CH    R5,LWCURLIN    IS IT HIGHER THAN CURRENT LINE
         BH    LWREDISP       YES, GO DISPLAY NEXT PAGE
         B     LWGETDET       NO, GO GET DETAIL FOR THIS HEADER
         EJECT
***********************************************************************
*                                                                     *
*        CURSOR WAS IN FIRST LINE, CHECK FOR 'END', 'ALL',        KHP10
*        'CURRENT', OR 'HELP'/'TUTORIAL'; OTHERWISE, EITHER       KHP10
*        A NUMERIC ITEM # WAS ENTERED OR DISPLAY NEXT SCREEN      KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWREDISP LA    R1,LWTGETIN+6  POINT TO INPUT DATA
         LA    R15,64         SET LOOP LIMIT
LWENDLOP OI    0(R1),X'40'    MAKE UPPERCASE
         CLI   0(R1),C'E'     IS IT END ?
         BE    LWEXIT         YES, GO QUIT
         CLI   0(R1),C'Z'     IS IT END FOR AN RMF BIGOT?         KHP10
         BE    LWEXIT         YES, GO QUIT                        KHP10
         CLI   0(R1),C' '     BLANK?
         BE    LWNEXT         YES, KEEP LOOKING
         SPACE 1                                                  KHP10
         L     R15,=A(HELP1)  POINT TO FIRST HELP PANEL           KHP10
         LA    R14,LWSETPG    SET RETURN TO REDISPLAY SUMMARY     KHP10
         CLI   0(R1),C'H'     IF USER SAID 'HELP', START WITH     KHP10
         BE    LHELP          FIRST HELP PANEL                    KHP10
         CLI   0(R1),C'T'     IF USER SAID 'TUTORIAL', START WITH KHP10
         BE    LHELP          FIRST HELP PANEL                    KHP10
         SPACE 1                                                  KHP10
         CLI   0(R1),C'A'     IS USER REQUESTING ALL HEADERS?     KHP10
         BNE   LWENDLPC       NO, TRY REQUESTING CURRENTS ONLY    KHP10
         OI    LWSWITCH,LWALL INDICATE "ALL" HEADERS DISPLAYED    KHP10
         MVC   LWHD2M,=CL7'All'   INDICATE MODE IS "ALL"          KHP11
         B     LWSETPG        AND START OVER W/SUMMARY DISPLAY    KHP10
LWENDLPC CLI   0(R1),C'C'     IS USER REQUESTING CURRENT HEADERS? KHP10
         BNE   LWNEXT00       NO, GO CHECK NUMERIC REQUEST        KHP10
         NI    LWSWITCH,X'FF'-LWALL  RESET "ALL" SWITCH           KHP10
         MVC   LWHD2M,=CL7'Current'  INDICATE MODE IS "CURRENT"   KHP11
         B     LWSETPG        AND START OVER W/SUMMARY DISPLAY    KHP10
         SPACE 1                                                  KHP10
LWNEXT00 TM    0(R1),X'F0'    NUMERIC ?                           KHP10
         BO    LWGETLIN       YES, GO GET A LINE NUMBER
         SPACE 1                                                  KHP10
LWNEXT   LA    R1,1(R1)
         BCT   R15,LWENDLOP
         L     R4,LWCURPTR    GET CURRENT LINE POINTER (NEXT PAGE)
         LH    R1,LWSPAGEC    BUMP CURRENT PAGE NUMBER            KHP10
         LA    R1,1(R1)                                           KHP10
         STH   R1,LWSPAGEC                                        KHP10
         B     LWLOOP1        GO BUILD NEXT PAGE
         EJECT                                                    KHP10
***********************************************************************
*                                                                     *
*        FIND SPECIFIED ITEM # AND SETUP TO DISPLAY DETAIL        KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWGETLIN LA    R15,2          SET LOOP LIMIT
         L     R14,=X'40404040' DEFAULT TO BLANKS
         IC    R14,0(R1)      GET THE FIRST DIGIT
LWGETLOP LA    R1,1(R1)       BUMP POINTER
         CLI   0(R1),C' '     IS IT THE END
         BE    LWGETEN        YES, WE'RE DONE
         CLI   0(R1),X'00'    IS IT THE END
         BE    LWGETEN        YES, WE'RE DONE
         OI    0(R1),X'F0'    MAKE SURE IT IS NUMERIC
         SLL   R14,8          NO, PUT IT IN THE REGISTER
         IC    R14,0(R1)
         BCT   R15,LWGETLOP   KEEP LOOKING
LWGETEN  ST    R14,SAVER10    SAVE IT FOR PACK
         L     R4,LWTOPPTR    POINT AT TABLE TOP
         L     R5,LWTOTTIT    AND GET COUNT OF ENTRIES            KHP10
LWTBLOOP CLC   10(4,R4),SAVER10  IS THIS THE HEADER REQUESTED ?
         BE    LWGETDT1         YES, GET DETAIL
         L     R4,0(R4)
         BCT   R5,LWTBLOOP      NO, KEEP LOOKING
         B     LWERR9           END OF TABLE, STOP LOOKING
         PACK  PACK(8),SAVER10(4)  PACK IT
         CVD   R5,PACK        AND PUT IT IN REG 5
         B     LWGETDET       GO GET THE DETAILS FOR THIS ONE
         TITLE 'N E W S  --- END THE COMMAND'
***********************************************************************
*                                                                     *
*        'END' WAS ENTERED, SO FREE NEWS.TEXT, CLEAR SCREEN,          *
*        CLOSE AND FREE SYSOUT DATASET IF OPEN, RELEASE           KHP10
*        DYNAMIC STORAGE AREAS IF ALLOCATED, AND TERMINATE.       KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWEXIT   BAL   R10,LWSCRCLR   CLEAR THE SCREEN
LWEXIT1  LA    R1,LWDYNFRE
         DYNALLOC             FREE THE NEWS DATASET
         TM    LWSWITCH,LWSYSOUT  HAS A PRINT DATASET BEEN OPENED KHP10
         BNO   LWEXIT2            NO, BYPASS CLOSE/DEALLOC        KHP10
         CLOSE SYSUVNSP           CLOSE SYSOUT PRINT DATASET      KHP10
         LA    R1,LWPFRSYS        POINT TO DYNALLOC PARMLIST      KHP10
         DYNALLOC                 SPIN OFF THE PRINT DATASET      KHP10
         SPACE 1                                                  KHP10
LWEXIT2  DS    0H                                                 KHP10
         L     R1,TITABLE         ADDRESS OF TITLE TABLE          KHP10
         LTR   R1,R1              HAS TABLE SPACE BEEN GOTTEN     KHP10
         BZ    LWEXIT3            DON'T FREE IF DON'T HAVE        KHP10
         FREEMAIN R,LV=84000,A=(1),SP=120  FREE TITLE TABLE       KHP10
         SPACE 1                                                  KHP10
LWEXIT3  DS    0H                                                 KHP10
         L     R1,DETABLE         ADDRESS OF DETAIL TABLE         KHP10
         LTR   R1,R1              HAS TABLE SPACE BEEN GOTTEN     KHP10
         BZ    LWEXIT4            DON'T FREE IF DON'T HAVE        KHP10
         FREEMAIN R,LV=84000,A=(1),SP=121  FREE DETAIL TABLE      KHP10
LWEXIT4  DS    0H                                                 KHP10
         SPACE 1                                                  KHP10
         TSOLEAVE
         TITLE 'N E W S  --- LIST DETAILS FOR A REQUESTED SUMMARY'
***********************************************************************
*                                                                     *
*        DETAIL SECTION --- OPEN SYSNEWS AGAIN.                       *
*                                                                     *
***********************************************************************
*                                                                     *
LWGETDET BCTR  R5,0
         SLL   R5,2 MUTIPLY BY 4
         L     R4,LWLINEAD(R5) POINT TO LINE THE CURSOR WAS ON
         MVC   SAVER10(4),10(R4) SAVE LINEID FOR ERRORS
LWGETDT1 L     R1,=A(LWGETEND)
         ST    R1,SYSNEWS+32  SET EODAD TO THIS LOOP END
         NI    LWSWITCH,X'FF'-LWFOUND TURN SWITCH OFF
         OPEN  SYSNEWS
         SPACE 4
***********************************************************************
*                                                                     *
*        SEARCH FOR THE REQUESTED HEADER.                             *
*                                                                     *
***********************************************************************
*                                                                     *
LWGET2   GET   SYSNEWS,LWINAREA
         CLC   LWINAREA+4(6),=6C'×' IS IT A HEADER RECORD ?
         BNE   LWGET2
         CLC   LWINAREA+10(4),10(R4) IS IT THE ONE WE WANT
         BNE   LWGET2         NO, KEEP LOOKING
         SPACE 1
         OI    LWSWITCH,LWFOUND SET SWITCH
         MVC   LWHD2M(7),=CL7'Entry'     INDICATE PRINTING ENTRY  KHP11
         ST    R4,LWTEMP
         SPACE 1
         L     R3,DETABLE     GET DETAIL TABLE ADDRESS IF EXISTS  KHP10
         LTR   R3,R3          DO WE HAVE IT ALREADY?              KHP10
         BNZ   LWGET20        YES, BYPASS GETMAIN                 KHP10
         GETMAIN R,LV=84000,SP=121    BUFFER FOR DETAIL TABLE     KHP10
         ST    R1,DETABLE     AND SAVE THE TABLE ADDRESS          KHP10
         EJECT                                                    KHP10
***********************************************************************
*                                                                     *
*        BUILD DETAIL TABLE FROM DETAIL ENTRIES                   KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWGET20  L     R3,DETABLE     POINT TO BEGINNING OF DETAIL TABLE  KHP10
         LA    R4,1           INDICATE ONE ENTRY                  KHP10
         MVC   0(84,R3),LWINAREA   MOVE HEADER LINE TO TABLE      KHP10
         LA    R3,84(,R3)     AND POINT TO NEXT ENTRY             KHP10
         SPACE 1                                                  KHP10
LWGET21  GET   SYSNEWS,(R3)   GET NEXT DETAIL RECORD TO TABLE     KHP10
         CLC   4(6,R3),=6C'×' IS THIS THE NEXT HEADER?            KHP10
         BE    LWGETEND       YES, GO CLOSE AND SETUP DISPLAY     KHP10
         LA    R3,84(,R3)     POINT TO NEXT ENTRY                 KHP10
         LA    R4,1(,R4)      INCREMENT DETAIL LINE COUNT         KHP10
         CH    R4,=H'990'     HAVE WE EXHAUSTED TABLE AREA?       KHP10
         BNH   LWGET21        NO, READ NEXT DETAIL LINE           KHP10
*                             YES, FORCE END OF LINES             KHP10
         SPACE 4                                                  KHP10
***********************************************************************
*                                                                     *
*        NEXT HEADER, TABLE EXHAUSTED OR EOF ON SYSNEWS           KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWGETEND CLOSE SYSNEWS        CLOSE THE NEWS DATASET              KHP10
         STH   R4,DET#LINE    SAVE # DETAIL LINES IN TABLE        KHP10
         TM    LWSWITCH,LWFOUND    FIND ANY ENTRIES?              KHP10
         BNO   LWERR9              NO, ISSUE ERROR MESSAGE        KHP10
         EJECT
***********************************************************************
*                                                                     *
*        SET UP AND DISPLAY ONE OR MORE DETAIL SCREENS FROM LINES KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWDENTER L     R6,DETABLE     POINT TO DETAIL LINES TABLE AREA    KHP10
         MVC   DETENTR#(3),11(R6)   GET DETAIL ENTRY NUMBER       KHP10
         MVC   DETDATE(13),15(R6)   GET DETAIL ADD DATE/TIME      KHP10
         MVI   DETTITLE,C' '        CLEAR TITLE AREA              KHP10
         MVC   DETTITLE+1(L'DETTITLE-1),DETTITLE TO BLANKS        KHP10
         LH    R1,0(,R6)            GET LENGTH OF RECORD          KHP10
         SH    R1,=H'40'            SUBTRACT PREFIX LENGTH+1      KHP10
         MVC   DETTITLE(0),39(R6)   MOVE TITLE TO HEADER LINE     KHP10
         EX    R1,*-6               EXECUTE THE MOVE INSTRUCTION  KHP10
         LA    R6,84(,R6)     POINT TO FIRST DETAIL LINE PAST HDR KHP10
         LA    R5,1           SHOW COUNT = 1 FOR HEADER INFO      KHP10
         ST    R5,LWDLCNTR    SAVE BEGINNING COUNT AND LINE       KHP10
         ST    R6,LWDLPNTR    POINTER IN IN CASE PFK7 LATER       KHP10
         SPACE 1                                                  KHP10
LWDLOOP  LA    R0,LWDETOUT    CLEAR DETAIL SCREEN AREA TO BLANKS  KHP10
         LA    R1,L'LWDETOUT                                      KHP10
         SR    R14,R14                                            KHP10
         L     R15,=X'40000000'                                   KHP10
         MVCL  R0,R14                                             KHP10
         LA    R4,22          SET # LINES PER SCREEN              KHP10
         MVC   DETMORE,=6C' '       BLANK *MORE* FIELD IN HDRLINE KHP10
         LA    R3,LWDETOUT    POINT TO FIRST DETAIL LINE IN SCREENKHP10
         MVC   LWDXCNTR,LWDLCNTR SAVE PREVIOUS COUNT AND LINE     KHP10
         MVC   LWDXPNTR,LWDLPNTR IN CASE PFK7 CAUSES REDISPLAY    KHP10
         ST    R5,LWDLCNTR    HOLD CURRENT COUNT AND LINE POINTER KHP10
         ST    R6,LWDLPNTR    IN CASE PFK7 CAUSES REDISPLAY       KHP10
         SPACE 1
LWDLOOP1 LH    R1,0(,R6)      GET LENGTH OF LINE IN TABLE         KHP10
         SH    R1,=H'4'       DECREMENT BY LLZZ LENGTH
         CH    R1,=H'80'      IS IT LONGER THAN SCREEN LENGTH
         BNH   LWDMOVE        NO, O.K.
         LA    R1,80          YES, TRUNCATE IT
LWDMOVE  BCTR  R1,0           DECREMENT FOR MOVE
         MVC   0(0,R3),4(R6)  MOVE DETAIL LINE TO SCREEN AREA     KHP10
         EX    R1,*-6         MOVE IT TO OUTPUT SCREEN
         LA    R6,84(,R6)     BUMP TO NEXT TABLE ENTRY            KHP10
         LA    R3,80(R3)      BUMP TO NEXT LINE
         LA    R5,1(R5)       BUMP COUNTER
         CH    R5,DET#LINE    HAVE WE MOVED ALL                   KHP10
         BNL   LWPUTSCR       YES, GO PUT SCREEN                  KHP10
         BCT   R4,LWDLOOP1    AND GO GET NEXT LINE
         EJECT
***********************************************************************
*                                                                     *
*        EXHAUSTED SCREEN AND MORE DATA.  THIS IS MULTI-SCREEN    KHP10
*                                                                     *
***********************************************************************
*                                                                     *
         MVC   DETMORE,=C'*MORE*'      INDICATE MORE DATA TO COME KHP10
         BAL   R15,DETSCREN            GO DISPLAY SCREEN, AWAIT   KHP10
*                                      RESPONSE.  RETURN HERE IF  KHP10
*                                      TO DO ANOTHER SCREEN.      KHP10
         B     LWDLOOP                 RETURN TO LOOP IF RETURNED KHP10
         SPACE 4
***********************************************************************
*                                                                     *
*        LAST OR ONLY SCREEN.                                         *
*                                                                     *
***********************************************************************
*                                                                     *
LWPUTSCR BAL   R15,DETSCREN            GO DISPLAY SCREEN, AWAIT   KHP10
*                                      RESPONSE.  IF RETURN HERE, KHP10
         B     LWGETXIT                GO BACK TO SUMMARY         KHP10
         EJECT                                                    KHP10
***********************************************************************
*                                                                     *
*        SUBROUTINE TO DISPLAY A SCREEN, AWAIT RESPONSE FROM      KHP10
*        TERMINAL, ANALYZE RESPONSE AND TAKE ACTION.              KHP10
*                                                                     *
***********************************************************************
*                                                                     *
DETSCREN ST    R15,DETRETRN            SAVE RETURN ADDRESS        KHP10
         SPACE 1                                                  KHP10
         TPUT  LWDETHDR,DETLGH,FULLSCR                            KHP10
         SPACE 3                                                  KHP10
***********************************************************************
*                                                                     *
*        WAIT FOR AN ENTER KEY ---                                    *
*                                 *ENTER - RETURN TO CALLER           *
*                                  PA1   - TERMINATE                  *
*                                  PF1/13- GO DO HELP FOR DETAIL  KHP11
*                                  PF3/15- RETURN TO SUMMARY          *
*                                  PF4/16- PRINT ENTRY TO SYSOUT  KHP10
*                                          AND RETURN TO SUMMARY  KHP10
*                                  PF7/19- BACK UP ONE SCREEN IF  KHP10
*                                          POSSIBLE AND RETURN    KHP10
*                                 *PF8/20- RETURN TO CALLER       KHP10
*                                                                     *
*         * = DEFAULT ACTION WILL BE TO DO NEXT SCREEN IF W/IN    KHP10
*             ENTRY, OR TERMINATE IF END OF ENTRY.                KHP10
*                                                                     *
***********************************************************************
*                                                                     *
         XC    LWTGETIN,LWTGETIN
         TGET  LWTGETIN,20,ASIS
         TM    LWSWITCH,LWATTN  WAS AN ATTN HIT ?
         BO    LWEXIT           YES, GO QUIT
         LTR   R15,R15        WAS IT O.K.
         BNZ   LWERR8         NO, GO QUIT
         SPACE 1                                                  KHP10
         L     R15,=A(HELP5)  POINT TO DETAIL HELP PANEL          KHP11
         LA    R14,LWBACKUP   SET RETURN TO REDISPLAY CURRENT     KHP11
         CLI   LWTGETIN,C'1'  IS THIS PFK 1?                      KHP11
         BE    LHELP          YES, GO DISPLAY HELP                KHP11
         CLI   LWTGETIN,C'A'  IS THIS PFK 13?                     KHP11
         BE    LHELP          YES, GO DISPLAY HELP                KHP11
         SPACE 1                                                  KHP11
         CLI   LWTGETIN,C'3'  PFK  3 ENTERED ?
         BE    LWGETXIT       YES, RETURN TO SUMMARY              KHP10
         CLI   LWTGETIN,C'C'  PFK 15 ENTERED ?
         BE    LWGETXIT       YES, RETURN TO SUMMARY              KHP10
         SPACE 1                                                  KHP10
         CLI   LWTGETIN,C'4'  PFK  4 ENTERED ?                    KHP10
         BE    LWPRINT        YES, GO TO PRINT TO SYSOUT          KHP10
         CLI   LWTGETIN,C'D'  PFK 16 ENTERED ?                    KHP10
         BE    LWPRINT        YES, GO TO PRINT TO SYSOUT          KHP10
         SPACE 1
         CLI   LWTGETIN,C'7'  PFK  7 ENTERED ?                    KHP10
         BE    LWBACKUP       YES, BACK UP SCREEN IF POSSIBLE     KHP10
         CLI   LWTGETIN,C'G'  PFK 19 ENTERED ?                    KHP10
         BE    LWBACKUP       YES, BACK UP SCREEN IF POSSIBLE     KHP10
         SPACE 1
*        PFK 8/20 FUNCTION IS TO GO TO NEXT SCREEN, SAME AS       KHP10
*        DEFAULT ENTER.  SO NO CODE NECESSARY TO IMPLEMENT.       KHP10
         SPACE 1
         L     R15,DETRETRN   RESTORE RETURN ADDRESS              KHP10
         BR    R15            RETURN TO CALLINE POINT             KHP10
         SPACE 3
***********************************************************************
*                                                                     *
*        PFK 7/19 - BACK UP SCREEN IF POSSIBLE OR START OVER      KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWBACKUP L     R5,LWDXCNTR    RESTORE LAST FRAME START COUNTER    KHP10
         L     R6,LWDXPNTR    RESTORE LAST FRAME START LINE       KHP10
         ST    R5,LWDLCNTR    ENFORCE PREVIOUS FRAME ALWAYS       KHP10
         ST    R6,LWDLPNTR    UNLESS RECURSE ON FIRST FRAME       KHP10
         B     LWDLOOP        RETURN TO DISPLAY LAST PAGE         KHP10
         TITLE 'N E W S  --- PRINT REQUESTED SUMMARY OR DETAILS'  KHP11
***********************************************************************
*                                                                     *
*        IF PFK4 OR PFK16, COPY THE ENTIRE ENTRY TO SYSOUT.       KHP10
*        SETUP AND OPEN A DATASET UNLESS ALREADY DONE             KHP10
*                                                                     *
***********************************************************************
*                                                                     *
         PRINT NOGEN
LWPRINTS NI    LWSWITCH,X'FF'-LWFOUND PRINTING SUMMARY: DET OFF   KHP11
         SPACE 1                                                  KHP11
LWPRINT  TM    LWSWITCH,LWSYSOUT   DO WE HAVE A DATASET ALREADY?  KHP10
         BO    LWPRINT1            YES, SKIP ALLOC/OPEN           KHP10
         SPACE 1                                                  KHP10
         LA    R1,LWDYNSYS    YES, DYN ALLOC A SYSOUT DATA SET
         DYNALLOC
         LTR   R15,R15        ALLOC O.K. ?
         BNZ   LWERR2
         MVC   LWPFRDDN(8),LWSYSDDN  YES, SAVE DDNAME FOR FREE
         MVC   SYSUVNSP+40(8),LWSYSDDN  AND SET UP DCB
         OPEN  (SYSUVNSP,(OUTPUT))
         TM    SYSUVNSP+48,X'10'  OPEN O.K.
         BNO   LWERR3
         OI    LWSWITCH,LWSYSOUT     INDICATE SYSOUT DATASET      KHP10
         SPACE 2
***********************************************************************
*                                                                     *
*        SKIP TO NEW PAGE, PRINT HEADER LINES                     KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWPRINT1 MVI   LWINAREA,C' '                                      KHP10
         MVC   LWINAREA+1(80),LWINAREA                            KHP10
         LA    R1,L'LWHD1              PUT OUT STANDARD           KHP10
         LA    R15,LWHD1               HEADER LINES               KHP10
         BCTR  R1,0
         MVC   LWINAREA+1(0),0(R15)                               KHP10
         EX    R1,*-6
         MVI   LWINAREA,C'1'            SKIP TO NEW PAGE          KHP10
         MVC   LWINAREA+48(14),LWIDENT  PUT IN DATASET ID         KHP10
         MVC   LWINAREA+63(8),DATE      PUT IN CURRENT DATE       KHP10
         MVC   LWINAREA+72(8),TIME      PUT IN CURRENT TIME       KHP10
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE FOR PRT  KHP11
         PUT   SYSUVNSP,LWINAREA
         MVI   LWINAREA,C' '            RESET TO SPACE 1          KHP10
         MVC   LWINAREA+1(80),LWINAREA                            KHP10
         LA    R1,L'LWHD2
         LA    R15,LWHD2
         BCTR  R1,0
         MVC   LWINAREA+1(0),0(R15)                               KHP10
         EX    R1,*-6
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE FOR PRT  khp11
         PUT   SYSUVNSP,LWINAREA
         LA    R1,L'LWHD3+L'LWHD3A                                KHP10
         LA    R15,LWHD3
         BCTR  R1,0
         MVC   LWINAREA+1(0),0(R15)                               KHP10
         EX    R1,*-6
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE FOR PRT  KHP11
         PUT   SYSUVNSP,LWINAREA
         MVI   LWINAREA,C' '                CLEAR LWINAREA        KHP10
         MVC   LWINAREA+1(80),LWINAREA
         SPACE 3
***********************************************************************
*                                                                     *
*        IF THIS IS HARDCOPY FOR SUMMARY, DO IT                   KHP11
*                                                                     *
***********************************************************************
*
         TM    LWSWITCH,LWFOUND     IS THIS A DETAIL PRINT?       KHP11
         BO    LWPUTDET             YES, GO TO DETAIL LOGIC       KHP11
         SPACE 1                                                  KHP11
         L     R4,LWTOPPTR    POINT AT TOP SUMMARY LINE           KHP11
         MVI   LWINAREA,C'0'   SKIP FOR FIRST SUMMARY LINE        KHP11
         MVI   LWINAREA+1,C' '   AND BLANK OUT REST OF PRINT      KHP11
         MVC   LWINAREA+2(79),LWINAREA+1  AREA BEFORE MOVE        KHP11
         SPACE 1                                                  KHP11
LWPUTSUM LH    R1,4(R4)                                           KHP11
         SH    R1,=H'11'     SET LENGTH                           KHP11
         CLI   36(R4),C'*'    IS THIS A SUPERCEDED ENTRY?         KHP11
         BNE   LWPUTPUT       NO, ALWAYS PRINT IT                 KHP11
         TM    LWSWITCH,LWALL ARE WE DOING ALL ENTRIES?           KHP11
         BNO   LWPUTNOT       IF NOT, SKIP; IF SO, PRINT          KHP11
LWPUTPUT MVC   LWINAREA+1(0),10(R4)  MOVE SUMMARY LINE TO PRINT   KHP11
         EX    R1,*-6                MOVE THE LINE                KHP11
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE          KHP11
         PUT   SYSUVNSP,LWINAREA     PRINT SUMMARY LINE           KHP11
         MVI   LWINAREA,C' '   RE-BLANK OUT PRINT AREA            KHP11
         MVC   LWINAREA+1(80),LWINAREA                            KHP11
         SPACE 1                                                  KHP11
LWPUTNOT L     R4,0(R4)       NO POINT AT LAST ENTRY              KHP11
         LTR   R4,R4          IS IT THE END                       KHP11
         BNZ   LWPUTSUM       NO, KEEP LOOKING                    KHP11
         MVC   LWHD3A(26),=CL26' Current Headers Printed '        KHP11
         TM    LWSWITCH,LWALL DOING ALL?                          KHP11
         BNO   LWSETPG        NO, SKIP CHANGE OF MESSAGE          KHP11
         MVC   LWHD3A(26),=CL26' All Headers Printed'             KHP11
         B     LWSETPG        AND GO TO REDISPLAY LINE            KHP11
         EJECT
***********************************************************************
*                                                                     *
*        PRINT OF DETAIL RECORDS FOR A HEADER.                    KHP10
*        NOW PRINT HEADER LINE, SET TO SKIP AFTER IT              KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWPUTDET L     R6,DETABLE     POINT AT HEADER LINE IN TABLE       KHP10
         LH    R1,0(,R6)      GET LENGTH OF HEADER                KHP10
         SH    R1,=H'11'                                          KHP10
         MVC   LWINAREA+1(0),10(R6)   MOVE HEADER LINE TO PRINT   KHP10
         EX    R1,*-6         EXECUTED MOVE INSTRUCTION           KHP10
         MVI   LWINAREA,C'0'  SKIP ONE BEFORE PRINT HEADER        KHP10
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE FOR PRT  KHP10
         PUT   SYSUVNSP,LWINAREA   PRINT HEADER LINE              KHP10
         MVI   LWINAREA,C' '       CLEAR LWINAREA                 KHP10
         MVC   LWINAREA+1(80),LWINAREA                            KHP10
         MVI   LWINAREA,C'-'  FIRST DETAIL LINE SKIPS 2           KHP10
         LH    R4,DET#LINE    GET # LINES FOR DETAIL              KHP10
         B     LWPUTJMP       GO INTO DETAIL PUT LOOP             KHP10
         SPACE 2
***********************************************************************
*                                                                     *
*        NOW PRINT ALL DETAIL LINES IN ENTRY                      KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWPUTLOP LH    R1,0(,R6)      GET LENGTH OF LINE IN TABLE         KHP10
         SH    R1,=H'4'       DECREMENT BY LLZZ LENGTH            KHP10
         CH    R1,=H'80'      IS IT LONGER THAN SCREEN LENGTH     KHP10
         BNH   LWPUTMOV       NO, O.K.                            KHP10
         LA    R1,80          YES, TRUNCATE IT                    KHP10
LWPUTMOV BCTR  R1,0           DECREMENT FOR MOVE                  KHP10
         MVC   LWINAREA+1(0),4(R6) DETAIL LINE TO PRINT AREA      KHP10
         EX    R1,*-6         MOVE IT TO PRINT BUFFER             KHP10
         OC    LWINAREA+1(80),=80X'40' ENSURE UPPER CASE FOR PRT  KHP11
         PUT   SYSUVNSP,LWINAREA   PRINT THE LINE                 KHP10
         MVI   LWINAREA,C' '       CLEAR LWINAREA                 KHP10
         MVC   LWINAREA+1(80),LWINAREA
LWPUTJMP LA    R6,84(,R6)     BUMP TO NEXT TABLE ENTRY            KHP10
         BCT   R4,LWPUTLOP    AND GO TO GET LINE AND PRINT        KHP10
         MVC   LWHD3A(26),=CL26' ** Item XXXX Printed **  '       KHP10
         MVC   LWHD3A+9(4),SAVER10    PUT IN ITEM NUMBER          KHP10
         SPACE 2
***********************************************************************
*                                                                     *
*        DONE WITH DETAIL OR PRINT; RETURN TO SUMMARY             KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWGETXIT L     R4,LWDETPTR
         B     LWLOOP1
         TITLE 'N E W S -- PUT SUMMARY/DETAILS TO ASCII DEVICE'   KHP11
***********************************************************************
*                                                                     *
*        PRINT SUMMARY INFO TO AN ASCII DEVICE.                   KHP10
*                                                                     *
***********************************************************************
*                                                                     *
LWPRSUM  MVI   LWINAREA,C' '              CLEAR ASSEMBLY          KHP11
         MVC   LWINAREA+1(80),LWINAREA    AREA FOR HEADER 1       KHP11
         LA    R1,L'LWHD1                 MOVE FIXED              KHP11
         BCTR  R1,0                       TEXT TO                 KHP11
         MVC   LWINAREA(0),LWHD1          ASSEMBLY                KHP11
         EX    R1,*-6                     AREA                    KHP11
         MVC   LWINAREA+47(14),LWIDENT    SET NEWS ID             KHP11
         MVC   LWINAREA+62(8),DATE            DATE                KHP11
         MVC   LWINAREA+71(8),TIME            TIME                KHP11
         TPUT  LWINAREA,80                PUT ASSEMBLED HEADER 1  KHP11
         TPUT  LWHD2,L'LWHD2              PUT HEADER 2            KHP11
         TPUT  LWHD3,L'LWHD3+L'LWHD3A     PUT HEADER 3 INCL. MODE KHP10
         SPACE 1                                                  KHP11
LWPRSLP  LH    R0,4(R4)
         SH    R0,=H'10'     SET LENGTH
         LA    R1,10(R4)      POINT AT SUMMARY DATA LINE
         CLI   36(R4),C'*'    IS THIS A SUPERCEDED ENTRY?         KHP11
         BNE   LWPRTPUT       NO, ALWAYS PRINT IT                 KHP11
         TM    LWSWITCH,LWALL ARE WE DOING ALL ENTRIES?           KHP11
         BNO   LWPRNOTP       IF NOT, SKIP; IF SO, PRINT          KHP11
LWPRTPUT TPUT  (R1),(R0)                                          KHP11
LWPRNOTP TM    LWSWITCH,LWEND WAS THIS THE LAST TIME THROUGH ?    KHP11
         BO    LWEXIT         YES, QUIT
         L     R4,0(R4)       NO POINT AT LAST ENTRY
         LTR   R4,R4          IS IT THE END
         BNZ   LWPRSLP        NO, KEEP LOOKING
         OI    LWSWITCH,LWEND  YES, SIGNAL END
         B     LWPRSLP
         EJECT
***********************************************************************
*                                                                     *
*        A MESSAGE NUMBER WAS ENTERED, SO PRINT DETAIL FOR IT ONLY.   *
*                                                                     *
***********************************************************************
*                                                                     *
LWPRDET  ST    R10,SAVER10
         BAL   R10,LWSCRCLR   GET DATA LENGTH
         L     R10,SAVER10
         LH    R1,12(R10)     GET DATA LENGTH
         SR    R7,R7
         L     R15,8(R10)     POINT AT DATA
LWPRLOP  IC    R7,0(R15)      GET A BYTE OF DATA
         SH    R1,=H'1'
         BZ    LWPRLE         END OF DATA, BRANCH
         LA    R15,1(R15)     NO, BUMP TO NEXT BYTE
         SLL   R7,8           AN MOVE REG
         B     LWPRLOP
LWPRLE   O     R7,=X'F0F0F0F0'  MAKE ALL NUMERIC
         L     R1,=A(LWPRDEND)
         ST    R1,SYSNEWS+32  SET EODAD TO THIS LOOP END
         NI    LWSWITCH,X'FF'-LWFOUND TURN SWITCH OFF
         OPEN  SYSNEWS
LWGET4   GET   SYSNEWS,LWINAREA
         CLC   LWINAREA+4(6),=6C'×' IS IT A HEADER RECORD ?
         BNE   LWGET4
         OC    LWINAREA+10(4),=X'F0F0F0F0'  MAKE NUMERIC
         ST    R7,LWTEMP
         CLC   LWTEMP(4),LWINAREA+10 IS THIS THE RIGHT MESSAGE
         BNE   LWGET4         NO, KEEP LOOKING
         OI    LWSWITCH,LWFOUND  YES, SIGNAL FOUND
         EJECT                                                    KHP11
***********************************************************************
*                                                                     *
*        FOUND DETAIL ITEM; PRINT IT OUT                          KHP11
*                                                                     *
***********************************************************************
*                                                                     *
         MVC   LWHD2M(7),=CL7'Entry'     INDICATE PRINTING ENTRY  KHP11
         MVI   LWDETOUT,C' '              CLEAR ASSEMBLY          KHP11
         MVC   LWDETOUT+1(80),LWDETOUT    AREA FOR HEADER 1       KHP11
         LA    R1,L'LWHD1                 MOVE FIXED              KHP11
         BCTR  R1,0                       TEXT TO                 KHP11
         MVC   LWDETOUT(0),LWHD1          ASSEMBLY                KHP11
         EX    R1,*-6                     AREA                    KHP11
         MVC   LWDETOUT+47(14),LWIDENT    SET NEWS ID             KHP11
         MVC   LWDETOUT+62(8),DATE            DATE                KHP11
         MVC   LWDETOUT+71(8),TIME            TIME                KHP11
         TPUT  LWDETOUT,80                PUT ASSEMBLED HEADER 1  KHP11
         TPUT  LWHD2,L'LWHD2              PUT HEADER 2            KHP11
         TPUT  LWHD3,L'LWHD3+L'LWHD3A     PUT HEADER 3 INCL. MODE KHP11
         TPUT  BLANKSS,2               AXC-CBT                    KHP11
         LH    R0,LWINAREA       NOW GET LENGTH OF HEADER         KHP11
         SH    R0,=H'10'         DECREMENT BY LL HEADER           KHP11
         TPUT  LWINAREA+10,(R0)  PUT HEADER                       KHP11
         TPUT  BLANKSS,2                AXC-CBT                   KHP11
         SPACE 1                                                  KHP11
LWGET5   GET   SYSNEWS,LWINAREA
         CLC   LWINAREA+4(6),=6C'×'  IS IT A HEADER ?
         BE    LWPRDEND       YES, WE'RE DONE
         LH    R0,LWINAREA
         SH    R0,=H'4'       NO, PRINT ANOTHER DETAIL
         TPUT  LWINAREA+4,(R0)
         B     LWGET5         AND KEEP LOOPING
         SPACE 1                                                  KHP11
LWPRDEND CLOSE  SYSNEWS
         TM    LWSWITCH,LWFOUND  DID WE GET A HIT ?
         BO    LWEXIT1           YES, EXIT NORMALLY               KHP11
         SPACE 1                                                  KHP11
         MVC   LWINAREA(26),=CL26' ** Item XXXX Not Found **'     KHP11
         STCM  R7,15,LWINAREA+9  SET BAD ITEM NUMBER IN MESSAGE   KHP11
         TPUT  LWINAREA,26       PUT MESSAGE OUT                  KHP11
         B     LWEXIT1           AND EXIT FROM ROUTINE            KHP11
         PRINT GEN
         TITLE 'N E W S  --- ISSUE ERROR MESSAGES AND QUIT'
***********************************************************************
*                                                                     *
*        ISSUE ERROR MESSAGES.                                        *
*                                                                     *
***********************************************************************
*                                                                     *
         PRINT NOGEN
LWERR1   BAL   R10,LWSCRCLR
         TPUT  LWMSG1,L'LWMSG1
         B     LWEXIT1
LWERR2   BAL   R10,LWSCRCLR
         TPUT  LWMSG2,L'LWMSG2
         B     LWEXIT1
LWERR3   BAL   R10,LWSCRCLR
         TPUT  LWMSG3,L'LWMSG3
         B     LWEXIT1
LWERR4   BAL   R10,LWSCRCLR
         TPUT  LWMSG4,L'LWMSG4
         B     LWEXIT1
LWERR5   BAL   R10,LWSCRCLR
         TPUT  LWMSG5,L'LWMSG5
         B     LWEXIT1
LWERR6   BAL   R10,LWSCRCLR
         TPUT  LWMSG6,L'LWMSG6
         B     LWEXIT1
LWERR7   BAL   R10,LWSCRCLR
         TPUT  LWMSG7,L'LWMSG7
         B     LWEXIT1
LWERR8   BAL   R10,LWSCRCLR
         TPUT  LWMSG8,L'LWMSG8
         B     LWEXIT1
LWERR9   MVC   LWHD3A(26),=CL26' ** Item XXXX Not Found **'
         MVC   LWHD3A+9(4),SAVER10
         B     LWGETXIT
         TITLE 'N E W S  ---  ATTENTION EXIT AND CLR SCREEN SUBRTN'
***********************************************************************
*                                                                     *
*        ATTN WAS ENTERED, CLEAR SCREEN AND QUIT.                     *
*                                                                     *
***********************************************************************
*                                                                     *
         DROP  R11,R12
         USING *,R15
LWATTNRT LM    R11,R12,SAVER11
         OI    LWSWITCH,LWATTN SET ATTN SWITCH
         BR    R14
         DROP  R15
         USING UVNS,R12
         USING UVNS+4096,R11
         SPACE 4
***********************************************************************
*                                                                     *
*        SUBROUTINE TO CLEAR THE SCREEN.                              *
*                                                                     *
***********************************************************************
*                                                                     *
LWSCRCLR GTSIZE
         LTR   R0,R0          GRAPHIC TERMINAL ?
         BZ    LWCLRXIT       NO, SKIP CLEAR
         TPUT  LWSUMSCN,LWCLEAR,FULLSCR  CLEAR THE SCREEN
LWCLRXIT BR    R10
         TITLE 'N E W S  ---  FULLSCREEN HELP/TUTORIAL SUPPORT'   KHP11
***********************************************************************
*                                                                     *
*        ENTERED WITH R15 POINTING TO FIRST PANEL TO BE DISPLAYED KHP11
*        AND R14 POINT TO RETURN ADDRESS.                         KHP11
*                                                                     *
***********************************************************************
*                                                                     *
LHELP    STM   R14,R15,HELPSAVE   SAVE REGISTERS FOR DURATION     KHP11
         ST    R10,SAVER10        SAVE R10 FOR POINTER USE        KHP11
         LR    R10,R15            GET ADDRESS OF FIRST PANEL      KHP11
         SPACE 1                                                  KHP11
         GTSIZE ,                                                 KHP11
         LTR   R0,R0              IF THIS IS NOT FULLSCREEN       KHP11
         BNZ   LHELP1             TELL THEM TO DO "HELP NEWS"     KHP11
         TPUT  LWMSG10,L'LWMSG10  AND QUIT                        KHP11
         B     LWEXIT1                                            KHP11
         SPACE 2                                                  KHP11
***********************************************************************
*                                                                     *
*        DISPLAY FIRST PANEL REQUESTED, AWAIT RESPONSE FROM       KHP11
*        TERMINAL, ANALYZE RESPONSE AND TAKE ACTION.              KHP11
*                                                                     *
***********************************************************************
*                                                                     *
LHELP1   TPUT  (R10),HELPLEN,FULLSCR DISPLAY A HELP PANEL         KHP11
         EJECT                                                    KHP11
***********************************************************************
*                                                                     *
*        WAIT FOR AN ENTER KEY ---                                    *
*                                 *ENTER - REDISPLAY CURENT PANEL KHP11
*                                  PA1   - TERMINATE                  *
*                                  PF3/15- RETURN TO CALLER       KHP11
*                                  PF7/19- BACK UP ONE PANEL IF   KHP11
*                                          POSSIBLE AND DISPLAY   KHP11
*                                  PF8/20- GO FORWARD ONE PANEL   KHP11
*                                          POSSIBLE AND DISPLAY   KHP11
*                                                                     *
*        *DEFAULT ACTION WILL BE TO REDISPLAY CURRENT PANEL       KHP11
*                                                                     *
***********************************************************************
*                                                                     *
         XC    LWTGETIN,LWTGETIN  CLEAR RETURN AREA               KHP11
         TGET  LWTGETIN,20,ASIS   WAIT FOR RESPONSE               KHP11
         SPACE 1                                                  KHP11
         TM    LWSWITCH,LWATTN    WAS AN ATTN HIT?                KHP11
         BO    LWEXIT             YES, QUIT                       KHP11
         SPACE 1                                                  KHP11
         LTR   R15,R15                                            KHP11
         BNZ   LWERR8         NO, GO QUIT                         KHP11
         SPACE 1                                                  KHP11
         CLI   LWTGETIN,C'3'  PFK  3 ENTERED ?                    KHP11
         BE    LHELPEND       YES, BACK TO CALLER                 KHP11
         CLI   LWTGETIN,C'C'  PFK 15 ENTERED ?                    KHP11
         BE    LHELPEND       YES, BACK TO CALLER                 KHP11
         SPACE 1                                                  KHP11
         CLI   LWTGETIN,C'7'  PFK  7 ENTERED ?                    KHP11
         BE    LHELPB1        YES, BACK UP SCREEN IF POSSIBLE     KHP11
         CLI   LWTGETIN,C'G'  PFK 19 ENTERED ?                    KHP11
         BE    LHELPB1        YES, BACK UP SCREEN IF POSSIBLE     KHP11
         SPACE 1                                                  KHP11
         CLI   LWTGETIN,C'8'  PFK  8 ENTERED ?                    KHP11
         BE    LHELPF1        YES, FORWARD SCREEN IF POSSIBLE     KHP11
         CLI   LWTGETIN,C'H'  PFK 20 ENTERED ?                    KHP11
         BE    LHELPF1        YES, BACK UP SCREEN IF POSSIBLE     KHP11
         SPACE 1                                                  KHP11
         B     LHELP1         GO REDISPLAY CURRENT PANEL          KHP11
         EJECT                                                    KHP11
***********************************************************************
*                                                                     *
*        BACK UP OR FORWARD PANEL IF POSSIBLE                     KHP11
*                                                                     *
***********************************************************************
*                                                                     *
LHELPB1  C     R10,=A(HELPFRST)   IS THIS BEFORE FIRST HELP       KHP11
         BNH   LHELP1             YES, CANNOT BACK UP             KHP11
         S     R10,=A(HELPLEN)    POSITION TO PREVIOUS PANEL      KHP11
         B     LHELP1             AND DISPLAY IT                  KHP11
         SPACE 1                                                  KHP11
LHELPF1  C     R10,=A(HELPLAST)   IS THIS LAST HELP PANEL         KHP11
         BNL   LHELP1             YES, CANNOT GO FORWARD          KHP11
         A     R10,=A(HELPLEN)    POSITION TO NEXT PANEL          KHP11
         B     LHELP1             AND DISPLAY IT                  KHP11
         SPACE 2                                                  KHP11
***********************************************************************
*                                                                     *
*        EXIT FROM HELP                                           KHP11
*                                                                     *
***********************************************************************
*                                                                     *
LHELPEND LM    R14,R15,HELPSAVE   RESTORE REGISTERS               KHP11
         L     R10,SAVER10        RESTORE R10                     KHP11
         BR    R14                BACK TO THE CALLER              KHP11
         TITLE 'N E W S  --- CONSTANTS AND STORAGE AREAS'
PACK     DS    D
SAVER11  DS    D
SAVER10  DS    F
HELPSAVE DS    2F
LWLINEAD DS    20F            ADDRESS OF TITLE LINE
LWCURPTR DS    F              CURRENT NEXT POINTER
LWTOPPTR DS    F
LWDETPTR DS    F
LWTITTAB DS    F
LWNUMTIT DS    F             NUMBER CURRENT HEADERS               KHP10
LWTOTTIT DS    F             TOTAL NUMBER HEADERS                 KHP10
LWDLCNTR DS    F      LAST   DETAIL FRAME-BEGIN COUNT FOR PFK7    KHP10
LWDLPNTR DS    F      LAST   DETAIL FRAME-BEGIN LINE FOR PFK7     KHP10
LWDXCNTR DS    F      LAST-1 DETAIL FRAME-BEGIN COUNT FOR PFK7    KHP10
LWDXPNTR DS    F      LAST-1 DETAIL FRAME-BEGIN LINE FOR PFK7     KHP10
LWPTRLST DS    F
LWPUT1SZ DS    F
LWTEMP   DS    F
REMDATE  DS    0CL6          REMOVE DATE AS YYMMDD                KHP10
REMYEAR  DS    CL2                          YY                    KHP10
REMONTH  DS    CL2                            MM                  KHP10
REMDAY   DS    CL2                              DD                KHP10
TODAY    DS    0CL6          TODAY'S DATE AS YYMMDD               KHP10
TODYEAR  DS    CL2                           YY                   KHP10
TODMONTH DS    CL2                             MM                 KHP10
TODDAY   DS    CL2                               DD               KHP10
DATE     DS    CL8                                                KHP10
TIME     DS    CL8                                                KHP10
DETRETRN DS    A              RETURN ADDRESS FOR DETSCREN SUBR.   KHP10
DETABLE  DC    A(0)           84K TABLE OF CURRENT DETAIL LINES   KHP10
TITABLE  DC    A(0)           84K TABLE OF SUMMARY HEADER LINES   KHP10
DET#LINE DS    H'0'           # ENTRIES IN DETABLE                KHP10
LWCURLIN DS    H
LWSPAGES DS    H
LWSPAGEC DS    H              CURRENT PAGE NUMBER
LWSWITCH DC    X'00'
LWFOUND  EQU   X'01'
LWEND    EQU   X'02'
LWATTN   EQU   X'04'
LWSYSOUT EQU   X'08'       WE HAVE AN OPEN SYSOUT DATASET         KHP10
LWALL    EQU   X'10'       PRINTING ALL HEADERS                   KHP10
LWTGETIN DS    XL80
         DS    0H
LWINAREA DS    XL255
LWMSG1   DC    C'PARSE ISSUED A BAD RETURN CODE'
LWMSG2   DC    C'DYNAMIC ALLOCATION FAILED'
LWMSG3   DC    C'OPEN FAILED'
LWMSG4   DC    C'MORE THAN 1000 ENTRIES ARE IN THE NEWS DATA SET' KHP11
LWMSG5   DC    C'THE NEWS DATA SET IS EMPTY'
LWMSG6   DC    C'TPUT --- BAD RETURN CODE (SUMMARY)'
LWMSG7   DC    C'TGET --- BAD RETURN CODE (SUMMARY)'
LWMSG8   DC    C'TGET --- BAD RETURN CODE (DETAIL)'
LWMSG9   DC    C'THE REQUESTED MESSAGE NUMBER WAS NOT FOUND'
LWMSG10  DC    C'ISSUE "HELP NEWS" FROM READY FOR INFORMATION ABOUT USE*
                WITH ASCII TERMINALS'                             KHP11
LWSUMSCN DC    X'C11140403C5D7F00114040' CLEAR SCREEN (REPEAT TO END)
         DC    X'1D40'        SF   UNPROT,LOW
         DC    X'13'          IC
LWCLEAR  EQU   *-LWSUMSCN
LWSUMMSG DC    XL52'00'
         DC    X'1DE8'        SF   PROT HI
         DC    CL3' '             *PADDING ADDED FOR PAGE REMOVE* KHP10
LWIDENT  DC    C'ID: '                                            KHP10
LWID     DC    CL9' '
         DC    CL4' '             *PADDING ADDED FOR PAGE REMOVE* KHP10
LWMORE   DC    CL6' '             *REPLACE PAGE #S WITH '*MORE*'* KHP10
*        DC    C'PAGE '                                           KHP10
*WSUMCP  DC    C'XX OF '                                          KHP10
*WSUMTP  DC    C'XX'                                              KHP10
         DC    X'11C150'      SBA 2-1
LWHD1    DC    C'News    Add    Add  Expire'
         DC    X'11C260'      SBA 3-1
LWHD2    DC    C'Item   Date   Time   Date    Title of News Item       *
                Mode:  xxxxxxx'
         ORG   *-7
LWHD2M   DC    CL7'Current'
         DC    X'11C3F0'      SBA 4-1
LWHD3    DC    C'---- ------- ----- -------   ------------------------'
LWHD3A   DC    C'--------------------------'
LWSUMSZ  EQU   *-LWSUMSCN
LWTITLIN DS    20XL80
         DC    256X'00'      AREA TO ALLOW OVERFLOW OF LAST LINE
LWADDTBL DC    X'C540C650C760C8F04A404B504C604DF04F405050'
         DC    X'D160D2F0D440D550D660D7F0D9405A505B605CF0'
         EJECT
SYSNEWS  DCB   DDNAME=SYSNEWS,DSORG=PS,MACRF=(GM),EODAD=LWEOF1
SYSUVNSP DCB   DDNAME=SYSUVNSP,DSORG=PS,MACRF=(PM),LRECL=81,      KHP10*
               BLKSIZE=81,RECFM=FBA                               KHP10
*
LWDYNTST DS    0F
LWDYNSYS DC    X'80',AL3(LWSYSRB)
LWSYSRB  DC    X'1401',3H'0'
         DC    A(LWSYSUPS),2A(0)
LWSYSUPS DC    A(LWSYSSYS),X'80',AL3(LWSYSRDD)
LWSYSSYS DC    X'001800010001C1' REQUEST SYSOUT, SYSOUT=A         KHP10
*WSYSSYS DC    X'00180000'       REQUEST SYSOUT, SYS DEFAULT CLASS
LWSYSRDD DC    X'005500010008'  AND RETURN DDNAME TO LWSYSDDN
LWSYSDDN DC    CL8' '
LWDYNPRD DS    0F
LWPRDRBP DC    X'80',AL3(LWPRDRB)
LWPRDRB  DC    X'1401',3H'0'
         DC    A(LWPRDUPS),2A(0)
LWPRDUPS DC    A(LWPRDDPT),A(LWPRDDSP),X'80',AL3(LWRETLST)
LWPRDDPT DC    H'2',H'1'
LWPRDLDN DC    H'0'
LWPRDDSN DC   CL44'MVS'
LWPRDDSP DC    H'4',H'1',H'1',X'08'
*                                                                     *
LWRETLST DC    X'005500010008'
LWRETDDN DC    CL8' '
*                                                                     *
LWDYNFRE DS    0F
         DC    X'80',AL3(LWFRERB)
LWFRERB  DC    X'1402',3H'0'   FREE BY DDNAME
         DC    A(LWFREUPS),2A(0)
LWFREUPS DC    X'80',AL3(LWFRELST)
LWFRELST DC    H'1',H'1',H'8'
LWFREDDN DC    CL8' '
LWPFRSYS DS    0F
         DC    X'80',AL3(LWPFRRB)
LWPFRRB  DC    X'1402',3H'0'   FREE BY DDNAME
         DC    A(LWPFRUPS),2A(0)
LWPFRUPS DC    X'80',AL3(LWPFRLST)
LWPFRLST DC    H'1',H'1',H'8'
LWPFRDDN DC    CL8' '
         EJECT
         LTORG *
         EJECT                                                    KHP11
BLANKSS  DC    CL5' '
LWDETHDR DC    X'C11140403C5D7F001140401DE813'
         DC    C' Item: '                                         KHP10
DETENTR# DC    CL5' '          ENTRY #                            KHP10
DETTITLE DC    CL46' '         TITLE                              KHP10
DETDATE  DC    CL15' '         DATE/TIME OF ENTRY                 KHP10
DETMORE  DC    CL6' '          *MORE* IF NOT LAST PAGE            KHP10
         DC    CL80' '            A BLANK LINE                    KHP11
LWDETOUT DS    CL(22*80)       THE DETAIL AREA                    KHP10
DETLGH   EQU   *-LWDETHDR                                         KHP11
         TITLE 'N E W S -- H E L P   S C R E E N S'               KHP11
HELPFRST EQU   *                                                  KHP11
HELP1    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                               The NEWS '        KHP11
         DC    C'Facility                  HELP Panel  1 '        KHP11
         DC    C'                              General In'        KHP11
         DC    C'formation                               '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The NEWS command is used to display inf'        KHP11
         DC    C'ormational news items which are kept in '        KHP11
         DC    C' the system news dataset.  Optionally,  '        KHP11
         DC    C'other news datasets may be displayed if '        KHP11
         DC    C' they exist.                            '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' Each news item consists of a summary li'        KHP11
         DC    C'ne containing a unique item number, the '        KHP11
         DC    C' date and time when that item was added '        KHP11
         DC    C'to the news dataset, and a "retirement" '        KHP11
         DC    C' date after which the item has expired. '        KHP11
         DC    C'    Each news item has a detailed entry '        KHP11
         DC    C' associated with it.     The NEWS comman'        KHP11
         DC    C'd allows the user to browse through the '        KHP11
         DC    C' summary index list (displaying either a'        KHP11
         DC    C'll entries or only current  non-expired '        KHP11
         DC    C' entries) and selectively displaying the'        KHP11
         DC    C' detailed information about any of  the '        KHP11
         DC    C' items.  The Summary Index or any detail'        KHP11
         DC    C'ed entries may be printed.              '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The remaining help panels discuss:     '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The SUMMARY Panel:           The DETAIL'        KHP11
         DC    C' Panel:          Miscellaneous Panels:  '        KHP11
         DC    C' (2) General Information      (5) Genera'        KHP11
         DC    C'l Information    (7) The PRINT Facility '        KHP11
         DC    C' (3) Display Options          (6) Displa'        KHP11
         DC    C'y Options        (8) Building your own  '        KHP11
         DC    C' (4) Selecting a Detail Entry           '        KHP11
         DC    C'                     NEWS dataset       '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C'***First Help Page***          PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP1LEN EQU   *-HELP1                                            KHP11
         EJECT                                                    KHP11
HELP2    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                               The SUMMA'        KHP11
         DC    C'RY Panel                  HELP Panel  2 '        KHP11
         DC    C'                              General In'        KHP11
         DC    C'formation                               '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The SUMMARY panel displays a one-line h'        KHP11
         DC    C'eader entry  for  each news item in the '        KHP11
         DC    C' news dataset.   These are displayed as '        KHP11
         DC    C'most-recently-entered first,   and will '        KHP11
         DC    C' normally be in inverse chronological or'        KHP11
         DC    C'der by date of entry.  If the "CURRENT" '        KHP11
         DC    C' option is in effect, only non-expired e'        KHP11
         DC    C'ntries will be displayed.  If the "ALL" '        KHP11
         DC    C' option is in effect, both current and e'        KHP11
         DC    C'xpired entries will be displayed,  with '        KHP11
         DC    C' the expired entries shown in LOW intens'        KHP11
         DC    C'ity and with a "*" after the expiration '        KHP11
         DC    C' date.                                  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' If more entries (current or all, contro'        KHP11
         DC    C'lled by the mode) exist in the  dataset '        KHP11
         DC    C' than can be displayed on the screen, th'        KHP11
         DC    C'e message  "*MORE*"  will appear in the '        KHP11
         DC    C' upper right hand corner.  Depressing "E'        KHP11
         DC    C'NTER", or any PFK other than  3/4/15/16 '        KHP11
         DC    C' causes the next screen of entries to be'        KHP11
         DC    C' displayed. After the last screen,  the '        KHP11
         DC    C' first screen will be displayed again.  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' From the SUMMARY Panel display you may '        KHP11
         DC    C'switch between CURRENT and ALL modes of '        KHP11
         DC    C' summary information display; print the '        KHP11
         DC    C'CURRENT or ALL index; display the entry '        KHP11
         DC    C' for an item; terminate NEWS; or display'        KHP11
         DC    C' HELP information.                      '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP2LEN EQU   *-HELP2                                            KHP11
         EJECT                                                    KHP11
HELP3    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                               The SUMMA'        KHP11
         DC    C'RY Panel                  HELP Panel  3 '        KHP11
         DC    C'                               Selection'        KHP11
         DC    C' Options                                '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' From any SUMMARY screen the following P'        KHP11
         DC    C'A/PF keys may be used:                  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     PA 1     (ATTN)   Terminate NEWS   '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     PF 3/15  (END)    Terminate NEWS   '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     PF 4/16  (PRINT)  Print SUMMARY Ind'        KHP11
         DC    C'ex (ALL or CURRENT as per mode)         '        KHP11
         DC    C'     any other PFK     Roll to next SUMM'        KHP11
         DC    C'ARY screen or back to first screen      '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' From any SUMMARY screen the following c'        KHP11
         DC    C'ommands may be entered (enter the       '        KHP11
         DC    C' command on the Command Entry Line where'        KHP11
         DC    C' the CURSOR is positioned and depress   '        KHP11
         DC    C' the ENTER key:                         '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     blank             Roll to next SUMM'        KHP11
         DC    C'ARY screen or back to first screen      '        KHP11
         DC    C'     A -or- ALL        Change to ALL mod'        KHP11
         DC    C'e for SUMMARY display or print          '        KHP11
         DC    C'     C -or- CURRENT    Change to CURRENT'        KHP11
         DC    C' mode for SUMMARY display or print      '        KHP11
         DC    C'     E -or- END        Terminate NEWS   '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     H -or- HELP       Display HELP pane'        KHP11
         DC    C'ls                                      '        KHP11
         DC    C'     nnn               Display detail en'        KHP11
         DC    C'try for NEWS Item "nnn"                 '        KHP11
         DC    C'                       (see "Selecting a'        KHP11
         DC    C' Detail Entry" on next screen)          '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP3LEN EQU   *-HELP3                                            KHP11
         EJECT                                                    KHP11
HELP4    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                               The SUMMA'        KHP11
         DC    C'RY Panel                  HELP Panel  4 '        KHP11
         DC    C'                        Displaying a Det'        KHP11
         DC    C'ail NEWS Entry                          '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' From the SUMMARY panel there are two wa'        KHP11
         DC    C'ys of displaying a specific NEWS entry: '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     1.   Position the cursor anywhere o'        KHP11
         DC    C'n the index line  of the news entry you '        KHP11
         DC    C'          wish to display and depress EN'        KHP11
         DC    C'TER.                                    '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     2.  Type the number of the NEWS ent'        KHP11
         DC    C'ry in the Command Entry Line  where the '        KHP11
         DC    C'         cursor is positioned and depres'        KHP11
         DC    C's ENTER.                                '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     Method (2) will work even if the en'        KHP11
         DC    C'try to be displayed is not displayed on '        KHP11
         DC    C'     the current SUMMARY screen (for exa'        KHP11
         DC    C'mple, if it is an expired entry and you '        KHP11
         DC    C'     are in CURRENT mode, or if it shows'        KHP11
         DC    C'on another screen.)                     '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
         DC    X'115CF01DE8'                                      KHP11
HELP4LEN EQU   *-HELP4                                            KHP11
         EJECT                                                    KHP11
HELP5    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                               The DETAI'        KHP11
         DC    C'L Panel                   HELP Panel  5 '        KHP11
         DC    C'                              General In'        KHP11
         DC    C'formation                               '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The DETAIL panel displays the text asso'        KHP11
         DC    C'ciated with a selected NEWS entry  from '        KHP11
         DC    C' the news dataset.  The entry is display'        KHP11
         DC    C'ed a screen at a time, and PF Keys  are '        KHP11
         DC    C' used to move forward or back in the ent'        KHP11
         DC    C'ry, to return to the SUMMARY panel,  to '        KHP11
         DC    C' print the entry, or to terminate the NE'        KHP11
         DC    C'WS Command.                             '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' From the DETAIL screen the following PA'        KHP11
         DC    C'/PF keys may be used:                   '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     PA 1     (ATTN)   Terminate NEWS   '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     PF 3/15  (END)    Return to the SUM'        KHP11
         DC    C'MARY screen                             '        KHP11
         DC    C'     PF 4/16  (PRINT)  Print Detail Entr'        KHP11
         DC    C'y and return to the SUMMARY screen      '        KHP11
         DC    C'     PF 7/19  (BACK)   Back up to previo'        KHP11
         DC    C'us DETAIL screen of this entry          '        KHP11
         DC    C'     PF 8/20  (FWD)    Go forward to nex'        KHP11
         DC    C't DETAIL screen of this entry           '        KHP11
         DC    C'                       (or return to SUM'        KHP11
         DC    C'MARY screen if exhausted entry)         '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The ENTER key has the same effect as PF'        KHP11
         DC    C' 8/20.                                  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP5LEN EQU   *-HELP5                                            KHP11
         EJECT                                                    KHP11
HELP6    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                              The PRINT '        KHP11
         DC    C'Facility                  HELP Panel  6 '        KHP11
         DC    C'                             General  In'        KHP11
         DC    C'formation                               '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The Print facility of the NEWS command '        KHP11
         DC    C'allows you to print the  Summary  Index '        KHP11
         DC    C' in either "ALL" or "CURRENT" mode, and '        KHP11
         DC    C'to print the detail entry for any  NEWS '        KHP11
         DC    C' item.                                  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The Print facility is invoked by depres'        KHP11
         DC    C'sing PF Key 4 or 16 from any Summary or '        KHP11
         DC    C' Detail panel.  The first time in a NEWS'        KHP11
         DC    C' session that Print is invoked, a print '        KHP11
         DC    C' dataset is dynamically allocated and op'        KHP11
         DC    C'ened for SYSOUT Class A, for the user'           KHP11
         DC    X'7D',C's '                                        KHP11
         DC    C' default TSO destination.  Once allocate'        KHP11
         DC    C'd and opened, the print dataset remains '        KHP11
         DC    C' open for the remainder of the NEWS sess'        KHP11
         DC    C'ion, and all subsequent prints go  into '        KHP11
         DC    C' the same dataset.                      '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' Each entry printed will be begun on a n'        KHP11
         DC    C'ew page, and will be date/time  stamped '        KHP11
         DC    C' and its index entry printed at the top '        KHP11
         DC    C'of the first page of the item.  When an '        KHP11
         DC    C' entry or the Summary is printed, the *E'        KHP11
         DC    C'NTIRE* entry is printed, not merely the '        KHP11
         DC    C' screen currently being displayed.  When'        KHP11
         DC    C' the Summary is printed, the CURRENT or '        KHP11
         DC    C' ALL mode currently in effect controls w'        KHP11
         DC    C'hether current or all index entries are '        KHP11
         DC    C' printed.                               '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The dataset is closed and printed when '        KHP11
         DC    C'the NEWS command is terminated.         '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP6LEN EQU   *-HELP6                                            KHP11
         EJECT                                                    KHP11
HELP7    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                        Creating your ow'        KHP11
         DC    C'n NEWS dataset            HELP Panel  7 '        KHP11
         DC    C'                             General  In'        KHP11
         DC    C'formation                               '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' A NEWS dataset is a TSO "TEXT" dataset '        KHP11
         DC    C'whose name is of the form:              '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'     "Index.NEWS.TEXT"                  '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The high-level index of the dataset def'        KHP11
         DC    C'aults to "MVS" but may be specified via '        KHP11
         DC    C' the "ID(Index)" parameter when the NEWS'        KHP11
         DC    C' command is issued.                     '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The dataset is allocated as a sequentia'        KHP11
         DC    C'l dataset, and is RECFM=VB.   Max LRECL '        KHP11
         DC    C' is 255, but NEWS only uses the first 80'        KHP11
         DC    C'. The BLKSIZE may be any desired.   The '        KHP11
         DC    C' contents consist of a series of NEWS en'        KHP11
         DC    C'tries, each of which begins with a sen- '        KHP11
         DC    C' tinel "header" line which contains the '        KHP11
         DC    C'News Item Number, date and time entered '        KHP11
         DC    C' and date of expiration, and a short des'        KHP11
         DC    C'cription of the item. THE FIELDS IN THE '        KHP11
         DC    C' HEADER LINE ARE POSITIONAL!  The header'        KHP11
         DC    C' line is followed by the detail  entry, '        KHP11
         DC    C' which may be as many lines as desired, '        KHP11
         DC    C'and is delimited by the next header  or '        KHP11
         DC    C' the end of file.                       '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C' The NEWS dataset is normally updated by'        KHP11
         DC    C' TSO or SPF edit.  Note that news items '        KHP11
         DC    C' are entered at the bottom of the datase'        KHP11
         DC    C't, and the Item Number and date/time of '        KHP11
         DC    C' entry and retirement must be specified '        KHP11
         DC    C'by the person entering the item.        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page    PFK 8/20 '        KHP11
         DC    C'for next page    PFK 3/15 to exit HELP  '        KHP11
HELP7LEN EQU   *-HELP7                                            KHP11
         EJECT                                                    KHP11
HELPLAST EQU   *                                                  KHP11
HELP8    DC    X'C11140403C5D7F001140401DE813'                    KHP11
         DC    C'                        Creating your ow'        KHP11
         DC    C'n NEWS Dataset            HELP Panel  8 '        KHP11
         DC    C'                      Sample Contents of'        KHP11
         DC    C' a NEWS Dataset                         '        KHP11
         DC    X'11C2601DE4'                                      KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'The following lines are the first lines '        KHP11
         DC    C'in a NEWS.TEXT dataset. You must supply '        KHP11
         DC    C'the header line with ××××××, news number'        KHP11
         DC    C', add date/time, and remove date before '        KHP11
         DC    C'the text of the news item.  Note that re'        KHP11
         DC    C'move date "***PERM" means forever.      '        KHP11
         DC    C'  -  -  -  -  -  - Material below copied'        KHP11
         DC    C' from News Dataset -  -  -  -  -  -  -  '        KHP11
         DC    C'(Note: Vertical bar in position three wa'        KHP11
         DC    C's left out on purpose so that           '        KHP11
         DC    C' News # 000 will not be displayed when "'        KHP11
         DC    C'NEWS" is typed in under TSO).           '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'      NEWS    ADD    ADD  REMOVE        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'      NMBR   DATE   TIME   DATE    TITLE'        KHP11
         DC    C'                                        '        KHP11
         DC    C'       --- ------- ----- -------   -----'        KHP11
         DC    C'--------------------------------------- '        KHP11
         DC    C'×× ××× 000 25sep80 08:00 ***PERM   sampl'        KHP11
         DC    C'e summary line  (maximum 44 characters) '        KHP11
         DC    C'----+----1----+----2----+----3----+----4'        KHP11
         DC    C'----+----5----+----6----+----7----+---- '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'××××××   1 25Jul81 15:47 ***perm   Intro'        KHP11
         DC    C'duction to News Facility                '        KHP11
         DC    C'                                        '        KHP11
         DC    C'                                        '        KHP11
         DC    C'This is the body of text of a news item '        KHP11
         DC    C'and can be as long as wanted. It will   '        KHP11
         DC    C'be displayed exactly as entered, includi'        KHP11
         DC    C'ng blank lines, etc.                    '        KHP11
         DC    C'××××××   2 25Jul81 15:47 31Dec81   Entry'        KHP11
         DC    C' 2 will expire on January 1, 1982       '        KHP11
         DC    C'This is the text  of news item 2, and it'        KHP11
         DC    C'may go on as long as necessary, with a  '        KHP11
         DC    C'limit of 1000 lines.  It is delimited by'        KHP11
         DC    C' the next Header or by end-of-file.     '        KHP11
         DC    X'115CF01DE8'                                      KHP11
         DC    C' PFK 7/19 for previous page      **Last '        KHP11
         DC    C'HELP Page**      PFK 3/15 to exit HELP  '        KHP11
HELP8LEN EQU   *-HELP8                                            KHP11
         SPACE 1                                                  KHP11
HELPLEN  EQU   HELP1LEN                                           KHP11
         EJECT                                                    KHP11
         TITLE 'N E W S -- PARSE PARAMETERS'                      KHP11
***********************************************************************
*                                                                     *
*        PARSE PARAMETERS                                             *
*                                                                     *
***********************************************************************
*                                                                     *
         PRINT GEN
PCL      IKJPARM DSECT=PDL
PDMSGNO  IKJIDENT 'NEWSNMBR',MAXLNTH=3,FIRST=NUMERIC,             KHP11*
               OTHER=NUMERIC,DEFAULT='0',                         KHP11*
               HELP=('MUST BE INTEGER NEWS ITEM NUMBER')          KHP11
PDMODE   IKJKEYWD ,                                               KHP11
         IKJNAME 'ALL',ALIAS=('A')                                KHP11
         IKJNAME 'CURRENT',ALIAS=('C')                            KHP11
         IKJNAME 'HELP',ALIAS=('H','TUTORIAL','T')                KHP11
PIDKEY   IKJKEYWD
         IKJNAME 'ID',SUBFLD=PID
PID      IKJSUBF
PIDID    IKJIDENT 'USER-NEWS-ID',MAXLNTH=8,FIRST=ALPHA,OTHER=ALPHANUM, *
               DEFAULT='MVS',HELP=('ID OF THE NEWS DATA SET')     KHP10
         IKJENDP
         END

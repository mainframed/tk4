//FIXARDIR JOB (@SYSUID,@SYSACCT),'REDO ARCH. DIRECTORY',CLASS=B
/*JOBPARM   I,W,T=5,Q=T,L=9
//*
//* THIS JOBSTREAM CAN BE USED TO REBUILD ONE OR ALL OF THE MEMBERS
//* OF THE LIBSPOOL ARCHIVE DIRECTORY DATA SET. THE FOLLOWING VARIABLE
//* SYMBOLIC PARAMETERS MUST BE SUPPLIED ACCORDING TO YOUR CONVENTIONS:
//*
//*    ARCHDSN  - LIBSPOOL ARCHIVE DIRECTORY DATA SET
//*    IN1      - LIBSPOOL ARCHIVE TAPE DATA SET NAME BEING INPUT
//*               (INCLUDE GENERATION NUMBER)
//*    MEMDATE -  THE DATE IN YYMMDD FORMAT TO BE USED IN THE MEMBER
//*               NAME TO BE CREATED IN THE ARCHIVE DIRECTORY DATA SET
//*               (USED ONLY WHEN A WEEKLY ARCHIVE TAPE IS INPUT)
//*    RUNTYPE -  'D' FOR A CREATION OF THE #DAILY MEMBER
//*               'W' FOR A CREATION OF A $WYYMMDD MEMBER
//*
//* RUN CONSIDERATIONS
//*
//*    RECREATING MEMBERS OF THE ARCHIVE DIRECTORY DATA SET REQUIRES
//*    THE FOLLOWING CONSIDERATIONS:
//*
//*      1) EACH MEMBER NAME MUST FALL IN ITS PROPER SPOT IN THE
//*         DIRECTORY OF THE ARCHIVE DIRECTORY DATA SET. THIS IS
//*         ACCOMPLISHED BY USING &MEMDATE VALUES THAT USE THE
//*         LAST RUN DATE OF THE DATA ON THE ARCHIVE TAPE BEING
//*         PROCESSED. THIS RULE IS TO BE FOLLOWED FOR ALL WEEKLY
//*         ARCHIVE TAPES. IF A WEEKLY MEMBER ALREADY EXISTS WITH
//*         THIS DATE, A DATE MUST BE CHOSEN SO THAT:
//*
//*           A) THE PREVIOUS MEMBERS LAST RUN DATE IS NOT GREATER
//*              THAN THE FIRST RUN DATE OF THE MEMBER TO BE ADDED.
//*           B) THE NEXT MEMBERS FIRST RUN DATE IS NOT LESS THAN
//*              THE LAST RUN DATE OF THE MEMBER TO BE ADDED.
//*
//*      2) WHEN RECREATING THE #DAILY MEMBER DO NOT INPUT A &MEMDATE
//*         VALUE. ONLY SPECIFY 'D' FOR &RUNTYPE.
//*
//CNTL    EXEC PGM=IEBGENER
//SYSPRINT DD DUMMY
//SYSUT2   DD DSN=&&LIBRCNTL,DISP=(,PASS),SPACE=(TRK,1),
//         DCB=(RECFM=FB,LRECL=80,BLKSIZE=80),UNIT=SYSDA
//SYSIN    DD DUMMY
//SYSUT1   DD *
-OPT NOCYCLE,NOOUTPUT,INDEX
-END
//*
//REBUILD PROC ARCHDSN=,                   ARCHIVE DIRECTORY
//       IN1=,                             INPUT ARCHIVE TAPE
//       MEMDATE=,                         MEMBER NAME DATE (YYMMDD)
//       RUNTYPE='W',                      D - DAILY,W - WEEKLY
//       PARMLIB='NRJS,NJTA'               LIBRARIAN PARM INFO
//**********************************************************************
//*   CREATE INDEX DATA SET FROM ARCHIVE TAPE
//**********************************************************************
//INDEX    EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD SYSOUT=A
//OSJOB    DD DUMMY
//LIST     DD SYSOUT=A
//INDEX    DD  DSN=&&INDEX,DISP=(,PASS),
//         DCB=(RECFM=FB,LRECL=133,BLKSIZE=6118),UNIT=SYSDA,
//         SPACE=(6118,(20,20),RLSE)
//SYSAF01  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF02  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF03  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=19069
//MASTIN   DD DSN=&IN1,DISP=(OLD,PASS)
//SYSIN    DD  DSN=&&LIBRCNTL,DISP=(OLD,DELETE)
//**********************************************************************
//*   UPDATE ONLINE ARCHIVE DIRECTORY DATA SET
//**********************************************************************
//LIBUP   EXEC PGM=OPS4321G,PARM='&RUNTYPE.&MEMDATE',COND=(0,NE)
//STEPLIB  DD DSN=PHGI.LINKLIB,DISP=SHR
//SYSABEND DD SYSOUT=A
//SORTLIB  DD DSN=SYS1.SORTLIB,DISP=SHR
//SORTOUT  DD DSN=&ARCHDSN(#DAILY),DISP=SHR
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SYSOUT   DD SYSOUT=A
//MESSAGES DD SYSOUT=A
//MASTDD   DD DSN=&&INDEX,DISP=(OLD,DELETE)
//TAPEDD   DD DSN=*.INDEX.MASTIN,DISP=(OLD,KEEP)
//DIRDD    DD DSN=&ARCHDSN(#DAILY),DISP=OLD
//DIRDDA   DD DSN=&ARCHDSN,DISP=OLD
//  PEND
//REDO   EXEC REBUILD,ARCHDSN='SHSWRPD.TEST.DIR', ARCHIVE DIRECTORY
//      IN1='PHGIOPS.OPS2339.DALYARCH(0)',   OUTPUT ARCHIVE TAPE DSNAME
//      RUNTYPE='W',
//      MEMDATE='820721'

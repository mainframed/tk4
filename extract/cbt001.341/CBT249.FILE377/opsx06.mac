//OPSX06  PROC MASTIN=,                    DISK LIBRARIAN MASTER
//       OUT1=,                NEW TAPE MASTER FILE (DO NOT INCLUDE GDG)
//       IN1=,              CURRENT TAPE MASTER FILE (INCLUDE GDG LEVEL)
//       ARCHDSN=,                         ARCHIVE DIRECTORY DSNAME
//       RUNTYPE='D',                      D - DAILY, W - WEEKLY
//       GEN='+1',                         NEW GENERATION # FOR IN1
//       RET='EXPDT=99000',                RETENTION FOR NEW TAPE MASTER
//       PARMSEL='HOURS=120,MODULES=000',  MODULE SELECTION CRITERIA
//       PARMLIB='NRJS,NJTA'               LIBRARIAN PARM INFO
//*
//**********************************************************************
//* CREATE DLM AND COPY CONTROL CARDS FOR MODULES GREATER THAN X HOURS
//**********************************************************************
//SELECT   EXEC  PGM=OPS4320G,PARM='&PARMSEL'
//STEPLIB  DD  DSN=PHGI.LINKLIB,DISP=SHR
//SYSOUT   DD  SYSOUT=*
//MCDCODE  DD  DUMMY
//*MCDCODE  DD  DSN=SHSW.PARMLIB(OPSX0601),DISP=SHR
//DLMCARD  DD  DSN=&&DLMCARD,DISP=(,PASS),UNIT=VIO,
//             DCB=BLKSIZE=4080,SPACE=(TRK,(5,5),RLSE)
//COPYCARD DD  DSN=&&COPYCARD,DISP=(,PASS),UNIT=VIO,
//             DCB=BLKSIZE=4080,SPACE=(TRK,(5,5),RLSE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//**********************************************************************
//*   COPY SELECTED MODULES FROM ONLINE LIBRARIAN JCL DATA SET
//**********************************************************************
//COPYSTEP EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  SYSOUT=A
//LIST     DD  SYSOUT=A
//OSJOB    DD  DSN=&&TEMP,DISP=(,PASS),UNIT=(SYSDA,2),
//             DCB=BLKSIZE=19040,SPACE=(CYL,(20,10),RLSE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//SYSIN    DD  DSN=&&COPYCARD,DISP=(OLD,DELETE)
//**********************************************************************
//*   MERGE COPIED MODULES ONTO NEW TAPE MASTER
//**********************************************************************
//COPYTAPE EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  DSN=&&INDEX,DISP=(,PASS),
//         DCB=(RECFM=FB,LRECL=133,BLKSIZE=6118),UNIT=SYSDA,
//         SPACE=(6118,(20,20),RLSE)
//LIST     DD  SYSOUT=A
//OSJOB    DD  DUMMY
//SYSAF01  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF02  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF03  DD  UNIT=(SYSDA,2),SPACE=(CYL,(30,15)),DCB=BLKSIZE=19069
//MASTIN   DD  DSN=&IN1,DISP=OLD
//MASTOUT  DD  DSN=&OUT1(&GEN.),UNIT=TAPE,
//            LABEL=&RET,VOL=(,RETAIN),
//            DCB=(SYS2.MODEL,BLKSIZE=32760),
//            DISP=(,CATLG,DELETE)
//SYSIN    DD  DSN=SHSW.PARMLIB(OPSX0602),DISP=SHR
//         DD  DSN=&&TEMP,DISP=(OLD,DELETE)
//* SHSW.PARMLIB(OPSX0602) = -OPT NOCYCLE,INDEX
//*SYSIN    DD  DSN=SHSW.PARMLIB(LBSPGPO1),DISP=SHR
//**********************************************************************
//*   UPDATE ONLINE ARCHIVE DIRECTORY DATA SET
//**********************************************************************
//LIBUP   EXEC PGM=OPS4321G,PARM='&RUNTYPE',COND=(0,NE)
//STEPLIB  DD DSN=PHGI.LINKLIB,DISP=SHR
//SYSABEND DD SYSOUT=A
//SORTLIB  DD DSN=SYS1.SORTLIB,DISP=SHR
//SORTOUT  DD DSN=&ARCHDSN(#DAILY),DISP=SHR
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SYSOUT   DD SYSOUT=*
//MESSAGES DD SYSOUT=*
//MASTDD   DD DSN=&&INDEX,DISP=(OLD,PASS)
//TAPEDD   DD DSN=*.COPYTAPE.MASTOUT,DISP=(OLD,PASS)
//DIRDD    DD DSN=&ARCHDSN(#DAILY),DISP=OLD
//DIRDDA   DD DSN=&ARCHDSN,DISP=OLD
//**********************************************************************
//*   REPORT CONTENTS OF ARCHIVE TAPE CREATED IN COPYTAPE STEP ABOVE
//**********************************************************************
//LIBPRT  EXEC PGM=OPS4322G,PARM='&RUNTYPE',COND=(0,NE)
//STEPLIB  DD DSN=PHGI.LINKLIB,DISP=SHR
//SYSABEND DD SYSOUT=A
//SORTLIB  DD DSN=SYS1.SORTLIB,DISP=SHR
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SYSOUT   DD SYSOUT=*
//MESSAGES DD SYSOUT=*
//REPORTDD DD SYSOUT=A,DCB=(RECFM=FBA,LRECL=133,BLKSIZE=133)
//MASTDD   DD DSN=&&INDEX,DISP=(OLD,PASS)
//TAPEDD   DD DSN=*.COPYTAPE.MASTOUT,DISP=(OLD,PASS)
//**********************************************************************
//*   BACKUP DISK MASTER ONTO TAPE MASTER BEFORE DELETES
//**********************************************************************
//BACKUPM  EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  DUMMY
//LIST     DD  SYSOUT=A
//OSJOB    DD  DUMMY
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//BACKUP   DD  DSN=&MASTIN..BACKUP,DISP=(NEW,KEEP,DELETE),
//             LABEL=(2,&RET),VOL=REF=*.COPYTAPE.MASTOUT,
//             DCB=BLKSIZE=32760
//SYSIN    DD  DSN=SHSW.PARMLIB(OPSX0603),DISP=SHR
//* SHSW.PARMLIB(OPSX0603) = -OPT BKUPTAPE
//*                          -END
//**********************************************************************
//*   DELETE MOVED MODULES FROM DISK MASTER
//**********************************************************************
//DELETEM  EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//SYSIN    DD  DSN=&&DLMCARD,DISP=(OLD,DELETE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//INDEX    DD  SYSOUT=A
//OSJOB    DD  DUMMY
//**********************************************************************
//*   NOTIFY THE OPERTOR THAT THE ARCHIVE JOB IS NOW COMPLETE AND
//*   LIBSPOOL WILL NOW BE STARTED
//**********************************************************************
//OPERMSG  EXEC PGM=OPS4341G
//STEPLIB  DD DSN=PHGI.LINKLIB,DISP=SHR
//**********************************************************************
//*   SUBMIT A START COMMAND TO START LIBSPOOL
//**********************************************************************
//STARTLS  EXEC PGM=IEBGENER,COND=EVEN
//SYSPRINT DD DUMMY
//SYSUT1   DD  DSN=SHSW.PARMLIB(OPSX0604),DISP=SHR
//SYSUT2   DD SYSOUT=(A,INTRDR)
//SYSIN    DD DUMMY
//* SHSW.PARMLIB(OPSX0604) = /*$VS,'S LIBSPOOL'

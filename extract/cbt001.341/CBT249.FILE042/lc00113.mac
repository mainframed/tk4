++PTF  (LC00113) /*  STORAGE FENCE ZAP FOR MVS/SE.
                 THIS ZAP WILL MODIFY THE SRM TO LIMIT AVQLOW STEALING
                 FROM A SPECIFIED ADDRESS SPACE IF ITS ALLOCATED FRAME
                 COUNT IS BELOW A GIVEN VALUE.
                 IN PARTICULAR, THIS FENCING MODIFICATION PROHIBITS
                 PAGE STEALING FROM CICS DUE TO BATCH PREEMPTION OF
                 REFERENCED PAGES.
                 THE PERFORMANCE GROUPS PROTECTED AND THE NUMBER OF
                 FRAMES PROTECTED ARE IN A TABLE AT THE END OF THE
                 CODE.

                 WARNING:  BE VERY CAREFUL NOT TO FENCE OFF TOO MUCH
                           REAL MEMORY OR RUN MORE THAN ONE ADDRESS
                           SPACE PER FENCED PERFORMANCE GROUP.
                           FAILURE TO OBSERVE THIS CAUTION WILL
                           PROBABLY RESULT IN A SYSTEM DISABLED WAIT.
                           ALSO REALIZE THAT THIS MODIFICATION WASTES
                           REAL MEMORY.

                 B. LUM, 4/19/79.
                  */.
++VER (Z038) PRE(UZ85000) .
++ZAP (IRARMSTM) .
 NAME IRARMSTM
*  EXPAND IRARMSTM 48 BYTES + 4*(# OF PG'S) + 4 BYTES(FOR END OF TABLE)
 EXPAND IRARMSTM(60)
 VER 02AE 45E0CB2C       BAL @14,STEAL
 VER 0BF8 00000000,00000000,00000000,0000     PATCH AREA
 VER 0C06 00000000,00000000,00000000,0000     PATCH AREA
 VER 0C14 00000000,00000000,00000000,0000     PATCH AREA
 VER 0C22 00000000,00000000,00000000,0000     PATCH AREA
*    REGISTER USAGE...
*    R4 = OUCB PTR
*    R5 = ASCB PTR
*    RA = WORK REG
*    RC = STM BASE    CONTAINS X'20'
*
 REP 02AE 45E0CBD8       BAL @14,PATCH
 REP 0BF8 41A0CC04 PATCH LA 10,FIRSTPG    (1ST TABLE ENTRY)
 REP 0BFC 9500A000 P1    CLI 0(10),X'00'  TEST FOR END OF TABLE
 REP 0C00 4780CB2C       BE STEAL         YES
 REP 0C04 D500A0004018   CLC 0(1,10),OUCBPG(OUCBPTR) CORRECT PG?
 REP 0C0A 4780CBF6       BE  P2           YES - CHECK FRAME COUNT
 REP 0C0E 41A0A004       LA  10,4(10)     PT TO NEXT TABLE ENTRY
 REP 0C12 47F0CBDC       B   P1           BR TO CHECK END OF TABLE
 REP 0C16 D501A0025098 P2 CLC 0(2,10),ASCBFC(ASCBPTR) CMP LIMIT TO FC
 REP 0C1C 47B0C2A8       BNL @RF00166     GET NEXT ADDRESS SPACE
 REP 0C20 47F0CB2C       B   STEAL        STEAL FROM ADDRESS SPACE
*  TABLE FORMAT 4 BYTES  PP00NNNN
*                        PP=PERFORMANCE GROUP NUMBER
*                        00=FILLER
*                        NNNN=NUMBER OF FRAMES TO FENCE
*                        WORD OF ZEROES END THE TABLE
*REP 0C24 14000032       PG=20 FRAMES=50
*REP 0C28 21000120       PG=33 FRAMES=288
 REP 0C24 290002BC       PG=41 FRAMES=700  CICS
 REP 0C28 33000140       PG=51 FRAMES=256  TEST CICS
 REP 0C2C 00000000

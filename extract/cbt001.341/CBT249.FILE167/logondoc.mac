     LOGONXIT P3.2 - BEN MOORE, SCHERING-PLOUGH, INC         18 MAR 81
                     3030 JACKSON AVE, MEMPHIS, TN 38151
                     901/320-2341

     IMPLEMENTED AS 2 MODULES, IKJEFLD AND LOGONXIT.  IKJEFLD IS THE
STANDARD LOGON PRE-PROMPT EXIT NAME AND IS LINKEDITED INTO IKJEFLA IN
SYS1.LPALIB.  WHEN USING SMP4, YOU CAN DO AN INLINE JCLIN TO ADD A MOD
ENTRY FOR IKJEFLD OR SIMPLY PUT LMOD(IKJEFLA) ON THE ++MOD CARD FOR
IKJEFLD.  BECAUSE OF THIS PROBLEM AND THE INCONVENIENCE OF HAVING TO DO
A CLPA EACH TIME THE EXIT IS CHANGED, THIS IKJEFLD DOES A BLDL FOR
MODULE LOGONXIT AND IF PRESENT, LOADS IT AND BALR'S TO IT.  THIS ALLOWS
FOR EASY REMOVAL OF THE EXIT.  THE MODULE LOGONXIT COULD BE CHANGED TO
USE A CSECT NAME OF IKJEFLD AND BE LINKED DIRECTLY INTO IKJEFLA IF THE
USER WANTED TO.  OTHERWISE, THE MODULE LOGONXIT NEED ONLY RESIDE IN THE
LINKLIST.

     IKJEFLD ALLOWS FOR TESTING OF AN ALTERNATE EXIT BY ENTERING 'LOGON
#' RATHER THAN LOGON.  IT CHECKS FOR THE # AND BLDLS FOR LOGONTST RATHER
THAT LOGONXIT.

     ENFORCES 5 MINUTE LOGON "TIMEOUT".  INTERVAL AMOUNT DEFINED BY
LOGTIME.  GENERATES ABEND U0522.  DOESN'T SEEM TO WORK ON VTAM LOCAL
3270 UNTIL INTERRUPT FROM TERMINAL.

     SUPPORTS 2 LEVELS OF ATTENTION INTERRUPTS.  FIRST LEVEL ATTENTION
WILL ACCEPT EITHER ANOTHER LOGON COMMAND OR LOGOFF.  SECOND LEVEL
ATTENTION WILL RETURN TO THE TGET/GETLINE WITH NO INPUT.  THIS SHOULD
CAUSE LOGONXIT TO RE-PROMPT.

     DIAGNOSES "USERID ENQ FAIL", "RESOURCE FAILURE", AND "ABEND"
CONTROL SWITCHES BEING SET.  USER IS NOTIFIED AND THE LOGON DENIED.

     USES A USER SVC TO GAIN APF AUTHORIZATION.  THIS IS NEEDED TO DO
MODESET TO GET INTO KEY 0.  KEY 0 IS USED TO FETCH THE TERMINAL NAME
FROM THE TSB.

     CLEARS THE TERMINAL BUFFERS.  THIS IS INTENDED TO PREVENT HARDCOPY
USERS FROM USING "CONTROL W" TO DELIMETER THEIR PASSWORD AND ACCOUNT
NUMBER THEREBY BYPASSING THE MASKING FEATURE OF THE LOGONXIT.

     BUILDS CBUF FROM THE PASSED INPUT BUFFER AND USES IKJSCAN AND
IKJPARS EXAMINE THE BUFFER.  ERRORS ARE DIAGNOSED BY GNRLFAIL
(IKJEFF19).

     SUPPORTS THE FOLLOWING JCL TYPE KEYWORDS:
          PROGNAME - PROGRAMMER NAME ON JOB CARD
          MSGCLASS - MSGCLASS ON JOB CARD
          MSGLEVEL - MSGLEVEL ON JOB CARD
          TIME     - TIME ON EXEC CARD
          COPIES   - COPIES ON /*JOBPARM CARD (JES2)
          LINECT   - LINECT ON /*JOBPARM CARD (JES2)
          ROOM     - ROOM ON /*JOBPARM CARD (JES2)
          FORMS    - FORMS ON /*JOBPARM CARD (JES2)

     SUPPORTS TSO/VTAM RECONNECT AS PER AZ06786.

     SUPPORTS PASSWORD CHANGING SIMILAR TO SU32 OR VIA NEWPSWD KEYWORD.

     CREATES AN INFORMATION BLOCK FOR EACH USER IN SYS1.UADS NAMED
$USERID.  THIS BLOCK CONTAINS THE FOLLOWING INFORMATION:
          USERID   - USERID
          NAME     - USER'S NAME
          PHONE    - BUSINESS PHONE
          ADDRESS  - INTERNAL MAILING ADDRESS
          LASTON   - YY.DDD TERMINAL LAST LOGGED ON
          CHGPSWD  - YY.DDD PASSWORD LAST CHANGED
          CPUTIME  - MAXIMUM CPU TIME
          DEFTIME  - DEFAULT CPU TIME
          PROGNAME - PROGRAMMER'S NAME FOR JOB CARD
          FORMS    - FORMS FOR /*JOBPARM CARD
          ROOM     - ROOM FOR /*JOBPARM CARD

     DENIES LOGON IF USER HAS NOT LOGGED ON IN THE LAST 30 DAYS.

     REQUIRES USER TO CHANGE PASSWORD EVERY 90 DAYS OR MORE OFTEN.

     ALLOWS PRIVILEGED USERS TO ENTER ADDITIONAL JCL.

     TAKES AN SVC DUMP IF THE EXIT ABENDS.

     ALLOWS PRIVILEGED USERS TO ENTER AN ALTERNATE PROC NAME.

     USES SPF ENQ(RESERVE)/DEQ CONVENTIONS TO CREATE OR UPDATE THE
INFO BLOCK.

     USES $SYSTEM$ MEMBER OF SYS1.UADS TO DEFINE LIMITS ON LOGONS BY
FIRST CHARACTER OF USERID.  THIS MEMBER CONTAINS DEFINITIONS OF LIMITS
BY PRIME AND OFF SHIFT.  ALSO DEFINED IN THIS MEMBER ARE USERS TO NEVER
DENY, HOLIDAYS, AND PRIME SHIFT HOURS.

     ALLOWS A USER TO CHANGE HIS DEFAULT SYSOUT DEFINITION.

     THE FOLLOWING ARE KNOWN PROBLEMS OR WARNINGS TO THE USER:

     IF YOU USE "LIST (*)" UNDER ACCOUNT, YOU WILL RECEIVE "IKJ56592I
COMMAND SYSTEM ERROR+ READ ERROR CODE 04".  THIS IS BECAUSE ACCOUNT
REQUIRES THAT THE FIRST MEMBER IN UADS MUST BE A 0TH MEMBER.  SINCE $
COLLATES BEFORE ANY LETTER, THE INFO BLOCKS OCCUR BEFORE ANY NORMAL
MEMBERS.  THIS CAN BE AVOIDED BY ADDING A DUMMY USERID OF $$.

     THE BLOCKSIZE ON UADS MUST BE LARGE ENOUGH TO CONTAIN ALL OF THE
MODEL INFO BLOCK PLUS AT LEAST ONE BLANK BYTE.  IF THE BLOCKSIZE IS NOT
THIS LARGE,  YOU WILL GET AN S0C4 IN THE FINDINFO SUBROUTINE.

     USE OF LRECL=80 FOR UADS WILL ALLOW YOU TO READILY SPF BROWSE AND
OR EDIT THE INFO BLOCKS.  NOTE THAT THIS IS PERFECTLY SAFE SINCE THE
LOGONXIT USES SPF CONVENTIONS TO UPDATE UADS.  THE ACCOUNT COMMAND
DOESN'T SEEM TO CARE ABOUT LRECL.

     I HAVE NOTICED A SITUATION WHERE A USER TRIES TO LOGON, IS
PROMPTED, AND DOESN'T KNOW THE REQUIRED RESPONSE.  AT THIS POINT, MY
USERS JUST WALK OFF AND GO TRY ANOTHER TERMINAL.  BECAUSE THE FIRST
ADDRESS SPACE IS HOLDING THE SPF ENQUEUES ON THE USERID0 AND $USERID
MEMBERS, THE SECOND TERMINAL JUST HANGS UP.  THE TIMERXIT WILL
EVENTUALLY KILL THE FIRST ADDRESS SPACE (HOPEFULLY).  YOU CAN'T CANCEL
THE FIRST ADDRESS SPACE BECAUSE HE DOESN'T HAVE A JOBNAME YET.  RESOLVE
EXIT SERVICE USING A JOBNAME OF "STARTING" WILL GET RID OF HIM (ASSUMING
HE IS THE FIRST "STARTING" IN THE ASVT).

     THE TIMERXIT DOESN'T ALWAYS GET ELONGATED LOGONS APPARENTLY DUE TO
THE FACT THAT TGET MARKS THE TCB NONDISPATCHABLE RATHER THAN WAITING ON
A ECB FOR COMPLETING OF THE TERMINAL I/O.  THIS PRECLUDES THE DISPATCH
OF THE IRB FOR THE TIMER EXIT.  THE USER WILL ABEND WITH A U0522 AS SOON
AS SOMEONE HITS THE ENTER KEY.

     THIS EXIT DOES NOT CURRENTLY SUPPORT NULL ACCOUNT NUMBERS OR PROCS
AND REQUIRES 8 CHARACTER ACCOUNT NUMBERS.  THIS MAY BE CHANGED IN A
FUTURE PHASE.

     THE "NEWPSWD" FACILITY, SPECIFICALLY THE GNEWPASS SUBROUTINE,
WILL ALLOW THE USER TO SPECIFY A PASSWORD WITH IMBEDDED BLANKS.  THIS
CAUSES A PROBLEM IF HE EVER TRIES TO LOGON USING
"LOGON USERID/PASSWORD" SINCE THE BLANK WILL CAUSE PARSE TO TERMINATE
THE PASSWORD.  HE CAN STILL LOGON BY ENTERING "LOGON USERID" AND
LETTING THE PRE-PROMPT EXIT PROMPT HIM.  THIS WILL BE FIXED IN A FUTURE
PHASE.

     THE PARAMETERS 'COPIES', 'FORMS', AND 'LINECNT' ONLY APPLY TO
SYSOUT DATA SETS THAT ARE CONTAINED IN THE LOGON PROCEDURE OR ARE
ENTERED BY THE 'JCL' OPTION.

     THE MEMBER $SYSTEM$ IS REQUIRED.  IF IT IS NOT PRESENT, LOGONS
WILL RECEIVE A MESSAGE AND THE LOGON WILL BE DENIED.

     AZ40482 WILL CORRECT MSGIKJ5645I LOGON TERMINATED WITH MVS SE1
R3.8.

     WHEN THE 'DEST' KEYWORD IS ENTERED, THE LOGONXIT SIMPLY CHANGES THE
DESTINATION IN THE UADS DATA BLOCK.  NO CHECK IS DONE TO VERIFY THAT THE
DESTINATION IS VALID.  AN IEFSSREQ MACRO COULD BE USED TO CHECK THE
DESTINATION.

     TO CAUSE THE OVERPRINTING OF THE PASSWORD ON NON-DISPLAY TERMINALS,
THE RUBOUT CHARACTER, X'17' IS USED.  DEPENDING ON THE PARITY OF YOUR
TERMINALS, YOU MAY NEED TO SUBSTITUTE X'16'.

     BEFORE YOU PUT THIS EXIT IN PRODUCTION, YOU SHOULD ENSURE THAT YOUR
SYS1.UADS IS LARGE ENOUGH TO CONTAIN ALL THE NEW INFO BLOCKS THAT WILL
BE GENERATED.  THIS GROWTH MAY BE DRAMATIC FOR THE FIRST SEVERAL DAYS
(SORRY ABOUT THAT ELAINE!).


 GETSCRN:
 PROC (RESPONSES,TABLE,RETC) REORDER;
 DCL
 RESPONSES CHAR(*),
 1 TABLE,
 2 SIZE BINARY FIXED(15,0),
 2 FIELD(*),
 3 ADDRESS CHAR(2),
 3 O BINARY FIXED(15,0),
 3 L BINARY FIXED(15,0),
 3 FLAG CHAR(1),
 RETC BINARY FIXED(15,0),
 TERMGET ENTRY(CHAR(1024),BINARY FIXED(15,0),BINARY FIXED(15,0)) OPTI
 ONS(ASM INTER),
 PA2 CONDITION EXTERNAL,
 (INDEX,
 SUBSTR,
 TRANSLATE) BUILTIN,
 MSGSIZE BINARY FIXED(15,0) STATIC INIT(1021),
 BUFFER CHAR(1024),
 (START,
 I,
 LENGTH) BINARY FIXED(15,0) STATIC INIT(0),
 (SBA INIT(''),          /*   SBA=HEX'11'   */
 DUP INIT('º')) CHAR(1) STATIC, /*   DUP=HEX'1C'   */
 UPPER_CASE CHAR(26) INIT('ABCDEFGHIJKLMNOPQRSTUVWXYZ') STATIC,
 LOWER_CASE CHAR(26) INIT('abcdefghijklmnopqrstuvwxyz') STATIC;
 MSGSIZE=1021;
 CALL TERMGET(BUFFER,MSGSIZE,RETC);
 IF SUBSTR(BUFFER,1,1)='>' THEN
 SIGNAL COND(PA2);
 SUBSTR(BUFFER,MSGSIZE+1,3)=SBA××'""';
 START=5;
 DO I=1 TO SIZE;
 SELECT;
 WHEN ( SUBSTR(BUFFER,START,2)=TABLE.FIELD(I).ADDRESS )
 DO;
 START=START+2;
 LENGTH=INDEX(SUBSTR(BUFFER,START),SBA)-1;
 IF SUBSTR(BUFFER,START,1)^=DUP THEN
 SELECT ( TABLE.FIELD(I).FLAG );
 WHEN ( '1' )
 SUBSTR(RESPONSES,O(I),L(I))=SUBSTR(BUFFER,START,LENGTH);
 WHEN ( '2' )
 SUBSTR(RESPONSES,O(I),L(I))=
 TRANSLATE(SUBSTR(BUFFER,START, LENGTH),UPPER_CASE,LOWER_CASE);
 WHEN ( '3' )
 DO;
 SUBSTR(RESPONSES,O(I),L(I))=' ';
 SUBSTR(RESPONSES,O(I)+L(I)-LENGTH,LENGTH)=
 SUBSTR(BUFFER,START,LENGTH);
 END;
 WHEN ( '4' )
 SUBSTR(RESPONSES,O(I),L(I))='>';
 OTHERWISE
 ;
 END;
 START=START+LENGTH+1;
 END;
 WHEN ( TABLE.FIELD(I).FLAG='4' & TABLE.FIELD(I).ADDRESS=SUBSTR(BUFFE
 R,2,2) )
 SUBSTR(RESPONSES,O(I),L(I))='>';
 OTHERWISE
 SUBSTR(RESPONSES,O(I),L(I))=' ';
 END;
 END;
 END GETSCRN;

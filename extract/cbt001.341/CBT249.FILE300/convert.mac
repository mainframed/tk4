         MACRO
&NAME    CONVERT &EVENREG,&DIGITS,&DBLWD,&TYPE=DEC
.*
.*  THIS MACRO WILL PERFORM HEX TO HEX CHARACTER OR DECIMAL
.*  CHARACTER CONVERSIONS.  IT USES AN EVEN-ODD PAIR OF REGS
.*  AND A DOUBLE WORD OF STORAGE TO DO ITS CALCULATIONS.
.*
         GBLC  &CONV
         GBLC  &P
         LCLA  &N
         LCLA  &ODDREG
         LCLA  &LCLDIGS
&N       SETA  0
&ODDREG  SETA  &EVENREG+1
&LCLDIGS SETA  &DIGITS
         AIF   (T'&EVENREG NE 'N').ERR1
         AIF   (T'&DIGITS NE 'N').ERR2
         AIF   ('&NAME' EQ '').NONAME
&NAME    EQU   *
.NONAME  ANOP
         AIF   ('&TYPE' NE 'DEC').NODEC
         AIF   (&DIGITS GT 5).ERR4
         CVD   &EVENREG,&DBLWD
         UNPK  &DBLWD.(&DIGITS.),&DBLWD+5(3)
         OI    &DBLWD+&DIGITS-1,X'F0'
         MEXIT
.NODEC   ANOP
         AIF   (&DIGITS GT 4).ERR3
&CONV    SETC  'YES'   SO CPDATA KNOWS A HEX CONVERT WAS ISSUED
         AIF   (&LCLDIGS EQ 0).DONE
         SRDL  &EVENREG,4
         SRL   &ODDREG,4
&LCLDIGS SETA  &LCLDIGS-1
         AGOB  .NODEC
.DONE    ANOP
         ST    &ODDREG,&DBLWD
         TR    &DBLWD.(&DIGITS.),&P.CHARS
         MEXIT
.ERR1    ANOP
         MNOTE 8,'FIRST OPERAND NOT NUMERIC'
         MEXIT
.ERR2    ANOP
         MNOTE 8,'SECOND OPERAND NOT NUMERIC'
         MEXIT
.ERR3    ANOP
         MNOTE 8,'SECOND OPERAND > 4 ON HEX CONVERT'
         MEXIT
.ERR4    ANOP
         MNOTE 8,'SECOND OPERAND > 5 ON DEC CONVERT'
         MEND

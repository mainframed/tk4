//BLDX JOB (CCP64,1B),BLDX,NOTIFY=CCP11
/*JOBPARM TIME=1459,TAPES=2,LINES=1000
/*ROUTE  PRINT LOCAL
//*
//* NOTE TO AUBURN:
//*
//* BEFORE TESTING THIS JCL AT AUBURN, CHANGE EVERY OCCURRENCE OF
//* 'CCP11.Q.' TO 'CCP11.QS.' AND EVERY OCCURRENCE OF 'CCP64.' TO
//* 'CCP64.QS.'. CHANGE THE JOBPARM TIME TO 29 SECONDS, THE INDEX
//* SPACE ALLOCATION TO (CYL,(1,,1),,CONTIG), AND THE MAP SPACE
//* ALLOCATION TO (CYL,1).
//*
//*
//* FUNCTION:
//*
//* BLDX IS THE THIRD AND LAST OF THE QUANDRY BUILDERS.  IT TAKES
//* AS INPUT THE MAJOR AND MINOR OCCURRENCE FILES (CCP64.MAJOR,
//* CCP64.MINOR) FROM BLDO AND BUILDS AN ISAM DESCRIPTOR FILE
//* (CCP11.Q.X) AND A DIRECT OCCURRENCE FILE (CCP11.Q.M) REFERRED
//* TO AS THE INDEX AND MAP FILES.  IN ORDER TO SAVE STORAGE AND
//* TIME IN PROCESSING TRUNCATIONS IN READ STATEMENTS, KEYS
//* (AUTHORS, DESCRIPTORS, AND IDENTIFIERS) WHICH OCCUR ONLY ONCE
//* ARE OMITTED.  THE THRESHOLD (1) IS DETERMINED BY THE VARIABLE
//* RECORD_COUNT_CUTOFF IN CCP11.Q.PLI(BLDX).  THIS MAY BE SET TO
//* ZERO TO INCLUDE ALL KEYS OR MAY BE INCREASED.  A VALUE OF
//* ZERO WILL VERY ROUGHLY TRIPLE THE NUMBER OF DESCRIPTORS, AND
//* CONSEQUENTLY, THE SIZE OF THE (RELATIVELY SMALL) INDEX FILE.
//* SPECIAL HANDLING REDUCES THE TIME AND CORE OVERHEAD OF
//* SINGLE-OCCURRENCE KEYS IN READ STATEMENTS SO THAT A CUTOFF
//* OF ZERO IS NOT INFEASIBLE.
//*
//* JCL MODIFICATIONS:
//*
//* JOB CARDS, DEVICE TYPES, VOLUMES, AND SO FORTH MUST BE MODIFIED
//* TO CONFORM TO YOUR INSTALLATION AND REQUIREMENTS.  ADDITIONALLY,
//* THE AUBURN UTILITY ZAP, WHICH DOES AN IEHPROGM SCRATCH OF
//* DATASETS, MUST BE REPLACED.
//*
//* THE CPU TIME CAN BE REDUCED TO 29 SECONDS, THE INDX SPACE
//* TO SPACE=(CYL,(1,,1)), AND THE MAP SPACE TO 1 CYLINDER
//* WHEN BUILDING THE TEST FILES.
//*
//* RESOURCE ESTIMATES:
//*
//* ONE CYLINDER OF A 3350 WILL HOLD 1620 MAP BLOCKS.  EACH MAP
//* BLOCK HOLDS 42 OCCURRENCE ENTRIES.  ENTRIES ARE GENERATED AS
//* FOLLOWS:  MAJOR DESCRIPTORS AND IDENTIFIERS, 1 + 2 PER
//* OCCURRENCE; MINOR DESCRIPTORS AND IDENTIFIERS, 1 + 1 PER
//* OCCURRENCE; AUTHORS, 1 + 1 PER OCCURRENCE.  KEYS WITH ONLY
//* ONE OCCURRENCE (CUTOFF=1) ARE ELIMINATED AND DO NOT COUNT
//* TOWARD THE TOTALS.
//*
//* THE STORAGE NEEDED FOR THE ISAM FILE INDX IS ROUGHLY ONE
//* CYLINDER (3350) PLUS ONE ADDITIONAL CYLINDER FOR EACH
//* 10000 KEYS WHICH PASS THE CUTOFF TEST.  (3330 FIGURES ARE
//* 1 + 1 PER 4000 KEYS OVER THE CUTOFF.)  AN ERIC FILE OF
//* 175000 RECORDS WILL HAVE APPROXIMATELY 187000 KEYS, 57000
//* OF WHICH WILL OCCUR MORE THAN ONCE. (30000 OF THESE ARE
//* FOR AUTHORS.
//*
//* A 175000 RECORD FILE DESCRIBED IN BLDE TOOK 39 MAP CYLINDERS AND
//* 6 INDEX CYLINDERS.  RUNNING ON A 158 MOD 1, BLDX TOOK 12 MINUTES
//* OF COMPUTER TIME, DID 27K TAPE OPERATIONS AND 67K DISK OPERATIONS.
//* CLOCK TIME WAS 30 MINUTES.
//*
//* A WORD OF WARNING:  THE MAP FILE IS A REGIONAL(1) BDAM FILE
//* AND MUST BE FORMATTED WITH DUMMY RECORDS.  IF THE MAP FILE
//* IS ALLOCATED TOO MUCH STORAGE, BLDX WILL CONTINUE TO RUN FOR
//* SOME TIME AFTER THE OCCURRENCE TAPES HAVE BEEN READ TO
//* FORMAT THE UNUSED RECORDS AT THE END OF THE FILE.
//*
//* SAMPLE OUTPUT (3350):
//*
//*
//*          1 CYLINDERS WERE USED FOR MAP RECORDS.
//*       1620 MAP RECORDS WERE WRITTEN PER CYLINDER.
//*         42 OCCURRENCES FIT IN ONE MAP RECORD.
//*        407 WAS THE KEY OF THE LAST RECORD WRITTEN.
//*
//*       5842 POTENTIAL KEYS WERE FOUND.
//*       2524 OF THESE WERE ACCEPTED AS QUANDARY ACCESS KEYS.
//*          2 OCCURRENCES WERE REQUIRED FOR ACCEPTANCE.
//*
// EXEC ZAP
//SYSIN DD *
 CCP11.Q.X
 CCP11.Q.M
// EXEC PLIXCLG,PARM.PLI='X,A,AG,STG,OPT(TIME),MAR(2,72,1)'
//PLI.SYSLIB DD DSNAME=CCP11.Q.PLI,DISP=SHR
//PLI.SYSIN DD DSNAME=CCP11.Q.PLI(BLDX),DISP=SHR
//LKED.OBJ DD DSNAME=CCP11.Q.OBJ,DISP=SHR
//LKED.SYSIN DD *
 INCLUDE OBJ(DEVTYPE)
//GO.MAJOR DD DSNAME=CCP64.MAJOR,DISP=SHR
//GO.MINOR DD DSNAME=CCP64.MINOR,DISP=SHR
//GO.INDX DD DSNAME=CCP11.Q.X,DISP=(NEW,CATLG),LABEL=RETPD=365,
// DCB=(RECFM=FB,LRECL=40,BLKSIZE=880,RKP=0,KEYLEN=32,DSORG=IS),
// UNIT=3350,SPACE=(CYL,(6,,1),,CONTIG),VOL=SER=USER04
//GO.MAP DD DSNAME=CCP11.Q.M,DISP=(NEW,CATLG),LABEL=RETPD=365,
// DCB=(RECFM=F,BLKSIZE=168,DSORG=DA),
// UNIT=3350,SPACE=(CYL,40),VOL=SER=TEMP08
//

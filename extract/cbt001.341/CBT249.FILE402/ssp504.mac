000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.    SSP504.
000030 AUTHOR.        MOA ANCHORAGE.
000310
000320
000330*****************************************************************
000340*****************************************************************
000350**                                                             **
000360**                                                             **
000370**             SSSSSSSSSS   MM        MM   SSSSSSSSSS          **
000380**            SSSSSSSSSSSS  MMM      MMM  SSSSSSSSSSSS         **
000390**            SS        SS  MMMM    MMMM  SS        SS         **
000391**            SS            MM MM  MM MM  SS                   **
000392**            SSS           MM  MMMM  MM  SSS                  **
000393**             SSSSSSSSS    MM   MM   MM   SSSSSSSSS           **
000394**              SSSSSSSSS   MM        MM    SSSSSSSSS          **
000395**                     SSS  MM        MM           SSS         **
000396**                      SS  MM        MM            SS         **
000397**            SS        SS  MM        MM  SS        SS         **
000398**            SSSSSSSSSSSS  MM        MM  SSSSSSSSSSSS         **
000399**             SSSSSSSSSS   MM        MM   SSSSSSSSSS          **
000400**                                                             **
000401**                                                             **
000402**        M U N I C I P A L I T Y   O F   A N C H O R A G E    **
000403**                                                             **
000404**          S P A C E   M A N A G E M E N T   S Y S T E M      **
000405**                                                             **
000406*****************************************************************
000407*****************************************************************
000408
000409
000040 ENVIRONMENT DIVISION.
000050 CONFIGURATION SECTION.
000060 SOURCE-COMPUTER.  IBM-370.
000070 OBJECT-COMPUTER.  IBM-370.
000080 SPECIAL-NAMES.
000090     C01 IS TO-TOP.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT EXTRACT-INPUT
000130         ASSIGN TO UT-DMSFREE.
000140     SELECT REPORT-FILE
000150         ASSIGN TO UT-DMSRPT.
000160     SELECT SORT-FILE
000170         ASSIGN TO UT-SORTWK01.
000180     EJECT
000190 DATA DIVISION.
000200 FILE SECTION.
000210     SKIP2
000220 FD  EXTRACT-INPUT
000230     RECORDING MODE IS F
000240     LABEL RECORDS ARE STANDARD
000250     RECORD CONTAINS 148 CHARACTERS
000260     BLOCK CONTAINS 0 RECORDS
000270     DATA RECORD IS EXTRACT-FILE-RECORD.
000280 01  EXTRACT-FILE-RECORD         PIC X(148).
000290     SKIP2
000300 FD  REPORT-FILE
000310     RECORDING MODE IS F
000320     LABEL RECORDS ARE STANDARD
000330     RECORD CONTAINS 133 CHARACTERS
000340     BLOCK CONTAINS 0 RECORDS
000350     DATA RECORD IS REPORT-REC.
000360 01  REPORT-REC.
000370     05  FILLER                  PIC X(133).
000380     SKIP2
000390 SD  SORT-FILE
000400     RECORD CONTAINS 148 CHARACTERS
000410     DATA RECORD IS SORT-RECORD.
000420 01  SORT-RECORD.
000430     05  SORT-VOLUME             PIC X(6).
000440     05  FILLER                  PIC X(142).
000450     EJECT
000460 WORKING-STORAGE SECTION.
000470 77  WS-AVAIL-TRKS               PIC S9(5)      COMP-3
000480                                                VALUE ZEROS.
000490 77  WS-TOTAL-TRACKS             PIC S9(5)      COMP-3
000500                                                VALUE ZEROS.
000510 77  INDEX-HOLD                  PIC S9(3)      COMP-3
000520                                                VALUE ZEROS.
000530 77  LINE-CNT                    PIC S9(3)      COMP-3
000540                                                VALUE +999.
000550 77  PAGE-CNT                    PIC S9(3)      COMP-3
000560                                                VALUE ZEROS.
000570 77  AVAIL-SPACE-TOTAL           PIC S9(5)      VALUE ZEROS
000580                                                COMP-3.
000590 77  NUM-TRACKS-PER-CYLINDER     PIC 9(4)       VALUE ZEROS
000600                                                COMP-3.
000610 77  VOLUME-HOLD                 PIC X(6)       VALUE SPACES.
000620 77  VOLUME-SWITCH               PIC X          VALUE SPACES.
000621
000630 01  MOVE-COMP.
000640     05  X-FIELD.
000650         10  FILLER              PIC X          VALUE LOW-VALUES.
000660         10  COMP-DATA           PIC X.
000670     05  COMP-FIELD  REDEFINES  X-FIELD
000680                                 PIC 9(2)       COMP.
000681
000682 01  TIME-WORK.
000683     02  TIME-WK1                PIC XX.
000684     02  TIME-WK2                PIC XX.
000685     02  TIME-WK3                PIC XX.
000686
000690 01  HOLD-DATE.
000700     05  HOLD-MM                 PIC 99.
000710     05  FILLER                  PIC X.
000720     05  HOLD-DD                 PIC 99.
000730     05  FILLER                  PIC X.
000740     05  HOLD-YY                 PIC 99.
000750 01  EXTRACT-RECORD.
000760     05  EXTRACT-VOLUME          PIC X(6).
000770     05  EXTRACT-VOL-TYPE        PIC 9(4)  COMP.
000781         88  EXTRACT-3340            VALUE 10.
000782         88  EXTRACT-3350            VALUE 11.
000790         88  EXTRACT-3375            VALUE 12.
000791         88  EXTRACT-3330            VALUE 13.
000800     05  FILLER                  PIC X(4).
000810     05  EXTRACT-1ST-EXTENTS     OCCURS 8 TIMES
000820                                 INDEXED BY EXTENT1-INDEX.
000830         10  EXTRACT-1ST-REL-TRK PIC 9(4)       COMP.
000840         10  EXTRACT-1ST-CYLS    PIC 9(4)       COMP.
000850         10  EXTRACT-1ST-TRKS    PIC X(1).
000860     05  FILLER                  PIC X(1).
000870     05  EXTRACT-2ND-EXTENTS     OCCURS 18 TIMES
000880                                 INDEXED BY EXTENT2-INDEX.
000890         10  EXTRACT-2ND-REL-TRK PIC 9(4)       COMP.
000900         10  EXTRACT-2ND-CYLS    PIC 9(4)       COMP.
000910         10  EXTRACT-2ND-TRKS    PIC X(1).
000920     05  FILLER                  PIC X(5).
000931
000932 01  HEADING-LINE-1.
000933
000934     02  FILLER                  PIC X(25) VALUE
000935         'MUNICIPALITY OF ANCHORAGE'.
000936     02  FILLER                  PIC X(14) VALUE SPACES.
000937     02  FILLER                  PIC X(02) VALUE SPACES.
000938     02  FILLER                  PIC X(49)
000939         VALUE '   D I S K   M A N A G E M E N T   S Y S T E M'.
000940     02  FILLER                  PIC X(02) VALUE SPACES.
000941     02  FILLER                  PIC X(26) VALUE SPACES.
000942     02  FILLER                  PIC X(09) VALUE 'PAGE NO: '.
000943     02  PAGE-NO-HL1             PIC Z(5).
000944
000945 01  HEADING-LINE-2.
000946
000947     02  FILLER                  PIC X(25) VALUE
000948         'INFORMATION SYSTEMS DEPT.'.
000949     02  FILLER                  PIC X(93) VALUE SPACES.
000950     02  FILLER                  PIC X(06) VALUE 'DATE: '.
000951     02  DATE-HL2                PIC X(8)  VALUE SPACES.
000952
000953 01  HEADING-LINE-3.
000954
000955     02  FILLER                  PIC X(17) VALUE
000956         'REPORT: SSP504-R1'.
000957     02  FILLER                  PIC X(06) VALUE SPACES.
000958     02  FILLER                  PIC X(16) VALUE SPACES.
000959     02  REPORT-NAME-HL3         PIC X(53)
000960         VALUE '             AVAILABLE EXTENTS BY VOLUME'.
000961     02  FILLER                  PIC X(26) VALUE SPACES.
000962     02  FILLER                  PIC X(09) VALUE 'TIME:    '.
000963     02  TIME1-HL3               PIC X(2)  VALUE SPACES.
000964     02  FILLER                  PIC X(1)  VALUE ':'.
000965     02  TIME2-HL3               PIC X(2)  VALUE SPACES.
000966
000970 01  PRINT-LINES.
001260
001270     05  DETAIL-HEADING-1.
001280         10  FILLER              PIC X(9)       VALUE SPACES.
001290         10  FILLER              PIC X(6)
001300             VALUE 'EXTENT'.
001310         10  FILLER              PIC X(5)       VALUE SPACES.
001320         10  FILLER              PIC X(8)
001330             VALUE 'RELATIVE'.
001340         10  FILLER              PIC X(6)       VALUE SPACES.
001350         10  FILLER              PIC X(9)
001360             VALUE 'NUMBER OF'.
001370         10  FILLER              PIC X(5)       VALUE SPACES.
001380         10  FILLER              PIC X(6)
001390             VALUE 'EXTENT'.
001400         10  FILLER              PIC X(5)       VALUE SPACES.
001410         10  FILLER              PIC X(8)
001420             VALUE 'RELATIVE'.
001430         10  FILLER              PIC X(6)       VALUE SPACES.
001440         10  FILLER              PIC X(9)
001450             VALUE 'NUMBER OF'.
001460         10  FILLER              PIC X(5)       VALUE SPACES.
001470         10  FILLER              PIC X(6)
001480             VALUE 'EXTENT'.
001490         10  FILLER              PIC X(5)       VALUE SPACES.
001500         10  FILLER              PIC X(8)
001510             VALUE 'RELATIVE'.
001520         10  FILLER              PIC X(6)       VALUE SPACES.
001530         10  FILLER              PIC X(9)
001540             VALUE 'NUMBER OF'.
001550         10  FILLER              PIC X(10)      VALUE SPACES.
001560     SKIP1
001570     05  DETAIL-HEADING-2.
001580         10  FILLER              PIC X(10)      VALUE SPACES.
001590         10  FILLER              PIC X(3)
001600             VALUE 'NUM'.
001610         10  FILLER              PIC X(7)       VALUE SPACES.
001620         10  FILLER              PIC X(8)
001630             VALUE 'TRK ADDR'.
001640         10  FILLER              PIC X(6)       VALUE SPACES.
001650         10  FILLER              PIC X(10)
001660             VALUE 'AVAIL TRKS'.
001670         10  FILLER              PIC X(5)       VALUE SPACES.
001680         10  FILLER              PIC X(3)
001690             VALUE 'NUM'.
001700         10  FILLER              PIC X(7)       VALUE SPACES.
001710         10  FILLER              PIC X(8)
001720             VALUE 'TRK ADDR'.
001730         10  FILLER              PIC X(6)       VALUE SPACES.
001740         10  FILLER              PIC X(10)
001750             VALUE 'AVAIL TRKS'.
001760         10  FILLER              PIC X(5)       VALUE SPACES.
001770         10  FILLER              PIC X(3)
001780             VALUE 'NUM'.
001790         10  FILLER              PIC X(7)       VALUE SPACES.
001800         10  FILLER              PIC X(8)
001810             VALUE 'TRK ADDR'.
001820         10  FILLER              PIC X(6)       VALUE SPACES.
001830         10  FILLER              PIC X(10)
001840             VALUE 'AVAIL TRKS'.
001850         10  FILLER              PIC X(9)       VALUE SPACES.
001860     SKIP1
001870     05  DETAIL-LINE-1.
001880         10  FILLER              PIC X(10).
001890         10  DETAIL-PRINT-DATA   OCCURS 3 TIMES
001900                                 INDEXED BY DETAIL-INDEX.
001910             15  DETAIL-EXTENT-NUM
001920                                 PIC ZZ9.
001930             15  FILLER          PIC X(8).
001940             15  DETAIL-EXTENT-REL-TRK
001950                                 PIC ZZZ,ZZ9.
001960             15  FILLER          PIC X(8).
001970             15  DETAIL-AVAIL-TRKS
001980                                 PIC ZZ,ZZ9.
001990             15  FILLER          PIC X(8).
002000         10  FILLER              PIC X(2).
002010     SKIP1
002020     05  TOTAL-LINE-1.
002030         10  FILLER              PIC X(40)      VALUE SPACES.
002040         10  FILLER              PIC X(34)
002050             VALUE 'TOTAL AVAILABLE SPACE FOR VOLUME '.
002060         10  TOTAL-LINE-VOLUME   PIC X(6).
002070         10  FILLER              PIC X(1)       VALUE SPACES.
002080         10  TOTAL-LINE-TOTAL-TRKS              PIC ZZ,ZZ9.
002090         10  FILLER              PIC X(1)
002100             VALUE '/'.
002110         10  TOTAL-LINE-TOTAL-CYLS
002120                                 PIC ZZ9.
002130         10  FILLER              PIC X(47)      VALUE SPACES.
002230     EJECT
002240 PROCEDURE DIVISION.
002250
002251     MOVE TIME-OF-DAY TO TIME-WORK.
002252     MOVE TIME-WK1 TO TIME1-HL3.
002253     MOVE TIME-WK2 TO TIME2-HL3.
002254     MOVE CURRENT-DATE TO DATE-HL2.
002255
002256     PERFORM 0400-PRINT-HEADINGS.
002257
002260 0010-START-PROCESS SECTION.
002270
002370     MOVE CURRENT-DATE TO HOLD-DATE.
002410     OPEN OUTPUT REPORT-FILE.
002420
002430 0020-SORT SECTION.
002440*
002450*
002460*     SORT FOR DATA SET NAME PROCESSING
002470*
002480*
002490     SORT SORT-FILE
002500         ASCENDING SORT-VOLUME
002510             USING EXTRACT-INPUT
002520             OUTPUT PROCEDURE IS 0021-PROCESS.
002530     STOP RUN.
002540     SKIP2
002550 0021-PROCESS SECTION.
002551
002560     RETURN SORT-FILE
002570         AT END
002580             GO TO 0029-END-OF-INPUT.
002581
002590     MOVE SORT-RECORD TO EXTRACT-RECORD.
002600     MOVE EXTRACT-VOLUME TO VOLUME-HOLD.
002601
002602     MOVE ZEROS TO NUM-TRACKS-PER-CYLINDER.
002603
002610     IF EXTRACT-3340
002620         MOVE +12 TO NUM-TRACKS-PER-CYLINDER.
002621
002622     IF EXTRACT-3330
002623         MOVE +19 TO NUM-TRACKS-PER-CYLINDER.
002630
002640     IF EXTRACT-3350
002650         MOVE +30 TO NUM-TRACKS-PER-CYLINDER.
002660
002670     IF EXTRACT-3375
002680         MOVE +12 TO NUM-TRACKS-PER-CYLINDER.
002681
002683     SET EXTENT1-INDEX TO 1.
002690     SET DETAIL-INDEX TO 1.
002700
002710 0022-EXTENT1-PROCESS.
002711
002720     IF EXTRACT-1ST-EXTENTS (EXTENT1-INDEX) EQUAL LOW-VALUES
002730         GO TO 0100-CHECK-FOR-MORE.
002731
002740     IF EXTENT1-INDEX EQUAL 9
002750         SET EXTENT2-INDEX TO 1
002760         GO TO 0023-EXTENT2-PROCESS.
002761
002770     MOVE EXTRACT-1ST-REL-TRK (EXTENT1-INDEX) TO
002780          DETAIL-EXTENT-REL-TRK (DETAIL-INDEX).
002781
002790     ADD 1 TO INDEX-HOLD.
002800     MOVE INDEX-HOLD TO DETAIL-EXTENT-NUM (DETAIL-INDEX).
002810     MOVE EXTRACT-1ST-TRKS (EXTENT1-INDEX) TO
002820          COMP-DATA.
002830     COMPUTE WS-AVAIL-TRKS = (EXTRACT-1ST-CYLS (EXTENT1-INDEX) *
002840                              NUM-TRACKS-PER-CYLINDER) +
002850                              COMP-FIELD.
002860     MOVE WS-AVAIL-TRKS TO DETAIL-AVAIL-TRKS (DETAIL-INDEX).
002870     ADD WS-AVAIL-TRKS TO WS-TOTAL-TRACKS.
002880     SET EXTENT1-INDEX UP BY 1.
002890     IF DETAIL-INDEX EQUAL 3
002900         PERFORM 0300-PRINT-DETAIL
002910         SET DETAIL-INDEX TO 1
002920     ELSE
002930         SET DETAIL-INDEX UP BY 1.
002940     GO TO 0022-EXTENT1-PROCESS.
002950     SKIP2
002960 0023-EXTENT2-PROCESS.
002970     IF EXTRACT-2ND-EXTENTS (EXTENT2-INDEX) EQUAL LOW-VALUES
002980         GO TO 0100-CHECK-FOR-MORE.
002990     IF EXTENT2-INDEX EQUAL TO 19
003000         GO TO 0100-CHECK-FOR-MORE.
003010     MOVE EXTRACT-2ND-REL-TRK (EXTENT2-INDEX) TO
003020          DETAIL-EXTENT-REL-TRK (DETAIL-INDEX).
003030     ADD 1 TO INDEX-HOLD.
003040     MOVE INDEX-HOLD TO DETAIL-EXTENT-NUM (DETAIL-INDEX).
003050     MOVE EXTRACT-2ND-TRKS (EXTENT2-INDEX) TO
003060          COMP-DATA.
003070     COMPUTE WS-AVAIL-TRKS = (EXTRACT-2ND-CYLS (EXTENT2-INDEX) *
003080                              NUM-TRACKS-PER-CYLINDER) +
003090                              COMP-FIELD.
003100     MOVE WS-AVAIL-TRKS TO DETAIL-AVAIL-TRKS (DETAIL-INDEX).
003110     ADD WS-AVAIL-TRKS TO WS-TOTAL-TRACKS.
003120     SET EXTENT2-INDEX UP BY 1.
003130     IF DETAIL-INDEX EQUAL 3
003140         PERFORM 0300-PRINT-DETAIL
003150         SET DETAIL-INDEX TO 1
003160     ELSE
003170         SET DETAIL-INDEX UP BY 1.
003180     GO TO 0023-EXTENT2-PROCESS.
003190     SKIP2
003200 0028-END-OF-REC.
003210     PERFORM 0300-PRINT-DETAIL.
003220     IF VOLUME-SWITCH EQUAL HIGH-VALUES
003230         MOVE VOLUME-HOLD TO TOTAL-LINE-VOLUME
003240     ELSE
003250         MOVE EXTRACT-VOLUME TO TOTAL-LINE-VOLUME.
003260     MOVE WS-TOTAL-TRACKS TO TOTAL-LINE-TOTAL-TRKS.
003270     DIVIDE WS-TOTAL-TRACKS BY
003280         NUM-TRACKS-PER-CYLINDER
003290             GIVING TOTAL-LINE-TOTAL-CYLS.
003300     PERFORM 0500-PRINT-TOTAL-LINE.
003310     IF VOLUME-SWITCH EQUAL HIGH-VALUES
003320         MOVE EXTRACT-VOLUME TO VOLUME-HOLD
003330         SET EXTENT1-INDEX TO 1
003340         SET DETAIL-INDEX TO 1
003350         GO TO 0022-EXTENT1-PROCESS
003360     ELSE
003370         GO TO 0021-PROCESS.
003380     SKIP2
003390 0029-END-OF-INPUT.
003400     MOVE EXTRACT-VOLUME TO TOTAL-LINE-VOLUME.
003410     MOVE WS-TOTAL-TRACKS TO TOTAL-LINE-TOTAL-TRKS.
003420     DIVIDE WS-TOTAL-TRACKS BY
003430         NUM-TRACKS-PER-CYLINDER
003440             GIVING TOTAL-LINE-TOTAL-CYLS.
003450     PERFORM 0500-PRINT-TOTAL-LINE.
003460     EJECT
003470 0100-CHECK-FOR-MORE.
003480     MOVE EXTRACT-VOLUME TO VOLUME-HOLD.
003490     RETURN SORT-FILE
003500        AT END
003510            GO TO 0029-END-OF-INPUT.
003520     MOVE SORT-RECORD TO EXTRACT-RECORD.
003530     IF EXTRACT-VOLUME = VOLUME-HOLD
003540         SET EXTENT1-INDEX TO 1
003550         GO TO 0022-EXTENT1-PROCESS
003560     ELSE
003570         MOVE HIGH-VALUES TO VOLUME-SWITCH
003580         GO TO 0028-END-OF-REC.
003590     EJECT
003600 0300-PRINT-SECTION SECTION.
003610 0300-PRINT-DETAIL.
003620     IF LINE-CNT GREATER THAN 50
003630         PERFORM 0400-PRINT-HEADINGS.
003640     WRITE REPORT-REC FROM DETAIL-LINE-1 AFTER 1.
003650     MOVE SPACES TO DETAIL-LINE-1.
003660     ADD 1 TO LINE-CNT.
003670     SKIP2
003680 0400-PRINT-HEADINGS.
003690
003700     ADD 1 TO PAGE-CNT.
003710     MOVE PAGE-CNT TO PAGE-NO-HL1.
003711     WRITE REPORT-REC FROM HEADING-LINE-1 AFTER TO-TOP.
003712     MOVE ZEROS TO LINE-CNT.
003713     WRITE REPORT-REC FROM HEADING-LINE-2 AFTER 1.
003714     WRITE REPORT-REC FROM HEADING-LINE-3 AFTER 1.
003715     MOVE ALL '-' TO REPORT-REC.
003716     WRITE REPORT-REC AFTER 1.
003717     WRITE REPORT-REC FROM DETAIL-HEADING-1 AFTER 1.
003718     WRITE REPORT-REC FROM DETAIL-HEADING-2 AFTER 1.
003719     MOVE ALL '-' TO REPORT-REC.
003720     WRITE REPORT-REC AFTER 1.
003800     MOVE SPACES TO REPORT-REC.
003810     WRITE REPORT-REC AFTER 1.
003820     SKIP2
003830 0500-PRINT-TOTAL-LINE.
003840     WRITE REPORT-REC FROM TOTAL-LINE-1 AFTER 2.
003850     MOVE SPACES TO REPORT-REC.
003860     WRITE REPORT-REC AFTER 1.
003870     ADD 3 TO LINE-CNT.
003880     MOVE ZEROS TO WS-TOTAL-TRACKS.
003890     MOVE ZEROS TO INDEX-HOLD.
003900     SET DETAIL-INDEX TO 1.

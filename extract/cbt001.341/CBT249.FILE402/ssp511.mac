000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.    SSP511.
000300 AUTHOR.        MOA ANCHORAGE.
000310
000320
000330*****************************************************************
000340*****************************************************************
000350**                                                             **
000360**                                                             **
000370**            DDDDDDDDD     MM        MM   SSSSSSSSSS          **
000380**            DDDDDDDDDD    MMM      MMM  SSSSSSSSSSSS         **
000390**            DD       DD   MMMM    MMMM  SS        SS         **
000391**            DD        DD  MM MM  MM MM  SS                   **
000392**            DD        DD  MM  MMMM  MM  SSS                  **
000393**            DD        DD  MM   MM   MM   SSSSSSSSS           **
000394**            DD        DD  MM        MM    SSSSSSSSS          **
000395**            DD        DD  MM        MM           SSS         **
000396**            DD        DD  MM        MM            SS         **
000397**            DD       DD   MM        MM  SS        SS         **
000398**            DDDDDDDDDD    MM        MM  SSSSSSSSSSSS         **
000399**            DDDDDDDDD     MM        MM   SSSSSSSSSS          **
000400**                                                             **
000401**                                                             **
000402**        M U N I C I P A L I T Y   O F   A N C H O R A G E    **
000403**                                                             **
000404**           D I S K   M A N A G E M E N T   S Y S T E M       **
000405**                                                             **
000406*****************************************************************
000407*****************************************************************
000408
000409
000410 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SOURCE-COMPUTER.  IBM-370.
000700 OBJECT-COMPUTER.  IBM-370.
000800
000900 SPECIAL-NAMES.
001000     C01 IS TO-TOP.
001100
001200 INPUT-OUTPUT SECTION.
001300
001400 FILE-CONTROL.
001500
001600     SELECT SUMMARY-FILE
001700         ASSIGN TO UT-DMSSUMM.
001710
001720     SELECT BILLING-FILE
001730         ASSIGN TO UT-DMSBILL.
001800
001900     SELECT REPORT-FILE
002000         ASSIGN TO UT-DMSRPT.
002100
002200     SELECT ACCT-MASTER
002300         ASSIGN TO DMSACCT
002400         ORGANIZATION IS INDEXED
002500         ACCESS MODE IS RANDOM
002600         RECORD KEY IS AR-NODE
002700         FILE STATUS IS VSAM-STATUS.
002800
002900     SELECT SORT-FILE
003000         ASSIGN TO UT-S-SORTWK01.
003100
003200 DATA DIVISION.
003300 FILE SECTION.
003400
003500 FD  SUMMARY-FILE
003600     RECORDING MODE IS F
003700     LABEL RECORDS ARE STANDARD
003800     RECORD CONTAINS 53 CHARACTERS
003900     BLOCK CONTAINS 0 RECORDS
004000     DATA RECORD IS SUMMARY-REC.
004100
004200 01  SUMMARY-REC.
004300     05  SR-NODE                 PIC X(17).
004400     05  SR-TYPE                 PIC X(4).
004500     05  SR-DATE                 PIC X(8).
004600     05  SR-TOT-3340             PIC 9(6).
004700     05  SR-TOT-3350             PIC 9(6).
004800     05  SR-TOT-3375             PIC 9(6).
004900     05  SR-TOT-3380             PIC 9(6).
004910
004920 FD  BILLING-FILE
004930     RECORDING MODE IS F
004940     LABEL RECORDS ARE STANDARD
004960     BLOCK CONTAINS 0 RECORDS.
004970     COPY ACCTREC.
005000
005100 FD  REPORT-FILE
005200     RECORDING MODE IS F
005300     LABEL RECORDS ARE STANDARD
005400     RECORD CONTAINS 133 CHARACTERS
005500     BLOCK CONTAINS 0 RECORDS
005600     DATA RECORD IS REPORT-REC.
005700
005800 01  REPORT-REC.
005900     05  FILLER                  PIC X(133).
006000
006100 FD  ACCT-MASTER
006200     LABEL RECORDS ARE STANDARD
006300     RECORD CONTAINS 80 CHARACTERS
006400     DATA RECORD IS ACCT-REC.
006500
006600 01  ACCT-REC.
006700     05  AR-NODE                 PIC X(17).
006800     05  AR-ACCT                 PIC X(6).
006900     05  AR-PROJ                 PIC X(4).
007000     05  AR-NAME1                PIC X(25).
007100     05  AR-NAME2                PIC X(25).
007200     05  FILLER                  PIC X(3).
007300
007400 SD  SORT-FILE
007500     DATA RECORD IS SORT-RECORD.
007600
007700 01  SORT-RECORD.
007800     05  SORT-NODE                 PIC X(17).
007900     05  SORT-ACCT                 PIC X(6).
008000     05  SORT-PROJ                 PIC X(4).
008100     05  SORT-TYPE                 PIC X(4).
008200     05  SORT-DATE                 PIC X(8).
008300     05  SORT-TOT-3340             PIC 9(6).
008400     05  SORT-TOT-3350             PIC 9(6).
008500     05  SORT-TOT-3375             PIC 9(6).
008600     05  SORT-TOT-3380             PIC 9(6).
008700     EJECT
008800 WORKING-STORAGE SECTION.
008900 77  LINE-CNT                    PIC S9(3)      COMP-3
009000                                                VALUE +999.
009100 77  PAGE-CNT                    PIC S9(3)      VALUE ZEROS
009200                                                COMP-3.
009300 77  SUMM-3340                   PIC S9(7)      VALUE ZEROS
009400                                                COMP-3.
009500 77  SUMM-3350                   PIC S9(7)      VALUE ZEROS
009600                                                COMP-3.
009700 77  SUMM-3375                   PIC S9(7)      VALUE ZEROS
009800                                                COMP-3.
009900 77  SUMM-3380                   PIC S9(7)      VALUE ZEROS
010000                                                COMP-3.
010100 77  MB-3340                     PIC S9(6)V99   VALUE ZEROS
010200                                                COMP-3.
010300 77  MB-3350                     PIC S9(6)V99   VALUE ZEROS
010400                                                COMP-3.
010500 77  MB-3375                     PIC S9(6)V99   VALUE ZEROS
010600                                                COMP-3.
010700 77  MB-3380                     PIC S9(6)V99   VALUE ZEROS
010800                                                COMP-3.
010810 77  MB-TOTAL                    PIC S9(8)V99   VALUE ZEROS
010820                                                COMP-3.
010900 77  MB-WORK                     PIC S9(6)V99   VALUE ZEROS
011000                                                COMP-3.
011100
011200 01  OLD-KEY.
011300     02  OK-ACCT                 PIC X(6)       VALUE LOW-VALUE.
011400     02  OK-PROJ                 PIC X(4)       VALUE LOW-VALUE.
011500
011600 01  NEW-KEY.
011700     02  NK-ACCT                 PIC X(6)       VALUE SPACES.
011800     02  NK-PROJ                 PIC X(4)       VALUE SPACES.
011900
012000 01  TIME-WORK.
012100     02  TIME-WK1                PIC XX.
012200     02  TIME-WK2                PIC XX.
012300     02  TIME-WK3                PIC XX.
012400
012500 01  HOLD-DATE.
012600     05  HOLD-MM                 PIC 99.
012700     05  FILLER                  PIC X.
012800     05  HOLD-DD                 PIC 99.
012900     05  FILLER                  PIC X.
013000     05  HOLD-YY                 PIC 99.
013100
013200 01  OLD-DATE-NUM                PIC 9(6).
013300 01  OLD-DATE REDEFINES OLD-DATE-NUM.
013400     05  OLD-DATE-YY             PIC 99.
013500     05  OLD-DATE-MM             PIC 99.
013600     05  OLD-DATE-DD             PIC 99.
013700
013800 01  HOLD-DATE-2.
013900
014000     05  HOLD-DATE-NUM           PIC 9(7).
014100     05  HOLD-DATE-GRP  REDEFINES HOLD-DATE-NUM.
014200         10  FILLER              PIC X.
014300         10  HOLD-DATE-GRP-MM    PIC 9(2).
014400         10  HOLD-DATE-GRP-DD    PIC 9(2).
014500         10  HOLD-DATE-GRP-YY    PIC 9(2).
014600
014700 01  VSAM-STATUS-AREA.
014800     03  VSAM-STATUS.
014900         05  VSAM-STAT-BYTE1     PIC X(1).
015000             88  STATUS-OK                  VALUE '0'.
015100             88  STATUS-AT-END              VALUE '1'.
015200             88  STATUS-INVALID-KEY         VALUE '2'.
015300             88  STATUS-ERROR               VALUE '3'.
015400             88  STATUS-OTHER               VALUE '9'.
015500             88  STATUS-ABORT               VALUE '1' '3' '9'.
015600         05  VSAM-STAT-BYTE2     PIC X(1).
015700     03  VSAM-STAT-BOTH REDEFINES VSAM-STATUS PIC X(2).
015800         88  DUPLICATE-RECORD               VALUE '22'.
015900
015910 01  REPORT-ID                   PIC X(53)
015920         VALUE '               DASD UTILIZATION SUMMARY'.
016000
016100 01  HEADING-LINE-1.
016200
016300     02  FILLER                  PIC X(25) VALUE
016400         'MUNICIPALITY OF ANCHORAGE'.
016500     02  FILLER                  PIC X(14) VALUE SPACES.
016600     02  FILLER                  PIC X(02) VALUE SPACES.
016700     02  FILLER                  PIC X(49)
016800         VALUE '   D I S K   M A N A G E M E N T   S Y S T E M'.
016900     02  FILLER                  PIC X(02) VALUE SPACES.
017000     02  FILLER                  PIC X(26) VALUE SPACES.
017100     02  FILLER                  PIC X(09) VALUE 'PAGE NO: '.
017200     02  PAGE-NO-HL1             PIC Z(5).
017300
017400 01  HEADING-LINE-2.
017500
017600     02  FILLER                  PIC X(25) VALUE
017700         'INFORMATION SYSTEMS DEPT.'.
017800     02  FILLER                  PIC X(93) VALUE SPACES.
017900     02  FILLER                  PIC X(06) VALUE 'DATE: '.
018000     02  DATE-HL2                PIC X(8)  VALUE SPACES.
018100
018200 01  HEADING-LINE-3.
018300
018400     02  FILLER                  PIC X(16) VALUE
018500         'REPORT: SSP511-R'.
018600     02  REPORT-NO-HL3           PIC X(02) VALUE '01'.
018700     02  FILLER                  PIC X(05) VALUE SPACES.
018800     02  FILLER                  PIC X(16) VALUE SPACES.
018900     02  REPORT-NAME-HL3         PIC X(53) VALUE SPACES.
019000     02  FILLER                  PIC X(26) VALUE SPACES.
019100     02  FILLER                  PIC X(09) VALUE 'TIME:    '.
019200     02  TIME1-HL3               PIC X(2)  VALUE SPACES.
019300     02  FILLER                  PIC X(1)  VALUE ':'.
019400     02  TIME2-HL3               PIC X(2)  VALUE SPACES.
019500
019600 01  DETAIL-HEADING-1.
019700
019800     02  FILLER                  PIC X(17)
019810         VALUE ' WORK            '.
019820     02  FILLER                  PIC X(24)
019830         VALUE '<---------3340--------->'.
019840     02  FILLER                  PIC X(24)
019850         VALUE '<---------3350--------->'.
019860     02  FILLER                  PIC X(24)
019870         VALUE '<---------3375--------->'.
019880     02  FILLER                  PIC X(24)
019890         VALUE '<---------3380--------->'.
019900
020000 01  DETAIL-HEADING-2.
020100
020210     02  FILLER                  PIC X(17)
020220         VALUE ' AUTH    PROJ    '.
020230     02  FILLER                  PIC X(24)
020240         VALUE '   TRACKS     MEGABYTES '.
020250     02  FILLER                  PIC X(24)
020260         VALUE '   TRACKS     MEGABYTES '.
020270     02  FILLER                  PIC X(24)
020280         VALUE '   TRACKS     MEGABYTES '.
020290     02  FILLER                  PIC X(24)
020291         VALUE '   TRACKS     MEGABYTES '.
020292     02  FILLER                  PIC X(24)
020293         VALUE '  TOTAL MEGABYTES       '.
020300
020400 01  PRINT-AREA                  PIC X(132) VALUE SPACES.
020500
020600 01  PRINT-LINE REDEFINES PRINT-AREA.
020700
020800     05  PL-ACCT                 PIC X(06).
020900     05  FILLER                  PIC X(3).
021000     05  PL-PROJ                 PIC X(06).
021100     05  FILLER                  PIC X(3).
021200     05  PL-TRKS-3340            PIC Z,ZZZ,ZZZ.
021300     05  FILLER                  PIC X(1).
021400     05  PL-MB-3340              PIC ZZ,ZZZ,ZZZ.99.
021500     05  FILLER                  PIC X(1).
021600     05  PL-TRKS-3350            PIC Z,ZZZ,ZZZ.
021700     05  FILLER                  PIC X(1).
021800     05  PL-MB-3350              PIC ZZ,ZZZ,ZZZ.99.
021900     05  FILLER                  PIC X(1).
022000     05  PL-TRKS-3375            PIC Z,ZZZ,ZZZ.
022100     05  FILLER                  PIC X(1).
022200     05  PL-MB-3375              PIC ZZ,ZZZ,ZZZ.99.
022300     05  FILLER                  PIC X(1).
022400     05  PL-TRKS-3380            PIC Z,ZZZ,ZZZ.
022500     05  FILLER                  PIC X(1).
022600     05  PL-MB-3380              PIC ZZ,ZZZ,ZZZ.99.
022610     05  FILLER                  PIC X(3).
022620     05  PL-MB-TOTAL             PIC ZZZ,ZZZ,ZZZ.99.
022700
022800 PROCEDURE DIVISION.
022900
023000     OPEN INPUT  SUMMARY-FILE
023010          OUTPUT BILLING-FILE
023100                 REPORT-FILE.
023200
023300     MOVE REPORT-ID TO REPORT-NAME-HL3.
023400     MOVE TIME-OF-DAY TO TIME-WORK.
023500     MOVE TIME-WK1 TO TIME1-HL3.
023600     MOVE TIME-WK2 TO TIME2-HL3.
023700     MOVE CURRENT-DATE TO DATE-HL2.
023800
023900     PERFORM PRINT-HEADINGS.
024000
024100     OPEN INPUT ACCT-MASTER.
024200
024300     IF STATUS-ABORT
024400         STRING 'SSP511-01 UNABLE TO OPEN ACCOUNT MASTER'
024500                ' FILE STATUS='
024600                VSAM-STATUS
024700                DELIMITED BY SIZE
024800                INTO PRINT-AREA
024900                PERFORM WRITE-REPORT
025000                GO TO CLOSE-FILES.
025100
025200     SORT SORT-FILE
025300         ASCENDING SORT-ACCT SORT-PROJ
025400             INPUT  PROCEDURE IS INPUT-PROCESS
025500             OUTPUT PROCEDURE IS OUTPUT-PROCESS.
025600
025700 CLOSE-FILES.
025800
025900     CLOSE SUMMARY-FILE
026000           REPORT-FILE
026010           BILLING-FILE
026100           ACCT-MASTER.
026200
026300     STOP RUN.
026400
026500 INPUT-PROCESS SECTION.
026510
026520 INPUT-PROCESS-READ.
026600
026700     READ SUMMARY-FILE
026800         AT END GO TO INPUT-PROCESS-EXIT.
026810
026820     IF SR-TYPE IS EQUAL TO 'VOL '
026830         GO TO INPUT-PROCESS-READ.
026900
027000     MOVE SR-NODE TO SORT-NODE.
027100     MOVE SR-TYPE TO SORT-TYPE.
027200     MOVE SR-DATE TO SORT-DATE.
027300     MOVE SR-TOT-3340 TO SORT-TOT-3340.
027400     MOVE SR-TOT-3350 TO SORT-TOT-3350.
027500     MOVE SR-TOT-3375 TO SORT-TOT-3375.
027600     MOVE SR-TOT-3380 TO SORT-TOT-3380.
027700
027800     MOVE SR-NODE TO AR-NODE.
027900
028000     READ ACCT-MASTER.
028100
028200     IF STATUS-ABORT
028300         STRING 'SSP511-02 VSAM ERROR ON ACCOUNT MASTER'
028400                ' FILE STATUS='
028500                VSAM-STATUS
028600                DELIMITED BY SIZE
028700                INTO PRINT-AREA
028800                PERFORM WRITE-REPORT
028900                GO TO CLOSE-FILES.
029000
029100     IF STATUS-OK
029200         MOVE AR-ACCT TO SORT-ACCT
029300         MOVE AR-PROJ TO SORT-PROJ
029400         ELSE
029500             MOVE 'UNK' TO SORT-ACCT
029600             MOVE 'UNK' TO SORT-PROJ
029601             STRING 'SSP511-03 INVALID NODE ='
029602                    SR-NODE
029604                    DELIMITED BY SIZE
029605                    INTO PRINT-AREA
029606                    PERFORM WRITE-REPORT.
029700
029800     RELEASE SORT-RECORD.
029900
030000     GO TO INPUT-PROCESS.
030100
030200 INPUT-PROCESS-EXIT.
030300
030400     EXIT.
030500
030600 OUTPUT-PROCESS SECTION.
030700
030800     RETURN SORT-FILE
030900         AT END PERFORM TOTAL-PROCESS
031000         GO TO OUTPUT-PROCESS-EXIT.
031100
031200     MOVE SORT-ACCT TO NK-ACCT.
031300     MOVE SORT-PROJ TO NK-PROJ.
031400
031500     IF OLD-KEY IS EQUAL TO LOW-VALUE
031600         MOVE NEW-KEY TO OLD-KEY.
031700
031800     IF OLD-KEY IS NOT EQUAL TO NEW-KEY
031900         PERFORM TOTAL-PROCESS
032000         MOVE NEW-KEY TO OLD-KEY.
032100
032200     ADD SORT-TOT-3340 TO SUMM-3340.
032300     ADD SORT-TOT-3350 TO SUMM-3350.
032400     ADD SORT-TOT-3375 TO SUMM-3375.
032500     ADD SORT-TOT-3380 TO SUMM-3380.
032600
032700     GO TO OUTPUT-PROCESS.
032800
032900 TOTAL-PROCESS.
033000
033100     MOVE OK-ACCT TO PL-ACCT.
033200     MOVE OK-PROJ TO PL-PROJ.
033300     MOVE SUMM-3340 TO PL-TRKS-3340.
033400     MOVE SUMM-3350 TO PL-TRKS-3350.
033500     MOVE SUMM-3375 TO PL-TRKS-3375.
033600     MOVE SUMM-3380 TO PL-TRKS-3380.
033610
033620     MOVE ZEROS TO MB-TOTAL.
033700
033800     COMPUTE MB-WORK = SUMM-3340 * 8368 / 1000000.
033810     ADD MB-WORK TO MB-TOTAL.
033900     MOVE MB-WORK TO PL-MB-3340.
034000
034100     COMPUTE MB-WORK = SUMM-3350 * 19069 / 1000000.
034110     ADD MB-WORK TO MB-TOTAL.
034200     MOVE MB-WORK TO PL-MB-3350.
034300
034400     COMPUTE MB-WORK = SUMM-3375 * 35616 / 1000000.
034410     ADD MB-WORK TO MB-TOTAL.
034500     MOVE MB-WORK TO PL-MB-3375.
034600
034700     COMPUTE MB-WORK = SUMM-3380 * 47476 / 1000000.
034710     ADD MB-WORK TO MB-TOTAL.
034800     MOVE MB-WORK TO PL-MB-3380.
034810
034820     MOVE MB-TOTAL TO PL-MB-TOTAL.
034900
035000     PERFORM WRITE-REPORT.
035010
035020     MOVE SPACES TO ACCTREC.
035030     MOVE '5' TO HDR1.
035040     MOVE 'NV' TO DISKID.
035050     MOVE 'DISK' TO SYSTEM-ID.
035060     MOVE OK-ACCT TO CHARGE-CODE.
035070     MOVE OK-ACCT TO TASK-CODE.
035080     MOVE MB-TOTAL TO DISK-SPACE.
035090     WRITE ACCTREC.
035100
035200     MOVE ZEROS TO SUMM-3340
035300                   SUMM-3350
035400                   SUMM-3375
035500                   SUMM-3380.
035600
035700 OUTPUT-PROCESS-EXIT.
035800
035900     EXIT.
036000
036100 WRITE-REPORT SECTION.
036200
036300     IF LINE-CNT IS GREATER THAN 55
036400         PERFORM PRINT-HEADINGS.
036500
036600     WRITE REPORT-REC FROM PRINT-AREA AFTER 2.
036700
036800     ADD 2 TO LINE-CNT.
036810
036820     MOVE SPACES TO PRINT-AREA.
036900
037000 PRINT-HEADINGS SECTION.
037100
037200     ADD 1 TO PAGE-CNT.
037300     MOVE PAGE-CNT TO PAGE-NO-HL1.
037310     MOVE SPACES TO REPORT-REC.
037400     WRITE REPORT-REC AFTER TO-TOP.
037410     WRITE REPORT-REC FROM HEADING-LINE-1 AFTER 1.
037500     MOVE ZEROS TO LINE-CNT.
037600     WRITE REPORT-REC FROM HEADING-LINE-2 AFTER 1.
037700     WRITE REPORT-REC FROM HEADING-LINE-3 AFTER 1.
037800     MOVE ALL '-' TO REPORT-REC.
037900     WRITE REPORT-REC AFTER 1.
038000     WRITE REPORT-REC FROM DETAIL-HEADING-1 AFTER 1.
038100     WRITE REPORT-REC FROM DETAIL-HEADING-2 AFTER 1.
038200     MOVE ALL '-' TO REPORT-REC.
038300     WRITE REPORT-REC AFTER 1.
038400     MOVE SPACES TO REPORT-REC.
038500     WRITE REPORT-REC AFTER 1.
038600     MOVE 8 TO LINE-CNT.

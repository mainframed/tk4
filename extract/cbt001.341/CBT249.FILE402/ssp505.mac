000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.   SSP505.
000310
000320
000330*****************************************************************
000340*****************************************************************
000350**                                                             **
000360**                                                             **
000370**             SSSSSSSSSS   MM        MM   SSSSSSSSSS          **
000380**            SSSSSSSSSSSS  MMM      MMM  SSSSSSSSSSSS         **
000390**            SS        SS  MMMM    MMMM  SS        SS         **
000391**            SS            MM MM  MM MM  SS                   **
000392**            SSS           MM  MMMM  MM  SSS                  **
000393**             SSSSSSSSS    MM   MM   MM   SSSSSSSSS           **
000394**              SSSSSSSSS   MM        MM    SSSSSSSSS          **
000395**                     SSS  MM        MM           SSS         **
000396**                      SS  MM        MM            SS         **
000397**            SS        SS  MM        MM  SS        SS         **
000398**            SSSSSSSSSSSS  MM        MM  SSSSSSSSSSSS         **
000399**             SSSSSSSSSS   MM        MM   SSSSSSSSSS          **
000400**                                                             **
000401**                                                             **
000402**        M U N I C I P A L I T Y   O F   A N C H O R A G E    **
000403**                                                             **
000404**          S P A C E   M A N A G E M E N T   S Y S T E M      **
000405**                                                             **
000406*****************************************************************
000407*****************************************************************
000408
000409
000410 ENVIRONMENT DIVISION.
000500 CONFIGURATION SECTION.
000600 SOURCE-COMPUTER.  IBM-370.
000700 OBJECT-COMPUTER.  IBM-370.
000800
000900 SPECIAL-NAMES.
001000     C01 IS TO-TOP.
001100
001200 INPUT-OUTPUT SECTION.
001300
001400 FILE-CONTROL.
001500     SELECT INPUT-EXTRACT
001600            ASSIGN TO UT-S-DMSEXT.
001700     SELECT OUTPUT-REPORT
001800            ASSIGN TO UT-S-DMSRPT.
001900     SELECT MESSAGE-REPORT
002000            ASSIGN TO UT-S-DMSMSG.
002100     SELECT OUTPUT-SCRATCH-CARDS
002200            ASSIGN TO UT-S-DMSSCR.
002300     SELECT ARCHIVE-CARDS
002400            ASSIGN TO UT-S-DMSARCH.
002500     SELECT EXCLUDE-CARDS
002600            ASSIGN TO UT-S-DMSEXC.
002700     SELECT VAT-CARDS
002800            ASSIGN TO UT-S-VATLIST.
002900     SELECT DSN-MASTER
003000            ASSIGN TO DMSDSN
003100            ORGANIZATION IS INDEXED
003200            ACCESS MODE IS RANDOM
003300            RECORD KEY IS DSN-KEY
003400            FILE STATUS IS VSAM-STATUS.
003500
003600 DATA DIVISION.
003700
003800 FILE SECTION.
003900
004000 FD  INPUT-EXTRACT
004100     RECORDING MODE IS F
004200     LABEL RECORDS ARE STANDARD
004300     RECORD CONTAINS 105 CHARACTERS
004400     BLOCK CONTAINS 0 RECORDS
004500     DATA RECORD IS EXTRACT-REC.
004600     SKIP1
004700 01  EXTRACT-REC.
004800     05  EXTRACT-DSN.
004900          10  EXTRACT-DSN-1ST-8.
005000             15  EXTRACT-DSN-1ST-4.
005100                 20  EXTRACT-DSN-1ST-3.
005200                     25  FILLER  PIC X(2).
005300                     25  EXTRACT-DSN-3RD PIC X(1).
005400                 20  FILLER      PIC X(1).
005500             15  FILLER          PIC X(4).
005600         10  EXTRACT-DSN-9TH     PIC X(1).
005700         10  FILLER              PIC X(35).
005800     05  EXTRACT-DSN1 REDEFINES EXTRACT-DSN.
005900         10  FILLER              PIC X(3).
006000         10  EXTRACT-DSN-4-5     PIC X(2).
006100         10  FILLER              PIC X(39).
006200     05  EXTRACT-DSN2 REDEFINES EXTRACT-DSN1.
006300         10  EXTRACT-DSN-OCC     PIC X(1)   OCCURS 44.
006400     05  EXTRACT-CREATE-DATE     PIC S9(7)  COMP-3.
006500     05  EXTRACT-EXPIR-DATE      PIC S9(7)  COMP-3.
006600     05  EXTRACT-NUM-EXTENTS     PIC  9(4)  COMP.
006700     05  EXTRACT-DSORG           PIC  X(2).
006800     05  EXTRACT-RECFM           PIC  X(3).
006900     05  EXTRACT-LRECL           PIC  9(4)  COMP.
007000     05  EXTRACT-BLKSIZE         PIC  9(4)  COMP.
007100     05  EXTRACT-KEYLEN          PIC  9(4)  COMP.
007200     05  EXTRACT-RKP             PIC  9(4)  COMP.
007300     05  EXTRACT-ALLOC-PRM       PIC  X(3).
007400     05  EXTRACT-RES-VOLSER.
007500         10  EXTRACT-RES-VOLSER-1-3  PIC  X(3).
007600         10  FILLER                  PIC  X(3).
007700     05  EXTRACT-DEVT            PIC  X(4).
007800     05  EXTRACT-SPACE-ALLOC     PIC S9(9)  COMP-3.
007900     05  EXTRACT-SPACE-USED      PIC S9(9)  COMP-3.
008000     05  EXTRACT-CVOL            PIC  X(6).
008100     05  EXTRACT-CAT-VOL         PIC  X(6).
008200     05  FILLER                  PIC  X(3).
008300
008400 FD  OUTPUT-REPORT
008500     RECORDING MODE IS F
008600     LABEL RECORDS ARE STANDARD
008700     RECORD CONTAINS 133 CHARACTERS
008800     BLOCK CONTAINS 1 RECORDS
008900     DATA RECORD IS REPORT-REC.
009000
009100 01  REPORT-REC                  PIC X(133).
009200
009300 FD  MESSAGE-REPORT
009400     RECORDING MODE IS F
009500     LABEL RECORDS ARE STANDARD
009600     RECORD CONTAINS 133 CHARACTERS
009700     BLOCK CONTAINS 1 RECORDS
009800     DATA RECORD IS MESSAGE-REC.
009900
010000 01  MESSAGE-REC                  PIC X(133).
010100
010200 FD  OUTPUT-SCRATCH-CARDS
010300     RECORDING MODE IS F
010400     LABEL RECORDS ARE STANDARD
010500     RECORD CONTAINS 80 CHARACTERS
010600     BLOCK CONTAINS 0 RECORDS
010700     DATA RECORD IS SCRATCH-REC.
010800
010900 01  SCRATCH-REC                 PIC X(80).
011000
011100 FD  ARCHIVE-CARDS
011200     RECORDING MODE IS F
011300     LABEL RECORDS ARE STANDARD
011400     RECORD CONTAINS 80 CHARACTERS
011500     BLOCK CONTAINS 0 RECORDS
011600     DATA RECORD IS ARCHIVE-REC.
011700
011800 01  ARCHIVE-REC                 PIC X(80).
011900
012000 FD  EXCLUDE-CARDS
012100     RECORDING MODE IS F
012200     LABEL RECORDS ARE STANDARD
012300     RECORD CONTAINS 80 CHARACTERS
012400     BLOCK CONTAINS 0 RECORDS
012500     DATA RECORD IS EXCLUDE-REC.
012600
012700 01  EXCLUDE-REC.
012800     05  EXCLUDE-1ST-3           PIC X(3).
012900     05  FILLER                  PIC X(77).
013000
013100 FD  VAT-CARDS
013200     RECORDING MODE IS F
013300     LABEL RECORDS ARE STANDARD
013400     RECORD CONTAINS 80 CHARACTERS
013500     BLOCK CONTAINS 0 RECORDS
013600     DATA RECORD IS VAT-REC.
013700
013800 01  VAT-REC.
013900     05  VOLSER-VR               PIC X(6).
014000     05  FILLER                  PIC X(5).
014100     05  DEVT-VR                 PIC X(4).
014200     05  FILLER                  PIC X(65).
014300
014400 FD  DSN-MASTER
014500     LABEL RECORDS ARE STANDARD
014600     RECORD CONTAINS 300 CHARACTERS
014700     DATA RECORD IS DSN-REC.
014800
014900 01  DSN-REC.
015000
015100     05  DSN-KEY                 PIC X(44).
015200     05  DSN-CREATE-DATE         PIC 9(6).
015300     05  DSN-CHG-DATE            PIC 9(6).
015400     05  DSN-STRUCTURE           PIC X(4).
015500     05  DSN-SIZE                PIC 9(5).
015600     05  DSN-GROTH               PIC 9(3).
015700     05  DSN-GDG                 PIC 9(2).
015800     05  DSN-DEV-TYPE            PIC X(4).
015900     05  DSN-VOLSER              PIC X(6).
016000     05  DSN-RETAIN-DATE         PIC 9(6).
016100     05  FILLER                  PIC X(214).
016200     EJECT
016300 WORKING-STORAGE SECTION.
016400
016500 01  TEST-DAYS                   PIC 9(2)   VALUE 30.
016600
016700 01  DSN-SUB                     PIC S9(4)  VALUE +0    COMP.
016800
016900 01  ABEND-CODE                  PIC S9(4)  VALUE +0    COMP.
017000
017100 01  LINE-CNT                    PIC S9(5)  VALUE +99 COMP-3.
017200
017300 01  PAGE-CNT                    PIC S9(5)  VALUE ZEROS COMP-3.
017400
017500 01  LINE-CNT-MSG                PIC S9(5)  VALUE +99 COMP-3.
017600
017700 01  PAGE-CNT-MSG                PIC S9(5)  VALUE ZEROS COMP-3.
017800
017900 01  TOTAL-TRACKS-3340           PIC S9(6)  VALUE ZEROS COMP-3.
018000
018100 01  TOTAL-TRACKS-3350           PIC S9(6)  VALUE ZEROS COMP-3.
018200
018300 01  TOTAL-TRACKS-3375           PIC S9(6)  VALUE ZEROS COMP-3.
018400
018500 01  MSG-01-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
018600
018700 01  MSG-02-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
018800
018900 01  MSG-03-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
019000
019100 01  MSG-04-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
019200
019300 01  MSG-05-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
019400
019500 01  MSG-06-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
019600
019700 01  MSG-07-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
019800
019900 01  MSG-08-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
020000
020100 01  MSG-09-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
020200
020300 01  MSG-10-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
020400
020500 01  MSG-11-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
020600
020700 01  MSG-12-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
020800
020900 01  MSG-13-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
021000
021100 01  MSG-14-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
021200
021300 01  MSG-15-CTR                  PIC S9(6)  VALUE ZEROS COMP-3.
021400
021500 01  HOLD-JULIAN                 PIC S9(7)  VALUE ZEROS.
021600
021700 01  CTR-WORK                    PIC Z(6)  VALUE ZEROS.
021800
021900 01  VSAM-STATUS-AREA.
022000     03  VSAM-STATUS.
022100         05  VSAM-STAT-BYTE1     PIC X(1).
022200             88  STATUS-OK                  VALUE '0'.
022300             88  STATUS-AT-END              VALUE '1'.
022400             88  STATUS-INVALID-KEY         VALUE '2'.
022500             88  STATUS-ERROR               VALUE '3'.
022600             88  STATUS-OTHER               VALUE '9'.
022700             88  STATUS-ABORT               VALUE '1' '3' '9'.
022800         05  VSAM-STAT-BYTE2     PIC X(1).
022900     03  VSAM-STAT-BOTH REDEFINES VSAM-STATUS PIC X(2).
023000         88  DUPLICATE-RECORD               VALUE '22'.
023100
023200 01  DSN-WORK.
023300     02  DSN-WORK-OCC            PIC X(1) OCCURS 44.
023400
023500 01  TIME-WORK.
023600     02  TIME-WK1                PIC XX.
023700     02  TIME-WK2                PIC XX.
023800     02  TIME-WK3                PIC XX.
023900
024000 01  OLD-DATE-NUM                PIC 9(6).
024100 01  OLD-DATE REDEFINES OLD-DATE-NUM.
024200     05  OLD-DATE-YY             PIC 99.
024300     05  OLD-DATE-MM             PIC 99.
024400     05  OLD-DATE-DD             PIC 99.
024500
024600 01  S630-LIST.
024700     05   S630-REQUEST     PICTURE  9(1).
024800     05   S630-DATE-1      PICTURE  S9(6) COMP-3.
024900     05   S630-DATE-2      PICTURE  S9(6) COMP-3.
025000     05   S630-NO-DAYS     PICTURE  S9(6) COMP-3.
025100     05   S630-RETURN-CODE PICTURE  X(1).
025200
025300 01  HOLD-DATE-2.
025400
025500     05  HOLD-DATE-NUM           PIC 9(7).
025600     05  HOLD-DATE-GRP  REDEFINES HOLD-DATE-NUM.
025700         10  FILLER              PIC X.
025800         10  HOLD-DATE-MDY.
025900             15  HOLD-DATE-GRP-MM    PIC 9(2).
026000             15  HOLD-DATE-GRP-DD    PIC 9(2).
026100             15  HOLD-DATE-GRP-YY    PIC 9(2).
026200
026300 01  HOLD-DATE.
026400     05  HOLD-MM                 PIC 99.
026500     05  FILLER                  PIC X.
026600     05  HOLD-DD                 PIC 99.
026700     05  FILLER                  PIC X.
026800     05  HOLD-YY                 PIC 99.
026900     SKIP1
027000     COPY    SSP025C.
027100     SKIP1
027200 01  HOLD-DATE-3.
027300     05  HOLD-3-YYYY.
027400         10  FILLER              PIC X(2).
027500         10  HOLD-3-YY           PIC 9(2).
027600     05  HOLD-3-DDD              PIC S9(3).
027700
027800 01  EXCLUDE-NODES.
027900     05  HIGH-LEVEL-TABLE
028000                OCCURS 25 TIMES
028100                INDEXED BY HIGHLVL-SUB
028200                                 PIC X(3).
028300
028400 01  VOLUME-LIST.
028500     05  VOL-TABLE
028600         OCCURS 200 TIMES
028700         INDEXED BY VOL-SUB.
028800         10  VOLSER-VT           PIC X(6).
028900         10  DEVT-VT             PIC X(4).
029000         10  TRACKS-VT           PIC 9(6).
029100
029200 01  SCRATCH-FORMAT1.
029300     05  FILLER                  PIC X(13)
029400         VALUE ' SCRATCH VOL='.
029500     05  SCRATCH-DEVT            PIC X(4).
029600     05  FILLER                  PIC X(1)  VALUE '='.
029700     05  SCRATCH-VOLSER          PIC X(6).
029800     05  FILLER                  PIC X(7)
029900         VALUE ',PURGE,'.
030000     05  FILLER                  PIC X(40) VALUE SPACES.
030100     05  FILLER                  PIC X(1)  VALUE '*'.
030200     05  FILLER                  PIC X(8)  VALUE SPACES.
030210
030300 01  SCRATCH-FORMAT2.
030400     05  FILLER                  PIC X(15) VALUE SPACES.
030500     05  FILLER                  PIC X(7)
030600         VALUE 'DSNAME='.
030700     05  SCRATCH-DSNAME          PIC X(44).
030800     05  FILLER                  PIC X(40) VALUE SPACES.
030900     05  FILLER                  PIC X(14) VALUE SPACES.
031000
031100 01  UNCATLG-FORMAT.
031200     05  FILLER                  PIC X(16)
031300         VALUE ' UNCATLG DSNAME='.
031400     05  UNCATLG-DSNAME          PIC X(44).
031500     05  FILLER                  PIC X(20)     VALUE SPACES.
031600
031700
031800 01  MDASD-RECORD.
031900
032000     05  FILLER                  PIC X(5)
032100         VALUE ' DSN='.
032200     05  ARCH-DSNAME             PIC X(44).
032300     05  FILLER                  PIC X(05)
032400         VALUE ' VOL='.
032500     05  ARCH-VOLSER             PIC X(06).
032600     05  FILLER                  PIC X(11)
032700         VALUE ' DAYS=IMMED'.
032800
032900 01  MDASD-RECORD-2.
033000
033100     05  FILLER                  PIC X(80)
033200         VALUE ' DEF ARC -'.
033300
033400 01  SYS-COMPARE.
033500     05  FILLER                  PIC X(3)       VALUE 'SYS'.
033600     05  SYS-YY                  PIC 9(2).
033700     05  SYS-DDD                 PIC 9(3).
033800
033900
034000 01  HEADING-LINE-1.
034100
034200     02  FILLER                  PIC X(25) VALUE
034300         'MUNICIPALITY OF ANCHORAGE'.
034400     02  FILLER                  PIC X(14) VALUE SPACES.
034500     02  FILLER                  PIC X(02) VALUE SPACES.
034600     02  FILLER                  PIC X(49)
034700         VALUE '   D I S K   M A N A G E M E N T   S Y S T E M'.
034800     02  FILLER                  PIC X(02) VALUE SPACES.
034900     02  FILLER                  PIC X(26) VALUE SPACES.
035000     02  FILLER                  PIC X(09) VALUE 'PAGE NO: '.
035100     02  PAGE-NO-HL1             PIC Z(5).
035200
035300 01  HEADING-LINE-2.
035400
035500     02  FILLER                  PIC X(25) VALUE
035600         'INFORMATION SYSTEMS DEPT.'.
035700     02  FILLER                  PIC X(93) VALUE SPACES.
035800     02  FILLER                  PIC X(06) VALUE 'DATE: '.
035900     02  DATE-HL2                PIC X(8)  VALUE SPACES.
036000
036100 01  HEADING-LINE-3.
036200
036300     02  FILLER                  PIC X(17) VALUE
036400         'REPORT: SSP505-R1'.
036500     02  FILLER                  PIC X(06) VALUE SPACES.
036600     02  FILLER                  PIC X(16) VALUE SPACES.
036700     02  REPORT-NAME-HL3         PIC X(53)
036800         VALUE '                  SELECTIVE SCRATCH'.
036900     02  FILLER                  PIC X(26) VALUE SPACES.
037000     02  FILLER                  PIC X(09) VALUE 'TIME:    '.
037100     02  TIME1-HL3               PIC X(2)  VALUE SPACES.
037200     02  FILLER                  PIC X(1)  VALUE ':'.
037300     02  TIME2-HL3               PIC X(2)  VALUE SPACES.
037400
037500 01  PRINT-LINES.
037600
037700     05  DETAIL-HEADING-1.
037800
037900         10  FILLER              PIC X(44)      VALUE SPACES.
038000         10  FILLER              PIC X(1)       VALUE SPACES.
038100         10  FILLER              PIC X(8)       VALUE ' CREATE'.
038200         10  FILLER              PIC X(1)       VALUE SPACES.
038300         10  FILLER              PIC X(9)
038400             VALUE 'LAST USED'.
038500         10  FILLER              PIC X(2)       VALUE SPACES.
038600         10  FILLER              PIC X(6)       VALUE 'VOLUME'.
038700         10  FILLER              PIC X(5)       VALUE SPACES.
038800         10  FILLER              PIC X(50)      VALUE SPACES.
038900
039000     05  DETAIL-HEADING-2.
039100
039200         10  FILLER              PIC X(44)
039300             VALUE 'DATA SET NAME'.
039400         10  FILLER              PIC X(1)       VALUE SPACES.
039500         10  FILLER              PIC X(8)       VALUE '  DATE'.
039600         10  FILLER              PIC X(2)       VALUE SPACES.
039700         10  FILLER              PIC X(8)       VALUE '  DATE'.
039800         10  FILLER              PIC X(2)       VALUE SPACES.
039900         10  FILLER              PIC X(6)       VALUE 'SERIAL'.
039910         10  FILLER              PIC X(2)       VALUE SPACES.
039920         10  FILLER              PIC X(6)       VALUE 'TRACKS'.
039930         10  FILLER              PIC X(2)       VALUE SPACES.
039940         10  FILLER              PIC X(7)       VALUE 'ACTION'.
040000         10  FILLER              PIC X(2)       VALUE SPACES.
040100         10  FILLER              PIC X(45)
040200             VALUE 'REASON FOR SCRATCH OR ARCHIVE'.
040300
040400     05  DETAIL-LINE-1.
040500         10  DTL-DATA-SET-NAME   PIC X(44).
040600         10  FILLER              PIC X(1)       VALUE SPACES.
040700         10  DTL-CREATE-DATE     PIC X(8).
040800         10  FILLER              PIC X(2)       VALUE SPACES.
040900         10  DTL-EXPIR-DATE      PIC X(8).
041000         10  FILLER              PIC X(2)       VALUE SPACES.
041100         10  DTL-VOL-SER         PIC X(6).
041101         10  FILLER              PIC X(2)       VALUE SPACES.
041102         10  DTL-TRACKS          PIC ZZ,ZZ9.
041110         10  FILLER              PIC X(2)       VALUE SPACES.
041120         10  DTL-ACTION          PIC X(7).
041200         10  FILLER              PIC X(2)       VALUE SPACES.
041300         10  DTL-MESSAGE         PIC X(45)      VALUE SPACES.
041400
041500 01  MESSAGE-AREA                PIC X(132)     VALUE SPACES.
041600
041700 01  ERROR-MESSAGES.
041800
041900     05  MESSAGE-01              PIC X(45)
042000         VALUE 'DATA SET NOT CATALOGUED'.
042100
042200     05  MESSAGE-02              PIC X(45)
042300         VALUE 'TEMPORARY DATA SET SCRATCHED'.
042400
042500     05  MESSAGE-03              PIC X(45)
042600         VALUE 'TSO DATA SET NOT ON TSO VOLUME'.
042700
042800     05  MESSAGE-04              PIC X(45)
042900         VALUE 'TEMPORARY DATA SET NOT ON WORK VOLUME'.
043000
043100     05  MESSAGE-05              PIC X(45)
043200         VALUE 'PERM DATA SET ON WORK VOLUME OVER 4 DAYS OLD'.
043300
043400     05  MESSAGE-06              PIC X(45)
043500         VALUE 'TEST DATA SET ON PRODUCTION VOLUME'.
043600
043700     05  MESSAGE-07              PIC X(45)
043800         VALUE 'DATA SET NOT ON AUTHORIZATION MASTER'.
043900
044000     05  MESSAGE-08              PIC X(45)
044100         VALUE 'UNAUTHORIZED DATA SET ON LIBRARY VOLUME'.
044200
044300     05  MESSAGE-09              PIC X(45)
044400         VALUE 'INVALID DATA SET ON TEST VOLUME'.
044500
044600     05  MESSAGE-10              PIC X(45)
044700         VALUE 'TEST DATA SET NOT ACCESSED IN LAST 30 DAYS'.
044800
044900     05  MESSAGE-11              PIC X(45)
045000         VALUE 'OBSOLETE TSO/SPF DATA SET       '.
045100
045200     05  MESSAGE-12              PIC X(45)
045300         VALUE '                                '.
045400
045500     05  MESSAGE-13              PIC X(45)
045600         VALUE '                                '.
045700
045800     05  MESSAGE-14              PIC X(45)
045900         VALUE '                                '.
046000
046100     05  MESSAGE-15              PIC X(45)
046200         VALUE '                                '.
046300     EJECT
046400 PROCEDURE DIVISION.
046500
046600 START-IT.
046700     OPEN INPUT INPUT-EXTRACT
046800                EXCLUDE-CARDS
046900                VAT-CARDS
047000         OUTPUT OUTPUT-SCRATCH-CARDS
047100                ARCHIVE-CARDS
047200                MESSAGE-REPORT
047300                OUTPUT-REPORT.
047400
047500     OPEN INPUT DSN-MASTER.
047600
047700     MOVE CURRENT-DATE  TO HOLD-DATE.
047800     MOVE HOLD-MM       TO HOLD-DATE-GRP-MM.
047900     MOVE HOLD-DD       TO HOLD-DATE-GRP-DD.
048000     MOVE HOLD-YY       TO HOLD-DATE-GRP-YY.
048100     MOVE SPACES        TO DATE-AREA.
048200     MOVE HOLD-DATE-MDY TO GREGORIAN-MMDDYY.
048300
048400     MOVE TIME-OF-DAY TO TIME-WORK.
048500     MOVE TIME-WK1 TO TIME1-HL3.
048600     MOVE TIME-WK2 TO TIME2-HL3.
048700     MOVE CURRENT-DATE TO DATE-HL2.
048800
048900     MOVE CURRENT-DATE TO HOLD-DATE.
049000     MOVE HOLD-YY TO OLD-DATE-YY.
049100     MOVE HOLD-MM TO OLD-DATE-MM.
049200     MOVE HOLD-DD TO OLD-DATE-DD.
049300     MOVE OLD-DATE-NUM TO S630-DATE-2.
049400
049500     PERFORM WRITE-HEADINGS.
049600
049700     IF STATUS-ABORT
049800         STRING 'SSP505-10 UNABLE TO OPEN AUTHORIZATION MASTER'
049900                ' FILE STATUS='
050000                VSAM-STATUS
050100                DELIMITED BY SIZE
050200                INTO MESSAGE-AREA
050300         PERFORM WRITE-MESSAGE
050301         MOVE +4016 TO ABEND-CODE
050310         CALL 'ILBOABN0' USING ABEND-CODE
050400         GO TO CLOSE-FILES.
050500
050600     CALL 'SSP025' USING DATE-AREA.
050700     MOVE JULIAN-YYYYDDD TO HOLD-JULIAN.
050800     SUBTRACT 2 FROM HOLD-JULIAN GIVING HOLD-JULIAN.
050900     MOVE HOLD-JULIAN TO HOLD-DATE-3.
051000
051100     IF HOLD-3-DDD GREATER THAN 365
051200         COMPUTE SYS-DDD = 365 - (1000 - HOLD-3-DDD)
051300     ELSE
051400         MOVE HOLD-3-DDD TO SYS-DDD.
051500
051600     MOVE HOLD-3-YY TO SYS-YY.
051700
051800     STRING 'SSP505-07 DATE USED FOR TEMPORARY DATA SETS='
051900            SYS-COMPARE
052000            DELIMITED BY SIZE
052100            INTO MESSAGE-AREA
052200     PERFORM WRITE-MESSAGE
052300
052400     SET HIGHLVL-SUB TO 1.
052500     PERFORM BUILD-EXCLUDE-TABLE THRU BUILD-EXIT.
052600
052700     SET VOL-SUB TO 1.
052800     PERFORM BUILD-VAT THRU BUILD-VAT-EXIT.
052900
053000 PROCESS-INPUT.
053100
053200     READ  INPUT-EXTRACT
053300          AT END   GO TO EOJ.
053400
053500     IF EXTRACT-DSN-1ST-4 EQUAL 'SYS1'
053600         GO TO PROCESS-INPUT.
053700
053800     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'SYS8'
053900         GO TO PROCESS-TEMP.
054000
054100     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'APPX'
054200         GO TO PROCESS-TSO.
054300
054400     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'CNVX'
054500         GO TO PROCESS-TSO.
054600
054700     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'DDEX'
054800         GO TO PROCESS-TSO.
054900
055000     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'SOPX'
055100         GO TO PROCESS-TSO.
055200
055300     IF EXTRACT-DSN-1ST-4 IS EQUAL TO 'SSPX'
055400         GO TO PROCESS-TSO.
055500
055600     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'WOR'
055700         GO TO PROCESS-WORK.
055800
055900     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'TES'
056000         GO TO PROCESS-TESTXX.
056100
056200     IF EXTRACT-DSN-1ST-3 EQUAL 'SSP'
056300         GO TO PROCESS-INPUT.
056400
056500     SET HIGHLVL-SUB TO 1.
056600
056700     SEARCH HIGH-LEVEL-TABLE
056800         WHEN HIGH-LEVEL-TABLE (HIGHLVL-SUB) = EXTRACT-DSN-1ST-3
056900             GO TO PROCESS-INPUT.
057000
057100     IF EXTRACT-CAT-VOL = 'NOTCAT'
057200         MOVE MESSAGE-01 TO DTL-MESSAGE
057300         ADD EXTRACT-SPACE-ALLOC TO MSG-01-CTR
057400         PERFORM ARCHIVE-FILE
057500         GO TO PROCESS-INPUT.
057600
057700     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'SYS'
057800         GO TO PROCESS-TEST.
057810
057820     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'AUX'
057830         GO TO PROCESS-TEST.
057840
057850     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'VSP'
057860         GO TO PROCESS-TEST.
057900
058000     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'MVS'
058100         GO TO PROCESS-LIB.
058200
058300     GO TO PROCESS-INPUT.
058400
058500 PROCESS-TEMP.
058600
058700     IF EXTRACT-DSN-9TH IS NOT EQUAL TO '.'
058800         GO TO PROCESS-INPUT.
058900
059000     IF EXTRACT-RES-VOLSER-1-3 IS NOT EQUAL TO 'WOR'
059100         MOVE MESSAGE-04 TO DTL-MESSAGE
059200         ADD EXTRACT-SPACE-ALLOC TO MSG-04-CTR
059300         PERFORM SCRATCH-FILE
059400         GO TO PROCESS-INPUT.
059500
059600     IF EXTRACT-DSN-1ST-8 LESS THAN SYS-COMPARE
059700         MOVE MESSAGE-02 TO DTL-MESSAGE
059800         ADD EXTRACT-SPACE-ALLOC TO MSG-02-CTR
059900         PERFORM SCRATCH-FILE.
060000
060100     GO TO PROCESS-INPUT.
060200
060300 PROCESS-TSO.
060400
060500     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'TSO'
060600         GO TO PROCESS-TSO-SPF1.
060700
060800     IF EXTRACT-RES-VOLSER-1-3 IS EQUAL TO 'WOR'
060900         GO TO PROCESS-TSO-SPF1.
061000
061100     MOVE MESSAGE-03 TO DTL-MESSAGE
061200     ADD EXTRACT-SPACE-ALLOC TO MSG-03-CTR
061300     PERFORM ARCHIVE-FILE.
061400
061500     GO TO PROCESS-INPUT.
061600
061700****************************************************************
061800*                                                              *
061900* PROCESS-TSO-SPF1                                             *
062000*                                                              *
062100*   ROUTINE TO FIND TSO/SPF OUTLIST DATA SETS                  *
062200*                                                              *
062300****************************************************************
062400
062500 PROCESS-TSO-SPF1.
062600
062700     MOVE EXTRACT-CREATE-DATE TO HOLD-DATE-NUM
062800     MOVE HOLD-DATE-GRP-MM TO OLD-DATE-MM
062900     MOVE HOLD-DATE-GRP-DD TO OLD-DATE-DD
063000     MOVE HOLD-DATE-GRP-YY TO OLD-DATE-YY.
063100     MOVE OLD-DATE-NUM TO S630-DATE-1.
063200     MOVE '4' TO S630-REQUEST.
063300     MOVE ' ' TO S630-RETURN-CODE.
063400
063500     CALL 'SSP630' USING S630-LIST.
063600
063700     MOVE +0 TO DSN-SUB.
063800
063900 SPF-DSN-LOOP1.
064000
064100     ADD +1 TO DSN-SUB.
064200
064300     IF DSN-SUB IS GREATER THAN 41
064400         GO TO PROCESS-TSO-SPF2.
064500
064600     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
064700         GO TO SPF-DSN-LOOP1.
064800
064900     ADD +1 TO DSN-SUB.
065000
065100     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'P'
065200         GO TO SPF-DSN-LOOP1.
065300
065400     ADD +1 TO DSN-SUB.
065500
065600     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'F'
065700         GO TO SPF-DSN-LOOP1.
065800
065900     ADD +5 TO DSN-SUB.
066000
066100     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'O'
066200         GO TO SPF-DSN-LOOP1.
066300
066400     ADD +1 TO DSN-SUB.
066500
066600     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'U'
066700         GO TO SPF-DSN-LOOP1.
066800
066900     ADD +1 TO DSN-SUB.
067000
067100     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
067200         GO TO SPF-DSN-LOOP1.
067300
067400     ADD +1 TO DSN-SUB.
067500
067600     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'L'
067700         GO TO SPF-DSN-LOOP1.
067800
067900     ADD +1 TO DSN-SUB.
068000
068100     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'I'
068200         GO TO SPF-DSN-LOOP1.
068300
068400     ADD +1 TO DSN-SUB.
068500
068600     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
068700         GO TO SPF-DSN-LOOP1.
068800
068900     ADD +1 TO DSN-SUB.
069000
069100     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
069200         GO TO SPF-DSN-LOOP1.
069300
069400     IF S630-NO-DAYS IS NOT GREATER THAN 1
069500         GO TO PROCESS-INPUT.
069600
069700     MOVE MESSAGE-11 TO DTL-MESSAGE
069800     ADD EXTRACT-SPACE-ALLOC TO MSG-11-CTR
069900     PERFORM SCRATCH-FILE.
070000
070100     GO TO PROCESS-INPUT.
070200
070300
070400****************************************************************
070500*                                                              *
070600* PROCESS-TSO-SPF2                                             *
070700*                                                              *
070800*   ROUTINE TO FIND TSO/SPF LIST DATA SETS                     *
070900*                                                              *
071000****************************************************************
071100
071200 PROCESS-TSO-SPF2.
071300
071400     MOVE +0 TO DSN-SUB.
071500
071600 SPF-DSN-LOOP2.
071700
071800     ADD +1 TO DSN-SUB.
071900
072000     IF DSN-SUB IS GREATER THAN 41
072100         GO TO PROCESS-TSO-SPF3.
072200
072300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
072400         GO TO SPF-DSN-LOOP2.
072500
072600     ADD +1 TO DSN-SUB.
072700
072800     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'P'
072900         GO TO SPF-DSN-LOOP2.
073000
073100     ADD +1 TO DSN-SUB.
073200
073300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'F'
073400         GO TO SPF-DSN-LOOP2.
073500
073600     ADD +3 TO DSN-SUB.
073700
073800     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'L'
073900         GO TO SPF-DSN-LOOP2.
074000
074100     ADD +1 TO DSN-SUB.
074200
074300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'I'
074400         GO TO SPF-DSN-LOOP2.
074500
074600     ADD +1 TO DSN-SUB.
074700
074800     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
074900         GO TO SPF-DSN-LOOP2.
075000
075100     ADD +1 TO DSN-SUB.
075200
075300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
075400         GO TO SPF-DSN-LOOP2.
075500
075600     IF S630-NO-DAYS IS NOT GREATER THAN 1
075700         GO TO PROCESS-INPUT.
075800
075900     MOVE MESSAGE-11 TO DTL-MESSAGE
076000     ADD EXTRACT-SPACE-ALLOC TO MSG-11-CTR
076100     PERFORM SCRATCH-FILE.
076200
076300     GO TO PROCESS-INPUT.
076400
076500****************************************************************
076600*                                                              *
076700* PROCESS-TSO-SPF3                                             *
076800*                                                              *
076900*   ROUTINE TO FIND TSO/SPF LOG DATA SETS                      *
077000*                                                              *
077100****************************************************************
077200
077300 PROCESS-TSO-SPF3.
077400
077500     MOVE +0 TO DSN-SUB.
077600
077700 SPF-DSN-LOOP3.
077800
077900     ADD +1 TO DSN-SUB.
078000
078100     IF DSN-SUB IS GREATER THAN 41
078200         GO TO PROCESS-INPUT.
078300
078400     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
078500         GO TO SPF-DSN-LOOP3.
078600
078700     ADD +1 TO DSN-SUB.
078800
078900     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'P'
079000         GO TO SPF-DSN-LOOP3.
079100
079200     ADD +1 TO DSN-SUB.
079300
079400     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'F'
079500         GO TO SPF-DSN-LOOP3.
079600
079700     ADD +1 TO DSN-SUB.
079800
079900     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'L'
080000         GO TO SPF-DSN-LOOP3.
080100
080200     ADD +1 TO DSN-SUB.
080300
080400     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'O'
080500         GO TO SPF-DSN-LOOP3.
080600
080700     ADD +1 TO DSN-SUB.
080800
080900     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'G'
081000         GO TO SPF-DSN-LOOP3.
081100
081200     ADD +3 TO DSN-SUB.
081300
081400     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'L'
081500         GO TO SPF-DSN-LOOP3.
081600
081700     ADD +1 TO DSN-SUB.
081800
081900     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'I'
082000         GO TO SPF-DSN-LOOP3.
082100
082200     ADD +1 TO DSN-SUB.
082300
082400     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
082500         GO TO SPF-DSN-LOOP3.
082600
082700     ADD +1 TO DSN-SUB.
082800
082900     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
083000         GO TO SPF-DSN-LOOP3.
083100
083200     IF S630-NO-DAYS IS NOT GREATER THAN 1
083300         GO TO PROCESS-INPUT.
083400
083500     MOVE MESSAGE-11 TO DTL-MESSAGE
083600     ADD EXTRACT-SPACE-ALLOC TO MSG-11-CTR
083700     PERFORM SCRATCH-FILE.
083800
083900     GO TO PROCESS-INPUT.
084000
084100
084200 PROCESS-WORK.
084300
084400     MOVE EXTRACT-CREATE-DATE TO HOLD-DATE-NUM
084500     MOVE HOLD-DATE-GRP-MM TO OLD-DATE-MM
084600     MOVE HOLD-DATE-GRP-DD TO OLD-DATE-DD
084700     MOVE HOLD-DATE-GRP-YY TO OLD-DATE-YY.
084800     MOVE OLD-DATE-NUM TO S630-DATE-1.
084900     MOVE '4' TO S630-REQUEST.
085000     MOVE ' ' TO S630-RETURN-CODE.
085100
085200     CALL 'SSP630' USING S630-LIST.
085300
085400     IF S630-NO-DAYS IS NOT GREATER THAN 4
085500         GO TO PROCESS-INPUT.
085600
085700     MOVE MESSAGE-05 TO DTL-MESSAGE
085800     ADD EXTRACT-SPACE-ALLOC TO MSG-05-CTR
085900     PERFORM ARCHIVE-FILE.
086000
086100     GO TO PROCESS-INPUT.
086200
086300 PROCESS-TEST.
086400
086500     IF EXTRACT-DSN-4-5 IS EQUAL TO 'T.'
086600         GO TO PROCESS-TEST-2.
086700
086800     MOVE +0 TO DSN-SUB.
086900
087000 TEST-DSN-LOOP.
087100
087200     ADD +1 TO DSN-SUB.
087300
087400     IF DSN-SUB IS GREATER THAN 41
087500         GO TO PROCESS-PROD.
087600
087700     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
087800         GO TO TEST-DSN-LOOP.
087900
088000     ADD +1 TO DSN-SUB.
088100
088200     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'E'
088300         GO TO TEST-DSN-LOOP.
088400
088500     ADD +1 TO DSN-SUB.
088600
088700     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'S'
088800         GO TO TEST-DSN-LOOP.
088900
089000     ADD +1 TO DSN-SUB.
089100
089200     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'T'
089300         GO TO TEST-DSN-LOOP.
089400
089500 PROCESS-TEST-2.
089600
089700     PERFORM SEARCH-DSN.
089800
089900     IF STATUS-OK
090000         NEXT SENTENCE
090100         ELSE
090200             GO TO PROCESS-TEST-3.
090300
090400     IF DSN-VOLSER IS EQUAL TO 'TEST$$'
090500         GO TO PROCESS-INPUT.
090600
090700 PROCESS-TEST-3.
090800
090900     MOVE MESSAGE-06 TO DTL-MESSAGE
091000     ADD EXTRACT-SPACE-ALLOC TO MSG-06-CTR
091100     PERFORM ARCHIVE-FILE
091200     GO TO PROCESS-INPUT.
091300
091400 PROCESS-TESTXX.
091500
091600     IF EXTRACT-RES-VOLSER IS EQUAL TO 'TEST01'
091700         GO TO PROCESS-INPUT.
091800
091900     IF EXTRACT-DSN-4-5 IS EQUAL TO 'T.'
092000         GO TO PROCESS-TESTXX-1.
092100
092200     MOVE MESSAGE-09 TO DTL-MESSAGE.
092300     ADD EXTRACT-SPACE-ALLOC TO MSG-09-CTR.
092400     PERFORM ARCHIVE-FILE.
092500     GO TO PROCESS-INPUT.
092600
092700 PROCESS-TESTXX-1.
092800
092900     MOVE EXTRACT-EXPIR-DATE TO HOLD-DATE-NUM
093000     MOVE HOLD-DATE-GRP-MM TO OLD-DATE-MM
093100     MOVE HOLD-DATE-GRP-DD TO OLD-DATE-DD
093200     MOVE HOLD-DATE-GRP-YY TO OLD-DATE-YY.
093300     MOVE OLD-DATE-NUM TO S630-DATE-1.
093400     MOVE '4' TO S630-REQUEST.
093500     MOVE ' ' TO S630-RETURN-CODE.
093600
093700     CALL 'SSP630' USING S630-LIST.
093800
093900     IF S630-NO-DAYS IS NOT GREATER THAN TEST-DAYS
094000         GO TO PROCESS-INPUT.
094100
094200     MOVE MESSAGE-10 TO DTL-MESSAGE
094300     ADD EXTRACT-SPACE-ALLOC TO MSG-10-CTR
094400     PERFORM ARCHIVE-FILE.
094500
094600     GO TO PROCESS-INPUT.
094700
094800 PROCESS-PROD.
094900
095000     PERFORM SEARCH-DSN.
095100
095200     IF STATUS-OK
095300         GO TO PROCESS-INPUT.
095400
095500     MOVE MESSAGE-07 TO DTL-MESSAGE.
095600     ADD EXTRACT-SPACE-ALLOC TO MSG-07-CTR.
095700     PERFORM ARCHIVE-FILE.
095800     GO TO PROCESS-INPUT.
095900
096000 PROCESS-LIB.
096100
096200     IF EXTRACT-DSN-1ST-3 EQUAL 'SSP'
096300         GO TO PROCESS-INPUT.
096400
096500     PERFORM SEARCH-DSN.
096600
096700     IF STATUS-OK
096800         NEXT SENTENCE
096900         ELSE
097000             GO TO PROCESS-LIB-ERROR.
097100
097200     IF DSN-VOLSER IS EQUAL TO EXTRACT-RES-VOLSER
097300         GO TO PROCESS-INPUT.
097400
097500 PROCESS-LIB-ERROR.
097600
097700     MOVE MESSAGE-08 TO DTL-MESSAGE.
097800     ADD EXTRACT-SPACE-ALLOC TO MSG-08-CTR.
097900     PERFORM ARCHIVE-FILE.
098000     GO TO PROCESS-INPUT.
098100
098200 BUILD-EXCLUDE-TABLE.
098300
098400     READ EXCLUDE-CARDS
098500         AT END    GO TO BUILD-EXIT.
098600
098700     MOVE EXCLUDE-1ST-3 TO HIGH-LEVEL-TABLE (HIGHLVL-SUB).
098800     SET HIGHLVL-SUB UP BY 1.
098900
099000     IF HIGHLVL-SUB GREATER THAN 25
099100         STRING 'SSP505-03 EXCESSIVE NUMBER OF EXCLUDE ENTRIES'
099200                DELIMITED BY SIZE
099300                INTO MESSAGE-AREA
099400         PERFORM WRITE-MESSAGE
099410         MOVE +4015 TO ABEND-CODE
099500         CALL 'ILBOABN0' USING ABEND-CODE.
099600
099700     STRING 'SSP505-04 EXCLUDE ENTRY ACCEPTED, NODE='
099800            EXCLUDE-1ST-3
099900            DELIMITED BY SIZE
100000            INTO MESSAGE-AREA.
100100
100200     PERFORM WRITE-MESSAGE.
100300
100400     GO TO BUILD-EXCLUDE-TABLE.
100500
100600 BUILD-EXIT.
100700     EXIT.
100800
100900 BUILD-VAT.
101000
101100     READ VAT-CARDS
101200         AT END    GO TO BUILD-VAT-EXIT.
101300
101400     MOVE VOLSER-VR TO VOLSER-VT (VOL-SUB).
101500     MOVE DEVT-VR TO DEVT-VT (VOL-SUB).
101600     MOVE ZEROS TO TRACKS-VT (VOL-SUB).
101700     SET VOL-SUB UP BY 1.
101800     MOVE HIGH-VALUE TO VOLSER-VT (VOL-SUB).
101900
102000     IF VOL-SUB GREATER THAN 200
102100         STRING 'SSP505-01 EXCESSIVE NUMBER OF VATLST ENTRIES'
102200                DELIMITED BY SIZE
102300                INTO MESSAGE-AREA
102400         PERFORM WRITE-MESSAGE
102410         MOVE +4014 TO ABEND-CODE
102500         CALL 'ILBOABN0' USING ABEND-CODE.
102600
102700     STRING 'SSP505-02 VATLST ENTRY ACCEPTED, VOLSER='
102800            VOLSER-VR
102900            ' DEVICE TYPE='
103000            DEVT-VR
103100            DELIMITED BY SIZE
103200            INTO MESSAGE-AREA.
103300
103400     PERFORM WRITE-MESSAGE.
103500
103600     GO TO BUILD-VAT.
103700
103800 BUILD-VAT-EXIT.
103900     EXIT.
104000
104100 SEARCH-DSN SECTION.
104200
104300     MOVE +0 TO DSN-SUB.
104400     MOVE EXTRACT-DSN TO DSN-WORK.
104500
104600 SEARCH-DSN-LOOP.
104700
104800     ADD +1 TO DSN-SUB.
104900
105000     IF DSN-SUB IS GREATER THAN 41
105100         GO TO SEARCH-AUTH-MASTER.
105200
105300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO '.'
105400         GO TO SEARCH-DSN-LOOP.
105500
105600     ADD +1 TO DSN-SUB.
105700
105800     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'G'
105900         GO TO SEARCH-DSN-LOOP.
106000
106100     ADD +5 TO DSN-SUB.
106200
106300     IF EXTRACT-DSN-OCC (DSN-SUB) IS NOT EQUAL TO 'V'
106400         GO TO SEARCH-DSN-LOOP.
106500
106600     SUBTRACT +6 FROM DSN-SUB.
106700     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
106800     ADD +1 TO DSN-SUB.
106900     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
107000     ADD +1 TO DSN-SUB.
107100     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
107200     ADD +1 TO DSN-SUB.
107300     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
107400     ADD +1 TO DSN-SUB.
107500     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
107600     ADD +1 TO DSN-SUB.
107700     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
107800     ADD +1 TO DSN-SUB.
107900     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
108000     ADD +1 TO DSN-SUB.
108100     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
108200     ADD +1 TO DSN-SUB.
108300     MOVE SPACE TO DSN-WORK-OCC (DSN-SUB).
108400
108500 SEARCH-AUTH-MASTER.
108600
108700     MOVE DSN-WORK TO DSN-KEY.
108800
108900     READ DSN-MASTER.
109000
109100     IF STATUS-ABORT
109200         STRING 'SSP505-11 VSAM ERROR ON AUTHORIZATION MASTER'
109300                ' FILE STATUS='
109400                VSAM-STATUS
109500                DELIMITED BY SIZE
109600                INTO MESSAGE-AREA
109700         PERFORM WRITE-MESSAGE
109800         PERFORM CLEAR-SCRATCH-FILE
109900         GO TO CLOSE-FILES.
110000
110100     GO TO SEARCH-DSN-EXIT.
110200
110300 SEARCH-DSN-EXIT.
110400
110500     EXIT.
110600
110700 CLEAR-SCRATCH-FILE SECTION.
110800
110900     CLOSE OUTPUT-SCRATCH-CARDS.
111000     OPEN OUTPUT OUTPUT-SCRATCH-CARDS.
111100
111200 ARCHIVE-FILE SECTION.
111300
111400     IF LINE-CNT GREATER THAN 48
111500         PERFORM WRITE-HEADINGS.
111600
111700     MOVE EXTRACT-DSN TO DTL-DATA-SET-NAME
111800     MOVE EXTRACT-CREATE-DATE TO HOLD-DATE-NUM.
111900     MOVE '  /  /' TO HOLD-DATE.
112000     MOVE HOLD-DATE-GRP-MM TO HOLD-MM.
112100     MOVE HOLD-DATE-GRP-DD TO HOLD-DD.
112200     MOVE HOLD-DATE-GRP-YY TO HOLD-YY.
112300     MOVE HOLD-DATE TO DTL-CREATE-DATE.
112400
112500     IF EXTRACT-EXPIR-DATE EQUAL ZEROS
112600         MOVE SPACES TO DTL-EXPIR-DATE
112700     ELSE
112800         MOVE EXTRACT-EXPIR-DATE TO HOLD-DATE-NUM
112900         MOVE HOLD-DATE-GRP-MM TO HOLD-MM
113000         MOVE HOLD-DATE-GRP-DD TO HOLD-DD
113100         MOVE HOLD-DATE-GRP-YY TO HOLD-YY
113200         MOVE HOLD-DATE TO DTL-EXPIR-DATE.
113210
113220     MOVE 'ARCHIVE' TO DTL-ACTION.
113230     MOVE EXTRACT-SPACE-ALLOC TO DTL-TRACKS.
113300
113400     MOVE EXTRACT-RES-VOLSER TO DTL-VOL-SER.
113500     WRITE REPORT-REC FROM DETAIL-LINE-1 AFTER 2.
113600     ADD 2 TO LINE-CNT.
113700
113800     MOVE EXTRACT-RES-VOLSER TO ARCH-VOLSER.
113900     MOVE EXTRACT-DSN        TO ARCH-DSNAME.
114000     WRITE ARCHIVE-REC FROM MDASD-RECORD-2.
114100     WRITE ARCHIVE-REC FROM MDASD-RECORD.
114200
114300
114400     PERFORM ACCUM-STATS.
114500
114600 SCRATCH-FILE SECTION.
114700
114800     IF LINE-CNT GREATER THAN 48
114900         PERFORM WRITE-HEADINGS.
115000
115100     MOVE EXTRACT-DSN TO DTL-DATA-SET-NAME
115200     MOVE EXTRACT-CREATE-DATE TO HOLD-DATE-NUM.
115300     MOVE '  /  /' TO HOLD-DATE.
115400     MOVE HOLD-DATE-GRP-MM TO HOLD-MM.
115500     MOVE HOLD-DATE-GRP-DD TO HOLD-DD.
115600     MOVE HOLD-DATE-GRP-YY TO HOLD-YY.
115700     MOVE HOLD-DATE TO DTL-CREATE-DATE.
115800
115900     IF EXTRACT-EXPIR-DATE EQUAL ZEROS
116000         MOVE SPACES TO DTL-EXPIR-DATE
116100     ELSE
116200         MOVE EXTRACT-EXPIR-DATE TO HOLD-DATE-NUM
116300         MOVE HOLD-DATE-GRP-MM TO HOLD-MM
116400         MOVE HOLD-DATE-GRP-DD TO HOLD-DD
116500         MOVE HOLD-DATE-GRP-YY TO HOLD-YY
116600         MOVE HOLD-DATE TO DTL-EXPIR-DATE.
116601
116610     MOVE 'SCRATCH' TO DTL-ACTION.
116620     MOVE EXTRACT-SPACE-ALLOC TO DTL-TRACKS.
116700
116800     MOVE EXTRACT-RES-VOLSER TO DTL-VOL-SER.
116900     WRITE REPORT-REC FROM DETAIL-LINE-1 AFTER 2.
117000     ADD 2 TO LINE-CNT.
117100
117200     MOVE EXTRACT-RES-VOLSER TO SCRATCH-VOLSER.
117300     MOVE EXTRACT-DSN        TO SCRATCH-DSNAME.
117400     MOVE EXTRACT-DEVT       TO SCRATCH-DEVT.
117500     WRITE SCRATCH-REC FROM SCRATCH-FORMAT1.
117600     WRITE SCRATCH-REC FROM SCRATCH-FORMAT2.
117700
117800     IF EXTRACT-CAT-VOL IS NOT EQUAL 'NOTCAT'
117900         MOVE EXTRACT-DSN TO UNCATLG-DSNAME
118000         WRITE SCRATCH-REC FROM UNCATLG-FORMAT.
118100
118200     PERFORM ACCUM-STATS.
118300
118400 ACCUM-STATS SECTION.
118500
118600     IF EXTRACT-DEVT IS EQUAL TO '3340'
118700         ADD EXTRACT-SPACE-ALLOC TO TOTAL-TRACKS-3340.
118800
118900     IF EXTRACT-DEVT IS EQUAL TO '3350'
119000         ADD EXTRACT-SPACE-ALLOC TO TOTAL-TRACKS-3350.
119100
119200     IF EXTRACT-DEVT IS EQUAL TO '3375'
119300         ADD EXTRACT-SPACE-ALLOC TO TOTAL-TRACKS-3375.
119400
119500     SET VOL-SUB TO 1.
119600
119700     SEARCH VOL-TABLE
119800         WHEN VOLSER-VT (VOL-SUB) IS EQUAL TO EXTRACT-RES-VOLSER
119900         ADD EXTRACT-SPACE-ALLOC TO TRACKS-VT (VOL-SUB).
120000
120100 WRITE-MESSAGE SECTION.
120200
120300     IF LINE-CNT-MSG GREATER THAN 48
120400         PERFORM MESSAGE-HEADINGS.
120500
120600     WRITE MESSAGE-REC FROM MESSAGE-AREA AFTER 2.
120700
120800     MOVE SPACES TO MESSAGE-AREA.
120900
121000     ADD 2 TO LINE-CNT-MSG.
121100
121200
121300 WRITE-HEADINGS SECTION.
121400
121500     ADD 1 TO PAGE-CNT.
121600     MOVE PAGE-CNT TO PAGE-NO-HL1.
121700     WRITE REPORT-REC FROM HEADING-LINE-1 AFTER TO-TOP.
121800     MOVE ZEROS TO LINE-CNT.
121900     WRITE REPORT-REC FROM HEADING-LINE-2 AFTER 1.
122000     WRITE REPORT-REC FROM HEADING-LINE-3 AFTER 1.
122100     MOVE ALL '-' TO REPORT-REC.
122200     WRITE REPORT-REC AFTER 1.
122300     WRITE REPORT-REC FROM DETAIL-HEADING-1 AFTER 1.
122400     WRITE REPORT-REC FROM DETAIL-HEADING-2 AFTER 1.
122500     MOVE ALL '-' TO REPORT-REC.
122600     WRITE REPORT-REC AFTER 1.
122700     MOVE SPACES TO REPORT-REC.
122800     WRITE REPORT-REC AFTER 1.
122900
123000 MESSAGE-HEADINGS SECTION.
123100
123200     ADD 1 TO PAGE-CNT-MSG.
123300     MOVE PAGE-CNT-MSG TO PAGE-NO-HL1.
123400     WRITE MESSAGE-REC FROM HEADING-LINE-1 AFTER TO-TOP.
123500     MOVE ZEROS TO LINE-CNT-MSG.
123600     WRITE MESSAGE-REC FROM HEADING-LINE-2 AFTER 1.
123700     WRITE MESSAGE-REC FROM HEADING-LINE-3 AFTER 1.
123800     MOVE ALL '-' TO MESSAGE-REC.
123900     WRITE MESSAGE-REC AFTER 1.
124000     MOVE SPACES TO MESSAGE-REC.
124100     WRITE MESSAGE-REC AFTER 1.
124200
124300 DUMP-TABLES SECTION.
124400
124500     SET VOL-SUB TO 1.
124600
124700 DUMP-TABLES-LOOP.
124800
124900     IF VOLSER-VT (VOL-SUB) IS EQUAL TO HIGH-VALUE
125000         GO TO DUMP-TABLES-EXIT.
125100
125200     IF TRACKS-VT (VOL-SUB) IS EQUAL TO ZEROS
125300         SET VOL-SUB UP BY 1
125400         GO TO DUMP-TABLES-LOOP.
125500
125600     MOVE TRACKS-VT (VOL-SUB) TO CTR-WORK.
125700
125800     STRING 'SSP505-05 '
125900            CTR-WORK
126000            ' TRACKS WILL BE ARCHIVED FOR VOLUME '
126100            VOLSER-VT (VOL-SUB)
126200            DELIMITED BY SIZE
126300            INTO MESSAGE-AREA.
126400
126500     PERFORM WRITE-MESSAGE.
126600
126700     SET VOL-SUB UP BY 1.
126800
126900     GO TO DUMP-TABLES-LOOP.
127000
127100 DUMP-TABLES-EXIT.
127200
127300     EXIT.
127400
127500 EOJ SECTION.
127600
127700     PERFORM DUMP-TABLES.
127800
127900     MOVE TOTAL-TRACKS-3340 TO CTR-WORK.
128000     STRING 'SSP505-06 '
128100            CTR-WORK
128200            ' TRACKS WILL BE ARCHIVED FROM 3340''S'
128300            DELIMITED BY SIZE
128400            INTO MESSAGE-AREA.
128500     PERFORM WRITE-MESSAGE.
128600
128700     MOVE TOTAL-TRACKS-3350 TO CTR-WORK.
128800     STRING 'SSP505-06 '
128900            CTR-WORK
129000            ' TRACKS WILL BE ARCHIVED FROM 3350''S'
129100            DELIMITED BY SIZE
129200            INTO MESSAGE-AREA.
129300     PERFORM WRITE-MESSAGE.
129400
129500     MOVE TOTAL-TRACKS-3375 TO CTR-WORK.
129600     STRING 'SSP505-06 '
129700            CTR-WORK
129800            ' TRACKS WILL BE ARCHIVED FROM 3375''S'
129900            DELIMITED BY SIZE
130000            INTO MESSAGE-AREA.
130100     PERFORM WRITE-MESSAGE.
130200
130300     MOVE MSG-01-CTR TO CTR-WORK.
130400     STRING 'SSP505-07 '
130500            CTR-WORK
130600            ' TRACKS WILL BE ARCHIVED FOR'
130700            ' UNCATALOGUED DATA SETS'
130800            DELIMITED BY SIZE
130900            INTO MESSAGE-AREA.
131000     PERFORM WRITE-MESSAGE.
131100
131200     MOVE MSG-02-CTR TO CTR-WORK.
131300     STRING 'SSP505-07 '
131400            CTR-WORK
131500            ' TRACKS WILL BE ARCHIVED FOR'
131600            ' TEMPORARY DATA SETS'
131700            DELIMITED BY SIZE
131800            INTO MESSAGE-AREA.
131900     PERFORM WRITE-MESSAGE.
132000
132100     MOVE MSG-03-CTR TO CTR-WORK.
132200     STRING 'SSP505-08 '
132300            CTR-WORK
132400            ' TRACKS WILL BE ARCHIVED FOR'
132500            ' TSO DATA SETS NOT ON TSO VOLUMES'
132600            DELIMITED BY SIZE
132700            INTO MESSAGE-AREA.
132800     PERFORM WRITE-MESSAGE.
132900
133000     MOVE MSG-04-CTR TO CTR-WORK.
133100     STRING 'SSP505-08 '
133200            CTR-WORK
133300            ' TRACKS WILL BE ARCHIVED FOR'
133400            ' TEMPORARY DATA SETS NOT ON WORK VOLUME'
133500            DELIMITED BY SIZE
133600            INTO MESSAGE-AREA.
133700     PERFORM WRITE-MESSAGE.
133800
133900     MOVE MSG-05-CTR TO CTR-WORK.
134000     STRING 'SSP505-08 '
134100            CTR-WORK
134200            ' TRACKS WILL BE ARCHIVED FOR'
134300            ' PERMANENT DATA SETS ON WORK VOLUME OVER 4 DAYS'
134400            DELIMITED BY SIZE
134500            INTO MESSAGE-AREA.
134600     PERFORM WRITE-MESSAGE.
134700
134800     MOVE MSG-06-CTR TO CTR-WORK.
134900     STRING 'SSP505-08 '
135000            CTR-WORK
135100            ' TRACKS WILL BE ARCHIVED FOR'
135200            ' TEST DATA SETS ON PRODUCTION VOLUME'
135300            DELIMITED BY SIZE
135400            INTO MESSAGE-AREA.
135500     PERFORM WRITE-MESSAGE.
135600
135700     MOVE MSG-07-CTR TO CTR-WORK.
135800     STRING 'SSP505-08 '
135900            CTR-WORK
136000            ' TRACKS WILL BE ARCHIVED FOR'
136100            ' DATA SET NOT ON AUTHORIZATION MASTER'
136200            DELIMITED BY SIZE
136300            INTO MESSAGE-AREA.
136400     PERFORM WRITE-MESSAGE.
136500
136600     MOVE MSG-08-CTR TO CTR-WORK.
136700     STRING 'SSP505-08 '
136800            CTR-WORK
136900            ' TRACKS WILL BE ARCHIVED FOR'
137000            ' UNAUTHORIZED DATA SET ON LIBRARY VOLUME'
137100            DELIMITED BY SIZE
137200            INTO MESSAGE-AREA.
137300     PERFORM WRITE-MESSAGE.
137400
137500     MOVE MSG-09-CTR TO CTR-WORK.
137600     STRING 'SSP505-08 '
137700            CTR-WORK
137800            ' TRACKS WILL BE ARCHIVED FOR'
137900            ' INVALID DATA SET ON TEST VOLUME'
138000            DELIMITED BY SIZE
138100            INTO MESSAGE-AREA.
138200     PERFORM WRITE-MESSAGE.
138300
138400     MOVE MSG-10-CTR TO CTR-WORK.
138500     STRING 'SSP505-08 '
138600            CTR-WORK
138700            ' TRACKS WILL BE ARCHIVED FOR'
138800            ' TEST DATA SET NOT ACCESSED IN OVER '
138900            TEST-DAYS
139000            ' DAYS'
139100            DELIMITED BY SIZE
139200            INTO MESSAGE-AREA.
139300     PERFORM WRITE-MESSAGE.
139400
139500     MOVE MSG-11-CTR TO CTR-WORK.
139600     STRING 'SSP505-08 '
139700            CTR-WORK
139800            ' TRACKS WILL BE ARCHIVED FOR'
139900            ' OBSOLETE TSO/SPF DATA SETS '
140000            DELIMITED BY SIZE
140100            INTO MESSAGE-AREA.
140200     PERFORM WRITE-MESSAGE.
140300
140400 CLOSE-FILES.
140500
140600     CLOSE INPUT-EXTRACT
140700           EXCLUDE-CARDS
140800           VAT-CARDS
140900           OUTPUT-SCRATCH-CARDS
141000           ARCHIVE-CARDS
141100           OUTPUT-REPORT
141200           MESSAGE-REPORT
141300           DSN-MASTER.
141400
141500     STOP RUN.

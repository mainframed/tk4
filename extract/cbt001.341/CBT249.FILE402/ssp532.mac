SSP532 CSECT
*
*        SUBROUTINE TO CONVERT A VSAM TIME STAMP TO SOMETHING
*        WE CAN UNDERSTAND, I.E., A JULIAN DATE.  THE OUTPUT
*        DATE IS IN DISPLAY FORMAT INTENDED FOR PRINTING.
*
*        EXAMPLE: CALL 'SSP532' USING TIMESTAMP, DISP-AREA.
*
*              WHERE:
*                    TIMESTAMP = VSAM HEX TIME STAMP IN DISPLAY
*                                FORMAT, ONLY LEFT HALF. (8 BYTES)
*
*                    DISP-AREA = SIX CHAR AREA WHERE DATE IS PLACE
*
*
         EJECT
SSP532 TSENTRY 'TIME STAMP CONVERTER',BASE=R8
         SPACE 3
         LM    R2,R3,0(R1)         LOAD POINTERS
         CLI   0(R2),C'0'          IS THERE A DATE
         BE    MOVEZERO            NO, BRANCH
*
*        COMPRESS DISPLAY FORMAT BACK TO HEX
*
         MVC   WKD2,0(R2)
         TR    WKD2,CNVHEX
         PACK  WKD(5),WKD2(9)
         XC    WKD+4(4),WKD+4
*
*        LOOK UP YEAR
*
         LA    R9,YRTBL
YRLUKUP  CLC   WKD,YRTBLL+4(R9)   FOUND RIGHT ENTRY
         BL    YRFOUND            YES, BRANCH
         LA    R9,YRTBLL(,R9)     INCR TO NEXT ENTRY
         B     YRLUKUP            LOOP
*
*        SUBTRACT YEAR VALUE FORM TIME STAMP
*
YRFOUND  LA    R4,WKD
         LA    R5,4(,R9)
         BAL   R14,SUBTRCT
         MVC   WKD,SRESULT
*
*        LOOK UP MONTH
*
         LA    R10,MONTBL
MONLUKUP CLC   WKD,MONTBLL+2(R10)   FOUND RIGHT ENTRY
         BL    MONFOUND             YES, BRANCH
         LA    R10,MONTBLL(,R10)    INCR TO NEXT ENTRY
         B     MONLUKUP             LOOP
*
*        FIND NUMBER OF DAYS IN MONTH
*
MONFOUND LA    R4,WKD
         LA    R5,2(,R10)
         BAL   R14,SUBTRCT
         MVC   WKD,SRESULT
         LA    R11,1
DAYLUP   CLC   WKD,DAY              LESS THAN A DAY LEFT
         BL    BUILDATE             YES, BRANCH
         LA    R11,1(,R11)          INCR DAY CNT
         LA    R4,WKD
         LA    R5,DAY
         BAL   R14,SUBTRCT
         MVC   WKD,SRESULT
         B     DAYLUP               LOOP
*
*        BUILD JULIAN DATE
*
BUILDATE MVC   0(2,R3),0(R9)        PUT IN YEAR
         MVI   2(R3),C'.'           PUT IN DOT
         AH    R11,0(,R10)          COUNT ALL DAYS
         CVD   R11,WKD2             MAKE DECIMAL
         OI    WKD2+7,X'0F'         SET DISP ZONE
         UNPK  3(3,R3),WKD2         PUT IN DAYS
*
*        RETURN TO CALLER
*
RETURN   TSEXIT RC=0
*
*        ZERO TIME STAMP
*
MOVEZERO MVC   0(6,R3),=C'00.000'
         B     RETURN
         EJECT
*
*        DOUBLE PRECISION SUBTRACT ROUTINE
*
SUBTRCT  LM    R0,R1,0(R4)
         L     R15,4(,R5)
         SLR   R1,R15
         BC    11,*+6
         BCTR  R0,0
         L     R15,0(,R5)
         SR    R0,R15
         STM   R0,R1,SRESULT
         BR    R14
         EJECT
*
*        SAVE AND WORK AREAS
*
SAVEAREA DC    18F'0'
WKD      DS    D
WKD2     DS    D
SRESULT  DS    D
CNVHEX   DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'000A0B0C0D0E0F000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00000000000000000000000000000000'
         DC    XL16'00010203040506070809000000000000'
         SPACE 3
         LTORG
         EJECT
*
*        YEAR TABLE
*
         DS    0F
YRTBL    DC    C'76',H'1',XL8'8853BAF0B4000000'
YRTBLL   EQU   *-YRTBL
         DC    C'77',H'0',XL8'8A1FE58F68000000'
         DC    C'78',H'0',XL8'8BEACE50A6000000'
         DC    C'79',H'0',XL8'8DB5B711E4000000'
         DC    C'80',H'1',XL8'8F809FD322000000'
         DC    C'81',H'0',XL8'914CCA71D6000000'
         DC    C'82',H'0',XL8'9317B33314000000'
         DC    C'83',H'0',XL8'94E29BF452000000'
         DC    C'84',H'1',XL8'96AD84B590000000'
         DC    C'85',H'0',XL8'9879AF5444000000'
         DC    C'86',H'0',XL8'9A44981582000000'
         DC    C'87',H'0',XL8'9C0F80D6C0000000'
         DC    C'88',H'1',XL8'9DDA6997FE000000'
         DC    C'89',H'0',XL8'9FA69436B2000000'
         DC    C'90',H'0',XL8'A1717CF7F0000000'
         DC    C'91',H'0',XL8'A33C65B92E000000'
         DC    C'92',H'1',XL8'A5074E7A6C000000'
         DC    C'XX',H'256',8X'FF'
         EJECT
*
*        MONTH TABLE
*
         DS    0F
MONTBL   DC    H'000',8X'00'
MONTBLL  EQU   *-MONTBL
         DC    H'031',XL8'026F9D14A000000'
         DC    H'060',XL8'04B6FE7A8000000'
         DC    H'091',XL8'07269B8F2000000'
         DC    H'121',XL8'09821ACC6000000'
         DC    H'152',XL8'0BF1B7E10000000'
         DC    H'182',XL8'0E4D371E4000000'
         DC    H'213',XL8'10BCD432E000000'
         DC    H'244',XL8'132C71478000000'
         DC    H'274',XL8'1587F084C000000'
         DC    H'305',XL8'17F78D996000000'
         DC    H'335',XL8'1A530CD6A000000'
         DC    H'366',8X'FF'
         SPACE 2
DAY      DC    XL8'141DD76000000'
         EJECT
         TSEQUR
         SPACE 3
         END

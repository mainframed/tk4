//TEC02JMI JOB 70,'APPLY SM00023-T',CLASS=B,MSGCLASS=A,NOTIFY=CJM
//SMP EXEC IPOSMP4
//SMPPTFIN DD *
++USERMOD(SM00023) /* PAGE STEAL MODIFICATION ---
THIS MOD TO PAGE STEAL MONITOR MODULE PROTECTS A FAVORED, NONSWAPPABLE
JOB FROM EXCESSIVE PAGE FAULTING BY INSULATING IT FROM PAGE STEALING
AS ORIGINALLY IMPLEMENTED. PART 1 REVERSES THE ORDER OF SELECTING
ADDRESS SPACES FOR PAGE STEALING FROM LEAST-RECENTLY-SWAPPED-IN TO
MOST-RECENTLY-SWAPPED-IN, THEREBY PROTECTING NON-SWAPPABLE, LONG-
RUNNING JOBS AT ANY GIVEN LEVEL OF UIC.  PART 2 BYPASSES STEALING FOR
THE 'FAVORED' JOB IF ITS SPEDIFIC UIC IS NOT ABOVE A FENCE LEVEL.
HOWEVER, A SAFETY-VALVE IS PROVIDED BY RESUMING NORMAL STEAL IF
THIS JOB'S FRAME COUNT EXCEEDS A SPECIFIED DANGER LEVEL.
PART 3 EXCLUDES THE FENCED JOB'S UIC FROM THE SYSTEM-WIDE HIGH UIC
BECAUSE THE FENCED JOB WOULD DISTORT ONE OF THE IMPORTANT PAGING
CONTENTION INDICATORS USED BY THE SRM.
THIS VERSION IS AT PUT8004 LEVEL.
     */.
++VER (Z038) FMID(EBB1102) PRE(UZ29415) /* IPO38E VERSION, PUT8004 */
++ZAP (IRARMSTM).
NAME IRARMSTM
 EXPAND IRARMSTM(80)
*
*
* PART 1 - START STEALING FROM BOTTOM OF RMCTINQE AND CONTINUE
* STEALING FROM MOST RECENTLY SWAPPED IN TO LEAST RECENTLY
* SWAPPED IN.
*
VER 01C8 58404004                   L     OUCBPTR,OUCBFWD(,OUCBPTR)
VER 0216 58404004                         DITTO
REP 01C8 58404008                   L     OUCBPTR,OUCBBWD(,OUCBPTR)
REP 0216 58404008                         DITTO
*
* FOLLOWING NEEDED IF INSTALLING EITHER PART 2 OR 3.
*
VER 0A70 00000000,00000000,00000000,00000000  EXPANSION PATCH AREA
VER 0A80 00000000,00000000,00000000,00000000
VER 0A90 00000000,00000000,00000000,00000000
VER 0AA0 00000000,00000000,00000000,00000000
VER 0AB0 00000000,00000000,00000000,00000000
VER 0AC0 00000000,00000000
*
REP 0A70 C3C9C3E2F0F0F0F0  FENCEJOB DC    C'CICS0000' *INITIATED JOB
*                                                      NAME*
*
* PART 2 - IF PRODUCTION CICS JOB, BYPASS STEAL IF ADDRESS SPACE
* DOES NOT HAVE MORE THAN 300 FRAMES AND IF ITS HIGH UIC IS BELOW 16.
*
VER 01FA 45E0C938                   BAL   @14,STEAL
REP 01FA 47F0CA76                   B     PATCH1
*
* CHECK INITIATED JOB NAME POINTED TO BY ASCB. IF JOB NOT FENCED, THEN
* STEAL FRAMES NORMALLY. NOTE - IF JOB IS A STARTED TASK, MOD MUST USE
* ASCBJBNS INSTEAD OF ASCBJBNI.
*
*                          PATCH1   EQU   *
REP 0A78 589050AC                   L     @09,ASCBJBNI(,ASCBPTR)
REP 0A7C D507CA6E9000               CLC   FENCEJOB,0(@9)
REP 0A82 4770CA9C                   BNE   STEALPGE
*
* CHECK FRAME COUNT AGAINST SAFETY LIMIT. IF FRAME COUNT TOO HIGH,
* INVOKE NORMAL STEAL. IF FRAME COUNT OK, CHECK UIC AGAINST PROTECTION
* LEVEL.  IF BELOW PROTECTION LEVEL, DONT INVOKE STEAL AND RETURN TO
* CHECK NEXT INCORE USER.  IF UIC HIGH ENOUGH, INVOKE NORMAL STEAL.
*
REP 0A86 41900190                   LA    @09,400  *SAFETY LIMIT*
REP 0A8A 49905098                   CH    @09,ASCBFMCT(,ASCBPTR)
REP 0A8E 4740CA9C                   BL    STEALPGE  *TOO HIGH*
REP 0A92 41900010                   LA    @09,16  *OK-TO-STEAL LEVEL*
REP 0A96 49906086                   CH    @09,OUXBUIC(,OUXBPTR)
REP 0A9A 4720C214                   BH    @RF00143  *STEP TO NEXT USER*
*                          STEALPGE EQU   *
REP 0A9E 45E0C938                   BAL   @14,STEAL  *NORMAL STEAL*
REP 0AA2 47F0C1FC                   B     @RF00143-X'18'
*
* PART 3 - EXCLUDE FENCED JOB FROM SYSTEM-WIDE HIGH UIC CALCULATION.
*
VER 00EC 58605094                   L     OUXBPTR,ASCBOUXB(,OUXBPTR)
REP 00EC 47F0CAA4                   B     PATCH2
*
* CHECK INITIATED JOB NAME POINTED TO BY ASCB. IF STARTED JOB, THEN
* THIS MOD MUST USE ASCBJBNS.  IF FENCED, BYPASS CHECKING ITS HIGH UIC
* AGAINST SYSTEM-WIDE HIGH UIC AS CANDIDATE FOR NEW SYSTEM HIGH UIC.
*
*                          PATCH2   EQU   *
REP 0AA6 58F050AC                   L     @15,ASCBJBNI(,ASCBPTR)
REP 0AAA D507CA6EF000               CLC   FENCEJOB,0(@15)
REP 0AB0 4780C102                   BE    @RF00109 *BYPASS UIC CHECK*
REP 0AB4 58605094                   L     OUXBPTR,ASCBOUXB(,ASCBPTR)
REP 0AB8 47F0C0EE                   B     @RF00109-X'14'*NORMAL CHECK*
//SYSIN DD *
RECEIVE S(SM00023).
APPLY S(SM00023) DIS(NO).
LIST CDS SYSMOD(SM00023) DIS(NO).
//DUMPT EXEC PGM=AMASPZAP
//SYSPRINT DD SYSOUT=A
//SYSLIB DD DISP=SHR,DSN=SYS9.NUCLEUS
DUMPT IEANUC01 IRARMSTM

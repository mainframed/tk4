++USERMOD(JGS9918) . /* PAGE STEAL MODIFICATION ---
       FLOATING STORAGE FENCE (NON MVSSE).
       THIS MOD TO PAGE STEAL MONITOR MODULE PROTECTS A FAVORED,
     NONSWAPPABLE JOB FROM EXCESSIVE PAGE FAULTING BY INSULATING IT
     FROM PAGE STEALING AS ORIGINALLY IMPLEMENTED.  THIS STRATEGY
     DIFFERS FROM OTHER STORAGE FENCING IN THAT THE NUMBER OF
     FENCED PAGE FRAMES VARIES WITH THE DEMAND (AS MEASURED BY
     UIC) OF THE PROTECTED ADDRESS SPACE. AS ITS PRIVATE UIC
     DROPS STEAL IS INHIBITED AND MORE FRAMES ARE PROTECTED. AS
     IT IDLES UIC RISES AND STEAL RESUMES, RETURNING MORE OF ITS
     FRAMES TO THE PAGE FRAME POOL FOR USE BY OTHER ADDRESS
     SPACES.  ANOTHER KEY DIFFERENCE IS THAT THIS MOD EXCLUDES
     THE PROTECTED ADDRESS SPACE FROM SYSTEM-WIDE HIGH UIC
     CALCULATION, ENABLING SRM TO CONTINUE TO USE UIC IN
     ADJUSTING SYSTEM MPL.
       PART 1 REVERSES THE ORDER OF SELECTING ADDRESS SPACES FOR
     PAGE STEALING FROM LEAST-RECENTLY-SWAPPED-IN TO
     MOST-RECENTLY-SWAPPED-IN, THEREBY PROTECTING NON-SWAPPABLE,
     LONG-RUNNING JOBS AT ANY GIVEN LEVEL OF UIC.
       PART 2 BYPASSES STEALING FOR THE 'FAVORED' JOB IF ITS
     SPECIFIC UIC IS NOT ABOVE A FENCE LEVEL.  HOWEVER, A
     SAFETY-VALVE IS PROVIDED BY RESUMING NORMAL STEAL IF THIS
     JOB'S FRAME COUNT EXCEEDS A SPECIFIED DANGER LEVEL.
       PART 3 EXCLUDES THE FENCED JOB'S UIC FROM THE SYSTEM-WIDE
     HIGH UIC BECAUSE THE FENCED JOB WOULD DISTORT ONE OF THE
     IMPORTANT PAGING CONTENTION INDICATORS USED BY THE SRM.
       THIS VERSION IS AT PUT8104 LEVEL.  */
++VER (Z038) FMID(EBB1102) PRE(UZ35231) . /* PUT8104 */
++ZAP (IRARMSTM).
NAME IRARMSTM
 EXPAND IRARMSTM(80)
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
* PART 1 - START STEALING FROM BOTTOM OF RMCTINQE AND CONTINUE
* STEALING FROM MOST RECENTLY SWAPPED IN TO LEAST RECENTLY
* SWAPPED IN.
*
VER 01C8 58404004                   L     OUCBPTR,OUCBFWD(,OUCBPTR)
VER 0216 58404004                         DITTO
REP 01C8 58404008                   L     OUCBPTR,OUCBBWD(,OUCBPTR)
REP 0216 58404008                         DITTO
*
* FOLLOWING NEEDED IF INSTALLING EITHER PART 2 OR 3.
*
VER 0B40 00000000,00000000,00000000,00000000  EXPANSION PATCH AREA
VER 0B50 00000000,00000000,00000000,00000000
VER 0B60 00000000,00000000,00000000,00000000
VER 0B70 00000000,00000000,00000000,00000000
VER 0B80 00000000,00000000,00000000,00000000  LAST USED IS AT X'0B8C'
*
REP 0B40 E2E8E2D7C3C9C3E2  FENCEJOB DC    C'SYSPCICS' *INITIATED JOB
*                                                      NAME* @LLUMC
*** 0B40 C3C9C3E2F0F0F0F0  FENCEJOB DC    C'CICS0000' *INITIATED JOB
***                                                    NAME* @HOBART
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
* PART 2 - IF PRODUCTION CICS JOB, BYPASS STEAL IF ADDRESS SPACE
* DOES NOT HAVE MORE THAN 300 FRAMES AND IF ITS HIGH UIC IS BELOW 32.
*
VER 01FA 45E0C9FA                   BAL   @14,STEAL
REP 01FA 47F0CB46                   B     PATCH1
*
* CHECK INITIATED JOB NAME POINTED TO BY ASCB. IF JOB NOT FENCED, THEN
* STEAL FRAMES NORMALLY. NOTE - IF JOB IS A STARTED TASK, MOD MUST USE
* ASCBJBNS INSTEAD OF ASCBJBNI.
*
*                          PATCH1   EQU   *
REP 0B48 589050AC                   L     @09,ASCBJBNI(,ASCBPTR)
REP 0B4C D507CB3E9000               CLC   FENCEJOB,0(@9)
REP 0B52 4770CB6C                   BNE   STEALPGE
*
* CHECK FRAME COUNT AGAINST SAFETY LIMIT. IF FRAME COUNT TOO HIGH,
* INVOKE NORMAL STEAL. IF FRAME COUNT OK, CHECK UIC AGAINST PROTECTION
* LEVEL.  IF BELOW PROTECTION LEVEL, DON'T INVOKE STEAL AND RETURN TO
* CHECK NEXT INCORE USER.  IF UIC HIGH ENOUGH, INVOKE NORMAL STEAL.
*
REP 0B56 4190012C                   LA    @09,300   *SAFETY LIMIT*
REP 0B5A 49905098                   CH    @09,ASCBFMCT(,ASCBPTR)
REP 0B5E 4740CB6C                   BL    STEALPGE  *TOO HIGH*
REP 0B62 41900020                   LA    @09,32    *OK-TO-STEAL LEVEL*
REP 0B66 49906086                   CH    @09,OUXBUIC(,OUXBPTR)
REP 0B6A 4720C214                   BH    @RF00146  *STEP TO NEXT USER*
*                          STEALPGE EQU   *
REP 0B6E 45E0C9FA                   BAL   @14,STEAL *NORMAL STEAL*
REP 0B72 47F0C1FC                   B     @RF00146-X'18'
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
* PART 3 - EXCLUDE FENCED JOB FROM SYSTEM-WIDE HIGH UIC CALCULATION.
*
VER 00EC 58605094                   L     OUXBPTR,ASCBOUXB(,OUXBPTR)
REP 00EC 47F0CB74                   B     PATCH2
*
* CHECK INITIATED JOB NAME POINTED TO BY ASCB. IF STARTED JOB, THEN
* THIS MOD MUST USE ASCBJBNS.  IF FENCED, BYPASS CHECKING ITS HIGH UIC
* AGAINST SYSTEM-WIDE HIGH UIC AS CANDIDATE FOR NEW SYSTEM HIGH UIC.
*
*                          PATCH2   EQU   *
REP 0B76 58F050AC                   L     @15,ASCBJBNI(,ASCBPTR)
REP 0B7A D507CB3EF000               CLC   FENCEJOB,0(@15)
REP 0B80 4780C102                   BE    @RF00112  *BYPASS UIC CHECK*
REP 0B84 58605094                   L     OUXBPTR,ASCBOUXB(,ASCBPTR)
REP 0B88 47F0C0EE                   B     @RF00112-X'14'*NORMAL CHECK*

  /*TGSREST*/
 RESTORE: PROC OPTIONS (MAIN);
         % INCLUDE TGSFREE;
         % INCLUDE TGSQCR;
         DCL QCRMAIN CHAR (110);
         QC  = ADDR(QCRMAIN);
         DCL 1 DUMMY BIT (4) BASED (BDAM);
         DCL CURKEY FIXED DEC (9,0) INIT (0);
         DCL BDAMKEY CHAR (8);
         DCL BDAMKEYA PIC 'ZZZZZZZ9' DEF BDAMKEY;
         ON ENDFILE (BDAMFLE) GO TO RESTORED;
         DCL BDAMFLE FILE ENV(F RECSIZE(110) REGIONAL(1)) RECORD KEYED;
         DCL 1 BDAMREC CHAR (110);
         BDAM = ADDR(BDAMREC);
         OPEN FILE (BDAMFLE) OUTPUT SEQUENTIAL;
         DCL FCPRINT FIXED DEC (9,0);
         ON ENDFILE (BACKUP) GO TO DONEIN;
 BACKIN:
         READ FILE (BACKUP) INTO (BDAMREC);
         WRITE FILE (BDAMFLE) FROM (BDAMREC) KEYFROM (CURKEY);
         CURKEY = CURKEY + 1;
         GO TO BACKIN;
 DONEIN:
         CLOSE FILE (BDAMFLE);
         CLOSE FILE (BACKUP);
         OPEN FILE (BDAMFLE) UPDATE SEQUENTIAL;
         READ FILE (BDAMFLE) INTO (QCRMAIN);
         READ FILE (BDAMFLE) INTO (QCRMAIN);
         IF QC  -> DUMMY ^= '0'B THEN DO;
              QCR = 0;
              DAQCR = 1;
              END;
         CURKEY = 1;
 FREEREAD:
         CURKEY = CURKEY + 1;
         READ FILE (BDAMFLE) INTO (BDAMREC);
         IF DUMMY = '0'B THEN GO TO FREEREAD;
         DANFREE = DALFREE;
         DALFREE,DAFREE = CURKEY;
         FREE.PAD = ' ';
         REWRITE FILE (BDAMFLE) FROM (BDAMREC);
         FREECNT = FREECNT + 1;
         GO TO FREEREAD;
 RESTORED:
         CLOSE FILE (BDAMFLE);
         OPEN FILE (BDAMFLE) UPDATE DIRECT KEYED;
         BDAMKEYA = 1;
         WRITE FILE (BDAMFLE) FROM (QCRMAIN) KEYFROM (BDAMKEY);
         CLOSE FILE (BDAMFLE);
         FCPRINT = FREECNT;
         PUT DATA (FCPRINT);
         END RESTORE;

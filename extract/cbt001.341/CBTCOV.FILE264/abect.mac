 /* COPYRIGHT 1983 BY THOMAS GLEN SMITH */
 /**********************************************************************
 *                                                                     *
 * ABECT IS CALLED WHENEVER EITHER THE COLUMN OR TRUNCATE VALUES ARE   *
 * CHANGED.  IT ALTERS THE DISPLAY ACCORDINGLY.  ALIAS IS #COLTR.      *
 *                                                                     *
 **********************************************************************/
   %INCLUDE ABESUB;
 ABESUB(ABECT) PARMS(RHHDRPT) CHECK(YES);
   %INCLUDE ABESUBA;
   %INCLUDE ABERHPNL;
   %INCLUDE ABEPNL;
   DCL PREFIX ENTRY(CHAR(*),CHAR(*))
     RETURNS(FIXED BIN(15,0));
   DCL PTRIN ENTRY(PTR)
     RETURNS(FIXED BIN(31,0));
   DCL PTROUT ENTRY(FIXED BIN(31,0))
     RETURNS(PTR);
   DCL (HD1,HD2) CHAR(1024) VAR;
   DCL 1 SKEL BASED(SKELPTR),
     2 SKNXT PTR,
     2 STC FIXED BIN(15,0),
     2 ENC FIXED BIN(15,0);
   DCL BLNKS CHAR(1024) INIT(' ');
   DCL COL FIXED BIN(15,0);
   DO COL = COLUMN REPEAT COL-100 WHILE(COL > 100);
     END;
   @NXTPNL = 1;
   MAXSC = TRUNCATE-COLUMN+1;
   SQL=LINESIZE-RHPMAXLN-2;
   SCANLEN=MIN(MAXSC,SQL);
   DYNPTR = RHPDYNPT;
   PNLPTR = RHPSTAPT;
   SFLDPTR = ADDR(FLDLOC); /*GET FIELD DESCR FOR HEADING */
   DFLDPTR = PTROUT(PTRIN(DYNPTR)+DOUTOF+OUTOFF);
   HD1,HD2='';
   IF RHPSKHD=NULL
     THEN CALL NSEG(COLUMN,TRUNCATE);
     ELSE DO SKELPTR=RHPSKHD REPEAT SKNXT WHILE(SKELPTR^=NULL);
       CALL NSEG(STC,ENC);
       END;
   DATA=SUBSTR(BLNKS,1,RHPMAXLN+1)××HD1;
   SFLDPTR=PTROUT(PTRIN(SFLDPTR)+FLDLEN);
   DFLDPTR=PTROUT(PTRIN(DYNPTR)+DOUTOF+OUTOFF);
   DATA=SUBSTR(BLNKS,1,RHPMAXLN+1)××HD2;
   OUTFLAG(1) = '1'B;
   OUTFLAG(2) = '1'B;
   CALL #TABDISP(RHPPTR); /* TABDISP */

 NSEG:  PROC(ST,EN) OPTIONS(REENTRANT);
   DCL (ST,EN,I,J,K) FIXED BIN(15,0);
   DCL DIGIT PIC'9';
   DCL HDPIC PIC'ZZZZZZ9',
       HDSTR CHAR(7) DEF HDPIC;
   DCL NUMHD CHAR(7) VAR;
   NUMHD=' ';
   DO I=ST TO EN;
     DIGIT=MOD(I,10);
     HD2=HD2××DIGIT;
     IF DIGIT='0'
       THEN DO;
         HDPIC=I;
         NUMHD=SUBSTR(HDSTR,PREFIX(HDSTR,' '));
         END;
     HD1=HD1××SUBSTR(NUMHD,1,1);
     IF NUMHD^=' '
       THEN IF LENGTH(NUMHD)=1
         THEN NUMHD=' ';
         ELSE NUMHD=SUBSTR(NUMHD,2);
     IF RHPHEX
       THEN DO;
         HD1=HD1××' ';
         HD2=HD2××' ';
         END;
     END;
   END NSEG;
   END ABECT;

 /* REQRPT3 */
 /* THIS PROGRAM WILL GENERATE THE NECESSARY JCL TO RUN THE BI-WEEKLY
    DISK SPACE CLEANUP JOBS (AU109856).  UNLESS THE VOLUME IS FLAGGED
    IN THE REQSPACE DATA BASE, ONE JOB WILL BE GENERATED
    FOR EACH DISK VOLUME IN THE DISK SPACE MANAGEMENT DATA BASE.
    IN ADDITION, A FINAL JOB WILL BE GENERATED TO PRINT OUT ALL
    OF THE REPORTS GENERATED. */
 REQRPT3:  PROC OPTIONS(MAIN);
         DFT RANGE(*) FIXED BIN VALUE(FIXED BIN(15,0));
         DCL LOG2 BUILTIN;
         DCL JOBCARD CHAR(80) STATIC INIT(
   '//AU109856 JOB (10-339-0109-ISD-A1,010),BABLER-TC-CENTER,CLASS=C ');
         DCL REC CHAR(80);
         DCL DSSQ PIC'99' STATIC INIT(2);  /*INIT 2, TO INDICATE THE*/
         DCL NXT PIC'99' STATIC INIT(3);   /*SECOND FILE ON THE TAPE*/
                   /* ABOVE WAS CHANGED ON DEC. 21, 1977, R. BABLER */
         % INCLUDE TGSVOL;
         % INCLUDE TGSBDAM;
         % INCLUDE TGSQCR;
         DCL BDAM PTR;
         VOLRPTR,QC = ADDR(BDAMREC);
         DCL UNITA(0:3) CHAR(6) VARYING STATIC INIT(
           '3350',
           '3330-1',
           '3330',
           '2314');
         OPEN FILE(BDAMFLE) INPUT DIRECT KEYED;
         BDAMKEYA = 1;
         READ FILE(BDAMFLE) INTO(BDAMREC) KEY(BDAMKEY);
         BDAMKEYA = DAFSTVL;
         DO WHILE(BDAMKEYA ^= 0);
              READ FILE(BDAMFLE) INTO(BDAMREC) KEY(BDAMKEY);
              IF ^SUBSTR(VOLFLGS,16,1)
                   THEN DO;
                        I = SUBSTR(VOLFLGS,9,4);
                        I = LOG2(I);
                        REC='./ ADD NAME=U9856'××DSSQ;
                        WRITE FILE(JCLOUT) FROM(REC);
                        WRITE FILE(JCLOUT) FROM(JOBCARD);
  REC='/*MESSAGE      *** 1-'××UNITA(I)××'******** 1-9TRACK ********';
  WRITE FILE(JCLOUT) FROM(REC);
  IF I=0 THEN DO;
  REC='/*MESSAGE      *** '××VOLSER××'   U.SD.U000.REQFDR(0) ***';
  WRITE FILE(JCLOUT) FROM(REC);
  END;
  ELSE DO;
  REC='/*SETUP        *** '××VOLSER××'   U.SD.U000.REQFDR(0) ***';
  WRITE FILE(JCLOUT) FROM(REC);
  END;
                        REC='// EXEC U109856B,SER='××VOLSER××',UNIT='''
                          ××UNITA(I)××''',DSSQ='××DSSQ××',NXT='××NXT;
                        WRITE FILE(JCLOUT) FROM(REC);
                        DSSQ = DSSQ + 1;
                        NXT = DSSQ + 1;
                        END;
              BDAMKEYA = VOLNPT;
              END;
         REC='./ ADD NAME=U9856'××DSSQ;
         WRITE FILE(JCLOUT) FROM(REC);
         WRITE FILE(JCLOUT) FROM(JOBCARD);
         REC='// EXEC U109856C';
         WRITE FILE(JCLOUT) FROM(REC);
         END;

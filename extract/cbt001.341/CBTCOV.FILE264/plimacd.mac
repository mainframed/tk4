.HE GENERALIZED SUBROUTINES - PLIMACD
.HE PLI/BAL SUBROUTINE INTERFACE MACROS
.PL 55
.PN 0
.PA
.SS
.NF
6/7/74
AUTHOR:  T. SMITH
SOURCE MODULE NAME:  PLIMACD
DOCUMENTATION ID:  NONE
.FI L
.SP 5
THIS PAPER DESCRIBES A SERIES OF MACROS WHICH FACILITATE THE WRITING
OF SUBROUTINES IN BAL TO BE CALLED FROM PLI PROGRAMS.
.PA
.CE 1
PLIENTRY MACRO
.SP 1
THE PLIENTRY MACRO SHOULD BE ISSUED AS THE FIRST STATEMENT IN YOUR BAL
SUBROUTINE.  IT WILL GENERATE A CSECT STATEMENT WITH THE ENTRY NAME YOU
SPECIFY IN THE MACRO, FOLLOWED BY THE CODE NECESSARY TO SAVE THE CALLING
ROUTINES REGISTERS, AND TO ESTABLISH A NEW DSA FOR USE IN THE
SUBROUTINE.
.SP 1
.NF
&NAME PLIENTRY &DEBUG,
               &DSA=104,
               &COMPILE=O,
               &REGS=,
               &BASE=10
.SP 1
.FI L
&NAME
.IN 5
THIS IS A ONE TO SEVEN CHARACTER NAME THAT YOU WISH DESIGNATED AS THE
ENTRY POINT TO YOUR SUBROUTINE.  THE MACRO WILL GENERATE A CSECT
STATEMENT USING THIS NAME.
.IN 0
&DEBUG
.IN 5
THIS POSITIONAL PARAMETER IS OPTIONAL.  IF SPECIFIED, ONLY THE
CHARACTERS "DEBUG" ARE ACCEPTABLE.  IF NOT SPECIFIED, YOU MUST AT
LEAST CODE A COMMA INDICATING IT IS OMITTED.  THIS PARAMETER WILL CAUSE
THE MACRO TO GENERATE A SPIE MACRO WHICH WILL NULLIFY THE PLI ERROR
HANDLING ROUTINES SO THAT YOU CAN DEBUG YOUR SUBROUTINE FROM A
DUMP, IF NECESSARY.  NOTE THAT THIS PARAMETER SHOULD BE SPECIFIED
ONLY FOR TESTING.
.IN 0
&DSA=104
.IN 5
THIS KEYWORD PARAMETER TELLS THE MACRO HOW MUCH MAIN STORAGE YOU
DESIRE FOR A DSA.  IF YOU DON'T SPECIFY A DSA SIZE THE DEFAULT IS
104 BYTES, THE MINIMUM SIZE.  AS PART OF THE MACRO EXPANSION A DSECT
CALLED "DSA" IS GENERATED DESCRIBING THE FIRST 104 BYTES OF THE
DSA.  THIS FIRST 104 BYTES IS RESERVED, AND SHOULD NOT BE USED IN YOUR
CODE.  ADDITIONAL STORAGE BEYOND THE FIRST 104 BYTES MAY BE USED IN ANY
FASHION YOU SEE FIT, AND CAN BE USED TO MAKE YOUR SUBROUTINE REENTRANT.
YOU MAY CONTINUE THE DEFINITION OF THE DSA DSECT FURTHER ON IN YOUR
PROGRAM BY CODING ANOTHER DSECT STATEMENT NAMED "DSA" AND FOLLOWED
BY THE NECESSARY DEFINE STORAGE STATEMENTS.
.IN 0
&COMPILE=O
.IN 5
THIS KEYWORD PARAMETER TELLS THE MACRO WHETHER TO GENERATE CODE TO
INTERFACE TO THE OPTIMIZING COMPILER (COMPILE=O), OR THE LEVEL-F
COMPILER (COMPILE=F).  THE DEFAULT IS "COMPILE=O."
NOTE: BASED ON THIS PARAMETER, THE MACRO WILL CAUSE A GLOBAL VARIABLE
TO BE SET.  WHEN THE MACROS PLIEXIT, PLIGOTO, PLIPRINT, PLIREQU, AND
PLISIGNL ARE SUBSEQUENTLY ISSUED, THEY WILL CHECK THIS GLOBAL VARIABLE
AND WILL GENERATE CODE FOR EITHER THE OPTIMIZING COMPILER OR LEVEL-F
BASED ON ITS SETTING.  THIS GLOBAL VARIABLE IS &COMP, AND IS SET TO
EITHER 'O' OR 'F'.  YOU MIGHT WANT TO CHECK THIS GLOBAL IN YOUR OWN
CODE, AND CONDITIONALLY ASSEMBLE BASED ON ITS SETTING.
.IN 0
&REGS=
.IN 5
THIS KEYWORD PARAMETER TELLS THE MACRO WHETHER TO GENERATE REGISTER
EQUATES COMPATIBLE WITH THE OPTIMIZING COMPILER (REGS=O) OR THE
LEVEL-F COMPILER (REGS=F).  IF YOU DO NOT SPECIFY, THE DEFAULT IS
THE SPECIFICATION FOR THE COMPILE= KEYWORD.  NOTE THAT EVEN THOUGH
YOU MIGHT HAVE SPECIFIED "COMPILE=F," YOU CAN STILL SPECIFY
"REGS=O."  IT ALL DEPENDS ON WHICH SET OF REGISTER EQUATES YOU PREFER
TO USE.  SEE THE DESCRIPTION OF THE PLIREQU MACRO THE FOLLOWS FOR
A COMPLETE LIST OF THE TWO SETS OF REGISTER EQUATES.
.IN 0
&BASE=10
.IN 5
THIS KEYWORD PARAMETER TELLS THE MACRO WHAT REGISTER TO SET UP AS THE
BASE REGISTER.  THE DEFAULT IS 10.  YOU MUST NOT USE REGISTER 12 FOR
BASE REGISTER.
.IN 0
.PA
.CE 1
PLIEXIT MACRO
.SP 1
THIS MACRO SHOULD BE ISSUED IN YOUR CODE WHEN YOU WISH TO RETURN
CONTROL TO THE CALLING ROUTINE.  IT WILL CAUSE CODE TO BE GENERATED
TO RESTORE THE CALLERS REGISTERS AND FREE THE DSA.  ALSO, IF "DEBUG"
WAS SPECIFIED ON THE PLIENTRY MACRO, A SPIE MACRO WILL BE ISSUED
TO REINSTATE THE PLI ERROR HANDLING ENVIRONMENT.
.SP 1
PLIEXIT &COMPILE=
.SP 1
&COMPILE=
.IN 5
THIS KEYWORD PARAMETER IS THE SAME AS FOR THE PLIENTRY MACRO.
IT NEED NOT, AND SHOULD NOT, BE SPECIFIED IF THE PLIENTRY MACRO
WAS PREVIOUSLY ISSUED; THE APPROPRIATE CODE FOR EITHER THE
OPTIMIZING OR LEVEL-F COMPILER WILL BE GENERATED BASED ON THE
SETTING OF THE GLOBAL SETC VARIABLE &COMP.
.IN 0
.PA
.CE 1
PLIGOTO MACRO
.SP 1
THIS MACRO CAN BE USED TO PERFORM THE EQUIVALENT OF A GO TO STATEMENT
"OUT OF BLOCK" IN PLI.  IN OTHER WORDS, A GO TO TO A LABEL NOT IN
THE CURRENT PROCEDURE, BUT IN SOME CONTAINING PROCEDURE.
THE CURRENT DSA AND ALL DSAS UP TO THE DSA OF THE APPROPRIATE
PROCEDURE CONTAINING THE SPECIFIED TAG WILL BE FREED
BEFORE CONTROL IS TRANSFERED.
.SP 1
&NAME PLIGOTO &TAG,&COMPILE=
.SP 1
&COMPILE=
.IN 5
SPECIFIED THE SAME AS IN THE PLIENTRY MACRO.  SHOULD NOT BE SPECIFIED
IF A PLIENTRY MACRO WAS PREVIOUSLY ISSUED.
.IN 0
&TAG
.IN 5
THIS POSITIONAL PARAMETER SPECIFIES THE ADDRESS OF AN EIGHT-BYTE,
WORD ALIGNED PARAMETER LIST OF THE FOLLOWING FORMAT:
.IN 10
WORD 1 - EITHER INVOCATION COUNT (BIT 0 OF WORD 2 = 0) OR
PR OFFSET (BIT 0 OF WORD 2 = 1)
.IN 10
WORD 2 - A(LOCATION TO WHICH CONTROL IS TO BE RETURNED)
.IN 5
TAG CAN EITHER BE SPECIFIED AS A REGISTER NUMBER SURROUNDED BY
PARENTHESIS, OR AS A SYMBOL WHICH WILL BE ASSUMED TO BE AN
EXTERNAL SYMBOL, AND A VCON WILL BE GENERATED TO RESOLVE ITS
ADDRESS.
.IN 0
.PA
.CE 1
PLIPRINT MACRO
.SP 1
THIS MACRO CAN BE USED TO WRITE A MESSAGE (SUCH AS AN ERROR MESSAGE)
TO SYSPRINT.
.SP 1
&NAME PLIPRINT &CHAR,&LGTH,&COMPILE=,&PRNTCTL=00
.SP 1
&CHAR
.IN 5
THIS POSITIONAL PARAMETER CAN BE EITHER THE MESSAGE ITSELF
CONTAINED IN QUOTES, OR A SYMBOL REPRESENTING THE MESSAGE
IF &LGTH IS ALSO SPECIFIED, OR A SYMBOL REPRESENTING THE STRING
DOPE VECTOR FOR THE MESSAGE IF &LGTH IS NOT SPECIFIED,
OR A REGISTER NUMBER CONTAINED IN PARENTHESIS; THE REGISTER
CONTAINING THE ADDRESS OF THE MESSAGE
IF THE POSITIONAL PARAMETER &LGTH IS SPECIFIED, AND CONTAINING
THE ADDRESS OF A STRING DOPE VECTOR FOR THE MESSAGE IF THE
POSITIONAL PARAMETER &LGTH IS NOT SPECIFIED.
.IN 0
&LGTH
.IN 5
THIS POSITIONAL PARAMETER SPECIFIES THE LENGTH OF THE MESSAGE.
&LGTH SHOULD NOT BE SPECIFIED IF &CHAR IS SPECIFIED AS A CHARACTER
STRING IN QUOTES (THE LENGTH IS THE ASSEMBLED LENGTH), OR AS A
SYMBOL REPRESENTING THE ADDRESS OF A STRING DOPE VECTOR (THE LENGTH
IS ACQUIRED FROM THE SDV), OR AS A REGISTER CONTAINING THE ADDRESS
OF A STRING DOPE VECTOR (DITTO).
&LGTH CAN EITHER BE SPECIFIED AS A SYMBOL REPRESENTING THE ADDRESS OF
A HALFWORD CONTAINING THE LENGTH OF THE MESSAGE, OR AS A REGISTER
NUMBER IN PARENTHESIS; THE REGISTER CONTAINING THE ADDRESS OF A HALFWORD
CONTAINING THE LENGTH OF THE MESSAGE.
.IN 0
&COMPILE=
.IN 5
SPECIFIED THE SAME AS IN THE PLIENTRY MACRO.  SHOULD NOT BE SPECIFIED
IF THE PLIENTRY MACRO WAS PREVIOUSLY ISSUED.
.IN 0
&PRNTCTL=00
.IN 5
THIS PARAMETER HAS SIGNIFICANCE ONLY TO THE OPTIMIZING COMPILER.
.IN 0
.PA
.CE 1
PLIREQU MACRO
.SP 1
THIS MACRO IS USED TO ESTABLISH A SET OF REGISTER EQUATES.  IT IS
ISSUED AUTOMATICALLY FOR YOU IF YOU USE THE PLIENTRY MACRO
PREVIOUSLY DESCRIBED.
.SP 1
PLIREQU &REGS
.SP 1
&REGS
.IN 5
SPECIFIES WHICH OF TWO POSSIBLE SETS OF REGISTER EQUATES SHOULD
BE GENERATED.
.IN 10
.NF
REGS=O
.SP 1
R0 EQU 0
R1 EQU 1
R2 EQU 2
R3 EQU 3
R4 EQU 4
R5 EQU 5
R6 EQU 6
R7 EQU 7
R8 EQU 8
R9 EQU 9
RA EQU 10
RB EQU 11
RC EQU 12
RD EQU 13
RE EQU 14
RF EQU 15
AR EQU 3
RX EQU 10
RY EQU 11
CR EQU 12
DR EQU 13
LR EQU 14
BR EQU 15
.SP 1
REGS=F
.SP 1
LR EQU 14
RY EQU 14
BR EQU 15
RZ EQU 15
R0 EQU 0
R1 EQU 1
RA EQU 1
RB EQU 2
RC EQU 3
RD EQU 4
RE EQU 5
RF EQU 6
RG EQU 7
RH EQU 8
RI EQU 9
RJ EQU 10
RX EQU 11
WR EQU 11
PR EQU 12
DR EQU 13
.IN 0
.FI L
.PA
.CE 1
PLISIGNL MACRO
.SP 1
THIS MACRO MAY BE USED TO SIGNAL ON-CONDITIONS SUCH AS "ERROR" OR
"FINISH" OR USER-DEFINED.
.SP 1
&NAME PLISIGNL &TYPE,&COND=,&FILE=,&COMPILE=
.SP 1
&TYPE
.IN 5
THIS PARAMETER SPECIFIES THE TYPE OF CONDITION TO BE SIGNALLED.
ONLY THE TYPES "ERROR," "FINISH," AND "CONDITION" ARE PERMITTED
WITH THE LEVEL-F COMPILER.  THE FOLLOWING TABLE LISTS THE POSSIBLE
CONDITIONS FOR THE OPTIMIZING COMPILER.
.IN 10
.NF
ZERODIVIDE
FIXEDOVERFLOW
SIZE
CONVERSION
OVERFLOW
UNDERFLOW
STRINGSIZE
STRINGRANGE
SUBSCRIPTRANGE
AREA
ERROR
FINISH
CONDITION
KEY
RECORD
UNDEFINEDFILE
ENDFILE
TRANSMIT
NAME
ENDPAGE
.IN 0
.FI L
&COND=
.IN 5
THIS KEYWORD SHOULD BE SPECIFIED ONLY IF &TYPE WAS SPECIFIED AS
"CONDITION."  IN THIS CASE, &COND= SHOULD SPECIFY A USER-DEFINED
CONDITION NAME THAT IS 8 CHARACTERS OR LESS.
.IN 0
&FILE=
.IN 5
THIS KEYWORD MUST BE SPECIFIED IF ONE OF THE CONDITIONS RELATED TO
I/O HAS BEEN SPECIFIED IN THE &COND= KEYWORD.
THE CONDITIONS RELATED TO I/O ARE KEY, RECORD, UNDEFINEDFILE,
ENDFILE, TRANSMIT, AND ENDPAGE.  &FILE= SPECIFIES THE ADDRESS
THE ADDRESS OF THE DCLCB, AND CAN BE SPECIFIED AS SYMBOL (A
VCON IS THEN GENERATED TO RESOLVE THE ADDRESS), OR AS A
REGISTER NUMBER IN PARENTHESIS (THE REGISTER WILL CONTAIN THE ADDRESS
OF THE DCLCB).
.IN 0
&COMPILE=
.IN 5
SPECIFIED THE SAME AS WITH THE PLIENTRY MACRO.  SHOULD NOT BE
SPECIFIED IF THE PLIENTRY MACRO HAS BEEN PREVIOUSLY ISSUED.

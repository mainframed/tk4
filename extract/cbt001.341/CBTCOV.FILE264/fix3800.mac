 FIX3800: PROC OPTIONS(MAIN);
   %INCLUDE @HEXCHAR;
   DCL BUF CHAR(32760) VAR;
   DCL PAGENO PIC'99999' INIT(0);

   ON ENDFILE(IN) GO TO EOJ;
   DO I=1 REPEAT I+1;
     READ FILE(IN) INTO(BUF);
     J=1;
     IF LENGTH(BUF)>4
       THEN SELECT(SUBSTR(BUF,4,3));
         WHEN(@HEXCHAR(D3A8A8)) /* BEGIN DOCUMENT */
           IF I>1 THEN J=0; /* ONLY WRITE THE FIRST */
         WHEN(@HEXCHAR(D3A9A8)) /* END DOCUMENT */
           J=0; /* ONLY WRITE THE LAST */
         WHEN(@HEXCHAR(D3A8AF)) DO; /* BEGIN PAGE */
           PAGENO=PAGENO+1;
           SUBSTR(BUF,13,5)=PAGENO;
           END;
         WHEN(@HEXCHAR(D3A9AF)) /* END PAGE */
           SUBSTR(BUF,13,5)=PAGENO;
         OTHERWISE;
         END; /* SELECT */
     IF J=1
       THEN WRITE FILE(OUT) FROM(BUF);
     END;
 EOJ:
   WRITE FILE(OUT) FROM(BUF); /* WRITE OUT LAST END DOCUMENT CODE */
   END FIX3800;

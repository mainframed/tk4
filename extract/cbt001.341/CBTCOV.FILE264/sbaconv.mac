 /* SBACONV
*$.HE GENERALIZED SUBROUTINES - SBACONV
*$.HE CONVERT 3277 SET BUFFER ADDRESS
*$.PL 55
*$.PN 0
*$.PA
*$.SS
*$.NF
*$6/1/76
*$AUTHOR:  T. SMITH
*$SOURCE MODULE NAME:  SBACONV
*$DOCUMENTATION ID:  *$
*$.FI L
*$.SP 5
*$THIS SUBROUTINE IS INVOKED TO CONVERT THE ADDRESS PORTION OF A
*$3277 SET BUFFER ADDRESS COMMAND FROM BINARY TO TRANSMISSION CODE,
*$OR VICE VERSA.  FORMAT TO CALL THE ROUTINE IS AS FOLLOWS -
*$.SP 1
*$.IN 5
*$CALL SBACONV(SBADDR,SWITCH);
*$.SP 1
*$WHERE -
*$.SP 1
*$SBADDR IS FIXED BIN(15,0).
*$.SP 1
*$SWITCH IS DECLARED AS BIT(1), AND IS SET TO '1'B IF THE ADDR
*$IS TO BE CONVERTED TO TRANSMISSION CODE, AND '0'B IF THE ADDR
*$IS TO BE CONVERTED TO BINARY.
 */
 SBACONV:  PROC(SBADDR,SWITCH) OPTIONS(REENTRANT);
         DCL TRTABA(64) BIT(8) STATIC INIT(
 '01000000'B,'11000001'B,'11000010'B,'11000011'B,'11000100'B,
 '11000101'B,'11000110'B,'11000111'B,'11001000'B,'11001001'B,
 '01001010'B,'01001011'B,'01001100'B,'01001101'B,'01001110'B,
 '01001111'B,'01010000'B,'11010001'B,'11010010'B,'11010011'B,
 '11010100'B,'11010101'B,'11010110'B,'11010111'B,'11011000'B,
 '11011001'B,'01011010'B,'01011011'B,'01011100'B,'01011101'B,
 '01011110'B,'01011111'B,'01100000'B,'01100001'B,'11100010'B,
 '11100011'B,'11100100'B,'11100101'B,'11100110'B,'11100111'B,
 '11101000'B,'11101001'B,'01101010'B,'01101011'B,'01101100'B,
 '01101101'B,'01101110'B,'01101111'B,'11110000'B,'11110001'B,
 '11110010'B,'11110011'B,'11110100'B,'11110101'B,'11110110'B,
 '11110111'B,'11111000'B,'11111001'B,'01111010'B,'01111011'B,
 '01111100'B,'01111101'B,'01111110'B,'01111111'B);
  DCL TRTAB CHAR(64) DEF TRTABA;
         DCL SWITCH BIT(1);
         DCL SBADDR FIXED BIN(15,0);
         DCL SBAPTR PTR;
         SBAPTR = ADDR(SBADDR);
         DCL 1 SBACON2 BASED(SBAPTR),
              2 SBADDR1 BIT(8),
              2 SBADDR2 BIT(8);
         DCL SBADDRC CHAR(2) BASED(SBAPTR);
         DCL SBAWRK FIXED BIN(15,0),
             SBAWRKB BIT(16) DEF SBAWRK;
         IF SWITCH
              THEN DO;
                   /*CONVERTS BUF ADDR FROM BINARY TO 3270 CODE */
                   SBAWRK = SBADDR/64;
                   SBADDR1 = SUBSTR(SBAWRKB,9,8);
                   SBADDR2 = SBADDR2 & '00111111'B;
                   CALL XLATE(SBADDRC,TRTAB);
                   END;
              ELSE DO;
                   /*CONVERTS BUF ADDR FROM 3270 CODE TO BINARY */
                   SBADDR1 = SBADDR1 & '00111111'B;
                   SBADDR2 = SBADDR2 & '00111111'B;
                   I = SBADDR1;
                   J = SBADDR2;
                   SBADDR = I*64+J;
                   END;
         END;

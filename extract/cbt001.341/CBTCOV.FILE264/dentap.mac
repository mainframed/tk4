 /* COPYRIGHT 1983 BY THOMAS GLEN SMITH */
 DENTAP: PROC(SUBENT,RHHDRPT) OPTIONS(REENTRANT);
 /**********************************************************************
 * THIS SUBROUTINE IS CALLED WHENEVER A SUBCOMMAND ISSUES RETURN CODE  *
 * (IN RHRC) WHICH IS GREATER THAN RHRCLIM, WHICH IS SET VIA THE RLIM  *
 * SUBCOMMAND.  DENTAP WILL PURGE ALL SUBCOMMAND STACKS, AND WILL ALSO *
 * PURGE THE RUN STACK.                                                *
 **********************************************************************/
   % DCL @PROCNAME CHAR;
   % @PROCNAME = '';
   % INCLUDE DENTSUB;
   DCL 1 RUNDATA UNALIGNED BASED(RUNPTR),
       /* RUN STACK ELEMENT - EACH ELEMENT REPRESENTS
          A RUN CURRENTLY IN PROGRESS. */
     2 RUNPOP PTR,
       /* PTR TO NEXT RUN STACK ELEMENT */
     2 RUNPRE PTR,
       /* PTR TO PRIOR RUN STACK ELEMENT */
     2 RUNRHP PTR,
       /* PTR TO RECHDR FOR DATA SET TO WHICH ARUN IS DONE */
     2 RUNRHEL PTR,
       /* PTR TO RECHDR ASSOCIATED WITH THIS RUN */
     2 RUNCUR PTR,
       /* PTR TO CURRENT REC STRUCTURE */
     2 LABI FIXED BIN(31,0),
       /* INDEX TO THE HIGHEST ELEMENT USED IN RHAIDLBT */
     2 LABTAB(256),
      3 $KEY FIXED BIN(31,0),
      3 $LAB CHAR(8);
   DCL 1 BLSTR BASED(BLPTR),
     2 NBLPTR PTR,
     2 BLCMDLEN FIXED BIN(15,0),
     2 BLCMD CHAR(L REFER(BLCMDLEN)) VAR;
   DO RHPTR=NXTRHEL REPEAT RHNXT WHILE(RHPTR^=NULL);
     DO BLPTR=BLHDR REPEAT BLHDR WHILE(BLPTR^=NULL);
       BLHDR=NBLPTR;
       FREE BLSTR;
       END;
     END;
   DO RUNPTR = RHRUNSTK REPEAT RHRUNSTK
     WHILE(RHRUNSTK^=NULL);
     RHRUNSTK = RUNPOP;
     FREE RUNDATA;
     END;
   END DENTAP;

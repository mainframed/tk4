 /* COPYRIGHT 1983 BY THOMAS GLEN SMITH */
 /* DENT039 - PGM */
   % DCL @PROCNAME CHAR;
   % @PROCNAME = 'DENT039';
   % INCLUDE DENTSUB;
   % INCLUDE DCB;
   DCL DDN PTR;
   DCL DSN CHAR(44) VAR INIT('');
   DCL LISTPTR PTR;
   DCL 1 LIST,
    2 FF FIXED BIN(15,0) INIT(1),
    2 LL FIXED BIN(15,0) INIT(58),
    2 PGMNAME CHAR(8),
    2 PAD CHAR(80);
   DCL ALCODE CHAR(3) VAR STATIC INIT('BPA');
   DCL EP ENTRY VARIABLE,
       1 EPDF BASED(ADDR(EP)),
         2 EPTR FIXED BIN(31,0),
         2 EPZERO FIXED BIN(31,0);
   DCL INITSW BIT(1) STATIC INIT('1'B);
   DCL DUMCOR(28) FIXED BIN(31,0) STATIC,
       DCBCOR CHAR(112) DEF DUMCOR;
   DCL DCBPATPT PTR STATIC;
   DCL MYDCBPT PTR,
       MYDCBPTF FIXED BIN(31,0) DEF MYDCBPT;
   DCL DCBPAT CHAR(112) BASED(DCBPATPT);
   DCL (SYSBLDL,SYSLOAD,SYSDELE,SETCAPS,SYSDCBP,SYSOPEN,SYSCLOS) ENTRY;
   DDN=NULL;
   RHRC=0;
   I=INDEX(PARY(2),'(');
   IF I=0
     THEN DO;
       MYDCBPTF=0;
       PGMNAME=PARY(2);
       END;
     ELSE DO;
       MYDCBPT=ADDR(DCBCOR);
       J=INDEX(PARY(2),')');
       IF (J=0) × ((J-I) > 9)
         THEN DO;
           MSGDATA='INVALID DSNAME';
           RHRC=8;
           RETURN;
           END;
       PGMNAME=SUBSTR(PARY(2),I+1,J-I-1);
       DSN=SUBSTR(PARY(2),1,I-1);
       IF SUBSTR(PARQCK,2,1)
         THEN DSN=''''××DSN××'''';
       CALL #DOALC(DSN,ALCODE,DDN,NULL); /* CALL DOALC */
       IF DDN=NULL
         THEN DO;
           MSGDATA='UNABLE TO ALLOCATE DATA SET';
           RHRC=8;
           RETURN;
           END;
       IF INITSW
         THEN DO;
           INITSW='0'B;
           CALL SYSDCBP(DCBPATPT,DDN->ALCDDN);
           END;
       DCBCOR=DCBPAT;
       MYDCBPT->DCBDDNAM=DDN->ALCDDN;
       CALL SYSOPEN(MYDCBPT,'INPUT');
       IF ^SUBSTR(MYDCBPT->DCBFNDA.DCBOFLGS,4,1)
         THEN DO;
           MSGDATA='UNABLE TO OPEN DATA SET';
           RHRC=8;
           RETURN;
           END;
       END;
   CALL SETCAPS(PGMNAME);
   LISTPTR=ADDR(LIST);
   CALL SYSBLDL(MYDCBPT,LISTPTR,RETCODE);
   IF RETCODE^=0
     THEN DO;
       MSGDATA='PGM '××PGMNAME××' NOT FOUND';
       RHRC=8;
       END;
     ELSE DO;
       CALL SYSLOAD(PGMNAME,EPTR,MYDCBPT);
       EPZERO=0;
       PAROCK=SUBSTR(PAROCK,2);
       PARQCK=SUBSTR(PARQCK,2);
       DO I=1 TO 15;
         PARY(I)=PARY(I+1);
         END;
       CALL EP(CMDINDX,PARPTR,RHPTR,SUBENT,RHHDRPT);
       CALL SYSDELE(PGMNAME);
       END;
   IF DDN^=NULL
     THEN DO;
       CALL SYSCLOS(MYDCBPT);
       CALL #DOFRE(DDN); /* CALL DOFRE */
       DDN=NULL;
       END;
   END;

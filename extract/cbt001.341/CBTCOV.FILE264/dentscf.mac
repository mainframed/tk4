 /* COPYRIGHT 1983 BY THOMAS GLEN SMITH */
 DENTSCF:  PROC (RHPPTR,SUBENT) OPTIONS(REENTRANT);
 /* THIS SUBROUTINE IS CALLED WHENEVER THE SCREEN FORMAT HAS BEEN
 CHANGED.  IT WILL CHECK TO FIND OUT WHAT THE CURRENT FORMAT IS
 (E.G. 24X80 OR 27X132) AND WILL RESET VARIOUS CONTROL BLOCKS
 ACCORDINGLY. */
 % DCL @PROCNAME CHAR;
 % @PROCNAME = '';
 % INCLUDE DENTSUB;
 % INCLUDE DENTPNL;
   DCL RHPPTR PTR;
   DCL (DENTSCG,TERMCTL) ENTRY;
   DCL STFSMOD ENTRY(CHAR(*),CHAR(*),FIXED BIN(15,0))
     RETURNS(FIXED BIN(15,0));
   CALL TERMCTL('GTSIZE',TRET,SCREENLEN,LINESIZE);
   IF SCREENLEN = 0
     THEN HARDCOPY = '1'B;
     ELSE HARDCOPY = '0'B;
   IF HARDCOPY
     THEN DO;
       SCREENLEN=24;
       LINESIZE=80;
       END;
     ELSE DO;
       J=STFSMOD('ON','INITIAL=YES',0);
       STFSMODE='1'B;
       END;
   DYNPTR = RHPDYNPT;
   PNLPTR = RHPSTAPT;
   SFLDPTR = ADDR(FLDLOC);
   DO J = 1 TO FLDCNT WHILE(SUBSTR(FLAGS,3,1));
     WRKPTR = SFLDPTR;
     /*SAVE POTENTIAL MESSAGE FIELD PTR */
     SFLDADJ = SFLDADJ + FLDLEN;
     END;
   DFLDPTR = DYNPTR;
   DFLDADJ = DFLDADJ+DOUTOF+WRKPTR->OUTOFF;
   MSGPTR=DFLDPTR;
   MSGNUM=WRKPTR->FLDNUM;
   /* SFLDPTR = A(1ST UNPROTECTED FIELD) */
   DFLDPTR = DYNPTR;
   DFLDADJ = DFLDADJ+DINOF+INOFF;
   CMDPTR = DFLDPTR;
   DFLDPTR = DYNPTR;
   DFLDADJ = DFLDADJ + DOUTOF + OUTOFF;
   CMDOPTR = DFLDPTR;
   CMDSPTR = SFLDPTR;
   SFLDADJ = SFLDADJ + FLDLEN;
   DFLDPTR=DYNPTR;
   DFLDADJ=DFLDADJ+DOUTOF+OUTOFF;
   TABPTR=DFLDPTR;
   TABNUM=FLDNUM;
   DO J = 1 TO INCNT WHILE(SUBSTR(FLAGS,3,1));
     /* DO WHILE PROTECTED */
     SFLDADJ = SFLDADJ + FLDLEN;
     END;
   /* SFLDPTR = A(1ST RECORD INPUT FIELD) */
   INPTR = SFLDPTR;
   TRUNCATE = LINESIZE-RHPMAXLN-2;
   RHPFILL=MIN(RHPFILL,TRUNCATE);
   COLUMN = 1;
   CALL DENTSCG(RHPPTR,SUBENT);
   CALL #COLTR(RHPPTR,SUBENT); /* COLTR */
     /*GO SET DISPLAY FOR NEW COL/TRUNC*/
   @CURPNL = 0;
   @NXTPNL = 1;
   @CHGCURS = -1;
   @CALLFLGS = '0'B;
   NXTPNL,CURPNL = @NXTPNL;
   END DENTSCF;

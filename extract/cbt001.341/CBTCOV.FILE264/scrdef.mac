  /*SCRDEF*/
  % INCLUDE CPINIT1;
  % @CMP ='O';
  % INCLUDE CPINIT2;
  DFT RANGE(*) FIXED BIN VALUE(FIXED BIN(31,0));
  DCL PLIXOPT CHAR(15) VAR INIT('ISA(1000K)') STATIC EXT;
  DCL TMPFILE FILE RECORD OUTPUT ENV(FB RECSIZE(80));
  DCL PNL ENTRY;
  DCL SCREEN ENTRY(CHAR(*) VARYING) RETURNS(CHAR(32000) VARYING);
  DCL BLNKS CHAR(6000) STATIC INIT('');
  DCL TSTR CHAR(6000) VAR;
  DCL (MYSTR,PANSTR) CHAR(32767) VARYING;
  DCL NEWSTR(5) CHAR(32767) VAR;
  DCL REPEAT BUILTIN;
  DCL (SUFFIX,PREFIX) ENTRY RETURNS(FIXED BIN(15,0));
  DCL (INSW,OUTSW) BIT(1) STATIC INIT('0'B);
  DCL INREC CHAR(80);
  DCL 1 OUTREC,
    2 PAD1 CHAR(1) INIT(' '),
    2 OUT CHAR(71) INIT(''),
    2 SEQ PIC'(8)9'INIT(10);
  DCL OUTOFF FIXED BIN(15,0) INIT(1);
  DCL (SCR1920,SCR3440,SCR3564) ENTRY(CHAR(32767) VAR)RETURNS(CHAR(
  32767) VAR);
  DCL (@ROWS,@COLS,SCRSIZE) FIXED BIN(31,0) EXT;
  DCL SYSLINK ENTRY;
  DCL CLRSCRN CHAR(8) INIT('CLRSCRN');
  DCL RETCODE FIXED BIN(31,0);
  DCL 1 PARM,
    2 PLEN FIXED BIN(15,0) INIT(2),
    2 PSTR CHAR(2);
  @PROC(0,OUTDA(ODSN#(DSNAME)),INDA(IDSN#(DSNAME)));
  IF SETDSN@(IDSN) =''& SETDSN@(ODSN) =''
    THEN DO;
      @WRITE('ERROR - EITHER INDA OR OUTDA REQUIRED');
      SIGNAL ERROR;
      END;
  PSTR='QL';
  CALL SYSLINK(CLRSCRN,RETCODE,PLEN);
  @ROWS=RETCODE;
  PSTR='QW';
  CALL SYSLINK(CLRSCRN,RETCODE,PLEN);
  @COLS=RETCODE;
  SCRSIZE=@ROWS*@COLS;
  IF SETDSN@(IDSN) ^=''
    THEN DO;
      INSW ='1'B;
      @SETDSN(IDSN,PLI);
      END;
  IF SETDSN@(ODSN) ^=''
    THEN OUTSW ='1'B;
  IF ^INSW
    THEN MYSTR = SUBSTR(BLNKS,1,SCRSIZE);
    ELSE DO;
      IF ^OUTSW
        THEN @ALLOC(DA,OLD);
        ELSE @ALLOC(DA,SHR);
      OPEN FILE(IN) TITLE(DA08DDN) RECORD INPUT;
      DO UNTIL(SUBSTR(INREC,2,11)='/*#@$SCREEN');
        READ FILE(IN) INTO(INREC);
        END;
      MYSTR ='';
      INITLP:DO FOREVER=1 REPEAT FOREVER;
        READ FILE(IN) INTO(INREC);
        IF SUBSTR(INREC,1,3) =' */'
          THEN LEAVE INITLP;
        MYSTR=MYSTR××SUBSTR(INREC,2,71);
        END;
      CLOSE FILE(IN);
      IF OUTSW
        THEN DO;
          DA18DDN=DA08DDN;
          @FREE(DA,KEEP);
          END;
      END;
  IF OUTSW
    THEN DO;
      @SETDSN(ODSN,PLI);
      @ALLOC(DA,WORK);
      END;
    ELSE IF ^INSW
      THEN DO;
        @WRITE('ERROR - NEITHER IN NOR OUT DATA SET SPECIFIED');
        SIGNAL ERROR;
        END;
  OPEN FILE(TMPFILE) TITLE(DA08DDN);
  L = LENGTH(MYSTR);
  IF L < SCRSIZE-1
    THEN MYSTR=MYSTR××SUBSTR(BLNKS,1,SCRSIZE-1-L);
  SELECT(SCRSIZE);
    WHEN(1920) DO;
      PANSTR=SCR1920(MYSTR);
      RELEASE SCR1920;
      END;
    WHEN(3440) DO;
      PANSTR=SCR3440(MYSTR);
      RELEASE SCR3440;
      END;
    WHEN(3564) DO;
      PANSTR=SCR3564(MYSTR);
      RELEASE SCR3564;
      END;
    OTHERWISE DO;
      PUT SKIP LIST('ERROR - UNSUPPORTED SCREEN SIZE');
      SIGNAL ERROR;
      END;
    END;
  OUT ='/*#@$SCREEN';
  WRITE FILE(TMPFILE) FROM(OUTREC);
  SEQ = SEQ + 10;
  OUTOFF=1; /* BUG - OUTOFF IS LOSING ITS INITIALIZATION VALUE */
  TSTR=PANSTR;
  CALL WRITSTR(TSTR);
  CALL WRITSTR(REPEAT(' ',71-OUTOFF));
  OUT='*/';
  WRITE FILE(TMPFILE) FROM(OUTREC);
  SEQ = SEQ + 10;
  OUTOFF=1;
  MYSTR=SCREEN('@'××PANSTR)××' @ENDPNL(LAST);';
  CALL PNL(MYSTR,NEWSTR(*));
  DO Q = 1 TO HBOUND(NEWSTR,1);
    CALL WRITSTR(NEWSTR(Q));
    END;
  CALL DOCLOSE;
  DA18DDN = DA08DDN;
  @FREE(DA,KEEP);
  DOCLOSE:PROC;
    DCL STR CHAR(71) VAR;
    IF OUTOFF^=1
      THEN DO;
        STR=REPEAT(' ',71-OUTOFF);
        CALL WRITSTR(STR);
        END;
    CLOSE FILE(TMPFILE);
    END DOCLOSE;
  WRITSTR:PROC(STR);
    DCL (I,J,K,L) FIXED BIN(31,0);
    DCL STR CHAR(*) VARYING;
    DO FOREVER=1 REPEAT FOREVER;
      SUBSTR(OUT,OUTOFF,72-OUTOFF)=STR;
      K=71-OUTOFF+1; /* K=# BYTES AVAILABLE IN OUT */
      L = LENGTH(STR);
      IF K>=L
        THEN DO;
          OUTOFF=OUTOFF+L;
          IF OUTOFF>71
            THEN DO;
              OUTOFF=1;
              WRITE FILE(TMPFILE) FROM(OUTREC);
              SEQ = SEQ + 10;
              END;
          RETURN;
          END;
        ELSE DO;
          STR=SUBSTR(STR,K+1);
          OUTOFF=1;
          WRITE FILE(TMPFILE) FROM(OUTREC);
          SEQ = SEQ + 10;
          END;
      END;
    END WRITSTR;
  END;

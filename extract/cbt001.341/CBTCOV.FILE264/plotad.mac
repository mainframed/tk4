 TESTDSN:  PROC(DSN) RETURNS(FIXED BIN(15,0));
 /* RETURNS 0 IF DATA SET EXISTS AND IS USEABLE.
            4 IF DATA SET EXISTS BUT MUST BE INITIALIZED.
            8 IF DATA SET DOES NOT EXIST. */
         % INCLUDE CTLGDEF;
         % INCLUDE DSCB1;
         DCL WRKPTR PTR,
             WRKADJ FIXED BIN(31,0);
         DCL WKAREA CHAR(148);
         WRKPTR = ADDR(WKAREA);
         WRKADJ = WRKADJ - 44;
         DSCB1PTR = WRKPTR;
         DCL RETCODE FIXED BIN(31,0),
             RET BIT(32) DEF RETCODE,
             RETC CHAR(4) DEF RETCODE;
         DCL 1 ABND STATIC,
              2 DUM BIN FLOAT(53),
              2 MAREA CHAR(265);
         CTLGPTR = ADDR(MAREA);
         DCL MYVOL CHAR(6);
         DCL DSN CHAR(44) VAR;
         DCL (SYSCTLG,SYSVTOC) ENTRY;
         CALL SYSCTLG('NAME',RET,DSN,'SYSRES',MAREA);
         IF RETCODE ^= 0
              THEN RETURN(8); /* DATASET DOESN'T EXIST */
         MYVOL = VLSTBLK.VOLID.VOLSER(1);
         CALL SYSVTOC('SEARCH',RET,DSN,MYVOL,WKAREA);
         IF RETCODE ^= 0
              THEN RETURN(8); /* DATASET DOESN'T EXIST */
         IF DS1LSTAR = '0'B
              THEN RETURN(4);
         RETURN(0);
         END;

*PROCESS M,CS(60);
  /* PRNT */
  % INCLUDE CPINIT;
  DCL JCLA(6) CHAR(80) STATIC INIT(
  '/*ROUTE  PRINT &AT',
  '// EXEC PGM=GPRNT,REGION=64K,PARM=''/&OFF,&MYPGS,&SKIP''',
  '//SYSPRINT DD SYSOUT=A',
  '//IN DD DSN=&MYDSN,DISP=(SHR,&DISP)&MYRFM',
  '//OUT DD SYSOUT=&MYSYS,COPIES=&COPY&MYUCS&MYCHARS&MYFCB&MYOUT,',
  '// DCB=(LRECL=2004,BLKSIZE=2008,RECFM=V&CC)&MYBUR&MYFL');
  DCL OUT1 CHAR(80) STATIC INIT(
    '//OUT1 OUTPUT PRMODE=PAGE&MYPDF&MYFDF');
  DCL (MYDSN,MYSYS,MYUCS,MYCHARS,MYFCB,MYRFM,MYFL,MYPDF,MYFDF,MYOUT,
    PDFDFT,FDFDFT,PGSDFT) CHAR(44) VARYING;
  DCL INQUAL CHAR(46) VARYING;
  DCL PRMODE FIXED BIN INIT(0);
  INLEN = 0;
  J = 1;
  DCL MYUSERID CHAR(7) VARYING;
  MYUSERID = SYMC('&SYSUID');
  DCL REC CHAR(80);
  @PROC(1,DSN#(DSNAME),CC(A),AT(LOCAL),SYSOUT(A),FORM(),CHARS(),
    DISP(KEEP),COPY(1),OFF(0),UCS(),BURST,FLASH(),NOFLASH,
    JOBCARD(#(DSNAME,DEFAULT=JOBCARD)),
    PGSIZE(0#(NUMERIC)),SKIP(0#(NUMERIC)),FCB(),PROMPT,RECFM(),
    PAGEDEF(),FDEF());
  IF BURST ^= 0
    THEN @SETL(&MYBUR=',BURST=Y');
  MYUCS = SYMC('&UCS');
  IF MYUCS ^=''
    THEN MYUCS=',UCS='××MYUCS;
  @SETL(&MYUCS=MYUCS);
  MYFCB = SYMC('&FCB');
  IF MYFCB ^=''
    THEN MYFCB=',FCB='××MYFCB;
  @SETL(&MYFCB=MYFCB);
  MYCHARS = SYMC('&CHARS');
  PRMODE=0;
  PDFDFT='090C0';
  FDFDFT='0101';
  PGSDFT=SYMC('&PGSIZE');
  SELECT(MYCHARS);
    WHEN('LG10') DO;
      PRMODE=1;
      PDFDFT='04560';
      IF PGSDFT='0'
        THEN PGSDFT='39';
      END;
    WHEN('LOGO') DO;
      PRMODE=1;
      PDFDFT='090C0';
      IF PGSDFT='0'
        THEN PGSDFT='81';
      END;
    OTHERWISE;
    END; /* SELECT */
  IF PGSDFT='0'
    THEN PGSDFT='55';
  @SETL(&MYPGS=PGSDFT);

  IF MYCHARS ^=''
    THEN DO;
      MYCHARS=',CHARS='××MYCHARS;
      END;
  @SETL(&MYCHARS=MYCHARS);
  MYSYS=SYMC('&SYSOUT');
  IF SYMC('&FORM')^=''
    THEN DO;
      IF MYSYS='A'
        THEN MYSYS='G';
      MYSYS='('××MYSYS××',,'××SYMC('&FORM')××')';
      END;
  @SETL(&MYSYS=MYSYS);
  MYRFM = SYMC('&RECFM');
  IF MYRFM ^=''
    THEN MYRFM=',DCB=RECFM='××MYRFM;
  @SETL(&MYRFM=MYRFM);

  MYPDF = SYMC('&PAGEDEF');
  MYFDF = SYMC('&FDEF');
  IF MYPDF^='' × MYFDF^=''
    THEN PRMODE=1;
  IF PRMODE=1
    THEN DO; /* SET DEFAULTS, IF NECESSARY */
      IF MYPDF=''
        THEN MYPDF=PDFDFT;
      IF MYFDF=''
        THEN MYFDF=FDFDFT;
      END;
  IF MYPDF^=''
    THEN DO;
      MYPDF =',PAGEDEF='××MYPDF;
      PRMODE=1;
      END;
  @SETL(&MYPDF=MYPDF);

  IF MYFDF ^=''
    THEN DO;
      MYFDF=',FORMDEF='××MYFDF;
      PRMODE=1;
      END;
  @SETL(&MYFDF=MYFDF);

  IF PRMODE^=0
    THEN MYOUT=',OUTPUT=(*.OUT1)';
    ELSE MYOUT='';
  @SETL(&MYOUT=MYOUT);

  MYDSN=SETDSN@(DSN);
  MYFL=SYMC('&FLASH');
  IF MYFL=''
    THEN IF NOFLASH=0 & MYSYS='A'
      THEN MYFL='KV01';
  IF MYFL^=''
    THEN DO;
      MYFL=',FLASH='××MYFL;
      @SETL(&MYFL=MYFL);
      END;

  DCL (ERROR_CODE,INFO_CODE) FIXED BINARY(15);
  DCL DDNAME CHAR(8);
  DCL INTRDR FILE RECORD OUTPUT ENV(F RECSIZE(80));
  DCL JOBCARD FILE RECORD INPUT;
  DCL JCDSN CHAR(44) VAR;
  DCL JCDDN CHAR(8);
  %INCLUDE @9,@9SYSOUT,@9WRITER,@9DDNRET,@9CLOSE,@9ALLOC,@9DCLSVC,
    @9DSNAME,@9STATUS,@9DDNAME,@9FREE,@9MEMBER;
  JCDSN=SETDSN@(JOBCARDSUB);
  I = INDEX(JCDSN,'(');
  IF I ^= 0 THEN
     DO;
        @9MEMBER(  SUBSTR(JCDSN, I+1, INDEX(JCDSN,')')-I-1)  );
        JCDSN = SUBSTR(JCDSN,1,I-1);
     END;
  @9DSNAME(JCDSN);
  @9STATUS('SHR');
  @9DDNRET(JCDDN);
  @9ALLOC(ERROR_CODE,INFO_CODE);
  IF ERROR_CODE ^= 0
    THEN DO;
       PUT FILE(SYSPRINT) EDIT
           ('ERROR ALLOCATING JOBCARD DATA SET = ') (A)
           (ERROR_CODE)                                  (F(5));
       STOP;
       END;
  OPEN FILE(JOBCARD) TITLE(JCDDN);
  @9SYSOUT('*');
  @9WRITER('INTRDR');
  @9DDNRET(DDNAME);
  @9CLOSE;
  @9ALLOC(ERROR_CODE,INFO_CODE);
  IF ERROR_CODE ^= 0
    THEN DO;
       PUT FILE(SYSPRINT) EDIT
           ('ERROR ALLOCATING INTERNAL READER, CODE = ') (A)
           (ERROR_CODE)                                  (F(5));
       STOP;
       END;
  OPEN FILE(INTRDR) TITLE(DDNAME);
  ON ENDFILE(JOBCARD) GOTO JCEOJ;
  DO FOREVER=1 REPEAT FOREVER;
    READ FILE(JOBCARD) INTO(REC);
    WRITE FILE(INTRDR) FROM(REC);
    END;
 JCEOJ:
  CLOSE FILE(JOBCARD);
  @9DDNAME(JCDDN);
  @9FREE;
  DO UNTIL(INLEN = 0);
    @SETL(&MYDSN=MYDSN);
    DO I = J TO 6;
      @REP(REC=JCLA(I));
      WRITE FILE(INTRDR) FROM(REC);
      IF I=4 & PRMODE^=0
        THEN DO;
          @REP(REC=OUT1);
          WRITE FILE(INTRDR) FROM(REC);
          END;
      END;
    IF PROMPT ^= 0
      THEN DO;
        @PUTGET(' ENTER NEXT TO BE PRINTED ',INQUAL);
        INLEN = LENGTH(INQUAL);
        IF INLEN > 0
          THEN IF SUBSTR(INQUAL,1,1)^=''''
            THEN MYDSN=MYUSERID××'.'××INQUAL;
            ELSE MYDSN=SUBSTR(INQUAL,2,INLEN-2);
        END;
    J = 2;
    END;
  CLOSE FILE(INTRDR);
  @WRITE('PRINT JOB SUCCESSFULLY SUBMITTED');
  END;

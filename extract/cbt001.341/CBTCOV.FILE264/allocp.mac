*$.HE GENERALIZED SUBROUTINES - ALLOCP
*$.HE PLI INTERFACE TO SVC 32
*$.PL 55
*$.PN 0
*$.PA
*$.SS
*$.NF
*$6/19/74
*$AUTHOR:  T. SMITH
*$SOURCE MODULE NAME:  ALLOCP
*$DOCUMENTATION ID:  *$
*$.FI L
*$.SP 5
*$FOR USE IN MVT ONLY.
*$THIS SUBROUTINE PROVIDES THE PLI PROGRAMMER WITH AN INTERFACE TO
*$SVC 32.  USING THIS INTERFACE, HE CAN DYNAMICALLY ALLOCATE DIRECT
*$ACCESS DATA SETS FROM HIS PLI PROGRAM.
*$.SP 1
*$CALL ALLOCP(JFCBPTR,UCBPTR,RET),.
*$.SP 1
*$.CE 1
*$DEFINITION OF TERMS
*$.SP 1
*$JFCBPTR
*$.IN 5
*$POINTER VARIABLE CONTAINING ADDRESS OF JFCB.
*$.IN 0
*$UCBPTR
*$.IN 5
*$POINTER VARIABLE CONTAINING ADDRESS OF UCB DEFINING
*$DIRECT ACCESS DEVICE ON WHICH ALLOCATION IS TO BE MADE.
*$.IN 0
*$RET
*$.IN 5
*$FIXED BIN (31,0) - WILL BE SET TO THE RETURN CODE FROM SVC 32
*$AS FOLLOWS:
*$.IN 10
*$00 - SUCCESSFUL ALLOCATION
*$.IN 10
*$04 - DUPLICATE NAME DSCB EXISTS
*$.IN 10
*$08 - NO ROOM AVAILABLE IN THE VTOC
*$.IN 10
*$0C - PERMANENT I/O ERROR
*$.IN 10
*$10 - REQUESTED ABSOLUTE TRACK NO AVAILABLE
*$.IN 10
*$14 - REQUESTED QUANTITY NOT AVAILABLE
*$.IN 10
*$18 - AVERAGE RECORD LENGTH GREATER THAN 65,535 BYTES
*$.IN 10
*$30 - SPLIT REQUEST - NUMBER OF TRACKS IS GREATER THAT THE NUMBER
*$OF TRACKS/CYLINDER
*$.IN 10
*$30 - SUBALLOCATE REQUEST - DATA SET NOT ON THIS DEVICE OR DATA
*$SET HAS MORE THAN ONE EXTENT OR MAY NOT SUBALLOCATE FROM A SECURITY
*$PROTECTED DATA SET.
*$.IN 10
*$34 - INVALID REQUEST - MUST BE ABSTR/SUBALLOCATE REQUEST WHEN BOS
*$INDICATOR IN THE FORMAT 4 DSCB IS ON.
*$.IN 10
*$38 - DIRECTORY REQUEST - DIRECTORY QUANTITY REQUESTED IS GREATER
*$THAN PRIMARY QUANTITY OR THE SPACE REQUIRED FOR THE DIRECTORY
*$QUANTITY REQURESTED IS LARGER THAN THE LARGEST AREA CURRENTLY
*$AVAILABLE.
*$.IN 10
*$80 - INPUT PARAMETER LIST IS INCORRECT.
* WHEN SVC 32 IS ISSUED, REGISTER ZERO WILL CONTAIN THE CORE ADDRESS
* OF A JFCB WHICH WILL CONTAIN THE NECESSARY ALLOCATION DATA.
* REGISTER ONE WILL POINT TO A LIST OF UCB ADDRESSES THE FIRST OF
* WHICH WILL BE USED IN THIS ALLOCATION.
ALLOCP   CSECT
         TGSREQU
         USING *,RA
         STM   RE,RC,12(RD)
         LR    RA,RF
         LM    R2,R4,0(R1)
         L     R2,0(R2)
         L     R0,0(R2)                R0 = A(JFCB)
         LR    R1,R3
         SVC   32
         ST    R4,0(R4)
         LM    RE,RC,12(RD)
         BR    RE
         LTORG
         END

 /* COPYRIGHT 1983 BY THOMAS GLEN SMITH */
 /* ABE064D - PRINT GRAPHICS BITMAP TO CITOH PRINTER */
 ABE064D: PROC(RHPLOT79,RH_SEQ_2);
   DFT RANGE(*) FIXED BIN VALUE(FIXED BIN(31,0));
   DCL RHPLOT79 PTR;
   DCL 1 DDI01 BASED(RHPLOT79),
   %INCLUDE ABE063I;
   DCL RH_SEQ_2 FILE;

   DCL ABE064C ENTRY(FIXED BIN(31,0),FIXED BIN(31,0),PTR)
     RETURNS(CHAR(1));
   DCL TROUT ENTRY(CHAR(1)) RETURNS(CHAR(2));

   DCL CHARSTR CHAR(8);
   DCL BITSTR BIT(8),
       BITDEF CHAR(1) BASED(ADDR(BITSTR));
   DCL RPTLINE CHAR(254) VAR;
   DCL (H,I,J,K,L,M,N,P,R) FIXED BIN;
   DCL CH CHAR(1);
   DCL STRIPLEN FIXED BIN STATIC INIT(124);

   RPTLINE='1';
   WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
   RPTLINE=' ^PY^-';
   WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
   RPTLINE=' ^F^-';
   WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
   RPTLINE=' ^Q';
   DO J=MAXBTY TO 1 BY -1;
     /* NOW FIND RIGHTMOST NONBLANK */
     DO P=MAXBTX TO 7 BY -1 WHILE(ABE064C(P,J,RHPLOT79)=' ');
       END;
     DO H=0 REPEAT H+STRIPLEN*3 WHILE(H<P);
       DO I=1 TO STRIPLEN/2;
         L=H+(I-1)*6;
         IF P-L<1
           THEN LEAVE;
         CHARSTR='00000000';
         DO K=1 TO MIN(6,P-L);
           CH=ABE064C(L+K,J,RHPLOT79);
           IF ^(CH=' ' × CH='0')
             THEN CH='1';
             ELSE CH='0';
           SUBSTR(CHARSTR,2+K,1)=CH;
           END;
         SUBSTR(CHARSTR,1,2)='11';
         BITSTR=CHARSTR;
         RPTLINE=RPTLINE××TROUT(BITDEF);
         END;
       RPTLINE=RPTLINE××'^X';
       WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
       RPTLINE=' ^A';
       END;
     RPTLINE=RPTLINE××'^*';
     WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
     RPTLINE=' ^Q';
     END;
   RPTLINE=' ^PN^-';
   WRITE FILE(RH_SEQ_2) FROM(RPTLINE);
   END ABE064D;

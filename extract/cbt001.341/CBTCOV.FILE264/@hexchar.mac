 /* @HEXCHAR */
 %NOPRINT;
 /*
0*$.HE GENERALIZED SUBROUTINES - @HEXCHAR
0*$.HE PLI PREPROCESSOR TEXT
0*$.HE CONVERTS HEX CONSTANTS TO CHARACTER
0*$.PL 55
0*$.PN 0
0*$.PA
0*$.SS
0*$.NF
0*$01/16/80
0*$AUTHOR:  T. SMITH
0*$SOURCE MODULE NAME:  @HEXCHAR
0*$DOCUMENTATION ID:  0*$
0*$.FI L
0*$.SP 5
0*$PREPROCESSOR PROCEDURE @HEXCHAR CAN BE USED TO CONVERT HEXADECIMAL
0*$CONSTANTS TO CHARACTER STRINGS IN A PL/I SOURCE PROGRAM.
0*$FOR EXAMPLE:
0*$.SP 1
0*$.IN 5
0*$.NF
0*$TEST:  PROC;
0*$% INCLUDE @HEXCHAR;
0*$DCL A CHAR(2)
0*$ INIT(@HEXCHAR(CFAE));
0*$.FI L
0*$.IN 0
0*$.SP 1
0*$IN THE ABOVE EXAMPLE, THE VARIABLE "A" WOULD BE INITIALIZED TO
0*$HEXADECIMAL CFAE.  NOTE THAT THESE TWO BYTES WILL BE UNPRINTABLE.
 */
         % DCL @HEXCHAR ENTRY;
 % @HEXCHAR:  PROC(P1) RETURNS(CHAR);
         DCL (P1,HEXTAB,HEXKEY,RETSTR) CHAR;
         DCL (I,J,K,L,M) FIXED;
         /* IN HEXTAB, EACH BYTE CONTAINS HEX 00 TO FF */
         HEXTAB='
  ԃՆ.<(+&!$*);^-/َݏ|,%_>?ސ`:#@'
 '="abcdefghijklmnopqr~stuvwxyz[]{ABC
 DEFGHIʓ}JKLMNOPQRږ\STUVWXYZ0123456789';
         HEXKEY='0123456789ABCDEF';
         RETSTR='';
         I = LENGTH(P1);
         IF I^=(I/2)*2
           THEN P1='0'P1;
         I = LENGTH(P1);
         DO J=1 TO I-1 BY 2;
           K=INDEX(HEXKEY,SUBSTR(P1,J,1));
           L=INDEX(HEXKEY,SUBSTR(P1,J+1,1));
           M=(K-1)*16 + L;
           RETSTR=RETSTRSUBSTR(HEXTAB,M,1);
           IF M=126 /* IF APOSTROPHE, DOUBLE UP */
             THEN RETSTR=RETSTRSUBSTR(HEXTAB,M,1);
           END;
         RETURN(''''RETSTR'''');
         %END @HEXCHAR;
 %PRINT;

++PTF(HG00201)
  /* MODIFICATION TO RMF WORKLOAD INTERVAL REPORTING
     TO COPY WAMT TO STATDIE PAGABLE WAMT BUFFER IF
     STATDIE IS ACTIVE.
     THIS CODE ZAPS THE ASSEMBLER LANGUAGE PROLOGUE
     TO THE THIRD ENTRY POINT IN ERBMFDWP. IT USES
     THE LINK PACK AREA SEARCH ROUTINE TO LOCATE
     'STATWAMT' WHICH IS A POINTER TO THE ONE PAGE
     BUFFER OBTAINED BY STATDIE TO HOLD THE LAST
     WAMT FOR DISPLAY BY THE 'WORKLOAD' TSO COMMAND
     OR TRACING BY OURMF. */ .
++VER(Z037) PRE(UZ80700 UZ86101).
++ZAP(ERBMFDWP).
 NAME ERBMFDWP
 EXPAND ERBMFDWP(90)
*                            ORG   ZAPPED
VER 0274 982C,101C           LM    2,12,28(1)
*                   ZAPPED2  EQU   *
VER 0278 50D0,1004           ST    13,4(,1)
*                            ORG   PATCH
VER 09F0 0000,0000,0000,0000 DC    XL32'00'
VER 09F8 0000,0000,0000,0000
VER 0A00 0000,0000,0000,0000
VER 0A08 0000,0000,0000,0000
*                            ORG   ZAPPED2
REP 0278 47F0,C9CC           B     PATCH
*                   RET      EQU   *
*                            ORG   PATCH
* THERE HAS TO BE SOMETHING EXCEPTIONAL ABOUT A GOOD ZAP
* THE NICE THINGS ABOUNT THIS ONE ARE:
*  1) WE HAVE TWO SAVE AREAS, ONE POINTED TO BY R13 THAT
*     HAS BEEN JUST STORED INTO, AND ONE POINTED TO BY
*     R1 WHICH R2-12 ARE BEING RESTORED FROM.  SO THERE
*     ARE LOTS OF REGISTERS TO USE.
*  2) IT IS JUST AFTER AN INTERNAL ENTRY POINT IN THE
*     MODULE AND WILL BE EASY TO RELOCATE AFTER MAINTENANCE
*  3) THIS ZAP HITS ONLY GENNED ASSEMBLER STATEMENTS, AN
*     ISLAND OF SANITY IN A SEA OF PLS.
REP 09F0 18A1                LR    10,1               SAVE FOR LATER
REP 09F2 9801,CA10           LM    0,1,NAME           PARM TO LPA SRCH
REP 09F6 5830,0010           L     3,CVTPTR
REP 09FA 58F3,0160           L     15,CVTLPDSR-CVT(3) ADDR OF LPASRCH
REP 09FE 05EF                BALR  14,15              CALL IEAVVMSR
REP 0A00 47F0,C9E4           B     FOUND              NAME FOUND
REP 0A04 47F0,CA02           B     RTNR               NAME NOT FOUND
*                   FOUND    EQU   *
REP 0A08 1810                LR    1,0                GET LPDE ADDR
REP 0A0A 5811,0010           L     1,LPDENTP-LPDE(1) GET ENTRY POINT
REP 0A0E 5801,0000           L     0,0(1)             GET STATWAMT VALUE
REP 0A12 1200                LTR   0,0                IS STATDIE UP?
REP 0A14 4780,CA02           BZ    RTNR               NO, QUIT
REP 0A18 4110,0FFF           LA    1,4095             STATDIE GETS 4K BU
REP 0A1C 582B,00B8           L     2,WAMTPTR(11)      GET LOCAL WAMT ADD
*                                 FROM GETMAIN DATA AREA
REP 0A20 5832,0004           L     3,4(2)             GET ITS SIZE
REP 0A24 0E02                MVCL  0,2                COPY WAMT
*                   RTNR     EQU   *
REP 0A26 181A                LR    1,10               RESTORE
REP 0A28 982C,101C           LM    2,12,28(1)         RELOAD REGS
REP 0A2C 50D0,1004           ST    13,4(,1)
REP 0A30 47F0,C258           B     RET                GO BACK
*                   NAME     EQU   *
REP 0A34 E2E3,C1E3,E6C1,D4E3 DC    CL8'STATWAMT'
* DECK PRODUCED BY THE ASMTOZAP UTILITY 78/01/12 103610

*************
************* W E E K L Y    B A S E   C H A N G E S ******************
*            ****************************************                 *
* 050<DAY<084             PRIOR (5) WEEKS. MONDAY-FRIDAY..(JULIAN)..  *
* 078<DAY<084             PRIOR WEEK..MONDAY-FRIDAY.......(JULIAN)..  *
* WEEK OF 3/20           PRIOR WEEK..MONDAYS CALENDER DATE.........  *
* 051 TO 083        PRIOR (5) WEEKS. MONDAY-FRIDAY..(JULIAN)..  *
* 051 058 065 072 079 083 PRIOR (5) WEEKS. MONDAYS JULIAN DATES       *
*                         AND JULIAN DATE FOR PRIOR FRIDAY..........
* 02/20(DAY 51)          PRIOR (5TH) MONDAYS CALENDER AND JULIAN DATE*
* 03/24(DAY 83)          PRIOR WEEKS FRIDAYS CALENDER AND JULIAN DATE*
*                                                                     *
*                                                                     *
*                                                                     *
**********************************************************************;
*****************  RMF SYSTEM ANALYSIS REPORTING   ********************;
DATA HIST_PG ;
         KEEP PAGERATE COMRATE SWAPRATE PGFAULT DEMAND  HR CPU_ID
              SHIFT DATE  DAY    ;
SET BASE1.PAGING BASE2.PAGING BASE3.PAGING BASE4.PAGING BASE5.PAGING;
         IF DATE= . THEN DELETE;
         IF PAGEINS  < 0 THEN DELETE ;
    DAY=MOD(DATE,1000);K=MOD(DAY,7);
         IF K=0 OR K=1  THEN DELETE ;
         IF 050<DAY<084 ;
    HOUR   =     ( TIME / 10000 )     ;
    HR     = INT ( TIME / 10000 ) ;
    SHIFT  = INT ( HR / 8 ) ;
         IF SHIFT = 0  THEN SHIFT = 3 ;

*********************** PAGING  MEANS  ********************************;
DATA PAGE_A1 PAGE_B1 ;
         KEEP PAGERATE COMRATE SWAPRATE PGFAULT DEMAND  HR CPU_ID
              SHIFT DATE  DAY    ;
SET  HIST_PG ;
         IF 078<DAY<084 ;
         IF SHIFT^=1 THEN DELETE ;
         IF CPU_ID='A' THEN OUTPUT PAGE_A1 ;
         IF CPU_ID='B' THEN OUTPUT PAGE_B1 ;
RETURN ;

************************* 24 HR WEEKLY TREND  *************************;
DATA ALL_PAGE  ;
         KEEP HR CPU_ID PAGERATE COMRATE SWAPRATE PGFAULT DEMAND;
SET HIST_PG;
         IF 078<DAY<084 ;
RETURN ;

***********************  PAGING HISTORY *******************************;
DATA PAGING ;
         KEEP DAY HR CPU_ID PAGERATE;
SET  HIST_PG  ;
         IF SHIFT ^= 1 THEN DELETE;
         IF CPU_ID='A' THEN OUTPUT PAGING;
         IF CPU_ID='B' THEN OUTPUT PAGING;
RETURN;

*************************** CHANNEL HISTORY  **************************;
DATA CH_A1 CH_A2 CH_A3 ;
         KEEP CHN_ID DATE CHN_BUSY CPU_ID CHN_SIO SHIFT;
SET BASE5.CHANNELS ;
         IF DATE= . THEN DELETE;
         IF CHN_BUSY < 0 THEN DELETE ;
         IF CHN_BUSY > 1. THEN DELETE;
    DAY=MOD(DATE,1000);K=MOD(DAY,7);
         IF K=0 OR K=1 THEN DELETE;
    HOUR  = ( TIME / 10000 )  ;
    HR    = INT ( TIME / 10000 ) ;
    SHIFT = INT ( HR / 8 ) ;
         IF SHIFT = 0  THEN SHIFT = 3   ;
         IF CPU_ID = 'A' AND SHIFT = 1 THEN OUTPUT CH_A1;
         IF CPU_ID = 'C' AND SHIFT = 1 THEN OUTPUT CH_A1;
         IF CPU_ID = 'B' AND SHIFT = 1 THEN OUTPUT CH_A1;
         IF CPU_ID = 'A' AND SHIFT = 2 THEN OUTPUT CH_A2;
         IF CPU_ID = 'C' AND SHIFT = 2 THEN OUTPUT CH_A2;
         IF CPU_ID = 'B' AND SHIFT = 2 THEN OUTPUT CH_A2;
         IF CPU_ID = 'A' AND SHIFT = 3 THEN OUTPUT CH_A3;
         IF CPU_ID = 'C' AND SHIFT = 3 THEN OUTPUT CH_A3;
         IF CPU_ID = 'B' AND SHIFT = 3 THEN OUTPUT CH_A3 ;
RETURN ;

************************  CPU  HISTORY ********************************;
DATA HIST_CPU CPU_FST SHFT_OFF;
         KEEP CPU_ID DAY CPU_BUSY SHIFT HR BTH_ASID STC_ASID
              TSO_ASID TOT_ASID DATE     ;
SET BASE1.CPU  BASE2.CPU  BASE3.CPU  BASE4.CPU  BASE5.CPU ;
         IF DATE= . THEN DELETE;
         IF CPU_BUSY < 0 THEN DELETE ;
         IF CPU_BUSY > 1. THEN DELETE;
    DAY=MOD(DATE,1000);K=MOD(DAY,7);
         IF K=0 OR K=1 THEN DELETE;
         IF 050<DAY<084 ;
    TOT_ASID=BTH_ASID + STC_ASID + TSO_ASID;
    HR   = INT ( TIME / 10000 )  ;
    HOUR = ( TIME / 10000 )  ;
    SHIFT = INT ( HR / 8 ) ;
         IF SHIFT = 0  THEN SHIFT = 3 ;
         IF SHIFT = 1 THEN OUTPUT CPU_FST;
         IF SHIFT ^= 1 THEN OUTPUT SHFT_OFF;
         IF SHIFT <=3 THEN OUTPUT HIST_CPU ;
RETURN;

***************** SORT 1ST SHIFT CPU TREND DATA   *********************;
PROC SORT DATA= CPU_FST  ; BY DAY CPU_ID;
PROC MEANS DATA =CPU_FST  MEAN NOPRINT ; BY DAY CPU_ID ;VAR CPU_BUSY ;
LABEL DAY=FIRST SHIFT CPU TREND PRIOR 5 WEEKS CPU_DAY=% CPU UTILIZATION;
OUTPUT OUT= NEW_DAY MEAN=CPU_DAY;

******************SORT 2ND AND 3RD SHIFT CPU TREND DATA ***************;
PROC SORT DATA= SHFT_OFF ; BY DAY CPU_ID;
PROC MEANS DATA =SHFT_OFF MEAN NOPRINT ; BY DAY CPU_ID ;VAR CPU_BUSY ;
LABEL DAY=OFF_SHIFT SUMMED CPU TREND PRIOR 5 WEEKS  CPU_DAY=% CPU BUSY;
OUTPUT OUT= NEW_OFF MEAN=CPU_DAY;

******************SORT 1ST SHIFT COMPLEX TREND DATA *******************;
PROC SORT DATA= CPU_FST  ; BY DAY ;
PROC MEANS DATA =CPU_FST  MEAN         ;   BY DAY  ;    VAR CPU_BUSY ;
LABEL DAY=1ST SHIFT COMPLEX TREND PRIOR 5 WKS AVE_1ST=% COMPLEX BUSY  ;
OUTPUT OUT= TOT_DAY MEAN=AVE_1ST; **** CPU_FST REPLACED BY AVE_1ST ** ;
                                      ********* NOTE *********        ;
************* SORT 2ND AND 3RD SHIFT COMPLEX TREND DATA ***************;
PROC SORT DATA= SHFT_OFF ; BY DAY CPU_ID;
PROC MEANS DATA =SHFT_OFF MEAN NOPRINT ;   BY DAY  ;    VAR CPU_BUSY ;
LABEL DAY=2ND_3RD SUMMED COMPLEX TREND PRIOR 5 WKS  AVEOFF=% ALL  BUSY;
OUTPUT OUT= TOT_OFF MEAN=AVEOFF;

****************** RMF WEEKLY STATISTICAL REPORTING *******************;
DATA CPU_WEEK;
         KEEP CPU_ID DAY CPU_BUSY HR SHIFT  ;
SET HIST_CPU;
         IF 078<DAY<084 ;
RETURN ;

***********  SORT  HOURLY CPU PROFILE FOR CURRENT WEEK  ***************;
PROC SORT DATA = CPU_WEEK ; BY HR CPU_ID ;
PROC MEANS DATA= CPU_WEEK MEAN NOPRINT ; BY HR CPU_ID ; VAR CPU_BUSY ;
LABEL HR=HOURLY CPU PROFILE WEEK OF 3/20  CPU=PERCENT CPU  UTILIZATION;
OUTPUT OUT=CPU_HR MEAN=CPU ;TITLE HOURLY CPU PROFILE FOR WEEK OF 3/20;

***********  SORT AND PRODUCE CURRENT WEEKLY CPU BUSY REPORTS  ********;
PROC SORT DATA = CPU_WEEK ; BY SHIFT CPU_ID ;
PROC MEANS DATA= CPU_WEEK N MEAN MAX ; BY SHIFT CPU_ID ; VAR CPU_BUSY ;
TITLE CPU WEEKLY UTILIZATION (BUSY) PROFILE BY SHIFT FOR WEEK OF 3/20;

***********  SORT CURRENT WEEKLY CPU% COMPLEX UTILIZATION  ************;
PROC SORT DATA = CPU_WEEK ; BY HR        ;
PROC MEANS DATA= CPU_WEEK MEAN NOPRINT ; BY HR  ; VAR CPU_BUSY ;
LABEL HR=HOURLY COMLEX PROFILE WEEK 03/06  TOTAVE=% COMPLEX UTILIZATION;
OUTPUT OUT=TOT_HR MEAN=TOTAVE  ;TITLE HOURLY COMPLEX FOR WEEK OF 3/20;

*******************  SORT CPU BUSY BY CURRENT SHIFT  ******************;
PROC SORT DATA = CPU_WEEK ; BY SHIFT        ;
PROC MEANS DATA= CPU_WEEK N MEAN MAX ; BY SHIFT        ; VAR CPU_BUSY ;
TITLE CPU WEEKLY UTILIZATION (BUSY) PROFILE BY SHIFT FOR WEEK OF 3/20;

************************************************************************
************* CREATE ASID DATA, SORT & GET MEANS   *********************
***********************************************************************;

DATA NEW_ASID;
         KEEP CPU_ID DAY TOT_ASID HR SHIFT;
SET HIST_CPU;
IF CPU_ID='A' THEN OUTPUT NEW_ASID  ;
IF CPU_ID='B' THEN OUTPUT NEW_ASID  ;
RETURN ;

DATA ASID_FST;
         KEEP CPU_ID DAY TOT_ASID HR SHIFT ;
SET NEW_ASID ;
         IF SHIFT^=1 THEN DELETE           ;
RETURN ;
PROC SORT DATA = ASID_FST;   BY DAY CPU_ID ;
PROC MEANS DATA=ASID_FST MEAN NOPRINT ;  BY DAY CPU_ID ;  VAR TOT_ASID ;
LABEL DAY=1ST SHIFT ASID TREND PRIOR 5 WEEKS  ASID_DAY=AVE ASIDS BY CPU;
OUTPUT OUT= ASID_78 MEAN=ASID_DAY ;

DATA ASID_WK ;
         KEEP CPU_ID DAY TOT_ASID HR SHIFT ;
SET NEW_ASID ;
         IF 078<DAY<084  ;
RETURN ;

PROC SORT DATA = ASID_WK  ; BY HR CPU_ID ;
PROC MEANS DATA= ASID_WK  MEAN NOPRINT ; BY HR CPU_ID ; VAR TOT_ASID ;
OUTPUT OUT=ASIDHR MEAN=AVE ;TITLE HOURLY ASID PROFILE    WEEK OF 3/20;

PROC MEANS DATA= ASIDHR SUM   NOPRINT; BY HR    CPU_ID ; VAR AVE      ;
LABEL AVE=AVE ASIDS BY CPU HR=HOURLY ASID PROFILE WEEK OF 3/20;
OUTPUT OUT=ASID_HR MEAN=AVE ;TITLE HOURLY ASID PROFILE   WEEK OF 3/20;

************************************************************************
*********    WEEKLY ASID PROFILE BY SHIFT FOR CURRENT WEEK  ************
*******                                                       **********
***** SORT CHANNEL DATA ,DERIVE MEANS , AND OUTPUT FOR PLOTTING ********
***********************************************************************;

PROC SORT  DATA = CH_A1 ; BY  CPU_ID     CHN_ID ;
PROC SORT  DATA = CH_A2 ; BY  CPU_ID     CHN_ID ;
PROC SORT  DATA = CH_A3 ; BY  CPU_ID     CHN_ID ;

************************************************************************
********************  CHANNEL  UTILIZATION  MEANS  *********************
***********************************************************************;

PROC MEANS DATA =CH_A1 MEAN NOPRINT  ;BY CPU_ID CHN_ID ;VAR CHN_BUSY  ;
LABEL AVE=% CHAN BUSY CHN_ID=% BUSY BY CHAN & CPU ID  WEEK OF 3/20 ;
OUTPUT OUT=A1_CH MEAN=AVE           ;TITLE CHN MP  BUSY WEEK OF 3/20;

PROC MEANS DATA =CH_A2 MEAN NOPRINT  ;BY CPU_ID CHN_ID ;VAR CHN_BUSY  ;
LABEL AVE=% CHAN BUSY CHN_ID=% BUSY BY CHAN & CPU ID  WEEK OF 3/20 ;
OUTPUT OUT=A2_CH MEAN=AVE             ;TITLE CHN MP  BUSY WEEK OF 3/20;

PROC MEANS DATA =CH_A3 MEAN NOPRINT  ;BY CPU_ID CHN_ID ;VAR CHN_BUSY  ;
LABEL AVE=% CHAN BUSY CHN_ID=% BUSY BY CHAN & CPU ID  WEEK OF 3/20 ;
OUTPUT OUT=A3_CH MEAN=AVE            ;TITLE CHN  MP BUSY WEEK OF 3/20;

************************************************************************
*********************    CHANNEL SIOS MEANS    *************************
***********************************************************************;

PROC MEANS DATA = CH_A1 MEAN NOPRINT ;BY CPU_ID CHN_ID ; VAR CHN_SIO  ;
 LABEL AVE=AVE SIOS/SEC  CHN_ID=AVE SIO/SEC BY CHAN & CPU WEEK OF 3/20;
OUTPUT OUT=A1_SIO MEAN=AVE           ;TITLE CHN MP  SIOS WEEK OF 3/20;

PROC MEANS DATA = CH_A2 MEAN NOPRINT ;BY CPU_ID CHN_ID ; VAR CHN_SIO  ;
 LABEL AVE=AVE SIOS/SEC  CHN_ID=AVE SIO/SEC BY CHAN & CPU WEEK OF 3/20;
OUTPUT OUT=A2_SIO MEAN=AVE           ;TITLE CHN MP  SIOS WEEK OF 3/20;

PROC MEANS DATA = CH_A3 MEAN NOPRINT ;BY CPU_ID CHN_ID ; VAR CHN_SIO  ;
 LABEL AVE=AVE SIOS/SEC  CHN_ID=AVE SIO/SEC BY CHAN & CPU WEEK OF 3/20;
OUTPUT OUT=A3_SIO MEAN=AVE           ;TITLE CHN MP  SIOS WEEK OF 3/20;

************************************************************************
*****************  SORT PAGING AND DERIVE MEANS  ***********************
***********************************************************************;

PROC SORT DATA=PAGING     ; BY DAY CPU_ID ;
PROC MEANS DATA=PAGING  MEAN NOPRINT; BY DAY CPU_ID ;  VAR  PAGERATE ;
LABEL DAY=AVE 1ST SHIFT PAGING TREND PRIOR 5 WKS  PAGE=PAGES PER SECOND;
OUTPUT OUT=PG_DAYS MEAN=PAGE  ;

PROC SORT DATA=ALL_PAGE   ; BY HR CPU_ID ;
PROC MEANS DATA=ALL_PAGE MEAN NOPRINT ; BY HR CPU_ID ; VAR  PAGERATE ;
LABEL HR=HOURLY PAGING PROFILE WEEK OF 3/20  PAGE=PAGES PER SECOND ;
OUTPUT OUT=PAGE_HR MEAN=PAGE ;

************************************************************************
***********  HOURLY  PAGING  RATE  BY  SYSTEM  WEEK OF 3/20  **********
***********************************************************************;

PROC MEANS DATA = PAGE_A1 N MEAN MAX        ;
VAR COMRATE SWAPRATE PGFAULT DEMAND PAGERATE      ;
TITLE PAGING RATES 1ST SHIFT FOR   168 MP FOR WEEK OF 3/20;

PROC MEANS DATA = PAGE_B1 N MEAN MAX         ;
VAR COMRATE SWAPRATE PGFAULT DEMAND PAGERATE      ;
TITLE PAGING RATES 1ST SHIFT FOR   168 UP FOR WEEK OF 3/20;

************************************************************************
**********   PLOT   PRIOR  WEEK    24   HOUR   TREND  AVE   ************
***********************************************************************;

PROC PLOT DATA = TOT_HR   ;
PLOT TOTAVE*HR='*' / OVERLAY VAXIS=0.0 TO 1.0 BY .1   HREF= 8 17
HAXIS= 0 TO 24 BY 1    VREF=.35 .65 .95 ;
TITLE AVE COMPLEX (BUSY)PROFILE REGRESSED - 24 HR PERIOD WEEK OF 3/20;

PROC PLOT DATA = CPU_HR   ;
PLOT CPU*HR=CPU_ID / OVERLAY VAXIS=0.0 TO 1.0 BY .1   HREF= 8 17
HAXIS= 0 TO 24 BY 1    VREF=.35 .65 .95 ;
TITLE AVE CPU (BUSY)PROFILE REGRESSED FOR 24 HR PERIOD   WEEK OF 3/20 ;

PROC PLOT DATA =PAGE_HR   ;
PLOT PAGE*HR=CPU_ID / OVERLAY VAXIS=0 TO 140 BY 10  HREF= 8 17
HAXIS= 0 TO 24 BY 1    VREF= 30 60 90 ;
TITLE AVE SYSTEM PAGING PROFILE REGRESSED  24 HR PERIOD   WEEK OF 3/20;

PROC PLOT DATA = ASID_HR  ;
PLOT AVE*HR=CPU_ID/OVERLAY VAXIS=0 TO 80 BY 5 HREF=8 17 VREF=40 55 70
HAXIS= 0 TO 24 BY 1  ;
TITLE AVE MP & UP ASID PROFILE REGRESSED FOR 24 HR PERIOD WEEK OF 3/20;

************************************************************************
****    PLOT    LAST   FIVE    WEEKS    TRENDING    STATISTICS      ****
***********************************************************************;

PROC PLOT DATA= TOT_DAY ;
PLOT AVE_1ST*DAY='*' / OVERLAY VAXIS=0.0 TO 1.0 BY .1
HAXIS =  051 TO 083 BY 1
VREF  =  .35 .65 .95
HREF  =  051 058 065 072 079 083 ;
TITLE AVE 1ST SHIFT COMPLEX TREND  PERIOD 02/20(DAY 51)-03/24(DAY 83);

PROC PLOT DATA= NEW_DAY    ;
PLOT  CPU_DAY * DAY=CPU_ID  / OVERLAY VAXIS=0.0 TO 1.0 BY .1
HAXIS =  051 TO 083 BY 1
VREF  =  .35 .65 .95
HREF  =  051 058 065 072 079 083 ;
TITLE AVE 1ST SHIFT TREND ANALYSIS PERIOD 02/20(DAY 51)-03/24(DAY 83);

PROC PLOT DATA= PG_DAYS ;
PLOT PAGE *DAY=CPU_ID / OVERLAY VAXIS=0 TO 140 BY 10
HAXIS =  051 TO 083 BY 1
VREF  =  30 60 90
HREF  =  051 058 065 072 079 083 ;
TITLE AVE 1ST SHIFT PAGING TREND ANALYSIS 02/20(DAY 51)-03/24(DAY 83);

PROC PLOT DATA = ASID_78  ;
PLOT ASID_DAY*DAY=CPU_ID/OVERLAY VAXIS=0 TO 80 BY 5
HAXIS =  051 TO 083 BY 1
VREF  =  40  55  70
HREF  =  051 058 065 072 079 083 ;
TITLE AVE 1ST SHIFT ASID  TREND ANALYSIS  02/20(DAY 51)-03/24(DAY 83);

PROC PLOT DATA= NEW_OFF;
PLOT CPU_DAY*DAY=CPU_ID / OVERLAY VAXIS=0.0 TO 1.0 BY .1
HAXIS =  051 TO 083 BY 1
VREF  =  .35 .65 .95
HREF  =  051 058 065 072 079 083 ;
TITLE 2ND_3RD SHIFT TREND ANALYSIS PERIOD 02/20(DAY 51)-03/24(DAY 83);

PROC PLOT DATA= TOT_OFF;
PLOT AVEOFF*DAY='*' / OVERLAY VAXIS=0.0 TO 1.0 BY .1
HAXIS =  051 TO 083 BY 1
VREF  =  .35 .65 .95
HREF  =  051 058 065 072 079 083 ;
TITLE 2ND_3RD SHIFT COMPLEX TREND  PERIOD 02/20(DAY 51)-03/24(DAY 83);

************************************************************************
*******************   PLOT CHANNEL ACTIVITY    *************************
***********************************************************************;

PROC PLOT DATA = A1_CH ;
PLOT AVE*CHN_ID=CPU_ID / OVERLAY VAXIS=0.0 TO 1.0 BY .1 VREF=.35 ;
TITLE AVERAGE CHAN (BUSY)PROFILE FOR COMPLEX  FIRST SHIFT WEEK OF 3/20;

PROC PLOT DATA = A2_CH ;
PLOT AVE*CHN_ID=CPU_ID / OVERLAY VAXIS=0.0 TO 1.0 BY .1 VREF=.35 ;
TITLE AVERAGE CHAN (BUSY)PROFILE FOR COMPLEX SECOND SHIFT WEEK OF 3/20;

PROC PLOT DATA = A3_CH ;
PLOT AVE*CHN_ID=CPU_ID / OVERLAY VAXIS=0.0 TO 1.0 BY .1 VREF=.35 ;
TITLE AVERAGE CHAN (BUSY)PROFILE FOR COMPLEX  THIRD SHIFT WEEK OF 3/20;

PROC PLOT DATA = A1_SIO;
PLOT AVE*CHN_ID= CPU_ID   /OVERLAY VAXIS=0 TO 40 BY 4 VREF=24 ;
TITLE AVERAGE CHAN SIO  PROFILE  FOR COMPLEX  FIRST SHIFT WEEK OF 3/20;

PROC PLOT DATA = A2_SIO;
PLOT AVE*CHN_ID= CPU_ID   /OVERLAY VAXIS=0 TO 40 BY 4 VREF=24 ;
TITLE AVERAGE CHAN SIO PROFILE FOR COMPLEX   SECOND SHIFT WEEK OF 3/20;

PROC PLOT DATA = A3_SIO;
PLOT AVE*CHN_ID= CPU_ID   /OVERLAY VAXIS=0 TO 40 BY 4 VREF=24 ;
TITLE AVERAGE CHAN SIO PROFILE FOR COMPLEX   THIRD SHIFT WEEK OF 3/20;


* SAS76 CODE. THIS SERIES OF MACROS DOES THE SORTING AND CALCULATIONS
* NECESSARY TO CALCULATE PERCENTILE VALUES, CURRENTLY THE 90TH PERCENT.
*
*  FIVE MACROS MUST BE DEFINED BEFORE INVOKING _PERTILE
*  THEY ARE:
*
* _BYLIST - THE VARIABLES IN THE BYLIST FOR THE PERCENTILE CALCULATION
*
* _LASTVAR - THE LAST VARIABLE IN THE BYLIST
*
* _CALCVAR - THE VARIABLE WHOSE PERCENTILE DISTRIBUTION IS CALCULATED
*
* _NRVAR   - THE VARIABLE WHICH WILL CONTAIN THE COUNT OF EACH GROUP
*            OF VALUES
* _INDATA  - THE SAS DATA SET TAKEN AS INPUT
*
* _OUTDATA - THE OUTPUT SAS DATA SET CONTAINING THE RESULTING DATA SET,
*          - WHICH WILL CONTAIN ONLY THE VARIABLES IN THE BYLIST,
*          - _CALCVAR (CONTAINING THE PERCENTILE VALUE FOR THAT GROUP
*          - OF BY VALUES) AND _NRVAR (CONTAINING THE NUMBER OF OBS
*          - IN THAT GROUP).
*
*  THE PERCENTILE VALUE CALCULATED IS SET BY THE VALUE 9 IN
*   THE EQUATION NINETY=FLOOR(.9*_NRVAR), WHICH MAY BE CHANGED TO ANY
*   PERCENTILE VALUE
*    ;
MACRO _PERTILE
PROC SORT DATA= _INDATA OUT= _OUTDATA (KEEP= _BYLIST _CALCVAR);
BY _BYLIST _CALCVAR ;
PROC MEANS NOPRINT DATA= _OUTDATA;
BY _BYLIST ;
VARIABLES _CALCVAR ;
OUTPUT OUT=COUNT N=XXNRXX NMISS=MISSJOBS;
DATA _OUTDATA;
UPDATE  COUNT (BY=INSETC) _OUTDATA (BY=INSETQ);
BY _BYLIST;
DROP NQUE NINETY HIT MISSJOBS XXNRXX;
IF FIRST._LASTVAR THEN LINK BEGIN;
NQUE+1; IF NQUE>=NINETY AND HIT=. THEN GO TO OUT; RETURN;
BEGIN: _NRVAR=SUM(XXNRXX,MISSJOBS);NQUE=0;HIT=.;
NINETY=FLOOR(.9*_NRVAR); RETURN;
OUT:OUTPUT;HIT=1;RETURN;RETAIN HIT NINETY _NRVAR;
RUN;
%
* EXAMPLE - TO CALCULATE 90% ASPQUEUE TIME BY SETUP TYPE PRTY INITSHFT
* FROM INPUT DATA SET ASPOS AND STORE IN FORNICK ;
DATA EXAMPLE; INPUT SETUP $ TYPE $ PRTY INITSHFT $ ASPQUEUE; CARDS;
YES PROD 3 1ST 8.2
YES PROD 3 1ST 18.9
YES PROD 3 1ST 12.1
YES PROD 3 1ST 8.0
YES PROD 3 1ST 2.4
YES PROD 3 2ND 1.2
YES PROD 3 2ND 2.7
YES PROD 3 2ND .6
YES TEST 5 1ST .2
YES TEST 5 1ST .9
RUN;
MACRO _INDATA ASPOS % MACRO _CALCVAR ASPQUEUE %
MACRO _OUTDATA FORNICK %
MACRO _BYLIST SETUP TYPE PRTY INITSHFT %
MACRO _LASTVAR INITSHFT % MACRO _NRVAR NRJOBS %
_PERTILE
RUN;
MACRO _INDATA USED.ASPOS % MACRO _CALCVAR ASPQUEUE %
MACRO _OUTDATA FORNIC  %
MACRO _BYLIST SETUP TYPE PRTY          %
MACRO _LASTVAR PRTY     % MACRO _NRVAR NRJOBS %
_PERTILE
RUN;
PROC SORT DATA=FORNICK;
BY SETUP TYPE DESCENDING PRTY INITSHFT;
PROC PRINT; BY SETUP; ID TYPE; VARIABLES PRTY INITSHFT ASPQUEUE;
TITLE 90% ASPQUEUE TIME BY PRIORITY AND INITIATED SHIFT;
TITLE2 DATA FOR WEEK OF JAN 1 - JAN 7 1978;
PROC SORT DATA=FORNIC;
BY SETUP TYPE DESCENDING PRTY;
PROC PRINT; BY SETUP; ID TYPE; VARIABLES PRTY ASPQUEUE;
TITLE 90% ASPQUEUE TIME BY PRIORITY;
TITLE2 DATA FOR WEEK OF JAN 1 - JAN 7 1978;

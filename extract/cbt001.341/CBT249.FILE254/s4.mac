DATA FOUR(KEEP= HOUR CLASS DATE CPU)
     ABENDS(KEEP=   ABEND  CODE   STRT_TIM END_TIME  UP_TIME
                 JOBNAME                 )       ;
INFILE SMF  END = TT        ;
INPUT @2 REC_TYPE PIB1. @;
IF REC_TYPE NE 4 THEN GO TO NOTFOUR   ;
INPUT  @15 JOBNAME $CHAR8.  @15 JOBPREFX $CHAR4. @  ;
IF JOBPREFX = 'IMSP' OR JOBPREFX = 'TCAM' OR JOBNAME  = 'ATS3350'
     THEN GO TO ONLINE       ;
IF JOBNAME = 'LCKINTAA' OR JOBNAME = 'BTSINTAA'
     OR JOBNAME = 'CGSINTAA' OR JOBNAME = 'SBSINTAA'
     THEN GO TO ONLINE       ;
IF JOBNAME NE 'CODSWYLB' THEN DELETE ;
ONLINE:
INPUT  @3 END_TIME SMFSTAMP8. @40 STRT_TIM SMFSTAMP8.
         @52   CODE  PIB2.                         @84 FLAGS PIB1.  ;
UP_TIME = END_TIME - STRT_TIM                ;
*    CALCULATE THE ABEND  OR    COMPLETION CODES  ;
AB = MOD ( FLAGS, 4 )  ; *  ABEND AND STEP FLUSH FLAGS ;
ABEND = '        ' ;
IF AB = 2 AND CODE GE 32768 THEN ABEND = 'USER    '    ;
IF AB = 2 AND CODE LT 16384 THEN ABEND = 'SYSTEM  '    ;
IF AB = 2 AND ABEND = '        ' THEN ABEND = 'OTHER   '       ;
IF AB = 1 THEN ABEND = 'FLUSH   '                      ;
IF AB NE 2 AND CODE GE 16384 THEN CODE = CODE - 16384  ;
IF ABEND = 'USER    ' THEN CODE = CODE - 32768         ;
IF ABEND = '        ' AND CODE NE 0 THEN ABEND = 'RETURN  '    ;
IF ABEND NE 'USER    ' THEN GO TO PUTOUT               ;
   *    CONVERT DECIMAL CODE INTO HEX FOR PRINTING     ;
   DGT1 = FLOOR ( CODE / 1000 ) ; CODE = CODE - 1000 * DGT1 ;
   DGT2 = FLOOR ( CODE / 100  ) ; CODE = CODE - 100  * DGT2 ;
   DGT3 = FLOOR ( CODE / 10   ) ; DGT4 = CODE - 10   * DGT3 ;
   CODE = DGT4 + 16 * DGT3 + 256 * DGT2 + 4096 * DGT1       ;
PUTOUT:  OUTPUT ABENDS; RETURN ;
FORMAT CODE    HEX4.  UP_TIME  TIME.  ABEND   $CHAR8.     ;
FORMAT END_TIME DATETIME20. STRT_TIM DATETIME20.  ;
NOTFOUR:
IF REC_TYPE NE 0 THEN GO TO NOTIPL   ;
FILE PRINT ;
INPUT @3 IPL_TIME SMFSTAMP8. SYS_ID $1. ;
IPL_DATE = INT ( IPL_TIME / (24*60*60)) ;
IPL_TIME = MOD ( IPL_TIME, 24*60*60 )  ;
PUT  ' IPL AT ' IPL_TIME TIME. ' '  IPL_DATE WEEKDATE37.
    ' ON MACHINE ' SYS_ID ;
NOTIPL:
IF TT=1 THEN PUT DATE      ;
* CHANGES MADE TO PROCESS FBM REC=245 1/11/77  ;
IF REC_TYPE^=5 AND REC_TYPE^=245 THEN DELETE;
INPUT @3 TIME PIB4. @7 DATE PD4. @72 CLASS $CHAR1. @11 CPU $4.     ;
HOUR=INT(TIME/360000);
IF HOUR<7 OR HOUR>16 THEN DELETE;
* CLASS CHANGES 12/23/76  ;
IF REC_TYPE=245 THEN CLASS='P';
IF CLASS='B' THEN CLASS='A'  ;
IF CLASS='E' THEN CLASS='D'   ;
IF CLASS='P' THEN CLASS='M'   ;
IF CLASS='Q' THEN CLASS='M'   ;
IF CLASS='I' THEN CLASS='G'   ;
IF CLASS='X' THEN CLASS='G'   ;
IF TT=1 THEN PUT '***DATE=' DATE        ;
OUTPUT FOUR;  RETURN  ;
PROC FREQ DATA=FOUR   ;
TABLES HOUR*CLASS CPU*HOUR*CLASS  / NOROW NOCOL;
DATA FIVE ;
SET OUT2.SMF9 ;
DATA SIX ;
SET FOUR END=TT    ;
IF TT^=1 THEN DELETE ;
IF TT=1 THEN PUT DATE ;
JOBS=_N_ ;
KEEP DATE JOBS;
DATA OUT2.SMF9 ;
SET FIVE SIX;
PROC PLOT  DATA = OUT2.SMF9     ;
PLOT JOBS*DATE    /
       HAXIS = 78000 TO 78150 BY 30   VAXIS = 1500 TO 3000 BY 100
       VREF= 1750 2000 2250 2500                                  ;
TITLE1 NUMBER OF JOBS PER DAY ;
PROC SORT  DATA=ABENDS ; BY JOBNAME STRT_TIM ;
PROC PRINT DATA=ABENDS ;
   TITLE   ONLINE SYSTEM STEP RECORDS ;
   VAR     JOBNAME
                    UP_TIME  ABEND    CODE     STRT_TIM   END_TIME ;
*PROC FREQ  DATA=ABENDS ;
*   TABLES  JOBNAME * (  ABEND    CODE               )               ;
